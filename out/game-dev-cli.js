#!/usr/bin/env ts-node --transpile-only
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const program = require("commander");
const Rx = require("rxjs");
const childProcess = require("child_process");
const readline = require("readline");
const operators_1 = require("rxjs/operators");
const fs = require("fs");
const path = require("path");
const _ = require("lodash");
const yaml = require("js-yaml");
program
    .version("0.0.1")
    .option("-v, --verbose", "Log child processes")
    .option("-s, --swarm", "Uses Docker Swarm")
    .option("-f, --follow", "Follow logs");
const execCmd = (command, args, stdin) => new Rx.Observable(observer => {
    const spawnee = childProcess.spawn(command, args);
    if (stdin) {
        spawnee.stdin.write(stdin);
        spawnee.stdin.end();
    }
    readline
        .createInterface({ input: spawnee.stdout, terminal: false })
        .on('line', line => {
        observer.next(line);
    });
    readline
        .createInterface({ input: spawnee.stderr, terminal: false })
        .on('line', line => {
        observer.error(line);
    });
    spawnee.on('close', (code) => {
        if (code === 0) {
            observer.complete();
        }
        else {
            observer.error(new Error(`child process exited with code ${code}`));
        }
    });
});
const cmd = (v, stdin) => {
    const [command, ...args] = v.split(" ");
    const cmd = execCmd(command, args, stdin);
    if (program.opts().verbose) {
        return cmd.pipe(operators_1.tap(console.log, console.error));
    }
    return cmd;
};
function dockerCompose(command) {
    const config = getComposeConfig(sanitizeConfigToCompose);
    return cmd("docker-compose -f - " + command, config)
        .pipe(convertErrorsToSuccess);
}
const ComposeImpl = {
    up() {
        return dockerCompose("up -d")
            .pipe(operators_1.tap(console.log));
    },
    stop() {
        return dockerCompose("stop");
    },
    down() {
        return dockerCompose("down");
    },
    ps() {
        return dockerCompose("ps")
            .pipe(operators_1.tap(console.log));
    },
    logs() {
        return dockerCompose(`logs ${program.follow ? "-f" : ""}`)
            .pipe(convertErrorsToSuccess, operators_1.tap(console.log));
    }
};
function sanitizeConfigToSwarm(config) {
    const compose = Object.assign({}, config);
    delete compose.services.gameserver.build;
    delete compose.services.webserver.build;
    return compose;
}
function sanitizeConfigToCompose(config) {
    const compose = Object.assign({}, config);
    delete compose.services.gameserver.deploy;
    delete compose.services.webserver.deploy;
    return compose;
}
function getComposeConfig(sanitize) {
    const p = path.resolve(__dirname, "../docker-compose.yml");
    const file = fs.readFileSync(p).toString();
    const config = yaml.safeLoad(file);
    const sanitizedConfig = sanitize(config);
    return yaml.safeDump(sanitizedConfig);
}
const DEPLOYMENT_NAME = process.env.SWARM_DEPLOYMENT_NAME || "game";
const logTask = (str) => (task) => {
    console.log(str.join("") + " ...");
    function logDone() {
        if (program.verbose) {
            console.log("... done.");
        }
    }
    const t = task();
    if (Rx.isObservable(t)) {
        return t.pipe(operators_1.tap({
            complete: logDone
        }));
    }
    else {
        return (async () => {
            const v = await t;
            logDone();
            return v;
        })();
    }
};
const handleSwarmErrors = operators_1.tap({
    error: (e) => {
        if (e.toLowerCase().startsWith("nothing found in stack:")) {
            console.error("No deployment found.");
        }
        if (e.startsWith("this node is not a swarm manager")) {
            console.error(e);
        }
    }
});
const convertErrorsToSuccess = operators_1.catchError(err => Rx.of(err));
operators_1.reduce((acc, curr) => acc + "\n" + curr, "");
const SwarmImpl = {
    async up() {
        await logTask `Building game:latest`(() => cmd("docker build -t game:latest .").toPromise());
        await logTask `Deploying to Swarm`(() => {
            const swarmComposeFile = getComposeConfig(sanitizeConfigToSwarm);
            return cmd(`docker stack deploy -c - ${DEPLOYMENT_NAME}`, swarmComposeFile)
                .pipe(handleSwarmErrors, convertErrorsToSuccess)
                .toPromise();
        });
    },
    async stop() {
        console.error("Docker swarm does not support stopping.");
    },
    down() {
        return logTask `Destroying Swarm deployment`(() => cmd(`docker stack rm ${DEPLOYMENT_NAME}`)
            .pipe(handleSwarmErrors, convertErrorsToSuccess));
    },
    ps() {
        return cmd(`docker stack ps ${DEPLOYMENT_NAME}`)
            .pipe(handleSwarmErrors, convertErrorsToSuccess, operators_1.tap(console.log));
    },
    logs() {
        const follow = program.follow;
        return execCmd("docker", ["stack", "ps", DEPLOYMENT_NAME, "--format={{json .}}"])
            .pipe(handleSwarmErrors, operators_1.map(v => JSON.parse(v)), operators_1.mergeMap(({ ID, Name }) => execCmd("docker", ["inspect", ID, "--format={{json .}}"])
            .pipe(operators_1.map(v => JSON.parse(v)), operators_1.mergeMap(({ Status: { ContainerStatus: { ContainerID } } }) => {
            return cmd(`docker logs ${ContainerID}${follow ? " -f" : ""}`)
                .pipe(convertErrorsToSuccess, operators_1.map(line => `${Name} | ${line}`));
        }))), operators_1.tap(console.log));
    }
};
const getOrchestrator = _.memoize(() => program.swarm
    ? SwarmImpl
    : ComposeImpl);
async function handle(v) {
    if (Rx.isObservable(v)) {
        await v.toPromise();
    }
    else {
        await v;
    }
}
async function up() {
    console.log("Creating deployment ...");
    await handle(getOrchestrator().up());
}
async function stop() {
    console.log("Stopping deployment ...");
    await handle(getOrchestrator().stop());
}
async function down() {
    console.log("Destroying deployment ...");
    await handle(getOrchestrator().down());
}
async function ps() {
    await handle(getOrchestrator().ps());
}
async function logs() {
    await handle(getOrchestrator().logs());
}
program
    .command("up")
    .description("Start the dev environment")
    .action(up);
program
    .command("stop")
    .description("Stop the dev environment")
    .action(stop);
program
    .command("down")
    .description("Destroy the dev environment")
    .action(down);
program
    .command("ps")
    .description("List containers")
    .action(ps);
program
    .command("logs")
    .description("Print logs")
    .action(logs);
program.parse(process.argv);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2FtZS1kZXYtY2xpLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc291cmNlL2dhbWUtZGV2LWNsaS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFFQSxxQ0FBcUM7QUFDckMsMkJBQTJCO0FBQzNCLDhDQUE4QztBQUM5QyxxQ0FBcUM7QUFDckMsOENBQXdFO0FBQ3hFLHlCQUF5QjtBQUN6Qiw2QkFBNkI7QUFDN0IsNEJBQTRCO0FBQzVCLGdDQUFnQztBQUVoQyxPQUFPO0tBQ0YsT0FBTyxDQUFDLE9BQU8sQ0FBQztLQUNoQixNQUFNLENBQUMsZUFBZSxFQUFFLHFCQUFxQixDQUFDO0tBQzlDLE1BQU0sQ0FBQyxhQUFhLEVBQUUsbUJBQW1CLENBQUM7S0FDMUMsTUFBTSxDQUFDLGNBQWMsRUFBRSxhQUFhLENBQUMsQ0FBQztBQUUzQyxNQUFNLE9BQU8sR0FBRyxDQUFDLE9BQWUsRUFBRSxJQUFjLEVBQUUsS0FBYyxFQUFFLEVBQUUsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxVQUFVLENBQ2xGLFFBQVEsQ0FBQyxFQUFFO0lBQ1AsTUFBTSxPQUFPLEdBQUcsWUFBWSxDQUFDLEtBQUssQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFFbEQsSUFBSSxLQUFLLEVBQUU7UUFDUCxPQUFPLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUMzQixPQUFPLENBQUMsS0FBSyxDQUFDLEdBQUcsRUFBRSxDQUFDO0tBQ3ZCO0lBRUQsUUFBUTtTQUNILGVBQWUsQ0FBQyxFQUFFLEtBQUssRUFBRSxPQUFPLENBQUMsTUFBTSxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQUUsQ0FBQztTQUMzRCxFQUFFLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFO1FBQ2YsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQTtJQUN2QixDQUFDLENBQUMsQ0FBQztJQUVQLFFBQVE7U0FDSCxlQUFlLENBQUMsRUFBRSxLQUFL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