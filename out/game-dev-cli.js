#!/usr/bin/env ts-node --transpile-only
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const program = require("commander");
const Rx = require("rxjs");
const childProcess = require("child_process");
const readline = require("readline");
const operators_1 = require("rxjs/operators");
const fs = require("fs");
const path = require("path");
const _ = require("lodash");
const yaml = require("js-yaml");
program
    .version("0.0.1")
    .option("-v, --verbose", "Log child processes")
    .option("-s, --swarm", "Uses Docker Swarm")
    .option("-f, --follow", "Follow logs");
const execCmd = (command, args, stdin) => new Rx.Observable(observer => {
    const spawnee = childProcess.spawn(command, args);
    if (stdin) {
        spawnee.stdin.write(stdin);
        spawnee.stdin.end();
    }
    readline
        .createInterface({ input: spawnee.stdout, terminal: false })
        .on('line', line => {
        observer.next(line);
    });
    readline
        .createInterface({ input: spawnee.stderr, terminal: false })
        .on('line', line => {
        observer.error(line);
    });
    spawnee.on('close', (code) => {
        if (code === 0) {
            observer.complete();
        }
        else {
            observer.error(new Error(`child process exited with code ${code}`));
        }
    });
});
const cmd = (v, stdin) => {
    const [command, ...args] = v.split(" ");
    const cmd = execCmd(command, args, stdin);
    if (program.opts().verbose) {
        return cmd.pipe(operators_1.tap(console.log, console.error));
    }
    return cmd;
};
function dockerCompose(command) {
    const config = getComposeConfig(sanitizeConfigToCompose);
    return cmd("docker-compose -f - " + command, config)
        .pipe(convertErrorsToSuccess);
}
const ComposeImpl = {
    up() {
        return dockerCompose("up -d")
            .pipe(operators_1.tap(console.log));
    },
    stop() {
        return dockerCompose("stop");
    },
    down() {
        return dockerCompose("down");
    },
    ps() {
        return dockerCompose("ps")
            .pipe(operators_1.tap(console.log));
    },
    logs() {
        return dockerCompose(`logs ${program.follow ? "-f" : ""}`)
            .pipe(convertErrorsToSuccess, operators_1.tap(console.log));
    }
};
function sanitizeConfigToSwarm(config) {
    const compose = Object.assign({}, config);
    delete compose.services.gameserver.build;
    delete compose.services.webserver.build;
    return compose;
}
function sanitizeConfigToCompose(config) {
    const compose = Object.assign({}, config);
    delete compose.services.gameserver.deploy;
    delete compose.services.webserver.deploy;
    return compose;
}
function getComposeConfig(sanitize) {
    const p = path.resolve(__dirname, "../docker-compose.yml");
    const file = fs.readFileSync(p).toString();
    const config = yaml.safeLoad(file);
    const sanitizedConfig = sanitize(config);
    return yaml.safeDump(sanitizedConfig);
}
const DEPLOYMENT_NAME = process.env.SWARM_DEPLOYMENT_NAME || "game";
const logTask = (str) => (task) => {
    console.log(str.join("") + " ...");
    function logDone() {
        if (program.verbose) {
            console.log("... done.");
        }
    }
    const t = task();
    if (Rx.isObservable(t)) {
        return t.pipe(operators_1.tap({
            complete: logDone
        }));
    }
    else {
        return (async () => {
            const v = await t;
            logDone();
            return v;
        })();
    }
};
const handleSwarmErrors = operators_1.tap({
    error: (e) => {
        if (e.toLowerCase().startsWith("nothing found in stack:")) {
            console.error("No deployment found.");
        }
        if (e.startsWith("this node is not a swarm manager")) {
            console.error(e);
        }
    }
});
const convertErrorsToSuccess = operators_1.catchError(err => Rx.of(err));
const concatToSingleString = operators_1.reduce((acc, curr) => acc + "\n" + curr, "");
const SwarmImpl = {
    async up() {
        await logTask `Building game:latest`(() => cmd("docker build -t game:latest .").toPromise());
        await logTask `Deploying to Swarm`(() => {
            const swarmComposeFile = getComposeConfig(sanitizeConfigToSwarm);
            return cmd(`docker stack deploy -c - ${DEPLOYMENT_NAME}`, swarmComposeFile)
                .pipe(handleSwarmErrors, convertErrorsToSuccess)
                .toPromise();
        });
    },
    async stop() {
        console.error("Docker swarm does not support stopping.");
    },
    down() {
        return logTask `Destroying Swarm deployment`(() => cmd(`docker stack rm ${DEPLOYMENT_NAME}`)
            .pipe(handleSwarmErrors, convertErrorsToSuccess));
    },
    ps() {
        return cmd(`docker stack ps ${DEPLOYMENT_NAME}`)
            .pipe(handleSwarmErrors, convertErrorsToSuccess, operators_1.tap(console.log));
    },
    logs() {
        const follow = program.follow;
        return execCmd("docker", ["stack", "ps", DEPLOYMENT_NAME, "--format={{json .}}"])
            .pipe(handleSwarmErrors, operators_1.map(v => JSON.parse(v)), operators_1.mergeMap(({ ID, Name }) => execCmd("docker", ["inspect", ID, "--format={{json .}}"])
            .pipe(operators_1.map(v => JSON.parse(v)), operators_1.mergeMap(({ Status: { ContainerStatus: { ContainerID } } }) => {
            return cmd(`docker logs ${ContainerID}${follow ? " -f" : ""}`)
                .pipe(convertErrorsToSuccess, operators_1.map(line => `${Name} | ${line}`));
        }))), operators_1.tap(console.log));
    }
};
const getOrchestrator = _.memoize(() => program.swarm
    ? SwarmImpl
    : ComposeImpl);
async function handle(v) {
    if (Rx.isObservable(v)) {
        await v.toPromise();
    }
    else {
        await v;
    }
}
async function up() {
    console.log("Creating deployment ...");
    await handle(getOrchestrator().up());
}
async function stop() {
    console.log("Stopping deployment ...");
    await handle(getOrchestrator().stop());
}
async function down() {
    console.log("Destroying deployment ...");
    await handle(getOrchestrator().down());
}
async function ps() {
    await handle(getOrchestrator().ps());
}
async function logs() {
    await handle(getOrchestrator().logs());
}
program
    .command("up")
    .description("Start the dev environment")
    .action(up);
program
    .command("stop")
    .description("Stop the dev environment")
    .action(stop);
program
    .command("down")
    .description("Destroy the dev environment")
    .action(down);
program
    .command("ps")
    .description("List containers")
    .action(ps);
program
    .command("logs")
    .description("Print logs")
    .action(logs);
program.parse(process.argv);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2FtZS1kZXYtY2xpLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc291cmNlL2dhbWUtZGV2LWNsaS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFFQSxxQ0FBcUM7QUFDckMsMkJBQTJCO0FBQzNCLDhDQUE4QztBQUM5QyxxQ0FBcUM7QUFDckMsOENBQWlGO0FBQ2pGLHlCQUF5QjtBQUN6Qiw2QkFBNkI7QUFDN0IsNEJBQTRCO0FBQzVCLGdDQUFnQztBQUVoQyxPQUFPO0tBQ0YsT0FBTyxDQUFDLE9BQU8sQ0FBQztLQUNoQixNQUFNLENBQUMsZUFBZSxFQUFFLHFCQUFxQixDQUFDO0tBQzlDLE1BQU0sQ0FBQyxhQUFhLEVBQUUsbUJBQW1CLENBQUM7S0FDMUMsTUFBTSxDQUFDLGNBQWMsRUFBRSxhQUFhLENBQUMsQ0FBQztBQUUzQyxNQUFNLE9BQU8sR0FBRyxDQUFDLE9BQWUsRUFBRSxJQUFjLEVBQUUsS0FBYyxFQUFFLEVBQUUsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxVQUFVLENBQ2xGLFFBQVEsQ0FBQyxFQUFFO0lBQ1AsTUFBTSxPQUFPLEdBQUcsWUFBWSxDQUFDLEtBQUssQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFFbEQsSUFBSSxLQUFLLEVBQUU7UUFDUCxPQUFPLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUMzQixPQUFPLENBQUMsS0FBSyxDQUFDLEdBQUcsRUFBRSxDQUFDO0tBQ3ZCO0lBRUQsUUFBUTtTQUNILGVBQWUsQ0FBQyxFQUFFLEtBQUssRUFBRSxPQUFPLENBQUMsTUFBTSxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQUUsQ0FBQztTQUMzRCxFQUFFLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFO1FBQ2YsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQTtJQUN2QixDQUFDLENBQUMsQ0FBQztJQUVQLFFBQVE7U0FDSCxlQUFlLENBQUMsRUFBRSxLQUFL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