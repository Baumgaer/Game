(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{11:function(t,e,s){"use strict";s.r(e),s.d(e,"BaseComponentFactory",(function(){return BaseComponentFactory}));var i=s(1),r=(s(26),s(25)),o=s(2),a=s(4),n=s(12),c=s(3),l=s(5);function BaseComponentFactory(t){class BaseComponent extends t{constructor(...t){super(...t),this.id=this.generateUniqueID(),this.isBaseComponent=!0,this.className=Object.getPrototypeOf(this.constructor).name,this.templateString="<div><slot></slot></div>",this.styleString=""}get properties(){const t=new Map,e=Object(a.getMetadata)(this,"definedProperties");if(e)for(const s of e.keys())t.set(s.toString(),Object(a.getWildcardMetadata)(this,s));return t}get refs(){const t={};if(!this.shadowRoot)return t;const e=Array.from(this.shadowRoot.querySelectorAll("[ref]"));for(const s of e){const e=s.getAttribute("ref");if(e){if(e in t)throw new Error(`ref ${e} already exists`);t[e]=s}}return t}get parentComponent(){let t=this,e=null;for(;!e;){const s=t.getRootNode();let i=t.parentElement;if(!i&&s instanceof ShadowRoot&&(i=s.host),!i)break;if(Object(l.isComponent)(i)){e=i;break}t=i}return e}get childComponents(){var t,e;const s=Array.from(null!==(e=null===(t=this.shadowRoot)||void 0===t?void 0:t.children)&&void 0!==e?e:[]).concat(Array.from(this.children)),i=[];for(const t of s)Object(l.isComponent)(t)&&i.push(t);return i}get firstComponentChild(){var t,e;const s=Array.from(null!==(e=null===(t=this.shadowRoot)||void 0===t?void 0:t.children)&&void 0!==e?e:[]).concat(Array.from(this.children));for(const t of s)if(Object(l.isComponent)(t))return t;return null}get lastComponentChild(){var t,e;let s=this.lastElementChild;for(;s;){if(Object(l.isComponent)(s))return s;s=s.previousElementSibling,s||(s=null!==(e=null===(t=this.shadowRoot)||void 0===t?void 0:t.firstElementChild)&&void 0!==e?e:null)}return null}get nextComponentSibling(){let t=this,e=null;for(;!e;){const s=t.getRootNode();let i=t.nextElementSibling;if(!i&&s instanceof ShadowRoot&&(i=s.host.firstElementChild),!i)break;if(Object(l.isComponent)(i)){e=i;break}t=i}return e}get previousComponentSibling(){var t,e;let s=this,i=null;for(;!i;){const r=s.getRootNode();let o=s.previousElementSibling;if(!o&&r instanceof ShadowRoot&&(o=null!==(e=null===(t=this.shadowRoot)||void 0===t?void 0:t.firstElementChild)&&void 0!==e?e:null),!o)break;if(Object(l.isComponent)(o)){i=o;break}s=o}return i}get bindings(){const t=Object(a.getMetadata)(this,"initiatorBinding");return t||new Map}static create(t){const e=Object(c.pascalCase2kebabCase)(Object.getPrototypeOf(this).name);let s=this.extends,i=e;s&&(i=s,s=e),this.isProceduralComponentConstruction=!0;const r=document.createElement(i,{is:s});return this.isProceduralComponentConstruction=!1,r.invokeLifeCycle(t),s&&r.setAttribute("is",s,!0),r}invokeLifeCycle(t){throw new Error("This is not a BaseConstructor")}getNamespacedStorage(t,e,s){return Object(n.getNamespacedStorage)(this,t,e,s)}setUpdateNamespacedStorage(t,e,s){return Object(n.setUpdateNamespacedStorage)(this,t,e,s)}deleteFromNamespacedStorage(t,e){return Object(n.deleteFromNamespacedStorage)(this,t,e)}setAttribute(t,e,s=!0){if(this.properties&&this.properties.has(t))throw new Error(`"${t}" can't be set as attribute because it is a defined property`);if(e){let i=e;Object(c.isPrimitive)(e)||(i=JSON.stringify(e).replace(/\"/g,"'")),super.setAttribute(t,i),i=Object(c.constructTypeOfHTMLAttribute)(this,t),s&&(this[t]=i)}else this.removeAttribute(t)}removeAttribute(t){if(this.properties&&this.properties.has(t))throw new Error(`"${t}" can't be removed as attribute because it is a defined property`);super.removeAttribute(t),this[t]=void 0}setStyle(t,e,s){let i=null;t instanceof HTMLElement?s&&(i=s):(i=e,e=t,t=this),t.style.setProperty(e,i)}removeStyle(t,e){let s=null;t instanceof HTMLElement?e&&(s=e):(s=t,t=this),s&&t.style.removeProperty(s)}place(t,e,s){let i=t,r=e,o=s;if(e instanceof Element||(o=e,i=t,r=this),o||(o="last"),"number"==typeof o){const t=Array.from(i.children);t.length<=o?o="last":o<=0?o="first":(i=t[o+1],o="before")}"after"===o&&(i.nextElementSibling?(i=i.nextElementSibling,o="before"):(i=i.parentElement,s="last")),"first"===o&&i.prepend(r),"last"===o&&i.appendChild(r),"replace"===o&&i.replaceWith(r),"before"===o&&i.parentElement.insertBefore(r,i)}toJSON(){const t={};for(const e in this)if(void 0!==this[e]){const s=this[e];t[e]=s}return t}renderTemplate(){if(!this.constructor.extends){let t=null;if(Object(c.isString)(this.templateString)&&(t=Object(r.renderString)(this.templateString,this.toJSON())),Object(c.isObject)(this.templateString)&&(t=this.templateString.render(this.toJSON())),t){const e=this.attachShadow({mode:"open"}),s=(new DOMParser).parseFromString(`<style>${this.styleString}</style>${t}`,"text/html");e.appendChild(s.head.firstChild),e.appendChild(s.body.firstChild)}}}constructedCallback(){}connectedCallback(){}disconnectedCallback(){}adoptedCallback(){}addController(){}removeController(){}generateUniqueID(){const t=Object.getPrototypeOf(this.constructor).name,e=Array.from(document.getElementsByTagName(this.tagName)),s=e.indexOf(this);let i=s>=0?s:e.length;for(;document.getElementById(`${t}_${i}`);)i++;return`${t}_${i}`}}return BaseComponent.isBaseComponent=!0,BaseComponent.isProceduralComponentConstruction=!1,Object(i.__decorate)([Object(o.attribute)(),Object(i.__metadata)("design:type",String)],BaseComponent.prototype,"id",void 0),Object(i.__decorate)([Object(o.property)(),Object(i.__metadata)("design:type",Boolean)],BaseComponent.prototype,"isBaseComponent",void 0),Object(i.__decorate)([Object(o.property)(),Object(i.__metadata)("design:type",String)],BaseComponent.prototype,"className",void 0),Object(i.__decorate)([Object(o.property)({disableTypeGuard:!0}),Object(i.__metadata)("design:type",Object)],BaseComponent.prototype,"templateString",void 0),Object(i.__decorate)([Object(o.property)({disableTypeGuard:!0}),Object(i.__metadata)("design:type",String)],BaseComponent.prototype,"styleString",void 0),BaseComponent}},14:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(3),r=s(32),o=s(5),a=s(4),n="initiatorBinding";e.Binding=class Binding{constructor(t,e,s="ReadWrite"){this.object=t,this.property=e,this.mode=s,this.descriptor=this.getOriginalPropertyDescriptor(this.object,this.property)}setValue(t){this.value=t}valueOf(){return this.value||this.object[this.property]}install(t,e){this.initiator=t,this.initiatorProperty=e,this.initiatorDescriptor=this.getOriginalPropertyDescriptor(this.initiator,this.initiatorProperty),Reflect.hasMetadata(n,this.initiator)||a.defineMetadata(this.initiator,n,new Map),Reflect.hasMetadata("bindings",this.object)||a.defineMetadata(this.object,"bindings",new Map);const s=a.getMetadata(this.initiator,n)||new Map,i=s.get(this.initiatorProperty);i&&i.remove();const o=a.getMetadata(this.object,"bindings")||new Map;o.has(this.property)||o.set(this.property,[]),o.get(this.property).push(this),s.set(this.initiatorProperty,this);const c=`field:${this.property}`,l=a.getWildcardMetadata(this.object,this.property),h=a.getWildcardMetadata(this.initiator,this.initiatorProperty);let d=a.getWildcardMetadata(this.object,c);d||a.defineWildcardMetadata(this.object,c,new r.Field(this.object,this.property)),d=a.getWildcardMetadata(this.object,c),d.addField(l),d.addField(h),this.replaceDescriptor(),Reflect.set(this.initiator,this.initiatorProperty,this.valueOf())}remove(){const t=this.object[this.property],e=this.initiator[this.initiatorProperty],s=a.getMetadata(this.object,"bindings"),r=s?s.get(this.property):void 0,o=a.getMetadata(this.initiator,n),c=o?o.get(this.initiatorProperty.toString()):void 0,l=`field:${this.property}`,h=a.getWildcardMetadata(this.object,l);c&&(o&&o.delete(this.initiatorProperty.toString()),this.restoreDescriptor(this.initiator,this.initiatorProperty,e,this.initiatorDescriptor),h.removeField(a.getWildcardMetadata(this.initiator,this.initiatorProperty))),r&&(i.removeElementFromArray(r,this),h.removeField(a.getWildcardMetadata(this.object,this.property)),r.length||(s&&s.delete(this.property),this.restoreDescriptor(this.object,this.property,t,this.descriptor),a.defineWildcardMetadata(this.object,l,null)))}replaceDescriptor(){const t=this;Reflect.deleteProperty(this.object,this.property),Reflect.defineProperty(this.object,this.property,{get:function bindingGet(){if("WriteOnly"!==t.mode||this!==t.initiator)return o.getter(t.object,t.property,"field")},set:function bindingSet(e){"ReadOnly"===t.mode&&this===t.initiator||o.setter(t.object,t.property,e,"field")},configurable:!0,enumerable:!0});const e=Reflect.getOwnPropertyDescriptor(this.object,this.property);Reflect.deleteProperty(this.initiator,this.initiatorProperty),Reflect.defineProperty(this.initiator,this.initiatorProperty,e),a.defineMetadata(this.object,"bindingDescriptor",e)}restoreDescriptor(t,e,s,i){Reflect.deleteProperty(t,e),i&&Reflect.defineProperty(this.initiator,this.initiatorProperty,i),t[e.toString()]=s}getOriginalPropertyDescriptor(t,e){let s=Reflect.getOwnPropertyDescriptor(t,e),i="bindings",r=t;for(t===this.initiator&&(i=n);!s&&(r=Object.getPrototypeOf(r),r);)"BaseConstructor"===r.constructor.name&&(r=Object.getPrototypeOf(r)),s=Reflect.getOwnPropertyDescriptor(r,e);let o=!1;if(s&&(s.set&&"bindingSet"===s.set.name&&(o=!0),s.get&&"bindingGet"===s.get.name&&(o=!0)),o){const r=a.getMetadata(t,i),o=r?r.get(e.toString()):void 0;o&&(s=o instanceof Array?o[0].descriptor:o.initiatorDescriptor)}return s}}},15:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(1),r=s(16),o=s(3),a=i.__importDefault(s(13)),n=i.__importDefault(s(192));e.Watched=class Watched{constructor(t,e,s){this.isShallow=!0,this.isInitialized=!1,this.object=t,this.property=e;const i=o.ucFirst(e),r=`on${i}Init`,a=`on${i}Change`,n=`on${i}Add`,c=`on${i}Remove`;this.onInit=s&&s.onInit||r,this.onChange=s&&s.onChange||a,this.onAdd=s&&s.onAdd||n,this.onRemove=s&&s.onRemove||c,this.isShallow=s&&"boolean"==typeof s.isShallow?s.isShallow:this.isShallow}setValue(t){if(!this.shouldDoSetValue(t))return;const e=n.default(this.ownValue);let s;s=t instanceof r.Modification?t.valueOf():t;let i=!1;t instanceof r.Modification&&(t.setValue(s),i=!0);const a=i?t:s;this.subObject?(this.subObject.setValue(a),this.ownValue=o.getProxyTarget(this.subObject.valueOf())):(s=this.proxyfyValue(s),this.value=s,this.ownValue=o.getProxyTarget(s));const c=this.object;o.isFunction(c[this.onChange])&&this.isInitialized&&c[this.onChange](e),o.isFunction(c[this.onInit])&&!this.isInitialized&&c[this.onInit](s),this.isInitialized=!0}valueOf(){return this.subObject?this.subObject.valueOf():this.value}setSubObject(t){t.proxyHandlerReplacement=this.proxyHandler.bind(this),t.isShallow=this.isShallow,this.subObject=t}proxyHandler(t,e,s){this.subObject&&this.subObject.proxyHandler(t,e,s);const i=e?Object.keys(e):[],r=s?Object.keys(s):[],o=i.length,a=r.length;this.caseDetectExec({len1:o,len2:a,func:this.onAdd,keys1:i,keys2:r,changedVal:e,path:t}),this.caseDetectExec({len1:a,len2:o,func:this.onRemove,keys1:r,keys2:i,changedVal:e,path:t}),o===a&&this.onChange in this&&this.isInitialized&&this.object[this.onChange](e,t)}shouldDoSetValue(t,e=!1){return this.subObject?this.subObject.shouldDoSetValue(t,e):t!==this.ownValue}proxyfyValue(t){return t instanceof Array||o.isObject(t)&&!t.isBDOModel?(t=a.default.target(t),a.default(t,(t,e,s)=>{this.proxyHandler(t,e,s)},{isShallow:this.isShallow})):t}caseDetectExec(t){if(t.len1>t.len2&&t.func in this.object)for(const e of t.keys1)if(!t.keys2.includes(e)){this.object[t.func](t.changedVal[e],t.path);break}}}},16:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.Modification=class Modification{constructor(t,e="delete"){this.value=t,this.type=e}valueOf(){return this.value}setValue(t){this.value=t}}},17:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(5);class ModelRegistry{constructor(){this.models=new Map}static getInstance(){return ModelRegistry.instance||(ModelRegistry.instance=new ModelRegistry),ModelRegistry.instance}register(t){this.models.set(`${t.className}${t.id}`,t)}unregister(t){this.models.delete(`${t.className}${t.id}`)}getModelById(t,e){return this.models.get(`${this.getClassName(e)}${t}`)}getModelsByAttributes(t){const e=[];return this.models.forEach(s=>{for(const e in t)if(t.hasOwnProperty(e)){const i=t[e];if(!(e in s)||i!==s[e])return}e.push(s)}),e}updateID(t,e){const s=this.models.get(`${this.getClassName(e)}${t}`);s&&(this.models.delete(`${this.getClassName(e)}${t}`),this.register(s))}getModelsByCondition(t,e="all"){const s=[];let i;for(const r of this.models.values())if(t(r)){if("first"===e)return r;"all"===e&&s.push(r),"last"===e&&(i=r)}return"last"===e?i:s}getClassName(t){let e;return e=i.isBaseConstructor(t)||"className"in t?t.className:"function"==typeof t?t.name:t.constructor.name,e}}e.ModelRegistry=ModelRegistry},175:function(t,e,s){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0});const r=s(1),o=s(221),a=s(35),n=s(14),c=s(2),l=s(4),h=s(17);let d=i=class BDOModel{constructor(){this.isBDOModel=!0,this.collectionName=i.collectionName,this.databaseName=i.databaseName,this.id=`pending_${o.v4()}`,this.className=Object.getPrototypeOf(this.constructor).name,h.ModelRegistry.getInstance().register(this)}get bindings(){const t=l.getMetadata(this,"bindings");return t||new Map}static getInstanceByID(t){throw new Error("Not implemented")}getReferenceString(){return`_reference:${this.className}${this.id}`}bind(t,e){return new n.Binding(this,t,e)}toString(){const t=this.toJSON();return JSON.stringify(t)}toJSON(){const t={};for(const e in this)if(void 0!==this[e]){const s=this[e];t[e]=s}return t}async isUnsaved(t){const e=await this.getUnsavedChanges();let s=!1;return e&&e.hasOwnProperty(t)&&(s=!0),Promise.resolve(s)}async hasUnsavedChanges(){const t=await this.getUnsavedChanges();return Promise.resolve(Boolean(Object.keys(t).length))}};d.graphQLType=Object.getPrototypeOf(i.constructor),d.isBDOModel=!0,r.__decorate([c.property(),r.__metadata("design:type",Boolean)],d.prototype,"isBDOModel",void 0),r.__decorate([c.property(),r.__metadata("design:type",String)],d.prototype,"collectionName",void 0),r.__decorate([c.property(),r.__metadata("design:type",String)],d.prototype,"databaseName",void 0),r.__decorate([c.attribute(t=>a.ID),r.__metadata("design:type",String)],d.prototype,"id",void 0),r.__decorate([c.attribute(),r.__metadata("design:type",String)],d.prototype,"className",void 0),d=i=r.__decorate([c.baseConstructor({isAbstract:!0}),r.__metadata("design:paramtypes",[])],d),e.BDOModel=d},176:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(3),r=s(8);class BDORoute{constructor(){this.routerNameSpace=`/${this.constructor.name.toLowerCase()}`,this.routes=["/"],this.templateString="<div></div>",this.jsonOnly=!1}renderTemplate(t){let e=null;return i.isString(this.templateString)&&(e=r.templateEnvironment.renderString(this.templateString,t)),i.isObject(this.templateString)&&(e=this.templateString.render(t)),e}async templateParams(t){return{}}}e.BDORoute=BDORoute,BDORoute.attachToServers=["*"]},18:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(176),r=s(3),o=new(s(22).Logger);class ClientRoute extends i.BDORoute{constructor(){super(...arguments),this.isClientRoute=!0}get router(){const t={};for(const e of this.routes)t[`${this.routerNameSpace}/${e}`.replace("//","/")]=this.handleGet.bind(this);return t}async templateParams(t){return super.templateParams(t)}async handleGet(t){o.log(r.merge(await this.templateParamsFromServer(),await this.templateParams(t)))}async templateParamsFromServer(){let t=location.pathname;t||(t="/");const e=new Headers({"X-Game-As-JSON":"true"});return(await fetch(t,{headers:e})).json()}}e.ClientRoute=ClientRoute},180:function(t,e,s){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0});const r=s(1),o=s(2),a=s(175),n=s(12),c=s(5),l=s(4),h=s(22),d=s(181),u=s(15),p=s(3),g=s(17),f=new h.Logger,b=d.DatabaseManager.getInstance();let y=i=class ClientModel extends a.BDOModel{constructor(){super(...arguments),this.isClientModel=!0}static getInstanceByID(t){return new Promise(async e=>{let r=g.ModelRegistry.getInstance().getModelById(t,this);r||(r=new this);const o=await b.database(r.databaseName).collection(r.collectionName).get(t);if(o){const t=[];for(const e in o)if(o.hasOwnProperty(e)){const a=Reflect.get(r,e);let n,l=o[e],h=[];if(a instanceof Array&&(h=a.map(t=>t instanceof i?t.getReferenceString():t)),l instanceof Array&&p.difference(h,l).length){const e=[];for(let t of l)if(c.isReferenceString(t)){const i=t.split(":")[1],r=i[1];n=s(182)(`./${r}.ts`)[r],e.push(n.getInstanceByID(i[2]).then(e=>{t=e}))}t.push(Promise.all(e).then())}else if(c.isReferenceString(l)&&l!==r.getReferenceString()){const e=l.split(":")[1],i=e[1];n=s(182)(`./${i}.ts`)[i],t.push(n.getInstanceByID(e[2]).then(t=>{l=t}))}}await Promise.all(t),Object.assign(r,o)}return r.id.includes("pending")?e():e(r)})}static getInstancesByAttributes(t){return g.ModelRegistry.getInstance().getModelsByAttributes(t)}getNamespacedStorage(t,e,s){return n.getNamespacedStorage(this,t,e,s)}setUpdateNamespacedStorage(t,e,s){return n.setUpdateNamespacedStorage(this,t,e,s)}deleteFromNamespacedStorage(t,e){return n.deleteFromNamespacedStorage(this,t,e)}async save(t){const e=l.getMetadata(this,"definedAttributes");if(!e||t&&!e.has(t))throw new Error("invalid defined attributes");const s=t?[t]:e.keys(),r=await this.getUnsavedChanges(),o={},a={};for(const t of s)if(r.hasOwnProperty(t)){const e=t;let s=p.getProxyTarget(r[e]);s instanceof Array&&(s=s.map(t=>t instanceof i?t.getReferenceString():p.getProxyTarget(t))),s instanceof i&&(s=s.getReferenceString());let n=l.getWildcardMetadata(this,e);n instanceof u.Watched&&(n=n.subObject),n.doNotPersist||(o[e]=s),n.noServerInteraction||(a[e]=s)}try{Object.keys(o).length&&await b.database(this.databaseName).collection(this.collectionName).update(this.id,o),Object.keys(a).length&&f.debug(`send ${JSON.stringify(a)} to server`)}catch(t){return Promise.reject(t)}return Promise.resolve(r)}discard(t){throw new Error("Method not implemented.")}async getUnsavedChanges(){if(!this.collectionName)return Promise.reject("No collectionName provided");const t={};let e=await b.database("default").collection(this.collectionName).get(this.id);const s=l.getMetadata(this,"definedAttributes");if(e=e||{},s)for(const i of s.keys()){const s=i.toString(),r=p.getProxyTarget(this[i]);(p.isArray(r)&&p.difference(r,e[s]).length||p.isObject(r)&&!p.isEqual(r,e[s])||p.isPrimitive(r)&&r!==e[s])&&(t[s]=this[i])}return Promise.resolve(t)}onTypeCheckFail(t){f.error(t.message)}};y.isClientModel=!0,r.__decorate([o.property(),r.__metadata("design:type",Boolean)],y.prototype,"isClientModel",void 0),y=i=r.__decorate([o.baseConstructor()],y),e.ClientModel=y},181:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(1),r=s(46),o=i.__importDefault(s(208));class DatabaseManager extends r.BDODatabasemanager{constructor(){super(),this.databases=new Map}static getInstance(){return DatabaseManager.instance||(DatabaseManager.instance=new DatabaseManager),DatabaseManager.instance}database(t){return this.currentDatabase=t,this.databases.hasOwnProperty(t)||this.databases.set(t,o.default.createInstance({name:t,driver:[o.default.INDEXEDDB,o.default.WEBSQL]})),delete this.currentCollection,delete this.currentGraph,delete this.currentView,this}collection(t){return this.currentCollection=`collection_${t}`,this.getDatabase().config({storeName:this.currentCollection}),delete this.currentGraph,delete this.currentView,this}view(t){return this.currentView=`view_${t}`,this.getDatabase().config({storeName:this.currentView}),delete this.currentCollection,delete this.currentGraph,this}graph(t){return this.currentGraph=`graph_${t}`,this.getDatabase().config({storeName:this.currentGraph}),delete this.currentCollection,delete this.currentView,this}get(t){return this.getDatabase().getItem(t)}insert(t,e){return this.getDatabase().setItem(t,e)}update(t,e){return new Promise(async(s,i)=>{try{const i=await this.get(t)||{};Object.assign(i,e),await this.insert(t,i),s()}catch(t){i(t)}})}delete(t){return this.getDatabase().removeItem(t)}clear(){return this.getDatabase().clear()}length(){return this.getDatabase().length()}key(t){return this.getDatabase().key(t)}keys(){return this.getDatabase().keys()}iterate(t){return this.getDatabase().iterate(t)}getDatabase(){if(!this.currentDatabase)throw new Error("No Database chosen");return this.databases.get(this.currentDatabase)}}e.DatabaseManager=DatabaseManager},20:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(1),r=s(16),o=s(4),a=s(8),n=s(3),c=s(21),l=i.__importDefault(s(13));e.Property=class Property{constructor(t,e,s){this.isShallow=!0,this.object=t,this.property=e;let i={};s&&s.params&&(i=s.params),Object.assign(this,i);const r=n.ucFirst(e),o=`on${r}TypeCheckFail`,a=`on${r}TypeCheck`,c=`on${r}TypeCheckSuccess`;this.onTypeCheckFail=i&&i.onTypeCheckFail||o,this.onTypeCheck=i&&i.onTypeCheck||a,this.onTypeCheckSuccess=i&&i.onTypeCheckSuccess||c}setValue(t){this.doSetValue(t,!0)}valueOf(){const t=this.property.toString();let e=this.value;return!n.isProxy(e)&&this.saveInLocalStorage&&n.isFunction(this.object.getNamespacedStorage)&&(e=this.object.getNamespacedStorage(t)),e}typeGuard(t){let e=t;t instanceof r.Modification&&(e=t.valueOf());const s=o.getDesignType(this.object,this.property.toString()),i=new c.TypeError(`${e} is not type of ${s.className||s.name}`),a=this.object;let l;if(this.nullable||null!=e||(l=i),l||(n.isPrimitive(e)?typeof e!==s.name.toLowerCase()&&(this.nullable&&null==e||(l=i)):e instanceof s||(l=i)),!l&&n.isFunction(a[this.onTypeCheck])&&(l=a[this.onTypeCheck](e)),l)if(n.isFunction(a[this.onTypeCheckFail]))a[this.onTypeCheckFail](l);else{if(!n.isFunction(a.onTypeCheckFail))throw l;a.onTypeCheckFail(l)}else n.isFunction(a[this.onTypeCheckSuccess])&&a[this.onTypeCheckSuccess]();return!Boolean(l).valueOf()}proxyHandler(t,e,s){const i=this.value;null!=i&&this.doSetValue(l.default.target(i),!1)}shouldDoSetValue(t,e=!1){return!(t===this.ownValue||!e&&!this.disableTypeGuard&&!this.typeGuard(t))}doSetValue(t,e=!0,s=!1){if(!this.shouldDoSetValue(t,s))return;let i;if(i=t instanceof r.Modification?t.valueOf():t,e){const t=this.proxyfyValue(i);this.value=t,this.ownValue=i}this.shouldUpdateNsStorage()&&n.isFunction(this.object.setUpdateNamespacedStorage)&&this.object.setUpdateNamespacedStorage(this.property.toString(),i)}proxyfyValue(t){return t instanceof Array||n.isObject(t)&&!t.isBDOModel?(t=l.default.target(t),l.default(t,(t,e,s)=>{this.proxyHandlerReplacement?this.proxyHandlerReplacement(t,e,s):this.proxyHandler(t,e,s)},{isShallow:this.isShallow})):t}shouldUpdateNsStorage(){if(!this.saveInLocalStorage||!a.isBrowser())return!1;const t=this.property.toString(),e=o.getMetadata(this.object,"keyShouldBeUpdated")||{};return!!e[t]||(n.isFunction(this.object.getNamespacedStorage)&&void 0===this.object.getNamespacedStorage(t)?(o.defineMetadata(this.object,"keyShouldBeUpdated",Object.assign(e,{[t]:!0})),!0):Boolean(o.getMetadata(this.object,"constructionComplete")))}}},209:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.BaseController=class BaseController{constructor(){}constructedCallback(){}connectedCallback(){}disconnectedCallback(){}adoptedCallback(){}}},21:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class ValueError extends Error{}e.ValueError=ValueError;class TypeError extends Error{}e.TypeError=TypeError;class ConfigurationError extends Error{}e.ConfigurationError=ConfigurationError},210:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(44);class ConfigManager extends i.BDOConfigManager{set(t){throw new Error("Method not implemented.")}load(t){throw new Error("Method not implemented.")}getCache(t){throw new Error("Method not implemented.")}setCache(t,e){throw new Error("Method not implemented.")}}e.ConfigManager=ConfigManager},22:function(t,e,s){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0});const r=s(1),o=s(47),a=s(2);let n=class Logger extends o.BDOLogger{constructor(t){super(t),this.logLevelColors={log:"color: gray; font-weight: bold;",debug:"color: green; font-weight: bold;",info:"color: #00806B; font-weight: bold;",warn:"color: #808000; font-weight: bold;",error:"color: red; font-weight: bold;"}}getHeader(t,e="console"){const s=this.getProcInfo(),i=this.currentTime(),r=t.toUpperCase(),o=this.getLogPoint(),a="color: black; font-weight: normal",n="color: #800080; font-weight: normal";if("console"===e){return[`%c[%c${r} %c- %c${s} %c- %c${i} %cat %c${o}%c]`,a,this.logLevelColors[t],a,n,a,"color: #00806B; font-weight: normal",a,n,a]}return`[${r} - ${s} - ${i} - ${o}]`}writeToFile(t,e){}};n=r.__decorate([a.baseConstructor(),r.__metadata("design:paramtypes",["function"==typeof(i="undefined"!=typeof ConstParams&&ConstParams)?i:Object])],n),e.Logger=n},31:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(14),r=s(4),o=s(3),a=s(5);e.baseConstructorFactory=function baseConstructorFactory(t,e){class BaseConstructor extends t{constructor(...t){super(...t),this.collectionName=BaseConstructor.collectionName,this.databaseName=BaseConstructor.databaseName;const s=t[e];r.defineMetadata(this,"normalFunctionality",!0),BaseConstructor.isProceduralComponentConstruction||this.invokeLifeCycle(s)}invokeLifeCycle(e){e instanceof Object||(e={});let s=r.getMetadata(this,"defaultSettings")||{};if(s=Object.assign(s,e),o.isFunction(this.getNamespacedStorage)){const t=e.id||s.id,r=this.getNamespacedStorage("*","id",t)||{};for(const t in r)if(r.hasOwnProperty(t)){const e=s[t];e instanceof i.Binding?e.setValue(r[t]):s[t]=r[t]}}Object.assign(this,s),r.defineMetadata(this,"constructionComplete",!0),a.isComponent(t)&&o.isFunction(this.renderTemplate)&&this.renderTemplate(),o.isFunction(this.constructedCallback)&&this.constructedCallback()}}return BaseConstructor.className=Object.getPrototypeOf(BaseConstructor).name,BaseConstructor.graphQLType=t,BaseConstructor.collectionName=r.getMetadata(BaseConstructor,"collectionName"),BaseConstructor.databaseName=r.getMetadata(BaseConstructor,"databaseName"),BaseConstructor.isProceduralComponentConstruction=!1,BaseConstructor}},32:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(1),r=s(15),o=s(3),a=s(4),n=i.__importDefault(s(13));e.Field=class Field{constructor(t,e){this.fields=[],this.object=t,this.property=e}addField(t){this.fields.includes(t)||(t.object&&t.object.isBDOModel&&(this.value=this.proxyfyValue(t.valueOf())),t instanceof r.Watched&&t.subObject&&this.redefineValue(t.subObject),this.redefineValue(t),this.fields.push(t))}removeField(t){this.fields.includes(t)&&(t instanceof r.Watched&&t.subObject&&this.restoreValue(t.subObject),this.restoreValue(t),o.removeElementFromArray(this.fields,t))}setValue(t){for(const e of this.fields)e.setValue(t)}valueOf(){return this.value}redefineValue(t){a.defineWildcardMetadata(t,"value",t.valueOf());const e=this;Reflect.deleteProperty(t,"value"),Reflect.defineProperty(t,"value",{get:()=>e.value,set(t){(t=o.getProxyTarget(t))!==o.getProxyTarget(e.value)&&(e.value=e.proxyfyValue(t))},configurable:!0,enumerable:!0})}restoreValue(t){Reflect.deleteProperty(t,"value"),t.setValue(o.getProxyTarget(this.value))}proxyfyValue(t){if(t instanceof Array||o.isObject(t)&&!t.isBDOModel){let e=!0;for(const t of this.fields)if(!t.isShallow){e=!1;break}return t=n.default.target(t),n.default(t,(t,e,s)=>{const i=t.split(".").length;for(const r of this.fields)(!r.isShallow||r.isShallow&&i<=1)&&r.proxyHandler(t,e,s)},{isShallow:e})}return t}}},34:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(20),r=s(8),o=s(16),a=s(3),n=s(21),c=s(17);class Attribute extends i.Property{constructor(t,e,s){super(t,e,s),this.inDOMInitialized=!1,this.autoSaveAllowed=!1}setValue(t){if(!this.shouldDoSetValue(t))return;let e;this.object.isBDOModel&&"id"===this.property&&(e=this.ownValue),this.doSetValue(t,!0,!0),e&&c.ModelRegistry.getInstance().updateID(e,this.object),this.reflectToDOMAttribute(t),this.doAutoSave()}proxyHandler(t,e,s){const i=this.value;null!=i&&(this.doSetValue(a.getProxyTarget(i),!0,!0),this.reflectToDOMAttribute(i),this.doAutoSave())}getUnsavedChange(){}shouldDoSetValue(t,e=!1){if(r.isBrowser()&&!this.object.isBDOModel&&this.object instanceof HTMLElement){const e=a.constructTypeOfHTMLAttribute(this.object,this.property);if(!this.inDOMInitialized&&this.object.getAttribute(this.property)&&t!==e)return this.setValue(e),!1}return!(t===this.ownValue||!e&&!this.disableTypeGuard&&!this.typeGuard(t))}reflectToDOMAttribute(t){if(!(r.isBrowser()&&this.object instanceof HTMLElement))return;const e=this.property.toString(),s=this.object.getAttribute(e);let i,n=!0,c=t;t instanceof o.Modification&&(c=t.valueOf()),!this.inDOMInitialized&&s?n=!1:i=a.getProxyTarget(c),this.inDOMInitialized=!0,n&&s!==i&&s!==JSON.stringify(i).replace(/\"/g,"'")&&this.object.setAttribute(e,i,!1)}doAutoSave(){if(this.autoSave&&this.doNotPersist)throw new n.ConfigurationError("You have turned on autosave but at the same time it is forbidden to persist the value!");this.autoSaveAllowed?this.autoSave&&a.isFunction(this.object.save)&&("boolean"==typeof this.autoSave&&this.object.save(this.property),"number"!=typeof this.autoSave||this.autoSaveTimeout||(this.autoSaveTimeout=setTimeout(()=>{this.object.save(this.property),delete this.autoSaveTimeout},Math.abs(this.autoSave)))):this.autoSaveAllowed=!0}}e.Attribute=Attribute},44:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(1).__importDefault(s(205)),r=s(45);e.BDOConfigManager=class BDOConfigManager{constructor(){this.cache=new r.BDOMapCache}async get(t){let e=await this.getCache(t);return e||(e=await this.load(t),await this.setCache(t,e)),Promise.resolve(e)}getCache(t){const e=this.cache.get(t);return e||null}async setCache(t,e){let s=this.cache.get("__ConfigManagerCacheTimeout__");this.cache.has("__ConfigManagerCacheTimeout__")||(s=(await this.load("config")).timeouts.configCache,s&&(s=i.default(s)),this.cache.set("__ConfigManagerCacheTimeout__",s)),this.cache.set(t,e,s)}}},45:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class Entity{constructor(t,e){this.expire=1/0,this.data=t,this.expire=(new Date).getTime()+(e||1/0)}get expired(){return!!this.expire&&this.expire<(new Date).getTime()}}class BDOMapCache extends Map{set(t,e,s){const i=new Entity(e,s);return super.set(t,i)}get(t){const e=super.get(t);if(void 0!==e&&!e.expired)return e.data;this.delete(t)}}e.BDOMapCache=BDOMapCache},46:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.BDODatabasemanager=class BDODatabasemanager{}},47:function(t,e,s){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});const i=s(1).__importDefault(s(0)),r=s(207),o=s(3);e.BDOLogger=class BDOLogger{constructor(t){this.logFile="default.log",this.preventConsolePrint=!1,this.preventFilePrint=!1,this.logLevel="debug",this.prototypeNames=o.getPrototypeNamesRecursive(this)}log(t,e="log",...s){if("log"!==e&&!this.isAllowed(e))return;if(!this.preventConsolePrint||["log","error"].includes(e)){const i=this.getHeader(e);let r=[];i instanceof Array?r=r.concat(i):r.push(i),r.push(t),r=r.concat(s),console[e].apply(this,r)}const i=JSON.stringify(s);this.preventFilePrint&&"error"!==e||this.writeToFile(e,t+i.substr(1,i.length-2))}debug(t,...e){const s=[t,"debug"].concat(e);this.log.apply(this,s)}info(t,...e){const s=[t,"info"].concat(e);this.log.apply(this,s)}warn(t,...e){const s=[t,"warn"].concat(e);this.log.apply(this,s)}error(t,...e){const s=[t,"error"].concat(e);this.log.apply(this,s)}getProcInfo(){return`${t.process.env.name||""} ${t.process.env.hostname||""} ${t.process.pid}`}isAllowed(t){const e=["log","debug","info","warn","error"];return e.indexOf(t)>=e.indexOf(this.logLevel)}currentTime(){return i.default().format("DD.MM.YYYY HH:mm:ss")}getLogPoint(){const t=(new Error).stack.split("\n");let e;for(const[s,i]of t.entries())if(s&&!o.includesMemberOfList(i,this.prototypeNames,".ts")){e=i.split(r.sep).pop();break}return e=e?e.replace(")",""):"",e}}}).call(this,s(6))}}]);