(window.webpackJsonp=window.webpackJsonp||[]).push([[4],[function(D,w,N){(function(D){D.exports=function(){"use strict";var w,F;function hooks(){return w.apply(null,arguments)}function isArray(D){return D instanceof Array||"[object Array]"===Object.prototype.toString.call(D)}function isObject(D){return null!=D&&"[object Object]"===Object.prototype.toString.call(D)}function isUndefined(D){return void 0===D}function isNumber(D){return"number"==typeof D||"[object Number]"===Object.prototype.toString.call(D)}function isDate(D){return D instanceof Date||"[object Date]"===Object.prototype.toString.call(D)}function map(D,w){var N,F=[];for(N=0;N<D.length;++N)F.push(w(D[N],N));return F}function hasOwnProp(D,w){return Object.prototype.hasOwnProperty.call(D,w)}function extend(D,w){for(var N in w)hasOwnProp(w,N)&&(D[N]=w[N]);return hasOwnProp(w,"toString")&&(D.toString=w.toString),hasOwnProp(w,"valueOf")&&(D.valueOf=w.valueOf),D}function createUTC(D,w,N,F){return createLocalOrUTC(D,w,N,F,!0).utc()}function getParsingFlags(D){return null==D._pf&&(D._pf={empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],meridiem:null,rfc2822:!1,weekdayMismatch:!1}),D._pf}function isValid(D){if(null==D._isValid){var w=getParsingFlags(D),N=F.call(w.parsedDateParts,(function(D){return null!=D})),k=!isNaN(D._d.getTime())&&w.overflow<0&&!w.empty&&!w.invalidMonth&&!w.invalidWeekday&&!w.weekdayMismatch&&!w.nullInput&&!w.invalidFormat&&!w.userInvalidated&&(!w.meridiem||w.meridiem&&N);if(D._strict&&(k=k&&0===w.charsLeftOver&&0===w.unusedTokens.length&&void 0===w.bigHour),null!=Object.isFrozen&&Object.isFrozen(D))return k;D._isValid=k}return D._isValid}function createInvalid(D){var w=createUTC(NaN);return null!=D?extend(getParsingFlags(w),D):getParsingFlags(w).userInvalidated=!0,w}F=Array.prototype.some?Array.prototype.some:function(D){for(var w=Object(this),N=w.length>>>0,F=0;F<N;F++)if(F in w&&D.call(this,w[F],F,w))return!0;return!1};var k=hooks.momentProperties=[];function copyConfig(D,w){var N,F,j;if(isUndefined(w._isAMomentObject)||(D._isAMomentObject=w._isAMomentObject),isUndefined(w._i)||(D._i=w._i),isUndefined(w._f)||(D._f=w._f),isUndefined(w._l)||(D._l=w._l),isUndefined(w._strict)||(D._strict=w._strict),isUndefined(w._tzm)||(D._tzm=w._tzm),isUndefined(w._isUTC)||(D._isUTC=w._isUTC),isUndefined(w._offset)||(D._offset=w._offset),isUndefined(w._pf)||(D._pf=getParsingFlags(w)),isUndefined(w._locale)||(D._locale=w._locale),k.length>0)for(N=0;N<k.length;N++)isUndefined(j=w[F=k[N]])||(D[F]=j);return D}var j=!1;function Moment(D){copyConfig(this,D),this._d=new Date(null!=D._d?D._d.getTime():NaN),this.isValid()||(this._d=new Date(NaN)),!1===j&&(j=!0,hooks.updateOffset(this),j=!1)}function isMoment(D){return D instanceof Moment||null!=D&&null!=D._isAMomentObject}function absFloor(D){return D<0?Math.ceil(D)||0:Math.floor(D)}function toInt(D){var w=+D,N=0;return 0!==w&&isFinite(w)&&(N=absFloor(w)),N}function compareArrays(D,w,N){var F,k=Math.min(D.length,w.length),j=Math.abs(D.length-w.length),z=0;for(F=0;F<k;F++)(N&&D[F]!==w[F]||!N&&toInt(D[F])!==toInt(w[F]))&&z++;return z+j}function warn(D){!1===hooks.suppressDeprecationWarnings&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+D)}function deprecate(D,w){var N=!0;return extend((function(){if(null!=hooks.deprecationHandler&&hooks.deprecationHandler(null,D),N){for(var F,k=[],j=0;j<arguments.length;j++){if(F="","object"==typeof arguments[j]){for(var z in F+="\n["+j+"] ",arguments[0])F+=z+": "+arguments[0][z]+", ";F=F.slice(0,-2)}else F=arguments[j];k.push(F)}warn(D+"\nArguments: "+Array.prototype.slice.call(k).join("")+"\n"+(new Error).stack),N=!1}return w.apply(this,arguments)}),w)}var z,G={};function deprecateSimple(D,w){null!=hooks.deprecationHandler&&hooks.deprecationHandler(D,w),G[D]||(warn(w),G[D]=!0)}function isFunction(D){return D instanceof Function||"[object Function]"===Object.prototype.toString.call(D)}function mergeConfigs(D,w){var N,F=extend({},D);for(N in w)hasOwnProp(w,N)&&(isObject(D[N])&&isObject(w[N])?(F[N]={},extend(F[N],D[N]),extend(F[N],w[N])):null!=w[N]?F[N]=w[N]:delete F[N]);for(N in D)hasOwnProp(D,N)&&!hasOwnProp(w,N)&&isObject(D[N])&&(F[N]=extend({},F[N]));return F}function Locale(D){null!=D&&this.set(D)}hooks.suppressDeprecationWarnings=!1,hooks.deprecationHandler=null,z=Object.keys?Object.keys:function(D){var w,N=[];for(w in D)hasOwnProp(D,w)&&N.push(w);return N};var H={};function addUnitAlias(D,w){var N=D.toLowerCase();H[N]=H[N+"s"]=H[w]=D}function normalizeUnits(D){return"string"==typeof D?H[D]||H[D.toLowerCase()]:void 0}function normalizeObjectUnits(D){var w,N,F={};for(N in D)hasOwnProp(D,N)&&(w=normalizeUnits(N))&&(F[w]=D[N]);return F}var X={};function addUnitPriority(D,w){X[D]=w}function zeroFill(D,w,N){var F=""+Math.abs(D),k=w-F.length;return(D>=0?N?"+":"":"-")+Math.pow(10,Math.max(0,k)).toString().substr(1)+F}var q=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,Z=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,J={},$={};function addFormatToken(D,w,N,F){var k=F;"string"==typeof F&&(k=function(){return this[F]()}),D&&($[D]=k),w&&($[w[0]]=function(){return zeroFill(k.apply(this,arguments),w[1],w[2])}),N&&($[N]=function(){return this.localeData().ordinal(k.apply(this,arguments),D)})}function formatMoment(D,w){return D.isValid()?(w=expandFormat(w,D.localeData()),J[w]=J[w]||function makeFormatFunction(D){var w,N,F,k=D.match(q);for(w=0,N=k.length;w<N;w++)$[k[w]]?k[w]=$[k[w]]:k[w]=(F=k[w]).match(/\[[\s\S]/)?F.replace(/^\[|\]$/g,""):F.replace(/\\/g,"");return function(w){var F,j="";for(F=0;F<N;F++)j+=isFunction(k[F])?k[F].call(w,D):k[F];return j}}(w),J[w](D)):D.localeData().invalidDate()}function expandFormat(D,w){var N=5;function replaceLongDateFormatTokens(D){return w.longDateFormat(D)||D}for(Z.lastIndex=0;N>=0&&Z.test(D);)D=D.replace(Z,replaceLongDateFormatTokens),Z.lastIndex=0,N-=1;return D}var te=/\d/,ie=/\d\d/,oe=/\d{3}/,ce=/\d{4}/,he=/[+-]?\d{6}/,fe=/\d\d?/,pe=/\d\d\d\d?/,_e=/\d\d\d\d\d\d?/,ve=/\d{1,3}/,ye=/\d{1,4}/,be=/[+-]?\d{1,6}/,Te=/\d+/,Ee=/[+-]?\d+/,Se=/Z|[+-]\d\d:?\d\d/gi,Me=/Z|[+-]\d\d(?::?\d\d)?/gi,xe=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i,Ae={};function addRegexToken(D,w,N){Ae[D]=isFunction(w)?w:function(D,F){return D&&N?N:w}}function getParseRegexForToken(D,w){return hasOwnProp(Ae,D)?Ae[D](w._strict,w._locale):new RegExp(function unescapeFormat(D){return regexEscape(D.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,(function(D,w,N,F,k){return w||N||F||k})))}(D))}function regexEscape(D){return D.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}var Pe={};function addParseToken(D,w){var N,F=w;for("string"==typeof D&&(D=[D]),isNumber(w)&&(F=function(D,N){N[w]=toInt(D)}),N=0;N<D.length;N++)Pe[D[N]]=F}function addWeekParseToken(D,w){addParseToken(D,(function(D,N,F,k){F._w=F._w||{},w(D,F._w,F,k)}))}function addTimeToArrayFromToken(D,w,N){null!=w&&hasOwnProp(Pe,D)&&Pe[D](w,N._a,N,D)}function daysInYear(D){return isLeapYear(D)?366:365}function isLeapYear(D){return D%4==0&&D%100!=0||D%400==0}addFormatToken("Y",0,0,(function(){var D=this.year();return D<=9999?""+D:"+"+D})),addFormatToken(0,["YY",2],0,(function(){return this.year()%100})),addFormatToken(0,["YYYY",4],0,"year"),addFormatToken(0,["YYYYY",5],0,"year"),addFormatToken(0,["YYYYYY",6,!0],0,"year"),addUnitAlias("year","y"),addUnitPriority("year",1),addRegexToken("Y",Ee),addRegexToken("YY",fe,ie),addRegexToken("YYYY",ye,ce),addRegexToken("YYYYY",be,he),addRegexToken("YYYYYY",be,he),addParseToken(["YYYYY","YYYYYY"],0),addParseToken("YYYY",(function(D,w){w[0]=2===D.length?hooks.parseTwoDigitYear(D):toInt(D)})),addParseToken("YY",(function(D,w){w[0]=hooks.parseTwoDigitYear(D)})),addParseToken("Y",(function(D,w){w[0]=parseInt(D,10)})),hooks.parseTwoDigitYear=function(D){return toInt(D)+(toInt(D)>68?1900:2e3)};var Oe,Re=makeGetSet("FullYear",!0);function makeGetSet(D,w){return function(N){return null!=N?(set$1(this,D,N),hooks.updateOffset(this,w),this):get(this,D)}}function get(D,w){return D.isValid()?D._d["get"+(D._isUTC?"UTC":"")+w]():NaN}function set$1(D,w,N){D.isValid()&&!isNaN(N)&&("FullYear"===w&&isLeapYear(D.year())&&1===D.month()&&29===D.date()?D._d["set"+(D._isUTC?"UTC":"")+w](N,D.month(),daysInMonth(N,D.month())):D._d["set"+(D._isUTC?"UTC":"")+w](N))}function daysInMonth(D,w){if(isNaN(D)||isNaN(w))return NaN;var N=function mod(D,w){return(D%w+w)%w}(w,12);return D+=(w-N)/12,1===N?isLeapYear(D)?29:28:31-N%7%2}Oe=Array.prototype.indexOf?Array.prototype.indexOf:function(D){var w;for(w=0;w<this.length;++w)if(this[w]===D)return w;return-1},addFormatToken("M",["MM",2],"Mo",(function(){return this.month()+1})),addFormatToken("MMM",0,0,(function(D){return this.localeData().monthsShort(this,D)})),addFormatToken("MMMM",0,0,(function(D){return this.localeData().months(this,D)})),addUnitAlias("month","M"),addUnitPriority("month",8),addRegexToken("M",fe),addRegexToken("MM",fe,ie),addRegexToken("MMM",(function(D,w){return w.monthsShortRegex(D)})),addRegexToken("MMMM",(function(D,w){return w.monthsRegex(D)})),addParseToken(["M","MM"],(function(D,w){w[1]=toInt(D)-1})),addParseToken(["MMM","MMMM"],(function(D,w,N,F){var k=N._locale.monthsParse(D,F,N._strict);null!=k?w[1]=k:getParsingFlags(N).invalidMonth=D}));var De=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,Ie="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),Le="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_");function handleStrictParse(D,w,N){var F,k,j,z=D.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],F=0;F<12;++F)j=createUTC([2e3,F]),this._shortMonthsParse[F]=this.monthsShort(j,"").toLocaleLowerCase(),this._longMonthsParse[F]=this.months(j,"").toLocaleLowerCase();return N?"MMM"===w?-1!==(k=Oe.call(this._shortMonthsParse,z))?k:null:-1!==(k=Oe.call(this._longMonthsParse,z))?k:null:"MMM"===w?-1!==(k=Oe.call(this._shortMonthsParse,z))||-1!==(k=Oe.call(this._longMonthsParse,z))?k:null:-1!==(k=Oe.call(this._longMonthsParse,z))||-1!==(k=Oe.call(this._shortMonthsParse,z))?k:null}function setMonth(D,w){var N;if(!D.isValid())return D;if("string"==typeof w)if(/^\d+$/.test(w))w=toInt(w);else if(!isNumber(w=D.localeData().monthsParse(w)))return D;return N=Math.min(D.date(),daysInMonth(D.year(),w)),D._d["set"+(D._isUTC?"UTC":"")+"Month"](w,N),D}function getSetMonth(D){return null!=D?(setMonth(this,D),hooks.updateOffset(this,!0),this):get(this,"Month")}var we=xe,Ne=xe;function computeMonthsParse(){function cmpLenRev(D,w){return w.length-D.length}var D,w,N=[],F=[],k=[];for(D=0;D<12;D++)w=createUTC([2e3,D]),N.push(this.monthsShort(w,"")),F.push(this.months(w,"")),k.push(this.months(w,"")),k.push(this.monthsShort(w,""));for(N.sort(cmpLenRev),F.sort(cmpLenRev),k.sort(cmpLenRev),D=0;D<12;D++)N[D]=regexEscape(N[D]),F[D]=regexEscape(F[D]);for(D=0;D<24;D++)k[D]=regexEscape(k[D]);this._monthsRegex=new RegExp("^("+k.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+F.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+N.join("|")+")","i")}function createDate(D,w,N,F,k,j,z){var G;return D<100&&D>=0?(G=new Date(D+400,w,N,F,k,j,z),isFinite(G.getFullYear())&&G.setFullYear(D)):G=new Date(D,w,N,F,k,j,z),G}function createUTCDate(D){var w;if(D<100&&D>=0){var N=Array.prototype.slice.call(arguments);N[0]=D+400,w=new Date(Date.UTC.apply(null,N)),isFinite(w.getUTCFullYear())&&w.setUTCFullYear(D)}else w=new Date(Date.UTC.apply(null,arguments));return w}function firstWeekOffset(D,w,N){var F=7+w-N;return-(7+createUTCDate(D,0,F).getUTCDay()-w)%7+F-1}function dayOfYearFromWeeks(D,w,N,F,k){var j,z,G=1+7*(w-1)+(7+N-F)%7+firstWeekOffset(D,F,k);return G<=0?z=daysInYear(j=D-1)+G:G>daysInYear(D)?(j=D+1,z=G-daysInYear(D)):(j=D,z=G),{year:j,dayOfYear:z}}function weekOfYear(D,w,N){var F,k,j=firstWeekOffset(D.year(),w,N),z=Math.floor((D.dayOfYear()-j-1)/7)+1;return z<1?F=z+weeksInYear(k=D.year()-1,w,N):z>weeksInYear(D.year(),w,N)?(F=z-weeksInYear(D.year(),w,N),k=D.year()+1):(k=D.year(),F=z),{week:F,year:k}}function weeksInYear(D,w,N){var F=firstWeekOffset(D,w,N),k=firstWeekOffset(D+1,w,N);return(daysInYear(D)-F+k)/7}function shiftWeekdays(D,w){return D.slice(w,7).concat(D.slice(0,w))}addFormatToken("w",["ww",2],"wo","week"),addFormatToken("W",["WW",2],"Wo","isoWeek"),addUnitAlias("week","w"),addUnitAlias("isoWeek","W"),addUnitPriority("week",5),addUnitPriority("isoWeek",5),addRegexToken("w",fe),addRegexToken("ww",fe,ie),addRegexToken("W",fe),addRegexToken("WW",fe,ie),addWeekParseToken(["w","ww","W","WW"],(function(D,w,N,F){w[F.substr(0,1)]=toInt(D)})),addFormatToken("d",0,"do","day"),addFormatToken("dd",0,0,(function(D){return this.localeData().weekdaysMin(this,D)})),addFormatToken("ddd",0,0,(function(D){return this.localeData().weekdaysShort(this,D)})),addFormatToken("dddd",0,0,(function(D){return this.localeData().weekdays(this,D)})),addFormatToken("e",0,0,"weekday"),addFormatToken("E",0,0,"isoWeekday"),addUnitAlias("day","d"),addUnitAlias("weekday","e"),addUnitAlias("isoWeekday","E"),addUnitPriority("day",11),addUnitPriority("weekday",11),addUnitPriority("isoWeekday",11),addRegexToken("d",fe),addRegexToken("e",fe),addRegexToken("E",fe),addRegexToken("dd",(function(D,w){return w.weekdaysMinRegex(D)})),addRegexToken("ddd",(function(D,w){return w.weekdaysShortRegex(D)})),addRegexToken("dddd",(function(D,w){return w.weekdaysRegex(D)})),addWeekParseToken(["dd","ddd","dddd"],(function(D,w,N,F){var k=N._locale.weekdaysParse(D,F,N._strict);null!=k?w.d=k:getParsingFlags(N).invalidWeekday=D})),addWeekParseToken(["d","e","E"],(function(D,w,N,F){w[F]=toInt(D)}));var Fe="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),Be="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),Ue="Su_Mo_Tu_We_Th_Fr_Sa".split("_");function handleStrictParse$1(D,w,N){var F,k,j,z=D.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],F=0;F<7;++F)j=createUTC([2e3,1]).day(F),this._minWeekdaysParse[F]=this.weekdaysMin(j,"").toLocaleLowerCase(),this._shortWeekdaysParse[F]=this.weekdaysShort(j,"").toLocaleLowerCase(),this._weekdaysParse[F]=this.weekdays(j,"").toLocaleLowerCase();return N?"dddd"===w?-1!==(k=Oe.call(this._weekdaysParse,z))?k:null:"ddd"===w?-1!==(k=Oe.call(this._shortWeekdaysParse,z))?k:null:-1!==(k=Oe.call(this._minWeekdaysParse,z))?k:null:"dddd"===w?-1!==(k=Oe.call(this._weekdaysParse,z))||-1!==(k=Oe.call(this._shortWeekdaysParse,z))||-1!==(k=Oe.call(this._minWeekdaysParse,z))?k:null:"ddd"===w?-1!==(k=Oe.call(this._shortWeekdaysParse,z))||-1!==(k=Oe.call(this._weekdaysParse,z))||-1!==(k=Oe.call(this._minWeekdaysParse,z))?k:null:-1!==(k=Oe.call(this._minWeekdaysParse,z))||-1!==(k=Oe.call(this._weekdaysParse,z))||-1!==(k=Oe.call(this._shortWeekdaysParse,z))?k:null}var Ve=xe,ze=xe,Ge=xe;function computeWeekdaysParse(){function cmpLenRev(D,w){return w.length-D.length}var D,w,N,F,k,j=[],z=[],G=[],H=[];for(D=0;D<7;D++)w=createUTC([2e3,1]).day(D),N=this.weekdaysMin(w,""),F=this.weekdaysShort(w,""),k=this.weekdays(w,""),j.push(N),z.push(F),G.push(k),H.push(N),H.push(F),H.push(k);for(j.sort(cmpLenRev),z.sort(cmpLenRev),G.sort(cmpLenRev),H.sort(cmpLenRev),D=0;D<7;D++)z[D]=regexEscape(z[D]),G[D]=regexEscape(G[D]),H[D]=regexEscape(H[D]);this._weekdaysRegex=new RegExp("^("+H.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+G.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+z.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+j.join("|")+")","i")}function hFormat(){return this.hours()%12||12}function meridiem(D,w){addFormatToken(D,0,0,(function(){return this.localeData().meridiem(this.hours(),this.minutes(),w)}))}function matchMeridiem(D,w){return w._meridiemParse}addFormatToken("H",["HH",2],0,"hour"),addFormatToken("h",["hh",2],0,hFormat),addFormatToken("k",["kk",2],0,(function kFormat(){return this.hours()||24})),addFormatToken("hmm",0,0,(function(){return""+hFormat.apply(this)+zeroFill(this.minutes(),2)})),addFormatToken("hmmss",0,0,(function(){return""+hFormat.apply(this)+zeroFill(this.minutes(),2)+zeroFill(this.seconds(),2)})),addFormatToken("Hmm",0,0,(function(){return""+this.hours()+zeroFill(this.minutes(),2)})),addFormatToken("Hmmss",0,0,(function(){return""+this.hours()+zeroFill(this.minutes(),2)+zeroFill(this.seconds(),2)})),meridiem("a",!0),meridiem("A",!1),addUnitAlias("hour","h"),addUnitPriority("hour",13),addRegexToken("a",matchMeridiem),addRegexToken("A",matchMeridiem),addRegexToken("H",fe),addRegexToken("h",fe),addRegexToken("k",fe),addRegexToken("HH",fe,ie),addRegexToken("hh",fe,ie),addRegexToken("kk",fe,ie),addRegexToken("hmm",pe),addRegexToken("hmmss",_e),addRegexToken("Hmm",pe),addRegexToken("Hmmss",_e),addParseToken(["H","HH"],3),addParseToken(["k","kk"],(function(D,w,N){var F=toInt(D);w[3]=24===F?0:F})),addParseToken(["a","A"],(function(D,w,N){N._isPm=N._locale.isPM(D),N._meridiem=D})),addParseToken(["h","hh"],(function(D,w,N){w[3]=toInt(D),getParsingFlags(N).bigHour=!0})),addParseToken("hmm",(function(D,w,N){var F=D.length-2;w[3]=toInt(D.substr(0,F)),w[4]=toInt(D.substr(F)),getParsingFlags(N).bigHour=!0})),addParseToken("hmmss",(function(D,w,N){var F=D.length-4,k=D.length-2;w[3]=toInt(D.substr(0,F)),w[4]=toInt(D.substr(F,2)),w[5]=toInt(D.substr(k)),getParsingFlags(N).bigHour=!0})),addParseToken("Hmm",(function(D,w,N){var F=D.length-2;w[3]=toInt(D.substr(0,F)),w[4]=toInt(D.substr(F))})),addParseToken("Hmmss",(function(D,w,N){var F=D.length-4,k=D.length-2;w[3]=toInt(D.substr(0,F)),w[4]=toInt(D.substr(F,2)),w[5]=toInt(D.substr(k))}));var Ye,He=makeGetSet("Hours",!0),We={calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},longDateFormat:{LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},invalidDate:"Invalid date",ordinal:"%d",dayOfMonthOrdinalParse:/\d{1,2}/,relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},months:Ie,monthsShort:Le,week:{dow:0,doy:6},weekdays:Fe,weekdaysMin:Ue,weekdaysShort:Be,meridiemParse:/[ap]\.?m?\.?/i},Xe={},Ke={};function normalizeLocale(D){return D?D.toLowerCase().replace("_","-"):D}function loadLocale(w){var F=null;if(!Xe[w]&&void 0!==D&&D&&D.exports)try{F=Ye._abbr,N(206)("./"+w),getSetGlobalLocale(F)}catch(D){}return Xe[w]}function getSetGlobalLocale(D,w){var N;return D&&((N=isUndefined(w)?getLocale(D):defineLocale(D,w))?Ye=N:"undefined"!=typeof console&&console.warn&&console.warn("Locale "+D+" not found. Did you forget to load it?")),Ye._abbr}function defineLocale(D,w){if(null!==w){var N,F=We;if(w.abbr=D,null!=Xe[D])deprecateSimple("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),F=Xe[D]._config;else if(null!=w.parentLocale)if(null!=Xe[w.parentLocale])F=Xe[w.parentLocale]._config;else{if(null==(N=loadLocale(w.parentLocale)))return Ke[w.parentLocale]||(Ke[w.parentLocale]=[]),Ke[w.parentLocale].push({name:D,config:w}),null;F=N._config}return Xe[D]=new Locale(mergeConfigs(F,w)),Ke[D]&&Ke[D].forEach((function(D){defineLocale(D.name,D.config)})),getSetGlobalLocale(D),Xe[D]}return delete Xe[D],null}function getLocale(D){var w;if(D&&D._locale&&D._locale._abbr&&(D=D._locale._abbr),!D)return Ye;if(!isArray(D)){if(w=loadLocale(D))return w;D=[D]}return function chooseLocale(D){for(var w,N,F,k,j=0;j<D.length;){for(w=(k=normalizeLocale(D[j]).split("-")).length,N=(N=normalizeLocale(D[j+1]))?N.split("-"):null;w>0;){if(F=loadLocale(k.slice(0,w).join("-")))return F;if(N&&N.length>=w&&compareArrays(k,N,!0)>=w-1)break;w--}j++}return Ye}(D)}function checkOverflow(D){var w,N=D._a;return N&&-2===getParsingFlags(D).overflow&&(w=N[1]<0||N[1]>11?1:N[2]<1||N[2]>daysInMonth(N[0],N[1])?2:N[3]<0||N[3]>24||24===N[3]&&(0!==N[4]||0!==N[5]||0!==N[6])?3:N[4]<0||N[4]>59?4:N[5]<0||N[5]>59?5:N[6]<0||N[6]>999?6:-1,getParsingFlags(D)._overflowDayOfYear&&(w<0||w>2)&&(w=2),getParsingFlags(D)._overflowWeeks&&-1===w&&(w=7),getParsingFlags(D)._overflowWeekday&&-1===w&&(w=8),getParsingFlags(D).overflow=w),D}function defaults(D,w,N){return null!=D?D:null!=w?w:N}function configFromArray(D){var w,N,F,k,j,z=[];if(!D._d){for(F=function currentDateArray(D){var w=new Date(hooks.now());return D._useUTC?[w.getUTCFullYear(),w.getUTCMonth(),w.getUTCDate()]:[w.getFullYear(),w.getMonth(),w.getDate()]}(D),D._w&&null==D._a[2]&&null==D._a[1]&&function dayOfYearFromWeekInfo(D){var w,N,F,k,j,z,G,H;if(null!=(w=D._w).GG||null!=w.W||null!=w.E)j=1,z=4,N=defaults(w.GG,D._a[0],weekOfYear(createLocal(),1,4).year),F=defaults(w.W,1),((k=defaults(w.E,1))<1||k>7)&&(H=!0);else{j=D._locale._week.dow,z=D._locale._week.doy;var X=weekOfYear(createLocal(),j,z);N=defaults(w.gg,D._a[0],X.year),F=defaults(w.w,X.week),null!=w.d?((k=w.d)<0||k>6)&&(H=!0):null!=w.e?(k=w.e+j,(w.e<0||w.e>6)&&(H=!0)):k=j}F<1||F>weeksInYear(N,j,z)?getParsingFlags(D)._overflowWeeks=!0:null!=H?getParsingFlags(D)._overflowWeekday=!0:(G=dayOfYearFromWeeks(N,F,k,j,z),D._a[0]=G.year,D._dayOfYear=G.dayOfYear)}(D),null!=D._dayOfYear&&(j=defaults(D._a[0],F[0]),(D._dayOfYear>daysInYear(j)||0===D._dayOfYear)&&(getParsingFlags(D)._overflowDayOfYear=!0),N=createUTCDate(j,0,D._dayOfYear),D._a[1]=N.getUTCMonth(),D._a[2]=N.getUTCDate()),w=0;w<3&&null==D._a[w];++w)D._a[w]=z[w]=F[w];for(;w<7;w++)D._a[w]=z[w]=null==D._a[w]?2===w?1:0:D._a[w];24===D._a[3]&&0===D._a[4]&&0===D._a[5]&&0===D._a[6]&&(D._nextDay=!0,D._a[3]=0),D._d=(D._useUTC?createUTCDate:createDate).apply(null,z),k=D._useUTC?D._d.getUTCDay():D._d.getDay(),null!=D._tzm&&D._d.setUTCMinutes(D._d.getUTCMinutes()-D._tzm),D._nextDay&&(D._a[3]=24),D._w&&void 0!==D._w.d&&D._w.d!==k&&(getParsingFlags(D).weekdayMismatch=!0)}}var Qe=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,Ze=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,Je=/Z|[+-]\d\d(?::?\d\d)?/,$e=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/]],et=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],tt=/^\/?Date\((\-?\d+)/i;function configFromISO(D){var w,N,F,k,j,z,G=D._i,H=Qe.exec(G)||Ze.exec(G);if(H){for(getParsingFlags(D).iso=!0,w=0,N=$e.length;w<N;w++)if($e[w][1].exec(H[1])){k=$e[w][0],F=!1!==$e[w][2];break}if(null==k)return void(D._isValid=!1);if(H[3]){for(w=0,N=et.length;w<N;w++)if(et[w][1].exec(H[3])){j=(H[2]||" ")+et[w][0];break}if(null==j)return void(D._isValid=!1)}if(!F&&null!=j)return void(D._isValid=!1);if(H[4]){if(!Je.exec(H[4]))return void(D._isValid=!1);z="Z"}D._f=k+(j||"")+(z||""),configFromStringAndFormat(D)}else D._isValid=!1}var rt=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/;function untruncateYear(D){var w=parseInt(D,10);return w<=49?2e3+w:w<=999?1900+w:w}var ot={UT:0,GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};function configFromRFC2822(D){var w=rt.exec(function preprocessRFC2822(D){return D.replace(/\([^)]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s\s*/,"").replace(/\s\s*$/,"")}(D._i));if(w){var N=function extractFromRFC2822Strings(D,w,N,F,k,j){var z=[untruncateYear(D),Le.indexOf(w),parseInt(N,10),parseInt(F,10),parseInt(k,10)];return j&&z.push(parseInt(j,10)),z}(w[4],w[3],w[2],w[5],w[6],w[7]);if(!function checkWeekday(D,w,N){return!D||Be.indexOf(D)===new Date(w[0],w[1],w[2]).getDay()||(getParsingFlags(N).weekdayMismatch=!0,N._isValid=!1,!1)}(w[1],N,D))return;D._a=N,D._tzm=function calculateOffset(D,w,N){if(D)return ot[D];if(w)return 0;var F=parseInt(N,10),k=F%100;return(F-k)/100*60+k}(w[8],w[9],w[10]),D._d=createUTCDate.apply(null,D._a),D._d.setUTCMinutes(D._d.getUTCMinutes()-D._tzm),getParsingFlags(D).rfc2822=!0}else D._isValid=!1}function configFromStringAndFormat(D){if(D._f!==hooks.ISO_8601)if(D._f!==hooks.RFC_2822){D._a=[],getParsingFlags(D).empty=!0;var w,N,F,k,j,z=""+D._i,G=z.length,H=0;for(F=expandFormat(D._f,D._locale).match(q)||[],w=0;w<F.length;w++)k=F[w],(N=(z.match(getParseRegexForToken(k,D))||[])[0])&&((j=z.substr(0,z.indexOf(N))).length>0&&getParsingFlags(D).unusedInput.push(j),z=z.slice(z.indexOf(N)+N.length),H+=N.length),$[k]?(N?getParsingFlags(D).empty=!1:getParsingFlags(D).unusedTokens.push(k),addTimeToArrayFromToken(k,N,D)):D._strict&&!N&&getParsingFlags(D).unusedTokens.push(k);getParsingFlags(D).charsLeftOver=G-H,z.length>0&&getParsingFlags(D).unusedInput.push(z),D._a[3]<=12&&!0===getParsingFlags(D).bigHour&&D._a[3]>0&&(getParsingFlags(D).bigHour=void 0),getParsingFlags(D).parsedDateParts=D._a.slice(0),getParsingFlags(D).meridiem=D._meridiem,D._a[3]=function meridiemFixWrap(D,w,N){var F;return null==N?w:null!=D.meridiemHour?D.meridiemHour(w,N):null!=D.isPM?((F=D.isPM(N))&&w<12&&(w+=12),F||12!==w||(w=0),w):w}(D._locale,D._a[3],D._meridiem),configFromArray(D),checkOverflow(D)}else configFromRFC2822(D);else configFromISO(D)}function prepareConfig(D){var w=D._i,N=D._f;return D._locale=D._locale||getLocale(D._l),null===w||void 0===N&&""===w?createInvalid({nullInput:!0}):("string"==typeof w&&(D._i=w=D._locale.preparse(w)),isMoment(w)?new Moment(checkOverflow(w)):(isDate(w)?D._d=w:isArray(N)?function configFromStringAndArray(D){var w,N,F,k,j;if(0===D._f.length)return getParsingFlags(D).invalidFormat=!0,void(D._d=new Date(NaN));for(k=0;k<D._f.length;k++)j=0,w=copyConfig({},D),null!=D._useUTC&&(w._useUTC=D._useUTC),w._f=D._f[k],configFromStringAndFormat(w),isValid(w)&&(j+=getParsingFlags(w).charsLeftOver,j+=10*getParsingFlags(w).unusedTokens.length,getParsingFlags(w).score=j,(null==F||j<F)&&(F=j,N=w));extend(D,N||w)}(D):N?configFromStringAndFormat(D):function configFromInput(D){var w=D._i;isUndefined(w)?D._d=new Date(hooks.now()):isDate(w)?D._d=new Date(w.valueOf()):"string"==typeof w?function configFromString(D){var w=tt.exec(D._i);null===w?(configFromISO(D),!1===D._isValid&&(delete D._isValid,configFromRFC2822(D),!1===D._isValid&&(delete D._isValid,hooks.createFromInputFallback(D)))):D._d=new Date(+w[1])}(D):isArray(w)?(D._a=map(w.slice(0),(function(D){return parseInt(D,10)})),configFromArray(D)):isObject(w)?function configFromObject(D){if(!D._d){var w=normalizeObjectUnits(D._i);D._a=map([w.year,w.month,w.day||w.date,w.hour,w.minute,w.second,w.millisecond],(function(D){return D&&parseInt(D,10)})),configFromArray(D)}}(D):isNumber(w)?D._d=new Date(w):hooks.createFromInputFallback(D)}(D),isValid(D)||(D._d=null),D))}function createLocalOrUTC(D,w,N,F,k){var j={};return!0!==N&&!1!==N||(F=N,N=void 0),(isObject(D)&&function isObjectEmpty(D){if(Object.getOwnPropertyNames)return 0===Object.getOwnPropertyNames(D).length;var w;for(w in D)if(D.hasOwnProperty(w))return!1;return!0}(D)||isArray(D)&&0===D.length)&&(D=void 0),j._isAMomentObject=!0,j._useUTC=j._isUTC=k,j._l=N,j._i=D,j._f=w,j._strict=F,function createFromConfig(D){var w=new Moment(checkOverflow(prepareConfig(D)));return w._nextDay&&(w.add(1,"d"),w._nextDay=void 0),w}(j)}function createLocal(D,w,N,F){return createLocalOrUTC(D,w,N,F,!1)}hooks.createFromInputFallback=deprecate("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged and will be removed in an upcoming major release. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",(function(D){D._d=new Date(D._i+(D._useUTC?" UTC":""))})),hooks.ISO_8601=function(){},hooks.RFC_2822=function(){};var at=deprecate("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",(function(){var D=createLocal.apply(null,arguments);return this.isValid()&&D.isValid()?D<this?this:D:createInvalid()})),st=deprecate("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",(function(){var D=createLocal.apply(null,arguments);return this.isValid()&&D.isValid()?D>this?this:D:createInvalid()}));function pickBy(D,w){var N,F;if(1===w.length&&isArray(w[0])&&(w=w[0]),!w.length)return createLocal();for(N=w[0],F=1;F<w.length;++F)w[F].isValid()&&!w[F][D](N)||(N=w[F]);return N}var ut=["year","quarter","month","week","day","hour","minute","second","millisecond"];function Duration(D){var w=normalizeObjectUnits(D),N=w.year||0,F=w.quarter||0,k=w.month||0,j=w.week||w.isoWeek||0,z=w.day||0,G=w.hour||0,H=w.minute||0,X=w.second||0,q=w.millisecond||0;this._isValid=function isDurationValid(D){for(var w in D)if(-1===Oe.call(ut,w)||null!=D[w]&&isNaN(D[w]))return!1;for(var N=!1,F=0;F<ut.length;++F)if(D[ut[F]]){if(N)return!1;parseFloat(D[ut[F]])!==toInt(D[ut[F]])&&(N=!0)}return!0}(w),this._milliseconds=+q+1e3*X+6e4*H+1e3*G*60*60,this._days=+z+7*j,this._months=+k+3*F+12*N,this._data={},this._locale=getLocale(),this._bubble()}function isDuration(D){return D instanceof Duration}function absRound(D){return D<0?-1*Math.round(-1*D):Math.round(D)}function offset(D,w){addFormatToken(D,0,0,(function(){var D=this.utcOffset(),N="+";return D<0&&(D=-D,N="-"),N+zeroFill(~~(D/60),2)+w+zeroFill(~~D%60,2)}))}offset("Z",":"),offset("ZZ",""),addRegexToken("Z",Me),addRegexToken("ZZ",Me),addParseToken(["Z","ZZ"],(function(D,w,N){N._useUTC=!0,N._tzm=offsetFromString(Me,D)}));var lt=/([\+\-]|\d\d)/gi;function offsetFromString(D,w){var N=(w||"").match(D);if(null===N)return null;var F=((N[N.length-1]||[])+"").match(lt)||["-",0,0],k=60*F[1]+toInt(F[2]);return 0===k?0:"+"===F[0]?k:-k}function cloneWithOffset(D,w){var N,F;return w._isUTC?(N=w.clone(),F=(isMoment(D)||isDate(D)?D.valueOf():createLocal(D).valueOf())-N.valueOf(),N._d.setTime(N._d.valueOf()+F),hooks.updateOffset(N,!1),N):createLocal(D).local()}function getDateOffset(D){return 15*-Math.round(D._d.getTimezoneOffset()/15)}function isUtc(){return!!this.isValid()&&this._isUTC&&0===this._offset}hooks.updateOffset=function(){};var ht=/^(\-|\+)?(?:(\d*)[. ])?(\d+)\:(\d+)(?:\:(\d+)(\.\d*)?)?$/,dt=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function createDuration(D,w){var N,F,k,j=D,z=null;return isDuration(D)?j={ms:D._milliseconds,d:D._days,M:D._months}:isNumber(D)?(j={},w?j[w]=D:j.milliseconds=D):(z=ht.exec(D))?(N="-"===z[1]?-1:1,j={y:0,d:toInt(z[2])*N,h:toInt(z[3])*N,m:toInt(z[4])*N,s:toInt(z[5])*N,ms:toInt(absRound(1e3*z[6]))*N}):(z=dt.exec(D))?(N="-"===z[1]?-1:1,j={y:parseIso(z[2],N),M:parseIso(z[3],N),w:parseIso(z[4],N),d:parseIso(z[5],N),h:parseIso(z[6],N),m:parseIso(z[7],N),s:parseIso(z[8],N)}):null==j?j={}:"object"==typeof j&&("from"in j||"to"in j)&&(k=function momentsDifference(D,w){var N;return D.isValid()&&w.isValid()?(w=cloneWithOffset(w,D),D.isBefore(w)?N=positiveMomentsDifference(D,w):((N=positiveMomentsDifference(w,D)).milliseconds=-N.milliseconds,N.months=-N.months),N):{milliseconds:0,months:0}}(createLocal(j.from),createLocal(j.to)),(j={}).ms=k.milliseconds,j.M=k.months),F=new Duration(j),isDuration(D)&&hasOwnProp(D,"_locale")&&(F._locale=D._locale),F}function parseIso(D,w){var N=D&&parseFloat(D.replace(",","."));return(isNaN(N)?0:N)*w}function positiveMomentsDifference(D,w){var N={};return N.months=w.month()-D.month()+12*(w.year()-D.year()),D.clone().add(N.months,"M").isAfter(w)&&--N.months,N.milliseconds=+w-+D.clone().add(N.months,"M"),N}function createAdder(D,w){return function(N,F){var k;return null===F||isNaN(+F)||(deprecateSimple(w,"moment()."+w+"(period, number) is deprecated. Please use moment()."+w+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),k=N,N=F,F=k),addSubtract(this,createDuration(N="string"==typeof N?+N:N,F),D),this}}function addSubtract(D,w,N,F){var k=w._milliseconds,j=absRound(w._days),z=absRound(w._months);D.isValid()&&(F=null==F||F,z&&setMonth(D,get(D,"Month")+z*N),j&&set$1(D,"Date",get(D,"Date")+j*N),k&&D._d.setTime(D._d.valueOf()+k*N),F&&hooks.updateOffset(D,j||z))}createDuration.fn=Duration.prototype,createDuration.invalid=function createInvalid$1(){return createDuration(NaN)};var ft=createAdder(1,"add"),pt=createAdder(-1,"subtract");function monthDiff(D,w){var N=12*(w.year()-D.year())+(w.month()-D.month()),F=D.clone().add(N,"months");return-(N+(w-F<0?(w-F)/(F-D.clone().add(N-1,"months")):(w-F)/(D.clone().add(N+1,"months")-F)))||0}function locale(D){var w;return void 0===D?this._locale._abbr:(null!=(w=getLocale(D))&&(this._locale=w),this)}hooks.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",hooks.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";var _t=deprecate("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",(function(D){return void 0===D?this.localeData():this.locale(D)}));function localeData(){return this._locale}function mod$1(D,w){return(D%w+w)%w}function localStartOfDate(D,w,N){return D<100&&D>=0?new Date(D+400,w,N)-126227808e5:new Date(D,w,N).valueOf()}function utcStartOfDate(D,w,N){return D<100&&D>=0?Date.UTC(D+400,w,N)-126227808e5:Date.UTC(D,w,N)}function addWeekYearFormatToken(D,w){addFormatToken(0,[D,D.length],0,w)}function getSetWeekYearHelper(D,w,N,F,k){var j;return null==D?weekOfYear(this,F,k).year:(w>(j=weeksInYear(D,F,k))&&(w=j),setWeekAll.call(this,D,w,N,F,k))}function setWeekAll(D,w,N,F,k){var j=dayOfYearFromWeeks(D,w,N,F,k),z=createUTCDate(j.year,0,j.dayOfYear);return this.year(z.getUTCFullYear()),this.month(z.getUTCMonth()),this.date(z.getUTCDate()),this}addFormatToken(0,["gg",2],0,(function(){return this.weekYear()%100})),addFormatToken(0,["GG",2],0,(function(){return this.isoWeekYear()%100})),addWeekYearFormatToken("gggg","weekYear"),addWeekYearFormatToken("ggggg","weekYear"),addWeekYearFormatToken("GGGG","isoWeekYear"),addWeekYearFormatToken("GGGGG","isoWeekYear"),addUnitAlias("weekYear","gg"),addUnitAlias("isoWeekYear","GG"),addUnitPriority("weekYear",1),addUnitPriority("isoWeekYear",1),addRegexToken("G",Ee),addRegexToken("g",Ee),addRegexToken("GG",fe,ie),addRegexToken("gg",fe,ie),addRegexToken("GGGG",ye,ce),addRegexToken("gggg",ye,ce),addRegexToken("GGGGG",be,he),addRegexToken("ggggg",be,he),addWeekParseToken(["gggg","ggggg","GGGG","GGGGG"],(function(D,w,N,F){w[F.substr(0,2)]=toInt(D)})),addWeekParseToken(["gg","GG"],(function(D,w,N,F){w[F]=hooks.parseTwoDigitYear(D)})),addFormatToken("Q",0,"Qo","quarter"),addUnitAlias("quarter","Q"),addUnitPriority("quarter",7),addRegexToken("Q",te),addParseToken("Q",(function(D,w){w[1]=3*(toInt(D)-1)})),addFormatToken("D",["DD",2],"Do","date"),addUnitAlias("date","D"),addUnitPriority("date",9),addRegexToken("D",fe),addRegexToken("DD",fe,ie),addRegexToken("Do",(function(D,w){return D?w._dayOfMonthOrdinalParse||w._ordinalParse:w._dayOfMonthOrdinalParseLenient})),addParseToken(["D","DD"],2),addParseToken("Do",(function(D,w){w[2]=toInt(D.match(fe)[0])}));var mt=makeGetSet("Date",!0);addFormatToken("DDD",["DDDD",3],"DDDo","dayOfYear"),addUnitAlias("dayOfYear","DDD"),addUnitPriority("dayOfYear",4),addRegexToken("DDD",ve),addRegexToken("DDDD",oe),addParseToken(["DDD","DDDD"],(function(D,w,N){N._dayOfYear=toInt(D)})),addFormatToken("m",["mm",2],0,"minute"),addUnitAlias("minute","m"),addUnitPriority("minute",14),addRegexToken("m",fe),addRegexToken("mm",fe,ie),addParseToken(["m","mm"],4);var gt=makeGetSet("Minutes",!1);addFormatToken("s",["ss",2],0,"second"),addUnitAlias("second","s"),addUnitPriority("second",15),addRegexToken("s",fe),addRegexToken("ss",fe,ie),addParseToken(["s","ss"],5);var vt,yt=makeGetSet("Seconds",!1);for(addFormatToken("S",0,0,(function(){return~~(this.millisecond()/100)})),addFormatToken(0,["SS",2],0,(function(){return~~(this.millisecond()/10)})),addFormatToken(0,["SSS",3],0,"millisecond"),addFormatToken(0,["SSSS",4],0,(function(){return 10*this.millisecond()})),addFormatToken(0,["SSSSS",5],0,(function(){return 100*this.millisecond()})),addFormatToken(0,["SSSSSS",6],0,(function(){return 1e3*this.millisecond()})),addFormatToken(0,["SSSSSSS",7],0,(function(){return 1e4*this.millisecond()})),addFormatToken(0,["SSSSSSSS",8],0,(function(){return 1e5*this.millisecond()})),addFormatToken(0,["SSSSSSSSS",9],0,(function(){return 1e6*this.millisecond()})),addUnitAlias("millisecond","ms"),addUnitPriority("millisecond",16),addRegexToken("S",ve,te),addRegexToken("SS",ve,ie),addRegexToken("SSS",ve,oe),vt="SSSS";vt.length<=9;vt+="S")addRegexToken(vt,Te);function parseMs(D,w){w[6]=toInt(1e3*("0."+D))}for(vt="S";vt.length<=9;vt+="S")addParseToken(vt,parseMs);var bt=makeGetSet("Milliseconds",!1);addFormatToken("z",0,0,"zoneAbbr"),addFormatToken("zz",0,0,"zoneName");var Tt=Moment.prototype;function preParsePostFormat(D){return D}Tt.add=ft,Tt.calendar=function calendar$1(D,w){var N=D||createLocal(),F=cloneWithOffset(N,this).startOf("day"),k=hooks.calendarFormat(this,F)||"sameElse",j=w&&(isFunction(w[k])?w[k].call(this,N):w[k]);return this.format(j||this.localeData().calendar(k,this,createLocal(N)))},Tt.clone=function clone(){return new Moment(this)},Tt.diff=function diff(D,w,N){var F,k,j;if(!this.isValid())return NaN;if(!(F=cloneWithOffset(D,this)).isValid())return NaN;switch(k=6e4*(F.utcOffset()-this.utcOffset()),w=normalizeUnits(w)){case"year":j=monthDiff(this,F)/12;break;case"month":j=monthDiff(this,F);break;case"quarter":j=monthDiff(this,F)/3;break;case"second":j=(this-F)/1e3;break;case"minute":j=(this-F)/6e4;break;case"hour":j=(this-F)/36e5;break;case"day":j=(this-F-k)/864e5;break;case"week":j=(this-F-k)/6048e5;break;default:j=this-F}return N?j:absFloor(j)},Tt.endOf=function endOf(D){var w;if(void 0===(D=normalizeUnits(D))||"millisecond"===D||!this.isValid())return this;var N=this._isUTC?utcStartOfDate:localStartOfDate;switch(D){case"year":w=N(this.year()+1,0,1)-1;break;case"quarter":w=N(this.year(),this.month()-this.month()%3+3,1)-1;break;case"month":w=N(this.year(),this.month()+1,1)-1;break;case"week":w=N(this.year(),this.month(),this.date()-this.weekday()+7)-1;break;case"isoWeek":w=N(this.year(),this.month(),this.date()-(this.isoWeekday()-1)+7)-1;break;case"day":case"date":w=N(this.year(),this.month(),this.date()+1)-1;break;case"hour":w=this._d.valueOf(),w+=36e5-mod$1(w+(this._isUTC?0:6e4*this.utcOffset()),36e5)-1;break;case"minute":w=this._d.valueOf(),w+=6e4-mod$1(w,6e4)-1;break;case"second":w=this._d.valueOf(),w+=1e3-mod$1(w,1e3)-1}return this._d.setTime(w),hooks.updateOffset(this,!0),this},Tt.format=function format(D){D||(D=this.isUtc()?hooks.defaultFormatUtc:hooks.defaultFormat);var w=formatMoment(this,D);return this.localeData().postformat(w)},Tt.from=function from(D,w){return this.isValid()&&(isMoment(D)&&D.isValid()||createLocal(D).isValid())?createDuration({to:this,from:D}).locale(this.locale()).humanize(!w):this.localeData().invalidDate()},Tt.fromNow=function fromNow(D){return this.from(createLocal(),D)},Tt.to=function to(D,w){return this.isValid()&&(isMoment(D)&&D.isValid()||createLocal(D).isValid())?createDuration({from:this,to:D}).locale(this.locale()).humanize(!w):this.localeData().invalidDate()},Tt.toNow=function toNow(D){return this.to(createLocal(),D)},Tt.get=function stringGet(D){return isFunction(this[D=normalizeUnits(D)])?this[D]():this},Tt.invalidAt=function invalidAt(){return getParsingFlags(this).overflow},Tt.isAfter=function isAfter(D,w){var N=isMoment(D)?D:createLocal(D);return!(!this.isValid()||!N.isValid())&&("millisecond"===(w=normalizeUnits(w)||"millisecond")?this.valueOf()>N.valueOf():N.valueOf()<this.clone().startOf(w).valueOf())},Tt.isBefore=function isBefore(D,w){var N=isMoment(D)?D:createLocal(D);return!(!this.isValid()||!N.isValid())&&("millisecond"===(w=normalizeUnits(w)||"millisecond")?this.valueOf()<N.valueOf():this.clone().endOf(w).valueOf()<N.valueOf())},Tt.isBetween=function isBetween(D,w,N,F){var k=isMoment(D)?D:createLocal(D),j=isMoment(w)?w:createLocal(w);return!!(this.isValid()&&k.isValid()&&j.isValid())&&("("===(F=F||"()")[0]?this.isAfter(k,N):!this.isBefore(k,N))&&(")"===F[1]?this.isBefore(j,N):!this.isAfter(j,N))},Tt.isSame=function isSame(D,w){var N,F=isMoment(D)?D:createLocal(D);return!(!this.isValid()||!F.isValid())&&("millisecond"===(w=normalizeUnits(w)||"millisecond")?this.valueOf()===F.valueOf():(N=F.valueOf(),this.clone().startOf(w).valueOf()<=N&&N<=this.clone().endOf(w).valueOf()))},Tt.isSameOrAfter=function isSameOrAfter(D,w){return this.isSame(D,w)||this.isAfter(D,w)},Tt.isSameOrBefore=function isSameOrBefore(D,w){return this.isSame(D,w)||this.isBefore(D,w)},Tt.isValid=function isValid$2(){return isValid(this)},Tt.lang=_t,Tt.locale=locale,Tt.localeData=localeData,Tt.max=st,Tt.min=at,Tt.parsingFlags=function parsingFlags(){return extend({},getParsingFlags(this))},Tt.set=function stringSet(D,w){if("object"==typeof D)for(var N=function getPrioritizedUnits(D){var w=[];for(var N in D)w.push({unit:N,priority:X[N]});return w.sort((function(D,w){return D.priority-w.priority})),w}(D=normalizeObjectUnits(D)),F=0;F<N.length;F++)this[N[F].unit](D[N[F].unit]);else if(isFunction(this[D=normalizeUnits(D)]))return this[D](w);return this},Tt.startOf=function startOf(D){var w;if(void 0===(D=normalizeUnits(D))||"millisecond"===D||!this.isValid())return this;var N=this._isUTC?utcStartOfDate:localStartOfDate;switch(D){case"year":w=N(this.year(),0,1);break;case"quarter":w=N(this.year(),this.month()-this.month()%3,1);break;case"month":w=N(this.year(),this.month(),1);break;case"week":w=N(this.year(),this.month(),this.date()-this.weekday());break;case"isoWeek":w=N(this.year(),this.month(),this.date()-(this.isoWeekday()-1));break;case"day":case"date":w=N(this.year(),this.month(),this.date());break;case"hour":w=this._d.valueOf(),w-=mod$1(w+(this._isUTC?0:6e4*this.utcOffset()),36e5);break;case"minute":w=this._d.valueOf(),w-=mod$1(w,6e4);break;case"second":w=this._d.valueOf(),w-=mod$1(w,1e3)}return this._d.setTime(w),hooks.updateOffset(this,!0),this},Tt.subtract=pt,Tt.toArray=function toArray(){var D=this;return[D.year(),D.month(),D.date(),D.hour(),D.minute(),D.second(),D.millisecond()]},Tt.toObject=function toObject(){var D=this;return{years:D.year(),months:D.month(),date:D.date(),hours:D.hours(),minutes:D.minutes(),seconds:D.seconds(),milliseconds:D.milliseconds()}},Tt.toDate=function toDate(){return new Date(this.valueOf())},Tt.toISOString=function toISOString(D){if(!this.isValid())return null;var w=!0!==D,N=w?this.clone().utc():this;return N.year()<0||N.year()>9999?formatMoment(N,w?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ"):isFunction(Date.prototype.toISOString)?w?this.toDate().toISOString():new Date(this.valueOf()+60*this.utcOffset()*1e3).toISOString().replace("Z",formatMoment(N,"Z")):formatMoment(N,w?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")},Tt.inspect=function inspect(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var D="moment",w="";this.isLocal()||(D=0===this.utcOffset()?"moment.utc":"moment.parseZone",w="Z");var N="["+D+'("]',F=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY",k=w+'[")]';return this.format(N+F+"-MM-DD[T]HH:mm:ss.SSS"+k)},Tt.toJSON=function toJSON(){return this.isValid()?this.toISOString():null},Tt.toString=function toString(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},Tt.unix=function unix(){return Math.floor(this.valueOf()/1e3)},Tt.valueOf=function valueOf(){return this._d.valueOf()-6e4*(this._offset||0)},Tt.creationData=function creationData(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}},Tt.year=Re,Tt.isLeapYear=function getIsLeapYear(){return isLeapYear(this.year())},Tt.weekYear=function getSetWeekYear(D){return getSetWeekYearHelper.call(this,D,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)},Tt.isoWeekYear=function getSetISOWeekYear(D){return getSetWeekYearHelper.call(this,D,this.isoWeek(),this.isoWeekday(),1,4)},Tt.quarter=Tt.quarters=function getSetQuarter(D){return null==D?Math.ceil((this.month()+1)/3):this.month(3*(D-1)+this.month()%3)},Tt.month=getSetMonth,Tt.daysInMonth=function getDaysInMonth(){return daysInMonth(this.year(),this.month())},Tt.week=Tt.weeks=function getSetWeek(D){var w=this.localeData().week(this);return null==D?w:this.add(7*(D-w),"d")},Tt.isoWeek=Tt.isoWeeks=function getSetISOWeek(D){var w=weekOfYear(this,1,4).week;return null==D?w:this.add(7*(D-w),"d")},Tt.weeksInYear=function getWeeksInYear(){var D=this.localeData()._week;return weeksInYear(this.year(),D.dow,D.doy)},Tt.isoWeeksInYear=function getISOWeeksInYear(){return weeksInYear(this.year(),1,4)},Tt.date=mt,Tt.day=Tt.days=function getSetDayOfWeek(D){if(!this.isValid())return null!=D?this:NaN;var w=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=D?(D=function parseWeekday(D,w){return"string"!=typeof D?D:isNaN(D)?"number"==typeof(D=w.weekdaysParse(D))?D:null:parseInt(D,10)}(D,this.localeData()),this.add(D-w,"d")):w},Tt.weekday=function getSetLocaleDayOfWeek(D){if(!this.isValid())return null!=D?this:NaN;var w=(this.day()+7-this.localeData()._week.dow)%7;return null==D?w:this.add(D-w,"d")},Tt.isoWeekday=function getSetISODayOfWeek(D){if(!this.isValid())return null!=D?this:NaN;if(null!=D){var w=function parseIsoWeekday(D,w){return"string"==typeof D?w.weekdaysParse(D)%7||7:isNaN(D)?null:D}(D,this.localeData());return this.day(this.day()%7?w:w-7)}return this.day()||7},Tt.dayOfYear=function getSetDayOfYear(D){var w=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return null==D?w:this.add(D-w,"d")},Tt.hour=Tt.hours=He,Tt.minute=Tt.minutes=gt,Tt.second=Tt.seconds=yt,Tt.millisecond=Tt.milliseconds=bt,Tt.utcOffset=function getSetOffset(D,w,N){var F,k=this._offset||0;if(!this.isValid())return null!=D?this:NaN;if(null!=D){if("string"==typeof D){if(null===(D=offsetFromString(Me,D)))return this}else Math.abs(D)<16&&!N&&(D*=60);return!this._isUTC&&w&&(F=getDateOffset(this)),this._offset=D,this._isUTC=!0,null!=F&&this.add(F,"m"),k!==D&&(!w||this._changeInProgress?addSubtract(this,createDuration(D-k,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,hooks.updateOffset(this,!0),this._changeInProgress=null)),this}return this._isUTC?k:getDateOffset(this)},Tt.utc=function setOffsetToUTC(D){return this.utcOffset(0,D)},Tt.local=function setOffsetToLocal(D){return this._isUTC&&(this.utcOffset(0,D),this._isUTC=!1,D&&this.subtract(getDateOffset(this),"m")),this},Tt.parseZone=function setOffsetToParsedOffset(){if(null!=this._tzm)this.utcOffset(this._tzm,!1,!0);else if("string"==typeof this._i){var D=offsetFromString(Se,this._i);null!=D?this.utcOffset(D):this.utcOffset(0,!0)}return this},Tt.hasAlignedHourOffset=function hasAlignedHourOffset(D){return!!this.isValid()&&(D=D?createLocal(D).utcOffset():0,(this.utcOffset()-D)%60==0)},Tt.isDST=function isDaylightSavingTime(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()},Tt.isLocal=function isLocal(){return!!this.isValid()&&!this._isUTC},Tt.isUtcOffset=function isUtcOffset(){return!!this.isValid()&&this._isUTC},Tt.isUtc=isUtc,Tt.isUTC=isUtc,Tt.zoneAbbr=function getZoneAbbr(){return this._isUTC?"UTC":""},Tt.zoneName=function getZoneName(){return this._isUTC?"Coordinated Universal Time":""},Tt.dates=deprecate("dates accessor is deprecated. Use date instead.",mt),Tt.months=deprecate("months accessor is deprecated. Use month instead",getSetMonth),Tt.years=deprecate("years accessor is deprecated. Use year instead",Re),Tt.zone=deprecate("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",(function getSetZone(D,w){return null!=D?("string"!=typeof D&&(D=-D),this.utcOffset(D,w),this):-this.utcOffset()})),Tt.isDSTShifted=deprecate("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",(function isDaylightSavingTimeShifted(){if(!isUndefined(this._isDSTShifted))return this._isDSTShifted;var D={};if(copyConfig(D,this),(D=prepareConfig(D))._a){var w=D._isUTC?createUTC(D._a):createLocal(D._a);this._isDSTShifted=this.isValid()&&compareArrays(D._a,w.toArray())>0}else this._isDSTShifted=!1;return this._isDSTShifted}));var Et=Locale.prototype;function get$1(D,w,N,F){var k=getLocale(),j=createUTC().set(F,w);return k[N](j,D)}function listMonthsImpl(D,w,N){if(isNumber(D)&&(w=D,D=void 0),D=D||"",null!=w)return get$1(D,w,N,"month");var F,k=[];for(F=0;F<12;F++)k[F]=get$1(D,F,N,"month");return k}function listWeekdaysImpl(D,w,N,F){"boolean"==typeof D?(isNumber(w)&&(N=w,w=void 0),w=w||""):(N=w=D,D=!1,isNumber(w)&&(N=w,w=void 0),w=w||"");var k,j=getLocale(),z=D?j._week.dow:0;if(null!=N)return get$1(w,(N+z)%7,F,"day");var G=[];for(k=0;k<7;k++)G[k]=get$1(w,(k+z)%7,F,"day");return G}Et.calendar=function calendar(D,w,N){var F=this._calendar[D]||this._calendar.sameElse;return isFunction(F)?F.call(w,N):F},Et.longDateFormat=function longDateFormat(D){var w=this._longDateFormat[D],N=this._longDateFormat[D.toUpperCase()];return w||!N?w:(this._longDateFormat[D]=N.replace(/MMMM|MM|DD|dddd/g,(function(D){return D.slice(1)})),this._longDateFormat[D])},Et.invalidDate=function invalidDate(){return this._invalidDate},Et.ordinal=function ordinal(D){return this._ordinal.replace("%d",D)},Et.preparse=preParsePostFormat,Et.postformat=preParsePostFormat,Et.relativeTime=function relativeTime(D,w,N,F){var k=this._relativeTime[N];return isFunction(k)?k(D,w,N,F):k.replace(/%d/i,D)},Et.pastFuture=function pastFuture(D,w){var N=this._relativeTime[D>0?"future":"past"];return isFunction(N)?N(w):N.replace(/%s/i,w)},Et.set=function set(D){var w,N;for(N in D)isFunction(w=D[N])?this[N]=w:this["_"+N]=w;this._config=D,this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)},Et.months=function localeMonths(D,w){return D?isArray(this._months)?this._months[D.month()]:this._months[(this._months.isFormat||De).test(w)?"format":"standalone"][D.month()]:isArray(this._months)?this._months:this._months.standalone},Et.monthsShort=function localeMonthsShort(D,w){return D?isArray(this._monthsShort)?this._monthsShort[D.month()]:this._monthsShort[De.test(w)?"format":"standalone"][D.month()]:isArray(this._monthsShort)?this._monthsShort:this._monthsShort.standalone},Et.monthsParse=function localeMonthsParse(D,w,N){var F,k,j;if(this._monthsParseExact)return handleStrictParse.call(this,D,w,N);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),F=0;F<12;F++){if(k=createUTC([2e3,F]),N&&!this._longMonthsParse[F]&&(this._longMonthsParse[F]=new RegExp("^"+this.months(k,"").replace(".","")+"$","i"),this._shortMonthsParse[F]=new RegExp("^"+this.monthsShort(k,"").replace(".","")+"$","i")),N||this._monthsParse[F]||(j="^"+this.months(k,"")+"|^"+this.monthsShort(k,""),this._monthsParse[F]=new RegExp(j.replace(".",""),"i")),N&&"MMMM"===w&&this._longMonthsParse[F].test(D))return F;if(N&&"MMM"===w&&this._shortMonthsParse[F].test(D))return F;if(!N&&this._monthsParse[F].test(D))return F}},Et.monthsRegex=function monthsRegex(D){return this._monthsParseExact?(hasOwnProp(this,"_monthsRegex")||computeMonthsParse.call(this),D?this._monthsStrictRegex:this._monthsRegex):(hasOwnProp(this,"_monthsRegex")||(this._monthsRegex=Ne),this._monthsStrictRegex&&D?this._monthsStrictRegex:this._monthsRegex)},Et.monthsShortRegex=function monthsShortRegex(D){return this._monthsParseExact?(hasOwnProp(this,"_monthsRegex")||computeMonthsParse.call(this),D?this._monthsShortStrictRegex:this._monthsShortRegex):(hasOwnProp(this,"_monthsShortRegex")||(this._monthsShortRegex=we),this._monthsShortStrictRegex&&D?this._monthsShortStrictRegex:this._monthsShortRegex)},Et.week=function localeWeek(D){return weekOfYear(D,this._week.dow,this._week.doy).week},Et.firstDayOfYear=function localeFirstDayOfYear(){return this._week.doy},Et.firstDayOfWeek=function localeFirstDayOfWeek(){return this._week.dow},Et.weekdays=function localeWeekdays(D,w){var N=isArray(this._weekdays)?this._weekdays:this._weekdays[D&&!0!==D&&this._weekdays.isFormat.test(w)?"format":"standalone"];return!0===D?shiftWeekdays(N,this._week.dow):D?N[D.day()]:N},Et.weekdaysMin=function localeWeekdaysMin(D){return!0===D?shiftWeekdays(this._weekdaysMin,this._week.dow):D?this._weekdaysMin[D.day()]:this._weekdaysMin},Et.weekdaysShort=function localeWeekdaysShort(D){return!0===D?shiftWeekdays(this._weekdaysShort,this._week.dow):D?this._weekdaysShort[D.day()]:this._weekdaysShort},Et.weekdaysParse=function localeWeekdaysParse(D,w,N){var F,k,j;if(this._weekdaysParseExact)return handleStrictParse$1.call(this,D,w,N);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),F=0;F<7;F++){if(k=createUTC([2e3,1]).day(F),N&&!this._fullWeekdaysParse[F]&&(this._fullWeekdaysParse[F]=new RegExp("^"+this.weekdays(k,"").replace(".","\\.?")+"$","i"),this._shortWeekdaysParse[F]=new RegExp("^"+this.weekdaysShort(k,"").replace(".","\\.?")+"$","i"),this._minWeekdaysParse[F]=new RegExp("^"+this.weekdaysMin(k,"").replace(".","\\.?")+"$","i")),this._weekdaysParse[F]||(j="^"+this.weekdays(k,"")+"|^"+this.weekdaysShort(k,"")+"|^"+this.weekdaysMin(k,""),this._weekdaysParse[F]=new RegExp(j.replace(".",""),"i")),N&&"dddd"===w&&this._fullWeekdaysParse[F].test(D))return F;if(N&&"ddd"===w&&this._shortWeekdaysParse[F].test(D))return F;if(N&&"dd"===w&&this._minWeekdaysParse[F].test(D))return F;if(!N&&this._weekdaysParse[F].test(D))return F}},Et.weekdaysRegex=function weekdaysRegex(D){return this._weekdaysParseExact?(hasOwnProp(this,"_weekdaysRegex")||computeWeekdaysParse.call(this),D?this._weekdaysStrictRegex:this._weekdaysRegex):(hasOwnProp(this,"_weekdaysRegex")||(this._weekdaysRegex=Ve),this._weekdaysStrictRegex&&D?this._weekdaysStrictRegex:this._weekdaysRegex)},Et.weekdaysShortRegex=function weekdaysShortRegex(D){return this._weekdaysParseExact?(hasOwnProp(this,"_weekdaysRegex")||computeWeekdaysParse.call(this),D?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(hasOwnProp(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=ze),this._weekdaysShortStrictRegex&&D?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)},Et.weekdaysMinRegex=function weekdaysMinRegex(D){return this._weekdaysParseExact?(hasOwnProp(this,"_weekdaysRegex")||computeWeekdaysParse.call(this),D?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(hasOwnProp(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=Ge),this._weekdaysMinStrictRegex&&D?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)},Et.isPM=function localeIsPM(D){return"p"===(D+"").toLowerCase().charAt(0)},Et.meridiem=function localeMeridiem(D,w,N){return D>11?N?"pm":"PM":N?"am":"AM"},getSetGlobalLocale("en",{dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(D){var w=D%10;return D+(1===toInt(D%100/10)?"th":1===w?"st":2===w?"nd":3===w?"rd":"th")}}),hooks.lang=deprecate("moment.lang is deprecated. Use moment.locale instead.",getSetGlobalLocale),hooks.langData=deprecate("moment.langData is deprecated. Use moment.localeData instead.",getLocale);var St=Math.abs;function addSubtract$1(D,w,N,F){var k=createDuration(w,N);return D._milliseconds+=F*k._milliseconds,D._days+=F*k._days,D._months+=F*k._months,D._bubble()}function absCeil(D){return D<0?Math.floor(D):Math.ceil(D)}function daysToMonths(D){return 4800*D/146097}function monthsToDays(D){return 146097*D/4800}function makeAs(D){return function(){return this.as(D)}}var Mt=makeAs("ms"),xt=makeAs("s"),At=makeAs("m"),Pt=makeAs("h"),Ct=makeAs("d"),Ot=makeAs("w"),Rt=makeAs("M"),Dt=makeAs("Q"),It=makeAs("y");function makeGetter(D){return function(){return this.isValid()?this._data[D]:NaN}}var Lt=makeGetter("milliseconds"),wt=makeGetter("seconds"),Nt=makeGetter("minutes"),Ft=makeGetter("hours"),Bt=makeGetter("days"),kt=makeGetter("months"),Ut=makeGetter("years"),Vt=Math.round,jt={ss:44,s:45,m:45,h:22,d:26,M:11};function substituteTimeAgo(D,w,N,F,k){return k.relativeTime(w||1,!!N,D,F)}var zt=Math.abs;function sign(D){return(D>0)-(D<0)||+D}function toISOString$1(){if(!this.isValid())return this.localeData().invalidDate();var D,w,N=zt(this._milliseconds)/1e3,F=zt(this._days),k=zt(this._months);D=absFloor(N/60),w=absFloor(D/60),N%=60,D%=60;var j=absFloor(k/12),z=k%=12,G=F,H=w,X=D,q=N?N.toFixed(3).replace(/\.?0+$/,""):"",Z=this.asSeconds();if(!Z)return"P0D";var J=Z<0?"-":"",$=sign(this._months)!==sign(Z)?"-":"",te=sign(this._days)!==sign(Z)?"-":"",ie=sign(this._milliseconds)!==sign(Z)?"-":"";return J+"P"+(j?$+j+"Y":"")+(z?$+z+"M":"")+(G?te+G+"D":"")+(H||X||q?"T":"")+(H?ie+H+"H":"")+(X?ie+X+"M":"")+(q?ie+q+"S":"")}var Gt=Duration.prototype;return Gt.isValid=function isValid$1(){return this._isValid},Gt.abs=function abs(){var D=this._data;return this._milliseconds=St(this._milliseconds),this._days=St(this._days),this._months=St(this._months),D.milliseconds=St(D.milliseconds),D.seconds=St(D.seconds),D.minutes=St(D.minutes),D.hours=St(D.hours),D.months=St(D.months),D.years=St(D.years),this},Gt.add=function add$1(D,w){return addSubtract$1(this,D,w,1)},Gt.subtract=function subtract$1(D,w){return addSubtract$1(this,D,w,-1)},Gt.as=function as(D){if(!this.isValid())return NaN;var w,N,F=this._milliseconds;if("month"===(D=normalizeUnits(D))||"quarter"===D||"year"===D)switch(w=this._days+F/864e5,N=this._months+daysToMonths(w),D){case"month":return N;case"quarter":return N/3;case"year":return N/12}else switch(w=this._days+Math.round(monthsToDays(this._months)),D){case"week":return w/7+F/6048e5;case"day":return w+F/864e5;case"hour":return 24*w+F/36e5;case"minute":return 1440*w+F/6e4;case"second":return 86400*w+F/1e3;case"millisecond":return Math.floor(864e5*w)+F;default:throw new Error("Unknown unit "+D)}},Gt.asMilliseconds=Mt,Gt.asSeconds=xt,Gt.asMinutes=At,Gt.asHours=Pt,Gt.asDays=Ct,Gt.asWeeks=Ot,Gt.asMonths=Rt,Gt.asQuarters=Dt,Gt.asYears=It,Gt.valueOf=function valueOf$1(){return this.isValid()?this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*toInt(this._months/12):NaN},Gt._bubble=function bubble(){var D,w,N,F,k,j=this._milliseconds,z=this._days,G=this._months,H=this._data;return j>=0&&z>=0&&G>=0||j<=0&&z<=0&&G<=0||(j+=864e5*absCeil(monthsToDays(G)+z),z=0,G=0),H.milliseconds=j%1e3,D=absFloor(j/1e3),H.seconds=D%60,w=absFloor(D/60),H.minutes=w%60,N=absFloor(w/60),H.hours=N%24,z+=absFloor(N/24),k=absFloor(daysToMonths(z)),G+=k,z-=absCeil(monthsToDays(k)),F=absFloor(G/12),G%=12,H.days=z,H.months=G,H.years=F,this},Gt.clone=function clone$1(){return createDuration(this)},Gt.get=function get$2(D){return D=normalizeUnits(D),this.isValid()?this[D+"s"]():NaN},Gt.milliseconds=Lt,Gt.seconds=wt,Gt.minutes=Nt,Gt.hours=Ft,Gt.days=Bt,Gt.weeks=function weeks(){return absFloor(this.days()/7)},Gt.months=kt,Gt.years=Ut,Gt.humanize=function humanize(D){if(!this.isValid())return this.localeData().invalidDate();var w=this.localeData(),N=function relativeTime$1(D,w,N){var F=createDuration(D).abs(),k=Vt(F.as("s")),j=Vt(F.as("m")),z=Vt(F.as("h")),G=Vt(F.as("d")),H=Vt(F.as("M")),X=Vt(F.as("y")),q=k<=jt.ss&&["s",k]||k<jt.s&&["ss",k]||j<=1&&["m"]||j<jt.m&&["mm",j]||z<=1&&["h"]||z<jt.h&&["hh",z]||G<=1&&["d"]||G<jt.d&&["dd",G]||H<=1&&["M"]||H<jt.M&&["MM",H]||X<=1&&["y"]||["yy",X];return q[2]=w,q[3]=+D>0,q[4]=N,substituteTimeAgo.apply(null,q)}(this,!D,w);return D&&(N=w.pastFuture(+this,N)),w.postformat(N)},Gt.toISOString=toISOString$1,Gt.toString=toISOString$1,Gt.toJSON=toISOString$1,Gt.locale=locale,Gt.localeData=localeData,Gt.toIsoString=deprecate("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",toISOString$1),Gt.lang=_t,addFormatToken("X",0,0,"unix"),addFormatToken("x",0,0,"valueOf"),addRegexToken("x",Ee),addRegexToken("X",/[+-]?\d+(\.\d{1,3})?/),addParseToken("X",(function(D,w,N){N._d=new Date(1e3*parseFloat(D,10))})),addParseToken("x",(function(D,w,N){N._d=new Date(toInt(D))})),hooks.version="2.24.0",function setHookCallback(D){w=D}(createLocal),hooks.fn=Tt,hooks.min=function min(){var D=[].slice.call(arguments,0);return pickBy("isBefore",D)},hooks.max=function max(){var D=[].slice.call(arguments,0);return pickBy("isAfter",D)},hooks.now=function(){return Date.now?Date.now():+new Date},hooks.utc=createUTC,hooks.unix=function createUnix(D){return createLocal(1e3*D)},hooks.months=function listMonths(D,w){return listMonthsImpl(D,w,"months")},hooks.isDate=isDate,hooks.locale=getSetGlobalLocale,hooks.invalid=createInvalid,hooks.duration=createDuration,hooks.isMoment=isMoment,hooks.weekdays=function listWeekdays(D,w,N){return listWeekdaysImpl(D,w,N,"weekdays")},hooks.parseZone=function createInZone(){return createLocal.apply(null,arguments).parseZone()},hooks.localeData=getLocale,hooks.isDuration=isDuration,hooks.monthsShort=function listMonthsShort(D,w){return listMonthsImpl(D,w,"monthsShort")},hooks.weekdaysMin=function listWeekdaysMin(D,w,N){return listWeekdaysImpl(D,w,N,"weekdaysMin")},hooks.defineLocale=defineLocale,hooks.updateLocale=function updateLocale(D,w){if(null!=w){var N,F,k=We;null!=(F=loadLocale(D))&&(k=F._config),w=mergeConfigs(k,w),(N=new Locale(w)).parentLocale=Xe[D],Xe[D]=N,getSetGlobalLocale(D)}else null!=Xe[D]&&(null!=Xe[D].parentLocale?Xe[D]=Xe[D].parentLocale:null!=Xe[D]&&delete Xe[D]);return Xe[D]},hooks.locales=function listLocales(){return z(Xe)},hooks.weekdaysShort=function listWeekdaysShort(D,w,N){return listWeekdaysImpl(D,w,N,"weekdaysShort")},hooks.normalizeUnits=normalizeUnits,hooks.relativeTimeRounding=function getSetRelativeTimeRounding(D){return void 0===D?Vt:"function"==typeof D&&(Vt=D,!0)},hooks.relativeTimeThreshold=function getSetRelativeTimeThreshold(D,w){return void 0!==jt[D]&&(void 0===w?jt[D]:(jt[D]=w,"s"===D&&(jt.ss=w-1),!0))},hooks.calendarFormat=function getCalendarFormat(D,w){var N=D.diff(w,"days",!0);return N<-6?"sameElse":N<-1?"lastWeek":N<0?"lastDay":N<1?"sameDay":N<2?"nextDay":N<7?"nextWeek":"sameElse"},hooks.prototype=Tt,hooks.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"GGGG-[W]WW",MONTH:"YYYY-MM"},hooks}()}).call(this,N(30)(D))},function(D,w,N){"use strict";N.r(w),N.d(w,"__extends",(function(){return __extends})),N.d(w,"__assign",(function(){return __assign})),N.d(w,"__rest",(function(){return __rest})),N.d(w,"__decorate",(function(){return __decorate})),N.d(w,"__param",(function(){return __param})),N.d(w,"__metadata",(function(){return __metadata})),N.d(w,"__awaiter",(function(){return __awaiter})),N.d(w,"__generator",(function(){return __generator})),N.d(w,"__exportStar",(function(){return __exportStar})),N.d(w,"__values",(function(){return __values})),N.d(w,"__read",(function(){return __read})),N.d(w,"__spread",(function(){return __spread})),N.d(w,"__spreadArrays",(function(){return __spreadArrays})),N.d(w,"__await",(function(){return __await})),N.d(w,"__asyncGenerator",(function(){return __asyncGenerator})),N.d(w,"__asyncDelegator",(function(){return __asyncDelegator})),N.d(w,"__asyncValues",(function(){return __asyncValues})),N.d(w,"__makeTemplateObject",(function(){return __makeTemplateObject})),N.d(w,"__importStar",(function(){return __importStar})),N.d(w,"__importDefault",(function(){return __importDefault})),N.d(w,"__classPrivateFieldGet",(function(){return __classPrivateFieldGet})),N.d(w,"__classPrivateFieldSet",(function(){return __classPrivateFieldSet}));var extendStatics=function(D,w){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(D,w){D.__proto__=w}||function(D,w){for(var N in w)w.hasOwnProperty(N)&&(D[N]=w[N])})(D,w)};function __extends(D,w){function __(){this.constructor=D}extendStatics(D,w),D.prototype=null===w?Object.create(w):(__.prototype=w.prototype,new __)}var __assign=function(){return(__assign=Object.assign||function __assign(D){for(var w,N=1,F=arguments.length;N<F;N++)for(var k in w=arguments[N])Object.prototype.hasOwnProperty.call(w,k)&&(D[k]=w[k]);return D}).apply(this,arguments)};function __rest(D,w){var N={};for(var F in D)Object.prototype.hasOwnProperty.call(D,F)&&w.indexOf(F)<0&&(N[F]=D[F]);if(null!=D&&"function"==typeof Object.getOwnPropertySymbols){var k=0;for(F=Object.getOwnPropertySymbols(D);k<F.length;k++)w.indexOf(F[k])<0&&Object.prototype.propertyIsEnumerable.call(D,F[k])&&(N[F[k]]=D[F[k]])}return N}function __decorate(D,w,N,F){var k,j=arguments.length,z=j<3?w:null===F?F=Object.getOwnPropertyDescriptor(w,N):F;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)z=Reflect.decorate(D,w,N,F);else for(var G=D.length-1;G>=0;G--)(k=D[G])&&(z=(j<3?k(z):j>3?k(w,N,z):k(w,N))||z);return j>3&&z&&Object.defineProperty(w,N,z),z}function __param(D,w){return function(N,F){w(N,F,D)}}function __metadata(D,w){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(D,w)}function __awaiter(D,w,N,F){return new(N||(N=Promise))((function(k,j){function fulfilled(D){try{step(F.next(D))}catch(D){j(D)}}function rejected(D){try{step(F.throw(D))}catch(D){j(D)}}function step(D){D.done?k(D.value):function adopt(D){return D instanceof N?D:new N((function(w){w(D)}))}(D.value).then(fulfilled,rejected)}step((F=F.apply(D,w||[])).next())}))}function __generator(D,w){var N,F,k,j,z={label:0,sent:function(){if(1&k[0])throw k[1];return k[1]},trys:[],ops:[]};return j={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(j[Symbol.iterator]=function(){return this}),j;function verb(j){return function(G){return function step(j){if(N)throw new TypeError("Generator is already executing.");for(;z;)try{if(N=1,F&&(k=2&j[0]?F.return:j[0]?F.throw||((k=F.return)&&k.call(F),0):F.next)&&!(k=k.call(F,j[1])).done)return k;switch(F=0,k&&(j=[2&j[0],k.value]),j[0]){case 0:case 1:k=j;break;case 4:return z.label++,{value:j[1],done:!1};case 5:z.label++,F=j[1],j=[0];continue;case 7:j=z.ops.pop(),z.trys.pop();continue;default:if(!(k=z.trys,(k=k.length>0&&k[k.length-1])||6!==j[0]&&2!==j[0])){z=0;continue}if(3===j[0]&&(!k||j[1]>k[0]&&j[1]<k[3])){z.label=j[1];break}if(6===j[0]&&z.label<k[1]){z.label=k[1],k=j;break}if(k&&z.label<k[2]){z.label=k[2],z.ops.push(j);break}k[2]&&z.ops.pop(),z.trys.pop();continue}j=w.call(D,z)}catch(D){j=[6,D],F=0}finally{N=k=0}if(5&j[0])throw j[1];return{value:j[0]?j[1]:void 0,done:!0}}([j,G])}}}function __exportStar(D,w){for(var N in D)w.hasOwnProperty(N)||(w[N]=D[N])}function __values(D){var w="function"==typeof Symbol&&Symbol.iterator,N=w&&D[w],F=0;if(N)return N.call(D);if(D&&"number"==typeof D.length)return{next:function(){return D&&F>=D.length&&(D=void 0),{value:D&&D[F++],done:!D}}};throw new TypeError(w?"Object is not iterable.":"Symbol.iterator is not defined.")}function __read(D,w){var N="function"==typeof Symbol&&D[Symbol.iterator];if(!N)return D;var F,k,j=N.call(D),z=[];try{for(;(void 0===w||w-- >0)&&!(F=j.next()).done;)z.push(F.value)}catch(D){k={error:D}}finally{try{F&&!F.done&&(N=j.return)&&N.call(j)}finally{if(k)throw k.error}}return z}function __spread(){for(var D=[],w=0;w<arguments.length;w++)D=D.concat(__read(arguments[w]));return D}function __spreadArrays(){for(var D=0,w=0,N=arguments.length;w<N;w++)D+=arguments[w].length;var F=Array(D),k=0;for(w=0;w<N;w++)for(var j=arguments[w],z=0,G=j.length;z<G;z++,k++)F[k]=j[z];return F}function __await(D){return this instanceof __await?(this.v=D,this):new __await(D)}function __asyncGenerator(D,w,N){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var F,k=N.apply(D,w||[]),j=[];return F={},verb("next"),verb("throw"),verb("return"),F[Symbol.asyncIterator]=function(){return this},F;function verb(D){k[D]&&(F[D]=function(w){return new Promise((function(N,F){j.push([D,w,N,F])>1||resume(D,w)}))})}function resume(D,w){try{!function step(D){D.value instanceof __await?Promise.resolve(D.value.v).then(fulfill,reject):settle(j[0][2],D)}(k[D](w))}catch(D){settle(j[0][3],D)}}function fulfill(D){resume("next",D)}function reject(D){resume("throw",D)}function settle(D,w){D(w),j.shift(),j.length&&resume(j[0][0],j[0][1])}}function __asyncDelegator(D){var w,N;return w={},verb("next"),verb("throw",(function(D){throw D})),verb("return"),w[Symbol.iterator]=function(){return this},w;function verb(F,k){w[F]=D[F]?function(w){return(N=!N)?{value:__await(D[F](w)),done:"return"===F}:k?k(w):w}:k}}function __asyncValues(D){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var w,N=D[Symbol.asyncIterator];return N?N.call(D):(D=__values(D),w={},verb("next"),verb("throw"),verb("return"),w[Symbol.asyncIterator]=function(){return this},w);function verb(N){w[N]=D[N]&&function(w){return new Promise((function(F,k){(function settle(D,w,N,F){Promise.resolve(F).then((function(w){D({value:w,done:N})}),w)})(F,k,(w=D[N](w)).done,w.value)}))}}}function __makeTemplateObject(D,w){return Object.defineProperty?Object.defineProperty(D,"raw",{value:w}):D.raw=w,D}function __importStar(D){if(D&&D.__esModule)return D;var w={};if(null!=D)for(var N in D)Object.hasOwnProperty.call(D,N)&&(w[N]=D[N]);return w.default=D,w}function __importDefault(D){return D&&D.__esModule?D:{default:D}}function __classPrivateFieldGet(D,w){if(!w.has(D))throw new TypeError("attempted to get private field on non-instance");return w.get(D)}function __classPrivateFieldSet(D,w,N){if(!w.has(D))throw new TypeError("attempted to set private field on non-instance");return w.set(D,N),N}},,,,,function(D,w){var N;N=function(){return this}();try{N=N||new Function("return this")()}catch(D){"object"==typeof window&&(N=window)}D.exports=N},function(D,w){var N,F,k=D.exports={};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(D){if(N===setTimeout)return setTimeout(D,0);if((N===defaultSetTimout||!N)&&setTimeout)return N=setTimeout,setTimeout(D,0);try{return N(D,0)}catch(w){try{return N.call(null,D,0)}catch(w){return N.call(this,D,0)}}}!function(){try{N="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(D){N=defaultSetTimout}try{F="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(D){F=defaultClearTimeout}}();var j,z=[],G=!1,H=-1;function cleanUpNextTick(){G&&j&&(G=!1,j.length?z=j.concat(z):H=-1,z.length&&drainQueue())}function drainQueue(){if(!G){var D=runTimeout(cleanUpNextTick);G=!0;for(var w=z.length;w;){for(j=z,z=[];++H<w;)j&&j[H].run();H=-1,w=z.length}j=null,G=!1,function runClearTimeout(D){if(F===clearTimeout)return clearTimeout(D);if((F===defaultClearTimeout||!F)&&clearTimeout)return F=clearTimeout,clearTimeout(D);try{return F(D)}catch(w){try{return F.call(null,D)}catch(w){return F.call(this,D)}}}(D)}}function Item(D,w){this.fun=D,this.array=w}function noop(){}k.nextTick=function(D){var w=new Array(arguments.length-1);if(arguments.length>1)for(var N=1;N<arguments.length;N++)w[N-1]=arguments[N];z.push(new Item(D,w)),1!==z.length||G||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},k.title="browser",k.browser=!0,k.env={},k.argv=[],k.version="",k.versions={},k.on=noop,k.addListener=noop,k.once=noop,k.off=noop,k.removeListener=noop,k.removeAllListeners=noop,k.emit=noop,k.prependListener=noop,k.prependOnceListener=noop,k.listeners=function(D){return[]},k.binding=function(D){throw new Error("process.binding is not supported")},k.cwd=function(){return"/"},k.chdir=function(D){throw new Error("process.chdir is not supported")},k.umask=function(){return 0}},,function(D,w,N){(function(w,N){!function webpackUniversalModuleDefinition(w,N){D.exports=N()}("undefined"!=typeof self&&self,(function(){return function(D){var w={};function __webpack_require__(N){if(w[N])return w[N].exports;var F=w[N]={i:N,l:!1,exports:{}};return D[N].call(F.exports,F,F.exports,__webpack_require__),F.l=!0,F.exports}return __webpack_require__.m=D,__webpack_require__.c=w,__webpack_require__.d=function(D,w,N){__webpack_require__.o(D,w)||Object.defineProperty(D,w,{configurable:!1,enumerable:!0,get:N})},__webpack_require__.n=function(D){var w=D&&D.__esModule?function getDefault(){return D.default}:function getModuleExports(){return D};return __webpack_require__.d(w,"a",w),w},__webpack_require__.o=function(D,w){return Object.prototype.hasOwnProperty.call(D,w)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=6)}([function(D,w){},function(D,w,N){"use strict";var F=Array.prototype,k=Object.prototype,j={"&":"&amp;",'"':"&quot;","'":"&#39;","<":"&lt;",">":"&gt;"},z=/[&"'<>]/g;function hasOwnProp(D,w){return k.hasOwnProperty.call(D,w)}function lookupEscape(D){return j[D]}function TemplateError(D,w,N){var F,k,j;if(D instanceof Error&&(D=(k=D).name+": "+k.message),Object.setPrototypeOf?(F=new Error(D),Object.setPrototypeOf(F,TemplateError.prototype)):(F=this,Object.defineProperty(F,"message",{enumerable:!1,writable:!0,value:D})),Object.defineProperty(F,"name",{value:"Template render error"}),Error.captureStackTrace&&Error.captureStackTrace(F,this.constructor),k){var z=Object.getOwnPropertyDescriptor(k,"stack");(j=z&&(z.get||function(){return z.value}))||(j=function getStack(){return k.stack})}else{var G=new Error(D).stack;j=function getStack(){return G}}return Object.defineProperty(F,"stack",{get:function get(){return j.call(F)}}),Object.defineProperty(F,"cause",{value:k}),F.lineno=w,F.colno=N,F.firstUpdate=!0,F.Update=function Update(D){var w="("+(D||"unknown path")+")";return this.firstUpdate&&(this.lineno&&this.colno?w+=" [Line "+this.lineno+", Column "+this.colno+"]":this.lineno&&(w+=" [Line "+this.lineno+"]")),w+="\n ",this.firstUpdate&&(w+=" "),this.message=w+(this.message||""),this.firstUpdate=!1,this},F}function isFunction(D){return"[object Function]"===k.toString.call(D)}function isArray(D){return"[object Array]"===k.toString.call(D)}function isString(D){return"[object String]"===k.toString.call(D)}function isObject(D){return"[object Object]"===k.toString.call(D)}function toArray(D){return Array.prototype.slice.call(D)}function indexOf(D,w,N){return Array.prototype.indexOf.call(D||[],w,N)}function keys_(D){var w=[];for(var N in D)hasOwnProp(D,N)&&w.push(N);return w}(w=D.exports={}).hasOwnProp=hasOwnProp,w._prettifyError=function _prettifyError(D,N,F){if(F.Update||(F=new w.TemplateError(F)),F.Update(D),!N){var k=F;(F=new Error(k.message)).name=k.name}return F},Object.setPrototypeOf?Object.setPrototypeOf(TemplateError.prototype,Error.prototype):TemplateError.prototype=Object.create(Error.prototype,{constructor:{value:TemplateError}}),w.TemplateError=TemplateError,w.escape=function escape(D){return D.replace(z,lookupEscape)},w.isFunction=isFunction,w.isArray=isArray,w.isString=isString,w.isObject=isObject,w.groupBy=function groupBy(D,w){for(var N={},F=isFunction(w)?w:function(D){return D[w]},k=0;k<D.length;k++){var j=D[k],z=F(j,k);(N[z]||(N[z]=[])).push(j)}return N},w.toArray=toArray,w.without=function without(D){var w=[];if(!D)return w;for(var N=D.length,F=toArray(arguments).slice(1),k=-1;++k<N;)-1===indexOf(F,D[k])&&w.push(D[k]);return w},w.repeat=function repeat(D,w){for(var N="",F=0;F<w;F++)N+=D;return N},w.each=function each(D,w,N){if(null!=D)if(F.forEach&&D.forEach===F.forEach)D.forEach(w,N);else if(D.length===+D.length)for(var k=0,j=D.length;k<j;k++)w.call(N,D[k],k,D)},w.map=function map(D,w){var N=[];if(null==D)return N;if(F.map&&D.map===F.map)return D.map(w);for(var k=0;k<D.length;k++)N[N.length]=w(D[k],k);return D.length===+D.length&&(N.length=D.length),N},w.asyncIter=function asyncIter(D,w,N){var F=-1;!function next(){++F<D.length?w(D[F],F,next,N):N()}()},w.asyncFor=function asyncFor(D,w,N){var F=keys_(D||{}),k=F.length,j=-1;!function next(){j++;var z=F[j];j<k?w(z,D[z],j,k,next):N()}()},w.indexOf=indexOf,w.keys=keys_,w._entries=function _entries(D){return keys_(D).map((function(w){return[w,D[w]]}))},w._values=function _values(D){return keys_(D).map((function(w){return D[w]}))},w._assign=w.extend=function extend(D,w){return D=D||{},keys_(w).forEach((function(N){D[N]=w[N]})),D},w.inOperator=function inOperator(D,w){if(isArray(w)||isString(w))return-1!==w.indexOf(D);if(isObject(w))return D in w;throw new Error('Cannot use "in" operator to search for "'+D+'" in unexpected types.')}},function(D,w,N){"use strict";var F=N(1),k=Array.from,j="function"==typeof Symbol&&Symbol.iterator&&"function"==typeof k,z=function(){function Frame(D,w){this.variables={},this.parent=D,this.topLevel=!1,this.isolateWrites=w}var D=Frame.prototype;return D.set=function set(D,w,N){var F=D.split("."),k=this.variables,j=this;if(N&&(j=this.resolve(F[0],!0)))j.set(D,w);else{for(var z=0;z<F.length-1;z++){var G=F[z];k[G]||(k[G]={}),k=k[G]}k[F[F.length-1]]=w}},D.get=function get(D){var w=this.variables[D];return void 0!==w?w:null},D.lookup=function lookup(D){var w=this.parent,N=this.variables[D];return void 0!==N?N:w&&w.lookup(D)},D.resolve=function resolve(D,w){var N=w&&this.isolateWrites?void 0:this.parent;return void 0!==this.variables[D]?this:N&&N.resolve(D)},D.push=function push(D){return new Frame(this,D)},D.pop=function pop(){return this.parent},Frame}();function isKeywordArgs(D){return D&&Object.prototype.hasOwnProperty.call(D,"__keywords")}function getKeywordArgs(D){var w=D.length;if(w){var N=D[w-1];if(isKeywordArgs(N))return N}return{}}function numArgs(D){var w=D.length;return 0===w?0:isKeywordArgs(D[w-1])?w-1:w}function SafeString(D){if("string"!=typeof D)return D;this.val=D,this.length=D.length}SafeString.prototype=Object.create(String.prototype,{length:{writable:!0,configurable:!0,value:0}}),SafeString.prototype.valueOf=function valueOf(){return this.val},SafeString.prototype.toString=function toString(){return this.val},D.exports={Frame:z,makeMacro:function makeMacro(D,w,N){var F=this;return function(){for(var k=arguments.length,j=new Array(k),z=0;z<k;z++)j[z]=arguments[z];var G,H=numArgs(j),X=getKeywordArgs(j);if(H>D.length)G=j.slice(0,D.length),j.slice(G.length,H).forEach((function(D,N){N<w.length&&(X[w[N]]=D)})),G.push(X);else if(H<D.length){G=j.slice(0,H);for(var q=H;q<D.length;q++){var Z=D[q];G.push(X[Z]),delete X[Z]}G.push(X)}else G=j;return N.apply(F,G)}},makeKeywordArgs:function makeKeywordArgs(D){return D.__keywords=!0,D},numArgs,suppressValue:function suppressValue(D,w){return D=null!=D?D:"",!w||D instanceof SafeString||(D=F.escape(D.toString())),D},ensureDefined:function ensureDefined(D,w,N){if(null==D)throw new F.TemplateError("attempted to output null or undefined value",w+1,N+1);return D},memberLookup:function memberLookup(D,w){if(null!=D)return"function"==typeof D[w]?function(){for(var N=arguments.length,F=new Array(N),k=0;k<N;k++)F[k]=arguments[k];return D[w].apply(D,F)}:D[w]},contextOrFrameLookup:function contextOrFrameLookup(D,w,N){var F=w.lookup(N);return void 0!==F?F:D.lookup(N)},callWrap:function callWrap(D,w,N,F){if(!D)throw new Error("Unable to call `"+w+"`, which is undefined or falsey");if("function"!=typeof D)throw new Error("Unable to call `"+w+"`, which is not a function");return D.apply(N,F)},handleError:function handleError(D,w,N){return D.lineno?D:new F.TemplateError(D,w,N)},isArray:F.isArray,keys:F.keys,SafeString,copySafeness:function copySafeness(D,w){return D instanceof SafeString?new SafeString(w):w.toString()},markSafe:function markSafe(D){var w=typeof D;return"string"===w?new SafeString(D):"function"!==w?D:function wrapSafe(w){var N=D.apply(this,arguments);return"string"==typeof N?new SafeString(N):N}},asyncEach:function asyncEach(D,w,N,k){if(F.isArray(D)){var j=D.length;F.asyncIter(D,(function iterCallback(D,F,k){switch(w){case 1:N(D,F,j,k);break;case 2:N(D[0],D[1],F,j,k);break;case 3:N(D[0],D[1],D[2],F,j,k);break;default:D.push(F,j,k),N.apply(this,D)}}),k)}else F.asyncFor(D,(function iterCallback(D,w,F,k,j){N(D,w,F,k,j)}),k)},asyncAll:function asyncAll(D,w,N,k){var j,z,G=0;function done(D,w){G++,z[D]=w,G===j&&k(null,z.join(""))}if(F.isArray(D))if(j=D.length,z=new Array(j),0===j)k(null,"");else for(var H=0;H<D.length;H++){var X=D[H];switch(w){case 1:N(X,H,j,done);break;case 2:N(X[0],X[1],H,j,done);break;case 3:N(X[0],X[1],X[2],H,j,done);break;default:X.push(H,j,done),N.apply(this,X)}}else{var q=F.keys(D||{});if(j=q.length,z=new Array(j),0===j)k(null,"");else for(var Z=0;Z<q.length;Z++){var J=q[Z];N(J,D[J],Z,j,done)}}},inOperator:F.inOperator,fromIterator:function fromIterator(D){return"object"!=typeof D||null===D||F.isArray(D)?D:j&&Symbol.iterator in D?k(D):D}}},function(D,w,N){"use strict";var F=function(D){function PrecompiledLoader(w){var N;return(N=D.call(this)||this).precompiled=w||{},N}return function _inheritsLoose(D,w){D.prototype=Object.create(w.prototype),D.prototype.constructor=D,D.__proto__=w}(PrecompiledLoader,D),PrecompiledLoader.prototype.getSource=function getSource(D){return this.precompiled[D]?{src:{type:"code",obj:this.precompiled[D]},path:D}:null},PrecompiledLoader}(N(4));D.exports={PrecompiledLoader:F}},function(D,w,N){"use strict";var F=N(0),k=N(5).EmitterObj;D.exports=function(D){function Loader(){return D.apply(this,arguments)||this}!function _inheritsLoose(D,w){D.prototype=Object.create(w.prototype),D.prototype.constructor=D,D.__proto__=w}(Loader,D);var w=Loader.prototype;return w.resolve=function resolve(D,w){return F.resolve(F.dirname(D),w)},w.isRelative=function isRelative(D){return 0===D.indexOf("./")||0===D.indexOf("../")},Loader}(k)},function(D,w,N){"use strict";function _defineProperties(D,w){for(var N=0;N<w.length;N++){var F=w[N];F.enumerable=F.enumerable||!1,F.configurable=!0,"value"in F&&(F.writable=!0),Object.defineProperty(D,F.key,F)}}function _createClass(D,w,N){return w&&_defineProperties(D.prototype,w),N&&_defineProperties(D,N),D}function _inheritsLoose(D,w){D.prototype=Object.create(w.prototype),D.prototype.constructor=D,D.__proto__=w}var F=N(13),k=N(1);function extendClass(D,w,N){N=N||{},k.keys(N).forEach((function(w){N[w]=function parentWrap(D,w){return"function"!=typeof D||"function"!=typeof w?w:function wrap(){var N=this.parent;this.parent=D;var F=w.apply(this,arguments);return this.parent=N,F}}(D.prototype[w],N[w])}));var F=function(D){function subclass(){return D.apply(this,arguments)||this}return _inheritsLoose(subclass,D),_createClass(subclass,[{key:"typename",get:function get(){return w}}]),subclass}(D);return k._assign(F.prototype,N),F}var j=function(){function Obj(){this.init.apply(this,arguments)}return Obj.prototype.init=function init(){},Obj.extend=function extend(D,w){return"object"==typeof D&&(w=D,D="anonymous"),extendClass(this,D,w)},_createClass(Obj,[{key:"typename",get:function get(){return this.constructor.name}}]),Obj}(),z=function(D){function EmitterObj(){var w,N;return(w=N=D.call(this)||this).init.apply(w,arguments),N}return _inheritsLoose(EmitterObj,D),EmitterObj.prototype.init=function init(){},EmitterObj.extend=function extend(D,w){return"object"==typeof D&&(w=D,D="anonymous"),extendClass(this,D,w)},_createClass(EmitterObj,[{key:"typename",get:function get(){return this.constructor.name}}]),EmitterObj}(F);D.exports={Obj:j,EmitterObj:z}},function(D,w,N){"use strict";var F,k=N(1),j=N(7),z=j.Environment,G=j.Template,H=N(4),X=N(3),q=N(0),Z=N(0),J=N(0),$=N(0),te=N(2),ie=N(0),oe=N(17);function configure(D,w){var N;return w=w||{},k.isObject(D)&&(w=D,D=null),X.FileSystemLoader?N=new X.FileSystemLoader(D,{watch:w.watch,noCache:w.noCache}):X.WebLoader&&(N=new X.WebLoader(D,{useCache:w.web&&w.web.useCache,async:w.web&&w.web.async})),F=new z(N,w),w&&w.express&&F.express(w.express),F}D.exports={Environment:z,Template:G,Loader:H,FileSystemLoader:X.FileSystemLoader,NodeResolveLoader:X.NodeResolveLoader,PrecompiledLoader:X.PrecompiledLoader,WebLoader:X.WebLoader,compiler:Z,parser:J,lexer:$,runtime:te,lib:k,nodes:ie,installJinjaCompat:oe,configure,reset:function reset(){F=void 0},compile:function compile(D,w,N,k){return F||configure(),new G(D,w,N,k)},render:function render(D,w,N){return F||configure(),F.render(D,w,N)},renderString:function renderString(D,w,N){return F||configure(),F.renderString(D,w,N)},precompile:q?q.precompile:void 0,precompileString:q?q.precompileString:void 0}},function(D,w,N){"use strict";function _inheritsLoose(D,w){D.prototype=Object.create(w.prototype),D.prototype.constructor=D,D.__proto__=w}var F=N(8),k=N(11),j=N(1),z=N(0),G=N(12),H=N(3),X=H.FileSystemLoader,q=H.WebLoader,Z=H.PrecompiledLoader,J=N(14),$=N(15),te=N(5),ie=te.Obj,oe=te.EmitterObj,ce=N(2),he=ce.handleError,fe=ce.Frame,pe=N(16);function callbackAsap(D,w,N){F((function(){D(w,N)}))}var _e={type:"code",obj:{root:function root(D,w,N,F,k){try{k(null,"")}catch(D){k(he(D,null,null))}}}},ve=function(D){function Environment(){return D.apply(this,arguments)||this}_inheritsLoose(Environment,D);var w=Environment.prototype;return w.init=function init(D,w){var N=this;w=this.opts=w||{},this.opts.dev=!!w.dev,this.opts.autoescape=null==w.autoescape||w.autoescape,this.opts.throwOnUndefined=!!w.throwOnUndefined,this.opts.trimBlocks=!!w.trimBlocks,this.opts.lstripBlocks=!!w.lstripBlocks,this.loaders=[],D?this.loaders=j.isArray(D)?D:[D]:X?this.loaders=[new X("views")]:q&&(this.loaders=[new q("/views")]),"undefined"!=typeof window&&window.nunjucksPrecompiled&&this.loaders.unshift(new Z(window.nunjucksPrecompiled)),this._initLoaders(),this.globals=$(),this.filters={},this.tests={},this.asyncFilters=[],this.extensions={},this.extensionsList=[],j._entries(G).forEach((function(D){var w=D[0],F=D[1];return N.addFilter(w,F)})),j._entries(J).forEach((function(D){var w=D[0],F=D[1];return N.addTest(w,F)}))},w._initLoaders=function _initLoaders(){var D=this;this.loaders.forEach((function(w){w.cache={},"function"==typeof w.on&&(w.on("update",(function(N,F){w.cache[N]=null,D.emit("update",N,F,w)})),w.on("load",(function(N,F){D.emit("load",N,F,w)})))}))},w.invalidateCache=function invalidateCache(){this.loaders.forEach((function(D){D.cache={}}))},w.addExtension=function addExtension(D,w){return w.__name=D,this.extensions[D]=w,this.extensionsList.push(w),this},w.removeExtension=function removeExtension(D){var w=this.getExtension(D);w&&(this.extensionsList=j.without(this.extensionsList,w),delete this.extensions[D])},w.getExtension=function getExtension(D){return this.extensions[D]},w.hasExtension=function hasExtension(D){return!!this.extensions[D]},w.addGlobal=function addGlobal(D,w){return this.globals[D]=w,this},w.getGlobal=function getGlobal(D){if(void 0===this.globals[D])throw new Error("global not found: "+D);return this.globals[D]},w.addFilter=function addFilter(D,w,N){var F=w;return N&&this.asyncFilters.push(D),this.filters[D]=F,this},w.getFilter=function getFilter(D){if(!this.filters[D])throw new Error("filter not found: "+D);return this.filters[D]},w.addTest=function addTest(D,w){return this.tests[D]=w,this},w.getTest=function getTest(D){if(!this.tests[D])throw new Error("test not found: "+D);return this.tests[D]},w.resolveTemplate=function resolveTemplate(D,w,N){return!(!D.isRelative||!w)&&D.isRelative(N)&&D.resolve?D.resolve(w,N):N},w.getTemplate=function getTemplate(D,w,N,F,k){var z,G=this,H=this,X=null;if(D&&D.raw&&(D=D.raw),j.isFunction(N)&&(k=N,N=null,w=w||!1),j.isFunction(w)&&(k=w,w=!1),D instanceof be)X=D;else{if("string"!=typeof D)throw new Error("template names must be a string: "+D);for(var q=0;q<this.loaders.length;q++){var Z=this.loaders[q];if(X=Z.cache[this.resolveTemplate(Z,N,D)])break}}if(X)return w&&X.compile(),k?void k(null,X):X;return j.asyncIter(this.loaders,(function(w,F,k,j){function handle(D,N){D?j(D):N?(N.loader=w,j(null,N)):k()}D=H.resolveTemplate(w,N,D),w.async?w.getSource(D,handle):handle(null,w.getSource(D))}),(function createTemplate(N,j){if(j||N||F||(N=new Error("template not found: "+D)),N){if(k)return void k(N);throw N}var H;j?(H=new be(j.src,G,j.path,w),j.noCache||(j.loader.cache[D]=H)):H=new be(_e,G,"",w),k?k(null,H):z=H})),z},w.express=function express(D){return pe(this,D)},w.render=function render(D,w,N){j.isFunction(w)&&(N=w,w=null);var F=null;return this.getTemplate(D,(function(D,k){if(D&&N)callbackAsap(N,D);else{if(D)throw D;F=k.render(w,N)}})),F},w.renderString=function renderString(D,w,N,F){return j.isFunction(N)&&(F=N,N={}),new be(D,this,(N=N||{}).path).render(w,F)},w.waterfall=function waterfall(D,w,N){return k(D,w,N)},Environment}(oe),ye=function(D){function Context(){return D.apply(this,arguments)||this}_inheritsLoose(Context,D);var w=Context.prototype;return w.init=function init(D,w,N){var F=this;this.env=N||new ve,this.ctx=j.extend({},D),this.blocks={},this.exported=[],j.keys(w).forEach((function(D){F.addBlock(D,w[D])}))},w.lookup=function lookup(D){return D in this.env.globals&&!(D in this.ctx)?this.env.globals[D]:this.ctx[D]},w.setVariable=function setVariable(D,w){this.ctx[D]=w},w.getVariables=function getVariables(){return this.ctx},w.addBlock=function addBlock(D,w){return this.blocks[D]=this.blocks[D]||[],this.blocks[D].push(w),this},w.getBlock=function getBlock(D){if(!this.blocks[D])throw new Error('unknown block "'+D+'"');return this.blocks[D][0]},w.getSuper=function getSuper(D,w,N,F,k,z){var G=j.indexOf(this.blocks[w]||[],N),H=this.blocks[w][G+1];if(-1===G||!H)throw new Error('no super block available for "'+w+'"');H(D,this,F,k,z)},w.addExport=function addExport(D){this.exported.push(D)},w.getExported=function getExported(){var D=this,w={};return this.exported.forEach((function(N){w[N]=D.ctx[N]})),w},Context}(ie),be=function(D){function Template(){return D.apply(this,arguments)||this}_inheritsLoose(Template,D);var w=Template.prototype;return w.init=function init(D,w,N,F){if(this.env=w||new ve,j.isObject(D))switch(D.type){case"code":this.tmplProps=D.obj;break;case"string":this.tmplStr=D.obj;break;default:throw new Error("Unexpected template object type "+D.type+"; expected 'code', or 'string'")}else{if(!j.isString(D))throw new Error("src must be a string or an object describing the source");this.tmplStr=D}if(this.path=N,F)try{this._compile()}catch(D){throw j._prettifyError(this.path,this.env.opts.dev,D)}else this.compiled=!1},w.render=function render(D,w,N){var F=this;"function"==typeof D?(N=D,D={}):"function"==typeof w&&(N=w,w=null);var k=!w;try{this.compile()}catch(D){var z=j._prettifyError(this.path,this.env.opts.dev,D);if(N)return callbackAsap(N,z);throw z}var G=new ye(D||{},this.blocks,this.env),H=w?w.push(!0):new fe;H.topLevel=!0;var X=null,q=!1;return this.rootRenderFunc(this.env,G,H,ce,(function(D,w){if(q){if(N)return;throw D}if(D&&(D=j._prettifyError(F.path,F.env.opts.dev,D),q=!0),N)k?callbackAsap(N,D,w):N(D,w);else{if(D)throw D;X=w}})),X},w.getExported=function getExported(D,w,N){"function"==typeof D&&(N=D,D={}),"function"==typeof w&&(N=w,w=null);try{this.compile()}catch(D){if(N)return N(D);throw D}var F=w?w.push():new fe;F.topLevel=!0;var k=new ye(D||{},this.blocks,this.env);this.rootRenderFunc(this.env,k,F,ce,(function(D){D?N(D,null):N(null,k.getExported())}))},w.compile=function compile(){this.compiled||this._compile()},w._compile=function _compile(){var D;if(this.tmplProps)D=this.tmplProps;else{var w=z.compile(this.tmplStr,this.env.asyncFilters,this.env.extensionsList,this.path,this.env.opts);D=new Function(w)()}this.blocks=this._getBlocks(D),this.rootRenderFunc=D.root,this.compiled=!0},w._getBlocks=function _getBlocks(D){var w={};return j.keys(D).forEach((function(N){"b_"===N.slice(0,2)&&(w[N.slice(2)]=D[N])})),w},Template}(ie);D.exports={Environment:ve,Template:be}},function(D,w,N){"use strict";var F=N(9),k=[],j=[],z=F.makeRequestCallFromTimer((function throwFirstError(){if(j.length)throw j.shift()}));function asap(D){var w;(w=k.length?k.pop():new RawTask).task=D,F(w)}function RawTask(){this.task=null}D.exports=asap,RawTask.prototype.call=function(){try{this.task.call()}catch(D){asap.onerror?asap.onerror(D):(j.push(D),z())}finally{this.task=null,k[k.length]=this}}},function(D,w,N){"use strict";(function(w){function rawAsap(D){F.length||(N(),!0),F[F.length]=D}D.exports=rawAsap;var N,F=[],k=0;function flush(){for(;k<F.length;){var D=k;if(k+=1,F[D].call(),k>1024){for(var w=0,N=F.length-k;w<N;w++)F[w]=F[w+k];F.length-=k,k=0}}F.length=0,k=0,!1}var j=void 0!==w?w:self,z=j.MutationObserver||j.WebKitMutationObserver;function makeRequestCallFromTimer(D){return function requestCall(){var w=setTimeout(handleTimer,0),N=setInterval(handleTimer,50);function handleTimer(){clearTimeout(w),clearInterval(N),D()}}}N="function"==typeof z?function makeRequestCallFromMutationObserver(D){var w=1,N=new z(D),F=document.createTextNode("");return N.observe(F,{characterData:!0}),function requestCall(){w=-w,F.data=w}}(flush):makeRequestCallFromTimer(flush),rawAsap.requestFlush=N,rawAsap.makeRequestCallFromTimer=makeRequestCallFromTimer}).call(w,N(10))},function(D,w){var N;N=function(){return this}();try{N=N||Function("return this")()||(0,eval)("this")}catch(D){"object"==typeof window&&(N=window)}D.exports=N},function(D,F,k){var j;!function(k){"use strict";var executeSync=function(){var D=Array.prototype.slice.call(arguments);"function"==typeof D[0]&&D[0].apply(null,D.splice(1))},executeAsync=function(D){"function"==typeof w?w(D):void 0!==N&&N.nextTick?N.nextTick(D):setTimeout(D,0)},z=Array.isArray||function(D){return"[object Array]"===Object.prototype.toString.call(D)},waterfall=function(D,w,N){var F=N?executeAsync:executeSync;if(w=w||function(){},!z(D)){var k=new Error("First argument to waterfall must be an array of functions");return w(k)}if(!D.length)return w();var wrapIterator=function(D){return function(N){if(N)w.apply(null,arguments),w=function(){};else{var k=Array.prototype.slice.call(arguments,1),j=D.next();j?k.push(wrapIterator(j)):k.push(w),F((function(){D.apply(null,k)}))}}};wrapIterator(function(D){var makeCallback=function(w){var fn=function(){return D.length&&D[w].apply(null,arguments),fn.next()};return fn.next=function(){return w<D.length-1?makeCallback(w+1):null},fn};return makeCallback(0)}(D))()};void 0===(j=function(){return waterfall}.apply(F,[]))||(D.exports=j)}()},function(D,w,N){"use strict";var F=N(1),k=N(2);function normalize(D,w){return null==D||!1===D?w:D}function isNaN(D){return D!=D}function capitalize(D){var w=(D=normalize(D,"")).toLowerCase();return k.copySafeness(D,w.charAt(0).toUpperCase()+w.slice(1))}function list(D){if(F.isString(D))return D.split("");if(F.isObject(D))return F._entries(D||{}).map((function(D){return{key:D[0],value:D[1]}}));if(F.isArray(D))return D;throw new F.TemplateError("list filter: type not iterable")}function trim(D){return k.copySafeness(D,D.replace(/^\s*|\s*$/g,""))}(w=D.exports={}).abs=Math.abs,w.batch=function batch(D,w,N){var F,k=[],j=[];for(F=0;F<D.length;F++)F%w==0&&j.length&&(k.push(j),j=[]),j.push(D[F]);if(j.length){if(N)for(F=j.length;F<w;F++)j.push(N);k.push(j)}return k},w.capitalize=capitalize,w.center=function center(D,w){if(w=w||80,(D=normalize(D,"")).length>=w)return D;var N=w-D.length,j=F.repeat(" ",N/2-N%2),z=F.repeat(" ",N/2);return k.copySafeness(D,j+D+z)},w.default=function default_(D,w,N){return N?D||w:void 0!==D?D:w},w.dictsort=function dictsort(D,w,N){if(!F.isObject(D))throw new F.TemplateError("dictsort filter: val must be an object");var k,j=[];for(var z in D)j.push([z,D[z]]);if(void 0===N||"key"===N)k=0;else{if("value"!==N)throw new F.TemplateError("dictsort filter: You can only sort by either key or value");k=1}return j.sort((function(D,N){var j=D[k],z=N[k];return w||(F.isString(j)&&(j=j.toUpperCase()),F.isString(z)&&(z=z.toUpperCase())),j>z?1:j===z?0:-1})),j},w.dump=function dump(D,w){return JSON.stringify(D,null,w)},w.escape=function escape(D){return D instanceof k.SafeString?D:(D=null==D?"":D,k.markSafe(F.escape(D.toString())))},w.safe=function safe(D){return D instanceof k.SafeString?D:(D=null==D?"":D,k.markSafe(D.toString()))},w.first=function first(D){return D[0]},w.forceescape=function forceescape(D){return D=null==D?"":D,k.markSafe(F.escape(D.toString()))},w.groupby=function groupby(D,w){return F.groupBy(D,w)},w.indent=function indent(D,w,N){if(""===(D=normalize(D,"")))return"";w=w||4;var j=D.split("\n"),z=F.repeat(" ",w),G=j.map((function(D,w){return 0!==w||N?""+z+D+"\n":D+"\n"})).join("");return k.copySafeness(D,G)},w.join=function join(D,w,N){return w=w||"",N&&(D=F.map(D,(function(D){return D[N]}))),D.join(w)},w.last=function last(D){return D[D.length-1]},w.length=function lengthFilter(D){var w=normalize(D,"");return void 0!==w?"function"==typeof Map&&w instanceof Map||"function"==typeof Set&&w instanceof Set?w.size:!F.isObject(w)||w instanceof k.SafeString?w.length:F.keys(w).length:0},w.list=list,w.lower=function lower(D){return(D=normalize(D,"")).toLowerCase()},w.nl2br=function nl2br(D){return null==D?"":k.copySafeness(D,D.replace(/\r\n|\n/g,"<br />\n"))},w.random=function random(D){return D[Math.floor(Math.random()*D.length)]},w.rejectattr=function rejectattr(D,w){return D.filter((function(D){return!D[w]}))},w.selectattr=function selectattr(D,w){return D.filter((function(D){return!!D[w]}))},w.replace=function replace(D,w,N,F){var j=D;if(w instanceof RegExp)return D.replace(w,N);void 0===F&&(F=-1);var z="";if("number"==typeof w)w=""+w;else if("string"!=typeof w)return D;if("number"==typeof D&&(D=""+D),"string"!=typeof D&&!(D instanceof k.SafeString))return D;if(""===w)return z=N+D.split("").join(N)+N,k.copySafeness(D,z);var G=D.indexOf(w);if(0===F||-1===G)return D;for(var H=0,X=0;G>-1&&(-1===F||X<F);)z+=D.substring(H,G)+N,H=G+w.length,X++,G=D.indexOf(w,H);return H<D.length&&(z+=D.substring(H)),k.copySafeness(j,z)},w.reverse=function reverse(D){var w;return(w=F.isString(D)?list(D):F.map(D,(function(D){return D}))).reverse(),F.isString(D)?k.copySafeness(D,w.join("")):w},w.round=function round(D,w,N){w=w||0;var F=Math.pow(10,w);return("ceil"===N?Math.ceil:"floor"===N?Math.floor:Math.round)(D*F)/F},w.slice=function slice(D,w,N){for(var F=Math.floor(D.length/w),k=D.length%w,j=[],z=0,G=0;G<w;G++){var H=z+G*F;G<k&&z++;var X=z+(G+1)*F,q=D.slice(H,X);N&&G>=k&&q.push(N),j.push(q)}return j},w.sum=function sum(D,w,N){return void 0===N&&(N=0),w&&(D=F.map(D,(function(D){return D[w]}))),N+D.reduce((function(D,w){return D+w}),0)},w.sort=k.makeMacro(["value","reverse","case_sensitive","attribute"],[],(function(D,w,N,k){var j=F.map(D,(function(D){return D}));return j.sort((function(D,j){var z=k?D[k]:D,G=k?j[k]:j;return!N&&F.isString(z)&&F.isString(G)&&(z=z.toLowerCase(),G=G.toLowerCase()),z<G?w?1:-1:z>G?w?-1:1:0})),j})),w.string=function string(D){return k.copySafeness(D,D)},w.striptags=function striptags(D,w){var N=trim((D=normalize(D,"")).replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>|<!--[\s\S]*?-->/gi,"")),F="";return F=w?N.replace(/^ +| +$/gm,"").replace(/ +/g," ").replace(/(\r\n)/g,"\n").replace(/\n\n\n+/g,"\n\n"):N.replace(/\s+/gi," "),k.copySafeness(D,F)},w.title=function title(D){var w=(D=normalize(D,"")).split(" ").map((function(D){return capitalize(D)}));return k.copySafeness(D,w.join(" "))},w.trim=trim,w.truncate=function truncate(D,w,N,F){var j=D;if(w=w||255,(D=normalize(D,"")).length<=w)return D;if(N)D=D.substring(0,w);else{var z=D.lastIndexOf(" ",w);-1===z&&(z=w),D=D.substring(0,z)}return D+=null!=F?F:"...",k.copySafeness(j,D)},w.upper=function upper(D){return(D=normalize(D,"")).toUpperCase()},w.urlencode=function urlencode(D){var w=encodeURIComponent;return F.isString(D)?w(D):(F.isArray(D)?D:F._entries(D)).map((function(D){var N=D[0],F=D[1];return w(N)+"="+w(F)})).join("&")};var j=/^(?:\(|<|&lt;)?(.*?)(?:\.|,|\)|\n|&gt;)?$/,z=/^[\w.!#$%&'*+\-\/=?\^`{|}~]+@[a-z\d\-]+(\.[a-z\d\-]+)+$/i,G=/^https?:\/\/.*$/,H=/^www\./,X=/\.(?:org|net|com)(?:\:|\/|$)/;w.urlize=function urlize(D,w,N){isNaN(w)&&(w=1/0);var F=!0===N?' rel="nofollow"':"";return D.split(/(\s+)/).filter((function(D){return D&&D.length})).map((function(D){var N=D.match(j),k=N?N[1]:D,q=k.substr(0,w);return G.test(k)?'<a href="'+k+'"'+F+">"+q+"</a>":H.test(k)?'<a href="http://'+k+'"'+F+">"+q+"</a>":z.test(k)?'<a href="mailto:'+k+'">'+k+"</a>":X.test(k)?'<a href="http://'+k+'"'+F+">"+q+"</a>":D})).join("")},w.wordcount=function wordcount(D){var w=(D=normalize(D,""))?D.match(/\w+/g):null;return w?w.length:null},w.float=function float(D,w){var N=parseFloat(D);return isNaN(N)?w:N},w.int=function int(D,w){var N=parseInt(D,10);return isNaN(N)?w:N},w.d=w.default,w.e=w.escape},function(D,w,N){"use strict";var F,k="object"==typeof Reflect?Reflect:null,j=k&&"function"==typeof k.apply?k.apply:function ReflectApply(D,w,N){return Function.prototype.apply.call(D,w,N)};F=k&&"function"==typeof k.ownKeys?k.ownKeys:Object.getOwnPropertySymbols?function ReflectOwnKeys(D){return Object.getOwnPropertyNames(D).concat(Object.getOwnPropertySymbols(D))}:function ReflectOwnKeys(D){return Object.getOwnPropertyNames(D)};var z=Number.isNaN||function NumberIsNaN(D){return D!=D};function EventEmitter(){EventEmitter.init.call(this)}D.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._eventsCount=0,EventEmitter.prototype._maxListeners=void 0;var G=10;function checkListener(D){if("function"!=typeof D)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof D)}function _getMaxListeners(D){return void 0===D._maxListeners?EventEmitter.defaultMaxListeners:D._maxListeners}function _addListener(D,w,N,F){var k,j,z;if(checkListener(N),void 0===(j=D._events)?(j=D._events=Object.create(null),D._eventsCount=0):(void 0!==j.newListener&&(D.emit("newListener",w,N.listener?N.listener:N),j=D._events),z=j[w]),void 0===z)z=j[w]=N,++D._eventsCount;else if("function"==typeof z?z=j[w]=F?[N,z]:[z,N]:F?z.unshift(N):z.push(N),(k=_getMaxListeners(D))>0&&z.length>k&&!z.warned){z.warned=!0;var G=new Error("Possible EventEmitter memory leak detected. "+z.length+" "+String(w)+" listeners added. Use emitter.setMaxListeners() to increase limit");G.name="MaxListenersExceededWarning",G.emitter=D,G.type=w,G.count=z.length,function ProcessEmitWarning(D){console&&console.warn&&console.warn(D)}(G)}return D}function onceWrapper(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _onceWrap(D,w,N){var F={fired:!1,wrapFn:void 0,target:D,type:w,listener:N},k=onceWrapper.bind(F);return k.listener=N,F.wrapFn=k,k}function _listeners(D,w,N){var F=D._events;if(void 0===F)return[];var k=F[w];return void 0===k?[]:"function"==typeof k?N?[k.listener||k]:[k]:N?function unwrapListeners(D){for(var w=new Array(D.length),N=0;N<w.length;++N)w[N]=D[N].listener||D[N];return w}(k):arrayClone(k,k.length)}function listenerCount(D){var w=this._events;if(void 0!==w){var N=w[D];if("function"==typeof N)return 1;if(void 0!==N)return N.length}return 0}function arrayClone(D,w){for(var N=new Array(w),F=0;F<w;++F)N[F]=D[F];return N}Object.defineProperty(EventEmitter,"defaultMaxListeners",{enumerable:!0,get:function(){return G},set:function(D){if("number"!=typeof D||D<0||z(D))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+D+".");G=D}}),EventEmitter.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},EventEmitter.prototype.setMaxListeners=function setMaxListeners(D){if("number"!=typeof D||D<0||z(D))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+D+".");return this._maxListeners=D,this},EventEmitter.prototype.getMaxListeners=function getMaxListeners(){return _getMaxListeners(this)},EventEmitter.prototype.emit=function emit(D){for(var w=[],N=1;N<arguments.length;N++)w.push(arguments[N]);var F="error"===D,k=this._events;if(void 0!==k)F=F&&void 0===k.error;else if(!F)return!1;if(F){var z;if(w.length>0&&(z=w[0]),z instanceof Error)throw z;var G=new Error("Unhandled error."+(z?" ("+z.message+")":""));throw G.context=z,G}var H=k[D];if(void 0===H)return!1;if("function"==typeof H)j(H,this,w);else{var X=H.length,q=arrayClone(H,X);for(N=0;N<X;++N)j(q[N],this,w)}return!0},EventEmitter.prototype.addListener=function addListener(D,w){return _addListener(this,D,w,!1)},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.prependListener=function prependListener(D,w){return _addListener(this,D,w,!0)},EventEmitter.prototype.once=function once(D,w){return checkListener(w),this.on(D,_onceWrap(this,D,w)),this},EventEmitter.prototype.prependOnceListener=function prependOnceListener(D,w){return checkListener(w),this.prependListener(D,_onceWrap(this,D,w)),this},EventEmitter.prototype.removeListener=function removeListener(D,w){var N,F,k,j,z;if(checkListener(w),void 0===(F=this._events))return this;if(void 0===(N=F[D]))return this;if(N===w||N.listener===w)0==--this._eventsCount?this._events=Object.create(null):(delete F[D],F.removeListener&&this.emit("removeListener",D,N.listener||w));else if("function"!=typeof N){for(k=-1,j=N.length-1;j>=0;j--)if(N[j]===w||N[j].listener===w){z=N[j].listener,k=j;break}if(k<0)return this;0===k?N.shift():function spliceOne(D,w){for(;w+1<D.length;w++)D[w]=D[w+1];D.pop()}(N,k),1===N.length&&(F[D]=N[0]),void 0!==F.removeListener&&this.emit("removeListener",D,z||w)}return this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.removeAllListeners=function removeAllListeners(D){var w,N,F;if(void 0===(N=this._events))return this;if(void 0===N.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==N[D]&&(0==--this._eventsCount?this._events=Object.create(null):delete N[D]),this;if(0===arguments.length){var k,j=Object.keys(N);for(F=0;F<j.length;++F)"removeListener"!==(k=j[F])&&this.removeAllListeners(k);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(w=N[D]))this.removeListener(D,w);else if(void 0!==w)for(F=w.length-1;F>=0;F--)this.removeListener(D,w[F]);return this},EventEmitter.prototype.listeners=function listeners(D){return _listeners(this,D,!0)},EventEmitter.prototype.rawListeners=function rawListeners(D){return _listeners(this,D,!1)},EventEmitter.listenerCount=function(D,w){return"function"==typeof D.listenerCount?D.listenerCount(w):listenerCount.call(D,w)},EventEmitter.prototype.listenerCount=listenerCount,EventEmitter.prototype.eventNames=function eventNames(){return this._eventsCount>0?F(this._events):[]}},function(D,w,N){"use strict";var F=N(2).SafeString;w.callable=function callable(D){return"function"==typeof D},w.defined=function defined(D){return void 0!==D},w.divisibleby=function divisibleby(D,w){return D%w==0},w.escaped=function escaped(D){return D instanceof F},w.equalto=function equalto(D,w){return D===w},w.eq=w.equalto,w.sameas=w.equalto,w.even=function even(D){return D%2==0},w.falsy=function falsy(D){return!D},w.ge=function ge(D,w){return D>=w},w.greaterthan=function greaterthan(D,w){return D>w},w.gt=w.greaterthan,w.le=function le(D,w){return D<=w},w.lessthan=function lessthan(D,w){return D<w},w.lt=w.lessthan,w.lower=function lower(D){return D.toLowerCase()===D},w.ne=function ne(D,w){return D!==w},w.null=function nullTest(D){return null===D},w.number=function number(D){return"number"==typeof D},w.odd=function odd(D){return D%2==1},w.string=function string(D){return"string"==typeof D},w.truthy=function truthy(D){return!!D},w.undefined=function undefinedTest(D){return void 0===D},w.upper=function upper(D){return D.toUpperCase()===D},w.iterable=function iterable(D){return"undefined"!=typeof Symbol?!!D[Symbol.iterator]:Array.isArray(D)||"string"==typeof D},w.mapping=function mapping(D){var w=null!=D&&"object"==typeof D&&!Array.isArray(D);return Set?w&&!(D instanceof Set):w}},function(D,w,N){"use strict";function _cycler(D){var w=-1;return{current:null,reset:function reset(){w=-1,this.current=null},next:function next(){return++w>=D.length&&(w=0),this.current=D[w],this.current}}}D.exports=function globals(){return{range:function range(D,w,N){void 0===w?(w=D,D=0,N=1):N||(N=1);var F=[];if(N>0)for(var k=D;k<w;k+=N)F.push(k);else for(var j=D;j>w;j+=N)F.push(j);return F},cycler:function cycler(){return _cycler(Array.prototype.slice.call(arguments))},joiner:function joiner(D){return function _joiner(D){D=D||",";var w=!0;return function(){var N=w?"":D;return w=!1,N}}(D)}}}},function(D,w,N){var F=N(0);D.exports=function express(D,w){function NunjucksView(D,w){if(this.name=D,this.path=D,this.defaultEngine=w.defaultEngine,this.ext=F.extname(D),!this.ext&&!this.defaultEngine)throw new Error("No default engine was specified and no extension was provided.");this.ext||(this.name+=this.ext=("."!==this.defaultEngine[0]?".":"")+this.defaultEngine)}return NunjucksView.prototype.render=function render(w,N){D.render(this.name,w,N)},w.set("view",NunjucksView),w.set("nunjucksEnv",D),D}},function(D,w,N){D.exports=function installCompat(){"use strict";var D,w,N=this.runtime,F=this.lib,k=this.compiler.Compiler,j=this.parser.Parser,z=(this.nodes,this.lexer,N.contextOrFrameLookup),G=N.memberLookup;function sliceLookup(D,w,F,k){D=D||[],null===w&&(w=k<0?D.length-1:0),null===F?F=k<0?-1:D.length:F<0&&(F+=D.length),w<0&&(w+=D.length);for(var j=[],z=w;!(z<0||z>D.length)&&!(k>0&&z>=F)&&!(k<0&&z<=F);z+=k)j.push(N.memberLookup(D,z));return j}function hasOwnProp(D,w){return Object.prototype.hasOwnProperty.call(D,w)}k&&(D=k.prototype.assertType),j&&(w=j.prototype.parseAggregate),N.contextOrFrameLookup=function contextOrFrameLookup(D,w,N){var F=z.apply(this,arguments);if(void 0!==F)return F;switch(N){case"True":return!0;case"False":return!1;case"None":return null;default:return}};var H={pop:function pop(D){if(void 0===D)return this.pop();if(D>=this.length||D<0)throw new Error("KeyError");return this.splice(D,1)},append:function append(D){return this.push(D)},remove:function remove(D){for(var w=0;w<this.length;w++)if(this[w]===D)return this.splice(w,1);throw new Error("ValueError")},count:function count(D){for(var count=0,w=0;w<this.length;w++)this[w]===D&&count++;return count},index:function index(D){var w;if(-1===(w=this.indexOf(D)))throw new Error("ValueError");return w},find:function find(D){return this.indexOf(D)},insert:function insert(D,w){return this.splice(D,0,w)}},X={items:function items(){return F._entries(this)},values:function values(){return F._values(this)},keys:function keys(){return F.keys(this)},get:function get(D,w){var N=this[D];return void 0===N&&(N=w),N},has_key:function has_key(D){return hasOwnProp(this,D)},pop:function pop(D,w){var N=this[D];if(void 0===N&&void 0!==w)N=w;else{if(void 0===N)throw new Error("KeyError");delete this[D]}return N},popitem:function popitem(){var D=F.keys(this);if(!D.length)throw new Error("KeyError");var w=D[0],N=this[w];return delete this[w],[w,N]},setdefault:function setdefault(D,w){return void 0===w&&(w=null),D in this||(this[D]=w),this[D]},update:function update(D){return F._assign(this,D),null}};return X.iteritems=X.items,X.itervalues=X.values,X.iterkeys=X.keys,N.memberLookup=function memberLookup(D,w,N){return 4===arguments.length?sliceLookup.apply(this,arguments):(D=D||{},F.isArray(D)&&hasOwnProp(H,w)?H[w].bind(D):F.isObject(D)&&hasOwnProp(X,w)?X[w].bind(D):G.apply(this,arguments))},function uninstall(){N.contextOrFrameLookup=z,N.memberLookup=G,k&&(k.prototype.assertType=D),j&&(j.prototype.parseAggregate=w)}}}])}))}).call(this,N(19).setImmediate,N(7))},function(D,w){D.exports=function(D,w,N,F){var k=N.root;N.root=function(D,w,N,j,z,G){var H=D.getTemplate;D.getTemplate=function(D,w,k,j,z){"function"==typeof w&&(z=w=!1);var _require=function(D){try{return F[D]}catch(w){if(N.get("_require"))return N.get("_require")(D);console.warn('Could not load template "%s"',D)}},G=_require(D);N.set("_require",_require),w&&G.compile(),z(null,G)},k(D,w,N,j,z,(function(w,N){D.getTemplate=H,G(w,N)}))};var j={obj:N,type:"code"};return new D.Template(j,w)}},,,function(D,w,N){"use strict";const{TARGET:F,UNSUBSCRIBE:k}=N(27),j=N(190),z=N(28),G=N(29),isSameDescriptor=(D,w)=>void 0!==D&&void 0!==w&&Object.is(D.value,w.value)&&(D.writable||!1)===(w.writable||!1)&&(D.enumerable||!1)===(w.enumerable||!1)&&(D.configurable||!1)===(w.configurable||!1),shallowClone=D=>z(D)?D.slice():{...D},onChange=(D,w,N={})=>{const H=Symbol("ProxyTarget");let X,q,Z=!1,J=!1,$=!1;const te=N.equals||Object.is;let ie=new WeakMap,oe=new WeakMap,ce=new WeakMap;const handleChange=(D,N,F,k)=>{if(!$)if(Z){if(Z&&q&&void 0!==F&&void 0!==k&&"length"!==N){let w=q;D!==X&&(D=j.after(D,X),j.walk(D,D=>{w[D]=shallowClone(w[D]),w=w[D]})),w[N]=F}J=!0}else w(j.concat(D,N),k,F)},getOwnPropertyDescriptor=(D,w)=>{let N=null!==ie&&ie.get(D);if(N&&(N=N.get(w)),N)return N;N=new Map,ie.set(D,N);let F=N.get(w);return F||(F=Reflect.getOwnPropertyDescriptor(D,w),N.set(w,F)),F},invalidateCachedDescriptor=(D,w)=>{const N=ie?ie.get(D):void 0;N&&N.delete(w)},buildProxy=(D,w)=>{if($)return D;oe.set(D,w);let N=ce.get(D);return void 0===N&&(N=new Proxy(D,he),ce.set(D,N)),N},ignoreProperty=D=>$||!0===N.ignoreSymbols&&G(D)||!0===N.ignoreUnderscores&&"_"===D.charAt(0)||void 0!==N.ignoreKeys&&N.ignoreKeys.includes(D),he={get(D,w,z){if(w===H||w===F)return D;if(w===k&&null!==oe&&""===oe.get(D))return(D=>($=!0,ie=null,oe=null,ce=null,D))(D);const G=Reflect.get(D,w,z);if((D=>null===D||"object"!=typeof D&&"function"!=typeof D)(G)||(D=>D instanceof RegExp||D instanceof Number)(G)||"constructor"===w||!0===N.isShallow||ignoreProperty(w))return G;const X=getOwnPropertyDescriptor(D,w);if(X&&!X.configurable){if(X.set&&!X.get)return;if(!1===X.writable)return G}return buildProxy(G,j.concat(oe.get(D),w))},set(D,w,N,F){N&&void 0!==N[H]&&(N=N[H]);const k=ignoreProperty(w),j=k?null:Reflect.get(D,w,F);let z=!0;return(!(w in D)||!te(j,N))&&(z=Reflect.set(D[H]||D,w,N),!k&&z&&handleChange(oe.get(D),w,j,N)),z},defineProperty(D,w,N){let F=!0;return isSameDescriptor(N,getOwnPropertyDescriptor(D,w))||(F=Reflect.defineProperty(D,w,N),!F||ignoreProperty(w)||isSameDescriptor()||(invalidateCachedDescriptor(D,w),handleChange(oe.get(D),w,void 0,N.value))),F},deleteProperty(D,w){if(!Reflect.has(D,w))return!0;const N=ignoreProperty(w),F=N?null:Reflect.get(D,w),k=Reflect.deleteProperty(D,w);return!N&&k&&(invalidateCachedDescriptor(D,w),handleChange(oe.get(D),w,F)),k},apply(D,w,N){const F=w instanceof Date;if(F&&(w=w[H]),!Z){Z=!0,F&&(q=w.valueOf()),(z(w)||"[object Object]"===toString.call(w))&&(q=shallowClone(w[H])),X=j.initial(oe.get(D));const k=Reflect.apply(D,w,N);return Z=!1,(J||F&&!te(q,w.valueOf()))&&(handleChange(X,"",q,w[H]||w),q=null,J=!1),k}return Reflect.apply(D,w,N)}},fe=buildProxy(D,!0===N.pathAsArray?[]:"");return w=w.bind(fe),fe};onChange.target=D=>D[F]||D,onChange.unsubscribe=D=>D[k]||D,D.exports=onChange},,,,,,function(D,w,N){(function(D){var F=void 0!==D&&D||"undefined"!=typeof self&&self||window,k=Function.prototype.apply;function Timeout(D,w){this._id=D,this._clearFn=w}w.setTimeout=function(){return new Timeout(k.call(setTimeout,F,arguments),clearTimeout)},w.setInterval=function(){return new Timeout(k.call(setInterval,F,arguments),clearInterval)},w.clearTimeout=w.clearInterval=function(D){D&&D.close()},Timeout.prototype.unref=Timeout.prototype.ref=function(){},Timeout.prototype.close=function(){this._clearFn.call(F,this._id)},w.enroll=function(D,w){clearTimeout(D._idleTimeoutId),D._idleTimeout=w},w.unenroll=function(D){clearTimeout(D._idleTimeoutId),D._idleTimeout=-1},w._unrefActive=w.active=function(D){clearTimeout(D._idleTimeoutId);var w=D._idleTimeout;w>=0&&(D._idleTimeoutId=setTimeout((function onTimeout(){D._onTimeout&&D._onTimeout()}),w))},N(187),w.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==D&&D.setImmediate||this&&this.setImmediate,w.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==D&&D.clearImmediate||this&&this.clearImmediate}).call(this,N(6))},,,,,,function(D,w,N){(function(w,N){!function webpackUniversalModuleDefinition(w,N){D.exports=N()}("undefined"!=typeof self&&self,(function(){return function(D){var w={};function __webpack_require__(N){if(w[N])return w[N].exports;var F=w[N]={i:N,l:!1,exports:{}};return D[N].call(F.exports,F,F.exports,__webpack_require__),F.l=!0,F.exports}return __webpack_require__.m=D,__webpack_require__.c=w,__webpack_require__.d=function(D,w,N){__webpack_require__.o(D,w)||Object.defineProperty(D,w,{configurable:!1,enumerable:!0,get:N})},__webpack_require__.n=function(D){var w=D&&D.__esModule?function getDefault(){return D.default}:function getModuleExports(){return D};return __webpack_require__.d(w,"a",w),w},__webpack_require__.o=function(D,w){return Object.prototype.hasOwnProperty.call(D,w)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=11)}([function(D,w,N){"use strict";var F=Array.prototype,k=Object.prototype,j={"&":"&amp;",'"':"&quot;","'":"&#39;","<":"&lt;",">":"&gt;"},z=/[&"'<>]/g;function hasOwnProp(D,w){return k.hasOwnProperty.call(D,w)}function lookupEscape(D){return j[D]}function TemplateError(D,w,N){var F,k,j;if(D instanceof Error&&(D=(k=D).name+": "+k.message),Object.setPrototypeOf?(F=new Error(D),Object.setPrototypeOf(F,TemplateError.prototype)):(F=this,Object.defineProperty(F,"message",{enumerable:!1,writable:!0,value:D})),Object.defineProperty(F,"name",{value:"Template render error"}),Error.captureStackTrace&&Error.captureStackTrace(F,this.constructor),k){var z=Object.getOwnPropertyDescriptor(k,"stack");(j=z&&(z.get||function(){return z.value}))||(j=function getStack(){return k.stack})}else{var G=new Error(D).stack;j=function getStack(){return G}}return Object.defineProperty(F,"stack",{get:function get(){return j.call(F)}}),Object.defineProperty(F,"cause",{value:k}),F.lineno=w,F.colno=N,F.firstUpdate=!0,F.Update=function Update(D){var w="("+(D||"unknown path")+")";return this.firstUpdate&&(this.lineno&&this.colno?w+=" [Line "+this.lineno+", Column "+this.colno+"]":this.lineno&&(w+=" [Line "+this.lineno+"]")),w+="\n ",this.firstUpdate&&(w+=" "),this.message=w+(this.message||""),this.firstUpdate=!1,this},F}function isFunction(D){return"[object Function]"===k.toString.call(D)}function isArray(D){return"[object Array]"===k.toString.call(D)}function isString(D){return"[object String]"===k.toString.call(D)}function isObject(D){return"[object Object]"===k.toString.call(D)}function toArray(D){return Array.prototype.slice.call(D)}function indexOf(D,w,N){return Array.prototype.indexOf.call(D||[],w,N)}function keys_(D){var w=[];for(var N in D)hasOwnProp(D,N)&&w.push(N);return w}(w=D.exports={}).hasOwnProp=hasOwnProp,w._prettifyError=function _prettifyError(D,N,F){if(F.Update||(F=new w.TemplateError(F)),F.Update(D),!N){var k=F;(F=new Error(k.message)).name=k.name}return F},Object.setPrototypeOf?Object.setPrototypeOf(TemplateError.prototype,Error.prototype):TemplateError.prototype=Object.create(Error.prototype,{constructor:{value:TemplateError}}),w.TemplateError=TemplateError,w.escape=function escape(D){return D.replace(z,lookupEscape)},w.isFunction=isFunction,w.isArray=isArray,w.isString=isString,w.isObject=isObject,w.groupBy=function groupBy(D,w){for(var N={},F=isFunction(w)?w:function(D){return D[w]},k=0;k<D.length;k++){var j=D[k],z=F(j,k);(N[z]||(N[z]=[])).push(j)}return N},w.toArray=toArray,w.without=function without(D){var w=[];if(!D)return w;for(var N=D.length,F=toArray(arguments).slice(1),k=-1;++k<N;)-1===indexOf(F,D[k])&&w.push(D[k]);return w},w.repeat=function repeat(D,w){for(var N="",F=0;F<w;F++)N+=D;return N},w.each=function each(D,w,N){if(null!=D)if(F.forEach&&D.forEach===F.forEach)D.forEach(w,N);else if(D.length===+D.length)for(var k=0,j=D.length;k<j;k++)w.call(N,D[k],k,D)},w.map=function map(D,w){var N=[];if(null==D)return N;if(F.map&&D.map===F.map)return D.map(w);for(var k=0;k<D.length;k++)N[N.length]=w(D[k],k);return D.length===+D.length&&(N.length=D.length),N},w.asyncIter=function asyncIter(D,w,N){var F=-1;!function next(){++F<D.length?w(D[F],F,next,N):N()}()},w.asyncFor=function asyncFor(D,w,N){var F=keys_(D||{}),k=F.length,j=-1;!function next(){j++;var z=F[j];j<k?w(z,D[z],j,k,next):N()}()},w.indexOf=indexOf,w.keys=keys_,w._entries=function _entries(D){return keys_(D).map((function(w){return[w,D[w]]}))},w._values=function _values(D){return keys_(D).map((function(w){return D[w]}))},w._assign=w.extend=function extend(D,w){return D=D||{},keys_(w).forEach((function(N){D[N]=w[N]})),D},w.inOperator=function inOperator(D,w){if(isArray(w)||isString(w))return-1!==w.indexOf(D);if(isObject(w))return D in w;throw new Error('Cannot use "in" operator to search for "'+D+'" in unexpected types.')}},function(D,w,N){"use strict";function _defineProperties(D,w){for(var N=0;N<w.length;N++){var F=w[N];F.enumerable=F.enumerable||!1,F.configurable=!0,"value"in F&&(F.writable=!0),Object.defineProperty(D,F.key,F)}}function _createClass(D,w,N){return w&&_defineProperties(D.prototype,w),N&&_defineProperties(D,N),D}function _inheritsLoose(D,w){D.prototype=Object.create(w.prototype),D.prototype.constructor=D,D.__proto__=w}var F=N(16),k=N(0);function extendClass(D,w,N){N=N||{},k.keys(N).forEach((function(w){N[w]=function parentWrap(D,w){return"function"!=typeof D||"function"!=typeof w?w:function wrap(){var N=this.parent;this.parent=D;var F=w.apply(this,arguments);return this.parent=N,F}}(D.prototype[w],N[w])}));var F=function(D){function subclass(){return D.apply(this,arguments)||this}return _inheritsLoose(subclass,D),_createClass(subclass,[{key:"typename",get:function get(){return w}}]),subclass}(D);return k._assign(F.prototype,N),F}var j=function(){function Obj(){this.init.apply(this,arguments)}return Obj.prototype.init=function init(){},Obj.extend=function extend(D,w){return"object"==typeof D&&(w=D,D="anonymous"),extendClass(this,D,w)},_createClass(Obj,[{key:"typename",get:function get(){return this.constructor.name}}]),Obj}(),z=function(D){function EmitterObj(){var w,N;return(w=N=D.call(this)||this).init.apply(w,arguments),N}return _inheritsLoose(EmitterObj,D),EmitterObj.prototype.init=function init(){},EmitterObj.extend=function extend(D,w){return"object"==typeof D&&(w=D,D="anonymous"),extendClass(this,D,w)},_createClass(EmitterObj,[{key:"typename",get:function get(){return this.constructor.name}}]),EmitterObj}(F);D.exports={Obj:j,EmitterObj:z}},function(D,w,N){"use strict";var F=N(0),k=Array.from,j="function"==typeof Symbol&&Symbol.iterator&&"function"==typeof k,z=function(){function Frame(D,w){this.variables={},this.parent=D,this.topLevel=!1,this.isolateWrites=w}var D=Frame.prototype;return D.set=function set(D,w,N){var F=D.split("."),k=this.variables,j=this;if(N&&(j=this.resolve(F[0],!0)))j.set(D,w);else{for(var z=0;z<F.length-1;z++){var G=F[z];k[G]||(k[G]={}),k=k[G]}k[F[F.length-1]]=w}},D.get=function get(D){var w=this.variables[D];return void 0!==w?w:null},D.lookup=function lookup(D){var w=this.parent,N=this.variables[D];return void 0!==N?N:w&&w.lookup(D)},D.resolve=function resolve(D,w){var N=w&&this.isolateWrites?void 0:this.parent;return void 0!==this.variables[D]?this:N&&N.resolve(D)},D.push=function push(D){return new Frame(this,D)},D.pop=function pop(){return this.parent},Frame}();function isKeywordArgs(D){return D&&Object.prototype.hasOwnProperty.call(D,"__keywords")}function getKeywordArgs(D){var w=D.length;if(w){var N=D[w-1];if(isKeywordArgs(N))return N}return{}}function numArgs(D){var w=D.length;return 0===w?0:isKeywordArgs(D[w-1])?w-1:w}function SafeString(D){if("string"!=typeof D)return D;this.val=D,this.length=D.length}SafeString.prototype=Object.create(String.prototype,{length:{writable:!0,configurable:!0,value:0}}),SafeString.prototype.valueOf=function valueOf(){return this.val},SafeString.prototype.toString=function toString(){return this.val},D.exports={Frame:z,makeMacro:function makeMacro(D,w,N){var F=this;return function(){for(var k=arguments.length,j=new Array(k),z=0;z<k;z++)j[z]=arguments[z];var G,H=numArgs(j),X=getKeywordArgs(j);if(H>D.length)G=j.slice(0,D.length),j.slice(G.length,H).forEach((function(D,N){N<w.length&&(X[w[N]]=D)})),G.push(X);else if(H<D.length){G=j.slice(0,H);for(var q=H;q<D.length;q++){var Z=D[q];G.push(X[Z]),delete X[Z]}G.push(X)}else G=j;return N.apply(F,G)}},makeKeywordArgs:function makeKeywordArgs(D){return D.__keywords=!0,D},numArgs,suppressValue:function suppressValue(D,w){return D=null!=D?D:"",!w||D instanceof SafeString||(D=F.escape(D.toString())),D},ensureDefined:function ensureDefined(D,w,N){if(null==D)throw new F.TemplateError("attempted to output null or undefined value",w+1,N+1);return D},memberLookup:function memberLookup(D,w){if(null!=D)return"function"==typeof D[w]?function(){for(var N=arguments.length,F=new Array(N),k=0;k<N;k++)F[k]=arguments[k];return D[w].apply(D,F)}:D[w]},contextOrFrameLookup:function contextOrFrameLookup(D,w,N){var F=w.lookup(N);return void 0!==F?F:D.lookup(N)},callWrap:function callWrap(D,w,N,F){if(!D)throw new Error("Unable to call `"+w+"`, which is undefined or falsey");if("function"!=typeof D)throw new Error("Unable to call `"+w+"`, which is not a function");return D.apply(N,F)},handleError:function handleError(D,w,N){return D.lineno?D:new F.TemplateError(D,w,N)},isArray:F.isArray,keys:F.keys,SafeString,copySafeness:function copySafeness(D,w){return D instanceof SafeString?new SafeString(w):w.toString()},markSafe:function markSafe(D){var w=typeof D;return"string"===w?new SafeString(D):"function"!==w?D:function wrapSafe(w){var N=D.apply(this,arguments);return"string"==typeof N?new SafeString(N):N}},asyncEach:function asyncEach(D,w,N,k){if(F.isArray(D)){var j=D.length;F.asyncIter(D,(function iterCallback(D,F,k){switch(w){case 1:N(D,F,j,k);break;case 2:N(D[0],D[1],F,j,k);break;case 3:N(D[0],D[1],D[2],F,j,k);break;default:D.push(F,j,k),N.apply(this,D)}}),k)}else F.asyncFor(D,(function iterCallback(D,w,F,k,j){N(D,w,F,k,j)}),k)},asyncAll:function asyncAll(D,w,N,k){var j,z,G=0;function done(D,w){G++,z[D]=w,G===j&&k(null,z.join(""))}if(F.isArray(D))if(j=D.length,z=new Array(j),0===j)k(null,"");else for(var H=0;H<D.length;H++){var X=D[H];switch(w){case 1:N(X,H,j,done);break;case 2:N(X[0],X[1],H,j,done);break;case 3:N(X[0],X[1],X[2],H,j,done);break;default:X.push(H,j,done),N.apply(this,X)}}else{var q=F.keys(D||{});if(j=q.length,z=new Array(j),0===j)k(null,"");else for(var Z=0;Z<q.length;Z++){var J=q[Z];N(J,D[J],Z,j,done)}}},inOperator:F.inOperator,fromIterator:function fromIterator(D){return"object"!=typeof D||null===D||F.isArray(D)?D:j&&Symbol.iterator in D?k(D):D}}},function(D,N,F){"use strict";function _defineProperties(D,w){for(var N=0;N<w.length;N++){var F=w[N];F.enumerable=F.enumerable||!1,F.configurable=!0,"value"in F&&(F.writable=!0),Object.defineProperty(D,F.key,F)}}function _createClass(D,w,N){return w&&_defineProperties(D.prototype,w),N&&_defineProperties(D,N),D}function _inheritsLoose(D,w){D.prototype=Object.create(w.prototype),D.prototype.constructor=D,D.__proto__=w}function traverseAndCheck(D,w,N){D instanceof w&&N.push(D),D instanceof k&&D.findAll(w,N)}var k=function(D){function Node(){return D.apply(this,arguments)||this}_inheritsLoose(Node,D);var w=Node.prototype;return w.init=function init(D,w){for(var N=arguments,F=this,k=arguments.length,j=new Array(k>2?k-2:0),z=2;z<k;z++)j[z-2]=arguments[z];this.lineno=D,this.colno=w,this.fields.forEach((function(D,w){var k=N[w+2];void 0===k&&(k=null),F[D]=k}))},w.findAll=function findAll(D,w){var N=this;return w=w||[],this instanceof z?this.children.forEach((function(N){return traverseAndCheck(N,D,w)})):this.fields.forEach((function(F){return traverseAndCheck(N[F],D,w)})),w},w.iterFields=function iterFields(D){var w=this;this.fields.forEach((function(N){D(w[N],N)}))},Node}(F(1).Obj),j=function(D){function Value(){return D.apply(this,arguments)||this}return _inheritsLoose(Value,D),_createClass(Value,[{key:"typename",get:function get(){return"Value"}},{key:"fields",get:function get(){return["value"]}}]),Value}(k),z=function(D){function NodeList(){return D.apply(this,arguments)||this}_inheritsLoose(NodeList,D);var w=NodeList.prototype;return w.init=function init(w,N,F){D.prototype.init.call(this,w,N,F||[])},w.addChild=function addChild(D){this.children.push(D)},_createClass(NodeList,[{key:"typename",get:function get(){return"NodeList"}},{key:"fields",get:function get(){return["children"]}}]),NodeList}(k),G=z.extend("Root"),H=j.extend("Literal"),X=j.extend("Symbol"),q=z.extend("Group"),Z=z.extend("Array"),J=k.extend("Pair",{fields:["key","value"]}),$=z.extend("Dict"),te=k.extend("LookupVal",{fields:["target","val"]}),ie=k.extend("If",{fields:["cond","body","else_"]}),oe=ie.extend("IfAsync"),ce=k.extend("InlineIf",{fields:["cond","body","else_"]}),he=k.extend("For",{fields:["arr","name","body","else_"]}),fe=he.extend("AsyncEach"),pe=he.extend("AsyncAll"),_e=k.extend("Macro",{fields:["name","args","body"]}),ve=_e.extend("Caller"),ye=k.extend("Import",{fields:["template","target","withContext"]}),be=function(D){function FromImport(){return D.apply(this,arguments)||this}return _inheritsLoose(FromImport,D),FromImport.prototype.init=function init(w,N,F,k,j){D.prototype.init.call(this,w,N,F,k||new z,j)},_createClass(FromImport,[{key:"typename",get:function get(){return"FromImport"}},{key:"fields",get:function get(){return["template","names","withContext"]}}]),FromImport}(k),Te=k.extend("FunCall",{fields:["name","args"]}),Ee=Te.extend("Filter"),Se=Ee.extend("FilterAsync",{fields:["name","args","symbol"]}),Me=$.extend("KeywordArgs"),xe=k.extend("Block",{fields:["name","body"]}),Ae=k.extend("Super",{fields:["blockName","symbol"]}),Pe=k.extend("TemplateRef",{fields:["template"]}).extend("Extends"),Oe=k.extend("Include",{fields:["template","ignoreMissing"]}),Re=k.extend("Set",{fields:["targets","value"]}),De=k.extend("Switch",{fields:["expr","cases","default"]}),Ie=k.extend("Case",{fields:["cond","body"]}),Le=z.extend("Output"),we=k.extend("Capture",{fields:["body"]}),Ne=H.extend("TemplateData"),Fe=k.extend("UnaryOp",{fields:["target"]}),Be=k.extend("BinOp",{fields:["left","right"]}),Ue=Be.extend("In"),Ve=Be.extend("Is"),ze=Be.extend("Or"),Ge=Be.extend("And"),Ye=Fe.extend("Not"),He=Be.extend("Add"),We=Be.extend("Concat"),Xe=Be.extend("Sub"),Ke=Be.extend("Mul"),Qe=Be.extend("Div"),Ze=Be.extend("FloorDiv"),Je=Be.extend("Mod"),$e=Be.extend("Pow"),et=Fe.extend("Neg"),tt=Fe.extend("Pos"),rt=k.extend("Compare",{fields:["expr","ops"]}),ot=k.extend("CompareOperand",{fields:["expr","type"]}),at=k.extend("CallExtension",{init:function init(D,w,N,F){this.parent(),this.extName=D.__name||D,this.prop=w,this.args=N||new z,this.contentArgs=F||[],this.autoescape=D.autoescape},fields:["extName","prop","args","contentArgs"]}),st=at.extend("CallExtensionAsync");function print(D,N,F){var k=D.split("\n");k.forEach((function(D,j){D&&(F&&j>0||!F)&&w.stdout.write(" ".repeat(N));var z=j===k.length-1?"":"\n";w.stdout.write(""+D+z)}))}D.exports={Node:k,Root:G,NodeList:z,Value:j,Literal:H,Symbol:X,Group:q,Array:Z,Pair:J,Dict:$,Output:Le,Capture:we,TemplateData:Ne,If:ie,IfAsync:oe,InlineIf:ce,For:he,AsyncEach:fe,AsyncAll:pe,Macro:_e,Caller:ve,Import:ye,FromImport:be,FunCall:Te,Filter:Ee,FilterAsync:Se,KeywordArgs:Me,Block:xe,Super:Ae,Extends:Pe,Include:Oe,Set:Re,Switch:De,Case:Ie,LookupVal:te,BinOp:Be,In:Ue,Is:Ve,Or:ze,And:Ge,Not:Ye,Add:He,Concat:We,Sub:Xe,Mul:Ke,Div:Qe,FloorDiv:Ze,Mod:Je,Pow:$e,Neg:et,Pos:tt,Compare:rt,CompareOperand:ot,CallExtension:at,CallExtensionAsync:st,printNodes:function printNodes(D,w){if(w=w||0,print(D.typename+": ",w),D instanceof z)print("\n"),D.children.forEach((function(D){printNodes(D,w+2)}));else if(D instanceof at)print(D.extName+"."+D.prop+"\n"),D.args&&printNodes(D.args,w+2),D.contentArgs&&D.contentArgs.forEach((function(D){printNodes(D,w+2)}));else{var N=[],F=null;D.iterFields((function(D,w){D instanceof k?N.push([w,D]):(F=F||{})[w]=D})),F?print(JSON.stringify(F,null,2)+"\n",null,!0):print("\n"),N.forEach((function(D){var N=D[0],F=D[1];print("["+N+"] =>",w+2),printNodes(F,w+4)}))}}}},function(D,w){},function(D,w,N){"use strict";var F=N(8),k=N(17),j=N(3),z=N(0).TemplateError,G=N(2).Frame,H=N(1).Obj,X={"==":"==","===":"===","!=":"!=","!==":"!==","<":"<",">":">","<=":"<=",">=":">="},q=function(D){function Compiler(){return D.apply(this,arguments)||this}!function _inheritsLoose(D,w){D.prototype=Object.create(w.prototype),D.prototype.constructor=D,D.__proto__=w}(Compiler,D);var w=Compiler.prototype;return w.init=function init(D,w){this.templateName=D,this.codebuf=[],this.lastId=0,this.buffer=null,this.bufferStack=[],this._scopeClosers="",this.inBlock=!1,this.throwOnUndefined=w},w.fail=function fail(D,w,N){throw void 0!==w&&(w+=1),void 0!==N&&(N+=1),new z(D,w,N)},w._pushBuffer=function _pushBuffer(){var D=this._tmpid();return this.bufferStack.push(this.buffer),this.buffer=D,this._emit("var "+this.buffer+' = "";'),D},w._popBuffer=function _popBuffer(){this.buffer=this.bufferStack.pop()},w._emit=function _emit(D){this.codebuf.push(D)},w._emitLine=function _emitLine(D){this._emit(D+"\n")},w._emitLines=function _emitLines(){for(var D=this,w=arguments.length,N=new Array(w),F=0;F<w;F++)N[F]=arguments[F];N.forEach((function(w){return D._emitLine(w)}))},w._emitFuncBegin=function _emitFuncBegin(D,w){this.buffer="output",this._scopeClosers="",this._emitLine("function "+w+"(env, context, frame, runtime, cb) {"),this._emitLine("var lineno = "+D.lineno+";"),this._emitLine("var colno = "+D.colno+";"),this._emitLine("var "+this.buffer+' = "";'),this._emitLine("try {")},w._emitFuncEnd=function _emitFuncEnd(D){D||this._emitLine("cb(null, "+this.buffer+");"),this._closeScopeLevels(),this._emitLine("} catch (e) {"),this._emitLine("  cb(runtime.handleError(e, lineno, colno));"),this._emitLine("}"),this._emitLine("}"),this.buffer=null},w._addScopeLevel=function _addScopeLevel(){this._scopeClosers+="})"},w._closeScopeLevels=function _closeScopeLevels(){this._emitLine(this._scopeClosers+";"),this._scopeClosers=""},w._withScopedSyntax=function _withScopedSyntax(D){var w=this._scopeClosers;this._scopeClosers="",D.call(this),this._closeScopeLevels(),this._scopeClosers=w},w._makeCallback=function _makeCallback(D){var w=this._tmpid();return"function("+w+(D?","+D:"")+") {\nif("+w+") { cb("+w+"); return; }"},w._tmpid=function _tmpid(){return this.lastId++,"t_"+this.lastId},w._templateName=function _templateName(){return null==this.templateName?"undefined":JSON.stringify(this.templateName)},w._compileChildren=function _compileChildren(D,w){var N=this;D.children.forEach((function(D){N.compile(D,w)}))},w._compileAggregate=function _compileAggregate(D,w,N,F){var k=this;N&&this._emit(N),D.children.forEach((function(D,N){N>0&&k._emit(","),k.compile(D,w)})),F&&this._emit(F)},w._compileExpression=function _compileExpression(D,w){this.assertType(D,j.Literal,j.Symbol,j.Group,j.Array,j.Dict,j.FunCall,j.Caller,j.Filter,j.LookupVal,j.Compare,j.InlineIf,j.In,j.Is,j.And,j.Or,j.Not,j.Add,j.Concat,j.Sub,j.Mul,j.Div,j.FloorDiv,j.Mod,j.Pow,j.Neg,j.Pos,j.Compare,j.NodeList),this.compile(D,w)},w.assertType=function assertType(D){for(var w=arguments.length,N=new Array(w>1?w-1:0),F=1;F<w;F++)N[F-1]=arguments[F];N.some((function(w){return D instanceof w}))||this.fail("assertType: invalid type: "+D.typename,D.lineno,D.colno)},w.compileCallExtension=function compileCallExtension(D,w,N){var F=this,k=D.args,z=D.contentArgs,G="boolean"!=typeof D.autoescape||D.autoescape;if(N||this._emit(this.buffer+" += runtime.suppressValue("),this._emit('env.getExtension("'+D.extName+'")["'+D.prop+'"]('),this._emit("context"),(k||z)&&this._emit(","),k&&(k instanceof j.NodeList||this.fail("compileCallExtension: arguments must be a NodeList, use `parser.parseSignature`"),k.children.forEach((function(D,N){F._compileExpression(D,w),(N!==k.children.length-1||z.length)&&F._emit(",")}))),z.length&&z.forEach((function(D,N){if(N>0&&F._emit(","),D){F._emitLine("function(cb) {"),F._emitLine("if(!cb) { cb = function(err) { if(err) { throw err; }}}");var k=F._pushBuffer();F._withScopedSyntax((function(){F.compile(D,w),F._emitLine("cb(null, "+k+");")})),F._popBuffer(),F._emitLine("return "+k+";"),F._emitLine("}")}else F._emit("null")})),N){var H=this._tmpid();this._emitLine(", "+this._makeCallback(H)),this._emitLine(this.buffer+" += runtime.suppressValue("+H+", "+G+" && env.opts.autoescape);"),this._addScopeLevel()}else this._emit(")"),this._emit(", "+G+" && env.opts.autoescape);\n")},w.compileCallExtensionAsync=function compileCallExtensionAsync(D,w){this.compileCallExtension(D,w,!0)},w.compileNodeList=function compileNodeList(D,w){this._compileChildren(D,w)},w.compileLiteral=function compileLiteral(D){if("string"==typeof D.value){var w=D.value.replace(/\\/g,"\\\\");w=(w=(w=(w=(w=w.replace(/"/g,'\\"')).replace(/\n/g,"\\n")).replace(/\r/g,"\\r")).replace(/\t/g,"\\t")).replace(/\u2028/g,"\\u2028"),this._emit('"'+w+'"')}else null===D.value?this._emit("null"):this._emit(D.value.toString())},w.compileSymbol=function compileSymbol(D,w){var N=D.value,F=w.lookup(N);F?this._emit(F):this._emit('runtime.contextOrFrameLookup(context, frame, "'+N+'")')},w.compileGroup=function compileGroup(D,w){this._compileAggregate(D,w,"(",")")},w.compileArray=function compileArray(D,w){this._compileAggregate(D,w,"[","]")},w.compileDict=function compileDict(D,w){this._compileAggregate(D,w,"{","}")},w.compilePair=function compilePair(D,w){var N=D.key,F=D.value;N instanceof j.Symbol?N=new j.Literal(N.lineno,N.colno,N.value):N instanceof j.Literal&&"string"==typeof N.value||this.fail("compilePair: Dict keys must be strings or names",N.lineno,N.colno),this.compile(N,w),this._emit(": "),this._compileExpression(F,w)},w.compileInlineIf=function compileInlineIf(D,w){this._emit("("),this.compile(D.cond,w),this._emit("?"),this.compile(D.body,w),this._emit(":"),null!==D.else_?this.compile(D.else_,w):this._emit('""'),this._emit(")")},w.compileIn=function compileIn(D,w){this._emit("runtime.inOperator("),this.compile(D.left,w),this._emit(","),this.compile(D.right,w),this._emit(")")},w.compileIs=function compileIs(D,w){var N=D.right.name?D.right.name.value:D.right.value;this._emit('env.getTest("'+N+'").call(context, '),this.compile(D.left,w),D.right.args&&(this._emit(","),this.compile(D.right.args,w)),this._emit(") === true")},w._binOpEmitter=function _binOpEmitter(D,w,N){this.compile(D.left,w),this._emit(N),this.compile(D.right,w)},w.compileOr=function compileOr(D,w){return this._binOpEmitter(D,w," || ")},w.compileAnd=function compileAnd(D,w){return this._binOpEmitter(D,w," && ")},w.compileAdd=function compileAdd(D,w){return this._binOpEmitter(D,w," + ")},w.compileConcat=function compileConcat(D,w){return this._binOpEmitter(D,w,' + "" + ')},w.compileSub=function compileSub(D,w){return this._binOpEmitter(D,w," - ")},w.compileMul=function compileMul(D,w){return this._binOpEmitter(D,w," * ")},w.compileDiv=function compileDiv(D,w){return this._binOpEmitter(D,w," / ")},w.compileMod=function compileMod(D,w){return this._binOpEmitter(D,w," % ")},w.compileNot=function compileNot(D,w){this._emit("!"),this.compile(D.target,w)},w.compileFloorDiv=function compileFloorDiv(D,w){this._emit("Math.floor("),this.compile(D.left,w),this._emit(" / "),this.compile(D.right,w),this._emit(")")},w.compilePow=function compilePow(D,w){this._emit("Math.pow("),this.compile(D.left,w),this._emit(", "),this.compile(D.right,w),this._emit(")")},w.compileNeg=function compileNeg(D,w){this._emit("-"),this.compile(D.target,w)},w.compilePos=function compilePos(D,w){this._emit("+"),this.compile(D.target,w)},w.compileCompare=function compileCompare(D,w){var N=this;this.compile(D.expr,w),D.ops.forEach((function(D){N._emit(" "+X[D.type]+" "),N.compile(D.expr,w)}))},w.compileLookupVal=function compileLookupVal(D,w){this._emit("runtime.memberLookup(("),this._compileExpression(D.target,w),this._emit("),"),this._compileExpression(D.val,w),this._emit(")")},w._getNodeName=function _getNodeName(D){switch(D.typename){case"Symbol":return D.value;case"FunCall":return"the return value of ("+this._getNodeName(D.name)+")";case"LookupVal":return this._getNodeName(D.target)+'["'+this._getNodeName(D.val)+'"]';case"Literal":return D.value.toString();default:return"--expression--"}},w.compileFunCall=function compileFunCall(D,w){this._emit("(lineno = "+D.lineno+", colno = "+D.colno+", "),this._emit("runtime.callWrap("),this._compileExpression(D.name,w),this._emit(', "'+this._getNodeName(D.name).replace(/"/g,'\\"')+'", context, '),this._compileAggregate(D.args,w,"[","])"),this._emit(")")},w.compileFilter=function compileFilter(D,w){var N=D.name;this.assertType(N,j.Symbol),this._emit('env.getFilter("'+N.value+'").call(context, '),this._compileAggregate(D.args,w),this._emit(")")},w.compileFilterAsync=function compileFilterAsync(D,w){var N=D.name,F=D.symbol.value;this.assertType(N,j.Symbol),w.set(F,F),this._emit('env.getFilter("'+N.value+'").call(context, '),this._compileAggregate(D.args,w),this._emitLine(", "+this._makeCallback(F)),this._addScopeLevel()},w.compileKeywordArgs=function compileKeywordArgs(D,w){this._emit("runtime.makeKeywordArgs("),this.compileDict(D,w),this._emit(")")},w.compileSet=function compileSet(D,w){var N=this,F=[];D.targets.forEach((function(D){var k=D.value,j=w.lookup(k);null==j&&(j=N._tmpid(),N._emitLine("var "+j+";")),F.push(j)})),D.value?(this._emit(F.join(" = ")+" = "),this._compileExpression(D.value,w),this._emitLine(";")):(this._emit(F.join(" = ")+" = "),this.compile(D.body,w),this._emitLine(";")),D.targets.forEach((function(D,w){var k=F[w],j=D.value;N._emitLine('frame.set("'+j+'", '+k+", true);"),N._emitLine("if(frame.topLevel) {"),N._emitLine('context.setVariable("'+j+'", '+k+");"),N._emitLine("}"),"_"!==j.charAt(0)&&(N._emitLine("if(frame.topLevel) {"),N._emitLine('context.addExport("'+j+'", '+k+");"),N._emitLine("}"))}))},w.compileSwitch=function compileSwitch(D,w){var N=this;this._emit("switch ("),this.compile(D.expr,w),this._emit(") {"),D.cases.forEach((function(D,F){N._emit("case "),N.compile(D.cond,w),N._emit(": "),N.compile(D.body,w),D.body.children.length&&N._emitLine("break;")})),D.default&&(this._emit("default:"),this.compile(D.default,w)),this._emit("}")},w.compileIf=function compileIf(D,w,N){var F=this;this._emit("if("),this._compileExpression(D.cond,w),this._emitLine(") {"),this._withScopedSyntax((function(){F.compile(D.body,w),N&&F._emit("cb()")})),D.else_?(this._emitLine("}\nelse {"),this._withScopedSyntax((function(){F.compile(D.else_,w),N&&F._emit("cb()")}))):N&&(this._emitLine("}\nelse {"),this._emit("cb()")),this._emitLine("}")},w.compileIfAsync=function compileIfAsync(D,w){this._emit("(function(cb) {"),this.compileIf(D,w,!0),this._emit("})("+this._makeCallback()),this._addScopeLevel()},w._emitLoopBindings=function _emitLoopBindings(D,w,N,F){var k=this;[{name:"index",val:N+" + 1"},{name:"index0",val:N},{name:"revindex",val:F+" - "+N},{name:"revindex0",val:F+" - "+N+" - 1"},{name:"first",val:N+" === 0"},{name:"last",val:N+" === "+F+" - 1"},{name:"length",val:F}].forEach((function(D){k._emitLine('frame.set("loop.'+D.name+'", '+D.val+");")}))},w.compileFor=function compileFor(D,w){var N=this,F=this._tmpid(),k=this._tmpid(),z=this._tmpid();if(w=w.push(),this._emitLine("frame = frame.push();"),this._emit("var "+z+" = "),this._compileExpression(D.arr,w),this._emitLine(";"),this._emit("if("+z+") {"),this._emitLine(z+" = runtime.fromIterator("+z+");"),D.name instanceof j.Array){this._emitLine("var "+F+";"),this._emitLine("if(runtime.isArray("+z+")) {"),this._emitLine("var "+k+" = "+z+".length;"),this._emitLine("for("+F+"=0; "+F+" < "+z+".length; "+F+"++) {"),D.name.children.forEach((function(k,j){var G=N._tmpid();N._emitLine("var "+G+" = "+z+"["+F+"]["+j+"];"),N._emitLine('frame.set("'+k+'", '+z+"["+F+"]["+j+"]);"),w.set(D.name.children[j].value,G)})),this._emitLoopBindings(D,z,F,k),this._withScopedSyntax((function(){N.compile(D.body,w)})),this._emitLine("}"),this._emitLine("} else {");var G=D.name.children,H=G[0],X=G[1],q=this._tmpid(),Z=this._tmpid();w.set(H.value,q),w.set(X.value,Z),this._emitLine(F+" = -1;"),this._emitLine("var "+k+" = runtime.keys("+z+").length;"),this._emitLine("for(var "+q+" in "+z+") {"),this._emitLine(F+"++;"),this._emitLine("var "+Z+" = "+z+"["+q+"];"),this._emitLine('frame.set("'+H.value+'", '+q+");"),this._emitLine('frame.set("'+X.value+'", '+Z+");"),this._emitLoopBindings(D,z,F,k),this._withScopedSyntax((function(){N.compile(D.body,w)})),this._emitLine("}"),this._emitLine("}")}else{var J=this._tmpid();w.set(D.name.value,J),this._emitLine("var "+k+" = "+z+".length;"),this._emitLine("for(var "+F+"=0; "+F+" < "+z+".length; "+F+"++) {"),this._emitLine("var "+J+" = "+z+"["+F+"];"),this._emitLine('frame.set("'+D.name.value+'", '+J+");"),this._emitLoopBindings(D,z,F,k),this._withScopedSyntax((function(){N.compile(D.body,w)})),this._emitLine("}")}this._emitLine("}"),D.else_&&(this._emitLine("if (!"+k+") {"),this.compile(D.else_,w),this._emitLine("}")),this._emitLine("frame = frame.pop();")},w._compileAsyncLoop=function _compileAsyncLoop(D,w,N){var F=this,k=this._tmpid(),z=this._tmpid(),G=this._tmpid(),H=N?"asyncAll":"asyncEach";if(w=w.push(),this._emitLine("frame = frame.push();"),this._emit("var "+G+" = runtime.fromIterator("),this._compileExpression(D.arr,w),this._emitLine(");"),D.name instanceof j.Array){var X=D.name.children.length;this._emit("runtime."+H+"("+G+", "+X+", function("),D.name.children.forEach((function(D){F._emit(D.value+",")})),this._emit(k+","+z+",next) {"),D.name.children.forEach((function(D){var N=D.value;w.set(N,N),F._emitLine('frame.set("'+N+'", '+N+");")}))}else{var q=D.name.value;this._emitLine("runtime."+H+"("+G+", 1, function("+q+", "+k+", "+z+",next) {"),this._emitLine('frame.set("'+q+'", '+q+");"),w.set(q,q)}this._emitLoopBindings(D,G,k,z),this._withScopedSyntax((function(){var j;N&&(j=F._pushBuffer()),F.compile(D.body,w),F._emitLine("next("+k+(j?","+j:"")+");"),N&&F._popBuffer()}));var Z=this._tmpid();this._emitLine("}, "+this._makeCallback(Z)),this._addScopeLevel(),N&&this._emitLine(this.buffer+" += "+Z+";"),D.else_&&(this._emitLine("if (!"+G+".length) {"),this.compile(D.else_,w),this._emitLine("}")),this._emitLine("frame = frame.pop();")},w.compileAsyncEach=function compileAsyncEach(D,w){this._compileAsyncLoop(D,w)},w.compileAsyncAll=function compileAsyncAll(D,w){this._compileAsyncLoop(D,w,!0)},w._compileMacro=function _compileMacro(D,w){var N=this,F=[],k=null,z="macro_"+this._tmpid(),H=void 0!==w;D.args.children.forEach((function(w,z){z===D.args.children.length-1&&w instanceof j.Dict?k=w:(N.assertType(w,j.Symbol),F.push(w))}));var X,q=[].concat(F.map((function(D){return"l_"+D.value})),["kwargs"]),Z=F.map((function(D){return'"'+D.value+'"'})),J=(k&&k.children||[]).map((function(D){return'"'+D.key.value+'"'}));X=H?w.push(!0):new G,this._emitLines("var "+z+" = runtime.makeMacro(","["+Z.join(", ")+"], ","["+J.join(", ")+"], ","function ("+q.join(", ")+") {","var callerFrame = frame;","frame = "+(H?"frame.push(true);":"new runtime.Frame();"),"kwargs = kwargs || {};",'if (Object.prototype.hasOwnProperty.call(kwargs, "caller")) {','frame.set("caller", kwargs.caller); }'),F.forEach((function(D){N._emitLine('frame.set("'+D.value+'", l_'+D.value+");"),X.set(D.value,"l_"+D.value)})),k&&k.children.forEach((function(D){var w=D.key.value;N._emit('frame.set("'+w+'", '),N._emit('Object.prototype.hasOwnProperty.call(kwargs, "'+w+'")'),N._emit(' ? kwargs["'+w+'"] : '),N._compileExpression(D.value,X),N._emit(");")}));var $=this._pushBuffer();return this._withScopedSyntax((function(){N.compile(D.body,X)})),this._emitLine("frame = "+(H?"frame.pop();":"callerFrame;")),this._emitLine("return new runtime.SafeString("+$+");"),this._emitLine("});"),this._popBuffer(),z},w.compileMacro=function compileMacro(D,w){var N=this._compileMacro(D),F=D.name.value;w.set(F,N),w.parent?this._emitLine('frame.set("'+F+'", '+N+");"):("_"!==D.name.value.charAt(0)&&this._emitLine('context.addExport("'+F+'");'),this._emitLine('context.setVariable("'+F+'", '+N+");"))},w.compileCaller=function compileCaller(D,w){this._emit("(function (){");var N=this._compileMacro(D,w);this._emit("return "+N+";})()")},w._compileGetTemplate=function _compileGetTemplate(D,w,N,F){var k=this._tmpid(),j=this._templateName(),z=this._makeCallback(k),G=N?"true":"false",H=F?"true":"false";return this._emit("env.getTemplate("),this._compileExpression(D.template,w),this._emitLine(", "+G+", "+j+", "+H+", "+z),k},w.compileImport=function compileImport(D,w){var N=D.target.value,F=this._compileGetTemplate(D,w,!1,!1);this._addScopeLevel(),this._emitLine(F+".getExported("+(D.withContext?"context.getVariables(), frame, ":"")+this._makeCallback(F)),this._addScopeLevel(),w.set(N,F),w.parent?this._emitLine('frame.set("'+N+'", '+F+");"):this._emitLine('context.setVariable("'+N+'", '+F+");")},w.compileFromImport=function compileFromImport(D,w){var N=this,F=this._compileGetTemplate(D,w,!1,!1);this._addScopeLevel(),this._emitLine(F+".getExported("+(D.withContext?"context.getVariables(), frame, ":"")+this._makeCallback(F)),this._addScopeLevel(),D.names.children.forEach((function(D){var k,z,G=N._tmpid();D instanceof j.Pair?(k=D.key.value,z=D.value.value):z=k=D.value,N._emitLine("if(Object.prototype.hasOwnProperty.call("+F+', "'+k+'")) {'),N._emitLine("var "+G+" = "+F+"."+k+";"),N._emitLine("} else {"),N._emitLine("cb(new Error(\"cannot import '"+k+"'\")); return;"),N._emitLine("}"),w.set(z,G),w.parent?N._emitLine('frame.set("'+z+'", '+G+");"):N._emitLine('context.setVariable("'+z+'", '+G+");")}))},w.compileBlock=function compileBlock(D){var w=this._tmpid();this.inBlock||this._emit('(parentTemplate ? function(e, c, f, r, cb) { cb(""); } : '),this._emit('context.getBlock("'+D.name.value+'")'),this.inBlock||this._emit(")"),this._emitLine("(env, context, frame, runtime, "+this._makeCallback(w)),this._emitLine(this.buffer+" += "+w+";"),this._addScopeLevel()},w.compileSuper=function compileSuper(D,w){var N=D.blockName.value,F=D.symbol.value,k=this._makeCallback(F);this._emitLine('context.getSuper(env, "'+N+'", b_'+N+", frame, runtime, "+k),this._emitLine(F+" = runtime.markSafe("+F+");"),this._addScopeLevel(),w.set(F,F)},w.compileExtends=function compileExtends(D,w){var N=this._tmpid(),F=this._compileGetTemplate(D,w,!0,!1);this._emitLine("parentTemplate = "+F),this._emitLine("for(var "+N+" in parentTemplate.blocks) {"),this._emitLine("context.addBlock("+N+", parentTemplate.blocks["+N+"]);"),this._emitLine("}"),this._addScopeLevel()},w.compileInclude=function compileInclude(D,w){this._emitLine("var tasks = [];"),this._emitLine("tasks.push("),this._emitLine("function(callback) {");var N=this._compileGetTemplate(D,w,!1,D.ignoreMissing);this._emitLine("callback(null,"+N+");});"),this._emitLine("});");var F=this._tmpid();this._emitLine("tasks.push("),this._emitLine("function(template, callback){"),this._emitLine("template.render(context.getVariables(), frame, "+this._makeCallback(F)),this._emitLine("callback(null,"+F+");});"),this._emitLine("});"),this._emitLine("tasks.push("),this._emitLine("function(result, callback){"),this._emitLine(this.buffer+" += result;"),this._emitLine("callback(null);"),this._emitLine("});"),this._emitLine("env.waterfall(tasks, function(){"),this._addScopeLevel()},w.compileTemplateData=function compileTemplateData(D,w){this.compileLiteral(D,w)},w.compileCapture=function compileCapture(D,w){var N=this,F=this.buffer;this.buffer="output",this._emitLine("(function() {"),this._emitLine('var output = "";'),this._withScopedSyntax((function(){N.compile(D.body,w)})),this._emitLine("return output;"),this._emitLine("})()"),this.buffer=F},w.compileOutput=function compileOutput(D,w){var N=this;D.children.forEach((function(F){F instanceof j.TemplateData?F.value&&(N._emit(N.buffer+" += "),N.compileLiteral(F,w),N._emitLine(";")):(N._emit(N.buffer+" += runtime.suppressValue("),N.throwOnUndefined&&N._emit("runtime.ensureDefined("),N.compile(F,w),N.throwOnUndefined&&N._emit(","+D.lineno+","+D.colno+")"),N._emit(", env.opts.autoescape);\n"))}))},w.compileRoot=function compileRoot(D,w){var N=this;w&&this.fail("compileRoot: root node can't have frame"),w=new G,this._emitFuncBegin(D,"root"),this._emitLine("var parentTemplate = null;"),this._compileChildren(D,w),this._emitLine("if(parentTemplate) {"),this._emitLine("parentTemplate.rootRenderFunc(env, context, frame, runtime, cb);"),this._emitLine("} else {"),this._emitLine("cb(null, "+this.buffer+");"),this._emitLine("}"),this._emitFuncEnd(!0),this.inBlock=!0;var F=[],k=D.findAll(j.Block);k.forEach((function(D,w){var k=D.name.value;if(-1!==F.indexOf(k))throw new Error('Block "'+k+'" defined more than once.');F.push(k),N._emitFuncBegin(D,"b_"+k);var j=new G;N._emitLine("var frame = frame.push(true);"),N.compile(D.body,j),N._emitFuncEnd()})),this._emitLine("return {"),k.forEach((function(D,w){var F="b_"+D.name.value;N._emitLine(F+": "+F+",")})),this._emitLine("root: root\n};")},w.compile=function compile(D,w){var N=this["compile"+D.typename];N?N.call(this,D,w):this.fail("compile: Cannot compile node: "+D.typename,D.lineno,D.colno)},w.getCode=function getCode(){return this.codebuf.join("")},Compiler}(H);D.exports={compile:function compile(D,w,N,j,z){void 0===z&&(z={});var G=new q(j,z.throwOnUndefined),H=(N||[]).map((function(D){return D.preprocess})).filter((function(D){return!!D})).reduce((function(D,w){return w(D)}),D);return G.compile(k.transform(F.parse(H,N,z),w,j)),G.getCode()},Compiler:q}},function(D,w,N){"use strict";var F=N(4),k=N(1).EmitterObj;D.exports=function(D){function Loader(){return D.apply(this,arguments)||this}!function _inheritsLoose(D,w){D.prototype=Object.create(w.prototype),D.prototype.constructor=D,D.__proto__=w}(Loader,D);var w=Loader.prototype;return w.resolve=function resolve(D,w){return F.resolve(F.dirname(D),w)},w.isRelative=function isRelative(D){return 0===D.indexOf("./")||0===D.indexOf("../")},Loader}(k)},function(D,w,N){"use strict";function _inheritsLoose(D,w){D.prototype=Object.create(w.prototype),D.prototype.constructor=D,D.__proto__=w}var F=N(12),k=N(15),j=N(0),z=N(5),G=N(18),H=N(10),X=H.FileSystemLoader,q=H.WebLoader,Z=H.PrecompiledLoader,J=N(20),$=N(21),te=N(1),ie=te.Obj,oe=te.EmitterObj,ce=N(2),he=ce.handleError,fe=ce.Frame,pe=N(22);function callbackAsap(D,w,N){F((function(){D(w,N)}))}var _e={type:"code",obj:{root:function root(D,w,N,F,k){try{k(null,"")}catch(D){k(he(D,null,null))}}}},ve=function(D){function Environment(){return D.apply(this,arguments)||this}_inheritsLoose(Environment,D);var w=Environment.prototype;return w.init=function init(D,w){var N=this;w=this.opts=w||{},this.opts.dev=!!w.dev,this.opts.autoescape=null==w.autoescape||w.autoescape,this.opts.throwOnUndefined=!!w.throwOnUndefined,this.opts.trimBlocks=!!w.trimBlocks,this.opts.lstripBlocks=!!w.lstripBlocks,this.loaders=[],D?this.loaders=j.isArray(D)?D:[D]:X?this.loaders=[new X("views")]:q&&(this.loaders=[new q("/views")]),"undefined"!=typeof window&&window.nunjucksPrecompiled&&this.loaders.unshift(new Z(window.nunjucksPrecompiled)),this._initLoaders(),this.globals=$(),this.filters={},this.tests={},this.asyncFilters=[],this.extensions={},this.extensionsList=[],j._entries(G).forEach((function(D){var w=D[0],F=D[1];return N.addFilter(w,F)})),j._entries(J).forEach((function(D){var w=D[0],F=D[1];return N.addTest(w,F)}))},w._initLoaders=function _initLoaders(){var D=this;this.loaders.forEach((function(w){w.cache={},"function"==typeof w.on&&(w.on("update",(function(N,F){w.cache[N]=null,D.emit("update",N,F,w)})),w.on("load",(function(N,F){D.emit("load",N,F,w)})))}))},w.invalidateCache=function invalidateCache(){this.loaders.forEach((function(D){D.cache={}}))},w.addExtension=function addExtension(D,w){return w.__name=D,this.extensions[D]=w,this.extensionsList.push(w),this},w.removeExtension=function removeExtension(D){var w=this.getExtension(D);w&&(this.extensionsList=j.without(this.extensionsList,w),delete this.extensions[D])},w.getExtension=function getExtension(D){return this.extensions[D]},w.hasExtension=function hasExtension(D){return!!this.extensions[D]},w.addGlobal=function addGlobal(D,w){return this.globals[D]=w,this},w.getGlobal=function getGlobal(D){if(void 0===this.globals[D])throw new Error("global not found: "+D);return this.globals[D]},w.addFilter=function addFilter(D,w,N){var F=w;return N&&this.asyncFilters.push(D),this.filters[D]=F,this},w.getFilter=function getFilter(D){if(!this.filters[D])throw new Error("filter not found: "+D);return this.filters[D]},w.addTest=function addTest(D,w){return this.tests[D]=w,this},w.getTest=function getTest(D){if(!this.tests[D])throw new Error("test not found: "+D);return this.tests[D]},w.resolveTemplate=function resolveTemplate(D,w,N){return!(!D.isRelative||!w)&&D.isRelative(N)&&D.resolve?D.resolve(w,N):N},w.getTemplate=function getTemplate(D,w,N,F,k){var z,G=this,H=this,X=null;if(D&&D.raw&&(D=D.raw),j.isFunction(N)&&(k=N,N=null,w=w||!1),j.isFunction(w)&&(k=w,w=!1),D instanceof be)X=D;else{if("string"!=typeof D)throw new Error("template names must be a string: "+D);for(var q=0;q<this.loaders.length;q++){var Z=this.loaders[q];if(X=Z.cache[this.resolveTemplate(Z,N,D)])break}}if(X)return w&&X.compile(),k?void k(null,X):X;return j.asyncIter(this.loaders,(function(w,F,k,j){function handle(D,N){D?j(D):N?(N.loader=w,j(null,N)):k()}D=H.resolveTemplate(w,N,D),w.async?w.getSource(D,handle):handle(null,w.getSource(D))}),(function createTemplate(N,j){if(j||N||F||(N=new Error("template not found: "+D)),N){if(k)return void k(N);throw N}var H;j?(H=new be(j.src,G,j.path,w),j.noCache||(j.loader.cache[D]=H)):H=new be(_e,G,"",w),k?k(null,H):z=H})),z},w.express=function express(D){return pe(this,D)},w.render=function render(D,w,N){j.isFunction(w)&&(N=w,w=null);var F=null;return this.getTemplate(D,(function(D,k){if(D&&N)callbackAsap(N,D);else{if(D)throw D;F=k.render(w,N)}})),F},w.renderString=function renderString(D,w,N,F){return j.isFunction(N)&&(F=N,N={}),new be(D,this,(N=N||{}).path).render(w,F)},w.waterfall=function waterfall(D,w,N){return k(D,w,N)},Environment}(oe),ye=function(D){function Context(){return D.apply(this,arguments)||this}_inheritsLoose(Context,D);var w=Context.prototype;return w.init=function init(D,w,N){var F=this;this.env=N||new ve,this.ctx=j.extend({},D),this.blocks={},this.exported=[],j.keys(w).forEach((function(D){F.addBlock(D,w[D])}))},w.lookup=function lookup(D){return D in this.env.globals&&!(D in this.ctx)?this.env.globals[D]:this.ctx[D]},w.setVariable=function setVariable(D,w){this.ctx[D]=w},w.getVariables=function getVariables(){return this.ctx},w.addBlock=function addBlock(D,w){return this.blocks[D]=this.blocks[D]||[],this.blocks[D].push(w),this},w.getBlock=function getBlock(D){if(!this.blocks[D])throw new Error('unknown block "'+D+'"');return this.blocks[D][0]},w.getSuper=function getSuper(D,w,N,F,k,z){var G=j.indexOf(this.blocks[w]||[],N),H=this.blocks[w][G+1];if(-1===G||!H)throw new Error('no super block available for "'+w+'"');H(D,this,F,k,z)},w.addExport=function addExport(D){this.exported.push(D)},w.getExported=function getExported(){var D=this,w={};return this.exported.forEach((function(N){w[N]=D.ctx[N]})),w},Context}(ie),be=function(D){function Template(){return D.apply(this,arguments)||this}_inheritsLoose(Template,D);var w=Template.prototype;return w.init=function init(D,w,N,F){if(this.env=w||new ve,j.isObject(D))switch(D.type){case"code":this.tmplProps=D.obj;break;case"string":this.tmplStr=D.obj;break;default:throw new Error("Unexpected template object type "+D.type+"; expected 'code', or 'string'")}else{if(!j.isString(D))throw new Error("src must be a string or an object describing the source");this.tmplStr=D}if(this.path=N,F)try{this._compile()}catch(D){throw j._prettifyError(this.path,this.env.opts.dev,D)}else this.compiled=!1},w.render=function render(D,w,N){var F=this;"function"==typeof D?(N=D,D={}):"function"==typeof w&&(N=w,w=null);var k=!w;try{this.compile()}catch(D){var z=j._prettifyError(this.path,this.env.opts.dev,D);if(N)return callbackAsap(N,z);throw z}var G=new ye(D||{},this.blocks,this.env),H=w?w.push(!0):new fe;H.topLevel=!0;var X=null,q=!1;return this.rootRenderFunc(this.env,G,H,ce,(function(D,w){if(q){if(N)return;throw D}if(D&&(D=j._prettifyError(F.path,F.env.opts.dev,D),q=!0),N)k?callbackAsap(N,D,w):N(D,w);else{if(D)throw D;X=w}})),X},w.getExported=function getExported(D,w,N){"function"==typeof D&&(N=D,D={}),"function"==typeof w&&(N=w,w=null);try{this.compile()}catch(D){if(N)return N(D);throw D}var F=w?w.push():new fe;F.topLevel=!0;var k=new ye(D||{},this.blocks,this.env);this.rootRenderFunc(this.env,k,F,ce,(function(D){D?N(D,null):N(null,k.getExported())}))},w.compile=function compile(){this.compiled||this._compile()},w._compile=function _compile(){var D;if(this.tmplProps)D=this.tmplProps;else{var w=z.compile(this.tmplStr,this.env.asyncFilters,this.env.extensionsList,this.path,this.env.opts);D=new Function(w)()}this.blocks=this._getBlocks(D),this.rootRenderFunc=D.root,this.compiled=!0},w._getBlocks=function _getBlocks(D){var w={};return j.keys(D).forEach((function(N){"b_"===N.slice(0,2)&&(w[N.slice(2)]=D[N])})),w},Template}(ie);D.exports={Environment:ve,Template:be}},function(D,w,N){"use strict";var F=N(9),k=N(3),j=N(1).Obj,z=N(0),G=function(D){function Parser(){return D.apply(this,arguments)||this}!function _inheritsLoose(D,w){D.prototype=Object.create(w.prototype),D.prototype.constructor=D,D.__proto__=w}(Parser,D);var w=Parser.prototype;return w.init=function init(D){this.tokens=D,this.peeked=null,this.breakOnBlocks=null,this.dropLeadingWhitespace=!1,this.extensions=[]},w.nextToken=function nextToken(D){var w;if(this.peeked){if(D||this.peeked.type!==F.TOKEN_WHITESPACE)return w=this.peeked,this.peeked=null,w;this.peeked=null}if(w=this.tokens.nextToken(),!D)for(;w&&w.type===F.TOKEN_WHITESPACE;)w=this.tokens.nextToken();return w},w.peekToken=function peekToken(){return this.peeked=this.peeked||this.nextToken(),this.peeked},w.pushToken=function pushToken(D){if(this.peeked)throw new Error("pushToken: can only push one token on between reads");this.peeked=D},w.error=function error(D,w,N){if(void 0===w||void 0===N){var F=this.peekToken()||{};w=F.lineno,N=F.colno}return void 0!==w&&(w+=1),void 0!==N&&(N+=1),new z.TemplateError(D,w,N)},w.fail=function fail(D,w,N){throw this.error(D,w,N)},w.skip=function skip(D){var w=this.nextToken();return!(!w||w.type!==D)||(this.pushToken(w),!1)},w.expect=function expect(D){var w=this.nextToken();return w.type!==D&&this.fail("expected "+D+", got "+w.type,w.lineno,w.colno),w},w.skipValue=function skipValue(D,w){var N=this.nextToken();return!(!N||N.type!==D||N.value!==w)||(this.pushToken(N),!1)},w.skipSymbol=function skipSymbol(D){return this.skipValue(F.TOKEN_SYMBOL,D)},w.advanceAfterBlockEnd=function advanceAfterBlockEnd(D){var w;return D||((w=this.peekToken())||this.fail("unexpected end of file"),w.type!==F.TOKEN_SYMBOL&&this.fail("advanceAfterBlockEnd: expected symbol token or explicit name to be passed"),D=this.nextToken().value),(w=this.nextToken())&&w.type===F.TOKEN_BLOCK_END?"-"===w.value.charAt(0)&&(this.dropLeadingWhitespace=!0):this.fail("expected block end in "+D+" statement"),w},w.advanceAfterVariableEnd=function advanceAfterVariableEnd(){var D=this.nextToken();D&&D.type===F.TOKEN_VARIABLE_END?this.dropLeadingWhitespace="-"===D.value.charAt(D.value.length-this.tokens.tags.VARIABLE_END.length-1):(this.pushToken(D),this.fail("expected variable end"))},w.parseFor=function parseFor(){var D,w,N=this.peekToken();if(this.skipSymbol("for")?(D=new k.For(N.lineno,N.colno),w="endfor"):this.skipSymbol("asyncEach")?(D=new k.AsyncEach(N.lineno,N.colno),w="endeach"):this.skipSymbol("asyncAll")?(D=new k.AsyncAll(N.lineno,N.colno),w="endall"):this.fail("parseFor: expected for{Async}",N.lineno,N.colno),D.name=this.parsePrimary(),D.name instanceof k.Symbol||this.fail("parseFor: variable name expected for loop"),this.peekToken().type===F.TOKEN_COMMA){var j=D.name;for(D.name=new k.Array(j.lineno,j.colno),D.name.addChild(j);this.skip(F.TOKEN_COMMA);){var z=this.parsePrimary();D.name.addChild(z)}}return this.skipSymbol("in")||this.fail('parseFor: expected "in" keyword for loop',N.lineno,N.colno),D.arr=this.parseExpression(),this.advanceAfterBlockEnd(N.value),D.body=this.parseUntilBlocks(w,"else"),this.skipSymbol("else")&&(this.advanceAfterBlockEnd("else"),D.else_=this.parseUntilBlocks(w)),this.advanceAfterBlockEnd(),D},w.parseMacro=function parseMacro(){var D=this.peekToken();this.skipSymbol("macro")||this.fail("expected macro");var w=this.parsePrimary(!0),N=this.parseSignature(),F=new k.Macro(D.lineno,D.colno,w,N);return this.advanceAfterBlockEnd(D.value),F.body=this.parseUntilBlocks("endmacro"),this.advanceAfterBlockEnd(),F},w.parseCall=function parseCall(){var D=this.peekToken();this.skipSymbol("call")||this.fail("expected call");var w=this.parseSignature(!0)||new k.NodeList,N=this.parsePrimary();this.advanceAfterBlockEnd(D.value);var F=this.parseUntilBlocks("endcall");this.advanceAfterBlockEnd();var j=new k.Symbol(D.lineno,D.colno,"caller"),z=new k.Caller(D.lineno,D.colno,j,w,F),G=N.args.children;return G[G.length-1]instanceof k.KeywordArgs||G.push(new k.KeywordArgs),G[G.length-1].addChild(new k.Pair(D.lineno,D.colno,j,z)),new k.Output(D.lineno,D.colno,[N])},w.parseWithContext=function parseWithContext(){var D=this.peekToken(),w=null;return this.skipSymbol("with")?w=!0:this.skipSymbol("without")&&(w=!1),null!==w&&(this.skipSymbol("context")||this.fail("parseFrom: expected context after with/without",D.lineno,D.colno)),w},w.parseImport=function parseImport(){var D=this.peekToken();this.skipSymbol("import")||this.fail("parseImport: expected import",D.lineno,D.colno);var w=this.parseExpression();this.skipSymbol("as")||this.fail('parseImport: expected "as" keyword',D.lineno,D.colno);var N=this.parseExpression(),F=this.parseWithContext(),j=new k.Import(D.lineno,D.colno,w,N,F);return this.advanceAfterBlockEnd(D.value),j},w.parseFrom=function parseFrom(){var D=this.peekToken();this.skipSymbol("from")||this.fail("parseFrom: expected from");var w=this.parseExpression();this.skipSymbol("import")||this.fail("parseFrom: expected import",D.lineno,D.colno);for(var N,j=new k.NodeList;;){var z=this.peekToken();if(z.type===F.TOKEN_BLOCK_END){j.children.length||this.fail("parseFrom: Expected at least one import name",D.lineno,D.colno),"-"===z.value.charAt(0)&&(this.dropLeadingWhitespace=!0),this.nextToken();break}j.children.length>0&&!this.skip(F.TOKEN_COMMA)&&this.fail("parseFrom: expected comma",D.lineno,D.colno);var G=this.parsePrimary();if("_"===G.value.charAt(0)&&this.fail("parseFrom: names starting with an underscore cannot be imported",G.lineno,G.colno),this.skipSymbol("as")){var H=this.parsePrimary();j.addChild(new k.Pair(G.lineno,G.colno,G,H))}else j.addChild(G);N=this.parseWithContext()}return new k.FromImport(D.lineno,D.colno,w,j,N)},w.parseBlock=function parseBlock(){var D=this.peekToken();this.skipSymbol("block")||this.fail("parseBlock: expected block",D.lineno,D.colno);var w=new k.Block(D.lineno,D.colno);w.name=this.parsePrimary(),w.name instanceof k.Symbol||this.fail("parseBlock: variable name expected",D.lineno,D.colno),this.advanceAfterBlockEnd(D.value),w.body=this.parseUntilBlocks("endblock"),this.skipSymbol("endblock"),this.skipSymbol(w.name.value);var N=this.peekToken();return N||this.fail("parseBlock: expected endblock, got end of file"),this.advanceAfterBlockEnd(N.value),w},w.parseExtends=function parseExtends(){var D=this.peekToken();this.skipSymbol("extends")||this.fail("parseTemplateRef: expected extends");var w=new k.Extends(D.lineno,D.colno);return w.template=this.parseExpression(),this.advanceAfterBlockEnd(D.value),w},w.parseInclude=function parseInclude(){var D=this.peekToken();this.skipSymbol("include")||this.fail("parseInclude: expected include");var w=new k.Include(D.lineno,D.colno);return w.template=this.parseExpression(),this.skipSymbol("ignore")&&this.skipSymbol("missing")&&(w.ignoreMissing=!0),this.advanceAfterBlockEnd(D.value),w},w.parseIf=function parseIf(){var D,w=this.peekToken();this.skipSymbol("if")||this.skipSymbol("elif")||this.skipSymbol("elseif")?D=new k.If(w.lineno,w.colno):this.skipSymbol("ifAsync")?D=new k.IfAsync(w.lineno,w.colno):this.fail("parseIf: expected if, elif, or elseif",w.lineno,w.colno),D.cond=this.parseExpression(),this.advanceAfterBlockEnd(w.value),D.body=this.parseUntilBlocks("elif","elseif","else","endif");var N=this.peekToken();switch(N&&N.value){case"elseif":case"elif":D.else_=this.parseIf();break;case"else":this.advanceAfterBlockEnd(),D.else_=this.parseUntilBlocks("endif"),this.advanceAfterBlockEnd();break;case"endif":D.else_=null,this.advanceAfterBlockEnd();break;default:this.fail("parseIf: expected elif, else, or endif, got end of file")}return D},w.parseSet=function parseSet(){var D=this.peekToken();this.skipSymbol("set")||this.fail("parseSet: expected set",D.lineno,D.colno);for(var w,N=new k.Set(D.lineno,D.colno,[]);(w=this.parsePrimary())&&(N.targets.push(w),this.skip(F.TOKEN_COMMA)););return this.skipValue(F.TOKEN_OPERATOR,"=")?(N.value=this.parseExpression(),this.advanceAfterBlockEnd(D.value)):this.skip(F.TOKEN_BLOCK_END)?(N.body=new k.Capture(D.lineno,D.colno,this.parseUntilBlocks("endset")),N.value=null,this.advanceAfterBlockEnd()):this.fail("parseSet: expected = or block end in set tag",D.lineno,D.colno),N},w.parseSwitch=function parseSwitch(){var D=this.peekToken();this.skipSymbol("switch")||this.skipSymbol("case")||this.skipSymbol("default")||this.fail('parseSwitch: expected "switch," "case" or "default"',D.lineno,D.colno);var w=this.parseExpression();this.advanceAfterBlockEnd("switch"),this.parseUntilBlocks("case","default","endswitch");var N,F=this.peekToken(),j=[];do{this.skipSymbol("case");var z=this.parseExpression();this.advanceAfterBlockEnd("switch");var G=this.parseUntilBlocks("case","default","endswitch");j.push(new k.Case(F.line,F.col,z,G)),F=this.peekToken()}while(F&&"case"===F.value);switch(F.value){case"default":this.advanceAfterBlockEnd(),N=this.parseUntilBlocks("endswitch"),this.advanceAfterBlockEnd();break;case"endswitch":this.advanceAfterBlockEnd();break;default:this.fail('parseSwitch: expected "case," "default" or "endswitch," got EOF.')}return new k.Switch(D.lineno,D.colno,w,j,N)},w.parseStatement=function parseStatement(){var D=this.peekToken();if(D.type!==F.TOKEN_SYMBOL&&this.fail("tag name expected",D.lineno,D.colno),this.breakOnBlocks&&-1!==z.indexOf(this.breakOnBlocks,D.value))return null;switch(D.value){case"raw":return this.parseRaw();case"verbatim":return this.parseRaw("verbatim");case"if":case"ifAsync":return this.parseIf();case"for":case"asyncEach":case"asyncAll":return this.parseFor();case"block":return this.parseBlock();case"extends":return this.parseExtends();case"include":return this.parseInclude();case"set":return this.parseSet();case"macro":return this.parseMacro();case"call":return this.parseCall();case"import":return this.parseImport();case"from":return this.parseFrom();case"filter":return this.parseFilterStatement();case"switch":return this.parseSwitch();default:if(this.extensions.length)for(var w=0;w<this.extensions.length;w++){var N=this.extensions[w];if(-1!==z.indexOf(N.tags||[],D.value))return N.parse(this,k,F)}this.fail("unknown block tag: "+D.value,D.lineno,D.colno)}},w.parseRaw=function parseRaw(D){for(var w="end"+(D=D||"raw"),N=new RegExp("([\\s\\S]*?){%\\s*("+D+"|"+w+")\\s*(?=%})%}"),F=1,j="",z=null,G=this.advanceAfterBlockEnd();(z=this.tokens._extractRegex(N))&&F>0;){var H=z[0],X=z[1],q=z[2];q===D?F+=1:q===w&&(F-=1),0===F?(j+=X,this.tokens.backN(H.length-X.length)):j+=H}return new k.Output(G.lineno,G.colno,[new k.TemplateData(G.lineno,G.colno,j)])},w.parsePostfix=function parsePostfix(D){for(var w,N=this.peekToken();N;){if(N.type===F.TOKEN_LEFT_PAREN)D=new k.FunCall(N.lineno,N.colno,D,this.parseSignature());else if(N.type===F.TOKEN_LEFT_BRACKET)(w=this.parseAggregate()).children.length>1&&this.fail("invalid index"),D=new k.LookupVal(N.lineno,N.colno,D,w.children[0]);else{if(N.type!==F.TOKEN_OPERATOR||"."!==N.value)break;this.nextToken();var j=this.nextToken();j.type!==F.TOKEN_SYMBOL&&this.fail("expected name as lookup value, got "+j.value,j.lineno,j.colno),w=new k.Literal(j.lineno,j.colno,j.value),D=new k.LookupVal(N.lineno,N.colno,D,w)}N=this.peekToken()}return D},w.parseExpression=function parseExpression(){return this.parseInlineIf()},w.parseInlineIf=function parseInlineIf(){var D=this.parseOr();if(this.skipSymbol("if")){var w=this.parseOr(),N=D;(D=new k.InlineIf(D.lineno,D.colno)).body=N,D.cond=w,this.skipSymbol("else")?D.else_=this.parseOr():D.else_=null}return D},w.parseOr=function parseOr(){for(var D=this.parseAnd();this.skipSymbol("or");){var w=this.parseAnd();D=new k.Or(D.lineno,D.colno,D,w)}return D},w.parseAnd=function parseAnd(){for(var D=this.parseNot();this.skipSymbol("and");){var w=this.parseNot();D=new k.And(D.lineno,D.colno,D,w)}return D},w.parseNot=function parseNot(){var D=this.peekToken();return this.skipSymbol("not")?new k.Not(D.lineno,D.colno,this.parseNot()):this.parseIn()},w.parseIn=function parseIn(){for(var D=this.parseIs();;){var w=this.nextToken();if(!w)break;var N=w.type===F.TOKEN_SYMBOL&&"not"===w.value;if(N||this.pushToken(w),!this.skipSymbol("in")){N&&this.pushToken(w);break}var j=this.parseIs();D=new k.In(D.lineno,D.colno,D,j),N&&(D=new k.Not(D.lineno,D.colno,D))}return D},w.parseIs=function parseIs(){var D=this.parseCompare();if(this.skipSymbol("is")){var w=this.skipSymbol("not"),N=this.parseCompare();D=new k.Is(D.lineno,D.colno,D,N),w&&(D=new k.Not(D.lineno,D.colno,D))}return D},w.parseCompare=function parseCompare(){for(var D=["==","===","!=","!==","<",">","<=",">="],w=this.parseConcat(),N=[];;){var F=this.nextToken();if(!F)break;if(-1===D.indexOf(F.value)){this.pushToken(F);break}N.push(new k.CompareOperand(F.lineno,F.colno,this.parseConcat(),F.value))}return N.length?new k.Compare(N[0].lineno,N[0].colno,w,N):w},w.parseConcat=function parseConcat(){for(var D=this.parseAdd();this.skipValue(F.TOKEN_TILDE,"~");){var w=this.parseAdd();D=new k.Concat(D.lineno,D.colno,D,w)}return D},w.parseAdd=function parseAdd(){for(var D=this.parseSub();this.skipValue(F.TOKEN_OPERATOR,"+");){var w=this.parseSub();D=new k.Add(D.lineno,D.colno,D,w)}return D},w.parseSub=function parseSub(){for(var D=this.parseMul();this.skipValue(F.TOKEN_OPERATOR,"-");){var w=this.parseMul();D=new k.Sub(D.lineno,D.colno,D,w)}return D},w.parseMul=function parseMul(){for(var D=this.parseDiv();this.skipValue(F.TOKEN_OPERATOR,"*");){var w=this.parseDiv();D=new k.Mul(D.lineno,D.colno,D,w)}return D},w.parseDiv=function parseDiv(){for(var D=this.parseFloorDiv();this.skipValue(F.TOKEN_OPERATOR,"/");){var w=this.parseFloorDiv();D=new k.Div(D.lineno,D.colno,D,w)}return D},w.parseFloorDiv=function parseFloorDiv(){for(var D=this.parseMod();this.skipValue(F.TOKEN_OPERATOR,"//");){var w=this.parseMod();D=new k.FloorDiv(D.lineno,D.colno,D,w)}return D},w.parseMod=function parseMod(){for(var D=this.parsePow();this.skipValue(F.TOKEN_OPERATOR,"%");){var w=this.parsePow();D=new k.Mod(D.lineno,D.colno,D,w)}return D},w.parsePow=function parsePow(){for(var D=this.parseUnary();this.skipValue(F.TOKEN_OPERATOR,"**");){var w=this.parseUnary();D=new k.Pow(D.lineno,D.colno,D,w)}return D},w.parseUnary=function parseUnary(D){var w,N=this.peekToken();return w=this.skipValue(F.TOKEN_OPERATOR,"-")?new k.Neg(N.lineno,N.colno,this.parseUnary(!0)):this.skipValue(F.TOKEN_OPERATOR,"+")?new k.Pos(N.lineno,N.colno,this.parseUnary(!0)):this.parsePrimary(),D||(w=this.parseFilter(w)),w},w.parsePrimary=function parsePrimary(D){var w,N=this.nextToken(),j=null;if(N?N.type===F.TOKEN_STRING?w=N.value:N.type===F.TOKEN_INT?w=parseInt(N.value,10):N.type===F.TOKEN_FLOAT?w=parseFloat(N.value):N.type===F.TOKEN_BOOLEAN?"true"===N.value?w=!0:"false"===N.value?w=!1:this.fail("invalid boolean: "+N.value,N.lineno,N.colno):N.type===F.TOKEN_NONE?w=null:N.type===F.TOKEN_REGEX&&(w=new RegExp(N.value.body,N.value.flags)):this.fail("expected expression, got end of file"),void 0!==w?j=new k.Literal(N.lineno,N.colno,w):N.type===F.TOKEN_SYMBOL?j=new k.Symbol(N.lineno,N.colno,N.value):(this.pushToken(N),j=this.parseAggregate()),D||(j=this.parsePostfix(j)),j)return j;throw this.error("unexpected token: "+N.value,N.lineno,N.colno)},w.parseFilterName=function parseFilterName(){for(var D=this.expect(F.TOKEN_SYMBOL),w=D.value;this.skipValue(F.TOKEN_OPERATOR,".");)w+="."+this.expect(F.TOKEN_SYMBOL).value;return new k.Symbol(D.lineno,D.colno,w)},w.parseFilterArgs=function parseFilterArgs(D){return this.peekToken().type===F.TOKEN_LEFT_PAREN?this.parsePostfix(D).args.children:[]},w.parseFilter=function parseFilter(D){for(;this.skip(F.TOKEN_PIPE);){var w=this.parseFilterName();D=new k.Filter(w.lineno,w.colno,w,new k.NodeList(w.lineno,w.colno,[D].concat(this.parseFilterArgs(D))))}return D},w.parseFilterStatement=function parseFilterStatement(){var D=this.peekToken();this.skipSymbol("filter")||this.fail("parseFilterStatement: expected filter");var w=this.parseFilterName(),N=this.parseFilterArgs(w);this.advanceAfterBlockEnd(D.value);var F=new k.Capture(w.lineno,w.colno,this.parseUntilBlocks("endfilter"));this.advanceAfterBlockEnd();var j=new k.Filter(w.lineno,w.colno,w,new k.NodeList(w.lineno,w.colno,[F].concat(N)));return new k.Output(w.lineno,w.colno,[j])},w.parseAggregate=function parseAggregate(){var D,w=this.nextToken();switch(w.type){case F.TOKEN_LEFT_PAREN:D=new k.Group(w.lineno,w.colno);break;case F.TOKEN_LEFT_BRACKET:D=new k.Array(w.lineno,w.colno);break;case F.TOKEN_LEFT_CURLY:D=new k.Dict(w.lineno,w.colno);break;default:return null}for(;;){var N=this.peekToken().type;if(N===F.TOKEN_RIGHT_PAREN||N===F.TOKEN_RIGHT_BRACKET||N===F.TOKEN_RIGHT_CURLY){this.nextToken();break}if(D.children.length>0&&(this.skip(F.TOKEN_COMMA)||this.fail("parseAggregate: expected comma after expression",w.lineno,w.colno)),D instanceof k.Dict){var j=this.parsePrimary();this.skip(F.TOKEN_COLON)||this.fail("parseAggregate: expected colon after dict key",w.lineno,w.colno);var z=this.parseExpression();D.addChild(new k.Pair(j.lineno,j.colno,j,z))}else{var G=this.parseExpression();D.addChild(G)}}return D},w.parseSignature=function parseSignature(D,w){var N=this.peekToken();if(!w&&N.type!==F.TOKEN_LEFT_PAREN){if(D)return null;this.fail("expected arguments",N.lineno,N.colno)}N.type===F.TOKEN_LEFT_PAREN&&(N=this.nextToken());for(var j=new k.NodeList(N.lineno,N.colno),z=new k.KeywordArgs(N.lineno,N.colno),G=!1;;){if(N=this.peekToken(),!w&&N.type===F.TOKEN_RIGHT_PAREN){this.nextToken();break}if(w&&N.type===F.TOKEN_BLOCK_END)break;if(G&&!this.skip(F.TOKEN_COMMA))this.fail("parseSignature: expected comma after expression",N.lineno,N.colno);else{var H=this.parseExpression();this.skipValue(F.TOKEN_OPERATOR,"=")?z.addChild(new k.Pair(H.lineno,H.colno,H,this.parseExpression())):j.addChild(H)}G=!0}return z.children.length&&j.addChild(z),j},w.parseUntilBlocks=function parseUntilBlocks(){for(var D=this.breakOnBlocks,w=arguments.length,N=new Array(w),F=0;F<w;F++)N[F]=arguments[F];this.breakOnBlocks=N;var k=this.parse();return this.breakOnBlocks=D,k},w.parseNodes=function parseNodes(){for(var D,w=[];D=this.nextToken();)if(D.type===F.TOKEN_DATA){var N=D.value,j=this.peekToken(),z=j&&j.value;this.dropLeadingWhitespace&&(N=N.replace(/^\s*/,""),this.dropLeadingWhitespace=!1),j&&(j.type===F.TOKEN_BLOCK_START&&"-"===z.charAt(z.length-1)||j.type===F.TOKEN_VARIABLE_START&&"-"===z.charAt(this.tokens.tags.VARIABLE_START.length)||j.type===F.TOKEN_COMMENT&&"-"===z.charAt(this.tokens.tags.COMMENT_START.length))&&(N=N.replace(/\s*$/,"")),w.push(new k.Output(D.lineno,D.colno,[new k.TemplateData(D.lineno,D.colno,N)]))}else if(D.type===F.TOKEN_BLOCK_START){this.dropLeadingWhitespace=!1;var G=this.parseStatement();if(!G)break;w.push(G)}else if(D.type===F.TOKEN_VARIABLE_START){var H=this.parseExpression();this.dropLeadingWhitespace=!1,this.advanceAfterVariableEnd(),w.push(new k.Output(D.lineno,D.colno,[H]))}else D.type===F.TOKEN_COMMENT?this.dropLeadingWhitespace="-"===D.value.charAt(D.value.length-this.tokens.tags.COMMENT_END.length-1):this.fail("Unexpected token at top-level: "+D.type,D.lineno,D.colno);return w},w.parse=function parse(){return new k.NodeList(0,0,this.parseNodes())},w.parseAsRoot=function parseAsRoot(){return new k.Root(0,0,this.parseNodes())},Parser}(j);D.exports={parse:function parse(D,w,N){var k=new G(F.lex(D,N));return void 0!==w&&(k.extensions=w),k.parseAsRoot()},Parser:G}},function(D,w,N){"use strict";var F=N(0);function token(D,w,N,F){return{type:D,value:w,lineno:N,colno:F}}var k=function(){function Tokenizer(D,w){this.str=D,this.index=0,this.len=D.length,this.lineno=0,this.colno=0,this.in_code=!1;var N=(w=w||{}).tags||{};this.tags={BLOCK_START:N.blockStart||"{%",BLOCK_END:N.blockEnd||"%}",VARIABLE_START:N.variableStart||"{{",VARIABLE_END:N.variableEnd||"}}",COMMENT_START:N.commentStart||"{#",COMMENT_END:N.commentEnd||"#}"},this.trimBlocks=!!w.trimBlocks,this.lstripBlocks=!!w.lstripBlocks}var D=Tokenizer.prototype;return D.nextToken=function nextToken(){var D,w=this.lineno,N=this.colno;if(this.in_code){var k=this.current();if(this.isFinished())return null;if('"'===k||"'"===k)return token("string",this._parseString(k),w,N);if(D=this._extract(" \n\t\r"))return token("whitespace",D,w,N);if((D=this._extractString(this.tags.BLOCK_END))||(D=this._extractString("-"+this.tags.BLOCK_END)))return this.in_code=!1,this.trimBlocks&&("\n"===(k=this.current())?this.forward():"\r"===k&&(this.forward(),"\n"===(k=this.current())?this.forward():this.back())),token("block-end",D,w,N);if((D=this._extractString(this.tags.VARIABLE_END))||(D=this._extractString("-"+this.tags.VARIABLE_END)))return this.in_code=!1,token("variable-end",D,w,N);if("r"===k&&"/"===this.str.charAt(this.index+1)){this.forwardN(2);for(var j="";!this.isFinished();){if("/"===this.current()&&"\\"!==this.previous()){this.forward();break}j+=this.current(),this.forward()}for(var z=["g","i","m","y"],G="";!this.isFinished();){if(!(-1!==z.indexOf(this.current())))break;G+=this.current(),this.forward()}return token("regex",{body:j,flags:G},w,N)}if(-1!=="()[]{}%*-+~/#,:|.<>=!".indexOf(k)){this.forward();var H,X=["==","===","!=","!==","<=",">=","//","**"],q=k+this.current();switch(-1!==F.indexOf(X,q)&&(this.forward(),k=q,-1!==F.indexOf(X,q+this.current())&&(k=q+this.current(),this.forward())),k){case"(":H="left-paren";break;case")":H="right-paren";break;case"[":H="left-bracket";break;case"]":H="right-bracket";break;case"{":H="left-curly";break;case"}":H="right-curly";break;case",":H="comma";break;case":":H="colon";break;case"~":H="tilde";break;case"|":H="pipe";break;default:H="operator"}return token(H,k,w,N)}if((D=this._extractUntil(" \n\t\r()[]{}%*-+~/#,:|.<>=!")).match(/^[-+]?[0-9]+$/))return"."===this.current()?(this.forward(),token("float",D+"."+this._extract("0123456789"),w,N)):token("int",D,w,N);if(D.match(/^(true|false)$/))return token("boolean",D,w,N);if("none"===D)return token("none",D,w,N);if("null"===D)return token("none",D,w,N);if(D)return token("symbol",D,w,N);throw new Error("Unexpected value while parsing: "+D)}var Z,J=this.tags.BLOCK_START.charAt(0)+this.tags.VARIABLE_START.charAt(0)+this.tags.COMMENT_START.charAt(0)+this.tags.COMMENT_END.charAt(0);if(this.isFinished())return null;if((D=this._extractString(this.tags.BLOCK_START+"-"))||(D=this._extractString(this.tags.BLOCK_START)))return this.in_code=!0,token("block-start",D,w,N);if((D=this._extractString(this.tags.VARIABLE_START+"-"))||(D=this._extractString(this.tags.VARIABLE_START)))return this.in_code=!0,token("variable-start",D,w,N);D="";var $=!1;for(this._matches(this.tags.COMMENT_START)&&($=!0,D=this._extractString(this.tags.COMMENT_START));null!==(Z=this._extractUntil(J));){if(D+=Z,(this._matches(this.tags.BLOCK_START)||this._matches(this.tags.VARIABLE_START)||this._matches(this.tags.COMMENT_START))&&!$){if(this.lstripBlocks&&this._matches(this.tags.BLOCK_START)&&this.colno>0&&this.colno<=D.length){var te=D.slice(-this.colno);if(/^\s+$/.test(te)&&!(D=D.slice(0,-this.colno)).length)return this.nextToken()}break}if(this._matches(this.tags.COMMENT_END)){if(!$)throw new Error("unexpected end of comment");D+=this._extractString(this.tags.COMMENT_END);break}D+=this.current(),this.forward()}if(null===Z&&$)throw new Error("expected end of comment, got end of file");return token($?"comment":"data",D,w,N)},D._parseString=function _parseString(D){this.forward();for(var w="";!this.isFinished()&&this.current()!==D;){var N=this.current();if("\\"===N){switch(this.forward(),this.current()){case"n":w+="\n";break;case"t":w+="\t";break;case"r":w+="\r";break;default:w+=this.current()}this.forward()}else w+=N,this.forward()}return this.forward(),w},D._matches=function _matches(D){return this.index+D.length>this.len?null:this.str.slice(this.index,this.index+D.length)===D},D._extractString=function _extractString(D){return this._matches(D)?(this.forwardN(D.length),D):null},D._extractUntil=function _extractUntil(D){return this._extractMatching(!0,D||"")},D._extract=function _extract(D){return this._extractMatching(!1,D)},D._extractMatching=function _extractMatching(D,w){if(this.isFinished())return null;var N=w.indexOf(this.current());if(D&&-1===N||!D&&-1!==N){var F=this.current();this.forward();for(var k=w.indexOf(this.current());(D&&-1===k||!D&&-1!==k)&&!this.isFinished();)F+=this.current(),this.forward(),k=w.indexOf(this.current());return F}return""},D._extractRegex=function _extractRegex(D){var w=this.currentStr().match(D);return w?(this.forwardN(w[0].length),w):null},D.isFinished=function isFinished(){return this.index>=this.len},D.forwardN=function forwardN(D){for(var w=0;w<D;w++)this.forward()},D.forward=function forward(){this.index++,"\n"===this.previous()?(this.lineno++,this.colno=0):this.colno++},D.backN=function backN(D){for(var w=0;w<D;w++)this.back()},D.back=function back(){if(this.index--,"\n"===this.current()){this.lineno--;var D=this.src.lastIndexOf("\n",this.index-1);this.colno=-1===D?this.index:this.index-D}else this.colno--},D.current=function current(){return this.isFinished()?"":this.str.charAt(this.index)},D.currentStr=function currentStr(){return this.isFinished()?"":this.str.substr(this.index)},D.previous=function previous(){return this.str.charAt(this.index-1)},Tokenizer}();D.exports={lex:function lex(D,w){return new k(D,w)},TOKEN_STRING:"string",TOKEN_WHITESPACE:"whitespace",TOKEN_DATA:"data",TOKEN_BLOCK_START:"block-start",TOKEN_BLOCK_END:"block-end",TOKEN_VARIABLE_START:"variable-start",TOKEN_VARIABLE_END:"variable-end",TOKEN_COMMENT:"comment",TOKEN_LEFT_PAREN:"left-paren",TOKEN_RIGHT_PAREN:"right-paren",TOKEN_LEFT_BRACKET:"left-bracket",TOKEN_RIGHT_BRACKET:"right-bracket",TOKEN_LEFT_CURLY:"left-curly",TOKEN_RIGHT_CURLY:"right-curly",TOKEN_OPERATOR:"operator",TOKEN_COMMA:"comma",TOKEN_COLON:"colon",TOKEN_TILDE:"tilde",TOKEN_PIPE:"pipe",TOKEN_INT:"int",TOKEN_FLOAT:"float",TOKEN_BOOLEAN:"boolean",TOKEN_NONE:"none",TOKEN_SYMBOL:"symbol",TOKEN_SPECIAL:"special",TOKEN_REGEX:"regex"}},function(D,w,N){"use strict";var F=N(6),k=N(19).PrecompiledLoader,j=function(D){function WebLoader(w,N){var F;return(F=D.call(this)||this).baseURL=w||".",N=N||{},F.useCache=!!N.useCache,F.async=!!N.async,F}!function _inheritsLoose(D,w){D.prototype=Object.create(w.prototype),D.prototype.constructor=D,D.__proto__=w}(WebLoader,D);var w=WebLoader.prototype;return w.resolve=function resolve(D,w){throw new Error("relative templates not support in the browser yet")},w.getSource=function getSource(D,w){var N,F=this,k=this.useCache;return this.fetch(this.baseURL+"/"+D,(function(j,z){if(j)if(w)w(j.content);else{if(404!==j.status)throw j.content;N=null}else N={src:z,path:D,noCache:!k},F.emit("load",D,N),w&&w(null,N)})),N},w.fetch=function fetch(D,w){if("undefined"==typeof window)throw new Error("WebLoader can only by used in a browser");var N=new XMLHttpRequest,F=!0;N.onreadystatechange=function(){4===N.readyState&&F&&(F=!1,0===N.status||200===N.status?w(null,N.responseText):w({status:N.status,content:N.responseText}))},D+=(-1===D.indexOf("?")?"?":"&")+"s="+(new Date).getTime(),N.open("GET",D,this.async),N.send()},WebLoader}(F);D.exports={WebLoader:j,PrecompiledLoader:k}},function(D,w,N){"use strict";var F,k=N(0),j=N(7),z=j.Environment,G=j.Template,H=N(6),X=N(10),q=N(23),Z=N(5),J=N(8),$=N(9),te=N(2),ie=N(3),oe=N(25);function configure(D,w){var N;return w=w||{},k.isObject(D)&&(w=D,D=null),X.FileSystemLoader?N=new X.FileSystemLoader(D,{watch:w.watch,noCache:w.noCache}):X.WebLoader&&(N=new X.WebLoader(D,{useCache:w.web&&w.web.useCache,async:w.web&&w.web.async})),F=new z(N,w),w&&w.express&&F.express(w.express),F}D.exports={Environment:z,Template:G,Loader:H,FileSystemLoader:X.FileSystemLoader,NodeResolveLoader:X.NodeResolveLoader,PrecompiledLoader:X.PrecompiledLoader,WebLoader:X.WebLoader,compiler:Z,parser:J,lexer:$,runtime:te,lib:k,nodes:ie,installJinjaCompat:oe,configure,reset:function reset(){F=void 0},compile:function compile(D,w,N,k){return F||configure(),new G(D,w,N,k)},render:function render(D,w,N){return F||configure(),F.render(D,w,N)},renderString:function renderString(D,w,N){return F||configure(),F.renderString(D,w,N)},precompile:q?q.precompile:void 0,precompileString:q?q.precompileString:void 0}},function(D,w,N){"use strict";var F=N(13),k=[],j=[],z=F.makeRequestCallFromTimer((function throwFirstError(){if(j.length)throw j.shift()}));function asap(D){var w;(w=k.length?k.pop():new RawTask).task=D,F(w)}function RawTask(){this.task=null}D.exports=asap,RawTask.prototype.call=function(){try{this.task.call()}catch(D){asap.onerror?asap.onerror(D):(j.push(D),z())}finally{this.task=null,k[k.length]=this}}},function(D,w,N){"use strict";(function(w){function rawAsap(D){F.length||(N(),!0),F[F.length]=D}D.exports=rawAsap;var N,F=[],k=0;function flush(){for(;k<F.length;){var D=k;if(k+=1,F[D].call(),k>1024){for(var w=0,N=F.length-k;w<N;w++)F[w]=F[w+k];F.length-=k,k=0}}F.length=0,k=0,!1}var j=void 0!==w?w:self,z=j.MutationObserver||j.WebKitMutationObserver;function makeRequestCallFromTimer(D){return function requestCall(){var w=setTimeout(handleTimer,0),N=setInterval(handleTimer,50);function handleTimer(){clearTimeout(w),clearInterval(N),D()}}}N="function"==typeof z?function makeRequestCallFromMutationObserver(D){var w=1,N=new z(D),F=document.createTextNode("");return N.observe(F,{characterData:!0}),function requestCall(){w=-w,F.data=w}}(flush):makeRequestCallFromTimer(flush),rawAsap.requestFlush=N,rawAsap.makeRequestCallFromTimer=makeRequestCallFromTimer}).call(w,N(14))},function(D,w){var N;N=function(){return this}();try{N=N||Function("return this")()||(0,eval)("this")}catch(D){"object"==typeof window&&(N=window)}D.exports=N},function(D,F,k){var j;!function(k){"use strict";var executeSync=function(){var D=Array.prototype.slice.call(arguments);"function"==typeof D[0]&&D[0].apply(null,D.splice(1))},executeAsync=function(D){"function"==typeof N?N(D):void 0!==w&&w.nextTick?w.nextTick(D):setTimeout(D,0)},z=Array.isArray||function(D){return"[object Array]"===Object.prototype.toString.call(D)},waterfall=function(D,w,N){var F=N?executeAsync:executeSync;if(w=w||function(){},!z(D)){var k=new Error("First argument to waterfall must be an array of functions");return w(k)}if(!D.length)return w();var wrapIterator=function(D){return function(N){if(N)w.apply(null,arguments),w=function(){};else{var k=Array.prototype.slice.call(arguments,1),j=D.next();j?k.push(wrapIterator(j)):k.push(w),F((function(){D.apply(null,k)}))}}};wrapIterator(function(D){var makeCallback=function(w){var fn=function(){return D.length&&D[w].apply(null,arguments),fn.next()};return fn.next=function(){return w<D.length-1?makeCallback(w+1):null},fn};return makeCallback(0)}(D))()};void 0===(j=function(){return waterfall}.apply(F,[]))||(D.exports=j)}()},function(D,w,N){"use strict";var F,k="object"==typeof Reflect?Reflect:null,j=k&&"function"==typeof k.apply?k.apply:function ReflectApply(D,w,N){return Function.prototype.apply.call(D,w,N)};F=k&&"function"==typeof k.ownKeys?k.ownKeys:Object.getOwnPropertySymbols?function ReflectOwnKeys(D){return Object.getOwnPropertyNames(D).concat(Object.getOwnPropertySymbols(D))}:function ReflectOwnKeys(D){return Object.getOwnPropertyNames(D)};var z=Number.isNaN||function NumberIsNaN(D){return D!=D};function EventEmitter(){EventEmitter.init.call(this)}D.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._eventsCount=0,EventEmitter.prototype._maxListeners=void 0;var G=10;function checkListener(D){if("function"!=typeof D)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof D)}function _getMaxListeners(D){return void 0===D._maxListeners?EventEmitter.defaultMaxListeners:D._maxListeners}function _addListener(D,w,N,F){var k,j,z;if(checkListener(N),void 0===(j=D._events)?(j=D._events=Object.create(null),D._eventsCount=0):(void 0!==j.newListener&&(D.emit("newListener",w,N.listener?N.listener:N),j=D._events),z=j[w]),void 0===z)z=j[w]=N,++D._eventsCount;else if("function"==typeof z?z=j[w]=F?[N,z]:[z,N]:F?z.unshift(N):z.push(N),(k=_getMaxListeners(D))>0&&z.length>k&&!z.warned){z.warned=!0;var G=new Error("Possible EventEmitter memory leak detected. "+z.length+" "+String(w)+" listeners added. Use emitter.setMaxListeners() to increase limit");G.name="MaxListenersExceededWarning",G.emitter=D,G.type=w,G.count=z.length,function ProcessEmitWarning(D){console&&console.warn&&console.warn(D)}(G)}return D}function onceWrapper(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _onceWrap(D,w,N){var F={fired:!1,wrapFn:void 0,target:D,type:w,listener:N},k=onceWrapper.bind(F);return k.listener=N,F.wrapFn=k,k}function _listeners(D,w,N){var F=D._events;if(void 0===F)return[];var k=F[w];return void 0===k?[]:"function"==typeof k?N?[k.listener||k]:[k]:N?function unwrapListeners(D){for(var w=new Array(D.length),N=0;N<w.length;++N)w[N]=D[N].listener||D[N];return w}(k):arrayClone(k,k.length)}function listenerCount(D){var w=this._events;if(void 0!==w){var N=w[D];if("function"==typeof N)return 1;if(void 0!==N)return N.length}return 0}function arrayClone(D,w){for(var N=new Array(w),F=0;F<w;++F)N[F]=D[F];return N}Object.defineProperty(EventEmitter,"defaultMaxListeners",{enumerable:!0,get:function(){return G},set:function(D){if("number"!=typeof D||D<0||z(D))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+D+".");G=D}}),EventEmitter.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},EventEmitter.prototype.setMaxListeners=function setMaxListeners(D){if("number"!=typeof D||D<0||z(D))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+D+".");return this._maxListeners=D,this},EventEmitter.prototype.getMaxListeners=function getMaxListeners(){return _getMaxListeners(this)},EventEmitter.prototype.emit=function emit(D){for(var w=[],N=1;N<arguments.length;N++)w.push(arguments[N]);var F="error"===D,k=this._events;if(void 0!==k)F=F&&void 0===k.error;else if(!F)return!1;if(F){var z;if(w.length>0&&(z=w[0]),z instanceof Error)throw z;var G=new Error("Unhandled error."+(z?" ("+z.message+")":""));throw G.context=z,G}var H=k[D];if(void 0===H)return!1;if("function"==typeof H)j(H,this,w);else{var X=H.length,q=arrayClone(H,X);for(N=0;N<X;++N)j(q[N],this,w)}return!0},EventEmitter.prototype.addListener=function addListener(D,w){return _addListener(this,D,w,!1)},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.prependListener=function prependListener(D,w){return _addListener(this,D,w,!0)},EventEmitter.prototype.once=function once(D,w){return checkListener(w),this.on(D,_onceWrap(this,D,w)),this},EventEmitter.prototype.prependOnceListener=function prependOnceListener(D,w){return checkListener(w),this.prependListener(D,_onceWrap(this,D,w)),this},EventEmitter.prototype.removeListener=function removeListener(D,w){var N,F,k,j,z;if(checkListener(w),void 0===(F=this._events))return this;if(void 0===(N=F[D]))return this;if(N===w||N.listener===w)0==--this._eventsCount?this._events=Object.create(null):(delete F[D],F.removeListener&&this.emit("removeListener",D,N.listener||w));else if("function"!=typeof N){for(k=-1,j=N.length-1;j>=0;j--)if(N[j]===w||N[j].listener===w){z=N[j].listener,k=j;break}if(k<0)return this;0===k?N.shift():function spliceOne(D,w){for(;w+1<D.length;w++)D[w]=D[w+1];D.pop()}(N,k),1===N.length&&(F[D]=N[0]),void 0!==F.removeListener&&this.emit("removeListener",D,z||w)}return this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.removeAllListeners=function removeAllListeners(D){var w,N,F;if(void 0===(N=this._events))return this;if(void 0===N.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==N[D]&&(0==--this._eventsCount?this._events=Object.create(null):delete N[D]),this;if(0===arguments.length){var k,j=Object.keys(N);for(F=0;F<j.length;++F)"removeListener"!==(k=j[F])&&this.removeAllListeners(k);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(w=N[D]))this.removeListener(D,w);else if(void 0!==w)for(F=w.length-1;F>=0;F--)this.removeListener(D,w[F]);return this},EventEmitter.prototype.listeners=function listeners(D){return _listeners(this,D,!0)},EventEmitter.prototype.rawListeners=function rawListeners(D){return _listeners(this,D,!1)},EventEmitter.listenerCount=function(D,w){return"function"==typeof D.listenerCount?D.listenerCount(w):listenerCount.call(D,w)},EventEmitter.prototype.listenerCount=listenerCount,EventEmitter.prototype.eventNames=function eventNames(){return this._eventsCount>0?F(this._events):[]}},function(D,w,N){"use strict";var F=N(3),k=N(0),j=0;function gensym(){return"hole_"+j++}function mapCOW(D,w){for(var N=null,F=0;F<D.length;F++){var k=w(D[F]);k!==D[F]&&(N||(N=D.slice()),N[F]=k)}return N||D}function walk(D,w,N){if(!(D instanceof F.Node))return D;if(!N){var k=w(D);if(k&&k!==D)return k}if(D instanceof F.NodeList){var j=mapCOW(D.children,(function(D){return walk(D,w,N)}));j!==D.children&&(D=new F[D.typename](D.lineno,D.colno,j))}else if(D instanceof F.CallExtension){var z=walk(D.args,w,N),G=mapCOW(D.contentArgs,(function(D){return walk(D,w,N)}));z===D.args&&G===D.contentArgs||(D=new F[D.typename](D.extName,D.prop,z,G))}else{var H=D.fields.map((function(w){return D[w]})),X=mapCOW(H,(function(D){return walk(D,w,N)}));X!==H&&(D=new F[D.typename](D.lineno,D.colno),X.forEach((function(w,N){D[D.fields[N]]=w})))}return N&&w(D)||D}function depthWalk(D,w){return walk(D,w,!0)}function _liftFilters(D,w,N){var j=[],z=depthWalk(N?D[N]:D,(function(D){var N;return D instanceof F.Block?D:((D instanceof F.Filter&&-1!==k.indexOf(w,D.name.value)||D instanceof F.CallExtensionAsync)&&(N=new F.Symbol(D.lineno,D.colno,gensym()),j.push(new F.FilterAsync(D.lineno,D.colno,D.name,D.args,N))),N)}));return N?D[N]=z:D=z,j.length?(j.push(D),new F.NodeList(D.lineno,D.colno,j)):D}function cps(D,w){return function convertStatements(D){return depthWalk(D,(function(D){if(D instanceof F.If||D instanceof F.For){var w=!1;if(walk(D,(function(D){if(D instanceof F.FilterAsync||D instanceof F.IfAsync||D instanceof F.AsyncEach||D instanceof F.AsyncAll||D instanceof F.CallExtensionAsync)return w=!0,D})),w){if(D instanceof F.If)return new F.IfAsync(D.lineno,D.colno,D.cond,D.body,D.else_);if(D instanceof F.For&&!(D instanceof F.AsyncAll))return new F.AsyncEach(D.lineno,D.colno,D.arr,D.name,D.body,D.else_)}}}))}(function liftSuper(D){return walk(D,(function(D){if(D instanceof F.Block){var w=!1,N=gensym();D.body=walk(D.body,(function(D){if(D instanceof F.FunCall&&"super"===D.name.value)return w=!0,new F.Symbol(D.lineno,D.colno,N)})),w&&D.body.children.unshift(new F.Super(0,0,D.name,new F.Symbol(0,0,N)))}}))}(function liftFilters(D,w){return depthWalk(D,(function(D){return D instanceof F.Output?_liftFilters(D,w):D instanceof F.Set?_liftFilters(D,w,"value"):D instanceof F.For?_liftFilters(D,w,"arr"):D instanceof F.If?_liftFilters(D,w,"cond"):D instanceof F.CallExtension?_liftFilters(D,w,"args"):void 0}))}(D,w)))}D.exports={transform:function transform(D,w){return cps(D,w||[])}}},function(D,w,N){"use strict";var F=N(0),k=N(2);function normalize(D,w){return null==D||!1===D?w:D}function isNaN(D){return D!=D}function capitalize(D){var w=(D=normalize(D,"")).toLowerCase();return k.copySafeness(D,w.charAt(0).toUpperCase()+w.slice(1))}function list(D){if(F.isString(D))return D.split("");if(F.isObject(D))return F._entries(D||{}).map((function(D){return{key:D[0],value:D[1]}}));if(F.isArray(D))return D;throw new F.TemplateError("list filter: type not iterable")}function trim(D){return k.copySafeness(D,D.replace(/^\s*|\s*$/g,""))}(w=D.exports={}).abs=Math.abs,w.batch=function batch(D,w,N){var F,k=[],j=[];for(F=0;F<D.length;F++)F%w==0&&j.length&&(k.push(j),j=[]),j.push(D[F]);if(j.length){if(N)for(F=j.length;F<w;F++)j.push(N);k.push(j)}return k},w.capitalize=capitalize,w.center=function center(D,w){if(w=w||80,(D=normalize(D,"")).length>=w)return D;var N=w-D.length,j=F.repeat(" ",N/2-N%2),z=F.repeat(" ",N/2);return k.copySafeness(D,j+D+z)},w.default=function default_(D,w,N){return N?D||w:void 0!==D?D:w},w.dictsort=function dictsort(D,w,N){if(!F.isObject(D))throw new F.TemplateError("dictsort filter: val must be an object");var k,j=[];for(var z in D)j.push([z,D[z]]);if(void 0===N||"key"===N)k=0;else{if("value"!==N)throw new F.TemplateError("dictsort filter: You can only sort by either key or value");k=1}return j.sort((function(D,N){var j=D[k],z=N[k];return w||(F.isString(j)&&(j=j.toUpperCase()),F.isString(z)&&(z=z.toUpperCase())),j>z?1:j===z?0:-1})),j},w.dump=function dump(D,w){return JSON.stringify(D,null,w)},w.escape=function escape(D){return D instanceof k.SafeString?D:(D=null==D?"":D,k.markSafe(F.escape(D.toString())))},w.safe=function safe(D){return D instanceof k.SafeString?D:(D=null==D?"":D,k.markSafe(D.toString()))},w.first=function first(D){return D[0]},w.forceescape=function forceescape(D){return D=null==D?"":D,k.markSafe(F.escape(D.toString()))},w.groupby=function groupby(D,w){return F.groupBy(D,w)},w.indent=function indent(D,w,N){if(""===(D=normalize(D,"")))return"";w=w||4;var j=D.split("\n"),z=F.repeat(" ",w),G=j.map((function(D,w){return 0!==w||N?""+z+D+"\n":D+"\n"})).join("");return k.copySafeness(D,G)},w.join=function join(D,w,N){return w=w||"",N&&(D=F.map(D,(function(D){return D[N]}))),D.join(w)},w.last=function last(D){return D[D.length-1]},w.length=function lengthFilter(D){var w=normalize(D,"");return void 0!==w?"function"==typeof Map&&w instanceof Map||"function"==typeof Set&&w instanceof Set?w.size:!F.isObject(w)||w instanceof k.SafeString?w.length:F.keys(w).length:0},w.list=list,w.lower=function lower(D){return(D=normalize(D,"")).toLowerCase()},w.nl2br=function nl2br(D){return null==D?"":k.copySafeness(D,D.replace(/\r\n|\n/g,"<br />\n"))},w.random=function random(D){return D[Math.floor(Math.random()*D.length)]},w.rejectattr=function rejectattr(D,w){return D.filter((function(D){return!D[w]}))},w.selectattr=function selectattr(D,w){return D.filter((function(D){return!!D[w]}))},w.replace=function replace(D,w,N,F){var j=D;if(w instanceof RegExp)return D.replace(w,N);void 0===F&&(F=-1);var z="";if("number"==typeof w)w=""+w;else if("string"!=typeof w)return D;if("number"==typeof D&&(D=""+D),"string"!=typeof D&&!(D instanceof k.SafeString))return D;if(""===w)return z=N+D.split("").join(N)+N,k.copySafeness(D,z);var G=D.indexOf(w);if(0===F||-1===G)return D;for(var H=0,X=0;G>-1&&(-1===F||X<F);)z+=D.substring(H,G)+N,H=G+w.length,X++,G=D.indexOf(w,H);return H<D.length&&(z+=D.substring(H)),k.copySafeness(j,z)},w.reverse=function reverse(D){var w;return(w=F.isString(D)?list(D):F.map(D,(function(D){return D}))).reverse(),F.isString(D)?k.copySafeness(D,w.join("")):w},w.round=function round(D,w,N){w=w||0;var F=Math.pow(10,w);return("ceil"===N?Math.ceil:"floor"===N?Math.floor:Math.round)(D*F)/F},w.slice=function slice(D,w,N){for(var F=Math.floor(D.length/w),k=D.length%w,j=[],z=0,G=0;G<w;G++){var H=z+G*F;G<k&&z++;var X=z+(G+1)*F,q=D.slice(H,X);N&&G>=k&&q.push(N),j.push(q)}return j},w.sum=function sum(D,w,N){return void 0===N&&(N=0),w&&(D=F.map(D,(function(D){return D[w]}))),N+D.reduce((function(D,w){return D+w}),0)},w.sort=k.makeMacro(["value","reverse","case_sensitive","attribute"],[],(function(D,w,N,k){var j=F.map(D,(function(D){return D}));return j.sort((function(D,j){var z=k?D[k]:D,G=k?j[k]:j;return!N&&F.isString(z)&&F.isString(G)&&(z=z.toLowerCase(),G=G.toLowerCase()),z<G?w?1:-1:z>G?w?-1:1:0})),j})),w.string=function string(D){return k.copySafeness(D,D)},w.striptags=function striptags(D,w){var N=trim((D=normalize(D,"")).replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>|<!--[\s\S]*?-->/gi,"")),F="";return F=w?N.replace(/^ +| +$/gm,"").replace(/ +/g," ").replace(/(\r\n)/g,"\n").replace(/\n\n\n+/g,"\n\n"):N.replace(/\s+/gi," "),k.copySafeness(D,F)},w.title=function title(D){var w=(D=normalize(D,"")).split(" ").map((function(D){return capitalize(D)}));return k.copySafeness(D,w.join(" "))},w.trim=trim,w.truncate=function truncate(D,w,N,F){var j=D;if(w=w||255,(D=normalize(D,"")).length<=w)return D;if(N)D=D.substring(0,w);else{var z=D.lastIndexOf(" ",w);-1===z&&(z=w),D=D.substring(0,z)}return D+=null!=F?F:"...",k.copySafeness(j,D)},w.upper=function upper(D){return(D=normalize(D,"")).toUpperCase()},w.urlencode=function urlencode(D){var w=encodeURIComponent;return F.isString(D)?w(D):(F.isArray(D)?D:F._entries(D)).map((function(D){var N=D[0],F=D[1];return w(N)+"="+w(F)})).join("&")};var j=/^(?:\(|<|&lt;)?(.*?)(?:\.|,|\)|\n|&gt;)?$/,z=/^[\w.!#$%&'*+\-\/=?\^`{|}~]+@[a-z\d\-]+(\.[a-z\d\-]+)+$/i,G=/^https?:\/\/.*$/,H=/^www\./,X=/\.(?:org|net|com)(?:\:|\/|$)/;w.urlize=function urlize(D,w,N){isNaN(w)&&(w=1/0);var F=!0===N?' rel="nofollow"':"";return D.split(/(\s+)/).filter((function(D){return D&&D.length})).map((function(D){var N=D.match(j),k=N?N[1]:D,q=k.substr(0,w);return G.test(k)?'<a href="'+k+'"'+F+">"+q+"</a>":H.test(k)?'<a href="http://'+k+'"'+F+">"+q+"</a>":z.test(k)?'<a href="mailto:'+k+'">'+k+"</a>":X.test(k)?'<a href="http://'+k+'"'+F+">"+q+"</a>":D})).join("")},w.wordcount=function wordcount(D){var w=(D=normalize(D,""))?D.match(/\w+/g):null;return w?w.length:null},w.float=function float(D,w){var N=parseFloat(D);return isNaN(N)?w:N},w.int=function int(D,w){var N=parseInt(D,10);return isNaN(N)?w:N},w.d=w.default,w.e=w.escape},function(D,w,N){"use strict";var F=function(D){function PrecompiledLoader(w){var N;return(N=D.call(this)||this).precompiled=w||{},N}return function _inheritsLoose(D,w){D.prototype=Object.create(w.prototype),D.prototype.constructor=D,D.__proto__=w}(PrecompiledLoader,D),PrecompiledLoader.prototype.getSource=function getSource(D){return this.precompiled[D]?{src:{type:"code",obj:this.precompiled[D]},path:D}:null},PrecompiledLoader}(N(6));D.exports={PrecompiledLoader:F}},function(D,w,N){"use strict";var F=N(2).SafeString;w.callable=function callable(D){return"function"==typeof D},w.defined=function defined(D){return void 0!==D},w.divisibleby=function divisibleby(D,w){return D%w==0},w.escaped=function escaped(D){return D instanceof F},w.equalto=function equalto(D,w){return D===w},w.eq=w.equalto,w.sameas=w.equalto,w.even=function even(D){return D%2==0},w.falsy=function falsy(D){return!D},w.ge=function ge(D,w){return D>=w},w.greaterthan=function greaterthan(D,w){return D>w},w.gt=w.greaterthan,w.le=function le(D,w){return D<=w},w.lessthan=function lessthan(D,w){return D<w},w.lt=w.lessthan,w.lower=function lower(D){return D.toLowerCase()===D},w.ne=function ne(D,w){return D!==w},w.null=function nullTest(D){return null===D},w.number=function number(D){return"number"==typeof D},w.odd=function odd(D){return D%2==1},w.string=function string(D){return"string"==typeof D},w.truthy=function truthy(D){return!!D},w.undefined=function undefinedTest(D){return void 0===D},w.upper=function upper(D){return D.toUpperCase()===D},w.iterable=function iterable(D){return"undefined"!=typeof Symbol?!!D[Symbol.iterator]:Array.isArray(D)||"string"==typeof D},w.mapping=function mapping(D){var w=null!=D&&"object"==typeof D&&!Array.isArray(D);return Set?w&&!(D instanceof Set):w}},function(D,w,N){"use strict";function _cycler(D){var w=-1;return{current:null,reset:function reset(){w=-1,this.current=null},next:function next(){return++w>=D.length&&(w=0),this.current=D[w],this.current}}}D.exports=function globals(){return{range:function range(D,w,N){void 0===w?(w=D,D=0,N=1):N||(N=1);var F=[];if(N>0)for(var k=D;k<w;k+=N)F.push(k);else for(var j=D;j>w;j+=N)F.push(j);return F},cycler:function cycler(){return _cycler(Array.prototype.slice.call(arguments))},joiner:function joiner(D){return function _joiner(D){D=D||",";var w=!0;return function(){var N=w?"":D;return w=!1,N}}(D)}}}},function(D,w,N){var F=N(4);D.exports=function express(D,w){function NunjucksView(D,w){if(this.name=D,this.path=D,this.defaultEngine=w.defaultEngine,this.ext=F.extname(D),!this.ext&&!this.defaultEngine)throw new Error("No default engine was specified and no extension was provided.");this.ext||(this.name+=this.ext=("."!==this.defaultEngine[0]?".":"")+this.defaultEngine)}return NunjucksView.prototype.render=function render(w,N){D.render(this.name,w,N)},w.set("view",NunjucksView),w.set("nunjucksEnv",D),D}},function(D,w,N){"use strict";var F=N(4),k=N(4),j=N(0)._prettifyError,z=N(5),G=N(7).Environment,H=N(24);function match(D,w){return!!Array.isArray(w)&&w.some((function(w){return D.match(w)}))}function precompileString(D,w){(w=w||{}).isString=!0;var N=w.env||new G([]),F=w.wrapper||H;if(!w.name)throw new Error('the "name" option is required when compiling a string');return F([_precompile(D,w.name,N)],w)}function _precompile(D,w,N){var F,k=(N=N||new G([])).asyncFilters,H=N.extensionsList;w=w.replace(/\\/g,"/");try{F=z.compile(D,k,H,w,N.opts)}catch(D){throw j(w,!1,D)}return{name:w,template:F}}D.exports={precompile:function precompile(D,w){var N=(w=w||{}).env||new G([]),j=w.wrapper||H;if(w.isString)return precompileString(D,w);var z=F.existsSync(D)&&F.statSync(D),X=[],q=[];if(z.isFile())X.push(_precompile(F.readFileSync(D,"utf-8"),w.name||D,N));else if(z.isDirectory()){!function addTemplates(N){F.readdirSync(N).forEach((function(j){var z=k.join(N,j),G=z.substr(k.join(D,"/").length),H=F.statSync(z);H&&H.isDirectory()?match(G+="/",w.exclude)||addTemplates(z):match(G,w.include)&&q.push(z)}))}(D);for(var Z=0;Z<q.length;Z++){var J=q[Z].replace(k.join(D,"/"),"");try{X.push(_precompile(F.readFileSync(q[Z],"utf-8"),J,N))}catch(D){if(!w.force)throw D;console.error(D)}}}return j(X,w)},precompileString}},function(D,w,N){"use strict";D.exports=function precompileGlobal(D,w){var N="";w=w||{};for(var F=0;F<D.length;F++){var k=JSON.stringify(D[F].name);N+="(function() {(window.nunjucksPrecompiled = window.nunjucksPrecompiled || {})["+k+"] = (function() {\n"+D[F].template+"\n})();\n",w.asFunction&&(N+="return function(ctx, cb) { return nunjucks.render("+k+", ctx, cb); }\n"),N+="})();\n"}return N}},function(D,w,N){D.exports=function installCompat(){"use strict";var D,w,N=this.runtime,F=this.lib,k=this.compiler.Compiler,j=this.parser.Parser,z=this.nodes,G=this.lexer,H=N.contextOrFrameLookup,X=N.memberLookup;function getTokensState(D){return{index:D.index,lineno:D.lineno,colno:D.colno}}if(k&&(D=k.prototype.assertType),j&&(w=j.prototype.parseAggregate),N.contextOrFrameLookup=function contextOrFrameLookup(D,w,N){var F=H.apply(this,arguments);if(void 0!==F)return F;switch(N){case"True":return!0;case"False":return!1;case"None":return null;default:return}},z&&k&&j){var q=z.Node.extend("Slice",{fields:["start","stop","step"],init:function init(D,w,N,F,k){N=N||new z.Literal(D,w,null),F=F||new z.Literal(D,w,null),k=k||new z.Literal(D,w,1),this.parent(D,w,N,F,k)}});k.prototype.assertType=function assertType(w){w instanceof q||D.apply(this,arguments)},k.prototype.compileSlice=function compileSlice(D,w){this._emit("("),this._compileExpression(D.start,w),this._emit("),("),this._compileExpression(D.stop,w),this._emit("),("),this._compileExpression(D.step,w),this._emit(")")},j.prototype.parseAggregate=function parseAggregate(){var D=this,N=getTokensState(this.tokens);N.colno--,N.index--;try{return w.apply(this)}catch(w){var k=getTokensState(this.tokens),j=function rethrow(){return F._assign(D.tokens,k),w};F._assign(this.tokens,N),this.peeked=!1;var H=this.peekToken();if(H.type!==G.TOKEN_LEFT_BRACKET)throw j();this.nextToken();for(var X=new q(H.lineno,H.colno),Z=!1,J=0;J<=X.fields.length&&!this.skip(G.TOKEN_RIGHT_BRACKET);J++){if(J===X.fields.length){if(!Z)break;this.fail("parseSlice: too many slice components",H.lineno,H.colno)}this.skip(G.TOKEN_COLON)?Z=!0:(X[X.fields[J]]=this.parseExpression(),Z=this.skip(G.TOKEN_COLON)||Z)}if(!Z)throw j();return new z.Array(H.lineno,H.colno,[X])}}}function sliceLookup(D,w,F,k){D=D||[],null===w&&(w=k<0?D.length-1:0),null===F?F=k<0?-1:D.length:F<0&&(F+=D.length),w<0&&(w+=D.length);for(var j=[],z=w;!(z<0||z>D.length)&&!(k>0&&z>=F)&&!(k<0&&z<=F);z+=k)j.push(N.memberLookup(D,z));return j}function hasOwnProp(D,w){return Object.prototype.hasOwnProperty.call(D,w)}var Z={pop:function pop(D){if(void 0===D)return this.pop();if(D>=this.length||D<0)throw new Error("KeyError");return this.splice(D,1)},append:function append(D){return this.push(D)},remove:function remove(D){for(var w=0;w<this.length;w++)if(this[w]===D)return this.splice(w,1);throw new Error("ValueError")},count:function count(D){for(var count=0,w=0;w<this.length;w++)this[w]===D&&count++;return count},index:function index(D){var w;if(-1===(w=this.indexOf(D)))throw new Error("ValueError");return w},find:function find(D){return this.indexOf(D)},insert:function insert(D,w){return this.splice(D,0,w)}},J={items:function items(){return F._entries(this)},values:function values(){return F._values(this)},keys:function keys(){return F.keys(this)},get:function get(D,w){var N=this[D];return void 0===N&&(N=w),N},has_key:function has_key(D){return hasOwnProp(this,D)},pop:function pop(D,w){var N=this[D];if(void 0===N&&void 0!==w)N=w;else{if(void 0===N)throw new Error("KeyError");delete this[D]}return N},popitem:function popitem(){var D=F.keys(this);if(!D.length)throw new Error("KeyError");var w=D[0],N=this[w];return delete this[w],[w,N]},setdefault:function setdefault(D,w){return void 0===w&&(w=null),D in this||(this[D]=w),this[D]},update:function update(D){return F._assign(this,D),null}};return J.iteritems=J.items,J.itervalues=J.values,J.iterkeys=J.keys,N.memberLookup=function memberLookup(D,w,N){return 4===arguments.length?sliceLookup.apply(this,arguments):(D=D||{},F.isArray(D)&&hasOwnProp(Z,w)?Z[w].bind(D):F.isObject(D)&&hasOwnProp(J,w)?J[w].bind(D):X.apply(this,arguments))},function uninstall(){N.contextOrFrameLookup=H,N.memberLookup=X,k&&(k.prototype.assertType=D),j&&(j.prototype.parseAggregate=w)}}}])}))}).call(this,N(7),N(19).setImmediate)},function(D,w,N){(function(D,w){var N;!function(N){!function(F){var k="object"==typeof w?w:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),j=makeExporter(N);function makeExporter(D,w){return function(N,F){"function"!=typeof D[N]&&Object.defineProperty(D,N,{configurable:!0,writable:!0,value:F}),w&&w(N,F)}}void 0===k.Reflect?k.Reflect=N:j=makeExporter(k.Reflect,j),function(w){var N=Object.prototype.hasOwnProperty,F="function"==typeof Symbol,k=F&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",j=F&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",z="function"==typeof Object.create,G={__proto__:[]}instanceof Array,H=!z&&!G,X={create:z?function(){return MakeDictionary(Object.create(null))}:G?function(){return MakeDictionary({__proto__:null})}:function(){return MakeDictionary({})},has:H?function(D,w){return N.call(D,w)}:function(D,w){return w in D},get:H?function(D,w){return N.call(D,w)?D[w]:void 0}:function(D,w){return D[w]}},q=Object.getPrototypeOf(Function),Z="object"==typeof D&&D.env&&"true"===D.env.REFLECT_METADATA_USE_MAP_POLYFILL,J=Z||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?function CreateMapPolyfill(){var D={},w=[],N=function(){function MapIterator(D,w,N){this._index=0,this._keys=D,this._values=w,this._selector=N}return MapIterator.prototype["@@iterator"]=function(){return this},MapIterator.prototype[j]=function(){return this},MapIterator.prototype.next=function(){var D=this._index;if(D>=0&&D<this._keys.length){var N=this._selector(this._keys[D],this._values[D]);return D+1>=this._keys.length?(this._index=-1,this._keys=w,this._values=w):this._index++,{value:N,done:!1}}return{value:void 0,done:!0}},MapIterator.prototype.throw=function(D){throw this._index>=0&&(this._index=-1,this._keys=w,this._values=w),D},MapIterator.prototype.return=function(D){return this._index>=0&&(this._index=-1,this._keys=w,this._values=w),{value:D,done:!0}},MapIterator}();return function(){function Map(){this._keys=[],this._values=[],this._cacheKey=D,this._cacheIndex=-2}return Object.defineProperty(Map.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),Map.prototype.has=function(D){return this._find(D,!1)>=0},Map.prototype.get=function(D){var w=this._find(D,!1);return w>=0?this._values[w]:void 0},Map.prototype.set=function(D,w){var N=this._find(D,!0);return this._values[N]=w,this},Map.prototype.delete=function(w){var N=this._find(w,!1);if(N>=0){for(var F=this._keys.length,k=N+1;k<F;k++)this._keys[k-1]=this._keys[k],this._values[k-1]=this._values[k];return this._keys.length--,this._values.length--,w===this._cacheKey&&(this._cacheKey=D,this._cacheIndex=-2),!0}return!1},Map.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=D,this._cacheIndex=-2},Map.prototype.keys=function(){return new N(this._keys,this._values,getKey)},Map.prototype.values=function(){return new N(this._keys,this._values,getValue)},Map.prototype.entries=function(){return new N(this._keys,this._values,getEntry)},Map.prototype["@@iterator"]=function(){return this.entries()},Map.prototype[j]=function(){return this.entries()},Map.prototype._find=function(D,w){return this._cacheKey!==D&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=D)),this._cacheIndex<0&&w&&(this._cacheIndex=this._keys.length,this._keys.push(D),this._values.push(void 0)),this._cacheIndex},Map}();function getKey(D,w){return D}function getValue(D,w){return w}function getEntry(D,w){return[D,w]}}():Map,$=Z||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?function CreateSetPolyfill(){return function(){function Set(){this._map=new J}return Object.defineProperty(Set.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Set.prototype.has=function(D){return this._map.has(D)},Set.prototype.add=function(D){return this._map.set(D,D),this},Set.prototype.delete=function(D){return this._map.delete(D)},Set.prototype.clear=function(){this._map.clear()},Set.prototype.keys=function(){return this._map.keys()},Set.prototype.values=function(){return this._map.values()},Set.prototype.entries=function(){return this._map.entries()},Set.prototype["@@iterator"]=function(){return this.keys()},Set.prototype[j]=function(){return this.keys()},Set}()}():Set,te=new(Z||"function"!=typeof WeakMap?function CreateWeakMapPolyfill(){var D=X.create(),w=CreateUniqueKey();return function(){function WeakMap(){this._key=CreateUniqueKey()}return WeakMap.prototype.has=function(D){var w=GetOrCreateWeakMapTable(D,!1);return void 0!==w&&X.has(w,this._key)},WeakMap.prototype.get=function(D){var w=GetOrCreateWeakMapTable(D,!1);return void 0!==w?X.get(w,this._key):void 0},WeakMap.prototype.set=function(D,w){return GetOrCreateWeakMapTable(D,!0)[this._key]=w,this},WeakMap.prototype.delete=function(D){var w=GetOrCreateWeakMapTable(D,!1);return void 0!==w&&delete w[this._key]},WeakMap.prototype.clear=function(){this._key=CreateUniqueKey()},WeakMap}();function CreateUniqueKey(){var w;do{w="@@WeakMap@@"+CreateUUID()}while(X.has(D,w));return D[w]=!0,w}function GetOrCreateWeakMapTable(D,F){if(!N.call(D,w)){if(!F)return;Object.defineProperty(D,w,{value:X.create()})}return D[w]}function FillRandomBytes(D,w){for(var N=0;N<w;++N)D[N]=255*Math.random()|0;return D}function CreateUUID(){var D=function GenRandomBytes(D){return"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(D)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(D)):FillRandomBytes(new Uint8Array(D),D):FillRandomBytes(new Array(D),D)}(16);D[6]=79&D[6]|64,D[8]=191&D[8]|128;for(var w="",N=0;N<16;++N){var F=D[N];4!==N&&6!==N&&8!==N||(w+="-"),F<16&&(w+="0"),w+=F.toString(16).toLowerCase()}return w}}():WeakMap);function GetOrCreateMetadataMap(D,w,N){var F=te.get(D);if(IsUndefined(F)){if(!N)return;F=new J,te.set(D,F)}var k=F.get(w);if(IsUndefined(k)){if(!N)return;k=new J,F.set(w,k)}return k}function OrdinaryHasOwnMetadata(D,w,N){var F=GetOrCreateMetadataMap(w,N,!1);return!IsUndefined(F)&&function ToBoolean(D){return!!D}(F.has(D))}function OrdinaryGetOwnMetadata(D,w,N){var F=GetOrCreateMetadataMap(w,N,!1);if(!IsUndefined(F))return F.get(D)}function OrdinaryDefineOwnMetadata(D,w,N,F){GetOrCreateMetadataMap(N,F,!0).set(D,w)}function OrdinaryOwnMetadataKeys(D,w){var N=[],F=GetOrCreateMetadataMap(D,w,!1);if(IsUndefined(F))return N;for(var k=function GetIterator(D){var w=GetMethod(D,j);if(!IsCallable(w))throw new TypeError;var N=w.call(D);if(!IsObject(N))throw new TypeError;return N}(F.keys()),z=0;;){var G=IteratorStep(k);if(!G)return N.length=z,N;var H=G.value;try{N[z]=H}catch(D){try{IteratorClose(k)}finally{throw D}}z++}}function Type(D){if(null===D)return 1;switch(typeof D){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===D?1:6;default:return 6}}function IsUndefined(D){return void 0===D}function IsNull(D){return null===D}function IsObject(D){return"object"==typeof D?null!==D:"function"==typeof D}function ToPrimitive(D,w){switch(Type(D)){case 0:case 1:case 2:case 3:case 4:case 5:return D}var N=3===w?"string":5===w?"number":"default",F=GetMethod(D,k);if(void 0!==F){var j=F.call(D,N);if(IsObject(j))throw new TypeError;return j}return function OrdinaryToPrimitive(D,w){if("string"===w){var N=D.toString;if(IsCallable(N))if(!IsObject(k=N.call(D)))return k;if(IsCallable(F=D.valueOf))if(!IsObject(k=F.call(D)))return k}else{var F;if(IsCallable(F=D.valueOf))if(!IsObject(k=F.call(D)))return k;var k,j=D.toString;if(IsCallable(j))if(!IsObject(k=j.call(D)))return k}throw new TypeError}(D,"default"===N?"number":N)}function ToPropertyKey(D){var w=ToPrimitive(D,3);return function IsSymbol(D){return"symbol"==typeof D}(w)?w:function ToString(D){return""+D}(w)}function IsArray(D){return Array.isArray?Array.isArray(D):D instanceof Object?D instanceof Array:"[object Array]"===Object.prototype.toString.call(D)}function IsCallable(D){return"function"==typeof D}function IsConstructor(D){return"function"==typeof D}function GetMethod(D,w){var N=D[w];if(null!=N){if(!IsCallable(N))throw new TypeError;return N}}function IteratorStep(D){var w=D.next();return!w.done&&w}function IteratorClose(D){var w=D.return;w&&w.call(D)}function OrdinaryGetPrototypeOf(D){var w=Object.getPrototypeOf(D);if("function"!=typeof D||D===q)return w;if(w!==q)return w;var N=D.prototype,F=N&&Object.getPrototypeOf(N);if(null==F||F===Object.prototype)return w;var k=F.constructor;return"function"!=typeof k||k===D?w:k}function MakeDictionary(D){return D.__=void 0,delete D.__,D}w("decorate",(function decorate(D,w,N,F){if(IsUndefined(N)){if(!IsArray(D))throw new TypeError;if(!IsConstructor(w))throw new TypeError;return function DecorateConstructor(D,w){for(var N=D.length-1;N>=0;--N){var F=(0,D[N])(w);if(!IsUndefined(F)&&!IsNull(F)){if(!IsConstructor(F))throw new TypeError;w=F}}return w}(D,w)}if(!IsArray(D))throw new TypeError;if(!IsObject(w))throw new TypeError;if(!IsObject(F)&&!IsUndefined(F)&&!IsNull(F))throw new TypeError;return IsNull(F)&&(F=void 0),function DecorateProperty(D,w,N,F){for(var k=D.length-1;k>=0;--k){var j=(0,D[k])(w,N,F);if(!IsUndefined(j)&&!IsNull(j)){if(!IsObject(j))throw new TypeError;F=j}}return F}(D,w,N=ToPropertyKey(N),F)})),w("metadata",(function metadata(D,w){return function decorator(N,F){if(!IsObject(N))throw new TypeError;if(!IsUndefined(F)&&!function IsPropertyKey(D){switch(Type(D)){case 3:case 4:return!0;default:return!1}}(F))throw new TypeError;OrdinaryDefineOwnMetadata(D,w,N,F)}})),w("defineMetadata",(function defineMetadata(D,w,N,F){if(!IsObject(N))throw new TypeError;return IsUndefined(F)||(F=ToPropertyKey(F)),OrdinaryDefineOwnMetadata(D,w,N,F)})),w("hasMetadata",(function hasMetadata(D,w,N){if(!IsObject(w))throw new TypeError;return IsUndefined(N)||(N=ToPropertyKey(N)),function OrdinaryHasMetadata(D,w,N){if(OrdinaryHasOwnMetadata(D,w,N))return!0;var F=OrdinaryGetPrototypeOf(w);return!IsNull(F)&&OrdinaryHasMetadata(D,F,N)}(D,w,N)})),w("hasOwnMetadata",(function hasOwnMetadata(D,w,N){if(!IsObject(w))throw new TypeError;return IsUndefined(N)||(N=ToPropertyKey(N)),OrdinaryHasOwnMetadata(D,w,N)})),w("getMetadata",(function getMetadata(D,w,N){if(!IsObject(w))throw new TypeError;return IsUndefined(N)||(N=ToPropertyKey(N)),function OrdinaryGetMetadata(D,w,N){if(OrdinaryHasOwnMetadata(D,w,N))return OrdinaryGetOwnMetadata(D,w,N);var F=OrdinaryGetPrototypeOf(w);return IsNull(F)?void 0:OrdinaryGetMetadata(D,F,N)}(D,w,N)})),w("getOwnMetadata",(function getOwnMetadata(D,w,N){if(!IsObject(w))throw new TypeError;return IsUndefined(N)||(N=ToPropertyKey(N)),OrdinaryGetOwnMetadata(D,w,N)})),w("getMetadataKeys",(function getMetadataKeys(D,w){if(!IsObject(D))throw new TypeError;return IsUndefined(w)||(w=ToPropertyKey(w)),function OrdinaryMetadataKeys(D,w){var N=OrdinaryOwnMetadataKeys(D,w),F=OrdinaryGetPrototypeOf(D);if(null===F)return N;var k=OrdinaryMetadataKeys(F,w);if(k.length<=0)return N;if(N.length<=0)return k;for(var j=new $,z=[],G=0,H=N;G<H.length;G++){var X=H[G];j.has(X)||(j.add(X),z.push(X))}for(var q=0,Z=k;q<Z.length;q++){X=Z[q];j.has(X)||(j.add(X),z.push(X))}return z}(D,w)})),w("getOwnMetadataKeys",(function getOwnMetadataKeys(D,w){if(!IsObject(D))throw new TypeError;return IsUndefined(w)||(w=ToPropertyKey(w)),OrdinaryOwnMetadataKeys(D,w)})),w("deleteMetadata",(function deleteMetadata(D,w,N){if(!IsObject(w))throw new TypeError;IsUndefined(N)||(N=ToPropertyKey(N));var F=GetOrCreateMetadataMap(w,N,!1);if(IsUndefined(F))return!1;if(!F.delete(D))return!1;if(F.size>0)return!0;var k=te.get(w);return k.delete(N),k.size>0||te.delete(w),!0}))}(j)}()}(N||(N={}))}).call(this,N(7),N(6))},function(D,w){D.exports={PATH_SEPARATOR:".",TARGET:Symbol("target"),UNSUBSCRIBE:Symbol("unsubscribe")}},function(D,w,N){"use strict";D.exports=Array.isArray},function(D,w,N){"use strict";D.exports=D=>"symbol"==typeof D},function(D,w){D.exports=function(D){return D.webpackPolyfill||(D.deprecate=function(){},D.paths=[],D.children||(D.children=[]),Object.defineProperty(D,"loaded",{enumerable:!0,get:function(){return D.l}}),Object.defineProperty(D,"id",{enumerable:!0,get:function(){return D.i}}),D.webpackPolyfill=1),D}},,,function(D,w){var N=Object.prototype.toString;function ctorName(D){return"function"==typeof D.constructor?D.constructor.name:null}D.exports=function kindOf(D){if(void 0===D)return"undefined";if(null===D)return"null";var w=typeof D;if("boolean"===w)return"boolean";if("string"===w)return"string";if("number"===w)return"number";if("symbol"===w)return"symbol";if("function"===w)return function isGeneratorFn(D,w){return"GeneratorFunction"===ctorName(D)}(D)?"generatorfunction":"function";if(function isArray(D){return Array.isArray?Array.isArray(D):D instanceof Array}(D))return"array";if(function isBuffer(D){if(D.constructor&&"function"==typeof D.constructor.isBuffer)return D.constructor.isBuffer(D);return!1}(D))return"buffer";if(function isArguments(D){try{if("number"==typeof D.length&&"function"==typeof D.callee)return!0}catch(D){if(-1!==D.message.indexOf("callee"))return!0}return!1}(D))return"arguments";if(function isDate(D){return D instanceof Date||"function"==typeof D.toDateString&&"function"==typeof D.getDate&&"function"==typeof D.setDate}(D))return"date";if(function isError(D){return D instanceof Error||"string"==typeof D.message&&D.constructor&&"number"==typeof D.constructor.stackTraceLimit}(D))return"error";if(function isRegexp(D){return D instanceof RegExp||"string"==typeof D.flags&&"boolean"==typeof D.ignoreCase&&"boolean"==typeof D.multiline&&"boolean"==typeof D.global}(D))return"regexp";switch(ctorName(D)){case"Symbol":return"symbol";case"Promise":return"promise";case"WeakMap":return"weakmap";case"WeakSet":return"weakset";case"Map":return"map";case"Set":return"set";case"Int8Array":return"int8array";case"Uint8Array":return"uint8array";case"Uint8ClampedArray":return"uint8clampedarray";case"Int16Array":return"int16array";case"Uint16Array":return"uint16array";case"Int32Array":return"int32array";case"Uint32Array":return"uint32array";case"Float32Array":return"float32array";case"Float64Array":return"float64array"}if(function isGeneratorObj(D){return"function"==typeof D.throw&&"function"==typeof D.return&&"function"==typeof D.next}(D))return"generator";switch(w=N.call(D)){case"[object Object]":return"object";case"[object Map Iterator]":return"mapiterator";case"[object Set Iterator]":return"setiterator";case"[object String Iterator]":return"stringiterator";case"[object Array Iterator]":return"arrayiterator"}return w.slice(8,-1).toLowerCase().replace(/\s/g,"")}},,function(D,w,N){"use strict";Object.defineProperty(w,"__esModule",{value:!0});const dummyFn=()=>{},dummyDecorator=()=>dummyFn;w.Arg=dummyDecorator,w.Args=dummyDecorator,w.ArgsType=dummyDecorator,w.Authorized=dummyDecorator,w.Ctx=dummyDecorator,w.registerEnumType=dummyFn,w.Field=dummyDecorator,w.FieldResolver=dummyDecorator,w.Info=dummyDecorator,w.InputType=dummyDecorator,w.InterfaceType=dummyDecorator,w.Mutation=dummyDecorator,w.ObjectType=dummyDecorator,w.PubSub=dummyDecorator,w.Query=dummyDecorator,w.Resolver=dummyDecorator,w.Root=dummyDecorator,w.Subscription=dummyDecorator,w.createUnionType=dummyFn,w.UseMiddleware=dummyDecorator},,,,,,,,,,,,,function(D,w,N){!function(D){"use strict";D.defineLocale("af",{months:"Januarie_Februarie_Maart_April_Mei_Junie_Julie_Augustus_September_Oktober_November_Desember".split("_"),monthsShort:"Jan_Feb_Mrt_Apr_Mei_Jun_Jul_Aug_Sep_Okt_Nov_Des".split("_"),weekdays:"Sondag_Maandag_Dinsdag_Woensdag_Donderdag_Vrydag_Saterdag".split("_"),weekdaysShort:"Son_Maa_Din_Woe_Don_Vry_Sat".split("_"),weekdaysMin:"So_Ma_Di_Wo_Do_Vr_Sa".split("_"),meridiemParse:/vm|nm/i,isPM:function(D){return/^nm$/i.test(D)},meridiem:function(D,w,N){return D<12?N?"vm":"VM":N?"nm":"NM"},longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Vandag om] LT",nextDay:"[Mre om] LT",nextWeek:"dddd [om] LT",lastDay:"[Gister om] LT",lastWeek:"[Laas] dddd [om] LT",sameElse:"L"},relativeTime:{future:"oor %s",past:"%s gelede",s:"'n paar sekondes",ss:"%d sekondes",m:"'n minuut",mm:"%d minute",h:"'n uur",hh:"%d ure",d:"'n dag",dd:"%d dae",M:"'n maand",MM:"%d maande",y:"'n jaar",yy:"%d jaar"},dayOfMonthOrdinalParse:/\d{1,2}(ste|de)/,ordinal:function(D){return D+(1===D||8===D||D>=20?"ste":"de")},week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";var w={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},N={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"},pluralForm=function(D){return 0===D?0:1===D?1:2===D?2:D%100>=3&&D%100<=10?3:D%100>=11?4:5},F={s:["  "," ",["",""],"%d ","%d ","%d "],m:["  "," ",["",""],"%d ","%d ","%d "],h:["  "," ",["",""],"%d ","%d ","%d "],d:["  "," ",["",""],"%d ","%d ","%d "],M:["  "," ",["",""],"%d ","%d ","%d "],y:["  "," ",["",""],"%d ","%d ","%d "]},pluralize=function(D){return function(w,N,k,j){var z=pluralForm(w),G=F[D][pluralForm(w)];return 2===z&&(G=G[N?0:1]),G.replace(/%d/i,w)}},k=["","","","","","","","","","","",""];D.defineLocale("ar",{months:k,monthsShort:k,weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"D/M/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},meridiemParse:/|/,isPM:function(D){return""===D},meridiem:function(D,w,N){return D<12?"":""},calendar:{sameDay:"[  ] LT",nextDay:"[  ] LT",nextWeek:"dddd [ ] LT",lastDay:"[  ] LT",lastWeek:"dddd [ ] LT",sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:pluralize("s"),ss:pluralize("s"),m:pluralize("m"),mm:pluralize("m"),h:pluralize("h"),hh:pluralize("h"),d:pluralize("d"),dd:pluralize("d"),M:pluralize("M"),MM:pluralize("M"),y:pluralize("y"),yy:pluralize("y")},preparse:function(D){return D.replace(/[]/g,(function(D){return N[D]})).replace(//g,",")},postformat:function(D){return D.replace(/\d/g,(function(D){return w[D]})).replace(/,/g,"")},week:{dow:6,doy:12}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("ar-dz",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[  ] LT",nextDay:"[  ] LT",nextWeek:"dddd [ ] LT",lastDay:"[  ] LT",lastWeek:"dddd [ ] LT",sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:"",ss:"%d ",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},week:{dow:0,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("ar-kw",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[  ] LT",nextDay:"[  ] LT",nextWeek:"dddd [ ] LT",lastDay:"[  ] LT",lastWeek:"dddd [ ] LT",sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:"",ss:"%d ",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},week:{dow:0,doy:12}})}(N(0))},function(D,w,N){!function(D){"use strict";var w={1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",0:"0"},pluralForm=function(D){return 0===D?0:1===D?1:2===D?2:D%100>=3&&D%100<=10?3:D%100>=11?4:5},N={s:["  "," ",["",""],"%d ","%d ","%d "],m:["  "," ",["",""],"%d ","%d ","%d "],h:["  "," ",["",""],"%d ","%d ","%d "],d:["  "," ",["",""],"%d ","%d ","%d "],M:["  "," ",["",""],"%d ","%d ","%d "],y:["  "," ",["",""],"%d ","%d ","%d "]},pluralize=function(D){return function(w,F,k,j){var z=pluralForm(w),G=N[D][pluralForm(w)];return 2===z&&(G=G[F?0:1]),G.replace(/%d/i,w)}},F=["","","","","","","","","","","",""];D.defineLocale("ar-ly",{months:F,monthsShort:F,weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"D/M/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},meridiemParse:/|/,isPM:function(D){return""===D},meridiem:function(D,w,N){return D<12?"":""},calendar:{sameDay:"[  ] LT",nextDay:"[  ] LT",nextWeek:"dddd [ ] LT",lastDay:"[  ] LT",lastWeek:"dddd [ ] LT",sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:pluralize("s"),ss:pluralize("s"),m:pluralize("m"),mm:pluralize("m"),h:pluralize("h"),hh:pluralize("h"),d:pluralize("d"),dd:pluralize("d"),M:pluralize("M"),MM:pluralize("M"),y:pluralize("y"),yy:pluralize("y")},preparse:function(D){return D.replace(//g,",")},postformat:function(D){return D.replace(/\d/g,(function(D){return w[D]})).replace(/,/g,"")},week:{dow:6,doy:12}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("ar-ma",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[  ] LT",nextDay:"[  ] LT",nextWeek:"dddd [ ] LT",lastDay:"[  ] LT",lastWeek:"dddd [ ] LT",sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:"",ss:"%d ",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},week:{dow:6,doy:12}})}(N(0))},function(D,w,N){!function(D){"use strict";var w={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},N={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};D.defineLocale("ar-sa",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},meridiemParse:/|/,isPM:function(D){return""===D},meridiem:function(D,w,N){return D<12?"":""},calendar:{sameDay:"[  ] LT",nextDay:"[  ] LT",nextWeek:"dddd [ ] LT",lastDay:"[  ] LT",lastWeek:"dddd [ ] LT",sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:"",ss:"%d ",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},preparse:function(D){return D.replace(/[]/g,(function(D){return N[D]})).replace(//g,",")},postformat:function(D){return D.replace(/\d/g,(function(D){return w[D]})).replace(/,/g,"")},week:{dow:0,doy:6}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("ar-tn",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[  ] LT",nextDay:"[  ] LT",nextWeek:"dddd [ ] LT",lastDay:"[  ] LT",lastWeek:"dddd [ ] LT",sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:"",ss:"%d ",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";var w={1:"-inci",5:"-inci",8:"-inci",70:"-inci",80:"-inci",2:"-nci",7:"-nci",20:"-nci",50:"-nci",3:"-nc",4:"-nc",100:"-nc",6:"-nc",9:"-uncu",10:"-uncu",30:"-uncu",60:"-nc",90:"-nc"};D.defineLocale("az",{months:"yanvar_fevral_mart_aprel_may_iyun_iyul_avqust_sentyabr_oktyabr_noyabr_dekabr".split("_"),monthsShort:"yan_fev_mar_apr_may_iyn_iyl_avq_sen_okt_noy_dek".split("_"),weekdays:"Bazar_Bazar ertsi_rnb axam_rnb_Cm axam_Cm_nb".split("_"),weekdaysShort:"Baz_BzE_Ax_r_CAx_Cm_n".split("_"),weekdaysMin:"Bz_BE_A__CA_C_".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[bugn saat] LT",nextDay:"[sabah saat] LT",nextWeek:"[gln hft] dddd [saat] LT",lastDay:"[dnn] LT",lastWeek:"[ken hft] dddd [saat] LT",sameElse:"L"},relativeTime:{future:"%s sonra",past:"%s vvl",s:"birne saniy",ss:"%d saniy",m:"bir dqiq",mm:"%d dqiq",h:"bir saat",hh:"%d saat",d:"bir gn",dd:"%d gn",M:"bir ay",MM:"%d ay",y:"bir il",yy:"%d il"},meridiemParse:/gec|shr|gndz|axam/,isPM:function(D){return/^(gndz|axam)$/.test(D)},meridiem:function(D,w,N){return D<4?"gec":D<12?"shr":D<17?"gndz":"axam"},dayOfMonthOrdinalParse:/\d{1,2}-(nc|inci|nci|nc|nc|uncu)/,ordinal:function(D){if(0===D)return D+"-nc";var N=D%10;return D+(w[N]||w[D%100-N]||w[D>=100?100:null])},week:{dow:1,doy:7}})}(N(0))},function(D,w,N){!function(D){"use strict";function relativeTimeWithPlural(D,w,N){return"m"===N?w?"":"":"h"===N?w?"":"":D+" "+function plural(D,w){var N=D.split("_");return w%10==1&&w%100!=11?N[0]:w%10>=2&&w%10<=4&&(w%100<10||w%100>=20)?N[1]:N[2]}({ss:w?"__":"__",mm:w?"__":"__",hh:w?"__":"__",dd:"__",MM:"__",yy:"__"}[N],+D)}D.defineLocale("be",{months:{format:"___________".split("_"),standalone:"___________".split("_")},monthsShort:"___________".split("_"),weekdays:{format:"______".split("_"),standalone:"______".split("_"),isFormat:/\[ ?[] ?(?:|)? ?\] ?dddd/},weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY .",LLL:"D MMMM YYYY ., HH:mm",LLLL:"dddd, D MMMM YYYY ., HH:mm"},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",lastDay:"[ ] LT",nextWeek:function(){return"[] dddd [] LT"},lastWeek:function(){switch(this.day()){case 0:case 3:case 5:case 6:return"[ ] dddd [] LT";case 1:case 2:case 4:return"[ ] dddd [] LT"}},sameElse:"L"},relativeTime:{future:" %s",past:"%s ",s:" ",m:relativeTimeWithPlural,mm:relativeTimeWithPlural,h:relativeTimeWithPlural,hh:relativeTimeWithPlural,d:"",dd:relativeTimeWithPlural,M:"",MM:relativeTimeWithPlural,y:"",yy:relativeTimeWithPlural},meridiemParse:/|||/,isPM:function(D){return/^(|)$/.test(D)},meridiem:function(D,w,N){return D<4?"":D<12?"":D<17?"":""},dayOfMonthOrdinalParse:/\d{1,2}-(||)/,ordinal:function(D,w){switch(w){case"M":case"d":case"DDD":case"w":case"W":return D%10!=2&&D%10!=3||D%100==12||D%100==13?D+"-":D+"-";case"D":return D+"-";default:return D}},week:{dow:1,doy:7}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("bg",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"D.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY H:mm",LLLL:"dddd, D MMMM YYYY H:mm"},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"dddd [] LT",lastDay:"[ ] LT",lastWeek:function(){switch(this.day()){case 0:case 3:case 6:return"[ ] dddd [] LT";case 1:case 2:case 4:case 5:return"[ ] dddd [] LT"}},sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:" ",ss:"%d ",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},dayOfMonthOrdinalParse:/\d{1,2}-(|||||)/,ordinal:function(D){var w=D%10,N=D%100;return 0===D?D+"-":0===N?D+"-":N>10&&N<20?D+"-":1===w?D+"-":2===w?D+"-":7===w||8===w?D+"-":D+"-"},week:{dow:1,doy:7}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("bm",{months:"Zanwuyekalo_Fewuruyekalo_Marisikalo_Awirilikalo_Mkalo_Zuwnkalo_Zuluyekalo_Utikalo_Stanburukalo_kutburukalo_Nowanburukalo_Desanburukalo".split("_"),monthsShort:"Zan_Few_Mar_Awi_M_Zuw_Zul_Uti_St_ku_Now_Des".split("_"),weekdays:"Kari_Ntnn_Tarata_Araba_Alamisa_Juma_Sibiri".split("_"),weekdaysShort:"Kar_Nt_Tar_Ara_Ala_Jum_Sib".split("_"),weekdaysMin:"Ka_Nt_Ta_Ar_Al_Ju_Si".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"MMMM [tile] D [san] YYYY",LLL:"MMMM [tile] D [san] YYYY [lr] HH:mm",LLLL:"dddd MMMM [tile] D [san] YYYY [lr] HH:mm"},calendar:{sameDay:"[Bi lr] LT",nextDay:"[Sini lr] LT",nextWeek:"dddd [don lr] LT",lastDay:"[Kunu lr] LT",lastWeek:"dddd [tmnen lr] LT",sameElse:"L"},relativeTime:{future:"%s kn",past:"a b %s b",s:"sanga dama dama",ss:"sekondi %d",m:"miniti kelen",mm:"miniti %d",h:"lr kelen",hh:"lr %d",d:"tile kelen",dd:"tile %d",M:"kalo kelen",MM:"kalo %d",y:"san kelen",yy:"san %d"},week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";var w={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},N={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};D.defineLocale("bn",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"A h:mm ",LTS:"A h:mm:ss ",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm ",LLLL:"dddd, D MMMM YYYY, A h:mm "},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"dddd, LT",lastDay:"[] LT",lastWeek:"[] dddd, LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:" ",ss:"%d ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},preparse:function(D){return D.replace(/[]/g,(function(D){return N[D]}))},postformat:function(D){return D.replace(/\d/g,(function(D){return w[D]}))},meridiemParse:/||||/,meridiemHour:function(D,w){return 12===D&&(D=0),""===w&&D>=4||""===w&&D<5||""===w?D+12:D},meridiem:function(D,w,N){return D<4?"":D<10?"":D<17?"":D<20?"":""},week:{dow:0,doy:6}})}(N(0))},function(D,w,N){!function(D){"use strict";var w={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},N={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};D.defineLocale("bo",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"A h:mm",LTS:"A h:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm",LLLL:"dddd, D MMMM YYYY, A h:mm"},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"[], LT",lastDay:"[] LT",lastWeek:"[] dddd, LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:"",ss:"%d ",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},preparse:function(D){return D.replace(/[]/g,(function(D){return N[D]}))},postformat:function(D){return D.replace(/\d/g,(function(D){return w[D]}))},meridiemParse:/||||/,meridiemHour:function(D,w){return 12===D&&(D=0),""===w&&D>=4||""===w&&D<5||""===w?D+12:D},meridiem:function(D,w,N){return D<4?"":D<10?"":D<17?"":D<20?"":""},week:{dow:0,doy:6}})}(N(0))},function(D,w,N){!function(D){"use strict";function relativeTimeWithMutation(D,w,N){return D+" "+function mutation(D,w){return 2===w?function softMutation(D){var w={m:"v",b:"v",d:"z"};return void 0===w[D.charAt(0)]?D:w[D.charAt(0)]+D.substring(1)}(D):D}({mm:"munutenn",MM:"miz",dd:"devezh"}[N],D)}D.defineLocale("br",{months:"Genver_C'hwevrer_Meurzh_Ebrel_Mae_Mezheven_Gouere_Eost_Gwengolo_Here_Du_Kerzu".split("_"),monthsShort:"Gen_C'hwe_Meu_Ebr_Mae_Eve_Gou_Eos_Gwe_Her_Du_Ker".split("_"),weekdays:"Sul_Lun_Meurzh_Merc'her_Yaou_Gwener_Sadorn".split("_"),weekdaysShort:"Sul_Lun_Meu_Mer_Yao_Gwe_Sad".split("_"),weekdaysMin:"Su_Lu_Me_Mer_Ya_Gw_Sa".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"h[e]mm A",LTS:"h[e]mm:ss A",L:"DD/MM/YYYY",LL:"D [a viz] MMMM YYYY",LLL:"D [a viz] MMMM YYYY h[e]mm A",LLLL:"dddd, D [a viz] MMMM YYYY h[e]mm A"},calendar:{sameDay:"[Hiziv da] LT",nextDay:"[Warc'hoazh da] LT",nextWeek:"dddd [da] LT",lastDay:"[Dec'h da] LT",lastWeek:"dddd [paset da] LT",sameElse:"L"},relativeTime:{future:"a-benn %s",past:"%s 'zo",s:"un nebeud segondenno",ss:"%d eilenn",m:"ur vunutenn",mm:relativeTimeWithMutation,h:"un eur",hh:"%d eur",d:"un devezh",dd:relativeTimeWithMutation,M:"ur miz",MM:relativeTimeWithMutation,y:"ur bloaz",yy:function specialMutationForYears(D){switch(function lastNumber(D){return D>9?lastNumber(D%10):D}(D)){case 1:case 3:case 4:case 5:case 9:return D+" bloaz";default:return D+" vloaz"}}},dayOfMonthOrdinalParse:/\d{1,2}(a|vet)/,ordinal:function(D){return D+(1===D?"a":"vet")},week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";function translate(D,w,N){var F=D+" ";switch(N){case"ss":return F+=1===D?"sekunda":2===D||3===D||4===D?"sekunde":"sekundi";case"m":return w?"jedna minuta":"jedne minute";case"mm":return F+=1===D?"minuta":2===D||3===D||4===D?"minute":"minuta";case"h":return w?"jedan sat":"jednog sata";case"hh":return F+=1===D?"sat":2===D||3===D||4===D?"sata":"sati";case"dd":return F+=1===D?"dan":"dana";case"MM":return F+=1===D?"mjesec":2===D||3===D||4===D?"mjeseca":"mjeseci";case"yy":return F+=1===D?"godina":2===D||3===D||4===D?"godine":"godina"}}D.defineLocale("bs",{months:"januar_februar_mart_april_maj_juni_juli_august_septembar_oktobar_novembar_decembar".split("_"),monthsShort:"jan._feb._mar._apr._maj._jun._jul._aug._sep._okt._nov._dec.".split("_"),monthsParseExact:!0,weekdays:"nedjelja_ponedjeljak_utorak_srijeda_etvrtak_petak_subota".split("_"),weekdaysShort:"ned._pon._uto._sri._et._pet._sub.".split("_"),weekdaysMin:"ne_po_ut_sr_e_pe_su".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY H:mm",LLLL:"dddd, D. MMMM YYYY H:mm"},calendar:{sameDay:"[danas u] LT",nextDay:"[sutra u] LT",nextWeek:function(){switch(this.day()){case 0:return"[u] [nedjelju] [u] LT";case 3:return"[u] [srijedu] [u] LT";case 6:return"[u] [subotu] [u] LT";case 1:case 2:case 4:case 5:return"[u] dddd [u] LT"}},lastDay:"[juer u] LT",lastWeek:function(){switch(this.day()){case 0:case 3:return"[prolu] dddd [u] LT";case 6:return"[prole] [subote] [u] LT";case 1:case 2:case 4:case 5:return"[proli] dddd [u] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"prije %s",s:"par sekundi",ss:translate,m:translate,mm:translate,h:translate,hh:translate,d:"dan",dd:translate,M:"mjesec",MM:translate,y:"godinu",yy:translate},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("ca",{months:{standalone:"gener_febrer_mar_abril_maig_juny_juliol_agost_setembre_octubre_novembre_desembre".split("_"),format:"de gener_de febrer_de mar_d'abril_de maig_de juny_de juliol_d'agost_de setembre_d'octubre_de novembre_de desembre".split("_"),isFormat:/D[oD]?(\s)+MMMM/},monthsShort:"gen._febr._mar_abr._maig_juny_jul._ag._set._oct._nov._des.".split("_"),monthsParseExact:!0,weekdays:"diumenge_dilluns_dimarts_dimecres_dijous_divendres_dissabte".split("_"),weekdaysShort:"dg._dl._dt._dc._dj._dv._ds.".split("_"),weekdaysMin:"dg_dl_dt_dc_dj_dv_ds".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM [de] YYYY",ll:"D MMM YYYY",LLL:"D MMMM [de] YYYY [a les] H:mm",lll:"D MMM YYYY, H:mm",LLLL:"dddd D MMMM [de] YYYY [a les] H:mm",llll:"ddd D MMM YYYY, H:mm"},calendar:{sameDay:function(){return"[avui a "+(1!==this.hours()?"les":"la")+"] LT"},nextDay:function(){return"[dem a "+(1!==this.hours()?"les":"la")+"] LT"},nextWeek:function(){return"dddd [a "+(1!==this.hours()?"les":"la")+"] LT"},lastDay:function(){return"[ahir a "+(1!==this.hours()?"les":"la")+"] LT"},lastWeek:function(){return"[el] dddd [passat a "+(1!==this.hours()?"les":"la")+"] LT"},sameElse:"L"},relativeTime:{future:"d'aqu %s",past:"fa %s",s:"uns segons",ss:"%d segons",m:"un minut",mm:"%d minuts",h:"una hora",hh:"%d hores",d:"un dia",dd:"%d dies",M:"un mes",MM:"%d mesos",y:"un any",yy:"%d anys"},dayOfMonthOrdinalParse:/\d{1,2}(r|n|t||a)/,ordinal:function(D,w){var N=1===D?"r":2===D?"n":3===D?"r":4===D?"t":"";return"w"!==w&&"W"!==w||(N="a"),D+N},week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";var w="leden_nor_bezen_duben_kvten_erven_ervenec_srpen_z_jen_listopad_prosinec".split("_"),N="led_no_be_dub_kv_vn_vc_srp_z_j_lis_pro".split("_"),F=[/^led/i,/^no/i,/^be/i,/^dub/i,/^kv/i,/^(vn|erven$|ervna)/i,/^(vc|ervenec|ervence)/i,/^srp/i,/^z/i,/^j/i,/^lis/i,/^pro/i],k=/^(leden|nor|bezen|duben|kvten|ervenec|ervence|erven|ervna|srpen|z|jen|listopad|prosinec|led|no|be|dub|kv|vn|vc|srp|z|j|lis|pro)/i;function plural(D){return D>1&&D<5&&1!=~~(D/10)}function translate(D,w,N,F){var k=D+" ";switch(N){case"s":return w||F?"pr sekund":"pr sekundami";case"ss":return w||F?k+(plural(D)?"sekundy":"sekund"):k+"sekundami";case"m":return w?"minuta":F?"minutu":"minutou";case"mm":return w||F?k+(plural(D)?"minuty":"minut"):k+"minutami";case"h":return w?"hodina":F?"hodinu":"hodinou";case"hh":return w||F?k+(plural(D)?"hodiny":"hodin"):k+"hodinami";case"d":return w||F?"den":"dnem";case"dd":return w||F?k+(plural(D)?"dny":"dn"):k+"dny";case"M":return w||F?"msc":"mscem";case"MM":return w||F?k+(plural(D)?"msce":"msc"):k+"msci";case"y":return w||F?"rok":"rokem";case"yy":return w||F?k+(plural(D)?"roky":"let"):k+"lety"}}D.defineLocale("cs",{months:w,monthsShort:N,monthsRegex:k,monthsShortRegex:k,monthsStrictRegex:/^(leden|ledna|nora|nor|bezen|bezna|duben|dubna|kvten|kvtna|ervenec|ervence|erven|ervna|srpen|srpna|z|jen|jna|listopadu|listopad|prosinec|prosince)/i,monthsShortStrictRegex:/^(led|no|be|dub|kv|vn|vc|srp|z|j|lis|pro)/i,monthsParse:F,longMonthsParse:F,shortMonthsParse:F,weekdays:"nedle_pondl_ter_steda_tvrtek_ptek_sobota".split("_"),weekdaysShort:"ne_po_t_st_t_p_so".split("_"),weekdaysMin:"ne_po_t_st_t_p_so".split("_"),longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY H:mm",LLLL:"dddd D. MMMM YYYY H:mm",l:"D. M. YYYY"},calendar:{sameDay:"[dnes v] LT",nextDay:"[ztra v] LT",nextWeek:function(){switch(this.day()){case 0:return"[v nedli v] LT";case 1:case 2:return"[v] dddd [v] LT";case 3:return"[ve stedu v] LT";case 4:return"[ve tvrtek v] LT";case 5:return"[v ptek v] LT";case 6:return"[v sobotu v] LT"}},lastDay:"[vera v] LT",lastWeek:function(){switch(this.day()){case 0:return"[minulou nedli v] LT";case 1:case 2:return"[minul] dddd [v] LT";case 3:return"[minulou stedu v] LT";case 4:case 5:return"[minul] dddd [v] LT";case 6:return"[minulou sobotu v] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"ped %s",s:translate,ss:translate,m:translate,mm:translate,h:translate,hh:translate,d:translate,dd:translate,M:translate,MM:translate,y:translate,yy:translate},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("cv",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD-MM-YYYY",LL:"YYYY [] MMMM [] D[-]",LLL:"YYYY [] MMMM [] D[-], HH:mm",LLLL:"dddd, YYYY [] MMMM [] D[-], HH:mm"},calendar:{sameDay:"[] LT []",nextDay:"[] LT []",lastDay:"[] LT []",nextWeek:"[] dddd LT []",lastWeek:"[] dddd LT []",sameElse:"L"},relativeTime:{future:function(D){return D+(/$/i.exec(D)?"":/$/i.exec(D)?"":"")},past:"%s ",s:"- ",ss:"%d ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},dayOfMonthOrdinalParse:/\d{1,2}-/,ordinal:"%d-",week:{dow:1,doy:7}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("cy",{months:"Ionawr_Chwefror_Mawrth_Ebrill_Mai_Mehefin_Gorffennaf_Awst_Medi_Hydref_Tachwedd_Rhagfyr".split("_"),monthsShort:"Ion_Chwe_Maw_Ebr_Mai_Meh_Gor_Aws_Med_Hyd_Tach_Rhag".split("_"),weekdays:"Dydd Sul_Dydd Llun_Dydd Mawrth_Dydd Mercher_Dydd Iau_Dydd Gwener_Dydd Sadwrn".split("_"),weekdaysShort:"Sul_Llun_Maw_Mer_Iau_Gwe_Sad".split("_"),weekdaysMin:"Su_Ll_Ma_Me_Ia_Gw_Sa".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Heddiw am] LT",nextDay:"[Yfory am] LT",nextWeek:"dddd [am] LT",lastDay:"[Ddoe am] LT",lastWeek:"dddd [diwethaf am] LT",sameElse:"L"},relativeTime:{future:"mewn %s",past:"%s yn l",s:"ychydig eiliadau",ss:"%d eiliad",m:"munud",mm:"%d munud",h:"awr",hh:"%d awr",d:"diwrnod",dd:"%d diwrnod",M:"mis",MM:"%d mis",y:"blwyddyn",yy:"%d flynedd"},dayOfMonthOrdinalParse:/\d{1,2}(fed|ain|af|il|ydd|ed|eg)/,ordinal:function(D){var w="";return D>20?w=40===D||50===D||60===D||80===D||100===D?"fed":"ain":D>0&&(w=["","af","il","ydd","ydd","ed","ed","ed","fed","fed","fed","eg","fed","eg","eg","fed","eg","eg","fed","eg","fed"][D]),D+w},week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("da",{months:"januar_februar_marts_april_maj_juni_juli_august_september_oktober_november_december".split("_"),monthsShort:"jan_feb_mar_apr_maj_jun_jul_aug_sep_okt_nov_dec".split("_"),weekdays:"sndag_mandag_tirsdag_onsdag_torsdag_fredag_lrdag".split("_"),weekdaysShort:"sn_man_tir_ons_tor_fre_lr".split("_"),weekdaysMin:"s_ma_ti_on_to_fr_l".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY HH:mm",LLLL:"dddd [d.] D. MMMM YYYY [kl.] HH:mm"},calendar:{sameDay:"[i dag kl.] LT",nextDay:"[i morgen kl.] LT",nextWeek:"p dddd [kl.] LT",lastDay:"[i gr kl.] LT",lastWeek:"[i] dddd[s kl.] LT",sameElse:"L"},relativeTime:{future:"om %s",past:"%s siden",s:"f sekunder",ss:"%d sekunder",m:"et minut",mm:"%d minutter",h:"en time",hh:"%d timer",d:"en dag",dd:"%d dage",M:"en mned",MM:"%d mneder",y:"et r",yy:"%d r"},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";function processRelativeTime(D,w,N,F){var k={m:["eine Minute","einer Minute"],h:["eine Stunde","einer Stunde"],d:["ein Tag","einem Tag"],dd:[D+" Tage",D+" Tagen"],M:["ein Monat","einem Monat"],MM:[D+" Monate",D+" Monaten"],y:["ein Jahr","einem Jahr"],yy:[D+" Jahre",D+" Jahren"]};return w?k[N][0]:k[N][1]}D.defineLocale("de",{months:"Januar_Februar_Mrz_April_Mai_Juni_Juli_August_September_Oktober_November_Dezember".split("_"),monthsShort:"Jan._Feb._Mrz_Apr._Mai_Juni_Juli_Aug._Sep._Okt._Nov._Dez.".split("_"),monthsParseExact:!0,weekdays:"Sonntag_Montag_Dienstag_Mittwoch_Donnerstag_Freitag_Samstag".split("_"),weekdaysShort:"So._Mo._Di._Mi._Do._Fr._Sa.".split("_"),weekdaysMin:"So_Mo_Di_Mi_Do_Fr_Sa".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY HH:mm",LLLL:"dddd, D. MMMM YYYY HH:mm"},calendar:{sameDay:"[heute um] LT [Uhr]",sameElse:"L",nextDay:"[morgen um] LT [Uhr]",nextWeek:"dddd [um] LT [Uhr]",lastDay:"[gestern um] LT [Uhr]",lastWeek:"[letzten] dddd [um] LT [Uhr]"},relativeTime:{future:"in %s",past:"vor %s",s:"ein paar Sekunden",ss:"%d Sekunden",m:processRelativeTime,mm:"%d Minuten",h:processRelativeTime,hh:"%d Stunden",d:processRelativeTime,dd:processRelativeTime,M:processRelativeTime,MM:processRelativeTime,y:processRelativeTime,yy:processRelativeTime},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";function processRelativeTime(D,w,N,F){var k={m:["eine Minute","einer Minute"],h:["eine Stunde","einer Stunde"],d:["ein Tag","einem Tag"],dd:[D+" Tage",D+" Tagen"],M:["ein Monat","einem Monat"],MM:[D+" Monate",D+" Monaten"],y:["ein Jahr","einem Jahr"],yy:[D+" Jahre",D+" Jahren"]};return w?k[N][0]:k[N][1]}D.defineLocale("de-at",{months:"Jnner_Februar_Mrz_April_Mai_Juni_Juli_August_September_Oktober_November_Dezember".split("_"),monthsShort:"Jn._Feb._Mrz_Apr._Mai_Juni_Juli_Aug._Sep._Okt._Nov._Dez.".split("_"),monthsParseExact:!0,weekdays:"Sonntag_Montag_Dienstag_Mittwoch_Donnerstag_Freitag_Samstag".split("_"),weekdaysShort:"So._Mo._Di._Mi._Do._Fr._Sa.".split("_"),weekdaysMin:"So_Mo_Di_Mi_Do_Fr_Sa".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY HH:mm",LLLL:"dddd, D. MMMM YYYY HH:mm"},calendar:{sameDay:"[heute um] LT [Uhr]",sameElse:"L",nextDay:"[morgen um] LT [Uhr]",nextWeek:"dddd [um] LT [Uhr]",lastDay:"[gestern um] LT [Uhr]",lastWeek:"[letzten] dddd [um] LT [Uhr]"},relativeTime:{future:"in %s",past:"vor %s",s:"ein paar Sekunden",ss:"%d Sekunden",m:processRelativeTime,mm:"%d Minuten",h:processRelativeTime,hh:"%d Stunden",d:processRelativeTime,dd:processRelativeTime,M:processRelativeTime,MM:processRelativeTime,y:processRelativeTime,yy:processRelativeTime},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";function processRelativeTime(D,w,N,F){var k={m:["eine Minute","einer Minute"],h:["eine Stunde","einer Stunde"],d:["ein Tag","einem Tag"],dd:[D+" Tage",D+" Tagen"],M:["ein Monat","einem Monat"],MM:[D+" Monate",D+" Monaten"],y:["ein Jahr","einem Jahr"],yy:[D+" Jahre",D+" Jahren"]};return w?k[N][0]:k[N][1]}D.defineLocale("de-ch",{months:"Januar_Februar_Mrz_April_Mai_Juni_Juli_August_September_Oktober_November_Dezember".split("_"),monthsShort:"Jan._Feb._Mrz_Apr._Mai_Juni_Juli_Aug._Sep._Okt._Nov._Dez.".split("_"),monthsParseExact:!0,weekdays:"Sonntag_Montag_Dienstag_Mittwoch_Donnerstag_Freitag_Samstag".split("_"),weekdaysShort:"So_Mo_Di_Mi_Do_Fr_Sa".split("_"),weekdaysMin:"So_Mo_Di_Mi_Do_Fr_Sa".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY HH:mm",LLLL:"dddd, D. MMMM YYYY HH:mm"},calendar:{sameDay:"[heute um] LT [Uhr]",sameElse:"L",nextDay:"[morgen um] LT [Uhr]",nextWeek:"dddd [um] LT [Uhr]",lastDay:"[gestern um] LT [Uhr]",lastWeek:"[letzten] dddd [um] LT [Uhr]"},relativeTime:{future:"in %s",past:"vor %s",s:"ein paar Sekunden",ss:"%d Sekunden",m:processRelativeTime,mm:"%d Minuten",h:processRelativeTime,hh:"%d Stunden",d:processRelativeTime,dd:processRelativeTime,M:processRelativeTime,MM:processRelativeTime,y:processRelativeTime,yy:processRelativeTime},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";var w=["","","","","","","","","","","",""],N=["","","","","","",""];D.defineLocale("dv",{months:w,monthsShort:w,weekdays:N,weekdaysShort:N,weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"D/M/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},meridiemParse:/|/,isPM:function(D){return""===D},meridiem:function(D,w,N){return D<12?"":""},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"dddd LT",lastDay:"[] LT",lastWeek:"[] dddd LT",sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:"",ss:"d% ",m:"",mm:" %d",h:"",hh:" %d",d:"",dd:" %d",M:"",MM:" %d",y:"",yy:" %d"},preparse:function(D){return D.replace(//g,",")},postformat:function(D){return D.replace(/,/g,"")},week:{dow:7,doy:12}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("el",{monthsNominativeEl:"___________".split("_"),monthsGenitiveEl:"___________".split("_"),months:function(D,w){return D?"string"==typeof w&&/D/.test(w.substring(0,w.indexOf("MMMM")))?this._monthsGenitiveEl[D.month()]:this._monthsNominativeEl[D.month()]:this._monthsNominativeEl},monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),meridiem:function(D,w,N){return D>11?N?"":"":N?"":""},isPM:function(D){return""===(D+"").toLowerCase()[0]},meridiemParse:/[]\.??\.?/i,longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY h:mm A",LLLL:"dddd, D MMMM YYYY h:mm A"},calendarEl:{sameDay:"[ {}] LT",nextDay:"[ {}] LT",nextWeek:"dddd [{}] LT",lastDay:"[ {}] LT",lastWeek:function(){switch(this.day()){case 6:return"[ ] dddd [{}] LT";default:return"[ ] dddd [{}] LT"}},sameElse:"L"},calendar:function(D,w){var N=this._calendarEl[D],F=w&&w.hours();return function isFunction(D){return D instanceof Function||"[object Function]"===Object.prototype.toString.call(D)}(N)&&(N=N.apply(w)),N.replace("{}",F%12==1?"":"")},relativeTime:{future:" %s",past:"%s ",s:" ",ss:"%d ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:"%d",week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("en-SG",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},dayOfMonthOrdinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(D){var w=D%10;return D+(1==~~(D%100/10)?"th":1===w?"st":2===w?"nd":3===w?"rd":"th")},week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("en-au",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY h:mm A",LLLL:"dddd, D MMMM YYYY h:mm A"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},dayOfMonthOrdinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(D){var w=D%10;return D+(1==~~(D%100/10)?"th":1===w?"st":2===w?"nd":3===w?"rd":"th")},week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("en-ca",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"YYYY-MM-DD",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},dayOfMonthOrdinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(D){var w=D%10;return D+(1==~~(D%100/10)?"th":1===w?"st":2===w?"nd":3===w?"rd":"th")}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("en-gb",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},dayOfMonthOrdinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(D){var w=D%10;return D+(1==~~(D%100/10)?"th":1===w?"st":2===w?"nd":3===w?"rd":"th")},week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("en-ie",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},dayOfMonthOrdinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(D){var w=D%10;return D+(1==~~(D%100/10)?"th":1===w?"st":2===w?"nd":3===w?"rd":"th")},week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("en-il",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},dayOfMonthOrdinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(D){var w=D%10;return D+(1==~~(D%100/10)?"th":1===w?"st":2===w?"nd":3===w?"rd":"th")}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("en-nz",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY h:mm A",LLLL:"dddd, D MMMM YYYY h:mm A"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},dayOfMonthOrdinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(D){var w=D%10;return D+(1==~~(D%100/10)?"th":1===w?"st":2===w?"nd":3===w?"rd":"th")},week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("eo",{months:"januaro_februaro_marto_aprilo_majo_junio_julio_agusto_septembro_oktobro_novembro_decembro".split("_"),monthsShort:"jan_feb_mar_apr_maj_jun_jul_ag_sep_okt_nov_dec".split("_"),weekdays:"dimano_lundo_mardo_merkredo_ado_vendredo_sabato".split("_"),weekdaysShort:"dim_lun_mard_merk_a_ven_sab".split("_"),weekdaysMin:"di_lu_ma_me_a_ve_sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY-MM-DD",LL:"D[-a de] MMMM, YYYY",LLL:"D[-a de] MMMM, YYYY HH:mm",LLLL:"dddd, [la] D[-a de] MMMM, YYYY HH:mm"},meridiemParse:/[ap]\.t\.m/i,isPM:function(D){return"p"===D.charAt(0).toLowerCase()},meridiem:function(D,w,N){return D>11?N?"p.t.m.":"P.T.M.":N?"a.t.m.":"A.T.M."},calendar:{sameDay:"[Hodia je] LT",nextDay:"[Morga je] LT",nextWeek:"dddd [je] LT",lastDay:"[Hiera je] LT",lastWeek:"[pasinta] dddd [je] LT",sameElse:"L"},relativeTime:{future:"post %s",past:"anta %s",s:"sekundoj",ss:"%d sekundoj",m:"minuto",mm:"%d minutoj",h:"horo",hh:"%d horoj",d:"tago",dd:"%d tagoj",M:"monato",MM:"%d monatoj",y:"jaro",yy:"%d jaroj"},dayOfMonthOrdinalParse:/\d{1,2}a/,ordinal:"%da",week:{dow:1,doy:7}})}(N(0))},function(D,w,N){!function(D){"use strict";var w="ene._feb._mar._abr._may._jun._jul._ago._sep._oct._nov._dic.".split("_"),N="ene_feb_mar_abr_may_jun_jul_ago_sep_oct_nov_dic".split("_"),F=[/^ene/i,/^feb/i,/^mar/i,/^abr/i,/^may/i,/^jun/i,/^jul/i,/^ago/i,/^sep/i,/^oct/i,/^nov/i,/^dic/i],k=/^(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre|ene\.?|feb\.?|mar\.?|abr\.?|may\.?|jun\.?|jul\.?|ago\.?|sep\.?|oct\.?|nov\.?|dic\.?)/i;D.defineLocale("es",{months:"enero_febrero_marzo_abril_mayo_junio_julio_agosto_septiembre_octubre_noviembre_diciembre".split("_"),monthsShort:function(D,F){return D?/-MMM-/.test(F)?N[D.month()]:w[D.month()]:w},monthsRegex:k,monthsShortRegex:k,monthsStrictRegex:/^(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre)/i,monthsShortStrictRegex:/^(ene\.?|feb\.?|mar\.?|abr\.?|may\.?|jun\.?|jul\.?|ago\.?|sep\.?|oct\.?|nov\.?|dic\.?)/i,monthsParse:F,longMonthsParse:F,shortMonthsParse:F,weekdays:"domingo_lunes_martes_mircoles_jueves_viernes_sbado".split("_"),weekdaysShort:"dom._lun._mar._mi._jue._vie._sb.".split("_"),weekdaysMin:"do_lu_ma_mi_ju_vi_s".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY H:mm",LLLL:"dddd, D [de] MMMM [de] YYYY H:mm"},calendar:{sameDay:function(){return"[hoy a la"+(1!==this.hours()?"s":"")+"] LT"},nextDay:function(){return"[maana a la"+(1!==this.hours()?"s":"")+"] LT"},nextWeek:function(){return"dddd [a la"+(1!==this.hours()?"s":"")+"] LT"},lastDay:function(){return"[ayer a la"+(1!==this.hours()?"s":"")+"] LT"},lastWeek:function(){return"[el] dddd [pasado a la"+(1!==this.hours()?"s":"")+"] LT"},sameElse:"L"},relativeTime:{future:"en %s",past:"hace %s",s:"unos segundos",ss:"%d segundos",m:"un minuto",mm:"%d minutos",h:"una hora",hh:"%d horas",d:"un da",dd:"%d das",M:"un mes",MM:"%d meses",y:"un ao",yy:"%d aos"},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:"%d",week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";var w="ene._feb._mar._abr._may._jun._jul._ago._sep._oct._nov._dic.".split("_"),N="ene_feb_mar_abr_may_jun_jul_ago_sep_oct_nov_dic".split("_"),F=[/^ene/i,/^feb/i,/^mar/i,/^abr/i,/^may/i,/^jun/i,/^jul/i,/^ago/i,/^sep/i,/^oct/i,/^nov/i,/^dic/i],k=/^(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre|ene\.?|feb\.?|mar\.?|abr\.?|may\.?|jun\.?|jul\.?|ago\.?|sep\.?|oct\.?|nov\.?|dic\.?)/i;D.defineLocale("es-do",{months:"enero_febrero_marzo_abril_mayo_junio_julio_agosto_septiembre_octubre_noviembre_diciembre".split("_"),monthsShort:function(D,F){return D?/-MMM-/.test(F)?N[D.month()]:w[D.month()]:w},monthsRegex:k,monthsShortRegex:k,monthsStrictRegex:/^(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre)/i,monthsShortStrictRegex:/^(ene\.?|feb\.?|mar\.?|abr\.?|may\.?|jun\.?|jul\.?|ago\.?|sep\.?|oct\.?|nov\.?|dic\.?)/i,monthsParse:F,longMonthsParse:F,shortMonthsParse:F,weekdays:"domingo_lunes_martes_mircoles_jueves_viernes_sbado".split("_"),weekdaysShort:"dom._lun._mar._mi._jue._vie._sb.".split("_"),weekdaysMin:"do_lu_ma_mi_ju_vi_s".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY h:mm A",LLLL:"dddd, D [de] MMMM [de] YYYY h:mm A"},calendar:{sameDay:function(){return"[hoy a la"+(1!==this.hours()?"s":"")+"] LT"},nextDay:function(){return"[maana a la"+(1!==this.hours()?"s":"")+"] LT"},nextWeek:function(){return"dddd [a la"+(1!==this.hours()?"s":"")+"] LT"},lastDay:function(){return"[ayer a la"+(1!==this.hours()?"s":"")+"] LT"},lastWeek:function(){return"[el] dddd [pasado a la"+(1!==this.hours()?"s":"")+"] LT"},sameElse:"L"},relativeTime:{future:"en %s",past:"hace %s",s:"unos segundos",ss:"%d segundos",m:"un minuto",mm:"%d minutos",h:"una hora",hh:"%d horas",d:"un da",dd:"%d das",M:"un mes",MM:"%d meses",y:"un ao",yy:"%d aos"},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:"%d",week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";var w="ene._feb._mar._abr._may._jun._jul._ago._sep._oct._nov._dic.".split("_"),N="ene_feb_mar_abr_may_jun_jul_ago_sep_oct_nov_dic".split("_"),F=[/^ene/i,/^feb/i,/^mar/i,/^abr/i,/^may/i,/^jun/i,/^jul/i,/^ago/i,/^sep/i,/^oct/i,/^nov/i,/^dic/i],k=/^(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre|ene\.?|feb\.?|mar\.?|abr\.?|may\.?|jun\.?|jul\.?|ago\.?|sep\.?|oct\.?|nov\.?|dic\.?)/i;D.defineLocale("es-us",{months:"enero_febrero_marzo_abril_mayo_junio_julio_agosto_septiembre_octubre_noviembre_diciembre".split("_"),monthsShort:function(D,F){return D?/-MMM-/.test(F)?N[D.month()]:w[D.month()]:w},monthsRegex:k,monthsShortRegex:k,monthsStrictRegex:/^(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre)/i,monthsShortStrictRegex:/^(ene\.?|feb\.?|mar\.?|abr\.?|may\.?|jun\.?|jul\.?|ago\.?|sep\.?|oct\.?|nov\.?|dic\.?)/i,monthsParse:F,longMonthsParse:F,shortMonthsParse:F,weekdays:"domingo_lunes_martes_mircoles_jueves_viernes_sbado".split("_"),weekdaysShort:"dom._lun._mar._mi._jue._vie._sb.".split("_"),weekdaysMin:"do_lu_ma_mi_ju_vi_s".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"MM/DD/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY h:mm A",LLLL:"dddd, D [de] MMMM [de] YYYY h:mm A"},calendar:{sameDay:function(){return"[hoy a la"+(1!==this.hours()?"s":"")+"] LT"},nextDay:function(){return"[maana a la"+(1!==this.hours()?"s":"")+"] LT"},nextWeek:function(){return"dddd [a la"+(1!==this.hours()?"s":"")+"] LT"},lastDay:function(){return"[ayer a la"+(1!==this.hours()?"s":"")+"] LT"},lastWeek:function(){return"[el] dddd [pasado a la"+(1!==this.hours()?"s":"")+"] LT"},sameElse:"L"},relativeTime:{future:"en %s",past:"hace %s",s:"unos segundos",ss:"%d segundos",m:"un minuto",mm:"%d minutos",h:"una hora",hh:"%d horas",d:"un da",dd:"%d das",M:"un mes",MM:"%d meses",y:"un ao",yy:"%d aos"},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:"%d",week:{dow:0,doy:6}})}(N(0))},function(D,w,N){!function(D){"use strict";function processRelativeTime(D,w,N,F){var k={s:["mne sekundi","mni sekund","paar sekundit"],ss:[D+"sekundi",D+"sekundit"],m:["he minuti","ks minut"],mm:[D+" minuti",D+" minutit"],h:["he tunni","tund aega","ks tund"],hh:[D+" tunni",D+" tundi"],d:["he peva","ks pev"],M:["kuu aja","kuu aega","ks kuu"],MM:[D+" kuu",D+" kuud"],y:["he aasta","aasta","ks aasta"],yy:[D+" aasta",D+" aastat"]};return w?k[N][2]?k[N][2]:k[N][1]:F?k[N][0]:k[N][1]}D.defineLocale("et",{months:"jaanuar_veebruar_mrts_aprill_mai_juuni_juuli_august_september_oktoober_november_detsember".split("_"),monthsShort:"jaan_veebr_mrts_apr_mai_juuni_juuli_aug_sept_okt_nov_dets".split("_"),weekdays:"phapev_esmaspev_teisipev_kolmapev_neljapev_reede_laupev".split("_"),weekdaysShort:"P_E_T_K_N_R_L".split("_"),weekdaysMin:"P_E_T_K_N_R_L".split("_"),longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY H:mm",LLLL:"dddd, D. MMMM YYYY H:mm"},calendar:{sameDay:"[Tna,] LT",nextDay:"[Homme,] LT",nextWeek:"[Jrgmine] dddd LT",lastDay:"[Eile,] LT",lastWeek:"[Eelmine] dddd LT",sameElse:"L"},relativeTime:{future:"%s prast",past:"%s tagasi",s:processRelativeTime,ss:processRelativeTime,m:processRelativeTime,mm:processRelativeTime,h:processRelativeTime,hh:processRelativeTime,d:processRelativeTime,dd:"%d peva",M:processRelativeTime,MM:processRelativeTime,y:processRelativeTime,yy:processRelativeTime},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("eu",{months:"urtarrila_otsaila_martxoa_apirila_maiatza_ekaina_uztaila_abuztua_iraila_urria_azaroa_abendua".split("_"),monthsShort:"urt._ots._mar._api._mai._eka._uzt._abu._ira._urr._aza._abe.".split("_"),monthsParseExact:!0,weekdays:"igandea_astelehena_asteartea_asteazkena_osteguna_ostirala_larunbata".split("_"),weekdaysShort:"ig._al._ar._az._og._ol._lr.".split("_"),weekdaysMin:"ig_al_ar_az_og_ol_lr".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY-MM-DD",LL:"YYYY[ko] MMMM[ren] D[a]",LLL:"YYYY[ko] MMMM[ren] D[a] HH:mm",LLLL:"dddd, YYYY[ko] MMMM[ren] D[a] HH:mm",l:"YYYY-M-D",ll:"YYYY[ko] MMM D[a]",lll:"YYYY[ko] MMM D[a] HH:mm",llll:"ddd, YYYY[ko] MMM D[a] HH:mm"},calendar:{sameDay:"[gaur] LT[etan]",nextDay:"[bihar] LT[etan]",nextWeek:"dddd LT[etan]",lastDay:"[atzo] LT[etan]",lastWeek:"[aurreko] dddd LT[etan]",sameElse:"L"},relativeTime:{future:"%s barru",past:"duela %s",s:"segundo batzuk",ss:"%d segundo",m:"minutu bat",mm:"%d minutu",h:"ordu bat",hh:"%d ordu",d:"egun bat",dd:"%d egun",M:"hilabete bat",MM:"%d hilabete",y:"urte bat",yy:"%d urte"},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}})}(N(0))},function(D,w,N){!function(D){"use strict";var w={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},N={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};D.defineLocale("fa",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},meridiemParse:/  |  /,isPM:function(D){return/  /.test(D)},meridiem:function(D,w,N){return D<12?"  ":"  "},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"dddd [] LT",lastDay:"[ ] LT",lastWeek:"dddd [] [] LT",sameElse:"L"},relativeTime:{future:" %s",past:"%s ",s:" ",ss:" d%",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},preparse:function(D){return D.replace(/[-]/g,(function(D){return N[D]})).replace(//g,",")},postformat:function(D){return D.replace(/\d/g,(function(D){return w[D]})).replace(/,/g,"")},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:"%d",week:{dow:6,doy:12}})}(N(0))},function(D,w,N){!function(D){"use strict";var w="nolla yksi kaksi kolme nelj viisi kuusi seitsemn kahdeksan yhdeksn".split(" "),N=["nolla","yhden","kahden","kolmen","neljn","viiden","kuuden",w[7],w[8],w[9]];function translate(D,F,k,j){var z="";switch(k){case"s":return j?"muutaman sekunnin":"muutama sekunti";case"ss":return j?"sekunnin":"sekuntia";case"m":return j?"minuutin":"minuutti";case"mm":z=j?"minuutin":"minuuttia";break;case"h":return j?"tunnin":"tunti";case"hh":z=j?"tunnin":"tuntia";break;case"d":return j?"pivn":"piv";case"dd":z=j?"pivn":"piv";break;case"M":return j?"kuukauden":"kuukausi";case"MM":z=j?"kuukauden":"kuukautta";break;case"y":return j?"vuoden":"vuosi";case"yy":z=j?"vuoden":"vuotta"}return z=function verbalNumber(D,F){return D<10?F?N[D]:w[D]:D}(D,j)+" "+z}D.defineLocale("fi",{months:"tammikuu_helmikuu_maaliskuu_huhtikuu_toukokuu_keskuu_heinkuu_elokuu_syyskuu_lokakuu_marraskuu_joulukuu".split("_"),monthsShort:"tammi_helmi_maalis_huhti_touko_kes_hein_elo_syys_loka_marras_joulu".split("_"),weekdays:"sunnuntai_maanantai_tiistai_keskiviikko_torstai_perjantai_lauantai".split("_"),weekdaysShort:"su_ma_ti_ke_to_pe_la".split("_"),weekdaysMin:"su_ma_ti_ke_to_pe_la".split("_"),longDateFormat:{LT:"HH.mm",LTS:"HH.mm.ss",L:"DD.MM.YYYY",LL:"Do MMMM[ta] YYYY",LLL:"Do MMMM[ta] YYYY, [klo] HH.mm",LLLL:"dddd, Do MMMM[ta] YYYY, [klo] HH.mm",l:"D.M.YYYY",ll:"Do MMM YYYY",lll:"Do MMM YYYY, [klo] HH.mm",llll:"ddd, Do MMM YYYY, [klo] HH.mm"},calendar:{sameDay:"[tnn] [klo] LT",nextDay:"[huomenna] [klo] LT",nextWeek:"dddd [klo] LT",lastDay:"[eilen] [klo] LT",lastWeek:"[viime] dddd[na] [klo] LT",sameElse:"L"},relativeTime:{future:"%s pst",past:"%s sitten",s:translate,ss:translate,m:translate,mm:translate,h:translate,hh:translate,d:translate,dd:translate,M:translate,MM:translate,y:translate,yy:translate},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("fo",{months:"januar_februar_mars_aprl_mai_juni_juli_august_september_oktober_november_desember".split("_"),monthsShort:"jan_feb_mar_apr_mai_jun_jul_aug_sep_okt_nov_des".split("_"),weekdays:"sunnudagur_mnadagur_tsdagur_mikudagur_hsdagur_frggjadagur_leygardagur".split("_"),weekdaysShort:"sun_mn_ts_mik_hs_fr_ley".split("_"),weekdaysMin:"su_m_t_mi_h_fr_le".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D. MMMM, YYYY HH:mm"},calendar:{sameDay:"[ dag kl.] LT",nextDay:"[ morgin kl.] LT",nextWeek:"dddd [kl.] LT",lastDay:"[ gjr kl.] LT",lastWeek:"[sstu] dddd [kl] LT",sameElse:"L"},relativeTime:{future:"um %s",past:"%s sani",s:"f sekund",ss:"%d sekundir",m:"ein minuttur",mm:"%d minuttir",h:"ein tmi",hh:"%d tmar",d:"ein dagur",dd:"%d dagar",M:"ein mnaur",MM:"%d mnair",y:"eitt r",yy:"%d r"},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("fr",{months:"janvier_fvrier_mars_avril_mai_juin_juillet_aot_septembre_octobre_novembre_dcembre".split("_"),monthsShort:"janv._fvr._mars_avr._mai_juin_juil._aot_sept._oct._nov._dc.".split("_"),monthsParseExact:!0,weekdays:"dimanche_lundi_mardi_mercredi_jeudi_vendredi_samedi".split("_"),weekdaysShort:"dim._lun._mar._mer._jeu._ven._sam.".split("_"),weekdaysMin:"di_lu_ma_me_je_ve_sa".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[Aujourdhui ] LT",nextDay:"[Demain ] LT",nextWeek:"dddd [] LT",lastDay:"[Hier ] LT",lastWeek:"dddd [dernier ] LT",sameElse:"L"},relativeTime:{future:"dans %s",past:"il y a %s",s:"quelques secondes",ss:"%d secondes",m:"une minute",mm:"%d minutes",h:"une heure",hh:"%d heures",d:"un jour",dd:"%d jours",M:"un mois",MM:"%d mois",y:"un an",yy:"%d ans"},dayOfMonthOrdinalParse:/\d{1,2}(er|)/,ordinal:function(D,w){switch(w){case"D":return D+(1===D?"er":"");default:case"M":case"Q":case"DDD":case"d":return D+(1===D?"er":"e");case"w":case"W":return D+(1===D?"re":"e")}},week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("fr-ca",{months:"janvier_fvrier_mars_avril_mai_juin_juillet_aot_septembre_octobre_novembre_dcembre".split("_"),monthsShort:"janv._fvr._mars_avr._mai_juin_juil._aot_sept._oct._nov._dc.".split("_"),monthsParseExact:!0,weekdays:"dimanche_lundi_mardi_mercredi_jeudi_vendredi_samedi".split("_"),weekdaysShort:"dim._lun._mar._mer._jeu._ven._sam.".split("_"),weekdaysMin:"di_lu_ma_me_je_ve_sa".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY-MM-DD",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[Aujourdhui ] LT",nextDay:"[Demain ] LT",nextWeek:"dddd [] LT",lastDay:"[Hier ] LT",lastWeek:"dddd [dernier ] LT",sameElse:"L"},relativeTime:{future:"dans %s",past:"il y a %s",s:"quelques secondes",ss:"%d secondes",m:"une minute",mm:"%d minutes",h:"une heure",hh:"%d heures",d:"un jour",dd:"%d jours",M:"un mois",MM:"%d mois",y:"un an",yy:"%d ans"},dayOfMonthOrdinalParse:/\d{1,2}(er|e)/,ordinal:function(D,w){switch(w){default:case"M":case"Q":case"D":case"DDD":case"d":return D+(1===D?"er":"e");case"w":case"W":return D+(1===D?"re":"e")}}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("fr-ch",{months:"janvier_fvrier_mars_avril_mai_juin_juillet_aot_septembre_octobre_novembre_dcembre".split("_"),monthsShort:"janv._fvr._mars_avr._mai_juin_juil._aot_sept._oct._nov._dc.".split("_"),monthsParseExact:!0,weekdays:"dimanche_lundi_mardi_mercredi_jeudi_vendredi_samedi".split("_"),weekdaysShort:"dim._lun._mar._mer._jeu._ven._sam.".split("_"),weekdaysMin:"di_lu_ma_me_je_ve_sa".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[Aujourdhui ] LT",nextDay:"[Demain ] LT",nextWeek:"dddd [] LT",lastDay:"[Hier ] LT",lastWeek:"dddd [dernier ] LT",sameElse:"L"},relativeTime:{future:"dans %s",past:"il y a %s",s:"quelques secondes",ss:"%d secondes",m:"une minute",mm:"%d minutes",h:"une heure",hh:"%d heures",d:"un jour",dd:"%d jours",M:"un mois",MM:"%d mois",y:"un an",yy:"%d ans"},dayOfMonthOrdinalParse:/\d{1,2}(er|e)/,ordinal:function(D,w){switch(w){default:case"M":case"Q":case"D":case"DDD":case"d":return D+(1===D?"er":"e");case"w":case"W":return D+(1===D?"re":"e")}},week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";var w="jan._feb._mrt._apr._mai_jun._jul._aug._sep._okt._nov._des.".split("_"),N="jan_feb_mrt_apr_mai_jun_jul_aug_sep_okt_nov_des".split("_");D.defineLocale("fy",{months:"jannewaris_febrewaris_maart_april_maaie_juny_july_augustus_septimber_oktober_novimber_desimber".split("_"),monthsShort:function(D,F){return D?/-MMM-/.test(F)?N[D.month()]:w[D.month()]:w},monthsParseExact:!0,weekdays:"snein_moandei_tiisdei_woansdei_tongersdei_freed_sneon".split("_"),weekdaysShort:"si._mo._ti._wo._to._fr._so.".split("_"),weekdaysMin:"Si_Mo_Ti_Wo_To_Fr_So".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD-MM-YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[hjoed om] LT",nextDay:"[moarn om] LT",nextWeek:"dddd [om] LT",lastDay:"[juster om] LT",lastWeek:"[frne] dddd [om] LT",sameElse:"L"},relativeTime:{future:"oer %s",past:"%s lyn",s:"in pear sekonden",ss:"%d sekonden",m:"ien mint",mm:"%d minuten",h:"ien oere",hh:"%d oeren",d:"ien dei",dd:"%d dagen",M:"ien moanne",MM:"%d moannen",y:"ien jier",yy:"%d jierren"},dayOfMonthOrdinalParse:/\d{1,2}(ste|de)/,ordinal:function(D){return D+(1===D||8===D||D>=20?"ste":"de")},week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("ga",{months:["Eanir","Feabhra","Mrta","Aibren","Bealtaine","Mitheamh","Iil","Lnasa","Men Fmhair","Deaireadh Fmhair","Samhain","Nollaig"],monthsShort:["Ean","Feab","Mrt","Aibr","Beal","Mit","Iil","Lna","Men","Deai","Samh","Noll"],monthsParseExact:!0,weekdays:["D Domhnaigh","D Luain","D Mirt","D Cadaoin","Dardaoin","D hAoine","D Satharn"],weekdaysShort:["Dom","Lua","Mi","Ca","Da","hAo","Sat"],weekdaysMin:["Do","Lu","M","Ce","D","hA","Sa"],longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Inniu ag] LT",nextDay:"[Amrach ag] LT",nextWeek:"dddd [ag] LT",lastDay:"[Inn aig] LT",lastWeek:"dddd [seo caite] [ag] LT",sameElse:"L"},relativeTime:{future:"i %s",past:"%s  shin",s:"cpla soicind",ss:"%d soicind",m:"nimad",mm:"%d nimad",h:"uair an chloig",hh:"%d uair an chloig",d:"l",dd:"%d l",M:"m",MM:"%d m",y:"bliain",yy:"%d bliain"},dayOfMonthOrdinalParse:/\d{1,2}(d|na|mh)/,ordinal:function(D){return D+(1===D?"d":D%10==2?"na":"mh")},week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("gd",{months:["Am Faoilleach","An Gearran","Am Mrt","An Giblean","An Citean","An t-gmhios","An t-Iuchar","An Lnastal","An t-Sultain","An Dmhair","An t-Samhain","An Dbhlachd"],monthsShort:["Faoi","Gear","Mrt","Gibl","Cit","gmh","Iuch","Ln","Sult","Dmh","Samh","Dbh"],monthsParseExact:!0,weekdays:["Didmhnaich","Diluain","Dimirt","Diciadain","Diardaoin","Dihaoine","Disathairne"],weekdaysShort:["Did","Dil","Dim","Dic","Dia","Dih","Dis"],weekdaysMin:["D","Lu","M","Ci","Ar","Ha","Sa"],longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[An-diugh aig] LT",nextDay:"[A-mireach aig] LT",nextWeek:"dddd [aig] LT",lastDay:"[An-d aig] LT",lastWeek:"dddd [seo chaidh] [aig] LT",sameElse:"L"},relativeTime:{future:"ann an %s",past:"bho chionn %s",s:"beagan diogan",ss:"%d diogan",m:"mionaid",mm:"%d mionaidean",h:"uair",hh:"%d uairean",d:"latha",dd:"%d latha",M:"mos",MM:"%d mosan",y:"bliadhna",yy:"%d bliadhna"},dayOfMonthOrdinalParse:/\d{1,2}(d|na|mh)/,ordinal:function(D){return D+(1===D?"d":D%10==2?"na":"mh")},week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("gl",{months:"xaneiro_febreiro_marzo_abril_maio_xuo_xullo_agosto_setembro_outubro_novembro_decembro".split("_"),monthsShort:"xan._feb._mar._abr._mai._xu._xul._ago._set._out._nov._dec.".split("_"),monthsParseExact:!0,weekdays:"domingo_luns_martes_mrcores_xoves_venres_sbado".split("_"),weekdaysShort:"dom._lun._mar._mr._xov._ven._sb.".split("_"),weekdaysMin:"do_lu_ma_m_xo_ve_s".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY H:mm",LLLL:"dddd, D [de] MMMM [de] YYYY H:mm"},calendar:{sameDay:function(){return"[hoxe "+(1!==this.hours()?"s":"")+"] LT"},nextDay:function(){return"[ma "+(1!==this.hours()?"s":"")+"] LT"},nextWeek:function(){return"dddd ["+(1!==this.hours()?"s":"a")+"] LT"},lastDay:function(){return"[onte "+(1!==this.hours()?"":"a")+"] LT"},lastWeek:function(){return"[o] dddd [pasado "+(1!==this.hours()?"s":"a")+"] LT"},sameElse:"L"},relativeTime:{future:function(D){return 0===D.indexOf("un")?"n"+D:"en "+D},past:"hai %s",s:"uns segundos",ss:"%d segundos",m:"un minuto",mm:"%d minutos",h:"unha hora",hh:"%d horas",d:"un da",dd:"%d das",M:"un mes",MM:"%d meses",y:"un ano",yy:"%d anos"},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:"%d",week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";function processRelativeTime(D,w,N,F){var k={s:["thodde secondanim","thodde second"],ss:[D+" secondanim",D+" second"],m:["eka mintan","ek minute"],mm:[D+" mintanim",D+" mintam"],h:["eka voran","ek vor"],hh:[D+" voranim",D+" voram"],d:["eka disan","ek dis"],dd:[D+" disanim",D+" dis"],M:["eka mhoinean","ek mhoino"],MM:[D+" mhoineanim",D+" mhoine"],y:["eka vorsan","ek voros"],yy:[D+" vorsanim",D+" vorsam"]};return w?k[N][0]:k[N][1]}D.defineLocale("gom-latn",{months:"Janer_Febrer_Mars_Abril_Mai_Jun_Julai_Agost_Setembr_Otubr_Novembr_Dezembr".split("_"),monthsShort:"Jan._Feb._Mars_Abr._Mai_Jun_Jul._Ago._Set._Otu._Nov._Dez.".split("_"),monthsParseExact:!0,weekdays:"Aitar_Somar_Mongllar_Budvar_Brestar_Sukrar_Son'var".split("_"),weekdaysShort:"Ait._Som._Mon._Bud._Bre._Suk._Son.".split("_"),weekdaysMin:"Ai_Sm_Mo_Bu_Br_Su_Sn".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"A h:mm [vazta]",LTS:"A h:mm:ss [vazta]",L:"DD-MM-YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY A h:mm [vazta]",LLLL:"dddd, MMMM[achea] Do, YYYY, A h:mm [vazta]",llll:"ddd, D MMM YYYY, A h:mm [vazta]"},calendar:{sameDay:"[Aiz] LT",nextDay:"[Faleam] LT",nextWeek:"[Ieta to] dddd[,] LT",lastDay:"[Kal] LT",lastWeek:"[Fatlo] dddd[,] LT",sameElse:"L"},relativeTime:{future:"%s",past:"%s adim",s:processRelativeTime,ss:processRelativeTime,m:processRelativeTime,mm:processRelativeTime,h:processRelativeTime,hh:processRelativeTime,d:processRelativeTime,dd:processRelativeTime,M:processRelativeTime,MM:processRelativeTime,y:processRelativeTime,yy:processRelativeTime},dayOfMonthOrdinalParse:/\d{1,2}(er)/,ordinal:function(D,w){switch(w){case"D":return D+"er";default:case"M":case"Q":case"DDD":case"d":case"w":case"W":return D}},week:{dow:1,doy:4},meridiemParse:/rati|sokalli|donparam|sanje/,meridiemHour:function(D,w){return 12===D&&(D=0),"rati"===w?D<4?D:D+12:"sokalli"===w?D:"donparam"===w?D>12?D:D+12:"sanje"===w?D+12:void 0},meridiem:function(D,w,N){return D<4?"rati":D<12?"sokalli":D<16?"donparam":D<20?"sanje":"rati"}})}(N(0))},function(D,w,N){!function(D){"use strict";var w={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},N={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};D.defineLocale("gu",{months:"___________".split("_"),monthsShort:"._.__.___._._._._._.".split("_"),monthsParseExact:!0,weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"A h:mm ",LTS:"A h:mm:ss ",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm ",LLLL:"dddd, D MMMM YYYY, A h:mm "},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"dddd, LT",lastDay:"[] LT",lastWeek:"[] dddd, LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:" ",ss:"%d ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},preparse:function(D){return D.replace(/[]/g,(function(D){return N[D]}))},postformat:function(D){return D.replace(/\d/g,(function(D){return w[D]}))},meridiemParse:/|||/,meridiemHour:function(D,w){return 12===D&&(D=0),""===w?D<4?D:D+12:""===w?D:""===w?D>=10?D:D+12:""===w?D+12:void 0},meridiem:function(D,w,N){return D<4?"":D<10?"":D<17?"":D<20?"":""},week:{dow:0,doy:6}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("he",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D []MMMM YYYY",LLL:"D []MMMM YYYY HH:mm",LLLL:"dddd, D []MMMM YYYY HH:mm",l:"D/M/YYYY",ll:"D MMM YYYY",lll:"D MMM YYYY HH:mm",llll:"ddd, D MMM YYYY HH:mm"},calendar:{sameDay:"[ ]LT",nextDay:"[ ]LT",nextWeek:"dddd [] LT",lastDay:"[ ]LT",lastWeek:"[] dddd [ ] LT",sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:" ",ss:"%d ",m:"",mm:"%d ",h:"",hh:function(D){return 2===D?"":D+" "},d:"",dd:function(D){return 2===D?"":D+" "},M:"",MM:function(D){return 2===D?"":D+" "},y:"",yy:function(D){return 2===D?"":D%10==0&&10!==D?D+" ":D+" "}},meridiemParse:/"|"| | | ||/i,isPM:function(D){return/^("| |)$/.test(D)},meridiem:function(D,w,N){return D<5?" ":D<10?"":D<12?N?'"':" ":D<18?N?'"':" ":""}})}(N(0))},function(D,w,N){!function(D){"use strict";var w={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},N={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};D.defineLocale("hi",{months:"___________".split("_"),monthsShort:"._.__.___._._._._._.".split("_"),monthsParseExact:!0,weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"A h:mm ",LTS:"A h:mm:ss ",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm ",LLLL:"dddd, D MMMM YYYY, A h:mm "},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"dddd, LT",lastDay:"[] LT",lastWeek:"[] dddd, LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:"  ",ss:"%d ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},preparse:function(D){return D.replace(/[]/g,(function(D){return N[D]}))},postformat:function(D){return D.replace(/\d/g,(function(D){return w[D]}))},meridiemParse:/|||/,meridiemHour:function(D,w){return 12===D&&(D=0),""===w?D<4?D:D+12:""===w?D:""===w?D>=10?D:D+12:""===w?D+12:void 0},meridiem:function(D,w,N){return D<4?"":D<10?"":D<17?"":D<20?"":""},week:{dow:0,doy:6}})}(N(0))},function(D,w,N){!function(D){"use strict";function translate(D,w,N){var F=D+" ";switch(N){case"ss":return F+=1===D?"sekunda":2===D||3===D||4===D?"sekunde":"sekundi";case"m":return w?"jedna minuta":"jedne minute";case"mm":return F+=1===D?"minuta":2===D||3===D||4===D?"minute":"minuta";case"h":return w?"jedan sat":"jednog sata";case"hh":return F+=1===D?"sat":2===D||3===D||4===D?"sata":"sati";case"dd":return F+=1===D?"dan":"dana";case"MM":return F+=1===D?"mjesec":2===D||3===D||4===D?"mjeseca":"mjeseci";case"yy":return F+=1===D?"godina":2===D||3===D||4===D?"godine":"godina"}}D.defineLocale("hr",{months:{format:"sijenja_veljae_oujka_travnja_svibnja_lipnja_srpnja_kolovoza_rujna_listopada_studenoga_prosinca".split("_"),standalone:"sijeanj_veljaa_oujak_travanj_svibanj_lipanj_srpanj_kolovoz_rujan_listopad_studeni_prosinac".split("_")},monthsShort:"sij._velj._ou._tra._svi._lip._srp._kol._ruj._lis._stu._pro.".split("_"),monthsParseExact:!0,weekdays:"nedjelja_ponedjeljak_utorak_srijeda_etvrtak_petak_subota".split("_"),weekdaysShort:"ned._pon._uto._sri._et._pet._sub.".split("_"),weekdaysMin:"ne_po_ut_sr_e_pe_su".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY H:mm",LLLL:"dddd, D. MMMM YYYY H:mm"},calendar:{sameDay:"[danas u] LT",nextDay:"[sutra u] LT",nextWeek:function(){switch(this.day()){case 0:return"[u] [nedjelju] [u] LT";case 3:return"[u] [srijedu] [u] LT";case 6:return"[u] [subotu] [u] LT";case 1:case 2:case 4:case 5:return"[u] dddd [u] LT"}},lastDay:"[juer u] LT",lastWeek:function(){switch(this.day()){case 0:case 3:return"[prolu] dddd [u] LT";case 6:return"[prole] [subote] [u] LT";case 1:case 2:case 4:case 5:return"[proli] dddd [u] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"prije %s",s:"par sekundi",ss:translate,m:translate,mm:translate,h:translate,hh:translate,d:"dan",dd:translate,M:"mjesec",MM:translate,y:"godinu",yy:translate},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}})}(N(0))},function(D,w,N){!function(D){"use strict";var w="vasrnap htfn kedden szerdn cstrtkn pnteken szombaton".split(" ");function translate(D,w,N,F){var k=D;switch(N){case"s":return F||w?"nhny msodperc":"nhny msodperce";case"ss":return k+(F||w)?" msodperc":" msodperce";case"m":return"egy"+(F||w?" perc":" perce");case"mm":return k+(F||w?" perc":" perce");case"h":return"egy"+(F||w?" ra":" rja");case"hh":return k+(F||w?" ra":" rja");case"d":return"egy"+(F||w?" nap":" napja");case"dd":return k+(F||w?" nap":" napja");case"M":return"egy"+(F||w?" hnap":" hnapja");case"MM":return k+(F||w?" hnap":" hnapja");case"y":return"egy"+(F||w?" v":" ve");case"yy":return k+(F||w?" v":" ve")}return""}function week(D){return(D?"":"[mlt] ")+"["+w[this.day()]+"] LT[-kor]"}D.defineLocale("hu",{months:"janur_februr_mrcius_prilis_mjus_jnius_jlius_augusztus_szeptember_oktber_november_december".split("_"),monthsShort:"jan_feb_mrc_pr_mj_jn_jl_aug_szept_okt_nov_dec".split("_"),weekdays:"vasrnap_htf_kedd_szerda_cstrtk_pntek_szombat".split("_"),weekdaysShort:"vas_ht_kedd_sze_cst_pn_szo".split("_"),weekdaysMin:"v_h_k_sze_cs_p_szo".split("_"),longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"YYYY.MM.DD.",LL:"YYYY. MMMM D.",LLL:"YYYY. MMMM D. H:mm",LLLL:"YYYY. MMMM D., dddd H:mm"},meridiemParse:/de|du/i,isPM:function(D){return"u"===D.charAt(1).toLowerCase()},meridiem:function(D,w,N){return D<12?!0===N?"de":"DE":!0===N?"du":"DU"},calendar:{sameDay:"[ma] LT[-kor]",nextDay:"[holnap] LT[-kor]",nextWeek:function(){return week.call(this,!0)},lastDay:"[tegnap] LT[-kor]",lastWeek:function(){return week.call(this,!1)},sameElse:"L"},relativeTime:{future:"%s mlva",past:"%s",s:translate,ss:translate,m:translate,mm:translate,h:translate,hh:translate,d:translate,dd:translate,M:translate,MM:translate,y:translate,yy:translate},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("hy-am",{months:{format:"___________".split("_"),standalone:"___________".split("_")},monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY .",LLL:"D MMMM YYYY ., HH:mm",LLLL:"dddd, D MMMM YYYY ., HH:mm"},calendar:{sameDay:"[] LT",nextDay:"[] LT",lastDay:"[] LT",nextWeek:function(){return"dddd [ ] LT"},lastWeek:function(){return"[] dddd [ ] LT"},sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:"  ",ss:"%d ",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},meridiemParse:/|||/,isPM:function(D){return/^(|)$/.test(D)},meridiem:function(D){return D<4?"":D<12?"":D<17?"":""},dayOfMonthOrdinalParse:/\d{1,2}|\d{1,2}-(|)/,ordinal:function(D,w){switch(w){case"DDD":case"w":case"W":case"DDDo":return 1===D?D+"-":D+"-";default:return D}},week:{dow:1,doy:7}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("id",{months:"Januari_Februari_Maret_April_Mei_Juni_Juli_Agustus_September_Oktober_November_Desember".split("_"),monthsShort:"Jan_Feb_Mar_Apr_Mei_Jun_Jul_Agt_Sep_Okt_Nov_Des".split("_"),weekdays:"Minggu_Senin_Selasa_Rabu_Kamis_Jumat_Sabtu".split("_"),weekdaysShort:"Min_Sen_Sel_Rab_Kam_Jum_Sab".split("_"),weekdaysMin:"Mg_Sn_Sl_Rb_Km_Jm_Sb".split("_"),longDateFormat:{LT:"HH.mm",LTS:"HH.mm.ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [pukul] HH.mm",LLLL:"dddd, D MMMM YYYY [pukul] HH.mm"},meridiemParse:/pagi|siang|sore|malam/,meridiemHour:function(D,w){return 12===D&&(D=0),"pagi"===w?D:"siang"===w?D>=11?D:D+12:"sore"===w||"malam"===w?D+12:void 0},meridiem:function(D,w,N){return D<11?"pagi":D<15?"siang":D<19?"sore":"malam"},calendar:{sameDay:"[Hari ini pukul] LT",nextDay:"[Besok pukul] LT",nextWeek:"dddd [pukul] LT",lastDay:"[Kemarin pukul] LT",lastWeek:"dddd [lalu pukul] LT",sameElse:"L"},relativeTime:{future:"dalam %s",past:"%s yang lalu",s:"beberapa detik",ss:"%d detik",m:"semenit",mm:"%d menit",h:"sejam",hh:"%d jam",d:"sehari",dd:"%d hari",M:"sebulan",MM:"%d bulan",y:"setahun",yy:"%d tahun"},week:{dow:1,doy:7}})}(N(0))},function(D,w,N){!function(D){"use strict";function plural(D){return D%100==11||D%10!=1}function translate(D,w,N,F){var k=D+" ";switch(N){case"s":return w||F?"nokkrar sekndur":"nokkrum sekndum";case"ss":return plural(D)?k+(w||F?"sekndur":"sekndum"):k+"seknda";case"m":return w?"mnta":"mntu";case"mm":return plural(D)?k+(w||F?"mntur":"mntum"):w?k+"mnta":k+"mntu";case"hh":return plural(D)?k+(w||F?"klukkustundir":"klukkustundum"):k+"klukkustund";case"d":return w?"dagur":F?"dag":"degi";case"dd":return plural(D)?w?k+"dagar":k+(F?"daga":"dgum"):w?k+"dagur":k+(F?"dag":"degi");case"M":return w?"mnuur":F?"mnu":"mnui";case"MM":return plural(D)?w?k+"mnuir":k+(F?"mnui":"mnuum"):w?k+"mnuur":k+(F?"mnu":"mnui");case"y":return w||F?"r":"ri";case"yy":return plural(D)?k+(w||F?"r":"rum"):k+(w||F?"r":"ri")}}D.defineLocale("is",{months:"janar_febrar_mars_aprl_ma_jn_jl_gst_september_oktber_nvember_desember".split("_"),monthsShort:"jan_feb_mar_apr_ma_jn_jl_g_sep_okt_nv_des".split("_"),weekdays:"sunnudagur_mnudagur_rijudagur_mivikudagur_fimmtudagur_fstudagur_laugardagur".split("_"),weekdaysShort:"sun_mn_ri_mi_fim_fs_lau".split("_"),weekdaysMin:"Su_M_r_Mi_Fi_F_La".split("_"),longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY [kl.] H:mm",LLLL:"dddd, D. MMMM YYYY [kl.] H:mm"},calendar:{sameDay:"[ dag kl.] LT",nextDay:"[ morgun kl.] LT",nextWeek:"dddd [kl.] LT",lastDay:"[ gr kl.] LT",lastWeek:"[sasta] dddd [kl.] LT",sameElse:"L"},relativeTime:{future:"eftir %s",past:"fyrir %s san",s:translate,ss:translate,m:translate,mm:translate,h:"klukkustund",hh:translate,d:translate,dd:translate,M:translate,MM:translate,y:translate,yy:translate},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("it",{months:"gennaio_febbraio_marzo_aprile_maggio_giugno_luglio_agosto_settembre_ottobre_novembre_dicembre".split("_"),monthsShort:"gen_feb_mar_apr_mag_giu_lug_ago_set_ott_nov_dic".split("_"),weekdays:"domenica_luned_marted_mercoled_gioved_venerd_sabato".split("_"),weekdaysShort:"dom_lun_mar_mer_gio_ven_sab".split("_"),weekdaysMin:"do_lu_ma_me_gi_ve_sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[Oggi alle] LT",nextDay:"[Domani alle] LT",nextWeek:"dddd [alle] LT",lastDay:"[Ieri alle] LT",lastWeek:function(){switch(this.day()){case 0:return"[la scorsa] dddd [alle] LT";default:return"[lo scorso] dddd [alle] LT"}},sameElse:"L"},relativeTime:{future:function(D){return(/^[0-9].+$/.test(D)?"tra":"in")+" "+D},past:"%s fa",s:"alcuni secondi",ss:"%d secondi",m:"un minuto",mm:"%d minuti",h:"un'ora",hh:"%d ore",d:"un giorno",dd:"%d giorni",M:"un mese",MM:"%d mesi",y:"un anno",yy:"%d anni"},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:"%d",week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("it-ch",{months:"gennaio_febbraio_marzo_aprile_maggio_giugno_luglio_agosto_settembre_ottobre_novembre_dicembre".split("_"),monthsShort:"gen_feb_mar_apr_mag_giu_lug_ago_set_ott_nov_dic".split("_"),weekdays:"domenica_luned_marted_mercoled_gioved_venerd_sabato".split("_"),weekdaysShort:"dom_lun_mar_mer_gio_ven_sab".split("_"),weekdaysMin:"do_lu_ma_me_gi_ve_sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[Oggi alle] LT",nextDay:"[Domani alle] LT",nextWeek:"dddd [alle] LT",lastDay:"[Ieri alle] LT",lastWeek:function(){switch(this.day()){case 0:return"[la scorsa] dddd [alle] LT";default:return"[lo scorso] dddd [alle] LT"}},sameElse:"L"},relativeTime:{future:function(D){return(/^[0-9].+$/.test(D)?"tra":"in")+" "+D},past:"%s fa",s:"alcuni secondi",ss:"%d secondi",m:"un minuto",mm:"%d minuti",h:"un'ora",hh:"%d ore",d:"un giorno",dd:"%d giorni",M:"un mese",MM:"%d mesi",y:"un anno",yy:"%d anni"},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:"%d",week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("ja",{months:"___________".split("_"),monthsShort:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"YYYYMD",LLL:"YYYYMD HH:mm",LLLL:"YYYYMD dddd HH:mm",l:"YYYY/MM/DD",ll:"YYYYMD",lll:"YYYYMD HH:mm",llll:"YYYYMD(ddd) HH:mm"},meridiemParse:/|/i,isPM:function(D){return""===D},meridiem:function(D,w,N){return D<12?"":""},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:function(D){return D.week()<this.week()?"[]dddd LT":"dddd LT"},lastDay:"[] LT",lastWeek:function(D){return this.week()<D.week()?"[]dddd LT":"dddd LT"},sameElse:"L"},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:function(D,w){switch(w){case"d":case"D":case"DDD":return D+"";default:return D}},relativeTime:{future:"%s",past:"%s",s:"",ss:"%d",m:"1",mm:"%d",h:"1",hh:"%d",d:"1",dd:"%d",M:"1",MM:"%d",y:"1",yy:"%d"}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("jv",{months:"Januari_Februari_Maret_April_Mei_Juni_Juli_Agustus_September_Oktober_Nopember_Desember".split("_"),monthsShort:"Jan_Feb_Mar_Apr_Mei_Jun_Jul_Ags_Sep_Okt_Nop_Des".split("_"),weekdays:"Minggu_Senen_Seloso_Rebu_Kemis_Jemuwah_Septu".split("_"),weekdaysShort:"Min_Sen_Sel_Reb_Kem_Jem_Sep".split("_"),weekdaysMin:"Mg_Sn_Sl_Rb_Km_Jm_Sp".split("_"),longDateFormat:{LT:"HH.mm",LTS:"HH.mm.ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [pukul] HH.mm",LLLL:"dddd, D MMMM YYYY [pukul] HH.mm"},meridiemParse:/enjing|siyang|sonten|ndalu/,meridiemHour:function(D,w){return 12===D&&(D=0),"enjing"===w?D:"siyang"===w?D>=11?D:D+12:"sonten"===w||"ndalu"===w?D+12:void 0},meridiem:function(D,w,N){return D<11?"enjing":D<15?"siyang":D<19?"sonten":"ndalu"},calendar:{sameDay:"[Dinten puniko pukul] LT",nextDay:"[Mbenjang pukul] LT",nextWeek:"dddd [pukul] LT",lastDay:"[Kala wingi pukul] LT",lastWeek:"dddd [kepengker pukul] LT",sameElse:"L"},relativeTime:{future:"wonten ing %s",past:"%s ingkang kepengker",s:"sawetawis detik",ss:"%d detik",m:"setunggal menit",mm:"%d menit",h:"setunggal jam",hh:"%d jam",d:"sedinten",dd:"%d dinten",M:"sewulan",MM:"%d wulan",y:"setaun",yy:"%d taun"},week:{dow:1,doy:7}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("ka",{months:{standalone:"___________".split("_"),format:"___________".split("_")},monthsShort:"___________".split("_"),weekdays:{standalone:"______".split("_"),format:"______".split("_"),isFormat:/(|)/},weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY h:mm A",LLLL:"dddd, D MMMM YYYY h:mm A"},calendar:{sameDay:"[] LT[-]",nextDay:"[] LT[-]",lastDay:"[] LT[-]",nextWeek:"[] dddd LT[-]",lastWeek:"[] dddd LT-",sameElse:"L"},relativeTime:{future:function(D){return/(|||)/.test(D)?D.replace(/$/,""):D+""},past:function(D){return/(||||)/.test(D)?D.replace(/(|)$/," ")://.test(D)?D.replace(/$/," "):void 0},s:" ",ss:"%d ",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},dayOfMonthOrdinalParse:/0|1-|-\d{1,2}|\d{1,2}-/,ordinal:function(D){return 0===D?D:1===D?D+"-":D<20||D<=100&&D%20==0||D%100==0?"-"+D:D+"-"},week:{dow:1,doy:7}})}(N(0))},function(D,w,N){!function(D){"use strict";var w={0:"-",1:"-",2:"-",3:"-",4:"-",5:"-",6:"-",7:"-",8:"-",9:"-",10:"-",20:"-",30:"-",40:"-",50:"-",60:"-",70:"-",80:"-",90:"-",100:"-"};D.defineLocale("kk",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"dddd [] LT",lastDay:"[ ] LT",lastWeek:"[ ] dddd [] LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:" ",ss:"%d ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},dayOfMonthOrdinalParse:/\d{1,2}-(|)/,ordinal:function(D){return D+(w[D]||w[D%10]||w[D>=100?100:null])},week:{dow:1,doy:7}})}(N(0))},function(D,w,N){!function(D){"use strict";var w={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},N={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};D.defineLocale("km",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},meridiemParse:/|/,isPM:function(D){return""===D},meridiem:function(D,w,N){return D<12?"":""},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"dddd [] LT",lastDay:"[ ] LT",lastWeek:"dddd [] [] LT",sameElse:"L"},relativeTime:{future:"%s",past:"%s",s:"",ss:"%d ",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:"%d",preparse:function(D){return D.replace(/[]/g,(function(D){return N[D]}))},postformat:function(D){return D.replace(/\d/g,(function(D){return w[D]}))},week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";var w={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},N={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};D.defineLocale("kn",{months:"___________".split("_"),monthsShort:"___________".split("_"),monthsParseExact:!0,weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"A h:mm",LTS:"A h:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm",LLLL:"dddd, D MMMM YYYY, A h:mm"},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"dddd, LT",lastDay:"[] LT",lastWeek:"[] dddd, LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:" ",ss:"%d ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},preparse:function(D){return D.replace(/[]/g,(function(D){return N[D]}))},postformat:function(D){return D.replace(/\d/g,(function(D){return w[D]}))},meridiemParse:/|||/,meridiemHour:function(D,w){return 12===D&&(D=0),""===w?D<4?D:D+12:""===w?D:""===w?D>=10?D:D+12:""===w?D+12:void 0},meridiem:function(D,w,N){return D<4?"":D<10?"":D<17?"":D<20?"":""},dayOfMonthOrdinalParse:/\d{1,2}()/,ordinal:function(D){return D+""},week:{dow:0,doy:6}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("ko",{months:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),monthsShort:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"A h:mm",LTS:"A h:mm:ss",L:"YYYY.MM.DD.",LL:"YYYY MMMM D",LLL:"YYYY MMMM D A h:mm",LLLL:"YYYY MMMM D dddd A h:mm",l:"YYYY.MM.DD.",ll:"YYYY MMMM D",lll:"YYYY MMMM D A h:mm",llll:"YYYY MMMM D dddd A h:mm"},calendar:{sameDay:" LT",nextDay:" LT",nextWeek:"dddd LT",lastDay:" LT",lastWeek:" dddd LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:" ",ss:"%d",m:"1",mm:"%d",h:" ",hh:"%d",d:"",dd:"%d",M:" ",MM:"%d",y:" ",yy:"%d"},dayOfMonthOrdinalParse:/\d{1,2}(||)/,ordinal:function(D,w){switch(w){case"d":case"D":case"DDD":return D+"";case"M":return D+"";case"w":case"W":return D+"";default:return D}},meridiemParse:/|/,isPM:function(D){return""===D},meridiem:function(D,w,N){return D<12?"":""}})}(N(0))},function(D,w,N){!function(D){"use strict";var w={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},N={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"},F=[" ","","","","","","","",""," "," "," "];D.defineLocale("ku",{months:F,monthsShort:F,weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},meridiemParse:/|/,isPM:function(D){return//.test(D)},meridiem:function(D,w,N){return D<12?"":""},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"dddd [] LT",lastDay:"[ ] LT",lastWeek:"dddd [] LT",sameElse:"L"},relativeTime:{future:" %s",past:"%s",s:" ",ss:" %d",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},preparse:function(D){return D.replace(/[]/g,(function(D){return N[D]})).replace(//g,",")},postformat:function(D){return D.replace(/\d/g,(function(D){return w[D]})).replace(/,/g,"")},week:{dow:6,doy:12}})}(N(0))},function(D,w,N){!function(D){"use strict";var w={0:"-",1:"-",2:"-",3:"-",4:"-",5:"-",6:"-",7:"-",8:"-",9:"-",10:"-",20:"-",30:"-",40:"-",50:"-",60:"-",70:"-",80:"-",90:"-",100:"-"};D.defineLocale("ky",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"dddd [] LT",lastDay:"[ ] LT",lastWeek:"[ ] dddd [] [] LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:" ",ss:"%d ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},dayOfMonthOrdinalParse:/\d{1,2}-(|||)/,ordinal:function(D){return D+(w[D]||w[D%10]||w[D>=100?100:null])},week:{dow:1,doy:7}})}(N(0))},function(D,w,N){!function(D){"use strict";function processRelativeTime(D,w,N,F){var k={m:["eng Minutt","enger Minutt"],h:["eng Stonn","enger Stonn"],d:["een Dag","engem Dag"],M:["ee Mount","engem Mount"],y:["ee Joer","engem Joer"]};return w?k[N][0]:k[N][1]}function eifelerRegelAppliesToNumber(D){if(D=parseInt(D,10),isNaN(D))return!1;if(D<0)return!0;if(D<10)return 4<=D&&D<=7;if(D<100){var w=D%10;return eifelerRegelAppliesToNumber(0===w?D/10:w)}if(D<1e4){for(;D>=10;)D/=10;return eifelerRegelAppliesToNumber(D)}return eifelerRegelAppliesToNumber(D/=1e3)}D.defineLocale("lb",{months:"Januar_Februar_Merz_Abrll_Mee_Juni_Juli_August_September_Oktober_November_Dezember".split("_"),monthsShort:"Jan._Febr._Mrz._Abr._Mee_Jun._Jul._Aug._Sept._Okt._Nov._Dez.".split("_"),monthsParseExact:!0,weekdays:"Sonndeg_Mindeg_Dnschdeg_Mttwoch_Donneschdeg_Freideg_Samschdeg".split("_"),weekdaysShort:"So._M._D._M._Do._Fr._Sa.".split("_"),weekdaysMin:"So_M_D_M_Do_Fr_Sa".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm [Auer]",LTS:"H:mm:ss [Auer]",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY H:mm [Auer]",LLLL:"dddd, D. MMMM YYYY H:mm [Auer]"},calendar:{sameDay:"[Haut um] LT",sameElse:"L",nextDay:"[Muer um] LT",nextWeek:"dddd [um] LT",lastDay:"[Gschter um] LT",lastWeek:function(){switch(this.day()){case 2:case 4:return"[Leschten] dddd [um] LT";default:return"[Leschte] dddd [um] LT"}}},relativeTime:{future:function processFutureTime(D){return eifelerRegelAppliesToNumber(D.substr(0,D.indexOf(" ")))?"a "+D:"an "+D},past:function processPastTime(D){return eifelerRegelAppliesToNumber(D.substr(0,D.indexOf(" ")))?"viru "+D:"virun "+D},s:"e puer Sekonnen",ss:"%d Sekonnen",m:processRelativeTime,mm:"%d Minutten",h:processRelativeTime,hh:"%d Stonnen",d:processRelativeTime,dd:"%d Deeg",M:processRelativeTime,MM:"%d Mint",y:processRelativeTime,yy:"%d Joer"},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("lo",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},meridiemParse:/|/,isPM:function(D){return""===D},meridiem:function(D,w,N){return D<12?"":""},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"[]dddd[] LT",lastDay:"[] LT",lastWeek:"[]dddd[] LT",sameElse:"L"},relativeTime:{future:" %s",past:"%s",s:"",ss:"%d ",m:"1 ",mm:"%d ",h:"1 ",hh:"%d ",d:"1 ",dd:"%d ",M:"1 ",MM:"%d ",y:"1 ",yy:"%d "},dayOfMonthOrdinalParse:/()\d{1,2}/,ordinal:function(D){return""+D}})}(N(0))},function(D,w,N){!function(D){"use strict";var w={ss:"sekund_sekundi_sekundes",m:"minut_minuts_minut",mm:"minuts_minui_minutes",h:"valanda_valandos_valand",hh:"valandos_valand_valandas",d:"diena_dienos_dien",dd:"dienos_dien_dienas",M:"mnuo_mnesio_mnes",MM:"mnesiai_mnesi_mnesius",y:"metai_met_metus",yy:"metai_met_metus"};function translateSingular(D,w,N,F){return w?forms(N)[0]:F?forms(N)[1]:forms(N)[2]}function special(D){return D%10==0||D>10&&D<20}function forms(D){return w[D].split("_")}function translate(D,w,N,F){var k=D+" ";return 1===D?k+translateSingular(0,w,N[0],F):w?k+(special(D)?forms(N)[1]:forms(N)[0]):F?k+forms(N)[1]:k+(special(D)?forms(N)[1]:forms(N)[2])}D.defineLocale("lt",{months:{format:"sausio_vasario_kovo_balandio_gegus_birelio_liepos_rugpjio_rugsjo_spalio_lapkriio_gruodio".split("_"),standalone:"sausis_vasaris_kovas_balandis_gegu_birelis_liepa_rugpjtis_rugsjis_spalis_lapkritis_gruodis".split("_"),isFormat:/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?|MMMM?(\[[^\[\]]*\]|\s)+D[oD]?/},monthsShort:"sau_vas_kov_bal_geg_bir_lie_rgp_rgs_spa_lap_grd".split("_"),weekdays:{format:"sekmadien_pirmadien_antradien_treiadien_ketvirtadien_penktadien_etadien".split("_"),standalone:"sekmadienis_pirmadienis_antradienis_treiadienis_ketvirtadienis_penktadienis_etadienis".split("_"),isFormat:/dddd HH:mm/},weekdaysShort:"Sek_Pir_Ant_Tre_Ket_Pen_e".split("_"),weekdaysMin:"S_P_A_T_K_Pn_".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY-MM-DD",LL:"YYYY [m.] MMMM D [d.]",LLL:"YYYY [m.] MMMM D [d.], HH:mm [val.]",LLLL:"YYYY [m.] MMMM D [d.], dddd, HH:mm [val.]",l:"YYYY-MM-DD",ll:"YYYY [m.] MMMM D [d.]",lll:"YYYY [m.] MMMM D [d.], HH:mm [val.]",llll:"YYYY [m.] MMMM D [d.], ddd, HH:mm [val.]"},calendar:{sameDay:"[iandien] LT",nextDay:"[Rytoj] LT",nextWeek:"dddd LT",lastDay:"[Vakar] LT",lastWeek:"[Prajus] dddd LT",sameElse:"L"},relativeTime:{future:"po %s",past:"prie %s",s:function translateSeconds(D,w,N,F){return w?"kelios sekunds":F?"keli sekundi":"kelias sekundes"},ss:translate,m:translateSingular,mm:translate,h:translateSingular,hh:translate,d:translateSingular,dd:translate,M:translateSingular,MM:translate,y:translateSingular,yy:translate},dayOfMonthOrdinalParse:/\d{1,2}-oji/,ordinal:function(D){return D+"-oji"},week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";var w={ss:"sekundes_sekundm_sekunde_sekundes".split("_"),m:"mintes_mintm_minte_mintes".split("_"),mm:"mintes_mintm_minte_mintes".split("_"),h:"stundas_stundm_stunda_stundas".split("_"),hh:"stundas_stundm_stunda_stundas".split("_"),d:"dienas_dienm_diena_dienas".split("_"),dd:"dienas_dienm_diena_dienas".split("_"),M:"mnea_mneiem_mnesis_mnei".split("_"),MM:"mnea_mneiem_mnesis_mnei".split("_"),y:"gada_gadiem_gads_gadi".split("_"),yy:"gada_gadiem_gads_gadi".split("_")};function format(D,w,N){return N?w%10==1&&w%100!=11?D[2]:D[3]:w%10==1&&w%100!=11?D[0]:D[1]}function relativeTimeWithPlural(D,N,F){return D+" "+format(w[F],D,N)}function relativeTimeWithSingular(D,N,F){return format(w[F],D,N)}D.defineLocale("lv",{months:"janvris_februris_marts_aprlis_maijs_jnijs_jlijs_augusts_septembris_oktobris_novembris_decembris".split("_"),monthsShort:"jan_feb_mar_apr_mai_jn_jl_aug_sep_okt_nov_dec".split("_"),weekdays:"svtdiena_pirmdiena_otrdiena_trediena_ceturtdiena_piektdiena_sestdiena".split("_"),weekdaysShort:"Sv_P_O_T_C_Pk_S".split("_"),weekdaysMin:"Sv_P_O_T_C_Pk_S".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY.",LL:"YYYY. [gada] D. MMMM",LLL:"YYYY. [gada] D. MMMM, HH:mm",LLLL:"YYYY. [gada] D. MMMM, dddd, HH:mm"},calendar:{sameDay:"[odien pulksten] LT",nextDay:"[Rt pulksten] LT",nextWeek:"dddd [pulksten] LT",lastDay:"[Vakar pulksten] LT",lastWeek:"[Pagju] dddd [pulksten] LT",sameElse:"L"},relativeTime:{future:"pc %s",past:"pirms %s",s:function relativeSeconds(D,w){return w?"daas sekundes":"dam sekundm"},ss:relativeTimeWithPlural,m:relativeTimeWithSingular,mm:relativeTimeWithPlural,h:relativeTimeWithSingular,hh:relativeTimeWithPlural,d:relativeTimeWithSingular,dd:relativeTimeWithPlural,M:relativeTimeWithSingular,MM:relativeTimeWithPlural,y:relativeTimeWithSingular,yy:relativeTimeWithPlural},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";var w={words:{ss:["sekund","sekunda","sekundi"],m:["jedan minut","jednog minuta"],mm:["minut","minuta","minuta"],h:["jedan sat","jednog sata"],hh:["sat","sata","sati"],dd:["dan","dana","dana"],MM:["mjesec","mjeseca","mjeseci"],yy:["godina","godine","godina"]},correctGrammaticalCase:function(D,w){return 1===D?w[0]:D>=2&&D<=4?w[1]:w[2]},translate:function(D,N,F){var k=w.words[F];return 1===F.length?N?k[0]:k[1]:D+" "+w.correctGrammaticalCase(D,k)}};D.defineLocale("me",{months:"januar_februar_mart_april_maj_jun_jul_avgust_septembar_oktobar_novembar_decembar".split("_"),monthsShort:"jan._feb._mar._apr._maj_jun_jul_avg._sep._okt._nov._dec.".split("_"),monthsParseExact:!0,weekdays:"nedjelja_ponedjeljak_utorak_srijeda_etvrtak_petak_subota".split("_"),weekdaysShort:"ned._pon._uto._sri._et._pet._sub.".split("_"),weekdaysMin:"ne_po_ut_sr_e_pe_su".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY H:mm",LLLL:"dddd, D. MMMM YYYY H:mm"},calendar:{sameDay:"[danas u] LT",nextDay:"[sjutra u] LT",nextWeek:function(){switch(this.day()){case 0:return"[u] [nedjelju] [u] LT";case 3:return"[u] [srijedu] [u] LT";case 6:return"[u] [subotu] [u] LT";case 1:case 2:case 4:case 5:return"[u] dddd [u] LT"}},lastDay:"[jue u] LT",lastWeek:function(){return["[prole] [nedjelje] [u] LT","[prolog] [ponedjeljka] [u] LT","[prolog] [utorka] [u] LT","[prole] [srijede] [u] LT","[prolog] [etvrtka] [u] LT","[prolog] [petka] [u] LT","[prole] [subote] [u] LT"][this.day()]},sameElse:"L"},relativeTime:{future:"za %s",past:"prije %s",s:"nekoliko sekundi",ss:w.translate,m:w.translate,mm:w.translate,h:w.translate,hh:w.translate,d:"dan",dd:w.translate,M:"mjesec",MM:w.translate,y:"godinu",yy:w.translate},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("mi",{months:"Kohi-tte_Hui-tanguru_Pout-te-rangi_Paenga-whwh_Haratua_Pipiri_Hngoingoi_Here-turi-kk_Mahuru_Whiringa--nuku_Whiringa--rangi_Hakihea".split("_"),monthsShort:"Kohi_Hui_Pou_Pae_Hara_Pipi_Hngoi_Here_Mahu_Whi-nu_Whi-ra_Haki".split("_"),monthsRegex:/(?:['a-z\u0101\u014D\u016B]+\-?){1,3}/i,monthsStrictRegex:/(?:['a-z\u0101\u014D\u016B]+\-?){1,3}/i,monthsShortRegex:/(?:['a-z\u0101\u014D\u016B]+\-?){1,3}/i,monthsShortStrictRegex:/(?:['a-z\u0101\u014D\u016B]+\-?){1,2}/i,weekdays:"Rtapu_Mane_Trei_Wenerei_Tite_Paraire_Htarei".split("_"),weekdaysShort:"Ta_Ma_T_We_Ti_Pa_H".split("_"),weekdaysMin:"Ta_Ma_T_We_Ti_Pa_H".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [i] HH:mm",LLLL:"dddd, D MMMM YYYY [i] HH:mm"},calendar:{sameDay:"[i teie mahana, i] LT",nextDay:"[apopo i] LT",nextWeek:"dddd [i] LT",lastDay:"[inanahi i] LT",lastWeek:"dddd [whakamutunga i] LT",sameElse:"L"},relativeTime:{future:"i roto i %s",past:"%s i mua",s:"te hkona ruarua",ss:"%d hkona",m:"he meneti",mm:"%d meneti",h:"te haora",hh:"%d haora",d:"he ra",dd:"%d ra",M:"he marama",MM:"%d marama",y:"he tau",yy:"%d tau"},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:"%d",week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("mk",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"e_o_____a".split("_"),longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"D.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY H:mm",LLLL:"dddd, D MMMM YYYY H:mm"},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"[] dddd [] LT",lastDay:"[ ] LT",lastWeek:function(){switch(this.day()){case 0:case 3:case 6:return"[] dddd [] LT";case 1:case 2:case 4:case 5:return"[] dddd [] LT"}},sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:" ",ss:"%d ",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},dayOfMonthOrdinalParse:/\d{1,2}-(|||||)/,ordinal:function(D){var w=D%10,N=D%100;return 0===D?D+"-":0===N?D+"-":N>10&&N<20?D+"-":1===w?D+"-":2===w?D+"-":7===w||8===w?D+"-":D+"-"},week:{dow:1,doy:7}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("ml",{months:"___________".split("_"),monthsShort:"._._._.___._._._._._.".split("_"),monthsParseExact:!0,weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"A h:mm -",LTS:"A h:mm:ss -",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm -",LLLL:"dddd, D MMMM YYYY, A h:mm -"},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"dddd, LT",lastDay:"[] LT",lastWeek:"[] dddd, LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:" ",ss:"%d ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},meridiemParse:/|| ||/i,meridiemHour:function(D,w){return 12===D&&(D=0),""===w&&D>=4||" "===w||""===w?D+12:D},meridiem:function(D,w,N){return D<4?"":D<12?"":D<17?" ":D<20?"":""}})}(N(0))},function(D,w,N){!function(D){"use strict";function translate(D,w,N,F){switch(N){case"s":return w?" ":" ";case"ss":return D+(w?" ":" ");case"m":case"mm":return D+(w?" ":" ");case"h":case"hh":return D+(w?" ":" ");case"d":case"dd":return D+(w?" ":" ");case"M":case"MM":return D+(w?" ":" ");case"y":case"yy":return D+(w?" ":" ");default:return D}}D.defineLocale("mn",{months:" _ _ _ _ _ _ _ _ _ _  _  ".split("_"),monthsShort:"1 _2 _3 _4 _5 _6 _7 _8 _9 _10 _11 _12 ".split("_"),monthsParseExact:!0,weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY-MM-DD",LL:"YYYY  MMMM D",LLL:"YYYY  MMMM D HH:mm",LLLL:"dddd, YYYY  MMMM D HH:mm"},meridiemParse:/|/i,isPM:function(D){return""===D},meridiem:function(D,w,N){return D<12?"":""},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"[] dddd LT",lastDay:"[] LT",lastWeek:"[] dddd LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:translate,ss:translate,m:translate,mm:translate,h:translate,hh:translate,d:translate,dd:translate,M:translate,MM:translate,y:translate,yy:translate},dayOfMonthOrdinalParse:/\d{1,2} /,ordinal:function(D,w){switch(w){case"d":case"D":case"DDD":return D+" ";default:return D}}})}(N(0))},function(D,w,N){!function(D){"use strict";var w={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},N={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};function relativeTimeMr(D,w,N,F){var k="";if(w)switch(N){case"s":k=" ";break;case"ss":k="%d ";break;case"m":k=" ";break;case"mm":k="%d ";break;case"h":k=" ";break;case"hh":k="%d ";break;case"d":k=" ";break;case"dd":k="%d ";break;case"M":k=" ";break;case"MM":k="%d ";break;case"y":k=" ";break;case"yy":k="%d "}else switch(N){case"s":k=" ";break;case"ss":k="%d ";break;case"m":k=" ";break;case"mm":k="%d ";break;case"h":k=" ";break;case"hh":k="%d ";break;case"d":k=" ";break;case"dd":k="%d ";break;case"M":k=" ";break;case"MM":k="%d ";break;case"y":k=" ";break;case"yy":k="%d "}return k.replace(/%d/i,D)}D.defineLocale("mr",{months:"___________".split("_"),monthsShort:"._._._._._._._._._._._.".split("_"),monthsParseExact:!0,weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"A h:mm ",LTS:"A h:mm:ss ",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm ",LLLL:"dddd, D MMMM YYYY, A h:mm "},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"dddd, LT",lastDay:"[] LT",lastWeek:"[] dddd, LT",sameElse:"L"},relativeTime:{future:"%s",past:"%s",s:relativeTimeMr,ss:relativeTimeMr,m:relativeTimeMr,mm:relativeTimeMr,h:relativeTimeMr,hh:relativeTimeMr,d:relativeTimeMr,dd:relativeTimeMr,M:relativeTimeMr,MM:relativeTimeMr,y:relativeTimeMr,yy:relativeTimeMr},preparse:function(D){return D.replace(/[]/g,(function(D){return N[D]}))},postformat:function(D){return D.replace(/\d/g,(function(D){return w[D]}))},meridiemParse:/|||/,meridiemHour:function(D,w){return 12===D&&(D=0),""===w?D<4?D:D+12:""===w?D:""===w?D>=10?D:D+12:""===w?D+12:void 0},meridiem:function(D,w,N){return D<4?"":D<10?"":D<17?"":D<20?"":""},week:{dow:0,doy:6}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("ms",{months:"Januari_Februari_Mac_April_Mei_Jun_Julai_Ogos_September_Oktober_November_Disember".split("_"),monthsShort:"Jan_Feb_Mac_Apr_Mei_Jun_Jul_Ogs_Sep_Okt_Nov_Dis".split("_"),weekdays:"Ahad_Isnin_Selasa_Rabu_Khamis_Jumaat_Sabtu".split("_"),weekdaysShort:"Ahd_Isn_Sel_Rab_Kha_Jum_Sab".split("_"),weekdaysMin:"Ah_Is_Sl_Rb_Km_Jm_Sb".split("_"),longDateFormat:{LT:"HH.mm",LTS:"HH.mm.ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [pukul] HH.mm",LLLL:"dddd, D MMMM YYYY [pukul] HH.mm"},meridiemParse:/pagi|tengahari|petang|malam/,meridiemHour:function(D,w){return 12===D&&(D=0),"pagi"===w?D:"tengahari"===w?D>=11?D:D+12:"petang"===w||"malam"===w?D+12:void 0},meridiem:function(D,w,N){return D<11?"pagi":D<15?"tengahari":D<19?"petang":"malam"},calendar:{sameDay:"[Hari ini pukul] LT",nextDay:"[Esok pukul] LT",nextWeek:"dddd [pukul] LT",lastDay:"[Kelmarin pukul] LT",lastWeek:"dddd [lepas pukul] LT",sameElse:"L"},relativeTime:{future:"dalam %s",past:"%s yang lepas",s:"beberapa saat",ss:"%d saat",m:"seminit",mm:"%d minit",h:"sejam",hh:"%d jam",d:"sehari",dd:"%d hari",M:"sebulan",MM:"%d bulan",y:"setahun",yy:"%d tahun"},week:{dow:1,doy:7}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("ms-my",{months:"Januari_Februari_Mac_April_Mei_Jun_Julai_Ogos_September_Oktober_November_Disember".split("_"),monthsShort:"Jan_Feb_Mac_Apr_Mei_Jun_Jul_Ogs_Sep_Okt_Nov_Dis".split("_"),weekdays:"Ahad_Isnin_Selasa_Rabu_Khamis_Jumaat_Sabtu".split("_"),weekdaysShort:"Ahd_Isn_Sel_Rab_Kha_Jum_Sab".split("_"),weekdaysMin:"Ah_Is_Sl_Rb_Km_Jm_Sb".split("_"),longDateFormat:{LT:"HH.mm",LTS:"HH.mm.ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [pukul] HH.mm",LLLL:"dddd, D MMMM YYYY [pukul] HH.mm"},meridiemParse:/pagi|tengahari|petang|malam/,meridiemHour:function(D,w){return 12===D&&(D=0),"pagi"===w?D:"tengahari"===w?D>=11?D:D+12:"petang"===w||"malam"===w?D+12:void 0},meridiem:function(D,w,N){return D<11?"pagi":D<15?"tengahari":D<19?"petang":"malam"},calendar:{sameDay:"[Hari ini pukul] LT",nextDay:"[Esok pukul] LT",nextWeek:"dddd [pukul] LT",lastDay:"[Kelmarin pukul] LT",lastWeek:"dddd [lepas pukul] LT",sameElse:"L"},relativeTime:{future:"dalam %s",past:"%s yang lepas",s:"beberapa saat",ss:"%d saat",m:"seminit",mm:"%d minit",h:"sejam",hh:"%d jam",d:"sehari",dd:"%d hari",M:"sebulan",MM:"%d bulan",y:"setahun",yy:"%d tahun"},week:{dow:1,doy:7}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("mt",{months:"Jannar_Frar_Marzu_April_Mejju_unju_Lulju_Awwissu_Settembru_Ottubru_Novembru_Diembru".split("_"),monthsShort:"Jan_Fra_Mar_Apr_Mej_un_Lul_Aww_Set_Ott_Nov_Di".split("_"),weekdays:"Il-add_It-Tnejn_It-Tlieta_L-Erbga_Il-amis_Il-imga_Is-Sibt".split("_"),weekdaysShort:"ad_Tne_Tli_Erb_am_im_Sib".split("_"),weekdaysMin:"a_Tn_Tl_Er_a_i_Si".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Illum fil-]LT",nextDay:"[Gada fil-]LT",nextWeek:"dddd [fil-]LT",lastDay:"[Il-biera fil-]LT",lastWeek:"dddd [li gadda] [fil-]LT",sameElse:"L"},relativeTime:{future:"f %s",past:"%s ilu",s:"ftit sekondi",ss:"%d sekondi",m:"minuta",mm:"%d minuti",h:"siega",hh:"%d siegat",d:"urnata",dd:"%d ranet",M:"xahar",MM:"%d xhur",y:"sena",yy:"%d sni"},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:"%d",week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";var w={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},N={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};D.defineLocale("my",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[.] LT []",nextDay:"[] LT []",nextWeek:"dddd LT []",lastDay:"[.] LT []",lastWeek:"[] dddd LT []",sameElse:"L"},relativeTime:{future:" %s ",past:" %s ",s:".",ss:"%d ",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},preparse:function(D){return D.replace(/[]/g,(function(D){return N[D]}))},postformat:function(D){return D.replace(/\d/g,(function(D){return w[D]}))},week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("nb",{months:"januar_februar_mars_april_mai_juni_juli_august_september_oktober_november_desember".split("_"),monthsShort:"jan._feb._mars_april_mai_juni_juli_aug._sep._okt._nov._des.".split("_"),monthsParseExact:!0,weekdays:"sndag_mandag_tirsdag_onsdag_torsdag_fredag_lrdag".split("_"),weekdaysShort:"s._ma._ti._on._to._fr._l.".split("_"),weekdaysMin:"s_ma_ti_on_to_fr_l".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY [kl.] HH:mm",LLLL:"dddd D. MMMM YYYY [kl.] HH:mm"},calendar:{sameDay:"[i dag kl.] LT",nextDay:"[i morgen kl.] LT",nextWeek:"dddd [kl.] LT",lastDay:"[i gr kl.] LT",lastWeek:"[forrige] dddd [kl.] LT",sameElse:"L"},relativeTime:{future:"om %s",past:"%s siden",s:"noen sekunder",ss:"%d sekunder",m:"ett minutt",mm:"%d minutter",h:"en time",hh:"%d timer",d:"en dag",dd:"%d dager",M:"en mned",MM:"%d mneder",y:"ett r",yy:"%d r"},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";var w={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},N={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};D.defineLocale("ne",{months:"___________".split("_"),monthsShort:"._.__.___._._._._._.".split("_"),monthsParseExact:!0,weekdays:"______".split("_"),weekdaysShort:"._._._._._._.".split("_"),weekdaysMin:"._._._._._._.".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"A h:mm ",LTS:"A h:mm:ss ",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm ",LLLL:"dddd, D MMMM YYYY, A h:mm "},preparse:function(D){return D.replace(/[]/g,(function(D){return N[D]}))},postformat:function(D){return D.replace(/\d/g,(function(D){return w[D]}))},meridiemParse:/|||/,meridiemHour:function(D,w){return 12===D&&(D=0),""===w?D<4?D:D+12:""===w?D:""===w?D>=10?D:D+12:""===w?D+12:void 0},meridiem:function(D,w,N){return D<3?"":D<12?"":D<16?"":D<20?"":""},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"[] dddd[,] LT",lastDay:"[] LT",lastWeek:"[] dddd[,] LT",sameElse:"L"},relativeTime:{future:"%s",past:"%s ",s:" ",ss:"%d ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},week:{dow:0,doy:6}})}(N(0))},function(D,w,N){!function(D){"use strict";var w="jan._feb._mrt._apr._mei_jun._jul._aug._sep._okt._nov._dec.".split("_"),N="jan_feb_mrt_apr_mei_jun_jul_aug_sep_okt_nov_dec".split("_"),F=[/^jan/i,/^feb/i,/^maart|mrt.?$/i,/^apr/i,/^mei$/i,/^jun[i.]?$/i,/^jul[i.]?$/i,/^aug/i,/^sep/i,/^okt/i,/^nov/i,/^dec/i],k=/^(januari|februari|maart|april|mei|ju[nl]i|augustus|september|oktober|november|december|jan\.?|feb\.?|mrt\.?|apr\.?|ju[nl]\.?|aug\.?|sep\.?|okt\.?|nov\.?|dec\.?)/i;D.defineLocale("nl",{months:"januari_februari_maart_april_mei_juni_juli_augustus_september_oktober_november_december".split("_"),monthsShort:function(D,F){return D?/-MMM-/.test(F)?N[D.month()]:w[D.month()]:w},monthsRegex:k,monthsShortRegex:k,monthsStrictRegex:/^(januari|februari|maart|april|mei|ju[nl]i|augustus|september|oktober|november|december)/i,monthsShortStrictRegex:/^(jan\.?|feb\.?|mrt\.?|apr\.?|mei|ju[nl]\.?|aug\.?|sep\.?|okt\.?|nov\.?|dec\.?)/i,monthsParse:F,longMonthsParse:F,shortMonthsParse:F,weekdays:"zondag_maandag_dinsdag_woensdag_donderdag_vrijdag_zaterdag".split("_"),weekdaysShort:"zo._ma._di._wo._do._vr._za.".split("_"),weekdaysMin:"zo_ma_di_wo_do_vr_za".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD-MM-YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[vandaag om] LT",nextDay:"[morgen om] LT",nextWeek:"dddd [om] LT",lastDay:"[gisteren om] LT",lastWeek:"[afgelopen] dddd [om] LT",sameElse:"L"},relativeTime:{future:"over %s",past:"%s geleden",s:"een paar seconden",ss:"%d seconden",m:"n minuut",mm:"%d minuten",h:"n uur",hh:"%d uur",d:"n dag",dd:"%d dagen",M:"n maand",MM:"%d maanden",y:"n jaar",yy:"%d jaar"},dayOfMonthOrdinalParse:/\d{1,2}(ste|de)/,ordinal:function(D){return D+(1===D||8===D||D>=20?"ste":"de")},week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";var w="jan._feb._mrt._apr._mei_jun._jul._aug._sep._okt._nov._dec.".split("_"),N="jan_feb_mrt_apr_mei_jun_jul_aug_sep_okt_nov_dec".split("_"),F=[/^jan/i,/^feb/i,/^maart|mrt.?$/i,/^apr/i,/^mei$/i,/^jun[i.]?$/i,/^jul[i.]?$/i,/^aug/i,/^sep/i,/^okt/i,/^nov/i,/^dec/i],k=/^(januari|februari|maart|april|mei|ju[nl]i|augustus|september|oktober|november|december|jan\.?|feb\.?|mrt\.?|apr\.?|ju[nl]\.?|aug\.?|sep\.?|okt\.?|nov\.?|dec\.?)/i;D.defineLocale("nl-be",{months:"januari_februari_maart_april_mei_juni_juli_augustus_september_oktober_november_december".split("_"),monthsShort:function(D,F){return D?/-MMM-/.test(F)?N[D.month()]:w[D.month()]:w},monthsRegex:k,monthsShortRegex:k,monthsStrictRegex:/^(januari|februari|maart|april|mei|ju[nl]i|augustus|september|oktober|november|december)/i,monthsShortStrictRegex:/^(jan\.?|feb\.?|mrt\.?|apr\.?|mei|ju[nl]\.?|aug\.?|sep\.?|okt\.?|nov\.?|dec\.?)/i,monthsParse:F,longMonthsParse:F,shortMonthsParse:F,weekdays:"zondag_maandag_dinsdag_woensdag_donderdag_vrijdag_zaterdag".split("_"),weekdaysShort:"zo._ma._di._wo._do._vr._za.".split("_"),weekdaysMin:"zo_ma_di_wo_do_vr_za".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[vandaag om] LT",nextDay:"[morgen om] LT",nextWeek:"dddd [om] LT",lastDay:"[gisteren om] LT",lastWeek:"[afgelopen] dddd [om] LT",sameElse:"L"},relativeTime:{future:"over %s",past:"%s geleden",s:"een paar seconden",ss:"%d seconden",m:"n minuut",mm:"%d minuten",h:"n uur",hh:"%d uur",d:"n dag",dd:"%d dagen",M:"n maand",MM:"%d maanden",y:"n jaar",yy:"%d jaar"},dayOfMonthOrdinalParse:/\d{1,2}(ste|de)/,ordinal:function(D){return D+(1===D||8===D||D>=20?"ste":"de")},week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("nn",{months:"januar_februar_mars_april_mai_juni_juli_august_september_oktober_november_desember".split("_"),monthsShort:"jan_feb_mar_apr_mai_jun_jul_aug_sep_okt_nov_des".split("_"),weekdays:"sundag_mndag_tysdag_onsdag_torsdag_fredag_laurdag".split("_"),weekdaysShort:"sun_mn_tys_ons_tor_fre_lau".split("_"),weekdaysMin:"su_m_ty_on_to_fr_l".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY [kl.] H:mm",LLLL:"dddd D. MMMM YYYY [kl.] HH:mm"},calendar:{sameDay:"[I dag klokka] LT",nextDay:"[I morgon klokka] LT",nextWeek:"dddd [klokka] LT",lastDay:"[I gr klokka] LT",lastWeek:"[Fregande] dddd [klokka] LT",sameElse:"L"},relativeTime:{future:"om %s",past:"%s sidan",s:"nokre sekund",ss:"%d sekund",m:"eit minutt",mm:"%d minutt",h:"ein time",hh:"%d timar",d:"ein dag",dd:"%d dagar",M:"ein mnad",MM:"%d mnader",y:"eit r",yy:"%d r"},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";var w={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},N={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};D.defineLocale("pa-in",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"A h:mm ",LTS:"A h:mm:ss ",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm ",LLLL:"dddd, D MMMM YYYY, A h:mm "},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"[] dddd, LT",lastDay:"[] LT",lastWeek:"[] dddd, LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:" ",ss:"%d ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},preparse:function(D){return D.replace(/[]/g,(function(D){return N[D]}))},postformat:function(D){return D.replace(/\d/g,(function(D){return w[D]}))},meridiemParse:/|||/,meridiemHour:function(D,w){return 12===D&&(D=0),""===w?D<4?D:D+12:""===w?D:""===w?D>=10?D:D+12:""===w?D+12:void 0},meridiem:function(D,w,N){return D<4?"":D<10?"":D<17?"":D<20?"":""},week:{dow:0,doy:6}})}(N(0))},function(D,w,N){!function(D){"use strict";var w="stycze_luty_marzec_kwiecie_maj_czerwiec_lipiec_sierpie_wrzesie_padziernik_listopad_grudzie".split("_"),N="stycznia_lutego_marca_kwietnia_maja_czerwca_lipca_sierpnia_wrzenia_padziernika_listopada_grudnia".split("_");function plural(D){return D%10<5&&D%10>1&&~~(D/10)%10!=1}function translate(D,w,N){var F=D+" ";switch(N){case"ss":return F+(plural(D)?"sekundy":"sekund");case"m":return w?"minuta":"minut";case"mm":return F+(plural(D)?"minuty":"minut");case"h":return w?"godzina":"godzin";case"hh":return F+(plural(D)?"godziny":"godzin");case"MM":return F+(plural(D)?"miesice":"miesicy");case"yy":return F+(plural(D)?"lata":"lat")}}D.defineLocale("pl",{months:function(D,F){return D?""===F?"("+N[D.month()]+"|"+w[D.month()]+")":/D MMMM/.test(F)?N[D.month()]:w[D.month()]:w},monthsShort:"sty_lut_mar_kwi_maj_cze_lip_sie_wrz_pa_lis_gru".split("_"),weekdays:"niedziela_poniedziaek_wtorek_roda_czwartek_pitek_sobota".split("_"),weekdaysShort:"ndz_pon_wt_r_czw_pt_sob".split("_"),weekdaysMin:"Nd_Pn_Wt_r_Cz_Pt_So".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Dzi o] LT",nextDay:"[Jutro o] LT",nextWeek:function(){switch(this.day()){case 0:return"[W niedziel o] LT";case 2:return"[We wtorek o] LT";case 3:return"[W rod o] LT";case 6:return"[W sobot o] LT";default:return"[W] dddd [o] LT"}},lastDay:"[Wczoraj o] LT",lastWeek:function(){switch(this.day()){case 0:return"[W zesz niedziel o] LT";case 3:return"[W zesz rod o] LT";case 6:return"[W zesz sobot o] LT";default:return"[W zeszy] dddd [o] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"%s temu",s:"kilka sekund",ss:translate,m:translate,mm:translate,h:translate,hh:translate,d:"1 dzie",dd:"%d dni",M:"miesic",MM:translate,y:"rok",yy:translate},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("pt",{months:"Janeiro_Fevereiro_Maro_Abril_Maio_Junho_Julho_Agosto_Setembro_Outubro_Novembro_Dezembro".split("_"),monthsShort:"Jan_Fev_Mar_Abr_Mai_Jun_Jul_Ago_Set_Out_Nov_Dez".split("_"),weekdays:"Domingo_Segunda-feira_Tera-feira_Quarta-feira_Quinta-feira_Sexta-feira_Sbado".split("_"),weekdaysShort:"Dom_Seg_Ter_Qua_Qui_Sex_Sb".split("_"),weekdaysMin:"Do_2_3_4_5_6_S".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY HH:mm",LLLL:"dddd, D [de] MMMM [de] YYYY HH:mm"},calendar:{sameDay:"[Hoje s] LT",nextDay:"[Amanh s] LT",nextWeek:"dddd [s] LT",lastDay:"[Ontem s] LT",lastWeek:function(){return 0===this.day()||6===this.day()?"[ltimo] dddd [s] LT":"[ltima] dddd [s] LT"},sameElse:"L"},relativeTime:{future:"em %s",past:"h %s",s:"segundos",ss:"%d segundos",m:"um minuto",mm:"%d minutos",h:"uma hora",hh:"%d horas",d:"um dia",dd:"%d dias",M:"um ms",MM:"%d meses",y:"um ano",yy:"%d anos"},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:"%d",week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("pt-br",{months:"Janeiro_Fevereiro_Maro_Abril_Maio_Junho_Julho_Agosto_Setembro_Outubro_Novembro_Dezembro".split("_"),monthsShort:"Jan_Fev_Mar_Abr_Mai_Jun_Jul_Ago_Set_Out_Nov_Dez".split("_"),weekdays:"Domingo_Segunda-feira_Tera-feira_Quarta-feira_Quinta-feira_Sexta-feira_Sbado".split("_"),weekdaysShort:"Dom_Seg_Ter_Qua_Qui_Sex_Sb".split("_"),weekdaysMin:"Do_2_3_4_5_6_S".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY [s] HH:mm",LLLL:"dddd, D [de] MMMM [de] YYYY [s] HH:mm"},calendar:{sameDay:"[Hoje s] LT",nextDay:"[Amanh s] LT",nextWeek:"dddd [s] LT",lastDay:"[Ontem s] LT",lastWeek:function(){return 0===this.day()||6===this.day()?"[ltimo] dddd [s] LT":"[ltima] dddd [s] LT"},sameElse:"L"},relativeTime:{future:"em %s",past:"h %s",s:"poucos segundos",ss:"%d segundos",m:"um minuto",mm:"%d minutos",h:"uma hora",hh:"%d horas",d:"um dia",dd:"%d dias",M:"um ms",MM:"%d meses",y:"um ano",yy:"%d anos"},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:"%d"})}(N(0))},function(D,w,N){!function(D){"use strict";function relativeTimeWithPlural(D,w,N){var F=" ";return(D%100>=20||D>=100&&D%100==0)&&(F=" de "),D+F+{ss:"secunde",mm:"minute",hh:"ore",dd:"zile",MM:"luni",yy:"ani"}[N]}D.defineLocale("ro",{months:"ianuarie_februarie_martie_aprilie_mai_iunie_iulie_august_septembrie_octombrie_noiembrie_decembrie".split("_"),monthsShort:"ian._febr._mart._apr._mai_iun._iul._aug._sept._oct._nov._dec.".split("_"),monthsParseExact:!0,weekdays:"duminic_luni_mari_miercuri_joi_vineri_smbt".split("_"),weekdaysShort:"Dum_Lun_Mar_Mie_Joi_Vin_Sm".split("_"),weekdaysMin:"Du_Lu_Ma_Mi_Jo_Vi_S".split("_"),longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY H:mm",LLLL:"dddd, D MMMM YYYY H:mm"},calendar:{sameDay:"[azi la] LT",nextDay:"[mine la] LT",nextWeek:"dddd [la] LT",lastDay:"[ieri la] LT",lastWeek:"[fosta] dddd [la] LT",sameElse:"L"},relativeTime:{future:"peste %s",past:"%s n urm",s:"cteva secunde",ss:relativeTimeWithPlural,m:"un minut",mm:relativeTimeWithPlural,h:"o or",hh:relativeTimeWithPlural,d:"o zi",dd:relativeTimeWithPlural,M:"o lun",MM:relativeTimeWithPlural,y:"un an",yy:relativeTimeWithPlural},week:{dow:1,doy:7}})}(N(0))},function(D,w,N){!function(D){"use strict";function relativeTimeWithPlural(D,w,N){return"m"===N?w?"":"":D+" "+function plural(D,w){var N=D.split("_");return w%10==1&&w%100!=11?N[0]:w%10>=2&&w%10<=4&&(w%100<10||w%100>=20)?N[1]:N[2]}({ss:w?"__":"__",mm:w?"__":"__",hh:"__",dd:"__",MM:"__",yy:"__"}[N],+D)}var w=[/^/i,/^/i,/^/i,/^/i,/^[]/i,/^/i,/^/i,/^/i,/^/i,/^/i,/^/i,/^/i];D.defineLocale("ru",{months:{format:"___________".split("_"),standalone:"___________".split("_")},monthsShort:{format:"._._._.____._._._._.".split("_"),standalone:"._.__.____._._._._.".split("_")},weekdays:{standalone:"______".split("_"),format:"______".split("_"),isFormat:/\[ ?[] ?(?:||)? ?\] ?dddd/},weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),monthsParse:w,longMonthsParse:w,shortMonthsParse:w,monthsRegex:/^([]|\.?|[]|?\.?|?|\.?|[]|\.?|[]|[]|\.?|[]|\.?|?|\.?|[]|?\.?|[]|\.?|[]|?\.?|[]|\.?)/i,monthsShortRegex:/^([]|\.?|[]|?\.?|?|\.?|[]|\.?|[]|[]|\.?|[]|\.?|?|\.?|[]|?\.?|[]|\.?|[]|?\.?|[]|\.?)/i,monthsStrictRegex:/^([]|[]|?|[]|[]|[]|[]|?|[]|[]|[]|[])/i,monthsShortStrictRegex:/^(\.|?\.|[.]|\.|[]|[.]|[.]|\.|?\.|\.|?\.|\.)/i,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY .",LLL:"D MMMM YYYY ., H:mm",LLLL:"dddd, D MMMM YYYY ., H:mm"},calendar:{sameDay:"[, ] LT",nextDay:"[, ] LT",lastDay:"[, ] LT",nextWeek:function(D){if(D.week()===this.week())return 2===this.day()?"[] dddd, [] LT":"[] dddd, [] LT";switch(this.day()){case 0:return"[ ] dddd, [] LT";case 1:case 2:case 4:return"[ ] dddd, [] LT";case 3:case 5:case 6:return"[ ] dddd, [] LT"}},lastWeek:function(D){if(D.week()===this.week())return 2===this.day()?"[] dddd, [] LT":"[] dddd, [] LT";switch(this.day()){case 0:return"[ ] dddd, [] LT";case 1:case 2:case 4:return"[ ] dddd, [] LT";case 3:case 5:case 6:return"[ ] dddd, [] LT"}},sameElse:"L"},relativeTime:{future:" %s",past:"%s ",s:" ",ss:relativeTimeWithPlural,m:relativeTimeWithPlural,mm:relativeTimeWithPlural,h:"",hh:relativeTimeWithPlural,d:"",dd:relativeTimeWithPlural,M:"",MM:relativeTimeWithPlural,y:"",yy:relativeTimeWithPlural},meridiemParse:/|||/i,isPM:function(D){return/^(|)$/.test(D)},meridiem:function(D,w,N){return D<4?"":D<12?"":D<17?"":""},dayOfMonthOrdinalParse:/\d{1,2}-(||)/,ordinal:function(D,w){switch(w){case"M":case"d":case"DDD":return D+"-";case"D":return D+"-";case"w":case"W":return D+"-";default:return D}},week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";var w=["","","","","","","","","","","",""],N=["","","","","","",""];D.defineLocale("sd",{months:w,monthsShort:w,weekdays:N,weekdaysShort:N,weekdaysMin:N,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},meridiemParse:/|/,isPM:function(D){return""===D},meridiem:function(D,w,N){return D<12?"":""},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"dddd [  ] LT",lastDay:"[] LT",lastWeek:"[ ] dddd [] LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:" ",ss:"%d ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},preparse:function(D){return D.replace(//g,",")},postformat:function(D){return D.replace(/,/g,"")},week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("se",{months:"oajagemnnu_guovvamnnu_njukamnnu_cuoomnnu_miessemnnu_geassemnnu_suoidnemnnu_borgemnnu_akamnnu_golggotmnnu_skbmamnnu_juovlamnnu".split("_"),monthsShort:"oj_guov_njuk_cuo_mies_geas_suoi_borg_ak_golg_skb_juov".split("_"),weekdays:"sotnabeaivi_vuossrga_maebrga_gaskavahkku_duorastat_bearjadat_lvvardat".split("_"),weekdaysShort:"sotn_vuos_ma_gask_duor_bear_lv".split("_"),weekdaysMin:"s_v_m_g_d_b_L".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"MMMM D. [b.] YYYY",LLL:"MMMM D. [b.] YYYY [ti.] HH:mm",LLLL:"dddd, MMMM D. [b.] YYYY [ti.] HH:mm"},calendar:{sameDay:"[otne ti] LT",nextDay:"[ihttin ti] LT",nextWeek:"dddd [ti] LT",lastDay:"[ikte ti] LT",lastWeek:"[ovddit] dddd [ti] LT",sameElse:"L"},relativeTime:{future:"%s geaes",past:"mait %s",s:"moadde sekunddat",ss:"%d sekunddat",m:"okta minuhta",mm:"%d minuhtat",h:"okta diimmu",hh:"%d diimmut",d:"okta beaivi",dd:"%d beaivvit",M:"okta mnnu",MM:"%d mnut",y:"okta jahki",yy:"%d jagit"},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("si",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"a h:mm",LTS:"a h:mm:ss",L:"YYYY/MM/DD",LL:"YYYY MMMM D",LLL:"YYYY MMMM D, a h:mm",LLLL:"YYYY MMMM D [] dddd, a h:mm:ss"},calendar:{sameDay:"[] LT[]",nextDay:"[] LT[]",nextWeek:"dddd LT[]",lastDay:"[] LT[]",lastWeek:"[] dddd LT[]",sameElse:"L"},relativeTime:{future:"%s",past:"%s ",s:" ",ss:" %d",m:"",mm:" %d",h:"",hh:" %d",d:"",dd:" %d",M:"",MM:" %d",y:"",yy:" %d"},dayOfMonthOrdinalParse:/\d{1,2} /,ordinal:function(D){return D+" "},meridiemParse:/ | |.|../,isPM:function(D){return".."===D||" "===D},meridiem:function(D,w,N){return D>11?N?"..":" ":N?"..":" "}})}(N(0))},function(D,w,N){!function(D){"use strict";var w="janur_februr_marec_aprl_mj_jn_jl_august_september_oktber_november_december".split("_"),N="jan_feb_mar_apr_mj_jn_jl_aug_sep_okt_nov_dec".split("_");function plural(D){return D>1&&D<5}function translate(D,w,N,F){var k=D+" ";switch(N){case"s":return w||F?"pr seknd":"pr sekundami";case"ss":return w||F?k+(plural(D)?"sekundy":"seknd"):k+"sekundami";case"m":return w?"minta":F?"mintu":"mintou";case"mm":return w||F?k+(plural(D)?"minty":"mint"):k+"mintami";case"h":return w?"hodina":F?"hodinu":"hodinou";case"hh":return w||F?k+(plural(D)?"hodiny":"hodn"):k+"hodinami";case"d":return w||F?"de":"dom";case"dd":return w||F?k+(plural(D)?"dni":"dn"):k+"dami";case"M":return w||F?"mesiac":"mesiacom";case"MM":return w||F?k+(plural(D)?"mesiace":"mesiacov"):k+"mesiacmi";case"y":return w||F?"rok":"rokom";case"yy":return w||F?k+(plural(D)?"roky":"rokov"):k+"rokmi"}}D.defineLocale("sk",{months:w,monthsShort:N,weekdays:"nedea_pondelok_utorok_streda_tvrtok_piatok_sobota".split("_"),weekdaysShort:"ne_po_ut_st_t_pi_so".split("_"),weekdaysMin:"ne_po_ut_st_t_pi_so".split("_"),longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY H:mm",LLLL:"dddd D. MMMM YYYY H:mm"},calendar:{sameDay:"[dnes o] LT",nextDay:"[zajtra o] LT",nextWeek:function(){switch(this.day()){case 0:return"[v nedeu o] LT";case 1:case 2:return"[v] dddd [o] LT";case 3:return"[v stredu o] LT";case 4:return"[vo tvrtok o] LT";case 5:return"[v piatok o] LT";case 6:return"[v sobotu o] LT"}},lastDay:"[vera o] LT",lastWeek:function(){switch(this.day()){case 0:return"[minul nedeu o] LT";case 1:case 2:return"[minul] dddd [o] LT";case 3:return"[minul stredu o] LT";case 4:case 5:return"[minul] dddd [o] LT";case 6:return"[minul sobotu o] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"pred %s",s:translate,ss:translate,m:translate,mm:translate,h:translate,hh:translate,d:translate,dd:translate,M:translate,MM:translate,y:translate,yy:translate},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";function processRelativeTime(D,w,N,F){var k=D+" ";switch(N){case"s":return w||F?"nekaj sekund":"nekaj sekundami";case"ss":return k+=1===D?w?"sekundo":"sekundi":2===D?w||F?"sekundi":"sekundah":D<5?w||F?"sekunde":"sekundah":"sekund";case"m":return w?"ena minuta":"eno minuto";case"mm":return k+=1===D?w?"minuta":"minuto":2===D?w||F?"minuti":"minutama":D<5?w||F?"minute":"minutami":w||F?"minut":"minutami";case"h":return w?"ena ura":"eno uro";case"hh":return k+=1===D?w?"ura":"uro":2===D?w||F?"uri":"urama":D<5?w||F?"ure":"urami":w||F?"ur":"urami";case"d":return w||F?"en dan":"enim dnem";case"dd":return k+=1===D?w||F?"dan":"dnem":2===D?w||F?"dni":"dnevoma":w||F?"dni":"dnevi";case"M":return w||F?"en mesec":"enim mesecem";case"MM":return k+=1===D?w||F?"mesec":"mesecem":2===D?w||F?"meseca":"mesecema":D<5?w||F?"mesece":"meseci":w||F?"mesecev":"meseci";case"y":return w||F?"eno leto":"enim letom";case"yy":return k+=1===D?w||F?"leto":"letom":2===D?w||F?"leti":"letoma":D<5?w||F?"leta":"leti":w||F?"let":"leti"}}D.defineLocale("sl",{months:"januar_februar_marec_april_maj_junij_julij_avgust_september_oktober_november_december".split("_"),monthsShort:"jan._feb._mar._apr._maj._jun._jul._avg._sep._okt._nov._dec.".split("_"),monthsParseExact:!0,weekdays:"nedelja_ponedeljek_torek_sreda_etrtek_petek_sobota".split("_"),weekdaysShort:"ned._pon._tor._sre._et._pet._sob.".split("_"),weekdaysMin:"ne_po_to_sr_e_pe_so".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY H:mm",LLLL:"dddd, D. MMMM YYYY H:mm"},calendar:{sameDay:"[danes ob] LT",nextDay:"[jutri ob] LT",nextWeek:function(){switch(this.day()){case 0:return"[v] [nedeljo] [ob] LT";case 3:return"[v] [sredo] [ob] LT";case 6:return"[v] [soboto] [ob] LT";case 1:case 2:case 4:case 5:return"[v] dddd [ob] LT"}},lastDay:"[veraj ob] LT",lastWeek:function(){switch(this.day()){case 0:return"[prejnjo] [nedeljo] [ob] LT";case 3:return"[prejnjo] [sredo] [ob] LT";case 6:return"[prejnjo] [soboto] [ob] LT";case 1:case 2:case 4:case 5:return"[prejnji] dddd [ob] LT"}},sameElse:"L"},relativeTime:{future:"ez %s",past:"pred %s",s:processRelativeTime,ss:processRelativeTime,m:processRelativeTime,mm:processRelativeTime,h:processRelativeTime,hh:processRelativeTime,d:processRelativeTime,dd:processRelativeTime,M:processRelativeTime,MM:processRelativeTime,y:processRelativeTime,yy:processRelativeTime},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("sq",{months:"Janar_Shkurt_Mars_Prill_Maj_Qershor_Korrik_Gusht_Shtator_Tetor_Nntor_Dhjetor".split("_"),monthsShort:"Jan_Shk_Mar_Pri_Maj_Qer_Kor_Gus_Sht_Tet_Nn_Dhj".split("_"),weekdays:"E Diel_E Hn_E Mart_E Mrkur_E Enjte_E Premte_E Shtun".split("_"),weekdaysShort:"Die_Hn_Mar_Mr_Enj_Pre_Sht".split("_"),weekdaysMin:"D_H_Ma_M_E_P_Sh".split("_"),weekdaysParseExact:!0,meridiemParse:/PD|MD/,isPM:function(D){return"M"===D.charAt(0)},meridiem:function(D,w,N){return D<12?"PD":"MD"},longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Sot n] LT",nextDay:"[Nesr n] LT",nextWeek:"dddd [n] LT",lastDay:"[Dje n] LT",lastWeek:"dddd [e kaluar n] LT",sameElse:"L"},relativeTime:{future:"n %s",past:"%s m par",s:"disa sekonda",ss:"%d sekonda",m:"nj minut",mm:"%d minuta",h:"nj or",hh:"%d or",d:"nj dit",dd:"%d dit",M:"nj muaj",MM:"%d muaj",y:"nj vit",yy:"%d vite"},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";var w={words:{ss:["sekunda","sekunde","sekundi"],m:["jedan minut","jedne minute"],mm:["minut","minute","minuta"],h:["jedan sat","jednog sata"],hh:["sat","sata","sati"],dd:["dan","dana","dana"],MM:["mesec","meseca","meseci"],yy:["godina","godine","godina"]},correctGrammaticalCase:function(D,w){return 1===D?w[0]:D>=2&&D<=4?w[1]:w[2]},translate:function(D,N,F){var k=w.words[F];return 1===F.length?N?k[0]:k[1]:D+" "+w.correctGrammaticalCase(D,k)}};D.defineLocale("sr",{months:"januar_februar_mart_april_maj_jun_jul_avgust_septembar_oktobar_novembar_decembar".split("_"),monthsShort:"jan._feb._mar._apr._maj_jun_jul_avg._sep._okt._nov._dec.".split("_"),monthsParseExact:!0,weekdays:"nedelja_ponedeljak_utorak_sreda_etvrtak_petak_subota".split("_"),weekdaysShort:"ned._pon._uto._sre._et._pet._sub.".split("_"),weekdaysMin:"ne_po_ut_sr_e_pe_su".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY H:mm",LLLL:"dddd, D. MMMM YYYY H:mm"},calendar:{sameDay:"[danas u] LT",nextDay:"[sutra u] LT",nextWeek:function(){switch(this.day()){case 0:return"[u] [nedelju] [u] LT";case 3:return"[u] [sredu] [u] LT";case 6:return"[u] [subotu] [u] LT";case 1:case 2:case 4:case 5:return"[u] dddd [u] LT"}},lastDay:"[jue u] LT",lastWeek:function(){return["[prole] [nedelje] [u] LT","[prolog] [ponedeljka] [u] LT","[prolog] [utorka] [u] LT","[prole] [srede] [u] LT","[prolog] [etvrtka] [u] LT","[prolog] [petka] [u] LT","[prole] [subote] [u] LT"][this.day()]},sameElse:"L"},relativeTime:{future:"za %s",past:"pre %s",s:"nekoliko sekundi",ss:w.translate,m:w.translate,mm:w.translate,h:w.translate,hh:w.translate,d:"dan",dd:w.translate,M:"mesec",MM:w.translate,y:"godinu",yy:w.translate},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}})}(N(0))},function(D,w,N){!function(D){"use strict";var w={words:{ss:["","",""],m:[" "," "],mm:["","",""],h:[" "," "],hh:["","",""],dd:["","",""],MM:["","",""],yy:["","",""]},correctGrammaticalCase:function(D,w){return 1===D?w[0]:D>=2&&D<=4?w[1]:w[2]},translate:function(D,N,F){var k=w.words[F];return 1===F.length?N?k[0]:k[1]:D+" "+w.correctGrammaticalCase(D,k)}};D.defineLocale("sr-cyrl",{months:"___________".split("_"),monthsShort:"._._._.____._._._._.".split("_"),monthsParseExact:!0,weekdays:"______".split("_"),weekdaysShort:"._._._._._._.".split("_"),weekdaysMin:"______".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY H:mm",LLLL:"dddd, D. MMMM YYYY H:mm"},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:function(){switch(this.day()){case 0:return"[] [] [] LT";case 3:return"[] [] [] LT";case 6:return"[] [] [] LT";case 1:case 2:case 4:case 5:return"[] dddd [] LT"}},lastDay:"[ ] LT",lastWeek:function(){return["[] [] [] LT","[] [] [] LT","[] [] [] LT","[] [] [] LT","[] [] [] LT","[] [] [] LT","[] [] [] LT"][this.day()]},sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:" ",ss:w.translate,m:w.translate,mm:w.translate,h:w.translate,hh:w.translate,d:"",dd:w.translate,M:"",MM:w.translate,y:"",yy:w.translate},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("ss",{months:"Bhimbidvwane_Indlovana_Indlov'lenkhulu_Mabasa_Inkhwekhweti_Inhlaba_Kholwane_Ingci_Inyoni_Imphala_Lweti_Ingongoni".split("_"),monthsShort:"Bhi_Ina_Inu_Mab_Ink_Inh_Kho_Igc_Iny_Imp_Lwe_Igo".split("_"),weekdays:"Lisontfo_Umsombuluko_Lesibili_Lesitsatfu_Lesine_Lesihlanu_Umgcibelo".split("_"),weekdaysShort:"Lis_Umb_Lsb_Les_Lsi_Lsh_Umg".split("_"),weekdaysMin:"Li_Us_Lb_Lt_Ls_Lh_Ug".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY h:mm A",LLLL:"dddd, D MMMM YYYY h:mm A"},calendar:{sameDay:"[Namuhla nga] LT",nextDay:"[Kusasa nga] LT",nextWeek:"dddd [nga] LT",lastDay:"[Itolo nga] LT",lastWeek:"dddd [leliphelile] [nga] LT",sameElse:"L"},relativeTime:{future:"nga %s",past:"wenteka nga %s",s:"emizuzwana lomcane",ss:"%d mzuzwana",m:"umzuzu",mm:"%d emizuzu",h:"lihora",hh:"%d emahora",d:"lilanga",dd:"%d emalanga",M:"inyanga",MM:"%d tinyanga",y:"umnyaka",yy:"%d iminyaka"},meridiemParse:/ekuseni|emini|entsambama|ebusuku/,meridiem:function(D,w,N){return D<11?"ekuseni":D<15?"emini":D<19?"entsambama":"ebusuku"},meridiemHour:function(D,w){return 12===D&&(D=0),"ekuseni"===w?D:"emini"===w?D>=11?D:D+12:"entsambama"===w||"ebusuku"===w?0===D?0:D+12:void 0},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:"%d",week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("sv",{months:"januari_februari_mars_april_maj_juni_juli_augusti_september_oktober_november_december".split("_"),monthsShort:"jan_feb_mar_apr_maj_jun_jul_aug_sep_okt_nov_dec".split("_"),weekdays:"sndag_mndag_tisdag_onsdag_torsdag_fredag_lrdag".split("_"),weekdaysShort:"sn_mn_tis_ons_tor_fre_lr".split("_"),weekdaysMin:"s_m_ti_on_to_fr_l".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY-MM-DD",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [kl.] HH:mm",LLLL:"dddd D MMMM YYYY [kl.] HH:mm",lll:"D MMM YYYY HH:mm",llll:"ddd D MMM YYYY HH:mm"},calendar:{sameDay:"[Idag] LT",nextDay:"[Imorgon] LT",lastDay:"[Igr] LT",nextWeek:"[P] dddd LT",lastWeek:"[I] dddd[s] LT",sameElse:"L"},relativeTime:{future:"om %s",past:"fr %s sedan",s:"ngra sekunder",ss:"%d sekunder",m:"en minut",mm:"%d minuter",h:"en timme",hh:"%d timmar",d:"en dag",dd:"%d dagar",M:"en mnad",MM:"%d mnader",y:"ett r",yy:"%d r"},dayOfMonthOrdinalParse:/\d{1,2}(e|a)/,ordinal:function(D){var w=D%10;return D+(1==~~(D%100/10)?"e":1===w||2===w?"a":"e")},week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("sw",{months:"Januari_Februari_Machi_Aprili_Mei_Juni_Julai_Agosti_Septemba_Oktoba_Novemba_Desemba".split("_"),monthsShort:"Jan_Feb_Mac_Apr_Mei_Jun_Jul_Ago_Sep_Okt_Nov_Des".split("_"),weekdays:"Jumapili_Jumatatu_Jumanne_Jumatano_Alhamisi_Ijumaa_Jumamosi".split("_"),weekdaysShort:"Jpl_Jtat_Jnne_Jtan_Alh_Ijm_Jmos".split("_"),weekdaysMin:"J2_J3_J4_J5_Al_Ij_J1".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[leo saa] LT",nextDay:"[kesho saa] LT",nextWeek:"[wiki ijayo] dddd [saat] LT",lastDay:"[jana] LT",lastWeek:"[wiki iliyopita] dddd [saat] LT",sameElse:"L"},relativeTime:{future:"%s baadaye",past:"tokea %s",s:"hivi punde",ss:"sekunde %d",m:"dakika moja",mm:"dakika %d",h:"saa limoja",hh:"masaa %d",d:"siku moja",dd:"masiku %d",M:"mwezi mmoja",MM:"miezi %d",y:"mwaka mmoja",yy:"miaka %d"},week:{dow:1,doy:7}})}(N(0))},function(D,w,N){!function(D){"use strict";var w={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},N={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};D.defineLocale("ta",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, HH:mm",LLLL:"dddd, D MMMM YYYY, HH:mm"},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"dddd, LT",lastDay:"[] LT",lastWeek:"[ ] dddd, LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:"  ",ss:"%d ",m:" ",mm:"%d ",h:"  ",hh:"%d  ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:function(D){return D+""},preparse:function(D){return D.replace(/[]/g,(function(D){return N[D]}))},postformat:function(D){return D.replace(/\d/g,(function(D){return w[D]}))},meridiemParse:/|||||/,meridiem:function(D,w,N){return D<2?" ":D<6?" ":D<10?" ":D<14?" ":D<18?" ":D<22?" ":" "},meridiemHour:function(D,w){return 12===D&&(D=0),""===w?D<2?D:D+12:""===w||""===w||""===w&&D>=10?D:D+12},week:{dow:0,doy:6}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("te",{months:"___________".split("_"),monthsShort:"._.__.____._._._._.".split("_"),monthsParseExact:!0,weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"A h:mm",LTS:"A h:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm",LLLL:"dddd, D MMMM YYYY, A h:mm"},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"dddd, LT",lastDay:"[] LT",lastWeek:"[] dddd, LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:" ",ss:"%d ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:"%d",meridiemParse:/|||/,meridiemHour:function(D,w){return 12===D&&(D=0),""===w?D<4?D:D+12:""===w?D:""===w?D>=10?D:D+12:""===w?D+12:void 0},meridiem:function(D,w,N){return D<4?"":D<10?"":D<17?"":D<20?"":""},week:{dow:0,doy:6}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("tet",{months:"Janeiru_Fevereiru_Marsu_Abril_Maiu_Juu_Jullu_Agustu_Setembru_Outubru_Novembru_Dezembru".split("_"),monthsShort:"Jan_Fev_Mar_Abr_Mai_Jun_Jul_Ago_Set_Out_Nov_Dez".split("_"),weekdays:"Domingu_Segunda_Tersa_Kuarta_Kinta_Sesta_Sabadu".split("_"),weekdaysShort:"Dom_Seg_Ters_Kua_Kint_Sest_Sab".split("_"),weekdaysMin:"Do_Seg_Te_Ku_Ki_Ses_Sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Ohin iha] LT",nextDay:"[Aban iha] LT",nextWeek:"dddd [iha] LT",lastDay:"[Horiseik iha] LT",lastWeek:"dddd [semana kotuk] [iha] LT",sameElse:"L"},relativeTime:{future:"iha %s",past:"%s liuba",s:"minutu balun",ss:"minutu %d",m:"minutu ida",mm:"minutu %d",h:"oras ida",hh:"oras %d",d:"loron ida",dd:"loron %d",M:"fulan ida",MM:"fulan %d",y:"tinan ida",yy:"tinan %d"},dayOfMonthOrdinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(D){var w=D%10;return D+(1==~~(D%100/10)?"th":1===w?"st":2===w?"nd":3===w?"rd":"th")},week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";var w={0:"-",1:"-",2:"-",3:"-",4:"-",5:"-",6:"-",7:"-",8:"-",9:"-",10:"-",12:"-",13:"-",20:"-",30:"-",40:"-",50:"-",60:"-",70:"-",80:"-",90:"-",100:"-"};D.defineLocale("tg",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",lastDay:"[ ] LT",nextWeek:"dddd[] [  ] LT",lastWeek:"dddd[] [  ] LT",sameElse:"L"},relativeTime:{future:" %s",past:"%s ",s:" ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},meridiemParse:/|||/,meridiemHour:function(D,w){return 12===D&&(D=0),""===w?D<4?D:D+12:""===w?D:""===w?D>=11?D:D+12:""===w?D+12:void 0},meridiem:function(D,w,N){return D<4?"":D<11?"":D<16?"":D<19?"":""},dayOfMonthOrdinalParse:/\d{1,2}-(|)/,ordinal:function(D){return D+(w[D]||w[D%10]||w[D>=100?100:null])},week:{dow:1,doy:7}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("th",{months:"___________".split("_"),monthsShort:".._.._.._.._.._.._.._.._.._.._.._..".split("_"),monthsParseExact:!0,weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"._._._._._._.".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY  H:mm",LLLL:"dddd D MMMM YYYY  H:mm"},meridiemParse:/|/,isPM:function(D){return""===D},meridiem:function(D,w,N){return D<12?"":""},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"dddd[ ] LT",lastDay:"[ ] LT",lastWeek:"[]dddd[ ] LT",sameElse:"L"},relativeTime:{future:" %s",past:"%s",s:"",ss:"%d ",m:"1 ",mm:"%d ",h:"1 ",hh:"%d ",d:"1 ",dd:"%d ",M:"1 ",MM:"%d ",y:"1 ",yy:"%d "}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("tl-ph",{months:"Enero_Pebrero_Marso_Abril_Mayo_Hunyo_Hulyo_Agosto_Setyembre_Oktubre_Nobyembre_Disyembre".split("_"),monthsShort:"Ene_Peb_Mar_Abr_May_Hun_Hul_Ago_Set_Okt_Nob_Dis".split("_"),weekdays:"Linggo_Lunes_Martes_Miyerkules_Huwebes_Biyernes_Sabado".split("_"),weekdaysShort:"Lin_Lun_Mar_Miy_Huw_Biy_Sab".split("_"),weekdaysMin:"Li_Lu_Ma_Mi_Hu_Bi_Sab".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"MM/D/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY HH:mm",LLLL:"dddd, MMMM DD, YYYY HH:mm"},calendar:{sameDay:"LT [ngayong araw]",nextDay:"[Bukas ng] LT",nextWeek:"LT [sa susunod na] dddd",lastDay:"LT [kahapon]",lastWeek:"LT [noong nakaraang] dddd",sameElse:"L"},relativeTime:{future:"sa loob ng %s",past:"%s ang nakalipas",s:"ilang segundo",ss:"%d segundo",m:"isang minuto",mm:"%d minuto",h:"isang oras",hh:"%d oras",d:"isang araw",dd:"%d araw",M:"isang buwan",MM:"%d buwan",y:"isang taon",yy:"%d taon"},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:function(D){return D},week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";var w="pagh_wa_cha_wej_loS_vagh_jav_Soch_chorgh_Hut".split("_");function translate(D,N,F,k){var j=function numberAsNoun(D){var N=Math.floor(D%1e3/100),F=Math.floor(D%100/10),k=D%10,j="";return N>0&&(j+=w[N]+"vatlh"),F>0&&(j+=(""!==j?" ":"")+w[F]+"maH"),k>0&&(j+=(""!==j?" ":"")+w[k]),""===j?"pagh":j}(D);switch(F){case"ss":return j+" lup";case"mm":return j+" tup";case"hh":return j+" rep";case"dd":return j+" jaj";case"MM":return j+" jar";case"yy":return j+" DIS"}}D.defineLocale("tlh",{months:"tera jar wa_tera jar cha_tera jar wej_tera jar loS_tera jar vagh_tera jar jav_tera jar Soch_tera jar chorgh_tera jar Hut_tera jar wamaH_tera jar wamaH wa_tera jar wamaH cha".split("_"),monthsShort:"jar wa_jar cha_jar wej_jar loS_jar vagh_jar jav_jar Soch_jar chorgh_jar Hut_jar wamaH_jar wamaH wa_jar wamaH cha".split("_"),monthsParseExact:!0,weekdays:"lojmItjaj_DaSjaj_povjaj_ghItlhjaj_loghjaj_buqjaj_ghInjaj".split("_"),weekdaysShort:"lojmItjaj_DaSjaj_povjaj_ghItlhjaj_loghjaj_buqjaj_ghInjaj".split("_"),weekdaysMin:"lojmItjaj_DaSjaj_povjaj_ghItlhjaj_loghjaj_buqjaj_ghInjaj".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[DaHjaj] LT",nextDay:"[waleS] LT",nextWeek:"LLL",lastDay:"[waHu] LT",lastWeek:"LLL",sameElse:"L"},relativeTime:{future:function translateFuture(D){var w=D;return w=-1!==D.indexOf("jaj")?w.slice(0,-3)+"leS":-1!==D.indexOf("jar")?w.slice(0,-3)+"waQ":-1!==D.indexOf("DIS")?w.slice(0,-3)+"nem":w+" pIq"},past:function translatePast(D){var w=D;return w=-1!==D.indexOf("jaj")?w.slice(0,-3)+"Hu":-1!==D.indexOf("jar")?w.slice(0,-3)+"wen":-1!==D.indexOf("DIS")?w.slice(0,-3)+"ben":w+" ret"},s:"puS lup",ss:translate,m:"wa tup",mm:translate,h:"wa rep",hh:translate,d:"wa jaj",dd:translate,M:"wa jar",MM:translate,y:"wa DIS",yy:translate},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";var w={1:"'inci",5:"'inci",8:"'inci",70:"'inci",80:"'inci",2:"'nci",7:"'nci",20:"'nci",50:"'nci",3:"'nc",4:"'nc",100:"'nc",6:"'nc",9:"'uncu",10:"'uncu",30:"'uncu",60:"'nc",90:"'nc"};D.defineLocale("tr",{months:"Ocak_ubat_Mart_Nisan_Mays_Haziran_Temmuz_Austos_Eyll_Ekim_Kasm_Aralk".split("_"),monthsShort:"Oca_ub_Mar_Nis_May_Haz_Tem_Au_Eyl_Eki_Kas_Ara".split("_"),weekdays:"Pazar_Pazartesi_Sal_aramba_Perembe_Cuma_Cumartesi".split("_"),weekdaysShort:"Paz_Pts_Sal_ar_Per_Cum_Cts".split("_"),weekdaysMin:"Pz_Pt_Sa_a_Pe_Cu_Ct".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[bugn saat] LT",nextDay:"[yarn saat] LT",nextWeek:"[gelecek] dddd [saat] LT",lastDay:"[dn] LT",lastWeek:"[geen] dddd [saat] LT",sameElse:"L"},relativeTime:{future:"%s sonra",past:"%s nce",s:"birka saniye",ss:"%d saniye",m:"bir dakika",mm:"%d dakika",h:"bir saat",hh:"%d saat",d:"bir gn",dd:"%d gn",M:"bir ay",MM:"%d ay",y:"bir yl",yy:"%d yl"},ordinal:function(D,N){switch(N){case"d":case"D":case"Do":case"DD":return D;default:if(0===D)return D+"'nc";var F=D%10;return D+(w[F]||w[D%100-F]||w[D>=100?100:null])}},week:{dow:1,doy:7}})}(N(0))},function(D,w,N){!function(D){"use strict";function processRelativeTime(D,w,N,F){var k={s:["viensas secunds","'iensas secunds"],ss:[D+" secunds",D+" secunds"],m:["'n mut","'iens mut"],mm:[D+" muts",D+" muts"],h:["'n ora","'iensa ora"],hh:[D+" oras",D+" oras"],d:["'n ziua","'iensa ziua"],dd:[D+" ziuas",D+" ziuas"],M:["'n mes","'iens mes"],MM:[D+" mesen",D+" mesen"],y:["'n ar","'iens ar"],yy:[D+" ars",D+" ars"]};return F||w?k[N][0]:k[N][1]}D.defineLocale("tzl",{months:"Januar_Fevraglh_Mar_Avru_Mai_Gn_Julia_Guscht_Setemvar_Listopts_Noemvar_Zecemvar".split("_"),monthsShort:"Jan_Fev_Mar_Avr_Mai_Gn_Jul_Gus_Set_Lis_Noe_Zec".split("_"),weekdays:"Sladi_Lnei_Maitzi_Mrcuri_Xhadi_Vineri_Sturi".split("_"),weekdaysShort:"Sl_Ln_Mai_Mr_Xh_Vi_St".split("_"),weekdaysMin:"S_L_Ma_M_Xh_Vi_S".split("_"),longDateFormat:{LT:"HH.mm",LTS:"HH.mm.ss",L:"DD.MM.YYYY",LL:"D. MMMM [dallas] YYYY",LLL:"D. MMMM [dallas] YYYY HH.mm",LLLL:"dddd, [li] D. MMMM [dallas] YYYY HH.mm"},meridiemParse:/d\'o|d\'a/i,isPM:function(D){return"d'o"===D.toLowerCase()},meridiem:function(D,w,N){return D>11?N?"d'o":"D'O":N?"d'a":"D'A"},calendar:{sameDay:"[oxhi ] LT",nextDay:"[dem ] LT",nextWeek:"dddd [] LT",lastDay:"[ieiri ] LT",lastWeek:"[sr el] dddd [lasteu ] LT",sameElse:"L"},relativeTime:{future:"osprei %s",past:"ja%s",s:processRelativeTime,ss:processRelativeTime,m:processRelativeTime,mm:processRelativeTime,h:processRelativeTime,hh:processRelativeTime,d:processRelativeTime,dd:processRelativeTime,M:processRelativeTime,MM:processRelativeTime,y:processRelativeTime,yy:processRelativeTime},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("tzm",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"dddd [] LT",lastDay:"[ ] LT",lastWeek:"dddd [] LT",sameElse:"L"},relativeTime:{future:"   %s",past:" %s",s:"",ss:"%d ",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d o",M:"o",MM:"%d ",y:"",yy:"%d "},week:{dow:6,doy:12}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("tzm-latn",{months:"innayr_brayr_mars_ibrir_mayyw_ywnyw_ywlywz_wt_wtanbir_ktwbr_nwwanbir_dwjnbir".split("_"),monthsShort:"innayr_brayr_mars_ibrir_mayyw_ywnyw_ywlywz_wt_wtanbir_ktwbr_nwwanbir_dwjnbir".split("_"),weekdays:"asamas_aynas_asinas_akras_akwas_asimwas_asiyas".split("_"),weekdaysShort:"asamas_aynas_asinas_akras_akwas_asimwas_asiyas".split("_"),weekdaysMin:"asamas_aynas_asinas_akras_akwas_asimwas_asiyas".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[asdkh g] LT",nextDay:"[aska g] LT",nextWeek:"dddd [g] LT",lastDay:"[assant g] LT",lastWeek:"dddd [g] LT",sameElse:"L"},relativeTime:{future:"dadkh s yan %s",past:"yan %s",s:"imik",ss:"%d imik",m:"minu",mm:"%d minu",h:"saa",hh:"%d tassain",d:"ass",dd:"%d ossan",M:"ayowr",MM:"%d iyyirn",y:"asgas",yy:"%d isgasn"},week:{dow:6,doy:12}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("ug-cn",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY-MM-DD",LL:"YYYY-M-D-",LLL:"YYYY-M-D- HH:mm",LLLL:"dddd YYYY-M-D- HH:mm"},meridiemParse:/ || || |/,meridiemHour:function(D,w){return 12===D&&(D=0)," "===w||""===w||" "===w?D:" "===w||""===w?D+12:D>=11?D:D+12},meridiem:function(D,w,N){var F=100*D+w;return F<600?" ":F<900?"":F<1130?" ":F<1230?"":F<1800?" ":""},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"[] dddd [] LT",lastDay:"[] LT",lastWeek:"[] dddd [] LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:" ",ss:"%d ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},dayOfMonthOrdinalParse:/\d{1,2}(-|-|-)/,ordinal:function(D,w){switch(w){case"d":case"D":case"DDD":return D+"-";case"w":case"W":return D+"-";default:return D}},preparse:function(D){return D.replace(//g,",")},postformat:function(D){return D.replace(/,/g,"")},week:{dow:1,doy:7}})}(N(0))},function(D,w,N){!function(D){"use strict";function relativeTimeWithPlural(D,w,N){return"m"===N?w?"":"":"h"===N?w?"":"":D+" "+function plural(D,w){var N=D.split("_");return w%10==1&&w%100!=11?N[0]:w%10>=2&&w%10<=4&&(w%100<10||w%100>=20)?N[1]:N[2]}({ss:w?"__":"__",mm:w?"__":"__",hh:w?"__":"__",dd:"__",MM:"__",yy:"__"}[N],+D)}function processHoursFunction(D){return function(){return D+""+(11===this.hours()?"":"")+"] LT"}}D.defineLocale("uk",{months:{format:"___________".split("_"),standalone:"___________".split("_")},monthsShort:"___________".split("_"),weekdays:function weekdaysCaseReplace(D,w){var N={nominative:"______".split("_"),accusative:"______".split("_"),genitive:"______".split("_")};return!0===D?N.nominative.slice(1,7).concat(N.nominative.slice(0,1)):D?N[/(\[[]\]) ?dddd/.test(w)?"accusative":/\[?(?:|)? ?\] ?dddd/.test(w)?"genitive":"nominative"][D.day()]:N.nominative},weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY .",LLL:"D MMMM YYYY ., HH:mm",LLLL:"dddd, D MMMM YYYY ., HH:mm"},calendar:{sameDay:processHoursFunction("[ "),nextDay:processHoursFunction("[ "),lastDay:processHoursFunction("[ "),nextWeek:processHoursFunction("[] dddd ["),lastWeek:function(){switch(this.day()){case 0:case 3:case 5:case 6:return processHoursFunction("[] dddd [").call(this);case 1:case 2:case 4:return processHoursFunction("[] dddd [").call(this)}},sameElse:"L"},relativeTime:{future:" %s",past:"%s ",s:" ",ss:relativeTimeWithPlural,m:relativeTimeWithPlural,mm:relativeTimeWithPlural,h:"",hh:relativeTimeWithPlural,d:"",dd:relativeTimeWithPlural,M:"",MM:relativeTimeWithPlural,y:"",yy:relativeTimeWithPlural},meridiemParse:/|||/,isPM:function(D){return/^(|)$/.test(D)},meridiem:function(D,w,N){return D<4?"":D<12?"":D<17?"":""},dayOfMonthOrdinalParse:/\d{1,2}-(|)/,ordinal:function(D,w){switch(w){case"M":case"d":case"DDD":case"w":case"W":return D+"-";case"D":return D+"-";default:return D}},week:{dow:1,doy:7}})}(N(0))},function(D,w,N){!function(D){"use strict";var w=["","","","","","","","","","","",""],N=["","","","","","",""];D.defineLocale("ur",{months:w,monthsShort:w,weekdays:N,weekdaysShort:N,weekdaysMin:N,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},meridiemParse:/|/,isPM:function(D){return""===D},meridiem:function(D,w,N){return D<12?"":""},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"dddd [] LT",lastDay:"[  ] LT",lastWeek:"[] dddd [] LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:" ",ss:"%d ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},preparse:function(D){return D.replace(//g,",")},postformat:function(D){return D.replace(/,/g,"")},week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("uz",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"D MMMM YYYY, dddd HH:mm"},calendar:{sameDay:"[ ] LT []",nextDay:"[] LT []",nextWeek:"dddd [ ] LT []",lastDay:"[ ] LT []",lastWeek:"[] dddd [ ] LT []",sameElse:"L"},relativeTime:{future:" %s ",past:"  %s ",s:"",ss:"%d ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},week:{dow:1,doy:7}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("uz-latn",{months:"Yanvar_Fevral_Mart_Aprel_May_Iyun_Iyul_Avgust_Sentabr_Oktabr_Noyabr_Dekabr".split("_"),monthsShort:"Yan_Fev_Mar_Apr_May_Iyun_Iyul_Avg_Sen_Okt_Noy_Dek".split("_"),weekdays:"Yakshanba_Dushanba_Seshanba_Chorshanba_Payshanba_Juma_Shanba".split("_"),weekdaysShort:"Yak_Dush_Sesh_Chor_Pay_Jum_Shan".split("_"),weekdaysMin:"Ya_Du_Se_Cho_Pa_Ju_Sha".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"D MMMM YYYY, dddd HH:mm"},calendar:{sameDay:"[Bugun soat] LT [da]",nextDay:"[Ertaga] LT [da]",nextWeek:"dddd [kuni soat] LT [da]",lastDay:"[Kecha soat] LT [da]",lastWeek:"[O'tgan] dddd [kuni soat] LT [da]",sameElse:"L"},relativeTime:{future:"Yaqin %s ichida",past:"Bir necha %s oldin",s:"soniya",ss:"%d soniya",m:"bir daqiqa",mm:"%d daqiqa",h:"bir soat",hh:"%d soat",d:"bir kun",dd:"%d kun",M:"bir oy",MM:"%d oy",y:"bir yil",yy:"%d yil"},week:{dow:1,doy:7}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("vi",{months:"thng 1_thng 2_thng 3_thng 4_thng 5_thng 6_thng 7_thng 8_thng 9_thng 10_thng 11_thng 12".split("_"),monthsShort:"Th01_Th02_Th03_Th04_Th05_Th06_Th07_Th08_Th09_Th10_Th11_Th12".split("_"),monthsParseExact:!0,weekdays:"ch nht_th hai_th ba_th t_th nm_th su_th by".split("_"),weekdaysShort:"CN_T2_T3_T4_T5_T6_T7".split("_"),weekdaysMin:"CN_T2_T3_T4_T5_T6_T7".split("_"),weekdaysParseExact:!0,meridiemParse:/sa|ch/i,isPM:function(D){return/^ch$/i.test(D)},meridiem:function(D,w,N){return D<12?N?"sa":"SA":N?"ch":"CH"},longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM [nm] YYYY",LLL:"D MMMM [nm] YYYY HH:mm",LLLL:"dddd, D MMMM [nm] YYYY HH:mm",l:"DD/M/YYYY",ll:"D MMM YYYY",lll:"D MMM YYYY HH:mm",llll:"ddd, D MMM YYYY HH:mm"},calendar:{sameDay:"[Hm nay lc] LT",nextDay:"[Ngy mai lc] LT",nextWeek:"dddd [tun ti lc] LT",lastDay:"[Hm qua lc] LT",lastWeek:"dddd [tun ri lc] LT",sameElse:"L"},relativeTime:{future:"%s ti",past:"%s trc",s:"vi giy",ss:"%d giy",m:"mt pht",mm:"%d pht",h:"mt gi",hh:"%d gi",d:"mt ngy",dd:"%d ngy",M:"mt thng",MM:"%d thng",y:"mt nm",yy:"%d nm"},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:function(D){return D},week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("x-pseudo",{months:"J~~r_F~br~r_~Mrc~h_p~rl_~M_~J~_Jl~_~gst~_Sp~tmb~r_~ctb~r_~vm~br_~Dc~mbr".split("_"),monthsShort:"J~_~Fb_~Mr_~pr_~M_~J_~Jl_~g_~Sp_~ct_~v_~Dc".split("_"),monthsParseExact:!0,weekdays:"S~d~_M~d~_T~sd~_Wd~sd~_T~hrs~d_~Frd~_S~tr~d".split("_"),weekdaysShort:"S~_~M_~T_~Wd_~Th_~Fr_~St".split("_"),weekdaysMin:"S~_M~_T_~W_T~h_Fr~_S".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[T~d~ t] LT",nextDay:"[T~m~rr~w t] LT",nextWeek:"dddd [t] LT",lastDay:"[~st~rd~ t] LT",lastWeek:"[L~st] dddd [t] LT",sameElse:"L"},relativeTime:{future:"~ %s",past:"%s ~g",s:" ~fw ~sc~ds",ss:"%d s~c~ds",m:" ~m~t",mm:"%d m~~ts",h:"~ h~r",hh:"%d h~rs",d:" ~d",dd:"%d d~s",M:" ~m~th",MM:"%d m~t~hs",y:" ~r",yy:"%d ~rs"},dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(D){var w=D%10;return D+(1==~~(D%100/10)?"th":1===w?"st":2===w?"nd":3===w?"rd":"th")},week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("yo",{months:"Sr_Erele_rna_Igbe_Ebibi_Okudu_Agmo_Ogun_Owewe_wara_Belu_p".split("_"),monthsShort:"Sr_Erl_rn_Igb_Ebi_Oku_Ag_Ogu_Owe_wa_Bel_p".split("_"),weekdays:"Aiku_Aje_Isgun_jru_jb_ti_Abamta".split("_"),weekdaysShort:"Aik_Aje_Is_jr_jb_ti_Aba".split("_"),weekdaysMin:"Ai_Aj_Is_r_b_t_Ab".split("_"),longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY h:mm A",LLLL:"dddd, D MMMM YYYY h:mm A"},calendar:{sameDay:"[Oni ni] LT",nextDay:"[la ni] LT",nextWeek:"dddd [s ton'b] [ni] LT",lastDay:"[Ana ni] LT",lastWeek:"dddd [s tol] [ni] LT",sameElse:"L"},relativeTime:{future:"ni %s",past:"%s kja",s:"isju aaya die",ss:"aaya %d",m:"isju kan",mm:"isju %d",h:"wakati kan",hh:"wakati %d",d:"j kan",dd:"j %d",M:"osu kan",MM:"osu %d",y:"dun kan",yy:"dun %d"},dayOfMonthOrdinalParse:/j\s\d{1,2}/,ordinal:"j %d",week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("zh-cn",{months:"___________".split("_"),monthsShort:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"YYYYMD",LLL:"YYYYMDAhmm",LLLL:"YYYYMDddddAhmm",l:"YYYY/M/D",ll:"YYYYMD",lll:"YYYYMD HH:mm",llll:"YYYYMDdddd HH:mm"},meridiemParse:/|||||/,meridiemHour:function(D,w){return 12===D&&(D=0),""===w||""===w||""===w?D:""===w||""===w?D+12:D>=11?D:D+12},meridiem:function(D,w,N){var F=100*D+w;return F<600?"":F<900?"":F<1130?"":F<1230?"":F<1800?"":""},calendar:{sameDay:"[]LT",nextDay:"[]LT",nextWeek:"[]ddddLT",lastDay:"[]LT",lastWeek:"[]ddddLT",sameElse:"L"},dayOfMonthOrdinalParse:/\d{1,2}(||)/,ordinal:function(D,w){switch(w){case"d":case"D":case"DDD":return D+"";case"M":return D+"";case"w":case"W":return D+"";default:return D}},relativeTime:{future:"%s",past:"%s",s:"",ss:"%d ",m:"1 ",mm:"%d ",h:"1 ",hh:"%d ",d:"1 ",dd:"%d ",M:"1 ",MM:"%d ",y:"1 ",yy:"%d "},week:{dow:1,doy:4}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("zh-hk",{months:"___________".split("_"),monthsShort:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"YYYYMD",LLL:"YYYYMD HH:mm",LLLL:"YYYYMDdddd HH:mm",l:"YYYY/M/D",ll:"YYYYMD",lll:"YYYYMD HH:mm",llll:"YYYYMDdddd HH:mm"},meridiemParse:/|||||/,meridiemHour:function(D,w){return 12===D&&(D=0),""===w||""===w||""===w?D:""===w?D>=11?D:D+12:""===w||""===w?D+12:void 0},meridiem:function(D,w,N){var F=100*D+w;return F<600?"":F<900?"":F<1130?"":F<1230?"":F<1800?"":""},calendar:{sameDay:"[]LT",nextDay:"[]LT",nextWeek:"[]ddddLT",lastDay:"[]LT",lastWeek:"[]ddddLT",sameElse:"L"},dayOfMonthOrdinalParse:/\d{1,2}(||)/,ordinal:function(D,w){switch(w){case"d":case"D":case"DDD":return D+"";case"M":return D+"";case"w":case"W":return D+"";default:return D}},relativeTime:{future:"%s",past:"%s",s:"",ss:"%d ",m:"1 ",mm:"%d ",h:"1 ",hh:"%d ",d:"1 ",dd:"%d ",M:"1 ",MM:"%d ",y:"1 ",yy:"%d "}})}(N(0))},function(D,w,N){!function(D){"use strict";D.defineLocale("zh-tw",{months:"___________".split("_"),monthsShort:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"YYYYMD",LLL:"YYYYMD HH:mm",LLLL:"YYYYMDdddd HH:mm",l:"YYYY/M/D",ll:"YYYYMD",lll:"YYYYMD HH:mm",llll:"YYYYMDdddd HH:mm"},meridiemParse:/|||||/,meridiemHour:function(D,w){return 12===D&&(D=0),""===w||""===w||""===w?D:""===w?D>=11?D:D+12:""===w||""===w?D+12:void 0},meridiem:function(D,w,N){var F=100*D+w;return F<600?"":F<900?"":F<1130?"":F<1230?"":F<1800?"":""},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"[]dddd LT",lastDay:"[] LT",lastWeek:"[]dddd LT",sameElse:"L"},dayOfMonthOrdinalParse:/\d{1,2}(||)/,ordinal:function(D,w){switch(w){case"d":case"D":case"DDD":return D+"";case"M":return D+"";case"w":case"W":return D+"";default:return D}},relativeTime:{future:"%s",past:"%s",s:"",ss:"%d ",m:"1 ",mm:"%d ",h:"1 ",hh:"%d ",d:"1 ",dd:"%d ",M:"1 ",MM:"%d ",y:"1 ",yy:"%d "}})}(N(0))},,,,,,,,,,,,function(D,w,N){(function(D,w){(function(){"use strict";var N;function ba(D){var w=0;return function(){return w<D.length?{done:!1,value:D[w++]}:{done:!0}}}function ca(D){var w="undefined"!=typeof Symbol&&Symbol.iterator&&D[Symbol.iterator];return w?w.call(D):{next:ba(D)}}function da(D){for(var w,N=[];!(w=D.next()).done;)N.push(w.value);return N}var F="undefined"!=typeof window&&window===this?this:void 0!==D&&null!=D?D:this,k="function"==typeof Object.defineProperties?Object.defineProperty:function(D,w,N){D!=Array.prototype&&D!=Object.prototype&&(D[w]=N.value)};function ia(){ia=function(){},F.Symbol||(F.Symbol=G)}function ma(D,w){this.a=D,k(this,"description",{configurable:!0,writable:!0,value:w})}ma.prototype.toString=function(){return this.a};var j,z,G=(j=0,function a(D){if(this instanceof a)throw new TypeError("Symbol is not a constructor");return new ma("jscomp_symbol_"+(D||"")+"_"+j++,D)});function na(){ia();var D=F.Symbol.iterator;D||(D=F.Symbol.iterator=F.Symbol("Symbol.iterator")),"function"!=typeof Array.prototype[D]&&k(Array.prototype,D,{configurable:!0,writable:!0,value:function(){return function oa(D){return na(),(D={next:D})[F.Symbol.iterator]=function(){return this},D}(ba(this))}}),na=function(){}}if("function"==typeof Object.setPrototypeOf)z=Object.setPrototypeOf;else{var H;e:{var X={};try{X.__proto__={Pa:!0},H=X.Pa;break e}catch(Ze){}H=!1}z=H?function(D,w){if(D.__proto__=w,D.__proto__!==w)throw new TypeError(D+" is not extensible");return D}:null}var q=z;function ya(){this.l=!1,this.b=null,this.Ea=void 0,this.a=1,this.Y=0,this.c=null}function za(D){if(D.l)throw new TypeError("Generator is already running");D.l=!0}function Aa(D,w){D.c={Sa:w,Wa:!0},D.a=D.Y}function Ba(D,w){return D.a=3,{value:w}}function Ca(D){this.a=new ya,this.b=D}function Ea(D,w,N,F){try{var k=w.call(D.a.b,N);if(!(k instanceof Object))throw new TypeError("Iterator result "+k+" is not an object");if(!k.done)return D.a.l=!1,k;var j=k.value}catch(w){return D.a.b=null,Aa(D.a,w),Fa(D)}return D.a.b=null,F.call(D.a,j),Fa(D)}function Fa(D){for(;D.a.a;)try{var w=D.b(D.a);if(w)return D.a.l=!1,{value:w.value,done:!1}}catch(w){D.a.Ea=void 0,Aa(D.a,w)}if(D.a.l=!1,D.a.c){if(w=D.a.c,D.a.c=null,w.Wa)throw w.Sa;return{value:w.return,done:!0}}return{value:void 0,done:!0}}function Ga(D){this.next=function(w){return za(D.a),D.a.b?w=Ea(D,D.a.b.next,w,D.a.J):(D.a.J(w),w=Fa(D)),w},this.throw=function(w){return za(D.a),D.a.b?w=Ea(D,D.a.b.throw,w,D.a.J):(Aa(D.a,w),w=Fa(D)),w},this.return=function(w){return function Da(D,w){za(D.a);var N=D.a.b;return N?Ea(D,"return"in N?N.return:function(D){return{value:D,done:!0}},w,D.a.return):(D.a.return(w),Fa(D))}(D,w)},na(),this[Symbol.iterator]=function(){return this}}function Ha(D,w){return w=new Ga(new Ca(w)),q&&q(w,D.prototype),w}ya.prototype.J=function(D){this.Ea=D},ya.prototype.return=function(D){this.c={return:D},this.a=this.Y},Array.from||(Array.from=function(D){return[].slice.call(D)}),Object.assign||(Object.assign=function(D){for(var w,N=[].slice.call(arguments,1),F=0;F<N.length;F++)if(w=N[F])for(var k=D,j=w,z=Object.getOwnPropertyNames(j),G=0;G<z.length;G++)k[w=z[G]]=j[w];return D}),function(){if((w=document.createEvent("Event")).initEvent("foo",!0,!0),w.preventDefault(),!w.defaultPrevented){var D=Event.prototype.preventDefault;Event.prototype.preventDefault=function(){this.cancelable&&(D.call(this),Object.defineProperty(this,"defaultPrevented",{get:function(){return!0},configurable:!0}))}}var w,N=/Trident/.test(navigator.userAgent);if(!window.Event||N&&"function"!=typeof window.Event){var F=window.Event;if(window.Event=function(D,w){w=w||{};var N=document.createEvent("Event");return N.initEvent(D,!!w.bubbles,!!w.cancelable),N},F){for(var k in F)window.Event[k]=F[k];window.Event.prototype=F.prototype}}if((!window.CustomEvent||N&&"function"!=typeof window.CustomEvent)&&(window.CustomEvent=function(D,w){w=w||{};var N=document.createEvent("CustomEvent");return N.initCustomEvent(D,!!w.bubbles,!!w.cancelable,w.detail),N},window.CustomEvent.prototype=window.Event.prototype),!window.MouseEvent||N&&"function"!=typeof window.MouseEvent){if(N=window.MouseEvent,window.MouseEvent=function(D,w){w=w||{};var N=document.createEvent("MouseEvent");return N.initMouseEvent(D,!!w.bubbles,!!w.cancelable,w.view||window,w.detail,w.screenX,w.screenY,w.clientX,w.clientY,w.ctrlKey,w.altKey,w.shiftKey,w.metaKey,w.button,w.relatedTarget),N},N)for(var j in N)window.MouseEvent[j]=N[j];window.MouseEvent.prototype=N.prototype}}(),function(){function a(){}function b(D,w){if(!D.childNodes.length)return[];switch(D.nodeType){case Node.DOCUMENT_NODE:return $.call(D,w);case Node.DOCUMENT_FRAGMENT_NODE:return te.call(D,w);default:return J.call(D,w)}}var D="undefined"==typeof HTMLTemplateElement,w=!(document.createDocumentFragment().cloneNode()instanceof DocumentFragment),N=!1;/Trident/.test(navigator.userAgent)&&function(){function p(D,N){if(D instanceof DocumentFragment)for(var F;F=D.firstChild;)w.call(this,F,N);else w.call(this,D,N);return D}N=!0;var D=Node.prototype.cloneNode;Node.prototype.cloneNode=function(w){return w=D.call(this,w),this instanceof DocumentFragment&&(w.__proto__=DocumentFragment.prototype),w},DocumentFragment.prototype.querySelectorAll=HTMLElement.prototype.querySelectorAll,DocumentFragment.prototype.querySelector=HTMLElement.prototype.querySelector,Object.defineProperties(DocumentFragment.prototype,{nodeType:{get:function(){return Node.DOCUMENT_FRAGMENT_NODE},configurable:!0},localName:{get:function(){},configurable:!0},nodeName:{get:function(){return"#document-fragment"},configurable:!0}});var w=Node.prototype.insertBefore;Node.prototype.insertBefore=p;var F=Node.prototype.appendChild;Node.prototype.appendChild=function(D){return D instanceof DocumentFragment?p.call(this,D,null):F.call(this,D),D};var k=Node.prototype.removeChild,j=Node.prototype.replaceChild;Node.prototype.replaceChild=function(D,w){return D instanceof DocumentFragment?(p.call(this,D,w),k.call(this,w)):j.call(this,D,w),w},Document.prototype.createDocumentFragment=function(){var D=this.createElement("df");return D.__proto__=DocumentFragment.prototype,D};var z=Document.prototype.importNode;Document.prototype.importNode=function(D,w){return w=z.call(this,D,w||!1),D instanceof DocumentFragment&&(w.__proto__=DocumentFragment.prototype),w}}();var F=Node.prototype.cloneNode,k=Document.prototype.createElement,j=Document.prototype.importNode,z=Node.prototype.removeChild,G=Node.prototype.appendChild,H=Node.prototype.replaceChild,X=DOMParser.prototype.parseFromString,q=Object.getOwnPropertyDescriptor(window.HTMLElement.prototype,"innerHTML")||{get:function(){return this.innerHTML},set:function(D){this.innerHTML=D}},Z=Object.getOwnPropertyDescriptor(window.Node.prototype,"childNodes")||{get:function(){return this.childNodes}},J=Element.prototype.querySelectorAll,$=Document.prototype.querySelectorAll,te=DocumentFragment.prototype.querySelectorAll,ie=function(){if(!D){var N=document.createElement("template"),F=document.createElement("template");return F.content.appendChild(document.createElement("div")),N.content.appendChild(F),0===(N=N.cloneNode(!0)).content.childNodes.length||0===N.content.firstChild.content.childNodes.length||w}}();if(D){var oe=document.implementation.createHTMLDocument("template"),ce=!0,he=document.createElement("style");he.textContent="template{display:none;}";var fe=document.head;fe.insertBefore(he,fe.firstElementChild),a.prototype=Object.create(HTMLElement.prototype);var pe=!document.createElement("div").hasOwnProperty("innerHTML");a.U=function(D){if(!D.content&&D.namespaceURI===document.documentElement.namespaceURI){D.content=oe.createDocumentFragment();for(var w;w=D.firstChild;)G.call(D.content,w);if(pe)D.__proto__=a.prototype;else if(D.cloneNode=function(D){return a.b(this,D)},ce)try{n(D),I(D)}catch(D){ce=!1}a.a(D.content)}};var _e={option:["select"],thead:["table"],col:["colgroup","table"],tr:["tbody","table"],th:["tr","tbody","table"],td:["tr","tbody","table"]},n=function(D){Object.defineProperty(D,"innerHTML",{get:function(){return ua(this)},set:function(D){var w=_e[(/<([a-z][^/\0>\x20\t\r\n\f]+)/i.exec(D)||["",""])[1].toLowerCase()];if(w)for(var N=0;N<w.length;N++)D="<"+w[N]+">"+D+"</"+w[N]+">";for(oe.body.innerHTML=D,a.a(oe);this.content.firstChild;)z.call(this.content,this.content.firstChild);if(D=oe.body,w)for(N=0;N<w.length;N++)D=D.lastChild;for(;D.firstChild;)G.call(this.content,D.firstChild)},configurable:!0})},I=function(D){Object.defineProperty(D,"outerHTML",{get:function(){return"<template>"+this.innerHTML+"</template>"},set:function(D){if(!this.parentNode)throw Error("Failed to set the 'outerHTML' property on 'Element': This element has no parent node.");for(oe.body.innerHTML=D,D=this.ownerDocument.createDocumentFragment();oe.body.firstChild;)G.call(D,oe.body.firstChild);H.call(this.parentNode,D,this)},configurable:!0})};n(a.prototype),I(a.prototype),a.a=function(D){for(var w,N=0,F=(D=b(D,"template")).length;N<F&&(w=D[N]);N++)a.U(w)},document.addEventListener("DOMContentLoaded",(function(){a.a(document)})),Document.prototype.createElement=function(){var D=k.apply(this,arguments);return"template"===D.localName&&a.U(D),D},DOMParser.prototype.parseFromString=function(){var D=X.apply(this,arguments);return a.a(D),D},Object.defineProperty(HTMLElement.prototype,"innerHTML",{get:function(){return ua(this)},set:function(D){q.set.call(this,D),a.a(this)},configurable:!0,enumerable:!0});var ve=/[&\u00A0"]/g,ye=/[&\u00A0<>]/g,cb=function(D){switch(D){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"":return"&nbsp;"}},be=(he=function(D){for(var w={},N=0;N<D.length;N++)w[D[N]]=!0;return w})("area base br col command embed hr img input keygen link meta param source track wbr".split(" ")),Te=he("style script xmp iframe noembed noframes plaintext noscript".split(" ")),ua=function(D,w){"template"===D.localName&&(D=D.content);for(var N,F="",k=w?w(D):Z.get.call(D),j=0,z=k.length;j<z&&(N=k[j]);j++){e:{var G=N,H=D,X=w;switch(G.nodeType){case Node.ELEMENT_NODE:for(var q=G.localName,J="<"+q,$=G.attributes,te=0;H=$[te];te++)J+=" "+H.name+'="'+H.value.replace(ve,cb)+'"';J+=">",G=be[q]?J:J+ua(G,X)+"</"+q+">";break e;case Node.TEXT_NODE:G=G.data,G=H&&Te[H.localName]?G:G.replace(ye,cb);break e;case Node.COMMENT_NODE:G="\x3c!--"+G.data+"--\x3e";break e;default:throw window.console.error(G),Error("not implemented")}}F+=G}return F}}if(D||ie){a.b=function(D,w){var N=F.call(D,!1);return this.U&&this.U(N),w&&(G.call(N.content,F.call(D.content,!0)),u(N.content,D.content)),N};var u=function(D,w){if(w.querySelectorAll&&0!==(w=b(w,"template")).length)for(var N,F,k=0,j=(D=b(D,"template")).length;k<j;k++)F=w[k],N=D[k],a&&a.U&&a.U(F),H.call(N.parentNode,Ee.call(F,!0),N)},Ee=Node.prototype.cloneNode=function(D){if(!N&&w&&this instanceof DocumentFragment){if(!D)return this.ownerDocument.createDocumentFragment();var k=Se.call(this.ownerDocument,this,!0)}else k=this.nodeType===Node.ELEMENT_NODE&&"template"===this.localName&&this.namespaceURI==document.documentElement.namespaceURI?a.b(this,D):F.call(this,D);return D&&u(k,this),k},Se=Document.prototype.importNode=function(D,w){if(w=w||!1,"template"===D.localName)return a.b(D,w);var N=j.call(this,D,w);if(w){u(N,D),D=b(N,'script:not([type]),script[type="application/javascript"],script[type="text/javascript"]');for(var F,z=0;z<D.length;z++){F=D[z],(w=k.call(document,"script")).textContent=F.textContent;for(var G,X=F.attributes,q=0;q<X.length;q++)G=X[q],w.setAttribute(G.name,G.value);H.call(F.parentNode,w,F)}}return N}}D&&(window.HTMLTemplateElement=a)}();var Z=setTimeout;function Ja(){}function x(D){if(!(this instanceof x))throw new TypeError("Promises must be constructed via new");if("function"!=typeof D)throw new TypeError("not a function");this.I=0,this.za=!1,this.C=void 0,this.W=[],La(D,this)}function Ma(D,w){for(;3===D.I;)D=D.C;0===D.I?D.W.push(w):(D.za=!0,J((function(){var N=1===D.I?w.Ya:w.Za;if(null===N)(1===D.I?Oa:Pa)(w.va,D.C);else{try{var F=N(D.C)}catch(D){return void Pa(w.va,D)}Oa(w.va,F)}})))}function Oa(D,w){try{if(w===D)throw new TypeError("A promise cannot be resolved with itself.");if(w&&("object"==typeof w||"function"==typeof w)){var N=w.then;if(w instanceof x)return D.I=3,D.C=w,void Ra(D);if("function"==typeof N)return void La(function Ka(D,w){return function(){D.apply(w,arguments)}}(N,w),D)}D.I=1,D.C=w,Ra(D)}catch(w){Pa(D,w)}}function Pa(D,w){D.I=2,D.C=w,Ra(D)}function Ra(D){2===D.I&&0===D.W.length&&J((function(){D.za||"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",D.C)}));for(var w=0,N=D.W.length;w<N;w++)Ma(D,D.W[w]);D.W=null}function Sa(D,w,N){this.Ya="function"==typeof D?D:null,this.Za="function"==typeof w?w:null,this.va=N}function La(D,w){var N=!1;try{D((function(D){N||(N=!0,Oa(w,D))}),(function(D){N||(N=!0,Pa(w,D))}))}catch(D){N||(N=!0,Pa(w,D))}}x.prototype.catch=function(D){return this.then(null,D)},x.prototype.then=function(D,w){var N=new this.constructor(Ja);return Ma(this,new Sa(D,w,N)),N},x.prototype.finally=function(D){var w=this.constructor;return this.then((function(N){return w.resolve(D()).then((function(){return N}))}),(function(N){return w.resolve(D()).then((function(){return w.reject(N)}))}))};var J="function"==typeof w&&function(D){w(D)}||function(D){Z(D,0)};if(!window.Promise){window.Promise=x,x.prototype.then=x.prototype.then,x.all=function Ta(D){return new x((function(w,N){function d(D,j){try{if(j&&("object"==typeof j||"function"==typeof j)){var z=j.then;if("function"==typeof z)return void z.call(j,(function(w){d(D,w)}),N)}F[D]=j,0==--k&&w(F)}catch(D){N(D)}}if(!D||void 0===D.length)throw new TypeError("Promise.all accepts an array");var F=Array.prototype.slice.call(D);if(0===F.length)return w([]);for(var k=F.length,j=0;j<F.length;j++)d(j,F[j])}))},x.race=function Wa(D){return new x((function(w,N){for(var F=0,k=D.length;F<k;F++)D[F].then(w,N)}))},x.resolve=function Ua(D){return D&&"object"==typeof D&&D.constructor===x?D:new x((function(w){w(D)}))},x.reject=function Va(D){return new x((function(w,N){N(D)}))};var $=document.createTextNode(""),te=[];new MutationObserver((function(){for(var D=te.length,w=0;w<D;w++)te[w]();te.splice(0,D)})).observe($,{characterData:!0}),J=function(D){te.push(D),$.textContent=0<$.textContent.length?"":"a"}}!function(w,N){if(!(N in w)){var F=typeof D==typeof F?window:D,k=0,j=""+Math.random(),z="__symbol@@"+j,G=w.getOwnPropertyNames,H=w.getOwnPropertyDescriptor,X=w.create,q=w.keys,Z=w.freeze||w,J=w.defineProperty,$=w.defineProperties,te=H(w,"getOwnPropertyNames"),ie=w.prototype,oe=ie.hasOwnProperty,ce=ie.propertyIsEnumerable,he=ie.toString,y=function(D,w,N){oe.call(D,z)||J(D,z,{enumerable:!1,configurable:!1,writable:!1,value:{}}),D[z]["@@"+w]=N},W=function(D,w){var N=X(D);return G(w).forEach((function(D){ta.call(w,D)&&Qa(N,D,w[D])})),N},v=function(){},sa=function(D){return D!=z&&!oe.call(fe,D)},ea=function(D){return D!=z&&oe.call(fe,D)},ta=function(D){var w=""+D;return ea(w)?oe.call(this,w)&&this[z]["@@"+w]:ce.call(this,D)},n=function(D){return J(ie,D,{enumerable:!1,configurable:!0,get:v,set:function(w){_e(this,D,{enumerable:!1,configurable:!0,writable:!0,value:w}),y(this,D,!0)}}),Z(fe[D]=J(w(D),"constructor",pe))},I=function(D){if(this&&this!==F)throw new TypeError("Symbol is not a constructor");return n("__symbol:".concat(D||"",j,++k))},fe=X(null),pe={value:I},cb=function(D){return fe[D]},Qa=function(D,w,N){var F=""+w;if(ea(F)){if(w=_e,N.enumerable){var k=X(N);k.enumerable=!1}else k=N;w(D,F,k),y(D,F,!!N.enumerable)}else J(D,w,N);return D},db=function(D){return G(D).filter(ea).map(cb)};te.value=Qa,J(w,"defineProperty",te),te.value=db,J(w,N,te),te.value=function(D){return G(D).filter(sa)},J(w,"getOwnPropertyNames",te),te.value=function(D,w){var N=db(w);return N.length?q(w).concat(N).forEach((function(N){ta.call(w,N)&&Qa(D,N,w[N])})):$(D,w),D},J(w,"defineProperties",te),te.value=ta,J(ie,"propertyIsEnumerable",te),te.value=I,J(F,"Symbol",te),te.value=function(D){return(D="__symbol:".concat("__symbol:",D,j))in ie?fe[D]:n(D)},J(I,"for",te),te.value=function(D){if(sa(D))throw new TypeError(D+" is not a symbol");return oe.call(fe,D)?D.slice(20,-j.length):void 0},J(I,"keyFor",te),te.value=function(D,w){var N=H(D,w);return N&&ea(w)&&(N.enumerable=ta.call(D,w)),N},J(w,"getOwnPropertyDescriptor",te),te.value=function(D,w){return 1===arguments.length?X(D):W(D,w)},J(w,"create",te),te.value=function(){var D=he.call(this);return"[object String]"===D&&ea(this)?"[object Symbol]":D},J(ie,"toString",te);try{var _e=X(J({},"__symbol:",{get:function(){return J(this,"__symbol:",{value:!1})["__symbol:"]}}))["__symbol:"]||J}catch(D){_e=function(D,w,N){var F=H(ie,w);delete ie[w],J(D,w,N),J(ie,w,F)}}}}(Object,"getOwnPropertySymbols"),function(D){var w,N=D.defineProperty,F=D.prototype,k=F.toString;"iterator match replace search split hasInstance isConcatSpreadable unscopables species toPrimitive toStringTag".split(" ").forEach((function(j){if(!(j in Symbol))switch(N(Symbol,j,{value:Symbol(j)}),j){case"toStringTag":(w=D.getOwnPropertyDescriptor(F,"toString")).value=function(){var D=k.call(this),w=this[Symbol.toStringTag];return void 0===w?D:"[object "+w+"]"},N(F,"toString",w)}}))}(Object,Symbol),function(D,w,N){function d(){return this}w[D]||(w[D]=function(){var w=0,N=this,F={next:function(){var D=N.length<=w;return D?{done:D}:{done:D,value:N[w++]}}};return F[D]=d,F}),N[D]||(N[D]=function(){var w=String.fromCodePoint,N=this,F=0,k=N.length,j={next:function(){var D=k<=F,j=D?"":w(N.codePointAt(F));return F+=j.length,D?{done:D}:{done:D,value:j}}};return j[D]=d,j})}(Symbol.iterator,Array.prototype,String.prototype);var ie=Object.prototype.toString;Object.prototype.toString=function(){return void 0===this?"[object Undefined]":null===this?"[object Null]":ie.call(this)},Object.keys=function(D){return Object.getOwnPropertyNames(D).filter((function(w){return(w=Object.getOwnPropertyDescriptor(D,w))&&w.enumerable}))};var oe=window.Symbol.iterator;String.prototype[oe]&&String.prototype.codePointAt||(String.prototype[oe]=function ab(){var D,w=this;return Ha(ab,(function(N){if(1==N.a&&(D=0),3!=N.a)return D<w.length?N=Ba(N,w[D]):(N.a=0,N=void 0),N;D++,N.a=2}))}),Set.prototype[oe]||(Set.prototype[oe]=function fb(){var D,w,N=this;return Ha(fb,(function(F){if(1==F.a&&(D=[],N.forEach((function(w){D.push(w)})),w=0),3!=F.a)return w<D.length?F=Ba(F,D[w]):(F.a=0,F=void 0),F;w++,F.a=2}))}),Map.prototype[oe]||(Map.prototype[oe]=function gb(){var D,w,N=this;return Ha(gb,(function(F){if(1==F.a&&(D=[],N.forEach((function(w,N){D.push([N,w])})),w=0),3!=F.a)return w<D.length?F=Ba(F,D[w]):(F.a=0,F=void 0),F;w++,F.a=2}))}),window.WebComponents=window.WebComponents||{flags:{}};var ce=document.querySelector('script[src*="webcomponents-bundle"]'),he=/wc-(.+)/,fe={};if(!fe.noOpts){if(location.search.slice(1).split("&").forEach((function(D){var w;(D=D.split("="))[0]&&(w=D[0].match(he))&&(fe[w[1]]=D[1]||!0)})),ce)for(var pe=0,_e=void 0;_e=ce.attributes[pe];pe++)"src"!==_e.name&&(fe[_e.name]=_e.value||!0);if(fe.log&&fe.log.split){var ve=fe.log.split(",");fe.log={},ve.forEach((function(D){fe.log[D]=!0}))}else fe.log={}}window.WebComponents.flags=fe;var ye=fe.shadydom;if(ye){window.ShadyDOM=window.ShadyDOM||{},window.ShadyDOM.force=ye;var be=fe.noPatch;window.ShadyDOM.noPatch="true"===be||be}var Te=fe.register||fe.ce;function pb(){}function B(D){return D.__shady||(D.__shady=new pb),D.__shady}function L(D){return D&&D.__shady}Te&&window.customElements&&(window.customElements.forcePolyfill=Te),pb.prototype.toJSON=function(){return{}};var Ee=window.ShadyDOM||{};Ee.Ua=!(!Element.prototype.attachShadow||!Node.prototype.getRootNode);var Se=Object.getOwnPropertyDescriptor(Node.prototype,"firstChild");function rb(D){return(D=L(D))&&void 0!==D.firstChild}function O(D){return D instanceof ShadowRoot}function sb(D){return(D=(D=L(D))&&D.root)&&tb(D)}Ee.B=!!(Se&&Se.configurable&&Se.get),Ee.sa=Ee.force||!Ee.Ua,Ee.D=Ee.noPatch||!1,Ee.la=Ee.preferPerformance,Ee.ua="on-demand"===Ee.D,Ee.Ia=navigator.userAgent.match("Trident");var Me=Element.prototype,xe=Me.matches||Me.matchesSelector||Me.mozMatchesSelector||Me.msMatchesSelector||Me.oMatchesSelector||Me.webkitMatchesSelector,Ae=document.createTextNode(""),Pe=0,Oe=[];function zb(D){Oe.push(D),Ae.textContent=Pe++}new MutationObserver((function(){for(;Oe.length;)try{Oe.shift()()}catch(D){throw Ae.textContent=Pe++,D}})).observe(Ae,{characterData:!0});var Re=!!document.contains;function Bb(D,w){for(;w;){if(w==D)return!0;w=w.__shady_parentNode}return!1}function Cb(D){for(var w=D.length-1;0<=w;w--){var N=D[w],F=N.getAttribute("id")||N.getAttribute("name");F&&"length"!==F&&isNaN(F)&&(D[F]=N)}return D.item=function(w){return D[w]},D.namedItem=function(w){if("length"!==w&&isNaN(w)&&D[w])return D[w];for(var N=ca(D),F=N.next();!F.done;F=N.next())if(((F=F.value).getAttribute("id")||F.getAttribute("name"))==w)return F;return null},D}function Db(D){var w=[];for(D=D.__shady_native_firstChild;D;D=D.__shady_native_nextSibling)w.push(D);return w}function Eb(D){var w=[];for(D=D.__shady_firstChild;D;D=D.__shady_nextSibling)w.push(D);return w}function Fb(D,w,N){if(N.configurable=!0,N.value)D[w]=N.value;else try{Object.defineProperty(D,w,N)}catch(D){}}function P(D,w,N,F){for(var k in N=void 0===N?"":N,w)F&&0<=F.indexOf(k)||Fb(D,N+k,w[k])}function Gb(D,w){for(var N in w)N in D&&Fb(D,N,w[N])}function Q(D){var w={};return Object.getOwnPropertyNames(D).forEach((function(N){w[N]=Object.getOwnPropertyDescriptor(D,N)})),w}function Hb(D,w){for(var N,F=Object.getOwnPropertyNames(w),k=0;k<F.length;k++)D[N=F[k]]=w[N]}var De,Ie=[];function Kb(D){De||(De=!0,zb(Lb)),Ie.push(D)}function Lb(){De=!1;for(var D=!!Ie.length;Ie.length;)Ie.shift()();return D}function Mb(){this.a=!1,this.addedNodes=[],this.removedNodes=[],this.ia=new Set}Lb.list=Ie,Mb.prototype.flush=function(){if(this.a){this.a=!1;var D=this.takeRecords();D.length&&this.ia.forEach((function(w){w(D)}))}},Mb.prototype.takeRecords=function(){if(this.addedNodes.length||this.removedNodes.length){var D=[{addedNodes:this.addedNodes,removedNodes:this.removedNodes}];return this.addedNodes=[],this.removedNodes=[],D}return[]};var Le=/[&\u00A0"]/g,we=/[&\u00A0<>]/g;function Tb(D){switch(D){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"":return"&nbsp;"}}function Ub(D){for(var w={},N=0;N<D.length;N++)w[D[N]]=!0;return w}var Ne=Ub("area base br col command embed hr img input keygen link meta param source track wbr".split(" ")),Fe=Ub("style script xmp iframe noembed noframes plaintext noscript".split(" "));function Zb(D,w){"template"===D.localName&&(D=D.content);for(var N="",F=w?w(D):D.childNodes,k=0,j=F.length,z=void 0;k<j&&(z=F[k]);k++){e:{var G=z,H=D,X=w;switch(G.nodeType){case Node.ELEMENT_NODE:for(var q,Z="<"+(H=G.localName),J=G.attributes,$=0;q=J[$];$++)Z+=" "+q.name+'="'+q.value.replace(Le,Tb)+'"';Z+=">",G=Ne[H]?Z:Z+Zb(G,X)+"</"+H+">";break e;case Node.TEXT_NODE:G=G.data,G=H&&Fe[H.localName]?G:G.replace(we,Tb);break e;case Node.COMMENT_NODE:G="\x3c!--"+G.data+"--\x3e";break e;default:throw window.console.error(G),Error("not implemented")}}N+=G}return N}var Be=Ee.B,Ue={querySelector:function(D){return this.__shady_native_querySelector(D)},querySelectorAll:function(D){return this.__shady_native_querySelectorAll(D)}},Ve={};function cc(D){Ve[D]=function(w){return w["__shady_native_"+D]}}function dc(D,w){for(var N in P(D,w,"__shady_native_"),w)cc(N)}function S(D,w){w=void 0===w?[]:w;for(var N=0;N<w.length;N++){var F=w[N],k=Object.getOwnPropertyDescriptor(D,F);k&&(Object.defineProperty(D,"__shady_native_"+F,k),k.value?Ue[F]||(Ue[F]=k.value):cc(F))}}var ze=document.createTreeWalker(document,NodeFilter.SHOW_ALL,null,!1),Ge=document.createTreeWalker(document,NodeFilter.SHOW_ELEMENT,null,!1),Ye=document.implementation.createHTMLDocument("inert");function hc(D){for(var w;w=D.__shady_native_firstChild;)D.__shady_native_removeChild(w)}var He=["firstElementChild","lastElementChild","children","childElementCount"],We=["querySelector","querySelectorAll"];var Xe=Q({get childNodes(){return this.__shady_childNodes},get firstChild(){return this.__shady_firstChild},get lastChild(){return this.__shady_lastChild},get childElementCount(){return this.__shady_childElementCount},get children(){return this.__shady_children},get firstElementChild(){return this.__shady_firstElementChild},get lastElementChild(){return this.__shady_lastElementChild},get shadowRoot(){return this.__shady_shadowRoot}}),Ke=Q({get textContent(){return this.__shady_textContent},set textContent(D){this.__shady_textContent=D},get innerHTML(){return this.__shady_innerHTML},set innerHTML(D){return this.__shady_innerHTML=D}}),Qe=Q({get parentElement(){return this.__shady_parentElement},get parentNode(){return this.__shady_parentNode},get nextSibling(){return this.__shady_nextSibling},get previousSibling(){return this.__shady_previousSibling},get nextElementSibling(){return this.__shady_nextElementSibling},get previousElementSibling(){return this.__shady_previousElementSibling},get className(){return this.__shady_className},set className(D){return this.__shady_className=D}});function oc(D){for(var w in D){var N=D[w];N&&(N.enumerable=!1)}}oc(Xe),oc(Ke),oc(Qe);var Ze,Je=Ee.B||!0===Ee.D,$e=Je?function(){}:function(D){var w=B(D);w.Ka||(w.Ka=!0,Gb(D,Qe))},et=Je?function(){}:function(D){var w=B(D);w.Ja||(w.Ja=!0,Gb(D,Xe),window.customElements&&window.customElements.polyfillWrapFlushCallback&&!Ee.D||Gb(D,Ke))},tt="__eventWrappers"+Date.now(),rt=(Ze=Object.getOwnPropertyDescriptor(Event.prototype,"composed"))?function(D){return Ze.get.call(D)}:null,ot=function(){function a(){}var D=!1,w={get capture(){return D=!0,!1}};return window.addEventListener("test",a,w),window.removeEventListener("test",a,w),D}();function vc(D){if(D&&"object"==typeof D)var w=!!D.capture,N=!!D.once,F=!!D.passive,k=D.O;else w=!!D,F=N=!1;return{Ga:k,capture:w,once:N,passive:F,Fa:ot?D:w}}var at={blur:!0,focus:!0,focusin:!0,focusout:!0,click:!0,dblclick:!0,mousedown:!0,mouseenter:!0,mouseleave:!0,mousemove:!0,mouseout:!0,mouseover:!0,mouseup:!0,wheel:!0,beforeinput:!0,input:!0,keydown:!0,keyup:!0,compositionstart:!0,compositionupdate:!0,compositionend:!0,touchstart:!0,touchend:!0,touchmove:!0,touchcancel:!0,pointerover:!0,pointerenter:!0,pointerdown:!0,pointermove:!0,pointerup:!0,pointercancel:!0,pointerout:!0,pointerleave:!0,gotpointercapture:!0,lostpointercapture:!0,dragstart:!0,drag:!0,dragenter:!0,dragleave:!0,dragover:!0,drop:!0,dragend:!0,DOMActivate:!0,DOMFocusIn:!0,DOMFocusOut:!0,keypress:!0},st={DOMAttrModified:!0,DOMAttributeNameChanged:!0,DOMCharacterDataModified:!0,DOMElementNameChanged:!0,DOMNodeInserted:!0,DOMNodeInsertedIntoDocument:!0,DOMNodeRemoved:!0,DOMNodeRemovedFromDocument:!0,DOMSubtreeModified:!0};function yc(D){return D instanceof Node?D.__shady_getRootNode():D}function zc(D,w){var N=[],F=D;for(D=yc(D);F;)N.push(F),F=F.__shady_assignedSlot?F.__shady_assignedSlot:F.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&F.host&&(w||F!==D)?F.host:F.__shady_parentNode;return N[N.length-1]===document&&N.push(window),N}function Bc(D,w){if(!O)return D;D=zc(D,!0);for(var N,F,k=0,j=void 0,z=void 0;k<w.length;k++)if((F=yc(N=w[k]))!==j&&(z=D.indexOf(F),j=F),!O(F)||-1<z)return N}function Cc(D){function b(w,N){return(w=new D(w,N)).__composed=N&&!!N.composed,w}return b.__proto__=D,b.prototype=D.prototype,b}var ut={focus:!0,blur:!0};function Ec(D){return D.__target!==D.target||D.__relatedTarget!==D.relatedTarget}function Fc(D,w,N){if(N=w.__handlers&&w.__handlers[D.type]&&w.__handlers[D.type][N])for(var F,k=0;(F=N[k])&&(!Ec(D)||D.target!==D.relatedTarget)&&(F.call(w,D),!D.__immediatePropagationStopped);k++);}function Gc(D){var w,N=D.composedPath();Object.defineProperty(D,"currentTarget",{get:function(){return k},configurable:!0});for(var F=N.length-1;0<=F;F--){var k=N[F];if(Fc(D,k,"capture"),D.ma)return}for(Object.defineProperty(D,"eventPhase",{get:function(){return Event.AT_TARGET}}),F=0;F<N.length;F++){var j=L(k=N[F]);if(j=j&&j.root,(0===F||j&&j===w)&&(Fc(D,k,"bubble"),k!==window&&(w=k.__shady_getRootNode()),D.ma))break}}function Hc(D,w,N,F,k,j){for(var z=0;z<D.length;z++){var G=D[z],H=G.type,X=G.capture,q=G.once,Z=G.passive;if(w===G.node&&N===H&&F===X&&k===q&&j===Z)return z}return-1}function Ic(D){return Lb(),this.__shady_native_dispatchEvent(D)}function Jc(D,w,N){var F=vc(N),k=F.capture,j=F.once,z=F.passive,G=F.Ga;if(F=F.Fa,w){var H=typeof w;if(("function"===H||"object"===H)&&("object"!==H||w.handleEvent&&"function"==typeof w.handleEvent)){if(st[D])return this.__shady_native_addEventListener(D,w,F);var X=G||this;if(G=w[tt]){if(-1<Hc(G,X,D,k,j,z))return}else w[tt]=[];G=function(F){if(j&&this.__shady_removeEventListener(D,w,N),F.__target||Kc(F),X!==this){var k=Object.getOwnPropertyDescriptor(F,"currentTarget");Object.defineProperty(F,"currentTarget",{get:function(){return X},configurable:!0})}if(F.__previousCurrentTarget=F.currentTarget,(!O(X)&&"slot"!==X.localName||-1!=F.composedPath().indexOf(X))&&(F.composed||-1<F.composedPath().indexOf(X)))if(Ec(F)&&F.target===F.relatedTarget)F.eventPhase===Event.BUBBLING_PHASE&&F.stopImmediatePropagation();else if(F.eventPhase===Event.CAPTURING_PHASE||F.bubbles||F.target===X||X instanceof Window){var z="function"===H?w.call(X,F):w.handleEvent&&w.handleEvent(F);return X!==this&&(k?(Object.defineProperty(F,"currentTarget",k),k=null):delete F.currentTarget),z}},w[tt].push({node:X,type:D,capture:k,once:j,passive:z,lb:G}),ut[D]?(this.__handlers=this.__handlers||{},this.__handlers[D]=this.__handlers[D]||{capture:[],bubble:[]},this.__handlers[D][k?"capture":"bubble"].push(G)):this.__shady_native_addEventListener(D,G,F)}}}function Lc(D,w,N){if(w){var F=vc(N);N=F.capture;var k=F.once,j=F.passive,z=F.Ga;if(F=F.Fa,st[D])return this.__shady_native_removeEventListener(D,w,F);var G=z||this;z=void 0;var H=null;try{H=w[tt]}catch(D){}H&&(-1<(k=Hc(H,G,D,N,k,j))&&(z=H.splice(k,1)[0].lb,H.length||(w[tt]=void 0))),this.__shady_native_removeEventListener(D,z||w,F),z&&ut[D]&&this.__handlers&&this.__handlers[D]&&(-1<(w=(D=this.__handlers[D][N?"capture":"bubble"]).indexOf(z))&&D.splice(w,1))}}var lt=Q({get composed(){return void 0===this.__composed&&(rt?this.__composed="focusin"===this.type||"focusout"===this.type||rt(this):!1!==this.isTrusted&&(this.__composed=at[this.type])),this.__composed||!1},composedPath:function(){return this.__composedPath||(this.__composedPath=zc(this.__target,this.composed)),this.__composedPath},get target(){return Bc(this.currentTarget||this.__previousCurrentTarget,this.composedPath())},get relatedTarget(){return this.__relatedTarget?(this.__relatedTargetComposedPath||(this.__relatedTargetComposedPath=zc(this.__relatedTarget,!0)),Bc(this.currentTarget||this.__previousCurrentTarget,this.__relatedTargetComposedPath)):null},stopPropagation:function(){Event.prototype.stopPropagation.call(this),this.ma=!0},stopImmediatePropagation:function(){Event.prototype.stopImmediatePropagation.call(this),this.ma=this.__immediatePropagationStopped=!0}});function Kc(D){if(D.__target=D.target,D.__relatedTarget=D.relatedTarget,Ee.B){var w=Object.getPrototypeOf(D);if(!w.hasOwnProperty("__shady_patchedProto")){var N=Object.create(w);N.__shady_sourceProto=w,P(N,lt),w.__shady_patchedProto=N}D.__proto__=w.__shady_patchedProto}else P(D,lt)}var ht=Cc(Event),dt=Cc(CustomEvent),ft=Cc(MouseEvent);var pt=Object.getOwnPropertyNames(Element.prototype).filter((function(D){return"on"===D.substring(0,2)})),_t=Object.getOwnPropertyNames(HTMLElement.prototype).filter((function(D){return"on"===D.substring(0,2)}));function Uc(D){return{set:function(w){var N=B(this),F=D.substring(2);N.N||(N.N={}),N.N[D]&&this.removeEventListener(F,N.N[D]),this.__shady_addEventListener(F,w),N.N[D]=w},get:function(){var w=L(this);return w&&w.N&&w.N[D]},configurable:!0}}function Vc(D,w){return{index:D,aa:[],ha:w}}function Wc(D,w,N,F){var k=0,j=0,z=0,G=0,H=Math.min(w-k,F-j);if(0==k&&0==j)e:{for(z=0;z<H;z++)if(D[z]!==N[z])break e;z=H}if(w==D.length&&F==N.length){G=D.length;for(var X=N.length,q=0;q<H-z&&Xc(D[--G],N[--X]);)q++;G=q}if(j+=z,F-=G,0==(w-=G)-(k+=z)&&0==F-j)return[];if(k==w){for(w=Vc(k,0);j<F;)w.aa.push(N[j++]);return[w]}if(j==F)return[Vc(k,w-k)];for(F=F-(z=j)+1,G=w-(H=k)+1,w=Array(F),X=0;X<F;X++)w[X]=Array(G),w[X][0]=X;for(X=0;X<G;X++)w[0][X]=X;for(X=1;X<F;X++)for(q=1;q<G;q++)if(D[H+q-1]===N[z+X-1])w[X][q]=w[X-1][q-1];else{var Z=w[X-1][q]+1,J=w[X][q-1]+1;w[X][q]=Z<J?Z:J}for(H=w.length-1,z=w[0].length-1,F=w[H][z],D=[];0<H||0<z;)0==H?(D.push(2),z--):0==z?(D.push(3),H--):(G=w[H-1][z-1],(Z=(X=w[H-1][z])<(q=w[H][z-1])?X<G?X:G:q<G?q:G)==G?(G==F?D.push(0):(D.push(1),F=G),H--,z--):Z==X?(D.push(3),H--,F=X):(D.push(2),z--,F=q));for(D.reverse(),w=void 0,H=[],z=0;z<D.length;z++)switch(D[z]){case 0:w&&(H.push(w),w=void 0),k++,j++;break;case 1:w||(w=Vc(k,0)),w.ha++,k++,w.aa.push(N[j]),j++;break;case 2:w||(w=Vc(k,0)),w.ha++,k++;break;case 3:w||(w=Vc(k,0)),w.aa.push(N[j]),j++}return w&&H.push(w),H}function Xc(D,w){return D===w}var mt=Q({dispatchEvent:Ic,addEventListener:Jc,removeEventListener:Lc}),gt=null;function $c(){return gt||(gt=window.ShadyCSS&&window.ShadyCSS.ScopingShim),gt||null}function ad(D,w,N){var F=$c();return!(!F||"class"!==w)&&(F.setElementClass(D,N),!0)}function bd(D,w){var N=$c();N&&N.unscopeNode(D,w)}function dd(D){if(D.nodeType!==Node.ELEMENT_NODE)return"";var w=$c();return w?w.currentScopeForNode(D):""}function ed(D,w){if(D)for(D.nodeType===Node.ELEMENT_NODE&&w(D),D=D.__shady_firstChild;D;D=D.__shady_nextSibling)D.nodeType===Node.ELEMENT_NODE&&ed(D,w)}var vt=window.document,yt=Ee.la,bt=Object.getOwnPropertyDescriptor(Node.prototype,"isConnected"),Tt=bt&&bt.get;function jd(D){for(var w;w=D.__shady_firstChild;)D.__shady_removeChild(w)}function md(D,w,N){if(D=(D=L(D))&&D.Z){if(w)if(w.nodeType===Node.DOCUMENT_FRAGMENT_NODE)for(var F=0,k=w.childNodes.length;F<k;F++)D.addedNodes.push(w.childNodes[F]);else D.addedNodes.push(w);N&&D.removedNodes.push(N),function Nb(D){D.a||(D.a=!0,zb((function(){D.flush()})))}(D)}}var Et=Q({get parentNode(){var D=L(this);return void 0!==(D=D&&D.parentNode)?D:this.__shady_native_parentNode},get firstChild(){var D=L(this);return void 0!==(D=D&&D.firstChild)?D:this.__shady_native_firstChild},get lastChild(){var D=L(this);return void 0!==(D=D&&D.lastChild)?D:this.__shady_native_lastChild},get nextSibling(){var D=L(this);return void 0!==(D=D&&D.nextSibling)?D:this.__shady_native_nextSibling},get previousSibling(){var D=L(this);return void 0!==(D=D&&D.previousSibling)?D:this.__shady_native_previousSibling},get childNodes(){if(rb(this)){var D=L(this);if(!D.childNodes){D.childNodes=[];for(var w=this.__shady_firstChild;w;w=w.__shady_nextSibling)D.childNodes.push(w)}var N=D.childNodes}else N=this.__shady_native_childNodes;return N.item=function(D){return N[D]},N},get parentElement(){var D=L(this);return(D=D&&D.parentNode)&&D.nodeType!==Node.ELEMENT_NODE&&(D=null),void 0!==D?D:this.__shady_native_parentElement},get isConnected(){if(Tt&&Tt.call(this))return!0;if(this.nodeType==Node.DOCUMENT_FRAGMENT_NODE)return!1;var D=this.ownerDocument;if(Re){if(D.__shady_native_contains(this))return!0}else if(D.documentElement&&D.documentElement.__shady_native_contains(this))return!0;for(D=this;D&&!(D instanceof Document);)D=D.__shady_parentNode||(O(D)?D.host:void 0);return!!(D&&D instanceof Document)},get textContent(){if(rb(this)){for(var D=[],w=this.__shady_firstChild;w;w=w.__shady_nextSibling)w.nodeType!==Node.COMMENT_NODE&&D.push(w.__shady_textContent);return D.join("")}return this.__shady_native_textContent},set textContent(D){switch(null==D&&(D=""),this.nodeType){case Node.ELEMENT_NODE:case Node.DOCUMENT_FRAGMENT_NODE:if(!rb(this)&&Ee.B){var w=this.__shady_firstChild;(w!=this.__shady_lastChild||w&&w.nodeType!=Node.TEXT_NODE)&&jd(this),this.__shady_native_textContent=D}else jd(this),(0<D.length||this.nodeType===Node.ELEMENT_NODE)&&this.__shady_insertBefore(document.createTextNode(D));break;default:this.nodeValue=D}},insertBefore:function(D,w){if(this.ownerDocument!==vt&&D.ownerDocument!==vt)return this.__shady_native_insertBefore(D,w),D;if(D===this)throw Error("Failed to execute 'appendChild' on 'Node': The new child element contains the parent.");if(w){var N=L(w);if(void 0!==(N=N&&N.parentNode)&&N!==this||void 0===N&&w.__shady_native_parentNode!==this)throw Error("Failed to execute 'insertBefore' on 'Node': The node before which the new node is to be inserted is not a child of this node.")}if(w===D)return D;md(this,D);var F=[],k=(N=nd(this))?N.host.localName:dd(this),j=D.__shady_parentNode;if(j){var z=dd(D),G=!!N||!nd(D)||yt&&void 0!==this.__noInsertionPoint;j.__shady_removeChild(D,G)}j=!0;var H=(!yt||void 0===D.__noInsertionPoint&&void 0===this.__noInsertionPoint)&&!function cd(D,w){var N=$c();if(!N)return!0;if(D.nodeType===Node.DOCUMENT_FRAGMENT_NODE){for(N=!0,D=D.__shady_firstChild;D;D=D.__shady_nextSibling)N=N&&cd(D,w);return N}return D.nodeType!==Node.ELEMENT_NODE||N.currentScopeForNode(D)===w}(D,k),X=N&&!D.__noInsertionPoint&&(!yt||D.nodeType===Node.DOCUMENT_FRAGMENT_NODE);return(X||H)&&(H&&(z=z||dd(D)),ed(D,(function(D){if(X&&"slot"===D.localName&&F.push(D),H){var w=z;$c()&&(w&&bd(D,w),(w=$c())&&w.scopeNode(D,k))}}))),F.length&&(od(N),N.c.push.apply(N.c,F instanceof Array?F:da(ca(F))),pd(N)),rb(this)&&(function qd(D,w,N){de(w,2);var F=B(w);if(void 0!==F.firstChild&&(F.childNodes=null),D.nodeType===Node.DOCUMENT_FRAGMENT_NODE)for(D=D.__shady_native_firstChild;D;D=D.__shady_native_nextSibling)ee(D,w,F,N);else ee(D,w,F,N)}(D,this,w),(G=L(this)).root?(j=!1,sb(this)&&pd(G.root)):N&&"slot"===this.localName&&(j=!1,pd(N))),j?(N=O(this)?this.host:this,w?(w=function ld(D){var w=D;if(D&&"slot"===D.localName){var N=L(D);(N=N&&N.V)&&(w=N.length?N[0]:ld(D.__shady_nextSibling))}return w}(w),N.__shady_native_insertBefore(D,w)):N.__shady_native_appendChild(D)):D.ownerDocument!==this.ownerDocument&&this.ownerDocument.adoptNode(D),D},appendChild:function(D){if(this!=D||!O(D))return this.__shady_insertBefore(D)},removeChild:function(D,w){if(w=void 0!==w&&w,this.ownerDocument!==vt)return this.__shady_native_removeChild(D);if(D.__shady_parentNode!==this)throw Error("The node to be removed is not a child of this node: "+D);md(this,null,D);var N=nd(D),F=N&&function rd(D,w){if(D.a){Ed(D);var N,F=D.b;for(N in F)for(var k=F[N],j=0;j<k.length;j++){var z=k[j];if(Bb(w,z)){k.splice(j,1);var G=D.a.indexOf(z);if(0<=G&&(D.a.splice(G,1),(G=L(z.__shady_parentNode))&&G.ca&&G.ca--),j--,z=L(z),G=z.V)for(var H=0;H<G.length;H++){var X=G[H],q=X.__shady_native_parentNode;q&&q.__shady_native_removeChild(X)}z.V=[],z.assignedNodes=[],G=!0}}return G}}(N,D),k=L(this);if(rb(this)&&(function sd(D,w){var N=B(D);w=B(w),D===w.firstChild&&(w.firstChild=N.nextSibling),D===w.lastChild&&(w.lastChild=N.previousSibling),D=N.previousSibling;var F=N.nextSibling;D&&(B(D).nextSibling=F),F&&(B(F).previousSibling=D),N.parentNode=N.previousSibling=N.nextSibling=void 0,void 0!==w.childNodes&&(w.childNodes=null)}(D,this),sb(this))){pd(k.root);var j=!0}if($c()&&!w&&N&&D.nodeType!==Node.TEXT_NODE){var z=dd(D);ed(D,(function(D){bd(D,z)}))}return function kd(D){var w=L(D);if(w&&void 0!==w.ka)for(w=D.__shady_firstChild;w;w=w.__shady_nextSibling)kd(w);(D=L(D))&&(D.ka=void 0)}(D),N&&((w="slot"===this.localName)&&(j=!0),(F||w)&&pd(N)),j||(j=O(this)?this.host:this,(!k.root&&"slot"!==D.localName||j===D.__shady_native_parentNode)&&j.__shady_native_removeChild(D)),D},replaceChild:function(D,w){return this.__shady_insertBefore(D,w),this.__shady_removeChild(w),D},cloneNode:function(D){if("template"==this.localName)return this.__shady_native_cloneNode(D);var w=this.__shady_native_cloneNode(!1);if(D&&w.nodeType!==Node.ATTRIBUTE_NODE){D=this.__shady_firstChild;for(var N;D;D=D.__shady_nextSibling)N=D.__shady_cloneNode(!0),w.__shady_appendChild(N)}return w},getRootNode:function(D){if(this&&this.nodeType){var w=B(this),N=w.ka;return void 0===N&&(O(this)?(N=this,w.ka=N):(N=(N=this.__shady_parentNode)?N.__shady_getRootNode(D):this,document.documentElement.__shady_native_contains(this)&&(w.ka=N))),N}},contains:function(D){return Bb(this,D)}}),St=Q({get assignedSlot(){var D=this.__shady_parentNode;return(D=D&&D.__shady_shadowRoot)&&vd(D),(D=L(this))&&D.assignedSlot||null}});function xd(D,w,N){var F=[];return function yd(D,w,N,F){for(D=D.__shady_firstChild;D;D=D.__shady_nextSibling){var k;if(k=D.nodeType===Node.ELEMENT_NODE){var j=w,z=N,G=F,H=j(k=D);H&&G.push(k),z&&z(H)?k=H:(yd(k,j,z,G),k=void 0)}if(k)break}}(D,w,N,F),F}var Mt=Q({get firstElementChild(){var D=L(this);if(D&&void 0!==D.firstChild){for(D=this.__shady_firstChild;D&&D.nodeType!==Node.ELEMENT_NODE;)D=D.__shady_nextSibling;return D}return this.__shady_native_firstElementChild},get lastElementChild(){var D=L(this);if(D&&void 0!==D.lastChild){for(D=this.__shady_lastChild;D&&D.nodeType!==Node.ELEMENT_NODE;)D=D.__shady_previousSibling;return D}return this.__shady_native_lastElementChild},get children(){return rb(this)?Cb(Array.prototype.filter.call(Eb(this),(function(D){return D.nodeType===Node.ELEMENT_NODE}))):this.__shady_native_children},get childElementCount(){var D=this.__shady_children;return D?D.length:0}}),xt=Q({querySelector:function(D){return xd(this,(function(w){return xe.call(w,D)}),(function(D){return!!D}))[0]||null},querySelectorAll:function(D,w){if(w){w=Array.prototype.slice.call(this.__shady_native_querySelectorAll(D));var N=this.__shady_getRootNode();return Cb(w.filter((function(D){return D.__shady_getRootNode()==N})))}return Cb(xd(this,(function(w){return xe.call(w,D)})))}}),At=Ee.la&&!Ee.D?Hb({},Mt):Mt;Hb(Mt,xt);var Pt=window.document;function Dd(D,w){if("slot"===w)sb(D=D.__shady_parentNode)&&pd(L(D).root);else if("slot"===D.localName&&"name"===w&&(w=nd(D))){if(w.a){Ed(w);var N=D.La,F=Fd(D);if(F!==N){var k=(N=w.b[N]).indexOf(D);0<=k&&N.splice(k,1),(N=w.b[F]||(w.b[F]=[])).push(D),1<N.length&&(w.b[F]=Gd(N))}}pd(w)}}var Ct=Q({get previousElementSibling(){var D=L(this);if(D&&void 0!==D.previousSibling){for(D=this.__shady_previousSibling;D&&D.nodeType!==Node.ELEMENT_NODE;)D=D.__shady_previousSibling;return D}return this.__shady_native_previousElementSibling},get nextElementSibling(){var D=L(this);if(D&&void 0!==D.nextSibling){for(D=this.__shady_nextSibling;D&&D.nodeType!==Node.ELEMENT_NODE;)D=D.__shady_nextSibling;return D}return this.__shady_native_nextElementSibling},get slot(){return this.getAttribute("slot")},set slot(D){this.__shady_setAttribute("slot",D)},get className(){return this.getAttribute("class")||""},set className(D){this.__shady_setAttribute("class",D)},setAttribute:function(D,w){this.ownerDocument!==Pt?this.__shady_native_setAttribute(D,w):ad(this,D,w)||(this.__shady_native_setAttribute(D,w),Dd(this,D))},removeAttribute:function(D){this.ownerDocument!==Pt?this.__shady_native_removeAttribute(D):ad(this,D,"")?""===this.getAttribute(D)&&this.__shady_native_removeAttribute(D):(this.__shady_native_removeAttribute(D),Dd(this,D))}});Ee.la||pt.forEach((function(D){Ct[D]=Uc(D)}));var Ot=Q({attachShadow:function(D){if(!this)throw Error("Must provide a host.");if(!D)throw Error("Not enough arguments.");if(D.shadyUpgradeFragment&&!Ee.Ia){var w=D.shadyUpgradeFragment;if(w.__proto__=ShadowRoot.prototype,Id(w,this,D),Jd(w,w),D=w.__noInsertionPoint?null:w.querySelectorAll("slot"),w.__noInsertionPoint=void 0,D&&D.length){var N=w;od(N),N.c.push.apply(N.c,D instanceof Array?D:da(ca(D))),pd(w)}w.host.__shady_native_appendChild(w)}else w=new Kd(Wt,this,D);return this.__CE_shadowRoot=w},get shadowRoot(){var D=L(this);return D&&D.bb||null}});Hb(Ct,Ot);var Rt=document.implementation.createHTMLDocument("inert"),Dt=Q({get innerHTML(){return rb(this)?Zb("template"===this.localName?this.content:this,Eb):this.__shady_native_innerHTML},set innerHTML(D){if("template"===this.localName)this.__shady_native_innerHTML=D;else{jd(this);var w=this.localName||"div";for(w=this.namespaceURI&&this.namespaceURI!==Rt.namespaceURI?Rt.createElementNS(this.namespaceURI,w):Rt.createElement(w),Ee.B?w.__shady_native_innerHTML=D:w.innerHTML=D;D=w.__shady_firstChild;)this.__shady_insertBefore(D)}}}),It=Q({blur:function(){var D=L(this);(D=(D=D&&D.root)&&D.activeElement)?D.__shady_blur():this.__shady_native_blur()}});Ee.la||_t.forEach((function(D){It[D]=Uc(D)}));var Lt=Q({assignedNodes:function(D){if("slot"===this.localName){var w=this.__shady_getRootNode();return w&&O(w)&&vd(w),(w=L(this))&&(D&&D.flatten?w.V:w.assignedNodes)||[]}},addEventListener:function(D,w,N){if("slot"!==this.localName||"slotchange"===D)Jc.call(this,D,w,N);else{"object"!=typeof N&&(N={capture:!!N});var F=this.__shady_parentNode;if(!F)throw Error("ShadyDOM cannot attach event to slot unless it has a `parentNode`");N.O=this,F.__shady_addEventListener(D,w,N)}},removeEventListener:function(D,w,N){if("slot"!==this.localName||"slotchange"===D)Lc.call(this,D,w,N);else{"object"!=typeof N&&(N={capture:!!N});var F=this.__shady_parentNode;if(!F)throw Error("ShadyDOM cannot attach event to slot unless it has a `parentNode`");N.O=this,F.__shady_removeEventListener(D,w,N)}}}),wt=Q({getElementById:function(D){return""===D?null:xd(this,(function(w){return w.id==D}),(function(D){return!!D}))[0]||null}}),Nt=Q({get activeElement(){var D=Ee.B?document.__shady_native_activeElement:document.activeElement;if(!D||!D.nodeType)return null;var w=!!O(this);if(!(this===document||w&&this.host!==D&&this.host.__shady_native_contains(D)))return null;for(w=nd(D);w&&w!==this;)w=nd(D=w.host);return this===document?w?null:D:w===this?D:null}}),Ft=window.document,Bt=Q({importNode:function(D,w){if(D.ownerDocument!==Ft||"template"===D.localName)return this.__shady_native_importNode(D,w);var N=this.__shady_native_importNode(D,!1);if(w)for(D=D.__shady_firstChild;D;D=D.__shady_nextSibling)w=this.__shady_importNode(D,!0),N.__shady_appendChild(w);return N}}),kt=Q({dispatchEvent:Ic,addEventListener:Jc.bind(window),removeEventListener:Lc.bind(window)}),Ut={};Object.getOwnPropertyDescriptor(HTMLElement.prototype,"parentElement")&&(Ut.parentElement=Et.parentElement),Object.getOwnPropertyDescriptor(HTMLElement.prototype,"contains")&&(Ut.contains=Et.contains),Object.getOwnPropertyDescriptor(HTMLElement.prototype,"children")&&(Ut.children=Mt.children),Object.getOwnPropertyDescriptor(HTMLElement.prototype,"innerHTML")&&(Ut.innerHTML=Dt.innerHTML),Object.getOwnPropertyDescriptor(HTMLElement.prototype,"className")&&(Ut.className=Ct.className);var Vt={EventTarget:[mt],Node:[Et,window.EventTarget?null:mt],Text:[St],Comment:[St],CDATASection:[St],ProcessingInstruction:[St],Element:[Ct,Mt,St,!Ee.B||"innerHTML"in Element.prototype?Dt:null,window.HTMLSlotElement?null:Lt],HTMLElement:[It,Ut],HTMLSlotElement:[Lt],DocumentFragment:[At,wt],Document:[Bt,At,wt,Nt],Window:[kt]},jt=Ee.B?null:["innerHTML","textContent"];function Zd(D,w,N,F){w.forEach((function(w){return D&&w&&P(D,w,N,F)}))}function $d(D){var w,N=D?null:jt;for(w in Vt)Zd(window[w]&&window[w].prototype,Vt[w],D,N)}function ae(D){return D.__shady_protoIsPatched=!0,Zd(D,Vt.EventTarget),Zd(D,Vt.Node),Zd(D,Vt.Element),Zd(D,Vt.HTMLElement),Zd(D,Vt.HTMLSlotElement),D}["Text","Comment","CDATASection","ProcessingInstruction"].forEach((function(D){var w=window[D],N=Object.create(w.prototype);N.__shady_protoIsPatched=!0,Zd(N,Vt.EventTarget),Zd(N,Vt.Node),Vt[D]&&Zd(N,Vt[D]),w.prototype.__shady_patchedProto=N}));var zt=Ee.ua,Gt=Ee.B;function de(D,w){if(zt&&!D.__shady_protoIsPatched&&!O(D)){var N=Object.getPrototypeOf(D),F=N.hasOwnProperty("__shady_patchedProto")&&N.__shady_patchedProto;F||(ae(F=Object.create(N)),N.__shady_patchedProto=F),Object.setPrototypeOf(D,F)}Gt||(1===w?$e(D):2===w&&et(D))}function ee(D,w,N,F){de(D,1),F=F||null;var k=B(D),j=F?B(F):null;k.previousSibling=F?j.previousSibling:w.__shady_lastChild,(j=L(k.previousSibling))&&(j.nextSibling=D),(j=L(k.nextSibling=F))&&(j.previousSibling=D),k.parentNode=w,F?F===N.firstChild&&(N.firstChild=D):(N.lastChild=D,N.firstChild||(N.firstChild=D)),N.childNodes=null}function Jd(D,w){var N=B(D);if(w||void 0===N.firstChild){N.childNodes=null;var F=N.firstChild=D.__shady_native_firstChild;for(N.lastChild=D.__shady_native_lastChild,de(D,2),N=F,F=void 0;N;N=N.__shady_native_nextSibling){var k=B(N);k.parentNode=w||D,k.nextSibling=N.__shady_native_nextSibling,k.previousSibling=F||null,F=N,de(N,1)}}}var Yt=Q({addEventListener:function(D,w,N){"object"!=typeof N&&(N={capture:!!N}),N.O=N.O||this,this.host.__shady_addEventListener(D,w,N)},removeEventListener:function(D,w,N){"object"!=typeof N&&(N={capture:!!N}),N.O=N.O||this,this.host.__shady_removeEventListener(D,w,N)}});function ge(D,w){P(D,Yt,w),P(D,Nt,w),P(D,Dt,w),P(D,Mt,w),Ee.D&&!w?(P(D,Et,w),P(D,wt,w)):Ee.B||(P(D,Qe),P(D,Xe),P(D,Ke))}var Ht,Wt={},Xt=Ee.deferConnectionCallbacks&&"loading"===document.readyState;function je(D){var w=[];do{w.unshift(D)}while(D=D.__shady_parentNode);return w}function Kd(D,w,N){if(D!==Wt)throw new TypeError("Illegal constructor");this.a=null,Id(this,w,N)}function Id(D,w,N){if(D.host=w,D.mode=N&&N.mode,Jd(D.host),(w=B(D.host)).root=D,w.bb="closed"!==D.mode?D:null,(w=B(D)).firstChild=w.lastChild=w.parentNode=w.nextSibling=w.previousSibling=null,Ee.preferPerformance)for(;w=D.host.__shady_native_firstChild;)D.host.__shady_native_removeChild(w);else pd(D)}function pd(D){D.T||(D.T=!0,Kb((function(){return vd(D)})))}function vd(D){var w;if(w=D.T){for(var N;D;)D.T&&(N=D),O(D=(w=D).host.__shady_getRootNode())&&(w=L(w.host))&&0<w.ca||(D=void 0);w=N}(N=w)&&N._renderSelf()}function ke(D,w,N){var F=B(w),k=F.oa;F.oa=null,N||(N=(D=D.b[w.__shady_slot||"__catchall"])&&D[0]),N?(B(N).assignedNodes.push(w),F.assignedSlot=N):F.assignedSlot=void 0,k!==F.assignedSlot&&F.assignedSlot&&(B(F.assignedSlot).ra=!0)}function le(D,w,N){for(var F=0,k=void 0;F<N.length&&(k=N[F]);F++)if("slot"==k.localName){var j=L(k).assignedNodes;j&&j.length&&le(D,w,j)}else w.push(N[F])}function me(D,w){w.__shady_native_dispatchEvent(new Event("slotchange")),(w=L(w)).assignedSlot&&me(D,w.assignedSlot)}function od(D){D.c=D.c||[],D.a=D.a||[],D.b=D.b||{}}function Ed(D){if(D.c&&D.c.length){for(var w,N=D.c,F=0;F<N.length;F++){var k=N[F];Jd(k);var j=k.__shady_parentNode;Jd(j),(j=L(j)).ca=(j.ca||0)+1,j=Fd(k),D.b[j]?((w=w||{})[j]=!0,D.b[j].push(k)):D.b[j]=[k],D.a.push(k)}if(w)for(var z in w)D.b[z]=Gd(D.b[z]);D.c=[]}}function Fd(D){var w=D.name||D.getAttribute("name")||"__catchall";return D.La=w}function Gd(D){return D.sort((function(D,w){D=je(D);for(var N=je(w),F=0;F<D.length;F++){w=D[F];var k=N[F];if(w!==k)return(D=Eb(w.__shady_parentNode)).indexOf(w)-D.indexOf(k)}}))}function tb(D){return Ed(D),!(!D.a||!D.a.length)}if(Kd.prototype._renderSelf=function(){var D=Xt;if(Xt=!0,this.T=!1,this.a){Ed(this);for(var w,N=0;N<this.a.length;N++){var F=L(w=this.a[N]),k=F.assignedNodes;if(F.assignedNodes=[],F.V=[],F.Ba=k)for(F=0;F<k.length;F++){var j=L(k[F]);j.oa=j.assignedSlot,j.assignedSlot===w&&(j.assignedSlot=null)}}for(N=this.host.__shady_firstChild;N;N=N.__shady_nextSibling)ke(this,N);for(N=0;N<this.a.length;N++){if(!(k=L(w=this.a[N])).assignedNodes.length)for(F=w.__shady_firstChild;F;F=F.__shady_nextSibling)ke(this,F,w);if((F=(F=L(w.__shady_parentNode))&&F.root)&&(tb(F)||F.T)&&F._renderSelf(),le(this,k.V,k.assignedNodes),F=k.Ba){for(j=0;j<F.length;j++)L(F[j]).oa=null;k.Ba=null,F.length>k.assignedNodes.length&&(k.ra=!0)}k.ra&&(k.ra=!1,me(this,w))}for(w=this.a,N=[],k=0;k<w.length;k++)(j=L(F=w[k].__shady_parentNode))&&j.root||!(0>N.indexOf(F))||N.push(F);for(w=0;w<N.length;w++){for(k=(j=N[w])===this?this.host:j,F=[],j=j.__shady_firstChild;j;j=j.__shady_nextSibling)if("slot"==j.localName)for(var z=L(j).V,G=0;G<z.length;G++)F.push(z[G]);else F.push(j);j=Db(k),z=Wc(F,F.length,j,j.length);for(var H=G=0,X=void 0;G<z.length&&(X=z[G]);G++){for(var q=0,Z=void 0;q<X.aa.length&&(Z=X.aa[q]);q++)Z.__shady_native_parentNode===k&&k.__shady_native_removeChild(Z),j.splice(X.index+H,1);H-=X.ha}for(H=0,X=void 0;H<z.length&&(X=z[H]);H++)for(G=j[X.index],q=X.index;q<X.index+X.ha;q++)Z=F[q],k.__shady_native_insertBefore(Z,G),j.splice(q,0,Z)}}if(!Ee.preferPerformance&&!this.Aa)for(N=this.host.__shady_firstChild;N;N=N.__shady_nextSibling)w=L(N),N.__shady_native_parentNode!==this.host||"slot"!==N.localName&&w.assignedSlot||this.host.__shady_native_removeChild(N);this.Aa=!0,Xt=D,Ht&&Ht()},function(D){D.__proto__=DocumentFragment.prototype,ge(D,"__shady_"),ge(D),Object.defineProperties(D,{nodeType:{value:Node.DOCUMENT_FRAGMENT_NODE,configurable:!0},nodeName:{value:"#document-fragment",configurable:!0},nodeValue:{value:null,configurable:!0}}),["localName","namespaceURI","prefix"].forEach((function(w){Object.defineProperty(D,w,{value:void 0,configurable:!0})})),["ownerDocument","baseURI","isConnected"].forEach((function(w){Object.defineProperty(D,w,{get:function(){return this.host[w]},configurable:!0})}))}(Kd.prototype),window.customElements&&window.customElements.define&&Ee.sa&&!Ee.preferPerformance){var Kt=new Map;Ht=function(){var D=[];Kt.forEach((function(w,N){D.push([N,w])})),Kt.clear();for(var w=0;w<D.length;w++){var N=D[w][0];D[w][1]?N.__shadydom_connectedCallback():N.__shadydom_disconnectedCallback()}},Xt&&document.addEventListener("readystatechange",(function(){Xt=!1,Ht()}),{once:!0});var Qt=window.customElements.define,qe=function(D,w){var N=w.prototype.connectedCallback,F=w.prototype.disconnectedCallback;Qt.call(window.customElements,D,function(D,w,N){var F=0,k="__isConnected"+F++;return(w||N)&&(D.prototype.connectedCallback=D.prototype.__shadydom_connectedCallback=function(){Xt?Kt.set(this,!0):this[k]||(this[k]=!0,w&&w.call(this))},D.prototype.disconnectedCallback=D.prototype.__shadydom_disconnectedCallback=function(){Xt?this.isConnected||Kt.set(this,!1):this[k]&&(this[k]=!1,N&&N.call(this))}),D}(w,N,F)),w.prototype.connectedCallback=N,w.prototype.disconnectedCallback=F};window.customElements.define=qe,Object.defineProperty(window.CustomElementRegistry.prototype,"define",{value:qe,configurable:!0})}function nd(D){if(O(D=D.__shady_getRootNode()))return D}function re(D){this.node=D}function se(D){Object.defineProperty(re.prototype,D,{get:function(){return this.node["__shady_"+D]},set:function(w){this.node["__shady_"+D]=w},configurable:!0})}(N=re.prototype).addEventListener=function(D,w,N){return this.node.__shady_addEventListener(D,w,N)},N.removeEventListener=function(D,w,N){return this.node.__shady_removeEventListener(D,w,N)},N.appendChild=function(D){return this.node.__shady_appendChild(D)},N.insertBefore=function(D,w){return this.node.__shady_insertBefore(D,w)},N.removeChild=function(D){return this.node.__shady_removeChild(D)},N.replaceChild=function(D,w){return this.node.__shady_replaceChild(D,w)},N.cloneNode=function(D){return this.node.__shady_cloneNode(D)},N.getRootNode=function(D){return this.node.__shady_getRootNode(D)},N.contains=function(D){return this.node.__shady_contains(D)},N.dispatchEvent=function(D){return this.node.__shady_dispatchEvent(D)},N.setAttribute=function(D,w){this.node.__shady_setAttribute(D,w)},N.getAttribute=function(D){return this.node.__shady_native_getAttribute(D)},N.hasAttribute=function(D){return this.node.__shady_native_hasAttribute(D)},N.removeAttribute=function(D){this.node.__shady_removeAttribute(D)},N.attachShadow=function(D){return this.node.__shady_attachShadow(D)},N.focus=function(){this.node.__shady_native_focus()},N.blur=function(){this.node.__shady_blur()},N.importNode=function(D,w){if(this.node.nodeType===Node.DOCUMENT_NODE)return this.node.__shady_importNode(D,w)},N.getElementById=function(D){if(this.node.nodeType===Node.DOCUMENT_NODE)return this.node.__shady_getElementById(D)},N.querySelector=function(D){return this.node.__shady_querySelector(D)},N.querySelectorAll=function(D,w){return this.node.__shady_querySelectorAll(D,w)},N.assignedNodes=function(D){if("slot"===this.node.localName)return this.node.__shady_assignedNodes(D)},F.Object.defineProperties(re.prototype,{activeElement:{configurable:!0,enumerable:!0,get:function(){if(O(this.node)||this.node.nodeType===Node.DOCUMENT_NODE)return this.node.__shady_activeElement}},_activeElement:{configurable:!0,enumerable:!0,get:function(){return this.activeElement}},host:{configurable:!0,enumerable:!0,get:function(){if(O(this.node))return this.node.host}},parentNode:{configurable:!0,enumerable:!0,get:function(){return this.node.__shady_parentNode}},firstChild:{configurable:!0,enumerable:!0,get:function(){return this.node.__shady_firstChild}},lastChild:{configurable:!0,enumerable:!0,get:function(){return this.node.__shady_lastChild}},nextSibling:{configurable:!0,enumerable:!0,get:function(){return this.node.__shady_nextSibling}},previousSibling:{configurable:!0,enumerable:!0,get:function(){return this.node.__shady_previousSibling}},childNodes:{configurable:!0,enumerable:!0,get:function(){return this.node.__shady_childNodes}},parentElement:{configurable:!0,enumerable:!0,get:function(){return this.node.__shady_parentElement}},firstElementChild:{configurable:!0,enumerable:!0,get:function(){return this.node.__shady_firstElementChild}},lastElementChild:{configurable:!0,enumerable:!0,get:function(){return this.node.__shady_lastElementChild}},nextElementSibling:{configurable:!0,enumerable:!0,get:function(){return this.node.__shady_nextElementSibling}},previousElementSibling:{configurable:!0,enumerable:!0,get:function(){return this.node.__shady_previousElementSibling}},children:{configurable:!0,enumerable:!0,get:function(){return this.node.__shady_children}},childElementCount:{configurable:!0,enumerable:!0,get:function(){return this.node.__shady_childElementCount}},shadowRoot:{configurable:!0,enumerable:!0,get:function(){return this.node.__shady_shadowRoot}},assignedSlot:{configurable:!0,enumerable:!0,get:function(){return this.node.__shady_assignedSlot}},isConnected:{configurable:!0,enumerable:!0,get:function(){return this.node.__shady_isConnected}},innerHTML:{configurable:!0,enumerable:!0,get:function(){return this.node.__shady_innerHTML},set:function(D){this.node.__shady_innerHTML=D}},textContent:{configurable:!0,enumerable:!0,get:function(){return this.node.__shady_textContent},set:function(D){this.node.__shady_textContent=D}},slot:{configurable:!0,enumerable:!0,get:function(){return this.node.__shady_slot},set:function(D){this.node.__shady_slot=D}},className:{configurable:!0,enumerable:!0,get:function(){return this.node.__shady_className},set:function(D){return this.node.__shady_className=D}}}),pt.forEach((function(D){return se(D)})),_t.forEach((function(D){return se(D)}));var qt=new WeakMap;function ue(D){if(O(D)||D instanceof re)return D;var w=qt.get(D);return w||(w=new re(D),qt.set(D,w)),w}if(Ee.sa){var Zt=Ee.B?function(D){return D}:function(D){return et(D),$e(D),D},Jt={inUse:Ee.sa,patch:Zt,isShadyRoot:O,enqueue:Kb,flush:Lb,flushInitial:function(D){!D.Aa&&D.T&&vd(D)},settings:Ee,filterMutations:function Qb(D,w){var N=w.getRootNode();return D.map((function(D){var w=N===D.target.getRootNode();if(w&&D.addedNodes){if((w=[].slice.call(D.addedNodes).filter((function(D){return N===D.getRootNode()}))).length)return D=Object.create(D),Object.defineProperty(D,"addedNodes",{value:w,configurable:!0}),D}else if(w)return D})).filter((function(D){return D}))},observeChildren:function Ob(D,w){var N=B(D);N.Z||(N.Z=new Mb),N.Z.ia.add(w);var F=N.Z;return{Ma:w,S:F,Na:D,takeRecords:function(){return F.takeRecords()}}},unobserveChildren:function Pb(D){var w=D&&D.S;w&&(w.ia.delete(D.Ma),w.ia.size||(B(D.Na).Z=null))},deferConnectionCallbacks:Ee.deferConnectionCallbacks,preferPerformance:Ee.preferPerformance,handlesDynamicScoping:!0,wrap:Ee.D?ue:Zt,wrapIfNeeded:!0===Ee.D?ue:function(D){return D},Wrapper:re,composedPath:function Ac(D){return D.__composedPath||(D.__composedPath=zc(D.target,!0)),D.__composedPath},noPatch:Ee.D,patchOnDemand:Ee.ua,nativeMethods:Ue,nativeTree:Ve,patchElementProto:ae};window.ShadyDOM=Jt,function kc(){var D=["dispatchEvent","addEventListener","removeEventListener"];window.EventTarget?S(window.EventTarget.prototype,D):(S(Node.prototype,D),S(Window.prototype,D)),Be?S(Node.prototype,"parentNode firstChild lastChild previousSibling nextSibling childNodes parentElement textContent".split(" ")):dc(Node.prototype,{parentNode:{get:function(){return ze.currentNode=this,ze.parentNode()}},firstChild:{get:function(){return ze.currentNode=this,ze.firstChild()}},lastChild:{get:function(){return ze.currentNode=this,ze.lastChild()}},previousSibling:{get:function(){return ze.currentNode=this,ze.previousSibling()}},nextSibling:{get:function(){return ze.currentNode=this,ze.nextSibling()}},childNodes:{get:function(){var D=[];ze.currentNode=this;for(var w=ze.firstChild();w;)D.push(w),w=ze.nextSibling();return D}},parentElement:{get:function(){return Ge.currentNode=this,Ge.parentNode()}},textContent:{get:function(){switch(this.nodeType){case Node.ELEMENT_NODE:case Node.DOCUMENT_FRAGMENT_NODE:for(var D,w=document.createTreeWalker(this,NodeFilter.SHOW_TEXT,null,!1),N="";D=w.nextNode();)N+=D.nodeValue;return N;default:return this.nodeValue}},set:function(D){switch(null==D&&(D=""),this.nodeType){case Node.ELEMENT_NODE:case Node.DOCUMENT_FRAGMENT_NODE:hc(this),(0<D.length||this.nodeType===Node.ELEMENT_NODE)&&this.__shady_native_insertBefore(document.createTextNode(D),void 0);break;default:this.nodeValue=D}}}}),S(Node.prototype,"appendChild insertBefore removeChild replaceChild cloneNode contains".split(" ")),S(HTMLElement.prototype,["parentElement","contains"]),D={firstElementChild:{get:function(){return Ge.currentNode=this,Ge.firstChild()}},lastElementChild:{get:function(){return Ge.currentNode=this,Ge.lastChild()}},children:{get:function(){var D=[];Ge.currentNode=this;for(var w=Ge.firstChild();w;)D.push(w),w=Ge.nextSibling();return Cb(D)}},childElementCount:{get:function(){return this.children?this.children.length:0}}},Be?(S(Element.prototype,He),S(Element.prototype,["previousElementSibling","nextElementSibling","innerHTML","className"]),S(HTMLElement.prototype,["children","innerHTML","className"])):(dc(Element.prototype,D),dc(Element.prototype,{previousElementSibling:{get:function(){return Ge.currentNode=this,Ge.previousSibling()}},nextElementSibling:{get:function(){return Ge.currentNode=this,Ge.nextSibling()}},innerHTML:{get:function(){return Zb(this,Db)},set:function(D){var w="template"===this.localName?this.content:this;hc(w);var N=this.localName||"div";for((N=this.namespaceURI&&this.namespaceURI!==Ye.namespaceURI?Ye.createElementNS(this.namespaceURI,N):Ye.createElement(N)).innerHTML=D,D="template"===this.localName?N.content:N;N=D.__shady_native_firstChild;)w.__shady_native_insertBefore(N,void 0)}},className:{get:function(){return this.getAttribute("class")||""},set:function(D){this.setAttribute("class",D)}}})),S(Element.prototype,"setAttribute getAttribute hasAttribute removeAttribute focus blur".split(" ")),S(Element.prototype,We),S(HTMLElement.prototype,["focus","blur"]),window.HTMLTemplateElement&&S(window.HTMLTemplateElement.prototype,["innerHTML"]),Be?S(DocumentFragment.prototype,He):dc(DocumentFragment.prototype,D),S(DocumentFragment.prototype,We),Be?(S(Document.prototype,He),S(Document.prototype,["activeElement"])):dc(Document.prototype,D),S(Document.prototype,["importNode","getElementById"]),S(Document.prototype,We)}(),$d("__shady_"),Object.defineProperty(document,"_activeElement",Nt.activeElement),P(Window.prototype,kt,"__shady_"),Ee.D?Ee.ua&&P(Element.prototype,Ot):($d(),function Rc(){if(!rt&&Object.getOwnPropertyDescriptor(Event.prototype,"isTrusted")){var a=function(){var D=new MouseEvent("click",{bubbles:!0,cancelable:!0,composed:!0});this.__shady_dispatchEvent(D)};Element.prototype.click?Element.prototype.click=a:HTMLElement.prototype.click&&(HTMLElement.prototype.click=a)}}()),function Mc(){for(var D in ut)window.__shady_native_addEventListener(D,(function(D){D.__target||(Kc(D),Gc(D))}),!0)}(),window.Event=ht,window.CustomEvent=dt,window.MouseEvent=ft,window.ShadowRoot=Kd}var $t=window.Document.prototype.createElement,en=window.Document.prototype.createElementNS,tn=window.Document.prototype.importNode,nn=window.Document.prototype.prepend,rn=window.Document.prototype.append,on=window.DocumentFragment.prototype.prepend,an=window.DocumentFragment.prototype.append,sn=window.Node.prototype.cloneNode,cn=window.Node.prototype.appendChild,un=window.Node.prototype.insertBefore,ln=window.Node.prototype.removeChild,hn=window.Node.prototype.replaceChild,dn=Object.getOwnPropertyDescriptor(window.Node.prototype,"textContent"),_n=window.Element.prototype.attachShadow,mn=Object.getOwnPropertyDescriptor(window.Element.prototype,"innerHTML"),gn=window.Element.prototype.getAttribute,vn=window.Element.prototype.setAttribute,yn=window.Element.prototype.removeAttribute,bn=window.Element.prototype.getAttributeNS,Tn=window.Element.prototype.setAttributeNS,En=window.Element.prototype.removeAttributeNS,Sn=window.Element.prototype.insertAdjacentElement,Mn=window.Element.prototype.insertAdjacentHTML,xn=window.Element.prototype.prepend,An=window.Element.prototype.append,Pn=window.Element.prototype.before,Cn=window.Element.prototype.after,On=window.Element.prototype.replaceWith,Rn=window.Element.prototype.remove,Ln=window.HTMLElement,Nn=Object.getOwnPropertyDescriptor(window.HTMLElement.prototype,"innerHTML"),Fn=window.HTMLElement.prototype.insertAdjacentElement,Bn=window.HTMLElement.prototype.insertAdjacentHTML,kn=new Set;function df(D){var w=kn.has(D);return D=/^[a-z][.0-9_a-z]*-[-.0-9_a-z]*$/.test(D),!w&&D}"annotation-xml color-profile font-face font-face-src font-face-uri font-face-format font-face-name missing-glyph".split(" ").forEach((function(D){return kn.add(D)}));var Un=document.contains?document.contains.bind(document):document.documentElement.contains.bind(document.documentElement);function T(D){var w=D.isConnected;if(void 0!==w)return w;if(Un(D))return!0;for(;D&&!(D.__CE_isImportDocument||D instanceof Document);)D=D.parentNode||(window.ShadowRoot&&D instanceof ShadowRoot?D.host:void 0);return!(!D||!(D.__CE_isImportDocument||D instanceof Document))}function ff(D){var w=D.children;if(w)return Array.prototype.slice.call(w);for(w=[],D=D.firstChild;D;D=D.nextSibling)D.nodeType===Node.ELEMENT_NODE&&w.push(D);return w}function gf(D,w){for(;w&&w!==D&&!w.nextSibling;)w=w.parentNode;return w&&w!==D?w.nextSibling:null}function jf(){var D=!(null==zn||!zn.noDocumentConstructionObserver),w=!(null==zn||!zn.shadyDomFastWalk);this.X=[],this.a=[],this.R=!1,this.shadyDomFastWalk=w,this.jb=!D}function lf(D,w,N,F){var k=window.ShadyDom;if(D.shadyDomFastWalk&&k&&k.inUse){if(w.nodeType===Node.ELEMENT_NODE&&N(w),w.querySelectorAll)for(D=k.nativeMethods.querySelectorAll.call(w,"*"),w=0;w<D.length;w++)N(D[w])}else!function hf(D,w,N){for(var F=D;F;){if(F.nodeType===Node.ELEMENT_NODE){var k=F;w(k);var j=k.localName;if("link"===j&&"import"===k.getAttribute("rel")){if(F=k.import,void 0===N&&(N=new Set),F instanceof Node&&!N.has(F))for(N.add(F),F=F.firstChild;F;F=F.nextSibling)hf(F,w,N);F=gf(D,k);continue}if("template"===j){F=gf(D,k);continue}if(k=k.__CE_shadowRoot)for(k=k.firstChild;k;k=k.nextSibling)hf(k,w,N)}F=F.firstChild?F.firstChild:gf(D,F)}}(w,N,F)}function of(D,w){D.R&&lf(D,w,(function(w){return pf(D,w)}))}function pf(D,w){if(D.R&&!w.__CE_patched){w.__CE_patched=!0;for(var N=0;N<D.X.length;N++)D.X[N](w);for(N=0;N<D.a.length;N++)D.a[N](w)}}function qf(D,w){var N=[];for(lf(D,w,(function(D){return N.push(D)})),w=0;w<N.length;w++){var F=N[w];1===F.__CE_state?D.connectedCallback(F):rf(D,F)}}function sf(D,w){var N=[];for(lf(D,w,(function(D){return N.push(D)})),w=0;w<N.length;w++){var F=N[w];1===F.__CE_state&&D.disconnectedCallback(F)}}function tf(D,w,N){var F=(N=void 0===N?{}:N).kb,k=N.upgrade||function(w){return rf(D,w)},j=[];for(lf(D,w,(function(w){if(D.R&&pf(D,w),"link"===w.localName&&"import"===w.getAttribute("rel")){var N=w.import;N instanceof Node&&(N.__CE_isImportDocument=!0,N.__CE_registry=document.__CE_registry),N&&"complete"===N.readyState?N.__CE_documentLoadHandled=!0:w.addEventListener("load",(function(){var N=w.import;if(!N.__CE_documentLoadHandled){N.__CE_documentLoadHandled=!0;var j=new Set;F&&(F.forEach((function(D){return j.add(D)})),j.delete(N)),tf(D,N,{kb:j,upgrade:k})}}))}else j.push(w)}),F),w=0;w<j.length;w++)k(j[w])}function rf(D,w){try{var N=w.ownerDocument,F=N.__CE_registry,k=F&&(N.defaultView||N.__CE_isImportDocument)?uf(F,w.localName):void 0;if(k&&void 0===w.__CE_state){k.constructionStack.push(w);try{try{if(new k.constructorFunction!==w)throw Error("The custom element constructor did not produce the element being upgraded.")}finally{k.constructionStack.pop()}}catch(D){throw w.__CE_state=2,D}if(w.__CE_state=1,w.__CE_definition=k,k.attributeChangedCallback&&w.hasAttributes()){var j=k.observedAttributes;for(k=0;k<j.length;k++){var z=j[k],G=w.getAttribute(z);null!==G&&D.attributeChangedCallback(w,z,null,G,null)}}T(w)&&D.connectedCallback(w)}}catch(D){vf(D)}}function wf(D,w,N,F){var k=w.__CE_registry;if(k&&(null===F||"http://www.w3.org/1999/xhtml"===F)&&(k=uf(k,N)))try{var j=new k.constructorFunction;if(void 0===j.__CE_state||void 0===j.__CE_definition)throw Error("Failed to construct '"+N+"': The returned value was not constructed with the HTMLElement constructor.");if("http://www.w3.org/1999/xhtml"!==j.namespaceURI)throw Error("Failed to construct '"+N+"': The constructed element's namespace must be the HTML namespace.");if(j.hasAttributes())throw Error("Failed to construct '"+N+"': The constructed element must not have any attributes.");if(null!==j.firstChild)throw Error("Failed to construct '"+N+"': The constructed element must not have any children.");if(null!==j.parentNode)throw Error("Failed to construct '"+N+"': The constructed element must not have a parent node.");if(j.ownerDocument!==w)throw Error("Failed to construct '"+N+"': The constructed element's owner document is incorrect.");if(j.localName!==N)throw Error("Failed to construct '"+N+"': The constructed element's local name is incorrect.");return j}catch(k){return vf(k),w=null===F?$t.call(w,N):en.call(w,F,N),Object.setPrototypeOf(w,HTMLUnknownElement.prototype),w.__CE_state=2,w.__CE_definition=void 0,pf(D,w),w}return pf(D,w=null===F?$t.call(w,N):en.call(w,F,N)),w}function vf(D){var w=D.message,N=D.sourceURL||D.fileName||"",F=D.line||D.lineNumber||0,k=D.column||D.columnNumber||0,j=void 0;void 0===ErrorEvent.prototype.initErrorEvent?j=new ErrorEvent("error",{cancelable:!0,message:w,filename:N,lineno:F,colno:k,error:D}):((j=document.createEvent("ErrorEvent")).initErrorEvent("error",!1,!0,w,N,F),j.preventDefault=function(){Object.defineProperty(this,"defaultPrevented",{configurable:!0,get:function(){return!0}})}),void 0===j.error&&Object.defineProperty(j,"error",{configurable:!0,enumerable:!0,get:function(){return D}}),window.dispatchEvent(j),j.defaultPrevented||console.error(D)}function xf(){var D=this;this.C=void 0,this.Ca=new Promise((function(w){D.a=w}))}function yf(D){var w=document;this.S=void 0,this.M=D,this.a=w,tf(this.M,this.a),"loading"===this.a.readyState&&(this.S=new MutationObserver(this.b.bind(this)),this.S.observe(this.a,{childList:!0,subtree:!0}))}function zf(D){D.S&&D.S.disconnect()}function U(D){this.ea=new Map,this.fa=new Map,this.xa=new Map,this.na=!1,this.qa=new Map,this.da=function(D){return D()},this.P=!1,this.ga=[],this.M=D,this.ya=D.jb?new yf(D):void 0}function Af(D,w){if(!df(w))throw new SyntaxError("The element name '"+w+"' is not valid.");if(uf(D,w))throw Error("A custom element with name '"+w+"' has already been defined.");if(D.na)throw Error("A custom element is already being defined.")}function Cf(D,w,N){var F;D.na=!0;try{var k=N.prototype;if(!(k instanceof Object))throw new TypeError("The custom element constructor's prototype is not an object.");var f=function(D){var w=k[D];if(void 0!==w&&!(w instanceof Function))throw Error("The '"+D+"' callback must be a function.");return w},j=f("connectedCallback"),z=f("disconnectedCallback"),G=f("adoptedCallback"),H=(F=f("attributeChangedCallback"))&&N.observedAttributes||[]}catch(D){throw D}finally{D.na=!1}return N={localName:w,constructorFunction:N,connectedCallback:j,disconnectedCallback:z,adoptedCallback:G,attributeChangedCallback:F,observedAttributes:H,constructionStack:[]},D.fa.set(w,N),D.xa.set(N.constructorFunction,N),N}function Bf(D){if(!1!==D.P){D.P=!1;for(var w=[],N=D.ga,F=new Map,k=0;k<N.length;k++)F.set(N[k],[]);for(tf(D.M,document,{upgrade:function(N){if(void 0===N.__CE_state){var k=N.localName,j=F.get(k);j?j.push(N):D.fa.has(k)&&w.push(N)}}}),k=0;k<w.length;k++)rf(D.M,w[k]);for(k=0;k<N.length;k++){for(var j=N[k],z=F.get(j),G=0;G<z.length;G++)rf(D.M,z[G]);(j=D.qa.get(j))&&j.resolve(void 0)}N.length=0}}function uf(D,w){var N=D.fa.get(w);if(N)return N;if(N=D.ea.get(w)){D.ea.delete(w);try{return Cf(D,w,N())}catch(D){vf(D)}}}function Df(D,w,N){function d(w){return function(N){for(var F=[],k=0;k<arguments.length;++k)F[k]=arguments[k];k=[];for(var j=[],z=0;z<F.length;z++){var G=F[z];if(G instanceof Element&&T(G)&&j.push(G),G instanceof DocumentFragment)for(G=G.firstChild;G;G=G.nextSibling)k.push(G);else k.push(G)}for(w.apply(this,F),F=0;F<j.length;F++)sf(D,j[F]);if(T(this))for(F=0;F<k.length;F++)(j=k[F])instanceof Element&&qf(D,j)}}void 0!==N.prepend&&(w.prepend=d(N.prepend)),void 0!==N.append&&(w.append=d(N.append))}function Gf(D){function b(w,N){Object.defineProperty(w,"innerHTML",{enumerable:N.enumerable,configurable:!0,get:N.get,set:function(w){var F=this,k=void 0;if(T(this)&&(k=[],lf(D,this,(function(D){D!==F&&k.push(D)}))),N.set.call(this,w),k)for(var j=0;j<k.length;j++){var z=k[j];1===z.__CE_state&&D.disconnectedCallback(z)}return this.ownerDocument.__CE_registry?tf(D,this):of(D,this),w}})}function c(w,N){w.insertAdjacentElement=function(w,F){var k=T(F);return w=N.call(this,w,F),k&&sf(D,F),T(w)&&qf(D,F),w}}function d(w,N){function g(w,N){for(var F=[];w!==N;w=w.nextSibling)F.push(w);for(N=0;N<F.length;N++)tf(D,F[N])}w.insertAdjacentHTML=function(D,w){if("beforebegin"===(D=D.toLowerCase())){var F=this.previousSibling;N.call(this,D,w),g(F||this.parentNode.firstChild,this)}else if("afterbegin"===D)F=this.firstChild,N.call(this,D,w),g(this.firstChild,F);else if("beforeend"===D)F=this.lastChild,N.call(this,D,w),g(F||this.firstChild,null);else{if("afterend"!==D)throw new SyntaxError("The value provided ("+String(D)+") is not one of 'beforebegin', 'afterbegin', 'beforeend', or 'afterend'.");F=this.nextSibling,N.call(this,D,w),g(this.nextSibling,F)}}}_n&&(Element.prototype.attachShadow=function(w){if(w=_n.call(this,w),D.R&&!w.__CE_patched){w.__CE_patched=!0;for(var N=0;N<D.X.length;N++)D.X[N](w)}return this.__CE_shadowRoot=w}),mn&&mn.get?b(Element.prototype,mn):Nn&&Nn.get?b(HTMLElement.prototype,Nn):function nf(D,w){D.R=!0,D.a.push(w)}(D,(function(D){b(D,{enumerable:!0,configurable:!0,get:function(){return sn.call(this,!0).innerHTML},set:function(D){var w="template"===this.localName,N=w?this.content:this,F=en.call(document,this.namespaceURI,this.localName);for(F.innerHTML=D;0<N.childNodes.length;)ln.call(N,N.childNodes[0]);for(D=w?F.content:F;0<D.childNodes.length;)cn.call(N,D.childNodes[0])}})})),Element.prototype.setAttribute=function(w,N){if(1!==this.__CE_state)return vn.call(this,w,N);var F=gn.call(this,w);vn.call(this,w,N),N=gn.call(this,w),D.attributeChangedCallback(this,w,F,N,null)},Element.prototype.setAttributeNS=function(w,N,F){if(1!==this.__CE_state)return Tn.call(this,w,N,F);var k=bn.call(this,w,N);Tn.call(this,w,N,F),F=bn.call(this,w,N),D.attributeChangedCallback(this,N,k,F,w)},Element.prototype.removeAttribute=function(w){if(1!==this.__CE_state)return yn.call(this,w);var N=gn.call(this,w);yn.call(this,w),null!==N&&D.attributeChangedCallback(this,w,N,null,null)},Element.prototype.removeAttributeNS=function(w,N){if(1!==this.__CE_state)return En.call(this,w,N);var F=bn.call(this,w,N);En.call(this,w,N);var k=bn.call(this,w,N);F!==k&&D.attributeChangedCallback(this,N,F,k,w)},Fn?c(HTMLElement.prototype,Fn):Sn&&c(Element.prototype,Sn),Bn?d(HTMLElement.prototype,Bn):Mn&&d(Element.prototype,Mn),Df(D,Element.prototype,{prepend:xn,append:An}),function Ff(D){function b(w){return function(N){for(var F=[],k=0;k<arguments.length;++k)F[k]=arguments[k];k=[];for(var j=[],z=0;z<F.length;z++){var G=F[z];if(G instanceof Element&&T(G)&&j.push(G),G instanceof DocumentFragment)for(G=G.firstChild;G;G=G.nextSibling)k.push(G);else k.push(G)}for(w.apply(this,F),F=0;F<j.length;F++)sf(D,j[F]);if(T(this))for(F=0;F<k.length;F++)(j=k[F])instanceof Element&&qf(D,j)}}var w=Element.prototype;void 0!==Pn&&(w.before=b(Pn)),void 0!==Cn&&(w.after=b(Cn)),void 0!==On&&(w.replaceWith=function(w){for(var N=[],F=0;F<arguments.length;++F)N[F]=arguments[F];F=[];for(var k=[],j=0;j<N.length;j++){var z=N[j];if(z instanceof Element&&T(z)&&k.push(z),z instanceof DocumentFragment)for(z=z.firstChild;z;z=z.nextSibling)F.push(z);else F.push(z)}for(j=T(this),On.apply(this,N),N=0;N<k.length;N++)sf(D,k[N]);if(j)for(sf(D,this),N=0;N<F.length;N++)(k=F[N])instanceof Element&&qf(D,k)}),void 0!==Rn&&(w.remove=function(){var w=T(this);Rn.call(this),w&&sf(D,this)})}(D)}jf.prototype.connectedCallback=function(D){var w=D.__CE_definition;if(w.connectedCallback)try{w.connectedCallback.call(D)}catch(D){vf(D)}},jf.prototype.disconnectedCallback=function(D){var w=D.__CE_definition;if(w.disconnectedCallback)try{w.disconnectedCallback.call(D)}catch(D){vf(D)}},jf.prototype.attributeChangedCallback=function(D,w,N,F,k){var j=D.__CE_definition;if(j.attributeChangedCallback&&-1<j.observedAttributes.indexOf(w))try{j.attributeChangedCallback.call(D,w,N,F,k)}catch(D){vf(D)}},xf.prototype.resolve=function(D){if(this.C)throw Error("Already resolved.");this.C=D,this.a(D)},yf.prototype.b=function(D){var w=this.a.readyState;for("interactive"!==w&&"complete"!==w||zf(this),w=0;w<D.length;w++)for(var N=D[w].addedNodes,F=0;F<N.length;F++)tf(this.M,N[F])},(N=U.prototype).$a=function(D,w){var N=this;if(!(w instanceof Function))throw new TypeError("Custom element constructor getters must be functions.");Af(this,D),this.ea.set(D,w),this.ga.push(D),this.P||(this.P=!0,this.da((function(){return Bf(N)})))},N.define=function(D,w){var N=this;if(!(w instanceof Function))throw new TypeError("Custom element constructors must be functions.");Af(this,D),Cf(this,D,w),this.ga.push(D),this.P||(this.P=!0,this.da((function(){return Bf(N)})))},N.upgrade=function(D){tf(this.M,D)},N.get=function(D){if(D=uf(this,D))return D.constructorFunction},N.whenDefined=function(D){if(!df(D))return Promise.reject(new SyntaxError("'"+D+"' is not a valid custom element name."));var w=this.qa.get(D);if(w)return w.Ca;w=new xf,this.qa.set(D,w);var N=this.fa.has(D)||this.ea.has(D);return D=-1===this.ga.indexOf(D),N&&D&&w.resolve(void 0),w.Ca},N.polyfillWrapFlushCallback=function(D){this.ya&&zf(this.ya);var w=this.da;this.da=function(N){return D((function(){return w(N)}))}},window.CustomElementRegistry=U,U.prototype.define=U.prototype.define,U.prototype.upgrade=U.prototype.upgrade,U.prototype.get=U.prototype.get,U.prototype.whenDefined=U.prototype.whenDefined,U.prototype.polyfillDefineLazy=U.prototype.$a,U.prototype.polyfillWrapFlushCallback=U.prototype.polyfillWrapFlushCallback;var jn={};var zn=window.customElements;function Kf(){var D=new jf;!function If(D){function b(){var w=this.constructor,N=document.__CE_registry.xa.get(w);if(!N)throw Error("Failed to construct a custom element: The constructor was not registered with `customElements`.");var F=N.constructionStack;if(0===F.length)return F=$t.call(document,N.localName),Object.setPrototypeOf(F,w.prototype),F.__CE_state=1,F.__CE_definition=N,pf(D,F),F;var k=F.length-1,j=F[k];if(j===jn)throw Error("Failed to construct '"+N.localName+"': This element was already constructed.");return F[k]=jn,Object.setPrototypeOf(j,w.prototype),pf(D,j),j}b.prototype=Ln.prototype,Object.defineProperty(HTMLElement.prototype,"constructor",{writable:!0,configurable:!0,enumerable:!1,value:b}),window.HTMLElement=b}(D),function Ef(D){Document.prototype.createElement=function(w){return wf(D,this,w,null)},Document.prototype.importNode=function(w,N){return w=tn.call(this,w,!!N),this.__CE_registry?tf(D,w):of(D,w),w},Document.prototype.createElementNS=function(w,N){return wf(D,this,N,w)},Df(D,Document.prototype,{prepend:nn,append:rn})}(D),Df(D,DocumentFragment.prototype,{prepend:on,append:an}),function Jf(D){function b(w,N){Object.defineProperty(w,"textContent",{enumerable:N.enumerable,configurable:!0,get:N.get,set:function(w){if(this.nodeType===Node.TEXT_NODE)N.set.call(this,w);else{var F=void 0;if(this.firstChild){var k=this.childNodes,j=k.length;if(0<j&&T(this)){F=Array(j);for(var z=0;z<j;z++)F[z]=k[z]}}if(N.set.call(this,w),F)for(w=0;w<F.length;w++)sf(D,F[w])}}})}Node.prototype.insertBefore=function(w,N){if(w instanceof DocumentFragment){var F=ff(w);if(w=un.call(this,w,N),T(this))for(N=0;N<F.length;N++)qf(D,F[N]);return w}return F=w instanceof Element&&T(w),N=un.call(this,w,N),F&&sf(D,w),T(this)&&qf(D,w),N},Node.prototype.appendChild=function(w){if(w instanceof DocumentFragment){var N=ff(w);if(w=cn.call(this,w),T(this))for(var F=0;F<N.length;F++)qf(D,N[F]);return w}return N=w instanceof Element&&T(w),F=cn.call(this,w),N&&sf(D,w),T(this)&&qf(D,w),F},Node.prototype.cloneNode=function(w){return w=sn.call(this,!!w),this.ownerDocument.__CE_registry?tf(D,w):of(D,w),w},Node.prototype.removeChild=function(w){var N=w instanceof Element&&T(w),F=ln.call(this,w);return N&&sf(D,w),F},Node.prototype.replaceChild=function(w,N){if(w instanceof DocumentFragment){var F=ff(w);if(w=hn.call(this,w,N),T(this))for(sf(D,N),N=0;N<F.length;N++)qf(D,F[N]);return w}F=w instanceof Element&&T(w);var k=hn.call(this,w,N),j=T(this);return j&&sf(D,N),F&&sf(D,w),j&&qf(D,w),k},dn&&dn.get?b(Node.prototype,dn):function mf(D,w){D.R=!0,D.X.push(w)}(D,(function(D){b(D,{enumerable:!0,configurable:!0,get:function(){for(var D=[],w=this.firstChild;w;w=w.nextSibling)w.nodeType!==Node.COMMENT_NODE&&D.push(w.textContent);return D.join("")},set:function(D){for(;this.firstChild;)ln.call(this,this.firstChild);null!=D&&""!==D&&cn.call(this,document.createTextNode(D))}})}))}(D),Gf(D),D=new U(D),document.__CE_registry=D,Object.defineProperty(window,"customElements",{configurable:!0,enumerable:!0,value:D})}function Lf(){this.end=this.start=0,this.rules=this.parent=this.previous=null,this.cssText=this.parsedCssText="",this.atRule=!1,this.type=0,this.parsedSelector=this.selector=this.keyframesName=""}function Mf(D){var w=D=D.replace(qn,"").replace(Zn,""),N=new Lf;N.start=0,N.end=w.length;for(var F=N,k=0,j=w.length;k<j;k++)if("{"===w[k]){F.rules||(F.rules=[]);var z=F,G=z.rules[z.rules.length-1]||null;(F=new Lf).start=k+1,F.parent=z,F.previous=G,z.rules.push(F)}else"}"===w[k]&&(F.end=k+1,F=F.parent||N);return function Pf(D,w){var N=w.substring(D.start,D.end-1);if(D.parsedCssText=D.cssText=N.trim(),D.parent&&(N=(N=(N=function Qf(D){return D.replace(/\\([0-9a-f]{1,6})\s/gi,(function(D,w){for(w=6-(D=w).length;w--;)D="0"+D;return"\\"+D}))}(N=w.substring(D.previous?D.previous.end:D.parent.start,D.start-1))).replace(ii," ")).substring(N.lastIndexOf(";")+1),N=D.parsedSelector=D.selector=N.trim(),D.atRule=0===N.indexOf("@"),D.atRule?0===N.indexOf("@media")?D.type=Kn:N.match(ni)&&(D.type=Xn,D.keyframesName=D.selector.split(ii).pop()):D.type=0===N.indexOf("--")?Qn:Hn),N=D.rules)for(var F=0,k=N.length,j=void 0;F<k&&(j=N[F]);F++)Pf(j,w);return D}(N,D)}zn&&!zn.forcePolyfill&&"function"==typeof zn.define&&"function"==typeof zn.get||Kf(),window.__CE_installPolyfill=Kf;var Gn,Yn,Hn=1,Xn=7,Kn=4,Qn=1e3,qn=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//gim,Zn=/@import[^;]*;/gim,Jn=/(?:^[^;\-\s}]+)?--[^;{}]*?:[^{};]*?(?:[;\n]|$)/gim,$n=/(?:^[^;\-\s}]+)?--[^;{}]*?:[^{};]*?{[^}]*?}(?:[;\n]|$)?/gim,ei=/@apply\s*\(?[^);]*\)?\s*(?:[;\n]|$)?/gim,ti=/[^;:]*?:[^;]*?var\([^;]*\)(?:[;\n]|$)?/gim,ni=/^@[^\s]*keyframes/,ii=/\s+/g,ri=!(window.ShadyDOM&&window.ShadyDOM.inUse);function cg(D){Gn=(!D||!D.shimcssproperties)&&(ri||!(navigator.userAgent.match(/AppleWebKit\/601|Edge\/15/)||!window.CSS||!CSS.supports||!CSS.supports("box-shadow","0 0 0 var(--foo)")))}window.ShadyCSS&&void 0!==window.ShadyCSS.cssBuild&&(Yn=window.ShadyCSS.cssBuild);var oi=!(!window.ShadyCSS||!window.ShadyCSS.disableRuntime);window.ShadyCSS&&void 0!==window.ShadyCSS.nativeCss?Gn=window.ShadyCSS.nativeCss:window.ShadyCSS?(cg(window.ShadyCSS),window.ShadyCSS=void 0):cg(window.WebComponents&&window.WebComponents.flags);var ai=Gn,si=/(?:^|[;\s{]\s*)(--[\w-]*?)\s*:\s*(?:((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};{])+)|\{([^}]*)\}(?:(?=[;\s}])|$))/gi,ui=/(?:^|\W+)@apply\s*\(?([^);\n]*)\)?/gi,li=/(--[\w-]+)\s*([:,;)]|$)/gi,hi=/(animation\s*:)|(animation-name\s*:)/,di=/@media\s(.*)/,fi=/\{[^}]*\}/g,pi=new Set;function ng(D,w){return D?("string"==typeof D&&(D=Mf(D)),w&&og(D,w),function Xf(D,w,N){N=void 0===N?"":N;var F="";if(D.cssText||D.rules){var k,j=D.rules;if((k=j)&&(k=!((k=j[0])&&k.selector&&0===k.selector.indexOf("--"))),k){k=0;for(var z=j.length,G=void 0;k<z&&(G=j[k]);k++)F=Xf(G,w,F)}else w?w=D.cssText:w=(w=(w=D.cssText).replace(Jn,"").replace($n,"")).replace(ei,"").replace(ti,""),(F=w.trim())&&(F="  "+F+"\n")}return F&&(D.selector&&(N+=D.selector+" {\n"),N+=F,D.selector&&(N+="}\n\n")),N}(D,ai)):""}function pg(D){return!D.__cssRules&&D.textContent&&(D.__cssRules=Mf(D.textContent)),D.__cssRules||null}function qg(D){return!!D.parent&&D.parent.type===Xn}function og(D,w,N,F){if(D){var k=!1,j=D.type;if(F&&j===Kn){var z=D.selector.match(di);z&&(window.matchMedia(z[1]).matches||(k=!0))}if(j===Hn?w(D):N&&j===Xn?N(D):j===Qn&&(k=!0),(D=D.rules)&&!k)for(k=0,j=D.length,z=void 0;k<j&&(z=D[k]);k++)og(z,w,N,F)}}function rg(D,w,N,F){var k=document.createElement("style");return w&&k.setAttribute("scope",w),k.textContent=D,sg(k,N,F),k}var _i=null;function ug(D){D=document.createComment(" Shady DOM styles for "+D+" ");var w=document.head;return w.insertBefore(D,(_i?_i.nextSibling:null)||w.firstChild),_i=D}function sg(D,w,N){(w=w||document.head).insertBefore(D,N&&N.nextSibling||w.firstChild),_i?D.compareDocumentPosition(_i)===Node.DOCUMENT_POSITION_PRECEDING&&(_i=D):_i=D}function vg(D,w){for(var N=0,F=D.length;w<F;w++)if("("===D[w])N++;else if(")"===D[w]&&0==--N)return w;return-1}function xg(D,w){ri?D.setAttribute("class",w):window.ShadyDOM.nativeMethods.setAttribute.call(D,"class",w)}var mi=window.ShadyDOM&&window.ShadyDOM.wrap||function(D){return D};function zg(D){var w=D.localName,N="";return w?-1<w.indexOf("-")||(N=w,w=D.getAttribute&&D.getAttribute("is")||""):(w=D.is,N=D.extends),{is:w,ba:N}}function Ag(D){for(var w=[],N="",F=0;0<=F&&F<D.length;F++)if("("===D[F]){var k=vg(D,F);N+=D.slice(F,k+1),F=k}else","===D[F]?(w.push(N),N=""):N+=D[F];return N&&w.push(N),w}function Bg(D){if(void 0!==Yn)return Yn;if(void 0===D.__cssBuild){var w=D.getAttribute("css-build");if(w)D.__cssBuild=w;else{if(""!==(w=(w="template"===D.localName?D.content.firstChild:D.firstChild)instanceof Comment&&"css-build"===(w=w.textContent.trim().split(":"))[0]?w[1]:"")){var N="template"===D.localName?D.content.firstChild:D.firstChild;N.parentNode.removeChild(N)}D.__cssBuild=w}}return D.__cssBuild||""}function Cg(D){return!(""===(D=void 0===D?"":D)||!ai)&&(ri?"shadow"===D:"shady"===D)}function Dg(){}function Fg(D,w,N){var F;if(w.nodeType===Node.ELEMENT_NODE&&N(w),F="template"===w.localName?(w.content||w._content||w).childNodes:w.children||w.childNodes)for(w=0;w<F.length;w++)Fg(D,F[w],N)}function Hg(D,w,N){if(w)if(D.classList)N?(D.classList.remove("style-scope"),D.classList.remove(w)):(D.classList.add("style-scope"),D.classList.add(w));else if(D.getAttribute){var F=D.getAttribute("class");N?F&&xg(D,w=F.replace("style-scope","").replace(w,"")):xg(D,(F?F+" ":"")+"style-scope "+w)}}function Ig(D,w,N){Fg(xi,D,(function(D){Hg(D,w,!0),Hg(D,N)}))}function Jg(D,w){Fg(xi,D,(function(D){Hg(D,w||"",!0)}))}function Kg(D,w,N,F,k){var j=xi;return""===(k=void 0===k?"":k)&&(ri||"shady"===(void 0===F?"":F)?k=ng(w,N):k=function Lg(D,w,N,F,k){var j=Mg(N,F);return N=N?"."+N:"",ng(w,(function(w){w.c||(w.selector=w.w=Ng(D,w,D.b,N,j),w.c=!0),k&&k(w,N,j)}))}(j,w,(D=zg(D)).is,D.ba,N)+"\n\n"),k.trim()}function Mg(D,w){return w?"[is="+D+"]":D}function Ng(D,w,N,F,k){var j=Ag(w.selector);if(!qg(w)){w=0;for(var z=j.length,G=void 0;w<z&&(G=j[w]);w++)j[w]=N.call(D,G,F,k)}return j.filter((function(D){return!!D})).join(",")}function Og(D){return D.replace(gi,(function(D,w,N){return-1<N.indexOf("+")?N=N.replace(/\+/g,"___"):-1<N.indexOf("___")&&(N=N.replace(/___/g,"+")),":"+w+"("+N+")"}))}function Yg(D,w){D=D.split(/(\[.+?\])/);for(var N=[],F=0;F<D.length;F++)if(1==F%2)N.push(D[F]);else{var k=D[F];""===k&&F===D.length-1||((k=k.split(":"))[0]+=w,N.push(k.join(":")))}return N.join("")}function bh(D){":root"===D.selector&&(D.selector="html")}Dg.prototype.b=function(D,w,N){var F=!1;D=D.trim();var k=gi.test(D);k&&(D=Og(D=D.replace(gi,(function(D,w,N){return":"+w+"("+N.replace(/\s/g,"")+")"}))));var j=Mi.test(D);if(j){var z=function Qg(D){for(var w,N=[];w=D.match(Mi);){var F=w.index,k=vg(D,F);if(-1===k)throw Error(w.input+" selector missing ')'");w=D.slice(F,k+1),D=D.replace(w,""),N.push(w)}return{wa:D,matches:N}}(D);D=z.wa,z=z.matches}return D=(D=D.replace(bi,":host $1")).replace(vi,(function(D,k,j){return F||(D=function Vg(D,w,N,F){var k=D.indexOf("::slotted");if(0<=D.indexOf(":host")?D=function Xg(D,w){var N=D.match(Ti);return(N=N&&N[2].trim()||"")?N[0].match(yi)?D.replace(Ti,(function(D,N,F){return w+F})):N.split(yi)[0]===w?N:"should_not_match":D.replace(":host",w)}(D,F):0!==k&&(D=N?Yg(D,N):D),N=!1,0<=k&&(w="",N=!0),N){var j=!0;N&&(D=D.replace(Ei,(function(D,w){return" > "+w})))}return{value:D,Qa:w,stop:j}}(j,k,w,N),F=F||D.stop,k=D.Qa,j=D.value),k+j})),j&&(D=function Sg(D,w){var N=D.split("");return w.reduce((function(D,w,F){return D+w+N[F+1]}),N[0])}(D,z)),k&&(D=Og(D)),D.replace(Si,(function(D,w,N,F){return'[dir="'+N+'"] '+w+F+", "+w+'[dir="'+N+'"]'+F}))},Dg.prototype.c=function(D){return D.match(":host")?"":D.match("::slotted")?this.b(D,":not(.style-scope)"):Yg(D.trim(),":not(.style-scope)")},F.Object.defineProperties(Dg.prototype,{a:{configurable:!0,enumerable:!0,get:function(){return"style-scope"}}});var gi=/:(nth[-\w]+)\(([^)]+)\)/,vi=/(^|[\s>+~]+)((?:\[.+?\]|[^\s>+~=[])+)/g,yi=/[[.:#*]/,bi=/^(::slotted)/,Ti=/(:host)(?:\(((?:\([^)(]*\)|[^)(]*)+?)\))/,Ei=/(?:::slotted)(?:\(((?:\([^)(]*\)|[^)(]*)+?)\))/,Si=/(.*):dir\((?:(ltr|rtl))\)(.*)/,Mi=/:(?:matches|any|-(?:webkit|moz)-any)/,xi=new Dg;function ch(D,w,N,F,k){this.H=D||null,this.b=w||null,this.ta=N||[],this.F=null,this.cssBuild=k||"",this.ba=F||"",this.a=this.G=this.L=null}function dh(D){return D?D.__styleInfo:null}function eh(D,w){return D.__styleInfo=w}function fh(D){var w=this.matches||this.matchesSelector||this.mozMatchesSelector||this.msMatchesSelector||this.oMatchesSelector||this.webkitMatchesSelector;return w&&w.call(this,D)}ch.prototype.c=function(){return this.H},ch.prototype._getStyleRules=ch.prototype.c;var Ai=/:host\s*>\s*/,Pi=navigator.userAgent.match("Trident");function ih(){}function kh(D){if(!D.v){var w={},N={};lh(D,N)&&(w.K=N,D.rules=null),w.cssText=D.parsedCssText.replace(fi,"").replace(si,""),D.v=w}}function lh(D,w){var N=D.v;if(!N){N=D.parsedCssText;for(var F;D=si.exec(N);)"inherit"===(F=(D[2]||D[3]).trim())&&"unset"===F||(w[D[1].trim()]=F),F=!0;return F}if(N.K)return Object.assign(w,N.K),!0}function mh(D,w,N){return w&&(w=0<=w.indexOf(";")?nh(D,w,N):function wg(D,w){var N=D.indexOf("var(");if(-1===N)return w(D,"","","");var F=vg(D,N+3),k=D.substring(N+4,F);return N=D.substring(0,N),D=wg(D.substring(F+1),w),-1===(F=k.indexOf(","))?w(N,k.trim(),"",D):w(N,k.substring(0,F).trim(),k.substring(F+1).trim(),D)}(w,(function(w,F,k,j){return F?((F=mh(D,N[F],N))&&"initial"!==F?"apply-shim-inherit"===F&&(F="inherit"):F=mh(D,N[k]||k,N)||k,w+(F||"")+j):w+j}))),w&&w.trim()||""}function nh(D,w,N){w=w.split(";");for(var F,k,j=0;j<w.length;j++)if(F=w[j]){if(ui.lastIndex=0,k=ui.exec(F))F=mh(D,N[k[1]],N);else if(-1!==(k=F.indexOf(":"))){var z=F.substring(k);z=mh(D,z=z.trim(),N)||z,F=F.substring(0,k)+z}w[j]=F&&F.lastIndexOf(";")===F.length-1?F.slice(0,-1):F||""}return w.join(";")}function qh(D,w,N){var F={},k={};return og(w,(function(w){!function ph(D,w,N,F){if(w.v||kh(w),w.v.K){var k=zg(D);D=k.is,k=k.ba,k=D?Mg(D,k):"html";var j=w.parsedSelector,z=!!j.match(Ai)||"html"===k&&-1<j.indexOf("html"),G=0===j.indexOf(":host")&&!z;"shady"===N&&(G=!(z=j===k+" > *."+k||-1!==j.indexOf("html"))&&0===j.indexOf(k)),(z||G)&&(N=k,G&&(w.w||(w.w=Ng(xi,w,xi.b,D?"."+D:"",k)),N=w.w||k),z&&"html"===k&&(N=w.w||w.J),F({wa:N,Xa:G,mb:z}))}}(D,w,N,(function(N){fh.call(D._element||D,N.wa)&&(N.Xa?lh(w,F):lh(w,k))}))}),null,!0),{cb:k,Va:F}}function rh(D,w,N,F){var k=zg(w),j=Mg(k.is,k.ba),z=new RegExp("(?:^|[^.#[:])"+(w.extends?"\\"+j.slice(0,-1)+"\\]":j)+"($|[.:[\\s>+~])"),G=dh(w);k=G.H,G=G.cssBuild;var H=function sh(D,w){D=D.b;var N={};if(!ri&&D)for(var F=0,k=D[F];F<D.length;k=D[++F]){var j=k,z=w;j.l=new RegExp("\\b"+j.keyframesName+"(?!\\B|-)","g"),j.a=j.keyframesName+"-"+z,j.w=j.w||j.selector,j.selector=j.w.replace(j.keyframesName,j.a),N[k.keyframesName]=th(k)}return N}(k,F);return Kg(w,k,(function(w){var k="";if(w.v||kh(w),w.v.cssText&&(k=nh(D,w.v.cssText,N)),w.cssText=k,!ri&&!qg(w)&&w.cssText){var G=k=w.cssText;if(null==w.Da&&(w.Da=hi.test(k)),w.Da)if(null==w.ja)for(var X in w.ja=[],H)k!==(G=(G=H[X])(k))&&(k=G,w.ja.push(X));else{for(X=0;X<w.ja.length;++X)k=(G=H[w.ja[X]])(k);G=k}w.cssText=G,w.w=w.w||w.selector,k="."+F,G=0;for(var q=(X=Ag(w.w)).length,Z=void 0;G<q&&(Z=X[G]);G++)X[G]=Z.match(z)?Z.replace(j,k):k+" "+Z;w.selector=X.join(",")}}),G)}function th(D){return function(w){return w.replace(D.l,D.a)}}function uh(D,w){var N=Ci,F=pg(D);D.textContent=ng(F,(function(D){var F=D.cssText=D.parsedCssText;D.v&&D.v.cssText&&(F=F.replace(Jn,"").replace($n,""),D.cssText=nh(N,F,w))}))}F.Object.defineProperties(ih.prototype,{a:{configurable:!0,enumerable:!0,get:function(){return"x-scope"}}});var Ci=new ih,Oi={},Ri=window.customElements;if(Ri&&!ri&&!oi){var Di=Ri.define;Ri.define=function(D,w,N){Oi[D]||(Oi[D]=ug(D)),Di.call(Ri,D,w,N)}}function zh(){this.cache={}}function Ah(){}zh.prototype.store=function(D,w,N,F){var k=this.cache[D]||[];k.push({K:w,styleElement:N,G:F}),100<k.length&&k.shift(),this.cache[D]=k};var Ii=new RegExp(xi.a+"\\s*([^\\s]*)");function Ch(D){return(D=(D.classList&&D.classList.value?D.classList.value:D.getAttribute("class")||"").match(Ii))?D[1]:""}function Dh(D){var w=mi(D).getRootNode();return w===D||w===D.ownerDocument?"":(D=w.host)?zg(D).is:""}function Eh(D){for(var w=0;w<D.length;w++){var N=D[w];if(N.target!==document.documentElement&&N.target!==document.head)for(var F=0;F<N.addedNodes.length;F++){var k=N.addedNodes[F];if(k.nodeType===Node.ELEMENT_NODE){var j=k.getRootNode(),z=Ch(k);if(z&&j===k.ownerDocument&&("style"!==k.localName&&"template"!==k.localName||""===Bg(k)))Jg(k,z);else if(j instanceof ShadowRoot)for((j=Dh(k))!==z&&Ig(k,z,j),k=window.ShadyDOM.nativeMethods.querySelectorAll.call(k,":not(."+xi.a+")"),z=0;z<k.length;z++){var G=Dh(j=k[z]);G&&Hg(j,G)}}}}}if(!(ri||window.ShadyDOM&&window.ShadyDOM.handlesDynamicScoping)){var Li=new MutationObserver(Eh),Gh=function(D){Li.observe(D,{childList:!0,subtree:!0})};if(window.customElements&&!window.customElements.polyfillWrapFlushCallback)Gh(document);else{var Hh=function(){Gh(document.body)};window.HTMLImports?window.HTMLImports.whenReady(Hh):requestAnimationFrame((function(){if("loading"===document.readyState){var a=function(){Hh(),document.removeEventListener("readystatechange",a)};document.addEventListener("readystatechange",a)}else Hh()}))}Ah=function(){Eh(Li.takeRecords())}}var wi={},Ni=Promise.resolve();function Kh(D){(D=wi[D])&&(D._applyShimCurrentVersion=D._applyShimCurrentVersion||0,D._applyShimValidatingVersion=D._applyShimValidatingVersion||0,D._applyShimNextVersion=(D._applyShimNextVersion||0)+1)}function Lh(D){return D._applyShimCurrentVersion===D._applyShimNextVersion}var Fi={},Bi=new zh;function Y(){this.Y={},this.c=document.documentElement;var D=new Lf;D.rules=[],this.l=eh(this.c,new ch(D)),this.J=!1,this.a=this.b=null}function Qh(D){var w=zg(D),N=w.is;w=w.ba;var F=Oi[N]||null,k=wi[N];if(k)return eh(D,w=new ch(N=k._styleAst,F,k.a,w,k=Bg(k))),w}function Ph(D){if(!D.b&&window.ShadyCSS&&window.ShadyCSS.ApplyShim){D.b=window.ShadyCSS.ApplyShim,D.b.invalidCallback=Kh;var w=!0}else w=!1;return function Rh(D){!D.a&&window.ShadyCSS&&window.ShadyCSS.CustomStyleInterface&&(D.a=window.ShadyCSS.CustomStyleInterface,D.a.transformCallback=function(w){D.Ha(w)},D.a.validateCallback=function(){requestAnimationFrame((function(){(D.a.enqueued||D.J)&&D.flushCustomStyles()}))})}(D),w}function Uh(D,w,N){var F=zg(w).is;if(N.F){var k,j=N.F;for(k in j)null===k?w.style.removeProperty(k):w.style.setProperty(k,j[k])}!(j=wi[F])&&w!==D.c||j&&""!==Bg(j)||!j||!j._style||Lh(j)||((Lh(j)||j._applyShimValidatingVersion!==j._applyShimNextVersion)&&(Ph(D),D.b&&D.b.transformRules(j._styleAst,F),j._style.textContent=Kg(w,N.H),function Mh(D){D._applyShimValidatingVersion=D._applyShimNextVersion,D._validating||(D._validating=!0,Ni.then((function(){D._applyShimCurrentVersion=D._applyShimNextVersion,D._validating=!1})))}(j)),ri&&(D=w.shadowRoot)&&(D=D.querySelector("style"))&&(D.textContent=Kg(w,N.H)),N.H=j._styleAst)}function Vh(D,w){return(w=mi(w).getRootNode().host)?dh(w)||Qh(w)?w:Vh(D,w):D.c}function Th(D,w,N){var F=Vh(D,w),k=dh(F),j=k.L;for(var z in F===D.c||j||(Th(D,F,k),j=k.L),D=Object.create(j||null),F=qh(w,N.H,N.cssBuild),w=function oh(D,w){var N={},F=[];return og(D,(function(D){D.v||kh(D);var k=D.w||D.parsedSelector;w&&D.v.K&&k&&fh.call(w,k)&&(lh(D,N),D=D.index,k=parseInt(D/32,10),F[k]=(F[k]||0)|1<<D%32)}),null,!0),{K:N,key:F}}(k.H,w).K,Object.assign(D,F.Va,w,F.cb),w=N.F)((k=w[z])||0===k)&&(D[z]=k);for(z=Ci,w=Object.getOwnPropertyNames(D),k=0;k<w.length;k++)D[F=w[k]]=mh(z,D[F],D);N.L=D}(N=Y.prototype).flush=function(){Ah()},N.Ta=function(D){return pg(D)},N.hb=function(D){return ng(D)},N.prepareTemplate=function(D,w,N){this.prepareTemplateDom(D,w),this.prepareTemplateStyles(D,w,N)},N.prepareTemplateStyles=function(D,w,N){if(!D._prepared&&!oi){ri||Oi[w]||(Oi[w]=ug(w)),D._prepared=!0,D.name=w,D.extends=N,wi[w]=D;var F=Bg(D),k=Cg(F);N={is:w,extends:N};for(var j=[],z=D.content.querySelectorAll("style"),G=0;G<z.length;G++){var H=z[G];if(H.hasAttribute("shady-unscoped")){if(!ri){var X=H.textContent;if(!pi.has(X)){pi.add(X);var q=document.createElement("style");q.setAttribute("shady-unscoped",""),q.textContent=X,document.head.appendChild(q)}H.parentNode.removeChild(H)}}else j.push(H.textContent),H.parentNode.removeChild(H)}j=j.join("").trim()+(Fi[w]||""),Ph(this),k||((z=!F)&&(z=ui.test(j)||si.test(j),ui.lastIndex=0,si.lastIndex=0),G=Mf(j),z&&ai&&this.b&&this.b.transformRules(G,w),D._styleAst=G),z=[],ai||(z=function jh(D){var w={},N=[],F=0;for(var k in og(D,(function(D){kh(D),D.index=F++,D=D.v.cssText;for(var N;N=li.exec(D);){var k=N[1];":"!==N[2]&&(w[k]=!0)}}),(function(D){N.push(D)})),D.b=N,D=[],w)D.push(k);return D}(D._styleAst)),z.length&&!ai||(G=ri?D.content:null,w=Oi[w]||null,F=(F=Kg(N,D._styleAst,null,F,k?j:"")).length?rg(F,N.is,G,w):null,D._style=F),D.a=z}},N.ab=function(D,w){Fi[w]=D.join(" ")},N.prepareTemplateDom=function(D,w){if(!oi){var N=Bg(D);ri||"shady"===N||D._domPrepared||(D._domPrepared=!0,function Eg(D,w){Fg(xi,D,(function(D){Hg(D,w||"")}))}(D.content,w))}},N.flushCustomStyles=function(){if(!oi){var D=Ph(this);if(this.a){var w=this.a.processStyles();if((D||this.a.enqueued)&&!Cg(this.l.cssBuild)){if(ai){if(!this.l.cssBuild)for(D=0;D<w.length;D++){var N=this.a.getStyleForCustomStyle(w[D]);if(N&&ai&&this.b){var F=pg(N);Ph(this),this.b.transformRules(F),N.textContent=ng(F)}}}else{for(function Sh(D,w){(w=w.map((function(w){return D.a.getStyleForCustomStyle(w)})).filter((function(D){return!!D}))).sort((function(D,w){return(D=w.compareDocumentPosition(D))&Node.DOCUMENT_POSITION_FOLLOWING?1:D&Node.DOCUMENT_POSITION_PRECEDING?-1:0})),D.l.H.rules=w.map((function(D){return pg(D)}))}(this,w),Th(this,this.c,this.l),D=0;D<w.length;D++)(N=this.a.getStyleForCustomStyle(w[D]))&&uh(N,this.l.L);this.J&&this.styleDocument()}this.a.enqueued=!1}}}},N.styleElement=function(D,w){if(oi){if(w){dh(D)||eh(D,new ch(null));var N=dh(D);N.F=N.F||{},Object.assign(N.F,w),Uh(this,D,N)}}else if(N=dh(D)||Qh(D))if(D!==this.c&&(this.J=!0),w&&(N.F=N.F||{},Object.assign(N.F,w)),ai)Uh(this,D,N);else if(this.flush(),Th(this,D,N),N.ta&&N.ta.length){var F;w=zg(D).is;e:{if(F=Bi.cache[w])for(var k=F.length-1;0<=k;k--){var j=F[k];t:{for(var z=N.ta,G=0;G<z.length;G++){var H=z[G];if(j.K[H]!==N.L[H]){z=!1;break t}}z=!0}if(z){F=j;break e}}F=void 0}z=F?F.styleElement:null,k=N.G,(j=F&&F.G)||(j=w+"-"+(j=this.Y[w]=(this.Y[w]||0)+1)),N.G=j,j=N.G,G=Ci,G=z?z.textContent||"":rh(G,D,N.L,j);var X=(H=dh(D)).a;X&&!ri&&X!==z&&(X._useCount--,0>=X._useCount&&X.parentNode&&X.parentNode.removeChild(X)),ri?H.a?(H.a.textContent=G,z=H.a):G&&(z=rg(G,j,D.shadowRoot,H.b)):z?z.parentNode||(Pi&&-1<G.indexOf("@media")&&(z.textContent=G),sg(z,null,H.b)):G&&(z=rg(G,j,null,H.b)),z&&(z._useCount=z._useCount||0,H.a!=z&&z._useCount++,H.a=z),j=z,ri||(z=N.G,H=G=D.getAttribute("class")||"",k&&(H=G.replace(new RegExp("\\s*x-scope\\s*"+k+"\\s*","g")," ")),G!==(H+=(H?" ":"")+"x-scope "+z)&&xg(D,H)),F||Bi.store(w,N.L,j,N.G)}},N.styleDocument=function(D){this.styleSubtree(this.c,D)},N.styleSubtree=function(D,w){var N=mi(D),F=N.shadowRoot,k=D===this.c;if((F||k)&&this.styleElement(D,w),D=k?N:F)for(D=Array.from(D.querySelectorAll("*")).filter((function(D){return mi(D).shadowRoot})),w=0;w<D.length;w++)this.styleSubtree(D[w])},N.Ha=function(D){var w=this,N=Bg(D);if(N!==this.l.cssBuild&&(this.l.cssBuild=N),!Cg(N)){var F=pg(D);og(F,(function(D){if(ri)bh(D);else{var F=xi;D.selector=D.parsedSelector,bh(D),D.selector=D.w=Ng(F,D,F.c,void 0,void 0)}ai&&""===N&&(Ph(w),w.b&&w.b.transformRule(D))})),ai?D.textContent=ng(F):this.l.H.rules.push(F)}},N.getComputedStyleValue=function(D,w){var N;return ai||(N=(dh(D)||dh(Vh(this,D))).L[w]),(N=N||window.getComputedStyle(D).getPropertyValue(w))?N.trim():""},N.gb=function(D,w){var N,F=mi(D).getRootNode();if(N=w?("string"==typeof w?w:String(w)).split(/\s/):[],!(w=F.host&&F.host.localName)&&(F=D.getAttribute("class"))){F=F.split(/\s/);for(var k=0;k<F.length;k++)if(F[k]===xi.a){w=F[k+1];break}}w&&N.push(xi.a,w),ai||(w=dh(D))&&w.G&&N.push(Ci.a,w.G),xg(D,N.join(" "))},N.Oa=function(D){return dh(D)},N.fb=function(D,w){Hg(D,w)},N.ib=function(D,w){Hg(D,w,!0)},N.eb=function(D){return Dh(D)},N.Ra=function(D){return Ch(D)},Y.prototype.flush=Y.prototype.flush,Y.prototype.prepareTemplate=Y.prototype.prepareTemplate,Y.prototype.styleElement=Y.prototype.styleElement,Y.prototype.styleDocument=Y.prototype.styleDocument,Y.prototype.styleSubtree=Y.prototype.styleSubtree,Y.prototype.getComputedStyleValue=Y.prototype.getComputedStyleValue,Y.prototype.setElementClass=Y.prototype.gb,Y.prototype._styleInfoForNode=Y.prototype.Oa,Y.prototype.transformCustomStyleForDocument=Y.prototype.Ha,Y.prototype.getStyleAst=Y.prototype.Ta,Y.prototype.styleAstToString=Y.prototype.hb,Y.prototype.flushCustomStyles=Y.prototype.flushCustomStyles,Y.prototype.scopeNode=Y.prototype.fb,Y.prototype.unscopeNode=Y.prototype.ib,Y.prototype.scopeForNode=Y.prototype.eb,Y.prototype.currentScopeForNode=Y.prototype.Ra,Y.prototype.prepareAdoptedCssText=Y.prototype.ab,Object.defineProperties(Y.prototype,{nativeShadow:{get:function(){return ri}},nativeCss:{get:function(){return ai}}});var ki,Ui,Vi=new Y;window.ShadyCSS&&(ki=window.ShadyCSS.ApplyShim,Ui=window.ShadyCSS.CustomStyleInterface),window.ShadyCSS={ScopingShim:Vi,prepareTemplate:function(D,w,N){Vi.flushCustomStyles(),Vi.prepareTemplate(D,w,N)},prepareTemplateDom:function(D,w){Vi.prepareTemplateDom(D,w)},prepareTemplateStyles:function(D,w,N){Vi.flushCustomStyles(),Vi.prepareTemplateStyles(D,w,N)},styleSubtree:function(D,w){Vi.flushCustomStyles(),Vi.styleSubtree(D,w)},styleElement:function(D){Vi.flushCustomStyles(),Vi.styleElement(D)},styleDocument:function(D){Vi.flushCustomStyles(),Vi.styleDocument(D)},flushCustomStyles:function(){Vi.flushCustomStyles()},getComputedStyleValue:function(D,w){return Vi.getComputedStyleValue(D,w)},nativeCss:ai,nativeShadow:ri,cssBuild:Yn,disableRuntime:oi},ki&&(window.ShadyCSS.ApplyShim=ki),Ui&&(window.ShadyCSS.CustomStyleInterface=Ui),function(D){function b(D){return""==D&&(f.call(this),this.h=!0),D.toLowerCase()}function c(D){var w=D.charCodeAt(0);return 32<w&&127>w&&-1==[34,35,60,62,63,96].indexOf(w)?D:encodeURIComponent(D)}function d(D){var w=D.charCodeAt(0);return 32<w&&127>w&&-1==[34,35,60,62,96].indexOf(w)?D:encodeURIComponent(D)}function e(D,w,N){function M(D){J.push(D)}var G=w||"scheme start",H=0,X="",q=!1,Z=!1,J=[];e:for(;(null!=D[H-1]||0==H)&&!this.h;){var $=D[H];switch(G){case"scheme start":if(!$||!j.test($)){if(w){M("Invalid scheme.");break e}X="",G="no scheme";continue}X+=$.toLowerCase(),G="scheme";break;case"scheme":if($&&z.test($))X+=$.toLowerCase();else{if(":"!=$){if(w){null!=$&&M("Code point not allowed in scheme: "+$);break e}X="",H=0,G="no scheme";continue}if(this.g=X,X="",w)break e;void 0!==F[this.g]&&(this.A=!0),G="file"==this.g?"relative":this.A&&N&&N.g==this.g?"relative or authority":this.A?"authority first slash":"scheme data"}break;case"scheme data":"?"==$?(this.o="?",G="query"):"#"==$?(this.u="#",G="fragment"):null!=$&&"\t"!=$&&"\n"!=$&&"\r"!=$&&(this.pa+=c($));break;case"no scheme":if(N&&void 0!==F[N.g]){G="relative";continue}M("Missing scheme."),f.call(this),this.h=!0;break;case"relative or authority":if("/"!=$||"/"!=D[H+1]){M("Expected /, got: "+$),G="relative";continue}G="authority ignore slashes";break;case"relative":if(this.A=!0,"file"!=this.g&&(this.g=N.g),null==$){this.i=N.i,this.m=N.m,this.j=N.j.slice(),this.o=N.o,this.s=N.s,this.f=N.f;break e}if("/"==$||"\\"==$)"\\"==$&&M("\\ is an invalid code point."),G="relative slash";else if("?"==$)this.i=N.i,this.m=N.m,this.j=N.j.slice(),this.o="?",this.s=N.s,this.f=N.f,G="query";else{if("#"!=$){G=D[H+1];var te=D[H+2];("file"!=this.g||!j.test($)||":"!=G&&"|"!=G||null!=te&&"/"!=te&&"\\"!=te&&"?"!=te&&"#"!=te)&&(this.i=N.i,this.m=N.m,this.s=N.s,this.f=N.f,this.j=N.j.slice(),this.j.pop()),G="relative path";continue}this.i=N.i,this.m=N.m,this.j=N.j.slice(),this.o=N.o,this.u="#",this.s=N.s,this.f=N.f,G="fragment"}break;case"relative slash":if("/"!=$&&"\\"!=$){"file"!=this.g&&(this.i=N.i,this.m=N.m,this.s=N.s,this.f=N.f),G="relative path";continue}"\\"==$&&M("\\ is an invalid code point."),G="file"==this.g?"file host":"authority ignore slashes";break;case"authority first slash":if("/"!=$){M("Expected '/', got: "+$),G="authority ignore slashes";continue}G="authority second slash";break;case"authority second slash":if(G="authority ignore slashes","/"!=$){M("Expected '/', got: "+$);continue}break;case"authority ignore slashes":if("/"!=$&&"\\"!=$){G="authority";continue}M("Expected authority, got: "+$);break;case"authority":if("@"==$){for(q&&(M("@ already seen."),X+="%40"),q=!0,$=0;$<X.length;$++)"\t"==(te=X[$])||"\n"==te||"\r"==te?M("Invalid whitespace in authority."):":"==te&&null===this.f?this.f="":(te=c(te),null!==this.f?this.f+=te:this.s+=te);X=""}else{if(null==$||"/"==$||"\\"==$||"?"==$||"#"==$){H-=X.length,X="",G="host";continue}X+=$}break;case"file host":if(null==$||"/"==$||"\\"==$||"?"==$||"#"==$){2!=X.length||!j.test(X[0])||":"!=X[1]&&"|"!=X[1]?(0!=X.length&&(this.i=b.call(this,X),X=""),G="relative path start"):G="relative path";continue}"\t"==$||"\n"==$||"\r"==$?M("Invalid whitespace in file host."):X+=$;break;case"host":case"hostname":if(":"!=$||Z){if(null==$||"/"==$||"\\"==$||"?"==$||"#"==$){if(this.i=b.call(this,X),X="",G="relative path start",w)break e;continue}"\t"!=$&&"\n"!=$&&"\r"!=$?("["==$?Z=!0:"]"==$&&(Z=!1),X+=$):M("Invalid code point in host/hostname: "+$)}else if(this.i=b.call(this,X),X="",G="port","hostname"==w)break e;break;case"port":if(/[0-9]/.test($))X+=$;else{if(null==$||"/"==$||"\\"==$||"?"==$||"#"==$||w){if(""!=X&&((X=parseInt(X,10))!=F[this.g]&&(this.m=X+""),X=""),w)break e;G="relative path start";continue}"\t"==$||"\n"==$||"\r"==$?M("Invalid code point in port: "+$):(f.call(this),this.h=!0)}break;case"relative path start":if("\\"==$&&M("'\\' not allowed in path."),G="relative path","/"!=$&&"\\"!=$)continue;break;case"relative path":null!=$&&"/"!=$&&"\\"!=$&&(w||"?"!=$&&"#"!=$)?"\t"!=$&&"\n"!=$&&"\r"!=$&&(X+=c($)):("\\"==$&&M("\\ not allowed in relative path."),(te=k[X.toLowerCase()])&&(X=te),".."==X?(this.j.pop(),"/"!=$&&"\\"!=$&&this.j.push("")):"."==X&&"/"!=$&&"\\"!=$?this.j.push(""):"."!=X&&("file"==this.g&&0==this.j.length&&2==X.length&&j.test(X[0])&&"|"==X[1]&&(X=X[0]+":"),this.j.push(X)),X="","?"==$?(this.o="?",G="query"):"#"==$&&(this.u="#",G="fragment"));break;case"query":w||"#"!=$?null!=$&&"\t"!=$&&"\n"!=$&&"\r"!=$&&(this.o+=d($)):(this.u="#",G="fragment");break;case"fragment":null!=$&&"\t"!=$&&"\n"!=$&&"\r"!=$&&(this.u+=$)}H++}}function f(){this.s=this.pa=this.g="",this.f=null,this.m=this.i="",this.j=[],this.u=this.o="",this.A=this.h=!1}function g(D,w){void 0===w||w instanceof g||(w=new g(String(w))),this.a=D,f.call(this),e.call(this,this.a.replace(/^[ \t\r\n\f]+|[ \t\r\n\f]+$/g,""),null,w)}var w=!1;try{var N=new URL("b","http://a");N.pathname="c%20d",w="http://a/c%20d"===N.href}catch(D){}if(!w){var F=Object.create(null);F.ftp=21,F.file=0,F.gopher=70,F.http=80,F.https=443,F.ws=80,F.wss=443;var k=Object.create(null);k["%2e"]=".",k[".%2e"]="..",k["%2e."]="..",k["%2e%2e"]="..";var j=/[a-zA-Z]/,z=/[a-zA-Z0-9\+\-\.]/;g.prototype={toString:function(){return this.href},get href(){if(this.h)return this.a;var D="";return""==this.s&&null==this.f||(D=this.s+(null!=this.f?":"+this.f:"")+"@"),this.protocol+(this.A?"//"+D+this.host:"")+this.pathname+this.o+this.u},set href(D){f.call(this),e.call(this,D)},get protocol(){return this.g+":"},set protocol(D){this.h||e.call(this,D+":","scheme start")},get host(){return this.h?"":this.m?this.i+":"+this.m:this.i},set host(D){!this.h&&this.A&&e.call(this,D,"host")},get hostname(){return this.i},set hostname(D){!this.h&&this.A&&e.call(this,D,"hostname")},get port(){return this.m},set port(D){!this.h&&this.A&&e.call(this,D,"port")},get pathname(){return this.h?"":this.A?"/"+this.j.join("/"):this.pa},set pathname(D){!this.h&&this.A&&(this.j=[],e.call(this,D,"relative path start"))},get search(){return this.h||!this.o||"?"==this.o?"":this.o},set search(D){!this.h&&this.A&&(this.o="?","?"==D[0]&&(D=D.slice(1)),e.call(this,D,"query"))},get hash(){return this.h||!this.u||"#"==this.u?"":this.u},set hash(D){this.h||(D?(this.u="#","#"==D[0]&&(D=D.slice(1)),e.call(this,D,"fragment")):this.u="")},get origin(){var D;if(this.h||!this.g)return"";switch(this.g){case"data":case"file":case"javascript":case"mailto":return"null"}return(D=this.host)?this.g+"://"+D:""}};var G=D.URL;G&&(g.createObjectURL=function(D){return G.createObjectURL.apply(G,arguments)},g.revokeObjectURL=function(D){G.revokeObjectURL(D)}),D.URL=g}}(window),Object.getOwnPropertyDescriptor(Node.prototype,"baseURI")||Object.defineProperty(Node.prototype,"baseURI",{get:function(){var D=(this.ownerDocument||this).querySelector("base[href]");return D&&D.href||window.location.href},configurable:!0,enumerable:!0});var ji=document.createElement("style");ji.textContent="body {transition: opacity ease-in 0.2s; } \nbody[unresolved] {opacity: 0; display: block; overflow: hidden; position: relative; } \n";var zi=document.querySelector("head");zi.insertBefore(ji,zi.firstChild);var Gi=window.customElements,Yi=!1,Hi=null;function ci(){window.HTMLTemplateElement.bootstrap&&window.HTMLTemplateElement.bootstrap(window.document),Hi&&Hi(),Yi=!0,window.WebComponents.ready=!0,document.dispatchEvent(new CustomEvent("WebComponentsReady",{bubbles:!0}))}Gi.polyfillWrapFlushCallback&&Gi.polyfillWrapFlushCallback((function(D){Hi=D,Yi&&D()})),"complete"!==document.readyState?(window.addEventListener("load",ci),window.addEventListener("DOMContentLoaded",(function(){window.removeEventListener("load",ci),ci()}))):ci()}).call(this)}).call(this,N(6),N(19).setImmediate)},function(D,w,N){(function(D,w){!function(D,N){"use strict";if(!D.setImmediate){var F,k=1,j={},z=!1,G=D.document,H=Object.getPrototypeOf&&Object.getPrototypeOf(D);H=H&&H.setTimeout?H:D,"[object process]"==={}.toString.call(D.process)?function installNextTickImplementation(){F=function(D){w.nextTick((function(){runIfPresent(D)}))}}():!function canUsePostMessage(){if(D.postMessage&&!D.importScripts){var w=!0,N=D.onmessage;return D.onmessage=function(){w=!1},D.postMessage("","*"),D.onmessage=N,w}}()?D.MessageChannel?function installMessageChannelImplementation(){var D=new MessageChannel;D.port1.onmessage=function(D){runIfPresent(D.data)},F=function(w){D.port2.postMessage(w)}}():G&&"onreadystatechange"in G.createElement("script")?function installReadyStateChangeImplementation(){var D=G.documentElement;F=function(w){var N=G.createElement("script");N.onreadystatechange=function(){runIfPresent(w),N.onreadystatechange=null,D.removeChild(N),N=null},D.appendChild(N)}}():function installSetTimeoutImplementation(){F=function(D){setTimeout(runIfPresent,0,D)}}():function installPostMessageImplementation(){var w="setImmediate$"+Math.random()+"$",onGlobalMessage=function(N){N.source===D&&"string"==typeof N.data&&0===N.data.indexOf(w)&&runIfPresent(+N.data.slice(w.length))};D.addEventListener?D.addEventListener("message",onGlobalMessage,!1):D.attachEvent("onmessage",onGlobalMessage),F=function(N){D.postMessage(w+N,"*")}}(),H.setImmediate=function setImmediate(D){"function"!=typeof D&&(D=new Function(""+D));for(var w=new Array(arguments.length-1),N=0;N<w.length;N++)w[N]=arguments[N+1];var z={callback:D,args:w};return j[k]=z,F(k),k++},H.clearImmediate=clearImmediate}function clearImmediate(D){delete j[D]}function runIfPresent(D){if(z)setTimeout(runIfPresent,0,D);else{var w=j[D];if(w){z=!0;try{!function run(D){var w=D.callback,N=D.args;switch(N.length){case 0:w();break;case 1:w(N[0]);break;case 2:w(N[0],N[1]);break;case 3:w(N[0],N[1],N[2]);break;default:w.apply(void 0,N)}}(w)}finally{clearImmediate(D),z=!1}}}}}("undefined"==typeof self?void 0===D?this:D:self)}).call(this,N(6),N(7))},,,function(D,w,N){"use strict";const{PATH_SEPARATOR:F}=N(27),k=N(28),j=N(29);D.exports={after:(D,w)=>k(D)?D.slice(w.length):""===w?D:D.slice(w.length+1),concat:(D,w)=>k(D)?(D=D.slice(),w&&D.push(w),D):w&&void 0!==w.toString?(""!==D&&(D+=F),j(w)?D+"Symbol("+w.description+")":D+w):D,initial:D=>{if(k(D))return D.slice(0,-1);if(""===D)return D;const w=D.lastIndexOf(F);return-1===w?"":D.slice(0,w)},walk:(D,w)=>{if(k(D))D.forEach(w);else if(""!==D){let N=0,k=D.indexOf(F);if(-1===k)w(D);else for(;N<D.length;)-1===k&&(k=D.length),w(D.slice(N,k)),N=k+1,k=D.indexOf(F,N)}}}},function(D,w,N){(function(D,F){var k;(function(){var j="Expected a function",z="__lodash_placeholder__",G=[["ary",128],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",32],["partialRight",64],["rearg",256]],H="[object Arguments]",X="[object Array]",q="[object Boolean]",Z="[object Date]",J="[object Error]",$="[object Function]",te="[object GeneratorFunction]",ie="[object Map]",oe="[object Number]",ce="[object Object]",he="[object RegExp]",fe="[object Set]",pe="[object String]",_e="[object Symbol]",ve="[object WeakMap]",ye="[object ArrayBuffer]",be="[object DataView]",Te="[object Float32Array]",Ee="[object Float64Array]",Se="[object Int8Array]",Me="[object Int16Array]",xe="[object Int32Array]",Ae="[object Uint8Array]",Pe="[object Uint16Array]",Oe="[object Uint32Array]",Re=/\b__p \+= '';/g,De=/\b(__p \+=) '' \+/g,Ie=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Le=/&(?:amp|lt|gt|quot|#39);/g,we=/[&<>"']/g,Ne=RegExp(Le.source),Fe=RegExp(we.source),Be=/<%-([\s\S]+?)%>/g,Ue=/<%([\s\S]+?)%>/g,Ve=/<%=([\s\S]+?)%>/g,ze=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ge=/^\w*$/,Ye=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,He=/[\\^$.*+?()[\]{}|]/g,We=RegExp(He.source),Xe=/^\s+|\s+$/g,Ke=/^\s+/,Qe=/\s+$/,Ze=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Je=/\{\n\/\* \[wrapped with (.+)\] \*/,$e=/,? & /,et=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,tt=/\\(\\)?/g,rt=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,ot=/\w*$/,at=/^[-+]0x[0-9a-f]+$/i,st=/^0b[01]+$/i,ut=/^\[object .+?Constructor\]$/,lt=/^0o[0-7]+$/i,ht=/^(?:0|[1-9]\d*)$/,dt=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,ft=/($^)/,pt=/['\n\r\u2028\u2029\\]/g,_t="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",mt="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",gt="[\\ud800-\\udfff]",vt="["+mt+"]",yt="["+_t+"]",bt="\\d+",Tt="[\\u2700-\\u27bf]",Et="[a-z\\xdf-\\xf6\\xf8-\\xff]",St="[^\\ud800-\\udfff"+mt+bt+"\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde]",Mt="\\ud83c[\\udffb-\\udfff]",xt="[^\\ud800-\\udfff]",At="(?:\\ud83c[\\udde6-\\uddff]){2}",Pt="[\\ud800-\\udbff][\\udc00-\\udfff]",Ct="[A-Z\\xc0-\\xd6\\xd8-\\xde]",Ot="(?:"+Et+"|"+St+")",Rt="(?:"+Ct+"|"+St+")",Dt="(?:"+yt+"|"+Mt+")"+"?",It="[\\ufe0e\\ufe0f]?"+Dt+("(?:\\u200d(?:"+[xt,At,Pt].join("|")+")[\\ufe0e\\ufe0f]?"+Dt+")*"),Lt="(?:"+[Tt,At,Pt].join("|")+")"+It,wt="(?:"+[xt+yt+"?",yt,At,Pt,gt].join("|")+")",Nt=RegExp("[']","g"),Ft=RegExp(yt,"g"),Bt=RegExp(Mt+"(?="+Mt+")|"+wt+It,"g"),kt=RegExp([Ct+"?"+Et+"+(?:['](?:d|ll|m|re|s|t|ve))?(?="+[vt,Ct,"$"].join("|")+")",Rt+"+(?:['](?:D|LL|M|RE|S|T|VE))?(?="+[vt,Ct+Ot,"$"].join("|")+")",Ct+"?"+Ot+"+(?:['](?:d|ll|m|re|s|t|ve))?",Ct+"+(?:['](?:D|LL|M|RE|S|T|VE))?","\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",bt,Lt].join("|"),"g"),Ut=RegExp("[\\u200d\\ud800-\\udfff"+_t+"\\ufe0e\\ufe0f]"),Vt=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,jt=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],zt=-1,Gt={};Gt[Te]=Gt[Ee]=Gt[Se]=Gt[Me]=Gt[xe]=Gt[Ae]=Gt["[object Uint8ClampedArray]"]=Gt[Pe]=Gt[Oe]=!0,Gt[H]=Gt[X]=Gt[ye]=Gt[q]=Gt[be]=Gt[Z]=Gt[J]=Gt[$]=Gt[ie]=Gt[oe]=Gt[ce]=Gt[he]=Gt[fe]=Gt[pe]=Gt[ve]=!1;var Yt={};Yt[H]=Yt[X]=Yt[ye]=Yt[be]=Yt[q]=Yt[Z]=Yt[Te]=Yt[Ee]=Yt[Se]=Yt[Me]=Yt[xe]=Yt[ie]=Yt[oe]=Yt[ce]=Yt[he]=Yt[fe]=Yt[pe]=Yt[_e]=Yt[Ae]=Yt["[object Uint8ClampedArray]"]=Yt[Pe]=Yt[Oe]=!0,Yt[J]=Yt[$]=Yt[ve]=!1;var Ht={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Wt=parseFloat,Xt=parseInt,Kt="object"==typeof D&&D&&D.Object===Object&&D,Qt="object"==typeof self&&self&&self.Object===Object&&self,qt=Kt||Qt||Function("return this")(),Zt=w&&!w.nodeType&&w,Jt=Zt&&"object"==typeof F&&F&&!F.nodeType&&F,$t=Jt&&Jt.exports===Zt,en=$t&&Kt.process,tn=function(){try{var D=Jt&&Jt.require&&Jt.require("util").types;return D||en&&en.binding&&en.binding("util")}catch(D){}}(),nn=tn&&tn.isArrayBuffer,rn=tn&&tn.isDate,on=tn&&tn.isMap,an=tn&&tn.isRegExp,sn=tn&&tn.isSet,cn=tn&&tn.isTypedArray;function apply(D,w,N){switch(N.length){case 0:return D.call(w);case 1:return D.call(w,N[0]);case 2:return D.call(w,N[0],N[1]);case 3:return D.call(w,N[0],N[1],N[2])}return D.apply(w,N)}function arrayAggregator(D,w,N,F){for(var k=-1,j=null==D?0:D.length;++k<j;){var z=D[k];w(F,z,N(z),D)}return F}function arrayEach(D,w){for(var N=-1,F=null==D?0:D.length;++N<F&&!1!==w(D[N],N,D););return D}function arrayEachRight(D,w){for(var N=null==D?0:D.length;N--&&!1!==w(D[N],N,D););return D}function arrayEvery(D,w){for(var N=-1,F=null==D?0:D.length;++N<F;)if(!w(D[N],N,D))return!1;return!0}function arrayFilter(D,w){for(var N=-1,F=null==D?0:D.length,k=0,j=[];++N<F;){var z=D[N];w(z,N,D)&&(j[k++]=z)}return j}function arrayIncludes(D,w){return!!(null==D?0:D.length)&&baseIndexOf(D,w,0)>-1}function arrayIncludesWith(D,w,N){for(var F=-1,k=null==D?0:D.length;++F<k;)if(N(w,D[F]))return!0;return!1}function arrayMap(D,w){for(var N=-1,F=null==D?0:D.length,k=Array(F);++N<F;)k[N]=w(D[N],N,D);return k}function arrayPush(D,w){for(var N=-1,F=w.length,k=D.length;++N<F;)D[k+N]=w[N];return D}function arrayReduce(D,w,N,F){var k=-1,j=null==D?0:D.length;for(F&&j&&(N=D[++k]);++k<j;)N=w(N,D[k],k,D);return N}function arrayReduceRight(D,w,N,F){var k=null==D?0:D.length;for(F&&k&&(N=D[--k]);k--;)N=w(N,D[k],k,D);return N}function arraySome(D,w){for(var N=-1,F=null==D?0:D.length;++N<F;)if(w(D[N],N,D))return!0;return!1}var un=baseProperty("length");function baseFindKey(D,w,N){var F;return N(D,(function(D,N,k){if(w(D,N,k))return F=N,!1})),F}function baseFindIndex(D,w,N,F){for(var k=D.length,j=N+(F?1:-1);F?j--:++j<k;)if(w(D[j],j,D))return j;return-1}function baseIndexOf(D,w,N){return w==w?function strictIndexOf(D,w,N){var F=N-1,k=D.length;for(;++F<k;)if(D[F]===w)return F;return-1}(D,w,N):baseFindIndex(D,baseIsNaN,N)}function baseIndexOfWith(D,w,N,F){for(var k=N-1,j=D.length;++k<j;)if(F(D[k],w))return k;return-1}function baseIsNaN(D){return D!=D}function baseMean(D,w){var N=null==D?0:D.length;return N?baseSum(D,w)/N:NaN}function baseProperty(D){return function(w){return null==w?void 0:w[D]}}function basePropertyOf(D){return function(w){return null==D?void 0:D[w]}}function baseReduce(D,w,N,F,k){return k(D,(function(D,k,j){N=F?(F=!1,D):w(N,D,k,j)})),N}function baseSum(D,w){for(var N,F=-1,k=D.length;++F<k;){var j=w(D[F]);void 0!==j&&(N=void 0===N?j:N+j)}return N}function baseTimes(D,w){for(var N=-1,F=Array(D);++N<D;)F[N]=w(N);return F}function baseUnary(D){return function(w){return D(w)}}function baseValues(D,w){return arrayMap(w,(function(w){return D[w]}))}function cacheHas(D,w){return D.has(w)}function charsStartIndex(D,w){for(var N=-1,F=D.length;++N<F&&baseIndexOf(w,D[N],0)>-1;);return N}function charsEndIndex(D,w){for(var N=D.length;N--&&baseIndexOf(w,D[N],0)>-1;);return N}function countHolders(D,w){for(var N=D.length,F=0;N--;)D[N]===w&&++F;return F}var ln=basePropertyOf({"":"A","":"A","":"A","":"A","":"A","":"A","":"a","":"a","":"a","":"a","":"a","":"a","":"C","":"c","":"D","":"d","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"N","":"n","":"O","":"O","":"O","":"O","":"O","":"O","":"o","":"o","":"o","":"o","":"o","":"o","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"Y","":"y","":"y","":"Ae","":"ae","":"Th","":"th","":"ss","":"A","":"A","":"A","":"a","":"a","":"a","":"C","":"C","":"C","":"C","":"c","":"c","":"c","":"c","":"D","":"D","":"d","":"d","":"E","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"e","":"G","":"G","":"G","":"G","":"g","":"g","":"g","":"g","":"H","":"H","":"h","":"h","":"I","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"i","":"J","":"j","":"K","":"k","":"k","":"L","":"L","":"L","":"L","":"L","":"l","":"l","":"l","":"l","":"l","":"N","":"N","":"N","":"N","":"n","":"n","":"n","":"n","":"O","":"O","":"O","":"o","":"o","":"o","":"R","":"R","":"R","":"r","":"r","":"r","":"S","":"S","":"S","":"S","":"s","":"s","":"s","":"s","":"T","":"T","":"T","":"t","":"t","":"t","":"U","":"U","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"u","":"u","":"W","":"w","":"Y","":"y","":"Y","":"Z","":"Z","":"Z","":"z","":"z","":"z","":"IJ","":"ij","":"Oe","":"oe","":"'n","":"s"}),hn=basePropertyOf({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function escapeStringChar(D){return"\\"+Ht[D]}function hasUnicode(D){return Ut.test(D)}function mapToArray(D){var w=-1,N=Array(D.size);return D.forEach((function(D,F){N[++w]=[F,D]})),N}function overArg(D,w){return function(N){return D(w(N))}}function replaceHolders(D,w){for(var N=-1,F=D.length,k=0,j=[];++N<F;){var G=D[N];G!==w&&G!==z||(D[N]=z,j[k++]=N)}return j}function setToArray(D){var w=-1,N=Array(D.size);return D.forEach((function(D){N[++w]=D})),N}function setToPairs(D){var w=-1,N=Array(D.size);return D.forEach((function(D){N[++w]=[D,D]})),N}function stringSize(D){return hasUnicode(D)?function unicodeSize(D){var w=Bt.lastIndex=0;for(;Bt.test(D);)++w;return w}(D):un(D)}function stringToArray(D){return hasUnicode(D)?function unicodeToArray(D){return D.match(Bt)||[]}(D):function asciiToArray(D){return D.split("")}(D)}var dn=basePropertyOf({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"});var _n=function runInContext(D){var w,N=(D=null==D?qt:_n.defaults(qt.Object(),D,_n.pick(qt,jt))).Array,F=D.Date,k=D.Error,_t=D.Function,mt=D.Math,gt=D.Object,vt=D.RegExp,yt=D.String,bt=D.TypeError,Tt=N.prototype,Et=_t.prototype,St=gt.prototype,Mt=D["__core-js_shared__"],xt=Et.toString,At=St.hasOwnProperty,Pt=0,Ct=(w=/[^.]+$/.exec(Mt&&Mt.keys&&Mt.keys.IE_PROTO||""))?"Symbol(src)_1."+w:"",Ot=St.toString,Rt=xt.call(gt),Dt=qt._,It=vt("^"+xt.call(At).replace(He,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Lt=$t?D.Buffer:void 0,wt=D.Symbol,Bt=D.Uint8Array,Ut=Lt?Lt.allocUnsafe:void 0,Ht=overArg(gt.getPrototypeOf,gt),Kt=gt.create,Qt=St.propertyIsEnumerable,Zt=Tt.splice,Jt=wt?wt.isConcatSpreadable:void 0,en=wt?wt.iterator:void 0,tn=wt?wt.toStringTag:void 0,un=function(){try{var D=getNative(gt,"defineProperty");return D({},"",{}),D}catch(D){}}(),mn=D.clearTimeout!==qt.clearTimeout&&D.clearTimeout,gn=F&&F.now!==qt.Date.now&&F.now,vn=D.setTimeout!==qt.setTimeout&&D.setTimeout,yn=mt.ceil,bn=mt.floor,Tn=gt.getOwnPropertySymbols,En=Lt?Lt.isBuffer:void 0,Sn=D.isFinite,Mn=Tt.join,xn=overArg(gt.keys,gt),An=mt.max,Pn=mt.min,Cn=F.now,On=D.parseInt,Rn=mt.random,Ln=Tt.reverse,Nn=getNative(D,"DataView"),Fn=getNative(D,"Map"),Bn=getNative(D,"Promise"),kn=getNative(D,"Set"),Un=getNative(D,"WeakMap"),jn=getNative(gt,"create"),zn=Un&&new Un,Gn={},Yn=toSource(Nn),Hn=toSource(Fn),Xn=toSource(Bn),Kn=toSource(kn),Qn=toSource(Un),qn=wt?wt.prototype:void 0,Zn=qn?qn.valueOf:void 0,Jn=qn?qn.toString:void 0;function lodash(D){if(isObjectLike(D)&&!ir(D)&&!(D instanceof LazyWrapper)){if(D instanceof LodashWrapper)return D;if(At.call(D,"__wrapped__"))return wrapperClone(D)}return new LodashWrapper(D)}var $n=function(){function object(){}return function(D){if(!isObject(D))return{};if(Kt)return Kt(D);object.prototype=D;var w=new object;return object.prototype=void 0,w}}();function baseLodash(){}function LodashWrapper(D,w){this.__wrapped__=D,this.__actions__=[],this.__chain__=!!w,this.__index__=0,this.__values__=void 0}function LazyWrapper(D){this.__wrapped__=D,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=4294967295,this.__views__=[]}function Hash(D){var w=-1,N=null==D?0:D.length;for(this.clear();++w<N;){var F=D[w];this.set(F[0],F[1])}}function ListCache(D){var w=-1,N=null==D?0:D.length;for(this.clear();++w<N;){var F=D[w];this.set(F[0],F[1])}}function MapCache(D){var w=-1,N=null==D?0:D.length;for(this.clear();++w<N;){var F=D[w];this.set(F[0],F[1])}}function SetCache(D){var w=-1,N=null==D?0:D.length;for(this.__data__=new MapCache;++w<N;)this.add(D[w])}function Stack(D){var w=this.__data__=new ListCache(D);this.size=w.size}function arrayLikeKeys(D,w){var N=ir(D),F=!N&&nr(D),k=!N&&!F&&or(D),j=!N&&!F&&!k&&lr(D),z=N||F||k||j,G=z?baseTimes(D.length,yt):[],H=G.length;for(var X in D)!w&&!At.call(D,X)||z&&("length"==X||k&&("offset"==X||"parent"==X)||j&&("buffer"==X||"byteLength"==X||"byteOffset"==X)||isIndex(X,H))||G.push(X);return G}function arraySample(D){var w=D.length;return w?D[baseRandom(0,w-1)]:void 0}function arraySampleSize(D,w){return shuffleSelf(copyArray(D),baseClamp(w,0,D.length))}function arrayShuffle(D){return shuffleSelf(copyArray(D))}function assignMergeValue(D,w,N){(void 0!==N&&!eq(D[w],N)||void 0===N&&!(w in D))&&baseAssignValue(D,w,N)}function assignValue(D,w,N){var F=D[w];At.call(D,w)&&eq(F,N)&&(void 0!==N||w in D)||baseAssignValue(D,w,N)}function assocIndexOf(D,w){for(var N=D.length;N--;)if(eq(D[N][0],w))return N;return-1}function baseAggregator(D,w,N,F){return ei(D,(function(D,k,j){w(F,D,N(D),j)})),F}function baseAssign(D,w){return D&&copyObject(w,keys(w),D)}function baseAssignValue(D,w,N){"__proto__"==w&&un?un(D,w,{configurable:!0,enumerable:!0,value:N,writable:!0}):D[w]=N}function baseAt(D,w){for(var F=-1,k=w.length,j=N(k),z=null==D;++F<k;)j[F]=z?void 0:get(D,w[F]);return j}function baseClamp(D,w,N){return D==D&&(void 0!==N&&(D=D<=N?D:N),void 0!==w&&(D=D>=w?D:w)),D}function baseClone(D,w,N,F,k,j){var z,G=1&w,X=2&w,J=4&w;if(N&&(z=k?N(D,F,k,j):N(D)),void 0!==z)return z;if(!isObject(D))return D;var ve=ir(D);if(ve){if(z=function initCloneArray(D){var w=D.length,N=new D.constructor(w);w&&"string"==typeof D[0]&&At.call(D,"index")&&(N.index=D.index,N.input=D.input);return N}(D),!G)return copyArray(D,z)}else{var Re=fi(D),De=Re==$||Re==te;if(or(D))return cloneBuffer(D,G);if(Re==ce||Re==H||De&&!k){if(z=X||De?{}:initCloneObject(D),!G)return X?function copySymbolsIn(D,w){return copyObject(D,di(D),w)}(D,function baseAssignIn(D,w){return D&&copyObject(w,keysIn(w),D)}(z,D)):function copySymbols(D,w){return copyObject(D,hi(D),w)}(D,baseAssign(z,D))}else{if(!Yt[Re])return k?D:{};z=function initCloneByTag(D,w,N){var F=D.constructor;switch(w){case ye:return cloneArrayBuffer(D);case q:case Z:return new F(+D);case be:return function cloneDataView(D,w){var N=w?cloneArrayBuffer(D.buffer):D.buffer;return new D.constructor(N,D.byteOffset,D.byteLength)}(D,N);case Te:case Ee:case Se:case Me:case xe:case Ae:case"[object Uint8ClampedArray]":case Pe:case Oe:return cloneTypedArray(D,N);case ie:return new F;case oe:case pe:return new F(D);case he:return function cloneRegExp(D){var w=new D.constructor(D.source,ot.exec(D));return w.lastIndex=D.lastIndex,w}(D);case fe:return new F;case _e:return function cloneSymbol(D){return Zn?gt(Zn.call(D)):{}}(D)}}(D,Re,G)}}j||(j=new Stack);var Ie=j.get(D);if(Ie)return Ie;j.set(D,z),ur(D)?D.forEach((function(F){z.add(baseClone(F,w,N,F,D,j))})):sr(D)&&D.forEach((function(F,k){z.set(k,baseClone(F,w,N,k,D,j))}));var Le=ve?void 0:(J?X?getAllKeysIn:getAllKeys:X?keysIn:keys)(D);return arrayEach(Le||D,(function(F,k){Le&&(F=D[k=F]),assignValue(z,k,baseClone(F,w,N,k,D,j))})),z}function baseConformsTo(D,w,N){var F=N.length;if(null==D)return!F;for(D=gt(D);F--;){var k=N[F],j=w[k],z=D[k];if(void 0===z&&!(k in D)||!j(z))return!1}return!0}function baseDelay(D,w,N){if("function"!=typeof D)throw new bt(j);return mi((function(){D.apply(void 0,N)}),w)}function baseDifference(D,w,N,F){var k=-1,j=arrayIncludes,z=!0,G=D.length,H=[],X=w.length;if(!G)return H;N&&(w=arrayMap(w,baseUnary(N))),F?(j=arrayIncludesWith,z=!1):w.length>=200&&(j=cacheHas,z=!1,w=new SetCache(w));e:for(;++k<G;){var q=D[k],Z=null==N?q:N(q);if(q=F||0!==q?q:0,z&&Z==Z){for(var J=X;J--;)if(w[J]===Z)continue e;H.push(q)}else j(w,Z,F)||H.push(q)}return H}lodash.templateSettings={escape:Be,evaluate:Ue,interpolate:Ve,variable:"",imports:{_:lodash}},lodash.prototype=baseLodash.prototype,lodash.prototype.constructor=lodash,LodashWrapper.prototype=$n(baseLodash.prototype),LodashWrapper.prototype.constructor=LodashWrapper,LazyWrapper.prototype=$n(baseLodash.prototype),LazyWrapper.prototype.constructor=LazyWrapper,Hash.prototype.clear=function hashClear(){this.__data__=jn?jn(null):{},this.size=0},Hash.prototype.delete=function hashDelete(D){var w=this.has(D)&&delete this.__data__[D];return this.size-=w?1:0,w},Hash.prototype.get=function hashGet(D){var w=this.__data__;if(jn){var N=w[D];return"__lodash_hash_undefined__"===N?void 0:N}return At.call(w,D)?w[D]:void 0},Hash.prototype.has=function hashHas(D){var w=this.__data__;return jn?void 0!==w[D]:At.call(w,D)},Hash.prototype.set=function hashSet(D,w){var N=this.__data__;return this.size+=this.has(D)?0:1,N[D]=jn&&void 0===w?"__lodash_hash_undefined__":w,this},ListCache.prototype.clear=function listCacheClear(){this.__data__=[],this.size=0},ListCache.prototype.delete=function listCacheDelete(D){var w=this.__data__,N=assocIndexOf(w,D);return!(N<0)&&(N==w.length-1?w.pop():Zt.call(w,N,1),--this.size,!0)},ListCache.prototype.get=function listCacheGet(D){var w=this.__data__,N=assocIndexOf(w,D);return N<0?void 0:w[N][1]},ListCache.prototype.has=function listCacheHas(D){return assocIndexOf(this.__data__,D)>-1},ListCache.prototype.set=function listCacheSet(D,w){var N=this.__data__,F=assocIndexOf(N,D);return F<0?(++this.size,N.push([D,w])):N[F][1]=w,this},MapCache.prototype.clear=function mapCacheClear(){this.size=0,this.__data__={hash:new Hash,map:new(Fn||ListCache),string:new Hash}},MapCache.prototype.delete=function mapCacheDelete(D){var w=getMapData(this,D).delete(D);return this.size-=w?1:0,w},MapCache.prototype.get=function mapCacheGet(D){return getMapData(this,D).get(D)},MapCache.prototype.has=function mapCacheHas(D){return getMapData(this,D).has(D)},MapCache.prototype.set=function mapCacheSet(D,w){var N=getMapData(this,D),F=N.size;return N.set(D,w),this.size+=N.size==F?0:1,this},SetCache.prototype.add=SetCache.prototype.push=function setCacheAdd(D){return this.__data__.set(D,"__lodash_hash_undefined__"),this},SetCache.prototype.has=function setCacheHas(D){return this.__data__.has(D)},Stack.prototype.clear=function stackClear(){this.__data__=new ListCache,this.size=0},Stack.prototype.delete=function stackDelete(D){var w=this.__data__,N=w.delete(D);return this.size=w.size,N},Stack.prototype.get=function stackGet(D){return this.__data__.get(D)},Stack.prototype.has=function stackHas(D){return this.__data__.has(D)},Stack.prototype.set=function stackSet(D,w){var N=this.__data__;if(N instanceof ListCache){var F=N.__data__;if(!Fn||F.length<199)return F.push([D,w]),this.size=++N.size,this;N=this.__data__=new MapCache(F)}return N.set(D,w),this.size=N.size,this};var ei=createBaseEach(baseForOwn),ti=createBaseEach(baseForOwnRight,!0);function baseEvery(D,w){var N=!0;return ei(D,(function(D,F,k){return N=!!w(D,F,k)})),N}function baseExtremum(D,w,N){for(var F=-1,k=D.length;++F<k;){var j=D[F],z=w(j);if(null!=z&&(void 0===G?z==z&&!isSymbol(z):N(z,G)))var G=z,H=j}return H}function baseFilter(D,w){var N=[];return ei(D,(function(D,F,k){w(D,F,k)&&N.push(D)})),N}function baseFlatten(D,w,N,F,k){var j=-1,z=D.length;for(N||(N=isFlattenable),k||(k=[]);++j<z;){var G=D[j];w>0&&N(G)?w>1?baseFlatten(G,w-1,N,F,k):arrayPush(k,G):F||(k[k.length]=G)}return k}var ni=createBaseFor(),ii=createBaseFor(!0);function baseForOwn(D,w){return D&&ni(D,w,keys)}function baseForOwnRight(D,w){return D&&ii(D,w,keys)}function baseFunctions(D,w){return arrayFilter(w,(function(w){return isFunction(D[w])}))}function baseGet(D,w){for(var N=0,F=(w=castPath(w,D)).length;null!=D&&N<F;)D=D[toKey(w[N++])];return N&&N==F?D:void 0}function baseGetAllKeys(D,w,N){var F=w(D);return ir(D)?F:arrayPush(F,N(D))}function baseGetTag(D){return null==D?void 0===D?"[object Undefined]":"[object Null]":tn&&tn in gt(D)?function getRawTag(D){var w=At.call(D,tn),N=D[tn];try{D[tn]=void 0;var F=!0}catch(D){}var k=Ot.call(D);F&&(w?D[tn]=N:delete D[tn]);return k}(D):function objectToString(D){return Ot.call(D)}(D)}function baseGt(D,w){return D>w}function baseHas(D,w){return null!=D&&At.call(D,w)}function baseHasIn(D,w){return null!=D&&w in gt(D)}function baseIntersection(D,w,F){for(var k=F?arrayIncludesWith:arrayIncludes,j=D[0].length,z=D.length,G=z,H=N(z),X=1/0,q=[];G--;){var Z=D[G];G&&w&&(Z=arrayMap(Z,baseUnary(w))),X=Pn(Z.length,X),H[G]=!F&&(w||j>=120&&Z.length>=120)?new SetCache(G&&Z):void 0}Z=D[0];var J=-1,$=H[0];e:for(;++J<j&&q.length<X;){var te=Z[J],ie=w?w(te):te;if(te=F||0!==te?te:0,!($?cacheHas($,ie):k(q,ie,F))){for(G=z;--G;){var oe=H[G];if(!(oe?cacheHas(oe,ie):k(D[G],ie,F)))continue e}$&&$.push(ie),q.push(te)}}return q}function baseInvoke(D,w,N){var F=null==(D=parent(D,w=castPath(w,D)))?D:D[toKey(last(w))];return null==F?void 0:apply(F,D,N)}function baseIsArguments(D){return isObjectLike(D)&&baseGetTag(D)==H}function baseIsEqual(D,w,N,F,k){return D===w||(null==D||null==w||!isObjectLike(D)&&!isObjectLike(w)?D!=D&&w!=w:function baseIsEqualDeep(D,w,N,F,k,j){var z=ir(D),G=ir(w),$=z?X:fi(D),te=G?X:fi(w),ve=($=$==H?ce:$)==ce,Te=(te=te==H?ce:te)==ce,Ee=$==te;if(Ee&&or(D)){if(!or(w))return!1;z=!0,ve=!1}if(Ee&&!ve)return j||(j=new Stack),z||lr(D)?equalArrays(D,w,N,F,k,j):function equalByTag(D,w,N,F,k,j,z){switch(N){case be:if(D.byteLength!=w.byteLength||D.byteOffset!=w.byteOffset)return!1;D=D.buffer,w=w.buffer;case ye:return!(D.byteLength!=w.byteLength||!j(new Bt(D),new Bt(w)));case q:case Z:case oe:return eq(+D,+w);case J:return D.name==w.name&&D.message==w.message;case he:case pe:return D==w+"";case ie:var G=mapToArray;case fe:var H=1&F;if(G||(G=setToArray),D.size!=w.size&&!H)return!1;var X=z.get(D);if(X)return X==w;F|=2,z.set(D,w);var $=equalArrays(G(D),G(w),F,k,j,z);return z.delete(D),$;case _e:if(Zn)return Zn.call(D)==Zn.call(w)}return!1}(D,w,$,N,F,k,j);if(!(1&N)){var Se=ve&&At.call(D,"__wrapped__"),Me=Te&&At.call(w,"__wrapped__");if(Se||Me){var xe=Se?D.value():D,Ae=Me?w.value():w;return j||(j=new Stack),k(xe,Ae,N,F,j)}}if(!Ee)return!1;return j||(j=new Stack),function equalObjects(D,w,N,F,k,j){var z=1&N,G=getAllKeys(D),H=G.length,X=getAllKeys(w).length;if(H!=X&&!z)return!1;var q=H;for(;q--;){var Z=G[q];if(!(z?Z in w:At.call(w,Z)))return!1}var J=j.get(D);if(J&&j.get(w))return J==w;var $=!0;j.set(D,w),j.set(w,D);var te=z;for(;++q<H;){Z=G[q];var ie=D[Z],oe=w[Z];if(F)var ce=z?F(oe,ie,Z,w,D,j):F(ie,oe,Z,D,w,j);if(!(void 0===ce?ie===oe||k(ie,oe,N,F,j):ce)){$=!1;break}te||(te="constructor"==Z)}if($&&!te){var he=D.constructor,fe=w.constructor;he==fe||!("constructor"in D)||!("constructor"in w)||"function"==typeof he&&he instanceof he&&"function"==typeof fe&&fe instanceof fe||($=!1)}return j.delete(D),j.delete(w),$}(D,w,N,F,k,j)}(D,w,N,F,baseIsEqual,k))}function baseIsMatch(D,w,N,F){var k=N.length,j=k,z=!F;if(null==D)return!j;for(D=gt(D);k--;){var G=N[k];if(z&&G[2]?G[1]!==D[G[0]]:!(G[0]in D))return!1}for(;++k<j;){var H=(G=N[k])[0],X=D[H],q=G[1];if(z&&G[2]){if(void 0===X&&!(H in D))return!1}else{var Z=new Stack;if(F)var J=F(X,q,H,D,w,Z);if(!(void 0===J?baseIsEqual(q,X,3,F,Z):J))return!1}}return!0}function baseIsNative(D){return!(!isObject(D)||function isMasked(D){return!!Ct&&Ct in D}(D))&&(isFunction(D)?It:ut).test(toSource(D))}function baseIteratee(D){return"function"==typeof D?D:null==D?identity:"object"==typeof D?ir(D)?baseMatchesProperty(D[0],D[1]):baseMatches(D):property(D)}function baseKeys(D){if(!isPrototype(D))return xn(D);var w=[];for(var N in gt(D))At.call(D,N)&&"constructor"!=N&&w.push(N);return w}function baseKeysIn(D){if(!isObject(D))return function nativeKeysIn(D){var w=[];if(null!=D)for(var N in gt(D))w.push(N);return w}(D);var w=isPrototype(D),N=[];for(var F in D)("constructor"!=F||!w&&At.call(D,F))&&N.push(F);return N}function baseLt(D,w){return D<w}function baseMap(D,w){var F=-1,k=isArrayLike(D)?N(D.length):[];return ei(D,(function(D,N,j){k[++F]=w(D,N,j)})),k}function baseMatches(D){var w=getMatchData(D);return 1==w.length&&w[0][2]?matchesStrictComparable(w[0][0],w[0][1]):function(N){return N===D||baseIsMatch(N,D,w)}}function baseMatchesProperty(D,w){return isKey(D)&&isStrictComparable(w)?matchesStrictComparable(toKey(D),w):function(N){var F=get(N,D);return void 0===F&&F===w?hasIn(N,D):baseIsEqual(w,F,3)}}function baseMerge(D,w,N,F,k){D!==w&&ni(w,(function(j,z){if(k||(k=new Stack),isObject(j))!function baseMergeDeep(D,w,N,F,k,j,z){var G=safeGet(D,N),H=safeGet(w,N),X=z.get(H);if(X)return void assignMergeValue(D,N,X);var q=j?j(G,H,N+"",D,w,z):void 0,Z=void 0===q;if(Z){var J=ir(H),$=!J&&or(H),te=!J&&!$&&lr(H);q=H,J||$||te?ir(G)?q=G:isArrayLikeObject(G)?q=copyArray(G):$?(Z=!1,q=cloneBuffer(H,!0)):te?(Z=!1,q=cloneTypedArray(H,!0)):q=[]:isPlainObject(H)||nr(H)?(q=G,nr(G)?q=toPlainObject(G):isObject(G)&&!isFunction(G)||(q=initCloneObject(H))):Z=!1}Z&&(z.set(H,q),k(q,H,F,j,z),z.delete(H));assignMergeValue(D,N,q)}(D,w,z,N,baseMerge,F,k);else{var G=F?F(safeGet(D,z),j,z+"",D,w,k):void 0;void 0===G&&(G=j),assignMergeValue(D,z,G)}}),keysIn)}function baseNth(D,w){var N=D.length;if(N)return isIndex(w+=w<0?N:0,N)?D[w]:void 0}function baseOrderBy(D,w,N){var F=-1;return w=arrayMap(w.length?w:[identity],baseUnary(getIteratee())),function baseSortBy(D,w){var N=D.length;for(D.sort(w);N--;)D[N]=D[N].value;return D}(baseMap(D,(function(D,N,k){return{criteria:arrayMap(w,(function(w){return w(D)})),index:++F,value:D}})),(function(D,w){return function compareMultiple(D,w,N){var F=-1,k=D.criteria,j=w.criteria,z=k.length,G=N.length;for(;++F<z;){var H=compareAscending(k[F],j[F]);if(H){if(F>=G)return H;var X=N[F];return H*("desc"==X?-1:1)}}return D.index-w.index}(D,w,N)}))}function basePickBy(D,w,N){for(var F=-1,k=w.length,j={};++F<k;){var z=w[F],G=baseGet(D,z);N(G,z)&&baseSet(j,castPath(z,D),G)}return j}function basePullAll(D,w,N,F){var k=F?baseIndexOfWith:baseIndexOf,j=-1,z=w.length,G=D;for(D===w&&(w=copyArray(w)),N&&(G=arrayMap(D,baseUnary(N)));++j<z;)for(var H=0,X=w[j],q=N?N(X):X;(H=k(G,q,H,F))>-1;)G!==D&&Zt.call(G,H,1),Zt.call(D,H,1);return D}function basePullAt(D,w){for(var N=D?w.length:0,F=N-1;N--;){var k=w[N];if(N==F||k!==j){var j=k;isIndex(k)?Zt.call(D,k,1):baseUnset(D,k)}}return D}function baseRandom(D,w){return D+bn(Rn()*(w-D+1))}function baseRepeat(D,w){var N="";if(!D||w<1||w>9007199254740991)return N;do{w%2&&(N+=D),(w=bn(w/2))&&(D+=D)}while(w);return N}function baseRest(D,w){return gi(overRest(D,w,identity),D+"")}function baseSample(D){return arraySample(values(D))}function baseSampleSize(D,w){var N=values(D);return shuffleSelf(N,baseClamp(w,0,N.length))}function baseSet(D,w,N,F){if(!isObject(D))return D;for(var k=-1,j=(w=castPath(w,D)).length,z=j-1,G=D;null!=G&&++k<j;){var H=toKey(w[k]),X=N;if(k!=z){var q=G[H];void 0===(X=F?F(q,H,G):void 0)&&(X=isObject(q)?q:isIndex(w[k+1])?[]:{})}assignValue(G,H,X),G=G[H]}return D}var ri=zn?function(D,w){return zn.set(D,w),D}:identity,oi=un?function(D,w){return un(D,"toString",{configurable:!0,enumerable:!1,value:constant(w),writable:!0})}:identity;function baseShuffle(D){return shuffleSelf(values(D))}function baseSlice(D,w,F){var k=-1,j=D.length;w<0&&(w=-w>j?0:j+w),(F=F>j?j:F)<0&&(F+=j),j=w>F?0:F-w>>>0,w>>>=0;for(var z=N(j);++k<j;)z[k]=D[k+w];return z}function baseSome(D,w){var N;return ei(D,(function(D,F,k){return!(N=w(D,F,k))})),!!N}function baseSortedIndex(D,w,N){var F=0,k=null==D?F:D.length;if("number"==typeof w&&w==w&&k<=2147483647){for(;F<k;){var j=F+k>>>1,z=D[j];null!==z&&!isSymbol(z)&&(N?z<=w:z<w)?F=j+1:k=j}return k}return baseSortedIndexBy(D,w,identity,N)}function baseSortedIndexBy(D,w,N,F){w=N(w);for(var k=0,j=null==D?0:D.length,z=w!=w,G=null===w,H=isSymbol(w),X=void 0===w;k<j;){var q=bn((k+j)/2),Z=N(D[q]),J=void 0!==Z,$=null===Z,te=Z==Z,ie=isSymbol(Z);if(z)var oe=F||te;else oe=X?te&&(F||J):G?te&&J&&(F||!$):H?te&&J&&!$&&(F||!ie):!$&&!ie&&(F?Z<=w:Z<w);oe?k=q+1:j=q}return Pn(j,4294967294)}function baseSortedUniq(D,w){for(var N=-1,F=D.length,k=0,j=[];++N<F;){var z=D[N],G=w?w(z):z;if(!N||!eq(G,H)){var H=G;j[k++]=0===z?0:z}}return j}function baseToNumber(D){return"number"==typeof D?D:isSymbol(D)?NaN:+D}function baseToString(D){if("string"==typeof D)return D;if(ir(D))return arrayMap(D,baseToString)+"";if(isSymbol(D))return Jn?Jn.call(D):"";var w=D+"";return"0"==w&&1/D==-1/0?"-0":w}function baseUniq(D,w,N){var F=-1,k=arrayIncludes,j=D.length,z=!0,G=[],H=G;if(N)z=!1,k=arrayIncludesWith;else if(j>=200){var X=w?null:ui(D);if(X)return setToArray(X);z=!1,k=cacheHas,H=new SetCache}else H=w?[]:G;e:for(;++F<j;){var q=D[F],Z=w?w(q):q;if(q=N||0!==q?q:0,z&&Z==Z){for(var J=H.length;J--;)if(H[J]===Z)continue e;w&&H.push(Z),G.push(q)}else k(H,Z,N)||(H!==G&&H.push(Z),G.push(q))}return G}function baseUnset(D,w){return null==(D=parent(D,w=castPath(w,D)))||delete D[toKey(last(w))]}function baseUpdate(D,w,N,F){return baseSet(D,w,N(baseGet(D,w)),F)}function baseWhile(D,w,N,F){for(var k=D.length,j=F?k:-1;(F?j--:++j<k)&&w(D[j],j,D););return N?baseSlice(D,F?0:j,F?j+1:k):baseSlice(D,F?j+1:0,F?k:j)}function baseWrapperValue(D,w){var N=D;return N instanceof LazyWrapper&&(N=N.value()),arrayReduce(w,(function(D,w){return w.func.apply(w.thisArg,arrayPush([D],w.args))}),N)}function baseXor(D,w,F){var k=D.length;if(k<2)return k?baseUniq(D[0]):[];for(var j=-1,z=N(k);++j<k;)for(var G=D[j],H=-1;++H<k;)H!=j&&(z[j]=baseDifference(z[j]||G,D[H],w,F));return baseUniq(baseFlatten(z,1),w,F)}function baseZipObject(D,w,N){for(var F=-1,k=D.length,j=w.length,z={};++F<k;){var G=F<j?w[F]:void 0;N(z,D[F],G)}return z}function castArrayLikeObject(D){return isArrayLikeObject(D)?D:[]}function castFunction(D){return"function"==typeof D?D:identity}function castPath(D,w){return ir(D)?D:isKey(D,w)?[D]:vi(toString(D))}var ai=baseRest;function castSlice(D,w,N){var F=D.length;return N=void 0===N?F:N,!w&&N>=F?D:baseSlice(D,w,N)}var si=mn||function(D){return qt.clearTimeout(D)};function cloneBuffer(D,w){if(w)return D.slice();var N=D.length,F=Ut?Ut(N):new D.constructor(N);return D.copy(F),F}function cloneArrayBuffer(D){var w=new D.constructor(D.byteLength);return new Bt(w).set(new Bt(D)),w}function cloneTypedArray(D,w){var N=w?cloneArrayBuffer(D.buffer):D.buffer;return new D.constructor(N,D.byteOffset,D.length)}function compareAscending(D,w){if(D!==w){var N=void 0!==D,F=null===D,k=D==D,j=isSymbol(D),z=void 0!==w,G=null===w,H=w==w,X=isSymbol(w);if(!G&&!X&&!j&&D>w||j&&z&&H&&!G&&!X||F&&z&&H||!N&&H||!k)return 1;if(!F&&!j&&!X&&D<w||X&&N&&k&&!F&&!j||G&&N&&k||!z&&k||!H)return-1}return 0}function composeArgs(D,w,F,k){for(var j=-1,z=D.length,G=F.length,H=-1,X=w.length,q=An(z-G,0),Z=N(X+q),J=!k;++H<X;)Z[H]=w[H];for(;++j<G;)(J||j<z)&&(Z[F[j]]=D[j]);for(;q--;)Z[H++]=D[j++];return Z}function composeArgsRight(D,w,F,k){for(var j=-1,z=D.length,G=-1,H=F.length,X=-1,q=w.length,Z=An(z-H,0),J=N(Z+q),$=!k;++j<Z;)J[j]=D[j];for(var te=j;++X<q;)J[te+X]=w[X];for(;++G<H;)($||j<z)&&(J[te+F[G]]=D[j++]);return J}function copyArray(D,w){var F=-1,k=D.length;for(w||(w=N(k));++F<k;)w[F]=D[F];return w}function copyObject(D,w,N,F){var k=!N;N||(N={});for(var j=-1,z=w.length;++j<z;){var G=w[j],H=F?F(N[G],D[G],G,N,D):void 0;void 0===H&&(H=D[G]),k?baseAssignValue(N,G,H):assignValue(N,G,H)}return N}function createAggregator(D,w){return function(N,F){var k=ir(N)?arrayAggregator:baseAggregator,j=w?w():{};return k(N,D,getIteratee(F,2),j)}}function createAssigner(D){return baseRest((function(w,N){var F=-1,k=N.length,j=k>1?N[k-1]:void 0,z=k>2?N[2]:void 0;for(j=D.length>3&&"function"==typeof j?(k--,j):void 0,z&&isIterateeCall(N[0],N[1],z)&&(j=k<3?void 0:j,k=1),w=gt(w);++F<k;){var G=N[F];G&&D(w,G,F,j)}return w}))}function createBaseEach(D,w){return function(N,F){if(null==N)return N;if(!isArrayLike(N))return D(N,F);for(var k=N.length,j=w?k:-1,z=gt(N);(w?j--:++j<k)&&!1!==F(z[j],j,z););return N}}function createBaseFor(D){return function(w,N,F){for(var k=-1,j=gt(w),z=F(w),G=z.length;G--;){var H=z[D?G:++k];if(!1===N(j[H],H,j))break}return w}}function createCaseFirst(D){return function(w){var N=hasUnicode(w=toString(w))?stringToArray(w):void 0,F=N?N[0]:w.charAt(0),k=N?castSlice(N,1).join(""):w.slice(1);return F[D]()+k}}function createCompounder(D){return function(w){return arrayReduce(words(deburr(w).replace(Nt,"")),D,"")}}function createCtor(D){return function(){var w=arguments;switch(w.length){case 0:return new D;case 1:return new D(w[0]);case 2:return new D(w[0],w[1]);case 3:return new D(w[0],w[1],w[2]);case 4:return new D(w[0],w[1],w[2],w[3]);case 5:return new D(w[0],w[1],w[2],w[3],w[4]);case 6:return new D(w[0],w[1],w[2],w[3],w[4],w[5]);case 7:return new D(w[0],w[1],w[2],w[3],w[4],w[5],w[6])}var N=$n(D.prototype),F=D.apply(N,w);return isObject(F)?F:N}}function createFind(D){return function(w,N,F){var k=gt(w);if(!isArrayLike(w)){var j=getIteratee(N,3);w=keys(w),N=function(D){return j(k[D],D,k)}}var z=D(w,N,F);return z>-1?k[j?w[z]:z]:void 0}}function createFlow(D){return flatRest((function(w){var N=w.length,F=N,k=LodashWrapper.prototype.thru;for(D&&w.reverse();F--;){var z=w[F];if("function"!=typeof z)throw new bt(j);if(k&&!G&&"wrapper"==getFuncName(z))var G=new LodashWrapper([],!0)}for(F=G?F:N;++F<N;){var H=getFuncName(z=w[F]),X="wrapper"==H?li(z):void 0;G=X&&isLaziable(X[0])&&424==X[1]&&!X[4].length&&1==X[9]?G[getFuncName(X[0])].apply(G,X[3]):1==z.length&&isLaziable(z)?G[H]():G.thru(z)}return function(){var D=arguments,F=D[0];if(G&&1==D.length&&ir(F))return G.plant(F).value();for(var k=0,j=N?w[k].apply(this,D):F;++k<N;)j=w[k].call(this,j);return j}}))}function createHybrid(D,w,F,k,j,z,G,H,X,q){var Z=128&w,J=1&w,$=2&w,te=24&w,ie=512&w,oe=$?void 0:createCtor(D);return function wrapper(){for(var ce=arguments.length,he=N(ce),fe=ce;fe--;)he[fe]=arguments[fe];if(te)var pe=getHolder(wrapper),_e=countHolders(he,pe);if(k&&(he=composeArgs(he,k,j,te)),z&&(he=composeArgsRight(he,z,G,te)),ce-=_e,te&&ce<q){var ve=replaceHolders(he,pe);return createRecurry(D,w,createHybrid,wrapper.placeholder,F,he,ve,H,X,q-ce)}var ye=J?F:this,be=$?ye[D]:D;return ce=he.length,H?he=reorder(he,H):ie&&ce>1&&he.reverse(),Z&&X<ce&&(he.length=X),this&&this!==qt&&this instanceof wrapper&&(be=oe||createCtor(be)),be.apply(ye,he)}}function createInverter(D,w){return function(N,F){return function baseInverter(D,w,N,F){return baseForOwn(D,(function(D,k,j){w(F,N(D),k,j)})),F}(N,D,w(F),{})}}function createMathOperation(D,w){return function(N,F){var k;if(void 0===N&&void 0===F)return w;if(void 0!==N&&(k=N),void 0!==F){if(void 0===k)return F;"string"==typeof N||"string"==typeof F?(N=baseToString(N),F=baseToString(F)):(N=baseToNumber(N),F=baseToNumber(F)),k=D(N,F)}return k}}function createOver(D){return flatRest((function(w){return w=arrayMap(w,baseUnary(getIteratee())),baseRest((function(N){var F=this;return D(w,(function(D){return apply(D,F,N)}))}))}))}function createPadding(D,w){var N=(w=void 0===w?" ":baseToString(w)).length;if(N<2)return N?baseRepeat(w,D):w;var F=baseRepeat(w,yn(D/stringSize(w)));return hasUnicode(w)?castSlice(stringToArray(F),0,D).join(""):F.slice(0,D)}function createRange(D){return function(w,F,k){return k&&"number"!=typeof k&&isIterateeCall(w,F,k)&&(F=k=void 0),w=toFinite(w),void 0===F?(F=w,w=0):F=toFinite(F),function baseRange(D,w,F,k){for(var j=-1,z=An(yn((w-D)/(F||1)),0),G=N(z);z--;)G[k?z:++j]=D,D+=F;return G}(w,F,k=void 0===k?w<F?1:-1:toFinite(k),D)}}function createRelationalOperation(D){return function(w,N){return"string"==typeof w&&"string"==typeof N||(w=toNumber(w),N=toNumber(N)),D(w,N)}}function createRecurry(D,w,N,F,k,j,z,G,H,X){var q=8&w;w|=q?32:64,4&(w&=~(q?64:32))||(w&=-4);var Z=[D,w,k,q?j:void 0,q?z:void 0,q?void 0:j,q?void 0:z,G,H,X],J=N.apply(void 0,Z);return isLaziable(D)&&_i(J,Z),J.placeholder=F,setWrapToString(J,D,w)}function createRound(D){var w=mt[D];return function(D,N){if(D=toNumber(D),(N=null==N?0:Pn(toInteger(N),292))&&Sn(D)){var F=(toString(D)+"e").split("e");return+((F=(toString(w(F[0]+"e"+(+F[1]+N)))+"e").split("e"))[0]+"e"+(+F[1]-N))}return w(D)}}var ui=kn&&1/setToArray(new kn([,-0]))[1]==1/0?function(D){return new kn(D)}:noop;function createToPairs(D){return function(w){var N=fi(w);return N==ie?mapToArray(w):N==fe?setToPairs(w):function baseToPairs(D,w){return arrayMap(w,(function(w){return[w,D[w]]}))}(w,D(w))}}function createWrap(D,w,F,k,G,H,X,q){var Z=2&w;if(!Z&&"function"!=typeof D)throw new bt(j);var J=k?k.length:0;if(J||(w&=-97,k=G=void 0),X=void 0===X?X:An(toInteger(X),0),q=void 0===q?q:toInteger(q),J-=G?G.length:0,64&w){var $=k,te=G;k=G=void 0}var ie=Z?void 0:li(D),oe=[D,w,F,k,G,$,te,H,X,q];if(ie&&function mergeData(D,w){var N=D[1],F=w[1],k=N|F,j=k<131,G=128==F&&8==N||128==F&&256==N&&D[7].length<=w[8]||384==F&&w[7].length<=w[8]&&8==N;if(!j&&!G)return D;1&F&&(D[2]=w[2],k|=1&N?0:4);var H=w[3];if(H){var X=D[3];D[3]=X?composeArgs(X,H,w[4]):H,D[4]=X?replaceHolders(D[3],z):w[4]}(H=w[5])&&(X=D[5],D[5]=X?composeArgsRight(X,H,w[6]):H,D[6]=X?replaceHolders(D[5],z):w[6]);(H=w[7])&&(D[7]=H);128&F&&(D[8]=null==D[8]?w[8]:Pn(D[8],w[8]));null==D[9]&&(D[9]=w[9]);return D[0]=w[0],D[1]=k,D}(oe,ie),D=oe[0],w=oe[1],F=oe[2],k=oe[3],G=oe[4],!(q=oe[9]=void 0===oe[9]?Z?0:D.length:An(oe[9]-J,0))&&24&w&&(w&=-25),w&&1!=w)ce=8==w||16==w?function createCurry(D,w,F){var k=createCtor(D);return function wrapper(){for(var j=arguments.length,z=N(j),G=j,H=getHolder(wrapper);G--;)z[G]=arguments[G];var X=j<3&&z[0]!==H&&z[j-1]!==H?[]:replaceHolders(z,H);if((j-=X.length)<F)return createRecurry(D,w,createHybrid,wrapper.placeholder,void 0,z,X,void 0,void 0,F-j);var q=this&&this!==qt&&this instanceof wrapper?k:D;return apply(q,this,z)}}(D,w,q):32!=w&&33!=w||G.length?createHybrid.apply(void 0,oe):function createPartial(D,w,F,k){var j=1&w,z=createCtor(D);return function wrapper(){for(var w=-1,G=arguments.length,H=-1,X=k.length,q=N(X+G),Z=this&&this!==qt&&this instanceof wrapper?z:D;++H<X;)q[H]=k[H];for(;G--;)q[H++]=arguments[++w];return apply(Z,j?F:this,q)}}(D,w,F,k);else var ce=function createBind(D,w,N){var F=1&w,k=createCtor(D);return function wrapper(){var w=this&&this!==qt&&this instanceof wrapper?k:D;return w.apply(F?N:this,arguments)}}(D,w,F);return setWrapToString((ie?ri:_i)(ce,oe),D,w)}function customDefaultsAssignIn(D,w,N,F){return void 0===D||eq(D,St[N])&&!At.call(F,N)?w:D}function customDefaultsMerge(D,w,N,F,k,j){return isObject(D)&&isObject(w)&&(j.set(w,D),baseMerge(D,w,void 0,customDefaultsMerge,j),j.delete(w)),D}function customOmitClone(D){return isPlainObject(D)?void 0:D}function equalArrays(D,w,N,F,k,j){var z=1&N,G=D.length,H=w.length;if(G!=H&&!(z&&H>G))return!1;var X=j.get(D);if(X&&j.get(w))return X==w;var q=-1,Z=!0,J=2&N?new SetCache:void 0;for(j.set(D,w),j.set(w,D);++q<G;){var $=D[q],te=w[q];if(F)var ie=z?F(te,$,q,w,D,j):F($,te,q,D,w,j);if(void 0!==ie){if(ie)continue;Z=!1;break}if(J){if(!arraySome(w,(function(D,w){if(!cacheHas(J,w)&&($===D||k($,D,N,F,j)))return J.push(w)}))){Z=!1;break}}else if($!==te&&!k($,te,N,F,j)){Z=!1;break}}return j.delete(D),j.delete(w),Z}function flatRest(D){return gi(overRest(D,void 0,flatten),D+"")}function getAllKeys(D){return baseGetAllKeys(D,keys,hi)}function getAllKeysIn(D){return baseGetAllKeys(D,keysIn,di)}var li=zn?function(D){return zn.get(D)}:noop;function getFuncName(D){for(var w=D.name+"",N=Gn[w],F=At.call(Gn,w)?N.length:0;F--;){var k=N[F],j=k.func;if(null==j||j==D)return k.name}return w}function getHolder(D){return(At.call(lodash,"placeholder")?lodash:D).placeholder}function getIteratee(){var D=lodash.iteratee||iteratee;return D=D===iteratee?baseIteratee:D,arguments.length?D(arguments[0],arguments[1]):D}function getMapData(D,w){var N=D.__data__;return function isKeyable(D){var w=typeof D;return"string"==w||"number"==w||"symbol"==w||"boolean"==w?"__proto__"!==D:null===D}(w)?N["string"==typeof w?"string":"hash"]:N.map}function getMatchData(D){for(var w=keys(D),N=w.length;N--;){var F=w[N],k=D[F];w[N]=[F,k,isStrictComparable(k)]}return w}function getNative(D,w){var N=function getValue(D,w){return null==D?void 0:D[w]}(D,w);return baseIsNative(N)?N:void 0}var hi=Tn?function(D){return null==D?[]:(D=gt(D),arrayFilter(Tn(D),(function(w){return Qt.call(D,w)})))}:stubArray,di=Tn?function(D){for(var w=[];D;)arrayPush(w,hi(D)),D=Ht(D);return w}:stubArray,fi=baseGetTag;function hasPath(D,w,N){for(var F=-1,k=(w=castPath(w,D)).length,j=!1;++F<k;){var z=toKey(w[F]);if(!(j=null!=D&&N(D,z)))break;D=D[z]}return j||++F!=k?j:!!(k=null==D?0:D.length)&&isLength(k)&&isIndex(z,k)&&(ir(D)||nr(D))}function initCloneObject(D){return"function"!=typeof D.constructor||isPrototype(D)?{}:$n(Ht(D))}function isFlattenable(D){return ir(D)||nr(D)||!!(Jt&&D&&D[Jt])}function isIndex(D,w){var N=typeof D;return!!(w=null==w?9007199254740991:w)&&("number"==N||"symbol"!=N&&ht.test(D))&&D>-1&&D%1==0&&D<w}function isIterateeCall(D,w,N){if(!isObject(N))return!1;var F=typeof w;return!!("number"==F?isArrayLike(N)&&isIndex(w,N.length):"string"==F&&w in N)&&eq(N[w],D)}function isKey(D,w){if(ir(D))return!1;var N=typeof D;return!("number"!=N&&"symbol"!=N&&"boolean"!=N&&null!=D&&!isSymbol(D))||(Ge.test(D)||!ze.test(D)||null!=w&&D in gt(w))}function isLaziable(D){var w=getFuncName(D),N=lodash[w];if("function"!=typeof N||!(w in LazyWrapper.prototype))return!1;if(D===N)return!0;var F=li(N);return!!F&&D===F[0]}(Nn&&fi(new Nn(new ArrayBuffer(1)))!=be||Fn&&fi(new Fn)!=ie||Bn&&"[object Promise]"!=fi(Bn.resolve())||kn&&fi(new kn)!=fe||Un&&fi(new Un)!=ve)&&(fi=function(D){var w=baseGetTag(D),N=w==ce?D.constructor:void 0,F=N?toSource(N):"";if(F)switch(F){case Yn:return be;case Hn:return ie;case Xn:return"[object Promise]";case Kn:return fe;case Qn:return ve}return w});var pi=Mt?isFunction:stubFalse;function isPrototype(D){var w=D&&D.constructor;return D===("function"==typeof w&&w.prototype||St)}function isStrictComparable(D){return D==D&&!isObject(D)}function matchesStrictComparable(D,w){return function(N){return null!=N&&(N[D]===w&&(void 0!==w||D in gt(N)))}}function overRest(D,w,F){return w=An(void 0===w?D.length-1:w,0),function(){for(var k=arguments,j=-1,z=An(k.length-w,0),G=N(z);++j<z;)G[j]=k[w+j];j=-1;for(var H=N(w+1);++j<w;)H[j]=k[j];return H[w]=F(G),apply(D,this,H)}}function parent(D,w){return w.length<2?D:baseGet(D,baseSlice(w,0,-1))}function reorder(D,w){for(var N=D.length,F=Pn(w.length,N),k=copyArray(D);F--;){var j=w[F];D[F]=isIndex(j,N)?k[j]:void 0}return D}function safeGet(D,w){if(("constructor"!==w||"function"!=typeof D[w])&&"__proto__"!=w)return D[w]}var _i=shortOut(ri),mi=vn||function(D,w){return qt.setTimeout(D,w)},gi=shortOut(oi);function setWrapToString(D,w,N){var F=w+"";return gi(D,function insertWrapDetails(D,w){var N=w.length;if(!N)return D;var F=N-1;return w[F]=(N>1?"& ":"")+w[F],w=w.join(N>2?", ":" "),D.replace(Ze,"{\n/* [wrapped with "+w+"] */\n")}(F,function updateWrapDetails(D,w){return arrayEach(G,(function(N){var F="_."+N[0];w&N[1]&&!arrayIncludes(D,F)&&D.push(F)})),D.sort()}(function getWrapDetails(D){var w=D.match(Je);return w?w[1].split($e):[]}(F),N)))}function shortOut(D){var w=0,N=0;return function(){var F=Cn(),k=16-(F-N);if(N=F,k>0){if(++w>=800)return arguments[0]}else w=0;return D.apply(void 0,arguments)}}function shuffleSelf(D,w){var N=-1,F=D.length,k=F-1;for(w=void 0===w?F:w;++N<w;){var j=baseRandom(N,k),z=D[j];D[j]=D[N],D[N]=z}return D.length=w,D}var vi=function memoizeCapped(D){var w=memoize(D,(function(D){return 500===N.size&&N.clear(),D})),N=w.cache;return w}((function(D){var w=[];return 46===D.charCodeAt(0)&&w.push(""),D.replace(Ye,(function(D,N,F,k){w.push(F?k.replace(tt,"$1"):N||D)})),w}));function toKey(D){if("string"==typeof D||isSymbol(D))return D;var w=D+"";return"0"==w&&1/D==-1/0?"-0":w}function toSource(D){if(null!=D){try{return xt.call(D)}catch(D){}try{return D+""}catch(D){}}return""}function wrapperClone(D){if(D instanceof LazyWrapper)return D.clone();var w=new LodashWrapper(D.__wrapped__,D.__chain__);return w.__actions__=copyArray(D.__actions__),w.__index__=D.__index__,w.__values__=D.__values__,w}var yi=baseRest((function(D,w){return isArrayLikeObject(D)?baseDifference(D,baseFlatten(w,1,isArrayLikeObject,!0)):[]})),bi=baseRest((function(D,w){var N=last(w);return isArrayLikeObject(N)&&(N=void 0),isArrayLikeObject(D)?baseDifference(D,baseFlatten(w,1,isArrayLikeObject,!0),getIteratee(N,2)):[]})),Ti=baseRest((function(D,w){var N=last(w);return isArrayLikeObject(N)&&(N=void 0),isArrayLikeObject(D)?baseDifference(D,baseFlatten(w,1,isArrayLikeObject,!0),void 0,N):[]}));function findIndex(D,w,N){var F=null==D?0:D.length;if(!F)return-1;var k=null==N?0:toInteger(N);return k<0&&(k=An(F+k,0)),baseFindIndex(D,getIteratee(w,3),k)}function findLastIndex(D,w,N){var F=null==D?0:D.length;if(!F)return-1;var k=F-1;return void 0!==N&&(k=toInteger(N),k=N<0?An(F+k,0):Pn(k,F-1)),baseFindIndex(D,getIteratee(w,3),k,!0)}function flatten(D){return(null==D?0:D.length)?baseFlatten(D,1):[]}function head(D){return D&&D.length?D[0]:void 0}var Ei=baseRest((function(D){var w=arrayMap(D,castArrayLikeObject);return w.length&&w[0]===D[0]?baseIntersection(w):[]})),Si=baseRest((function(D){var w=last(D),N=arrayMap(D,castArrayLikeObject);return w===last(N)?w=void 0:N.pop(),N.length&&N[0]===D[0]?baseIntersection(N,getIteratee(w,2)):[]})),Mi=baseRest((function(D){var w=last(D),N=arrayMap(D,castArrayLikeObject);return(w="function"==typeof w?w:void 0)&&N.pop(),N.length&&N[0]===D[0]?baseIntersection(N,void 0,w):[]}));function last(D){var w=null==D?0:D.length;return w?D[w-1]:void 0}var xi=baseRest(pullAll);function pullAll(D,w){return D&&D.length&&w&&w.length?basePullAll(D,w):D}var Ai=flatRest((function(D,w){var N=null==D?0:D.length,F=baseAt(D,w);return basePullAt(D,arrayMap(w,(function(D){return isIndex(D,N)?+D:D})).sort(compareAscending)),F}));function reverse(D){return null==D?D:Ln.call(D)}var Pi=baseRest((function(D){return baseUniq(baseFlatten(D,1,isArrayLikeObject,!0))})),Ci=baseRest((function(D){var w=last(D);return isArrayLikeObject(w)&&(w=void 0),baseUniq(baseFlatten(D,1,isArrayLikeObject,!0),getIteratee(w,2))})),Oi=baseRest((function(D){var w=last(D);return w="function"==typeof w?w:void 0,baseUniq(baseFlatten(D,1,isArrayLikeObject,!0),void 0,w)}));function unzip(D){if(!D||!D.length)return[];var w=0;return D=arrayFilter(D,(function(D){if(isArrayLikeObject(D))return w=An(D.length,w),!0})),baseTimes(w,(function(w){return arrayMap(D,baseProperty(w))}))}function unzipWith(D,w){if(!D||!D.length)return[];var N=unzip(D);return null==w?N:arrayMap(N,(function(D){return apply(w,void 0,D)}))}var Ri=baseRest((function(D,w){return isArrayLikeObject(D)?baseDifference(D,w):[]})),Di=baseRest((function(D){return baseXor(arrayFilter(D,isArrayLikeObject))})),Ii=baseRest((function(D){var w=last(D);return isArrayLikeObject(w)&&(w=void 0),baseXor(arrayFilter(D,isArrayLikeObject),getIteratee(w,2))})),Li=baseRest((function(D){var w=last(D);return w="function"==typeof w?w:void 0,baseXor(arrayFilter(D,isArrayLikeObject),void 0,w)})),wi=baseRest(unzip);var Ni=baseRest((function(D){var w=D.length,N=w>1?D[w-1]:void 0;return N="function"==typeof N?(D.pop(),N):void 0,unzipWith(D,N)}));function chain(D){var w=lodash(D);return w.__chain__=!0,w}function thru(D,w){return w(D)}var Fi=flatRest((function(D){var w=D.length,N=w?D[0]:0,F=this.__wrapped__,interceptor=function(w){return baseAt(w,D)};return!(w>1||this.__actions__.length)&&F instanceof LazyWrapper&&isIndex(N)?((F=F.slice(N,+N+(w?1:0))).__actions__.push({func:thru,args:[interceptor],thisArg:void 0}),new LodashWrapper(F,this.__chain__).thru((function(D){return w&&!D.length&&D.push(void 0),D}))):this.thru(interceptor)}));var Bi=createAggregator((function(D,w,N){At.call(D,N)?++D[N]:baseAssignValue(D,N,1)}));var ki=createFind(findIndex),Ui=createFind(findLastIndex);function forEach(D,w){return(ir(D)?arrayEach:ei)(D,getIteratee(w,3))}function forEachRight(D,w){return(ir(D)?arrayEachRight:ti)(D,getIteratee(w,3))}var Vi=createAggregator((function(D,w,N){At.call(D,N)?D[N].push(w):baseAssignValue(D,N,[w])}));var ji=baseRest((function(D,w,F){var k=-1,j="function"==typeof w,z=isArrayLike(D)?N(D.length):[];return ei(D,(function(D){z[++k]=j?apply(w,D,F):baseInvoke(D,w,F)})),z})),zi=createAggregator((function(D,w,N){baseAssignValue(D,N,w)}));function map(D,w){return(ir(D)?arrayMap:baseMap)(D,getIteratee(w,3))}var Gi=createAggregator((function(D,w,N){D[N?0:1].push(w)}),(function(){return[[],[]]}));var Yi=baseRest((function(D,w){if(null==D)return[];var N=w.length;return N>1&&isIterateeCall(D,w[0],w[1])?w=[]:N>2&&isIterateeCall(w[0],w[1],w[2])&&(w=[w[0]]),baseOrderBy(D,baseFlatten(w,1),[])})),Hi=gn||function(){return qt.Date.now()};function ary(D,w,N){return w=N?void 0:w,createWrap(D,128,void 0,void 0,void 0,void 0,w=D&&null==w?D.length:w)}function before(D,w){var N;if("function"!=typeof w)throw new bt(j);return D=toInteger(D),function(){return--D>0&&(N=w.apply(this,arguments)),D<=1&&(w=void 0),N}}var Wi=baseRest((function(D,w,N){var F=1;if(N.length){var k=replaceHolders(N,getHolder(Wi));F|=32}return createWrap(D,F,w,N,k)})),Xi=baseRest((function(D,w,N){var F=3;if(N.length){var k=replaceHolders(N,getHolder(Xi));F|=32}return createWrap(w,F,D,N,k)}));function debounce(D,w,N){var F,k,z,G,H,X,q=0,Z=!1,J=!1,$=!0;if("function"!=typeof D)throw new bt(j);function invokeFunc(w){var N=F,j=k;return F=k=void 0,q=w,G=D.apply(j,N)}function leadingEdge(D){return q=D,H=mi(timerExpired,w),Z?invokeFunc(D):G}function shouldInvoke(D){var N=D-X;return void 0===X||N>=w||N<0||J&&D-q>=z}function timerExpired(){var D=Hi();if(shouldInvoke(D))return trailingEdge(D);H=mi(timerExpired,function remainingWait(D){var N=w-(D-X);return J?Pn(N,z-(D-q)):N}(D))}function trailingEdge(D){return H=void 0,$&&F?invokeFunc(D):(F=k=void 0,G)}function debounced(){var D=Hi(),N=shouldInvoke(D);if(F=arguments,k=this,X=D,N){if(void 0===H)return leadingEdge(X);if(J)return si(H),H=mi(timerExpired,w),invokeFunc(X)}return void 0===H&&(H=mi(timerExpired,w)),G}return w=toNumber(w)||0,isObject(N)&&(Z=!!N.leading,z=(J="maxWait"in N)?An(toNumber(N.maxWait)||0,w):z,$="trailing"in N?!!N.trailing:$),debounced.cancel=function cancel(){void 0!==H&&si(H),q=0,F=X=k=H=void 0},debounced.flush=function flush(){return void 0===H?G:trailingEdge(Hi())},debounced}var Ki=baseRest((function(D,w){return baseDelay(D,1,w)})),Qi=baseRest((function(D,w,N){return baseDelay(D,toNumber(w)||0,N)}));function memoize(D,w){if("function"!=typeof D||null!=w&&"function"!=typeof w)throw new bt(j);var memoized=function(){var N=arguments,F=w?w.apply(this,N):N[0],k=memoized.cache;if(k.has(F))return k.get(F);var j=D.apply(this,N);return memoized.cache=k.set(F,j)||k,j};return memoized.cache=new(memoize.Cache||MapCache),memoized}function negate(D){if("function"!=typeof D)throw new bt(j);return function(){var w=arguments;switch(w.length){case 0:return!D.call(this);case 1:return!D.call(this,w[0]);case 2:return!D.call(this,w[0],w[1]);case 3:return!D.call(this,w[0],w[1],w[2])}return!D.apply(this,w)}}memoize.Cache=MapCache;var qi=ai((function(D,w){var N=(w=1==w.length&&ir(w[0])?arrayMap(w[0],baseUnary(getIteratee())):arrayMap(baseFlatten(w,1),baseUnary(getIteratee()))).length;return baseRest((function(F){for(var k=-1,j=Pn(F.length,N);++k<j;)F[k]=w[k].call(this,F[k]);return apply(D,this,F)}))})),Zi=baseRest((function(D,w){return createWrap(D,32,void 0,w,replaceHolders(w,getHolder(Zi)))})),Ji=baseRest((function(D,w){return createWrap(D,64,void 0,w,replaceHolders(w,getHolder(Ji)))})),$i=flatRest((function(D,w){return createWrap(D,256,void 0,void 0,void 0,w)}));function eq(D,w){return D===w||D!=D&&w!=w}var er=createRelationalOperation(baseGt),tr=createRelationalOperation((function(D,w){return D>=w})),nr=baseIsArguments(function(){return arguments}())?baseIsArguments:function(D){return isObjectLike(D)&&At.call(D,"callee")&&!Qt.call(D,"callee")},ir=N.isArray,rr=nn?baseUnary(nn):function baseIsArrayBuffer(D){return isObjectLike(D)&&baseGetTag(D)==ye};function isArrayLike(D){return null!=D&&isLength(D.length)&&!isFunction(D)}function isArrayLikeObject(D){return isObjectLike(D)&&isArrayLike(D)}var or=En||stubFalse,ar=rn?baseUnary(rn):function baseIsDate(D){return isObjectLike(D)&&baseGetTag(D)==Z};function isError(D){if(!isObjectLike(D))return!1;var w=baseGetTag(D);return w==J||"[object DOMException]"==w||"string"==typeof D.message&&"string"==typeof D.name&&!isPlainObject(D)}function isFunction(D){if(!isObject(D))return!1;var w=baseGetTag(D);return w==$||w==te||"[object AsyncFunction]"==w||"[object Proxy]"==w}function isInteger(D){return"number"==typeof D&&D==toInteger(D)}function isLength(D){return"number"==typeof D&&D>-1&&D%1==0&&D<=9007199254740991}function isObject(D){var w=typeof D;return null!=D&&("object"==w||"function"==w)}function isObjectLike(D){return null!=D&&"object"==typeof D}var sr=on?baseUnary(on):function baseIsMap(D){return isObjectLike(D)&&fi(D)==ie};function isNumber(D){return"number"==typeof D||isObjectLike(D)&&baseGetTag(D)==oe}function isPlainObject(D){if(!isObjectLike(D)||baseGetTag(D)!=ce)return!1;var w=Ht(D);if(null===w)return!0;var N=At.call(w,"constructor")&&w.constructor;return"function"==typeof N&&N instanceof N&&xt.call(N)==Rt}var cr=an?baseUnary(an):function baseIsRegExp(D){return isObjectLike(D)&&baseGetTag(D)==he};var ur=sn?baseUnary(sn):function baseIsSet(D){return isObjectLike(D)&&fi(D)==fe};function isString(D){return"string"==typeof D||!ir(D)&&isObjectLike(D)&&baseGetTag(D)==pe}function isSymbol(D){return"symbol"==typeof D||isObjectLike(D)&&baseGetTag(D)==_e}var lr=cn?baseUnary(cn):function baseIsTypedArray(D){return isObjectLike(D)&&isLength(D.length)&&!!Gt[baseGetTag(D)]};var hr=createRelationalOperation(baseLt),dr=createRelationalOperation((function(D,w){return D<=w}));function toArray(D){if(!D)return[];if(isArrayLike(D))return isString(D)?stringToArray(D):copyArray(D);if(en&&D[en])return function iteratorToArray(D){for(var w,N=[];!(w=D.next()).done;)N.push(w.value);return N}(D[en]());var w=fi(D);return(w==ie?mapToArray:w==fe?setToArray:values)(D)}function toFinite(D){return D?(D=toNumber(D))===1/0||D===-1/0?17976931348623157e292*(D<0?-1:1):D==D?D:0:0===D?D:0}function toInteger(D){var w=toFinite(D),N=w%1;return w==w?N?w-N:w:0}function toLength(D){return D?baseClamp(toInteger(D),0,4294967295):0}function toNumber(D){if("number"==typeof D)return D;if(isSymbol(D))return NaN;if(isObject(D)){var w="function"==typeof D.valueOf?D.valueOf():D;D=isObject(w)?w+"":w}if("string"!=typeof D)return 0===D?D:+D;D=D.replace(Xe,"");var N=st.test(D);return N||lt.test(D)?Xt(D.slice(2),N?2:8):at.test(D)?NaN:+D}function toPlainObject(D){return copyObject(D,keysIn(D))}function toString(D){return null==D?"":baseToString(D)}var fr=createAssigner((function(D,w){if(isPrototype(w)||isArrayLike(w))copyObject(w,keys(w),D);else for(var N in w)At.call(w,N)&&assignValue(D,N,w[N])})),pr=createAssigner((function(D,w){copyObject(w,keysIn(w),D)})),_r=createAssigner((function(D,w,N,F){copyObject(w,keysIn(w),D,F)})),mr=createAssigner((function(D,w,N,F){copyObject(w,keys(w),D,F)})),gr=flatRest(baseAt);var vr=baseRest((function(D,w){D=gt(D);var N=-1,F=w.length,k=F>2?w[2]:void 0;for(k&&isIterateeCall(w[0],w[1],k)&&(F=1);++N<F;)for(var j=w[N],z=keysIn(j),G=-1,H=z.length;++G<H;){var X=z[G],q=D[X];(void 0===q||eq(q,St[X])&&!At.call(D,X))&&(D[X]=j[X])}return D})),yr=baseRest((function(D){return D.push(void 0,customDefaultsMerge),apply(xr,void 0,D)}));function get(D,w,N){var F=null==D?void 0:baseGet(D,w);return void 0===F?N:F}function hasIn(D,w){return null!=D&&hasPath(D,w,baseHasIn)}var Tr=createInverter((function(D,w,N){null!=w&&"function"!=typeof w.toString&&(w=Ot.call(w)),D[w]=N}),constant(identity)),Er=createInverter((function(D,w,N){null!=w&&"function"!=typeof w.toString&&(w=Ot.call(w)),At.call(D,w)?D[w].push(N):D[w]=[N]}),getIteratee),Sr=baseRest(baseInvoke);function keys(D){return isArrayLike(D)?arrayLikeKeys(D):baseKeys(D)}function keysIn(D){return isArrayLike(D)?arrayLikeKeys(D,!0):baseKeysIn(D)}var Mr=createAssigner((function(D,w,N){baseMerge(D,w,N)})),xr=createAssigner((function(D,w,N,F){baseMerge(D,w,N,F)})),Ar=flatRest((function(D,w){var N={};if(null==D)return N;var F=!1;w=arrayMap(w,(function(w){return w=castPath(w,D),F||(F=w.length>1),w})),copyObject(D,getAllKeysIn(D),N),F&&(N=baseClone(N,7,customOmitClone));for(var k=w.length;k--;)baseUnset(N,w[k]);return N}));var Pr=flatRest((function(D,w){return null==D?{}:function basePick(D,w){return basePickBy(D,w,(function(w,N){return hasIn(D,N)}))}(D,w)}));function pickBy(D,w){if(null==D)return{};var N=arrayMap(getAllKeysIn(D),(function(D){return[D]}));return w=getIteratee(w),basePickBy(D,N,(function(D,N){return w(D,N[0])}))}var Cr=createToPairs(keys),Or=createToPairs(keysIn);function values(D){return null==D?[]:baseValues(D,keys(D))}var Rr=createCompounder((function(D,w,N){return w=w.toLowerCase(),D+(N?capitalize(w):w)}));function capitalize(D){return Br(toString(D).toLowerCase())}function deburr(D){return(D=toString(D))&&D.replace(dt,ln).replace(Ft,"")}var Dr=createCompounder((function(D,w,N){return D+(N?"-":"")+w.toLowerCase()})),Ir=createCompounder((function(D,w,N){return D+(N?" ":"")+w.toLowerCase()})),Lr=createCaseFirst("toLowerCase");var wr=createCompounder((function(D,w,N){return D+(N?"_":"")+w.toLowerCase()}));var Nr=createCompounder((function(D,w,N){return D+(N?" ":"")+Br(w)}));var Fr=createCompounder((function(D,w,N){return D+(N?" ":"")+w.toUpperCase()})),Br=createCaseFirst("toUpperCase");function words(D,w,N){return D=toString(D),void 0===(w=N?void 0:w)?function hasUnicodeWord(D){return Vt.test(D)}(D)?function unicodeWords(D){return D.match(kt)||[]}(D):function asciiWords(D){return D.match(et)||[]}(D):D.match(w)||[]}var kr=baseRest((function(D,w){try{return apply(D,void 0,w)}catch(D){return isError(D)?D:new k(D)}})),Ur=flatRest((function(D,w){return arrayEach(w,(function(w){w=toKey(w),baseAssignValue(D,w,Wi(D[w],D))})),D}));function constant(D){return function(){return D}}var Vr=createFlow(),jr=createFlow(!0);function identity(D){return D}function iteratee(D){return baseIteratee("function"==typeof D?D:baseClone(D,1))}var zr=baseRest((function(D,w){return function(N){return baseInvoke(N,D,w)}})),Gr=baseRest((function(D,w){return function(N){return baseInvoke(D,N,w)}}));function mixin(D,w,N){var F=keys(w),k=baseFunctions(w,F);null!=N||isObject(w)&&(k.length||!F.length)||(N=w,w=D,D=this,k=baseFunctions(w,keys(w)));var j=!(isObject(N)&&"chain"in N&&!N.chain),z=isFunction(D);return arrayEach(k,(function(N){var F=w[N];D[N]=F,z&&(D.prototype[N]=function(){var w=this.__chain__;if(j||w){var N=D(this.__wrapped__),k=N.__actions__=copyArray(this.__actions__);return k.push({func:F,args:arguments,thisArg:D}),N.__chain__=w,N}return F.apply(D,arrayPush([this.value()],arguments))})})),D}function noop(){}var Yr=createOver(arrayMap),Hr=createOver(arrayEvery),Wr=createOver(arraySome);function property(D){return isKey(D)?baseProperty(toKey(D)):function basePropertyDeep(D){return function(w){return baseGet(w,D)}}(D)}var Xr=createRange(),Kr=createRange(!0);function stubArray(){return[]}function stubFalse(){return!1}var Qr=createMathOperation((function(D,w){return D+w}),0),qr=createRound("ceil"),Zr=createMathOperation((function(D,w){return D/w}),1),Jr=createRound("floor");var $r,eo=createMathOperation((function(D,w){return D*w}),1),no=createRound("round"),io=createMathOperation((function(D,w){return D-w}),0);return lodash.after=function after(D,w){if("function"!=typeof w)throw new bt(j);return D=toInteger(D),function(){if(--D<1)return w.apply(this,arguments)}},lodash.ary=ary,lodash.assign=fr,lodash.assignIn=pr,lodash.assignInWith=_r,lodash.assignWith=mr,lodash.at=gr,lodash.before=before,lodash.bind=Wi,lodash.bindAll=Ur,lodash.bindKey=Xi,lodash.castArray=function castArray(){if(!arguments.length)return[];var D=arguments[0];return ir(D)?D:[D]},lodash.chain=chain,lodash.chunk=function chunk(D,w,F){w=(F?isIterateeCall(D,w,F):void 0===w)?1:An(toInteger(w),0);var k=null==D?0:D.length;if(!k||w<1)return[];for(var j=0,z=0,G=N(yn(k/w));j<k;)G[z++]=baseSlice(D,j,j+=w);return G},lodash.compact=function compact(D){for(var w=-1,N=null==D?0:D.length,F=0,k=[];++w<N;){var j=D[w];j&&(k[F++]=j)}return k},lodash.concat=function concat(){var D=arguments.length;if(!D)return[];for(var w=N(D-1),F=arguments[0],k=D;k--;)w[k-1]=arguments[k];return arrayPush(ir(F)?copyArray(F):[F],baseFlatten(w,1))},lodash.cond=function cond(D){var w=null==D?0:D.length,N=getIteratee();return D=w?arrayMap(D,(function(D){if("function"!=typeof D[1])throw new bt(j);return[N(D[0]),D[1]]})):[],baseRest((function(N){for(var F=-1;++F<w;){var k=D[F];if(apply(k[0],this,N))return apply(k[1],this,N)}}))},lodash.conforms=function conforms(D){return function baseConforms(D){var w=keys(D);return function(N){return baseConformsTo(N,D,w)}}(baseClone(D,1))},lodash.constant=constant,lodash.countBy=Bi,lodash.create=function create(D,w){var N=$n(D);return null==w?N:baseAssign(N,w)},lodash.curry=function curry(D,w,N){var F=createWrap(D,8,void 0,void 0,void 0,void 0,void 0,w=N?void 0:w);return F.placeholder=curry.placeholder,F},lodash.curryRight=function curryRight(D,w,N){var F=createWrap(D,16,void 0,void 0,void 0,void 0,void 0,w=N?void 0:w);return F.placeholder=curryRight.placeholder,F},lodash.debounce=debounce,lodash.defaults=vr,lodash.defaultsDeep=yr,lodash.defer=Ki,lodash.delay=Qi,lodash.difference=yi,lodash.differenceBy=bi,lodash.differenceWith=Ti,lodash.drop=function drop(D,w,N){var F=null==D?0:D.length;return F?baseSlice(D,(w=N||void 0===w?1:toInteger(w))<0?0:w,F):[]},lodash.dropRight=function dropRight(D,w,N){var F=null==D?0:D.length;return F?baseSlice(D,0,(w=F-(w=N||void 0===w?1:toInteger(w)))<0?0:w):[]},lodash.dropRightWhile=function dropRightWhile(D,w){return D&&D.length?baseWhile(D,getIteratee(w,3),!0,!0):[]},lodash.dropWhile=function dropWhile(D,w){return D&&D.length?baseWhile(D,getIteratee(w,3),!0):[]},lodash.fill=function fill(D,w,N,F){var k=null==D?0:D.length;return k?(N&&"number"!=typeof N&&isIterateeCall(D,w,N)&&(N=0,F=k),function baseFill(D,w,N,F){var k=D.length;for((N=toInteger(N))<0&&(N=-N>k?0:k+N),(F=void 0===F||F>k?k:toInteger(F))<0&&(F+=k),F=N>F?0:toLength(F);N<F;)D[N++]=w;return D}(D,w,N,F)):[]},lodash.filter=function filter(D,w){return(ir(D)?arrayFilter:baseFilter)(D,getIteratee(w,3))},lodash.flatMap=function flatMap(D,w){return baseFlatten(map(D,w),1)},lodash.flatMapDeep=function flatMapDeep(D,w){return baseFlatten(map(D,w),1/0)},lodash.flatMapDepth=function flatMapDepth(D,w,N){return N=void 0===N?1:toInteger(N),baseFlatten(map(D,w),N)},lodash.flatten=flatten,lodash.flattenDeep=function flattenDeep(D){return(null==D?0:D.length)?baseFlatten(D,1/0):[]},lodash.flattenDepth=function flattenDepth(D,w){return(null==D?0:D.length)?baseFlatten(D,w=void 0===w?1:toInteger(w)):[]},lodash.flip=function flip(D){return createWrap(D,512)},lodash.flow=Vr,lodash.flowRight=jr,lodash.fromPairs=function fromPairs(D){for(var w=-1,N=null==D?0:D.length,F={};++w<N;){var k=D[w];F[k[0]]=k[1]}return F},lodash.functions=function functions(D){return null==D?[]:baseFunctions(D,keys(D))},lodash.functionsIn=function functionsIn(D){return null==D?[]:baseFunctions(D,keysIn(D))},lodash.groupBy=Vi,lodash.initial=function initial(D){return(null==D?0:D.length)?baseSlice(D,0,-1):[]},lodash.intersection=Ei,lodash.intersectionBy=Si,lodash.intersectionWith=Mi,lodash.invert=Tr,lodash.invertBy=Er,lodash.invokeMap=ji,lodash.iteratee=iteratee,lodash.keyBy=zi,lodash.keys=keys,lodash.keysIn=keysIn,lodash.map=map,lodash.mapKeys=function mapKeys(D,w){var N={};return w=getIteratee(w,3),baseForOwn(D,(function(D,F,k){baseAssignValue(N,w(D,F,k),D)})),N},lodash.mapValues=function mapValues(D,w){var N={};return w=getIteratee(w,3),baseForOwn(D,(function(D,F,k){baseAssignValue(N,F,w(D,F,k))})),N},lodash.matches=function matches(D){return baseMatches(baseClone(D,1))},lodash.matchesProperty=function matchesProperty(D,w){return baseMatchesProperty(D,baseClone(w,1))},lodash.memoize=memoize,lodash.merge=Mr,lodash.mergeWith=xr,lodash.method=zr,lodash.methodOf=Gr,lodash.mixin=mixin,lodash.negate=negate,lodash.nthArg=function nthArg(D){return D=toInteger(D),baseRest((function(w){return baseNth(w,D)}))},lodash.omit=Ar,lodash.omitBy=function omitBy(D,w){return pickBy(D,negate(getIteratee(w)))},lodash.once=function once(D){return before(2,D)},lodash.orderBy=function orderBy(D,w,N,F){return null==D?[]:(ir(w)||(w=null==w?[]:[w]),ir(N=F?void 0:N)||(N=null==N?[]:[N]),baseOrderBy(D,w,N))},lodash.over=Yr,lodash.overArgs=qi,lodash.overEvery=Hr,lodash.overSome=Wr,lodash.partial=Zi,lodash.partialRight=Ji,lodash.partition=Gi,lodash.pick=Pr,lodash.pickBy=pickBy,lodash.property=property,lodash.propertyOf=function propertyOf(D){return function(w){return null==D?void 0:baseGet(D,w)}},lodash.pull=xi,lodash.pullAll=pullAll,lodash.pullAllBy=function pullAllBy(D,w,N){return D&&D.length&&w&&w.length?basePullAll(D,w,getIteratee(N,2)):D},lodash.pullAllWith=function pullAllWith(D,w,N){return D&&D.length&&w&&w.length?basePullAll(D,w,void 0,N):D},lodash.pullAt=Ai,lodash.range=Xr,lodash.rangeRight=Kr,lodash.rearg=$i,lodash.reject=function reject(D,w){return(ir(D)?arrayFilter:baseFilter)(D,negate(getIteratee(w,3)))},lodash.remove=function remove(D,w){var N=[];if(!D||!D.length)return N;var F=-1,k=[],j=D.length;for(w=getIteratee(w,3);++F<j;){var z=D[F];w(z,F,D)&&(N.push(z),k.push(F))}return basePullAt(D,k),N},lodash.rest=function rest(D,w){if("function"!=typeof D)throw new bt(j);return baseRest(D,w=void 0===w?w:toInteger(w))},lodash.reverse=reverse,lodash.sampleSize=function sampleSize(D,w,N){return w=(N?isIterateeCall(D,w,N):void 0===w)?1:toInteger(w),(ir(D)?arraySampleSize:baseSampleSize)(D,w)},lodash.set=function set(D,w,N){return null==D?D:baseSet(D,w,N)},lodash.setWith=function setWith(D,w,N,F){return F="function"==typeof F?F:void 0,null==D?D:baseSet(D,w,N,F)},lodash.shuffle=function shuffle(D){return(ir(D)?arrayShuffle:baseShuffle)(D)},lodash.slice=function slice(D,w,N){var F=null==D?0:D.length;return F?(N&&"number"!=typeof N&&isIterateeCall(D,w,N)?(w=0,N=F):(w=null==w?0:toInteger(w),N=void 0===N?F:toInteger(N)),baseSlice(D,w,N)):[]},lodash.sortBy=Yi,lodash.sortedUniq=function sortedUniq(D){return D&&D.length?baseSortedUniq(D):[]},lodash.sortedUniqBy=function sortedUniqBy(D,w){return D&&D.length?baseSortedUniq(D,getIteratee(w,2)):[]},lodash.split=function split(D,w,N){return N&&"number"!=typeof N&&isIterateeCall(D,w,N)&&(w=N=void 0),(N=void 0===N?4294967295:N>>>0)?(D=toString(D))&&("string"==typeof w||null!=w&&!cr(w))&&!(w=baseToString(w))&&hasUnicode(D)?castSlice(stringToArray(D),0,N):D.split(w,N):[]},lodash.spread=function spread(D,w){if("function"!=typeof D)throw new bt(j);return w=null==w?0:An(toInteger(w),0),baseRest((function(N){var F=N[w],k=castSlice(N,0,w);return F&&arrayPush(k,F),apply(D,this,k)}))},lodash.tail=function tail(D){var w=null==D?0:D.length;return w?baseSlice(D,1,w):[]},lodash.take=function take(D,w,N){return D&&D.length?baseSlice(D,0,(w=N||void 0===w?1:toInteger(w))<0?0:w):[]},lodash.takeRight=function takeRight(D,w,N){var F=null==D?0:D.length;return F?baseSlice(D,(w=F-(w=N||void 0===w?1:toInteger(w)))<0?0:w,F):[]},lodash.takeRightWhile=function takeRightWhile(D,w){return D&&D.length?baseWhile(D,getIteratee(w,3),!1,!0):[]},lodash.takeWhile=function takeWhile(D,w){return D&&D.length?baseWhile(D,getIteratee(w,3)):[]},lodash.tap=function tap(D,w){return w(D),D},lodash.throttle=function throttle(D,w,N){var F=!0,k=!0;if("function"!=typeof D)throw new bt(j);return isObject(N)&&(F="leading"in N?!!N.leading:F,k="trailing"in N?!!N.trailing:k),debounce(D,w,{leading:F,maxWait:w,trailing:k})},lodash.thru=thru,lodash.toArray=toArray,lodash.toPairs=Cr,lodash.toPairsIn=Or,lodash.toPath=function toPath(D){return ir(D)?arrayMap(D,toKey):isSymbol(D)?[D]:copyArray(vi(toString(D)))},lodash.toPlainObject=toPlainObject,lodash.transform=function transform(D,w,N){var F=ir(D),k=F||or(D)||lr(D);if(w=getIteratee(w,4),null==N){var j=D&&D.constructor;N=k?F?new j:[]:isObject(D)&&isFunction(j)?$n(Ht(D)):{}}return(k?arrayEach:baseForOwn)(D,(function(D,F,k){return w(N,D,F,k)})),N},lodash.unary=function unary(D){return ary(D,1)},lodash.union=Pi,lodash.unionBy=Ci,lodash.unionWith=Oi,lodash.uniq=function uniq(D){return D&&D.length?baseUniq(D):[]},lodash.uniqBy=function uniqBy(D,w){return D&&D.length?baseUniq(D,getIteratee(w,2)):[]},lodash.uniqWith=function uniqWith(D,w){return w="function"==typeof w?w:void 0,D&&D.length?baseUniq(D,void 0,w):[]},lodash.unset=function unset(D,w){return null==D||baseUnset(D,w)},lodash.unzip=unzip,lodash.unzipWith=unzipWith,lodash.update=function update(D,w,N){return null==D?D:baseUpdate(D,w,castFunction(N))},lodash.updateWith=function updateWith(D,w,N,F){return F="function"==typeof F?F:void 0,null==D?D:baseUpdate(D,w,castFunction(N),F)},lodash.values=values,lodash.valuesIn=function valuesIn(D){return null==D?[]:baseValues(D,keysIn(D))},lodash.without=Ri,lodash.words=words,lodash.wrap=function wrap(D,w){return Zi(castFunction(w),D)},lodash.xor=Di,lodash.xorBy=Ii,lodash.xorWith=Li,lodash.zip=wi,lodash.zipObject=function zipObject(D,w){return baseZipObject(D||[],w||[],assignValue)},lodash.zipObjectDeep=function zipObjectDeep(D,w){return baseZipObject(D||[],w||[],baseSet)},lodash.zipWith=Ni,lodash.entries=Cr,lodash.entriesIn=Or,lodash.extend=pr,lodash.extendWith=_r,mixin(lodash,lodash),lodash.add=Qr,lodash.attempt=kr,lodash.camelCase=Rr,lodash.capitalize=capitalize,lodash.ceil=qr,lodash.clamp=function clamp(D,w,N){return void 0===N&&(N=w,w=void 0),void 0!==N&&(N=(N=toNumber(N))==N?N:0),void 0!==w&&(w=(w=toNumber(w))==w?w:0),baseClamp(toNumber(D),w,N)},lodash.clone=function clone(D){return baseClone(D,4)},lodash.cloneDeep=function cloneDeep(D){return baseClone(D,5)},lodash.cloneDeepWith=function cloneDeepWith(D,w){return baseClone(D,5,w="function"==typeof w?w:void 0)},lodash.cloneWith=function cloneWith(D,w){return baseClone(D,4,w="function"==typeof w?w:void 0)},lodash.conformsTo=function conformsTo(D,w){return null==w||baseConformsTo(D,w,keys(w))},lodash.deburr=deburr,lodash.defaultTo=function defaultTo(D,w){return null==D||D!=D?w:D},lodash.divide=Zr,lodash.endsWith=function endsWith(D,w,N){D=toString(D),w=baseToString(w);var F=D.length,k=N=void 0===N?F:baseClamp(toInteger(N),0,F);return(N-=w.length)>=0&&D.slice(N,k)==w},lodash.eq=eq,lodash.escape=function escape(D){return(D=toString(D))&&Fe.test(D)?D.replace(we,hn):D},lodash.escapeRegExp=function escapeRegExp(D){return(D=toString(D))&&We.test(D)?D.replace(He,"\\$&"):D},lodash.every=function every(D,w,N){var F=ir(D)?arrayEvery:baseEvery;return N&&isIterateeCall(D,w,N)&&(w=void 0),F(D,getIteratee(w,3))},lodash.find=ki,lodash.findIndex=findIndex,lodash.findKey=function findKey(D,w){return baseFindKey(D,getIteratee(w,3),baseForOwn)},lodash.findLast=Ui,lodash.findLastIndex=findLastIndex,lodash.findLastKey=function findLastKey(D,w){return baseFindKey(D,getIteratee(w,3),baseForOwnRight)},lodash.floor=Jr,lodash.forEach=forEach,lodash.forEachRight=forEachRight,lodash.forIn=function forIn(D,w){return null==D?D:ni(D,getIteratee(w,3),keysIn)},lodash.forInRight=function forInRight(D,w){return null==D?D:ii(D,getIteratee(w,3),keysIn)},lodash.forOwn=function forOwn(D,w){return D&&baseForOwn(D,getIteratee(w,3))},lodash.forOwnRight=function forOwnRight(D,w){return D&&baseForOwnRight(D,getIteratee(w,3))},lodash.get=get,lodash.gt=er,lodash.gte=tr,lodash.has=function has(D,w){return null!=D&&hasPath(D,w,baseHas)},lodash.hasIn=hasIn,lodash.head=head,lodash.identity=identity,lodash.includes=function includes(D,w,N,F){D=isArrayLike(D)?D:values(D),N=N&&!F?toInteger(N):0;var k=D.length;return N<0&&(N=An(k+N,0)),isString(D)?N<=k&&D.indexOf(w,N)>-1:!!k&&baseIndexOf(D,w,N)>-1},lodash.indexOf=function indexOf(D,w,N){var F=null==D?0:D.length;if(!F)return-1;var k=null==N?0:toInteger(N);return k<0&&(k=An(F+k,0)),baseIndexOf(D,w,k)},lodash.inRange=function inRange(D,w,N){return w=toFinite(w),void 0===N?(N=w,w=0):N=toFinite(N),function baseInRange(D,w,N){return D>=Pn(w,N)&&D<An(w,N)}(D=toNumber(D),w,N)},lodash.invoke=Sr,lodash.isArguments=nr,lodash.isArray=ir,lodash.isArrayBuffer=rr,lodash.isArrayLike=isArrayLike,lodash.isArrayLikeObject=isArrayLikeObject,lodash.isBoolean=function isBoolean(D){return!0===D||!1===D||isObjectLike(D)&&baseGetTag(D)==q},lodash.isBuffer=or,lodash.isDate=ar,lodash.isElement=function isElement(D){return isObjectLike(D)&&1===D.nodeType&&!isPlainObject(D)},lodash.isEmpty=function isEmpty(D){if(null==D)return!0;if(isArrayLike(D)&&(ir(D)||"string"==typeof D||"function"==typeof D.splice||or(D)||lr(D)||nr(D)))return!D.length;var w=fi(D);if(w==ie||w==fe)return!D.size;if(isPrototype(D))return!baseKeys(D).length;for(var N in D)if(At.call(D,N))return!1;return!0},lodash.isEqual=function isEqual(D,w){return baseIsEqual(D,w)},lodash.isEqualWith=function isEqualWith(D,w,N){var F=(N="function"==typeof N?N:void 0)?N(D,w):void 0;return void 0===F?baseIsEqual(D,w,void 0,N):!!F},lodash.isError=isError,lodash.isFinite=function isFinite(D){return"number"==typeof D&&Sn(D)},lodash.isFunction=isFunction,lodash.isInteger=isInteger,lodash.isLength=isLength,lodash.isMap=sr,lodash.isMatch=function isMatch(D,w){return D===w||baseIsMatch(D,w,getMatchData(w))},lodash.isMatchWith=function isMatchWith(D,w,N){return N="function"==typeof N?N:void 0,baseIsMatch(D,w,getMatchData(w),N)},lodash.isNaN=function isNaN(D){return isNumber(D)&&D!=+D},lodash.isNative=function isNative(D){if(pi(D))throw new k("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return baseIsNative(D)},lodash.isNil=function isNil(D){return null==D},lodash.isNull=function isNull(D){return null===D},lodash.isNumber=isNumber,lodash.isObject=isObject,lodash.isObjectLike=isObjectLike,lodash.isPlainObject=isPlainObject,lodash.isRegExp=cr,lodash.isSafeInteger=function isSafeInteger(D){return isInteger(D)&&D>=-9007199254740991&&D<=9007199254740991},lodash.isSet=ur,lodash.isString=isString,lodash.isSymbol=isSymbol,lodash.isTypedArray=lr,lodash.isUndefined=function isUndefined(D){return void 0===D},lodash.isWeakMap=function isWeakMap(D){return isObjectLike(D)&&fi(D)==ve},lodash.isWeakSet=function isWeakSet(D){return isObjectLike(D)&&"[object WeakSet]"==baseGetTag(D)},lodash.join=function join(D,w){return null==D?"":Mn.call(D,w)},lodash.kebabCase=Dr,lodash.last=last,lodash.lastIndexOf=function lastIndexOf(D,w,N){var F=null==D?0:D.length;if(!F)return-1;var k=F;return void 0!==N&&(k=(k=toInteger(N))<0?An(F+k,0):Pn(k,F-1)),w==w?function strictLastIndexOf(D,w,N){for(var F=N+1;F--;)if(D[F]===w)return F;return F}(D,w,k):baseFindIndex(D,baseIsNaN,k,!0)},lodash.lowerCase=Ir,lodash.lowerFirst=Lr,lodash.lt=hr,lodash.lte=dr,lodash.max=function max(D){return D&&D.length?baseExtremum(D,identity,baseGt):void 0},lodash.maxBy=function maxBy(D,w){return D&&D.length?baseExtremum(D,getIteratee(w,2),baseGt):void 0},lodash.mean=function mean(D){return baseMean(D,identity)},lodash.meanBy=function meanBy(D,w){return baseMean(D,getIteratee(w,2))},lodash.min=function min(D){return D&&D.length?baseExtremum(D,identity,baseLt):void 0},lodash.minBy=function minBy(D,w){return D&&D.length?baseExtremum(D,getIteratee(w,2),baseLt):void 0},lodash.stubArray=stubArray,lodash.stubFalse=stubFalse,lodash.stubObject=function stubObject(){return{}},lodash.stubString=function stubString(){return""},lodash.stubTrue=function stubTrue(){return!0},lodash.multiply=eo,lodash.nth=function nth(D,w){return D&&D.length?baseNth(D,toInteger(w)):void 0},lodash.noConflict=function noConflict(){return qt._===this&&(qt._=Dt),this},lodash.noop=noop,lodash.now=Hi,lodash.pad=function pad(D,w,N){D=toString(D);var F=(w=toInteger(w))?stringSize(D):0;if(!w||F>=w)return D;var k=(w-F)/2;return createPadding(bn(k),N)+D+createPadding(yn(k),N)},lodash.padEnd=function padEnd(D,w,N){D=toString(D);var F=(w=toInteger(w))?stringSize(D):0;return w&&F<w?D+createPadding(w-F,N):D},lodash.padStart=function padStart(D,w,N){D=toString(D);var F=(w=toInteger(w))?stringSize(D):0;return w&&F<w?createPadding(w-F,N)+D:D},lodash.parseInt=function parseInt(D,w,N){return N||null==w?w=0:w&&(w=+w),On(toString(D).replace(Ke,""),w||0)},lodash.random=function random(D,w,N){if(N&&"boolean"!=typeof N&&isIterateeCall(D,w,N)&&(w=N=void 0),void 0===N&&("boolean"==typeof w?(N=w,w=void 0):"boolean"==typeof D&&(N=D,D=void 0)),void 0===D&&void 0===w?(D=0,w=1):(D=toFinite(D),void 0===w?(w=D,D=0):w=toFinite(w)),D>w){var F=D;D=w,w=F}if(N||D%1||w%1){var k=Rn();return Pn(D+k*(w-D+Wt("1e-"+((k+"").length-1))),w)}return baseRandom(D,w)},lodash.reduce=function reduce(D,w,N){var F=ir(D)?arrayReduce:baseReduce,k=arguments.length<3;return F(D,getIteratee(w,4),N,k,ei)},lodash.reduceRight=function reduceRight(D,w,N){var F=ir(D)?arrayReduceRight:baseReduce,k=arguments.length<3;return F(D,getIteratee(w,4),N,k,ti)},lodash.repeat=function repeat(D,w,N){return w=(N?isIterateeCall(D,w,N):void 0===w)?1:toInteger(w),baseRepeat(toString(D),w)},lodash.replace=function replace(){var D=arguments,w=toString(D[0]);return D.length<3?w:w.replace(D[1],D[2])},lodash.result=function result(D,w,N){var F=-1,k=(w=castPath(w,D)).length;for(k||(k=1,D=void 0);++F<k;){var j=null==D?void 0:D[toKey(w[F])];void 0===j&&(F=k,j=N),D=isFunction(j)?j.call(D):j}return D},lodash.round=no,lodash.runInContext=runInContext,lodash.sample=function sample(D){return(ir(D)?arraySample:baseSample)(D)},lodash.size=function size(D){if(null==D)return 0;if(isArrayLike(D))return isString(D)?stringSize(D):D.length;var w=fi(D);return w==ie||w==fe?D.size:baseKeys(D).length},lodash.snakeCase=wr,lodash.some=function some(D,w,N){var F=ir(D)?arraySome:baseSome;return N&&isIterateeCall(D,w,N)&&(w=void 0),F(D,getIteratee(w,3))},lodash.sortedIndex=function sortedIndex(D,w){return baseSortedIndex(D,w)},lodash.sortedIndexBy=function sortedIndexBy(D,w,N){return baseSortedIndexBy(D,w,getIteratee(N,2))},lodash.sortedIndexOf=function sortedIndexOf(D,w){var N=null==D?0:D.length;if(N){var F=baseSortedIndex(D,w);if(F<N&&eq(D[F],w))return F}return-1},lodash.sortedLastIndex=function sortedLastIndex(D,w){return baseSortedIndex(D,w,!0)},lodash.sortedLastIndexBy=function sortedLastIndexBy(D,w,N){return baseSortedIndexBy(D,w,getIteratee(N,2),!0)},lodash.sortedLastIndexOf=function sortedLastIndexOf(D,w){if(null==D?0:D.length){var N=baseSortedIndex(D,w,!0)-1;if(eq(D[N],w))return N}return-1},lodash.startCase=Nr,lodash.startsWith=function startsWith(D,w,N){return D=toString(D),N=null==N?0:baseClamp(toInteger(N),0,D.length),w=baseToString(w),D.slice(N,N+w.length)==w},lodash.subtract=io,lodash.sum=function sum(D){return D&&D.length?baseSum(D,identity):0},lodash.sumBy=function sumBy(D,w){return D&&D.length?baseSum(D,getIteratee(w,2)):0},lodash.template=function template(D,w,N){var F=lodash.templateSettings;N&&isIterateeCall(D,w,N)&&(w=void 0),D=toString(D),w=_r({},w,F,customDefaultsAssignIn);var k,j,z=_r({},w.imports,F.imports,customDefaultsAssignIn),G=keys(z),H=baseValues(z,G),X=0,q=w.interpolate||ft,Z="__p += '",J=vt((w.escape||ft).source+"|"+q.source+"|"+(q===Ve?rt:ft).source+"|"+(w.evaluate||ft).source+"|$","g"),$="//# sourceURL="+(At.call(w,"sourceURL")?(w.sourceURL+"").replace(/[\r\n]/g," "):"lodash.templateSources["+ ++zt+"]")+"\n";D.replace(J,(function(w,N,F,z,G,H){return F||(F=z),Z+=D.slice(X,H).replace(pt,escapeStringChar),N&&(k=!0,Z+="' +\n__e("+N+") +\n'"),G&&(j=!0,Z+="';\n"+G+";\n__p += '"),F&&(Z+="' +\n((__t = ("+F+")) == null ? '' : __t) +\n'"),X=H+w.length,w})),Z+="';\n";var te=At.call(w,"variable")&&w.variable;te||(Z="with (obj) {\n"+Z+"\n}\n"),Z=(j?Z.replace(Re,""):Z).replace(De,"$1").replace(Ie,"$1;"),Z="function("+(te||"obj")+") {\n"+(te?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(k?", __e = _.escape":"")+(j?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+Z+"return __p\n}";var ie=kr((function(){return _t(G,$+"return "+Z).apply(void 0,H)}));if(ie.source=Z,isError(ie))throw ie;return ie},lodash.times=function times(D,w){if((D=toInteger(D))<1||D>9007199254740991)return[];var N=4294967295,F=Pn(D,4294967295);D-=4294967295;for(var k=baseTimes(F,w=getIteratee(w));++N<D;)w(N);return k},lodash.toFinite=toFinite,lodash.toInteger=toInteger,lodash.toLength=toLength,lodash.toLower=function toLower(D){return toString(D).toLowerCase()},lodash.toNumber=toNumber,lodash.toSafeInteger=function toSafeInteger(D){return D?baseClamp(toInteger(D),-9007199254740991,9007199254740991):0===D?D:0},lodash.toString=toString,lodash.toUpper=function toUpper(D){return toString(D).toUpperCase()},lodash.trim=function trim(D,w,N){if((D=toString(D))&&(N||void 0===w))return D.replace(Xe,"");if(!D||!(w=baseToString(w)))return D;var F=stringToArray(D),k=stringToArray(w);return castSlice(F,charsStartIndex(F,k),charsEndIndex(F,k)+1).join("")},lodash.trimEnd=function trimEnd(D,w,N){if((D=toString(D))&&(N||void 0===w))return D.replace(Qe,"");if(!D||!(w=baseToString(w)))return D;var F=stringToArray(D);return castSlice(F,0,charsEndIndex(F,stringToArray(w))+1).join("")},lodash.trimStart=function trimStart(D,w,N){if((D=toString(D))&&(N||void 0===w))return D.replace(Ke,"");if(!D||!(w=baseToString(w)))return D;var F=stringToArray(D);return castSlice(F,charsStartIndex(F,stringToArray(w))).join("")},lodash.truncate=function truncate(D,w){var N=30,F="...";if(isObject(w)){var k="separator"in w?w.separator:k;N="length"in w?toInteger(w.length):N,F="omission"in w?baseToString(w.omission):F}var j=(D=toString(D)).length;if(hasUnicode(D)){var z=stringToArray(D);j=z.length}if(N>=j)return D;var G=N-stringSize(F);if(G<1)return F;var H=z?castSlice(z,0,G).join(""):D.slice(0,G);if(void 0===k)return H+F;if(z&&(G+=H.length-G),cr(k)){if(D.slice(G).search(k)){var X,q=H;for(k.global||(k=vt(k.source,toString(ot.exec(k))+"g")),k.lastIndex=0;X=k.exec(q);)var Z=X.index;H=H.slice(0,void 0===Z?G:Z)}}else if(D.indexOf(baseToString(k),G)!=G){var J=H.lastIndexOf(k);J>-1&&(H=H.slice(0,J))}return H+F},lodash.unescape=function unescape(D){return(D=toString(D))&&Ne.test(D)?D.replace(Le,dn):D},lodash.uniqueId=function uniqueId(D){var w=++Pt;return toString(D)+w},lodash.upperCase=Fr,lodash.upperFirst=Br,lodash.each=forEach,lodash.eachRight=forEachRight,lodash.first=head,mixin(lodash,($r={},baseForOwn(lodash,(function(D,w){At.call(lodash.prototype,w)||($r[w]=D)})),$r),{chain:!1}),lodash.VERSION="4.17.15",arrayEach(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(D){lodash[D].placeholder=lodash})),arrayEach(["drop","take"],(function(D,w){LazyWrapper.prototype[D]=function(N){N=void 0===N?1:An(toInteger(N),0);var F=this.__filtered__&&!w?new LazyWrapper(this):this.clone();return F.__filtered__?F.__takeCount__=Pn(N,F.__takeCount__):F.__views__.push({size:Pn(N,4294967295),type:D+(F.__dir__<0?"Right":"")}),F},LazyWrapper.prototype[D+"Right"]=function(w){return this.reverse()[D](w).reverse()}})),arrayEach(["filter","map","takeWhile"],(function(D,w){var N=w+1,F=1==N||3==N;LazyWrapper.prototype[D]=function(D){var w=this.clone();return w.__iteratees__.push({iteratee:getIteratee(D,3),type:N}),w.__filtered__=w.__filtered__||F,w}})),arrayEach(["head","last"],(function(D,w){var N="take"+(w?"Right":"");LazyWrapper.prototype[D]=function(){return this[N](1).value()[0]}})),arrayEach(["initial","tail"],(function(D,w){var N="drop"+(w?"":"Right");LazyWrapper.prototype[D]=function(){return this.__filtered__?new LazyWrapper(this):this[N](1)}})),LazyWrapper.prototype.compact=function(){return this.filter(identity)},LazyWrapper.prototype.find=function(D){return this.filter(D).head()},LazyWrapper.prototype.findLast=function(D){return this.reverse().find(D)},LazyWrapper.prototype.invokeMap=baseRest((function(D,w){return"function"==typeof D?new LazyWrapper(this):this.map((function(N){return baseInvoke(N,D,w)}))})),LazyWrapper.prototype.reject=function(D){return this.filter(negate(getIteratee(D)))},LazyWrapper.prototype.slice=function(D,w){D=toInteger(D);var N=this;return N.__filtered__&&(D>0||w<0)?new LazyWrapper(N):(D<0?N=N.takeRight(-D):D&&(N=N.drop(D)),void 0!==w&&(N=(w=toInteger(w))<0?N.dropRight(-w):N.take(w-D)),N)},LazyWrapper.prototype.takeRightWhile=function(D){return this.reverse().takeWhile(D).reverse()},LazyWrapper.prototype.toArray=function(){return this.take(4294967295)},baseForOwn(LazyWrapper.prototype,(function(D,w){var N=/^(?:filter|find|map|reject)|While$/.test(w),F=/^(?:head|last)$/.test(w),k=lodash[F?"take"+("last"==w?"Right":""):w],j=F||/^find/.test(w);k&&(lodash.prototype[w]=function(){var w=this.__wrapped__,z=F?[1]:arguments,G=w instanceof LazyWrapper,H=z[0],X=G||ir(w),interceptor=function(D){var w=k.apply(lodash,arrayPush([D],z));return F&&q?w[0]:w};X&&N&&"function"==typeof H&&1!=H.length&&(G=X=!1);var q=this.__chain__,Z=!!this.__actions__.length,J=j&&!q,$=G&&!Z;if(!j&&X){w=$?w:new LazyWrapper(this);var te=D.apply(w,z);return te.__actions__.push({func:thru,args:[interceptor],thisArg:void 0}),new LodashWrapper(te,q)}return J&&$?D.apply(this,z):(te=this.thru(interceptor),J?F?te.value()[0]:te.value():te)})})),arrayEach(["pop","push","shift","sort","splice","unshift"],(function(D){var w=Tt[D],N=/^(?:push|sort|unshift)$/.test(D)?"tap":"thru",F=/^(?:pop|shift)$/.test(D);lodash.prototype[D]=function(){var D=arguments;if(F&&!this.__chain__){var k=this.value();return w.apply(ir(k)?k:[],D)}return this[N]((function(N){return w.apply(ir(N)?N:[],D)}))}})),baseForOwn(LazyWrapper.prototype,(function(D,w){var N=lodash[w];if(N){var F=N.name+"";At.call(Gn,F)||(Gn[F]=[]),Gn[F].push({name:w,func:N})}})),Gn[createHybrid(void 0,2).name]=[{name:"wrapper",func:void 0}],LazyWrapper.prototype.clone=function lazyClone(){var D=new LazyWrapper(this.__wrapped__);return D.__actions__=copyArray(this.__actions__),D.__dir__=this.__dir__,D.__filtered__=this.__filtered__,D.__iteratees__=copyArray(this.__iteratees__),D.__takeCount__=this.__takeCount__,D.__views__=copyArray(this.__views__),D},LazyWrapper.prototype.reverse=function lazyReverse(){if(this.__filtered__){var D=new LazyWrapper(this);D.__dir__=-1,D.__filtered__=!0}else(D=this.clone()).__dir__*=-1;return D},LazyWrapper.prototype.value=function lazyValue(){var D=this.__wrapped__.value(),w=this.__dir__,N=ir(D),F=w<0,k=N?D.length:0,j=function getView(D,w,N){var F=-1,k=N.length;for(;++F<k;){var j=N[F],z=j.size;switch(j.type){case"drop":D+=z;break;case"dropRight":w-=z;break;case"take":w=Pn(w,D+z);break;case"takeRight":D=An(D,w-z)}}return{start:D,end:w}}(0,k,this.__views__),z=j.start,G=j.end,H=G-z,X=F?G:z-1,q=this.__iteratees__,Z=q.length,J=0,$=Pn(H,this.__takeCount__);if(!N||!F&&k==H&&$==H)return baseWrapperValue(D,this.__actions__);var te=[];e:for(;H--&&J<$;){for(var ie=-1,oe=D[X+=w];++ie<Z;){var ce=q[ie],he=ce.iteratee,fe=ce.type,pe=he(oe);if(2==fe)oe=pe;else if(!pe){if(1==fe)continue e;break e}}te[J++]=oe}return te},lodash.prototype.at=Fi,lodash.prototype.chain=function wrapperChain(){return chain(this)},lodash.prototype.commit=function wrapperCommit(){return new LodashWrapper(this.value(),this.__chain__)},lodash.prototype.next=function wrapperNext(){void 0===this.__values__&&(this.__values__=toArray(this.value()));var D=this.__index__>=this.__values__.length;return{done:D,value:D?void 0:this.__values__[this.__index__++]}},lodash.prototype.plant=function wrapperPlant(D){for(var w,N=this;N instanceof baseLodash;){var F=wrapperClone(N);F.__index__=0,F.__values__=void 0,w?k.__wrapped__=F:w=F;var k=F;N=N.__wrapped__}return k.__wrapped__=D,w},lodash.prototype.reverse=function wrapperReverse(){var D=this.__wrapped__;if(D instanceof LazyWrapper){var w=D;return this.__actions__.length&&(w=new LazyWrapper(this)),(w=w.reverse()).__actions__.push({func:thru,args:[reverse],thisArg:void 0}),new LodashWrapper(w,this.__chain__)}return this.thru(reverse)},lodash.prototype.toJSON=lodash.prototype.valueOf=lodash.prototype.value=function wrapperValue(){return baseWrapperValue(this.__wrapped__,this.__actions__)},lodash.prototype.first=lodash.prototype.head,en&&(lodash.prototype[en]=function wrapperToIterator(){return this}),lodash}();qt._=_n,void 0===(k=function(){return _n}.call(w,N,w,F))||(F.exports=k)}).call(this)}).call(this,N(6),N(30)(D))},function(D,w,N){"use strict";const F=N(193),k=N(33),j=N(198);function cloneDeep(D,w){switch(k(D)){case"object":return function cloneObjectDeep(D,w){if("function"==typeof w)return w(D);if(w||j(D)){const N=new D.constructor;for(let F in D)N[F]=cloneDeep(D[F],w);return N}return D}(D,w);case"array":return function cloneArrayDeep(D,w){const N=new D.constructor(D.length);for(let F=0;F<D.length;F++)N[F]=cloneDeep(D[F],w);return N}(D,w);default:return F(D)}}D.exports=cloneDeep},function(D,w,N){"use strict";(function(w){const F=Symbol.prototype.valueOf,k=N(33);D.exports=function clone(D,N){switch(k(D)){case"array":return D.slice();case"object":return Object.assign({},D);case"date":return new D.constructor(Number(D));case"map":return new Map(D);case"set":return new Set(D);case"buffer":return function cloneBuffer(D){const N=D.length,F=w.allocUnsafe?w.allocUnsafe(N):w.from(N);return D.copy(F),F}(D);case"symbol":return function cloneSymbol(D){return F?Object(F.call(D)):{}}(D);case"arraybuffer":return function cloneArrayBuffer(D){const w=new D.constructor(D.byteLength);return new Uint8Array(w).set(new Uint8Array(D)),w}(D);case"float32array":case"float64array":case"int16array":case"int32array":case"int8array":case"uint16array":case"uint32array":case"uint8clampedarray":case"uint8array":return function cloneTypedArray(D,w){return new D.constructor(D.buffer,D.byteOffset,D.length)}(D);case"regexp":return function cloneRegExp(D){const w=void 0!==D.flags?D.flags:/\w+$/.exec(D)||void 0,N=new D.constructor(D.source,w);return N.lastIndex=D.lastIndex,N}(D);case"error":return Object.create(D);default:return D}}}).call(this,N(194).Buffer)},function(D,w,N){"use strict";(function(D){var F=N(195),k=N(196),j=N(197);function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function createBuffer(D,w){if(kMaxLength()<w)throw new RangeError("Invalid typed array length");return Buffer.TYPED_ARRAY_SUPPORT?(D=new Uint8Array(w)).__proto__=Buffer.prototype:(null===D&&(D=new Buffer(w)),D.length=w),D}function Buffer(D,w,N){if(!(Buffer.TYPED_ARRAY_SUPPORT||this instanceof Buffer))return new Buffer(D,w,N);if("number"==typeof D){if("string"==typeof w)throw new Error("If encoding is specified then the first argument must be a string");return allocUnsafe(this,D)}return from(this,D,w,N)}function from(D,w,N,F){if("number"==typeof w)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&w instanceof ArrayBuffer?function fromArrayBuffer(D,w,N,F){if(w.byteLength,N<0||w.byteLength<N)throw new RangeError("'offset' is out of bounds");if(w.byteLength<N+(F||0))throw new RangeError("'length' is out of bounds");w=void 0===N&&void 0===F?new Uint8Array(w):void 0===F?new Uint8Array(w,N):new Uint8Array(w,N,F);Buffer.TYPED_ARRAY_SUPPORT?(D=w).__proto__=Buffer.prototype:D=fromArrayLike(D,w);return D}(D,w,N,F):"string"==typeof w?function fromString(D,w,N){"string"==typeof N&&""!==N||(N="utf8");if(!Buffer.isEncoding(N))throw new TypeError('"encoding" must be a valid string encoding');var F=0|byteLength(w,N),k=(D=createBuffer(D,F)).write(w,N);k!==F&&(D=D.slice(0,k));return D}(D,w,N):function fromObject(D,w){if(Buffer.isBuffer(w)){var N=0|checked(w.length);return 0===(D=createBuffer(D,N)).length||w.copy(D,0,0,N),D}if(w){if("undefined"!=typeof ArrayBuffer&&w.buffer instanceof ArrayBuffer||"length"in w)return"number"!=typeof w.length||function isnan(D){return D!=D}(w.length)?createBuffer(D,0):fromArrayLike(D,w);if("Buffer"===w.type&&j(w.data))return fromArrayLike(D,w.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(D,w)}function assertSize(D){if("number"!=typeof D)throw new TypeError('"size" argument must be a number');if(D<0)throw new RangeError('"size" argument must not be negative')}function allocUnsafe(D,w){if(assertSize(w),D=createBuffer(D,w<0?0:0|checked(w)),!Buffer.TYPED_ARRAY_SUPPORT)for(var N=0;N<w;++N)D[N]=0;return D}function fromArrayLike(D,w){var N=w.length<0?0:0|checked(w.length);D=createBuffer(D,N);for(var F=0;F<N;F+=1)D[F]=255&w[F];return D}function checked(D){if(D>=kMaxLength())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+kMaxLength().toString(16)+" bytes");return 0|D}function byteLength(D,w){if(Buffer.isBuffer(D))return D.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(D)||D instanceof ArrayBuffer))return D.byteLength;"string"!=typeof D&&(D=""+D);var N=D.length;if(0===N)return 0;for(var F=!1;;)switch(w){case"ascii":case"latin1":case"binary":return N;case"utf8":case"utf-8":case void 0:return utf8ToBytes(D).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*N;case"hex":return N>>>1;case"base64":return base64ToBytes(D).length;default:if(F)return utf8ToBytes(D).length;w=(""+w).toLowerCase(),F=!0}}function slowToString(D,w,N){var F=!1;if((void 0===w||w<0)&&(w=0),w>this.length)return"";if((void 0===N||N>this.length)&&(N=this.length),N<=0)return"";if((N>>>=0)<=(w>>>=0))return"";for(D||(D="utf8");;)switch(D){case"hex":return hexSlice(this,w,N);case"utf8":case"utf-8":return utf8Slice(this,w,N);case"ascii":return asciiSlice(this,w,N);case"latin1":case"binary":return latin1Slice(this,w,N);case"base64":return base64Slice(this,w,N);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,w,N);default:if(F)throw new TypeError("Unknown encoding: "+D);D=(D+"").toLowerCase(),F=!0}}function swap(D,w,N){var F=D[w];D[w]=D[N],D[N]=F}function bidirectionalIndexOf(D,w,N,F,k){if(0===D.length)return-1;if("string"==typeof N?(F=N,N=0):N>2147483647?N=2147483647:N<-2147483648&&(N=-2147483648),N=+N,isNaN(N)&&(N=k?0:D.length-1),N<0&&(N=D.length+N),N>=D.length){if(k)return-1;N=D.length-1}else if(N<0){if(!k)return-1;N=0}if("string"==typeof w&&(w=Buffer.from(w,F)),Buffer.isBuffer(w))return 0===w.length?-1:arrayIndexOf(D,w,N,F,k);if("number"==typeof w)return w&=255,Buffer.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?k?Uint8Array.prototype.indexOf.call(D,w,N):Uint8Array.prototype.lastIndexOf.call(D,w,N):arrayIndexOf(D,[w],N,F,k);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(D,w,N,F,k){var j,z=1,G=D.length,H=w.length;if(void 0!==F&&("ucs2"===(F=String(F).toLowerCase())||"ucs-2"===F||"utf16le"===F||"utf-16le"===F)){if(D.length<2||w.length<2)return-1;z=2,G/=2,H/=2,N/=2}function read(D,w){return 1===z?D[w]:D.readUInt16BE(w*z)}if(k){var X=-1;for(j=N;j<G;j++)if(read(D,j)===read(w,-1===X?0:j-X)){if(-1===X&&(X=j),j-X+1===H)return X*z}else-1!==X&&(j-=j-X),X=-1}else for(N+H>G&&(N=G-H),j=N;j>=0;j--){for(var q=!0,Z=0;Z<H;Z++)if(read(D,j+Z)!==read(w,Z)){q=!1;break}if(q)return j}return-1}function hexWrite(D,w,N,F){N=Number(N)||0;var k=D.length-N;F?(F=Number(F))>k&&(F=k):F=k;var j=w.length;if(j%2!=0)throw new TypeError("Invalid hex string");F>j/2&&(F=j/2);for(var z=0;z<F;++z){var G=parseInt(w.substr(2*z,2),16);if(isNaN(G))return z;D[N+z]=G}return z}function utf8Write(D,w,N,F){return blitBuffer(utf8ToBytes(w,D.length-N),D,N,F)}function asciiWrite(D,w,N,F){return blitBuffer(function asciiToBytes(D){for(var w=[],N=0;N<D.length;++N)w.push(255&D.charCodeAt(N));return w}(w),D,N,F)}function latin1Write(D,w,N,F){return asciiWrite(D,w,N,F)}function base64Write(D,w,N,F){return blitBuffer(base64ToBytes(w),D,N,F)}function ucs2Write(D,w,N,F){return blitBuffer(function utf16leToBytes(D,w){for(var N,F,k,j=[],z=0;z<D.length&&!((w-=2)<0);++z)N=D.charCodeAt(z),F=N>>8,k=N%256,j.push(k),j.push(F);return j}(w,D.length-N),D,N,F)}function base64Slice(D,w,N){return 0===w&&N===D.length?F.fromByteArray(D):F.fromByteArray(D.slice(w,N))}function utf8Slice(D,w,N){N=Math.min(D.length,N);for(var F=[],k=w;k<N;){var j,z,G,H,X=D[k],q=null,Z=X>239?4:X>223?3:X>191?2:1;if(k+Z<=N)switch(Z){case 1:X<128&&(q=X);break;case 2:128==(192&(j=D[k+1]))&&(H=(31&X)<<6|63&j)>127&&(q=H);break;case 3:j=D[k+1],z=D[k+2],128==(192&j)&&128==(192&z)&&(H=(15&X)<<12|(63&j)<<6|63&z)>2047&&(H<55296||H>57343)&&(q=H);break;case 4:j=D[k+1],z=D[k+2],G=D[k+3],128==(192&j)&&128==(192&z)&&128==(192&G)&&(H=(15&X)<<18|(63&j)<<12|(63&z)<<6|63&G)>65535&&H<1114112&&(q=H)}null===q?(q=65533,Z=1):q>65535&&(q-=65536,F.push(q>>>10&1023|55296),q=56320|1023&q),F.push(q),k+=Z}return function decodeCodePointsArray(D){var w=D.length;if(w<=4096)return String.fromCharCode.apply(String,D);var N="",F=0;for(;F<w;)N+=String.fromCharCode.apply(String,D.slice(F,F+=4096));return N}(F)}w.Buffer=Buffer,w.SlowBuffer=function SlowBuffer(D){+D!=D&&(D=0);return Buffer.alloc(+D)},w.INSPECT_MAX_BYTES=50,Buffer.TYPED_ARRAY_SUPPORT=void 0!==D.TYPED_ARRAY_SUPPORT?D.TYPED_ARRAY_SUPPORT:function typedArraySupport(){try{var D=new Uint8Array(1);return D.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===D.foo()&&"function"==typeof D.subarray&&0===D.subarray(1,1).byteLength}catch(D){return!1}}(),w.kMaxLength=kMaxLength(),Buffer.poolSize=8192,Buffer._augment=function(D){return D.__proto__=Buffer.prototype,D},Buffer.from=function(D,w,N){return from(null,D,w,N)},Buffer.TYPED_ARRAY_SUPPORT&&(Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&Buffer[Symbol.species]===Buffer&&Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:!0})),Buffer.alloc=function(D,w,N){return function alloc(D,w,N,F){return assertSize(w),w<=0?createBuffer(D,w):void 0!==N?"string"==typeof F?createBuffer(D,w).fill(N,F):createBuffer(D,w).fill(N):createBuffer(D,w)}(null,D,w,N)},Buffer.allocUnsafe=function(D){return allocUnsafe(null,D)},Buffer.allocUnsafeSlow=function(D){return allocUnsafe(null,D)},Buffer.isBuffer=function isBuffer(D){return!(null==D||!D._isBuffer)},Buffer.compare=function compare(D,w){if(!Buffer.isBuffer(D)||!Buffer.isBuffer(w))throw new TypeError("Arguments must be Buffers");if(D===w)return 0;for(var N=D.length,F=w.length,k=0,j=Math.min(N,F);k<j;++k)if(D[k]!==w[k]){N=D[k],F=w[k];break}return N<F?-1:F<N?1:0},Buffer.isEncoding=function isEncoding(D){switch(String(D).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function concat(D,w){if(!j(D))throw new TypeError('"list" argument must be an Array of Buffers');if(0===D.length)return Buffer.alloc(0);var N;if(void 0===w)for(w=0,N=0;N<D.length;++N)w+=D[N].length;var F=Buffer.allocUnsafe(w),k=0;for(N=0;N<D.length;++N){var z=D[N];if(!Buffer.isBuffer(z))throw new TypeError('"list" argument must be an Array of Buffers');z.copy(F,k),k+=z.length}return F},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function swap16(){var D=this.length;if(D%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var w=0;w<D;w+=2)swap(this,w,w+1);return this},Buffer.prototype.swap32=function swap32(){var D=this.length;if(D%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var w=0;w<D;w+=4)swap(this,w,w+3),swap(this,w+1,w+2);return this},Buffer.prototype.swap64=function swap64(){var D=this.length;if(D%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var w=0;w<D;w+=8)swap(this,w,w+7),swap(this,w+1,w+6),swap(this,w+2,w+5),swap(this,w+3,w+4);return this},Buffer.prototype.toString=function toString(){var D=0|this.length;return 0===D?"":0===arguments.length?utf8Slice(this,0,D):slowToString.apply(this,arguments)},Buffer.prototype.equals=function equals(D){if(!Buffer.isBuffer(D))throw new TypeError("Argument must be a Buffer");return this===D||0===Buffer.compare(this,D)},Buffer.prototype.inspect=function inspect(){var D="",N=w.INSPECT_MAX_BYTES;return this.length>0&&(D=this.toString("hex",0,N).match(/.{2}/g).join(" "),this.length>N&&(D+=" ... ")),"<Buffer "+D+">"},Buffer.prototype.compare=function compare(D,w,N,F,k){if(!Buffer.isBuffer(D))throw new TypeError("Argument must be a Buffer");if(void 0===w&&(w=0),void 0===N&&(N=D?D.length:0),void 0===F&&(F=0),void 0===k&&(k=this.length),w<0||N>D.length||F<0||k>this.length)throw new RangeError("out of range index");if(F>=k&&w>=N)return 0;if(F>=k)return-1;if(w>=N)return 1;if(this===D)return 0;for(var j=(k>>>=0)-(F>>>=0),z=(N>>>=0)-(w>>>=0),G=Math.min(j,z),H=this.slice(F,k),X=D.slice(w,N),q=0;q<G;++q)if(H[q]!==X[q]){j=H[q],z=X[q];break}return j<z?-1:z<j?1:0},Buffer.prototype.includes=function includes(D,w,N){return-1!==this.indexOf(D,w,N)},Buffer.prototype.indexOf=function indexOf(D,w,N){return bidirectionalIndexOf(this,D,w,N,!0)},Buffer.prototype.lastIndexOf=function lastIndexOf(D,w,N){return bidirectionalIndexOf(this,D,w,N,!1)},Buffer.prototype.write=function write(D,w,N,F){if(void 0===w)F="utf8",N=this.length,w=0;else if(void 0===N&&"string"==typeof w)F=w,N=this.length,w=0;else{if(!isFinite(w))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");w|=0,isFinite(N)?(N|=0,void 0===F&&(F="utf8")):(F=N,N=void 0)}var k=this.length-w;if((void 0===N||N>k)&&(N=k),D.length>0&&(N<0||w<0)||w>this.length)throw new RangeError("Attempt to write outside buffer bounds");F||(F="utf8");for(var j=!1;;)switch(F){case"hex":return hexWrite(this,D,w,N);case"utf8":case"utf-8":return utf8Write(this,D,w,N);case"ascii":return asciiWrite(this,D,w,N);case"latin1":case"binary":return latin1Write(this,D,w,N);case"base64":return base64Write(this,D,w,N);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,D,w,N);default:if(j)throw new TypeError("Unknown encoding: "+F);F=(""+F).toLowerCase(),j=!0}},Buffer.prototype.toJSON=function toJSON(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function asciiSlice(D,w,N){var F="";N=Math.min(D.length,N);for(var k=w;k<N;++k)F+=String.fromCharCode(127&D[k]);return F}function latin1Slice(D,w,N){var F="";N=Math.min(D.length,N);for(var k=w;k<N;++k)F+=String.fromCharCode(D[k]);return F}function hexSlice(D,w,N){var F=D.length;(!w||w<0)&&(w=0),(!N||N<0||N>F)&&(N=F);for(var k="",j=w;j<N;++j)k+=toHex(D[j]);return k}function utf16leSlice(D,w,N){for(var F=D.slice(w,N),k="",j=0;j<F.length;j+=2)k+=String.fromCharCode(F[j]+256*F[j+1]);return k}function checkOffset(D,w,N){if(D%1!=0||D<0)throw new RangeError("offset is not uint");if(D+w>N)throw new RangeError("Trying to access beyond buffer length")}function checkInt(D,w,N,F,k,j){if(!Buffer.isBuffer(D))throw new TypeError('"buffer" argument must be a Buffer instance');if(w>k||w<j)throw new RangeError('"value" argument is out of bounds');if(N+F>D.length)throw new RangeError("Index out of range")}function objectWriteUInt16(D,w,N,F){w<0&&(w=65535+w+1);for(var k=0,j=Math.min(D.length-N,2);k<j;++k)D[N+k]=(w&255<<8*(F?k:1-k))>>>8*(F?k:1-k)}function objectWriteUInt32(D,w,N,F){w<0&&(w=4294967295+w+1);for(var k=0,j=Math.min(D.length-N,4);k<j;++k)D[N+k]=w>>>8*(F?k:3-k)&255}function checkIEEE754(D,w,N,F,k,j){if(N+F>D.length)throw new RangeError("Index out of range");if(N<0)throw new RangeError("Index out of range")}function writeFloat(D,w,N,F,j){return j||checkIEEE754(D,0,N,4),k.write(D,w,N,F,23,4),N+4}function writeDouble(D,w,N,F,j){return j||checkIEEE754(D,0,N,8),k.write(D,w,N,F,52,8),N+8}Buffer.prototype.slice=function slice(D,w){var N,F=this.length;if((D=~~D)<0?(D+=F)<0&&(D=0):D>F&&(D=F),(w=void 0===w?F:~~w)<0?(w+=F)<0&&(w=0):w>F&&(w=F),w<D&&(w=D),Buffer.TYPED_ARRAY_SUPPORT)(N=this.subarray(D,w)).__proto__=Buffer.prototype;else{var k=w-D;N=new Buffer(k,void 0);for(var j=0;j<k;++j)N[j]=this[j+D]}return N},Buffer.prototype.readUIntLE=function readUIntLE(D,w,N){D|=0,w|=0,N||checkOffset(D,w,this.length);for(var F=this[D],k=1,j=0;++j<w&&(k*=256);)F+=this[D+j]*k;return F},Buffer.prototype.readUIntBE=function readUIntBE(D,w,N){D|=0,w|=0,N||checkOffset(D,w,this.length);for(var F=this[D+--w],k=1;w>0&&(k*=256);)F+=this[D+--w]*k;return F},Buffer.prototype.readUInt8=function readUInt8(D,w){return w||checkOffset(D,1,this.length),this[D]},Buffer.prototype.readUInt16LE=function readUInt16LE(D,w){return w||checkOffset(D,2,this.length),this[D]|this[D+1]<<8},Buffer.prototype.readUInt16BE=function readUInt16BE(D,w){return w||checkOffset(D,2,this.length),this[D]<<8|this[D+1]},Buffer.prototype.readUInt32LE=function readUInt32LE(D,w){return w||checkOffset(D,4,this.length),(this[D]|this[D+1]<<8|this[D+2]<<16)+16777216*this[D+3]},Buffer.prototype.readUInt32BE=function readUInt32BE(D,w){return w||checkOffset(D,4,this.length),16777216*this[D]+(this[D+1]<<16|this[D+2]<<8|this[D+3])},Buffer.prototype.readIntLE=function readIntLE(D,w,N){D|=0,w|=0,N||checkOffset(D,w,this.length);for(var F=this[D],k=1,j=0;++j<w&&(k*=256);)F+=this[D+j]*k;return F>=(k*=128)&&(F-=Math.pow(2,8*w)),F},Buffer.prototype.readIntBE=function readIntBE(D,w,N){D|=0,w|=0,N||checkOffset(D,w,this.length);for(var F=w,k=1,j=this[D+--F];F>0&&(k*=256);)j+=this[D+--F]*k;return j>=(k*=128)&&(j-=Math.pow(2,8*w)),j},Buffer.prototype.readInt8=function readInt8(D,w){return w||checkOffset(D,1,this.length),128&this[D]?-1*(255-this[D]+1):this[D]},Buffer.prototype.readInt16LE=function readInt16LE(D,w){w||checkOffset(D,2,this.length);var N=this[D]|this[D+1]<<8;return 32768&N?4294901760|N:N},Buffer.prototype.readInt16BE=function readInt16BE(D,w){w||checkOffset(D,2,this.length);var N=this[D+1]|this[D]<<8;return 32768&N?4294901760|N:N},Buffer.prototype.readInt32LE=function readInt32LE(D,w){return w||checkOffset(D,4,this.length),this[D]|this[D+1]<<8|this[D+2]<<16|this[D+3]<<24},Buffer.prototype.readInt32BE=function readInt32BE(D,w){return w||checkOffset(D,4,this.length),this[D]<<24|this[D+1]<<16|this[D+2]<<8|this[D+3]},Buffer.prototype.readFloatLE=function readFloatLE(D,w){return w||checkOffset(D,4,this.length),k.read(this,D,!0,23,4)},Buffer.prototype.readFloatBE=function readFloatBE(D,w){return w||checkOffset(D,4,this.length),k.read(this,D,!1,23,4)},Buffer.prototype.readDoubleLE=function readDoubleLE(D,w){return w||checkOffset(D,8,this.length),k.read(this,D,!0,52,8)},Buffer.prototype.readDoubleBE=function readDoubleBE(D,w){return w||checkOffset(D,8,this.length),k.read(this,D,!1,52,8)},Buffer.prototype.writeUIntLE=function writeUIntLE(D,w,N,F){(D=+D,w|=0,N|=0,F)||checkInt(this,D,w,N,Math.pow(2,8*N)-1,0);var k=1,j=0;for(this[w]=255&D;++j<N&&(k*=256);)this[w+j]=D/k&255;return w+N},Buffer.prototype.writeUIntBE=function writeUIntBE(D,w,N,F){(D=+D,w|=0,N|=0,F)||checkInt(this,D,w,N,Math.pow(2,8*N)-1,0);var k=N-1,j=1;for(this[w+k]=255&D;--k>=0&&(j*=256);)this[w+k]=D/j&255;return w+N},Buffer.prototype.writeUInt8=function writeUInt8(D,w,N){return D=+D,w|=0,N||checkInt(this,D,w,1,255,0),Buffer.TYPED_ARRAY_SUPPORT||(D=Math.floor(D)),this[w]=255&D,w+1},Buffer.prototype.writeUInt16LE=function writeUInt16LE(D,w,N){return D=+D,w|=0,N||checkInt(this,D,w,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[w]=255&D,this[w+1]=D>>>8):objectWriteUInt16(this,D,w,!0),w+2},Buffer.prototype.writeUInt16BE=function writeUInt16BE(D,w,N){return D=+D,w|=0,N||checkInt(this,D,w,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[w]=D>>>8,this[w+1]=255&D):objectWriteUInt16(this,D,w,!1),w+2},Buffer.prototype.writeUInt32LE=function writeUInt32LE(D,w,N){return D=+D,w|=0,N||checkInt(this,D,w,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[w+3]=D>>>24,this[w+2]=D>>>16,this[w+1]=D>>>8,this[w]=255&D):objectWriteUInt32(this,D,w,!0),w+4},Buffer.prototype.writeUInt32BE=function writeUInt32BE(D,w,N){return D=+D,w|=0,N||checkInt(this,D,w,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[w]=D>>>24,this[w+1]=D>>>16,this[w+2]=D>>>8,this[w+3]=255&D):objectWriteUInt32(this,D,w,!1),w+4},Buffer.prototype.writeIntLE=function writeIntLE(D,w,N,F){if(D=+D,w|=0,!F){var k=Math.pow(2,8*N-1);checkInt(this,D,w,N,k-1,-k)}var j=0,z=1,G=0;for(this[w]=255&D;++j<N&&(z*=256);)D<0&&0===G&&0!==this[w+j-1]&&(G=1),this[w+j]=(D/z>>0)-G&255;return w+N},Buffer.prototype.writeIntBE=function writeIntBE(D,w,N,F){if(D=+D,w|=0,!F){var k=Math.pow(2,8*N-1);checkInt(this,D,w,N,k-1,-k)}var j=N-1,z=1,G=0;for(this[w+j]=255&D;--j>=0&&(z*=256);)D<0&&0===G&&0!==this[w+j+1]&&(G=1),this[w+j]=(D/z>>0)-G&255;return w+N},Buffer.prototype.writeInt8=function writeInt8(D,w,N){return D=+D,w|=0,N||checkInt(this,D,w,1,127,-128),Buffer.TYPED_ARRAY_SUPPORT||(D=Math.floor(D)),D<0&&(D=255+D+1),this[w]=255&D,w+1},Buffer.prototype.writeInt16LE=function writeInt16LE(D,w,N){return D=+D,w|=0,N||checkInt(this,D,w,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[w]=255&D,this[w+1]=D>>>8):objectWriteUInt16(this,D,w,!0),w+2},Buffer.prototype.writeInt16BE=function writeInt16BE(D,w,N){return D=+D,w|=0,N||checkInt(this,D,w,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[w]=D>>>8,this[w+1]=255&D):objectWriteUInt16(this,D,w,!1),w+2},Buffer.prototype.writeInt32LE=function writeInt32LE(D,w,N){return D=+D,w|=0,N||checkInt(this,D,w,4,2147483647,-2147483648),Buffer.TYPED_ARRAY_SUPPORT?(this[w]=255&D,this[w+1]=D>>>8,this[w+2]=D>>>16,this[w+3]=D>>>24):objectWriteUInt32(this,D,w,!0),w+4},Buffer.prototype.writeInt32BE=function writeInt32BE(D,w,N){return D=+D,w|=0,N||checkInt(this,D,w,4,2147483647,-2147483648),D<0&&(D=4294967295+D+1),Buffer.TYPED_ARRAY_SUPPORT?(this[w]=D>>>24,this[w+1]=D>>>16,this[w+2]=D>>>8,this[w+3]=255&D):objectWriteUInt32(this,D,w,!1),w+4},Buffer.prototype.writeFloatLE=function writeFloatLE(D,w,N){return writeFloat(this,D,w,!0,N)},Buffer.prototype.writeFloatBE=function writeFloatBE(D,w,N){return writeFloat(this,D,w,!1,N)},Buffer.prototype.writeDoubleLE=function writeDoubleLE(D,w,N){return writeDouble(this,D,w,!0,N)},Buffer.prototype.writeDoubleBE=function writeDoubleBE(D,w,N){return writeDouble(this,D,w,!1,N)},Buffer.prototype.copy=function copy(D,w,N,F){if(N||(N=0),F||0===F||(F=this.length),w>=D.length&&(w=D.length),w||(w=0),F>0&&F<N&&(F=N),F===N)return 0;if(0===D.length||0===this.length)return 0;if(w<0)throw new RangeError("targetStart out of bounds");if(N<0||N>=this.length)throw new RangeError("sourceStart out of bounds");if(F<0)throw new RangeError("sourceEnd out of bounds");F>this.length&&(F=this.length),D.length-w<F-N&&(F=D.length-w+N);var k,j=F-N;if(this===D&&N<w&&w<F)for(k=j-1;k>=0;--k)D[k+w]=this[k+N];else if(j<1e3||!Buffer.TYPED_ARRAY_SUPPORT)for(k=0;k<j;++k)D[k+w]=this[k+N];else Uint8Array.prototype.set.call(D,this.subarray(N,N+j),w);return j},Buffer.prototype.fill=function fill(D,w,N,F){if("string"==typeof D){if("string"==typeof w?(F=w,w=0,N=this.length):"string"==typeof N&&(F=N,N=this.length),1===D.length){var k=D.charCodeAt(0);k<256&&(D=k)}if(void 0!==F&&"string"!=typeof F)throw new TypeError("encoding must be a string");if("string"==typeof F&&!Buffer.isEncoding(F))throw new TypeError("Unknown encoding: "+F)}else"number"==typeof D&&(D&=255);if(w<0||this.length<w||this.length<N)throw new RangeError("Out of range index");if(N<=w)return this;var j;if(w>>>=0,N=void 0===N?this.length:N>>>0,D||(D=0),"number"==typeof D)for(j=w;j<N;++j)this[j]=D;else{var z=Buffer.isBuffer(D)?D:utf8ToBytes(new Buffer(D,F).toString()),G=z.length;for(j=0;j<N-w;++j)this[j+w]=z[j%G]}return this};var z=/[^+\/0-9A-Za-z-_]/g;function toHex(D){return D<16?"0"+D.toString(16):D.toString(16)}function utf8ToBytes(D,w){var N;w=w||1/0;for(var F=D.length,k=null,j=[],z=0;z<F;++z){if((N=D.charCodeAt(z))>55295&&N<57344){if(!k){if(N>56319){(w-=3)>-1&&j.push(239,191,189);continue}if(z+1===F){(w-=3)>-1&&j.push(239,191,189);continue}k=N;continue}if(N<56320){(w-=3)>-1&&j.push(239,191,189),k=N;continue}N=65536+(k-55296<<10|N-56320)}else k&&(w-=3)>-1&&j.push(239,191,189);if(k=null,N<128){if((w-=1)<0)break;j.push(N)}else if(N<2048){if((w-=2)<0)break;j.push(N>>6|192,63&N|128)}else if(N<65536){if((w-=3)<0)break;j.push(N>>12|224,N>>6&63|128,63&N|128)}else{if(!(N<1114112))throw new Error("Invalid code point");if((w-=4)<0)break;j.push(N>>18|240,N>>12&63|128,N>>6&63|128,63&N|128)}}return j}function base64ToBytes(D){return F.toByteArray(function base64clean(D){if((D=function stringtrim(D){return D.trim?D.trim():D.replace(/^\s+|\s+$/g,"")}(D).replace(z,"")).length<2)return"";for(;D.length%4!=0;)D+="=";return D}(D))}function blitBuffer(D,w,N,F){for(var k=0;k<F&&!(k+N>=w.length||k>=D.length);++k)w[k+N]=D[k];return k}}).call(this,N(6))},function(D,w,N){"use strict";w.byteLength=function byteLength(D){var w=getLens(D),N=w[0],F=w[1];return 3*(N+F)/4-F},w.toByteArray=function toByteArray(D){var w,N,F=getLens(D),z=F[0],G=F[1],H=new j(function _byteLength(D,w,N){return 3*(w+N)/4-N}(0,z,G)),X=0,q=G>0?z-4:z;for(N=0;N<q;N+=4)w=k[D.charCodeAt(N)]<<18|k[D.charCodeAt(N+1)]<<12|k[D.charCodeAt(N+2)]<<6|k[D.charCodeAt(N+3)],H[X++]=w>>16&255,H[X++]=w>>8&255,H[X++]=255&w;2===G&&(w=k[D.charCodeAt(N)]<<2|k[D.charCodeAt(N+1)]>>4,H[X++]=255&w);1===G&&(w=k[D.charCodeAt(N)]<<10|k[D.charCodeAt(N+1)]<<4|k[D.charCodeAt(N+2)]>>2,H[X++]=w>>8&255,H[X++]=255&w);return H},w.fromByteArray=function fromByteArray(D){for(var w,N=D.length,k=N%3,j=[],z=0,G=N-k;z<G;z+=16383)j.push(encodeChunk(D,z,z+16383>G?G:z+16383));1===k?(w=D[N-1],j.push(F[w>>2]+F[w<<4&63]+"==")):2===k&&(w=(D[N-2]<<8)+D[N-1],j.push(F[w>>10]+F[w>>4&63]+F[w<<2&63]+"="));return j.join("")};for(var F=[],k=[],j="undefined"!=typeof Uint8Array?Uint8Array:Array,z="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",G=0,H=z.length;G<H;++G)F[G]=z[G],k[z.charCodeAt(G)]=G;function getLens(D){var w=D.length;if(w%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var N=D.indexOf("=");return-1===N&&(N=w),[N,N===w?0:4-N%4]}function encodeChunk(D,w,N){for(var k,j,z=[],G=w;G<N;G+=3)k=(D[G]<<16&16711680)+(D[G+1]<<8&65280)+(255&D[G+2]),z.push(F[(j=k)>>18&63]+F[j>>12&63]+F[j>>6&63]+F[63&j]);return z.join("")}k["-".charCodeAt(0)]=62,k["_".charCodeAt(0)]=63},function(D,w){w.read=function(D,w,N,F,k){var j,z,G=8*k-F-1,H=(1<<G)-1,X=H>>1,q=-7,Z=N?k-1:0,J=N?-1:1,$=D[w+Z];for(Z+=J,j=$&(1<<-q)-1,$>>=-q,q+=G;q>0;j=256*j+D[w+Z],Z+=J,q-=8);for(z=j&(1<<-q)-1,j>>=-q,q+=F;q>0;z=256*z+D[w+Z],Z+=J,q-=8);if(0===j)j=1-X;else{if(j===H)return z?NaN:1/0*($?-1:1);z+=Math.pow(2,F),j-=X}return($?-1:1)*z*Math.pow(2,j-F)},w.write=function(D,w,N,F,k,j){var z,G,H,X=8*j-k-1,q=(1<<X)-1,Z=q>>1,J=23===k?Math.pow(2,-24)-Math.pow(2,-77):0,$=F?0:j-1,te=F?1:-1,ie=w<0||0===w&&1/w<0?1:0;for(w=Math.abs(w),isNaN(w)||w===1/0?(G=isNaN(w)?1:0,z=q):(z=Math.floor(Math.log(w)/Math.LN2),w*(H=Math.pow(2,-z))<1&&(z--,H*=2),(w+=z+Z>=1?J/H:J*Math.pow(2,1-Z))*H>=2&&(z++,H/=2),z+Z>=q?(G=0,z=q):z+Z>=1?(G=(w*H-1)*Math.pow(2,k),z+=Z):(G=w*Math.pow(2,Z-1)*Math.pow(2,k),z=0));k>=8;D[N+$]=255&G,$+=te,G/=256,k-=8);for(z=z<<k|G,X+=k;X>0;D[N+$]=255&z,$+=te,z/=256,X-=8);D[N+$-te]|=128*ie}},function(D,w){var N={}.toString;D.exports=Array.isArray||function(D){return"[object Array]"==N.call(D)}},function(D,w,N){"use strict";var F=N(199);function isObjectObject(D){return!0===F(D)&&"[object Object]"===Object.prototype.toString.call(D)}D.exports=function isPlainObject(D){var w,N;return!1!==isObjectObject(D)&&("function"==typeof(w=D.constructor)&&(!1!==isObjectObject(N=w.prototype)&&!1!==N.hasOwnProperty("isPrototypeOf")))}},function(D,w,N){"use strict";D.exports=function isObject(D){return null!=D&&"object"==typeof D&&!1===Array.isArray(D)}},,,,function(D,w,N){"use strict";Object.defineProperty(w,"__esModule",{value:!0});var F=N(204);function contribution2D(D,w,N){return{dx:-w-D*F.SQUISH_2D,dy:-N-D*F.SQUISH_2D,xsb:w,ysb:N}}function contribution3D(D,w,N,k){return{dx:-w-D*F.SQUISH_3D,dy:-N-D*F.SQUISH_3D,dz:-k-D*F.SQUISH_3D,xsb:w,ysb:N,zsb:k}}function contribution4D(D,w,N,k,j){return{dx:-w-D*F.SQUISH_4D,dy:-N-D*F.SQUISH_4D,dz:-k-D*F.SQUISH_4D,dw:-j-D*F.SQUISH_4D,xsb:w,ysb:N,zsb:k,wsb:j}}function shuffleSeed(D){var w=new Uint32Array(1);return w[0]=1664525*D[0]+1013904223,w}w.makeNoise2D=function makeNoise2D(D){for(var w=[],N=0;N<F.p2D.length;N+=4){for(var k=F.base2D[F.p2D[N]],j=null,z=null,G=0;G<k.length;G+=3)z=contribution2D(k[G],k[G+1],k[G+2]),null===j?w[N/4]=z:j.next=z,j=z;z.next=contribution2D(F.p2D[N+1],F.p2D[N+2],F.p2D[N+3])}var H=[];for(N=0;N<F.lookupPairs2D.length;N+=2)H[F.lookupPairs2D[N]]=w[F.lookupPairs2D[N+1]];var X=new Uint8Array(256),q=new Uint8Array(256),Z=new Uint8Array(256);for(N=0;N<256;N++)Z[N]=N;var J=new Uint32Array(1);for(J[0]=D,J=shuffleSeed(shuffleSeed(shuffleSeed(J))),N=255;N>=0;N--){J=shuffleSeed(J);var $=new Uint32Array(1);$[0]=(J[0]+31)%(N+1),$[0]<0&&($[0]+=N+1),X[N]=Z[$[0]],q[N]=14&X[N],Z[$[0]]=Z[N]}return function(D,w){for(var N=(D+w)*F.STRETCH_2D,k=D+N,j=w+N,z=Math.floor(k),G=Math.floor(j),Z=(z+G)*F.SQUISH_2D,J=D-(z+Z),$=w-(G+Z),te=k-z,ie=j-G,oe=te+ie,ce=0,he=H[te-ie+1|oe<<1|oe+ie<<2|oe+te<<4];void 0!==he;he=he.next){var fe=J+he.dx,pe=$+he.dy,_e=2-fe*fe-pe*pe;if(_e>0){var ve=z+he.xsb,ye=G+he.ysb,be=X[255&ve],Te=q[be+ye&255];ce+=_e*_e*_e*_e*(F.gradients2D[Te]*fe+F.gradients2D[Te+1]*pe)}}return ce*F.NORM_2D}},w.makeNoise3D=function makeNoise3D(D){for(var w=[],N=0;N<F.p3D.length;N+=9){for(var k=F.base3D[F.p3D[N]],j=null,z=null,G=0;G<k.length;G+=4)z=contribution3D(k[G],k[G+1],k[G+2],k[G+3]),null===j?w[N/9]=z:j.next=z,j=z;z.next=contribution3D(F.p3D[N+1],F.p3D[N+2],F.p3D[N+3],F.p3D[N+4]),z.next.next=contribution3D(F.p3D[N+5],F.p3D[N+6],F.p3D[N+7],F.p3D[N+8])}var H=[];for(N=0;N<F.lookupPairs3D.length;N+=2)H[F.lookupPairs3D[N]]=w[F.lookupPairs3D[N+1]];var X=new Uint8Array(256),q=new Uint8Array(256),Z=new Uint8Array(256);for(N=0;N<256;N++)Z[N]=N;var J=new Uint32Array(1);for(J[0]=D,J=shuffleSeed(shuffleSeed(shuffleSeed(J))),N=255;N>=0;N--){J=shuffleSeed(J);var $=new Uint32Array(1);$[0]=(J[0]+31)%(N+1),$[0]<0&&($[0]+=N+1),X[N]=Z[$[0]],q[N]=X[N]%24*3,Z[$[0]]=Z[N]}return function(D,w,N){for(var k=(D+w+N)*F.STRETCH_3D,j=D+k,z=w+k,G=N+k,Z=Math.floor(j),J=Math.floor(z),$=Math.floor(G),te=(Z+J+$)*F.SQUISH_3D,ie=D-(Z+te),oe=w-(J+te),ce=N-($+te),he=j-Z,fe=z-J,pe=G-$,_e=he+fe+pe,ve=0,ye=H[fe-pe+1|he-fe+1<<1|he-pe+1<<2|_e<<3|_e+pe<<5|_e+fe<<7|_e+he<<9];void 0!==ye;ye=ye.next){var be=ie+ye.dx,Te=oe+ye.dy,Ee=ce+ye.dz,Se=2-be*be-Te*Te-Ee*Ee;if(Se>0){var Me=Z+ye.xsb,xe=J+ye.ysb,Ae=$+ye.zsb,Pe=X[255&Me],Oe=X[Pe+xe&255],Re=q[Oe+Ae&255];ve+=Se*Se*Se*Se*(F.gradients3D[Re]*be+F.gradients3D[Re+1]*Te+F.gradients3D[Re+2]*Ee)}}return ve*F.NORM_3D}},w.makeNoise4D=function makeNoise4D(D){for(var w=[],N=0;N<F.p4D.length;N+=16){for(var k=F.base4D[F.p4D[N]],j=null,z=null,G=0;G<k.length;G+=5)z=contribution4D(k[G],k[G+1],k[G+2],k[G+3],k[G+4]),null===j?w[N/16]=z:j.next=z,j=z;z.next=contribution4D(F.p4D[N+1],F.p4D[N+2],F.p4D[N+3],F.p4D[N+4],F.p4D[N+5]),z.next.next=contribution4D(F.p4D[N+6],F.p4D[N+7],F.p4D[N+8],F.p4D[N+9],F.p4D[N+10]),z.next.next.next=contribution4D(F.p4D[N+11],F.p4D[N+12],F.p4D[N+13],F.p4D[N+14],F.p4D[N+15])}var H=[];for(N=0;N<F.lookupPairs4D.length;N+=2)H[F.lookupPairs4D[N]]=w[F.lookupPairs4D[N+1]];var X=new Uint8Array(256),q=new Uint8Array(256),Z=new Uint8Array(256);for(N=0;N<256;N++)Z[N]=N;var J=new Uint32Array(1);for(J[0]=D,J=shuffleSeed(shuffleSeed(shuffleSeed(J))),N=255;N>=0;N--){J=shuffleSeed(J);var $=new Uint32Array(1);$[0]=(J[0]+31)%(N+1),$[0]<0&&($[0]+=N+1),X[N]=Z[$[0]],q[N]=252&X[N],Z[$[0]]=Z[N]}return function(D,w,N,k){for(var j=(D+w+N+k)*F.STRETCH_4D,z=D+j,G=w+j,Z=N+j,J=k+j,$=Math.floor(z),te=Math.floor(G),ie=Math.floor(Z),oe=Math.floor(J),ce=($+te+ie+oe)*F.SQUISH_4D,he=D-($+ce),fe=w-(te+ce),pe=N-(ie+ce),_e=k-(oe+ce),ve=z-$,ye=G-te,be=Z-ie,Te=J-oe,Ee=ve+ye+be+Te,Se=0,Me=H[be-Te+1|ye-be+1<<1|ye-Te+1<<2|ve-ye+1<<3|ve-be+1<<4|ve-Te+1<<5|Ee<<6|Ee+Te<<8|Ee+be<<11|Ee+ye<<14|Ee+ve<<17];void 0!==Me;Me=Me.next){var xe=he+Me.dx,Ae=fe+Me.dy,Pe=pe+Me.dz,Oe=_e+Me.dw,Re=2-xe*xe-Ae*Ae-Pe*Pe-Oe*Oe;if(Re>0){var De=$+Me.xsb,Ie=te+Me.ysb,Le=ie+Me.zsb,we=oe+Me.wsb,Ne=X[255&De],Fe=X[Ne+Ie&255],Be=X[Fe+Le&255],Ue=q[Be+we&255];Se+=Re*Re*Re*Re*(F.gradients4D[Ue]*xe+F.gradients4D[Ue+1]*Ae+F.gradients4D[Ue+2]*Pe+F.gradients4D[Ue+3]*Oe)}}return Se*F.NORM_4D}}},function(D,w,N){"use strict";Object.defineProperty(w,"__esModule",{value:!0}),w.NORM_2D=1/47,w.NORM_3D=1/103,w.NORM_4D=1/30,w.SQUISH_2D=(Math.sqrt(3)-1)/2,w.SQUISH_3D=(Math.sqrt(4)-1)/3,w.SQUISH_4D=(Math.sqrt(5)-1)/4,w.STRETCH_2D=(1/Math.sqrt(3)-1)/2,w.STRETCH_3D=(1/Math.sqrt(4)-1)/3,w.STRETCH_4D=(1/Math.sqrt(5)-1)/4,w.base2D=[[1,1,0,1,0,1,0,0,0],[1,1,0,1,0,1,2,1,1]],w.base3D=[[0,0,0,0,1,1,0,0,1,0,1,0,1,0,0,1],[2,1,1,0,2,1,0,1,2,0,1,1,3,1,1,1],[1,1,0,0,1,0,1,0,1,0,0,1,2,1,1,0,2,1,0,1,2,0,1,1]],w.base4D=[[0,0,0,0,0,1,1,0,0,0,1,0,1,0,0,1,0,0,1,0,1,0,0,0,1],[3,1,1,1,0,3,1,1,0,1,3,1,0,1,1,3,0,1,1,1,4,1,1,1,1],[1,1,0,0,0,1,0,1,0,0,1,0,0,1,0,1,0,0,0,1,2,1,1,0,0,2,1,0,1,0,2,1,0,0,1,2,0,1,1,0,2,0,1,0,1,2,0,0,1,1],[3,1,1,1,0,3,1,1,0,1,3,1,0,1,1,3,0,1,1,1,2,1,1,0,0,2,1,0,1,0,2,1,0,0,1,2,0,1,1,0,2,0,1,0,1,2,0,0,1,1]],w.gradients2D=[5,2,2,5,-5,2,-2,5,5,-2,2,-5,-5,-2,-2,-5],w.gradients3D=[-11,4,4,-4,11,4,-4,4,11,11,4,4,4,11,4,4,4,11,-11,-4,4,-4,-11,4,-4,-4,11,11,-4,4,4,-11,4,4,-4,11,-11,4,-4,-4,11,-4,-4,4,-11,11,4,-4,4,11,-4,4,4,-11,-11,-4,-4,-4,-11,-4,-4,-4,-11,11,-4,-4,4,-11,-4,4,-4,-11],w.gradients4D=[3,1,1,1,1,3,1,1,1,1,3,1,1,1,1,3,-3,1,1,1,-1,3,1,1,-1,1,3,1,-1,1,1,3,3,-1,1,1,1,-3,1,1,1,-1,3,1,1,-1,1,3,-3,-1,1,1,-1,-3,1,1,-1,-1,3,1,-1,-1,1,3,3,1,-1,1,1,3,-1,1,1,1,-3,1,1,1,-1,3,-3,1,-1,1,-1,3,-1,1,-1,1,-3,1,-1,1,-1,3,3,-1,-1,1,1,-3,-1,1,1,-1,-3,1,1,-1,-1,3,-3,-1,-1,1,-1,-3,-1,1,-1,-1,-3,1,-1,-1,-1,3,3,1,1,-1,1,3,1,-1,1,1,3,-1,1,1,1,-3,-3,1,1,-1,-1,3,1,-1,-1,1,3,-1,-1,1,1,-3,3,-1,1,-1,1,-3,1,-1,1,-1,3,-1,1,-1,1,-3,-3,-1,1,-1,-1,-3,1,-1,-1,-1,3,-1,-1,-1,1,-3,3,1,-1,-1,1,3,-1,-1,1,1,-3,-1,1,1,-1,-3,-3,1,-1,-1,-1,3,-1,-1,-1,1,-3,-1,-1,1,-1,-3,3,-1,-1,-1,1,-3,-1,-1,1,-1,-3,-1,1,-1,-1,-3,-3,-1,-1,-1,-1,-3,-1,-1,-1,-1,-3,-1,-1,-1,-1,-3],w.lookupPairs2D=[0,1,1,0,4,1,17,0,20,2,21,2,22,5,23,5,26,4,39,3,42,4,43,3],w.lookupPairs3D=[0,2,1,1,2,2,5,1,6,0,7,0,32,2,34,2,129,1,133,1,160,5,161,5,518,0,519,0,546,4,550,4,645,3,647,3,672,5,673,5,674,4,677,3,678,4,679,3,680,13,681,13,682,12,685,14,686,12,687,14,712,20,714,18,809,21,813,23,840,20,841,21,1198,19,1199,22,1226,18,1230,19,1325,23,1327,22,1352,15,1353,17,1354,15,1357,17,1358,16,1359,16,1360,11,1361,10,1362,11,1365,10,1366,9,1367,9,1392,11,1394,11,1489,10,1493,10,1520,8,1521,8,1878,9,1879,9,1906,7,1910,7,2005,6,2007,6,2032,8,2033,8,2034,7,2037,6,2038,7,2039,6],w.lookupPairs4D=[0,3,1,2,2,3,5,2,6,1,7,1,8,3,9,2,10,3,13,2,16,3,18,3,22,1,23,1,24,3,26,3,33,2,37,2,38,1,39,1,41,2,45,2,54,1,55,1,56,0,57,0,58,0,59,0,60,0,61,0,62,0,63,0,256,3,258,3,264,3,266,3,272,3,274,3,280,3,282,3,2049,2,2053,2,2057,2,2061,2,2081,2,2085,2,2089,2,2093,2,2304,9,2305,9,2312,9,2313,9,16390,1,16391,1,16406,1,16407,1,16422,1,16423,1,16438,1,16439,1,16642,8,16646,8,16658,8,16662,8,18437,6,18439,6,18469,6,18471,6,18688,9,18689,9,18690,8,18693,6,18694,8,18695,6,18696,9,18697,9,18706,8,18710,8,18725,6,18727,6,131128,0,131129,0,131130,0,131131,0,131132,0,131133,0,131134,0,131135,0,131352,7,131354,7,131384,7,131386,7,133161,5,133165,5,133177,5,133181,5,133376,9,133377,9,133384,9,133385,9,133400,7,133402,7,133417,5,133421,5,133432,7,133433,5,133434,7,133437,5,147510,4,147511,4,147518,4,147519,4,147714,8,147718,8,147730,8,147734,8,147736,7,147738,7,147766,4,147767,4,147768,7,147770,7,147774,4,147775,4,149509,6,149511,6,149541,6,149543,6,149545,5,149549,5,149558,4,149559,4,149561,5,149565,5,149566,4,149567,4,149760,9,149761,9,149762,8,149765,6,149766,8,149767,6,149768,9,149769,9,149778,8,149782,8,149784,7,149786,7,149797,6,149799,6,149801,5,149805,5,149814,4,149815,4,149816,7,149817,5,149818,7,149821,5,149822,4,149823,4,149824,37,149825,37,149826,36,149829,34,149830,36,149831,34,149832,37,149833,37,149842,36,149846,36,149848,35,149850,35,149861,34,149863,34,149865,33,149869,33,149878,32,149879,32,149880,35,149881,33,149882,35,149885,33,149886,32,149887,32,150080,49,150082,48,150088,49,150098,48,150104,47,150106,47,151873,46,151877,45,151881,46,151909,45,151913,44,151917,44,152128,49,152129,46,152136,49,152137,46,166214,43,166215,42,166230,43,166247,42,166262,41,166263,41,166466,48,166470,43,166482,48,166486,43,168261,45,168263,42,168293,45,168295,42,168512,31,168513,28,168514,31,168517,28,168518,25,168519,25,280952,40,280953,39,280954,40,280957,39,280958,38,280959,38,281176,47,281178,47,281208,40,281210,40,282985,44,282989,44,283001,39,283005,39,283208,30,283209,27,283224,30,283241,27,283256,22,283257,22,297334,41,297335,41,297342,38,297343,38,297554,29,297558,24,297562,29,297590,24,297594,21,297598,21,299365,26,299367,23,299373,26,299383,23,299389,20,299391,20,299584,31,299585,28,299586,31,299589,28,299590,25,299591,25,299592,30,299593,27,299602,29,299606,24,299608,30,299610,29,299621,26,299623,23,299625,27,299629,26,299638,24,299639,23,299640,22,299641,22,299642,21,299645,20,299646,21,299647,20,299648,61,299649,60,299650,61,299653,60,299654,59,299655,59,299656,58,299657,57,299666,55,299670,54,299672,58,299674,55,299685,52,299687,51,299689,57,299693,52,299702,54,299703,51,299704,56,299705,56,299706,53,299709,50,299710,53,299711,50,299904,61,299906,61,299912,58,299922,55,299928,58,299930,55,301697,60,301701,60,301705,57,301733,52,301737,57,301741,52,301952,79,301953,79,301960,76,301961,76,316038,59,316039,59,316054,54,316071,51,316086,54,316087,51,316290,78,316294,78,316306,73,316310,73,318085,77,318087,77,318117,70,318119,70,318336,79,318337,79,318338,78,318341,77,318342,78,318343,77,430776,56,430777,56,430778,53,430781,50,430782,53,430783,50,431e3,75,431002,72,431032,75,431034,72,432809,74,432813,69,432825,74,432829,69,433032,76,433033,76,433048,75,433065,74,433080,75,433081,74,447158,71,447159,68,447166,71,447167,68,447378,73,447382,73,447386,72,447414,71,447418,72,447422,71,449189,70,449191,70,449197,69,449207,68,449213,69,449215,68,449408,67,449409,67,449410,66,449413,64,449414,66,449415,64,449416,67,449417,67,449426,66,449430,66,449432,65,449434,65,449445,64,449447,64,449449,63,449453,63,449462,62,449463,62,449464,65,449465,63,449466,65,449469,63,449470,62,449471,62,449472,19,449473,19,449474,18,449477,16,449478,18,449479,16,449480,19,449481,19,449490,18,449494,18,449496,17,449498,17,449509,16,449511,16,449513,15,449517,15,449526,14,449527,14,449528,17,449529,15,449530,17,449533,15,449534,14,449535,14,449728,19,449729,19,449730,18,449734,18,449736,19,449737,19,449746,18,449750,18,449752,17,449754,17,449784,17,449786,17,451520,19,451521,19,451525,16,451527,16,451528,19,451529,19,451557,16,451559,16,451561,15,451565,15,451577,15,451581,15,451776,19,451777,19,451784,19,451785,19,465858,18,465861,16,465862,18,465863,16,465874,18,465878,18,465893,16,465895,16,465910,14,465911,14,465918,14,465919,14,466114,18,466118,18,466130,18,466134,18,467909,16,467911,16,467941,16,467943,16,468160,13,468161,13,468162,13,468163,13,468164,13,468165,13,468166,13,468167,13,580568,17,580570,17,580585,15,580589,15,580598,14,580599,14,580600,17,580601,15,580602,17,580605,15,580606,14,580607,14,580824,17,580826,17,580856,17,580858,17,582633,15,582637,15,582649,15,582653,15,582856,12,582857,12,582872,12,582873,12,582888,12,582889,12,582904,12,582905,12,596982,14,596983,14,596990,14,596991,14,597202,11,597206,11,597210,11,597214,11,597234,11,597238,11,597242,11,597246,11,599013,10,599015,10,599021,10,599023,10,599029,10,599031,10,599037,10,599039,10,599232,13,599233,13,599234,13,599235,13,599236,13,599237,13,599238,13,599239,13,599240,12,599241,12,599250,11,599254,11,599256,12,599257,12,599258,11,599262,11,599269,10,599271,10,599272,12,599273,12,599277,10,599279,10,599282,11,599285,10,599286,11,599287,10,599288,12,599289,12,599290,11,599293,10,599294,11,599295,10],w.p2D=[0,0,1,-1,0,0,-1,1,0,2,1,1,1,2,2,0,1,2,0,2,1,0,0,0],w.p3D=[0,0,1,-1,0,0,1,0,-1,0,0,-1,1,0,0,0,1,-1,0,0,-1,0,1,0,0,-1,1,0,2,1,1,0,1,1,1,-1,0,2,1,0,1,1,1,-1,1,0,2,0,1,1,1,-1,1,1,1,3,2,1,0,3,1,2,0,1,3,2,0,1,3,1,0,2,1,3,0,2,1,3,0,1,2,1,1,1,0,0,2,2,0,0,1,1,0,1,0,2,0,2,0,1,1,0,0,1,2,0,0,2,2,0,0,0,0,1,1,-1,1,2,0,0,0,0,1,-1,1,1,2,0,0,0,0,1,1,1,-1,2,3,1,1,1,2,0,0,2,2,3,1,1,1,2,2,0,0,2,3,1,1,1,2,0,2,0,2,1,1,-1,1,2,0,0,2,2,1,1,-1,1,2,2,0,0,2,1,-1,1,1,2,0,0,2,2,1,-1,1,1,2,0,2,0,2,1,1,1,-1,2,2,0,0,2,1,1,1,-1,2,0,2,0],w.p4D=[0,0,1,-1,0,0,0,1,0,-1,0,0,1,0,0,-1,0,0,-1,1,0,0,0,0,1,-1,0,0,0,1,0,-1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,-1,0,0,-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,2,1,1,0,0,1,1,1,-1,0,1,1,1,0,-1,0,2,1,0,1,0,1,1,-1,1,0,1,1,0,1,-1,0,2,0,1,1,0,1,-1,1,1,0,1,0,1,1,-1,0,2,1,0,0,1,1,1,-1,0,1,1,1,0,-1,1,0,2,0,1,0,1,1,-1,1,0,1,1,0,1,-1,1,0,2,0,0,1,1,1,-1,0,1,1,1,0,-1,1,1,1,4,2,1,1,0,4,1,2,1,0,4,1,1,2,0,1,4,2,1,0,1,4,1,2,0,1,4,1,1,0,2,1,4,2,0,1,1,4,1,0,2,1,4,1,0,1,2,1,4,0,2,1,1,4,0,1,2,1,4,0,1,1,2,1,2,1,1,0,0,3,2,1,0,0,3,1,2,0,0,1,2,1,0,1,0,3,2,0,1,0,3,1,0,2,0,1,2,0,1,1,0,3,0,2,1,0,3,0,1,2,0,1,2,1,0,0,1,3,2,0,0,1,3,1,0,0,2,1,2,0,1,0,1,3,0,2,0,1,3,0,1,0,2,1,2,0,0,1,1,3,0,0,2,1,3,0,0,1,2,2,3,1,1,1,0,2,1,1,1,-1,2,2,0,0,0,2,3,1,1,0,1,2,1,1,-1,1,2,2,0,0,0,2,3,1,0,1,1,2,1,-1,1,1,2,2,0,0,0,2,3,1,1,1,0,2,1,1,1,-1,2,0,2,0,0,2,3,1,1,0,1,2,1,1,-1,1,2,0,2,0,0,2,3,0,1,1,1,2,-1,1,1,1,2,0,2,0,0,2,3,1,1,1,0,2,1,1,1,-1,2,0,0,2,0,2,3,1,0,1,1,2,1,-1,1,1,2,0,0,2,0,2,3,0,1,1,1,2,-1,1,1,1,2,0,0,2,0,2,3,1,1,0,1,2,1,1,-1,1,2,0,0,0,2,2,3,1,0,1,1,2,1,-1,1,1,2,0,0,0,2,2,3,0,1,1,1,2,-1,1,1,1,2,0,0,0,2,2,1,1,1,-1,0,1,1,1,0,-1,0,0,0,0,0,2,1,1,-1,1,0,1,1,0,1,-1,0,0,0,0,0,2,1,-1,1,1,0,1,0,1,1,-1,0,0,0,0,0,2,1,1,-1,0,1,1,1,0,-1,1,0,0,0,0,0,2,1,-1,1,0,1,1,0,1,-1,1,0,0,0,0,0,2,1,-1,0,1,1,1,0,-1,1,1,0,0,0,0,0,2,1,1,1,-1,0,1,1,1,0,-1,2,2,0,0,0,2,1,1,-1,1,0,1,1,0,1,-1,2,2,0,0,0,2,1,1,-1,0,1,1,1,0,-1,1,2,2,0,0,0,2,1,1,1,-1,0,1,1,1,0,-1,2,0,2,0,0,2,1,-1,1,1,0,1,0,1,1,-1,2,0,2,0,0,2,1,-1,1,0,1,1,0,1,-1,1,2,0,2,0,0,2,1,1,-1,1,0,1,1,0,1,-1,2,0,0,2,0,2,1,-1,1,1,0,1,0,1,1,-1,2,0,0,2,0,2,1,-1,0,1,1,1,0,-1,1,1,2,0,0,2,0,2,1,1,-1,0,1,1,1,0,-1,1,2,0,0,0,2,2,1,-1,1,0,1,1,0,1,-1,1,2,0,0,0,2,2,1,-1,0,1,1,1,0,-1,1,1,2,0,0,0,2,3,1,1,0,0,0,2,2,0,0,0,2,1,1,1,-1,3,1,0,1,0,0,2,0,2,0,0,2,1,1,1,-1,3,1,0,0,1,0,2,0,0,2,0,2,1,1,1,-1,3,1,1,0,0,0,2,2,0,0,0,2,1,1,-1,1,3,1,0,1,0,0,2,0,2,0,0,2,1,1,-1,1,3,1,0,0,0,1,2,0,0,0,2,2,1,1,-1,1,3,1,1,0,0,0,2,2,0,0,0,2,1,-1,1,1,3,1,0,0,1,0,2,0,0,2,0,2,1,-1,1,1,3,1,0,0,0,1,2,0,0,0,2,2,1,-1,1,1,3,1,0,1,0,0,2,0,2,0,0,2,-1,1,1,1,3,1,0,0,1,0,2,0,0,2,0,2,-1,1,1,1,3,1,0,0,0,1,2,0,0,0,2,2,-1,1,1,1,3,3,2,1,0,0,3,1,2,0,0,4,1,1,1,1,3,3,2,0,1,0,3,1,0,2,0,4,1,1,1,1,3,3,0,2,1,0,3,0,1,2,0,4,1,1,1,1,3,3,2,0,0,1,3,1,0,0,2,4,1,1,1,1,3,3,0,2,0,1,3,0,1,0,2,4,1,1,1,1,3,3,0,0,2,1,3,0,0,1,2,4,1,1,1,1,3,3,2,1,0,0,3,1,2,0,0,2,1,1,1,-1,3,3,2,0,1,0,3,1,0,2,0,2,1,1,1,-1,3,3,0,2,1,0,3,0,1,2,0,2,1,1,1,-1,3,3,2,1,0,0,3,1,2,0,0,2,1,1,-1,1,3,3,2,0,0,1,3,1,0,0,2,2,1,1,-1,1,3,3,0,2,0,1,3,0,1,0,2,2,1,1,-1,1,3,3,2,0,1,0,3,1,0,2,0,2,1,-1,1,1,3,3,2,0,0,1,3,1,0,0,2,2,1,-1,1,1,3,3,0,0,2,1,3,0,0,1,2,2,1,-1,1,1,3,3,0,2,1,0,3,0,1,2,0,2,-1,1,1,1,3,3,0,2,0,1,3,0,1,0,2,2,-1,1,1,1,3,3,0,0,2,1,3,0,0,1,2,2,-1,1,1,1]},function(D,w){var N=1e3,F=6e4,k=60*F,j=24*k;function plural(D,w,N,F){var k=w>=1.5*N;return Math.round(D/N)+" "+F+(k?"s":"")}D.exports=function(D,w){w=w||{};var z=typeof D;if("string"===z&&D.length>0)return function parse(D){if((D=String(D)).length>100)return;var w=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(D);if(!w)return;var z=parseFloat(w[1]);switch((w[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*z;case"weeks":case"week":case"w":return 6048e5*z;case"days":case"day":case"d":return z*j;case"hours":case"hour":case"hrs":case"hr":case"h":return z*k;case"minutes":case"minute":case"mins":case"min":case"m":return z*F;case"seconds":case"second":case"secs":case"sec":case"s":return z*N;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return z;default:return}}(D);if("number"===z&&isFinite(D))return w.long?function fmtLong(D){var w=Math.abs(D);if(w>=j)return plural(D,w,j,"day");if(w>=k)return plural(D,w,k,"hour");if(w>=F)return plural(D,w,F,"minute");if(w>=N)return plural(D,w,N,"second");return D+" ms"}(D):function fmtShort(D){var w=Math.abs(D);if(w>=j)return Math.round(D/j)+"d";if(w>=k)return Math.round(D/k)+"h";if(w>=F)return Math.round(D/F)+"m";if(w>=N)return Math.round(D/N)+"s";return D+"ms"}(D);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(D))}},,function(D,w,N){(function(D){function normalizeArray(D,w){for(var N=0,F=D.length-1;F>=0;F--){var k=D[F];"."===k?D.splice(F,1):".."===k?(D.splice(F,1),N++):N&&(D.splice(F,1),N--)}if(w)for(;N--;N)D.unshift("..");return D}function filter(D,w){if(D.filter)return D.filter(w);for(var N=[],F=0;F<D.length;F++)w(D[F],F,D)&&N.push(D[F]);return N}w.resolve=function(){for(var w="",N=!1,F=arguments.length-1;F>=-1&&!N;F--){var k=F>=0?arguments[F]:D.cwd();if("string"!=typeof k)throw new TypeError("Arguments to path.resolve must be strings");k&&(w=k+"/"+w,N="/"===k.charAt(0))}return(N?"/":"")+(w=normalizeArray(filter(w.split("/"),(function(D){return!!D})),!N).join("/"))||"."},w.normalize=function(D){var F=w.isAbsolute(D),k="/"===N(D,-1);return(D=normalizeArray(filter(D.split("/"),(function(D){return!!D})),!F).join("/"))||F||(D="."),D&&k&&(D+="/"),(F?"/":"")+D},w.isAbsolute=function(D){return"/"===D.charAt(0)},w.join=function(){var D=Array.prototype.slice.call(arguments,0);return w.normalize(filter(D,(function(D,w){if("string"!=typeof D)throw new TypeError("Arguments to path.join must be strings");return D})).join("/"))},w.relative=function(D,N){function trim(D){for(var w=0;w<D.length&&""===D[w];w++);for(var N=D.length-1;N>=0&&""===D[N];N--);return w>N?[]:D.slice(w,N-w+1)}D=w.resolve(D).substr(1),N=w.resolve(N).substr(1);for(var F=trim(D.split("/")),k=trim(N.split("/")),j=Math.min(F.length,k.length),z=j,G=0;G<j;G++)if(F[G]!==k[G]){z=G;break}var H=[];for(G=z;G<F.length;G++)H.push("..");return(H=H.concat(k.slice(z))).join("/")},w.sep="/",w.delimiter=":",w.dirname=function(D){if("string"!=typeof D&&(D+=""),0===D.length)return".";for(var w=D.charCodeAt(0),N=47===w,F=-1,k=!0,j=D.length-1;j>=1;--j)if(47===(w=D.charCodeAt(j))){if(!k){F=j;break}}else k=!1;return-1===F?N?"/":".":N&&1===F?"/":D.slice(0,F)},w.basename=function(D,w){var N=function basename(D){"string"!=typeof D&&(D+="");var w,N=0,F=-1,k=!0;for(w=D.length-1;w>=0;--w)if(47===D.charCodeAt(w)){if(!k){N=w+1;break}}else-1===F&&(k=!1,F=w+1);return-1===F?"":D.slice(N,F)}(D);return w&&N.substr(-1*w.length)===w&&(N=N.substr(0,N.length-w.length)),N},w.extname=function(D){"string"!=typeof D&&(D+="");for(var w=-1,N=0,F=-1,k=!0,j=0,z=D.length-1;z>=0;--z){var G=D.charCodeAt(z);if(47!==G)-1===F&&(k=!1,F=z+1),46===G?-1===w?w=z:1!==j&&(j=1):-1!==w&&(j=-1);else if(!k){N=z+1;break}}return-1===w||-1===F||0===j||1===j&&w===F-1&&w===N+1?"":D.slice(w,F)};var N="b"==="ab".substr(-1)?function(D,w,N){return D.substr(w,N)}:function(D,w,N){return w<0&&(w=D.length+w),D.substr(w,N)}}).call(this,N(7))},function(D,w,N){(function(w){D.exports=function e(D,w,N){function s(k,j){if(!w[k]){if(!D[k]){if(F)return F(k,!0);var z=new Error("Cannot find module '"+k+"'");throw z.code="MODULE_NOT_FOUND",z}var G=w[k]={exports:{}};D[k][0].call(G.exports,(function(w){var N=D[k][1][w];return s(N||w)}),G,G.exports,e,D,w,N)}return w[k].exports}for(var F=!1,k=0;k<N.length;k++)s(N[k]);return s}({1:[function(D,N,F){(function(D){"use strict";var w,F,k=D.MutationObserver||D.WebKitMutationObserver;if(k){var j=0,z=new k(nextTick),G=D.document.createTextNode("");z.observe(G,{characterData:!0}),w=function(){G.data=j=++j%2}}else if(D.setImmediate||void 0===D.MessageChannel)w="document"in D&&"onreadystatechange"in D.document.createElement("script")?function(){var w=D.document.createElement("script");w.onreadystatechange=function(){nextTick(),w.onreadystatechange=null,w.parentNode.removeChild(w),w=null},D.document.documentElement.appendChild(w)}:function(){setTimeout(nextTick,0)};else{var H=new D.MessageChannel;H.port1.onmessage=nextTick,w=function(){H.port2.postMessage(0)}}var X=[];function nextTick(){var D,w;F=!0;for(var N=X.length;N;){for(w=X,X=[],D=-1;++D<N;)w[D]();N=X.length}F=!1}N.exports=function immediate(D){1!==X.push(D)||F||w()}}).call(this,void 0!==w?w:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(D,w,N){"use strict";var F=D(1);function INTERNAL(){}var k={},j=["REJECTED"],z=["FULFILLED"],G=["PENDING"];function Promise(D){if("function"!=typeof D)throw new TypeError("resolver must be a function");this.state=G,this.queue=[],this.outcome=void 0,D!==INTERNAL&&safelyResolveThenable(this,D)}function QueueItem(D,w,N){this.promise=D,"function"==typeof w&&(this.onFulfilled=w,this.callFulfilled=this.otherCallFulfilled),"function"==typeof N&&(this.onRejected=N,this.callRejected=this.otherCallRejected)}function unwrap(D,w,N){F((function(){var F;try{F=w(N)}catch(w){return k.reject(D,w)}F===D?k.reject(D,new TypeError("Cannot resolve promise with itself")):k.resolve(D,F)}))}function getThen(D){var w=D&&D.then;if(D&&("object"==typeof D||"function"==typeof D)&&"function"==typeof w)return function appyThen(){w.apply(D,arguments)}}function safelyResolveThenable(D,w){var N=!1;function onError(w){N||(N=!0,k.reject(D,w))}function onSuccess(w){N||(N=!0,k.resolve(D,w))}var F=tryCatch((function tryToUnwrap(){w(onSuccess,onError)}));"error"===F.status&&onError(F.value)}function tryCatch(D,w){var N={};try{N.value=D(w),N.status="success"}catch(D){N.status="error",N.value=D}return N}w.exports=Promise,Promise.prototype.catch=function(D){return this.then(null,D)},Promise.prototype.then=function(D,w){if("function"!=typeof D&&this.state===z||"function"!=typeof w&&this.state===j)return this;var N=new this.constructor(INTERNAL);return this.state!==G?unwrap(N,this.state===z?D:w,this.outcome):this.queue.push(new QueueItem(N,D,w)),N},QueueItem.prototype.callFulfilled=function(D){k.resolve(this.promise,D)},QueueItem.prototype.otherCallFulfilled=function(D){unwrap(this.promise,this.onFulfilled,D)},QueueItem.prototype.callRejected=function(D){k.reject(this.promise,D)},QueueItem.prototype.otherCallRejected=function(D){unwrap(this.promise,this.onRejected,D)},k.resolve=function(D,w){var N=tryCatch(getThen,w);if("error"===N.status)return k.reject(D,N.value);var F=N.value;if(F)safelyResolveThenable(D,F);else{D.state=z,D.outcome=w;for(var j=-1,G=D.queue.length;++j<G;)D.queue[j].callFulfilled(w)}return D},k.reject=function(D,w){D.state=j,D.outcome=w;for(var N=-1,F=D.queue.length;++N<F;)D.queue[N].callRejected(w);return D},Promise.resolve=function resolve(D){return D instanceof this?D:k.resolve(new this(INTERNAL),D)},Promise.reject=function reject(D){var w=new this(INTERNAL);return k.reject(w,D)},Promise.all=function all(D){var w=this;if("[object Array]"!==Object.prototype.toString.call(D))return this.reject(new TypeError("must be an array"));var N=D.length,F=!1;if(!N)return this.resolve([]);for(var j=new Array(N),z=0,G=-1,H=new this(INTERNAL);++G<N;)allResolver(D[G],G);return H;function allResolver(D,G){w.resolve(D).then((function resolveFromAll(D){j[G]=D,++z!==N||F||(F=!0,k.resolve(H,j))}),(function(D){F||(F=!0,k.reject(H,D))}))}},Promise.race=function race(D){var w=this;if("[object Array]"!==Object.prototype.toString.call(D))return this.reject(new TypeError("must be an array"));var N=D.length,F=!1;if(!N)return this.resolve([]);for(var j,z=-1,G=new this(INTERNAL);++z<N;)j=D[z],w.resolve(j).then((function(D){F||(F=!0,k.resolve(G,D))}),(function(D){F||(F=!0,k.reject(G,D))}));return G}},{1:1}],3:[function(D,N,F){(function(w){"use strict";"function"!=typeof w.Promise&&(w.Promise=D(2))}).call(this,void 0!==w?w:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(D,w,N){"use strict";var F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(D){return typeof D}:function(D){return D&&"function"==typeof Symbol&&D.constructor===Symbol&&D!==Symbol.prototype?"symbol":typeof D},k=function getIDB(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(D){return}}();function createBlob(D,w){D=D||[],w=w||{};try{return new Blob(D,w)}catch(k){if("TypeError"!==k.name)throw k;for(var N=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),F=0;F<D.length;F+=1)N.append(D[F]);return N.getBlob(w.type)}}"undefined"==typeof Promise&&D(3);var j=Promise;function executeCallback(D,w){w&&D.then((function(D){w(null,D)}),(function(D){w(D)}))}function executeTwoCallbacks(D,w,N){"function"==typeof w&&D.then(w),"function"==typeof N&&D.catch(N)}function normalizeKey(D){return"string"!=typeof D&&(console.warn(D+" used as a key, but it is not a string."),D=String(D)),D}function getCallback(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var z=void 0,G={},H=Object.prototype.toString;function _checkBlobSupport(D){return"boolean"==typeof z?j.resolve(z):function _checkBlobSupportWithoutCaching(D){return new j((function(w){var N=D.transaction("local-forage-detect-blob-support","readwrite"),F=createBlob([""]);N.objectStore("local-forage-detect-blob-support").put(F,"key"),N.onabort=function(D){D.preventDefault(),D.stopPropagation(),w(!1)},N.oncomplete=function(){var D=navigator.userAgent.match(/Chrome\/(\d+)/),N=navigator.userAgent.match(/Edge\//);w(N||!D||parseInt(D[1],10)>=43)}})).catch((function(){return!1}))}(D).then((function(D){return z=D}))}function _deferReadiness(D){var w=G[D.name],N={};N.promise=new j((function(D,w){N.resolve=D,N.reject=w})),w.deferredOperations.push(N),w.dbReady?w.dbReady=w.dbReady.then((function(){return N.promise})):w.dbReady=N.promise}function _advanceReadiness(D){var w=G[D.name].deferredOperations.pop();if(w)return w.resolve(),w.promise}function _rejectReadiness(D,w){var N=G[D.name].deferredOperations.pop();if(N)return N.reject(w),N.promise}function _getConnection(D,w){return new j((function(N,F){if(G[D.name]=G[D.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},D.db){if(!w)return N(D.db);_deferReadiness(D),D.db.close()}var j=[D.name];w&&j.push(D.version);var z=k.open.apply(k,j);w&&(z.onupgradeneeded=function(w){var N=z.result;try{N.createObjectStore(D.storeName),w.oldVersion<=1&&N.createObjectStore("local-forage-detect-blob-support")}catch(N){if("ConstraintError"!==N.name)throw N;console.warn('The database "'+D.name+'" has been upgraded from version '+w.oldVersion+" to version "+w.newVersion+', but the storage "'+D.storeName+'" already exists.')}}),z.onerror=function(D){D.preventDefault(),F(z.error)},z.onsuccess=function(){N(z.result),_advanceReadiness(D)}}))}function _getOriginalConnection(D){return _getConnection(D,!1)}function _getUpgradedConnection(D){return _getConnection(D,!0)}function _isUpgradeNeeded(D,w){if(!D.db)return!0;var N=!D.db.objectStoreNames.contains(D.storeName),F=D.version<D.db.version,k=D.version>D.db.version;if(F&&(D.version!==w&&console.warn('The database "'+D.name+"\" can't be downgraded from version "+D.db.version+" to version "+D.version+"."),D.version=D.db.version),k||N){if(N){var j=D.db.version+1;j>D.version&&(D.version=j)}return!0}return!1}function _decodeBlob(D){return createBlob([function _binStringToArrayBuffer(D){for(var w=D.length,N=new ArrayBuffer(w),F=new Uint8Array(N),k=0;k<w;k++)F[k]=D.charCodeAt(k);return N}(atob(D.data))],{type:D.type})}function _isEncodedBlob(D){return D&&D.__local_forage_encoded_blob}function _fullyReady(D){var w=this,N=w._initReady().then((function(){var D=G[w._dbInfo.name];if(D&&D.dbReady)return D.dbReady}));return executeTwoCallbacks(N,D,D),N}function createTransaction(D,w,N,F){void 0===F&&(F=1);try{var k=D.db.transaction(D.storeName,w);N(null,k)}catch(k){if(F>0&&(!D.db||"InvalidStateError"===k.name||"NotFoundError"===k.name))return j.resolve().then((function(){if(!D.db||"NotFoundError"===k.name&&!D.db.objectStoreNames.contains(D.storeName)&&D.version<=D.db.version)return D.db&&(D.version=D.db.version+1),_getUpgradedConnection(D)})).then((function(){return function _tryReconnect(D){_deferReadiness(D);for(var w=G[D.name],N=w.forages,F=0;F<N.length;F++){var k=N[F];k._dbInfo.db&&(k._dbInfo.db.close(),k._dbInfo.db=null)}return D.db=null,_getOriginalConnection(D).then((function(w){return D.db=w,_isUpgradeNeeded(D)?_getUpgradedConnection(D):w})).then((function(F){D.db=w.db=F;for(var k=0;k<N.length;k++)N[k]._dbInfo.db=F})).catch((function(w){throw _rejectReadiness(D,w),w}))}(D).then((function(){createTransaction(D,w,N,F-1)}))})).catch(N);N(k)}}var X={_driver:"asyncStorage",_initStorage:function _initStorage(D){var w=this,N={db:null};if(D)for(var F in D)N[F]=D[F];var k=G[N.name];k||(k={forages:[],db:null,dbReady:null,deferredOperations:[]},G[N.name]=k),k.forages.push(w),w._initReady||(w._initReady=w.ready,w.ready=_fullyReady);var z=[];function ignoreErrors(){return j.resolve()}for(var H=0;H<k.forages.length;H++){var X=k.forages[H];X!==w&&z.push(X._initReady().catch(ignoreErrors))}var q=k.forages.slice(0);return j.all(z).then((function(){return N.db=k.db,_getOriginalConnection(N)})).then((function(D){return N.db=D,_isUpgradeNeeded(N,w._defaultConfig.version)?_getUpgradedConnection(N):D})).then((function(D){N.db=k.db=D,w._dbInfo=N;for(var F=0;F<q.length;F++){var j=q[F];j!==w&&(j._dbInfo.db=N.db,j._dbInfo.version=N.version)}}))},_support:function isIndexedDBValid(){try{if(!k)return!1;var D="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),w="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!D||w)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(D){return!1}}(),iterate:function iterate(D,w){var N=this,F=new j((function(w,F){N.ready().then((function(){createTransaction(N._dbInfo,"readonly",(function(k,j){if(k)return F(k);try{var z=j.objectStore(N._dbInfo.storeName).openCursor(),G=1;z.onsuccess=function(){var N=z.result;if(N){var F=N.value;_isEncodedBlob(F)&&(F=_decodeBlob(F));var k=D(F,N.key,G++);void 0!==k?w(k):N.continue()}else w()},z.onerror=function(){F(z.error)}}catch(D){F(D)}}))})).catch(F)}));return executeCallback(F,w),F},getItem:function getItem(D,w){var N=this;D=normalizeKey(D);var F=new j((function(w,F){N.ready().then((function(){createTransaction(N._dbInfo,"readonly",(function(k,j){if(k)return F(k);try{var z=j.objectStore(N._dbInfo.storeName).get(D);z.onsuccess=function(){var D=z.result;void 0===D&&(D=null),_isEncodedBlob(D)&&(D=_decodeBlob(D)),w(D)},z.onerror=function(){F(z.error)}}catch(D){F(D)}}))})).catch(F)}));return executeCallback(F,w),F},setItem:function setItem(D,w,N){var F=this;D=normalizeKey(D);var k=new j((function(N,k){var z;F.ready().then((function(){return z=F._dbInfo,"[object Blob]"===H.call(w)?_checkBlobSupport(z.db).then((function(D){return D?w:function _encodeBlob(D){return new j((function(w,N){var F=new FileReader;F.onerror=N,F.onloadend=function(N){var F=btoa(N.target.result||"");w({__local_forage_encoded_blob:!0,data:F,type:D.type})},F.readAsBinaryString(D)}))}(w)})):w})).then((function(w){createTransaction(F._dbInfo,"readwrite",(function(j,z){if(j)return k(j);try{var G=z.objectStore(F._dbInfo.storeName);null===w&&(w=void 0);var H=G.put(w,D);z.oncomplete=function(){void 0===w&&(w=null),N(w)},z.onabort=z.onerror=function(){var D=H.error?H.error:H.transaction.error;k(D)}}catch(D){k(D)}}))})).catch(k)}));return executeCallback(k,N),k},removeItem:function removeItem(D,w){var N=this;D=normalizeKey(D);var F=new j((function(w,F){N.ready().then((function(){createTransaction(N._dbInfo,"readwrite",(function(k,j){if(k)return F(k);try{var z=j.objectStore(N._dbInfo.storeName).delete(D);j.oncomplete=function(){w()},j.onerror=function(){F(z.error)},j.onabort=function(){var D=z.error?z.error:z.transaction.error;F(D)}}catch(D){F(D)}}))})).catch(F)}));return executeCallback(F,w),F},clear:function clear(D){var w=this,N=new j((function(D,N){w.ready().then((function(){createTransaction(w._dbInfo,"readwrite",(function(F,k){if(F)return N(F);try{var j=k.objectStore(w._dbInfo.storeName).clear();k.oncomplete=function(){D()},k.onabort=k.onerror=function(){var D=j.error?j.error:j.transaction.error;N(D)}}catch(D){N(D)}}))})).catch(N)}));return executeCallback(N,D),N},length:function length(D){var w=this,N=new j((function(D,N){w.ready().then((function(){createTransaction(w._dbInfo,"readonly",(function(F,k){if(F)return N(F);try{var j=k.objectStore(w._dbInfo.storeName).count();j.onsuccess=function(){D(j.result)},j.onerror=function(){N(j.error)}}catch(D){N(D)}}))})).catch(N)}));return executeCallback(N,D),N},key:function key(D,w){var N=this,F=new j((function(w,F){D<0?w(null):N.ready().then((function(){createTransaction(N._dbInfo,"readonly",(function(k,j){if(k)return F(k);try{var z=j.objectStore(N._dbInfo.storeName),G=!1,H=z.openCursor();H.onsuccess=function(){var N=H.result;N?0===D||G?w(N.key):(G=!0,N.advance(D)):w(null)},H.onerror=function(){F(H.error)}}catch(D){F(D)}}))})).catch(F)}));return executeCallback(F,w),F},keys:function keys(D){var w=this,N=new j((function(D,N){w.ready().then((function(){createTransaction(w._dbInfo,"readonly",(function(F,k){if(F)return N(F);try{var j=k.objectStore(w._dbInfo.storeName).openCursor(),z=[];j.onsuccess=function(){var w=j.result;w?(z.push(w.key),w.continue()):D(z)},j.onerror=function(){N(j.error)}}catch(D){N(D)}}))})).catch(N)}));return executeCallback(N,D),N},dropInstance:function dropInstance(D,w){w=getCallback.apply(this,arguments);var N=this.config();(D="function"!=typeof D&&D||{}).name||(D.name=D.name||N.name,D.storeName=D.storeName||N.storeName);var F,z=this;if(D.name){var H=D.name===N.name&&z._dbInfo.db,X=H?j.resolve(z._dbInfo.db):_getOriginalConnection(D).then((function(w){var N=G[D.name],F=N.forages;N.db=w;for(var k=0;k<F.length;k++)F[k]._dbInfo.db=w;return w}));F=D.storeName?X.then((function(w){if(w.objectStoreNames.contains(D.storeName)){var N=w.version+1;_deferReadiness(D);var F=G[D.name],z=F.forages;w.close();for(var H=0;H<z.length;H++){var X=z[H];X._dbInfo.db=null,X._dbInfo.version=N}return new j((function(w,F){var j=k.open(D.name,N);j.onerror=function(D){j.result.close(),F(D)},j.onupgradeneeded=function(){j.result.deleteObjectStore(D.storeName)},j.onsuccess=function(){var D=j.result;D.close(),w(D)}})).then((function(D){F.db=D;for(var w=0;w<z.length;w++){var N=z[w];N._dbInfo.db=D,_advanceReadiness(N._dbInfo)}})).catch((function(w){throw(_rejectReadiness(D,w)||j.resolve()).catch((function(){})),w}))}})):X.then((function(w){_deferReadiness(D);var N=G[D.name],F=N.forages;w.close();for(var z=0;z<F.length;z++)F[z]._dbInfo.db=null;return new j((function(w,N){var F=k.deleteDatabase(D.name);F.onerror=F.onblocked=function(D){var w=F.result;w&&w.close(),N(D)},F.onsuccess=function(){var D=F.result;D&&D.close(),w(D)}})).then((function(D){N.db=D;for(var w=0;w<F.length;w++)_advanceReadiness(F[w]._dbInfo)})).catch((function(w){throw(_rejectReadiness(D,w)||j.resolve()).catch((function(){})),w}))}))}else F=j.reject("Invalid arguments");return executeCallback(F,w),F}},q="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Z=/^~~local_forage_type~([^~]+)~/,J="__lfsc__:".length,$=J+"arbf".length,te=Object.prototype.toString;function stringToBuffer(D){var w,N,F,k,j,z=.75*D.length,G=D.length,H=0;"="===D[D.length-1]&&(z--,"="===D[D.length-2]&&z--);var X=new ArrayBuffer(z),Z=new Uint8Array(X);for(w=0;w<G;w+=4)N=q.indexOf(D[w]),F=q.indexOf(D[w+1]),k=q.indexOf(D[w+2]),j=q.indexOf(D[w+3]),Z[H++]=N<<2|F>>4,Z[H++]=(15&F)<<4|k>>2,Z[H++]=(3&k)<<6|63&j;return X}function bufferToString(D){var w,N=new Uint8Array(D),F="";for(w=0;w<N.length;w+=3)F+=q[N[w]>>2],F+=q[(3&N[w])<<4|N[w+1]>>4],F+=q[(15&N[w+1])<<2|N[w+2]>>6],F+=q[63&N[w+2]];return N.length%3==2?F=F.substring(0,F.length-1)+"=":N.length%3==1&&(F=F.substring(0,F.length-2)+"=="),F}var ie={serialize:function serialize(D,w){var N="";if(D&&(N=te.call(D)),D&&("[object ArrayBuffer]"===N||D.buffer&&"[object ArrayBuffer]"===te.call(D.buffer))){var F,k="__lfsc__:";D instanceof ArrayBuffer?(F=D,k+="arbf"):(F=D.buffer,"[object Int8Array]"===N?k+="si08":"[object Uint8Array]"===N?k+="ui08":"[object Uint8ClampedArray]"===N?k+="uic8":"[object Int16Array]"===N?k+="si16":"[object Uint16Array]"===N?k+="ur16":"[object Int32Array]"===N?k+="si32":"[object Uint32Array]"===N?k+="ui32":"[object Float32Array]"===N?k+="fl32":"[object Float64Array]"===N?k+="fl64":w(new Error("Failed to get type for BinaryArray"))),w(k+bufferToString(F))}else if("[object Blob]"===N){var j=new FileReader;j.onload=function(){var N="~~local_forage_type~"+D.type+"~"+bufferToString(this.result);w("__lfsc__:blob"+N)},j.readAsArrayBuffer(D)}else try{w(JSON.stringify(D))}catch(N){console.error("Couldn't convert value into a JSON string: ",D),w(null,N)}},deserialize:function deserialize(D){if("__lfsc__:"!==D.substring(0,J))return JSON.parse(D);var w,N=D.substring($),F=D.substring(J,$);if("blob"===F&&Z.test(N)){var k=N.match(Z);w=k[1],N=N.substring(k[0].length)}var j=stringToBuffer(N);switch(F){case"arbf":return j;case"blob":return createBlob([j],{type:w});case"si08":return new Int8Array(j);case"ui08":return new Uint8Array(j);case"uic8":return new Uint8ClampedArray(j);case"si16":return new Int16Array(j);case"ur16":return new Uint16Array(j);case"si32":return new Int32Array(j);case"ui32":return new Uint32Array(j);case"fl32":return new Float32Array(j);case"fl64":return new Float64Array(j);default:throw new Error("Unkown type: "+F)}},stringToBuffer,bufferToString};function createDbTable(D,w,N,F){D.executeSql("CREATE TABLE IF NOT EXISTS "+w.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],N,F)}function tryExecuteSql(D,w,N,F,k,j){D.executeSql(N,F,k,(function(D,z){z.code===z.SYNTAX_ERR?D.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[w.storeName],(function(D,G){G.rows.length?j(D,z):createDbTable(D,w,(function(){D.executeSql(N,F,k,j)}),j)}),j):j(D,z)}),j)}function _setItem(D,w,N,F){var k=this;D=normalizeKey(D);var z=new j((function(j,z){k.ready().then((function(){void 0===w&&(w=null);var G=w,H=k._dbInfo;H.serializer.serialize(w,(function(w,X){X?z(X):H.db.transaction((function(N){tryExecuteSql(N,H,"INSERT OR REPLACE INTO "+H.storeName+" (key, value) VALUES (?, ?)",[D,w],(function(){j(G)}),(function(D,w){z(w)}))}),(function(w){if(w.code===w.QUOTA_ERR){if(F>0)return void j(_setItem.apply(k,[D,G,N,F-1]));z(w)}}))}))})).catch(z)}));return executeCallback(z,N),z}function getAllStoreNames(D){return new j((function(w,N){D.transaction((function(F){F.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(N,F){for(var k=[],j=0;j<F.rows.length;j++)k.push(F.rows.item(j).name);w({db:D,storeNames:k})}),(function(D,w){N(w)}))}),(function(D){N(D)}))}))}var oe={_driver:"webSQLStorage",_initStorage:function _initStorage$1(D){var w=this,N={db:null};if(D)for(var F in D)N[F]="string"!=typeof D[F]?D[F].toString():D[F];var k=new j((function(D,F){try{N.db=openDatabase(N.name,String(N.version),N.description,N.size)}catch(D){return F(D)}N.db.transaction((function(k){createDbTable(k,N,(function(){w._dbInfo=N,D()}),(function(D,w){F(w)}))}),F)}));return N.serializer=ie,k},_support:function isWebSQLValid(){return"function"==typeof openDatabase}(),iterate:function iterate$1(D,w){var N=this,F=new j((function(w,F){N.ready().then((function(){var k=N._dbInfo;k.db.transaction((function(N){tryExecuteSql(N,k,"SELECT * FROM "+k.storeName,[],(function(N,F){for(var j=F.rows,z=j.length,G=0;G<z;G++){var H=j.item(G),X=H.value;if(X&&(X=k.serializer.deserialize(X)),void 0!==(X=D(X,H.key,G+1)))return void w(X)}w()}),(function(D,w){F(w)}))}))})).catch(F)}));return executeCallback(F,w),F},getItem:function getItem$1(D,w){var N=this;D=normalizeKey(D);var F=new j((function(w,F){N.ready().then((function(){var k=N._dbInfo;k.db.transaction((function(N){tryExecuteSql(N,k,"SELECT * FROM "+k.storeName+" WHERE key = ? LIMIT 1",[D],(function(D,N){var F=N.rows.length?N.rows.item(0).value:null;F&&(F=k.serializer.deserialize(F)),w(F)}),(function(D,w){F(w)}))}))})).catch(F)}));return executeCallback(F,w),F},setItem:function setItem$1(D,w,N){return _setItem.apply(this,[D,w,N,1])},removeItem:function removeItem$1(D,w){var N=this;D=normalizeKey(D);var F=new j((function(w,F){N.ready().then((function(){var k=N._dbInfo;k.db.transaction((function(N){tryExecuteSql(N,k,"DELETE FROM "+k.storeName+" WHERE key = ?",[D],(function(){w()}),(function(D,w){F(w)}))}))})).catch(F)}));return executeCallback(F,w),F},clear:function clear$1(D){var w=this,N=new j((function(D,N){w.ready().then((function(){var F=w._dbInfo;F.db.transaction((function(w){tryExecuteSql(w,F,"DELETE FROM "+F.storeName,[],(function(){D()}),(function(D,w){N(w)}))}))})).catch(N)}));return executeCallback(N,D),N},length:function length$1(D){var w=this,N=new j((function(D,N){w.ready().then((function(){var F=w._dbInfo;F.db.transaction((function(w){tryExecuteSql(w,F,"SELECT COUNT(key) as c FROM "+F.storeName,[],(function(w,N){var F=N.rows.item(0).c;D(F)}),(function(D,w){N(w)}))}))})).catch(N)}));return executeCallback(N,D),N},key:function key$1(D,w){var N=this,F=new j((function(w,F){N.ready().then((function(){var k=N._dbInfo;k.db.transaction((function(N){tryExecuteSql(N,k,"SELECT key FROM "+k.storeName+" WHERE id = ? LIMIT 1",[D+1],(function(D,N){var F=N.rows.length?N.rows.item(0).key:null;w(F)}),(function(D,w){F(w)}))}))})).catch(F)}));return executeCallback(F,w),F},keys:function keys$1(D){var w=this,N=new j((function(D,N){w.ready().then((function(){var F=w._dbInfo;F.db.transaction((function(w){tryExecuteSql(w,F,"SELECT key FROM "+F.storeName,[],(function(w,N){for(var F=[],k=0;k<N.rows.length;k++)F.push(N.rows.item(k).key);D(F)}),(function(D,w){N(w)}))}))})).catch(N)}));return executeCallback(N,D),N},dropInstance:function dropInstance$1(D,w){w=getCallback.apply(this,arguments);var N=this.config();(D="function"!=typeof D&&D||{}).name||(D.name=D.name||N.name,D.storeName=D.storeName||N.storeName);var F,k=this;return executeCallback(F=D.name?new j((function(w){var F;F=D.name===N.name?k._dbInfo.db:openDatabase(D.name,"","",0),D.storeName?w({db:F,storeNames:[D.storeName]}):w(getAllStoreNames(F))})).then((function(D){return new j((function(w,N){D.db.transaction((function(F){function dropTable(D){return new j((function(w,N){F.executeSql("DROP TABLE IF EXISTS "+D,[],(function(){w()}),(function(D,w){N(w)}))}))}for(var k=[],z=0,G=D.storeNames.length;z<G;z++)k.push(dropTable(D.storeNames[z]));j.all(k).then((function(){w()})).catch((function(D){N(D)}))}),(function(D){N(D)}))}))})):j.reject("Invalid arguments"),w),F}};function _getKeyPrefix(D,w){var N=D.name+"/";return D.storeName!==w.storeName&&(N+=D.storeName+"/"),N}function _isLocalStorageUsable(){return!function checkIfLocalStorageThrows(){try{return localStorage.setItem("_localforage_support_test",!0),localStorage.removeItem("_localforage_support_test"),!1}catch(D){return!0}}()||localStorage.length>0}var ce={_driver:"localStorageWrapper",_initStorage:function _initStorage$2(D){var w={};if(D)for(var N in D)w[N]=D[N];return w.keyPrefix=_getKeyPrefix(D,this._defaultConfig),_isLocalStorageUsable()?(this._dbInfo=w,w.serializer=ie,j.resolve()):j.reject()},_support:function isLocalStorageValid(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(D){return!1}}(),iterate:function iterate$2(D,w){var N=this,F=N.ready().then((function(){for(var w=N._dbInfo,F=w.keyPrefix,k=F.length,j=localStorage.length,z=1,G=0;G<j;G++){var H=localStorage.key(G);if(0===H.indexOf(F)){var X=localStorage.getItem(H);if(X&&(X=w.serializer.deserialize(X)),void 0!==(X=D(X,H.substring(k),z++)))return X}}}));return executeCallback(F,w),F},getItem:function getItem$2(D,w){var N=this;D=normalizeKey(D);var F=N.ready().then((function(){var w=N._dbInfo,F=localStorage.getItem(w.keyPrefix+D);return F&&(F=w.serializer.deserialize(F)),F}));return executeCallback(F,w),F},setItem:function setItem$2(D,w,N){var F=this;D=normalizeKey(D);var k=F.ready().then((function(){void 0===w&&(w=null);var N=w;return new j((function(k,j){var z=F._dbInfo;z.serializer.serialize(w,(function(w,F){if(F)j(F);else try{localStorage.setItem(z.keyPrefix+D,w),k(N)}catch(D){"QuotaExceededError"!==D.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==D.name||j(D),j(D)}}))}))}));return executeCallback(k,N),k},removeItem:function removeItem$2(D,w){var N=this;D=normalizeKey(D);var F=N.ready().then((function(){var w=N._dbInfo;localStorage.removeItem(w.keyPrefix+D)}));return executeCallback(F,w),F},clear:function clear$2(D){var w=this,N=w.ready().then((function(){for(var D=w._dbInfo.keyPrefix,N=localStorage.length-1;N>=0;N--){var F=localStorage.key(N);0===F.indexOf(D)&&localStorage.removeItem(F)}}));return executeCallback(N,D),N},length:function length$2(D){var w=this.keys().then((function(D){return D.length}));return executeCallback(w,D),w},key:function key$2(D,w){var N=this,F=N.ready().then((function(){var w,F=N._dbInfo;try{w=localStorage.key(D)}catch(D){w=null}return w&&(w=w.substring(F.keyPrefix.length)),w}));return executeCallback(F,w),F},keys:function keys$2(D){var w=this,N=w.ready().then((function(){for(var D=w._dbInfo,N=localStorage.length,F=[],k=0;k<N;k++){var j=localStorage.key(k);0===j.indexOf(D.keyPrefix)&&F.push(j.substring(D.keyPrefix.length))}return F}));return executeCallback(N,D),N},dropInstance:function dropInstance$2(D,w){if(w=getCallback.apply(this,arguments),!(D="function"!=typeof D&&D||{}).name){var N=this.config();D.name=D.name||N.name,D.storeName=D.storeName||N.storeName}var F,k=this;return executeCallback(F=D.name?new j((function(w){D.storeName?w(_getKeyPrefix(D,k._defaultConfig)):w(D.name+"/")})).then((function(D){for(var w=localStorage.length-1;w>=0;w--){var N=localStorage.key(w);0===N.indexOf(D)&&localStorage.removeItem(N)}})):j.reject("Invalid arguments"),w),F}},he=function sameValue(D,w){return D===w||"number"==typeof D&&"number"==typeof w&&isNaN(D)&&isNaN(w)},fe=function includes(D,w){for(var N=D.length,F=0;F<N;){if(he(D[F],w))return!0;F++}return!1},pe=Array.isArray||function(D){return"[object Array]"===Object.prototype.toString.call(D)},_e={},ve={},ye={INDEXEDDB:X,WEBSQL:oe,LOCALSTORAGE:ce},be=[ye.INDEXEDDB._driver,ye.WEBSQL._driver,ye.LOCALSTORAGE._driver],Te=["dropInstance"],Ee=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(Te),Se={description:"",driver:be.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function callWhenReady(D,w){D[w]=function(){var N=arguments;return D.ready().then((function(){return D[w].apply(D,N)}))}}function extend(){for(var D=1;D<arguments.length;D++){var w=arguments[D];if(w)for(var N in w)w.hasOwnProperty(N)&&(pe(w[N])?arguments[0][N]=w[N].slice():arguments[0][N]=w[N])}return arguments[0]}var Me=new(function(){function LocalForage(D){for(var w in function _classCallCheck(D,w){if(!(D instanceof w))throw new TypeError("Cannot call a class as a function")}(this,LocalForage),ye)if(ye.hasOwnProperty(w)){var N=ye[w],F=N._driver;this[w]=F,_e[F]||this.defineDriver(N)}this._defaultConfig=extend({},Se),this._config=extend({},this._defaultConfig,D),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((function(){}))}return LocalForage.prototype.config=function config(D){if("object"===(void 0===D?"undefined":F(D))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var w in D){if("storeName"===w&&(D[w]=D[w].replace(/\W/g,"_")),"version"===w&&"number"!=typeof D[w])return new Error("Database version must be a number.");this._config[w]=D[w]}return!("driver"in D)||!D.driver||this.setDriver(this._config.driver)}return"string"==typeof D?this._config[D]:this._config},LocalForage.prototype.defineDriver=function defineDriver(D,w,N){var F=new j((function(w,N){try{var F=D._driver,k=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!D._driver)return void N(k);for(var z=Ee.concat("_initStorage"),G=0,H=z.length;G<H;G++){var X=z[G];if((!fe(Te,X)||D[X])&&"function"!=typeof D[X])return void N(k)}!function configureMissingMethods(){for(var w=function methodNotImplementedFactory(D){return function(){var w=new Error("Method "+D+" is not implemented by the current driver"),N=j.reject(w);return executeCallback(N,arguments[arguments.length-1]),N}},N=0,F=Te.length;N<F;N++){var k=Te[N];D[k]||(D[k]=w(k))}}();var q=function setDriverSupport(N){_e[F]&&console.info("Redefining LocalForage driver: "+F),_e[F]=D,ve[F]=N,w()};"_support"in D?D._support&&"function"==typeof D._support?D._support().then(q,N):q(!!D._support):q(!0)}catch(D){N(D)}}));return executeTwoCallbacks(F,w,N),F},LocalForage.prototype.driver=function driver(){return this._driver||null},LocalForage.prototype.getDriver=function getDriver(D,w,N){var F=_e[D]?j.resolve(_e[D]):j.reject(new Error("Driver not found."));return executeTwoCallbacks(F,w,N),F},LocalForage.prototype.getSerializer=function getSerializer(D){var w=j.resolve(ie);return executeTwoCallbacks(w,D),w},LocalForage.prototype.ready=function ready(D){var w=this,N=w._driverSet.then((function(){return null===w._ready&&(w._ready=w._initDriver()),w._ready}));return executeTwoCallbacks(N,D,D),N},LocalForage.prototype.setDriver=function setDriver(D,w,N){var F=this;pe(D)||(D=[D]);var k=this._getSupportedDrivers(D);function setDriverToConfig(){F._config.driver=F.driver()}function extendSelfWithDriver(D){return F._extend(D),setDriverToConfig(),F._ready=F._initStorage(F._config),F._ready}var z=null!==this._driverSet?this._driverSet.catch((function(){return j.resolve()})):j.resolve();return this._driverSet=z.then((function(){var D=k[0];return F._dbInfo=null,F._ready=null,F.getDriver(D).then((function(D){F._driver=D._driver,setDriverToConfig(),F._wrapLibraryMethodsWithReady(),F._initDriver=function initDriver(D){return function(){var w=0;return function driverPromiseLoop(){for(;w<D.length;){var N=D[w];return w++,F._dbInfo=null,F._ready=null,F.getDriver(N).then(extendSelfWithDriver).catch(driverPromiseLoop)}setDriverToConfig();var k=new Error("No available storage method found.");return F._driverSet=j.reject(k),F._driverSet}()}}(k)}))})).catch((function(){setDriverToConfig();var D=new Error("No available storage method found.");return F._driverSet=j.reject(D),F._driverSet})),executeTwoCallbacks(this._driverSet,w,N),this._driverSet},LocalForage.prototype.supports=function supports(D){return!!ve[D]},LocalForage.prototype._extend=function _extend(D){extend(this,D)},LocalForage.prototype._getSupportedDrivers=function _getSupportedDrivers(D){for(var w=[],N=0,F=D.length;N<F;N++){var k=D[N];this.supports(k)&&w.push(k)}return w},LocalForage.prototype._wrapLibraryMethodsWithReady=function _wrapLibraryMethodsWithReady(){for(var D=0,w=Ee.length;D<w;D++)callWhenReady(this,Ee[D])},LocalForage.prototype.createInstance=function createInstance(D){return new LocalForage(D)},LocalForage}());w.exports=Me},{3:3}]},{},[4])(4)}).call(this,N(6))},,,,function(D,w,N){(function(w){"undefined"!=typeof self&&self,D.exports=function(D){var w={};function i(N){if(w[N])return w[N].exports;var F=w[N]={i:N,l:!1,exports:{}};return D[N].call(F.exports,F,F.exports,i),F.l=!0,F.exports}return i.m=D,i.c=w,i.d=function(D,w,N){i.o(D,w)||Object.defineProperty(D,w,{enumerable:!0,get:N})},i.r=function(D){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(D,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(D,"__esModule",{value:!0})},i.t=function(D,w){if(1&w&&(D=i(D)),8&w)return D;if(4&w&&"object"==typeof D&&D&&D.__esModule)return D;var N=Object.create(null);if(i.r(N),Object.defineProperty(N,"default",{enumerable:!0,value:D}),2&w&&"string"!=typeof D)for(var F in D)i.d(N,F,function(w){return D[w]}.bind(null,F));return N},i.n=function(D){var w=D&&D.__esModule?function(){return D.default}:function(){return D};return i.d(w,"a",w),w},i.o=function(D,w){return Object.prototype.hasOwnProperty.call(D,w)},i.p="",i(i.s=151)}([function(D,w,N){"use strict";N.d(w,"d",(function(){return G})),N.d(w,"e",(function(){return H})),N.d(w,"f",(function(){return X})),N.d(w,"b",(function(){return q})),N.d(w,"a",(function(){return Z})),N.d(w,"c",(function(){return $}));var F=N(14),k=N(28),j=N(42),z=N(12),G=function(){function e(D,w){void 0===D&&(D=0),void 0===w&&(w=0),this.x=D,this.y=w}return e.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+"}"},e.prototype.getClassName=function(){return"Vector2"},e.prototype.getHashCode=function(){var D=0|this.x;return 397*D^(0|this.y)},e.prototype.toArray=function(D,w){return void 0===w&&(w=0),D[w]=this.x,D[w+1]=this.y,this},e.prototype.asArray=function(){var D=new Array;return this.toArray(D,0),D},e.prototype.copyFrom=function(D){return this.x=D.x,this.y=D.y,this},e.prototype.copyFromFloats=function(D,w){return this.x=D,this.y=w,this},e.prototype.set=function(D,w){return this.copyFromFloats(D,w)},e.prototype.add=function(D){return new e(this.x+D.x,this.y+D.y)},e.prototype.addToRef=function(D,w){return w.x=this.x+D.x,w.y=this.y+D.y,this},e.prototype.addInPlace=function(D){return this.x+=D.x,this.y+=D.y,this},e.prototype.addVector3=function(D){return new e(this.x+D.x,this.y+D.y)},e.prototype.subtract=function(D){return new e(this.x-D.x,this.y-D.y)},e.prototype.subtractToRef=function(D,w){return w.x=this.x-D.x,w.y=this.y-D.y,this},e.prototype.subtractInPlace=function(D){return this.x-=D.x,this.y-=D.y,this},e.prototype.multiplyInPlace=function(D){return this.x*=D.x,this.y*=D.y,this},e.prototype.multiply=function(D){return new e(this.x*D.x,this.y*D.y)},e.prototype.multiplyToRef=function(D,w){return w.x=this.x*D.x,w.y=this.y*D.y,this},e.prototype.multiplyByFloats=function(D,w){return new e(this.x*D,this.y*w)},e.prototype.divide=function(D){return new e(this.x/D.x,this.y/D.y)},e.prototype.divideToRef=function(D,w){return w.x=this.x/D.x,w.y=this.y/D.y,this},e.prototype.divideInPlace=function(D){return this.divideToRef(D,this)},e.prototype.negate=function(){return new e(-this.x,-this.y)},e.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this},e.prototype.negateToRef=function(D){return D.copyFromFloats(-1*this.x,-1*this.y)},e.prototype.scaleInPlace=function(D){return this.x*=D,this.y*=D,this},e.prototype.scale=function(D){var w=new e(0,0);return this.scaleToRef(D,w),w},e.prototype.scaleToRef=function(D,w){return w.x=this.x*D,w.y=this.y*D,this},e.prototype.scaleAndAddToRef=function(D,w){return w.x+=this.x*D,w.y+=this.y*D,this},e.prototype.equals=function(D){return D&&this.x===D.x&&this.y===D.y},e.prototype.equalsWithEpsilon=function(D,w){return void 0===w&&(w=k.a),D&&F.a.WithinEpsilon(this.x,D.x,w)&&F.a.WithinEpsilon(this.y,D.y,w)},e.prototype.floor=function(){return new e(Math.floor(this.x),Math.floor(this.y))},e.prototype.fract=function(){return new e(this.x-Math.floor(this.x),this.y-Math.floor(this.y))},e.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},e.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},e.prototype.normalize=function(){var D=this.length();return 0===D||(this.x/=D,this.y/=D),this},e.prototype.clone=function(){return new e(this.x,this.y)},e.Zero=function(){return new e(0,0)},e.One=function(){return new e(1,1)},e.FromArray=function(D,w){return void 0===w&&(w=0),new e(D[w],D[w+1])},e.FromArrayToRef=function(D,w,N){N.x=D[w],N.y=D[w+1]},e.CatmullRom=function(D,w,N,F,k){var j=k*k,z=k*j;return new e(.5*(2*w.x+(-D.x+N.x)*k+(2*D.x-5*w.x+4*N.x-F.x)*j+(-D.x+3*w.x-3*N.x+F.x)*z),.5*(2*w.y+(-D.y+N.y)*k+(2*D.y-5*w.y+4*N.y-F.y)*j+(-D.y+3*w.y-3*N.y+F.y)*z))},e.Clamp=function(D,w,N){var F=D.x;F=(F=F>N.x?N.x:F)<w.x?w.x:F;var k=D.y;return new e(F,k=(k=k>N.y?N.y:k)<w.y?w.y:k)},e.Hermite=function(D,w,N,F,k){var j=k*k,z=k*j,G=2*z-3*j+1,H=-2*z+3*j,X=z-2*j+k,q=z-j;return new e(D.x*G+N.x*H+w.x*X+F.x*q,D.y*G+N.y*H+w.y*X+F.y*q)},e.Lerp=function(D,w,N){return new e(D.x+(w.x-D.x)*N,D.y+(w.y-D.y)*N)},e.Dot=function(D,w){return D.x*w.x+D.y*w.y},e.Normalize=function(D){var w=D.clone();return w.normalize(),w},e.Minimize=function(D,w){return new e(D.x<w.x?D.x:w.x,D.y<w.y?D.y:w.y)},e.Maximize=function(D,w){return new e(D.x>w.x?D.x:w.x,D.y>w.y?D.y:w.y)},e.Transform=function(D,w){var N=e.Zero();return e.TransformToRef(D,w,N),N},e.TransformToRef=function(D,w,N){var F=w.m,k=D.x*F[0]+D.y*F[4]+F[12],j=D.x*F[1]+D.y*F[5]+F[13];N.x=k,N.y=j},e.PointInTriangle=function(D,w,N,F){var k=.5*(-N.y*F.x+w.y*(-N.x+F.x)+w.x*(N.y-F.y)+N.x*F.y),j=k<0?-1:1,z=(w.y*F.x-w.x*F.y+(F.y-w.y)*D.x+(w.x-F.x)*D.y)*j,G=(w.x*N.y-w.y*N.x+(w.y-N.y)*D.x+(N.x-w.x)*D.y)*j;return z>0&&G>0&&z+G<2*k*j},e.Distance=function(D,w){return Math.sqrt(e.DistanceSquared(D,w))},e.DistanceSquared=function(D,w){var N=D.x-w.x,F=D.y-w.y;return N*N+F*F},e.Center=function(D,w){var N=D.add(w);return N.scaleInPlace(.5),N},e.DistanceOfPointFromSegment=function(D,w,N){var F=e.DistanceSquared(w,N);if(0===F)return e.Distance(D,w);var k=N.subtract(w),j=Math.max(0,Math.min(1,e.Dot(D.subtract(w),k)/F)),z=w.add(k.multiplyByFloats(j,j));return e.Distance(D,z)},e}(),H=function(){function e(D,w,N){void 0===D&&(D=0),void 0===w&&(w=0),void 0===N&&(N=0),this.x=D,this.y=w,this.z=N}return e.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+"}"},e.prototype.getClassName=function(){return"Vector3"},e.prototype.getHashCode=function(){var D=0|this.x;return 397*(D=397*D^(0|this.y))^(0|this.z)},e.prototype.asArray=function(){var D=[];return this.toArray(D,0),D},e.prototype.toArray=function(D,w){return void 0===w&&(w=0),D[w]=this.x,D[w+1]=this.y,D[w+2]=this.z,this},e.prototype.toQuaternion=function(){return q.RotationYawPitchRoll(this.y,this.x,this.z)},e.prototype.addInPlace=function(D){return this.addInPlaceFromFloats(D.x,D.y,D.z)},e.prototype.addInPlaceFromFloats=function(D,w,N){return this.x+=D,this.y+=w,this.z+=N,this},e.prototype.add=function(D){return new e(this.x+D.x,this.y+D.y,this.z+D.z)},e.prototype.addToRef=function(D,w){return w.copyFromFloats(this.x+D.x,this.y+D.y,this.z+D.z)},e.prototype.subtractInPlace=function(D){return this.x-=D.x,this.y-=D.y,this.z-=D.z,this},e.prototype.subtract=function(D){return new e(this.x-D.x,this.y-D.y,this.z-D.z)},e.prototype.subtractToRef=function(D,w){return this.subtractFromFloatsToRef(D.x,D.y,D.z,w)},e.prototype.subtractFromFloats=function(D,w,N){return new e(this.x-D,this.y-w,this.z-N)},e.prototype.subtractFromFloatsToRef=function(D,w,N,F){return F.copyFromFloats(this.x-D,this.y-w,this.z-N)},e.prototype.negate=function(){return new e(-this.x,-this.y,-this.z)},e.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},e.prototype.negateToRef=function(D){return D.copyFromFloats(-1*this.x,-1*this.y,-1*this.z)},e.prototype.scaleInPlace=function(D){return this.x*=D,this.y*=D,this.z*=D,this},e.prototype.scale=function(D){return new e(this.x*D,this.y*D,this.z*D)},e.prototype.scaleToRef=function(D,w){return w.copyFromFloats(this.x*D,this.y*D,this.z*D)},e.prototype.scaleAndAddToRef=function(D,w){return w.addInPlaceFromFloats(this.x*D,this.y*D,this.z*D)},e.prototype.equals=function(D){return D&&this.x===D.x&&this.y===D.y&&this.z===D.z},e.prototype.equalsWithEpsilon=function(D,w){return void 0===w&&(w=k.a),D&&F.a.WithinEpsilon(this.x,D.x,w)&&F.a.WithinEpsilon(this.y,D.y,w)&&F.a.WithinEpsilon(this.z,D.z,w)},e.prototype.equalsToFloats=function(D,w,N){return this.x===D&&this.y===w&&this.z===N},e.prototype.multiplyInPlace=function(D){return this.x*=D.x,this.y*=D.y,this.z*=D.z,this},e.prototype.multiply=function(D){return this.multiplyByFloats(D.x,D.y,D.z)},e.prototype.multiplyToRef=function(D,w){return w.copyFromFloats(this.x*D.x,this.y*D.y,this.z*D.z)},e.prototype.multiplyByFloats=function(D,w,N){return new e(this.x*D,this.y*w,this.z*N)},e.prototype.divide=function(D){return new e(this.x/D.x,this.y/D.y,this.z/D.z)},e.prototype.divideToRef=function(D,w){return w.copyFromFloats(this.x/D.x,this.y/D.y,this.z/D.z)},e.prototype.divideInPlace=function(D){return this.divideToRef(D,this)},e.prototype.minimizeInPlace=function(D){return this.minimizeInPlaceFromFloats(D.x,D.y,D.z)},e.prototype.maximizeInPlace=function(D){return this.maximizeInPlaceFromFloats(D.x,D.y,D.z)},e.prototype.minimizeInPlaceFromFloats=function(D,w,N){return D<this.x&&(this.x=D),w<this.y&&(this.y=w),N<this.z&&(this.z=N),this},e.prototype.maximizeInPlaceFromFloats=function(D,w,N){return D>this.x&&(this.x=D),w>this.y&&(this.y=w),N>this.z&&(this.z=N),this},e.prototype.isNonUniformWithinEpsilon=function(D){var w=Math.abs(this.x),N=Math.abs(this.y);if(!F.a.WithinEpsilon(w,N,D))return!0;var k=Math.abs(this.z);return!F.a.WithinEpsilon(w,k,D)||!F.a.WithinEpsilon(N,k,D)},Object.defineProperty(e.prototype,"isNonUniform",{get:function(){var D=Math.abs(this.x),w=Math.abs(this.y);if(D!==w)return!0;var N=Math.abs(this.z);return D!==N||w!==N},enumerable:!0,configurable:!0}),e.prototype.floor=function(){return new e(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))},e.prototype.fract=function(){return new e(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z))},e.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},e.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},e.prototype.normalize=function(){return this.normalizeFromLength(this.length())},e.prototype.reorderInPlace=function(D){var w=this;return"xyz"===(D=D.toLowerCase())||(J.Vector3[0].copyFrom(this),["x","y","z"].forEach((function(N,F){w[N]=J.Vector3[0][D[F]]}))),this},e.prototype.rotateByQuaternionToRef=function(D,w){return D.toRotationMatrix(J.Matrix[0]),e.TransformCoordinatesToRef(this,J.Matrix[0],w),w},e.prototype.rotateByQuaternionAroundPointToRef=function(D,w,N){return this.subtractToRef(w,J.Vector3[0]),J.Vector3[0].rotateByQuaternionToRef(D,J.Vector3[0]),w.addToRef(J.Vector3[0],N),N},e.prototype.cross=function(D){return e.Cross(this,D)},e.prototype.normalizeFromLength=function(D){return 0===D||1===D?this:this.scaleInPlace(1/D)},e.prototype.normalizeToNew=function(){var D=new e(0,0,0);return this.normalizeToRef(D),D},e.prototype.normalizeToRef=function(D){var w=this.length();return 0===w||1===w?D.copyFromFloats(this.x,this.y,this.z):this.scaleToRef(1/w,D)},e.prototype.clone=function(){return new e(this.x,this.y,this.z)},e.prototype.copyFrom=function(D){return this.copyFromFloats(D.x,D.y,D.z)},e.prototype.copyFromFloats=function(D,w,N){return this.x=D,this.y=w,this.z=N,this},e.prototype.set=function(D,w,N){return this.copyFromFloats(D,w,N)},e.prototype.setAll=function(D){return this.x=this.y=this.z=D,this},e.GetClipFactor=function(D,w,N,F){var k=e.Dot(D,N)-F;return k/(k-(e.Dot(w,N)-F))},e.GetAngleBetweenVectors=function(D,w,N){var F=D.normalizeToRef(J.Vector3[1]),k=w.normalizeToRef(J.Vector3[2]),j=e.Dot(F,k),z=J.Vector3[3];return e.CrossToRef(F,k,z),e.Dot(z,N)>0?Math.acos(j):-Math.acos(j)},e.FromArray=function(D,w){return void 0===w&&(w=0),new e(D[w],D[w+1],D[w+2])},e.FromFloatArray=function(D,w){return e.FromArray(D,w)},e.FromArrayToRef=function(D,w,N){N.x=D[w],N.y=D[w+1],N.z=D[w+2]},e.FromFloatArrayToRef=function(D,w,N){return e.FromArrayToRef(D,w,N)},e.FromFloatsToRef=function(D,w,N,F){F.copyFromFloats(D,w,N)},e.Zero=function(){return new e(0,0,0)},e.One=function(){return new e(1,1,1)},e.Up=function(){return new e(0,1,0)},Object.defineProperty(e,"UpReadOnly",{get:function(){return e._UpReadOnly},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ZeroReadOnly",{get:function(){return e._ZeroReadOnly},enumerable:!0,configurable:!0}),e.Down=function(){return new e(0,-1,0)},e.Forward=function(){return new e(0,0,1)},e.Backward=function(){return new e(0,0,-1)},e.Right=function(){return new e(1,0,0)},e.Left=function(){return new e(-1,0,0)},e.TransformCoordinates=function(D,w){var N=e.Zero();return e.TransformCoordinatesToRef(D,w,N),N},e.TransformCoordinatesToRef=function(D,w,N){e.TransformCoordinatesFromFloatsToRef(D.x,D.y,D.z,w,N)},e.TransformCoordinatesFromFloatsToRef=function(D,w,N,F,k){var j=F.m,z=D*j[0]+w*j[4]+N*j[8]+j[12],G=D*j[1]+w*j[5]+N*j[9]+j[13],H=D*j[2]+w*j[6]+N*j[10]+j[14],X=1/(D*j[3]+w*j[7]+N*j[11]+j[15]);k.x=z*X,k.y=G*X,k.z=H*X},e.TransformNormal=function(D,w){var N=e.Zero();return e.TransformNormalToRef(D,w,N),N},e.TransformNormalToRef=function(D,w,N){this.TransformNormalFromFloatsToRef(D.x,D.y,D.z,w,N)},e.TransformNormalFromFloatsToRef=function(D,w,N,F,k){var j=F.m;k.x=D*j[0]+w*j[4]+N*j[8],k.y=D*j[1]+w*j[5]+N*j[9],k.z=D*j[2]+w*j[6]+N*j[10]},e.CatmullRom=function(D,w,N,F,k){var j=k*k,z=k*j;return new e(.5*(2*w.x+(-D.x+N.x)*k+(2*D.x-5*w.x+4*N.x-F.x)*j+(-D.x+3*w.x-3*N.x+F.x)*z),.5*(2*w.y+(-D.y+N.y)*k+(2*D.y-5*w.y+4*N.y-F.y)*j+(-D.y+3*w.y-3*N.y+F.y)*z),.5*(2*w.z+(-D.z+N.z)*k+(2*D.z-5*w.z+4*N.z-F.z)*j+(-D.z+3*w.z-3*N.z+F.z)*z))},e.Clamp=function(D,w,N){var F=new e;return e.ClampToRef(D,w,N,F),F},e.ClampToRef=function(D,w,N,F){var k=D.x;k=(k=k>N.x?N.x:k)<w.x?w.x:k;var j=D.y;j=(j=j>N.y?N.y:j)<w.y?w.y:j;var z=D.z;z=(z=z>N.z?N.z:z)<w.z?w.z:z,F.copyFromFloats(k,j,z)},e.CheckExtends=function(D,w,N){w.minimizeInPlace(D),N.maximizeInPlace(D)},e.Hermite=function(D,w,N,F,k){var j=k*k,z=k*j,G=2*z-3*j+1,H=-2*z+3*j,X=z-2*j+k,q=z-j;return new e(D.x*G+N.x*H+w.x*X+F.x*q,D.y*G+N.y*H+w.y*X+F.y*q,D.z*G+N.z*H+w.z*X+F.z*q)},e.Lerp=function(D,w,N){var F=new e(0,0,0);return e.LerpToRef(D,w,N,F),F},e.LerpToRef=function(D,w,N,F){F.x=D.x+(w.x-D.x)*N,F.y=D.y+(w.y-D.y)*N,F.z=D.z+(w.z-D.z)*N},e.Dot=function(D,w){return D.x*w.x+D.y*w.y+D.z*w.z},e.Cross=function(D,w){var N=e.Zero();return e.CrossToRef(D,w,N),N},e.CrossToRef=function(D,w,N){var F=D.y*w.z-D.z*w.y,k=D.z*w.x-D.x*w.z,j=D.x*w.y-D.y*w.x;N.copyFromFloats(F,k,j)},e.Normalize=function(D){var w=e.Zero();return e.NormalizeToRef(D,w),w},e.NormalizeToRef=function(D,w){D.normalizeToRef(w)},e.Project=function(D,w,N,F){var k=F.width,j=F.height,z=F.x,G=F.y,H=J.Matrix[1];Z.FromValuesToRef(k/2,0,0,0,0,-j/2,0,0,0,0,.5,0,z+k/2,j/2+G,.5,1,H);var X=J.Matrix[0];return w.multiplyToRef(N,X),X.multiplyToRef(H,X),e.TransformCoordinates(D,X)},e._UnprojectFromInvertedMatrixToRef=function(D,w,N){e.TransformCoordinatesToRef(D,w,N);var k=w.m,j=D.x*k[3]+D.y*k[7]+D.z*k[11]+k[15];F.a.WithinEpsilon(j,1)&&N.scaleInPlace(1/j)},e.UnprojectFromTransform=function(D,w,N,F,k){var j=J.Matrix[0];F.multiplyToRef(k,j),j.invert(),D.x=D.x/w*2-1,D.y=-(D.y/N*2-1);var z=new e;return e._UnprojectFromInvertedMatrixToRef(D,j,z),z},e.Unproject=function(D,w,N,F,k,j){var z=e.Zero();return e.UnprojectToRef(D,w,N,F,k,j,z),z},e.UnprojectToRef=function(D,w,N,F,k,j,z){e.UnprojectFloatsToRef(D.x,D.y,D.z,w,N,F,k,j,z)},e.UnprojectFloatsToRef=function(D,w,N,F,k,j,z,G,H){var X=J.Matrix[0];j.multiplyToRef(z,X),X.multiplyToRef(G,X),X.invert();var q=J.Vector3[0];q.x=D/F*2-1,q.y=-(w/k*2-1),q.z=2*N-1,e._UnprojectFromInvertedMatrixToRef(q,X,H)},e.Minimize=function(D,w){var N=D.clone();return N.minimizeInPlace(w),N},e.Maximize=function(D,w){var N=D.clone();return N.maximizeInPlace(w),N},e.Distance=function(D,w){return Math.sqrt(e.DistanceSquared(D,w))},e.DistanceSquared=function(D,w){var N=D.x-w.x,F=D.y-w.y,k=D.z-w.z;return N*N+F*F+k*k},e.Center=function(D,w){var N=D.add(w);return N.scaleInPlace(.5),N},e.RotationFromAxis=function(D,w,N){var F=e.Zero();return e.RotationFromAxisToRef(D,w,N,F),F},e.RotationFromAxisToRef=function(D,w,N,F){var k=J.Quaternion[0];q.RotationQuaternionFromAxisToRef(D,w,N,k),k.toEulerAnglesToRef(F)},e._UpReadOnly=e.Up(),e._ZeroReadOnly=e.Zero(),e}(),X=function(){function e(D,w,N,F){this.x=D,this.y=w,this.z=N,this.w=F}return e.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"},e.prototype.getClassName=function(){return"Vector4"},e.prototype.getHashCode=function(){var D=0|this.x;return 397*(D=397*(D=397*D^(0|this.y))^(0|this.z))^(0|this.w)},e.prototype.asArray=function(){var D=new Array;return this.toArray(D,0),D},e.prototype.toArray=function(D,w){return void 0===w&&(w=0),D[w]=this.x,D[w+1]=this.y,D[w+2]=this.z,D[w+3]=this.w,this},e.prototype.addInPlace=function(D){return this.x+=D.x,this.y+=D.y,this.z+=D.z,this.w+=D.w,this},e.prototype.add=function(D){return new e(this.x+D.x,this.y+D.y,this.z+D.z,this.w+D.w)},e.prototype.addToRef=function(D,w){return w.x=this.x+D.x,w.y=this.y+D.y,w.z=this.z+D.z,w.w=this.w+D.w,this},e.prototype.subtractInPlace=function(D){return this.x-=D.x,this.y-=D.y,this.z-=D.z,this.w-=D.w,this},e.prototype.subtract=function(D){return new e(this.x-D.x,this.y-D.y,this.z-D.z,this.w-D.w)},e.prototype.subtractToRef=function(D,w){return w.x=this.x-D.x,w.y=this.y-D.y,w.z=this.z-D.z,w.w=this.w-D.w,this},e.prototype.subtractFromFloats=function(D,w,N,F){return new e(this.x-D,this.y-w,this.z-N,this.w-F)},e.prototype.subtractFromFloatsToRef=function(D,w,N,F,k){return k.x=this.x-D,k.y=this.y-w,k.z=this.z-N,k.w=this.w-F,this},e.prototype.negate=function(){return new e(-this.x,-this.y,-this.z,-this.w)},e.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this},e.prototype.negateToRef=function(D){return D.copyFromFloats(-1*this.x,-1*this.y,-1*this.z,-1*this.w)},e.prototype.scaleInPlace=function(D){return this.x*=D,this.y*=D,this.z*=D,this.w*=D,this},e.prototype.scale=function(D){return new e(this.x*D,this.y*D,this.z*D,this.w*D)},e.prototype.scaleToRef=function(D,w){return w.x=this.x*D,w.y=this.y*D,w.z=this.z*D,w.w=this.w*D,this},e.prototype.scaleAndAddToRef=function(D,w){return w.x+=this.x*D,w.y+=this.y*D,w.z+=this.z*D,w.w+=this.w*D,this},e.prototype.equals=function(D){return D&&this.x===D.x&&this.y===D.y&&this.z===D.z&&this.w===D.w},e.prototype.equalsWithEpsilon=function(D,w){return void 0===w&&(w=k.a),D&&F.a.WithinEpsilon(this.x,D.x,w)&&F.a.WithinEpsilon(this.y,D.y,w)&&F.a.WithinEpsilon(this.z,D.z,w)&&F.a.WithinEpsilon(this.w,D.w,w)},e.prototype.equalsToFloats=function(D,w,N,F){return this.x===D&&this.y===w&&this.z===N&&this.w===F},e.prototype.multiplyInPlace=function(D){return this.x*=D.x,this.y*=D.y,this.z*=D.z,this.w*=D.w,this},e.prototype.multiply=function(D){return new e(this.x*D.x,this.y*D.y,this.z*D.z,this.w*D.w)},e.prototype.multiplyToRef=function(D,w){return w.x=this.x*D.x,w.y=this.y*D.y,w.z=this.z*D.z,w.w=this.w*D.w,this},e.prototype.multiplyByFloats=function(D,w,N,F){return new e(this.x*D,this.y*w,this.z*N,this.w*F)},e.prototype.divide=function(D){return new e(this.x/D.x,this.y/D.y,this.z/D.z,this.w/D.w)},e.prototype.divideToRef=function(D,w){return w.x=this.x/D.x,w.y=this.y/D.y,w.z=this.z/D.z,w.w=this.w/D.w,this},e.prototype.divideInPlace=function(D){return this.divideToRef(D,this)},e.prototype.minimizeInPlace=function(D){return D.x<this.x&&(this.x=D.x),D.y<this.y&&(this.y=D.y),D.z<this.z&&(this.z=D.z),D.w<this.w&&(this.w=D.w),this},e.prototype.maximizeInPlace=function(D){return D.x>this.x&&(this.x=D.x),D.y>this.y&&(this.y=D.y),D.z>this.z&&(this.z=D.z),D.w>this.w&&(this.w=D.w),this},e.prototype.floor=function(){return new e(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))},e.prototype.fract=function(){return new e(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))},e.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},e.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},e.prototype.normalize=function(){var D=this.length();return 0===D?this:this.scaleInPlace(1/D)},e.prototype.toVector3=function(){return new H(this.x,this.y,this.z)},e.prototype.clone=function(){return new e(this.x,this.y,this.z,this.w)},e.prototype.copyFrom=function(D){return this.x=D.x,this.y=D.y,this.z=D.z,this.w=D.w,this},e.prototype.copyFromFloats=function(D,w,N,F){return this.x=D,this.y=w,this.z=N,this.w=F,this},e.prototype.set=function(D,w,N,F){return this.copyFromFloats(D,w,N,F)},e.prototype.setAll=function(D){return this.x=this.y=this.z=this.w=D,this},e.FromArray=function(D,w){return w||(w=0),new e(D[w],D[w+1],D[w+2],D[w+3])},e.FromArrayToRef=function(D,w,N){N.x=D[w],N.y=D[w+1],N.z=D[w+2],N.w=D[w+3]},e.FromFloatArrayToRef=function(D,w,N){e.FromArrayToRef(D,w,N)},e.FromFloatsToRef=function(D,w,N,F,k){k.x=D,k.y=w,k.z=N,k.w=F},e.Zero=function(){return new e(0,0,0,0)},e.One=function(){return new e(1,1,1,1)},e.Normalize=function(D){var w=e.Zero();return e.NormalizeToRef(D,w),w},e.NormalizeToRef=function(D,w){w.copyFrom(D),w.normalize()},e.Minimize=function(D,w){var N=D.clone();return N.minimizeInPlace(w),N},e.Maximize=function(D,w){var N=D.clone();return N.maximizeInPlace(w),N},e.Distance=function(D,w){return Math.sqrt(e.DistanceSquared(D,w))},e.DistanceSquared=function(D,w){var N=D.x-w.x,F=D.y-w.y,k=D.z-w.z,j=D.w-w.w;return N*N+F*F+k*k+j*j},e.Center=function(D,w){var N=D.add(w);return N.scaleInPlace(.5),N},e.TransformNormal=function(D,w){var N=e.Zero();return e.TransformNormalToRef(D,w,N),N},e.TransformNormalToRef=function(D,w,N){var F=w.m,k=D.x*F[0]+D.y*F[4]+D.z*F[8],j=D.x*F[1]+D.y*F[5]+D.z*F[9],z=D.x*F[2]+D.y*F[6]+D.z*F[10];N.x=k,N.y=j,N.z=z,N.w=D.w},e.TransformNormalFromFloatsToRef=function(D,w,N,F,k,j){var z=k.m;j.x=D*z[0]+w*z[4]+N*z[8],j.y=D*z[1]+w*z[5]+N*z[9],j.z=D*z[2]+w*z[6]+N*z[10],j.w=F},e.FromVector3=function(D,w){return void 0===w&&(w=0),new e(D.x,D.y,D.z,w)},e}(),q=function(){function e(D,w,N,F){void 0===D&&(D=0),void 0===w&&(w=0),void 0===N&&(N=0),void 0===F&&(F=1),this.x=D,this.y=w,this.z=N,this.w=F}return e.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"},e.prototype.getClassName=function(){return"Quaternion"},e.prototype.getHashCode=function(){var D=0|this.x;return 397*(D=397*(D=397*D^(0|this.y))^(0|this.z))^(0|this.w)},e.prototype.asArray=function(){return[this.x,this.y,this.z,this.w]},e.prototype.equals=function(D){return D&&this.x===D.x&&this.y===D.y&&this.z===D.z&&this.w===D.w},e.prototype.equalsWithEpsilon=function(D,w){return void 0===w&&(w=k.a),D&&F.a.WithinEpsilon(this.x,D.x,w)&&F.a.WithinEpsilon(this.y,D.y,w)&&F.a.WithinEpsilon(this.z,D.z,w)&&F.a.WithinEpsilon(this.w,D.w,w)},e.prototype.clone=function(){return new e(this.x,this.y,this.z,this.w)},e.prototype.copyFrom=function(D){return this.x=D.x,this.y=D.y,this.z=D.z,this.w=D.w,this},e.prototype.copyFromFloats=function(D,w,N,F){return this.x=D,this.y=w,this.z=N,this.w=F,this},e.prototype.set=function(D,w,N,F){return this.copyFromFloats(D,w,N,F)},e.prototype.add=function(D){return new e(this.x+D.x,this.y+D.y,this.z+D.z,this.w+D.w)},e.prototype.addInPlace=function(D){return this.x+=D.x,this.y+=D.y,this.z+=D.z,this.w+=D.w,this},e.prototype.subtract=function(D){return new e(this.x-D.x,this.y-D.y,this.z-D.z,this.w-D.w)},e.prototype.scale=function(D){return new e(this.x*D,this.y*D,this.z*D,this.w*D)},e.prototype.scaleToRef=function(D,w){return w.x=this.x*D,w.y=this.y*D,w.z=this.z*D,w.w=this.w*D,this},e.prototype.scaleInPlace=function(D){return this.x*=D,this.y*=D,this.z*=D,this.w*=D,this},e.prototype.scaleAndAddToRef=function(D,w){return w.x+=this.x*D,w.y+=this.y*D,w.z+=this.z*D,w.w+=this.w*D,this},e.prototype.multiply=function(D){var w=new e(0,0,0,1);return this.multiplyToRef(D,w),w},e.prototype.multiplyToRef=function(D,w){var N=this.x*D.w+this.y*D.z-this.z*D.y+this.w*D.x,F=-this.x*D.z+this.y*D.w+this.z*D.x+this.w*D.y,k=this.x*D.y-this.y*D.x+this.z*D.w+this.w*D.z,j=-this.x*D.x-this.y*D.y-this.z*D.z+this.w*D.w;return w.copyFromFloats(N,F,k,j),this},e.prototype.multiplyInPlace=function(D){return this.multiplyToRef(D,this),this},e.prototype.conjugateToRef=function(D){return D.copyFromFloats(-this.x,-this.y,-this.z,this.w),this},e.prototype.conjugateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},e.prototype.conjugate=function(){return new e(-this.x,-this.y,-this.z,this.w)},e.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},e.prototype.normalize=function(){var D=this.length();if(0===D)return this;var w=1/D;return this.x*=w,this.y*=w,this.z*=w,this.w*=w,this},e.prototype.toEulerAngles=function(D){void 0===D&&(D="YZX");var w=H.Zero();return this.toEulerAnglesToRef(w),w},e.prototype.toEulerAnglesToRef=function(D){var w=this.z,N=this.x,F=this.y,k=this.w,j=k*k,z=w*w,G=N*N,H=F*F,X=F*w-N*k;return X<-.4999999?(D.y=2*Math.atan2(F,k),D.x=Math.PI/2,D.z=0):X>.4999999?(D.y=2*Math.atan2(F,k),D.x=-Math.PI/2,D.z=0):(D.z=Math.atan2(2*(N*F+w*k),-z-G+H+j),D.x=Math.asin(-2*(w*F-N*k)),D.y=Math.atan2(2*(w*N+F*k),z-G-H+j)),this},e.prototype.toRotationMatrix=function(D){return Z.FromQuaternionToRef(this,D),this},e.prototype.fromRotationMatrix=function(D){return e.FromRotationMatrixToRef(D,this),this},e.FromRotationMatrix=function(D){var w=new e;return e.FromRotationMatrixToRef(D,w),w},e.FromRotationMatrixToRef=function(D,w){var N,F=D.m,k=F[0],j=F[4],z=F[8],G=F[1],H=F[5],X=F[9],q=F[2],Z=F[6],J=F[10],$=k+H+J;$>0?(N=.5/Math.sqrt($+1),w.w=.25/N,w.x=(Z-X)*N,w.y=(z-q)*N,w.z=(G-j)*N):k>H&&k>J?(N=2*Math.sqrt(1+k-H-J),w.w=(Z-X)/N,w.x=.25*N,w.y=(j+G)/N,w.z=(z+q)/N):H>J?(N=2*Math.sqrt(1+H-k-J),w.w=(z-q)/N,w.x=(j+G)/N,w.y=.25*N,w.z=(X+Z)/N):(N=2*Math.sqrt(1+J-k-H),w.w=(G-j)/N,w.x=(z+q)/N,w.y=(X+Z)/N,w.z=.25*N)},e.Dot=function(D,w){return D.x*w.x+D.y*w.y+D.z*w.z+D.w*w.w},e.AreClose=function(D,w){return e.Dot(D,w)>=0},e.Zero=function(){return new e(0,0,0,0)},e.Inverse=function(D){return new e(-D.x,-D.y,-D.z,D.w)},e.InverseToRef=function(D,w){return w.set(-D.x,-D.y,-D.z,D.w),w},e.Identity=function(){return new e(0,0,0,1)},e.IsIdentity=function(D){return D&&0===D.x&&0===D.y&&0===D.z&&1===D.w},e.RotationAxis=function(D,w){return e.RotationAxisToRef(D,w,new e)},e.RotationAxisToRef=function(D,w,N){var F=Math.sin(w/2);return D.normalize(),N.w=Math.cos(w/2),N.x=D.x*F,N.y=D.y*F,N.z=D.z*F,N},e.FromArray=function(D,w){return w||(w=0),new e(D[w],D[w+1],D[w+2],D[w+3])},e.FromEulerAngles=function(D,w,N){var F=new e;return e.RotationYawPitchRollToRef(w,D,N,F),F},e.FromEulerAnglesToRef=function(D,w,N,F){return e.RotationYawPitchRollToRef(w,D,N,F),F},e.FromEulerVector=function(D){var w=new e;return e.RotationYawPitchRollToRef(D.y,D.x,D.z,w),w},e.FromEulerVectorToRef=function(D,w){return e.RotationYawPitchRollToRef(D.y,D.x,D.z,w),w},e.RotationYawPitchRoll=function(D,w,N){var F=new e;return e.RotationYawPitchRollToRef(D,w,N,F),F},e.RotationYawPitchRollToRef=function(D,w,N,F){var k=.5*N,j=.5*w,z=.5*D,G=Math.sin(k),H=Math.cos(k),X=Math.sin(j),q=Math.cos(j),Z=Math.sin(z),J=Math.cos(z);F.x=J*X*H+Z*q*G,F.y=Z*q*H-J*X*G,F.z=J*q*G-Z*X*H,F.w=J*q*H+Z*X*G},e.RotationAlphaBetaGamma=function(D,w,N){var F=new e;return e.RotationAlphaBetaGammaToRef(D,w,N,F),F},e.RotationAlphaBetaGammaToRef=function(D,w,N,F){var k=.5*(N+D),j=.5*(N-D),z=.5*w;F.x=Math.cos(j)*Math.sin(z),F.y=Math.sin(j)*Math.sin(z),F.z=Math.sin(k)*Math.cos(z),F.w=Math.cos(k)*Math.cos(z)},e.RotationQuaternionFromAxis=function(D,w,N){var F=new e(0,0,0,0);return e.RotationQuaternionFromAxisToRef(D,w,N,F),F},e.RotationQuaternionFromAxisToRef=function(D,w,N,F){var k=J.Matrix[0];Z.FromXYZAxesToRef(D.normalize(),w.normalize(),N.normalize(),k),e.FromRotationMatrixToRef(k,F)},e.Slerp=function(D,w,N){var F=e.Identity();return e.SlerpToRef(D,w,N,F),F},e.SlerpToRef=function(D,w,N,F){var k,j,z=D.x*w.x+D.y*w.y+D.z*w.z+D.w*w.w,G=!1;if(z<0&&(G=!0,z=-z),z>.999999)j=1-N,k=G?-N:N;else{var H=Math.acos(z),X=1/Math.sin(H);j=Math.sin((1-N)*H)*X,k=G?-Math.sin(N*H)*X:Math.sin(N*H)*X}F.x=j*D.x+k*w.x,F.y=j*D.y+k*w.y,F.z=j*D.z+k*w.z,F.w=j*D.w+k*w.w},e.Hermite=function(D,w,N,F,k){var j=k*k,z=k*j,G=2*z-3*j+1,H=-2*z+3*j,X=z-2*j+k,q=z-j;return new e(D.x*G+N.x*H+w.x*X+F.x*q,D.y*G+N.y*H+w.y*X+F.y*q,D.z*G+N.z*H+w.z*X+F.z*q,D.w*G+N.w*H+w.w*X+F.w*q)},e}(),Z=function(){function e(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,this._m=new Float32Array(16),this._updateIdentityStatus(!1)}return Object.defineProperty(e.prototype,"m",{get:function(){return this._m},enumerable:!0,configurable:!0}),e.prototype._markAsUpdated=function(){this.updateFlag=e._updateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0},e.prototype._updateIdentityStatus=function(D,w,N,F){void 0===w&&(w=!1),void 0===N&&(N=!1),void 0===F&&(F=!0),this.updateFlag=e._updateFlagSeed++,this._isIdentity=D,this._isIdentity3x2=D||N,this._isIdentityDirty=!this._isIdentity&&w,this._isIdentity3x2Dirty=!this._isIdentity3x2&&F},e.prototype.isIdentity=function(){if(this._isIdentityDirty){this._isIdentityDirty=!1;var D=this._m;this._isIdentity=1===D[0]&&0===D[1]&&0===D[2]&&0===D[3]&&0===D[4]&&1===D[5]&&0===D[6]&&0===D[7]&&0===D[8]&&0===D[9]&&1===D[10]&&0===D[11]&&0===D[12]&&0===D[13]&&0===D[14]&&1===D[15]}return this._isIdentity},e.prototype.isIdentityAs3x2=function(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,1!==this._m[0]||1!==this._m[5]||1!==this._m[15]||0!==this._m[1]||0!==this._m[2]||0!==this._m[3]||0!==this._m[4]||0!==this._m[6]||0!==this._m[7]||0!==this._m[8]||0!==this._m[9]||0!==this._m[10]||0!==this._m[11]||0!==this._m[12]||0!==this._m[13]||0!==this._m[14]?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2},e.prototype.determinant=function(){if(!0===this._isIdentity)return 1;var D=this._m,w=D[0],N=D[1],F=D[2],k=D[3],j=D[4],z=D[5],G=D[6],H=D[7],X=D[8],q=D[9],Z=D[10],J=D[11],$=D[12],te=D[13],ie=D[14],oe=D[15],ce=Z*oe-ie*J,he=q*oe-te*J,fe=q*ie-te*Z,pe=X*oe-$*J,_e=X*ie-Z*$,ve=X*te-$*q;return w*+(z*ce-G*he+H*fe)+N*-(j*ce-G*pe+H*_e)+F*+(j*he-z*pe+H*ve)+k*-(j*fe-z*_e+G*ve)},e.prototype.toArray=function(){return this._m},e.prototype.asArray=function(){return this._m},e.prototype.invert=function(){return this.invertToRef(this),this},e.prototype.reset=function(){return e.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this},e.prototype.add=function(D){var w=new e;return this.addToRef(D,w),w},e.prototype.addToRef=function(D,w){for(var N=this._m,F=w._m,k=D.m,j=0;j<16;j++)F[j]=N[j]+k[j];return w._markAsUpdated(),this},e.prototype.addToSelf=function(D){for(var w=this._m,N=D.m,F=0;F<16;F++)w[F]+=N[F];return this._markAsUpdated(),this},e.prototype.invertToRef=function(D){if(!0===this._isIdentity)return e.IdentityToRef(D),this;var w=this._m,N=w[0],F=w[1],k=w[2],j=w[3],z=w[4],G=w[5],H=w[6],X=w[7],q=w[8],Z=w[9],J=w[10],$=w[11],te=w[12],ie=w[13],oe=w[14],ce=w[15],he=J*ce-oe*$,fe=Z*ce-ie*$,pe=Z*oe-ie*J,_e=q*ce-te*$,ve=q*oe-J*te,ye=q*ie-te*Z,be=+(G*he-H*fe+X*pe),Te=-(z*he-H*_e+X*ve),Ee=+(z*fe-G*_e+X*ye),Se=-(z*pe-G*ve+H*ye),Me=N*be+F*Te+k*Ee+j*Se;if(0===Me)return D.copyFrom(this),this;var xe=1/Me,Ae=H*ce-oe*X,Pe=G*ce-ie*X,Oe=G*oe-ie*H,Re=z*ce-te*X,De=z*oe-te*H,Ie=z*ie-te*G,Le=H*$-J*X,we=G*$-Z*X,Ne=G*J-Z*H,Fe=z*$-q*X,Be=z*J-q*H,Ue=z*Z-q*G,Ve=-(F*he-k*fe+j*pe),ze=+(N*he-k*_e+j*ve),Ge=-(N*fe-F*_e+j*ye),Ye=+(N*pe-F*ve+k*ye),He=+(F*Ae-k*Pe+j*Oe),We=-(N*Ae-k*Re+j*De),Xe=+(N*Pe-F*Re+j*Ie),Ke=-(N*Oe-F*De+k*Ie),Qe=-(F*Le-k*we+j*Ne),Ze=+(N*Le-k*Fe+j*Be),Je=-(N*we-F*Fe+j*Ue),$e=+(N*Ne-F*Be+k*Ue);return e.FromValuesToRef(be*xe,Ve*xe,He*xe,Qe*xe,Te*xe,ze*xe,We*xe,Ze*xe,Ee*xe,Ge*xe,Xe*xe,Je*xe,Se*xe,Ye*xe,Ke*xe,$e*xe,D),this},e.prototype.addAtIndex=function(D,w){return this._m[D]+=w,this._markAsUpdated(),this},e.prototype.multiplyAtIndex=function(D,w){return this._m[D]*=w,this._markAsUpdated(),this},e.prototype.setTranslationFromFloats=function(D,w,N){return this._m[12]=D,this._m[13]=w,this._m[14]=N,this._markAsUpdated(),this},e.prototype.addTranslationFromFloats=function(D,w,N){return this._m[12]+=D,this._m[13]+=w,this._m[14]+=N,this._markAsUpdated(),this},e.prototype.setTranslation=function(D){return this.setTranslationFromFloats(D.x,D.y,D.z)},e.prototype.getTranslation=function(){return new H(this._m[12],this._m[13],this._m[14])},e.prototype.getTranslationToRef=function(D){return D.x=this._m[12],D.y=this._m[13],D.z=this._m[14],this},e.prototype.removeRotationAndScaling=function(){var D=this.m;return e.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,D[12],D[13],D[14],D[15],this),this._updateIdentityStatus(0===D[12]&&0===D[13]&&0===D[14]&&1===D[15]),this},e.prototype.multiply=function(D){var w=new e;return this.multiplyToRef(D,w),w},e.prototype.copyFrom=function(D){D.copyToArray(this._m);var w=D;return this._updateIdentityStatus(w._isIdentity,w._isIdentityDirty,w._isIdentity3x2,w._isIdentity3x2Dirty),this},e.prototype.copyToArray=function(D,w){void 0===w&&(w=0);var N=this._m;return D[w]=N[0],D[w+1]=N[1],D[w+2]=N[2],D[w+3]=N[3],D[w+4]=N[4],D[w+5]=N[5],D[w+6]=N[6],D[w+7]=N[7],D[w+8]=N[8],D[w+9]=N[9],D[w+10]=N[10],D[w+11]=N[11],D[w+12]=N[12],D[w+13]=N[13],D[w+14]=N[14],D[w+15]=N[15],this},e.prototype.multiplyToRef=function(D,w){return this._isIdentity?(w.copyFrom(D),this):D._isIdentity?(w.copyFrom(this),this):(this.multiplyToArray(D,w._m,0),w._markAsUpdated(),this)},e.prototype.multiplyToArray=function(D,w,N){var F=this._m,k=D.m,j=F[0],z=F[1],G=F[2],H=F[3],X=F[4],q=F[5],Z=F[6],J=F[7],$=F[8],te=F[9],ie=F[10],oe=F[11],ce=F[12],he=F[13],fe=F[14],pe=F[15],_e=k[0],ve=k[1],ye=k[2],be=k[3],Te=k[4],Ee=k[5],Se=k[6],Me=k[7],xe=k[8],Ae=k[9],Pe=k[10],Oe=k[11],Re=k[12],De=k[13],Ie=k[14],Le=k[15];return w[N]=j*_e+z*Te+G*xe+H*Re,w[N+1]=j*ve+z*Ee+G*Ae+H*De,w[N+2]=j*ye+z*Se+G*Pe+H*Ie,w[N+3]=j*be+z*Me+G*Oe+H*Le,w[N+4]=X*_e+q*Te+Z*xe+J*Re,w[N+5]=X*ve+q*Ee+Z*Ae+J*De,w[N+6]=X*ye+q*Se+Z*Pe+J*Ie,w[N+7]=X*be+q*Me+Z*Oe+J*Le,w[N+8]=$*_e+te*Te+ie*xe+oe*Re,w[N+9]=$*ve+te*Ee+ie*Ae+oe*De,w[N+10]=$*ye+te*Se+ie*Pe+oe*Ie,w[N+11]=$*be+te*Me+ie*Oe+oe*Le,w[N+12]=ce*_e+he*Te+fe*xe+pe*Re,w[N+13]=ce*ve+he*Ee+fe*Ae+pe*De,w[N+14]=ce*ye+he*Se+fe*Pe+pe*Ie,w[N+15]=ce*be+he*Me+fe*Oe+pe*Le,this},e.prototype.equals=function(D){var w=D;if(!w)return!1;if((this._isIdentity||w._isIdentity)&&!this._isIdentityDirty&&!w._isIdentityDirty)return this._isIdentity&&w._isIdentity;var N=this.m,F=w.m;return N[0]===F[0]&&N[1]===F[1]&&N[2]===F[2]&&N[3]===F[3]&&N[4]===F[4]&&N[5]===F[5]&&N[6]===F[6]&&N[7]===F[7]&&N[8]===F[8]&&N[9]===F[9]&&N[10]===F[10]&&N[11]===F[11]&&N[12]===F[12]&&N[13]===F[13]&&N[14]===F[14]&&N[15]===F[15]},e.prototype.clone=function(){var D=new e;return D.copyFrom(this),D},e.prototype.getClassName=function(){return"Matrix"},e.prototype.getHashCode=function(){for(var D=0|this._m[0],w=1;w<16;w++)D=397*D^(0|this._m[w]);return D},e.prototype.decompose=function(D,w,N){if(this._isIdentity)return N&&N.setAll(0),D&&D.setAll(1),w&&w.copyFromFloats(0,0,0,1),!0;var F=this._m;if(N&&N.copyFromFloats(F[12],F[13],F[14]),(D=D||J.Vector3[0]).x=Math.sqrt(F[0]*F[0]+F[1]*F[1]+F[2]*F[2]),D.y=Math.sqrt(F[4]*F[4]+F[5]*F[5]+F[6]*F[6]),D.z=Math.sqrt(F[8]*F[8]+F[9]*F[9]+F[10]*F[10]),this.determinant()<=0&&(D.y*=-1),0===D.x||0===D.y||0===D.z)return w&&w.copyFromFloats(0,0,0,1),!1;if(w){var k=1/D.x,j=1/D.y,z=1/D.z;e.FromValuesToRef(F[0]*k,F[1]*k,F[2]*k,0,F[4]*j,F[5]*j,F[6]*j,0,F[8]*z,F[9]*z,F[10]*z,0,0,0,0,1,J.Matrix[0]),q.FromRotationMatrixToRef(J.Matrix[0],w)}return!0},e.prototype.getRow=function(D){if(D<0||D>3)return null;var w=4*D;return new X(this._m[w+0],this._m[w+1],this._m[w+2],this._m[w+3])},e.prototype.setRow=function(D,w){return this.setRowFromFloats(D,w.x,w.y,w.z,w.w)},e.prototype.transpose=function(){return e.Transpose(this)},e.prototype.transposeToRef=function(D){return e.TransposeToRef(this,D),this},e.prototype.setRowFromFloats=function(D,w,N,F,k){if(D<0||D>3)return this;var j=4*D;return this._m[j+0]=w,this._m[j+1]=N,this._m[j+2]=F,this._m[j+3]=k,this._markAsUpdated(),this},e.prototype.scale=function(D){var w=new e;return this.scaleToRef(D,w),w},e.prototype.scaleToRef=function(D,w){for(var N=0;N<16;N++)w._m[N]=this._m[N]*D;return w._markAsUpdated(),this},e.prototype.scaleAndAddToRef=function(D,w){for(var N=0;N<16;N++)w._m[N]+=this._m[N]*D;return w._markAsUpdated(),this},e.prototype.toNormalMatrix=function(D){var w=J.Matrix[0];this.invertToRef(w),w.transposeToRef(D);var N=D._m;e.FromValuesToRef(N[0],N[1],N[2],0,N[4],N[5],N[6],0,N[8],N[9],N[10],0,0,0,0,1,D)},e.prototype.getRotationMatrix=function(){var D=new e;return this.getRotationMatrixToRef(D),D},e.prototype.getRotationMatrixToRef=function(D){var w=J.Vector3[0];if(!this.decompose(w))return e.IdentityToRef(D),this;var N=this._m,F=1/w.x,k=1/w.y,j=1/w.z;return e.FromValuesToRef(N[0]*F,N[1]*F,N[2]*F,0,N[4]*k,N[5]*k,N[6]*k,0,N[8]*j,N[9]*j,N[10]*j,0,0,0,0,1,D),this},e.prototype.toggleModelMatrixHandInPlace=function(){var D=this._m;D[2]*=-1,D[6]*=-1,D[8]*=-1,D[9]*=-1,D[14]*=-1,this._markAsUpdated()},e.prototype.toggleProjectionMatrixHandInPlace=function(){var D=this._m;D[8]*=-1,D[9]*=-1,D[10]*=-1,D[11]*=-1,this._markAsUpdated()},e.FromArray=function(D,w){void 0===w&&(w=0);var N=new e;return e.FromArrayToRef(D,w,N),N},e.FromArrayToRef=function(D,w,N){for(var F=0;F<16;F++)N._m[F]=D[F+w];N._markAsUpdated()},e.FromFloat32ArrayToRefScaled=function(D,w,N,F){for(var k=0;k<16;k++)F._m[k]=D[k+w]*N;F._markAsUpdated()},Object.defineProperty(e,"IdentityReadOnly",{get:function(){return e._identityReadOnly},enumerable:!0,configurable:!0}),e.FromValuesToRef=function(D,w,N,F,k,j,z,G,H,X,q,Z,J,$,te,ie,oe){var ce=oe._m;ce[0]=D,ce[1]=w,ce[2]=N,ce[3]=F,ce[4]=k,ce[5]=j,ce[6]=z,ce[7]=G,ce[8]=H,ce[9]=X,ce[10]=q,ce[11]=Z,ce[12]=J,ce[13]=$,ce[14]=te,ce[15]=ie,oe._markAsUpdated()},e.FromValues=function(D,w,N,F,k,j,z,G,H,X,q,Z,J,$,te,ie){var oe=new e,ce=oe._m;return ce[0]=D,ce[1]=w,ce[2]=N,ce[3]=F,ce[4]=k,ce[5]=j,ce[6]=z,ce[7]=G,ce[8]=H,ce[9]=X,ce[10]=q,ce[11]=Z,ce[12]=J,ce[13]=$,ce[14]=te,ce[15]=ie,oe._markAsUpdated(),oe},e.Compose=function(D,w,N){var F=new e;return e.ComposeToRef(D,w,N,F),F},e.ComposeToRef=function(D,w,N,F){var k=F._m,j=w.x,z=w.y,G=w.z,H=w.w,X=j+j,q=z+z,Z=G+G,J=j*X,$=j*q,te=j*Z,ie=z*q,oe=z*Z,ce=G*Z,he=H*X,fe=H*q,pe=H*Z,_e=D.x,ve=D.y,ye=D.z;k[0]=(1-(ie+ce))*_e,k[1]=($+pe)*_e,k[2]=(te-fe)*_e,k[3]=0,k[4]=($-pe)*ve,k[5]=(1-(J+ce))*ve,k[6]=(oe+he)*ve,k[7]=0,k[8]=(te+fe)*ye,k[9]=(oe-he)*ye,k[10]=(1-(J+ie))*ye,k[11]=0,k[12]=N.x,k[13]=N.y,k[14]=N.z,k[15]=1,F._markAsUpdated()},e.Identity=function(){var D=e.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return D._updateIdentityStatus(!0),D},e.IdentityToRef=function(D){e.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,D),D._updateIdentityStatus(!0)},e.Zero=function(){var D=e.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return D._updateIdentityStatus(!1),D},e.RotationX=function(D){var w=new e;return e.RotationXToRef(D,w),w},e.Invert=function(D){var w=new e;return D.invertToRef(w),w},e.RotationXToRef=function(D,w){var N=Math.sin(D),F=Math.cos(D);e.FromValuesToRef(1,0,0,0,0,F,N,0,0,-N,F,0,0,0,0,1,w),w._updateIdentityStatus(1===F&&0===N)},e.RotationY=function(D){var w=new e;return e.RotationYToRef(D,w),w},e.RotationYToRef=function(D,w){var N=Math.sin(D),F=Math.cos(D);e.FromValuesToRef(F,0,-N,0,0,1,0,0,N,0,F,0,0,0,0,1,w),w._updateIdentityStatus(1===F&&0===N)},e.RotationZ=function(D){var w=new e;return e.RotationZToRef(D,w),w},e.RotationZToRef=function(D,w){var N=Math.sin(D),F=Math.cos(D);e.FromValuesToRef(F,N,0,0,-N,F,0,0,0,0,1,0,0,0,0,1,w),w._updateIdentityStatus(1===F&&0===N)},e.RotationAxis=function(D,w){var N=new e;return e.RotationAxisToRef(D,w,N),N},e.RotationAxisToRef=function(D,w,N){var F=Math.sin(-w),k=Math.cos(-w),j=1-k;D.normalize();var z=N._m;z[0]=D.x*D.x*j+k,z[1]=D.x*D.y*j-D.z*F,z[2]=D.x*D.z*j+D.y*F,z[3]=0,z[4]=D.y*D.x*j+D.z*F,z[5]=D.y*D.y*j+k,z[6]=D.y*D.z*j-D.x*F,z[7]=0,z[8]=D.z*D.x*j-D.y*F,z[9]=D.z*D.y*j+D.x*F,z[10]=D.z*D.z*j+k,z[11]=0,z[12]=0,z[13]=0,z[14]=0,z[15]=1,N._markAsUpdated()},e.RotationAlignToRef=function(D,w,N){var F=H.Cross(w,D),k=H.Dot(w,D),j=1/(1+k),z=N._m;z[0]=F.x*F.x*j+k,z[1]=F.y*F.x*j-F.z,z[2]=F.z*F.x*j+F.y,z[3]=0,z[4]=F.x*F.y*j+F.z,z[5]=F.y*F.y*j+k,z[6]=F.z*F.y*j-F.x,z[7]=0,z[8]=F.x*F.z*j-F.y,z[9]=F.y*F.z*j+F.x,z[10]=F.z*F.z*j+k,z[11]=0,z[12]=0,z[13]=0,z[14]=0,z[15]=1,N._markAsUpdated()},e.RotationYawPitchRoll=function(D,w,N){var F=new e;return e.RotationYawPitchRollToRef(D,w,N,F),F},e.RotationYawPitchRollToRef=function(D,w,N,F){q.RotationYawPitchRollToRef(D,w,N,J.Quaternion[0]),J.Quaternion[0].toRotationMatrix(F)},e.Scaling=function(D,w,N){var F=new e;return e.ScalingToRef(D,w,N,F),F},e.ScalingToRef=function(D,w,N,F){e.FromValuesToRef(D,0,0,0,0,w,0,0,0,0,N,0,0,0,0,1,F),F._updateIdentityStatus(1===D&&1===w&&1===N)},e.Translation=function(D,w,N){var F=new e;return e.TranslationToRef(D,w,N,F),F},e.TranslationToRef=function(D,w,N,F){e.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,D,w,N,1,F),F._updateIdentityStatus(0===D&&0===w&&0===N)},e.Lerp=function(D,w,N){var F=new e;return e.LerpToRef(D,w,N,F),F},e.LerpToRef=function(D,w,N,F){for(var k=F._m,j=D.m,z=w.m,G=0;G<16;G++)k[G]=j[G]*(1-N)+z[G]*N;F._markAsUpdated()},e.DecomposeLerp=function(D,w,N){var F=new e;return e.DecomposeLerpToRef(D,w,N,F),F},e.DecomposeLerpToRef=function(D,w,N,F){var k=J.Vector3[0],j=J.Quaternion[0],z=J.Vector3[1];D.decompose(k,j,z);var G=J.Vector3[2],X=J.Quaternion[1],Z=J.Vector3[3];w.decompose(G,X,Z);var $=J.Vector3[4];H.LerpToRef(k,G,N,$);var te=J.Quaternion[2];q.SlerpToRef(j,X,N,te);var ie=J.Vector3[5];H.LerpToRef(z,Z,N,ie),e.ComposeToRef($,te,ie,F)},e.LookAtLH=function(D,w,N){var F=new e;return e.LookAtLHToRef(D,w,N,F),F},e.LookAtLHToRef=function(D,w,N,F){var k=J.Vector3[0],j=J.Vector3[1],z=J.Vector3[2];w.subtractToRef(D,z),z.normalize(),H.CrossToRef(N,z,k);var G=k.lengthSquared();0===G?k.x=1:k.normalizeFromLength(Math.sqrt(G)),H.CrossToRef(z,k,j),j.normalize();var X=-H.Dot(k,D),q=-H.Dot(j,D),Z=-H.Dot(z,D);e.FromValuesToRef(k.x,j.x,z.x,0,k.y,j.y,z.y,0,k.z,j.z,z.z,0,X,q,Z,1,F)},e.LookAtRH=function(D,w,N){var F=new e;return e.LookAtRHToRef(D,w,N,F),F},e.LookAtRHToRef=function(D,w,N,F){var k=J.Vector3[0],j=J.Vector3[1],z=J.Vector3[2];D.subtractToRef(w,z),z.normalize(),H.CrossToRef(N,z,k);var G=k.lengthSquared();0===G?k.x=1:k.normalizeFromLength(Math.sqrt(G)),H.CrossToRef(z,k,j),j.normalize();var X=-H.Dot(k,D),q=-H.Dot(j,D),Z=-H.Dot(z,D);e.FromValuesToRef(k.x,j.x,z.x,0,k.y,j.y,z.y,0,k.z,j.z,z.z,0,X,q,Z,1,F)},e.OrthoLH=function(D,w,N,F){var k=new e;return e.OrthoLHToRef(D,w,N,F,k),k},e.OrthoLHToRef=function(D,w,N,F,k){var j=2/D,z=2/w,G=2/(F-N),H=-(F+N)/(F-N);e.FromValuesToRef(j,0,0,0,0,z,0,0,0,0,G,0,0,0,H,1,k),k._updateIdentityStatus(1===j&&1===z&&1===G&&0===H)},e.OrthoOffCenterLH=function(D,w,N,F,k,j){var z=new e;return e.OrthoOffCenterLHToRef(D,w,N,F,k,j,z),z},e.OrthoOffCenterLHToRef=function(D,w,N,F,k,j,z){var G=2/(w-D),H=2/(F-N),X=2/(j-k),q=-(j+k)/(j-k),Z=(D+w)/(D-w),J=(F+N)/(N-F);e.FromValuesToRef(G,0,0,0,0,H,0,0,0,0,X,0,Z,J,q,1,z),z._markAsUpdated()},e.OrthoOffCenterRH=function(D,w,N,F,k,j){var z=new e;return e.OrthoOffCenterRHToRef(D,w,N,F,k,j,z),z},e.OrthoOffCenterRHToRef=function(D,w,N,F,k,j,z){e.OrthoOffCenterLHToRef(D,w,N,F,k,j,z),z._m[10]*=-1},e.PerspectiveLH=function(D,w,N,F){var k=new e,j=2*N/D,z=2*N/w,G=(F+N)/(F-N),H=-2*F*N/(F-N);return e.FromValuesToRef(j,0,0,0,0,z,0,0,0,0,G,1,0,0,H,0,k),k._updateIdentityStatus(!1),k},e.PerspectiveFovLH=function(D,w,N,F){var k=new e;return e.PerspectiveFovLHToRef(D,w,N,F,k),k},e.PerspectiveFovLHToRef=function(D,w,N,F,k,j){void 0===j&&(j=!0);var z=N,G=F,H=1/Math.tan(.5*D),X=j?H/w:H,q=j?H:H*w,Z=(G+z)/(G-z),J=-2*G*z/(G-z);e.FromValuesToRef(X,0,0,0,0,q,0,0,0,0,Z,1,0,0,J,0,k),k._updateIdentityStatus(!1)},e.PerspectiveFovReverseLHToRef=function(D,w,N,F,k,j){void 0===j&&(j=!0);var z=1/Math.tan(.5*D),G=j?z/w:z,H=j?z:z*w;e.FromValuesToRef(G,0,0,0,0,H,0,0,0,0,-N,1,0,0,1,0,k),k._updateIdentityStatus(!1)},e.PerspectiveFovRH=function(D,w,N,F){var k=new e;return e.PerspectiveFovRHToRef(D,w,N,F,k),k},e.PerspectiveFovRHToRef=function(D,w,N,F,k,j){void 0===j&&(j=!0);var z=N,G=F,H=1/Math.tan(.5*D),X=j?H/w:H,q=j?H:H*w,Z=-(G+z)/(G-z),J=-2*G*z/(G-z);e.FromValuesToRef(X,0,0,0,0,q,0,0,0,0,Z,-1,0,0,J,0,k),k._updateIdentityStatus(!1)},e.PerspectiveFovReverseRHToRef=function(D,w,N,F,k,j){void 0===j&&(j=!0);var z=1/Math.tan(.5*D),G=j?z/w:z,H=j?z:z*w;e.FromValuesToRef(G,0,0,0,0,H,0,0,0,0,-N,-1,0,0,-1,0,k),k._updateIdentityStatus(!1)},e.PerspectiveFovWebVRToRef=function(D,w,N,F,k){void 0===k&&(k=!1);var j=k?-1:1,z=Math.tan(D.upDegrees*Math.PI/180),G=Math.tan(D.downDegrees*Math.PI/180),H=Math.tan(D.leftDegrees*Math.PI/180),X=Math.tan(D.rightDegrees*Math.PI/180),q=2/(H+X),Z=2/(z+G),J=F._m;J[0]=q,J[1]=J[2]=J[3]=J[4]=0,J[5]=Z,J[6]=J[7]=0,J[8]=(H-X)*q*.5,J[9]=-(z-G)*Z*.5,J[10]=-N/(w-N),J[11]=1*j,J[12]=J[13]=J[15]=0,J[14]=-2*N*w/(N-w),F._markAsUpdated()},e.GetFinalMatrix=function(D,w,N,F,k,j){var z=D.width,G=D.height,H=D.x,X=D.y,q=e.FromValues(z/2,0,0,0,0,-G/2,0,0,0,0,j-k,0,H+z/2,G/2+X,k,1),Z=J.Matrix[0];return w.multiplyToRef(N,Z),Z.multiplyToRef(F,Z),Z.multiply(q)},e.GetAsMatrix2x2=function(D){var w=D.m;return new Float32Array([w[0],w[1],w[4],w[5]])},e.GetAsMatrix3x3=function(D){var w=D.m;return new Float32Array([w[0],w[1],w[2],w[4],w[5],w[6],w[8],w[9],w[10]])},e.Transpose=function(D){var w=new e;return e.TransposeToRef(D,w),w},e.TransposeToRef=function(D,w){var N=w._m,F=D.m;N[0]=F[0],N[1]=F[4],N[2]=F[8],N[3]=F[12],N[4]=F[1],N[5]=F[5],N[6]=F[9],N[7]=F[13],N[8]=F[2],N[9]=F[6],N[10]=F[10],N[11]=F[14],N[12]=F[3],N[13]=F[7],N[14]=F[11],N[15]=F[15],w._updateIdentityStatus(D._isIdentity,D._isIdentityDirty)},e.Reflection=function(D){var w=new e;return e.ReflectionToRef(D,w),w},e.ReflectionToRef=function(D,w){D.normalize();var N=D.normal.x,F=D.normal.y,k=D.normal.z,j=-2*N,z=-2*F,G=-2*k;e.FromValuesToRef(j*N+1,z*N,G*N,0,j*F,z*F+1,G*F,0,j*k,z*k,G*k+1,0,j*D.d,z*D.d,G*D.d,1,w)},e.FromXYZAxesToRef=function(D,w,N,F){e.FromValuesToRef(D.x,D.y,D.z,0,w.x,w.y,w.z,0,N.x,N.y,N.z,0,0,0,0,1,F)},e.FromQuaternionToRef=function(D,w){var N=D.x*D.x,F=D.y*D.y,k=D.z*D.z,j=D.x*D.y,z=D.z*D.w,G=D.z*D.x,H=D.y*D.w,X=D.y*D.z,q=D.x*D.w;w._m[0]=1-2*(F+k),w._m[1]=2*(j+z),w._m[2]=2*(G-H),w._m[3]=0,w._m[4]=2*(j-z),w._m[5]=1-2*(k+N),w._m[6]=2*(X+q),w._m[7]=0,w._m[8]=2*(G+H),w._m[9]=2*(X-q),w._m[10]=1-2*(F+N),w._m[11]=0,w._m[12]=0,w._m[13]=0,w._m[14]=0,w._m[15]=1,w._markAsUpdated()},e._updateFlagSeed=0,e._identityReadOnly=e.Identity(),e}(),J=function(){function e(){}return e.Vector3=j.a.BuildArray(6,H.Zero),e.Matrix=j.a.BuildArray(2,Z.Identity),e.Quaternion=j.a.BuildArray(3,q.Zero),e}(),$=function(){function e(){}return e.Vector2=j.a.BuildArray(3,G.Zero),e.Vector3=j.a.BuildArray(13,H.Zero),e.Vector4=j.a.BuildArray(3,X.Zero),e.Quaternion=j.a.BuildArray(2,q.Zero),e.Matrix=j.a.BuildArray(8,Z.Identity),e}();z.a.RegisteredTypes["BABYLON.Vector2"]=G,z.a.RegisteredTypes["BABYLON.Vector3"]=H,z.a.RegisteredTypes["BABYLON.Vector4"]=X,z.a.RegisteredTypes["BABYLON.Matrix"]=Z},function(D,w,N){"use strict";N.d(w,"d",(function(){return r})),N.d(w,"a",(function(){return o})),N.d(w,"c",(function(){return a})),N.d(w,"b",(function(){return s})),N.d(w,"e",(function(){return c}));var n=function(D,w){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(D,w){D.__proto__=w}||function(D,w){for(var N in w)w.hasOwnProperty(N)&&(D[N]=w[N])})(D,w)};function r(D,w){function i(){this.constructor=D}n(D,w),D.prototype=null===w?Object.create(w):(i.prototype=w.prototype,new i)}var o=function(){return(o=Object.assign||function(D){for(var w,N=1,F=arguments.length;N<F;N++)for(var k in w=arguments[N])Object.prototype.hasOwnProperty.call(w,k)&&(D[k]=w[k]);return D}).apply(this,arguments)};function a(D,w,N,F){var k,j=arguments.length,z=j<3?w:null===F?F=Object.getOwnPropertyDescriptor(w,N):F;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)z=Reflect.decorate(D,w,N,F);else for(var G=D.length-1;G>=0;G--)(k=D[G])&&(z=(j<3?k(z):j>3?k(w,N,z):k(w,N))||z);return j>3&&z&&Object.defineProperty(w,N,z),z}function s(D,w,N,F){return new(N||(N=Promise))((function(k,j){function a(D){try{c(F.next(D))}catch(D){j(D)}}function s(D){try{c(F.throw(D))}catch(D){j(D)}}function c(D){D.done?k(D.value):new N((function(w){w(D.value)})).then(a,s)}c((F=F.apply(D,w||[])).next())}))}function c(D,w){var N,F,k,j,z={label:0,sent:function(){if(1&k[0])throw k[1];return k[1]},trys:[],ops:[]};return j={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(j[Symbol.iterator]=function(){return this}),j;function s(j){return function(G){return function(j){if(N)throw new TypeError("Generator is already executing.");for(;z;)try{if(N=1,F&&(k=2&j[0]?F.return:j[0]?F.throw||((k=F.return)&&k.call(F),0):F.next)&&!(k=k.call(F,j[1])).done)return k;switch(F=0,k&&(j=[2&j[0],k.value]),j[0]){case 0:case 1:k=j;break;case 4:return z.label++,{value:j[1],done:!1};case 5:z.label++,F=j[1],j=[0];continue;case 7:j=z.ops.pop(),z.trys.pop();continue;default:if(!(k=(k=z.trys).length>0&&k[k.length-1])&&(6===j[0]||2===j[0])){z=0;continue}if(3===j[0]&&(!k||j[1]>k[0]&&j[1]<k[3])){z.label=j[1];break}if(6===j[0]&&z.label<k[1]){z.label=k[1],k=j;break}if(k&&z.label<k[2]){z.label=k[2],z.ops.push(j);break}k[2]&&z.ops.pop(),z.trys.pop();continue}j=w.call(D,z)}catch(D){j=[6,D],F=0}finally{N=k=0}if(5&j[0])throw j[1];return{value:j[0]?j[1]:void 0,done:!0}}([j,G])}}}},function(D,w,N){"use strict";N.d(w,"a",(function(){return F}));var F=function(){function e(){}return e.ALPHA_DISABLE=0,e.ALPHA_ADD=1,e.ALPHA_COMBINE=2,e.ALPHA_SUBTRACT=3,e.ALPHA_MULTIPLY=4,e.ALPHA_MAXIMIZED=5,e.ALPHA_ONEONE=6,e.ALPHA_PREMULTIPLIED=7,e.ALPHA_PREMULTIPLIED_PORTERDUFF=8,e.ALPHA_INTERPOLATE=9,e.ALPHA_SCREENMODE=10,e.ALPHA_ONEONE_ONEONE=11,e.ALPHA_ALPHATOCOLOR=12,e.ALPHA_REVERSEONEMINUS=13,e.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,e.ALPHA_ONEONE_ONEZERO=15,e.ALPHA_EXCLUSION=16,e.ALPHA_EQUATION_ADD=0,e.ALPHA_EQUATION_SUBSTRACT=1,e.ALPHA_EQUATION_REVERSE_SUBTRACT=2,e.ALPHA_EQUATION_MAX=3,e.ALPHA_EQUATION_MIN=4,e.ALPHA_EQUATION_DARKEN=5,e.DELAYLOADSTATE_NONE=0,e.DELAYLOADSTATE_LOADED=1,e.DELAYLOADSTATE_LOADING=2,e.DELAYLOADSTATE_NOTLOADED=4,e.NEVER=512,e.ALWAYS=519,e.LESS=513,e.EQUAL=514,e.LEQUAL=515,e.GREATER=516,e.GEQUAL=518,e.NOTEQUAL=517,e.KEEP=7680,e.REPLACE=7681,e.INCR=7682,e.DECR=7683,e.INVERT=5386,e.INCR_WRAP=34055,e.DECR_WRAP=34056,e.TEXTURE_CLAMP_ADDRESSMODE=0,e.TEXTURE_WRAP_ADDRESSMODE=1,e.TEXTURE_MIRROR_ADDRESSMODE=2,e.TEXTUREFORMAT_ALPHA=0,e.TEXTUREFORMAT_LUMINANCE=1,e.TEXTUREFORMAT_LUMINANCE_ALPHA=2,e.TEXTUREFORMAT_RGB=4,e.TEXTUREFORMAT_RGBA=5,e.TEXTUREFORMAT_RED=6,e.TEXTUREFORMAT_R=6,e.TEXTUREFORMAT_RG=7,e.TEXTUREFORMAT_RED_INTEGER=8,e.TEXTUREFORMAT_R_INTEGER=8,e.TEXTUREFORMAT_RG_INTEGER=9,e.TEXTUREFORMAT_RGB_INTEGER=10,e.TEXTUREFORMAT_RGBA_INTEGER=11,e.TEXTURETYPE_UNSIGNED_BYTE=0,e.TEXTURETYPE_UNSIGNED_INT=0,e.TEXTURETYPE_FLOAT=1,e.TEXTURETYPE_HALF_FLOAT=2,e.TEXTURETYPE_BYTE=3,e.TEXTURETYPE_SHORT=4,e.TEXTURETYPE_UNSIGNED_SHORT=5,e.TEXTURETYPE_INT=6,e.TEXTURETYPE_UNSIGNED_INTEGER=7,e.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,e.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,e.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,e.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,e.TEXTURETYPE_UNSIGNED_INT_24_8=12,e.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,e.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,e.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,e.TEXTURE_NEAREST_SAMPLINGMODE=1,e.TEXTURE_NEAREST_NEAREST=1,e.TEXTURE_BILINEAR_SAMPLINGMODE=2,e.TEXTURE_LINEAR_LINEAR=2,e.TEXTURE_TRILINEAR_SAMPLINGMODE=3,e.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,e.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,e.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,e.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,e.TEXTURE_NEAREST_LINEAR=7,e.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,e.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,e.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,e.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,e.TEXTURE_LINEAR_NEAREST=12,e.TEXTURE_EXPLICIT_MODE=0,e.TEXTURE_SPHERICAL_MODE=1,e.TEXTURE_PLANAR_MODE=2,e.TEXTURE_CUBIC_MODE=3,e.TEXTURE_PROJECTION_MODE=4,e.TEXTURE_SKYBOX_MODE=5,e.TEXTURE_INVCUBIC_MODE=6,e.TEXTURE_EQUIRECTANGULAR_MODE=7,e.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,e.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,e.SCALEMODE_FLOOR=1,e.SCALEMODE_NEAREST=2,e.SCALEMODE_CEILING=3,e.MATERIAL_TextureDirtyFlag=1,e.MATERIAL_LightDirtyFlag=2,e.MATERIAL_FresnelDirtyFlag=4,e.MATERIAL_AttributesDirtyFlag=8,e.MATERIAL_MiscDirtyFlag=16,e.MATERIAL_AllDirtyFlag=31,e.MATERIAL_TriangleFillMode=0,e.MATERIAL_WireFrameFillMode=1,e.MATERIAL_PointFillMode=2,e.MATERIAL_PointListDrawMode=3,e.MATERIAL_LineListDrawMode=4,e.MATERIAL_LineLoopDrawMode=5,e.MATERIAL_LineStripDrawMode=6,e.MATERIAL_TriangleStripDrawMode=7,e.MATERIAL_TriangleFanDrawMode=8,e.MATERIAL_ClockWiseSideOrientation=0,e.MATERIAL_CounterClockWiseSideOrientation=1,e.ACTION_NothingTrigger=0,e.ACTION_OnPickTrigger=1,e.ACTION_OnLeftPickTrigger=2,e.ACTION_OnRightPickTrigger=3,e.ACTION_OnCenterPickTrigger=4,e.ACTION_OnPickDownTrigger=5,e.ACTION_OnDoublePickTrigger=6,e.ACTION_OnPickUpTrigger=7,e.ACTION_OnPickOutTrigger=16,e.ACTION_OnLongPressTrigger=8,e.ACTION_OnPointerOverTrigger=9,e.ACTION_OnPointerOutTrigger=10,e.ACTION_OnEveryFrameTrigger=11,e.ACTION_OnIntersectionEnterTrigger=12,e.ACTION_OnIntersectionExitTrigger=13,e.ACTION_OnKeyDownTrigger=14,e.ACTION_OnKeyUpTrigger=15,e.PARTICLES_BILLBOARDMODE_Y=2,e.PARTICLES_BILLBOARDMODE_ALL=7,e.PARTICLES_BILLBOARDMODE_STRETCHED=8,e.MESHES_CULLINGSTRATEGY_STANDARD=0,e.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,e.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,e.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,e.SCENELOADER_NO_LOGGING=0,e.SCENELOADER_MINIMAL_LOGGING=1,e.SCENELOADER_SUMMARY_LOGGING=2,e.SCENELOADER_DETAILED_LOGGING=3,e}()},function(D,w,N){"use strict";N.d(w,"b",(function(){return d})),N.d(w,"c",(function(){return f})),N.d(w,"m",(function(){return p})),N.d(w,"e",(function(){return _})),N.d(w,"h",(function(){return m})),N.d(w,"n",(function(){return g})),N.d(w,"o",(function(){return v})),N.d(w,"k",(function(){return y})),N.d(w,"g",(function(){return b})),N.d(w,"f",(function(){return T})),N.d(w,"i",(function(){return E})),N.d(w,"l",(function(){return x})),N.d(w,"j",(function(){return P})),N.d(w,"d",(function(){return A})),N.d(w,"a",(function(){return X}));var F=N(35),k=N(0),j=N(19),z=N(10),G={},H={},l=function(D,w,N){var k=D();F.a&&F.a.AddTagsTo(k,w.tags);var j=u(k);for(var z in j){var G=j[z],H=w[z],X=G.type;if(null!=H&&"uniqueId"!==z)switch(X){case 0:case 6:case 11:k[z]=H;break;case 1:k[z]=N||H.isRenderTarget?H:H.clone();break;case 2:case 3:case 4:case 5:case 7:case 10:case 12:k[z]=N?H:H.clone()}}return k};function u(D){var w=D.getClassName();if(H[w])return H[w];H[w]={};for(var N=H[w],F=D,k=w;k;){var j=G[k];for(var z in j)N[z]=j[z];var X=void 0,q=!1;do{if(!(X=Object.getPrototypeOf(F)).getClassName){q=!0;break}if(X.getClassName()!==k)break;F=X}while(X);if(q)break;k=X.getClassName(),F=X}return N}function h(D,w){return function(N,F){var k=function(D){var w=D.getClassName();return G[w]||(G[w]={}),G[w]}(N);k[F]||(k[F]={type:D,sourceName:w})}}function d(D,w){return void 0===w&&(w=null),function(D,w){return void 0===w&&(w=null),function(N,F){var k=w||"_"+F;Object.defineProperty(N,F,{get:function(){return this[k]},set:function(w){this[k]!==w&&(this[k]=w,N[D].apply(this))},enumerable:!0,configurable:!0})}}(D,w)}function f(D){return h(0,D)}function p(D){return h(1,D)}function _(D){return h(2,D)}function m(D){return h(3,D)}function g(D){return h(4,D)}function v(D){return h(5,D)}function y(D){return h(6,D)}function b(D){return h(7,D)}function T(D){return h(8,D)}function E(D){return h(9,D)}function x(D){return h(10,D)}function P(D){return h(12,D)}function A(D){return h(11,D)}var X=function(){function e(){}return e.AppendSerializedAnimations=function(D,w){if(D.animations){w.animations=[];for(var N=0;N<D.animations.length;N++){var F=D.animations[N];w.animations.push(F.serialize())}}},e.Serialize=function(D,w){w||(w={}),F.a&&(w.tags=F.a.GetTags(D));var N=u(D);for(var k in N){var j=N[k],z=j.sourceName||k,G=j.type,H=D[k];if(null!=H)switch(G){case 0:w[z]=H;break;case 1:w[z]=H.serialize();break;case 2:w[z]=H.asArray();break;case 3:w[z]=H.serialize();break;case 4:case 5:w[z]=H.asArray();break;case 6:w[z]=H.id;break;case 7:w[z]=H.serialize();break;case 8:w[z]=H.asArray();break;case 9:w[z]=H.serialize();break;case 10:w[z]=H.asArray();break;case 11:w[z]=H.id;case 12:w[z]=H.asArray()}}return w},e.Parse=function(D,w,N,j){void 0===j&&(j=null);var G=D();j||(j=""),F.a&&F.a.AddTagsTo(G,w.tags);var H=u(G);for(var X in H){var q=H[X],Z=w[q.sourceName||X],J=q.type;if(null!=Z){var $=G;switch(J){case 0:$[X]=Z;break;case 1:N&&($[X]=e._TextureParser(Z,N,j));break;case 2:$[X]=z.a.FromArray(Z);break;case 3:$[X]=e._FresnelParametersParser(Z);break;case 4:$[X]=k.d.FromArray(Z);break;case 5:$[X]=k.e.FromArray(Z);break;case 6:N&&($[X]=N.getLastMeshByID(Z));break;case 7:$[X]=e._ColorCurvesParser(Z);break;case 8:$[X]=z.b.FromArray(Z);break;case 9:$[X]=e._ImageProcessingConfigurationParser(Z);break;case 10:$[X]=k.b.FromArray(Z);break;case 11:N&&($[X]=N.getCameraByID(Z));case 12:$[X]=k.a.FromArray(Z)}}}return G},e.Clone=function(D,w){return l(D,w,!1)},e.Instanciate=function(D,w){return l(D,w,!0)},e._ImageProcessingConfigurationParser=function(D){throw j.a.WarnImport("ImageProcessingConfiguration")},e._FresnelParametersParser=function(D){throw j.a.WarnImport("FresnelParameters")},e._ColorCurvesParser=function(D){throw j.a.WarnImport("ColorCurves")},e._TextureParser=function(D,w,N){throw j.a.WarnImport("Texture")},e}()},function(D,w,N){"use strict";N.d(w,"a",(function(){return F})),N.d(w,"b",(function(){return k}));var F=function(){function e(D,w,N,F,k,j,z,G){void 0===F&&(F=0),void 0===k&&(k=!1),void 0===j&&(j=!1),void 0===z&&(z=!1),D.getScene?this._engine=D.getScene().getEngine():this._engine=D,this._updatable=N,this._instanced=j,this._divisor=G||1,this._data=w,this.byteStride=z?F:F*Float32Array.BYTES_PER_ELEMENT,k||this.create()}return e.prototype.createVertexBuffer=function(D,w,N,F,j,z,G){void 0===z&&(z=!1);var H=z?w:w*Float32Array.BYTES_PER_ELEMENT,X=F?z?F:F*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new k(this._engine,this,D,this._updatable,!0,X,void 0===j?this._instanced:j,H,N,void 0,void 0,!0,this._divisor||G)},e.prototype.isUpdatable=function(){return this._updatable},e.prototype.getData=function(){return this._data},e.prototype.getBuffer=function(){return this._buffer},e.prototype.getStrideSize=function(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT},e.prototype.create=function(D){void 0===D&&(D=null),!D&&this._buffer||(D=D||this._data)&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,D),this._data=D):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(D),this._data=D):this._buffer=this._engine.createVertexBuffer(D))},e.prototype._rebuild=function(){this._buffer=null,this.create(this._data)},e.prototype.update=function(D){this.create(D)},e.prototype.updateDirectly=function(D,w,N,F){void 0===F&&(F=!1),this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,D,F?w:w*Float32Array.BYTES_PER_ELEMENT,N?N*this.byteStride:void 0),this._data=null)},e.prototype.dispose=function(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)},e}(),k=function(){function e(D,w,N,k,j,z,G,H,X,q,Z,J,$){if(void 0===Z&&(Z=!1),void 0===J&&(J=!1),void 0===$&&($=1),w instanceof F?(this._buffer=w,this._ownsBuffer=!1):(this._buffer=new F(D,w,k,z,j,G,J),this._ownsBuffer=!0),this._kind=N,null==q){var te=this.getData();this.type=e.FLOAT,te instanceof Int8Array?this.type=e.BYTE:te instanceof Uint8Array?this.type=e.UNSIGNED_BYTE:te instanceof Int16Array?this.type=e.SHORT:te instanceof Uint16Array?this.type=e.UNSIGNED_SHORT:te instanceof Int32Array?this.type=e.INT:te instanceof Uint32Array&&(this.type=e.UNSIGNED_INT)}else this.type=q;var ie=e.GetTypeByteLength(this.type);J?(this._size=X||(z?z/ie:e.DeduceStride(N)),this.byteStride=z||this._buffer.byteStride||this._size*ie,this.byteOffset=H||0):(this._size=X||z||e.DeduceStride(N),this.byteStride=z?z*ie:this._buffer.byteStride||this._size*ie,this.byteOffset=(H||0)*ie),this.normalized=Z,this._instanced=void 0!==G&&G,this._instanceDivisor=G?$:0}return Object.defineProperty(e.prototype,"instanceDivisor",{get:function(){return this._instanceDivisor},set:function(D){this._instanceDivisor=D,this._instanced=0!=D},enumerable:!0,configurable:!0}),e.prototype._rebuild=function(){this._buffer&&this._buffer._rebuild()},e.prototype.getKind=function(){return this._kind},e.prototype.isUpdatable=function(){return this._buffer.isUpdatable()},e.prototype.getData=function(){return this._buffer.getData()},e.prototype.getBuffer=function(){return this._buffer.getBuffer()},e.prototype.getStrideSize=function(){return this.byteStride/e.GetTypeByteLength(this.type)},e.prototype.getOffset=function(){return this.byteOffset/e.GetTypeByteLength(this.type)},e.prototype.getSize=function(){return this._size},e.prototype.getIsInstanced=function(){return this._instanced},e.prototype.getInstanceDivisor=function(){return this._instanceDivisor},e.prototype.create=function(D){this._buffer.create(D)},e.prototype.update=function(D){this._buffer.update(D)},e.prototype.updateDirectly=function(D,w,N){void 0===N&&(N=!1),this._buffer.updateDirectly(D,w,void 0,N)},e.prototype.dispose=function(){this._ownsBuffer&&this._buffer.dispose()},e.prototype.forEach=function(D,w){e.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,D,this.normalized,w)},e.DeduceStride=function(D){switch(D){case e.UVKind:case e.UV2Kind:case e.UV3Kind:case e.UV4Kind:case e.UV5Kind:case e.UV6Kind:return 2;case e.NormalKind:case e.PositionKind:return 3;case e.ColorKind:case e.MatricesIndicesKind:case e.MatricesIndicesExtraKind:case e.MatricesWeightsKind:case e.MatricesWeightsExtraKind:case e.TangentKind:return 4;default:throw new Error("Invalid kind '"+D+"'")}},e.GetTypeByteLength=function(D){switch(D){case e.BYTE:case e.UNSIGNED_BYTE:return 1;case e.SHORT:case e.UNSIGNED_SHORT:return 2;case e.INT:case e.UNSIGNED_INT:case e.FLOAT:return 4;default:throw new Error("Invalid type '"+D+"'")}},e.ForEach=function(D,w,N,F,k,j,z,G){if(D instanceof Array)for(var H=w/4,X=N/4,q=0;q<j;q+=F){for(var Z=0;Z<F;Z++)G(D[H+Z],q+Z);H+=X}else{var J=D instanceof ArrayBuffer?new DataView(D):new DataView(D.buffer,D.byteOffset,D.byteLength),$=e.GetTypeByteLength(k);for(q=0;q<j;q+=F){var te=w;for(Z=0;Z<F;Z++)G(e._GetFloatValue(J,k,te,z),q+Z),te+=$;w+=N}}},e._GetFloatValue=function(D,w,N,F){switch(w){case e.BYTE:var k=D.getInt8(N);return F&&(k=Math.max(k/127,-1)),k;case e.UNSIGNED_BYTE:return k=D.getUint8(N),F&&(k/=255),k;case e.SHORT:return k=D.getInt16(N,!0),F&&(k=Math.max(k/32767,-1)),k;case e.UNSIGNED_SHORT:return k=D.getUint16(N,!0),F&&(k/=65535),k;case e.INT:return D.getInt32(N,!0);case e.UNSIGNED_INT:return D.getUint32(N,!0);case e.FLOAT:return D.getFloat32(N,!0);default:throw new Error("Invalid component type "+w)}},e.BYTE=5120,e.UNSIGNED_BYTE=5121,e.SHORT=5122,e.UNSIGNED_SHORT=5123,e.INT=5124,e.UNSIGNED_INT=5125,e.FLOAT=5126,e.PositionKind="position",e.NormalKind="normal",e.TangentKind="tangent",e.UVKind="uv",e.UV2Kind="uv2",e.UV3Kind="uv3",e.UV4Kind="uv4",e.UV5Kind="uv5",e.UV6Kind="uv6",e.ColorKind="color",e.MatricesIndicesKind="matricesIndices",e.MatricesWeightsKind="matricesWeights",e.MatricesIndicesExtraKind="matricesIndicesExtra",e.MatricesWeightsExtraKind="matricesWeightsExtra",e}()},function(D,w,N){"use strict";N.d(w,"b",(function(){return R})),N.d(w,"c",(function(){return M})),N.d(w,"a",(function(){return Me}));var F=N(1),k=N(6),j=N(13),z=N(33),G=N(35),H=N(0),X=N(10),q=N(26),Z=N(4),J=N(15),$=N(69),te=N(27),ie=N(57),oe=N(44),ce=N(29),he=N(71),fe=N(67),pe=N(2),_e=N(3),ve=N(7),ye=N(12),be=N(19),Te=N(17),Ee=N(135),Se=N(70),R=function(){},O=function(){this.visibleInstances={},this.batchCache=new M,this.instancesBufferSize=2048},M=function(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=new Array,this.hardwareInstancedRendering=new Array},I=function(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._morphTargetManager=null},Me=function(D){function t(w,N,F,k,j,H){void 0===N&&(N=null),void 0===F&&(F=null),void 0===k&&(k=null),void 0===H&&(H=!0);var X=D.call(this,w,N)||this;if(X._internalMeshDataInfo=new I,X.delayLoadState=pe.a.DELAYLOADSTATE_NONE,X.instances=new Array,X._creationDataStorage=null,X._geometry=null,X._instanceDataStorage=new O,X._effectiveMaterial=null,X._shouldGenerateFlatShading=!1,X._originalBuilderSideOrientation=t.DEFAULTSIDE,X.overrideMaterialSideOrientation=null,N=X.getScene(),k){if(k._geometry&&k._geometry.applyToMesh(X),z.a.DeepCopy(k,X,["name","material","skeleton","instances","parent","uniqueId","source","metadata","hasLODLevels","geometry","isBlocked","areNormalsFrozen","onBeforeDrawObservable","onBeforeRenderObservable","onAfterRenderObservable","onBeforeDraw","onAfterWorldMatrixUpdateObservable","onCollideObservable","onCollisionPositionChangeObservable","onRebuildObservable","onDisposeObservable","lightSources","morphTargetManager"],["_poseMatrix"]),X._internalMeshDataInfo._source=k,N.useClonedMeshMap&&(k._internalMeshDataInfo.meshMap||(k._internalMeshDataInfo.meshMap={}),k._internalMeshDataInfo.meshMap[X.uniqueId]=X),X._originalBuilderSideOrientation=k._originalBuilderSideOrientation,X._creationDataStorage=k._creationDataStorage,k._ranges){var q=k._ranges;for(var w in q)q.hasOwnProperty(w)&&q[w]&&X.createAnimationRange(w,q[w].from,q[w].to)}var Z;if(k.metadata&&k.metadata.clone?X.metadata=k.metadata.clone():X.metadata=k.metadata,G.a&&G.a.HasTags(k)&&G.a.AddTagsTo(X,G.a.GetTags(k,!0)),X.parent=k.parent,X.setPivotMatrix(k.getPivotMatrix()),X.id=w+"."+k.id,X.material=k.material,!j)for(var J=k.getDescendants(!0),$=0;$<J.length;$++){var te=J[$];te.clone&&te.clone(w+"."+te.name,X)}if(k.morphTargetManager&&(X.morphTargetManager=k.morphTargetManager),N.getPhysicsEngine){var ie=N.getPhysicsEngine();if(H&&ie){var oe=ie.getImpostorForPhysicsObject(k);oe&&(X.physicsImpostor=oe.clone(X))}}for(Z=0;Z<N.particleSystems.length;Z++){var ce=N.particleSystems[Z];ce.emitter===k&&ce.clone(ce.name,X)}X.refreshBoundingInfo(),X.computeWorldMatrix(!0)}return null!==F&&(X.parent=F),X._instanceDataStorage.hardwareInstancedRendering=X.getEngine().getCaps().instancedArrays,X}return Object(F.d)(t,D),t._GetDefaultSideOrientation=function(D){return D||t.FRONTSIDE},Object.defineProperty(t.prototype,"onBeforeRenderObservable",{get:function(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new k.c),this._internalMeshDataInfo._onBeforeRenderObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onBeforeBindObservable",{get:function(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new k.c),this._internalMeshDataInfo._onBeforeBindObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onAfterRenderObservable",{get:function(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new k.c),this._internalMeshDataInfo._onAfterRenderObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onBeforeDrawObservable",{get:function(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new k.c),this._internalMeshDataInfo._onBeforeDrawObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onBeforeDraw",{set:function(D){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasInstances",{get:function(){return this.instances.length>0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"morphTargetManager",{get:function(){return this._internalMeshDataInfo._morphTargetManager},set:function(D){this._internalMeshDataInfo._morphTargetManager!==D&&(this._internalMeshDataInfo._morphTargetManager=D,this._syncGeometryWithMorphTargetManager())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"source",{get:function(){return this._internalMeshDataInfo._source},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isUnIndexed",{get:function(){return this._unIndexed},set:function(D){this._unIndexed!==D&&(this._unIndexed=D,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"worldMatrixInstancedBuffer",{get:function(){return this._instanceDataStorage.instancesData},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"manualUpdateOfWorldMatrixInstancedBuffer",{get:function(){return this._instanceDataStorage.manualUpdate},set:function(D){this._instanceDataStorage.manualUpdate=D},enumerable:!0,configurable:!0}),t.prototype.instantiateHierarchy=function(D,w,N){void 0===D&&(D=null);var F=!(this.getTotalVertices()>0)||w&&w.doNotInstantiate?this.clone("Clone of "+(this.name||this.id),D||this.parent,!0):this.createInstance("instance of "+(this.name||this.id));F&&(F.parent=D||this.parent,F.position=this.position.clone(),F.scaling=this.scaling.clone(),this.rotationQuaternion?F.rotationQuaternion=this.rotationQuaternion.clone():F.rotation=this.rotation.clone(),N&&N(this,F));for(var k=0,j=this.getChildTransformNodes(!0);k<j.length;k++)j[k].instantiateHierarchy(F,w,N);return F},t.prototype.getClassName=function(){return"Mesh"},Object.defineProperty(t.prototype,"_isMesh",{get:function(){return!0},enumerable:!0,configurable:!0}),t.prototype.toString=function(w){var N=D.prototype.toString.call(this,w);if(N+=", n vertices: "+this.getTotalVertices(),N+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(var F=0;F<this.animations.length;F++)N+=", animation[0]: "+this.animations[F].toString(w);if(w)if(this._geometry){var k=this.getIndices(),j=this.getVerticesData(Z.b.PositionKind);j&&k&&(N+=", flat shading: "+(j.length/3===k.length?"YES":"NO"))}else N+=", flat shading: UNKNOWN";return N},t.prototype._unBindEffect=function(){D.prototype._unBindEffect.call(this);for(var w=0,N=this.instances;w<N.length;w++)N[w]._unBindEffect()},Object.defineProperty(t.prototype,"hasLODLevels",{get:function(){return this._internalMeshDataInfo._LODLevels.length>0},enumerable:!0,configurable:!0}),t.prototype.getLODLevels=function(){return this._internalMeshDataInfo._LODLevels},t.prototype._sortLODLevels=function(){this._internalMeshDataInfo._LODLevels.sort((function(D,w){return D.distance<w.distance?1:D.distance>w.distance?-1:0}))},t.prototype.addLODLevel=function(D,w){if(w&&w._masterMesh)return ve.a.Warn("You cannot use a mesh as LOD level twice"),this;var N=new Ee.a(D,w);return this._internalMeshDataInfo._LODLevels.push(N),w&&(w._masterMesh=this),this._sortLODLevels(),this},t.prototype.getLODLevelAtDistance=function(D){for(var w=this._internalMeshDataInfo,N=0;N<w._LODLevels.length;N++){var F=w._LODLevels[N];if(F.distance===D)return F.mesh}return null},t.prototype.removeLODLevel=function(D){for(var w=this._internalMeshDataInfo,N=0;N<w._LODLevels.length;N++)w._LODLevels[N].mesh===D&&(w._LODLevels.splice(N,1),D&&(D._masterMesh=null));return this._sortLODLevels(),this},t.prototype.getLOD=function(D,w){var N=this._internalMeshDataInfo;if(!N._LODLevels||0===N._LODLevels.length)return this;var F=(w||this.getBoundingInfo().boundingSphere).centerWorld.subtract(D.globalPosition).length();if(N._LODLevels[N._LODLevels.length-1].distance>F)return this.onLODLevelSelection&&this.onLODLevelSelection(F,this,this),this;for(var k=0;k<N._LODLevels.length;k++){var j=N._LODLevels[k];if(j.distance<F)return j.mesh&&(j.mesh._preActivate(),j.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)),this.onLODLevelSelection&&this.onLODLevelSelection(F,this,j.mesh),j.mesh}return this.onLODLevelSelection&&this.onLODLevelSelection(F,this,this),this},Object.defineProperty(t.prototype,"geometry",{get:function(){return this._geometry},enumerable:!0,configurable:!0}),t.prototype.getTotalVertices=function(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()},t.prototype.getVerticesData=function(D,w,N){return this._geometry?this._geometry.getVerticesData(D,w,N):null},t.prototype.getVertexBuffer=function(D){return this._geometry?this._geometry.getVertexBuffer(D):null},t.prototype.isVerticesDataPresent=function(D){return this._geometry?this._geometry.isVerticesDataPresent(D):!!this._delayInfo&&-1!==this._delayInfo.indexOf(D)},t.prototype.isVertexBufferUpdatable=function(D){return this._geometry?this._geometry.isVertexBufferUpdatable(D):!!this._delayInfo&&-1!==this._delayInfo.indexOf(D)},t.prototype.getVerticesDataKinds=function(){if(!this._geometry){var D=new Array;return this._delayInfo&&this._delayInfo.forEach((function(w){D.push(w)})),D}return this._geometry.getVerticesDataKinds()},t.prototype.getTotalIndices=function(){return this._geometry?this._geometry.getTotalIndices():0},t.prototype.getIndices=function(D,w){return this._geometry?this._geometry.getIndices(D,w):[]},Object.defineProperty(t.prototype,"isBlocked",{get:function(){return null!==this._masterMesh&&void 0!==this._masterMesh},enumerable:!0,configurable:!0}),t.prototype.isReady=function(w,N){if(void 0===w&&(w=!1),void 0===N&&(N=!1),this.delayLoadState===pe.a.DELAYLOADSTATE_LOADING)return!1;if(!D.prototype.isReady.call(this,w))return!1;if(!this.subMeshes||0===this.subMeshes.length)return!0;if(!w)return!0;var F=this.getEngine(),k=this.getScene(),j=N||F.getCaps().instancedArrays&&this.instances.length>0;this.computeWorldMatrix();var z=this.material||k.defaultMaterial;if(z)if(z._storeEffectOnSubMeshes)for(var G=0,H=this.subMeshes;G<H.length;G++){var X=(ie=H[G]).getMaterial();if(X)if(X._storeEffectOnSubMeshes){if(!X.isReadyForSubMesh(this,ie,j))return!1}else if(!X.isReady(this,j))return!1}else if(!z.isReady(this,j))return!1;for(var q=0,Z=this.lightSources;q<Z.length;q++){var J=Z[q].getShadowGenerator();if(J)for(var $=0,te=this.subMeshes;$<te.length;$++){var ie=te[$];if(!J.isReady(ie,j))return!1}}for(var oe=0,ce=this._internalMeshDataInfo._LODLevels;oe<ce.length;oe++){var he=ce[oe];if(he.mesh&&!he.mesh.isReady(j))return!1}return!0},Object.defineProperty(t.prototype,"areNormalsFrozen",{get:function(){return this._internalMeshDataInfo._areNormalsFrozen},enumerable:!0,configurable:!0}),t.prototype.freezeNormals=function(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this},t.prototype.unfreezeNormals=function(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this},Object.defineProperty(t.prototype,"overridenInstanceCount",{set:function(D){this._instanceDataStorage.overridenInstanceCount=D},enumerable:!0,configurable:!0}),t.prototype._preActivate=function(){var D=this._internalMeshDataInfo,w=this.getScene().getRenderId();return D._preActivateId===w||(D._preActivateId=w,this._instanceDataStorage.visibleInstances=null),this},t.prototype._preActivateForIntermediateRendering=function(D){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=D),this},t.prototype._registerInstanceForRenderId=function(D,w){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:w,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[w]||(this._instanceDataStorage.visibleInstances[w]=new Array),this._instanceDataStorage.visibleInstances[w].push(D),this},t.prototype.refreshBoundingInfo=function(D){if(void 0===D&&(D=!1),this._boundingInfo&&this._boundingInfo.isLocked)return this;var w=this.geometry?this.geometry.boundingBias:null;return this._refreshBoundingInfo(this._getPositionData(D),w),this},t.prototype._createGlobalSubMesh=function(D){var w=this.getTotalVertices();if(!w||!this.getIndices())return null;if(this.subMeshes&&this.subMeshes.length>0){var N=this.getIndices();if(!N)return null;var F=N.length,k=!1;if(D)k=!0;else for(var j=0,z=this.subMeshes;j<z.length;j++){var G=z[j];if(G.indexStart+G.indexCount>=F){k=!0;break}if(G.verticesStart+G.verticesCount>=w){k=!0;break}}if(!k)return this.subMeshes[0]}return this.releaseSubMeshes(),new ie.b(0,0,w,0,this.getTotalIndices(),this)},t.prototype.subdivide=function(D){if(!(D<1)){for(var w=this.getTotalIndices(),N=w/D|0,F=0;N%3!=0;)N++;this.releaseSubMeshes();for(var k=0;k<D&&!(F>=w);k++)ie.b.CreateFromIndices(0,F,Math.min(N,w-F),this),F+=N;this.synchronizeInstances()}},t.prototype.setVerticesData=function(D,w,N,F){if(void 0===N&&(N=!1),this._geometry)this._geometry.setVerticesData(D,w,N,F);else{var k=new J.a;k.set(w,D);var j=this.getScene();new $.a($.a.RandomId(),j,k,N,this)}return this},t.prototype.removeVerticesData=function(D){this._geometry&&this._geometry.removeVerticesData(D)},t.prototype.markVerticesDataAsUpdatable=function(D,w){void 0===w&&(w=!0);var N=this.getVertexBuffer(D);N&&N.isUpdatable()!==w&&this.setVerticesData(D,this.getVerticesData(D),w)},t.prototype.setVerticesBuffer=function(D){return this._geometry||(this._geometry=$.a.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(D),this},t.prototype.updateVerticesData=function(D,w,N,F){return this._geometry?(F?(this.makeGeometryUnique(),this.updateVerticesData(D,w,N,!1)):this._geometry.updateVerticesData(D,w,N),this):this},t.prototype.updateMeshPositions=function(D,w){void 0===w&&(w=!0);var N=this.getVerticesData(Z.b.PositionKind);if(!N)return this;if(D(N),this.updateVerticesData(Z.b.PositionKind,N,!1,!1),w){var F=this.getIndices(),k=this.getVerticesData(Z.b.NormalKind);if(!k)return this;J.a.ComputeNormals(N,F,k),this.updateVerticesData(Z.b.NormalKind,k,!1,!1)}return this},t.prototype.makeGeometryUnique=function(){if(!this._geometry)return this;var D=this._geometry,w=this._geometry.copy($.a.RandomId());return D.releaseForMesh(this,!0),w.applyToMesh(this),this},t.prototype.setIndices=function(D,w,N){if(void 0===w&&(w=null),void 0===N&&(N=!1),this._geometry)this._geometry.setIndices(D,w,N);else{var F=new J.a;F.indices=D;var k=this.getScene();new $.a($.a.RandomId(),k,F,N,this)}return this},t.prototype.updateIndices=function(D,w,N){return void 0===N&&(N=!1),this._geometry?(this._geometry.updateIndices(D,w,N),this):this},t.prototype.toLeftHanded=function(){return this._geometry?(this._geometry.toLeftHanded(),this):this},t.prototype._bind=function(D,w,N){if(!this._geometry)return this;var F,k=this.getScene().getEngine();if(this._unIndexed)F=null;else switch(N){case ce.a.PointFillMode:F=null;break;case ce.a.WireFrameFillMode:F=D._getLinesIndexBuffer(this.getIndices(),k);break;default:case ce.a.TriangleFillMode:F=this._geometry.getIndexBuffer()}return this._geometry._bind(w,F),this},t.prototype._draw=function(D,w,N){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);var F=this.getScene().getEngine();return this._unIndexed||w==ce.a.PointFillMode?F.drawArraysType(w,D.verticesStart,D.verticesCount,N):w==ce.a.WireFrameFillMode?F.drawElementsType(w,0,D._linesIndexCount,N):F.drawElementsType(w,D.indexStart,D.indexCount,N),this},t.prototype.registerBeforeRender=function(D){return this.onBeforeRenderObservable.add(D),this},t.prototype.unregisterBeforeRender=function(D){return this.onBeforeRenderObservable.removeCallback(D),this},t.prototype.registerAfterRender=function(D){return this.onAfterRenderObservable.add(D),this},t.prototype.unregisterAfterRender=function(D){return this.onAfterRenderObservable.removeCallback(D),this},t.prototype._getInstancesRenderList=function(D,w){if(void 0===w&&(w=!1),this._instanceDataStorage.isFrozen&&this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch;var N=this.getScene(),F=N._isInIntermediateRendering(),k=F?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,j=this._instanceDataStorage.batchCache;if(j.mustReturn=!1,j.renderSelf[D]=w||!k&&this.isEnabled()&&this.isVisible,j.visibleInstances[D]=null,this._instanceDataStorage.visibleInstances&&!w){var z=this._instanceDataStorage.visibleInstances,G=N.getRenderId(),H=F?z.intermediateDefaultRenderId:z.defaultRenderId;j.visibleInstances[D]=z[G],!j.visibleInstances[D]&&H&&(j.visibleInstances[D]=z[H])}return j.hardwareInstancedRendering[D]=!w&&this._instanceDataStorage.hardwareInstancedRendering&&null!==j.visibleInstances[D]&&void 0!==j.visibleInstances[D],this._instanceDataStorage.previousBatch=j,j},t.prototype._renderWithInstances=function(D,w,N,F,k){var j=N.visibleInstances[D._id];if(!j)return this;for(var z=this._instanceDataStorage,G=z.instancesBufferSize,H=z.instancesBuffer,X=16*(j.length+1)*4;z.instancesBufferSize<X;)z.instancesBufferSize*=2;z.instancesData&&G==z.instancesBufferSize||(z.instancesData=new Float32Array(z.instancesBufferSize/4));var q=0,J=0,$=N.renderSelf[D._id];if(this._instanceDataStorage.manualUpdate)J=($?1:0)+j.length;else{var te=this._effectiveMesh.getWorldMatrix();if($&&(te.copyToArray(z.instancesData,q),q+=16,J++),j)for(var ie=0;ie<j.length;ie++)j[ie].getWorldMatrix().copyToArray(z.instancesData,q),q+=16,J++}return H&&G==z.instancesBufferSize?H.updateDirectly(z.instancesData,0,J):(H&&H.dispose(),H=new Z.a(k,z.instancesData,!0,16,!1,!0),z.instancesBuffer=H,this.setVerticesBuffer(H.createVertexBuffer("world0",0,4)),this.setVerticesBuffer(H.createVertexBuffer("world1",4,4)),this.setVerticesBuffer(H.createVertexBuffer("world2",8,4)),this.setVerticesBuffer(H.createVertexBuffer("world3",12,4))),this._processInstancedBuffers(j,$),this.getScene()._activeIndices.addCount(D.indexCount*J,!1),this._bind(D,F,w),this._draw(D,w,J),k.unbindInstanceAttributes(),this},t.prototype._processInstancedBuffers=function(D,w){},t.prototype._processRendering=function(D,w,N,F,k,j,z){var G=this.getScene(),H=G.getEngine();if(k)this._renderWithInstances(D,N,F,w,H);else{var X=0;F.renderSelf[D._id]&&(j&&j(!1,this._effectiveMesh.getWorldMatrix(),z),X++,this._draw(D,N,this._instanceDataStorage.overridenInstanceCount));var q=F.visibleInstances[D._id];if(q){var Z=q.length;X+=Z;for(var J=0;J<Z;J++){var $=q[J].getWorldMatrix();j&&j(!0,$,z),this._draw(D,N)}}G._activeIndices.addCount(D.indexCount*X,!1)}return this},t.prototype._rebuild=function(){this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),D.prototype._rebuild.call(this)},t.prototype._freeze=function(){if(this.subMeshes){for(var D=0;D<this.subMeshes.length;D++)this._getInstancesRenderList(D);this._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}},t.prototype._unFreeze=function(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null},t.prototype.render=function(D,w,N){var F=this.getScene();if(this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1,this._checkOcclusionQuery())return this;var k=this._getInstancesRenderList(D._id,!!N);if(k.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);var j,z=F.getEngine(),G=k.hardwareInstancedRendering[D._id],H=this._instanceDataStorage,X=D.getMaterial();if(!X)return this;if(!H.isFrozen||!this._effectiveMaterial||this._effectiveMaterial!==X){if(X._storeEffectOnSubMeshes){if(!X.isReadyForSubMesh(this,D,G))return this}else if(!X.isReady(this,G))return this;this._effectiveMaterial=X}w&&z.setAlphaMode(this._effectiveMaterial.alphaMode);for(var q=0,Z=F._beforeRenderingMeshStage;q<Z.length;q++)Z[q].action(this,D,k);if(!(j=this._effectiveMaterial._storeEffectOnSubMeshes?D.effect:this._effectiveMaterial.getEffect()))return this;var J,$=N||this._effectiveMesh;if(!H.isFrozen&&this._effectiveMaterial.backFaceCulling){var te=$._getWorldMatrixDeterminant();null==(J=this.overrideMaterialSideOrientation)&&(J=this._effectiveMaterial.sideOrientation),te<0&&(J=J===ce.a.ClockWiseSideOrientation?ce.a.CounterClockWiseSideOrientation:ce.a.ClockWiseSideOrientation),H.sideOrientation=J}else J=H.sideOrientation;var ie=this._effectiveMaterial._preBind(j,J);this._effectiveMaterial.forceDepthWrite&&z.setDepthWrite(!0);var oe=F.forcePointsCloud?ce.a.PointFillMode:F.forceWireframe?ce.a.WireFrameFillMode:this._effectiveMaterial.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),G||this._bind(D,j,oe);var he=$.getWorldMatrix();this._effectiveMaterial._storeEffectOnSubMeshes?this._effectiveMaterial.bindForSubMesh(he,this,D):this._effectiveMaterial.bind(he,this),!this._effectiveMaterial.backFaceCulling&&this._effectiveMaterial.separateCullingPass&&(z.setState(!0,this._effectiveMaterial.zOffset,!1,!ie),this._processRendering(D,j,oe,k,G,this._onBeforeDraw,this._effectiveMaterial),z.setState(!0,this._effectiveMaterial.zOffset,!1,ie)),this._processRendering(D,j,oe,k,G,this._onBeforeDraw,this._effectiveMaterial),this._effectiveMaterial.unbind();for(var fe=0,pe=F._afterRenderingMeshStage;fe<pe.length;fe++)pe[fe].action(this,D,k);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),this},t.prototype._onBeforeDraw=function(D,w,N){D&&N&&N.bindOnlyWorldMatrix(w)},t.prototype.cleanMatrixWeights=function(){this.isVerticesDataPresent(Z.b.MatricesWeightsKind)&&(this.isVerticesDataPresent(Z.b.MatricesWeightsExtraKind)?this.normalizeSkinWeightsAndExtra():this.normalizeSkinFourWeights())},t.prototype.normalizeSkinFourWeights=function(){for(var D=this.getVerticesData(Z.b.MatricesWeightsKind),w=D.length,N=0;N<w;N+=4){var F=D[N]+D[N+1]+D[N+2]+D[N+3];if(0===F)D[N]=1;else{var k=1/F;D[N]*=k,D[N+1]*=k,D[N+2]*=k,D[N+3]*=k}}this.setVerticesData(Z.b.MatricesWeightsKind,D)},t.prototype.normalizeSkinWeightsAndExtra=function(){for(var D=this.getVerticesData(Z.b.MatricesWeightsExtraKind),w=this.getVerticesData(Z.b.MatricesWeightsKind),N=w.length,F=0;F<N;F+=4){var k=w[F]+w[F+1]+w[F+2]+w[F+3];if(0===(k+=D[F]+D[F+1]+D[F+2]+D[F+3]))w[F]=1;else{var j=1/k;w[F]*=j,w[F+1]*=j,w[F+2]*=j,w[F+3]*=j,D[F]*=j,D[F+1]*=j,D[F+2]*=j,D[F+3]*=j}}this.setVerticesData(Z.b.MatricesWeightsKind,w),this.setVerticesData(Z.b.MatricesWeightsKind,D)},t.prototype.validateSkinning=function(){var D=this.getVerticesData(Z.b.MatricesWeightsExtraKind),w=this.getVerticesData(Z.b.MatricesWeightsKind);if(null===w||null==this.skeleton)return{skinned:!1,valid:!0,report:"not skinned"};for(var N=w.length,F=0,k=0,j=0,z=0,G=null===D?4:8,H=new Array,X=0;X<=G;X++)H[X]=0;for(X=0;X<N;X+=4){for(var q=w[X],J=q,$=0===J?0:1,te=1;te<G;te++){var ie=te<4?w[X+te]:D[X+te-4];ie>q&&F++,0!==ie&&$++,J+=ie,q=ie}if(H[$]++,$>j&&(j=$),0===J)k++;else{var oe=1/J,ce=0;for(te=0;te<G;te++)ce+=te<4?Math.abs(w[X+te]-w[X+te]*oe):Math.abs(D[X+te-4]-D[X+te-4]*oe);ce>.001&&z++}}var he=this.skeleton.bones.length,fe=this.getVerticesData(Z.b.MatricesIndicesKind),pe=this.getVerticesData(Z.b.MatricesIndicesExtraKind),_e=0;for(X=0;X<N;X++)for(te=0;te<G;te++){var ve=te<4?fe[te]:pe[te-4];(ve>=he||ve<0)&&_e++}return{skinned:!0,valid:0===k&&0===z&&0===_e,report:"Number of Weights = "+N/4+"\nMaximum influences = "+j+"\nMissing Weights = "+k+"\nNot Sorted = "+F+"\nNot Normalized = "+z+"\nWeightCounts = ["+H+"]\nNumber of bones = "+he+"\nBad Bone Indices = "+_e}},t.prototype._checkDelayState=function(){var D=this.getScene();return this._geometry?this._geometry.load(D):this.delayLoadState===pe.a.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=pe.a.DELAYLOADSTATE_LOADING,this._queueLoad(D)),this},t.prototype._queueLoad=function(D){var w=this;D._addPendingData(this);var N=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return j.b.LoadFile(this.delayLoadingFile,(function(N){N instanceof ArrayBuffer?w._delayLoadingFunction(N,w):w._delayLoadingFunction(JSON.parse(N),w),w.instances.forEach((function(D){D.refreshBoundingInfo(),D._syncSubMeshes()})),w.delayLoadState=pe.a.DELAYLOADSTATE_LOADED,D._removePendingData(w)}),(function(){}),D.offlineProvider,N),this},t.prototype.isInFrustum=function(w){return this.delayLoadState!==pe.a.DELAYLOADSTATE_LOADING&&!!D.prototype.isInFrustum.call(this,w)&&(this._checkDelayState(),!0)},t.prototype.setMaterialByID=function(D){var w,N=this.getScene().materials;for(w=N.length-1;w>-1;w--)if(N[w].id===D)return this.material=N[w],this;var F=this.getScene().multiMaterials;for(w=F.length-1;w>-1;w--)if(F[w].id===D)return this.material=F[w],this;return this},t.prototype.getAnimatables=function(){var D=new Array;return this.material&&D.push(this.material),this.skeleton&&D.push(this.skeleton),D},t.prototype.bakeTransformIntoVertices=function(D){if(!this.isVerticesDataPresent(Z.b.PositionKind))return this;var w=this.subMeshes.splice(0);this._resetPointsArrayCache();var N,F=this.getVerticesData(Z.b.PositionKind),k=new Array;for(N=0;N<F.length;N+=3)H.e.TransformCoordinates(H.e.FromArray(F,N),D).toArray(k,N);if(this.setVerticesData(Z.b.PositionKind,k,this.getVertexBuffer(Z.b.PositionKind).isUpdatable()),this.isVerticesDataPresent(Z.b.NormalKind)){for(F=this.getVerticesData(Z.b.NormalKind),k=[],N=0;N<F.length;N+=3)H.e.TransformNormal(H.e.FromArray(F,N),D).normalize().toArray(k,N);this.setVerticesData(Z.b.NormalKind,k,this.getVertexBuffer(Z.b.NormalKind).isUpdatable())}return D.m[0]*D.m[5]*D.m[10]<0&&this.flipFaces(),this.releaseSubMeshes(),this.subMeshes=w,this},t.prototype.bakeCurrentTransformIntoVertices=function(D){return void 0===D&&(D=!0),this.bakeTransformIntoVertices(this.computeWorldMatrix(!0)),this.resetLocalMatrix(D),this},Object.defineProperty(t.prototype,"_positions",{get:function(){return this._geometry?this._geometry._positions:null},enumerable:!0,configurable:!0}),t.prototype._resetPointsArrayCache=function(){return this._geometry&&this._geometry._resetPointsArrayCache(),this},t.prototype._generatePointsArray=function(){return!!this._geometry&&this._geometry._generatePointsArray()},t.prototype.clone=function(D,w,N,F){return void 0===D&&(D=""),void 0===w&&(w=null),void 0===F&&(F=!0),new t(D,this.getScene(),w,this,N,F)},t.prototype.dispose=function(w,N){void 0===N&&(N=!1),this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);var F=this._internalMeshDataInfo;if(F._onBeforeDrawObservable&&F._onBeforeDrawObservable.clear(),F._onBeforeBindObservable&&F._onBeforeBindObservable.clear(),F._onBeforeRenderObservable&&F._onBeforeRenderObservable.clear(),F._onAfterRenderObservable&&F._onAfterRenderObservable.clear(),this._scene.useClonedMeshMap){if(F.meshMap)for(var k in F.meshMap)(G=F.meshMap[k])&&(G._internalMeshDataInfo._source=null,F.meshMap[k]=void 0);F._source&&F._source._internalMeshDataInfo.meshMap&&(F._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else for(var j=0,z=this.getScene().meshes;j<z.length;j++){var G;(G=z[j])._internalMeshDataInfo&&G._internalMeshDataInfo._source&&G._internalMeshDataInfo._source===this&&(G._internalMeshDataInfo._source=null)}F._source=null,this._disposeInstanceSpecificData(),D.prototype.dispose.call(this,w,N)},t.prototype._disposeInstanceSpecificData=function(){},t.prototype.applyDisplacementMap=function(D,w,N,F,k,z,G){var H=this;void 0===G&&(G=!1);var X=this.getScene();return j.b.LoadImage(D,(function(D){var j=D.width,X=D.height,q=Se.a.CreateCanvas(j,X).getContext("2d");q.drawImage(D,0,0);var Z=q.getImageData(0,0,j,X).data;H.applyDisplacementMapFromBuffer(Z,j,X,w,N,k,z,G),F&&F(H)}),(function(){}),X.offlineProvider),this},t.prototype.applyDisplacementMapFromBuffer=function(D,w,N,F,k,j,z,G){if(void 0===G&&(G=!1),!this.isVerticesDataPresent(Z.b.PositionKind)||!this.isVerticesDataPresent(Z.b.NormalKind)||!this.isVerticesDataPresent(Z.b.UVKind))return ve.a.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;var X=this.getVerticesData(Z.b.PositionKind,!0,!0),q=this.getVerticesData(Z.b.NormalKind),$=this.getVerticesData(Z.b.UVKind),te=H.e.Zero(),ie=H.e.Zero(),oe=H.d.Zero();j=j||H.d.Zero(),z=z||new H.d(1,1);for(var ce=0;ce<X.length;ce+=3){H.e.FromArrayToRef(X,ce,te),H.e.FromArrayToRef(q,ce,ie),H.d.FromArrayToRef($,ce/3*2,oe);var he=4*((Math.abs(oe.x*z.x+j.x)*w%w|0)+(Math.abs(oe.y*z.y+j.y)*N%N|0)*w),fe=D[he]/255*.3+D[he+1]/255*.59+D[he+2]/255*.11;ie.normalize(),ie.scaleInPlace(F+(k-F)*fe),(te=te.add(ie)).toArray(X,ce)}return J.a.ComputeNormals(X,this.getIndices(),q),G?(this.setVerticesData(Z.b.PositionKind,X),this.setVerticesData(Z.b.NormalKind,q)):(this.updateVerticesData(Z.b.PositionKind,X),this.updateVerticesData(Z.b.NormalKind,q)),this},t.prototype.convertToFlatShadedMesh=function(){var D,w,N=this.getVerticesDataKinds(),F={},k={},j={},z=!1;for(D=0;D<N.length;D++){w=N[D];var G=this.getVertexBuffer(w);w!==Z.b.NormalKind?(F[w]=G,k[w]=F[w].getData(),j[w]=[]):(z=G.isUpdatable(),N.splice(D,1),D--)}var X,q=this.subMeshes.slice(0),J=this.getIndices(),$=this.getTotalIndices();for(X=0;X<$;X++){var te=J[X];for(D=0;D<N.length;D++)for(var oe=F[w=N[D]].getStrideSize(),ce=0;ce<oe;ce++)j[w].push(k[w][te*oe+ce])}var he=[],fe=j[Z.b.PositionKind];for(X=0;X<$;X+=3){J[X]=X,J[X+1]=X+1,J[X+2]=X+2;for(var pe=H.e.FromArray(fe,3*X),_e=H.e.FromArray(fe,3*(X+1)),ve=H.e.FromArray(fe,3*(X+2)),ye=pe.subtract(_e),be=ve.subtract(_e),Te=H.e.Normalize(H.e.Cross(ye,be)),Ee=0;Ee<3;Ee++)he.push(Te.x),he.push(Te.y),he.push(Te.z)}for(this.setIndices(J),this.setVerticesData(Z.b.NormalKind,he,z),D=0;D<N.length;D++)w=N[D],this.setVerticesData(w,j[w],F[w].isUpdatable());this.releaseSubMeshes();for(var Se=0;Se<q.length;Se++){var Me=q[Se];ie.b.AddToMesh(Me.materialIndex,Me.indexStart,Me.indexCount,Me.indexStart,Me.indexCount,this)}return this.synchronizeInstances(),this},t.prototype.convertToUnIndexedMesh=function(){var D,w,N=this.getVerticesDataKinds(),F={},k={},j={};for(D=0;D<N.length;D++){w=N[D];var z=this.getVertexBuffer(w);F[w]=z,k[w]=F[w].getData(),j[w]=[]}var G,H=this.subMeshes.slice(0),X=this.getIndices(),q=this.getTotalIndices();for(G=0;G<q;G++){var Z=X[G];for(D=0;D<N.length;D++)for(var J=F[w=N[D]].getStrideSize(),$=0;$<J;$++)j[w].push(k[w][Z*J+$])}for(G=0;G<q;G+=3)X[G]=G,X[G+1]=G+1,X[G+2]=G+2;for(this.setIndices(X),D=0;D<N.length;D++)w=N[D],this.setVerticesData(w,j[w],F[w].isUpdatable());this.releaseSubMeshes();for(var te=0;te<H.length;te++){var oe=H[te];ie.b.AddToMesh(oe.materialIndex,oe.indexStart,oe.indexCount,oe.indexStart,oe.indexCount,this)}return this._unIndexed=!0,this.synchronizeInstances(),this},t.prototype.flipFaces=function(D){void 0===D&&(D=!1);var w,N,F=J.a.ExtractFromMesh(this);if(D&&this.isVerticesDataPresent(Z.b.NormalKind)&&F.normals)for(w=0;w<F.normals.length;w++)F.normals[w]*=-1;if(F.indices)for(w=0;w<F.indices.length;w+=3)N=F.indices[w+1],F.indices[w+1]=F.indices[w+2],F.indices[w+2]=N;return F.applyToMesh(this,this.isVertexBufferUpdatable(Z.b.PositionKind)),this},t.prototype.increaseVertices=function(D){var w=J.a.ExtractFromMesh(this),N=w.uvs,F=w.indices,k=w.positions,j=w.normals;if(null===F||null===k||null===j||null===N)ve.a.Warn("VertexData contains null entries");else{for(var z,G,X=D+1,q=new Array,$=0;$<X+1;$++)q[$]=new Array;var te,ie=new H.e(0,0,0),oe=new H.e(0,0,0),ce=new H.d(0,0),he=new Array,fe=new Array,pe=new Array,_e=k.length,ye=N.length;for($=0;$<F.length;$+=3){fe[0]=F[$],fe[1]=F[$+1],fe[2]=F[$+2];for(var be=0;be<3;be++)if(z=fe[be],G=fe[(be+1)%3],void 0===pe[z]&&void 0===pe[G]?(pe[z]=new Array,pe[G]=new Array):(void 0===pe[z]&&(pe[z]=new Array),void 0===pe[G]&&(pe[G]=new Array)),void 0===pe[z][G]&&void 0===pe[G][z]){pe[z][G]=[],ie.x=(k[3*G]-k[3*z])/X,ie.y=(k[3*G+1]-k[3*z+1])/X,ie.z=(k[3*G+2]-k[3*z+2])/X,oe.x=(j[3*G]-j[3*z])/X,oe.y=(j[3*G+1]-j[3*z+1])/X,oe.z=(j[3*G+2]-j[3*z+2])/X,ce.x=(N[2*G]-N[2*z])/X,ce.y=(N[2*G+1]-N[2*z+1])/X,pe[z][G].push(z);for(var Te=1;Te<X;Te++)pe[z][G].push(k.length/3),k[_e]=k[3*z]+Te*ie.x,j[_e++]=j[3*z]+Te*oe.x,k[_e]=k[3*z+1]+Te*ie.y,j[_e++]=j[3*z+1]+Te*oe.y,k[_e]=k[3*z+2]+Te*ie.z,j[_e++]=j[3*z+2]+Te*oe.z,N[ye++]=N[2*z]+Te*ce.x,N[ye++]=N[2*z+1]+Te*ce.y;pe[z][G].push(G),pe[G][z]=new Array,te=pe[z][G].length;for(var Ee=0;Ee<te;Ee++)pe[G][z][Ee]=pe[z][G][te-1-Ee]}for(q[0][0]=F[$],q[1][0]=pe[F[$]][F[$+1]][1],q[1][1]=pe[F[$]][F[$+2]][1],Te=2;Te<X;Te++)for(q[Te][0]=pe[F[$]][F[$+1]][Te],q[Te][Te]=pe[F[$]][F[$+2]][Te],ie.x=(k[3*q[Te][Te]]-k[3*q[Te][0]])/Te,ie.y=(k[3*q[Te][Te]+1]-k[3*q[Te][0]+1])/Te,ie.z=(k[3*q[Te][Te]+2]-k[3*q[Te][0]+2])/Te,oe.x=(j[3*q[Te][Te]]-j[3*q[Te][0]])/Te,oe.y=(j[3*q[Te][Te]+1]-j[3*q[Te][0]+1])/Te,oe.z=(j[3*q[Te][Te]+2]-j[3*q[Te][0]+2])/Te,ce.x=(N[2*q[Te][Te]]-N[2*q[Te][0]])/Te,ce.y=(N[2*q[Te][Te]+1]-N[2*q[Te][0]+1])/Te,be=1;be<Te;be++)q[Te][be]=k.length/3,k[_e]=k[3*q[Te][0]]+be*ie.x,j[_e++]=j[3*q[Te][0]]+be*oe.x,k[_e]=k[3*q[Te][0]+1]+be*ie.y,j[_e++]=j[3*q[Te][0]+1]+be*oe.y,k[_e]=k[3*q[Te][0]+2]+be*ie.z,j[_e++]=j[3*q[Te][0]+2]+be*oe.z,N[ye++]=N[2*q[Te][0]]+be*ce.x,N[ye++]=N[2*q[Te][0]+1]+be*ce.y;for(q[X]=pe[F[$+1]][F[$+2]],he.push(q[0][0],q[1][0],q[1][1]),Te=1;Te<X;Te++){for(be=0;be<Te;be++)he.push(q[Te][be],q[Te+1][be],q[Te+1][be+1]),he.push(q[Te][be],q[Te+1][be+1],q[Te][be+1]);he.push(q[Te][be],q[Te+1][be],q[Te+1][be+1])}}w.indices=he,w.applyToMesh(this,this.isVertexBufferUpdatable(Z.b.PositionKind))}},t.prototype.forceSharedVertices=function(){var D=J.a.ExtractFromMesh(this),w=D.uvs,N=D.indices,F=D.positions,k=D.colors;if(void 0===N||void 0===F||null===N||null===F)ve.a.Warn("VertexData contains empty entries");else{for(var j,z,G=new Array,H=new Array,X=new Array,q=new Array,$=new Array,te=0,ie=new Array,oe=0;oe<N.length;oe+=3){z=[N[oe],N[oe+1],N[oe+2]],$=new Array;for(var ce=0;ce<3;ce++){$[ce]="";for(var he=0;he<3;he++)Math.abs(F[3*z[ce]+he])<1e-8&&(F[3*z[ce]+he]=0),$[ce]+=F[3*z[ce]+he]+"|";$[ce]=$[ce].slice(0,-1)}if($[0]!=$[1]&&$[0]!=$[2]&&$[1]!=$[2])for(ce=0;ce<3;ce++){if((j=ie.indexOf($[ce]))<0){for(ie.push($[ce]),j=te++,he=0;he<3;he++)G.push(F[3*z[ce]+he]);if(null!=k)for(he=0;he<4;he++)q.push(k[4*z[ce]+he]);if(null!=w)for(he=0;he<2;he++)X.push(w[2*z[ce]+he])}H.push(j)}}var fe=new Array;J.a.ComputeNormals(G,H,fe),D.positions=G,D.indices=H,D.normals=fe,null!=w&&(D.uvs=X),null!=k&&(D.colors=q),D.applyToMesh(this,this.isVertexBufferUpdatable(Z.b.PositionKind))}},t._instancedMeshFactory=function(D,w){throw be.a.WarnImport("InstancedMesh")},t._PhysicsImpostorParser=function(D,w,N){throw be.a.WarnImport("PhysicsImpostor")},t.prototype.createInstance=function(D){return t._instancedMeshFactory(D,this)},t.prototype.synchronizeInstances=function(){for(var D=0;D<this.instances.length;D++)this.instances[D]._syncSubMeshes();return this},t.prototype.optimizeIndices=function(D){var w=this,N=this.getIndices(),F=this.getVerticesData(Z.b.PositionKind);if(!F||!N)return this;for(var k=new Array,z=0;z<F.length;z+=3)k.push(H.e.FromArray(F,z));var G=new Array;return j.a.SyncAsyncForLoop(k.length,40,(function(D){for(var w=k.length-1-D,N=k[w],F=0;F<w;++F){var j=k[F];if(N.equals(j)){G[w]=F;break}}}),(function(){for(var F=0;F<N.length;++F)N[F]=G[N[F]]||N[F];var k=w.subMeshes.slice(0);w.setIndices(N),w.subMeshes=k,D&&D(w)})),this},t.prototype.serialize=function(D){D.name=this.name,D.id=this.id,D.type=this.getClassName(),G.a&&G.a.HasTags(this)&&(D.tags=G.a.GetTags(this)),D.position=this.position.asArray(),this.rotationQuaternion?D.rotationQuaternion=this.rotationQuaternion.asArray():this.rotation&&(D.rotation=this.rotation.asArray()),D.scaling=this.scaling.asArray(),this._postMultiplyPivotMatrix?D.pivotMatrix=this.getPivotMatrix().asArray():D.localMatrix=this.getPivotMatrix().asArray(),D.isEnabled=this.isEnabled(!1),D.isVisible=this.isVisible,D.infiniteDistance=this.infiniteDistance,D.pickable=this.isPickable,D.receiveShadows=this.receiveShadows,D.billboardMode=this.billboardMode,D.visibility=this.visibility,D.checkCollisions=this.checkCollisions,D.isBlocker=this.isBlocker,D.overrideMaterialSideOrientation=this.overrideMaterialSideOrientation,this.parent&&(D.parentId=this.parent.id),D.isUnIndexed=this.isUnIndexed;var w=this._geometry;if(w){var N=w.id;D.geometryId=N,D.subMeshes=[];for(var F=0;F<this.subMeshes.length;F++){var k=this.subMeshes[F];D.subMeshes.push({materialIndex:k.materialIndex,verticesStart:k.verticesStart,verticesCount:k.verticesCount,indexStart:k.indexStart,indexCount:k.indexCount})}}if(this.material?this.material.doNotSerialize||(D.materialId=this.material.id):this.material=null,this.morphTargetManager&&(D.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(D.skeletonId=this.skeleton.id),this.getScene()._getComponent(Te.a.NAME_PHYSICSENGINE)){var j=this.getPhysicsImpostor();j&&(D.physicsMass=j.getParam("mass"),D.physicsFriction=j.getParam("friction"),D.physicsRestitution=j.getParam("mass"),D.physicsImpostor=j.type)}this.metadata&&(D.metadata=this.metadata),D.instances=[];for(var z=0;z<this.instances.length;z++){var H=this.instances[z];if(!H.doNotSerialize){var X={name:H.name,id:H.id,position:H.position.asArray(),scaling:H.scaling.asArray()};H.parent&&(X.parentId=H.parent.id),H.rotationQuaternion?X.rotationQuaternion=H.rotationQuaternion.asArray():H.rotation&&(X.rotation=H.rotation.asArray()),D.instances.push(X),_e.a.AppendSerializedAnimations(H,X),X.ranges=H.serializeAnimationRanges()}}_e.a.AppendSerializedAnimations(this,D),D.ranges=this.serializeAnimationRanges(),D.layerMask=this.layerMask,D.alphaIndex=this.alphaIndex,D.hasVertexAlpha=this.hasVertexAlpha,D.overlayAlpha=this.overlayAlpha,D.overlayColor=this.overlayColor.asArray(),D.renderOverlay=this.renderOverlay,D.applyFog=this.applyFog,this.actionManager&&(D.actions=this.actionManager.serialize(this.name))},t.prototype._syncGeometryWithMorphTargetManager=function(){if(this.geometry){this._markSubMeshesAsAttributesDirty();var D=this._internalMeshDataInfo._morphTargetManager;if(D&&D.vertexCount){if(D.vertexCount!==this.getTotalVertices())return ve.a.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);for(var w=0;w<D.numInfluencers;w++){var N=D.getActiveTarget(w),F=N.getPositions();if(!F)return void ve.a.Error("Invalid morph target. Target must have positions.");this.geometry.setVerticesData(Z.b.PositionKind+w,F,!1,3);var k=N.getNormals();k&&this.geometry.setVerticesData(Z.b.NormalKind+w,k,!1,3);var j=N.getTangents();j&&this.geometry.setVerticesData(Z.b.TangentKind+w,j,!1,3);var z=N.getUVs();z&&this.geometry.setVerticesData(Z.b.UVKind+"_"+w,z,!1,2)}}else for(w=0;this.geometry.isVerticesDataPresent(Z.b.PositionKind+w);)this.geometry.removeVerticesData(Z.b.PositionKind+w),this.geometry.isVerticesDataPresent(Z.b.NormalKind+w)&&this.geometry.removeVerticesData(Z.b.NormalKind+w),this.geometry.isVerticesDataPresent(Z.b.TangentKind+w)&&this.geometry.removeVerticesData(Z.b.TangentKind+w),this.geometry.isVerticesDataPresent(Z.b.UVKind+w)&&this.geometry.removeVerticesData(Z.b.UVKind+"_"+w),w++}},t.Parse=function(D,w,N){var F;if((F=D.type&&"GroundMesh"===D.type?t._GroundMeshParser(D,w):new t(D.name,w)).id=D.id,G.a&&G.a.AddTagsTo(F,D.tags),F.position=H.e.FromArray(D.position),void 0!==D.metadata&&(F.metadata=D.metadata),D.rotationQuaternion?F.rotationQuaternion=H.b.FromArray(D.rotationQuaternion):D.rotation&&(F.rotation=H.e.FromArray(D.rotation)),F.scaling=H.e.FromArray(D.scaling),D.localMatrix?F.setPreTransformMatrix(H.a.FromArray(D.localMatrix)):D.pivotMatrix&&F.setPivotMatrix(H.a.FromArray(D.pivotMatrix)),F.setEnabled(D.isEnabled),F.isVisible=D.isVisible,F.infiniteDistance=D.infiniteDistance,F.showBoundingBox=D.showBoundingBox,F.showSubMeshesBoundingBox=D.showSubMeshesBoundingBox,void 0!==D.applyFog&&(F.applyFog=D.applyFog),void 0!==D.pickable&&(F.isPickable=D.pickable),void 0!==D.alphaIndex&&(F.alphaIndex=D.alphaIndex),F.receiveShadows=D.receiveShadows,F.billboardMode=D.billboardMode,void 0!==D.visibility&&(F.visibility=D.visibility),F.checkCollisions=D.checkCollisions,F.overrideMaterialSideOrientation=D.overrideMaterialSideOrientation,void 0!==D.isBlocker&&(F.isBlocker=D.isBlocker),F._shouldGenerateFlatShading=D.useFlatShading,D.freezeWorldMatrix&&(F._waitingData.freezeWorldMatrix=D.freezeWorldMatrix),D.parentId&&(F._waitingParentId=D.parentId),void 0!==D.actions&&(F._waitingData.actions=D.actions),void 0!==D.overlayAlpha&&(F.overlayAlpha=D.overlayAlpha),void 0!==D.overlayColor&&(F.overlayColor=X.a.FromArray(D.overlayColor)),void 0!==D.renderOverlay&&(F.renderOverlay=D.renderOverlay),F.isUnIndexed=!!D.isUnIndexed,F.hasVertexAlpha=D.hasVertexAlpha,D.delayLoadingFile?(F.delayLoadState=pe.a.DELAYLOADSTATE_NOTLOADED,F.delayLoadingFile=N+D.delayLoadingFile,F._boundingInfo=new oe.a(H.e.FromArray(D.boundingBoxMinimum),H.e.FromArray(D.boundingBoxMaximum)),D._binaryInfo&&(F._binaryInfo=D._binaryInfo),F._delayInfo=[],D.hasUVs&&F._delayInfo.push(Z.b.UVKind),D.hasUVs2&&F._delayInfo.push(Z.b.UV2Kind),D.hasUVs3&&F._delayInfo.push(Z.b.UV3Kind),D.hasUVs4&&F._delayInfo.push(Z.b.UV4Kind),D.hasUVs5&&F._delayInfo.push(Z.b.UV5Kind),D.hasUVs6&&F._delayInfo.push(Z.b.UV6Kind),D.hasColors&&F._delayInfo.push(Z.b.ColorKind),D.hasMatricesIndices&&F._delayInfo.push(Z.b.MatricesIndicesKind),D.hasMatricesWeights&&F._delayInfo.push(Z.b.MatricesWeightsKind),F._delayLoadingFunction=$.a._ImportGeometry,fe.a.ForceFullSceneLoadingForIncremental&&F._checkDelayState()):$.a._ImportGeometry(D,F),D.materialId?F.setMaterialByID(D.materialId):F.material=null,D.morphTargetManagerId>-1&&(F.morphTargetManager=w.getMorphTargetManagerById(D.morphTargetManagerId)),D.skeletonId>-1&&(F.skeleton=w.getLastSkeletonByID(D.skeletonId),D.numBoneInfluencers&&(F.numBoneInfluencers=D.numBoneInfluencers)),D.animations){for(var k=0;k<D.animations.length;k++){var j=D.animations[k];(ie=ye.a.GetClass("BABYLON.Animation"))&&F.animations.push(ie.Parse(j))}q.a.ParseAnimationRanges(F,D,w)}if(D.autoAnimate&&w.beginAnimation(F,D.autoAnimateFrom,D.autoAnimateTo,D.autoAnimateLoop,D.autoAnimateSpeed||1),D.layerMask&&!isNaN(D.layerMask)?F.layerMask=Math.abs(parseInt(D.layerMask)):F.layerMask=268435455,D.physicsImpostor&&t._PhysicsImpostorParser(w,F,D),D.lodMeshIds&&(F._waitingData.lods={ids:D.lodMeshIds,distances:D.lodDistances?D.lodDistances:null,coverages:D.lodCoverages?D.lodCoverages:null}),D.instances)for(var z=0;z<D.instances.length;z++){var J=D.instances[z],te=F.createInstance(J.name);if(J.id&&(te.id=J.id),G.a&&(J.tags?G.a.AddTagsTo(te,J.tags):G.a.AddTagsTo(te,D.tags)),te.position=H.e.FromArray(J.position),void 0!==J.metadata&&(te.metadata=J.metadata),J.parentId&&(te._waitingParentId=J.parentId),J.rotationQuaternion?te.rotationQuaternion=H.b.FromArray(J.rotationQuaternion):J.rotation&&(te.rotation=H.e.FromArray(J.rotation)),te.scaling=H.e.FromArray(J.scaling),null!=J.checkCollisions&&null!=J.checkCollisions&&(te.checkCollisions=J.checkCollisions),null!=J.pickable&&null!=J.pickable&&(te.isPickable=J.pickable),null!=J.showBoundingBox&&null!=J.showBoundingBox&&(te.showBoundingBox=J.showBoundingBox),null!=J.showSubMeshesBoundingBox&&null!=J.showSubMeshesBoundingBox&&(te.showSubMeshesBoundingBox=J.showSubMeshesBoundingBox),null!=J.alphaIndex&&null!=J.showSubMeshesBoundingBox&&(te.alphaIndex=J.alphaIndex),J.physicsImpostor&&t._PhysicsImpostorParser(w,te,J),J.animations){for(k=0;k<J.animations.length;k++){var ie;j=J.animations[k],(ie=ye.a.GetClass("BABYLON.Animation"))&&te.animations.push(ie.Parse(j))}q.a.ParseAnimationRanges(te,J,w),J.autoAnimate&&w.beginAnimation(te,J.autoAnimateFrom,J.autoAnimateTo,J.autoAnimateLoop,J.autoAnimateSpeed||1)}}return F},t.CreateRibbon=function(D,w,N,F,k,j,z,G,H){throw be.a.WarnImport("MeshBuilder")},t.CreateDisc=function(D,w,N,F,k,j){throw void 0===F&&(F=null),be.a.WarnImport("MeshBuilder")},t.CreateBox=function(D,w,N,F,k){throw void 0===N&&(N=null),be.a.WarnImport("MeshBuilder")},t.CreateSphere=function(D,w,N,F,k,j){throw be.a.WarnImport("MeshBuilder")},t.CreateHemisphere=function(D,w,N,F){throw be.a.WarnImport("MeshBuilder")},t.CreateCylinder=function(D,w,N,F,k,j,z,G,H){throw be.a.WarnImport("MeshBuilder")},t.CreateTorus=function(D,w,N,F,k,j,z){throw be.a.WarnImport("MeshBuilder")},t.CreateTorusKnot=function(D,w,N,F,k,j,z,G,H,X){throw be.a.WarnImport("MeshBuilder")},t.CreateLines=function(D,w,N,F,k){throw void 0===N&&(N=null),void 0===F&&(F=!1),void 0===k&&(k=null),be.a.WarnImport("MeshBuilder")},t.CreateDashedLines=function(D,w,N,F,k,j,z,G){throw void 0===j&&(j=null),be.a.WarnImport("MeshBuilder")},t.CreatePolygon=function(D,w,N,F,k,j,z){throw void 0===z&&(z=earcut),be.a.WarnImport("MeshBuilder")},t.ExtrudePolygon=function(D,w,N,F,k,j,z,G){throw void 0===G&&(G=earcut),be.a.WarnImport("MeshBuilder")},t.ExtrudeShape=function(D,w,N,F,k,j,z,G,H,X){throw void 0===z&&(z=null),be.a.WarnImport("MeshBuilder")},t.ExtrudeShapeCustom=function(D,w,N,F,k,j,z,G,H,X,q,Z){throw be.a.WarnImport("MeshBuilder")},t.CreateLathe=function(D,w,N,F,k,j,z){throw be.a.WarnImport("MeshBuilder")},t.CreatePlane=function(D,w,N,F,k){throw be.a.WarnImport("MeshBuilder")},t.CreateGround=function(D,w,N,F,k,j){throw be.a.WarnImport("MeshBuilder")},t.CreateTiledGround=function(D,w,N,F,k,j,z,G,H){throw be.a.WarnImport("MeshBuilder")},t.CreateGroundFromHeightMap=function(D,w,N,F,k,j,z,G,H,X,q){throw be.a.WarnImport("MeshBuilder")},t.CreateTube=function(D,w,N,F,k,j,z,G,H,X){throw be.a.WarnImport("MeshBuilder")},t.CreatePolyhedron=function(D,w,N){throw be.a.WarnImport("MeshBuilder")},t.CreateIcoSphere=function(D,w,N){throw be.a.WarnImport("MeshBuilder")},t.CreateDecal=function(D,w,N,F,k,j){throw be.a.WarnImport("MeshBuilder")},t.prototype.setPositionsForCPUSkinning=function(){var D=this._internalMeshDataInfo;if(!D._sourcePositions){var w=this.getVerticesData(Z.b.PositionKind);if(!w)return D._sourcePositions;D._sourcePositions=new Float32Array(w),this.isVertexBufferUpdatable(Z.b.PositionKind)||this.setVerticesData(Z.b.PositionKind,w,!0)}return D._sourcePositions},t.prototype.setNormalsForCPUSkinning=function(){var D=this._internalMeshDataInfo;if(!D._sourceNormals){var w=this.getVerticesData(Z.b.NormalKind);if(!w)return D._sourceNormals;D._sourceNormals=new Float32Array(w),this.isVertexBufferUpdatable(Z.b.NormalKind)||this.setVerticesData(Z.b.NormalKind,w,!0)}return D._sourceNormals},t.prototype.applySkeleton=function(D){if(!this.geometry)return this;if(this.geometry._softwareSkinningFrameId==this.getScene().getFrameId())return this;if(this.geometry._softwareSkinningFrameId=this.getScene().getFrameId(),!this.isVerticesDataPresent(Z.b.PositionKind))return this;if(!this.isVerticesDataPresent(Z.b.NormalKind))return this;if(!this.isVerticesDataPresent(Z.b.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(Z.b.MatricesWeightsKind))return this;var w=this._internalMeshDataInfo;if(!w._sourcePositions){var N=this.subMeshes.slice();this.setPositionsForCPUSkinning(),this.subMeshes=N}w._sourceNormals||this.setNormalsForCPUSkinning();var F=this.getVerticesData(Z.b.PositionKind);if(!F)return this;F instanceof Float32Array||(F=new Float32Array(F));var k=this.getVerticesData(Z.b.NormalKind);if(!k)return this;k instanceof Float32Array||(k=new Float32Array(k));var j=this.getVerticesData(Z.b.MatricesIndicesKind),z=this.getVerticesData(Z.b.MatricesWeightsKind);if(!z||!j)return this;for(var G,X=this.numBoneInfluencers>4,q=X?this.getVerticesData(Z.b.MatricesIndicesExtraKind):null,J=X?this.getVerticesData(Z.b.MatricesWeightsExtraKind):null,$=D.getTransformMatrices(this),te=H.e.Zero(),ie=new H.a,oe=new H.a,ce=0,he=0;he<F.length;he+=3,ce+=4){var fe;for(G=0;G<4;G++)(fe=z[ce+G])>0&&(H.a.FromFloat32ArrayToRefScaled($,Math.floor(16*j[ce+G]),fe,oe),ie.addToSelf(oe));if(X)for(G=0;G<4;G++)(fe=J[ce+G])>0&&(H.a.FromFloat32ArrayToRefScaled($,Math.floor(16*q[ce+G]),fe,oe),ie.addToSelf(oe));H.e.TransformCoordinatesFromFloatsToRef(w._sourcePositions[he],w._sourcePositions[he+1],w._sourcePositions[he+2],ie,te),te.toArray(F,he),H.e.TransformNormalFromFloatsToRef(w._sourceNormals[he],w._sourceNormals[he+1],w._sourceNormals[he+2],ie,te),te.toArray(k,he),ie.reset()}return this.updateVerticesData(Z.b.PositionKind,F),this.updateVerticesData(Z.b.NormalKind,k),this},t.MinMax=function(D){var w=null,N=null;return D.forEach((function(D){var F=D.getBoundingInfo().boundingBox;w&&N?(w.minimizeInPlace(F.minimumWorld),N.maximizeInPlace(F.maximumWorld)):(w=F.minimumWorld,N=F.maximumWorld)})),w&&N?{min:w,max:N}:{min:H.e.Zero(),max:H.e.Zero()}},t.Center=function(D){var w=D instanceof Array?t.MinMax(D):D;return H.e.Center(w.min,w.max)},t.MergeMeshes=function(D,w,N,F,k,j){var z;if(void 0===w&&(w=!0),!N){var G=0;for(z=0;z<D.length;z++)if(D[z]&&(G+=D[z].getTotalVertices())>=65536)return ve.a.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}if(j){var H,X,q=null;k=!1}var Z,$=new Array,te=new Array,oe=null,ce=new Array,fe=null;for(z=0;z<D.length;z++)if(D[z]){var pe=D[z];if(pe.isAnInstance)return ve.a.Warn("Cannot merge instance meshes."),null;var _e=pe.computeWorldMatrix(!0);if((Z=J.a.ExtractFromMesh(pe,!0,!0)).transform(_e),oe?oe.merge(Z,N):(oe=Z,fe=pe),k&&ce.push(pe.getTotalIndices()),j)if(pe.material){var ye=pe.material;if(ye instanceof he.a){for(X=0;X<ye.subMaterials.length;X++)$.indexOf(ye.subMaterials[X])<0&&$.push(ye.subMaterials[X]);for(H=0;H<pe.subMeshes.length;H++)te.push($.indexOf(ye.subMaterials[pe.subMeshes[H].materialIndex])),ce.push(pe.subMeshes[H].indexCount)}else for($.indexOf(ye)<0&&$.push(ye),H=0;H<pe.subMeshes.length;H++)te.push($.indexOf(ye)),ce.push(pe.subMeshes[H].indexCount)}else for(H=0;H<pe.subMeshes.length;H++)te.push(0),ce.push(pe.subMeshes[H].indexCount)}if(fe=fe,F||(F=new t(fe.name+"_merged",fe.getScene())),oe.applyToMesh(F),F.checkCollisions=fe.checkCollisions,w)for(z=0;z<D.length;z++)D[z]&&D[z].dispose();if(k||j){F.releaseSubMeshes(),z=0;for(var be=0;z<ce.length;)ie.b.CreateFromIndices(0,be,ce[z],F),be+=ce[z],z++}if(j){for((q=new he.a(fe.name+"_merged",fe.getScene())).subMaterials=$,H=0;H<F.subMeshes.length;H++)F.subMeshes[H].materialIndex=te[H];F.material=q}else F.material=fe.material;return F},t.prototype.addInstance=function(D){D._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(D)},t.prototype.removeInstance=function(D){var w=D._indexInSourceMeshInstanceArray;if(-1!=w){if(w!==this.instances.length-1){var N=this.instances[this.instances.length-1];this.instances[w]=N,N._indexInSourceMeshInstanceArray=w}D._indexInSourceMeshInstanceArray=-1,this.instances.pop()}},t.FRONTSIDE=J.a.FRONTSIDE,t.BACKSIDE=J.a.BACKSIDE,t.DOUBLESIDE=J.a.DOUBLESIDE,t.DEFAULTSIDE=J.a.DEFAULTSIDE,t.NO_CAP=0,t.CAP_START=1,t.CAP_END=2,t.CAP_ALL=3,t.NO_FLIP=0,t.FLIP_TILE=1,t.ROTATE_TILE=2,t.FLIP_ROW=3,t.ROTATE_ROW=4,t.FLIP_N_ROTATE_TILE=5,t.FLIP_N_ROTATE_ROW=6,t.CENTER=0,t.LEFT=1,t.RIGHT=2,t.TOP=3,t.BOTTOM=4,t._GroundMeshParser=function(D,w){throw be.a.WarnImport("GroundMesh")},t}(te.a)},function(D,w,N){"use strict";N.d(w,"a",(function(){return F})),N.d(w,"d",(function(){return r})),N.d(w,"b",(function(){return k})),N.d(w,"c",(function(){return j}));var F=function(){function e(D,w,N,F){void 0===w&&(w=!1),this.initalize(D,w,N,F)}return e.prototype.initalize=function(D,w,N,F){return void 0===w&&(w=!1),this.mask=D,this.skipNextObservers=w,this.target=N,this.currentTarget=F,this},e}(),r=function(D,w,N){void 0===N&&(N=null),this.callback=D,this.mask=w,this.scope=N,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1},k=function(){function e(){}return e.prototype.dispose=function(){if(this._observers&&this._observables)for(var D=0;D<this._observers.length;D++)this._observables[D].remove(this._observers[D]);this._observers=null,this._observables=null},e.Watch=function(D,w,N,F){void 0===N&&(N=-1),void 0===F&&(F=null);var k=new e;k._observers=new Array,k._observables=D;for(var j=0,z=D;j<z.length;j++){var G=z[j].add(w,N,!1,F);G&&k._observers.push(G)}return k},e}(),j=function(){function e(D){this._observers=new Array,this._eventState=new F(0),D&&(this._onObserverAdded=D)}return Object.defineProperty(e.prototype,"observers",{get:function(){return this._observers},enumerable:!0,configurable:!0}),e.prototype.add=function(D,w,N,F,k){if(void 0===w&&(w=-1),void 0===N&&(N=!1),void 0===F&&(F=null),void 0===k&&(k=!1),!D)return null;var j=new r(D,w,F);return j.unregisterOnNextCall=k,N?this._observers.unshift(j):this._observers.push(j),this._onObserverAdded&&this._onObserverAdded(j),j},e.prototype.addOnce=function(D){return this.add(D,void 0,void 0,void 0,!0)},e.prototype.remove=function(D){return!!D&&-1!==this._observers.indexOf(D)&&(this._deferUnregister(D),!0)},e.prototype.removeCallback=function(D,w){for(var N=0;N<this._observers.length;N++){var F=this._observers[N];if(!(F._willBeUnregistered||F.callback!==D||w&&w!==F.scope))return this._deferUnregister(F),!0}return!1},e.prototype._deferUnregister=function(D){var w=this;D.unregisterOnNextCall=!1,D._willBeUnregistered=!0,setTimeout((function(){w._remove(D)}),0)},e.prototype._remove=function(D){if(!D)return!1;var w=this._observers.indexOf(D);return-1!==w&&(this._observers.splice(w,1),!0)},e.prototype.makeObserverTopPriority=function(D){this._remove(D),this._observers.unshift(D)},e.prototype.makeObserverBottomPriority=function(D){this._remove(D),this._observers.push(D)},e.prototype.notifyObservers=function(D,w,N,F){if(void 0===w&&(w=-1),!this._observers.length)return!0;var k=this._eventState;k.mask=w,k.target=N,k.currentTarget=F,k.skipNextObservers=!1,k.lastReturnValue=D;for(var j=0,z=this._observers;j<z.length;j++){var G=z[j];if(!G._willBeUnregistered&&(G.mask&w&&(G.scope?k.lastReturnValue=G.callback.apply(G.scope,[D,k]):k.lastReturnValue=G.callback(D,k),G.unregisterOnNextCall&&this._deferUnregister(G)),k.skipNextObservers))return!1}return!0},e.prototype.notifyObserversWithPromise=function(D,w,N,F){var k=this;void 0===w&&(w=-1);var j=Promise.resolve(D);if(!this._observers.length)return j;var z=this._eventState;return z.mask=w,z.target=N,z.currentTarget=F,z.skipNextObservers=!1,this._observers.forEach((function(N){z.skipNextObservers||N._willBeUnregistered||N.mask&w&&(j=N.scope?j.then((function(w){return z.lastReturnValue=w,N.callback.apply(N.scope,[D,z])})):j.then((function(w){return z.lastReturnValue=w,N.callback(D,z)})),N.unregisterOnNextCall&&k._deferUnregister(N))})),j.then((function(){return D}))},e.prototype.notifyObserver=function(D,w,N){void 0===N&&(N=-1);var F=this._eventState;F.mask=N,F.skipNextObservers=!1,D.callback(w,F)},e.prototype.hasObservers=function(){return this._observers.length>0},e.prototype.clear=function(){this._observers=new Array,this._onObserverAdded=null},e.prototype.clone=function(){var D=new e;return D._observers=this._observers.slice(0),D},e.prototype.hasSpecificMask=function(D){void 0===D&&(D=-1);for(var w=0,N=this._observers;w<N.length;w++){var F=N[w];if(F.mask&D||F.mask===D)return!0}return!1},e}()},function(D,w,N){"use strict";N.d(w,"a",(function(){return F}));var F=function(){function e(){}return e._AddLogEntry=function(D){e._LogCache=D+e._LogCache,e.OnNewCacheEntry&&e.OnNewCacheEntry(D)},e._FormatMessage=function(D){var t=function(D){return D<10?"0"+D:""+D},w=new Date;return"["+t(w.getHours())+":"+t(w.getMinutes())+":"+t(w.getSeconds())+"]: "+D},e._LogDisabled=function(D){},e._LogEnabled=function(D){var w=e._FormatMessage(D);console.log("BJS - "+w);var N="<div style='color:white'>"+w+"</div><br>";e._AddLogEntry(N)},e._WarnDisabled=function(D){},e._WarnEnabled=function(D){var w=e._FormatMessage(D);console.warn("BJS - "+w);var N="<div style='color:orange'>"+w+"</div><br>";e._AddLogEntry(N)},e._ErrorDisabled=function(D){},e._ErrorEnabled=function(D){e.errorsCount++;var w=e._FormatMessage(D);console.error("BJS - "+w);var N="<div style='color:red'>"+w+"</div><br>";e._AddLogEntry(N)},Object.defineProperty(e,"LogCache",{get:function(){return e._LogCache},enumerable:!0,configurable:!0}),e.ClearLogCache=function(){e._LogCache="",e.errorsCount=0},Object.defineProperty(e,"LogLevels",{set:function(D){(D&e.MessageLogLevel)===e.MessageLogLevel?e.Log=e._LogEnabled:e.Log=e._LogDisabled,(D&e.WarningLogLevel)===e.WarningLogLevel?e.Warn=e._WarnEnabled:e.Warn=e._WarnDisabled,(D&e.ErrorLogLevel)===e.ErrorLogLevel?e.Error=e._ErrorEnabled:e.Error=e._ErrorDisabled},enumerable:!0,configurable:!0}),e.NoneLogLevel=0,e.MessageLogLevel=1,e.WarningLogLevel=2,e.ErrorLogLevel=4,e.AllLogLevel=7,e._LogCache="",e.errorsCount=0,e.Log=e._LogEnabled,e.Warn=e._WarnEnabled,e.Error=e._ErrorEnabled,e}()},function(D,w,N){"use strict";N.d(w,"a",(function(){return H}));var F=N(6),k=N(2),j=N(38),z=N(7),G=N(116),H=function(){function e(D,w,N,k,z,H,X,q,Z,J){var $,te,ie=this;if(void 0===k&&(k=null),void 0===H&&(H=null),void 0===X&&(X=null),void 0===q&&(q=null),void 0===Z&&(Z=null),this.name=null,this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new F.c,this.onErrorObservable=new F.c,this._onBindObservable=null,this._wasPreviouslyReady=!1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._pipelineContext=null,this._valueCache={},this.name=D,w.attributes){var oe=w;if(this._engine=N,this._attributesNames=oe.attributes,this._uniformsNames=oe.uniformsNames.concat(oe.samplers),this._samplerList=oe.samplers.slice(),this.defines=oe.defines,this.onError=oe.onError,this.onCompiled=oe.onCompiled,this._fallbacks=oe.fallbacks,this._indexParameters=oe.indexParameters,this._transformFeedbackVaryings=oe.transformFeedbackVaryings||null,oe.uniformBuffersNames)for(var ce=0;ce<oe.uniformBuffersNames.length;ce++)this._uniformBuffersNames[oe.uniformBuffersNames[ce]]=ce}else this._engine=z,this.defines=null==H?"":H,this._uniformsNames=N.concat(k),this._samplerList=k?k.slice():[],this._attributesNames=w,this.onError=Z,this.onCompiled=q,this._indexParameters=J,this._fallbacks=X;this._attributeLocationByName={},this.uniqueId=e._uniqueIdSeed++;var he=j.a.IsWindowObjectExist()?this._engine.getHostDocument():null;D.vertexSource?$="source:"+D.vertexSource:D.vertexElement?($=he?he.getElementById(D.vertexElement):null)||($=D.vertexElement):$=D.vertex||D,D.fragmentSource?te="source:"+D.fragmentSource:D.fragmentElement?(te=he?he.getElementById(D.fragmentElement):null)||(te=D.fragmentElement):te=D.fragment||D;var fe={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:this._engine._shaderProcessor,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:e.ShadersRepository,includesShadersStore:e.IncludesShadersStore,version:(100*this._engine.webGLVersion).toString(),platformName:this._engine.webGLVersion>=2?"WEBGL2":"WEBGL1"};this._loadShader($,"Vertex","",(function(w){ie._loadShader(te,"Fragment","Pixel",(function(N){G.a.Process(w,fe,(function(w){fe.isFragment=!0,G.a.Process(N,fe,(function(N){ie._useFinalCode(w,N,D)}))}))}))}))}return Object.defineProperty(e.prototype,"onBindObservable",{get:function(){return this._onBindObservable||(this._onBindObservable=new F.c),this._onBindObservable},enumerable:!0,configurable:!0}),e.prototype._useFinalCode=function(D,w,N){if(N){var F=N.vertexElement||N.vertex||N.spectorName||N,k=N.fragmentElement||N.fragment||N.spectorName||N;this._vertexSourceCode="#define SHADER_NAME vertex:"+F+"\n"+D,this._fragmentSourceCode="#define SHADER_NAME fragment:"+k+"\n"+w}else this._vertexSourceCode=D,this._fragmentSourceCode=w;this._prepareEffect()},Object.defineProperty(e.prototype,"key",{get:function(){return this._key},enumerable:!0,configurable:!0}),e.prototype.isReady=function(){try{return this._isReadyInternal()}catch(D){return!1}},e.prototype._isReadyInternal=function(){return!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady},e.prototype.getEngine=function(){return this._engine},e.prototype.getPipelineContext=function(){return this._pipelineContext},e.prototype.getAttributesNames=function(){return this._attributesNames},e.prototype.getAttributeLocation=function(D){return this._attributes[D]},e.prototype.getAttributeLocationByName=function(D){return this._attributeLocationByName[D]},e.prototype.getAttributesCount=function(){return this._attributes.length},e.prototype.getUniformIndex=function(D){return this._uniformsNames.indexOf(D)},e.prototype.getUniform=function(D){return this._uniforms[D]},e.prototype.getSamplers=function(){return this._samplerList},e.prototype.getCompilationError=function(){return this._compilationError},e.prototype.allFallbacksProcessed=function(){return this._allFallbacksProcessed},e.prototype.executeWhenCompiled=function(D){var w=this;this.isReady()?D(this):(this.onCompileObservable.add((function(w){D(w)})),this._pipelineContext&&!this._pipelineContext.isAsync||setTimeout((function(){w._checkIsReady(null)}),16))},e.prototype._checkIsReady=function(D){var w=this;try{if(this._isReadyInternal())return}catch(w){return void this._processCompilationErrors(w,D)}setTimeout((function(){w._checkIsReady(D)}),16)},e.prototype._loadShader=function(D,w,N,F){var k;"undefined"!=typeof HTMLElement&&D instanceof HTMLElement?F(j.a.GetDOMTextContent(D)):"source:"!==D.substr(0,7)?"base64:"!==D.substr(0,7)?e.ShadersStore[D+w+"Shader"]?F(e.ShadersStore[D+w+"Shader"]):N&&e.ShadersStore[D+N+"Shader"]?F(e.ShadersStore[D+N+"Shader"]):(k="."===D[0]||"/"===D[0]||D.indexOf("http")>-1?D:e.ShadersRepository+D,this._engine._loadFile(k+"."+w.toLowerCase()+".fx",F)):F(window.atob(D.substr(7))):F(D.substr(7))},e.prototype._rebuildProgram=function(D,w,N,F){var j=this;this._isReady=!1,this._vertexSourceCodeOverride=D,this._fragmentSourceCodeOverride=w,this.onError=function(D,w){F&&F(w)},this.onCompiled=function(){var D=j.getEngine().scenes;if(D)for(var w=0;w<D.length;w++)D[w].markAllMaterialsAsDirty(k.a.MATERIAL_AllDirtyFlag);j._pipelineContext._handlesSpectorRebuildCallback(N)},this._fallbacks=null,this._prepareEffect()},e.prototype._prepareEffect=function(){var D=this,w=this._attributesNames,N=this.defines;this._valueCache={};var F=this._pipelineContext;try{var k=this._engine;this._pipelineContext=k.createPipelineContext();var j=this._rebuildProgram.bind(this);this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?k._preparePipelineContext(this._pipelineContext,this._vertexSourceCodeOverride,this._fragmentSourceCodeOverride,!0,j,null,this._transformFeedbackVaryings):k._preparePipelineContext(this._pipelineContext,this._vertexSourceCode,this._fragmentSourceCode,!1,j,N,this._transformFeedbackVaryings),k._executeWhenRenderingStateIsCompiled(this._pipelineContext,(function(){if(k.supportsUniformBuffers)for(var N in D._uniformBuffersNames)D.bindUniformBlock(N,D._uniformBuffersNames[N]);var j;if(k.getUniforms(D._pipelineContext,D._uniformsNames).forEach((function(w,N){D._uniforms[D._uniformsNames[N]]=w})),D._attributes=k.getAttributes(D._pipelineContext,w),w)for(var z=0;z<w.length;z++){var G=w[z];D._attributeLocationByName[G]=D._attributes[z]}for(j=0;j<D._samplerList.length;j++)null==D.getUniform(D._samplerList[j])&&(D._samplerList.splice(j,1),j--);D._samplerList.forEach((function(w,N){D._samplers[w]=N})),k.bindSamplers(D),D._compilationError="",D._isReady=!0,D.onCompiled&&D.onCompiled(D),D.onCompileObservable.notifyObservers(D),D.onCompileObservable.clear(),D._fallbacks&&D._fallbacks.unBindMesh(),F&&D.getEngine()._deletePipelineContext(F)})),this._pipelineContext.isAsync&&this._checkIsReady(F)}catch(D){this._processCompilationErrors(D,F)}},e.prototype._processCompilationErrors=function(D,w){void 0===w&&(w=null),this._compilationError=D.message;var N=this._attributesNames,F=this._fallbacks;z.a.Error("Unable to compile effect:"),z.a.Error("Uniforms: "+this._uniformsNames.map((function(D){return" "+D}))),z.a.Error("Attributes: "+N.map((function(D){return" "+D}))),z.a.Error("Defines:\r\n"+this.defines),z.a.Error("Error: "+this._compilationError),w&&(this._pipelineContext=w,this._isReady=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this)),F?(this._pipelineContext=null,F.hasMoreFallbacks?(this._allFallbacksProcessed=!1,z.a.Error("Trying next fallback."),this.defines=F.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):this._allFallbacksProcessed=!0},Object.defineProperty(e.prototype,"isSupported",{get:function(){return""===this._compilationError},enumerable:!0,configurable:!0}),e.prototype._bindTexture=function(D,w){this._engine._bindTexture(this._samplers[D],w)},e.prototype.setTexture=function(D,w){this._engine.setTexture(this._samplers[D],this._uniforms[D],w)},e.prototype.setDepthStencilTexture=function(D,w){this._engine.setDepthStencilTexture(this._samplers[D],this._uniforms[D],w)},e.prototype.setTextureArray=function(D,w){var N=D+"Ex";if(-1===this._samplerList.indexOf(N+"0")){for(var F=this._samplerList.indexOf(D),k=1;k<w.length;k++){var j=N+(k-1).toString();this._samplerList.splice(F+k,0,j)}for(var z=0,G=0,H=this._samplerList;G<H.length;G++){var X=H[G];this._samplers[X]=z,z+=1}}this._engine.setTextureArray(this._samplers[D],this._uniforms[D],w)},e.prototype.setTextureFromPostProcess=function(D,w){this._engine.setTextureFromPostProcess(this._samplers[D],w)},e.prototype.setTextureFromPostProcessOutput=function(D,w){this._engine.setTextureFromPostProcessOutput(this._samplers[D],w)},e.prototype._cacheMatrix=function(D,w){var N=this._valueCache[D],F=w.updateFlag;return(void 0===N||N!==F)&&(this._valueCache[D]=F,!0)},e.prototype._cacheFloat2=function(D,w,N){var F=this._valueCache[D];if(!F||2!==F.length)return F=[w,N],this._valueCache[D]=F,!0;var k=!1;return F[0]!==w&&(F[0]=w,k=!0),F[1]!==N&&(F[1]=N,k=!0),k},e.prototype._cacheFloat3=function(D,w,N,F){var k=this._valueCache[D];if(!k||3!==k.length)return k=[w,N,F],this._valueCache[D]=k,!0;var j=!1;return k[0]!==w&&(k[0]=w,j=!0),k[1]!==N&&(k[1]=N,j=!0),k[2]!==F&&(k[2]=F,j=!0),j},e.prototype._cacheFloat4=function(D,w,N,F,k){var j=this._valueCache[D];if(!j||4!==j.length)return j=[w,N,F,k],this._valueCache[D]=j,!0;var z=!1;return j[0]!==w&&(j[0]=w,z=!0),j[1]!==N&&(j[1]=N,z=!0),j[2]!==F&&(j[2]=F,z=!0),j[3]!==k&&(j[3]=k,z=!0),z},e.prototype.bindUniformBuffer=function(D,w){var N=this._uniformBuffersNames[w];void 0!==N&&e._baseCache[N]!==D&&(e._baseCache[N]=D,this._engine.bindUniformBufferBase(D,N))},e.prototype.bindUniformBlock=function(D,w){this._engine.bindUniformBlock(this._pipelineContext,D,w)},e.prototype.setInt=function(D,w){var N=this._valueCache[D];return void 0!==N&&N===w||(this._valueCache[D]=w,this._engine.setInt(this._uniforms[D],w)),this},e.prototype.setIntArray=function(D,w){return this._valueCache[D]=null,this._engine.setIntArray(this._uniforms[D],w),this},e.prototype.setIntArray2=function(D,w){return this._valueCache[D]=null,this._engine.setIntArray2(this._uniforms[D],w),this},e.prototype.setIntArray3=function(D,w){return this._valueCache[D]=null,this._engine.setIntArray3(this._uniforms[D],w),this},e.prototype.setIntArray4=function(D,w){return this._valueCache[D]=null,this._engine.setIntArray4(this._uniforms[D],w),this},e.prototype.setFloatArray=function(D,w){return this._valueCache[D]=null,this._engine.setArray(this._uniforms[D],w),this},e.prototype.setFloatArray2=function(D,w){return this._valueCache[D]=null,this._engine.setArray2(this._uniforms[D],w),this},e.prototype.setFloatArray3=function(D,w){return this._valueCache[D]=null,this._engine.setArray3(this._uniforms[D],w),this},e.prototype.setFloatArray4=function(D,w){return this._valueCache[D]=null,this._engine.setArray4(this._uniforms[D],w),this},e.prototype.setArray=function(D,w){return this._valueCache[D]=null,this._engine.setArray(this._uniforms[D],w),this},e.prototype.setArray2=function(D,w){return this._valueCache[D]=null,this._engine.setArray2(this._uniforms[D],w),this},e.prototype.setArray3=function(D,w){return this._valueCache[D]=null,this._engine.setArray3(this._uniforms[D],w),this},e.prototype.setArray4=function(D,w){return this._valueCache[D]=null,this._engine.setArray4(this._uniforms[D],w),this},e.prototype.setMatrices=function(D,w){return w?(this._valueCache[D]=null,this._engine.setMatrices(this._uniforms[D],w),this):this},e.prototype.setMatrix=function(D,w){return this._cacheMatrix(D,w)&&this._engine.setMatrices(this._uniforms[D],w.toArray()),this},e.prototype.setMatrix3x3=function(D,w){return this._valueCache[D]=null,this._engine.setMatrix3x3(this._uniforms[D],w),this},e.prototype.setMatrix2x2=function(D,w){return this._valueCache[D]=null,this._engine.setMatrix2x2(this._uniforms[D],w),this},e.prototype.setFloat=function(D,w){var N=this._valueCache[D];return void 0!==N&&N===w||(this._valueCache[D]=w,this._engine.setFloat(this._uniforms[D],w)),this},e.prototype.setBool=function(D,w){var N=this._valueCache[D];return void 0!==N&&N===w||(this._valueCache[D]=w,this._engine.setInt(this._uniforms[D],w?1:0)),this},e.prototype.setVector2=function(D,w){return this._cacheFloat2(D,w.x,w.y)&&this._engine.setFloat2(this._uniforms[D],w.x,w.y),this},e.prototype.setFloat2=function(D,w,N){return this._cacheFloat2(D,w,N)&&this._engine.setFloat2(this._uniforms[D],w,N),this},e.prototype.setVector3=function(D,w){return this._cacheFloat3(D,w.x,w.y,w.z)&&this._engine.setFloat3(this._uniforms[D],w.x,w.y,w.z),this},e.prototype.setFloat3=function(D,w,N,F){return this._cacheFloat3(D,w,N,F)&&this._engine.setFloat3(this._uniforms[D],w,N,F),this},e.prototype.setVector4=function(D,w){return this._cacheFloat4(D,w.x,w.y,w.z,w.w)&&this._engine.setFloat4(this._uniforms[D],w.x,w.y,w.z,w.w),this},e.prototype.setFloat4=function(D,w,N,F,k){return this._cacheFloat4(D,w,N,F,k)&&this._engine.setFloat4(this._uniforms[D],w,N,F,k),this},e.prototype.setColor3=function(D,w){return this._cacheFloat3(D,w.r,w.g,w.b)&&this._engine.setFloat3(this._uniforms[D],w.r,w.g,w.b),this},e.prototype.setColor4=function(D,w,N){return this._cacheFloat4(D,w.r,w.g,w.b,N)&&this._engine.setFloat4(this._uniforms[D],w.r,w.g,w.b,N),this},e.prototype.setDirectColor4=function(D,w){return this._cacheFloat4(D,w.r,w.g,w.b,w.a)&&this._engine.setFloat4(this._uniforms[D],w.r,w.g,w.b,w.a),this},e.prototype.dispose=function(){this._engine._releaseEffect(this)},e.RegisterShader=function(D,w,N){w&&(e.ShadersStore[D+"PixelShader"]=w),N&&(e.ShadersStore[D+"VertexShader"]=N)},e.ResetCache=function(){e._baseCache={}},e.ShadersRepository="src/Shaders/",e._uniqueIdSeed=0,e._baseCache={},e.ShadersStore={},e.IncludesShadersStore={},e}()},function(D,w,N){"use strict";N.d(w,"a",(function(){return ie}));var F=N(1),k=N(3),j=N(6),z=N(0),G=N(49),H=N(2),X=N(12),q=N(19),Z=N(115),J=N(112),$=N(60),te=N(36),ie=function(D){function t(w,N,F,k,z,G,X,q,J,$,te){void 0===F&&(F=!1),void 0===k&&(k=!0),void 0===z&&(z=t.TRILINEAR_SAMPLINGMODE),void 0===G&&(G=null),void 0===X&&(X=null),void 0===q&&(q=null),void 0===J&&(J=!1);var ie=D.call(this,N&&"Scene"===N.getClassName()?N:null)||this;ie.url=null,ie.uOffset=0,ie.vOffset=0,ie.uScale=1,ie.vScale=1,ie.uAng=0,ie.vAng=0,ie.wAng=0,ie.uRotationCenter=.5,ie.vRotationCenter=.5,ie.wRotationCenter=.5,ie.inspectableCustomProperties=null,ie._noMipmap=!1,ie._invertY=!1,ie._rowGenerationMatrix=null,ie._cachedTextureMatrix=null,ie._projectionModeMatrix=null,ie._t0=null,ie._t1=null,ie._t2=null,ie._cachedUOffset=-1,ie._cachedVOffset=-1,ie._cachedUScale=0,ie._cachedVScale=0,ie._cachedUAng=-1,ie._cachedVAng=-1,ie._cachedWAng=-1,ie._cachedProjectionMatrixId=-1,ie._cachedCoordinatesMode=-1,ie._initialSamplingMode=t.BILINEAR_SAMPLINGMODE,ie._buffer=null,ie._deleteBuffer=!1,ie._format=null,ie._delayedOnLoad=null,ie._delayedOnError=null,ie.onLoadObservable=new j.c,ie._isBlocking=!0,ie.name=w||"",ie.url=w,ie._noMipmap=F,ie._invertY=k,ie._initialSamplingMode=z,ie._buffer=q,ie._deleteBuffer=J,ie._mimeType=te,$&&(ie._format=$);var oe=ie.getScene(),ce=N&&N.getCaps?N:oe?oe.getEngine():null;if(!ce)return ie;ce.onBeforeTextureInitObservable.notifyObservers(ie);var y=function(){ie._texture&&(ie._texture._invertVScale&&(ie.vScale*=-1,ie.vOffset+=1),null!==ie._texture._cachedWrapU&&(ie.wrapU=ie._texture._cachedWrapU,ie._texture._cachedWrapU=null),null!==ie._texture._cachedWrapV&&(ie.wrapV=ie._texture._cachedWrapV,ie._texture._cachedWrapV=null),null!==ie._texture._cachedWrapR&&(ie.wrapR=ie._texture._cachedWrapR,ie._texture._cachedWrapR=null)),ie.onLoadObservable.hasObservers()&&ie.onLoadObservable.notifyObservers(ie),G&&G(),!ie.isBlocking&&oe&&oe.resetCachedMaterial()};return ie.url?(ie._texture=ie._getFromCache(ie.url,F,z,k),ie._texture?ie._texture.isReady?Z.a.SetImmediate((function(){return y()})):ie._texture.onLoadedObservable.add(y):oe&&oe.useDelayedTextureLoading?(ie.delayLoadState=H.a.DELAYLOADSTATE_NOTLOADED,ie._delayedOnLoad=y,ie._delayedOnError=X):(ie._texture=ce.createTexture(ie.url,F,k,oe,z,y,X,ie._buffer,void 0,ie._format,null,te),J&&delete ie._buffer),ie):(ie._delayedOnLoad=y,ie._delayedOnError=X,ie)}return Object(F.d)(t,D),Object.defineProperty(t.prototype,"noMipmap",{get:function(){return this._noMipmap},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isBlocking",{get:function(){return this._isBlocking},set:function(D){this._isBlocking=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"samplingMode",{get:function(){return this._texture?this._texture.samplingMode:this._initialSamplingMode},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"invertY",{get:function(){return this._invertY},enumerable:!0,configurable:!0}),t.prototype.updateURL=function(D,w,N){void 0===w&&(w=null),this.url&&(this.releaseInternalTexture(),this.getScene().markAllMaterialsAsDirty(H.a.MATERIAL_TextureDirtyFlag)),this.name&&!te.a.StartsWith(this.name,"data:")||(this.name=D),this.url=D,this._buffer=w,this.delayLoadState=H.a.DELAYLOADSTATE_NOTLOADED,N&&(this._delayedOnLoad=N),this.delayLoad()},t.prototype.delayLoad=function(){if(this.delayLoadState===H.a.DELAYLOADSTATE_NOTLOADED){var D=this.getScene();D&&(this.delayLoadState=H.a.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY),this._texture?this._delayedOnLoad&&(this._texture.isReady?Z.a.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=D.getEngine().createTexture(this.url,this._noMipmap,this._invertY,D,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,null,this._mimeType),this._deleteBuffer&&delete this._buffer),this._delayedOnLoad=null,this._delayedOnError=null)}},t.prototype._prepareRowForTextureGeneration=function(D,w,N,F){D*=this._cachedUScale,w*=this._cachedVScale,D-=this.uRotationCenter*this._cachedUScale,w-=this.vRotationCenter*this._cachedVScale,N-=this.wRotationCenter,z.e.TransformCoordinatesFromFloatsToRef(D,w,N,this._rowGenerationMatrix,F),F.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,F.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,F.z+=this.wRotationCenter},t.prototype.getTextureMatrix=function(D){var w=this;if(void 0===D&&(D=1),this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*D===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*D,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedTextureMatrix||(this._cachedTextureMatrix=z.a.Zero(),this._rowGenerationMatrix=new z.a,this._t0=z.e.Zero(),this._t1=z.e.Zero(),this._t2=z.e.Zero()),z.a.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.subtractInPlace(this._t0),this._t2.subtractInPlace(this._t0),z.a.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix);var N=this.getScene();return N?(N.markAllMaterialsAsDirty(H.a.MATERIAL_TextureDirtyFlag,(function(D){return D.hasTexture(w)})),this._cachedTextureMatrix):this._cachedTextureMatrix},t.prototype.getReflectionTextureMatrix=function(){var D=this,w=this.getScene();if(!w)return this._cachedTextureMatrix;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale===this._cachedUScale&&this.vScale===this._cachedVScale&&this.coordinatesMode===this._cachedCoordinatesMode){if(this.coordinatesMode!==t.PROJECTION_MODE)return this._cachedTextureMatrix;if(this._cachedProjectionMatrixId===w.getProjectionMatrix().updateFlag)return this._cachedTextureMatrix}switch(this._cachedTextureMatrix||(this._cachedTextureMatrix=z.a.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=z.a.Zero()),this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale,this._cachedVScale=this.vScale,this._cachedCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case t.PLANAR_MODE:z.a.IdentityToRef(this._cachedTextureMatrix),this._cachedTextureMatrix[0]=this.uScale,this._cachedTextureMatrix[5]=this.vScale,this._cachedTextureMatrix[12]=this.uOffset,this._cachedTextureMatrix[13]=this.vOffset;break;case t.PROJECTION_MODE:z.a.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);var N=w.getProjectionMatrix();this._cachedProjectionMatrixId=N.updateFlag,N.multiplyToRef(this._projectionModeMatrix,this._cachedTextureMatrix);break;default:z.a.IdentityToRef(this._cachedTextureMatrix)}return w.markAllMaterialsAsDirty(H.a.MATERIAL_TextureDirtyFlag,(function(w){return-1!==w.getActiveTextures().indexOf(D)})),this._cachedTextureMatrix},t.prototype.clone=function(){var D=this;return k.a.Clone((function(){return new t(D._texture?D._texture.url:null,D.getScene(),D._noMipmap,D._invertY,D.samplingMode,void 0,void 0,D._texture?D._texture._buffer:void 0)}),this)},t.prototype.serialize=function(){var w=this.name;t.SerializeBuffers||te.a.StartsWith(this.name,"data:")&&(this.name="");var N=D.prototype.serialize.call(this);return N?(t.SerializeBuffers&&("string"==typeof this._buffer&&"data:"===this._buffer.substr(0,5)?(N.base64String=this._buffer,N.name=N.name.replace("data:","")):this.url&&te.a.StartsWith(this.url,"data:")&&this._buffer instanceof Uint8Array&&(N.base64String="data:image/png;base64,"+te.a.EncodeArrayBufferToBase64(this._buffer))),N.invertY=this._invertY,N.samplingMode=this.samplingMode,this.name=w,N):null},t.prototype.getClassName=function(){return"Texture"},t.prototype.dispose=function(){D.prototype.dispose.call(this),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null},t.Parse=function(D,w,N){if(D.customType){var F=J.a.Instantiate(D.customType).Parse(D,w,N);return D.samplingMode&&F.updateSamplingMode&&F._samplingMode&&F._samplingMode!==D.samplingMode&&F.updateSamplingMode(D.samplingMode),F}if(D.isCube&&!D.isRenderTarget)return t._CubeTextureParser(D,w,N);if(!D.name&&!D.isRenderTarget)return null;var j=k.a.Parse((function(){var F,k=!0;if(D.noMipmap&&(k=!1),D.mirrorPlane){var j=t._CreateMirror(D.name,D.renderTargetSize,w,k);return j._waitingRenderList=D.renderList,j.mirrorPlane=$.a.FromArray(D.mirrorPlane),j}if(D.isRenderTarget){var z=null;if(D.isCube){if(w.reflectionProbes)for(var G=0;G<w.reflectionProbes.length;G++){var H=w.reflectionProbes[G];if(H.name===D.name)return H.cubeTexture}}else(z=t._CreateRenderTargetTexture(D.name,D.renderTargetSize,w,k))._waitingRenderList=D.renderList;return z}if(D.base64String)F=t.CreateFromBase64String(D.base64String,D.name,w,!k,D.invertY);else{var X=N+D.name;t.UseSerializedUrlIfAny&&D.url&&(X=D.url),F=new t(X,w,!k,D.invertY)}return F}),D,w);if(j&&j._texture&&(j._texture._cachedWrapU=null,j._texture._cachedWrapV=null,j._texture._cachedWrapR=null),D.samplingMode){var z=D.samplingMode;j&&j.samplingMode!==z&&j.updateSamplingMode(z)}if(j&&D.animations)for(var G=0;G<D.animations.length;G++){var H=D.animations[G],q=X.a.GetClass("BABYLON.Animation");q&&j.animations.push(q.Parse(H))}return j},t.CreateFromBase64String=function(D,w,N,F,k,j,z,G,X){return void 0===j&&(j=t.TRILINEAR_SAMPLINGMODE),void 0===z&&(z=null),void 0===G&&(G=null),void 0===X&&(X=H.a.TEXTUREFORMAT_RGBA),new t("data:"+w,N,F,k,j,z,G,D,!1,X)},t.LoadFromDataString=function(D,w,N,F,k,j,z,G,X,q){return void 0===F&&(F=!1),void 0===k&&(k=!1),void 0===j&&(j=!0),void 0===z&&(z=t.TRILINEAR_SAMPLINGMODE),void 0===G&&(G=null),void 0===X&&(X=null),void 0===q&&(q=H.a.TEXTUREFORMAT_RGBA),"data:"!==D.substr(0,5)&&(D="data:"+D),new t(D,N,k,j,z,G,X,w,F,q)},t.SerializeBuffers=!0,t._CubeTextureParser=function(D,w,N){throw q.a.WarnImport("CubeTexture")},t._CreateMirror=function(D,w,N,F){throw q.a.WarnImport("MirrorTexture")},t._CreateRenderTargetTexture=function(D,w,N,F){throw q.a.WarnImport("RenderTargetTexture")},t.NEAREST_SAMPLINGMODE=H.a.TEXTURE_NEAREST_SAMPLINGMODE,t.NEAREST_NEAREST_MIPLINEAR=H.a.TEXTURE_NEAREST_NEAREST_MIPLINEAR,t.BILINEAR_SAMPLINGMODE=H.a.TEXTURE_BILINEAR_SAMPLINGMODE,t.LINEAR_LINEAR_MIPNEAREST=H.a.TEXTURE_LINEAR_LINEAR_MIPNEAREST,t.TRILINEAR_SAMPLINGMODE=H.a.TEXTURE_TRILINEAR_SAMPLINGMODE,t.LINEAR_LINEAR_MIPLINEAR=H.a.TEXTURE_LINEAR_LINEAR_MIPLINEAR,t.NEAREST_NEAREST_MIPNEAREST=H.a.TEXTURE_NEAREST_NEAREST_MIPNEAREST,t.NEAREST_LINEAR_MIPNEAREST=H.a.TEXTURE_NEAREST_LINEAR_MIPNEAREST,t.NEAREST_LINEAR_MIPLINEAR=H.a.TEXTURE_NEAREST_LINEAR_MIPLINEAR,t.NEAREST_LINEAR=H.a.TEXTURE_NEAREST_LINEAR,t.NEAREST_NEAREST=H.a.TEXTURE_NEAREST_NEAREST,t.LINEAR_NEAREST_MIPNEAREST=H.a.TEXTURE_LINEAR_NEAREST_MIPNEAREST,t.LINEAR_NEAREST_MIPLINEAR=H.a.TEXTURE_LINEAR_NEAREST_MIPLINEAR,t.LINEAR_LINEAR=H.a.TEXTURE_LINEAR_LINEAR,t.LINEAR_NEAREST=H.a.TEXTURE_LINEAR_NEAREST,t.EXPLICIT_MODE=H.a.TEXTURE_EXPLICIT_MODE,t.SPHERICAL_MODE=H.a.TEXTURE_SPHERICAL_MODE,t.PLANAR_MODE=H.a.TEXTURE_PLANAR_MODE,t.CUBIC_MODE=H.a.TEXTURE_CUBIC_MODE,t.PROJECTION_MODE=H.a.TEXTURE_PROJECTION_MODE,t.SKYBOX_MODE=H.a.TEXTURE_SKYBOX_MODE,t.INVCUBIC_MODE=H.a.TEXTURE_INVCUBIC_MODE,t.EQUIRECTANGULAR_MODE=H.a.TEXTURE_EQUIRECTANGULAR_MODE,t.FIXED_EQUIRECTANGULAR_MODE=H.a.TEXTURE_FIXED_EQUIRECTANGULAR_MODE,t.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=H.a.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE,t.CLAMP_ADDRESSMODE=H.a.TEXTURE_CLAMP_ADDRESSMODE,t.WRAP_ADDRESSMODE=H.a.TEXTURE_WRAP_ADDRESSMODE,t.MIRROR_ADDRESSMODE=H.a.TEXTURE_MIRROR_ADDRESSMODE,t.UseSerializedUrlIfAny=!1,Object(F.c)([Object(k.c)()],t.prototype,"url",void 0),Object(F.c)([Object(k.c)()],t.prototype,"uOffset",void 0),Object(F.c)([Object(k.c)()],t.prototype,"vOffset",void 0),Object(F.c)([Object(k.c)()],t.prototype,"uScale",void 0),Object(F.c)([Object(k.c)()],t.prototype,"vScale",void 0),Object(F.c)([Object(k.c)()],t.prototype,"uAng",void 0),Object(F.c)([Object(k.c)()],t.prototype,"vAng",void 0),Object(F.c)([Object(k.c)()],t.prototype,"wAng",void 0),Object(F.c)([Object(k.c)()],t.prototype,"uRotationCenter",void 0),Object(F.c)([Object(k.c)()],t.prototype,"vRotationCenter",void 0),Object(F.c)([Object(k.c)()],t.prototype,"wRotationCenter",void 0),Object(F.c)([Object(k.c)()],t.prototype,"isBlocking",null),t}(G.a);k.a._TextureParser=ie.Parse},function(D,w,N){"use strict";N.d(w,"a",(function(){return G})),N.d(w,"b",(function(){return H})),N.d(w,"c",(function(){return X}));var F=N(14),k=N(28),j=N(42),z=N(12),G=function(){function e(D,w,N){void 0===D&&(D=0),void 0===w&&(w=0),void 0===N&&(N=0),this.r=D,this.g=w,this.b=N}return e.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"},e.prototype.getClassName=function(){return"Color3"},e.prototype.getHashCode=function(){var D=255*this.r|0;return 397*(D=397*D^(255*this.g|0))^(255*this.b|0)},e.prototype.toArray=function(D,w){return void 0===w&&(w=0),D[w]=this.r,D[w+1]=this.g,D[w+2]=this.b,this},e.prototype.toColor4=function(D){return void 0===D&&(D=1),new H(this.r,this.g,this.b,D)},e.prototype.asArray=function(){var D=new Array;return this.toArray(D,0),D},e.prototype.toLuminance=function(){return.3*this.r+.59*this.g+.11*this.b},e.prototype.multiply=function(D){return new e(this.r*D.r,this.g*D.g,this.b*D.b)},e.prototype.multiplyToRef=function(D,w){return w.r=this.r*D.r,w.g=this.g*D.g,w.b=this.b*D.b,this},e.prototype.equals=function(D){return D&&this.r===D.r&&this.g===D.g&&this.b===D.b},e.prototype.equalsFloats=function(D,w,N){return this.r===D&&this.g===w&&this.b===N},e.prototype.scale=function(D){return new e(this.r*D,this.g*D,this.b*D)},e.prototype.scaleToRef=function(D,w){return w.r=this.r*D,w.g=this.g*D,w.b=this.b*D,this},e.prototype.scaleAndAddToRef=function(D,w){return w.r+=this.r*D,w.g+=this.g*D,w.b+=this.b*D,this},e.prototype.clampToRef=function(D,w,N){return void 0===D&&(D=0),void 0===w&&(w=1),N.r=F.a.Clamp(this.r,D,w),N.g=F.a.Clamp(this.g,D,w),N.b=F.a.Clamp(this.b,D,w),this},e.prototype.add=function(D){return new e(this.r+D.r,this.g+D.g,this.b+D.b)},e.prototype.addToRef=function(D,w){return w.r=this.r+D.r,w.g=this.g+D.g,w.b=this.b+D.b,this},e.prototype.subtract=function(D){return new e(this.r-D.r,this.g-D.g,this.b-D.b)},e.prototype.subtractToRef=function(D,w){return w.r=this.r-D.r,w.g=this.g-D.g,w.b=this.b-D.b,this},e.prototype.clone=function(){return new e(this.r,this.g,this.b)},e.prototype.copyFrom=function(D){return this.r=D.r,this.g=D.g,this.b=D.b,this},e.prototype.copyFromFloats=function(D,w,N){return this.r=D,this.g=w,this.b=N,this},e.prototype.set=function(D,w,N){return this.copyFromFloats(D,w,N)},e.prototype.toHexString=function(){var D=255*this.r|0,w=255*this.g|0,N=255*this.b|0;return"#"+F.a.ToHex(D)+F.a.ToHex(w)+F.a.ToHex(N)},e.prototype.toLinearSpace=function(){var D=new e;return this.toLinearSpaceToRef(D),D},e.prototype.toHSV=function(){var D=new e;return this.toHSVToRef(D),D},e.prototype.toHSVToRef=function(D){var w=this.r,N=this.g,F=this.b,k=Math.max(w,N,F),j=Math.min(w,N,F),z=0,G=0,H=k,X=k-j;0!==k&&(G=X/k),k!=j&&(k==w?(z=(N-F)/X,N<F&&(z+=6)):k==N?z=(F-w)/X+2:k==F&&(z=(w-N)/X+4),z*=60),D.r=z,D.g=G,D.b=H},e.prototype.toLinearSpaceToRef=function(D){return D.r=Math.pow(this.r,k.c),D.g=Math.pow(this.g,k.c),D.b=Math.pow(this.b,k.c),this},e.prototype.toGammaSpace=function(){var D=new e;return this.toGammaSpaceToRef(D),D},e.prototype.toGammaSpaceToRef=function(D){return D.r=Math.pow(this.r,k.b),D.g=Math.pow(this.g,k.b),D.b=Math.pow(this.b,k.b),this},e.HSVtoRGBToRef=function(D,w,N,F){var k=N*w,j=D/60,z=k*(1-Math.abs(j%2-1)),G=0,H=0,X=0;j>=0&&j<=1?(G=k,H=z):j>=1&&j<=2?(G=z,H=k):j>=2&&j<=3?(H=k,X=z):j>=3&&j<=4?(H=z,X=k):j>=4&&j<=5?(G=z,X=k):j>=5&&j<=6&&(G=k,X=z);var q=N-k;F.set(G+q,H+q,X+q)},e.FromHexString=function(D){if("#"!==D.substring(0,1)||7!==D.length)return new e(0,0,0);var w=parseInt(D.substring(1,3),16),N=parseInt(D.substring(3,5),16),F=parseInt(D.substring(5,7),16);return e.FromInts(w,N,F)},e.FromArray=function(D,w){return void 0===w&&(w=0),new e(D[w],D[w+1],D[w+2])},e.FromInts=function(D,w,N){return new e(D/255,w/255,N/255)},e.Lerp=function(D,w,N){var F=new e(0,0,0);return e.LerpToRef(D,w,N,F),F},e.LerpToRef=function(D,w,N,F){F.r=D.r+(w.r-D.r)*N,F.g=D.g+(w.g-D.g)*N,F.b=D.b+(w.b-D.b)*N},e.Red=function(){return new e(1,0,0)},e.Green=function(){return new e(0,1,0)},e.Blue=function(){return new e(0,0,1)},e.Black=function(){return new e(0,0,0)},Object.defineProperty(e,"BlackReadOnly",{get:function(){return e._BlackReadOnly},enumerable:!0,configurable:!0}),e.White=function(){return new e(1,1,1)},e.Purple=function(){return new e(.5,0,.5)},e.Magenta=function(){return new e(1,0,1)},e.Yellow=function(){return new e(1,1,0)},e.Gray=function(){return new e(.5,.5,.5)},e.Teal=function(){return new e(0,1,1)},e.Random=function(){return new e(Math.random(),Math.random(),Math.random())},e._BlackReadOnly=e.Black(),e}(),H=function(){function e(D,w,N,F){void 0===D&&(D=0),void 0===w&&(w=0),void 0===N&&(N=0),void 0===F&&(F=1),this.r=D,this.g=w,this.b=N,this.a=F}return e.prototype.addInPlace=function(D){return this.r+=D.r,this.g+=D.g,this.b+=D.b,this.a+=D.a,this},e.prototype.asArray=function(){var D=new Array;return this.toArray(D,0),D},e.prototype.toArray=function(D,w){return void 0===w&&(w=0),D[w]=this.r,D[w+1]=this.g,D[w+2]=this.b,D[w+3]=this.a,this},e.prototype.equals=function(D){return D&&this.r===D.r&&this.g===D.g&&this.b===D.b&&this.a===D.a},e.prototype.add=function(D){return new e(this.r+D.r,this.g+D.g,this.b+D.b,this.a+D.a)},e.prototype.subtract=function(D){return new e(this.r-D.r,this.g-D.g,this.b-D.b,this.a-D.a)},e.prototype.subtractToRef=function(D,w){return w.r=this.r-D.r,w.g=this.g-D.g,w.b=this.b-D.b,w.a=this.a-D.a,this},e.prototype.scale=function(D){return new e(this.r*D,this.g*D,this.b*D,this.a*D)},e.prototype.scaleToRef=function(D,w){return w.r=this.r*D,w.g=this.g*D,w.b=this.b*D,w.a=this.a*D,this},e.prototype.scaleAndAddToRef=function(D,w){return w.r+=this.r*D,w.g+=this.g*D,w.b+=this.b*D,w.a+=this.a*D,this},e.prototype.clampToRef=function(D,w,N){return void 0===D&&(D=0),void 0===w&&(w=1),N.r=F.a.Clamp(this.r,D,w),N.g=F.a.Clamp(this.g,D,w),N.b=F.a.Clamp(this.b,D,w),N.a=F.a.Clamp(this.a,D,w),this},e.prototype.multiply=function(D){return new e(this.r*D.r,this.g*D.g,this.b*D.b,this.a*D.a)},e.prototype.multiplyToRef=function(D,w){return w.r=this.r*D.r,w.g=this.g*D.g,w.b=this.b*D.b,w.a=this.a*D.a,w},e.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"},e.prototype.getClassName=function(){return"Color4"},e.prototype.getHashCode=function(){var D=255*this.r|0;return 397*(D=397*(D=397*D^(255*this.g|0))^(255*this.b|0))^(255*this.a|0)},e.prototype.clone=function(){return new e(this.r,this.g,this.b,this.a)},e.prototype.copyFrom=function(D){return this.r=D.r,this.g=D.g,this.b=D.b,this.a=D.a,this},e.prototype.copyFromFloats=function(D,w,N,F){return this.r=D,this.g=w,this.b=N,this.a=F,this},e.prototype.set=function(D,w,N,F){return this.copyFromFloats(D,w,N,F)},e.prototype.toHexString=function(){var D=255*this.r|0,w=255*this.g|0,N=255*this.b|0,k=255*this.a|0;return"#"+F.a.ToHex(D)+F.a.ToHex(w)+F.a.ToHex(N)+F.a.ToHex(k)},e.prototype.toLinearSpace=function(){var D=new e;return this.toLinearSpaceToRef(D),D},e.prototype.toLinearSpaceToRef=function(D){return D.r=Math.pow(this.r,k.c),D.g=Math.pow(this.g,k.c),D.b=Math.pow(this.b,k.c),D.a=this.a,this},e.prototype.toGammaSpace=function(){var D=new e;return this.toGammaSpaceToRef(D),D},e.prototype.toGammaSpaceToRef=function(D){return D.r=Math.pow(this.r,k.b),D.g=Math.pow(this.g,k.b),D.b=Math.pow(this.b,k.b),D.a=this.a,this},e.FromHexString=function(D){if("#"!==D.substring(0,1)||9!==D.length)return new e(0,0,0,0);var w=parseInt(D.substring(1,3),16),N=parseInt(D.substring(3,5),16),F=parseInt(D.substring(5,7),16),k=parseInt(D.substring(7,9),16);return e.FromInts(w,N,F,k)},e.Lerp=function(D,w,N){var F=new e(0,0,0,0);return e.LerpToRef(D,w,N,F),F},e.LerpToRef=function(D,w,N,F){F.r=D.r+(w.r-D.r)*N,F.g=D.g+(w.g-D.g)*N,F.b=D.b+(w.b-D.b)*N,F.a=D.a+(w.a-D.a)*N},e.FromColor3=function(D,w){return void 0===w&&(w=1),new e(D.r,D.g,D.b,w)},e.FromArray=function(D,w){return void 0===w&&(w=0),new e(D[w],D[w+1],D[w+2],D[w+3])},e.FromInts=function(D,w,N,F){return new e(D/255,w/255,N/255,F/255)},e.CheckColors4=function(D,w){if(D.length===3*w){for(var N=[],F=0;F<D.length;F+=3){var k=F/3*4;N[k]=D[F],N[k+1]=D[F+1],N[k+2]=D[F+2],N[k+3]=1}return N}return D},e}(),X=function(){function e(){}return e.Color3=j.a.BuildArray(3,G.Black),e.Color4=j.a.BuildArray(3,(function(){return new H(0,0,0,0)})),e}();z.a.RegisteredTypes["BABYLON.Color3"]=G,z.a.RegisteredTypes["BABYLON.Color4"]=H},function(D,w,N){"use strict";var F=N(1),k=N(6),j=N(38),z=N(23),G=N(19),H=N(31),X=N(2),q=N(132),Z=N(51),J=N(84),$=N(7);H.a.prototype.setAlphaConstants=function(D,w,N,F){this._alphaState.setAlphaBlendConstants(D,w,N,F)},H.a.prototype.setAlphaMode=function(D,w){if(void 0===w&&(w=!1),this._alphaMode!==D){switch(D){case X.a.ALPHA_DISABLE:this._alphaState.alphaBlend=!1;break;case X.a.ALPHA_PREMULTIPLIED:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case X.a.ALPHA_PREMULTIPLIED_PORTERDUFF:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case X.a.ALPHA_COMBINE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case X.a.ALPHA_ONEONE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case X.a.ALPHA_ADD:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case X.a.ALPHA_SUBTRACT:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case X.a.ALPHA_MULTIPLY:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case X.a.ALPHA_MAXIMIZED:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case X.a.ALPHA_INTERPOLATE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case X.a.ALPHA_SCREENMODE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case X.a.ALPHA_ONEONE_ONEONE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case X.a.ALPHA_ALPHATOCOLOR:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case X.a.ALPHA_REVERSEONEMINUS:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case X.a.ALPHA_SRC_DSTONEMINUSSRCALPHA:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case X.a.ALPHA_ONEONE_ONEZERO:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case X.a.ALPHA_EXCLUSION:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0}w||(this.depthCullingState.depthMask=D===X.a.ALPHA_DISABLE),this._alphaMode=D}},H.a.prototype.getAlphaMode=function(){return this._alphaMode},H.a.prototype.setAlphaEquation=function(D){if(this._alphaEquation!==D){switch(D){case X.a.ALPHA_EQUATION_ADD:this._alphaState.setAlphaEquationParameters(this._gl.FUNC_ADD,this._gl.FUNC_ADD);break;case X.a.ALPHA_EQUATION_SUBSTRACT:this._alphaState.setAlphaEquationParameters(this._gl.FUNC_SUBTRACT,this._gl.FUNC_SUBTRACT);break;case X.a.ALPHA_EQUATION_REVERSE_SUBTRACT:this._alphaState.setAlphaEquationParameters(this._gl.FUNC_REVERSE_SUBTRACT,this._gl.FUNC_REVERSE_SUBTRACT);break;case X.a.ALPHA_EQUATION_MAX:this._alphaState.setAlphaEquationParameters(this._gl.MAX,this._gl.MAX);break;case X.a.ALPHA_EQUATION_MIN:this._alphaState.setAlphaEquationParameters(this._gl.MIN,this._gl.MIN);break;case X.a.ALPHA_EQUATION_DARKEN:this._alphaState.setAlphaEquationParameters(this._gl.MIN,this._gl.FUNC_ADD)}this._alphaEquation=D}},H.a.prototype.getAlphaEquation=function(){return this._alphaEquation},N.d(w,"a",(function(){return te}));var te=function(D){function t(w,N,F,z){void 0===z&&(z=!1);var G=D.call(this,w,N,F,z)||this;if(G.enableOfflineSupport=!1,G.disableManifestCheck=!1,G.scenes=new Array,G.onNewSceneAddedObservable=new k.c,G.postProcesses=new Array,G.isPointerLock=!1,G.onResizeObservable=new k.c,G.onCanvasBlurObservable=new k.c,G.onCanvasFocusObservable=new k.c,G.onCanvasPointerOutObservable=new k.c,G.onBeginFrameObservable=new k.c,G.customAnimationFrameRequester=null,G.onEndFrameObservable=new k.c,G.onBeforeShaderCompilationObservable=new k.c,G.onAfterShaderCompilationObservable=new k.c,G._deterministicLockstep=!1,G._lockstepMaxSteps=4,G._timeStep=1/60,G._fps=60,G._deltaTime=0,G._drawCalls=new Z.a,G.canvasTabIndex=1,G.disablePerformanceMonitorInBackground=!1,G._performanceMonitor=new q.a,!w)return G;if(F=G._creationOptions,t.Instances.push(G),w.getContext){var H=w;if(G._onCanvasFocus=function(){G.onCanvasFocusObservable.notifyObservers(G)},G._onCanvasBlur=function(){G.onCanvasBlurObservable.notifyObservers(G)},H.addEventListener("focus",G._onCanvasFocus),H.addEventListener("blur",G._onCanvasBlur),G._onBlur=function(){G.disablePerformanceMonitorInBackground&&G._performanceMonitor.disable(),G._windowIsBackground=!0},G._onFocus=function(){G.disablePerformanceMonitorInBackground&&G._performanceMonitor.enable(),G._windowIsBackground=!1},G._onCanvasPointerOut=function(D){G.onCanvasPointerOutObservable.notifyObservers(D)},H.addEventListener("pointerout",G._onCanvasPointerOut),j.a.IsWindowObjectExist()){var X=G.getHostWindow();X.addEventListener("blur",G._onBlur),X.addEventListener("focus",G._onFocus);var J=document;G._onFullscreenChange=function(){void 0!==J.fullscreen?G.isFullscreen=J.fullscreen:void 0!==J.mozFullScreen?G.isFullscreen=J.mozFullScreen:void 0!==J.webkitIsFullScreen?G.isFullscreen=J.webkitIsFullScreen:void 0!==J.msIsFullScreen&&(G.isFullscreen=J.msIsFullScreen),G.isFullscreen&&G._pointerLockRequested&&H&&t._RequestPointerlock(H)},document.addEventListener("fullscreenchange",G._onFullscreenChange,!1),document.addEventListener("mozfullscreenchange",G._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",G._onFullscreenChange,!1),document.addEventListener("msfullscreenchange",G._onFullscreenChange,!1),G._onPointerLockChange=function(){G.isPointerLock=J.mozPointerLockElement===H||J.webkitPointerLockElement===H||J.msPointerLockElement===H||J.pointerLockElement===H},document.addEventListener("pointerlockchange",G._onPointerLockChange,!1),document.addEventListener("mspointerlockchange",G._onPointerLockChange,!1),document.addEventListener("mozpointerlockchange",G._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",G._onPointerLockChange,!1),!t.audioEngine&&F.audioEngine&&t.AudioEngineFactory&&(t.audioEngine=t.AudioEngineFactory(G.getRenderingCanvas()))}G._connectVREvents(),G.enableOfflineSupport=void 0!==t.OfflineProviderFactory,F.doNotHandleTouchAction||G._disableTouchAction(),G._deterministicLockstep=!!F.deterministicLockstep,G._lockstepMaxSteps=F.lockstepMaxSteps||0,G._timeStep=F.timeStep||1/60}return G._prepareVRComponent(),F.autoEnableWebVR&&G.initWebVR(),G}return Object(F.d)(t,D),Object.defineProperty(t,"NpmPackage",{get:function(){return H.a.NpmPackage},enumerable:!0,configurable:!0}),Object.defineProperty(t,"Version",{get:function(){return H.a.Version},enumerable:!0,configurable:!0}),Object.defineProperty(t,"Instances",{get:function(){return z.a.Instances},enumerable:!0,configurable:!0}),Object.defineProperty(t,"LastCreatedEngine",{get:function(){return z.a.LastCreatedEngine},enumerable:!0,configurable:!0}),Object.defineProperty(t,"LastCreatedScene",{get:function(){return z.a.LastCreatedScene},enumerable:!0,configurable:!0}),t.MarkAllMaterialsAsDirty=function(D,w){for(var N=0;N<t.Instances.length;N++)for(var F=t.Instances[N],k=0;k<F.scenes.length;k++)F.scenes[k].markAllMaterialsAsDirty(D,w)},t.DefaultLoadingScreenFactory=function(D){throw G.a.WarnImport("LoadingScreen")},Object.defineProperty(t.prototype,"_supportsHardwareTextureRescaling",{get:function(){return!!t._RescalePostProcessFactory},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"performanceMonitor",{get:function(){return this._performanceMonitor},enumerable:!0,configurable:!0}),t.prototype.getInputElement=function(){return this._renderingCanvas},t.prototype.getAspectRatio=function(D,w){void 0===w&&(w=!1);var N=D.viewport;return this.getRenderWidth(w)*N.width/(this.getRenderHeight(w)*N.height)},t.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},t.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},t.prototype.getInputElementClientRect=function(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null},t.prototype.isDeterministicLockStep=function(){return this._deterministicLockstep},t.prototype.getLockstepMaxSteps=function(){return this._lockstepMaxSteps},t.prototype.getTimeStep=function(){return 1e3*this._timeStep},t.prototype.generateMipMapsForCubemap=function(D,w){if(void 0===w&&(w=!0),D.generateMipMaps){var N=this._gl;this._bindTextureDirectly(N.TEXTURE_CUBE_MAP,D,!0),N.generateMipmap(N.TEXTURE_CUBE_MAP),w&&this._bindTextureDirectly(N.TEXTURE_CUBE_MAP,null)}},t.prototype.setState=function(D,w,N,F){void 0===w&&(w=0),void 0===F&&(F=!1),(this._depthCullingState.cull!==D||N)&&(this._depthCullingState.cull=D);var k=this.cullBackFaces?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==k||N)&&(this._depthCullingState.cullFace=k),this.setZOffset(w);var j=F?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==j||N)&&(this._depthCullingState.frontFace=j)},t.prototype.setZOffset=function(D){this._depthCullingState.zOffset=D},t.prototype.getZOffset=function(){return this._depthCullingState.zOffset},t.prototype.setDepthBuffer=function(D){this._depthCullingState.depthTest=D},t.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},t.prototype.setDepthWrite=function(D){this._depthCullingState.depthMask=D},t.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},t.prototype.setStencilBuffer=function(D){this._stencilState.stencilTest=D},t.prototype.getStencilMask=function(){return this._stencilState.stencilMask},t.prototype.setStencilMask=function(D){this._stencilState.stencilMask=D},t.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},t.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},t.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},t.prototype.setStencilFunction=function(D){this._stencilState.stencilFunc=D},t.prototype.setStencilFunctionReference=function(D){this._stencilState.stencilFuncRef=D},t.prototype.setStencilFunctionMask=function(D){this._stencilState.stencilFuncMask=D},t.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},t.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},t.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},t.prototype.setStencilOperationFail=function(D){this._stencilState.stencilOpStencilFail=D},t.prototype.setStencilOperationDepthFail=function(D){this._stencilState.stencilOpDepthFail=D},t.prototype.setStencilOperationPass=function(D){this._stencilState.stencilOpStencilDepthPass=D},t.prototype.setDitheringState=function(D){D?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)},t.prototype.setRasterizerState=function(D){D?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)},t.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},t.prototype.setDepthFunction=function(D){this._depthCullingState.depthFunc=D},t.prototype.setDepthFunctionToGreater=function(){this._depthCullingState.depthFunc=this._gl.GREATER},t.prototype.setDepthFunctionToGreaterOrEqual=function(){this._depthCullingState.depthFunc=this._gl.GEQUAL},t.prototype.setDepthFunctionToLess=function(){this._depthCullingState.depthFunc=this._gl.LESS},t.prototype.setDepthFunctionToLessOrEqual=function(){this._depthCullingState.depthFunc=this._gl.LEQUAL},t.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()},t.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)},t.prototype.setDirectViewport=function(D,w,N,F){var k=this._cachedViewport;return this._cachedViewport=null,this._viewport(D,w,N,F),k},t.prototype.scissorClear=function(D,w,N,F,k){this.enableScissor(D,w,N,F),this.clear(k,!0,!0,!0),this.disableScissor()},t.prototype.enableScissor=function(D,w,N,F){var k=this._gl;k.enable(k.SCISSOR_TEST),k.scissor(D,w,N,F)},t.prototype.disableScissor=function(){var D=this._gl;D.disable(D.SCISSOR_TEST)},t.prototype._reportDrawCall=function(){this._drawCalls.addCount(1,!1)},t.prototype.initWebVR=function(){throw G.a.WarnImport("WebVRCamera")},t.prototype._prepareVRComponent=function(){},t.prototype._connectVREvents=function(D,w){},t.prototype._submitVRFrame=function(){},t.prototype.disableVR=function(){},t.prototype.isVRPresenting=function(){return!1},t.prototype._requestVRFrame=function(){},t.prototype._loadFileAsync=function(D,w,N){var F=this;return new Promise((function(k,j){F._loadFile(D,(function(D){k(D)}),void 0,w,N,(function(D,w){j(w)}))}))},t.prototype.getVertexShaderSource=function(D){var w=this._gl.getAttachedShaders(D);return w?this._gl.getShaderSource(w[0]):null},t.prototype.getFragmentShaderSource=function(D){var w=this._gl.getAttachedShaders(D);return w?this._gl.getShaderSource(w[1]):null},t.prototype.setDepthStencilTexture=function(D,w,N){void 0!==D&&(w&&(this._boundUniforms[D]=w),N&&N.depthStencilTexture?this._setTexture(D,N,!1,!0):this._setTexture(D,null))},t.prototype.setTextureFromPostProcess=function(D,w){this._bindTexture(D,w?w._textures.data[w._currentRenderTextureInd]:null)},t.prototype.setTextureFromPostProcessOutput=function(D,w){this._bindTexture(D,w?w._outputTexture:null)},t.prototype._convertRGBtoRGBATextureData=function(D,w,N,F){var k;k=F===X.a.TEXTURETYPE_FLOAT?new Float32Array(w*N*4):new Uint32Array(w*N*4);for(var j=0;j<w;j++)for(var z=0;z<N;z++){var G=3*(z*w+j),H=4*(z*w+j);k[H+0]=D[G+0],k[H+1]=D[G+1],k[H+2]=D[G+2],k[H+3]=1}return k},t.prototype._rebuildBuffers=function(){for(var w=0,N=this.scenes;w<N.length;w++){var F=N[w];F.resetCachedMaterial(),F._rebuildGeometries(),F._rebuildTextures()}D.prototype._rebuildBuffers.call(this)},t.prototype._renderFrame=function(){for(var D=0;D<this._activeRenderLoops.length;D++)(0,this._activeRenderLoops[D])()},t.prototype._renderLoop=function(){if(!this._contextWasLost){var D=!0;!this.renderEvenInBackground&&this._windowIsBackground&&(D=!1),D&&(this.beginFrame(),this._renderViews()||this._renderFrame(),this.endFrame())}this._activeRenderLoops.length>0?this.customAnimationFrameRequester?(this.customAnimationFrameRequester.requestID=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.requestID):this.isVRPresenting()?this._requestVRFrame():this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()):this._renderingQueueLaunched=!1},t.prototype._renderViews=function(){return!1},t.prototype.switchFullscreen=function(D){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(D)},t.prototype.enterFullscreen=function(D){this.isFullscreen||(this._pointerLockRequested=D,this._renderingCanvas&&t._RequestFullscreen(this._renderingCanvas))},t.prototype.exitFullscreen=function(){this.isFullscreen&&t._ExitFullscreen()},t.prototype.enterPointerlock=function(){this._renderingCanvas&&t._RequestPointerlock(this._renderingCanvas)},t.prototype.exitPointerlock=function(){t._ExitPointerlock()},t.prototype.beginFrame=function(){this._measureFps(),this.onBeginFrameObservable.notifyObservers(this),D.prototype.beginFrame.call(this)},t.prototype.endFrame=function(){D.prototype.endFrame.call(this),this._submitVRFrame(),this.onEndFrameObservable.notifyObservers(this)},t.prototype.resize=function(){this.isVRPresenting()||D.prototype.resize.call(this)},t.prototype.setSize=function(w,N){if(this._renderingCanvas&&(D.prototype.setSize.call(this,w,N),this.scenes)){for(var F=0;F<this.scenes.length;F++)for(var k=this.scenes[F],j=0;j<k.cameras.length;j++)k.cameras[j]._currentRenderId=0;this.onResizeObservable.hasObservers&&this.onResizeObservable.notifyObservers(this)}},t.prototype.updateDynamicVertexBuffer=function(D,w,N,F){this.bindArrayBuffer(D),void 0===N&&(N=0);var k=w.length||w.byteLength;void 0===F||F>=k&&0===N?w instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,N,new Float32Array(w)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,N,w):w instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(w).subarray(N,N+F)):(w=w instanceof ArrayBuffer?new Uint8Array(w,N,F):new Uint8Array(w.buffer,w.byteOffset+N,F),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,w)),this._resetVertexBufferBinding()},t.prototype._deletePipelineContext=function(w){var N=w;N&&N.program&&N.transformFeedback&&(this.deleteTransformFeedback(N.transformFeedback),N.transformFeedback=null),D.prototype._deletePipelineContext.call(this,w)},t.prototype.createShaderProgram=function(w,N,F,k,j,z){void 0===z&&(z=null),j=j||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);var G=D.prototype.createShaderProgram.call(this,w,N,F,k,j,z);return this.onAfterShaderCompilationObservable.notifyObservers(this),G},t.prototype._createShaderProgram=function(D,w,N,F,k){void 0===k&&(k=null);var j=F.createProgram();if(D.program=j,!j)throw new Error("Unable to create program");if(F.attachShader(j,w),F.attachShader(j,N),this.webGLVersion>1&&k){var z=this.createTransformFeedback();this.bindTransformFeedback(z),this.setTranformFeedbackVaryings(j,k),D.transformFeedback=z}return F.linkProgram(j),this.webGLVersion>1&&k&&this.bindTransformFeedback(null),D.context=F,D.vertexShader=w,D.fragmentShader=N,D.isParallelCompiled||this._finalizePipelineContext(D),j},t.prototype._releaseTexture=function(w){D.prototype._releaseTexture.call(this,w),this.scenes.forEach((function(D){D.postProcesses.forEach((function(D){D._outputTexture==w&&(D._outputTexture=null)})),D.cameras.forEach((function(D){D._postProcesses.forEach((function(D){D&&D._outputTexture==w&&(D._outputTexture=null)}))}))}))},t.prototype._rescaleTexture=function(D,w,N,F,k){var j=this;this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);var z=this.createRenderTargetTexture({width:w.width,height:w.height},{generateMipMaps:!1,type:X.a.TEXTURETYPE_UNSIGNED_INT,samplingMode:X.a.TEXTURE_BILINEAR_SAMPLINGMODE,generateDepthBuffer:!1,generateStencilBuffer:!1});!this._rescalePostProcess&&t._RescalePostProcessFactory&&(this._rescalePostProcess=t._RescalePostProcessFactory(this)),this._rescalePostProcess.getEffect().executeWhenCompiled((function(){j._rescalePostProcess.onApply=function(w){w._bindTexture("textureSampler",D)};var G=N;G||(G=j.scenes[j.scenes.length-1]),G.postProcessManager.directRender([j._rescalePostProcess],z,!0),j._bindTextureDirectly(j._gl.TEXTURE_2D,w,!0),j._gl.copyTexImage2D(j._gl.TEXTURE_2D,0,F,0,0,w.width,w.height,0),j.unBindFramebuffer(z),j._releaseTexture(z),k&&k()}))},t.prototype.getFps=function(){return this._fps},t.prototype.getDeltaTime=function(){return this._deltaTime},t.prototype._measureFps=function(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0},t.prototype._uploadImageToTexture=function(D,w,N,F){void 0===N&&(N=0),void 0===F&&(F=0);var k=this._gl,j=this._getWebGLTextureType(D.type),z=this._getInternalFormat(D.format),G=this._getRGBABufferInternalSizedFormat(D.type,z),H=D.isCube?k.TEXTURE_CUBE_MAP:k.TEXTURE_2D;this._bindTextureDirectly(H,D,!0),this._unpackFlipY(D.invertY);var X=k.TEXTURE_2D;D.isCube&&(X=k.TEXTURE_CUBE_MAP_POSITIVE_X+N),k.texImage2D(X,F,G,z,j,w),this._bindTextureDirectly(H,null,!0)},t.prototype.updateDynamicIndexBuffer=function(D,w,N){var F;void 0===N&&(N=0),this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(D),F=w instanceof Uint16Array||w instanceof Uint32Array?w:D.is32Bits?new Uint32Array(w):new Uint16Array(w),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,F,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},t.prototype.updateRenderTargetTextureSampleCount=function(D,w){if(this.webGLVersion<2||!D)return 1;if(D.samples===w)return w;var N=this._gl;if(w=Math.min(w,this.getCaps().maxMSAASamples),D._depthStencilBuffer&&(N.deleteRenderbuffer(D._depthStencilBuffer),D._depthStencilBuffer=null),D._MSAAFramebuffer&&(N.deleteFramebuffer(D._MSAAFramebuffer),D._MSAAFramebuffer=null),D._MSAARenderBuffer&&(N.deleteRenderbuffer(D._MSAARenderBuffer),D._MSAARenderBuffer=null),w>1&&N.renderbufferStorageMultisample){var F=N.createFramebuffer();if(!F)throw new Error("Unable to create multi sampled framebuffer");D._MSAAFramebuffer=F,this._bindUnboundFramebuffer(D._MSAAFramebuffer);var k=N.createRenderbuffer();if(!k)throw new Error("Unable to create multi sampled framebuffer");N.bindRenderbuffer(N.RENDERBUFFER,k),N.renderbufferStorageMultisample(N.RENDERBUFFER,w,this._getRGBAMultiSampleBufferFormat(D.type),D.width,D.height),N.framebufferRenderbuffer(N.FRAMEBUFFER,N.COLOR_ATTACHMENT0,N.RENDERBUFFER,k),D._MSAARenderBuffer=k}else this._bindUnboundFramebuffer(D._framebuffer);return D.samples=w,D._depthStencilBuffer=this._setupFramebufferDepthAttachments(D._generateStencilBuffer,D._generateDepthBuffer,D.width,D.height,w),this._bindUnboundFramebuffer(null),w},t.prototype.updateTextureComparisonFunction=function(D,w){if(1!==this.webGLVersion){var N=this._gl;D.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,D,!0),0===w?(N.texParameteri(N.TEXTURE_CUBE_MAP,N.TEXTURE_COMPARE_FUNC,X.a.LEQUAL),N.texParameteri(N.TEXTURE_CUBE_MAP,N.TEXTURE_COMPARE_MODE,N.NONE)):(N.texParameteri(N.TEXTURE_CUBE_MAP,N.TEXTURE_COMPARE_FUNC,w),N.texParameteri(N.TEXTURE_CUBE_MAP,N.TEXTURE_COMPARE_MODE,N.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,D,!0),0===w?(N.texParameteri(N.TEXTURE_2D,N.TEXTURE_COMPARE_FUNC,X.a.LEQUAL),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_COMPARE_MODE,N.NONE)):(N.texParameteri(N.TEXTURE_2D,N.TEXTURE_COMPARE_FUNC,w),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_COMPARE_MODE,N.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),D._comparisonFunction=w}else $.a.Error("WebGL 1 does not support texture comparison.")},t.prototype.createInstancesBuffer=function(D){var w=this._gl.createBuffer();if(!w)throw new Error("Unable to create instance buffer");var N=new J.a(w);return N.capacity=D,this.bindArrayBuffer(N),this._gl.bufferData(this._gl.ARRAY_BUFFER,D,this._gl.DYNAMIC_DRAW),N},t.prototype.deleteInstancesBuffer=function(D){this._gl.deleteBuffer(D)},t.prototype._clientWaitAsync=function(D,w,N){void 0===w&&(w=0),void 0===N&&(N=10);var F=this._gl;return new Promise((function(k,j){var a=function(){var z=F.clientWaitSync(D,w,0);z!=F.WAIT_FAILED?z!=F.TIMEOUT_EXPIRED?k():setTimeout(a,N):j()};a()}))},t.prototype._readPixelsAsync=function(D,w,N,F,k,j,z){if(this._webGLVersion<2)throw new Error("_readPixelsAsync only work on WebGL2+");var G=this._gl,H=G.createBuffer();G.bindBuffer(G.PIXEL_PACK_BUFFER,H),G.bufferData(G.PIXEL_PACK_BUFFER,z.byteLength,G.STREAM_READ),G.readPixels(D,w,N,F,k,j,0),G.bindBuffer(G.PIXEL_PACK_BUFFER,null);var X=G.fenceSync(G.SYNC_GPU_COMMANDS_COMPLETE,0);return X?(G.flush(),this._clientWaitAsync(X,0,10).then((function(){return G.deleteSync(X),G.bindBuffer(G.PIXEL_PACK_BUFFER,H),G.getBufferSubData(G.PIXEL_PACK_BUFFER,0,z),G.bindBuffer(G.PIXEL_PACK_BUFFER,null),G.deleteBuffer(H),z}))):null},t.prototype._readTexturePixels=function(D,w,N,F,k,j){void 0===F&&(F=-1),void 0===k&&(k=0),void 0===j&&(j=null);var z=this._gl;if(!this._dummyFramebuffer){var G=z.createFramebuffer();if(!G)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=G}z.bindFramebuffer(z.FRAMEBUFFER,this._dummyFramebuffer),F>-1?z.framebufferTexture2D(z.FRAMEBUFFER,z.COLOR_ATTACHMENT0,z.TEXTURE_CUBE_MAP_POSITIVE_X+F,D._webGLTexture,k):z.framebufferTexture2D(z.FRAMEBUFFER,z.COLOR_ATTACHMENT0,z.TEXTURE_2D,D._webGLTexture,k);var H=void 0!==D.type?this._getWebGLTextureType(D.type):z.UNSIGNED_BYTE;switch(H){case z.UNSIGNED_BYTE:j||(j=new Uint8Array(4*w*N)),H=z.UNSIGNED_BYTE;break;default:j||(j=new Float32Array(4*w*N)),H=z.FLOAT}return z.readPixels(0,0,w,N,z.RGBA,H,j),z.bindFramebuffer(z.FRAMEBUFFER,this._currentFramebuffer),j},t.prototype.dispose=function(){for(this.hideLoadingUI(),this.onNewSceneAddedObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(this._rescalePostProcess&&this._rescalePostProcess.dispose();this.scenes.length;)this.scenes[0].dispose();1===t.Instances.length&&t.audioEngine&&t.audioEngine.dispose(),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.disableVR(),j.a.IsWindowObjectExist()&&(window.removeEventListener("blur",this._onBlur),window.removeEventListener("focus",this._onFocus),this._renderingCanvas&&(this._renderingCanvas.removeEventListener("focus",this._onCanvasFocus),this._renderingCanvas.removeEventListener("blur",this._onCanvasBlur),this._renderingCanvas.removeEventListener("pointerout",this._onCanvasPointerOut)),document.removeEventListener("fullscreenchange",this._onFullscreenChange),document.removeEventListener("mozfullscreenchange",this._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange),document.removeEventListener("msfullscreenchange",this._onFullscreenChange),document.removeEventListener("pointerlockchange",this._onPointerLockChange),document.removeEventListener("mspointerlockchange",this._onPointerLockChange),document.removeEventListener("mozpointerlockchange",this._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",this._onPointerLockChange)),D.prototype.dispose.call(this);var w=t.Instances.indexOf(this);w>=0&&t.Instances.splice(w,1),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()},t.prototype._disableTouchAction=function(){this._renderingCanvas&&this._renderingCanvas.setAttribute&&(this._renderingCanvas.setAttribute("touch-action","none"),this._renderingCanvas.style.touchAction="none",this._renderingCanvas.style.msTouchAction="none")},t.prototype.displayLoadingUI=function(){if(j.a.IsWindowObjectExist()){var D=this.loadingScreen;D&&D.displayLoadingUI()}},t.prototype.hideLoadingUI=function(){if(j.a.IsWindowObjectExist()){var D=this._loadingScreen;D&&D.hideLoadingUI()}},Object.defineProperty(t.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=t.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(D){this._loadingScreen=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"loadingUIText",{set:function(D){this.loadingScreen.loadingUIText=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"loadingUIBackgroundColor",{set:function(D){this.loadingScreen.loadingUIBackgroundColor=D},enumerable:!0,configurable:!0}),t._RequestPointerlock=function(D){D.requestPointerLock=D.requestPointerLock||D.msRequestPointerLock||D.mozRequestPointerLock||D.webkitRequestPointerLock,D.requestPointerLock&&D.requestPointerLock()},t._ExitPointerlock=function(){var D=document;document.exitPointerLock=document.exitPointerLock||D.msExitPointerLock||D.mozExitPointerLock||D.webkitExitPointerLock,document.exitPointerLock&&document.exitPointerLock()},t._RequestFullscreen=function(D){var w=D.requestFullscreen||D.msRequestFullscreen||D.webkitRequestFullscreen||D.mozRequestFullScreen;w&&w.call(D)},t._ExitFullscreen=function(){var D=document;document.exitFullscreen?document.exitFullscreen():D.mozCancelFullScreen?D.mozCancelFullScreen():D.webkitCancelFullScreen?D.webkitCancelFullScreen():D.msCancelFullScreen&&D.msCancelFullScreen()},t.ALPHA_DISABLE=X.a.ALPHA_DISABLE,t.ALPHA_ADD=X.a.ALPHA_ADD,t.ALPHA_COMBINE=X.a.ALPHA_COMBINE,t.ALPHA_SUBTRACT=X.a.ALPHA_SUBTRACT,t.ALPHA_MULTIPLY=X.a.ALPHA_MULTIPLY,t.ALPHA_MAXIMIZED=X.a.ALPHA_MAXIMIZED,t.ALPHA_ONEONE=X.a.ALPHA_ONEONE,t.ALPHA_PREMULTIPLIED=X.a.ALPHA_PREMULTIPLIED,t.ALPHA_PREMULTIPLIED_PORTERDUFF=X.a.ALPHA_PREMULTIPLIED_PORTERDUFF,t.ALPHA_INTERPOLATE=X.a.ALPHA_INTERPOLATE,t.ALPHA_SCREENMODE=X.a.ALPHA_SCREENMODE,t.DELAYLOADSTATE_NONE=X.a.DELAYLOADSTATE_NONE,t.DELAYLOADSTATE_LOADED=X.a.DELAYLOADSTATE_LOADED,t.DELAYLOADSTATE_LOADING=X.a.DELAYLOADSTATE_LOADING,t.DELAYLOADSTATE_NOTLOADED=X.a.DELAYLOADSTATE_NOTLOADED,t.NEVER=X.a.NEVER,t.ALWAYS=X.a.ALWAYS,t.LESS=X.a.LESS,t.EQUAL=X.a.EQUAL,t.LEQUAL=X.a.LEQUAL,t.GREATER=X.a.GREATER,t.GEQUAL=X.a.GEQUAL,t.NOTEQUAL=X.a.NOTEQUAL,t.KEEP=X.a.KEEP,t.REPLACE=X.a.REPLACE,t.INCR=X.a.INCR,t.DECR=X.a.DECR,t.INVERT=X.a.INVERT,t.INCR_WRAP=X.a.INCR_WRAP,t.DECR_WRAP=X.a.DECR_WRAP,t.TEXTURE_CLAMP_ADDRESSMODE=X.a.TEXTURE_CLAMP_ADDRESSMODE,t.TEXTURE_WRAP_ADDRESSMODE=X.a.TEXTURE_WRAP_ADDRESSMODE,t.TEXTURE_MIRROR_ADDRESSMODE=X.a.TEXTURE_MIRROR_ADDRESSMODE,t.TEXTUREFORMAT_ALPHA=X.a.TEXTUREFORMAT_ALPHA,t.TEXTUREFORMAT_LUMINANCE=X.a.TEXTUREFORMAT_LUMINANCE,t.TEXTUREFORMAT_LUMINANCE_ALPHA=X.a.TEXTUREFORMAT_LUMINANCE_ALPHA,t.TEXTUREFORMAT_RGB=X.a.TEXTUREFORMAT_RGB,t.TEXTUREFORMAT_RGBA=X.a.TEXTUREFORMAT_RGBA,t.TEXTUREFORMAT_RED=X.a.TEXTUREFORMAT_RED,t.TEXTUREFORMAT_R=X.a.TEXTUREFORMAT_R,t.TEXTUREFORMAT_RG=X.a.TEXTUREFORMAT_RG,t.TEXTUREFORMAT_RED_INTEGER=X.a.TEXTUREFORMAT_RED_INTEGER,t.TEXTUREFORMAT_R_INTEGER=X.a.TEXTUREFORMAT_R_INTEGER,t.TEXTUREFORMAT_RG_INTEGER=X.a.TEXTUREFORMAT_RG_INTEGER,t.TEXTUREFORMAT_RGB_INTEGER=X.a.TEXTUREFORMAT_RGB_INTEGER,t.TEXTUREFORMAT_RGBA_INTEGER=X.a.TEXTUREFORMAT_RGBA_INTEGER,t.TEXTURETYPE_UNSIGNED_BYTE=X.a.TEXTURETYPE_UNSIGNED_BYTE,t.TEXTURETYPE_UNSIGNED_INT=X.a.TEXTURETYPE_UNSIGNED_INT,t.TEXTURETYPE_FLOAT=X.a.TEXTURETYPE_FLOAT,t.TEXTURETYPE_HALF_FLOAT=X.a.TEXTURETYPE_HALF_FLOAT,t.TEXTURETYPE_BYTE=X.a.TEXTURETYPE_BYTE,t.TEXTURETYPE_SHORT=X.a.TEXTURETYPE_SHORT,t.TEXTURETYPE_UNSIGNED_SHORT=X.a.TEXTURETYPE_UNSIGNED_SHORT,t.TEXTURETYPE_INT=X.a.TEXTURETYPE_INT,t.TEXTURETYPE_UNSIGNED_INTEGER=X.a.TEXTURETYPE_UNSIGNED_INTEGER,t.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=X.a.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4,t.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=X.a.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1,t.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=X.a.TEXTURETYPE_UNSIGNED_SHORT_5_6_5,t.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=X.a.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV,t.TEXTURETYPE_UNSIGNED_INT_24_8=X.a.TEXTURETYPE_UNSIGNED_INT_24_8,t.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=X.a.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV,t.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=X.a.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV,t.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=X.a.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV,t.TEXTURE_NEAREST_SAMPLINGMODE=X.a.TEXTURE_NEAREST_SAMPLINGMODE,t.TEXTURE_BILINEAR_SAMPLINGMODE=X.a.TEXTURE_BILINEAR_SAMPLINGMODE,t.TEXTURE_TRILINEAR_SAMPLINGMODE=X.a.TEXTURE_TRILINEAR_SAMPLINGMODE,t.TEXTURE_NEAREST_NEAREST_MIPLINEAR=X.a.TEXTURE_NEAREST_NEAREST_MIPLINEAR,t.TEXTURE_LINEAR_LINEAR_MIPNEAREST=X.a.TEXTURE_LINEAR_LINEAR_MIPNEAREST,t.TEXTURE_LINEAR_LINEAR_MIPLINEAR=X.a.TEXTURE_LINEAR_LINEAR_MIPLINEAR,t.TEXTURE_NEAREST_NEAREST_MIPNEAREST=X.a.TEXTURE_NEAREST_NEAREST_MIPNEAREST,t.TEXTURE_NEAREST_LINEAR_MIPNEAREST=X.a.TEXTURE_NEAREST_LINEAR_MIPNEAREST,t.TEXTURE_NEAREST_LINEAR_MIPLINEAR=X.a.TEXTURE_NEAREST_LINEAR_MIPLINEAR,t.TEXTURE_NEAREST_LINEAR=X.a.TEXTURE_NEAREST_LINEAR,t.TEXTURE_NEAREST_NEAREST=X.a.TEXTURE_NEAREST_NEAREST,t.TEXTURE_LINEAR_NEAREST_MIPNEAREST=X.a.TEXTURE_LINEAR_NEAREST_MIPNEAREST,t.TEXTURE_LINEAR_NEAREST_MIPLINEAR=X.a.TEXTURE_LINEAR_NEAREST_MIPLINEAR,t.TEXTURE_LINEAR_LINEAR=X.a.TEXTURE_LINEAR_LINEAR,t.TEXTURE_LINEAR_NEAREST=X.a.TEXTURE_LINEAR_NEAREST,t.TEXTURE_EXPLICIT_MODE=X.a.TEXTURE_EXPLICIT_MODE,t.TEXTURE_SPHERICAL_MODE=X.a.TEXTURE_SPHERICAL_MODE,t.TEXTURE_PLANAR_MODE=X.a.TEXTURE_PLANAR_MODE,t.TEXTURE_CUBIC_MODE=X.a.TEXTURE_CUBIC_MODE,t.TEXTURE_PROJECTION_MODE=X.a.TEXTURE_PROJECTION_MODE,t.TEXTURE_SKYBOX_MODE=X.a.TEXTURE_SKYBOX_MODE,t.TEXTURE_INVCUBIC_MODE=X.a.TEXTURE_INVCUBIC_MODE,t.TEXTURE_EQUIRECTANGULAR_MODE=X.a.TEXTURE_EQUIRECTANGULAR_MODE,t.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=X.a.TEXTURE_FIXED_EQUIRECTANGULAR_MODE,t.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=X.a.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE,t.SCALEMODE_FLOOR=X.a.SCALEMODE_FLOOR,t.SCALEMODE_NEAREST=X.a.SCALEMODE_NEAREST,t.SCALEMODE_CEILING=X.a.SCALEMODE_CEILING,t._RescalePostProcessFactory=null,t}(H.a)},function(D,w,N){"use strict";N.d(w,"a",(function(){return F}));var F=function(){function e(){}return e.GetClass=function(D){return this.RegisteredTypes&&this.RegisteredTypes[D]?this.RegisteredTypes[D]:null},e.RegisteredTypes={},e}()},function(D,w,N){"use strict";N.d(w,"b",(function(){return oe})),N.d(w,"c",(function(){return g})),N.d(w,"a",(function(){return ce}));var F=N(6),k=N(38),j=N(7),z=N(33),G=N(52),H=N(19),X=N(65),q=N(23),Z=N(54),J=N(131),$=N(115),te=N(112),ie=N(137),oe=function(){function e(){}return Object.defineProperty(e,"BaseUrl",{get:function(){return Z.a.BaseUrl},set:function(D){Z.a.BaseUrl=D},enumerable:!0,configurable:!0}),Object.defineProperty(e,"DefaultRetryStrategy",{get:function(){return Z.a.DefaultRetryStrategy},set:function(D){Z.a.DefaultRetryStrategy=D},enumerable:!0,configurable:!0}),Object.defineProperty(e,"UseFallbackTexture",{get:function(){return q.a.UseFallbackTexture},set:function(D){q.a.UseFallbackTexture=D},enumerable:!0,configurable:!0}),Object.defineProperty(e,"RegisteredExternalClasses",{get:function(){return te.a.RegisteredExternalClasses},set:function(D){te.a.RegisteredExternalClasses=D},enumerable:!0,configurable:!0}),Object.defineProperty(e,"fallbackTexture",{get:function(){return q.a.FallbackTexture},set:function(D){q.a.FallbackTexture=D},enumerable:!0,configurable:!0}),e.FetchToRef=function(D,w,N,F,k,j){var z=4*((Math.abs(D)*N%N|0)+(Math.abs(w)*F%F|0)*N);j.r=k[z]/255,j.g=k[z+1]/255,j.b=k[z+2]/255,j.a=k[z+3]/255},e.Mix=function(D,w,N){return D*(1-N)+w*N},e.Instantiate=function(D){return te.a.Instantiate(D)},e.Slice=function(D,w,N){return D.slice?D.slice(w,N):Array.prototype.slice.call(D,w,N)},e.SetImmediate=function(D){$.a.SetImmediate(D)},e.IsExponentOfTwo=function(D){var w=1;do{w*=2}while(w<D);return w===D},e.FloatRound=function(D){return Math.fround?Math.fround(D):e._tmpFloatArray[0]=D},e.GetFilename=function(D){var w=D.lastIndexOf("/");return w<0?D:D.substring(w+1)},e.GetFolderPath=function(D,w){void 0===w&&(w=!1);var N=D.lastIndexOf("/");return N<0?w?D:"":D.substring(0,N+1)},e.ToDegrees=function(D){return 180*D/Math.PI},e.ToRadians=function(D){return D*Math.PI/180},e.MakeArray=function(D,w){return!0===w||void 0!==D&&null!=D?Array.isArray(D)?D:[D]:null},e.GetPointerPrefix=function(){var D="pointer";return k.a.IsWindowObjectExist()&&!window.PointerEvent&&k.a.IsNavigatorAvailable()&&!navigator.pointerEnabled&&(D="mouse"),D},e.SetCorsBehavior=function(D,w){Z.a.SetCorsBehavior(D,w)},e.CleanUrl=function(D){return D.replace(/#/gm,"%23")},Object.defineProperty(e,"PreprocessUrl",{get:function(){return Z.a.PreprocessUrl},set:function(D){Z.a.PreprocessUrl=D},enumerable:!0,configurable:!0}),e.LoadImage=function(D,w,N,F,k){return Z.a.LoadImage(D,w,N,F,k)},e.LoadFile=function(D,w,N,F,k,j){return Z.a.LoadFile(D,w,N,F,k,j)},e.LoadFileAsync=function(D,w){return void 0===w&&(w=!0),new Promise((function(N,F){Z.a.LoadFile(D,(function(D){N(D)}),void 0,void 0,w,(function(D,w){F(w)}))}))},e.LoadScript=function(D,w,N,F){if(k.a.IsWindowObjectExist()){var j=document.getElementsByTagName("head")[0],z=document.createElement("script");z.setAttribute("type","text/javascript"),z.setAttribute("src",D),F&&(z.id=F),z.onload=function(){w&&w()},z.onerror=function(w){N&&N("Unable to load script '"+D+"'",w)},j.appendChild(z)}},e.LoadScriptAsync=function(D,w){var N=this;return new Promise((function(w,F){N.LoadScript(D,(function(){w()}),(function(D,w){F(w)}))}))},e.ReadFileAsDataURL=function(D,w,N){var k=new FileReader,j={onCompleteObservable:new F.c,abort:function(){return k.abort()}};return k.onloadend=function(D){j.onCompleteObservable.notifyObservers(j)},k.onload=function(D){w(D.target.result)},k.onprogress=N,k.readAsDataURL(D),j},e.ReadFile=function(D,w,N,F,k){return Z.a.ReadFile(D,w,N,F,k)},e.FileAsURL=function(D){var w=new Blob([D]);return(window.URL||window.webkitURL).createObjectURL(w)},e.Format=function(D,w){return void 0===w&&(w=2),D.toFixed(w)},e.DeepCopy=function(D,w,N,F){z.a.DeepCopy(D,w,N,F)},e.IsEmpty=function(D){for(var w in D)if(D.hasOwnProperty(w))return!1;return!0},e.RegisterTopRootEvents=function(D,w){for(var N=0;N<w.length;N++){var F=w[N];D.addEventListener(F.name,F.handler,!1);try{window.parent&&window.parent.addEventListener(F.name,F.handler,!1)}catch(D){}}},e.UnregisterTopRootEvents=function(D,w){for(var N=0;N<w.length;N++){var F=w[N];D.removeEventListener(F.name,F.handler);try{D.parent&&D.parent.removeEventListener(F.name,F.handler)}catch(D){}}},e.DumpFramebuffer=function(D,w,N,F,k,j){void 0===k&&(k="image/png");for(var z=4*D,G=w/2,H=N.readPixels(0,0,D,w),X=0;X<G;X++)for(var q=0;q<z;q++){var Z=q+X*z,J=q+(w-X-1)*z,$=H[Z];H[Z]=H[J],H[J]=$}e._ScreenshotCanvas||(e._ScreenshotCanvas=document.createElement("canvas")),e._ScreenshotCanvas.width=D,e._ScreenshotCanvas.height=w;var te=e._ScreenshotCanvas.getContext("2d");if(te){var ie=te.createImageData(D,w);ie.data.set(H),te.putImageData(ie,0,0),e.EncodeScreenshotCanvasData(F,k,j)}},e.ToBlob=function(D,w,N){void 0===N&&(N="image/png"),D.toBlob||(D.toBlob=function(D,w,N){var F=this;setTimeout((function(){for(var k=atob(F.toDataURL(w,N).split(",")[1]),j=k.length,z=new Uint8Array(j),G=0;G<j;G++)z[G]=k.charCodeAt(G);D(new Blob([z]))}))}),D.toBlob((function(D){w(D)}),N)},e.EncodeScreenshotCanvasData=function(D,w,N){void 0===w&&(w="image/png"),D?D(e._ScreenshotCanvas.toDataURL(w)):this.ToBlob(e._ScreenshotCanvas,(function(D){if("download"in document.createElement("a")){if(!N){var w=new Date,F=(w.getFullYear()+"-"+(w.getMonth()+1)).slice(2)+"-"+w.getDate()+"_"+w.getHours()+"-"+("0"+w.getMinutes()).slice(-2);N="screenshot_"+F+".png"}e.Download(D,N)}else{var k=URL.createObjectURL(D),j=window.open("");if(!j)return;var z=j.document.createElement("img");z.onload=function(){URL.revokeObjectURL(k)},z.src=k,j.document.body.appendChild(z)}}),w)},e.Download=function(D,w){if(navigator&&navigator.msSaveBlob)navigator.msSaveBlob(D,w);else{var N=window.URL.createObjectURL(D),F=document.createElement("a");document.body.appendChild(F),F.style.display="none",F.href=N,F.download=w,F.addEventListener("click",(function(){F.parentElement&&F.parentElement.removeChild(F)})),F.click(),window.URL.revokeObjectURL(N)}},e.CreateScreenshot=function(D,w,N,F,k){throw void 0===k&&(k="image/png"),H.a.WarnImport("ScreenshotTools")},e.CreateScreenshotAsync=function(D,w,N,F){throw void 0===F&&(F="image/png"),H.a.WarnImport("ScreenshotTools")},e.CreateScreenshotUsingRenderTarget=function(D,w,N,F,k,j,z,G){throw void 0===k&&(k="image/png"),void 0===j&&(j=1),void 0===z&&(z=!1),H.a.WarnImport("ScreenshotTools")},e.CreateScreenshotUsingRenderTargetAsync=function(D,w,N,F,k,j,z){throw void 0===F&&(F="image/png"),void 0===k&&(k=1),void 0===j&&(j=!1),H.a.WarnImport("ScreenshotTools")},e.RandomId=function(){return ie.a.RandomId()},e.IsBase64=function(D){return!(D.length<5)&&"data:"===D.substr(0,5)},e.DecodeBase64=function(D){for(var w=atob(D.split(",")[1]),N=w.length,F=new Uint8Array(new ArrayBuffer(N)),k=0;k<N;k++)F[k]=w.charCodeAt(k);return F.buffer},e.GetAbsoluteUrl=function(D){var w=document.createElement("a");return w.href=D,w.href},Object.defineProperty(e,"errorsCount",{get:function(){return j.a.errorsCount},enumerable:!0,configurable:!0}),e.Log=function(D){j.a.Log(D)},e.Warn=function(D){j.a.Warn(D)},e.Error=function(D){j.a.Error(D)},Object.defineProperty(e,"LogCache",{get:function(){return j.a.LogCache},enumerable:!0,configurable:!0}),e.ClearLogCache=function(){j.a.ClearLogCache()},Object.defineProperty(e,"LogLevels",{set:function(D){j.a.LogLevels=D},enumerable:!0,configurable:!0}),Object.defineProperty(e,"PerformanceLogLevel",{set:function(D){return(D&e.PerformanceUserMarkLogLevel)===e.PerformanceUserMarkLogLevel?(e.StartPerformanceCounter=e._StartUserMark,void(e.EndPerformanceCounter=e._EndUserMark)):(D&e.PerformanceConsoleLogLevel)===e.PerformanceConsoleLogLevel?(e.StartPerformanceCounter=e._StartPerformanceConsole,void(e.EndPerformanceCounter=e._EndPerformanceConsole)):(e.StartPerformanceCounter=e._StartPerformanceCounterDisabled,void(e.EndPerformanceCounter=e._EndPerformanceCounterDisabled))},enumerable:!0,configurable:!0}),e._StartPerformanceCounterDisabled=function(D,w){},e._EndPerformanceCounterDisabled=function(D,w){},e._StartUserMark=function(D,w){if(void 0===w&&(w=!0),!e._performance){if(!k.a.IsWindowObjectExist())return;e._performance=window.performance}w&&e._performance.mark&&e._performance.mark(D+"-Begin")},e._EndUserMark=function(D,w){void 0===w&&(w=!0),w&&e._performance.mark&&(e._performance.mark(D+"-End"),e._performance.measure(D,D+"-Begin",D+"-End"))},e._StartPerformanceConsole=function(D,w){void 0===w&&(w=!0),w&&(e._StartUserMark(D,w),console.time&&console.time(D))},e._EndPerformanceConsole=function(D,w){void 0===w&&(w=!0),w&&(e._EndUserMark(D,w),console.timeEnd(D))},Object.defineProperty(e,"Now",{get:function(){return G.a.Now},enumerable:!0,configurable:!0}),e.GetClassName=function(D,w){void 0===w&&(w=!1);var N=null;return!w&&D.getClassName?N=D.getClassName():(D instanceof Object&&(N=(w?D:Object.getPrototypeOf(D)).constructor.__bjsclassName__),N||(N=typeof D)),N},e.First=function(D,w){for(var N=0,F=D;N<F.length;N++){var k=F[N];if(w(k))return k}return null},e.getFullClassName=function(D,w){void 0===w&&(w=!1);var N=null,F=null;if(!w&&D.getClassName)N=D.getClassName();else{if(D instanceof Object){var k=w?D:Object.getPrototypeOf(D);N=k.constructor.__bjsclassName__,F=k.constructor.__bjsmoduleName__}N||(N=typeof D)}return N?(null!=F?F+".":"")+N:null},e.DelayAsync=function(D){return new Promise((function(w){setTimeout((function(){w()}),D)}))},e.IsSafari=function(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},e.UseCustomRequestHeaders=!1,e.CustomRequestHeaders=X.a.CustomRequestHeaders,e.CorsBehavior="anonymous",e._tmpFloatArray=new Float32Array(1),e.GetDOMTextContent=k.a.GetDOMTextContent,e.NoneLogLevel=j.a.NoneLogLevel,e.MessageLogLevel=j.a.MessageLogLevel,e.WarningLogLevel=j.a.WarningLogLevel,e.ErrorLogLevel=j.a.ErrorLogLevel,e.AllLogLevel=j.a.AllLogLevel,e.IsWindowObjectExist=k.a.IsWindowObjectExist,e.PerformanceNoneLogLevel=0,e.PerformanceUserMarkLogLevel=1,e.PerformanceConsoleLogLevel=2,e.StartPerformanceCounter=e._StartPerformanceCounterDisabled,e.EndPerformanceCounter=e._EndPerformanceCounterDisabled,e}();function g(D,w){return function(N){N.__bjsclassName__=D,N.__bjsmoduleName__=null!=w?w:null}}var ce=function(){function e(D,w,N,F){void 0===F&&(F=0),this.iterations=D,this.index=F-1,this._done=!1,this._fn=w,this._successCallback=N}return e.prototype.executeNext=function(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())},e.prototype.breakLoop=function(){this._done=!0,this._successCallback()},e.Run=function(D,w,N,F){void 0===F&&(F=0);var k=new e(D,w,N,F);return k.executeNext(),k},e.SyncAsyncForLoop=function(D,w,N,F,k,j){return void 0===j&&(j=0),e.Run(Math.ceil(D/w),(function(F){k&&k()?F.breakLoop():setTimeout((function(){for(var j=0;j<w;++j){var z=F.index*w+j;if(z>=D)break;if(N(z),k&&k()){F.breakLoop();break}}F.executeNext()}),j)}),F)},e}();q.a.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z",J.a.Apply()},function(D,w,N){"use strict";N.d(w,"a",(function(){return F}));var F=function(){function e(){}return e.WithinEpsilon=function(D,w,N){void 0===N&&(N=1401298e-51);var F=D-w;return-N<=F&&F<=N},e.ToHex=function(D){var w=D.toString(16);return D<=15?("0"+w).toUpperCase():w.toUpperCase()},e.Sign=function(D){return 0==(D=+D)||isNaN(D)?D:D>0?1:-1},e.Clamp=function(D,w,N){return void 0===w&&(w=0),void 0===N&&(N=1),Math.min(N,Math.max(w,D))},e.Log2=function(D){return Math.log(D)*Math.LOG2E},e.Repeat=function(D,w){return D-Math.floor(D/w)*w},e.Normalize=function(D,w,N){return(D-w)/(N-w)},e.Denormalize=function(D,w,N){return D*(N-w)+w},e.DeltaAngle=function(D,w){var N=e.Repeat(w-D,360);return N>180&&(N-=360),N},e.PingPong=function(D,w){var N=e.Repeat(D,2*w);return w-Math.abs(N-w)},e.SmoothStep=function(D,w,N){var F=e.Clamp(N);return w*(F=-2*F*F*F+3*F*F)+D*(1-F)},e.MoveTowards=function(D,w,N){return Math.abs(w-D)<=N?w:D+e.Sign(w-D)*N},e.MoveTowardsAngle=function(D,w,N){var F=e.DeltaAngle(D,w),k=0;return-N<F&&F<N?k=w:(w=D+F,k=e.MoveTowards(D,w,N)),k},e.Lerp=function(D,w,N){return D+(w-D)*N},e.LerpAngle=function(D,w,N){var F=e.Repeat(w-D,360);return F>180&&(F-=360),D+F*e.Clamp(N)},e.InverseLerp=function(D,w,N){return D!=w?e.Clamp((N-D)/(w-D)):0},e.Hermite=function(D,w,N,F,k){var j=k*k,z=k*j;return D*(2*z-3*j+1)+N*(-2*z+3*j)+w*(z-2*j+k)+F*(z-j)},e.RandomRange=function(D,w){return D===w?D:Math.random()*(w-D)+D},e.RangeToPercent=function(D,w,N){return(D-w)/(N-w)},e.PercentToRange=function(D,w,N){return(N-w)*D+w},e.NormalizeRadians=function(D){return D-e.TwoPi*Math.floor((D+Math.PI)/e.TwoPi)},e.TwoPi=2*Math.PI,e}()},function(D,w,N){"use strict";N.d(w,"a",(function(){return G}));var F=N(0),k=N(4),j=N(19),z=N(10),G=function(){function e(){}return e.prototype.set=function(D,w){switch(w){case k.b.PositionKind:this.positions=D;break;case k.b.NormalKind:this.normals=D;break;case k.b.TangentKind:this.tangents=D;break;case k.b.UVKind:this.uvs=D;break;case k.b.UV2Kind:this.uvs2=D;break;case k.b.UV3Kind:this.uvs3=D;break;case k.b.UV4Kind:this.uvs4=D;break;case k.b.UV5Kind:this.uvs5=D;break;case k.b.UV6Kind:this.uvs6=D;break;case k.b.ColorKind:this.colors=D;break;case k.b.MatricesIndicesKind:this.matricesIndices=D;break;case k.b.MatricesWeightsKind:this.matricesWeights=D;break;case k.b.MatricesIndicesExtraKind:this.matricesIndicesExtra=D;break;case k.b.MatricesWeightsExtraKind:this.matricesWeightsExtra=D}},e.prototype.applyToMesh=function(D,w){return this._applyTo(D,w),this},e.prototype.applyToGeometry=function(D,w){return this._applyTo(D,w),this},e.prototype.updateMesh=function(D){return this._update(D),this},e.prototype.updateGeometry=function(D){return this._update(D),this},e.prototype._applyTo=function(D,w){return void 0===w&&(w=!1),this.positions&&D.setVerticesData(k.b.PositionKind,this.positions,w),this.normals&&D.setVerticesData(k.b.NormalKind,this.normals,w),this.tangents&&D.setVerticesData(k.b.TangentKind,this.tangents,w),this.uvs&&D.setVerticesData(k.b.UVKind,this.uvs,w),this.uvs2&&D.setVerticesData(k.b.UV2Kind,this.uvs2,w),this.uvs3&&D.setVerticesData(k.b.UV3Kind,this.uvs3,w),this.uvs4&&D.setVerticesData(k.b.UV4Kind,this.uvs4,w),this.uvs5&&D.setVerticesData(k.b.UV5Kind,this.uvs5,w),this.uvs6&&D.setVerticesData(k.b.UV6Kind,this.uvs6,w),this.colors&&D.setVerticesData(k.b.ColorKind,this.colors,w),this.matricesIndices&&D.setVerticesData(k.b.MatricesIndicesKind,this.matricesIndices,w),this.matricesWeights&&D.setVerticesData(k.b.MatricesWeightsKind,this.matricesWeights,w),this.matricesIndicesExtra&&D.setVerticesData(k.b.MatricesIndicesExtraKind,this.matricesIndicesExtra,w),this.matricesWeightsExtra&&D.setVerticesData(k.b.MatricesWeightsExtraKind,this.matricesWeightsExtra,w),this.indices?D.setIndices(this.indices,null,w):D.setIndices([],null),this},e.prototype._update=function(D,w,N){return this.positions&&D.updateVerticesData(k.b.PositionKind,this.positions,w,N),this.normals&&D.updateVerticesData(k.b.NormalKind,this.normals,w,N),this.tangents&&D.updateVerticesData(k.b.TangentKind,this.tangents,w,N),this.uvs&&D.updateVerticesData(k.b.UVKind,this.uvs,w,N),this.uvs2&&D.updateVerticesData(k.b.UV2Kind,this.uvs2,w,N),this.uvs3&&D.updateVerticesData(k.b.UV3Kind,this.uvs3,w,N),this.uvs4&&D.updateVerticesData(k.b.UV4Kind,this.uvs4,w,N),this.uvs5&&D.updateVerticesData(k.b.UV5Kind,this.uvs5,w,N),this.uvs6&&D.updateVerticesData(k.b.UV6Kind,this.uvs6,w,N),this.colors&&D.updateVerticesData(k.b.ColorKind,this.colors,w,N),this.matricesIndices&&D.updateVerticesData(k.b.MatricesIndicesKind,this.matricesIndices,w,N),this.matricesWeights&&D.updateVerticesData(k.b.MatricesWeightsKind,this.matricesWeights,w,N),this.matricesIndicesExtra&&D.updateVerticesData(k.b.MatricesIndicesExtraKind,this.matricesIndicesExtra,w,N),this.matricesWeightsExtra&&D.updateVerticesData(k.b.MatricesWeightsExtraKind,this.matricesWeightsExtra,w,N),this.indices&&D.setIndices(this.indices,null),this},e.prototype.transform=function(D){var w,N=D.m[0]*D.m[5]*D.m[10]<0,k=F.e.Zero();if(this.positions){var j=F.e.Zero();for(w=0;w<this.positions.length;w+=3)F.e.FromArrayToRef(this.positions,w,j),F.e.TransformCoordinatesToRef(j,D,k),this.positions[w]=k.x,this.positions[w+1]=k.y,this.positions[w+2]=k.z}if(this.normals){var z=F.e.Zero();for(w=0;w<this.normals.length;w+=3)F.e.FromArrayToRef(this.normals,w,z),F.e.TransformNormalToRef(z,D,k),this.normals[w]=k.x,this.normals[w+1]=k.y,this.normals[w+2]=k.z}if(this.tangents){var G=F.f.Zero(),H=F.f.Zero();for(w=0;w<this.tangents.length;w+=4)F.f.FromArrayToRef(this.tangents,w,G),F.f.TransformNormalToRef(G,D,H),this.tangents[w]=H.x,this.tangents[w+1]=H.y,this.tangents[w+2]=H.z,this.tangents[w+3]=H.w}if(N&&this.indices)for(w=0;w<this.indices.length;w+=3){var X=this.indices[w+1];this.indices[w+1]=this.indices[w+2],this.indices[w+2]=X}return this},e.prototype.merge=function(D,w){if(void 0===w&&(w=!1),this._validate(),D._validate(),!this.normals!=!D.normals||!this.tangents!=!D.tangents||!this.uvs!=!D.uvs||!this.uvs2!=!D.uvs2||!this.uvs3!=!D.uvs3||!this.uvs4!=!D.uvs4||!this.uvs5!=!D.uvs5||!this.uvs6!=!D.uvs6||!this.colors!=!D.colors||!this.matricesIndices!=!D.matricesIndices||!this.matricesWeights!=!D.matricesWeights||!this.matricesIndicesExtra!=!D.matricesIndicesExtra||!this.matricesWeightsExtra!=!D.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(D.indices){this.indices||(this.indices=[]);var N=this.positions?this.positions.length/3:0;if(void 0!==this.indices.BYTES_PER_ELEMENT){var F=this.indices.length+D.indices.length,k=w||this.indices instanceof Uint32Array?new Uint32Array(F):new Uint16Array(F);k.set(this.indices);for(var j=this.indices.length,z=0;z<D.indices.length;z++)k[j+z]=D.indices[z]+N;this.indices=k}else for(z=0;z<D.indices.length;z++)this.indices.push(D.indices[z]+N)}return this.positions=this._mergeElement(this.positions,D.positions),this.normals=this._mergeElement(this.normals,D.normals),this.tangents=this._mergeElement(this.tangents,D.tangents),this.uvs=this._mergeElement(this.uvs,D.uvs),this.uvs2=this._mergeElement(this.uvs2,D.uvs2),this.uvs3=this._mergeElement(this.uvs3,D.uvs3),this.uvs4=this._mergeElement(this.uvs4,D.uvs4),this.uvs5=this._mergeElement(this.uvs5,D.uvs5),this.uvs6=this._mergeElement(this.uvs6,D.uvs6),this.colors=this._mergeElement(this.colors,D.colors),this.matricesIndices=this._mergeElement(this.matricesIndices,D.matricesIndices),this.matricesWeights=this._mergeElement(this.matricesWeights,D.matricesWeights),this.matricesIndicesExtra=this._mergeElement(this.matricesIndicesExtra,D.matricesIndicesExtra),this.matricesWeightsExtra=this._mergeElement(this.matricesWeightsExtra,D.matricesWeightsExtra),this},e.prototype._mergeElement=function(D,w){if(!D)return w;if(!w)return D;var N=w.length+D.length,F=D instanceof Float32Array,k=w instanceof Float32Array;if(F){var j=new Float32Array(N);return j.set(D),j.set(w,D.length),j}if(k){var z=D.slice(0),G=0;for(N=w.length;G<N;G++)z.push(w[G]);return z}return D.concat(w)},e.prototype._validate=function(){if(!this.positions)throw new Error("Positions are required");var e=function(D,w){var N=k.b.DeduceStride(D);if(w.length%N!=0)throw new Error("The "+D+"s array count must be a multiple of "+N);return w.length/N},D=e(k.b.PositionKind,this.positions),i=function(w,N){var F=e(w,N);if(F!==D)throw new Error("The "+w+"s element count ("+F+") does not match the positions count ("+D+")")};this.normals&&i(k.b.NormalKind,this.normals),this.tangents&&i(k.b.TangentKind,this.tangents),this.uvs&&i(k.b.UVKind,this.uvs),this.uvs2&&i(k.b.UV2Kind,this.uvs2),this.uvs3&&i(k.b.UV3Kind,this.uvs3),this.uvs4&&i(k.b.UV4Kind,this.uvs4),this.uvs5&&i(k.b.UV5Kind,this.uvs5),this.uvs6&&i(k.b.UV6Kind,this.uvs6),this.colors&&i(k.b.ColorKind,this.colors),this.matricesIndices&&i(k.b.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&i(k.b.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&i(k.b.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&i(k.b.MatricesWeightsExtraKind,this.matricesWeightsExtra)},e.prototype.serialize=function(){var D=this.serialize();return this.positions&&(D.positions=this.positions),this.normals&&(D.normals=this.normals),this.tangents&&(D.tangents=this.tangents),this.uvs&&(D.uvs=this.uvs),this.uvs2&&(D.uvs2=this.uvs2),this.uvs3&&(D.uvs3=this.uvs3),this.uvs4&&(D.uvs4=this.uvs4),this.uvs5&&(D.uvs5=this.uvs5),this.uvs6&&(D.uvs6=this.uvs6),this.colors&&(D.colors=this.colors),this.matricesIndices&&(D.matricesIndices=this.matricesIndices,D.matricesIndices._isExpanded=!0),this.matricesWeights&&(D.matricesWeights=this.matricesWeights),this.matricesIndicesExtra&&(D.matricesIndicesExtra=this.matricesIndicesExtra,D.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(D.matricesWeightsExtra=this.matricesWeightsExtra),D.indices=this.indices,D},e.ExtractFromMesh=function(D,w,N){return e._ExtractFrom(D,w,N)},e.ExtractFromGeometry=function(D,w,N){return e._ExtractFrom(D,w,N)},e._ExtractFrom=function(D,w,N){var F=new e;return D.isVerticesDataPresent(k.b.PositionKind)&&(F.positions=D.getVerticesData(k.b.PositionKind,w,N)),D.isVerticesDataPresent(k.b.NormalKind)&&(F.normals=D.getVerticesData(k.b.NormalKind,w,N)),D.isVerticesDataPresent(k.b.TangentKind)&&(F.tangents=D.getVerticesData(k.b.TangentKind,w,N)),D.isVerticesDataPresent(k.b.UVKind)&&(F.uvs=D.getVerticesData(k.b.UVKind,w,N)),D.isVerticesDataPresent(k.b.UV2Kind)&&(F.uvs2=D.getVerticesData(k.b.UV2Kind,w,N)),D.isVerticesDataPresent(k.b.UV3Kind)&&(F.uvs3=D.getVerticesData(k.b.UV3Kind,w,N)),D.isVerticesDataPresent(k.b.UV4Kind)&&(F.uvs4=D.getVerticesData(k.b.UV4Kind,w,N)),D.isVerticesDataPresent(k.b.UV5Kind)&&(F.uvs5=D.getVerticesData(k.b.UV5Kind,w,N)),D.isVerticesDataPresent(k.b.UV6Kind)&&(F.uvs6=D.getVerticesData(k.b.UV6Kind,w,N)),D.isVerticesDataPresent(k.b.ColorKind)&&(F.colors=D.getVerticesData(k.b.ColorKind,w,N)),D.isVerticesDataPresent(k.b.MatricesIndicesKind)&&(F.matricesIndices=D.getVerticesData(k.b.MatricesIndicesKind,w,N)),D.isVerticesDataPresent(k.b.MatricesWeightsKind)&&(F.matricesWeights=D.getVerticesData(k.b.MatricesWeightsKind,w,N)),D.isVerticesDataPresent(k.b.MatricesIndicesExtraKind)&&(F.matricesIndicesExtra=D.getVerticesData(k.b.MatricesIndicesExtraKind,w,N)),D.isVerticesDataPresent(k.b.MatricesWeightsExtraKind)&&(F.matricesWeightsExtra=D.getVerticesData(k.b.MatricesWeightsExtraKind,w,N)),F.indices=D.getIndices(w,N),F},e.CreateRibbon=function(D){throw j.a.WarnImport("ribbonBuilder")},e.CreateBox=function(D){throw j.a.WarnImport("boxBuilder")},e.CreateTiledBox=function(D){throw j.a.WarnImport("tiledBoxBuilder")},e.CreateTiledPlane=function(D){throw j.a.WarnImport("tiledPlaneBuilder")},e.CreateSphere=function(D){throw j.a.WarnImport("sphereBuilder")},e.CreateCylinder=function(D){throw j.a.WarnImport("cylinderBuilder")},e.CreateTorus=function(D){throw j.a.WarnImport("torusBuilder")},e.CreateLineSystem=function(D){throw j.a.WarnImport("linesBuilder")},e.CreateDashedLines=function(D){throw j.a.WarnImport("linesBuilder")},e.CreateGround=function(D){throw j.a.WarnImport("groundBuilder")},e.CreateTiledGround=function(D){throw j.a.WarnImport("groundBuilder")},e.CreateGroundFromHeightMap=function(D){throw j.a.WarnImport("groundBuilder")},e.CreatePlane=function(D){throw j.a.WarnImport("planeBuilder")},e.CreateDisc=function(D){throw j.a.WarnImport("discBuilder")},e.CreatePolygon=function(D,w,N,F,k,z){throw j.a.WarnImport("polygonBuilder")},e.CreateIcoSphere=function(D){throw j.a.WarnImport("icoSphereBuilder")},e.CreatePolyhedron=function(D){throw j.a.WarnImport("polyhedronBuilder")},e.CreateTorusKnot=function(D){throw j.a.WarnImport("torusKnotBuilder")},e.ComputeNormals=function(D,w,N,k){var j=0,z=0,G=0,H=0,X=0,q=0,Z=0,J=0,$=0,te=0,ie=0,oe=0,ce=0,he=0,fe=0,pe=0,_e=0,ve=0,ye=0,be=0,Te=!1,Ee=!1,Se=!1,Me=!1,xe=1,Ae=0,Pe=null;if(k&&(Te=!!k.facetNormals,Ee=!!k.facetPositions,Se=!!k.facetPartitioning,xe=!0===k.useRightHandedSystem?-1:1,Ae=k.ratio||0,Me=!!k.depthSort,Pe=k.distanceTo,Me)){void 0===Pe&&(Pe=F.e.Zero());var Oe=k.depthSortedFacets}var Re=0,De=0,Ie=0,Le=0;if(Se&&k&&k.bbSize){var we=0,Ne=0,Fe=0,Be=0,Ue=0,Ve=0,ze=0,Ge=0,Ye=0,He=0,We=0,Xe=0,Ke=0,Qe=0,Ze=0,Je=0,$e=k.bbSize.x>k.bbSize.y?k.bbSize.x:k.bbSize.y;$e=$e>k.bbSize.z?$e:k.bbSize.z,Re=k.subDiv.X*Ae/k.bbSize.x,De=k.subDiv.Y*Ae/k.bbSize.y,Ie=k.subDiv.Z*Ae/k.bbSize.z,Le=k.subDiv.max*k.subDiv.max,k.facetPartitioning.length=0}for(j=0;j<D.length;j++)N[j]=0;var et=w.length/3|0;for(j=0;j<et;j++){if(ce=1+(oe=3*w[3*j]),he=oe+2,pe=1+(fe=3*w[3*j+1]),_e=fe+2,ye=1+(ve=3*w[3*j+2]),be=ve+2,z=D[oe]-D[fe],G=D[ce]-D[pe],H=D[he]-D[_e],X=D[ve]-D[fe],q=D[ye]-D[pe],J=xe*(G*(Z=D[be]-D[_e])-H*q),$=xe*(H*X-z*Z),te=xe*(z*q-G*X),J/=ie=0===(ie=Math.sqrt(J*J+$*$+te*te))?1:ie,$/=ie,te/=ie,Te&&k&&(k.facetNormals[j].x=J,k.facetNormals[j].y=$,k.facetNormals[j].z=te),Ee&&k&&(k.facetPositions[j].x=(D[oe]+D[fe]+D[ve])/3,k.facetPositions[j].y=(D[ce]+D[pe]+D[ye])/3,k.facetPositions[j].z=(D[he]+D[_e]+D[be])/3),Se&&k&&(we=Math.floor((k.facetPositions[j].x-k.bInfo.minimum.x*Ae)*Re),Ne=Math.floor((k.facetPositions[j].y-k.bInfo.minimum.y*Ae)*De),Fe=Math.floor((k.facetPositions[j].z-k.bInfo.minimum.z*Ae)*Ie),Be=Math.floor((D[oe]-k.bInfo.minimum.x*Ae)*Re),Ue=Math.floor((D[ce]-k.bInfo.minimum.y*Ae)*De),Ve=Math.floor((D[he]-k.bInfo.minimum.z*Ae)*Ie),ze=Math.floor((D[fe]-k.bInfo.minimum.x*Ae)*Re),Ge=Math.floor((D[pe]-k.bInfo.minimum.y*Ae)*De),Ye=Math.floor((D[_e]-k.bInfo.minimum.z*Ae)*Ie),He=Math.floor((D[ve]-k.bInfo.minimum.x*Ae)*Re),We=Math.floor((D[ye]-k.bInfo.minimum.y*Ae)*De),Xe=Math.floor((D[be]-k.bInfo.minimum.z*Ae)*Ie),Qe=Be+k.subDiv.max*Ue+Le*Ve,Ze=ze+k.subDiv.max*Ge+Le*Ye,Je=He+k.subDiv.max*We+Le*Xe,Ke=we+k.subDiv.max*Ne+Le*Fe,k.facetPartitioning[Ke]=k.facetPartitioning[Ke]?k.facetPartitioning[Ke]:new Array,k.facetPartitioning[Qe]=k.facetPartitioning[Qe]?k.facetPartitioning[Qe]:new Array,k.facetPartitioning[Ze]=k.facetPartitioning[Ze]?k.facetPartitioning[Ze]:new Array,k.facetPartitioning[Je]=k.facetPartitioning[Je]?k.facetPartitioning[Je]:new Array,k.facetPartitioning[Qe].push(j),Ze!=Qe&&k.facetPartitioning[Ze].push(j),Je!=Ze&&Je!=Qe&&k.facetPartitioning[Je].push(j),Ke!=Qe&&Ke!=Ze&&Ke!=Je&&k.facetPartitioning[Ke].push(j)),Me&&k&&k.facetPositions){var tt=Oe[j];tt.ind=3*j,tt.sqDistance=F.e.DistanceSquared(k.facetPositions[j],Pe)}N[oe]+=J,N[ce]+=$,N[he]+=te,N[fe]+=J,N[pe]+=$,N[_e]+=te,N[ve]+=J,N[ye]+=$,N[be]+=te}for(j=0;j<N.length/3;j++)J=N[3*j],$=N[3*j+1],te=N[3*j+2],J/=ie=0===(ie=Math.sqrt(J*J+$*$+te*te))?1:ie,$/=ie,te/=ie,N[3*j]=J,N[3*j+1]=$,N[3*j+2]=te},e._ComputeSides=function(D,w,N,k,j,z,G){var H,X,q=N.length,Z=k.length;switch(D=D||e.DEFAULTSIDE){case e.FRONTSIDE:break;case e.BACKSIDE:var J;for(H=0;H<q;H+=3)J=N[H],N[H]=N[H+2],N[H+2]=J;for(X=0;X<Z;X++)k[X]=-k[X];break;case e.DOUBLESIDE:for(var $=w.length,te=$/3,ie=0;ie<$;ie++)w[$+ie]=w[ie];for(H=0;H<q;H+=3)N[H+q]=N[H+2]+te,N[H+1+q]=N[H+1]+te,N[H+2+q]=N[H]+te;for(X=0;X<Z;X++)k[Z+X]=-k[X];var oe=j.length,ce=0;for(ce=0;ce<oe;ce++)j[ce+oe]=j[ce];for(z=z||new F.f(0,0,1,1),G=G||new F.f(0,0,1,1),ce=0,H=0;H<oe/2;H++)j[ce]=z.x+(z.z-z.x)*j[ce],j[ce+1]=z.y+(z.w-z.y)*j[ce+1],j[ce+oe]=G.x+(G.z-G.x)*j[ce+oe],j[ce+oe+1]=G.y+(G.w-G.y)*j[ce+oe+1],ce+=2}},e.ImportVertexData=function(D,w){var N=new e,F=D.positions;F&&N.set(F,k.b.PositionKind);var j=D.normals;j&&N.set(j,k.b.NormalKind);var G=D.tangents;G&&N.set(G,k.b.TangentKind);var H=D.uvs;H&&N.set(H,k.b.UVKind);var X=D.uv2s;X&&N.set(X,k.b.UV2Kind);var q=D.uv3s;q&&N.set(q,k.b.UV3Kind);var Z=D.uv4s;Z&&N.set(Z,k.b.UV4Kind);var J=D.uv5s;J&&N.set(J,k.b.UV5Kind);var $=D.uv6s;$&&N.set($,k.b.UV6Kind);var te=D.colors;te&&N.set(z.b.CheckColors4(te,F.length/3),k.b.ColorKind);var ie=D.matricesIndices;ie&&N.set(ie,k.b.MatricesIndicesKind);var oe=D.matricesWeights;oe&&N.set(oe,k.b.MatricesWeightsKind);var ce=D.indices;ce&&(N.indices=ce),w.setAllVerticesData(N,D.updatable)},e.FRONTSIDE=0,e.BACKSIDE=1,e.DOUBLESIDE=2,e.DEFAULTSIDE=0,e}()},function(D,w,N){"use strict";N.d(w,"a",(function(){return X}));var F=N(7),k=N(18),j=N(23),z=N(4),G=N(50),H=N(10),X=function(){function e(){}return e.BindEyePosition=function(D,w){if(w._forcedViewPosition)D.setVector3("vEyePosition",w._forcedViewPosition);else{var N=w.activeCamera.globalPosition;N||(N=w.activeCamera.devicePosition),D.setVector3("vEyePosition",w._mirroredCameraPosition?w._mirroredCameraPosition:N)}},e.PrepareDefinesForMergedUV=function(D,w,N){w._needUVs=!0,w[N]=!0,D.getTextureMatrix().isIdentityAs3x2()?(w[N+"DIRECTUV"]=D.coordinatesIndex+1,0===D.coordinatesIndex?w.MAINUV1=!0:w.MAINUV2=!0):w[N+"DIRECTUV"]=0},e.BindTextureMatrix=function(D,w,N){var F=D.getTextureMatrix();w.updateMatrix(N+"Matrix",F)},e.GetFogState=function(D,w){return w.fogEnabled&&D.applyFog&&w.fogMode!==k.a.FOGMODE_NONE},e.PrepareDefinesForMisc=function(D,w,N,F,k,j,z){z._areMiscDirty&&(z.LOGARITHMICDEPTH=N,z.POINTSIZE=F,z.FOG=k&&this.GetFogState(D,w),z.NONUNIFORMSCALING=D.nonUniformScaling,z.ALPHATEST=j)},e.PrepareDefinesForFrameBoundValues=function(D,w,N,F,k){void 0===k&&(k=null);var j,z,G,H,X,q,Z=!1;j=null==k?void 0!==D.clipPlane&&null!==D.clipPlane:k,z=null==k?void 0!==D.clipPlane2&&null!==D.clipPlane2:k,G=null==k?void 0!==D.clipPlane3&&null!==D.clipPlane3:k,H=null==k?void 0!==D.clipPlane4&&null!==D.clipPlane4:k,X=null==k?void 0!==D.clipPlane5&&null!==D.clipPlane5:k,q=null==k?void 0!==D.clipPlane6&&null!==D.clipPlane6:k,N.CLIPPLANE!==j&&(N.CLIPPLANE=j,Z=!0),N.CLIPPLANE2!==z&&(N.CLIPPLANE2=z,Z=!0),N.CLIPPLANE3!==G&&(N.CLIPPLANE3=G,Z=!0),N.CLIPPLANE4!==H&&(N.CLIPPLANE4=H,Z=!0),N.CLIPPLANE5!==X&&(N.CLIPPLANE5=X,Z=!0),N.CLIPPLANE6!==q&&(N.CLIPPLANE6=q,Z=!0),N.DEPTHPREPASS!==!w.getColorWrite()&&(N.DEPTHPREPASS=!N.DEPTHPREPASS,Z=!0),N.INSTANCES!==F&&(N.INSTANCES=F,Z=!0),Z&&N.markAsUnprocessed()},e.PrepareDefinesForBones=function(D,w){if(D.useBones&&D.computeBonesUsingShaders&&D.skeleton){w.NUM_BONE_INFLUENCERS=D.numBoneInfluencers;var N=void 0!==w.BONETEXTURE;D.skeleton.isUsingTextureForMatrices&&N?w.BONETEXTURE=!0:(w.BonesPerMesh=D.skeleton.bones.length+1,w.BONETEXTURE=!N&&void 0)}else w.NUM_BONE_INFLUENCERS=0,w.BonesPerMesh=0},e.PrepareDefinesForMorphTargets=function(D,w){var N=D.morphTargetManager;N?(w.MORPHTARGETS_UV=N.supportsUVs&&w.UV1,w.MORPHTARGETS_TANGENT=N.supportsTangents&&w.TANGENT,w.MORPHTARGETS_NORMAL=N.supportsNormals&&w.NORMAL,w.MORPHTARGETS=N.numInfluencers>0,w.NUM_MORPH_INFLUENCERS=N.numInfluencers):(w.MORPHTARGETS_UV=!1,w.MORPHTARGETS_TANGENT=!1,w.MORPHTARGETS_NORMAL=!1,w.MORPHTARGETS=!1,w.NUM_MORPH_INFLUENCERS=0)},e.PrepareDefinesForAttributes=function(D,w,N,F,k,j){if(void 0===k&&(k=!1),void 0===j&&(j=!0),!w._areAttributesDirty&&w._needNormals===w._normals&&w._needUVs===w._uvs)return!1;if(w._normals=w._needNormals,w._uvs=w._needUVs,w.NORMAL=w._needNormals&&D.isVerticesDataPresent(z.b.NormalKind),w._needNormals&&D.isVerticesDataPresent(z.b.TangentKind)&&(w.TANGENT=!0),w._needUVs?(w.UV1=D.isVerticesDataPresent(z.b.UVKind),w.UV2=D.isVerticesDataPresent(z.b.UV2Kind)):(w.UV1=!1,w.UV2=!1),N){var G=D.useVertexColors&&D.isVerticesDataPresent(z.b.ColorKind);w.VERTEXCOLOR=G,w.VERTEXALPHA=D.hasVertexAlpha&&G&&j}return F&&this.PrepareDefinesForBones(D,w),k&&this.PrepareDefinesForMorphTargets(D,w),!0},e.PrepareDefinesForMultiview=function(D,w){if(D.activeCamera){var N=w.MULTIVIEW;w.MULTIVIEW=null!==D.activeCamera.outputRenderTarget&&D.activeCamera.outputRenderTarget.getViewCount()>1,w.MULTIVIEW!=N&&w.markAsUnprocessed()}},e.PrepareDefinesForLight=function(D,w,N,F,k,j,z){switch(z.needNormals=!0,void 0===k["LIGHT"+F]&&(z.needRebuild=!0),k["LIGHT"+F]=!0,k["SPOTLIGHT"+F]=!1,k["HEMILIGHT"+F]=!1,k["POINTLIGHT"+F]=!1,k["DIRLIGHT"+F]=!1,N.prepareLightSpecificDefines(k,F),k["LIGHT_FALLOFF_PHYSICAL"+F]=!1,k["LIGHT_FALLOFF_GLTF"+F]=!1,k["LIGHT_FALLOFF_STANDARD"+F]=!1,N.falloffType){case G.a.FALLOFF_GLTF:k["LIGHT_FALLOFF_GLTF"+F]=!0;break;case G.a.FALLOFF_PHYSICAL:k["LIGHT_FALLOFF_PHYSICAL"+F]=!0;break;case G.a.FALLOFF_STANDARD:k["LIGHT_FALLOFF_STANDARD"+F]=!0}if(j&&!N.specular.equalsFloats(0,0,0)&&(z.specularEnabled=!0),k["SHADOW"+F]=!1,k["SHADOWCSM"+F]=!1,k["SHADOWCSMDEBUG"+F]=!1,k["SHADOWCSMNUM_CASCADES"+F]=!1,k["SHADOWCSMUSESHADOWMAXZ"+F]=!1,k["SHADOWCSMNOBLEND"+F]=!1,k["SHADOWCSM_RIGHTHANDED"+F]=!1,k["SHADOWPCF"+F]=!1,k["SHADOWPCSS"+F]=!1,k["SHADOWPOISSON"+F]=!1,k["SHADOWESM"+F]=!1,k["SHADOWCUBE"+F]=!1,k["SHADOWLOWQUALITY"+F]=!1,k["SHADOWMEDIUMQUALITY"+F]=!1,w&&w.receiveShadows&&D.shadowsEnabled&&N.shadowEnabled){var H=N.getShadowGenerator();if(H){var X=H.getShadowMap();X&&X.renderList&&X.renderList.length>0&&(z.shadowEnabled=!0,H.prepareDefines(k,F))}}N.lightmapMode!=G.a.LIGHTMAP_DEFAULT?(z.lightmapMode=!0,k["LIGHTMAPEXCLUDED"+F]=!0,k["LIGHTMAPNOSPECULAR"+F]=N.lightmapMode==G.a.LIGHTMAP_SHADOWSONLY):(k["LIGHTMAPEXCLUDED"+F]=!1,k["LIGHTMAPNOSPECULAR"+F]=!1)},e.PrepareDefinesForLights=function(D,w,N,F,k,j){if(void 0===k&&(k=4),void 0===j&&(j=!1),!N._areLightsDirty)return N._needNormals;var z=0,G={needNormals:!1,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(D.lightsEnabled&&!j)for(var H=0,X=w.lightSources;H<X.length;H++){var q=X[H];if(this.PrepareDefinesForLight(D,w,q,z,N,F,G),++z===k)break}N.SPECULARTERM=G.specularEnabled,N.SHADOWS=G.shadowEnabled;for(var Z=z;Z<k;Z++)void 0!==N["LIGHT"+Z]&&(N["LIGHT"+Z]=!1,N["HEMILIGHT"+Z]=!1,N["POINTLIGHT"+Z]=!1,N["DIRLIGHT"+Z]=!1,N["SPOTLIGHT"+Z]=!1,N["SHADOW"+Z]=!1,N["SHADOWCSM"+Z]=!1,N["SHADOWCSMDEBUG"+Z]=!1,N["SHADOWCSMNUM_CASCADES"+Z]=!1,N["SHADOWCSMUSESHADOWMAXZ"+Z]=!1,N["SHADOWCSMNOBLEND"+Z]=!1,N["SHADOWCSM_RIGHTHANDED"+Z]=!1,N["SHADOWPCF"+Z]=!1,N["SHADOWPCSS"+Z]=!1,N["SHADOWPOISSON"+Z]=!1,N["SHADOWESM"+Z]=!1,N["SHADOWCUBE"+Z]=!1,N["SHADOWLOWQUALITY"+Z]=!1,N["SHADOWMEDIUMQUALITY"+Z]=!1);var J=D.getEngine().getCaps();return void 0===N.SHADOWFLOAT&&(G.needRebuild=!0),N.SHADOWFLOAT=G.shadowEnabled&&(J.textureFloatRender&&J.textureFloatLinearFiltering||J.textureHalfFloatRender&&J.textureHalfFloatLinearFiltering),N.LIGHTMAPEXCLUDED=G.lightmapMode,G.needRebuild&&N.rebuild(),G.needNormals},e.PrepareUniformsAndSamplersForLight=function(D,w,N,F,k){void 0===k&&(k=null),w.push("vLightData"+D,"vLightDiffuse"+D,"vLightSpecular"+D,"vLightDirection"+D,"vLightFalloff"+D,"vLightGround"+D,"lightMatrix"+D,"shadowsInfo"+D,"depthValues"+D),k&&k.push("Light"+D),N.push("shadowSampler"+D),N.push("depthSampler"+D),w.push("viewFrustumZ"+D,"cascadeBlendFactor"+D,"lightSizeUVCorrection"+D,"depthCorrection"+D,"penumbraDarkness"+D,"frustumLengths"+D),F&&(N.push("projectionLightSampler"+D),w.push("textureProjectionMatrix"+D))},e.PrepareUniformsAndSamplersList=function(D,w,N,F){var k;void 0===F&&(F=4);var j=null;if(D.uniformsNames){var z=D;k=z.uniformsNames,j=z.uniformBuffersNames,w=z.samplers,N=z.defines,F=z.maxSimultaneousLights||0}else k=D,w||(w=[]);for(var G=0;G<F&&N["LIGHT"+G];G++)this.PrepareUniformsAndSamplersForLight(G,k,w,N["PROJECTEDLIGHTTEXTURE"+G],j);N.NUM_MORPH_INFLUENCERS&&k.push("morphTargetInfluences")},e.HandleFallbacksForShadows=function(D,w,N,F){void 0===N&&(N=4),void 0===F&&(F=0);for(var k=0,j=0;j<N&&D["LIGHT"+j];j++)j>0&&(k=F+j,w.addFallback(k,"LIGHT"+j)),D.SHADOWS||(D["SHADOW"+j]&&w.addFallback(F,"SHADOW"+j),D["SHADOWPCF"+j]&&w.addFallback(F,"SHADOWPCF"+j),D["SHADOWPCSS"+j]&&w.addFallback(F,"SHADOWPCSS"+j),D["SHADOWPOISSON"+j]&&w.addFallback(F,"SHADOWPOISSON"+j),D["SHADOWESM"+j]&&w.addFallback(F,"SHADOWESM"+j));return k++},e.PrepareAttributesForMorphTargetsInfluencers=function(D,w,N){this._TmpMorphInfluencers.NUM_MORPH_INFLUENCERS=N,this.PrepareAttributesForMorphTargets(D,w,this._TmpMorphInfluencers)},e.PrepareAttributesForMorphTargets=function(D,w,N){var k=N.NUM_MORPH_INFLUENCERS;if(k>0&&j.a.LastCreatedEngine)for(var G=j.a.LastCreatedEngine.getCaps().maxVertexAttribs,H=w.morphTargetManager,X=H&&H.supportsNormals&&N.NORMAL,q=H&&H.supportsTangents&&N.TANGENT,Z=H&&H.supportsUVs&&N.UV1,J=0;J<k;J++)D.push(z.b.PositionKind+J),X&&D.push(z.b.NormalKind+J),q&&D.push(z.b.TangentKind+J),Z&&D.push(z.b.UVKind+"_"+J),D.length>G&&F.a.Error("Cannot add more vertex attributes for mesh "+w.name)},e.PrepareAttributesForBones=function(D,w,N,F){N.NUM_BONE_INFLUENCERS>0&&(F.addCPUSkinningFallback(0,w),D.push(z.b.MatricesIndicesKind),D.push(z.b.MatricesWeightsKind),N.NUM_BONE_INFLUENCERS>4&&(D.push(z.b.MatricesIndicesExtraKind),D.push(z.b.MatricesWeightsExtraKind)))},e.PrepareAttributesForInstances=function(D,w){w.INSTANCES&&this.PushAttributesForInstances(D)},e.PushAttributesForInstances=function(D){D.push("world0"),D.push("world1"),D.push("world2"),D.push("world3")},e.BindLightProperties=function(D,w,N){D.transferToEffect(w,N+"")},e.BindLight=function(D,w,N,F,k,j){void 0===j&&(j=!1),D._bindLight(w,N,F,k,j)},e.BindLights=function(D,w,N,F,k,j){void 0===k&&(k=4),void 0===j&&(j=!1);for(var z=Math.min(w.lightSources.length,k),G=0;G<z;G++){var H=w.lightSources[G];this.BindLight(H,G,D,N,"boolean"==typeof F?F:F.SPECULARTERM,j)}},e.BindFogParameters=function(D,w,N,F){void 0===F&&(F=!1),D.fogEnabled&&w.applyFog&&D.fogMode!==k.a.FOGMODE_NONE&&(N.setFloat4("vFogInfos",D.fogMode,D.fogStart,D.fogEnd,D.fogDensity),F?(D.fogColor.toLinearSpaceToRef(this._tempFogColor),N.setColor3("vFogColor",this._tempFogColor)):N.setColor3("vFogColor",D.fogColor))},e.BindBonesParameters=function(D,w){if(w&&D&&(D.computeBonesUsingShaders&&w._bonesComputationForcedToCPU&&(D.computeBonesUsingShaders=!1),D.useBones&&D.computeBonesUsingShaders&&D.skeleton)){var N=D.skeleton;if(N.isUsingTextureForMatrices&&w.getUniformIndex("boneTextureWidth")>-1){var F=N.getTransformMatrixTexture(D);w.setTexture("boneSampler",F),w.setFloat("boneTextureWidth",4*(N.bones.length+1))}else{var k=N.getTransformMatrices(D);k&&w.setMatrices("mBones",k)}}},e.BindMorphTargetParameters=function(D,w){var N=D.morphTargetManager;D&&N&&w.setFloatArray("morphTargetInfluences",N.influences)},e.BindLogDepth=function(D,w,N){D.LOGARITHMICDEPTH&&w.setFloat("logarithmicDepthConstant",2/(Math.log(N.activeCamera.maxZ+1)/Math.LN2))},e.BindClipPlane=function(D,w){if(w.clipPlane){var N=w.clipPlane;D.setFloat4("vClipPlane",N.normal.x,N.normal.y,N.normal.z,N.d)}w.clipPlane2&&(N=w.clipPlane2,D.setFloat4("vClipPlane2",N.normal.x,N.normal.y,N.normal.z,N.d)),w.clipPlane3&&(N=w.clipPlane3,D.setFloat4("vClipPlane3",N.normal.x,N.normal.y,N.normal.z,N.d)),w.clipPlane4&&(N=w.clipPlane4,D.setFloat4("vClipPlane4",N.normal.x,N.normal.y,N.normal.z,N.d)),w.clipPlane5&&(N=w.clipPlane5,D.setFloat4("vClipPlane5",N.normal.x,N.normal.y,N.normal.z,N.d)),w.clipPlane6&&(N=w.clipPlane6,D.setFloat4("vClipPlane6",N.normal.x,N.normal.y,N.normal.z,N.d))},e._TmpMorphInfluencers={NUM_MORPH_INFLUENCERS:0},e._tempFogColor=H.a.Black(),e}()},function(D,w,N){"use strict";N.d(w,"a",(function(){return k})),N.d(w,"b",(function(){return j}));var F=N(1),k=function(){function e(){}return e.NAME_EFFECTLAYER="EffectLayer",e.NAME_LAYER="Layer",e.NAME_LENSFLARESYSTEM="LensFlareSystem",e.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",e.NAME_PARTICLESYSTEM="ParticleSystem",e.NAME_GAMEPAD="Gamepad",e.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",e.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",e.NAME_DEPTHRENDERER="DepthRenderer",e.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",e.NAME_SPRITE="Sprite",e.NAME_OUTLINERENDERER="Outline",e.NAME_PROCEDURALTEXTURE="ProceduralTexture",e.NAME_SHADOWGENERATOR="ShadowGenerator",e.NAME_OCTREE="Octree",e.NAME_PHYSICSENGINE="PhysicsEngine",e.NAME_AUDIO="Audio",e.STEP_ISREADYFORMESH_EFFECTLAYER=0,e.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,e.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,e.STEP_ACTIVEMESH_BOUNDINGBOXRENDERER=0,e.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,e.STEP_BEFORECAMERADRAW_EFFECTLAYER=0,e.STEP_BEFORECAMERADRAW_LAYER=1,e.STEP_BEFORERENDERTARGETDRAW_LAYER=0,e.STEP_BEFORERENDERINGMESH_OUTLINE=0,e.STEP_AFTERRENDERINGMESH_OUTLINE=0,e.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,e.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,e.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,e.STEP_BEFORECAMERAUPDATE_GAMEPAD=1,e.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,e.STEP_AFTERRENDERTARGETDRAW_LAYER=0,e.STEP_AFTERCAMERADRAW_EFFECTLAYER=0,e.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=1,e.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=2,e.STEP_AFTERCAMERADRAW_LAYER=3,e.STEP_AFTERRENDER_AUDIO=0,e.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0,e.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,e.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2,e.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,e.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,e.STEP_POINTERMOVE_SPRITE=0,e.STEP_POINTERDOWN_SPRITE=0,e.STEP_POINTERUP_SPRITE=0,e}(),j=function(D){function t(w){return D.apply(this,w)||this}return Object(F.d)(t,D),t.Create=function(){return Object.create(t.prototype)},t.prototype.registerStep=function(D,w,N){var F=0;for(Number.MAX_VALUE;F<this.length&&!(D<this[F].index);F++);this.splice(F,0,{index:D,component:w,action:N.bind(w)})},t.prototype.clear=function(){this.length=0},t}(Array)},function(D,w,N){"use strict";var F=N(1),k=N(13),j=N(52),z=N(6),G=N(34),H=N(103),X=N(35),q=N(0),Z=N(43),J=N(27),$=N(24),te=N(37),ie=N(40),oe=N(83),ce=N(50),he=N(53),fe=N(45),pe=N(90),_e=N(91),ve=N(17),ye=N(2),be=N(38),Te=N(7),Ee=N(23),Se=N(19),Me=N(20),xe=N(87),Ae=N(63),Pe=function(){function e(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}return Object.defineProperty(e.prototype,"singleClick",{get:function(){return this._singleClick},set:function(D){this._singleClick=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"doubleClick",{get:function(){return this._doubleClick},set:function(D){this._doubleClick=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasSwiped",{get:function(){return this._hasSwiped},set:function(D){this._hasSwiped=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ignore",{get:function(){return this._ignore},set:function(D){this._ignore=D},enumerable:!0,configurable:!0}),e}(),Oe=function(){function e(D){this._wheelEventName="",this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._totalPointersPressed=0,this._doubleClickOccured=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new q.d(0,0),this._previousStartingPointerPosition=new q.d(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._scene=D}return Object.defineProperty(e.prototype,"meshUnderPointer",{get:function(){return this._pointerOverMesh},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"unTranslatedPointer",{get:function(){return new q.d(this._unTranslatedPointerX,this._unTranslatedPointerY)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pointerX",{get:function(){return this._pointerX},set:function(D){this._pointerX=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pointerY",{get:function(){return this._pointerY},set:function(D){this._pointerY=D},enumerable:!0,configurable:!0}),e.prototype._updatePointerPosition=function(D){var w=this._scene.getEngine().getInputElementClientRect();w&&(this._pointerX=D.clientX-w.left,this._pointerY=D.clientY-w.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)},e.prototype._processPointerMove=function(D,w){var N=this._scene,F=N.getEngine(),k=F.getInputElement();if(k){k.tabIndex=F.canvasTabIndex,N.doNotHandleCursors||(k.style.cursor=N.defaultCursor);var j=!!(D&&D.hit&&D.pickedMesh);j?(N.setPointerOverMesh(D.pickedMesh),this._pointerOverMesh&&this._pointerOverMesh.actionManager&&this._pointerOverMesh.actionManager.hasPointerTriggers&&(N.doNotHandleCursors||(this._pointerOverMesh.actionManager.hoverCursor?k.style.cursor=this._pointerOverMesh.actionManager.hoverCursor:k.style.cursor=N.hoverCursor))):N.setPointerOverMesh(null);for(var z=0,G=N._pointerMoveStage;z<G.length;z++)D=G[z].action(this._unTranslatedPointerX,this._unTranslatedPointerY,D,j,k);if(D){var H=w.type===this._wheelEventName?Me.a.POINTERWHEEL:Me.a.POINTERMOVE;if(N.onPointerMove&&N.onPointerMove(w,D,H),N.onPointerObservable.hasObservers()){var X=new Me.b(H,w,D);this._setRayOnPointerInfo(X),N.onPointerObservable.notifyObservers(X,H)}}}},e.prototype._setRayOnPointerInfo=function(D){var w=this._scene;D.pickInfo&&!D.pickInfo._pickingUnavailable&&(D.pickInfo.ray||(D.pickInfo.ray=w.createPickingRay(D.event.offsetX,D.event.offsetY,q.a.Identity(),w.activeCamera)))},e.prototype._checkPrePointerObservable=function(D,w,N){var F=this._scene,k=new Me.d(N,w,this._unTranslatedPointerX,this._unTranslatedPointerY);return D&&(k.ray=D.ray),F.onPrePointerObservable.notifyObservers(k,N),!!k.skipOnPointerObservable},e.prototype.simulatePointerMove=function(D,w){var N=new PointerEvent("pointermove",w);this._checkPrePointerObservable(D,N,Me.a.POINTERMOVE)||this._processPointerMove(D,N)},e.prototype.simulatePointerDown=function(D,w){var N=new PointerEvent("pointerdown",w);this._checkPrePointerObservable(D,N,Me.a.POINTERDOWN)||this._processPointerDown(D,N)},e.prototype._processPointerDown=function(D,w){var N=this,F=this._scene;if(D&&D.hit&&D.pickedMesh){this._pickedDownMesh=D.pickedMesh;var k=D.pickedMesh._getActionManagerForTrigger();if(k){if(k.hasPickTriggers)switch(k.processTrigger(ye.a.ACTION_OnPickDownTrigger,fe.a.CreateNew(D.pickedMesh,w)),w.button){case 0:k.processTrigger(ye.a.ACTION_OnLeftPickTrigger,fe.a.CreateNew(D.pickedMesh,w));break;case 1:k.processTrigger(ye.a.ACTION_OnCenterPickTrigger,fe.a.CreateNew(D.pickedMesh,w));break;case 2:k.processTrigger(ye.a.ACTION_OnRightPickTrigger,fe.a.CreateNew(D.pickedMesh,w))}k.hasSpecificTrigger(ye.a.ACTION_OnLongPressTrigger)&&window.setTimeout((function(){var D=F.pick(N._unTranslatedPointerX,N._unTranslatedPointerY,(function(D){return D.isPickable&&D.isVisible&&D.isReady()&&D.actionManager&&D.actionManager.hasSpecificTrigger(ye.a.ACTION_OnLongPressTrigger)&&D==N._pickedDownMesh}),!1,F.cameraToUseForPointers);D&&D.hit&&D.pickedMesh&&k&&0!==N._totalPointersPressed&&Date.now()-N._startingPointerTime>e.LongPressDelay&&!N._isPointerSwiping()&&(N._startingPointerTime=0,k.processTrigger(ye.a.ACTION_OnLongPressTrigger,fe.a.CreateNew(D.pickedMesh,w)))}),e.LongPressDelay)}}else for(var j=0,z=F._pointerDownStage;j<z.length;j++)D=z[j].action(this._unTranslatedPointerX,this._unTranslatedPointerY,D,w);if(D){var G=Me.a.POINTERDOWN;if(F.onPointerDown&&F.onPointerDown(w,D,G),F.onPointerObservable.hasObservers()){var H=new Me.b(G,w,D);this._setRayOnPointerInfo(H),F.onPointerObservable.notifyObservers(H,G)}}},e.prototype._isPointerSwiping=function(){return Math.abs(this._startingPointerPosition.x-this._pointerX)>e.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>e.DragMovementThreshold},e.prototype.simulatePointerUp=function(D,w,N){var F=new PointerEvent("pointerup",w),k=new Pe;N?k.doubleClick=!0:k.singleClick=!0,this._checkPrePointerObservable(D,F,Me.a.POINTERUP)||this._processPointerUp(D,F,k)},e.prototype._processPointerUp=function(D,w,N){var F=this._scene;if(D&&D&&D.pickedMesh){if(this._pickedUpMesh=D.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(F.onPointerPick&&F.onPointerPick(w,D),N.singleClick&&!N.ignore&&F.onPointerObservable.hasObservers())){var k=Me.a.POINTERPICK,j=new Me.b(k,w,D);this._setRayOnPointerInfo(j),F.onPointerObservable.notifyObservers(j,k)}var z=D.pickedMesh._getActionManagerForTrigger();if(z&&!N.ignore){z.processTrigger(ye.a.ACTION_OnPickUpTrigger,fe.a.CreateNew(D.pickedMesh,w)),!N.hasSwiped&&N.singleClick&&z.processTrigger(ye.a.ACTION_OnPickTrigger,fe.a.CreateNew(D.pickedMesh,w));var G=D.pickedMesh._getActionManagerForTrigger(ye.a.ACTION_OnDoublePickTrigger);N.doubleClick&&G&&G.processTrigger(ye.a.ACTION_OnDoublePickTrigger,fe.a.CreateNew(D.pickedMesh,w))}}else if(!N.ignore)for(var H=0,X=F._pointerUpStage;H<X.length;H++)D=X[H].action(this._unTranslatedPointerX,this._unTranslatedPointerY,D,w);if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){var q=this._pickedDownMesh._getActionManagerForTrigger(ye.a.ACTION_OnPickOutTrigger);q&&q.processTrigger(ye.a.ACTION_OnPickOutTrigger,fe.a.CreateNew(this._pickedDownMesh,w))}var Z=0;F.onPointerObservable.hasObservers()&&(N.ignore||N.hasSwiped||(N.singleClick&&F.onPointerObservable.hasSpecificMask(Me.a.POINTERTAP)?Z=Me.a.POINTERTAP:N.doubleClick&&F.onPointerObservable.hasSpecificMask(Me.a.POINTERDOUBLETAP)&&(Z=Me.a.POINTERDOUBLETAP),!Z)||(j=new Me.b(Z,w,D),this._setRayOnPointerInfo(j),F.onPointerObservable.notifyObservers(j,Z)),N.ignore||(Z=Me.a.POINTERUP,j=new Me.b(Z,w,D),this._setRayOnPointerInfo(j),F.onPointerObservable.notifyObservers(j,Z))),F.onPointerUp&&!N.ignore&&F.onPointerUp(w,D,Z)},e.prototype.isPointerCaptured=function(D){return void 0===D&&(D=0),this._pointerCaptures[D]},e.prototype.attachControl=function(D,w,N,F){var j=this;void 0===D&&(D=!0),void 0===w&&(w=!0),void 0===N&&(N=!0),void 0===F&&(F=null);var z=this._scene;if(F||(F=z.getEngine().getInputElement()),F){var G,H=z.getEngine();this._initActionManager=function(D,w){if(!j._meshPickProceed){var N=z.pick(j._unTranslatedPointerX,j._unTranslatedPointerY,z.pointerDownPredicate,!1,z.cameraToUseForPointers);j._currentPickResult=N,N&&(D=N.hit&&N.pickedMesh?N.pickedMesh._getActionManagerForTrigger():null),j._meshPickProceed=!0}return D},this._delayedSimpleClick=function(D,w,N){(Date.now()-j._previousStartingPointerTime>e.DoubleClickDelay&&!j._doubleClickOccured||D!==j._previousButtonPressed)&&(j._doubleClickOccured=!1,w.singleClick=!0,w.ignore=!1,N(w,j._currentPickResult))},this._initClickEvent=function(D,w,N,F){var k=new Pe;j._currentPickResult=null;var z=null,G=D.hasSpecificMask(Me.a.POINTERPICK)||w.hasSpecificMask(Me.a.POINTERPICK)||D.hasSpecificMask(Me.a.POINTERTAP)||w.hasSpecificMask(Me.a.POINTERTAP)||D.hasSpecificMask(Me.a.POINTERDOUBLETAP)||w.hasSpecificMask(Me.a.POINTERDOUBLETAP);!G&&xe.a&&(z=j._initActionManager(z,k))&&(G=z.hasPickTriggers);var H=!1;if(G){var X=N.button;if(k.hasSwiped=j._isPointerSwiping(),!k.hasSwiped){var q=!e.ExclusiveDoubleClickMode;q||(q=!D.hasSpecificMask(Me.a.POINTERDOUBLETAP)&&!w.hasSpecificMask(Me.a.POINTERDOUBLETAP))&&!xe.a.HasSpecificTrigger(ye.a.ACTION_OnDoublePickTrigger)&&(z=j._initActionManager(z,k))&&(q=!z.hasSpecificTrigger(ye.a.ACTION_OnDoublePickTrigger)),q?(Date.now()-j._previousStartingPointerTime>e.DoubleClickDelay||X!==j._previousButtonPressed)&&(k.singleClick=!0,F(k,j._currentPickResult),H=!0):(j._previousDelayedSimpleClickTimeout=j._delayedSimpleClickTimeout,j._delayedSimpleClickTimeout=window.setTimeout(j._delayedSimpleClick.bind(j,X,k,F),e.DoubleClickDelay));var Z=D.hasSpecificMask(Me.a.POINTERDOUBLETAP)||w.hasSpecificMask(Me.a.POINTERDOUBLETAP);!Z&&xe.a.HasSpecificTrigger(ye.a.ACTION_OnDoublePickTrigger)&&(z=j._initActionManager(z,k))&&(Z=z.hasSpecificTrigger(ye.a.ACTION_OnDoublePickTrigger)),Z&&(X===j._previousButtonPressed&&Date.now()-j._previousStartingPointerTime<e.DoubleClickDelay&&!j._doubleClickOccured?(k.hasSwiped||j._isPointerSwiping()?(j._doubleClickOccured=!1,j._previousStartingPointerTime=j._startingPointerTime,j._previousStartingPointerPosition.x=j._startingPointerPosition.x,j._previousStartingPointerPosition.y=j._startingPointerPosition.y,j._previousButtonPressed=X,e.ExclusiveDoubleClickMode?(j._previousDelayedSimpleClickTimeout&&clearTimeout(j._previousDelayedSimpleClickTimeout),j._previousDelayedSimpleClickTimeout=j._delayedSimpleClickTimeout,F(k,j._previousPickResult)):F(k,j._currentPickResult)):(j._previousStartingPointerTime=0,j._doubleClickOccured=!0,k.doubleClick=!0,k.ignore=!1,e.ExclusiveDoubleClickMode&&j._previousDelayedSimpleClickTimeout&&clearTimeout(j._previousDelayedSimpleClickTimeout),j._previousDelayedSimpleClickTimeout=j._delayedSimpleClickTimeout,F(k,j._currentPickResult)),H=!0):(j._doubleClickOccured=!1,j._previousStartingPointerTime=j._startingPointerTime,j._previousStartingPointerPosition.x=j._startingPointerPosition.x,j._previousStartingPointerPosition.y=j._startingPointerPosition.y,j._previousButtonPressed=X))}}H||F(k,j._currentPickResult)},this._onPointerMove=function(D){if(j._updatePointerPosition(D),!j._checkPrePointerObservable(null,D,D.type===j._wheelEventName?Me.a.POINTERWHEEL:Me.a.POINTERMOVE)&&(z.cameraToUseForPointers||z.activeCamera)){z.pointerMovePredicate||(z.pointerMovePredicate=function(D){return D.isPickable&&D.isVisible&&D.isReady()&&D.isEnabled()&&(D.enablePointerMoveEvents||z.constantlyUpdateMeshUnderPointer||null!=D._getActionManagerForTrigger())&&(!z.cameraToUseForPointers||0!=(z.cameraToUseForPointers.layerMask&D.layerMask))});var w=z.pick(j._unTranslatedPointerX,j._unTranslatedPointerY,z.pointerMovePredicate,!1,z.cameraToUseForPointers);j._processPointerMove(w,D)}},this._onPointerDown=function(D){if(j._totalPointersPressed++,j._pickedDownMesh=null,j._meshPickProceed=!1,j._updatePointerPosition(D),z.preventDefaultOnPointerDown&&F&&(D.preventDefault(),F.focus()),j._startingPointerPosition.x=j._pointerX,j._startingPointerPosition.y=j._pointerY,j._startingPointerTime=Date.now(),!j._checkPrePointerObservable(null,D,Me.a.POINTERDOWN)&&(z.cameraToUseForPointers||z.activeCamera)){j._pointerCaptures[D.pointerId]=!0,z.pointerDownPredicate||(z.pointerDownPredicate=function(D){return D.isPickable&&D.isVisible&&D.isReady()&&D.isEnabled()&&(!z.cameraToUseForPointers||0!=(z.cameraToUseForPointers.layerMask&D.layerMask))}),j._pickedDownMesh=null;var w=z.pick(j._unTranslatedPointerX,j._unTranslatedPointerY,z.pointerDownPredicate,!1,z.cameraToUseForPointers);j._processPointerDown(w,D)}},this._onPointerUp=function(D){0!==j._totalPointersPressed&&(j._totalPointersPressed--,j._pickedUpMesh=null,j._meshPickProceed=!1,j._updatePointerPosition(D),z.preventDefaultOnPointerUp&&F&&(D.preventDefault(),F.focus()),j._initClickEvent(z.onPrePointerObservable,z.onPointerObservable,D,(function(w,N){if(z.onPrePointerObservable.hasObservers()&&!w.ignore){if(!w.hasSwiped){if(w.singleClick&&z.onPrePointerObservable.hasSpecificMask(Me.a.POINTERTAP)&&j._checkPrePointerObservable(null,D,Me.a.POINTERTAP))return;if(w.doubleClick&&z.onPrePointerObservable.hasSpecificMask(Me.a.POINTERDOUBLETAP)&&j._checkPrePointerObservable(null,D,Me.a.POINTERDOUBLETAP))return}if(j._checkPrePointerObservable(null,D,Me.a.POINTERUP))return}j._pointerCaptures[D.pointerId]&&(j._pointerCaptures[D.pointerId]=!1,(z.cameraToUseForPointers||z.activeCamera)&&(z.pointerUpPredicate||(z.pointerUpPredicate=function(D){return D.isPickable&&D.isVisible&&D.isReady()&&D.isEnabled()&&(!z.cameraToUseForPointers||0!=(z.cameraToUseForPointers.layerMask&D.layerMask))}),!j._meshPickProceed&&(xe.a&&xe.a.HasTriggers||z.onPointerObservable.hasObservers())&&j._initActionManager(null,w),N||(N=j._currentPickResult),j._processPointerUp(N,D,w),j._previousPickResult=j._currentPickResult))})))},this._onKeyDown=function(D){var w=Ae.a.KEYDOWN;if(z.onPreKeyboardObservable.hasObservers()){var N=new Ae.c(w,D);if(z.onPreKeyboardObservable.notifyObservers(N,w),N.skipOnPointerObservable)return}z.onKeyboardObservable.hasObservers()&&(N=new Ae.b(w,D),z.onKeyboardObservable.notifyObservers(N,w)),z.actionManager&&z.actionManager.processTrigger(ye.a.ACTION_OnKeyDownTrigger,fe.a.CreateNewFromScene(z,D))},this._onKeyUp=function(D){var w=Ae.a.KEYUP;if(z.onPreKeyboardObservable.hasObservers()){var N=new Ae.c(w,D);if(z.onPreKeyboardObservable.notifyObservers(N,w),N.skipOnPointerObservable)return}z.onKeyboardObservable.hasObservers()&&(N=new Ae.b(w,D),z.onKeyboardObservable.notifyObservers(N,w)),z.actionManager&&z.actionManager.processTrigger(ye.a.ACTION_OnKeyUpTrigger,fe.a.CreateNewFromScene(z,D))},this._onCanvasFocusObserver=H.onCanvasFocusObservable.add((G=function(){F&&(F.addEventListener("keydown",j._onKeyDown,!1),F.addEventListener("keyup",j._onKeyUp,!1))},document.activeElement===F&&G(),G)),this._onCanvasBlurObserver=H.onCanvasBlurObservable.add((function(){F&&(F.removeEventListener("keydown",j._onKeyDown),F.removeEventListener("keyup",j._onKeyUp))}));var X=k.b.GetPointerPrefix();if(N&&(F.addEventListener(X+"move",this._onPointerMove,!1),this._wheelEventName="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",F.addEventListener(this._wheelEventName,this._onPointerMove,!1)),w&&F.addEventListener(X+"down",this._onPointerDown,!1),D){var q=z.getEngine().getHostWindow();q&&q.addEventListener(X+"up",this._onPointerUp,!1)}}},e.prototype.detachControl=function(){var D=k.b.GetPointerPrefix(),w=this._scene.getEngine().getInputElement(),N=this._scene.getEngine();w&&(w.removeEventListener(D+"move",this._onPointerMove),w.removeEventListener(this._wheelEventName,this._onPointerMove),w.removeEventListener(D+"down",this._onPointerDown),window.removeEventListener(D+"up",this._onPointerUp),this._onCanvasBlurObserver&&N.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onCanvasFocusObserver&&N.onCanvasFocusObservable.remove(this._onCanvasFocusObserver),w.removeEventListener("keydown",this._onKeyDown),w.removeEventListener("keyup",this._onKeyUp),this._scene.doNotHandleCursors||(w.style.cursor=this._scene.defaultCursor))},e.prototype.setPointerOverMesh=function(D){var w;this._pointerOverMesh!==D&&(this._pointerOverMesh&&(w=this._pointerOverMesh._getActionManagerForTrigger(ye.a.ACTION_OnPointerOutTrigger))&&w.processTrigger(ye.a.ACTION_OnPointerOutTrigger,fe.a.CreateNew(this._pointerOverMesh)),this._pointerOverMesh=D,this._pointerOverMesh&&(w=this._pointerOverMesh._getActionManagerForTrigger(ye.a.ACTION_OnPointerOverTrigger))&&w.processTrigger(ye.a.ACTION_OnPointerOverTrigger,fe.a.CreateNew(this._pointerOverMesh)))},e.prototype.getPointerOverMesh=function(){return this._pointerOverMesh},e.DragMovementThreshold=10,e.LongPressDelay=500,e.DoubleClickDelay=300,e.ExclusiveDoubleClickMode=!1,e}(),Re=N(51),De=N(10),Ie=N(86),Le=N(138),we=N(54);N.d(w,"a",(function(){return Ne}));var Ne=function(D){function t(w,N){var k=D.call(this)||this;k._inputManager=new Oe(k),k.cameraToUseForPointers=null,k._isScene=!0,k._blockEntityCollection=!1,k.autoClear=!0,k.autoClearDepthAndStencil=!0,k.clearColor=new De.b(.2,.2,.3,1),k.ambientColor=new De.a(0,0,0),k._environmentIntensity=1,k._forceWireframe=!1,k._skipFrustumClipping=!1,k._forcePointsCloud=!1,k.animationsEnabled=!0,k._animationPropertiesOverride=null,k.useConstantAnimationDeltaTime=!1,k.constantlyUpdateMeshUnderPointer=!1,k.hoverCursor="pointer",k.defaultCursor="",k.doNotHandleCursors=!1,k.preventDefaultOnPointerDown=!0,k.preventDefaultOnPointerUp=!0,k.metadata=null,k.reservedDataStore=null,k.disableOfflineSupportExceptionRules=new Array,k.onDisposeObservable=new z.c,k._onDisposeObserver=null,k.onBeforeRenderObservable=new z.c,k._onBeforeRenderObserver=null,k.onAfterRenderObservable=new z.c,k.onAfterRenderCameraObservable=new z.c,k._onAfterRenderObserver=null,k.onBeforeAnimationsObservable=new z.c,k.onAfterAnimationsObservable=new z.c,k.onBeforeDrawPhaseObservable=new z.c,k.onAfterDrawPhaseObservable=new z.c,k.onReadyObservable=new z.c,k.onBeforeCameraRenderObservable=new z.c,k._onBeforeCameraRenderObserver=null,k.onAfterCameraRenderObservable=new z.c,k._onAfterCameraRenderObserver=null,k.onBeforeActiveMeshesEvaluationObservable=new z.c,k.onAfterActiveMeshesEvaluationObservable=new z.c,k.onBeforeParticlesRenderingObservable=new z.c,k.onAfterParticlesRenderingObservable=new z.c,k.onDataLoadedObservable=new z.c,k.onNewCameraAddedObservable=new z.c,k.onCameraRemovedObservable=new z.c,k.onNewLightAddedObservable=new z.c,k.onLightRemovedObservable=new z.c,k.onNewGeometryAddedObservable=new z.c,k.onGeometryRemovedObservable=new z.c,k.onNewTransformNodeAddedObservable=new z.c,k.onTransformNodeRemovedObservable=new z.c,k.onNewMeshAddedObservable=new z.c,k.onMeshRemovedObservable=new z.c,k.onNewSkeletonAddedObservable=new z.c,k.onSkeletonRemovedObservable=new z.c,k.onNewMaterialAddedObservable=new z.c,k.onMaterialRemovedObservable=new z.c,k.onNewTextureAddedObservable=new z.c,k.onTextureRemovedObservable=new z.c,k.onBeforeRenderTargetsRenderObservable=new z.c,k.onAfterRenderTargetsRenderObservable=new z.c,k.onBeforeStepObservable=new z.c,k.onAfterStepObservable=new z.c,k.onActiveCameraChanged=new z.c,k.onBeforeRenderingGroupObservable=new z.c,k.onAfterRenderingGroupObservable=new z.c,k.onMeshImportedObservable=new z.c,k.onAnimationFileImportedObservable=new z.c,k._registeredForLateAnimationBindings=new G.b(256),k.onPrePointerObservable=new z.c,k.onPointerObservable=new z.c,k.onPreKeyboardObservable=new z.c,k.onKeyboardObservable=new z.c,k._useRightHandedSystem=!1,k._timeAccumulator=0,k._currentStepId=0,k._currentInternalStep=0,k._fogEnabled=!0,k._fogMode=t.FOGMODE_NONE,k.fogColor=new De.a(.2,.2,.3),k.fogDensity=.1,k.fogStart=0,k.fogEnd=1e3,k._shadowsEnabled=!0,k._lightsEnabled=!0,k.activeCameras=new Array,k._texturesEnabled=!0,k.particlesEnabled=!0,k.spritesEnabled=!0,k._skeletonsEnabled=!0,k.lensFlaresEnabled=!0,k.collisionsEnabled=!0,k.gravity=new q.e(0,-9.807,0),k.postProcessesEnabled=!0,k.postProcesses=new Array,k.renderTargetsEnabled=!0,k.dumpNextRenderTargets=!1,k.customRenderTargets=new Array,k.importedMeshesFiles=new Array,k.probesEnabled=!0,k._meshesForIntersections=new G.b(256),k.proceduralTexturesEnabled=!0,k._totalVertices=new Re.a,k._activeIndices=new Re.a,k._activeParticles=new Re.a,k._activeBones=new Re.a,k._animationTime=0,k.animationTimeScale=1,k._renderId=0,k._frameId=0,k._executeWhenReadyTimeoutId=-1,k._intermediateRendering=!1,k._viewUpdateFlag=-1,k._projectionUpdateFlag=-1,k._toBeDisposed=new Array(256),k._activeRequests=new Array,k._pendingData=new Array,k._isDisposed=!1,k.dispatchAllSubMeshesOfActiveMeshes=!1,k._activeMeshes=new G.a(256),k._processedMaterials=new G.a(256),k._renderTargets=new G.b(256),k._activeParticleSystems=new G.a(256),k._activeSkeletons=new G.b(32),k._softwareSkinnedMeshes=new G.b(32),k._activeAnimatables=new Array,k._transformMatrix=q.a.Zero(),k.requireLightSorting=!1,k._components=[],k._serializableComponents=[],k._transientComponents=[],k._beforeCameraUpdateStage=ve.b.Create(),k._beforeClearStage=ve.b.Create(),k._gatherRenderTargetsStage=ve.b.Create(),k._gatherActiveCameraRenderTargetsStage=ve.b.Create(),k._isReadyForMeshStage=ve.b.Create(),k._beforeEvaluateActiveMeshStage=ve.b.Create(),k._evaluateSubMeshStage=ve.b.Create(),k._activeMeshStage=ve.b.Create(),k._cameraDrawRenderTargetStage=ve.b.Create(),k._beforeCameraDrawStage=ve.b.Create(),k._beforeRenderTargetDrawStage=ve.b.Create(),k._beforeRenderingGroupDrawStage=ve.b.Create(),k._beforeRenderingMeshStage=ve.b.Create(),k._afterRenderingMeshStage=ve.b.Create(),k._afterRenderingGroupDrawStage=ve.b.Create(),k._afterCameraDrawStage=ve.b.Create(),k._afterRenderTargetDrawStage=ve.b.Create(),k._afterRenderStage=ve.b.Create(),k._pointerMoveStage=ve.b.Create(),k._pointerDownStage=ve.b.Create(),k._pointerUpStage=ve.b.Create(),k.geometriesByUniqueId=null,k._defaultMeshCandidates={data:[],length:0},k._defaultSubMeshCandidates={data:[],length:0},k._preventFreeActiveMeshesAndRenderingGroups=!1,k._activeMeshesFrozen=!1,k._skipEvaluateActiveMeshesCompletely=!1,k._allowPostProcessClearColor=!0,k.getDeterministicFrameTime=function(){return k._engine.getTimeStep()},k._blockMaterialDirtyMechanism=!1;var j=Object(F.a)({useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1},N);return k._engine=w||Ee.a.LastCreatedEngine,j.virtual||(Ee.a._LastCreatedScene=k,k._engine.scenes.push(k)),k._uid=null,k._renderingManager=new _e.b(k),pe.a&&(k.postProcessManager=new pe.a(k)),be.a.IsWindowObjectExist()&&k.attachControl(),k._createUbo(),ie.a&&(k._imageProcessingConfiguration=new ie.a),k.setDefaultCandidateProviders(),j.useGeometryUniqueIdsMap&&(k.geometriesByUniqueId={}),k.useMaterialMeshMap=j.useMaterialMeshMap,k.useClonedMeshMap=j.useClonedMeshMap,N&&N.virtual||k._engine.onNewSceneAddedObservable.notifyObservers(k),k}return Object(F.d)(t,D),t.DefaultMaterialFactory=function(D){throw Se.a.WarnImport("StandardMaterial")},t.CollisionCoordinatorFactory=function(){throw Se.a.WarnImport("DefaultCollisionCoordinator")},Object.defineProperty(t.prototype,"environmentTexture",{get:function(){return this._environmentTexture},set:function(D){this._environmentTexture!==D&&(this._environmentTexture=D,this.markAllMaterialsAsDirty(ye.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"environmentIntensity",{get:function(){return this._environmentIntensity},set:function(D){this._environmentIntensity!==D&&(this._environmentIntensity=D,this.markAllMaterialsAsDirty(ye.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"forceWireframe",{get:function(){return this._forceWireframe},set:function(D){this._forceWireframe!==D&&(this._forceWireframe=D,this.markAllMaterialsAsDirty(ye.a.MATERIAL_MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skipFrustumClipping",{get:function(){return this._skipFrustumClipping},set:function(D){this._skipFrustumClipping!==D&&(this._skipFrustumClipping=D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"forcePointsCloud",{get:function(){return this._forcePointsCloud},set:function(D){this._forcePointsCloud!==D&&(this._forcePointsCloud=D,this.markAllMaterialsAsDirty(ye.a.MATERIAL_MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride},set:function(D){this._animationPropertiesOverride=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onDispose",{set:function(D){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"beforeRender",{set:function(D){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),D&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(D))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"afterRender",{set:function(D){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),D&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(D))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"beforeCameraRender",{set:function(D){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"afterCameraRender",{set:function(D){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"unTranslatedPointer",{get:function(){return this._inputManager.unTranslatedPointer},enumerable:!0,configurable:!0}),Object.defineProperty(t,"DragMovementThreshold",{get:function(){return Oe.DragMovementThreshold},set:function(D){Oe.DragMovementThreshold=D},enumerable:!0,configurable:!0}),Object.defineProperty(t,"LongPressDelay",{get:function(){return Oe.LongPressDelay},set:function(D){Oe.LongPressDelay=D},enumerable:!0,configurable:!0}),Object.defineProperty(t,"DoubleClickDelay",{get:function(){return Oe.DoubleClickDelay},set:function(D){Oe.DoubleClickDelay=D},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ExclusiveDoubleClickMode",{get:function(){return Oe.ExclusiveDoubleClickMode},set:function(D){Oe.ExclusiveDoubleClickMode=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useRightHandedSystem",{get:function(){return this._useRightHandedSystem},set:function(D){this._useRightHandedSystem!==D&&(this._useRightHandedSystem=D,this.markAllMaterialsAsDirty(ye.a.MATERIAL_MiscDirtyFlag))},enumerable:!0,configurable:!0}),t.prototype.setStepId=function(D){this._currentStepId=D},t.prototype.getStepId=function(){return this._currentStepId},t.prototype.getInternalStep=function(){return this._currentInternalStep},Object.defineProperty(t.prototype,"fogEnabled",{get:function(){return this._fogEnabled},set:function(D){this._fogEnabled!==D&&(this._fogEnabled=D,this.markAllMaterialsAsDirty(ye.a.MATERIAL_MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fogMode",{get:function(){return this._fogMode},set:function(D){this._fogMode!==D&&(this._fogMode=D,this.markAllMaterialsAsDirty(ye.a.MATERIAL_MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowsEnabled",{get:function(){return this._shadowsEnabled},set:function(D){this._shadowsEnabled!==D&&(this._shadowsEnabled=D,this.markAllMaterialsAsDirty(ye.a.MATERIAL_LightDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lightsEnabled",{get:function(){return this._lightsEnabled},set:function(D){this._lightsEnabled!==D&&(this._lightsEnabled=D,this.markAllMaterialsAsDirty(ye.a.MATERIAL_LightDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"activeCamera",{get:function(){return this._activeCamera},set:function(D){D!==this._activeCamera&&(this._activeCamera=D,this.onActiveCameraChanged.notifyObservers(this))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"defaultMaterial",{get:function(){return this._defaultMaterial||(this._defaultMaterial=t.DefaultMaterialFactory(this)),this._defaultMaterial},set:function(D){this._defaultMaterial=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"texturesEnabled",{get:function(){return this._texturesEnabled},set:function(D){this._texturesEnabled!==D&&(this._texturesEnabled=D,this.markAllMaterialsAsDirty(ye.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skeletonsEnabled",{get:function(){return this._skeletonsEnabled},set:function(D){this._skeletonsEnabled!==D&&(this._skeletonsEnabled=D,this.markAllMaterialsAsDirty(ye.a.MATERIAL_AttributesDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"collisionCoordinator",{get:function(){return this._collisionCoordinator||(this._collisionCoordinator=t.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"frustumPlanes",{get:function(){return this._frustumPlanes},enumerable:!0,configurable:!0}),t.prototype._registerTransientComponents=function(){if(this._transientComponents.length>0){for(var D=0,w=this._transientComponents;D<w.length;D++)w[D].register();this._transientComponents=[]}},t.prototype._addComponent=function(D){this._components.push(D),this._transientComponents.push(D);var w=D;w.addFromContainer&&w.serialize&&this._serializableComponents.push(w)},t.prototype._getComponent=function(D){for(var w=0,N=this._components;w<N.length;w++){var F=N[w];if(F.name===D)return F}return null},t.prototype.getClassName=function(){return"Scene"},t.prototype._getDefaultMeshCandidates=function(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates},t.prototype._getDefaultSubMeshCandidates=function(D){return this._defaultSubMeshCandidates.data=D.subMeshes,this._defaultSubMeshCandidates.length=D.subMeshes.length,this._defaultSubMeshCandidates},t.prototype.setDefaultCandidateProviders=function(){this.getActiveMeshCandidates=this._getDefaultMeshCandidates.bind(this),this.getActiveSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this),this.getIntersectingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this),this.getCollidingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this)},Object.defineProperty(t.prototype,"meshUnderPointer",{get:function(){return this._inputManager.meshUnderPointer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pointerX",{get:function(){return this._inputManager.pointerX},set:function(D){this._inputManager.pointerX=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pointerY",{get:function(){return this._inputManager.pointerY},set:function(D){this._inputManager.pointerY=D},enumerable:!0,configurable:!0}),t.prototype.getCachedMaterial=function(){return this._cachedMaterial},t.prototype.getCachedEffect=function(){return this._cachedEffect},t.prototype.getCachedVisibility=function(){return this._cachedVisibility},t.prototype.isCachedMaterialInvalid=function(D,w,N){return void 0===N&&(N=1),this._cachedEffect!==w||this._cachedMaterial!==D||this._cachedVisibility!==N},t.prototype.getEngine=function(){return this._engine},t.prototype.getTotalVertices=function(){return this._totalVertices.current},Object.defineProperty(t.prototype,"totalVerticesPerfCounter",{get:function(){return this._totalVertices},enumerable:!0,configurable:!0}),t.prototype.getActiveIndices=function(){return this._activeIndices.current},Object.defineProperty(t.prototype,"totalActiveIndicesPerfCounter",{get:function(){return this._activeIndices},enumerable:!0,configurable:!0}),t.prototype.getActiveParticles=function(){return this._activeParticles.current},Object.defineProperty(t.prototype,"activeParticlesPerfCounter",{get:function(){return this._activeParticles},enumerable:!0,configurable:!0}),t.prototype.getActiveBones=function(){return this._activeBones.current},Object.defineProperty(t.prototype,"activeBonesPerfCounter",{get:function(){return this._activeBones},enumerable:!0,configurable:!0}),t.prototype.getActiveMeshes=function(){return this._activeMeshes},t.prototype.getAnimationRatio=function(){return void 0!==this._animationRatio?this._animationRatio:1},t.prototype.getRenderId=function(){return this._renderId},t.prototype.getFrameId=function(){return this._frameId},t.prototype.incrementRenderId=function(){this._renderId++},t.prototype._createUbo=function(){this._sceneUbo=new oe.a(this._engine,void 0,!0),this._sceneUbo.addUniform("viewProjection",16),this._sceneUbo.addUniform("view",16)},t.prototype.simulatePointerMove=function(D,w){return this._inputManager.simulatePointerMove(D,w),this},t.prototype.simulatePointerDown=function(D,w){return this._inputManager.simulatePointerDown(D,w),this},t.prototype.simulatePointerUp=function(D,w,N){return this._inputManager.simulatePointerUp(D,w,N),this},t.prototype.isPointerCaptured=function(D){return void 0===D&&(D=0),this._inputManager.isPointerCaptured(D)},t.prototype.attachControl=function(D,w,N){void 0===D&&(D=!0),void 0===w&&(w=!0),void 0===N&&(N=!0),this._inputManager.attachControl(D,w,N)},t.prototype.detachControl=function(){this._inputManager.detachControl()},t.prototype.isReady=function(){if(this._isDisposed)return!1;var D,w=this.getEngine();if(!w.areAllEffectsReady())return!1;if(this._pendingData.length>0)return!1;for(D=0;D<this.meshes.length;D++){var N=this.meshes[D];if(N.isEnabled()&&N.subMeshes&&0!==N.subMeshes.length){if(!N.isReady(!0))return!1;for(var F="InstancedMesh"===N.getClassName()||"InstancedLinesMesh"===N.getClassName()||w.getCaps().instancedArrays&&N.instances.length>0,k=0,j=this._isReadyForMeshStage;k<j.length;k++)if(!j[k].action(N,F))return!1}}for(D=0;D<this.geometries.length;D++)if(this.geometries[D].delayLoadState===ye.a.DELAYLOADSTATE_LOADING)return!1;if(this.activeCameras&&this.activeCameras.length>0){for(var z=0,G=this.activeCameras;z<G.length;z++)if(!G[z].isReady(!0))return!1}else if(this.activeCamera&&!this.activeCamera.isReady(!0))return!1;for(var H=0,X=this.particleSystems;H<X.length;H++)if(!X[H].isReady())return!1;return!0},t.prototype.resetCachedMaterial=function(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null},t.prototype.registerBeforeRender=function(D){this.onBeforeRenderObservable.add(D)},t.prototype.unregisterBeforeRender=function(D){this.onBeforeRenderObservable.removeCallback(D)},t.prototype.registerAfterRender=function(D){this.onAfterRenderObservable.add(D)},t.prototype.unregisterAfterRender=function(D){this.onAfterRenderObservable.removeCallback(D)},t.prototype._executeOnceBeforeRender=function(D){var w=this,i=function(){D(),setTimeout((function(){w.unregisterBeforeRender(i)}))};this.registerBeforeRender(i)},t.prototype.executeOnceBeforeRender=function(D,w){var N=this;void 0!==w?setTimeout((function(){N._executeOnceBeforeRender(D)}),w):this._executeOnceBeforeRender(D)},t.prototype._addPendingData=function(D){this._pendingData.push(D)},t.prototype._removePendingData=function(D){var w=this.isLoading,N=this._pendingData.indexOf(D);-1!==N&&this._pendingData.splice(N,1),w&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)},t.prototype.getWaitingItemsCount=function(){return this._pendingData.length},Object.defineProperty(t.prototype,"isLoading",{get:function(){return this._pendingData.length>0},enumerable:!0,configurable:!0}),t.prototype.executeWhenReady=function(D){var w=this;this.onReadyObservable.add(D),-1===this._executeWhenReadyTimeoutId&&(this._executeWhenReadyTimeoutId=setTimeout((function(){w._checkIsReady()}),150))},t.prototype.whenReadyAsync=function(){var D=this;return new Promise((function(w){D.executeWhenReady((function(){w()}))}))},t.prototype._checkIsReady=function(){var D=this;return this._registerTransientComponents(),this.isReady()?(this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=-1)):this._isDisposed?(this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=-1)):void(this._executeWhenReadyTimeoutId=setTimeout((function(){D._checkIsReady()}),150))},Object.defineProperty(t.prototype,"animatables",{get:function(){return this._activeAnimatables},enumerable:!0,configurable:!0}),t.prototype.resetLastAnimationTimeFrame=function(){this._animationTimeLast=j.a.Now},t.prototype.getViewMatrix=function(){return this._viewMatrix},t.prototype.getProjectionMatrix=function(){return this._projectionMatrix},t.prototype.getTransformMatrix=function(){return this._transformMatrix},t.prototype.setTransformMatrix=function(D,w,N,F){this._viewUpdateFlag===D.updateFlag&&this._projectionUpdateFlag===w.updateFlag||(this._viewUpdateFlag=D.updateFlag,this._projectionUpdateFlag=w.updateFlag,this._viewMatrix=D,this._projectionMatrix=w,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?Ie.a.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=Ie.a.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(N,F):this._sceneUbo.useUbo&&(this._sceneUbo.updateMatrix("viewProjection",this._transformMatrix),this._sceneUbo.updateMatrix("view",this._viewMatrix),this._sceneUbo.update()))},t.prototype.getSceneUniformBuffer=function(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo},t.prototype.getUniqueId=function(){return Le.a.UniqueId},t.prototype.addMesh=function(D,w){var N=this;void 0===w&&(w=!1),this._blockEntityCollection||(this.meshes.push(D),D._resyncLightSources(),D.parent||D._addToSceneRootNodes(),this.onNewMeshAddedObservable.notifyObservers(D),w&&D.getChildMeshes().forEach((function(D){N.addMesh(D)})))},t.prototype.removeMesh=function(D,w){var N=this;void 0===w&&(w=!1);var F=this.meshes.indexOf(D);return-1!==F&&(this.meshes[F]=this.meshes[this.meshes.length-1],this.meshes.pop(),D.parent||D._removeFromSceneRootNodes()),this.onMeshRemovedObservable.notifyObservers(D),w&&D.getChildMeshes().forEach((function(D){N.removeMesh(D)})),F},t.prototype.addTransformNode=function(D){this._blockEntityCollection||(D._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(D),D.parent||D._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(D))},t.prototype.removeTransformNode=function(D){var w=D._indexInSceneTransformNodesArray;if(-1!==w){if(w!==this.transformNodes.length-1){var N=this.transformNodes[this.transformNodes.length-1];this.transformNodes[w]=N,N._indexInSceneTransformNodesArray=w}D._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),D.parent||D._removeFromSceneRootNodes()}return this.onTransformNodeRemovedObservable.notifyObservers(D),w},t.prototype.removeSkeleton=function(D){var w=this.skeletons.indexOf(D);return-1!==w&&(this.skeletons.splice(w,1),this.onSkeletonRemovedObservable.notifyObservers(D)),w},t.prototype.removeMorphTargetManager=function(D){var w=this.morphTargetManagers.indexOf(D);return-1!==w&&this.morphTargetManagers.splice(w,1),w},t.prototype.removeLight=function(D){var w=this.lights.indexOf(D);if(-1!==w){for(var N=0,F=this.meshes;N<F.length;N++)F[N]._removeLightSource(D,!1);this.lights.splice(w,1),this.sortLightsByPriority(),D.parent||D._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(D),w},t.prototype.removeCamera=function(D){var w=this.cameras.indexOf(D);-1!==w&&(this.cameras.splice(w,1),D.parent||D._removeFromSceneRootNodes());var N=this.activeCameras.indexOf(D);return-1!==N&&this.activeCameras.splice(N,1),this.activeCamera===D&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(D),w},t.prototype.removeParticleSystem=function(D){var w=this.particleSystems.indexOf(D);return-1!==w&&this.particleSystems.splice(w,1),w},t.prototype.removeAnimation=function(D){var w=this.animations.indexOf(D);return-1!==w&&this.animations.splice(w,1),w},t.prototype.stopAnimation=function(D,w,N){},t.prototype.removeAnimationGroup=function(D){var w=this.animationGroups.indexOf(D);return-1!==w&&this.animationGroups.splice(w,1),w},t.prototype.removeMultiMaterial=function(D){var w=this.multiMaterials.indexOf(D);return-1!==w&&this.multiMaterials.splice(w,1),w},t.prototype.removeMaterial=function(D){var w=D._indexInSceneMaterialArray;if(-1!==w&&w<this.materials.length){if(w!==this.materials.length-1){var N=this.materials[this.materials.length-1];this.materials[w]=N,N._indexInSceneMaterialArray=w}D._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(D),w},t.prototype.removeActionManager=function(D){var w=this.actionManagers.indexOf(D);return-1!==w&&this.actionManagers.splice(w,1),w},t.prototype.removeTexture=function(D){var w=this.textures.indexOf(D);return-1!==w&&this.textures.splice(w,1),this.onTextureRemovedObservable.notifyObservers(D),w},t.prototype.addLight=function(D){if(!this._blockEntityCollection){this.lights.push(D),this.sortLightsByPriority(),D.parent||D._addToSceneRootNodes();for(var w=0,N=this.meshes;w<N.length;w++){var F=N[w];-1===F.lightSources.indexOf(D)&&(F.lightSources.push(D),F._resyncLightSources())}this.onNewLightAddedObservable.notifyObservers(D)}},t.prototype.sortLightsByPriority=function(){this.requireLightSorting&&this.lights.sort(ce.a.CompareLightsPriority)},t.prototype.addCamera=function(D){this._blockEntityCollection||(this.cameras.push(D),this.onNewCameraAddedObservable.notifyObservers(D),D.parent||D._addToSceneRootNodes())},t.prototype.addSkeleton=function(D){this._blockEntityCollection||(this.skeletons.push(D),this.onNewSkeletonAddedObservable.notifyObservers(D))},t.prototype.addParticleSystem=function(D){this._blockEntityCollection||this.particleSystems.push(D)},t.prototype.addAnimation=function(D){this._blockEntityCollection||this.animations.push(D)},t.prototype.addAnimationGroup=function(D){this._blockEntityCollection||this.animationGroups.push(D)},t.prototype.addMultiMaterial=function(D){this._blockEntityCollection||this.multiMaterials.push(D)},t.prototype.addMaterial=function(D){this._blockEntityCollection||(D._indexInSceneMaterialArray=this.materials.length,this.materials.push(D),this.onNewMaterialAddedObservable.notifyObservers(D))},t.prototype.addMorphTargetManager=function(D){this._blockEntityCollection||this.morphTargetManagers.push(D)},t.prototype.addGeometry=function(D){this._blockEntityCollection||(this.geometriesByUniqueId&&(this.geometriesByUniqueId[D.uniqueId]=this.geometries.length),this.geometries.push(D))},t.prototype.addActionManager=function(D){this.actionManagers.push(D)},t.prototype.addTexture=function(D){this._blockEntityCollection||(this.textures.push(D),this.onNewTextureAddedObservable.notifyObservers(D))},t.prototype.switchActiveCamera=function(D,w){void 0===w&&(w=!0);var N=this._engine.getInputElement();N&&(this.activeCamera&&this.activeCamera.detachControl(N),this.activeCamera=D,w&&D.attachControl(N))},t.prototype.setActiveCameraByID=function(D){var w=this.getCameraByID(D);return w?(this.activeCamera=w,w):null},t.prototype.setActiveCameraByName=function(D){var w=this.getCameraByName(D);return w?(this.activeCamera=w,w):null},t.prototype.getAnimationGroupByName=function(D){for(var w=0;w<this.animationGroups.length;w++)if(this.animationGroups[w].name===D)return this.animationGroups[w];return null},t.prototype.getMaterialByUniqueID=function(D){for(var w=0;w<this.materials.length;w++)if(this.materials[w].uniqueId===D)return this.materials[w];return null},t.prototype.getMaterialByID=function(D){for(var w=0;w<this.materials.length;w++)if(this.materials[w].id===D)return this.materials[w];return null},t.prototype.getLastMaterialByID=function(D){for(var w=this.materials.length-1;w>=0;w--)if(this.materials[w].id===D)return this.materials[w];return null},t.prototype.getMaterialByName=function(D){for(var w=0;w<this.materials.length;w++)if(this.materials[w].name===D)return this.materials[w];return null},t.prototype.getTextureByUniqueID=function(D){for(var w=0;w<this.textures.length;w++)if(this.textures[w].uniqueId===D)return this.textures[w];return null},t.prototype.getCameraByID=function(D){for(var w=0;w<this.cameras.length;w++)if(this.cameras[w].id===D)return this.cameras[w];return null},t.prototype.getCameraByUniqueID=function(D){for(var w=0;w<this.cameras.length;w++)if(this.cameras[w].uniqueId===D)return this.cameras[w];return null},t.prototype.getCameraByName=function(D){for(var w=0;w<this.cameras.length;w++)if(this.cameras[w].name===D)return this.cameras[w];return null},t.prototype.getBoneByID=function(D){for(var w=0;w<this.skeletons.length;w++)for(var N=this.skeletons[w],F=0;F<N.bones.length;F++)if(N.bones[F].id===D)return N.bones[F];return null},t.prototype.getBoneByName=function(D){for(var w=0;w<this.skeletons.length;w++)for(var N=this.skeletons[w],F=0;F<N.bones.length;F++)if(N.bones[F].name===D)return N.bones[F];return null},t.prototype.getLightByName=function(D){for(var w=0;w<this.lights.length;w++)if(this.lights[w].name===D)return this.lights[w];return null},t.prototype.getLightByID=function(D){for(var w=0;w<this.lights.length;w++)if(this.lights[w].id===D)return this.lights[w];return null},t.prototype.getLightByUniqueID=function(D){for(var w=0;w<this.lights.length;w++)if(this.lights[w].uniqueId===D)return this.lights[w];return null},t.prototype.getParticleSystemByID=function(D){for(var w=0;w<this.particleSystems.length;w++)if(this.particleSystems[w].id===D)return this.particleSystems[w];return null},t.prototype.getGeometryByID=function(D){for(var w=0;w<this.geometries.length;w++)if(this.geometries[w].id===D)return this.geometries[w];return null},t.prototype._getGeometryByUniqueID=function(D){if(this.geometriesByUniqueId){var w=this.geometriesByUniqueId[D];if(void 0!==w)return this.geometries[w]}else for(var N=0;N<this.geometries.length;N++)if(this.geometries[N].uniqueId===D)return this.geometries[N];return null},t.prototype.pushGeometry=function(D,w){return!(!w&&this._getGeometryByUniqueID(D.uniqueId)||(this.addGeometry(D),this.onNewGeometryAddedObservable.notifyObservers(D),0))},t.prototype.removeGeometry=function(D){var w;if(this.geometriesByUniqueId){if(void 0===(w=this.geometriesByUniqueId[D.uniqueId]))return!1}else if((w=this.geometries.indexOf(D))<0)return!1;if(w!==this.geometries.length-1){var N=this.geometries[this.geometries.length-1];this.geometries[w]=N,this.geometriesByUniqueId&&(this.geometriesByUniqueId[N.uniqueId]=w,this.geometriesByUniqueId[D.uniqueId]=void 0)}return this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(D),!0},t.prototype.getGeometries=function(){return this.geometries},t.prototype.getMeshByID=function(D){for(var w=0;w<this.meshes.length;w++)if(this.meshes[w].id===D)return this.meshes[w];return null},t.prototype.getMeshesByID=function(D){return this.meshes.filter((function(w){return w.id===D}))},t.prototype.getTransformNodeByID=function(D){for(var w=0;w<this.transformNodes.length;w++)if(this.transformNodes[w].id===D)return this.transformNodes[w];return null},t.prototype.getTransformNodeByUniqueID=function(D){for(var w=0;w<this.transformNodes.length;w++)if(this.transformNodes[w].uniqueId===D)return this.transformNodes[w];return null},t.prototype.getTransformNodesByID=function(D){return this.transformNodes.filter((function(w){return w.id===D}))},t.prototype.getMeshByUniqueID=function(D){for(var w=0;w<this.meshes.length;w++)if(this.meshes[w].uniqueId===D)return this.meshes[w];return null},t.prototype.getLastMeshByID=function(D){for(var w=this.meshes.length-1;w>=0;w--)if(this.meshes[w].id===D)return this.meshes[w];return null},t.prototype.getLastEntryByID=function(D){var w;for(w=this.meshes.length-1;w>=0;w--)if(this.meshes[w].id===D)return this.meshes[w];for(w=this.transformNodes.length-1;w>=0;w--)if(this.transformNodes[w].id===D)return this.transformNodes[w];for(w=this.cameras.length-1;w>=0;w--)if(this.cameras[w].id===D)return this.cameras[w];for(w=this.lights.length-1;w>=0;w--)if(this.lights[w].id===D)return this.lights[w];return null},t.prototype.getNodeByID=function(D){var w=this.getMeshByID(D);if(w)return w;var N=this.getTransformNodeByID(D);if(N)return N;var F=this.getLightByID(D);if(F)return F;var k=this.getCameraByID(D);return k||this.getBoneByID(D)||null},t.prototype.getNodeByName=function(D){var w=this.getMeshByName(D);if(w)return w;var N=this.getTransformNodeByName(D);if(N)return N;var F=this.getLightByName(D);if(F)return F;var k=this.getCameraByName(D);return k||this.getBoneByName(D)||null},t.prototype.getMeshByName=function(D){for(var w=0;w<this.meshes.length;w++)if(this.meshes[w].name===D)return this.meshes[w];return null},t.prototype.getTransformNodeByName=function(D){for(var w=0;w<this.transformNodes.length;w++)if(this.transformNodes[w].name===D)return this.transformNodes[w];return null},t.prototype.getLastSkeletonByID=function(D){for(var w=this.skeletons.length-1;w>=0;w--)if(this.skeletons[w].id===D)return this.skeletons[w];return null},t.prototype.getSkeletonByUniqueId=function(D){for(var w=0;w<this.skeletons.length;w++)if(this.skeletons[w].uniqueId===D)return this.skeletons[w];return null},t.prototype.getSkeletonById=function(D){for(var w=0;w<this.skeletons.length;w++)if(this.skeletons[w].id===D)return this.skeletons[w];return null},t.prototype.getSkeletonByName=function(D){for(var w=0;w<this.skeletons.length;w++)if(this.skeletons[w].name===D)return this.skeletons[w];return null},t.prototype.getMorphTargetManagerById=function(D){for(var w=0;w<this.morphTargetManagers.length;w++)if(this.morphTargetManagers[w].uniqueId===D)return this.morphTargetManagers[w];return null},t.prototype.getMorphTargetById=function(D){for(var w=0;w<this.morphTargetManagers.length;++w)for(var N=this.morphTargetManagers[w],F=0;F<N.numTargets;++F){var k=N.getTarget(F);if(k.id===D)return k}return null},t.prototype.isActiveMesh=function(D){return-1!==this._activeMeshes.indexOf(D)},Object.defineProperty(t.prototype,"uid",{get:function(){return this._uid||(this._uid=k.b.RandomId()),this._uid},enumerable:!0,configurable:!0}),t.prototype.addExternalData=function(D,w){return this._externalData||(this._externalData=new H.a),this._externalData.add(D,w)},t.prototype.getExternalData=function(D){return this._externalData?this._externalData.get(D):null},t.prototype.getOrAddExternalDataWithFactory=function(D,w){return this._externalData||(this._externalData=new H.a),this._externalData.getOrAddWithFactory(D,w)},t.prototype.removeExternalData=function(D){return this._externalData.remove(D)},t.prototype._evaluateSubMesh=function(D,w,N){if(N.hasInstances||N.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||w.alwaysSelectAsActiveMesh||1===w.subMeshes.length||D.isInFrustum(this._frustumPlanes)){for(var F=0,k=this._evaluateSubMeshStage;F<k.length;F++)k[F].action(w,D);var j=D.getMaterial();null!=j&&(j.hasRenderTargetTextures&&null!=j.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(j)&&(this._processedMaterials.push(j),this._renderTargets.concatWithNoDuplicate(j.getRenderTargetTextures())),this._renderingManager.dispatch(D,w,j))}},t.prototype.freeProcessedMaterials=function(){this._processedMaterials.dispose()},Object.defineProperty(t.prototype,"blockfreeActiveMeshesAndRenderingGroups",{get:function(){return this._preventFreeActiveMeshesAndRenderingGroups},set:function(D){this._preventFreeActiveMeshesAndRenderingGroups!==D&&(D&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=D)},enumerable:!0,configurable:!0}),t.prototype.freeActiveMeshes=function(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(var D=0;D<this.activeCameras.length;D++){var w=this.activeCameras[D];w&&w._activeMeshes&&w._activeMeshes.dispose()}},t.prototype.freeRenderingGroups=function(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(var D=0;D<this.textures.length;D++){var w=this.textures[D];w&&w.renderList&&w.freeRenderingGroups()}},t.prototype._isInIntermediateRendering=function(){return this._intermediateRendering},t.prototype.freezeActiveMeshes=function(D){var w=this;return void 0===D&&(D=!1),this.executeWhenReady((function(){if(w.activeCamera){w._frustumPlanes||w.setTransformMatrix(w.activeCamera.getViewMatrix(),w.activeCamera.getProjectionMatrix()),w._evaluateActiveMeshes(),w._activeMeshesFrozen=!0,w._skipEvaluateActiveMeshesCompletely=D;for(var N=0;N<w._activeMeshes.length;N++)w._activeMeshes.data[N]._freeze()}})),this},t.prototype.unfreezeActiveMeshes=function(){for(var D=0;D<this.meshes.length;D++){var w=this.meshes[D];w._internalAbstractMeshDataInfo&&(w._internalAbstractMeshDataInfo._isActive=!1)}for(D=0;D<this._activeMeshes.length;D++)this._activeMeshes.data[D]._unFreeze();return this._activeMeshesFrozen=!1,this},t.prototype._evaluateActiveMeshes=function(){if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely)for(var D=this._activeMeshes.length,w=0;w<D;w++)(z=this._activeMeshes.data[w]).computeWorldMatrix()}else if(this.activeCamera){this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset();for(var N=0,F=this._beforeEvaluateActiveMeshStage;N<F.length;N++)F[N].action();var k=this.getActiveMeshCandidates(),j=k.length;for(w=0;w<j;w++){var z;if(!(z=k.data[w]).isBlocked&&(this._totalVertices.addCount(z.getTotalVertices(),!1),z.isReady()&&z.isEnabled()&&0!==z.scaling.lengthSquared())){z.computeWorldMatrix(),z.actionManager&&z.actionManager.hasSpecificTriggers2(ye.a.ACTION_OnIntersectionEnterTrigger,ye.a.ACTION_OnIntersectionExitTrigger)&&this._meshesForIntersections.pushNoDuplicate(z);var G=this.customLODSelector?this.customLODSelector(z,this.activeCamera):z.getLOD(this.activeCamera);null!=G&&(G!==z&&G.billboardMode!==Z.a.BILLBOARDMODE_NONE&&G.computeWorldMatrix(),z._preActivate(),z.isVisible&&z.visibility>0&&0!=(z.layerMask&this.activeCamera.layerMask)&&(this._skipFrustumClipping||z.alwaysSelectAsActiveMesh||z.isInFrustum(this._frustumPlanes))&&(this._activeMeshes.push(z),this.activeCamera._activeMeshes.push(z),G!==z&&G._activate(this._renderId,!1),z._activate(this._renderId,!1)&&(z.isAnInstance?z._internalAbstractMeshDataInfo._actAsRegularMesh&&(G=z):G._internalAbstractMeshDataInfo._onlyForInstances=!1,G._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(z,G)),z._postActivate()))}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(var H=0;H<this.particleSystems.length;H++){var X=this.particleSystems[H];if(X.isStarted()&&X.emitter){var q=X.emitter;q.position&&!q.isEnabled()||(this._activeParticleSystems.push(X),X.animate(),this._renderingManager.dispatchParticles(X))}}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}},t.prototype._activeMesh=function(D,w){this._skeletonsEnabled&&null!==w.skeleton&&void 0!==w.skeleton&&(this._activeSkeletons.pushNoDuplicate(w.skeleton)&&w.skeleton.prepare(),w.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(w));for(var N=0,F=this._activeMeshStage;N<F.length;N++)F[N].action(D,w);if(null!=w&&void 0!==w.subMeshes&&null!==w.subMeshes&&w.subMeshes.length>0)for(var k=this.getActiveSubMeshCandidates(w),j=k.length,z=0;z<j;z++){var G=k.data[z];this._evaluateSubMesh(G,w,D)}},t.prototype.updateTransformMatrix=function(D){this.activeCamera&&this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(D))},t.prototype._bindFrameBuffer=function(){if(this.activeCamera&&this.activeCamera._multiviewTexture)this.activeCamera._multiviewTexture._bindFrameBuffer();else if(this.activeCamera&&this.activeCamera.outputRenderTarget)if(this.getEngine().getCaps().multiview&&this.activeCamera.outputRenderTarget&&this.activeCamera.outputRenderTarget.getViewCount()>1)this.activeCamera.outputRenderTarget._bindFrameBuffer();else{var D=this.activeCamera.outputRenderTarget.getInternalTexture();D?this.getEngine().bindFramebuffer(D):Te.a.Error("Camera contains invalid customDefaultRenderTarget")}else this.getEngine().restoreDefaultFramebuffer()},t.prototype._renderForCamera=function(D,w){if(!D||!D._skipRendering){var N=this._engine;if(this._activeCamera=D,!this.activeCamera)throw new Error("Active camera not set");N.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,this.getEngine().getCaps().multiview&&D.outputRenderTarget&&D.outputRenderTarget.getViewCount()>1?this.setTransformMatrix(D._rigCameras[0].getViewMatrix(),D._rigCameras[0].getProjectionMatrix(),D._rigCameras[1].getViewMatrix(),D._rigCameras[1].getProjectionMatrix()):this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(var F=0;F<this._softwareSkinnedMeshes.length;F++){var j=this._softwareSkinnedMeshes.data[F];j.applySkeleton(j.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),D.customRenderTargets&&D.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(D.customRenderTargets),w&&w.customRenderTargets&&w.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(w.customRenderTargets);for(var z=0,G=this._gatherActiveCameraRenderTargetsStage;z<G.length;z++)G[z].action(this._renderTargets);if(this.renderTargetsEnabled){this._intermediateRendering=!0;var H=!1;if(this._renderTargets.length>0){k.b.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(var X=0;X<this._renderTargets.length;X++){var q=this._renderTargets.data[X];if(q._shouldRender()){this._renderId++;var Z=q.activeCamera&&q.activeCamera!==this.activeCamera;q.render(Z,this.dumpNextRenderTargets),H=!0}}k.b.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(var J=0,$=this._cameraDrawRenderTargetStage;J<$.length;J++)H=$[J].action(this.activeCamera)||H;this._intermediateRendering=!1,this.activeCamera&&this.activeCamera.outputRenderTarget&&(H=!0),H&&this._bindFrameBuffer()}this.onAfterRenderTargetsRenderObservable.notifyObservers(this),this.postProcessManager&&!D._multiviewTexture&&this.postProcessManager._prepareFrame();for(var te=0,ie=this._beforeCameraDrawStage;te<ie.length;te++)ie[te].action(this.activeCamera);this.onBeforeDrawPhaseObservable.notifyObservers(this),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(var oe=0,ce=this._afterCameraDrawStage;oe<ce.length;oe++)ce[oe].action(this.activeCamera);this.postProcessManager&&!D._multiviewTexture&&this.postProcessManager._finalizeFrame(D.isIntermediate),this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}},t.prototype._processSubCameras=function(D){if(D.cameraRigMode===$.a.RIG_MODE_NONE||D.outputRenderTarget&&D.outputRenderTarget.getViewCount()>1&&this.getEngine().getCaps().multiview)return this._renderForCamera(D),void this.onAfterRenderCameraObservable.notifyObservers(D);if(D._useMultiviewToSingleView)this._renderMultiviewToSingleView(D);else for(var w=0;w<D._rigCameras.length;w++)this._renderForCamera(D._rigCameras[w],D);this._activeCamera=D,this.setTransformMatrix(this._activeCamera.getViewMatrix(),this._activeCamera.getProjectionMatrix()),this.onAfterRenderCameraObservable.notifyObservers(D)},t.prototype._checkIntersections=function(){for(var D=0;D<this._meshesForIntersections.length;D++){var w=this._meshesForIntersections.data[D];if(w.actionManager)for(var N=0;w.actionManager&&N<w.actionManager.actions.length;N++){var F=w.actionManager.actions[N];if(F.trigger===ye.a.ACTION_OnIntersectionEnterTrigger||F.trigger===ye.a.ACTION_OnIntersectionExitTrigger){var k=F.getTriggerParameter(),j=k instanceof J.a?k:k.mesh,z=j.intersectsMesh(w,k.usePreciseIntersection),G=w._intersectionsInProgress.indexOf(j);z&&-1===G?F.trigger===ye.a.ACTION_OnIntersectionEnterTrigger?(F._executeCurrent(fe.a.CreateNew(w,void 0,j)),w._intersectionsInProgress.push(j)):F.trigger===ye.a.ACTION_OnIntersectionExitTrigger&&w._intersectionsInProgress.push(j):!z&&G>-1&&(F.trigger===ye.a.ACTION_OnIntersectionExitTrigger&&F._executeCurrent(fe.a.CreateNew(w,void 0,j)),w.actionManager.hasSpecificTrigger(ye.a.ACTION_OnIntersectionExitTrigger,(function(D){var w=D instanceof J.a?D:D.mesh;return j===w}))&&F.trigger!==ye.a.ACTION_OnIntersectionExitTrigger||w._intersectionsInProgress.splice(G,1))}}}},t.prototype._advancePhysicsEngineStep=function(D){},t.prototype._animate=function(){},t.prototype.animate=function(){if(this._engine.isDeterministicLockStep()){var D=Math.max(t.MinDeltaTime,Math.min(this._engine.getDeltaTime(),t.MaxDeltaTime))+this._timeAccumulator,w=this._engine.getTimeStep(),N=1e3/w/1e3,F=0,k=this._engine.getLockstepMaxSteps(),j=Math.floor(D/w);for(j=Math.min(j,k);D>0&&F<j;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=w*N,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this._advancePhysicsEngineStep(w),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,F++,D-=w;this._timeAccumulator=D<0?0:D}else D=this.useConstantAnimationDeltaTime?16:Math.max(t.MinDeltaTime,Math.min(this._engine.getDeltaTime(),t.MaxDeltaTime)),this._animationRatio=.06*D,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this._advancePhysicsEngineStep(D)},t.prototype.render=function(D,w){if(void 0===D&&(D=!0),void 0===w&&(w=!1),!this.isDisposed){this._frameId++,this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(ye.a.ACTION_OnEveryFrameTrigger),w||this.animate();for(var N=0,F=this._beforeCameraUpdateStage;N<F.length;N++)F[N].action();if(D)if(this.activeCameras.length>0)for(var j=0;j<this.activeCameras.length;j++){var z=this.activeCameras[j];if(z.update(),z.cameraRigMode!==$.a.RIG_MODE_NONE)for(var G=0;G<z._rigCameras.length;G++)z._rigCameras[G].update()}else if(this.activeCamera&&(this.activeCamera.update(),this.activeCamera.cameraRigMode!==$.a.RIG_MODE_NONE))for(G=0;G<this.activeCamera._rigCameras.length;G++)this.activeCamera._rigCameras[G].update();this.onBeforeRenderObservable.notifyObservers(this),this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);var H=this.getEngine(),X=this.activeCamera;if(this.renderTargetsEnabled){k.b.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!0;for(var q=0;q<this.customRenderTargets.length;q++){var Z=this.customRenderTargets[q];if(Z._shouldRender()){if(this._renderId++,this.activeCamera=Z.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");H.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),Z.render(X!==this.activeCamera,this.dumpNextRenderTargets)}}k.b.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!1,this._renderId++}this.activeCamera=X,this._bindFrameBuffer(),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(var J=0,te=this._beforeClearStage;J<te.length;J++)te[J].action();(this.autoClearDepthAndStencil||this.autoClear)&&this._engine.clear(this.clearColor,this.autoClear||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil);for(var ie=0,oe=this._gatherRenderTargetsStage;ie<oe.length;ie++)oe[ie].action(this._renderTargets);if(this.activeCameras.length>0)for(j=0;j<this.activeCameras.length;j++)j>0&&this._engine.clear(null,!1,!0,!0),this._processSubCameras(this.activeCameras[j]);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera)}this._checkIntersections();for(var ce=0,he=this._afterRenderStage;ce<he.length;ce++)he[ce].action();if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(G=0;G<this._toBeDisposed.length;G++){var fe=this._toBeDisposed[G];fe&&fe.dispose()}this._toBeDisposed=[]}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0)}},t.prototype.freezeMaterials=function(){for(var D=0;D<this.materials.length;D++)this.materials[D].freeze()},t.prototype.unfreezeMaterials=function(){for(var D=0;D<this.materials.length;D++)this.materials[D].unfreeze()},t.prototype.dispose=function(){this.beforeRender=null,this.afterRender=null,Ee.a._LastCreatedScene===this&&(Ee.a._LastCreatedScene=null),this.skeletons=[],this.morphTargetManagers=[],this._transientComponents=[],this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._activeMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear();for(var D=0,w=this._components;D<w.length;D++)w[D].dispose();this.importedMeshesFiles=new Array,this.stopAllAnimations&&this.stopAllAnimations(),this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed=[];for(var N=0,F=this._activeRequests;N<F.length;N++)F[N].abort();this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.detachControl();var k,j=this._engine.getInputElement();if(j)for(k=0;k<this.cameras.length;k++)this.cameras[k].detachControl(j);for(;this.animationGroups.length;)this.animationGroups[0].dispose();for(;this.lights.length;)this.lights[0].dispose();for(;this.meshes.length;)this.meshes[0].dispose(!0);for(;this.transformNodes.length;)this.transformNodes[0].dispose(!0);for(;this.cameras.length;)this.cameras[0].dispose();for(this._defaultMaterial&&this._defaultMaterial.dispose();this.multiMaterials.length;)this.multiMaterials[0].dispose();for(;this.materials.length;)this.materials[0].dispose();for(;this.particleSystems.length;)this.particleSystems[0].dispose();for(;this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.textures.length;)this.textures[0].dispose();this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),(k=this._engine.scenes.indexOf(this))>-1&&this._engine.scenes.splice(k,1),this._engine.wipeCaches(!0),this._isDisposed=!0},Object.defineProperty(t.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!0,configurable:!0}),t.prototype.clearCachedVertexData=function(){for(var D=0;D<this.meshes.length;D++){var w=this.meshes[D].geometry;if(w)for(var N in w._indices=[],w._vertexBuffers)w._vertexBuffers.hasOwnProperty(N)&&(w._vertexBuffers[N]._buffer._data=null)}},t.prototype.cleanCachedTextureBuffer=function(){for(var D=0,w=this.textures;D<w.length;D++){var N=w[D];N._buffer&&(N._buffer=null)}},t.prototype.getWorldExtends=function(D){var w=new q.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),N=new q.e(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return D=D||function(){return!0},this.meshes.filter(D).forEach((function(D){if(D.computeWorldMatrix(!0),D.subMeshes&&0!==D.subMeshes.length&&!D.infiniteDistance){var F=D.getBoundingInfo(),k=F.boundingBox.minimumWorld,j=F.boundingBox.maximumWorld;q.e.CheckExtends(k,w,N),q.e.CheckExtends(j,w,N)}})),{min:w,max:N}},t.prototype.createPickingRay=function(D,w,N,F,k){throw void 0===k&&(k=!1),Se.a.WarnImport("Ray")},t.prototype.createPickingRayToRef=function(D,w,N,F,k,j){throw void 0===j&&(j=!1),Se.a.WarnImport("Ray")},t.prototype.createPickingRayInCameraSpace=function(D,w,N){throw Se.a.WarnImport("Ray")},t.prototype.createPickingRayInCameraSpaceToRef=function(D,w,N,F){throw Se.a.WarnImport("Ray")},t.prototype.pick=function(D,w,N,F,k,j){var z=new he.a;return z._pickingUnavailable=!0,z},t.prototype.pickWithRay=function(D,w,N,F){throw Se.a.WarnImport("Ray")},t.prototype.multiPick=function(D,w,N,F,k){throw Se.a.WarnImport("Ray")},t.prototype.multiPickWithRay=function(D,w,N){throw Se.a.WarnImport("Ray")},t.prototype.setPointerOverMesh=function(D){this._inputManager.setPointerOverMesh(D)},t.prototype.getPointerOverMesh=function(){return this._inputManager.getPointerOverMesh()},t.prototype._rebuildGeometries=function(){for(var D=0,w=this.geometries;D<w.length;D++)w[D]._rebuild();for(var N=0,F=this.meshes;N<F.length;N++)F[N]._rebuild();this.postProcessManager&&this.postProcessManager._rebuild();for(var k=0,j=this._components;k<j.length;k++)j[k].rebuild();for(var z=0,G=this.particleSystems;z<G.length;z++)G[z].rebuild()},t.prototype._rebuildTextures=function(){for(var D=0,w=this.textures;D<w.length;D++)w[D]._rebuild();this.markAllMaterialsAsDirty(ye.a.MATERIAL_TextureDirtyFlag)},t.prototype._getByTags=function(D,w,N){if(void 0===w)return D;var F=[];for(var k in N=N||function(D){},D){var j=D[k];X.a&&X.a.MatchesQuery(j,w)&&(F.push(j),N(j))}return F},t.prototype.getMeshesByTags=function(D,w){return this._getByTags(this.meshes,D,w)},t.prototype.getCamerasByTags=function(D,w){return this._getByTags(this.cameras,D,w)},t.prototype.getLightsByTags=function(D,w){return this._getByTags(this.lights,D,w)},t.prototype.getMaterialByTags=function(D,w){return this._getByTags(this.materials,D,w).concat(this._getByTags(this.multiMaterials,D,w))},t.prototype.setRenderingOrder=function(D,w,N,F){void 0===w&&(w=null),void 0===N&&(N=null),void 0===F&&(F=null),this._renderingManager.setRenderingOrder(D,w,N,F)},t.prototype.setRenderingAutoClearDepthStencil=function(D,w,N,F){void 0===N&&(N=!0),void 0===F&&(F=!0),this._renderingManager.setRenderingAutoClearDepthStencil(D,w,N,F)},t.prototype.getAutoClearDepthStencilSetup=function(D){return this._renderingManager.getAutoClearDepthStencilSetup(D)},Object.defineProperty(t.prototype,"blockMaterialDirtyMechanism",{get:function(){return this._blockMaterialDirtyMechanism},set:function(D){this._blockMaterialDirtyMechanism!==D&&(this._blockMaterialDirtyMechanism=D,D||this.markAllMaterialsAsDirty(ye.a.MATERIAL_AllDirtyFlag))},enumerable:!0,configurable:!0}),t.prototype.markAllMaterialsAsDirty=function(D,w){if(!this._blockMaterialDirtyMechanism)for(var N=0,F=this.materials;N<F.length;N++){var k=F[N];w&&!w(k)||k.markAsDirty(D)}},t.prototype._loadFile=function(D,w,N,F,k,j){var z=this,G=we.a.LoadFile(D,w,N,F?this.offlineProvider:void 0,k,j);return this._activeRequests.push(G),G.onCompleteObservable.add((function(D){z._activeRequests.splice(z._activeRequests.indexOf(D),1)})),G},t.prototype._loadFileAsync=function(D,w,N,F){var k=this;return new Promise((function(j,z){k._loadFile(D,(function(D){j(D)}),w,N,F,(function(D,w){z(w)}))}))},t.prototype._requestFile=function(D,w,N,F,k,j,z){var G=this,H=we.a.RequestFile(D,w,N,F?this.offlineProvider:void 0,k,j,z);return this._activeRequests.push(H),H.onCompleteObservable.add((function(D){G._activeRequests.splice(G._activeRequests.indexOf(D),1)})),H},t.prototype._requestFileAsync=function(D,w,N,F,k){var j=this;return new Promise((function(z,G){j._requestFile(D,(function(D){z(D)}),w,N,F,(function(D){G(D)}),k)}))},t.prototype._readFile=function(D,w,N,F,k){var j=this,z=we.a.ReadFile(D,w,N,F,k);return this._activeRequests.push(z),z.onCompleteObservable.add((function(D){j._activeRequests.splice(j._activeRequests.indexOf(D),1)})),z},t.prototype._readFileAsync=function(D,w,N){var F=this;return new Promise((function(k,j){F._readFile(D,(function(D){k(D)}),w,N,(function(D){j(D)}))}))},t.FOGMODE_NONE=0,t.FOGMODE_EXP=1,t.FOGMODE_EXP2=2,t.FOGMODE_LINEAR=3,t.MinDeltaTime=1,t.MaxDeltaTime=1e3,t}(te.a)},function(D,w,N){"use strict";N.d(w,"a",(function(){return F}));var F=function(){function e(){}return e.WarnImport=function(D){return D+" needs to be imported before as it contains a side-effect required by your code."},e}()},function(D,w,N){"use strict";N.d(w,"a",(function(){return j})),N.d(w,"c",(function(){return a})),N.d(w,"d",(function(){return z})),N.d(w,"b",(function(){return G}));var F=N(1),k=N(0),j=function(){function e(){}return e.POINTERDOWN=1,e.POINTERUP=2,e.POINTERMOVE=4,e.POINTERWHEEL=8,e.POINTERPICK=16,e.POINTERTAP=32,e.POINTERDOUBLETAP=64,e}(),a=function(D,w){this.type=D,this.event=w},z=function(D){function t(w,N,F,j){var z=D.call(this,w,N)||this;return z.ray=null,z.skipOnPointerObservable=!1,z.localPosition=new k.d(F,j),z}return Object(F.d)(t,D),t}(a),G=function(D){function t(w,N,F){var k=D.call(this,w,N)||this;return k.pickInfo=F,k}return Object(F.d)(t,D),t}(a)},function(D,w,N){"use strict";N.d(w,"a",(function(){return j}));var F=N(11),k=N(2),j=function(){function e(){}return Object.defineProperty(e,"DiffuseTextureEnabled",{get:function(){return this._DiffuseTextureEnabled},set:function(D){this._DiffuseTextureEnabled!==D&&(this._DiffuseTextureEnabled=D,F.a.MarkAllMaterialsAsDirty(k.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e,"AmbientTextureEnabled",{get:function(){return this._AmbientTextureEnabled},set:function(D){this._AmbientTextureEnabled!==D&&(this._AmbientTextureEnabled=D,F.a.MarkAllMaterialsAsDirty(k.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e,"OpacityTextureEnabled",{get:function(){return this._OpacityTextureEnabled},set:function(D){this._OpacityTextureEnabled!==D&&(this._OpacityTextureEnabled=D,F.a.MarkAllMaterialsAsDirty(k.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ReflectionTextureEnabled",{get:function(){return this._ReflectionTextureEnabled},set:function(D){this._ReflectionTextureEnabled!==D&&(this._ReflectionTextureEnabled=D,F.a.MarkAllMaterialsAsDirty(k.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e,"EmissiveTextureEnabled",{get:function(){return this._EmissiveTextureEnabled},set:function(D){this._EmissiveTextureEnabled!==D&&(this._EmissiveTextureEnabled=D,F.a.MarkAllMaterialsAsDirty(k.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e,"SpecularTextureEnabled",{get:function(){return this._SpecularTextureEnabled},set:function(D){this._SpecularTextureEnabled!==D&&(this._SpecularTextureEnabled=D,F.a.MarkAllMaterialsAsDirty(k.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e,"BumpTextureEnabled",{get:function(){return this._BumpTextureEnabled},set:function(D){this._BumpTextureEnabled!==D&&(this._BumpTextureEnabled=D,F.a.MarkAllMaterialsAsDirty(k.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e,"LightmapTextureEnabled",{get:function(){return this._LightmapTextureEnabled},set:function(D){this._LightmapTextureEnabled!==D&&(this._LightmapTextureEnabled=D,F.a.MarkAllMaterialsAsDirty(k.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e,"RefractionTextureEnabled",{get:function(){return this._RefractionTextureEnabled},set:function(D){this._RefractionTextureEnabled!==D&&(this._RefractionTextureEnabled=D,F.a.MarkAllMaterialsAsDirty(k.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ColorGradingTextureEnabled",{get:function(){return this._ColorGradingTextureEnabled},set:function(D){this._ColorGradingTextureEnabled!==D&&(this._ColorGradingTextureEnabled=D,F.a.MarkAllMaterialsAsDirty(k.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e,"FresnelEnabled",{get:function(){return this._FresnelEnabled},set:function(D){this._FresnelEnabled!==D&&(this._FresnelEnabled=D,F.a.MarkAllMaterialsAsDirty(k.a.MATERIAL_FresnelDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ClearCoatTextureEnabled",{get:function(){return this._ClearCoatTextureEnabled},set:function(D){this._ClearCoatTextureEnabled!==D&&(this._ClearCoatTextureEnabled=D,F.a.MarkAllMaterialsAsDirty(k.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ClearCoatBumpTextureEnabled",{get:function(){return this._ClearCoatBumpTextureEnabled},set:function(D){this._ClearCoatBumpTextureEnabled!==D&&(this._ClearCoatBumpTextureEnabled=D,F.a.MarkAllMaterialsAsDirty(k.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ClearCoatTintTextureEnabled",{get:function(){return this._ClearCoatTintTextureEnabled},set:function(D){this._ClearCoatTintTextureEnabled!==D&&(this._ClearCoatTintTextureEnabled=D,F.a.MarkAllMaterialsAsDirty(k.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e,"SheenTextureEnabled",{get:function(){return this._SheenTextureEnabled},set:function(D){this._SheenTextureEnabled!==D&&(this._SheenTextureEnabled=D,F.a.MarkAllMaterialsAsDirty(k.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e,"AnisotropicTextureEnabled",{get:function(){return this._AnisotropicTextureEnabled},set:function(D){this._AnisotropicTextureEnabled!==D&&(this._AnisotropicTextureEnabled=D,F.a.MarkAllMaterialsAsDirty(k.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ThicknessTextureEnabled",{get:function(){return this._ThicknessTextureEnabled},set:function(D){this._ThicknessTextureEnabled!==D&&(this._ThicknessTextureEnabled=D,F.a.MarkAllMaterialsAsDirty(k.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),e._DiffuseTextureEnabled=!0,e._AmbientTextureEnabled=!0,e._OpacityTextureEnabled=!0,e._ReflectionTextureEnabled=!0,e._EmissiveTextureEnabled=!0,e._SpecularTextureEnabled=!0,e._BumpTextureEnabled=!0,e._LightmapTextureEnabled=!0,e._RefractionTextureEnabled=!0,e._ColorGradingTextureEnabled=!0,e._FresnelEnabled=!0,e._ClearCoatTextureEnabled=!0,e._ClearCoatBumpTextureEnabled=!0,e._ClearCoatTintTextureEnabled=!0,e._SheenTextureEnabled=!0,e._AnisotropicTextureEnabled=!0,e._ThicknessTextureEnabled=!0,e}()},function(D,w,N){"use strict";N.d(w,"b",(function(){return F})),N.d(w,"a",(function(){return j}));var F,k=N(0);!function(D){D[D.LOCAL=0]="LOCAL",D[D.WORLD=1]="WORLD",D[D.BONE=2]="BONE"}(F||(F={}));var j=function(){function e(){}return e.X=new k.e(1,0,0),e.Y=new k.e(0,1,0),e.Z=new k.e(0,0,1),e}()},function(D,w,N){"use strict";N.d(w,"a",(function(){return F}));var F=function(){function e(){}return Object.defineProperty(e,"LastCreatedEngine",{get:function(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]},enumerable:!0,configurable:!0}),Object.defineProperty(e,"LastCreatedScene",{get:function(){return this._LastCreatedScene},enumerable:!0,configurable:!0}),e.Instances=new Array,e._LastCreatedScene=null,e.UseFallbackTexture=!0,e.FallbackTexture="",e}()},function(D,w,N){"use strict";N.d(w,"a",(function(){return ie}));var F=N(1),k=N(3),j=N(34),z=N(13),G=N(6),H=N(0),X=N(26),q=N(7),Z=N(12),J=N(19),$=N(61),te=N(86),ie=function(D){function t(w,N,F,k){void 0===k&&(k=!0);var z=D.call(this,w,F)||this;return z._position=H.e.Zero(),z.upVector=H.e.Up(),z.orthoLeft=null,z.orthoRight=null,z.orthoBottom=null,z.orthoTop=null,z.fov=.8,z.minZ=1,z.maxZ=1e4,z.inertia=.9,z.mode=t.PERSPECTIVE_CAMERA,z.isIntermediate=!1,z.viewport=new $.a(0,0,1,1),z.layerMask=268435455,z.fovMode=t.FOVMODE_VERTICAL_FIXED,z.cameraRigMode=t.RIG_MODE_NONE,z.customRenderTargets=new Array,z.outputRenderTarget=null,z.onViewMatrixChangedObservable=new G.c,z.onProjectionMatrixChangedObservable=new G.c,z.onAfterCheckInputsObservable=new G.c,z.onRestoreStateObservable=new G.c,z.isRigCamera=!1,z._rigCameras=new Array,z._webvrViewMatrix=H.a.Identity(),z._skipRendering=!1,z._projectionMatrix=new H.a,z._postProcesses=new Array,z._activeMeshes=new j.a(256),z._globalPosition=H.e.Zero(),z._computedViewMatrix=H.a.Identity(),z._doNotComputeProjectionMatrix=!1,z._transformMatrix=H.a.Zero(),z._refreshFrustumPlanes=!0,z._isCamera=!0,z._isLeftCamera=!1,z._isRightCamera=!1,z.getScene().addCamera(z),k&&!z.getScene().activeCamera&&(z.getScene().activeCamera=z),z.position=N,z}return Object(F.d)(t,D),Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(D){this._position=D},enumerable:!0,configurable:!0}),t.prototype.storeState=function(){return this._stateStored=!0,this._storedFov=this.fov,this},t.prototype._restoreStateValues=function(){return!!this._stateStored&&(this.fov=this._storedFov,!0)},t.prototype.restoreState=function(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)},t.prototype.getClassName=function(){return"Camera"},t.prototype.toString=function(D){var w="Name: "+this.name;if(w+=", type: "+this.getClassName(),this.animations)for(var N=0;N<this.animations.length;N++)w+=", animation[0]: "+this.animations[N].toString(D);return w},Object.defineProperty(t.prototype,"globalPosition",{get:function(){return this._globalPosition},enumerable:!0,configurable:!0}),t.prototype.getActiveMeshes=function(){return this._activeMeshes},t.prototype.isActiveMesh=function(D){return-1!==this._activeMeshes.indexOf(D)},t.prototype.isReady=function(w){if(void 0===w&&(w=!1),w)for(var N=0,F=this._postProcesses;N<F.length;N++){var k=F[N];if(k&&!k.isReady())return!1}return D.prototype.isReady.call(this,w)},t.prototype._initCache=function(){D.prototype._initCache.call(this),this._cache.position=new H.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new H.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.minZ=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0},t.prototype._updateCache=function(w){w||D.prototype._updateCache.call(this),this._cache.position.copyFrom(this.position),this._cache.upVector.copyFrom(this.upVector)},t.prototype._isSynchronized=function(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()},t.prototype._isSynchronizedViewMatrix=function(){return!!D.prototype._isSynchronized.call(this)&&this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent()},t.prototype._isSynchronizedProjectionMatrix=function(){var D=this._cache.mode===this.mode&&this._cache.minZ===this.minZ&&this._cache.maxZ===this.maxZ;if(!D)return!1;var w=this.getEngine();return this.mode===t.PERSPECTIVE_CAMERA?this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===w.getAspectRatio(this):this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===w.getRenderWidth()&&this._cache.renderHeight===w.getRenderHeight()},t.prototype.attachControl=function(D,w){},t.prototype.detachControl=function(D){},t.prototype.update=function(){this._checkInputs(),this.cameraRigMode!==t.RIG_MODE_NONE&&this._updateRigCameras()},t.prototype._checkInputs=function(){this.onAfterCheckInputsObservable.notifyObservers(this)},Object.defineProperty(t.prototype,"rigCameras",{get:function(){return this._rigCameras},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rigPostProcess",{get:function(){return this._rigPostProcess},enumerable:!0,configurable:!0}),t.prototype._getFirstPostProcess=function(){for(var D=0;D<this._postProcesses.length;D++)if(null!==this._postProcesses[D])return this._postProcesses[D];return null},t.prototype._cascadePostProcessesToRigCams=function(){var D=this._getFirstPostProcess();D&&D.markTextureDirty();for(var w=0,N=this._rigCameras.length;w<N;w++){var F=this._rigCameras[w],k=F._rigPostProcess;k?("pass"===k.getEffectName()&&(F.isIntermediate=0===this._postProcesses.length),F._postProcesses=this._postProcesses.slice(0).concat(k),k.markTextureDirty()):F._postProcesses=this._postProcesses.slice(0)}},t.prototype.attachPostProcess=function(D,w){return void 0===w&&(w=null),!D.isReusable()&&this._postProcesses.indexOf(D)>-1?(q.a.Error("You're trying to reuse a post process not defined as reusable."),0):(null==w||w<0?this._postProcesses.push(D):null===this._postProcesses[w]?this._postProcesses[w]=D:this._postProcesses.splice(w,0,D),this._cascadePostProcessesToRigCams(),this._postProcesses.indexOf(D))},t.prototype.detachPostProcess=function(D){var w=this._postProcesses.indexOf(D);-1!==w&&(this._postProcesses[w]=null),this._cascadePostProcessesToRigCams()},t.prototype.getWorldMatrix=function(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix},t.prototype._getViewMatrix=function(){return H.a.Identity()},t.prototype.getViewMatrix=function(D){return!D&&this._isSynchronizedViewMatrix()||(this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.getScene().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix},t.prototype.freezeProjectionMatrix=function(D){this._doNotComputeProjectionMatrix=!0,void 0!==D&&(this._projectionMatrix=D)},t.prototype.unfreezeProjectionMatrix=function(){this._doNotComputeProjectionMatrix=!1},t.prototype.getProjectionMatrix=function(D){if(this._doNotComputeProjectionMatrix||!D&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.minZ=this.minZ,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;var w=this.getEngine(),N=this.getScene();if(this.mode===t.PERSPECTIVE_CAMERA){this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=w.getAspectRatio(this),this.minZ<=0&&(this.minZ=.1);var F=w.useReverseDepthBuffer;(N.useRightHandedSystem?F?H.a.PerspectiveFovReverseRHToRef:H.a.PerspectiveFovRHToRef:F?H.a.PerspectiveFovReverseLHToRef:H.a.PerspectiveFovLHToRef)(this.fov,w.getAspectRatio(this),this.minZ,this.maxZ,this._projectionMatrix,this.fovMode===t.FOVMODE_VERTICAL_FIXED)}else{var k=w.getRenderWidth()/2,j=w.getRenderHeight()/2;N.useRightHandedSystem?H.a.OrthoOffCenterRHToRef(this.orthoLeft||-k,this.orthoRight||k,this.orthoBottom||-j,this.orthoTop||j,this.minZ,this.maxZ,this._projectionMatrix):H.a.OrthoOffCenterLHToRef(this.orthoLeft||-k,this.orthoRight||k,this.orthoBottom||-j,this.orthoTop||j,this.minZ,this.maxZ,this._projectionMatrix),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.renderWidth=w.getRenderWidth(),this._cache.renderHeight=w.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix},t.prototype.getTransformationMatrix=function(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix},t.prototype._updateFrustumPlanes=function(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?te.a.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=te.a.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)},t.prototype.isInFrustum=function(D,w){if(void 0===w&&(w=!1),this._updateFrustumPlanes(),w&&this.rigCameras.length>0){var N=!1;return this.rigCameras.forEach((function(w){w._updateFrustumPlanes(),N=N||D.isInFrustum(w._frustumPlanes)})),N}return D.isInFrustum(this._frustumPlanes)},t.prototype.isCompletelyInFrustum=function(D){return this._updateFrustumPlanes(),D.isCompletelyInFrustum(this._frustumPlanes)},t.prototype.getForwardRay=function(D,w,N){throw void 0===D&&(D=100),J.a.WarnImport("Ray")},t.prototype.dispose=function(w,N){for(void 0===N&&(N=!1),this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.getScene().stopAnimation(this),this.getScene().removeCamera(this);this._rigCameras.length>0;){var F=this._rigCameras.pop();F&&F.dispose()}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses=[];else if(this.cameraRigMode!==t.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses=[];else for(var k=this._postProcesses.length;--k>=0;){var j=this._postProcesses[k];j&&j.dispose(this)}for(k=this.customRenderTargets.length;--k>=0;)this.customRenderTargets[k].dispose();this.customRenderTargets=[],this._activeMeshes.dispose(),D.prototype.dispose.call(this,w,N)},Object.defineProperty(t.prototype,"isLeftCamera",{get:function(){return this._isLeftCamera},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isRightCamera",{get:function(){return this._isRightCamera},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"leftCamera",{get:function(){return this._rigCameras.length<1?null:this._rigCameras[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rightCamera",{get:function(){return this._rigCameras.length<2?null:this._rigCameras[1]},enumerable:!0,configurable:!0}),t.prototype.getLeftTarget=function(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()},t.prototype.getRightTarget=function(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()},t.prototype.setCameraRigMode=function(D,w){if(this.cameraRigMode!==D){for(;this._rigCameras.length>0;){var N=this._rigCameras.pop();N&&N.dispose()}if(this.cameraRigMode=D,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=w.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=z.b.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==t.RIG_MODE_NONE){var F=this.createRigCamera(this.name+"_L",0);F&&(F._isLeftCamera=!0);var k=this.createRigCamera(this.name+"_R",1);k&&(k._isRightCamera=!0),F&&k&&(this._rigCameras.push(F),this._rigCameras.push(k))}switch(this.cameraRigMode){case t.RIG_MODE_STEREOSCOPIC_ANAGLYPH:t._setStereoscopicAnaglyphRigMode(this);break;case t.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case t.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case t.RIG_MODE_STEREOSCOPIC_OVERUNDER:case t.RIG_MODE_STEREOSCOPIC_INTERLACED:t._setStereoscopicRigMode(this);break;case t.RIG_MODE_VR:t._setVRRigMode(this,w);break;case t.RIG_MODE_WEBVR:t._setWebVRRigMode(this,w)}this._cascadePostProcessesToRigCams(),this.update()}},t._setStereoscopicRigMode=function(D){throw"Import Cameras/RigModes/stereoscopicRigMode before using stereoscopic rig mode"},t._setStereoscopicAnaglyphRigMode=function(D){throw"Import Cameras/RigModes/stereoscopicAnaglyphRigMode before using stereoscopic anaglyph rig mode"},t._setVRRigMode=function(D,w){throw"Import Cameras/RigModes/vrRigMode before using VR rig mode"},t._setWebVRRigMode=function(D,w){throw"Import Cameras/RigModes/WebVRRigMode before using Web VR rig mode"},t.prototype._getVRProjectionMatrix=function(){return H.a.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.minZ,this.maxZ,this._cameraRigParams.vrWorkMatrix),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix},t.prototype._updateCameraRotationMatrix=function(){},t.prototype._updateWebVRCameraRotationMatrix=function(){},t.prototype._getWebVRProjectionMatrix=function(){return H.a.Identity()},t.prototype._getWebVRViewMatrix=function(){return H.a.Identity()},t.prototype.setCameraRigParameter=function(D,w){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[D]=w,"interaxialDistance"===D&&(this._cameraRigParams.stereoHalfAngle=z.b.ToRadians(w/.0637))},t.prototype.createRigCamera=function(D,w){return null},t.prototype._updateRigCameras=function(){for(var D=0;D<this._rigCameras.length;D++)this._rigCameras[D].minZ=this.minZ,this._rigCameras[D].maxZ=this.maxZ,this._rigCameras[D].fov=this.fov,this._rigCameras[D].upVector.copyFrom(this.upVector);this.cameraRigMode===t.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)},t.prototype._setupInputs=function(){},t.prototype.serialize=function(){var D=k.a.Serialize(this);return D.type=this.getClassName(),this.parent&&(D.parentId=this.parent.id),this.inputs&&this.inputs.serialize(D),k.a.AppendSerializedAnimations(this,D),D.ranges=this.serializeAnimationRanges(),D},t.prototype.clone=function(D){return k.a.Clone(t.GetConstructorFromName(this.getClassName(),D,this.getScene(),this.interaxialDistance,this.isStereoscopicSideBySide),this)},t.prototype.getDirection=function(D){var w=H.e.Zero();return this.getDirectionToRef(D,w),w},Object.defineProperty(t.prototype,"absoluteRotation",{get:function(){var D=H.b.Zero();return this.getWorldMatrix().decompose(void 0,D),D},enumerable:!0,configurable:!0}),t.prototype.getDirectionToRef=function(D,w){H.e.TransformNormalToRef(D,this.getWorldMatrix(),w)},t.GetConstructorFromName=function(D,w,N,F,k){return void 0===F&&(F=0),void 0===k&&(k=!0),X.a.Construct(D,w,N,{interaxial_distance:F,isStereoscopicSideBySide:k})||function(){return t._createDefaultParsedCamera(w,N)}},t.prototype.computeWorldMatrix=function(){return this.getWorldMatrix()},t.Parse=function(D,w){var N=D.type,F=t.GetConstructorFromName(N,D.name,w,D.interaxial_distance,D.isStereoscopicSideBySide),j=k.a.Parse(F,D,w);if(D.parentId&&(j._waitingParentId=D.parentId),j.inputs&&(j.inputs.parse(D),j._setupInputs()),j.setPosition&&(j.position.copyFromFloats(0,0,0),j.setPosition(H.e.FromArray(D.position))),D.target&&j.setTarget&&j.setTarget(H.e.FromArray(D.target)),D.cameraRigMode){var z=D.interaxial_distance?{interaxialDistance:D.interaxial_distance}:{};j.setCameraRigMode(D.cameraRigMode,z)}if(D.animations){for(var G=0;G<D.animations.length;G++){var q=D.animations[G],J=Z.a.GetClass("BABYLON.Animation");J&&j.animations.push(J.Parse(q))}X.a.ParseAnimationRanges(j,D,w)}return D.autoAnimate&&w.beginAnimation(j,D.autoAnimateFrom,D.autoAnimateTo,D.autoAnimateLoop,D.autoAnimateSpeed||1),j},t._createDefaultParsedCamera=function(D,w){throw J.a.WarnImport("UniversalCamera")},t.PERSPECTIVE_CAMERA=0,t.ORTHOGRAPHIC_CAMERA=1,t.FOVMODE_VERTICAL_FIXED=0,t.FOVMODE_HORIZONTAL_FIXED=1,t.RIG_MODE_NONE=0,t.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,t.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,t.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,t.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,t.RIG_MODE_STEREOSCOPIC_INTERLACED=14,t.RIG_MODE_VR=20,t.RIG_MODE_WEBVR=21,t.RIG_MODE_CUSTOM=22,t.ForceAttachControlToAlwaysPreventDefault=!1,Object(F.c)([Object(k.o)("position")],t.prototype,"_position",void 0),Object(F.c)([Object(k.o)()],t.prototype,"upVector",void 0),Object(F.c)([Object(k.c)()],t.prototype,"orthoLeft",void 0),Object(F.c)([Object(k.c)()],t.prototype,"orthoRight",void 0),Object(F.c)([Object(k.c)()],t.prototype,"orthoBottom",void 0),Object(F.c)([Object(k.c)()],t.prototype,"orthoTop",void 0),Object(F.c)([Object(k.c)()],t.prototype,"fov",void 0),Object(F.c)([Object(k.c)()],t.prototype,"minZ",void 0),Object(F.c)([Object(k.c)()],t.prototype,"maxZ",void 0),Object(F.c)([Object(k.c)()],t.prototype,"inertia",void 0),Object(F.c)([Object(k.c)()],t.prototype,"mode",void 0),Object(F.c)([Object(k.c)()],t.prototype,"layerMask",void 0),Object(F.c)([Object(k.c)()],t.prototype,"fovMode",void 0),Object(F.c)([Object(k.c)()],t.prototype,"cameraRigMode",void 0),Object(F.c)([Object(k.c)()],t.prototype,"interaxialDistance",void 0),Object(F.c)([Object(k.c)()],t.prototype,"isStereoscopicSideBySide",void 0),t}(X.a)},function(D,w,N){"use strict";N.d(w,"b",(function(){return F})),N.d(w,"a",(function(){return H}));var F,k=N(6),j=N(95),z=N(2),G=N(19);!function(D){D[D.Unknown=0]="Unknown",D[D.Url=1]="Url",D[D.Temp=2]="Temp",D[D.Raw=3]="Raw",D[D.Dynamic=4]="Dynamic",D[D.RenderTarget=5]="RenderTarget",D[D.MultiRenderTarget=6]="MultiRenderTarget",D[D.Cube=7]="Cube",D[D.CubeRaw=8]="CubeRaw",D[D.CubePrefiltered=9]="CubePrefiltered",D[D.Raw3D=10]="Raw3D",D[D.Raw2DArray=11]="Raw2DArray",D[D.Depth=12]="Depth",D[D.CubeRawRGBD=13]="CubeRawRGBD"}(F||(F={}));var H=function(){function e(D,w,N){void 0===N&&(N=!1),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.is2DArray=!1,this.isMultiview=!1,this.url="",this.samplingMode=-1,this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new k.c,this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this._invertVScale=!1,this._associatedChannel=-1,this._source=F.Unknown,this._buffer=null,this._bufferView=null,this._bufferViewArray=null,this._bufferViewArrayArray=null,this._size=0,this._extension="",this._files=null,this._workingCanvas=null,this._workingContext=null,this._framebuffer=null,this._depthStencilBuffer=null,this._MSAAFramebuffer=null,this._MSAARenderBuffer=null,this._attachments=null,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._isDisabled=!1,this._compression=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._comparisonFunction=0,this._sphericalPolynomial=null,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._colorTextureArray=null,this._depthStencilTextureArray=null,this._lodTextureHigh=null,this._lodTextureMid=null,this._lodTextureLow=null,this._isRGBD=!1,this._linearSpecularLOD=!1,this._irradianceTexture=null,this._webGLTexture=null,this._references=1,this._engine=D,this._source=w,N||(this._webGLTexture=D._createTexture())}return e.prototype.getEngine=function(){return this._engine},Object.defineProperty(e.prototype,"source",{get:function(){return this._source},enumerable:!0,configurable:!0}),e.prototype.incrementReferences=function(){this._references++},e.prototype.updateSize=function(D,w,N){void 0===N&&(N=1),this.width=D,this.height=w,this.depth=N,this.baseWidth=D,this.baseHeight=w,this.baseDepth=N,this._size=D*w*N},e.prototype._rebuild=function(){var D,w=this;switch(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedAnisotropicFilteringLevel=null,this.source){case F.Temp:return;case F.Url:return void(D=this._engine.createTexture(this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,(function(){D._swapAndDie(w),w.isReady=!0}),null,this._buffer,void 0,this.format));case F.Raw:return(D=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case F.Raw3D:return(D=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case F.Raw2DArray:return(D=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case F.Dynamic:return(D=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode))._swapAndDie(this),void this._engine.updateDynamicTexture(this,this._engine.getRenderingCanvas(),this.invertY,void 0,void 0,!0);case F.RenderTarget:var N=new j.a;if(N.generateDepthBuffer=this._generateDepthBuffer,N.generateMipMaps=this.generateMipMaps,N.generateStencilBuffer=this._generateStencilBuffer,N.samplingMode=this.samplingMode,N.type=this.type,this.isCube)D=this._engine.createRenderTargetCubeTexture(this.width,N);else{var k={width:this.width,height:this.height,layers:this.is2DArray?this.depth:void 0};D=this._engine.createRenderTargetTexture(k,N)}return D._swapAndDie(this),void(this.isReady=!0);case F.Depth:var G={bilinearFiltering:this.samplingMode!==z.a.TEXTURE_BILINEAR_SAMPLINGMODE,comparisonFunction:this._comparisonFunction,generateStencil:this._generateStencilBuffer,isCube:this.isCube},H={width:this.width,height:this.height,layers:this.is2DArray?this.depth:void 0};return(D=this._engine.createDepthStencilTexture(H,G))._swapAndDie(this),void(this.isReady=!0);case F.Cube:return void(D=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,(function(){D._swapAndDie(w),w.isReady=!0}),null,this.format,this._extension));case F.CubeRaw:return(D=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case F.CubeRawRGBD:return D=this._engine.createRawCubeTexture(null,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),void e._UpdateRGBDAsync(D,this._bufferViewArrayArray,this._sphericalPolynomial,this._lodGenerationScale,this._lodGenerationOffset).then((function(){D._swapAndDie(w),w.isReady=!0}));case F.CubePrefiltered:return void((D=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,(function(D){D&&D._swapAndDie(w),w.isReady=!0}),null,this.format,this._extension))._sphericalPolynomial=this._sphericalPolynomial)}},e.prototype._swapAndDie=function(D){D._webGLTexture=this._webGLTexture,D._isRGBD=this._isRGBD,this._framebuffer&&(D._framebuffer=this._framebuffer),this._depthStencilBuffer&&(D._depthStencilBuffer=this._depthStencilBuffer),D._depthStencilTexture=this._depthStencilTexture,this._lodTextureHigh&&(D._lodTextureHigh&&D._lodTextureHigh.dispose(),D._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(D._lodTextureMid&&D._lodTextureMid.dispose(),D._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(D._lodTextureLow&&D._lodTextureLow.dispose(),D._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(D._irradianceTexture&&D._irradianceTexture.dispose(),D._irradianceTexture=this._irradianceTexture);var w,N=this._engine.getLoadedTexturesCache();-1!==(w=N.indexOf(this))&&N.splice(w,1),-1===(w=N.indexOf(D))&&N.push(D)},e.prototype.dispose=function(){this._webGLTexture&&(this._references--,0===this._references&&(this._engine._releaseTexture(this),this._webGLTexture=null))},e._UpdateRGBDAsync=function(D,w,N,F,k){throw G.a.WarnImport("environmentTextureTools")},e}()},function(D,w,N){"use strict";N.d(w,"a",(function(){return X}));var F=N(1),k=N(0),j=N(3),z=N(6),G=N(23),H=N(19),X=function(){function e(D,w){void 0===w&&(w=null),this.state="",this.metadata=null,this.reservedDataStore=null,this._doNotSerialize=!1,this._isDisposed=!1,this.animations=new Array,this._ranges={},this.onReady=null,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=k.a.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._sceneRootNodesIndex=-1,this._animationPropertiesOverride=null,this._isNode=!0,this.onDisposeObservable=new z.c,this._onDisposeObserver=null,this._behaviors=new Array,this.name=D,this.id=D,this._scene=w||G.a.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache()}return e.AddNodeConstructor=function(D,w){this._NodeConstructors[D]=w},e.Construct=function(D,w,N,F){var k=this._NodeConstructors[D];return k?k(w,N,F):null},Object.defineProperty(e.prototype,"doNotSerialize",{get:function(){return!!this._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize},set:function(D){this._doNotSerialize=D},enumerable:!0,configurable:!0}),e.prototype.isDisposed=function(){return this._isDisposed},Object.defineProperty(e.prototype,"parent",{get:function(){return this._parentNode},set:function(D){if(this._parentNode!==D){var w=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){var N=this._parentNode._children.indexOf(this);-1!==N&&this._parentNode._children.splice(N,1),D||this._isDisposed||this._addToSceneRootNodes()}this._parentNode=D,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),w||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}},enumerable:!0,configurable:!0}),e.prototype._addToSceneRootNodes=function(){-1===this._sceneRootNodesIndex&&(this._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))},e.prototype._removeFromSceneRootNodes=function(){if(-1!==this._sceneRootNodesIndex){var D=this._scene.rootNodes,w=D.length-1;D[this._sceneRootNodesIndex]=D[w],D[this._sceneRootNodesIndex]._sceneRootNodesIndex=this._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._sceneRootNodesIndex=-1}},Object.defineProperty(e.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride},set:function(D){this._animationPropertiesOverride=D},enumerable:!0,configurable:!0}),e.prototype.getClassName=function(){return"Node"},Object.defineProperty(e.prototype,"onDispose",{set:function(D){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(D)},enumerable:!0,configurable:!0}),e.prototype.getScene=function(){return this._scene},e.prototype.getEngine=function(){return this._scene.getEngine()},e.prototype.addBehavior=function(D,w){var N=this;return void 0===w&&(w=!1),-1!==this._behaviors.indexOf(D)||(D.init(),this._scene.isLoading&&!w?this._scene.onDataLoadedObservable.addOnce((function(){D.attach(N)})):D.attach(this),this._behaviors.push(D)),this},e.prototype.removeBehavior=function(D){var w=this._behaviors.indexOf(D);return-1===w||(this._behaviors[w].detach(),this._behaviors.splice(w,1)),this},Object.defineProperty(e.prototype,"behaviors",{get:function(){return this._behaviors},enumerable:!0,configurable:!0}),e.prototype.getBehaviorByName=function(D){for(var w=0,N=this._behaviors;w<N.length;w++){var F=N[w];if(F.name===D)return F}return null},e.prototype.getWorldMatrix=function(){return this._currentRenderId!==this._scene.getRenderId()&&this.computeWorldMatrix(),this._worldMatrix},e.prototype._getWorldMatrixDeterminant=function(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant},Object.defineProperty(e.prototype,"worldMatrixFromCache",{get:function(){return this._worldMatrix},enumerable:!0,configurable:!0}),e.prototype._initCache=function(){this._cache={},this._cache.parent=void 0},e.prototype.updateCache=function(D){!D&&this.isSynchronized()||(this._cache.parent=this.parent,this._updateCache())},e.prototype._getActionManagerForTrigger=function(D,w){return void 0===w&&(w=!0),this.parent?this.parent._getActionManagerForTrigger(D,!1):null},e.prototype._updateCache=function(D){},e.prototype._isSynchronized=function(){return!0},e.prototype._markSyncedWithParent=function(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)},e.prototype.isSynchronizedWithParent=function(){return!this._parentNode||this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()},e.prototype.isSynchronized=function(){return this._cache.parent!=this._parentNode?(this._cache.parent=this._parentNode,!1):!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()},e.prototype.isReady=function(D){return void 0===D&&(D=!1),this._isReady},e.prototype.isEnabled=function(D){return void 0===D&&(D=!0),!1===D?this._isEnabled:!!this._isEnabled&&this._isParentEnabled},e.prototype._syncParentEnabledState=function(){this._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children&&this._children.forEach((function(D){D._syncParentEnabledState()}))},e.prototype.setEnabled=function(D){this._isEnabled=D,this._syncParentEnabledState()},e.prototype.isDescendantOf=function(D){return!!this.parent&&(this.parent===D||this.parent.isDescendantOf(D))},e.prototype._getDescendants=function(D,w,N){if(void 0===w&&(w=!1),this._children)for(var F=0;F<this._children.length;F++){var k=this._children[F];N&&!N(k)||D.push(k),w||k._getDescendants(D,!1,N)}},e.prototype.getDescendants=function(D,w){var N=new Array;return this._getDescendants(N,D,w),N},e.prototype.getChildMeshes=function(D,w){var N=[];return this._getDescendants(N,D,(function(D){return(!w||w(D))&&void 0!==D.cullingStrategy})),N},e.prototype.getChildren=function(D,w){return void 0===w&&(w=!0),this.getDescendants(w,D)},e.prototype._setReady=function(D){D!==this._isReady&&(D?(this.onReady&&this.onReady(this),this._isReady=!0):this._isReady=!1)},e.prototype.getAnimationByName=function(D){for(var w=0;w<this.animations.length;w++){var N=this.animations[w];if(N.name===D)return N}return null},e.prototype.createAnimationRange=function(D,w,N){if(!this._ranges[D]){this._ranges[D]=e._AnimationRangeFactory(D,w,N);for(var F=0,k=this.animations.length;F<k;F++)this.animations[F]&&this.animations[F].createRange(D,w,N)}},e.prototype.deleteAnimationRange=function(D,w){void 0===w&&(w=!0);for(var N=0,F=this.animations.length;N<F;N++)this.animations[N]&&this.animations[N].deleteRange(D,w);this._ranges[D]=null},e.prototype.getAnimationRange=function(D){return this._ranges[D]},e.prototype.getAnimationRanges=function(){var D,w=[];for(D in this._ranges)w.push(this._ranges[D]);return w},e.prototype.beginAnimation=function(D,w,N,F){var k=this.getAnimationRange(D);return k?this._scene.beginAnimation(this,k.from,k.to,w,N,F):null},e.prototype.serializeAnimationRanges=function(){var D=[];for(var w in this._ranges){var N=this._ranges[w];if(N){var F={};F.name=w,F.from=N.from,F.to=N.to,D.push(F)}}return D},e.prototype.computeWorldMatrix=function(D){return this._worldMatrix||(this._worldMatrix=k.a.Identity()),this._worldMatrix},e.prototype.dispose=function(D,w){if(void 0===w&&(w=!1),this._isDisposed=!0,!D)for(var N=0,F=this.getDescendants(!0);N<F.length;N++)F[N].dispose(D,w);this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear();for(var k=0,j=this._behaviors;k<j.length;k++)j[k].detach();this._behaviors=[]},e.ParseAnimationRanges=function(D,w,N){if(w.ranges)for(var F=0;F<w.ranges.length;F++){var k=w.ranges[F];D.createAnimationRange(k.name,k.from,k.to)}},e.prototype.getHierarchyBoundingVectors=function(D,w){var N,F;if(void 0===D&&(D=!0),void 0===w&&(w=null),this.getScene().incrementRenderId(),this.computeWorldMatrix(!0),this.getBoundingInfo&&this.subMeshes){var j=this.getBoundingInfo();N=j.boundingBox.minimumWorld.clone(),F=j.boundingBox.maximumWorld.clone()}else N=new k.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),F=new k.e(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(D)for(var z=0,G=this.getDescendants(!1);z<G.length;z++){var H=G[z];if(H.computeWorldMatrix(!0),(!w||w(H))&&H.getBoundingInfo&&0!==H.getTotalVertices()){var X=H.getBoundingInfo().boundingBox,q=X.minimumWorld,Z=X.maximumWorld;k.e.CheckExtends(q,N,F),k.e.CheckExtends(Z,N,F)}}return{min:N,max:F}},e._AnimationRangeFactory=function(D,w,N){throw H.a.WarnImport("AnimationRange")},e._NodeConstructors={},Object(F.c)([Object(j.c)()],e.prototype,"name",void 0),Object(F.c)([Object(j.c)()],e.prototype,"id",void 0),Object(F.c)([Object(j.c)()],e.prototype,"uniqueId",void 0),Object(F.c)([Object(j.c)()],e.prototype,"state",void 0),Object(F.c)([Object(j.c)()],e.prototype,"metadata",void 0),e}()},function(D,w,N){"use strict";N.d(w,"a",(function(){return pe}));var F=N(1),k=N(13),j=N(6),z=N(0),G=N(11),H=N(4),X=N(15),q=N(43),Z=N(53),J=N(44),$=N(2),te=N(133),ie=N(19),oe=N(110),ce=N(10),he=N(28),fe=N(22),b=function(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=z.e.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1},T=function(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new b,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1},pe=function(D){function t(w,N){void 0===N&&(N=null);var F=D.call(this,w,N,!1)||this;return F._internalAbstractMeshDataInfo=new T,F.cullingStrategy=t.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,F.onCollideObservable=new j.c,F.onCollisionPositionChangeObservable=new j.c,F.onMaterialChangedObservable=new j.c,F.definedFacingForward=!0,F._occlusionQuery=null,F._renderingGroup=null,F.alphaIndex=Number.MAX_VALUE,F.isVisible=!0,F.isPickable=!0,F.showSubMeshesBoundingBox=!1,F.isBlocker=!1,F.enablePointerMoveEvents=!1,F.renderingGroupId=0,F._material=null,F.outlineColor=ce.a.Red(),F.outlineWidth=.02,F.overlayColor=ce.a.Red(),F.overlayAlpha=.5,F.useOctreeForRenderingSelection=!0,F.useOctreeForPicking=!0,F.useOctreeForCollisions=!0,F.alwaysSelectAsActiveMesh=!1,F.doNotSyncBoundingInfo=!1,F.actionManager=null,F._meshCollisionData=new te.a,F.ellipsoid=new z.e(.5,1,.5),F.ellipsoidOffset=new z.e(0,0,0),F.edgesWidth=1,F.edgesColor=new ce.b(1,0,0,1),F._edgesRenderer=null,F._masterMesh=null,F._boundingInfo=null,F._renderId=0,F._intersectionsInProgress=new Array,F._unIndexed=!1,F._lightSources=new Array,F._waitingData={lods:null,actions:null,freezeWorldMatrix:null},F._bonesTransformMatrices=null,F._transformMatrixTexture=null,F.onRebuildObservable=new j.c,F._onCollisionPositionChange=function(D,w,N){void 0===N&&(N=null),w.subtractToRef(F._meshCollisionData._oldPositionForCollisions,F._meshCollisionData._diffPositionForCollisions),F._meshCollisionData._diffPositionForCollisions.length()>G.a.CollisionsEpsilon&&F.position.addInPlace(F._meshCollisionData._diffPositionForCollisions),N&&F.onCollideObservable.notifyObservers(N),F.onCollisionPositionChangeObservable.notifyObservers(F.position)},F.getScene().addMesh(F),F._resyncLightSources(),F}return Object(F.d)(t,D),Object.defineProperty(t,"BILLBOARDMODE_NONE",{get:function(){return q.a.BILLBOARDMODE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(t,"BILLBOARDMODE_X",{get:function(){return q.a.BILLBOARDMODE_X},enumerable:!0,configurable:!0}),Object.defineProperty(t,"BILLBOARDMODE_Y",{get:function(){return q.a.BILLBOARDMODE_Y},enumerable:!0,configurable:!0}),Object.defineProperty(t,"BILLBOARDMODE_Z",{get:function(){return q.a.BILLBOARDMODE_Z},enumerable:!0,configurable:!0}),Object.defineProperty(t,"BILLBOARDMODE_ALL",{get:function(){return q.a.BILLBOARDMODE_ALL},enumerable:!0,configurable:!0}),Object.defineProperty(t,"BILLBOARDMODE_USE_POSITION",{get:function(){return q.a.BILLBOARDMODE_USE_POSITION},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"facetNb",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetNb},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"partitioningSubdivisions",{get:function(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions},set:function(D){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"partitioningBBoxRatio",{get:function(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio},set:function(D){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mustDepthSortFacets",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort},set:function(D){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"facetDepthSortFrom",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom},set:function(D){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isFacetDataEnabled",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled},enumerable:!0,configurable:!0}),t.prototype._updateNonUniformScalingState=function(w){return!!D.prototype._updateNonUniformScalingState.call(this,w)&&(this._markSubMeshesAsMiscDirty(),!0)},Object.defineProperty(t.prototype,"onCollide",{set:function(D){this._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._meshCollisionData._onCollideObserver),this._meshCollisionData._onCollideObserver=this.onCollideObservable.add(D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onCollisionPositionChange",{set:function(D){this._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._meshCollisionData._onCollisionPositionChangeObserver),this._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visibility",{get:function(){return this._internalAbstractMeshDataInfo._visibility},set:function(D){this._internalAbstractMeshDataInfo._visibility!==D&&(this._internalAbstractMeshDataInfo._visibility=D,this._markSubMeshesAsMiscDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"material",{get:function(){return this._material},set:function(D){this._material!==D&&(this._material&&this._material.meshMap&&(this._material.meshMap[this.uniqueId]=void 0),this._material=D,D&&D.meshMap&&(D.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.subMeshes&&this._unBindEffect())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"receiveShadows",{get:function(){return this._internalAbstractMeshDataInfo._receiveShadows},set:function(D){this._internalAbstractMeshDataInfo._receiveShadows!==D&&(this._internalAbstractMeshDataInfo._receiveShadows=D,this._markSubMeshesAsLightDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasVertexAlpha",{get:function(){return this._internalAbstractMeshDataInfo._hasVertexAlpha},set:function(D){this._internalAbstractMeshDataInfo._hasVertexAlpha!==D&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=D,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useVertexColors",{get:function(){return this._internalAbstractMeshDataInfo._useVertexColors},set:function(D){this._internalAbstractMeshDataInfo._useVertexColors!==D&&(this._internalAbstractMeshDataInfo._useVertexColors=D,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"computeBonesUsingShaders",{get:function(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders},set:function(D){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==D&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=D,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numBoneInfluencers",{get:function(){return this._internalAbstractMeshDataInfo._numBoneInfluencers},set:function(D){this._internalAbstractMeshDataInfo._numBoneInfluencers!==D&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=D,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"applyFog",{get:function(){return this._internalAbstractMeshDataInfo._applyFog},set:function(D){this._internalAbstractMeshDataInfo._applyFog!==D&&(this._internalAbstractMeshDataInfo._applyFog=D,this._markSubMeshesAsMiscDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"layerMask",{get:function(){return this._internalAbstractMeshDataInfo._layerMask},set:function(D){D!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=D,this._resyncLightSources())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"collisionMask",{get:function(){return this._meshCollisionData._collisionMask},set:function(D){this._meshCollisionData._collisionMask=isNaN(D)?-1:D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"collisionGroup",{get:function(){return this._meshCollisionData._collisionGroup},set:function(D){this._meshCollisionData._collisionGroup=isNaN(D)?-1:D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lightSources",{get:function(){return this._lightSources},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_positions",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skeleton",{get:function(){return this._internalAbstractMeshDataInfo._skeleton},set:function(D){var w=this._internalAbstractMeshDataInfo._skeleton;w&&w.needInitialSkinMatrix&&w._unregisterMeshWithPoseMatrix(this),D&&D.needInitialSkinMatrix&&D._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=D,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"AbstractMesh"},t.prototype.toString=function(D){var w="Name: "+this.name+", isInstance: "+("InstancedMesh"!==this.getClassName()?"YES":"NO");w+=", # of submeshes: "+(this.subMeshes?this.subMeshes.length:0);var N=this._internalAbstractMeshDataInfo._skeleton;return N&&(w+=", skeleton: "+N.name),D&&(w+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],w+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.freezeWorldMatrix?"YES":"NO")),w},t.prototype._getEffectiveParent=function(){return this._masterMesh&&this.billboardMode!==q.a.BILLBOARDMODE_NONE?this._masterMesh:D.prototype._getEffectiveParent.call(this)},t.prototype._getActionManagerForTrigger=function(D,w){if(void 0===w&&(w=!0),this.actionManager&&(w||this.actionManager.isRecursive)){if(!D)return this.actionManager;if(this.actionManager.hasSpecificTrigger(D))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(D,!1):null},t.prototype._rebuild=function(){if(this.onRebuildObservable.notifyObservers(this),this._occlusionQuery&&(this._occlusionQuery=null),this.subMeshes)for(var D=0,w=this.subMeshes;D<w.length;D++)w[D]._rebuild()},t.prototype._resyncLightSources=function(){this._lightSources.length=0;for(var D=0,w=this.getScene().lights;D<w.length;D++){var N=w[D];N.isEnabled()&&N.canAffectMesh(this)&&this._lightSources.push(N)}this._markSubMeshesAsLightDirty()},t.prototype._resyncLightSource=function(D){var w=D.isEnabled()&&D.canAffectMesh(this),N=this._lightSources.indexOf(D);if(-1===N){if(!w)return;this._lightSources.push(D)}else{if(w)return;this._lightSources.splice(N,1)}this._markSubMeshesAsLightDirty()},t.prototype._unBindEffect=function(){for(var D=0,w=this.subMeshes;D<w.length;D++)w[D].setEffect(null)},t.prototype._removeLightSource=function(D,w){var N=this._lightSources.indexOf(D);-1!==N&&(this._lightSources.splice(N,1),this._markSubMeshesAsLightDirty(w))},t.prototype._markSubMeshesAsDirty=function(D){if(this.subMeshes)for(var w=0,N=this.subMeshes;w<N.length;w++){var F=N[w];F._materialDefines&&D(F._materialDefines)}},t.prototype._markSubMeshesAsLightDirty=function(D){void 0===D&&(D=!1),this._markSubMeshesAsDirty((function(w){return w.markAsLightDirty(D)}))},t.prototype._markSubMeshesAsAttributesDirty=function(){this._markSubMeshesAsDirty((function(D){return D.markAsAttributesDirty()}))},t.prototype._markSubMeshesAsMiscDirty=function(){if(this.subMeshes)for(var D=0,w=this.subMeshes;D<w.length;D++){var N=w[D].getMaterial();N&&N.markAsDirty($.a.MATERIAL_MiscDirtyFlag)}},Object.defineProperty(t.prototype,"scaling",{get:function(){return this._scaling},set:function(D){this._scaling=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isBlocked",{get:function(){return!1},enumerable:!0,configurable:!0}),t.prototype.getLOD=function(D){return this},t.prototype.getTotalVertices=function(){return 0},t.prototype.getTotalIndices=function(){return 0},t.prototype.getIndices=function(){return null},t.prototype.getVerticesData=function(D){return null},t.prototype.setVerticesData=function(D,w,N,F){return this},t.prototype.updateVerticesData=function(D,w,N,F){return this},t.prototype.setIndices=function(D,w){return this},t.prototype.isVerticesDataPresent=function(D){return!1},t.prototype.getBoundingInfo=function(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfo||this._updateBoundingInfo(),this._boundingInfo)},t.prototype.normalizeToUnitCube=function(w,N,F){return void 0===w&&(w=!0),void 0===N&&(N=!1),D.prototype.normalizeToUnitCube.call(this,w,N,F)},t.prototype.setBoundingInfo=function(D){return this._boundingInfo=D,this},Object.defineProperty(t.prototype,"useBones",{get:function(){return this.skeleton&&this.getScene().skeletonsEnabled&&this.isVerticesDataPresent(H.b.MatricesIndicesKind)&&this.isVerticesDataPresent(H.b.MatricesWeightsKind)},enumerable:!0,configurable:!0}),t.prototype._preActivate=function(){},t.prototype._preActivateForIntermediateRendering=function(D){},t.prototype._activate=function(D,w){return this._renderId=D,!0},t.prototype._postActivate=function(){},t.prototype._freeze=function(){},t.prototype._unFreeze=function(){},t.prototype.getWorldMatrix=function(){return this._masterMesh&&this.billboardMode===q.a.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():D.prototype.getWorldMatrix.call(this)},t.prototype._getWorldMatrixDeterminant=function(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():D.prototype._getWorldMatrixDeterminant.call(this)},Object.defineProperty(t.prototype,"isAnInstance",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasInstances",{get:function(){return!1},enumerable:!0,configurable:!0}),t.prototype.movePOV=function(D,w,N){return this.position.addInPlace(this.calcMovePOV(D,w,N)),this},t.prototype.calcMovePOV=function(D,w,N){var F=new z.a;(this.rotationQuaternion?this.rotationQuaternion:z.b.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(F);var k=z.e.Zero(),j=this.definedFacingForward?-1:1;return z.e.TransformCoordinatesFromFloatsToRef(D*j,w,N*j,F,k),k},t.prototype.rotatePOV=function(D,w,N){return this.rotation.addInPlace(this.calcRotatePOV(D,w,N)),this},t.prototype.calcRotatePOV=function(D,w,N){var F=this.definedFacingForward?1:-1;return new z.e(D*F,w,N*F)},t.prototype.refreshBoundingInfo=function(D){return void 0===D&&(D=!1),this._boundingInfo&&this._boundingInfo.isLocked||this._refreshBoundingInfo(this._getPositionData(D),null),this},t.prototype._refreshBoundingInfo=function(D,w){if(D){var N=Object(oe.a)(D,0,this.getTotalVertices(),w);this._boundingInfo?this._boundingInfo.reConstruct(N.minimum,N.maximum):this._boundingInfo=new J.a(N.minimum,N.maximum)}if(this.subMeshes)for(var F=0;F<this.subMeshes.length;F++)this.subMeshes[F].refreshBoundingInfo(D);this._updateBoundingInfo()},t.prototype._getPositionData=function(D){var w=this.getVerticesData(H.b.PositionKind);if(w&&D&&this.skeleton){w=k.b.Slice(w),this._generatePointsArray();var N=this.getVerticesData(H.b.MatricesIndicesKind),F=this.getVerticesData(H.b.MatricesWeightsKind);if(F&&N){var j=this.numBoneInfluencers>4,G=j?this.getVerticesData(H.b.MatricesIndicesExtraKind):null,X=j?this.getVerticesData(H.b.MatricesWeightsExtraKind):null;this.skeleton.prepare();for(var q=this.skeleton.getTransformMatrices(this),Z=z.c.Vector3[0],J=z.c.Matrix[0],$=z.c.Matrix[1],te=0,ie=0;ie<w.length;ie+=3,te+=4){var oe,ce;for(J.reset(),oe=0;oe<4;oe++)(ce=F[te+oe])>0&&(z.a.FromFloat32ArrayToRefScaled(q,Math.floor(16*N[te+oe]),ce,$),J.addToSelf($));if(j)for(oe=0;oe<4;oe++)(ce=X[te+oe])>0&&(z.a.FromFloat32ArrayToRefScaled(q,Math.floor(16*G[te+oe]),ce,$),J.addToSelf($));z.e.TransformCoordinatesFromFloatsToRef(w[ie],w[ie+1],w[ie+2],J,Z),Z.toArray(w,ie),this._positions&&this._positions[ie/3].copyFrom(Z)}}}return w},t.prototype._updateBoundingInfo=function(){var D=this._effectiveMesh;return this._boundingInfo?this._boundingInfo.update(D.worldMatrixFromCache):this._boundingInfo=new J.a(this.absolutePosition,this.absolutePosition,D.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(D.worldMatrixFromCache),this},t.prototype._updateSubMeshesBoundingInfo=function(D){if(!this.subMeshes)return this;for(var w=this.subMeshes.length,N=0;N<w;N++){var F=this.subMeshes[N];(w>1||!F.IsGlobal)&&F.updateBoundingInfo(D)}return this},t.prototype._afterComputeWorldMatrix=function(){this.doNotSyncBoundingInfo||this._updateBoundingInfo()},Object.defineProperty(t.prototype,"_effectiveMesh",{get:function(){return this.skeleton&&this.skeleton.overrideMesh||this},enumerable:!0,configurable:!0}),t.prototype.isInFrustum=function(D){return null!==this._boundingInfo&&this._boundingInfo.isInFrustum(D,this.cullingStrategy)},t.prototype.isCompletelyInFrustum=function(D){return null!==this._boundingInfo&&this._boundingInfo.isCompletelyInFrustum(D)},t.prototype.intersectsMesh=function(D,w,N){if(void 0===w&&(w=!1),!this._boundingInfo||!D._boundingInfo)return!1;if(this._boundingInfo.intersects(D._boundingInfo,w))return!0;if(N)for(var F=0,k=this.getChildMeshes();F<k.length;F++)if(k[F].intersectsMesh(D,w,!0))return!0;return!1},t.prototype.intersectsPoint=function(D){return!!this._boundingInfo&&this._boundingInfo.intersectsPoint(D)},Object.defineProperty(t.prototype,"checkCollisions",{get:function(){return this._meshCollisionData._checkCollisions},set:function(D){this._meshCollisionData._checkCollisions=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"collider",{get:function(){return this._meshCollisionData._collider},enumerable:!0,configurable:!0}),t.prototype.moveWithCollisions=function(D){this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._meshCollisionData._oldPositionForCollisions);var w=this.getScene().collisionCoordinator;return this._meshCollisionData._collider||(this._meshCollisionData._collider=w.createCollider()),this._meshCollisionData._collider._radius=this.ellipsoid,w.getNewPosition(this._meshCollisionData._oldPositionForCollisions,D,this._meshCollisionData._collider,3,this,this._onCollisionPositionChange,this.uniqueId),this},t.prototype._collideForSubMesh=function(D,w,N){if(this._generatePointsArray(),!this._positions)return this;if(!D._lastColliderWorldVertices||!D._lastColliderTransformMatrix.equals(w)){D._lastColliderTransformMatrix=w.clone(),D._lastColliderWorldVertices=[],D._trianglePlanes=[];for(var F=D.verticesStart,k=D.verticesStart+D.verticesCount,j=F;j<k;j++)D._lastColliderWorldVertices.push(z.e.TransformCoordinates(this._positions[j],w))}return N._collide(D._trianglePlanes,D._lastColliderWorldVertices,this.getIndices(),D.indexStart,D.indexStart+D.indexCount,D.verticesStart,!!D.getMaterial(),this),this},t.prototype._processCollisionsForSubMeshes=function(D,w){for(var N=this._scene.getCollidingSubMeshCandidates(this,D),F=N.length,k=0;k<F;k++){var j=N.data[k];F>1&&!j._checkCollision(D)||this._collideForSubMesh(j,w,D)}return this},t.prototype._checkCollision=function(D){if(!this._boundingInfo||!this._boundingInfo._checkCollision(D))return this;var w=z.c.Matrix[0],N=z.c.Matrix[1];return z.a.ScalingToRef(1/D._radius.x,1/D._radius.y,1/D._radius.z,w),this.worldMatrixFromCache.multiplyToRef(w,N),this._processCollisionsForSubMeshes(D,N),this},t.prototype._generatePointsArray=function(){return!1},t.prototype.intersects=function(D,w,N){var F=new Z.a,k="InstancedLinesMesh"===this.getClassName()||"LinesMesh"===this.getClassName()?this.intersectionThreshold:0,j=this._boundingInfo;if(!(this.subMeshes&&j&&D.intersectsSphere(j.boundingSphere,k)&&D.intersectsBox(j.boundingBox,k)))return F;if(!this._generatePointsArray())return F;for(var G=null,H=this._scene.getIntersectingSubMeshCandidates(this,D),X=H.length,q=0;q<X;q++){var J=H.data[q];if(!(X>1)||J.canIntersects(D)){var $=J.intersects(D,this._positions,this.getIndices(),w,N);if($&&(w||!G||$.distance<G.distance)&&((G=$).subMeshId=q,w))break}}if(G){var te=this.getWorldMatrix(),ie=z.c.Vector3[0],oe=z.c.Vector3[1];z.e.TransformCoordinatesToRef(D.origin,te,ie),D.direction.scaleToRef(G.distance,oe);var ce=z.e.TransformNormal(oe,te).addInPlace(ie);return F.hit=!0,F.distance=z.e.Distance(ie,ce),F.pickedPoint=ce,F.pickedMesh=this,F.bu=G.bu||0,F.bv=G.bv||0,F.faceId=G.faceId,F.subMeshId=G.subMeshId,F}return F},t.prototype.clone=function(D,w,N){return null},t.prototype.releaseSubMeshes=function(){if(this.subMeshes)for(;this.subMeshes.length;)this.subMeshes[0].dispose();else this.subMeshes=new Array;return this},t.prototype.dispose=function(w,N){var F,k=this;for(void 0===N&&(N=!1),this._scene.useMaterialMeshMap&&this._material&&this._material.meshMap&&(this._material.meshMap[this.uniqueId]=void 0),this.getScene().freeActiveMeshes(),this.getScene().freeRenderingGroups(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),F=0;F<this._intersectionsInProgress.length;F++){var j=this._intersectionsInProgress[F],z=j._intersectionsInProgress.indexOf(this);j._intersectionsInProgress.splice(z,1)}this._intersectionsInProgress=[],this.getScene().lights.forEach((function(D){var w=D.includedOnlyMeshes.indexOf(k);-1!==w&&D.includedOnlyMeshes.splice(w,1),-1!==(w=D.excludedMeshes.indexOf(k))&&D.excludedMeshes.splice(w,1);var N=D.getShadowGenerator();if(N){var F=N.getShadowMap();F&&F.renderList&&-1!==(w=F.renderList.indexOf(k))&&F.renderList.splice(w,1)}})),"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes();var G=this.getScene().getEngine();if(this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,G.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),G.wipeCaches(),this.getScene().removeMesh(this),N&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!w)for(F=0;F<this.getScene().particleSystems.length;F++)this.getScene().particleSystems[F].emitter===this&&(this.getScene().particleSystems[F].dispose(),F--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),D.prototype.dispose.call(this,w,N)},t.prototype.addChild=function(D){return D.setParent(this),this},t.prototype.removeChild=function(D){return D.setParent(null),this},t.prototype._initFacetData=function(){var D=this._internalAbstractMeshDataInfo._facetData;D.facetNormals||(D.facetNormals=new Array),D.facetPositions||(D.facetPositions=new Array),D.facetPartitioning||(D.facetPartitioning=new Array),D.facetNb=this.getIndices().length/3|0,D.partitioningSubdivisions=D.partitioningSubdivisions?D.partitioningSubdivisions:10,D.partitioningBBoxRatio=D.partitioningBBoxRatio?D.partitioningBBoxRatio:1.01;for(var w=0;w<D.facetNb;w++)D.facetNormals[w]=z.e.Zero(),D.facetPositions[w]=z.e.Zero();return D.facetDataEnabled=!0,this},t.prototype.updateFacetData=function(){var D=this._internalAbstractMeshDataInfo._facetData;D.facetDataEnabled||this._initFacetData();var w=this.getVerticesData(H.b.PositionKind),N=this.getIndices(),F=this.getVerticesData(H.b.NormalKind),k=this.getBoundingInfo();if(D.facetDepthSort&&!D.facetDepthSortEnabled){if(D.facetDepthSortEnabled=!0,N instanceof Uint16Array)D.depthSortedIndices=new Uint16Array(N);else if(N instanceof Uint32Array)D.depthSortedIndices=new Uint32Array(N);else{for(var j=!1,G=0;G<N.length;G++)if(N[G]>65535){j=!0;break}D.depthSortedIndices=j?new Uint32Array(N):new Uint16Array(N)}if(D.facetDepthSortFunction=function(D,w){return w.sqDistance-D.sqDistance},!D.facetDepthSortFrom){var q=this.getScene().activeCamera;D.facetDepthSortFrom=q?q.position:z.e.Zero()}D.depthSortedFacets=[];for(var Z=0;Z<D.facetNb;Z++){var J={ind:3*Z,sqDistance:0};D.depthSortedFacets.push(J)}D.invertedMatrix=z.a.Identity(),D.facetDepthSortOrigin=z.e.Zero()}D.bbSize.x=k.maximum.x-k.minimum.x>he.a?k.maximum.x-k.minimum.x:he.a,D.bbSize.y=k.maximum.y-k.minimum.y>he.a?k.maximum.y-k.minimum.y:he.a,D.bbSize.z=k.maximum.z-k.minimum.z>he.a?k.maximum.z-k.minimum.z:he.a;var $=D.bbSize.x>D.bbSize.y?D.bbSize.x:D.bbSize.y;if($=$>D.bbSize.z?$:D.bbSize.z,D.subDiv.max=D.partitioningSubdivisions,D.subDiv.X=Math.floor(D.subDiv.max*D.bbSize.x/$),D.subDiv.Y=Math.floor(D.subDiv.max*D.bbSize.y/$),D.subDiv.Z=Math.floor(D.subDiv.max*D.bbSize.z/$),D.subDiv.X=D.subDiv.X<1?1:D.subDiv.X,D.subDiv.Y=D.subDiv.Y<1?1:D.subDiv.Y,D.subDiv.Z=D.subDiv.Z<1?1:D.subDiv.Z,D.facetParameters.facetNormals=this.getFacetLocalNormals(),D.facetParameters.facetPositions=this.getFacetLocalPositions(),D.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),D.facetParameters.bInfo=k,D.facetParameters.bbSize=D.bbSize,D.facetParameters.subDiv=D.subDiv,D.facetParameters.ratio=this.partitioningBBoxRatio,D.facetParameters.depthSort=D.facetDepthSort,D.facetDepthSort&&D.facetDepthSortEnabled&&(this.computeWorldMatrix(!0),this._worldMatrix.invertToRef(D.invertedMatrix),z.e.TransformCoordinatesToRef(D.facetDepthSortFrom,D.invertedMatrix,D.facetDepthSortOrigin),D.facetParameters.distanceTo=D.facetDepthSortOrigin),D.facetParameters.depthSortedFacets=D.depthSortedFacets,X.a.ComputeNormals(w,N,F,D.facetParameters),D.facetDepthSort&&D.facetDepthSortEnabled){D.depthSortedFacets.sort(D.facetDepthSortFunction);var te=D.depthSortedIndices.length/3|0;for(Z=0;Z<te;Z++){var ie=D.depthSortedFacets[Z].ind;D.depthSortedIndices[3*Z]=N[ie],D.depthSortedIndices[3*Z+1]=N[ie+1],D.depthSortedIndices[3*Z+2]=N[ie+2]}this.updateIndices(D.depthSortedIndices,void 0,!0)}return this},t.prototype.getFacetLocalNormals=function(){var D=this._internalAbstractMeshDataInfo._facetData;return D.facetNormals||this.updateFacetData(),D.facetNormals},t.prototype.getFacetLocalPositions=function(){var D=this._internalAbstractMeshDataInfo._facetData;return D.facetPositions||this.updateFacetData(),D.facetPositions},t.prototype.getFacetLocalPartitioning=function(){var D=this._internalAbstractMeshDataInfo._facetData;return D.facetPartitioning||this.updateFacetData(),D.facetPartitioning},t.prototype.getFacetPosition=function(D){var w=z.e.Zero();return this.getFacetPositionToRef(D,w),w},t.prototype.getFacetPositionToRef=function(D,w){var N=this.getFacetLocalPositions()[D],F=this.getWorldMatrix();return z.e.TransformCoordinatesToRef(N,F,w),this},t.prototype.getFacetNormal=function(D){var w=z.e.Zero();return this.getFacetNormalToRef(D,w),w},t.prototype.getFacetNormalToRef=function(D,w){var N=this.getFacetLocalNormals()[D];return z.e.TransformNormalToRef(N,this.getWorldMatrix(),w),this},t.prototype.getFacetsAtLocalCoordinates=function(D,w,N){var F=this.getBoundingInfo(),k=this._internalAbstractMeshDataInfo._facetData,j=Math.floor((D-F.minimum.x*k.partitioningBBoxRatio)*k.subDiv.X*k.partitioningBBoxRatio/k.bbSize.x),z=Math.floor((w-F.minimum.y*k.partitioningBBoxRatio)*k.subDiv.Y*k.partitioningBBoxRatio/k.bbSize.y),G=Math.floor((N-F.minimum.z*k.partitioningBBoxRatio)*k.subDiv.Z*k.partitioningBBoxRatio/k.bbSize.z);return j<0||j>k.subDiv.max||z<0||z>k.subDiv.max||G<0||G>k.subDiv.max?null:k.facetPartitioning[j+k.subDiv.max*z+k.subDiv.max*k.subDiv.max*G]},t.prototype.getClosestFacetAtCoordinates=function(D,w,N,F,k,j){void 0===k&&(k=!1),void 0===j&&(j=!0);var G=this.getWorldMatrix(),H=z.c.Matrix[5];G.invertToRef(H);var X=z.c.Vector3[8];z.e.TransformCoordinatesFromFloatsToRef(D,w,N,H,X);var q=this.getClosestFacetAtLocalCoordinates(X.x,X.y,X.z,F,k,j);return F&&z.e.TransformCoordinatesFromFloatsToRef(F.x,F.y,F.z,G,F),q},t.prototype.getClosestFacetAtLocalCoordinates=function(D,w,N,F,k,j){void 0===k&&(k=!1),void 0===j&&(j=!0);var z=null,G=0,H=0,X=0,q=0,Z=0,J=0,$=0,te=0,ie=this.getFacetLocalPositions(),oe=this.getFacetLocalNormals(),ce=this.getFacetsAtLocalCoordinates(D,w,N);if(!ce)return null;for(var he,fe,pe,_e=Number.MAX_VALUE,ve=_e,ye=0;ye<ce.length;ye++)fe=oe[he=ce[ye]],q=(D-(pe=ie[he]).x)*fe.x+(w-pe.y)*fe.y+(N-pe.z)*fe.z,(!k||k&&j&&q>=0||k&&!j&&q<=0)&&(q=fe.x*pe.x+fe.y*pe.y+fe.z*pe.z,Z=-(fe.x*D+fe.y*w+fe.z*N-q)/(fe.x*fe.x+fe.y*fe.y+fe.z*fe.z),(ve=(G=(J=D+fe.x*Z)-D)*G+(H=($=w+fe.y*Z)-w)*H+(X=(te=N+fe.z*Z)-N)*X)<_e&&(_e=ve,z=he,F&&(F.x=J,F.y=$,F.z=te)));return z},t.prototype.getFacetDataParameters=function(){return this._internalAbstractMeshDataInfo._facetData.facetParameters},t.prototype.disableFacetData=function(){var D=this._internalAbstractMeshDataInfo._facetData;return D.facetDataEnabled&&(D.facetDataEnabled=!1,D.facetPositions=new Array,D.facetNormals=new Array,D.facetPartitioning=new Array,D.facetParameters=null,D.depthSortedIndices=new Uint32Array(0)),this},t.prototype.updateIndices=function(D,w,N){return void 0===N&&(N=!1),this},t.prototype.createNormals=function(D){var w,N=this.getVerticesData(H.b.PositionKind),F=this.getIndices();return w=this.isVerticesDataPresent(H.b.NormalKind)?this.getVerticesData(H.b.NormalKind):[],X.a.ComputeNormals(N,F,w,{useRightHandedSystem:this.getScene().useRightHandedSystem}),this.setVerticesData(H.b.NormalKind,w,D),this},t.prototype.alignWithNormal=function(D,w){w||(w=fe.a.Y);var N=z.c.Vector3[0],F=z.c.Vector3[1];return z.e.CrossToRef(w,D,F),z.e.CrossToRef(D,F,N),this.rotationQuaternion?z.b.RotationQuaternionFromAxisToRef(N,D,F,this.rotationQuaternion):z.e.RotationFromAxisToRef(N,D,F,this.rotation),this},t.prototype._checkOcclusionQuery=function(){return!1},t.prototype.disableEdgesRendering=function(){throw ie.a.WarnImport("EdgesRenderer")},t.prototype.enableEdgesRendering=function(D,w){throw ie.a.WarnImport("EdgesRenderer")},t.OCCLUSION_TYPE_NONE=0,t.OCCLUSION_TYPE_OPTIMISTIC=1,t.OCCLUSION_TYPE_STRICT=2,t.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,t.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,t.CULLINGSTRATEGY_STANDARD=$.a.MESHES_CULLINGSTRATEGY_STANDARD,t.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=$.a.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,t.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=$.a.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION,t.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=$.a.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY,t}(q.a)},function(D,w,N){"use strict";N.d(w,"b",(function(){return F})),N.d(w,"c",(function(){return k})),N.d(w,"a",(function(){return j}));var F=1/2.2,k=2.2,j=.001},function(D,w,N){"use strict";N.d(w,"a",(function(){return $}));var F=N(1),k=N(3),j=N(13),z=N(6),G=N(23),H=N(57),X=N(83),q=N(2),Z=N(7),J=N(60),$=function(){function e(D,w,N){this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.onDisposeObservable=new z.c,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=q.a.ALPHA_COMBINE,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this._effect=null,this._useUBO=!1,this._fillMode=e.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this.name=D,this.id=D||j.b.RandomId(),this._scene=w||G.a.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._scene.useRightHandedSystem?this.sideOrientation=e.ClockWiseSideOrientation:this.sideOrientation=e.CounterClockWiseSideOrientation,this._uniformBuffer=new X.a(this._scene.getEngine()),this._useUBO=this.getScene().getEngine().supportsUniformBuffers,N||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={})}return Object.defineProperty(e.prototype,"alpha",{get:function(){return this._alpha},set:function(D){this._alpha!==D&&(this._alpha=D,this.markAsDirty(e.MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"backFaceCulling",{get:function(){return this._backFaceCulling},set:function(D){this._backFaceCulling!==D&&(this._backFaceCulling=D,this.markAsDirty(e.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasRenderTargetTextures",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onDispose",{set:function(D){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(D)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onBindObservable",{get:function(){return this._onBindObservable||(this._onBindObservable=new z.c),this._onBindObservable},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onBind",{set:function(D){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(D)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onUnBindObservable",{get:function(){return this._onUnBindObservable||(this._onUnBindObservable=new z.c),this._onUnBindObservable},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alphaMode",{get:function(){return this._alphaMode},set:function(D){this._alphaMode!==D&&(this._alphaMode=D,this.markAsDirty(e.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"needDepthPrePass",{get:function(){return this._needDepthPrePass},set:function(D){this._needDepthPrePass!==D&&(this._needDepthPrePass=D,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fogEnabled",{get:function(){return this._fogEnabled},set:function(D){this._fogEnabled!==D&&(this._fogEnabled=D,this.markAsDirty(e.MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wireframe",{get:function(){switch(this._fillMode){case e.WireFrameFillMode:case e.LineListDrawMode:case e.LineLoopDrawMode:case e.LineStripDrawMode:return!0}return this._scene.forceWireframe},set:function(D){this.fillMode=D?e.WireFrameFillMode:e.TriangleFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pointsCloud",{get:function(){switch(this._fillMode){case e.PointFillMode:case e.PointListDrawMode:return!0}return this._scene.forcePointsCloud},set:function(D){this.fillMode=D?e.PointFillMode:e.TriangleFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fillMode",{get:function(){return this._fillMode},set:function(D){this._fillMode!==D&&(this._fillMode=D,this.markAsDirty(e.MiscDirtyFlag))},enumerable:!0,configurable:!0}),e.prototype.toString=function(D){return"Name: "+this.name},e.prototype.getClassName=function(){return"Material"},Object.defineProperty(e.prototype,"isFrozen",{get:function(){return this.checkReadyOnlyOnce},enumerable:!0,configurable:!0}),e.prototype.freeze=function(){this.markDirty(),this.checkReadyOnlyOnce=!0},e.prototype.unfreeze=function(){this.markDirty(),this.checkReadyOnlyOnce=!1},e.prototype.isReady=function(D,w){return!0},e.prototype.isReadyForSubMesh=function(D,w,N){return!1},e.prototype.getEffect=function(){return this._effect},e.prototype.getScene=function(){return this._scene},e.prototype.needAlphaBlending=function(){return this.alpha<1},e.prototype.needAlphaBlendingForMesh=function(D){return this.needAlphaBlending()||D.visibility<1||D.hasVertexAlpha},e.prototype.needAlphaTesting=function(){return!1},e.prototype.getAlphaTestTexture=function(){return null},e.prototype.markDirty=function(){for(var D=0,w=this.getScene().meshes;D<w.length;D++){var N=w[D];if(N.subMeshes)for(var F=0,k=N.subMeshes;F<k.length;F++){var j=k[F];j.getMaterial()===this&&j.effect&&(j.effect._wasPreviouslyReady=!1)}}},e.prototype._preBind=function(D,w){void 0===w&&(w=null);var N=this._scene.getEngine(),F=(null==w?this.sideOrientation:w)===e.ClockWiseSideOrientation;return N.enableEffect(D||this._effect),N.setState(this.backFaceCulling,this.zOffset,!1,F),F},e.prototype.bind=function(D,w){},e.prototype.bindForSubMesh=function(D,w,N){},e.prototype.bindOnlyWorldMatrix=function(D){},e.prototype.bindSceneUniformBuffer=function(D,w){w.bindToEffect(D,"Scene")},e.prototype.bindView=function(D){this._useUBO?this.bindSceneUniformBuffer(D,this.getScene().getSceneUniformBuffer()):D.setMatrix("view",this.getScene().getViewMatrix())},e.prototype.bindViewProjection=function(D){this._useUBO?this.bindSceneUniformBuffer(D,this.getScene().getSceneUniformBuffer()):D.setMatrix("viewProjection",this.getScene().getTransformMatrix())},e.prototype._shouldTurnAlphaTestOn=function(D){return!this.needAlphaBlendingForMesh(D)&&this.needAlphaTesting()},e.prototype._afterBind=function(D){if(this._scene._cachedMaterial=this,this._scene._cachedVisibility=D?D.visibility:1,this._onBindObservable&&D&&this._onBindObservable.notifyObservers(D),this.disableDepthWrite){var w=this._scene.getEngine();this._cachedDepthWriteState=w.getDepthWrite(),w.setDepthWrite(!1)}0!==this.depthFunction&&(w=this._scene.getEngine(),this._cachedDepthFunctionState=w.getDepthFunction()||0,w.setDepthFunction(this.depthFunction))},e.prototype.unbind=function(){this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction&&this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState),this.disableDepthWrite&&this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)},e.prototype.getActiveTextures=function(){return[]},e.prototype.hasTexture=function(D){return!1},e.prototype.clone=function(D){return null},e.prototype.getBindedMeshes=function(){var D=this;if(this.meshMap){var w=new Array;for(var N in this.meshMap){var F=this.meshMap[N];F&&w.push(F)}return w}return this._scene.meshes.filter((function(w){return w.material===D}))},e.prototype.forceCompilation=function(D,w,N,k){var j=this,z=Object(F.a)({clipPlane:!1,useInstances:!1},N),G=new H.a,X=this.getScene(),u=function(){if(j._scene&&j._scene.getEngine()){G._materialDefines&&(G._materialDefines._renderId=-1);var N=X.clipPlane;z.clipPlane&&(X.clipPlane=new J.a(0,0,0,1)),j._storeEffectOnSubMeshes?j.isReadyForSubMesh(D,G,z.useInstances)?w&&w(j):G.effect&&G.effect.getCompilationError()&&G.effect.allFallbacksProcessed()?k&&k(G.effect.getCompilationError()):setTimeout(u,16):j.isReady()?w&&w(j):setTimeout(u,16),z.clipPlane&&(X.clipPlane=N)}};u()},e.prototype.forceCompilationAsync=function(D,w){var N=this;return new Promise((function(F,k){N.forceCompilation(D,(function(){F()}),w,(function(D){k(D)}))}))},e.prototype.markAsDirty=function(D){this.getScene().blockMaterialDirtyMechanism||(e._DirtyCallbackArray.length=0,D&e.TextureDirtyFlag&&e._DirtyCallbackArray.push(e._TextureDirtyCallBack),D&e.LightDirtyFlag&&e._DirtyCallbackArray.push(e._LightsDirtyCallBack),D&e.FresnelDirtyFlag&&e._DirtyCallbackArray.push(e._FresnelDirtyCallBack),D&e.AttributesDirtyFlag&&e._DirtyCallbackArray.push(e._AttributeDirtyCallBack),D&e.MiscDirtyFlag&&e._DirtyCallbackArray.push(e._MiscDirtyCallBack),e._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(e._RunDirtyCallBacks),this.getScene().resetCachedMaterial())},e.prototype._markAllSubMeshesAsDirty=function(D){if(!this.getScene().blockMaterialDirtyMechanism)for(var w=0,N=this.getScene().meshes;w<N.length;w++){var F=N[w];if(F.subMeshes)for(var k=0,j=F.subMeshes;k<j.length;k++){var z=j[k];z.getMaterial()===this&&z._materialDefines&&D(z._materialDefines)}}},e.prototype._markAllSubMeshesAsAllDirty=function(){this._markAllSubMeshesAsDirty(e._AllDirtyCallBack)},e.prototype._markAllSubMeshesAsImageProcessingDirty=function(){this._markAllSubMeshesAsDirty(e._ImageProcessingDirtyCallBack)},e.prototype._markAllSubMeshesAsTexturesDirty=function(){this._markAllSubMeshesAsDirty(e._TextureDirtyCallBack)},e.prototype._markAllSubMeshesAsFresnelDirty=function(){this._markAllSubMeshesAsDirty(e._FresnelDirtyCallBack)},e.prototype._markAllSubMeshesAsFresnelAndMiscDirty=function(){this._markAllSubMeshesAsDirty(e._FresnelAndMiscDirtyCallBack)},e.prototype._markAllSubMeshesAsLightsDirty=function(){this._markAllSubMeshesAsDirty(e._LightsDirtyCallBack)},e.prototype._markAllSubMeshesAsAttributesDirty=function(){this._markAllSubMeshesAsDirty(e._AttributeDirtyCallBack)},e.prototype._markAllSubMeshesAsMiscDirty=function(){this._markAllSubMeshesAsDirty(e._MiscDirtyCallBack)},e.prototype._markAllSubMeshesAsTexturesAndMiscDirty=function(){this._markAllSubMeshesAsDirty(e._TextureAndMiscDirtyCallBack)},e.prototype.dispose=function(D,w,N){var F=this.getScene();if(F.stopAnimation(this),F.freeProcessedMaterials(),F.removeMaterial(this),!0!==N)if(this.meshMap)for(var k in this.meshMap)(G=this.meshMap[k])&&(G.material=null,this.releaseVertexArrayObject(G,D));else for(var j=0,z=F.meshes;j<z.length;j++){var G;(G=z[j]).material!==this||G.sourceMesh||(G.material=null,this.releaseVertexArrayObject(G,D))}this._uniformBuffer.dispose(),D&&this._effect&&(this._storeEffectOnSubMeshes||this._effect.dispose(),this._effect=null),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear()},e.prototype.releaseVertexArrayObject=function(D,w){if(D.geometry){var N=D.geometry;if(this._storeEffectOnSubMeshes)for(var F=0,k=D.subMeshes;F<k.length;F++){var j=k[F];N._releaseVertexArrayObject(j._materialEffect),w&&j._materialEffect&&j._materialEffect.dispose()}else N._releaseVertexArrayObject(this._effect)}},e.prototype.serialize=function(){return k.a.Serialize(this)},e.Parse=function(D,w,N){if(D.customType){if("BABYLON.PBRMaterial"===D.customType&&D.overloadedAlbedo&&(D.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return Z.a.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else D.customType="BABYLON.StandardMaterial";return j.b.Instantiate(D.customType).Parse(D,w,N)},e.TriangleFillMode=q.a.MATERIAL_TriangleFillMode,e.WireFrameFillMode=q.a.MATERIAL_WireFrameFillMode,e.PointFillMode=q.a.MATERIAL_PointFillMode,e.PointListDrawMode=q.a.MATERIAL_PointListDrawMode,e.LineListDrawMode=q.a.MATERIAL_LineListDrawMode,e.LineLoopDrawMode=q.a.MATERIAL_LineLoopDrawMode,e.LineStripDrawMode=q.a.MATERIAL_LineStripDrawMode,e.TriangleStripDrawMode=q.a.MATERIAL_TriangleStripDrawMode,e.TriangleFanDrawMode=q.a.MATERIAL_TriangleFanDrawMode,e.ClockWiseSideOrientation=q.a.MATERIAL_ClockWiseSideOrientation,e.CounterClockWiseSideOrientation=q.a.MATERIAL_CounterClockWiseSideOrientation,e.TextureDirtyFlag=q.a.MATERIAL_TextureDirtyFlag,e.LightDirtyFlag=q.a.MATERIAL_LightDirtyFlag,e.FresnelDirtyFlag=q.a.MATERIAL_FresnelDirtyFlag,e.AttributesDirtyFlag=q.a.MATERIAL_AttributesDirtyFlag,e.MiscDirtyFlag=q.a.MATERIAL_MiscDirtyFlag,e.AllDirtyFlag=q.a.MATERIAL_AllDirtyFlag,e._AllDirtyCallBack=function(D){return D.markAllAsDirty()},e._ImageProcessingDirtyCallBack=function(D){return D.markAsImageProcessingDirty()},e._TextureDirtyCallBack=function(D){return D.markAsTexturesDirty()},e._FresnelDirtyCallBack=function(D){return D.markAsFresnelDirty()},e._MiscDirtyCallBack=function(D){return D.markAsMiscDirty()},e._LightsDirtyCallBack=function(D){return D.markAsLightDirty()},e._AttributeDirtyCallBack=function(D){return D.markAsAttributesDirty()},e._FresnelAndMiscDirtyCallBack=function(D){e._FresnelDirtyCallBack(D),e._MiscDirtyCallBack(D)},e._TextureAndMiscDirtyCallBack=function(D){e._TextureDirtyCallBack(D),e._MiscDirtyCallBack(D)},e._DirtyCallbackArray=[],e._RunDirtyCallBacks=function(D){for(var w=0,N=e._DirtyCallbackArray;w<N.length;w++)(0,N[w])(D)},Object(F.c)([Object(k.c)()],e.prototype,"id",void 0),Object(F.c)([Object(k.c)()],e.prototype,"uniqueId",void 0),Object(F.c)([Object(k.c)()],e.prototype,"name",void 0),Object(F.c)([Object(k.c)()],e.prototype,"checkReadyOnEveryCall",void 0),Object(F.c)([Object(k.c)()],e.prototype,"checkReadyOnlyOnce",void 0),Object(F.c)([Object(k.c)()],e.prototype,"state",void 0),Object(F.c)([Object(k.c)("alpha")],e.prototype,"_alpha",void 0),Object(F.c)([Object(k.c)("backFaceCulling")],e.prototype,"_backFaceCulling",void 0),Object(F.c)([Object(k.c)()],e.prototype,"sideOrientation",void 0),Object(F.c)([Object(k.c)("alphaMode")],e.prototype,"_alphaMode",void 0),Object(F.c)([Object(k.c)()],e.prototype,"_needDepthPrePass",void 0),Object(F.c)([Object(k.c)()],e.prototype,"disableDepthWrite",void 0),Object(F.c)([Object(k.c)()],e.prototype,"forceDepthWrite",void 0),Object(F.c)([Object(k.c)()],e.prototype,"depthFunction",void 0),Object(F.c)([Object(k.c)()],e.prototype,"separateCullingPass",void 0),Object(F.c)([Object(k.c)("fogEnabled")],e.prototype,"_fogEnabled",void 0),Object(F.c)([Object(k.c)()],e.prototype,"pointSize",void 0),Object(F.c)([Object(k.c)()],e.prototype,"zOffset",void 0),Object(F.c)([Object(k.c)()],e.prototype,"wireframe",null),Object(F.c)([Object(k.c)()],e.prototype,"pointsCloud",null),Object(F.c)([Object(k.c)()],e.prototype,"fillMode",null),e}()},function(D,w,N){"use strict";N.d(w,"a",(function(){return q}));var F=N(7),k=N(42),j=N(0),z=N(27),G=N(5),H=N(47),X=N(22);G.a._PhysicsImpostorParser=function(D,w,N){return new q(w,N.physicsImpostor,{mass:N.physicsMass,friction:N.physicsFriction,restitution:N.physicsRestitution},D)};var q=function(){function e(D,w,N,k){var z=this;void 0===N&&(N={mass:0}),this.object=D,this.type=w,this._options=N,this._scene=k,this._pluginData={},this._bodyUpdateRequired=!1,this._onBeforePhysicsStepCallbacks=new Array,this._onAfterPhysicsStepCallbacks=new Array,this._onPhysicsCollideCallbacks=[],this._deltaPosition=j.e.Zero(),this._isDisposed=!1,this.soft=!1,this.segments=0,this._tmpQuat=new j.b,this._tmpQuat2=new j.b,this.beforeStep=function(){z._physicsEngine&&(z.object.translate(z._deltaPosition,-1),z._deltaRotationConjugated&&z.object.rotationQuaternion&&z.object.rotationQuaternion.multiplyToRef(z._deltaRotationConjugated,z.object.rotationQuaternion),z.object.computeWorldMatrix(!1),z.object.parent&&z.object.rotationQuaternion?(z.getParentsRotation(),z._tmpQuat.multiplyToRef(z.object.rotationQuaternion,z._tmpQuat)):z._tmpQuat.copyFrom(z.object.rotationQuaternion||new j.b),z._options.disableBidirectionalTransformation||z.object.rotationQuaternion&&z._physicsEngine.getPhysicsPlugin().setPhysicsBodyTransformation(z,z.object.getAbsolutePosition(),z._tmpQuat),z._onBeforePhysicsStepCallbacks.forEach((function(D){D(z)})))},this.afterStep=function(){z._physicsEngine&&(z._onAfterPhysicsStepCallbacks.forEach((function(D){D(z)})),z._physicsEngine.getPhysicsPlugin().setTransformationFromPhysicsBody(z),z.object.parent&&z.object.rotationQuaternion&&(z.getParentsRotation(),z._tmpQuat.conjugateInPlace(),z._tmpQuat.multiplyToRef(z.object.rotationQuaternion,z.object.rotationQuaternion)),z.object.setAbsolutePosition(z.object.position),z._deltaRotation&&z.object.rotationQuaternion&&z.object.rotationQuaternion.multiplyToRef(z._deltaRotation,z.object.rotationQuaternion),z.object.translate(z._deltaPosition,1))},this.onCollideEvent=null,this.onCollide=function(D){if((z._onPhysicsCollideCallbacks.length||z.onCollideEvent)&&z._physicsEngine){var w=z._physicsEngine.getImpostorWithPhysicsBody(D.body);w&&(z.onCollideEvent&&z.onCollideEvent(z,w),z._onPhysicsCollideCallbacks.filter((function(D){return-1!==D.otherImpostors.indexOf(w)})).forEach((function(D){D.callback(z,w)})))}},this.object?(this.object.parent&&0!==N.mass&&F.a.Warn("A physics impostor has been created for an object which has a parent. Babylon physics currently works in local space so unexpected issues may occur."),!this._scene&&D.getScene&&(this._scene=D.getScene()),this._scene&&(this.type>100&&(this.soft=!0),this._physicsEngine=this._scene.getPhysicsEngine(),this._physicsEngine?(this.object.rotationQuaternion||(this.object.rotation?this.object.rotationQuaternion=j.b.RotationYawPitchRoll(this.object.rotation.y,this.object.rotation.x,this.object.rotation.z):this.object.rotationQuaternion=new j.b),this._options.mass=void 0===N.mass?0:N.mass,this._options.friction=void 0===N.friction?.2:N.friction,this._options.restitution=void 0===N.restitution?.2:N.restitution,this.soft&&(this._options.mass=this._options.mass>0?this._options.mass:1,this._options.pressure=void 0===N.pressure?200:N.pressure,this._options.stiffness=void 0===N.stiffness?1:N.stiffness,this._options.velocityIterations=void 0===N.velocityIterations?20:N.velocityIterations,this._options.positionIterations=void 0===N.positionIterations?20:N.positionIterations,this._options.fixedPoints=void 0===N.fixedPoints?0:N.fixedPoints,this._options.margin=void 0===N.margin?0:N.margin,this._options.damping=void 0===N.damping?0:N.damping,this._options.path=void 0===N.path?null:N.path,this._options.shape=void 0===N.shape?null:N.shape),this._joints=[],!this.object.parent||this._options.ignoreParent?this._init():this.object.parent.physicsImpostor&&F.a.Warn("You must affect impostors to children before affecting impostor to parent.")):F.a.Error("Physics not enabled. Please use scene.enablePhysics(...) before creating impostors."))):F.a.Error("No object was provided. A physics object is obligatory")}return Object.defineProperty(e.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mass",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyMass(this):0},set:function(D){this.setMass(D)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"friction",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyFriction(this):0},set:function(D){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyFriction(this,D)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"restitution",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyRestitution(this):0},set:function(D){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyRestitution(this,D)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pressure",{get:function(){if(!this._physicsEngine)return 0;var D=this._physicsEngine.getPhysicsPlugin();return D.setBodyPressure?D.getBodyPressure(this):0},set:function(D){if(this._physicsEngine){var w=this._physicsEngine.getPhysicsPlugin();w.setBodyPressure&&w.setBodyPressure(this,D)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stiffness",{get:function(){if(!this._physicsEngine)return 0;var D=this._physicsEngine.getPhysicsPlugin();return D.getBodyStiffness?D.getBodyStiffness(this):0},set:function(D){if(this._physicsEngine){var w=this._physicsEngine.getPhysicsPlugin();w.setBodyStiffness&&w.setBodyStiffness(this,D)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"velocityIterations",{get:function(){if(!this._physicsEngine)return 0;var D=this._physicsEngine.getPhysicsPlugin();return D.getBodyVelocityIterations?D.getBodyVelocityIterations(this):0},set:function(D){if(this._physicsEngine){var w=this._physicsEngine.getPhysicsPlugin();w.setBodyVelocityIterations&&w.setBodyVelocityIterations(this,D)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"positionIterations",{get:function(){if(!this._physicsEngine)return 0;var D=this._physicsEngine.getPhysicsPlugin();return D.getBodyPositionIterations?D.getBodyPositionIterations(this):0},set:function(D){if(this._physicsEngine){var w=this._physicsEngine.getPhysicsPlugin();w.setBodyPositionIterations&&w.setBodyPositionIterations(this,D)}},enumerable:!0,configurable:!0}),e.prototype._init=function(){this._physicsEngine&&(this._physicsEngine.removeImpostor(this),this.physicsBody=null,this._parent=this._parent||this._getPhysicsParent(),this._isDisposed||this.parent&&!this._options.ignoreParent||this._physicsEngine.addImpostor(this))},e.prototype._getPhysicsParent=function(){return this.object.parent instanceof z.a?this.object.parent.physicsImpostor:null},e.prototype.isBodyInitRequired=function(){return this._bodyUpdateRequired||!this._physicsBody&&!this._parent},e.prototype.setScalingUpdated=function(){this.forceUpdate()},e.prototype.forceUpdate=function(){this._init(),this.parent&&!this._options.ignoreParent&&this.parent.forceUpdate()},Object.defineProperty(e.prototype,"physicsBody",{get:function(){return this._parent&&!this._options.ignoreParent?this._parent.physicsBody:this._physicsBody},set:function(D){this._physicsBody&&this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().removePhysicsBody(this),this._physicsBody=D,this.resetUpdateFlags()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return!this._options.ignoreParent&&this._parent?this._parent:null},set:function(D){this._parent=D},enumerable:!0,configurable:!0}),e.prototype.resetUpdateFlags=function(){this._bodyUpdateRequired=!1},e.prototype.getObjectExtendSize=function(){if(this.object.getBoundingInfo){var D=this.object.rotationQuaternion;this.object.rotationQuaternion=e.IDENTITY_QUATERNION,this.object.computeWorldMatrix&&this.object.computeWorldMatrix(!0);var w=this.object.getBoundingInfo().boundingBox.extendSizeWorld.scale(2);return this.object.rotationQuaternion=D,this.object.computeWorldMatrix&&this.object.computeWorldMatrix(!0),w}return e.DEFAULT_OBJECT_SIZE},e.prototype.getObjectCenter=function(){return this.object.getBoundingInfo?this.object.getBoundingInfo().boundingBox.centerWorld:this.object.position},e.prototype.getParam=function(D){return this._options[D]},e.prototype.setParam=function(D,w){this._options[D]=w,this._bodyUpdateRequired=!0},e.prototype.setMass=function(D){this.getParam("mass")!==D&&this.setParam("mass",D),this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyMass(this,D)},e.prototype.getLinearVelocity=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getLinearVelocity(this):j.e.Zero()},e.prototype.setLinearVelocity=function(D){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setLinearVelocity(this,D)},e.prototype.getAngularVelocity=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getAngularVelocity(this):j.e.Zero()},e.prototype.setAngularVelocity=function(D){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setAngularVelocity(this,D)},e.prototype.executeNativeFunction=function(D){this._physicsEngine&&D(this._physicsEngine.getPhysicsPlugin().world,this.physicsBody)},e.prototype.registerBeforePhysicsStep=function(D){this._onBeforePhysicsStepCallbacks.push(D)},e.prototype.unregisterBeforePhysicsStep=function(D){var w=this._onBeforePhysicsStepCallbacks.indexOf(D);w>-1?this._onBeforePhysicsStepCallbacks.splice(w,1):F.a.Warn("Function to remove was not found")},e.prototype.registerAfterPhysicsStep=function(D){this._onAfterPhysicsStepCallbacks.push(D)},e.prototype.unregisterAfterPhysicsStep=function(D){var w=this._onAfterPhysicsStepCallbacks.indexOf(D);w>-1?this._onAfterPhysicsStepCallbacks.splice(w,1):F.a.Warn("Function to remove was not found")},e.prototype.registerOnPhysicsCollide=function(D,w){var N=D instanceof Array?D:[D];this._onPhysicsCollideCallbacks.push({callback:w,otherImpostors:N})},e.prototype.unregisterOnPhysicsCollide=function(D,w){var N=D instanceof Array?D:[D],k=-1;this._onPhysicsCollideCallbacks.some((function(D,F){if(D.callback===w&&D.otherImpostors.length===N.length){var j=D.otherImpostors.every((function(D){return N.indexOf(D)>-1}));return j&&(k=F),j}return!1}))?this._onPhysicsCollideCallbacks.splice(k,1):F.a.Warn("Function to remove was not found")},e.prototype.getParentsRotation=function(){var D=this.object.parent;for(this._tmpQuat.copyFromFloats(0,0,0,1);D;)D.rotationQuaternion?this._tmpQuat2.copyFrom(D.rotationQuaternion):j.b.RotationYawPitchRollToRef(D.rotation.y,D.rotation.x,D.rotation.z,this._tmpQuat2),this._tmpQuat.multiplyToRef(this._tmpQuat2,this._tmpQuat),D=D.parent;return this._tmpQuat},e.prototype.applyForce=function(D,w){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().applyForce(this,D,w),this},e.prototype.applyImpulse=function(D,w){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().applyImpulse(this,D,w),this},e.prototype.createJoint=function(D,w,N){var F=new H.e(w,N);return this.addJoint(D,F),this},e.prototype.addJoint=function(D,w){return this._joints.push({otherImpostor:D,joint:w}),this._physicsEngine&&this._physicsEngine.addJoint(this,D,w),this},e.prototype.addAnchor=function(D,w,N,F,k){if(!this._physicsEngine)return this;var j=this._physicsEngine.getPhysicsPlugin();return j.appendAnchor?(this._physicsEngine&&j.appendAnchor(this,D,w,N,F,k),this):this},e.prototype.addHook=function(D,w,N,F){if(!this._physicsEngine)return this;var k=this._physicsEngine.getPhysicsPlugin();return k.appendAnchor?(this._physicsEngine&&k.appendHook(this,D,w,N,F),this):this},e.prototype.sleep=function(){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().sleepBody(this),this},e.prototype.wakeUp=function(){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().wakeUpBody(this),this},e.prototype.clone=function(D){return D?new e(D,this.type,this._options,this._scene):null},e.prototype.dispose=function(){var D=this;this._physicsEngine&&(this._joints.forEach((function(w){D._physicsEngine&&D._physicsEngine.removeJoint(D,w.otherImpostor,w.joint)})),this._physicsEngine.removeImpostor(this),this.parent&&this.parent.forceUpdate(),this._isDisposed=!0)},e.prototype.setDeltaPosition=function(D){this._deltaPosition.copyFrom(D)},e.prototype.setDeltaRotation=function(D){this._deltaRotation||(this._deltaRotation=new j.b),this._deltaRotation.copyFrom(D),this._deltaRotationConjugated=this._deltaRotation.conjugate()},e.prototype.getBoxSizeToRef=function(D){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().getBoxSizeToRef(this,D),this},e.prototype.getRadius=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getRadius(this):0},e.prototype.syncBoneWithImpostor=function(D,w,N,F,k){var j=e._tmpVecs[0],z=this.object;if(z.rotationQuaternion)if(k){var G=e._tmpQuat;z.rotationQuaternion.multiplyToRef(k,G),D.setRotationQuaternion(G,X.b.WORLD,w)}else D.setRotationQuaternion(z.rotationQuaternion,X.b.WORLD,w);j.x=0,j.y=0,j.z=0,N&&(j.x=N.x,j.y=N.y,j.z=N.z,D.getDirectionToRef(j,w,j),null==F&&(F=N.length()),j.x*=F,j.y*=F,j.z*=F),D.getParent()?(j.addInPlace(z.getAbsolutePosition()),D.setAbsolutePosition(j,w)):(w.setAbsolutePosition(z.getAbsolutePosition()),w.position.x-=j.x,w.position.y-=j.y,w.position.z-=j.z)},e.prototype.syncImpostorWithBone=function(D,w,N,F,k,j){var z=this.object;if(z.rotationQuaternion)if(k){var G=e._tmpQuat;D.getRotationQuaternionToRef(X.b.WORLD,w,G),G.multiplyToRef(k,z.rotationQuaternion)}else D.getRotationQuaternionToRef(X.b.WORLD,w,z.rotationQuaternion);var H=e._tmpVecs[0],q=e._tmpVecs[1];j||((j=e._tmpVecs[2]).x=0,j.y=1,j.z=0),D.getDirectionToRef(j,w,q),D.getAbsolutePositionToRef(w,H),null==F&&N&&(F=N.length()),null!=F&&(H.x+=q.x*F,H.y+=q.y*F,H.z+=q.z*F),z.setAbsolutePosition(H)},e.DEFAULT_OBJECT_SIZE=new j.e(1,1,1),e.IDENTITY_QUATERNION=j.b.Identity(),e._tmpVecs=k.a.BuildArray(3,j.e.Zero),e._tmpQuat=j.b.Identity(),e.NoImpostor=0,e.SphereImpostor=1,e.BoxImpostor=2,e.PlaneImpostor=3,e.MeshImpostor=4,e.CapsuleImpostor=6,e.CylinderImpostor=7,e.ParticleImpostor=8,e.HeightmapImpostor=9,e.ConvexHullImpostor=10,e.CustomImpostor=100,e.RopeImpostor=101,e.ClothImpostor=102,e.SoftbodyImpostor=103,e}()},function(D,w,N){"use strict";N.d(w,"a",(function(){return he}));var F=N(23),k=N(8),j=N(19),z=N(6),G=N(127),H=N(128),X=N(129),q=N(2),Z=N(25),J=N(7),$=N(38),te=N(109),ie=N(84),oe=N(130),ce=N(70),v=function(){},he=function(){function e(D,w,N,F){var k=this;void 0===F&&(F=!1),this.forcePOTTextures=!1,this.isFullscreen=!1,this.cullBackFaces=!0,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this.validateShaderPrograms=!1,this.useReverseDepthBuffer=!1,this.disableUniformBuffers=!1,this._uniformBuffers=new Array,this._webGLVersion=1,this._windowIsBackground=!1,this._highPrecisionShadersAllowed=!0,this._badOS=!1,this._badDesktopOS=!1,this._renderingQueueLaunched=!1,this._activeRenderLoops=new Array,this.onContextLostObservable=new z.c,this.onContextRestoredObservable=new z.c,this._contextWasLost=!1,this._doNotHandleContextLost=!1,this.disableVertexArrayObjects=!1,this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new G.a,this._stencilState=new H.a,this._alphaState=new X.a,this._alphaMode=q.a.ALPHA_ADD,this._alphaEquation=q.a.ALPHA_DISABLE,this._internalTexturesCache=new Array,this._activeChannel=0,this._currentTextureChannel=-1,this._boundTexturesCache={},this._compiledEffects={},this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._activeRequests=new Array,this._texturesSupported=new Array,this.premultipliedAlpha=!0,this.onBeforeTextureInitObservable=new z.c,this._viewportCached={x:0,y:0,z:0,w:0},this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._getDepthStencilBuffer=function(D,w,N,F,j,z){var G=k._gl,H=G.createRenderbuffer();return G.bindRenderbuffer(G.RENDERBUFFER,H),N>1&&G.renderbufferStorageMultisample?G.renderbufferStorageMultisample(G.RENDERBUFFER,N,j,D,w):G.renderbufferStorage(G.RENDERBUFFER,F,D,w),G.framebufferRenderbuffer(G.FRAMEBUFFER,z,G.RENDERBUFFER,H),G.bindRenderbuffer(G.RENDERBUFFER,null),H},this._boundUniforms={};var j=null;if(D){if(N=N||{},D.getContext){if(j=D,this._renderingCanvas=j,null!=w&&(N.antialias=w),void 0===N.deterministicLockstep&&(N.deterministicLockstep=!1),void 0===N.lockstepMaxSteps&&(N.lockstepMaxSteps=4),void 0===N.timeStep&&(N.timeStep=1/60),void 0===N.preserveDrawingBuffer&&(N.preserveDrawingBuffer=!1),void 0===N.audioEngine&&(N.audioEngine=!0),void 0===N.stencil&&(N.stencil=!0),!1===N.premultipliedAlpha&&(this.premultipliedAlpha=!1),this._doNotHandleContextLost=!!N.doNotHandleContextLost,navigator&&navigator.userAgent)for(var Z=navigator.userAgent,ie=0,oe=e.ExceptionList;ie<oe.length;ie++){var ce=oe[ie],he=ce.key,fe=ce.targets;if(new RegExp(he).test(Z)){if(ce.capture&&ce.captureConstraint){var pe=ce.capture,_e=ce.captureConstraint,ve=new RegExp(pe).exec(Z);if(ve&&ve.length>0&&parseInt(ve[ve.length-1])>=_e)continue}for(var ye=0,be=fe;ye<be.length;ye++)switch(be[ye]){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0}}}if(this._doNotHandleContextLost||(this._onContextLost=function(D){D.preventDefault(),k._contextWasLost=!0,J.a.Warn("WebGL context lost."),k.onContextLostObservable.notifyObservers(k)},this._onContextRestored=function(){setTimeout((function(){k._initGLContext(),k._rebuildEffects(),k._rebuildInternalTextures(),k._rebuildBuffers(),k.wipeCaches(!0),J.a.Warn("WebGL context successfully restored."),k.onContextRestoredObservable.notifyObservers(k),k._contextWasLost=!1}),0)},j.addEventListener("webglcontextlost",this._onContextLost,!1),j.addEventListener("webglcontextrestored",this._onContextRestored,!1),N.powerPreference="high-performance"),!N.disableWebGL2Support)try{this._gl=j.getContext("webgl2",N)||j.getContext("experimental-webgl2",N),this._gl&&(this._webGLVersion=2,this._gl.deleteQuery||(this._webGLVersion=1))}catch(D){}if(!this._gl){if(!j)throw new Error("The provided canvas is null or undefined.");try{this._gl=j.getContext("webgl",N)||j.getContext("experimental-webgl",N)}catch(D){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=D,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample&&(this._webGLVersion=2);var Te=this._gl.getContextAttributes();Te&&(N.stencil=Te.stencil)}this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),void 0!==N.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=N.useHighPrecisionFloats);var Ee=$.a.IsWindowObjectExist()&&window.devicePixelRatio||1,Se=N.limitDeviceRatio||Ee;this._hardwareScalingLevel=F?1/Math.min(Se,Ee):1,this.resize(),this._isStencilEnable=!!N.stencil,this._initGLContext();for(var Me=0;Me<this._caps.maxVertexAttribs;Me++)this._currentBufferPointers[Me]=new v;this.webGLVersion>1&&(this._shaderProcessor=new te.a),this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),this._creationOptions=N,console.log("Babylon.js v"+e.Version+" - "+this.description)}}return Object.defineProperty(e,"NpmPackage",{get:function(){return"babylonjs@4.1.0"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"Version",{get:function(){return"4.1.0"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"description",{get:function(){var D="WebGL"+this.webGLVersion;return this._caps.parallelShaderCompile&&(D+=" - Parallel shader compilation"),D},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ShadersRepository",{get:function(){return k.a.ShadersRepository},set:function(D){k.a.ShadersRepository=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"supportsUniformBuffers",{get:function(){return this.webGLVersion>1&&!this.disableUniformBuffers},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_shouldUseHighPrecisionShader",{get:function(){return!(!this._caps.highPrecisionShaderSupported||!this._highPrecisionShadersAllowed)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"needPOTTextures",{get:function(){return this._webGLVersion<2||this.forcePOTTextures},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"doNotHandleContextLost",{get:function(){return this._doNotHandleContextLost},set:function(D){this._doNotHandleContextLost=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_supportsHardwareTextureRescaling",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"framebufferDimensionsObject",{set:function(D){this._framebufferDimensionsObject=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"texturesSupported",{get:function(){return this._texturesSupported},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textureFormatInUse",{get:function(){return this._textureFormatInUse},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentViewport",{get:function(){return this._cachedViewport},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"emptyTexture",{get:function(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,q.a.TEXTUREFORMAT_RGBA,!1,!1,q.a.TEXTURE_NEAREST_SAMPLINGMODE)),this._emptyTexture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"emptyTexture3D",{get:function(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,q.a.TEXTUREFORMAT_RGBA,!1,!1,q.a.TEXTURE_NEAREST_SAMPLINGMODE)),this._emptyTexture3D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"emptyTexture2DArray",{get:function(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,q.a.TEXTUREFORMAT_RGBA,!1,!1,q.a.TEXTURE_NEAREST_SAMPLINGMODE)),this._emptyTexture2DArray},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"emptyCubeTexture",{get:function(){if(!this._emptyCubeTexture){var D=new Uint8Array(4),w=[D,D,D,D,D,D];this._emptyCubeTexture=this.createRawCubeTexture(w,1,q.a.TEXTUREFORMAT_RGBA,q.a.TEXTURETYPE_UNSIGNED_INT,!1,!1,q.a.TEXTURE_NEAREST_SAMPLINGMODE)}return this._emptyCubeTexture},enumerable:!0,configurable:!0}),e.prototype._rebuildInternalTextures=function(){for(var D=0,w=this._internalTexturesCache.slice();D<w.length;D++)w[D]._rebuild()},e.prototype._rebuildEffects=function(){for(var D in this._compiledEffects)this._compiledEffects[D]._prepareEffect();k.a.ResetCache()},e.prototype.areAllEffectsReady=function(){for(var D in this._compiledEffects)if(!this._compiledEffects[D].isReady())return!1;return!0},e.prototype._rebuildBuffers=function(){for(var D=0,w=this._uniformBuffers;D<w.length;D++)w[D]._rebuild()},e.prototype._initGLContext=function(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile"),standardDerivatives:this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),fragmentDepthSupported:this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float"),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1},this._glVersion=this._gl.getParameter(this._gl.VERSION);var D=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=D&&(this._glRenderer=this._gl.getParameter(D.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(D.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor="Unknown vendor"),this._glRenderer||(this._glRenderer="Unknown renderer"),this._gl.HALF_FLOAT_OES=36193,34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._webGLVersion>1&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=this._gl.getParameter(this._gl.MAX_SAMPLES);else{var w=this._gl.getExtension("WEBGL_draw_buffers");if(null!==w){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=w.drawBuffersWEBGL.bind(w),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(var N=0;N<16;N++)this._gl["COLOR_ATTACHMENT"+N+"_WEBGL"]=w["COLOR_ATTACHMENT"+N+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{var F=this._gl.getExtension("WEBGL_depth_texture");null!=F&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=F.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{var k=this._gl.getExtension("OES_vertex_array_object");null!=k&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=k.createVertexArrayOES.bind(k),this._gl.bindVertexArray=k.bindVertexArrayOES.bind(k),this._gl.deleteVertexArray=k.deleteVertexArrayOES.bind(k))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{var j=this._gl.getExtension("ANGLE_instanced_arrays");null!=j?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=j.drawArraysInstancedANGLE.bind(j),this._gl.drawElementsInstanced=j.drawElementsInstancedANGLE.bind(j),this._gl.vertexAttribDivisor=j.vertexAttribDivisorANGLE.bind(j)):this._caps.instancedArrays=!1}if(this._caps.astc&&this.texturesSupported.push("-astc.ktx"),this._caps.s3tc&&this.texturesSupported.push("-dxt.ktx"),this._caps.pvrtc&&this.texturesSupported.push("-pvrtc.ktx"),this._caps.etc2&&this.texturesSupported.push("-etc2.ktx"),this._caps.etc1&&this.texturesSupported.push("-etc1.ktx"),this._gl.getShaderPrecisionFormat){var z=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),G=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);z&&G&&(this._caps.highPrecisionShaderSupported=0!==z.precision&&0!==G.precision)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{var H=this._gl.getExtension("EXT_blend_minmax");null!=H&&(this._caps.blendMinMax=!0,this._gl.MAX=H.MAX_EXT,this._gl.MIN=H.MIN_EXT)}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(var X=0;X<this._maxSimultaneousTextures;X++)this._nextFreeTextureSlots.push(X)},Object.defineProperty(e.prototype,"webGLVersion",{get:function(){return this._webGLVersion},enumerable:!0,configurable:!0}),e.prototype.getClassName=function(){return"ThinEngine"},Object.defineProperty(e.prototype,"isStencilEnable",{get:function(){return this._isStencilEnable},enumerable:!0,configurable:!0}),e.prototype._prepareWorkingCanvas=function(){if(!this._workingCanvas){this._workingCanvas=ce.a.CreateCanvas(1,1);var D=this._workingCanvas.getContext("2d");D&&(this._workingContext=D)}},e.prototype.resetTextureCache=function(){for(var D in this._boundTexturesCache)this._boundTexturesCache.hasOwnProperty(D)&&(this._boundTexturesCache[D]=null);this._currentTextureChannel=-1},e.prototype.getGlInfo=function(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}},e.prototype.setHardwareScalingLevel=function(D){this._hardwareScalingLevel=D,this.resize()},e.prototype.getHardwareScalingLevel=function(){return this._hardwareScalingLevel},e.prototype.getLoadedTexturesCache=function(){return this._internalTexturesCache},e.prototype.getCaps=function(){return this._caps},e.prototype.stopRenderLoop=function(D){if(D){var w=this._activeRenderLoops.indexOf(D);w>=0&&this._activeRenderLoops.splice(w,1)}else this._activeRenderLoops=[]},e.prototype._renderLoop=function(){if(!this._contextWasLost){var D=!0;if(!this.renderEvenInBackground&&this._windowIsBackground&&(D=!1),D){this.beginFrame();for(var w=0;w<this._activeRenderLoops.length;w++)(0,this._activeRenderLoops[w])();this.endFrame()}}this._activeRenderLoops.length>0?this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()):this._renderingQueueLaunched=!1},e.prototype.getRenderingCanvas=function(){return this._renderingCanvas},e.prototype.getHostWindow=function(){return $.a.IsWindowObjectExist()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null},e.prototype.getRenderWidth=function(D){return void 0===D&&(D=!1),!D&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth},e.prototype.getRenderHeight=function(D){return void 0===D&&(D=!1),!D&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight},e.prototype._queueNewFrame=function(D,w){return e.QueueNewFrame(D,w)},e.prototype.runRenderLoop=function(D){-1===this._activeRenderLoops.indexOf(D)&&(this._activeRenderLoops.push(D),this._renderingQueueLaunched||(this._renderingQueueLaunched=!0,this._boundRenderFunction=this._renderLoop.bind(this),this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))},e.prototype.clear=function(D,w,N,F){void 0===F&&(F=!1),this.applyStates();var k=0;w&&D&&(this._gl.clearColor(D.r,D.g,D.b,void 0!==D.a?D.a:1),k|=this._gl.COLOR_BUFFER_BIT),N&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GREATER,this._gl.clearDepth(0)):this._gl.clearDepth(1),k|=this._gl.DEPTH_BUFFER_BIT),F&&(this._gl.clearStencil(0),k|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(k)},e.prototype._viewport=function(D,w,N,F){D===this._viewportCached.x&&w===this._viewportCached.y&&N===this._viewportCached.z&&F===this._viewportCached.w||(this._viewportCached.x=D,this._viewportCached.y=w,this._viewportCached.z=N,this._viewportCached.w=F,this._gl.viewport(D,w,N,F))},e.prototype.setViewport=function(D,w,N){var F=w||this.getRenderWidth(),k=N||this.getRenderHeight(),j=D.x||0,z=D.y||0;this._cachedViewport=D,this._viewport(j*F,z*k,F*D.width,k*D.height)},e.prototype.beginFrame=function(){},e.prototype.endFrame=function(){this._badOS&&this.flushFramebuffer()},e.prototype.resize=function(){var D,w;$.a.IsWindowObjectExist()?(D=this._renderingCanvas?this._renderingCanvas.clientWidth:window.innerWidth,w=this._renderingCanvas?this._renderingCanvas.clientHeight:window.innerHeight):(D=this._renderingCanvas?this._renderingCanvas.width:100,w=this._renderingCanvas?this._renderingCanvas.height:100),this.setSize(D/this._hardwareScalingLevel,w/this._hardwareScalingLevel)},e.prototype.setSize=function(D,w){this._renderingCanvas&&(D|=0,w|=0,this._renderingCanvas.width===D&&this._renderingCanvas.height===w||(this._renderingCanvas.width=D,this._renderingCanvas.height=w))},e.prototype.bindFramebuffer=function(D,w,N,F,k,j,z){void 0===w&&(w=0),void 0===j&&(j=0),void 0===z&&(z=0),this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=D,this._bindUnboundFramebuffer(D._MSAAFramebuffer?D._MSAAFramebuffer:D._framebuffer);var G=this._gl;D.is2DArray?G.framebufferTextureLayer(G.FRAMEBUFFER,G.COLOR_ATTACHMENT0,D._webGLTexture,j,z):D.isCube&&G.framebufferTexture2D(G.FRAMEBUFFER,G.COLOR_ATTACHMENT0,G.TEXTURE_CUBE_MAP_POSITIVE_X+w,D._webGLTexture,j);var H=D._depthStencilTexture;if(H){var X=H._generateStencilBuffer?G.DEPTH_STENCIL_ATTACHMENT:G.DEPTH_ATTACHMENT;D.is2DArray?G.framebufferTextureLayer(G.FRAMEBUFFER,X,H._webGLTexture,j,z):D.isCube?G.framebufferTexture2D(G.FRAMEBUFFER,X,G.TEXTURE_CUBE_MAP_POSITIVE_X+w,H._webGLTexture,j):G.framebufferTexture2D(G.FRAMEBUFFER,X,G.TEXTURE_2D,H._webGLTexture,j)}this._cachedViewport&&!k?this.setViewport(this._cachedViewport,N,F):(N||(N=D.width,j&&(N/=Math.pow(2,j))),F||(F=D.height,j&&(F/=Math.pow(2,j))),this._viewport(0,0,N,F)),this.wipeCaches()},e.prototype._bindUnboundFramebuffer=function(D){this._currentFramebuffer!==D&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,D),this._currentFramebuffer=D)},e.prototype.unBindFramebuffer=function(D,w,N){void 0===w&&(w=!1),this._currentRenderTarget=null;var F=this._gl;D._MSAAFramebuffer&&(F.bindFramebuffer(F.READ_FRAMEBUFFER,D._MSAAFramebuffer),F.bindFramebuffer(F.DRAW_FRAMEBUFFER,D._framebuffer),F.blitFramebuffer(0,0,D.width,D.height,0,0,D.width,D.height,F.COLOR_BUFFER_BIT,F.NEAREST)),!D.generateMipMaps||w||D.isCube||(this._bindTextureDirectly(F.TEXTURE_2D,D,!0),F.generateMipmap(F.TEXTURE_2D),this._bindTextureDirectly(F.TEXTURE_2D,null)),N&&(D._MSAAFramebuffer&&this._bindUnboundFramebuffer(D._framebuffer),N()),this._bindUnboundFramebuffer(null)},e.prototype.flushFramebuffer=function(){this._gl.flush()},e.prototype.restoreDefaultFramebuffer=function(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()},e.prototype._resetVertexBufferBinding=function(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null},e.prototype.createVertexBuffer=function(D){return this._createVertexBuffer(D,this._gl.STATIC_DRAW)},e.prototype._createVertexBuffer=function(D,w){var N=this._gl.createBuffer();if(!N)throw new Error("Unable to create vertex buffer");var F=new ie.a(N);return this.bindArrayBuffer(F),D instanceof Array?this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(D),this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.ARRAY_BUFFER,D,this._gl.STATIC_DRAW),this._resetVertexBufferBinding(),F.references=1,F},e.prototype.createDynamicVertexBuffer=function(D){return this._createVertexBuffer(D,this._gl.DYNAMIC_DRAW)},e.prototype._resetIndexBufferBinding=function(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null},e.prototype.createIndexBuffer=function(D,w){var N=this._gl.createBuffer(),F=new ie.a(N);if(!N)throw new Error("Unable to create index buffer");this.bindIndexBuffer(F);var k=this._normalizeIndexData(D);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,k,w?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),F.references=1,F.is32Bits=4===k.BYTES_PER_ELEMENT,F},e.prototype._normalizeIndexData=function(D){if(D instanceof Uint16Array)return D;if(this._caps.uintIndices){if(D instanceof Uint32Array)return D;for(var w=0;w<D.length;w++)if(D[w]>=65535)return new Uint32Array(D);return new Uint16Array(D)}return new Uint16Array(D)},e.prototype.bindArrayBuffer=function(D){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.bindBuffer(D,this._gl.ARRAY_BUFFER)},e.prototype.bindUniformBlock=function(D,w,N){var F=D.program,k=this._gl.getUniformBlockIndex(F,w);this._gl.uniformBlockBinding(F,k,N)},e.prototype.bindIndexBuffer=function(D){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.bindBuffer(D,this._gl.ELEMENT_ARRAY_BUFFER)},e.prototype.bindBuffer=function(D,w){(this._vaoRecordInProgress||this._currentBoundBuffer[w]!==D)&&(this._gl.bindBuffer(w,D?D.underlyingResource:null),this._currentBoundBuffer[w]=D)},e.prototype.updateArrayBuffer=function(D){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,D)},e.prototype._vertexAttribPointer=function(D,w,N,F,k,j,z){var G=this._currentBufferPointers[w],H=!1;G.active?(G.buffer!==D&&(G.buffer=D,H=!0),G.size!==N&&(G.size=N,H=!0),G.type!==F&&(G.type=F,H=!0),G.normalized!==k&&(G.normalized=k,H=!0),G.stride!==j&&(G.stride=j,H=!0),G.offset!==z&&(G.offset=z,H=!0)):(H=!0,G.active=!0,G.index=w,G.size=N,G.type=F,G.normalized=k,G.stride=j,G.offset=z,G.buffer=D),(H||this._vaoRecordInProgress)&&(this.bindArrayBuffer(D),this._gl.vertexAttribPointer(w,N,F,k,j,z))},e.prototype._bindIndexBufferWithCache=function(D){null!=D&&this._cachedIndexBuffer!==D&&(this._cachedIndexBuffer=D,this.bindIndexBuffer(D),this._uintIndicesCurrentlySet=D.is32Bits)},e.prototype._bindVertexBuffersAttributes=function(D,w){var N=w.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var F=0;F<N.length;F++){var k=w.getAttributeLocation(F);if(k>=0){var j=D[N[F]];if(!j)continue;this._gl.enableVertexAttribArray(k),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[k]=!0);var z=j.getBuffer();z&&(this._vertexAttribPointer(z,k,j.getSize(),j.type,j.normalized,j.byteStride,j.byteOffset),j.getIsInstanced()&&(this._gl.vertexAttribDivisor(k,j.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(k),this._currentInstanceBuffers.push(z))))}}},e.prototype.recordVertexArrayObject=function(D,w,N){var F=this._gl.createVertexArray();return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(F),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(D,N),this.bindIndexBuffer(w),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),F},e.prototype.bindVertexArrayObject=function(D,w){this._cachedVertexArrayObject!==D&&(this._cachedVertexArrayObject=D,this._gl.bindVertexArray(D),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=w&&w.is32Bits,this._mustWipeVertexAttributes=!0)},e.prototype.bindBuffersDirectly=function(D,w,N,F,k){if(this._cachedVertexBuffers!==D||this._cachedEffectForVertexBuffers!==k){this._cachedVertexBuffers=D,this._cachedEffectForVertexBuffers=k;var j=k.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var z=0,G=0;G<j;G++)if(G<N.length){var H=k.getAttributeLocation(G);H>=0&&(this._gl.enableVertexAttribArray(H),this._vertexAttribArraysEnabled[H]=!0,this._vertexAttribPointer(D,H,N[G],this._gl.FLOAT,!1,F,z)),z+=4*N[G]}}this._bindIndexBufferWithCache(w)},e.prototype._unbindVertexArrayObject=function(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))},e.prototype.bindBuffers=function(D,w,N){this._cachedVertexBuffers===D&&this._cachedEffectForVertexBuffers===N||(this._cachedVertexBuffers=D,this._cachedEffectForVertexBuffers=N,this._bindVertexBuffersAttributes(D,N)),this._bindIndexBufferWithCache(w)},e.prototype.unbindInstanceAttributes=function(){for(var D,w=0,N=this._currentInstanceLocations.length;w<N;w++){var F=this._currentInstanceBuffers[w];D!=F&&F.references&&(D=F,this.bindArrayBuffer(F));var k=this._currentInstanceLocations[w];this._gl.vertexAttribDivisor(k,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0},e.prototype.releaseVertexArrayObject=function(D){this._gl.deleteVertexArray(D)},e.prototype._releaseBuffer=function(D){return D.references--,0===D.references&&(this._deleteBuffer(D),!0)},e.prototype._deleteBuffer=function(D){this._gl.deleteBuffer(D.underlyingResource)},e.prototype.updateAndBindInstancesBuffer=function(D,w,N){if(this.bindArrayBuffer(D),w&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,w),void 0!==N[0].index)this.bindInstancesBuffer(D,N,!0);else for(var F=0;F<4;F++){var k=N[F];this._vertexAttribArraysEnabled[k]||(this._gl.enableVertexAttribArray(k),this._vertexAttribArraysEnabled[k]=!0),this._vertexAttribPointer(D,k,4,this._gl.FLOAT,!1,64,16*F),this._gl.vertexAttribDivisor(k,1),this._currentInstanceLocations.push(k),this._currentInstanceBuffers.push(D)}},e.prototype.bindInstancesBuffer=function(D,w,N){void 0===N&&(N=!0),this.bindArrayBuffer(D);var F=0;if(N)for(var k=0;k<w.length;k++)F+=4*(j=w[k]).attributeSize;for(k=0;k<w.length;k++){var j;void 0===(j=w[k]).index&&(j.index=this._currentEffect.getAttributeLocationByName(j.attributeName)),this._vertexAttribArraysEnabled[j.index]||(this._gl.enableVertexAttribArray(j.index),this._vertexAttribArraysEnabled[j.index]=!0),this._vertexAttribPointer(D,j.index,j.attributeSize,j.attributeType||this._gl.FLOAT,j.normalized||!1,F,j.offset),this._gl.vertexAttribDivisor(j.index,void 0===j.divisor?1:j.divisor),this._currentInstanceLocations.push(j.index),this._currentInstanceBuffers.push(D)}},e.prototype.disableInstanceAttributeByName=function(D){if(this._currentEffect){var w=this._currentEffect.getAttributeLocationByName(D);this.disableInstanceAttribute(w)}},e.prototype.disableInstanceAttribute=function(D){for(var w,N=!1;-1!==(w=this._currentInstanceLocations.indexOf(D));)this._currentInstanceLocations.splice(w,1),this._currentInstanceBuffers.splice(w,1),N=!0,w=this._currentInstanceLocations.indexOf(D);N&&(this._gl.vertexAttribDivisor(D,0),this.disableAttributeByIndex(D))},e.prototype.disableAttributeByIndex=function(D){this._gl.disableVertexAttribArray(D),this._vertexAttribArraysEnabled[D]=!1,this._currentBufferPointers[D].active=!1},e.prototype.draw=function(D,w,N,F){this.drawElementsType(D?q.a.MATERIAL_TriangleFillMode:q.a.MATERIAL_WireFrameFillMode,w,N,F)},e.prototype.drawPointClouds=function(D,w,N){this.drawArraysType(q.a.MATERIAL_PointFillMode,D,w,N)},e.prototype.drawUnIndexed=function(D,w,N,F){this.drawArraysType(D?q.a.MATERIAL_TriangleFillMode:q.a.MATERIAL_WireFrameFillMode,w,N,F)},e.prototype.drawElementsType=function(D,w,N,F){this.applyStates(),this._reportDrawCall();var k=this._drawMode(D),j=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,z=this._uintIndicesCurrentlySet?4:2;F?this._gl.drawElementsInstanced(k,N,j,w*z,F):this._gl.drawElements(k,N,j,w*z)},e.prototype.drawArraysType=function(D,w,N,F){this.applyStates(),this._reportDrawCall();var k=this._drawMode(D);F?this._gl.drawArraysInstanced(k,w,N,F):this._gl.drawArrays(k,w,N)},e.prototype._drawMode=function(D){switch(D){case q.a.MATERIAL_TriangleFillMode:return this._gl.TRIANGLES;case q.a.MATERIAL_PointFillMode:return this._gl.POINTS;case q.a.MATERIAL_WireFrameFillMode:return this._gl.LINES;case q.a.MATERIAL_PointListDrawMode:return this._gl.POINTS;case q.a.MATERIAL_LineListDrawMode:return this._gl.LINES;case q.a.MATERIAL_LineLoopDrawMode:return this._gl.LINE_LOOP;case q.a.MATERIAL_LineStripDrawMode:return this._gl.LINE_STRIP;case q.a.MATERIAL_TriangleStripDrawMode:return this._gl.TRIANGLE_STRIP;case q.a.MATERIAL_TriangleFanDrawMode:return this._gl.TRIANGLE_FAN;default:return this._gl.TRIANGLES}},e.prototype._reportDrawCall=function(){},e.prototype._releaseEffect=function(D){this._compiledEffects[D._key]&&(delete this._compiledEffects[D._key],this._deletePipelineContext(D.getPipelineContext()))},e.prototype._deletePipelineContext=function(D){var w=D;w&&w.program&&(w.program.__SPECTOR_rebuildProgram=null,this._gl.deleteProgram(w.program))},e.prototype.createEffect=function(D,w,N,F,j,z,G,H,X){var q=(D.vertexElement||D.vertex||D)+"+"+(D.fragmentElement||D.fragment||D)+"@"+(j||w.defines);if(this._compiledEffects[q]){var Z=this._compiledEffects[q];return G&&Z.isReady()&&G(Z),Z}var J=new k.a(D,w,N,F,this,j,z,G,H,X);return J._key=q,this._compiledEffects[q]=J,J},e._ConcatenateShader=function(D,w,N){return void 0===N&&(N=""),N+(w?w+"\n":"")+D},e.prototype._compileShader=function(D,w,N,F){return this._compileRawShader(e._ConcatenateShader(D,N,F),w)},e.prototype._compileRawShader=function(D,w){var N=this._gl,F=N.createShader("vertex"===w?N.VERTEX_SHADER:N.FRAGMENT_SHADER);if(!F)throw new Error("Something went wrong while compile the shader.");return N.shaderSource(F,D),N.compileShader(F),F},e.prototype.createRawShaderProgram=function(D,w,N,F,k){void 0===k&&(k=null),F=F||this._gl;var j=this._compileRawShader(w,"vertex"),z=this._compileRawShader(N,"fragment");return this._createShaderProgram(D,j,z,F,k)},e.prototype.createShaderProgram=function(D,w,N,F,k,j){void 0===j&&(j=null),k=k||this._gl;var z=this._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"",G=this._compileShader(w,"vertex",F,z),H=this._compileShader(N,"fragment",F,z);return this._createShaderProgram(D,G,H,k,j)},e.prototype.createPipelineContext=function(){var D=new oe.a;return D.engine=this,this._caps.parallelShaderCompile&&(D.isParallelCompiled=!0),D},e.prototype._createShaderProgram=function(D,w,N,F,k){void 0===k&&(k=null);var j=F.createProgram();if(D.program=j,!j)throw new Error("Unable to create program");return F.attachShader(j,w),F.attachShader(j,N),F.linkProgram(j),D.context=F,D.vertexShader=w,D.fragmentShader=N,D.isParallelCompiled||this._finalizePipelineContext(D),j},e.prototype._finalizePipelineContext=function(D){var w=D.context,N=D.vertexShader,F=D.fragmentShader,k=D.program;if(!w.getProgramParameter(k,w.LINK_STATUS)){var j,z;if(!this._gl.getShaderParameter(N,this._gl.COMPILE_STATUS)&&(j=this._gl.getShaderInfoLog(N)))throw D.vertexCompilationError=j,new Error("VERTEX SHADER "+j);if(!this._gl.getShaderParameter(F,this._gl.COMPILE_STATUS)&&(j=this._gl.getShaderInfoLog(F)))throw D.fragmentCompilationError=j,new Error("FRAGMENT SHADER "+j);if(z=w.getProgramInfoLog(k))throw D.programLinkError=z,new Error(z)}if(this.validateShaderPrograms&&(w.validateProgram(k),!w.getProgramParameter(k,w.VALIDATE_STATUS)&&(z=w.getProgramInfoLog(k))))throw D.programValidationError=z,new Error(z);w.deleteShader(N),w.deleteShader(F),D.vertexShader=void 0,D.fragmentShader=void 0,D.onCompiled&&(D.onCompiled(),D.onCompiled=void 0)},e.prototype._preparePipelineContext=function(D,w,N,F,k,j,z){var G=D;G.program=F?this.createRawShaderProgram(G,w,N,void 0,z):this.createShaderProgram(G,w,N,j,void 0,z),G.program.__SPECTOR_rebuildProgram=k},e.prototype._isRenderingStateCompiled=function(D){var w=D;return!!this._gl.getProgramParameter(w.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)&&(this._finalizePipelineContext(w),!0)},e.prototype._executeWhenRenderingStateIsCompiled=function(D,w){var N=D;if(N.isParallelCompiled){var F=N.onCompiled;N.onCompiled=F?function(){F(),w()}:w}else w()},e.prototype.getUniforms=function(D,w){for(var N=new Array,F=D,k=0;k<w.length;k++)N.push(this._gl.getUniformLocation(F.program,w[k]));return N},e.prototype.getAttributes=function(D,w){for(var N=[],F=D,k=0;k<w.length;k++)try{N.push(this._gl.getAttribLocation(F.program,w[k]))}catch(D){N.push(-1)}return N},e.prototype.enableEffect=function(D){D&&D!==this._currentEffect&&(this.bindSamplers(D),this._currentEffect=D,D.onBind&&D.onBind(D),D._onBindObservable&&D._onBindObservable.notifyObservers(D))},e.prototype.setInt=function(D,w){D&&this._gl.uniform1i(D,w)},e.prototype.setIntArray=function(D,w){D&&this._gl.uniform1iv(D,w)},e.prototype.setIntArray2=function(D,w){D&&w.length%2==0&&this._gl.uniform2iv(D,w)},e.prototype.setIntArray3=function(D,w){D&&w.length%3==0&&this._gl.uniform3iv(D,w)},e.prototype.setIntArray4=function(D,w){D&&w.length%4==0&&this._gl.uniform4iv(D,w)},e.prototype.setArray=function(D,w){D&&this._gl.uniform1fv(D,w)},e.prototype.setArray2=function(D,w){D&&w.length%2==0&&this._gl.uniform2fv(D,w)},e.prototype.setArray3=function(D,w){D&&w.length%3==0&&this._gl.uniform3fv(D,w)},e.prototype.setArray4=function(D,w){D&&w.length%4==0&&this._gl.uniform4fv(D,w)},e.prototype.setMatrices=function(D,w){D&&this._gl.uniformMatrix4fv(D,!1,w)},e.prototype.setMatrix3x3=function(D,w){D&&this._gl.uniformMatrix3fv(D,!1,w)},e.prototype.setMatrix2x2=function(D,w){D&&this._gl.uniformMatrix2fv(D,!1,w)},e.prototype.setFloat=function(D,w){D&&this._gl.uniform1f(D,w)},e.prototype.setFloat2=function(D,w,N){D&&this._gl.uniform2f(D,w,N)},e.prototype.setFloat3=function(D,w,N,F){D&&this._gl.uniform3f(D,w,N,F)},e.prototype.setFloat4=function(D,w,N,F,k){D&&this._gl.uniform4f(D,w,N,F,k)},e.prototype.applyStates=function(){if(this._depthCullingState.apply(this._gl),this._stencilState.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;var D=this._colorWrite;this._gl.colorMask(D,D,D,D)}},e.prototype.setColorWrite=function(D){D!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=D)},e.prototype.getColorWrite=function(){return this._colorWrite},Object.defineProperty(e.prototype,"depthCullingState",{get:function(){return this._depthCullingState},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alphaState",{get:function(){return this._alphaState},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stencilState",{get:function(){return this._stencilState},enumerable:!0,configurable:!0}),e.prototype.clearInternalTexturesCache=function(){this._internalTexturesCache=[]},e.prototype.wipeCaches=function(D){this.preventCacheWipeBetweenFrames&&!D||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),D&&(this._currentProgram=null,this.resetTextureCache(),this._stencilState.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=q.a.ALPHA_ADD,this._alphaEquation=q.a.ALPHA_DISABLE,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))},e.prototype._getSamplingParameters=function(D,w){var N=this._gl,F=N.NEAREST,k=N.NEAREST;switch(D){case q.a.TEXTURE_LINEAR_LINEAR_MIPNEAREST:F=N.LINEAR,k=w?N.LINEAR_MIPMAP_NEAREST:N.LINEAR;break;case q.a.TEXTURE_LINEAR_LINEAR_MIPLINEAR:F=N.LINEAR,k=w?N.LINEAR_MIPMAP_LINEAR:N.LINEAR;break;case q.a.TEXTURE_NEAREST_NEAREST_MIPLINEAR:F=N.NEAREST,k=w?N.NEAREST_MIPMAP_LINEAR:N.NEAREST;break;case q.a.TEXTURE_NEAREST_NEAREST_MIPNEAREST:F=N.NEAREST,k=w?N.NEAREST_MIPMAP_NEAREST:N.NEAREST;break;case q.a.TEXTURE_NEAREST_LINEAR_MIPNEAREST:F=N.NEAREST,k=w?N.LINEAR_MIPMAP_NEAREST:N.LINEAR;break;case q.a.TEXTURE_NEAREST_LINEAR_MIPLINEAR:F=N.NEAREST,k=w?N.LINEAR_MIPMAP_LINEAR:N.LINEAR;break;case q.a.TEXTURE_NEAREST_LINEAR:F=N.NEAREST,k=N.LINEAR;break;case q.a.TEXTURE_NEAREST_NEAREST:F=N.NEAREST,k=N.NEAREST;break;case q.a.TEXTURE_LINEAR_NEAREST_MIPNEAREST:F=N.LINEAR,k=w?N.NEAREST_MIPMAP_NEAREST:N.NEAREST;break;case q.a.TEXTURE_LINEAR_NEAREST_MIPLINEAR:F=N.LINEAR,k=w?N.NEAREST_MIPMAP_LINEAR:N.NEAREST;break;case q.a.TEXTURE_LINEAR_LINEAR:F=N.LINEAR,k=N.LINEAR;break;case q.a.TEXTURE_LINEAR_NEAREST:F=N.LINEAR,k=N.NEAREST}return{min:k,mag:F}},e.prototype._createTexture=function(){var D=this._gl.createTexture();if(!D)throw new Error("Unable to create texture");return D},e.prototype.createTexture=function(D,w,N,k,j,z,G,H,X,J,$,te){var ie=this;void 0===j&&(j=q.a.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===z&&(z=null),void 0===G&&(G=null),void 0===H&&(H=null),void 0===X&&(X=null),void 0===J&&(J=null),void 0===$&&($=null);for(var oe=String(D),ce="data:"===oe.substr(0,5),he="blob:"===oe.substr(0,5),fe=ce&&-1!==oe.indexOf(";base64,"),pe=X||new Z.a(this,Z.b.Url),_e=oe.lastIndexOf("."),ve=$||(_e>-1?oe.substring(_e).toLowerCase():""),ye=null,be=0,Te=e._TextureLoaders;be<Te.length;be++){var Ee=Te[be];if(Ee.canLoad(ve)){ye=Ee;break}}k&&k._addPendingData(pe),pe.url=oe,pe.generateMipMaps=!w,pe.samplingMode=j,pe.invertY=N,this._doNotHandleContextLost||(pe._buffer=H);var Se=null;z&&!X&&(Se=pe.onLoadedObservable.add(z)),X||this._internalTexturesCache.push(pe);var O=function(D,N){k&&k._removePendingData(pe),Se&&pe.onLoadedObservable.remove(Se),F.a.UseFallbackTexture?ie.createTexture(F.a.FallbackTexture,w,pe.invertY,k,j,null,G,H,pe):G&&G(D||"Unknown error",N)};if(ye){var M=function(D){ye.loadData(D,pe,(function(D,w,N,F,z,G){G?O("TextureLoader failed to load data"):ie._prepareWebGLTexture(pe,k,D,w,pe.invertY,!N,F,(function(){return z(),!1}),j)}))};H?H instanceof ArrayBuffer?M(new Uint8Array(H)):ArrayBuffer.isView(H)?M(H):G&&G("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(oe,(function(D){return M(new Uint8Array(D))}),void 0,k?k.offlineProvider:void 0,!0,(function(D,w){O("Unable to load "+(D&&D.responseURL,w))}))}else{var I=function(D){he&&!ie._doNotHandleContextLost&&(pe._buffer=D),ie._prepareWebGLTexture(pe,k,D.width,D.height,pe.invertY,w,!1,(function(w,N,F){var j=ie._gl,z=D.width===w&&D.height===N,G=J?ie._getInternalFormat(J):".jpg"===ve?j.RGB:j.RGBA;if(z)return j.texImage2D(j.TEXTURE_2D,0,G,G,j.UNSIGNED_BYTE,D),!1;var H=ie._caps.maxTextureSize;if(D.width>H||D.height>H||!ie._supportsHardwareTextureRescaling)return ie._prepareWorkingCanvas(),!(!ie._workingCanvas||!ie._workingContext||(ie._workingCanvas.width=w,ie._workingCanvas.height=N,ie._workingContext.drawImage(D,0,0,D.width,D.height,0,0,w,N),j.texImage2D(j.TEXTURE_2D,0,G,G,j.UNSIGNED_BYTE,ie._workingCanvas),pe.width=w,pe.height=N,1));var X=new Z.a(ie,Z.b.Temp);return ie._bindTextureDirectly(j.TEXTURE_2D,X,!0),j.texImage2D(j.TEXTURE_2D,0,G,G,j.UNSIGNED_BYTE,D),ie._rescaleTexture(X,pe,k,G,(function(){ie._releaseTexture(X),ie._bindTextureDirectly(j.TEXTURE_2D,pe,!0),F()})),!0}),j)};!ce||fe?H&&(H.decoding||H.close)?I(H):e._FileToolsLoadImage(oe,I,O,k?k.offlineProvider:null,te):"string"==typeof H||H instanceof ArrayBuffer||ArrayBuffer.isView(H)||H instanceof Blob?e._FileToolsLoadImage(H,I,O,k?k.offlineProvider:null,te):H&&I(H)}return pe},e._FileToolsLoadImage=function(D,w,N,F,k){throw j.a.WarnImport("FileTools")},e.prototype._rescaleTexture=function(D,w,N,F,k){},e.prototype.createRawTexture=function(D,w,N,F,k,z,G,H,X){throw void 0===H&&(H=null),void 0===X&&(X=q.a.TEXTURETYPE_UNSIGNED_INT),j.a.WarnImport("Engine.RawTexture")},e.prototype.createRawCubeTexture=function(D,w,N,F,k,z,G,H){throw void 0===H&&(H=null),j.a.WarnImport("Engine.RawTexture")},e.prototype.createRawTexture3D=function(D,w,N,F,k,z,G,H,X,Z){throw void 0===X&&(X=null),void 0===Z&&(Z=q.a.TEXTURETYPE_UNSIGNED_INT),j.a.WarnImport("Engine.RawTexture")},e.prototype.createRawTexture2DArray=function(D,w,N,F,k,z,G,H,X,Z){throw void 0===X&&(X=null),void 0===Z&&(Z=q.a.TEXTURETYPE_UNSIGNED_INT),j.a.WarnImport("Engine.RawTexture")},e.prototype._unpackFlipY=function(D){this._unpackFlipYCached!==D&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,D?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=D))},e.prototype._getUnpackAlignement=function(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)},e.prototype._getTextureTarget=function(D){return D.isCube?this._gl.TEXTURE_CUBE_MAP:D.is3D?this._gl.TEXTURE_3D:D.is2DArray||D.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D},e.prototype.updateTextureSamplingMode=function(D,w,N){void 0===N&&(N=!1);var F=this._getTextureTarget(w),k=this._getSamplingParameters(D,w.generateMipMaps||N);this._setTextureParameterInteger(F,this._gl.TEXTURE_MAG_FILTER,k.mag,w),this._setTextureParameterInteger(F,this._gl.TEXTURE_MIN_FILTER,k.min),N&&(w.generateMipMaps=!0,this._gl.generateMipmap(F)),this._bindTextureDirectly(F,null),w.samplingMode=D},e.prototype.updateTextureWrappingMode=function(D,w,N,F){void 0===N&&(N=null),void 0===F&&(F=null);var k=this._getTextureTarget(D);null!==w&&(this._setTextureParameterInteger(k,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(w),D),D._cachedWrapU=w),null!==N&&(this._setTextureParameterInteger(k,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(N),D),D._cachedWrapV=N),(D.is2DArray||D.is3D)&&null!==F&&(this._setTextureParameterInteger(k,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(F),D),D._cachedWrapR=F),this._bindTextureDirectly(k,null)},e.prototype._setupDepthStencilTexture=function(D,w,N,F,k){var j=w.width||w,z=w.height||w,G=w.layers||0;D.baseWidth=j,D.baseHeight=z,D.width=j,D.height=z,D.is2DArray=G>0,D.depth=G,D.isReady=!0,D.samples=1,D.generateMipMaps=!1,D._generateDepthBuffer=!0,D._generateStencilBuffer=N,D.samplingMode=F?q.a.TEXTURE_BILINEAR_SAMPLINGMODE:q.a.TEXTURE_NEAREST_SAMPLINGMODE,D.type=q.a.TEXTURETYPE_UNSIGNED_INT,D._comparisonFunction=k;var H=this._gl,X=this._getTextureTarget(D),Z=this._getSamplingParameters(D.samplingMode,!1);H.texParameteri(X,H.TEXTURE_MAG_FILTER,Z.mag),H.texParameteri(X,H.TEXTURE_MIN_FILTER,Z.min),H.texParameteri(X,H.TEXTURE_WRAP_S,H.CLAMP_TO_EDGE),H.texParameteri(X,H.TEXTURE_WRAP_T,H.CLAMP_TO_EDGE),0===k?(H.texParameteri(X,H.TEXTURE_COMPARE_FUNC,q.a.LEQUAL),H.texParameteri(X,H.TEXTURE_COMPARE_MODE,H.NONE)):(H.texParameteri(X,H.TEXTURE_COMPARE_FUNC,k),H.texParameteri(X,H.TEXTURE_COMPARE_MODE,H.COMPARE_REF_TO_TEXTURE))},e.prototype._uploadCompressedDataToTextureDirectly=function(D,w,N,F,k,j,z){void 0===j&&(j=0),void 0===z&&(z=0);var G=this._gl,H=G.TEXTURE_2D;D.isCube&&(H=G.TEXTURE_CUBE_MAP_POSITIVE_X+j),this._gl.compressedTexImage2D(H,z,w,N,F,0,k)},e.prototype._uploadDataToTextureDirectly=function(D,w,N,F,k,j){void 0===N&&(N=0),void 0===F&&(F=0),void 0===j&&(j=!1);var z=this._gl,G=this._getWebGLTextureType(D.type),H=this._getInternalFormat(D.format),X=void 0===k?this._getRGBABufferInternalSizedFormat(D.type,D.format):this._getInternalFormat(k);this._unpackFlipY(D.invertY);var q=z.TEXTURE_2D;D.isCube&&(q=z.TEXTURE_CUBE_MAP_POSITIVE_X+N);var Z=Math.round(Math.log(D.width)*Math.LOG2E),J=Math.round(Math.log(D.height)*Math.LOG2E),$=j?D.width:Math.pow(2,Math.max(Z-F,0)),te=j?D.height:Math.pow(2,Math.max(J-F,0));z.texImage2D(q,F,X,$,te,0,H,G,w)},e.prototype.updateTextureData=function(D,w,N,F,k,j,z,G){void 0===z&&(z=0),void 0===G&&(G=0);var H=this._gl,X=this._getWebGLTextureType(D.type),q=this._getInternalFormat(D.format);this._unpackFlipY(D.invertY);var Z=H.TEXTURE_2D;D.isCube&&(Z=H.TEXTURE_CUBE_MAP_POSITIVE_X+z),H.texSubImage2D(Z,G,N,F,k,j,q,X,w)},e.prototype._uploadArrayBufferViewToTexture=function(D,w,N,F){void 0===N&&(N=0),void 0===F&&(F=0);var k=this._gl,j=D.isCube?k.TEXTURE_CUBE_MAP:k.TEXTURE_2D;this._bindTextureDirectly(j,D,!0),this._uploadDataToTextureDirectly(D,w,N,F),this._bindTextureDirectly(j,null,!0)},e.prototype._prepareWebGLTextureContinuation=function(D,w,N,F,k){var j=this._gl;if(j){var z=this._getSamplingParameters(k,!N);j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MAG_FILTER,z.mag),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MIN_FILTER,z.min),N||F||j.generateMipmap(j.TEXTURE_2D),this._bindTextureDirectly(j.TEXTURE_2D,null),w&&w._removePendingData(D),D.onLoadedObservable.notifyObservers(D),D.onLoadedObservable.clear()}},e.prototype._prepareWebGLTexture=function(D,w,N,F,k,j,z,G,H){var X=this;void 0===H&&(H=q.a.TEXTURE_TRILINEAR_SAMPLINGMODE);var Z=this.getCaps().maxTextureSize,J=Math.min(Z,this.needPOTTextures?e.GetExponentOfTwo(N,Z):N),$=Math.min(Z,this.needPOTTextures?e.GetExponentOfTwo(F,Z):F),te=this._gl;te&&(D._webGLTexture?(this._bindTextureDirectly(te.TEXTURE_2D,D,!0),this._unpackFlipY(void 0===k||!!k),D.baseWidth=N,D.baseHeight=F,D.width=J,D.height=$,D.isReady=!0,G(J,$,(function(){X._prepareWebGLTextureContinuation(D,w,j,z,H)}))||this._prepareWebGLTextureContinuation(D,w,j,z,H)):w&&w._removePendingData(D))},e.prototype._setupFramebufferDepthAttachments=function(D,w,N,F,k){void 0===k&&(k=1);var j=this._gl;if(D&&w)return this._getDepthStencilBuffer(N,F,k,j.DEPTH_STENCIL,j.DEPTH24_STENCIL8,j.DEPTH_STENCIL_ATTACHMENT);if(w){var z=j.DEPTH_COMPONENT16;return this._webGLVersion>1&&(z=j.DEPTH_COMPONENT32F),this._getDepthStencilBuffer(N,F,k,z,z,j.DEPTH_ATTACHMENT)}return D?this._getDepthStencilBuffer(N,F,k,j.STENCIL_INDEX8,j.STENCIL_INDEX8,j.STENCIL_ATTACHMENT):null},e.prototype._releaseFramebufferObjects=function(D){var w=this._gl;D._framebuffer&&(w.deleteFramebuffer(D._framebuffer),D._framebuffer=null),D._depthStencilBuffer&&(w.deleteRenderbuffer(D._depthStencilBuffer),D._depthStencilBuffer=null),D._MSAAFramebuffer&&(w.deleteFramebuffer(D._MSAAFramebuffer),D._MSAAFramebuffer=null),D._MSAARenderBuffer&&(w.deleteRenderbuffer(D._MSAARenderBuffer),D._MSAARenderBuffer=null)},e.prototype._releaseTexture=function(D){this._releaseFramebufferObjects(D),this._deleteTexture(D._webGLTexture),this.unbindAllTextures();var w=this._internalTexturesCache.indexOf(D);-1!==w&&this._internalTexturesCache.splice(w,1),D._lodTextureHigh&&D._lodTextureHigh.dispose(),D._lodTextureMid&&D._lodTextureMid.dispose(),D._lodTextureLow&&D._lodTextureLow.dispose(),D._irradianceTexture&&D._irradianceTexture.dispose()},e.prototype._deleteTexture=function(D){this._gl.deleteTexture(D)},e.prototype._setProgram=function(D){this._currentProgram!==D&&(this._gl.useProgram(D),this._currentProgram=D)},e.prototype.bindSamplers=function(D){var w=D.getPipelineContext();this._setProgram(w.program);for(var N=D.getSamplers(),F=0;F<N.length;F++){var k=D.getUniform(N[F]);k&&(this._boundUniforms[F]=k)}this._currentEffect=null},e.prototype._activateCurrentTexture=function(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)},e.prototype._bindTextureDirectly=function(D,w,N,F){void 0===N&&(N=!1),void 0===F&&(F=!1);var k=!1,j=w&&w._associatedChannel>-1;return N&&j&&(this._activeChannel=w._associatedChannel),this._boundTexturesCache[this._activeChannel]!==w||F?(this._activateCurrentTexture(),w&&w.isMultiview?this._gl.bindTexture(D,w?w._colorTextureArray:null):this._gl.bindTexture(D,w?w._webGLTexture:null),this._boundTexturesCache[this._activeChannel]=w,w&&(w._associatedChannel=this._activeChannel)):N&&(k=!0,this._activateCurrentTexture()),j&&!N&&this._bindSamplerUniformToChannel(w._associatedChannel,this._activeChannel),k},e.prototype._bindTexture=function(D,w){void 0!==D&&(w&&(w._associatedChannel=D),this._activeChannel=D,this._bindTextureDirectly(this._gl.TEXTURE_2D,w))},e.prototype.unbindAllTextures=function(){for(var D=0;D<this._maxSimultaneousTextures;D++)this._activeChannel=D,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))},e.prototype.setTexture=function(D,w,N){void 0!==D&&(w&&(this._boundUniforms[D]=w),this._setTexture(D,N))},e.prototype._bindSamplerUniformToChannel=function(D,w){var N=this._boundUniforms[D];N&&N._currentState!==w&&(this._gl.uniform1i(N,w),N._currentState=w)},e.prototype._getTextureWrapMode=function(D){switch(D){case q.a.TEXTURE_WRAP_ADDRESSMODE:return this._gl.REPEAT;case q.a.TEXTURE_CLAMP_ADDRESSMODE:return this._gl.CLAMP_TO_EDGE;case q.a.TEXTURE_MIRROR_ADDRESSMODE:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT},e.prototype._setTexture=function(D,w,N,F){if(void 0===N&&(N=!1),void 0===F&&(F=!1),!w)return null!=this._boundTexturesCache[D]&&(this._activeChannel=D,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(w.video)this._activeChannel=D,w.update();else if(w.delayLoadState===q.a.DELAYLOADSTATE_NOTLOADED)return w.delayLoad(),!1;var k;k=F?w.depthStencilTexture:w.isReady()?w.getInternalTexture():w.isCube?this.emptyCubeTexture:w.is3D?this.emptyTexture3D:w.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!N&&k&&(k._associatedChannel=D);var j=!0;this._boundTexturesCache[D]===k&&(N||this._bindSamplerUniformToChannel(k._associatedChannel,D),j=!1),this._activeChannel=D;var z=this._getTextureTarget(k);if(j&&this._bindTextureDirectly(z,k,N),k&&!k.isMultiview){if(k.isCube&&k._cachedCoordinatesMode!==w.coordinatesMode){k._cachedCoordinatesMode=w.coordinatesMode;var G=w.coordinatesMode!==q.a.TEXTURE_CUBIC_MODE&&w.coordinatesMode!==q.a.TEXTURE_SKYBOX_MODE?q.a.TEXTURE_WRAP_ADDRESSMODE:q.a.TEXTURE_CLAMP_ADDRESSMODE;w.wrapU=G,w.wrapV=G}k._cachedWrapU!==w.wrapU&&(k._cachedWrapU=w.wrapU,this._setTextureParameterInteger(z,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(w.wrapU),k)),k._cachedWrapV!==w.wrapV&&(k._cachedWrapV=w.wrapV,this._setTextureParameterInteger(z,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(w.wrapV),k)),k.is3D&&k._cachedWrapR!==w.wrapR&&(k._cachedWrapR=w.wrapR,this._setTextureParameterInteger(z,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(w.wrapR),k)),this._setAnisotropicLevel(z,k,w.anisotropicFilteringLevel)}return!0},e.prototype.setTextureArray=function(D,w,N){if(void 0!==D&&w){this._textureUnits&&this._textureUnits.length===N.length||(this._textureUnits=new Int32Array(N.length));for(var F=0;F<N.length;F++){var k=N[F].getInternalTexture();k?(this._textureUnits[F]=D+F,k._associatedChannel=D+F):this._textureUnits[F]=-1}this._gl.uniform1iv(w,this._textureUnits);for(var j=0;j<N.length;j++)this._setTexture(this._textureUnits[j],N[j],!0)}},e.prototype._setAnisotropicLevel=function(D,w,N){var F=this._caps.textureAnisotropicFilterExtension;w.samplingMode!==q.a.TEXTURE_LINEAR_LINEAR_MIPNEAREST&&w.samplingMode!==q.a.TEXTURE_LINEAR_LINEAR_MIPLINEAR&&w.samplingMode!==q.a.TEXTURE_LINEAR_LINEAR&&(N=1),F&&w._cachedAnisotropicFilteringLevel!==N&&(this._setTextureParameterFloat(D,F.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(N,this._caps.maxAnisotropy),w),w._cachedAnisotropicFilteringLevel=N)},e.prototype._setTextureParameterFloat=function(D,w,N,F){this._bindTextureDirectly(D,F,!0,!0),this._gl.texParameterf(D,w,N)},e.prototype._setTextureParameterInteger=function(D,w,N,F){F&&this._bindTextureDirectly(D,F,!0,!0),this._gl.texParameteri(D,w,N)},e.prototype.unbindAllAttributes=function(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(var D=0;D<this._caps.maxVertexAttribs;D++)this.disableAttributeByIndex(D)}else{D=0;for(var w=this._vertexAttribArraysEnabled.length;D<w;D++)D>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[D]||this.disableAttributeByIndex(D)}},e.prototype.releaseEffects=function(){for(var D in this._compiledEffects){var w=this._compiledEffects[D].getPipelineContext();this._deletePipelineContext(w)}this._compiledEffects={}},e.prototype.dispose=function(){this.stopRenderLoop(),this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this.releaseEffects(),this.unbindAllAttributes(),this._boundUniforms=[],$.a.IsWindowObjectExist()&&this._renderingCanvas&&(this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored))),this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers=[],this._renderingCanvas=null,this._currentProgram=null,this._boundRenderFunction=null,k.a.ResetCache();for(var D=0,w=this._activeRequests;D<w.length;D++)w[D].abort()},e.prototype.attachContextLostEvent=function(D){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",D,!1)},e.prototype.attachContextRestoredEvent=function(D){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",D,!1)},e.prototype.getError=function(){return this._gl.getError()},e.prototype._canRenderToFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(q.a.TEXTURETYPE_FLOAT)},e.prototype._canRenderToHalfFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(q.a.TEXTURETYPE_HALF_FLOAT)},e.prototype._canRenderToFramebuffer=function(D){for(var w=this._gl;w.getError()!==w.NO_ERROR;);var N=!0,F=w.createTexture();w.bindTexture(w.TEXTURE_2D,F),w.texImage2D(w.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(D),1,1,0,w.RGBA,this._getWebGLTextureType(D),null),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,w.NEAREST),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,w.NEAREST);var k=w.createFramebuffer();w.bindFramebuffer(w.FRAMEBUFFER,k),w.framebufferTexture2D(w.FRAMEBUFFER,w.COLOR_ATTACHMENT0,w.TEXTURE_2D,F,0);var j=w.checkFramebufferStatus(w.FRAMEBUFFER);if((N=(N=N&&j===w.FRAMEBUFFER_COMPLETE)&&w.getError()===w.NO_ERROR)&&(w.clear(w.COLOR_BUFFER_BIT),N=N&&w.getError()===w.NO_ERROR),N){w.bindFramebuffer(w.FRAMEBUFFER,null);var z=w.RGBA,G=w.UNSIGNED_BYTE,H=new Uint8Array(4);w.readPixels(0,0,1,1,z,G,H),N=N&&w.getError()===w.NO_ERROR}for(w.deleteTexture(F),w.deleteFramebuffer(k),w.bindFramebuffer(w.FRAMEBUFFER,null);!N&&w.getError()!==w.NO_ERROR;);return N},e.prototype._getWebGLTextureType=function(D){if(1===this._webGLVersion){switch(D){case q.a.TEXTURETYPE_FLOAT:return this._gl.FLOAT;case q.a.TEXTURETYPE_HALF_FLOAT:return this._gl.HALF_FLOAT_OES;case q.a.TEXTURETYPE_UNSIGNED_BYTE:return this._gl.UNSIGNED_BYTE;case q.a.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4:return this._gl.UNSIGNED_SHORT_4_4_4_4;case q.a.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1:return this._gl.UNSIGNED_SHORT_5_5_5_1;case q.a.TEXTURETYPE_UNSIGNED_SHORT_5_6_5:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(D){case q.a.TEXTURETYPE_BYTE:return this._gl.BYTE;case q.a.TEXTURETYPE_UNSIGNED_BYTE:return this._gl.UNSIGNED_BYTE;case q.a.TEXTURETYPE_SHORT:return this._gl.SHORT;case q.a.TEXTURETYPE_UNSIGNED_SHORT:return this._gl.UNSIGNED_SHORT;case q.a.TEXTURETYPE_INT:return this._gl.INT;case q.a.TEXTURETYPE_UNSIGNED_INTEGER:return this._gl.UNSIGNED_INT;case q.a.TEXTURETYPE_FLOAT:return this._gl.FLOAT;case q.a.TEXTURETYPE_HALF_FLOAT:return this._gl.HALF_FLOAT;case q.a.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4:return this._gl.UNSIGNED_SHORT_4_4_4_4;case q.a.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1:return this._gl.UNSIGNED_SHORT_5_5_5_1;case q.a.TEXTURETYPE_UNSIGNED_SHORT_5_6_5:return this._gl.UNSIGNED_SHORT_5_6_5;case q.a.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case q.a.TEXTURETYPE_UNSIGNED_INT_24_8:return this._gl.UNSIGNED_INT_24_8;case q.a.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case q.a.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case q.a.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE},e.prototype._getInternalFormat=function(D){var w=this._gl.RGBA;switch(D){case q.a.TEXTUREFORMAT_ALPHA:w=this._gl.ALPHA;break;case q.a.TEXTUREFORMAT_LUMINANCE:w=this._gl.LUMINANCE;break;case q.a.TEXTUREFORMAT_LUMINANCE_ALPHA:w=this._gl.LUMINANCE_ALPHA;break;case q.a.TEXTUREFORMAT_RED:w=this._gl.RED;break;case q.a.TEXTUREFORMAT_RG:w=this._gl.RG;break;case q.a.TEXTUREFORMAT_RGB:w=this._gl.RGB;break;case q.a.TEXTUREFORMAT_RGBA:w=this._gl.RGBA}if(this._webGLVersion>1)switch(D){case q.a.TEXTUREFORMAT_RED_INTEGER:w=this._gl.RED_INTEGER;break;case q.a.TEXTUREFORMAT_RG_INTEGER:w=this._gl.RG_INTEGER;break;case q.a.TEXTUREFORMAT_RGB_INTEGER:w=this._gl.RGB_INTEGER;break;case q.a.TEXTUREFORMAT_RGBA_INTEGER:w=this._gl.RGBA_INTEGER}return w},e.prototype._getRGBABufferInternalSizedFormat=function(D,w){if(1===this._webGLVersion){if(void 0!==w)switch(w){case q.a.TEXTUREFORMAT_ALPHA:return this._gl.ALPHA;case q.a.TEXTUREFORMAT_LUMINANCE:return this._gl.LUMINANCE;case q.a.TEXTUREFORMAT_LUMINANCE_ALPHA:return this._gl.LUMINANCE_ALPHA;case q.a.TEXTUREFORMAT_RGB:return this._gl.RGB}return this._gl.RGBA}switch(D){case q.a.TEXTURETYPE_BYTE:switch(w){case q.a.TEXTUREFORMAT_RED:return this._gl.R8_SNORM;case q.a.TEXTUREFORMAT_RG:return this._gl.RG8_SNORM;case q.a.TEXTUREFORMAT_RGB:return this._gl.RGB8_SNORM;case q.a.TEXTUREFORMAT_RED_INTEGER:return this._gl.R8I;case q.a.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG8I;case q.a.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB8I;case q.a.TEXTUREFORMAT_RGBA_INTEGER:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case q.a.TEXTURETYPE_UNSIGNED_BYTE:switch(w){case q.a.TEXTUREFORMAT_RED:return this._gl.R8;case q.a.TEXTUREFORMAT_RG:return this._gl.RG8;case q.a.TEXTUREFORMAT_RGB:return this._gl.RGB8;case q.a.TEXTUREFORMAT_RGBA:return this._gl.RGBA8;case q.a.TEXTUREFORMAT_RED_INTEGER:return this._gl.R8UI;case q.a.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG8UI;case q.a.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB8UI;case q.a.TEXTUREFORMAT_RGBA_INTEGER:return this._gl.RGBA8UI;case q.a.TEXTUREFORMAT_ALPHA:return this._gl.ALPHA;case q.a.TEXTUREFORMAT_LUMINANCE:return this._gl.LUMINANCE;case q.a.TEXTUREFORMAT_LUMINANCE_ALPHA:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case q.a.TEXTURETYPE_SHORT:switch(w){case q.a.TEXTUREFORMAT_RED_INTEGER:return this._gl.R16I;case q.a.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG16I;case q.a.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB16I;case q.a.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA16I}case q.a.TEXTURETYPE_UNSIGNED_SHORT:switch(w){case q.a.TEXTUREFORMAT_RED_INTEGER:return this._gl.R16UI;case q.a.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG16UI;case q.a.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB16UI;case q.a.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA16UI}case q.a.TEXTURETYPE_INT:switch(w){case q.a.TEXTUREFORMAT_RED_INTEGER:return this._gl.R32I;case q.a.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG32I;case q.a.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB32I;case q.a.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA32I}case q.a.TEXTURETYPE_UNSIGNED_INTEGER:switch(w){case q.a.TEXTUREFORMAT_RED_INTEGER:return this._gl.R32UI;case q.a.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG32UI;case q.a.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB32UI;case q.a.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA32UI}case q.a.TEXTURETYPE_FLOAT:switch(w){case q.a.TEXTUREFORMAT_RED:return this._gl.R32F;case q.a.TEXTUREFORMAT_RG:return this._gl.RG32F;case q.a.TEXTUREFORMAT_RGB:return this._gl.RGB32F;case q.a.TEXTUREFORMAT_RGBA:default:return this._gl.RGBA32F}case q.a.TEXTURETYPE_HALF_FLOAT:switch(w){case q.a.TEXTUREFORMAT_RED:return this._gl.R16F;case q.a.TEXTUREFORMAT_RG:return this._gl.RG16F;case q.a.TEXTUREFORMAT_RGB:return this._gl.RGB16F;case q.a.TEXTUREFORMAT_RGBA:default:return this._gl.RGBA16F}case q.a.TEXTURETYPE_UNSIGNED_SHORT_5_6_5:return this._gl.RGB565;case q.a.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV:return this._gl.R11F_G11F_B10F;case q.a.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV:return this._gl.RGB9_E5;case q.a.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4:return this._gl.RGBA4;case q.a.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1:return this._gl.RGB5_A1;case q.a.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV:switch(w){case q.a.TEXTUREFORMAT_RGBA:return this._gl.RGB10_A2;case q.a.TEXTUREFORMAT_RGBA_INTEGER:return this._gl.RGB10_A2UI;default:return this._gl.RGB10_A2}}return this._gl.RGBA8},e.prototype._getRGBAMultiSampleBufferFormat=function(D){return D===q.a.TEXTURETYPE_FLOAT?this._gl.RGBA32F:D===q.a.TEXTURETYPE_HALF_FLOAT?this._gl.RGBA16F:this._gl.RGBA8},e.prototype._loadFile=function(D,w,N,F,k,j){var z=this,G=e._FileToolsLoadFile(D,w,N,F,k,j);return this._activeRequests.push(G),G.onCompleteObservable.add((function(D){z._activeRequests.splice(z._activeRequests.indexOf(D),1)})),G},e._FileToolsLoadFile=function(D,w,N,F,k,z){throw j.a.WarnImport("FileTools")},e.prototype.readPixels=function(D,w,N,F,k){void 0===k&&(k=!0);var j=k?4:3,z=k?this._gl.RGBA:this._gl.RGB,G=new Uint8Array(F*N*j);return this._gl.readPixels(D,w,N,F,z,this._gl.UNSIGNED_BYTE,G),G},e.isSupported=function(){if(null===this._isSupported)try{var D=ce.a.CreateCanvas(1,1),w=D.getContext("webgl")||D.getContext("experimental-webgl");this._isSupported=null!=w&&!!window.WebGLRenderingContext}catch(D){this._isSupported=!1}return this._isSupported},e.CeilingPOT=function(D){return D--,D|=D>>1,D|=D>>2,D|=D>>4,D|=D>>8,D|=D>>16,++D},e.FloorPOT=function(D){return D|=D>>1,D|=D>>2,D|=D>>4,D|=D>>8,(D|=D>>16)-(D>>1)},e.NearestPOT=function(D){var w=e.CeilingPOT(D),N=e.FloorPOT(D);return w-D>D-N?N:w},e.GetExponentOfTwo=function(D,w,N){var F;switch(void 0===N&&(N=q.a.SCALEMODE_NEAREST),N){case q.a.SCALEMODE_FLOOR:F=e.FloorPOT(D);break;case q.a.SCALEMODE_NEAREST:F=e.NearestPOT(D);break;case q.a.SCALEMODE_CEILING:default:F=e.CeilingPOT(D)}return Math.min(F,w)},e.QueueNewFrame=function(D,w){return $.a.IsWindowObjectExist()?(w||(w=window),w.requestAnimationFrame?w.requestAnimationFrame(D):w.msRequestAnimationFrame?w.msRequestAnimationFrame(D):w.webkitRequestAnimationFrame?w.webkitRequestAnimationFrame(D):w.mozRequestAnimationFrame?w.mozRequestAnimationFrame(D):w.oRequestAnimationFrame?w.oRequestAnimationFrame(D):window.setTimeout(D,16)):"undefined"!=typeof requestAnimationFrame?requestAnimationFrame(D):setTimeout(D,16)},e.prototype.getHostDocument=function(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:document},e.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]}],e._TextureLoaders=[],e.CollisionsEpsilon=.001,e._isSupported=null,e}()},function(D,w,N){"use strict";var F=N(1),k=N(3),j=N(34),z=N(18),G=N(0),H=N(10),X=N(4),q=N(40),Z=N(73),J=N(81),$=N(16),te=N(9),ie=N(12),oe=N(21),ce=N(8);ce.a.IncludesShadersStore.defaultFragmentDeclaration="uniform vec4 vDiffuseColor;\n#ifdef SPECULARTERM\nuniform vec4 vSpecularColor;\n#endif\nuniform vec3 vEmissiveColor;\nuniform float visibility;\n\n#ifdef DIFFUSE\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform vec2 vTangentSpaceParams;\n#endif\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)\nuniform mat4 view;\n#endif\n#ifdef REFRACTION\nuniform vec4 vRefractionInfos;\n#ifndef REFRACTIONMAP_3D\nuniform mat4 refractionMatrix;\n#endif\n#ifdef REFRACTIONFRESNEL\nuniform vec4 refractionLeftColor;\nuniform vec4 refractionRightColor;\n#endif\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nuniform vec2 vSpecularInfos;\n#endif\n#ifdef DIFFUSEFRESNEL\nuniform vec4 diffuseLeftColor;\nuniform vec4 diffuseRightColor;\n#endif\n#ifdef OPACITYFRESNEL\nuniform vec4 opacityParts;\n#endif\n#ifdef EMISSIVEFRESNEL\nuniform vec4 emissiveLeftColor;\nuniform vec4 emissiveRightColor;\n#endif\n\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\n#if defined(REFLECTIONMAP_PLANAR) || defined(REFLECTIONMAP_CUBIC) || defined(REFLECTIONMAP_PROJECTION) || defined(REFLECTIONMAP_EQUIRECTANGULAR) || defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_SKYBOX)\nuniform mat4 reflectionMatrix;\n#endif\n#ifndef REFLECTIONMAP_SKYBOX\n#if defined(USE_LOCAL_REFLECTIONMAP_CUBIC) && defined(REFLECTIONMAP_CUBIC)\nuniform vec3 vReflectionPosition;\nuniform vec3 vReflectionSize;\n#endif\n#endif\n#ifdef REFLECTIONFRESNEL\nuniform vec4 reflectionLeftColor;\nuniform vec4 reflectionRightColor;\n#endif\n#endif",ce.a.IncludesShadersStore.defaultUboDeclaration="layout(std140,column_major) uniform;\nuniform Material\n{\nvec4 diffuseLeftColor;\nvec4 diffuseRightColor;\nvec4 opacityParts;\nvec4 reflectionLeftColor;\nvec4 reflectionRightColor;\nvec4 refractionLeftColor;\nvec4 refractionRightColor;\nvec4 emissiveLeftColor;\nvec4 emissiveRightColor;\nvec2 vDiffuseInfos;\nvec2 vAmbientInfos;\nvec2 vOpacityInfos;\nvec2 vReflectionInfos;\nvec3 vReflectionPosition;\nvec3 vReflectionSize;\nvec2 vEmissiveInfos;\nvec2 vLightmapInfos;\nvec2 vSpecularInfos;\nvec3 vBumpInfos;\nmat4 diffuseMatrix;\nmat4 ambientMatrix;\nmat4 opacityMatrix;\nmat4 reflectionMatrix;\nmat4 emissiveMatrix;\nmat4 lightmapMatrix;\nmat4 specularMatrix;\nmat4 bumpMatrix;\nvec2 vTangentSpaceParams;\nfloat pointSize;\nmat4 refractionMatrix;\nvec4 vRefractionInfos;\nvec4 vSpecularColor;\nvec3 vEmissiveColor;\nfloat visibility;\nvec4 vDiffuseColor;\n};\nuniform Scene {\nmat4 viewProjection;\n#ifdef MULTIVIEW\nmat4 viewProjectionR;\n#endif\nmat4 view;\n};\n",N(58),N(97),N(98),N(139),N(117),N(145),N(118),N(99),N(100),N(119),N(106),N(107),N(113),N(101),N(120),N(146),N(121),N(140),N(122),ce.a.ShadersStore.defaultPixelShader="#include<__decl__defaultFragment>\n#if defined(BUMP) || !defined(NORMAL)\n#extension GL_OES_standard_derivatives : enable\n#endif\n#define CUSTOM_FRAGMENT_BEGIN\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n\n#define RECIPROCAL_PI2 0.15915494\nuniform vec3 vEyePosition;\nuniform vec3 vAmbientColor;\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif\n#ifdef MAINUV2\nvarying vec2 vMainUV2;\n#endif\n\n#include<helperFunctions>\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n\n#ifdef DIFFUSE\n#if DIFFUSEDIRECTUV == 1\n#define vDiffuseUV vMainUV1\n#elif DIFFUSEDIRECTUV == 2\n#define vDiffuseUV vMainUV2\n#else\nvarying vec2 vDiffuseUV;\n#endif\nuniform sampler2D diffuseSampler;\n#endif\n#ifdef AMBIENT\n#if AMBIENTDIRECTUV == 1\n#define vAmbientUV vMainUV1\n#elif AMBIENTDIRECTUV == 2\n#define vAmbientUV vMainUV2\n#else\nvarying vec2 vAmbientUV;\n#endif\nuniform sampler2D ambientSampler;\n#endif\n#ifdef OPACITY\n#if OPACITYDIRECTUV == 1\n#define vOpacityUV vMainUV1\n#elif OPACITYDIRECTUV == 2\n#define vOpacityUV vMainUV2\n#else\nvarying vec2 vOpacityUV;\n#endif\nuniform sampler2D opacitySampler;\n#endif\n#ifdef EMISSIVE\n#if EMISSIVEDIRECTUV == 1\n#define vEmissiveUV vMainUV1\n#elif EMISSIVEDIRECTUV == 2\n#define vEmissiveUV vMainUV2\n#else\nvarying vec2 vEmissiveUV;\n#endif\nuniform sampler2D emissiveSampler;\n#endif\n#ifdef LIGHTMAP\n#if LIGHTMAPDIRECTUV == 1\n#define vLightmapUV vMainUV1\n#elif LIGHTMAPDIRECTUV == 2\n#define vLightmapUV vMainUV2\n#else\nvarying vec2 vLightmapUV;\n#endif\nuniform sampler2D lightmapSampler;\n#endif\n#ifdef REFRACTION\n#ifdef REFRACTIONMAP_3D\nuniform samplerCube refractionCubeSampler;\n#else\nuniform sampler2D refraction2DSampler;\n#endif\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\n#if SPECULARDIRECTUV == 1\n#define vSpecularUV vMainUV1\n#elif SPECULARDIRECTUV == 2\n#define vSpecularUV vMainUV2\n#else\nvarying vec2 vSpecularUV;\n#endif\nuniform sampler2D specularSampler;\n#endif\n#ifdef ALPHATEST\nuniform float alphaCutOff;\n#endif\n\n#include<fresnelFunction>\n\n#ifdef REFLECTION\n#ifdef REFLECTIONMAP_3D\nuniform samplerCube reflectionCubeSampler;\n#else\nuniform sampler2D reflection2DSampler;\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#endif\n#include<reflectionFunction>\n#endif\n#include<imageProcessingDeclaration>\n#include<imageProcessingFunctions>\n#include<bumpFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n\nfloat alpha=vDiffuseColor.a;\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=normalize(-cross(dFdx(vPositionW),dFdy(vPositionW)));\n#endif\n#include<bumpFragment>\n#ifdef TWOSIDEDLIGHTING\nnormalW=gl_FrontFacing ? normalW : -normalW;\n#endif\n#ifdef DIFFUSE\nbaseColor=texture2D(diffuseSampler,vDiffuseUV+uvOffset);\n#ifdef ALPHATEST\nif (baseColor.a<alphaCutOff)\ndiscard;\n#endif\n#ifdef ALPHAFROMDIFFUSE\nalpha*=baseColor.a;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_ALPHA\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#include<depthPrePass>\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_DIFFUSE\n\nvec3 baseAmbientColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nbaseAmbientColor=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb*vAmbientInfos.y;\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_LIGHTS\n\n#ifdef SPECULARTERM\nfloat glossiness=vSpecularColor.a;\nvec3 specularColor=vSpecularColor.rgb;\n#ifdef SPECULAR\nvec4 specularMapColor=texture2D(specularSampler,vSpecularUV+uvOffset);\nspecularColor=specularMapColor.rgb;\n#ifdef GLOSSINESS\nglossiness=glossiness*specularMapColor.a;\n#endif\n#endif\n#else\nfloat glossiness=0.;\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\nfloat shadow=1.;\n#ifdef LIGHTMAP\nvec3 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset).rgb*vLightmapInfos.y;\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\n\nvec3 refractionColor=vec3(0.,0.,0.);\n#ifdef REFRACTION\nvec3 refractionVector=normalize(refract(-viewDirectionW,normalW,vRefractionInfos.y));\n#ifdef REFRACTIONMAP_3D\nrefractionVector.y=refractionVector.y*vRefractionInfos.w;\nif (dot(refractionVector,viewDirectionW)<1.0) {\nrefractionColor=textureCube(refractionCubeSampler,refractionVector).rgb;\n}\n#else\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));\nvec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;\nrefractionCoords.y=1.0-refractionCoords.y;\nrefractionColor=texture2D(refraction2DSampler,refractionCoords).rgb;\n#endif\n#ifdef IS_REFRACTION_LINEAR\nrefractionColor=toGammaSpace(refractionColor);\n#endif\nrefractionColor*=vRefractionInfos.x;\n#endif\n\nvec3 reflectionColor=vec3(0.,0.,0.);\n#ifdef REFLECTION\nvec3 vReflectionUVW=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#ifdef REFLECTIONMAP_3D\n#ifdef ROUGHNESS\nfloat bias=vReflectionInfos.y;\n#ifdef SPECULARTERM\n#ifdef SPECULAR\n#ifdef GLOSSINESS\nbias*=(1.0-specularMapColor.a);\n#endif\n#endif\n#endif\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW,bias).rgb;\n#else\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW).rgb;\n#endif\n#else\nvec2 coords=vReflectionUVW.xy;\n#ifdef REFLECTIONMAP_PROJECTION\ncoords/=vReflectionUVW.z;\n#endif\ncoords.y=1.0-coords.y;\nreflectionColor=texture2D(reflection2DSampler,coords).rgb;\n#endif\n#ifdef IS_REFLECTION_LINEAR\nreflectionColor=toGammaSpace(reflectionColor);\n#endif\nreflectionColor*=vReflectionInfos.x;\n#ifdef REFLECTIONFRESNEL\nfloat reflectionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,reflectionRightColor.a,reflectionLeftColor.a);\n#ifdef REFLECTIONFRESNELFROMSPECULAR\n#ifdef SPECULARTERM\nreflectionColor*=specularColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#else\nreflectionColor*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#else\nreflectionColor*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#endif\n#endif\n#ifdef REFRACTIONFRESNEL\nfloat refractionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,refractionRightColor.a,refractionLeftColor.a);\nrefractionColor*=refractionLeftColor.rgb*(1.0-refractionFresnelTerm)+refractionFresnelTerm*refractionRightColor.rgb;\n#endif\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);\n#ifdef OPACITYRGB\nopacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);\nalpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y;\n#else\nalpha*=opacityMap.a*vOpacityInfos.y;\n#endif\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#ifdef OPACITYFRESNEL\nfloat opacityFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,opacityParts.z,opacityParts.w);\nalpha+=opacityParts.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*opacityParts.y;\n#endif\n\nvec3 emissiveColor=vEmissiveColor;\n#ifdef EMISSIVE\nemissiveColor+=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb*vEmissiveInfos.y;\n#endif\n#ifdef EMISSIVEFRESNEL\nfloat emissiveFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,emissiveRightColor.a,emissiveLeftColor.a);\nemissiveColor*=emissiveLeftColor.rgb*(1.0-emissiveFresnelTerm)+emissiveFresnelTerm*emissiveRightColor.rgb;\n#endif\n\n#ifdef DIFFUSEFRESNEL\nfloat diffuseFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,diffuseRightColor.a,diffuseLeftColor.a);\ndiffuseBase*=diffuseLeftColor.rgb*(1.0-diffuseFresnelTerm)+diffuseFresnelTerm*diffuseRightColor.rgb;\n#endif\n\n#ifdef EMISSIVEASILLUMINATION\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\n#ifdef LINKEMISSIVEWITHDIFFUSE\nvec3 finalDiffuse=clamp((diffuseBase+emissiveColor)*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+emissiveColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#endif\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#ifdef SPECULAROVERALPHA\nalpha=clamp(alpha+dot(finalSpecular,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\n#ifdef REFLECTIONOVERALPHA\nalpha=clamp(alpha+dot(reflectionColor,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n\n#ifdef EMISSIVEASILLUMINATION\nvec4 color=vec4(clamp(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor+emissiveColor+refractionColor,0.0,1.0),alpha);\n#else\nvec4 color=vec4(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor+refractionColor,alpha);\n#endif\n\n#ifdef LIGHTMAP\n#ifndef LIGHTMAPEXCLUDED\n#ifdef USELIGHTMAPASSHADOWMAP\ncolor.rgb*=lightmapColor;\n#else\ncolor.rgb+=lightmapColor;\n#endif\n#endif\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_FOG\ncolor.rgb=max(color.rgb,0.);\n#include<logDepthFragment>\n#include<fogFragment>\n\n\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ncolor.rgb=toLinearSpace(color.rgb);\n#else\n#ifdef IMAGEPROCESSING\ncolor.rgb=toLinearSpace(color.rgb);\ncolor=applyImageProcessing(color);\n#endif\n#endif\ncolor.a*=visibility;\n#ifdef PREMULTIPLYALPHA\n\ncolor.rgb*=color.a;\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR\ngl_FragColor=color;\n}\n",ce.a.IncludesShadersStore.defaultVertexDeclaration="\nuniform mat4 viewProjection;\nuniform mat4 view;\n#ifdef DIFFUSE\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nuniform mat4 ambientMatrix;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\nuniform mat4 lightmapMatrix;\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nuniform vec2 vSpecularInfos;\nuniform mat4 specularMatrix;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform mat4 bumpMatrix;\n#endif\n#ifdef REFLECTION\nuniform mat4 reflectionMatrix;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n",N(74),N(77),N(147),N(108),N(123),N(88),N(89),N(94),N(78),N(75),N(141),N(102),N(142),N(124),ce.a.IncludesShadersStore.pointCloudVertex="#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif",N(143),ce.a.ShadersStore.defaultVertexShader="#include<__decl__defaultVertex>\n\n#define CUSTOM_VERTEX_BEGIN\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef TANGENT\nattribute vec4 tangent;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<helperFunctions>\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif\n#ifdef MAINUV2\nvarying vec2 vMainUV2;\n#endif\n#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0\nvarying vec2 vDiffuseUV;\n#endif\n#if defined(AMBIENT) && AMBIENTDIRECTUV == 0\nvarying vec2 vAmbientUV;\n#endif\n#if defined(OPACITY) && OPACITYDIRECTUV == 0\nvarying vec2 vOpacityUV;\n#endif\n#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0\nvarying vec2 vEmissiveUV;\n#endif\n#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0\nvarying vec2 vLightmapUV;\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM) && SPECULARDIRECTUV == 0\nvarying vec2 vSpecularUV;\n#endif\n#if defined(BUMP) && BUMPDIRECTUV == 0\nvarying vec2 vBumpUV;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<bumpVertexDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#include<logDepthDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec3 positionUpdated=position;\n#ifdef NORMAL\nvec3 normalUpdated=normal;\n#endif\n#ifdef TANGENT\nvec4 tangentUpdated=tangent;\n#endif\n#ifdef UV1\nvec2 uvUpdated=uv;\n#endif\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvPositionUVW=positionUpdated;\n#endif\n#define CUSTOM_VERTEX_UPDATE_POSITION\n#define CUSTOM_VERTEX_UPDATE_NORMAL\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPos=finalWorld*vec4(positionUpdated,1.0);\n#ifdef MULTIVIEW\nif (gl_ViewID_OVR == 0u) {\ngl_Position=viewProjection*worldPos;\n} else {\ngl_Position=viewProjectionR*worldPos;\n}\n#else\ngl_Position=viewProjection*worldPos;\n#endif\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nmat3 normalWorld=mat3(finalWorld);\n#ifdef NONUNIFORMSCALING\nnormalWorld=transposeMat3(inverseMat3(normalWorld));\n#endif\nvNormalW=normalize(normalWorld*normalUpdated);\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvDirectionW=normalize(vec3(finalWorld*vec4(positionUpdated,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uvUpdated=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef MAINUV1\nvMainUV1=uvUpdated;\n#endif\n#ifdef MAINUV2\nvMainUV2=uv2;\n#endif\n#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0\nif (vDiffuseInfos.x == 0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(AMBIENT) && AMBIENTDIRECTUV == 0\nif (vAmbientInfos.x == 0.)\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(OPACITY) && OPACITYDIRECTUV == 0\nif (vOpacityInfos.x == 0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0\nif (vEmissiveInfos.x == 0.)\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0\nif (vLightmapInfos.x == 0.)\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM) && SPECULARDIRECTUV == 0\nif (vSpecularInfos.x == 0.)\n{\nvSpecularUV=vec2(specularMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvSpecularUV=vec2(specularMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(BUMP) && BUMPDIRECTUV == 0\nif (vBumpInfos.x == 0.)\n{\nvBumpUV=vec2(bumpMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#include<bumpVertex>\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n#ifdef VERTEXCOLOR\n\nvColor=color;\n#endif\n#include<pointCloudVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}\n";var he=N(2),fe=N(64);N.d(w,"b",(function(){return pe})),N.d(w,"a",(function(){return _e}));var pe=function(D){function t(){var w=D.call(this)||this;return w.MAINUV1=!1,w.MAINUV2=!1,w.DIFFUSE=!1,w.DIFFUSEDIRECTUV=0,w.AMBIENT=!1,w.AMBIENTDIRECTUV=0,w.OPACITY=!1,w.OPACITYDIRECTUV=0,w.OPACITYRGB=!1,w.REFLECTION=!1,w.EMISSIVE=!1,w.EMISSIVEDIRECTUV=0,w.SPECULAR=!1,w.SPECULARDIRECTUV=0,w.BUMP=!1,w.BUMPDIRECTUV=0,w.PARALLAX=!1,w.PARALLAXOCCLUSION=!1,w.SPECULAROVERALPHA=!1,w.CLIPPLANE=!1,w.CLIPPLANE2=!1,w.CLIPPLANE3=!1,w.CLIPPLANE4=!1,w.CLIPPLANE5=!1,w.CLIPPLANE6=!1,w.ALPHATEST=!1,w.DEPTHPREPASS=!1,w.ALPHAFROMDIFFUSE=!1,w.POINTSIZE=!1,w.FOG=!1,w.SPECULARTERM=!1,w.DIFFUSEFRESNEL=!1,w.OPACITYFRESNEL=!1,w.REFLECTIONFRESNEL=!1,w.REFRACTIONFRESNEL=!1,w.EMISSIVEFRESNEL=!1,w.FRESNEL=!1,w.NORMAL=!1,w.UV1=!1,w.UV2=!1,w.VERTEXCOLOR=!1,w.VERTEXALPHA=!1,w.NUM_BONE_INFLUENCERS=0,w.BonesPerMesh=0,w.BONETEXTURE=!1,w.INSTANCES=!1,w.GLOSSINESS=!1,w.ROUGHNESS=!1,w.EMISSIVEASILLUMINATION=!1,w.LINKEMISSIVEWITHDIFFUSE=!1,w.REFLECTIONFRESNELFROMSPECULAR=!1,w.LIGHTMAP=!1,w.LIGHTMAPDIRECTUV=0,w.OBJECTSPACE_NORMALMAP=!1,w.USELIGHTMAPASSHADOWMAP=!1,w.REFLECTIONMAP_3D=!1,w.REFLECTIONMAP_SPHERICAL=!1,w.REFLECTIONMAP_PLANAR=!1,w.REFLECTIONMAP_CUBIC=!1,w.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,w.REFLECTIONMAP_PROJECTION=!1,w.REFLECTIONMAP_SKYBOX=!1,w.REFLECTIONMAP_EXPLICIT=!1,w.REFLECTIONMAP_EQUIRECTANGULAR=!1,w.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,w.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,w.INVERTCUBICMAP=!1,w.LOGARITHMICDEPTH=!1,w.REFRACTION=!1,w.REFRACTIONMAP_3D=!1,w.REFLECTIONOVERALPHA=!1,w.TWOSIDEDLIGHTING=!1,w.SHADOWFLOAT=!1,w.MORPHTARGETS=!1,w.MORPHTARGETS_NORMAL=!1,w.MORPHTARGETS_TANGENT=!1,w.MORPHTARGETS_UV=!1,w.NUM_MORPH_INFLUENCERS=0,w.NONUNIFORMSCALING=!1,w.PREMULTIPLYALPHA=!1,w.IMAGEPROCESSING=!1,w.VIGNETTE=!1,w.VIGNETTEBLENDMODEMULTIPLY=!1,w.VIGNETTEBLENDMODEOPAQUE=!1,w.TONEMAPPING=!1,w.TONEMAPPING_ACES=!1,w.CONTRAST=!1,w.COLORCURVES=!1,w.COLORGRADING=!1,w.COLORGRADING3D=!1,w.SAMPLER3DGREENDEPTH=!1,w.SAMPLER3DBGRMAP=!1,w.IMAGEPROCESSINGPOSTPROCESS=!1,w.MULTIVIEW=!1,w.IS_REFLECTION_LINEAR=!1,w.IS_REFRACTION_LINEAR=!1,w.EXPOSURE=!1,w.rebuild(),w}return Object(F.d)(t,D),t.prototype.setReflectionMode=function(D){for(var w=0,N=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];w<N.length;w++){var F=N[w];this[F]=F===D}},t}(Z.a),_e=function(D){function t(w,N){var F=D.call(this,w,N)||this;return F._diffuseTexture=null,F._ambientTexture=null,F._opacityTexture=null,F._reflectionTexture=null,F._emissiveTexture=null,F._specularTexture=null,F._bumpTexture=null,F._lightmapTexture=null,F._refractionTexture=null,F.ambientColor=new H.a(0,0,0),F.diffuseColor=new H.a(1,1,1),F.specularColor=new H.a(1,1,1),F.emissiveColor=new H.a(0,0,0),F.specularPower=64,F._useAlphaFromDiffuseTexture=!1,F._useEmissiveAsIllumination=!1,F._linkEmissiveWithDiffuse=!1,F._useSpecularOverAlpha=!1,F._useReflectionOverAlpha=!1,F._disableLighting=!1,F._useObjectSpaceNormalMap=!1,F._useParallax=!1,F._useParallaxOcclusion=!1,F.parallaxScaleBias=.05,F._roughness=0,F.indexOfRefraction=.98,F.invertRefractionY=!0,F.alphaCutOff=.4,F._useLightmapAsShadowmap=!1,F._useReflectionFresnelFromSpecular=!1,F._useGlossinessFromSpecularMapAlpha=!1,F._maxSimultaneousLights=4,F._invertNormalMapX=!1,F._invertNormalMapY=!1,F._twoSidedLighting=!1,F._renderTargets=new j.a(16),F._worldViewProjectionMatrix=G.a.Zero(),F._globalAmbientColor=new H.a(0,0,0),F._rebuildInParallel=!1,F._attachImageProcessingConfiguration(null),F.getRenderTargetTextures=function(){return F._renderTargets.reset(),t.ReflectionTextureEnabled&&F._reflectionTexture&&F._reflectionTexture.isRenderTarget&&F._renderTargets.push(F._reflectionTexture),t.RefractionTextureEnabled&&F._refractionTexture&&F._refractionTexture.isRenderTarget&&F._renderTargets.push(F._refractionTexture),F._renderTargets},F}return Object(F.d)(t,D),Object.defineProperty(t.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(D){this._attachImageProcessingConfiguration(D),this._markAllSubMeshesAsTexturesDirty()},enumerable:!0,configurable:!0}),t.prototype._attachImageProcessingConfiguration=function(D){var w=this;D!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=D||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((function(){w._markAllSubMeshesAsImageProcessingDirty()}))))},Object.defineProperty(t.prototype,"cameraColorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(D){this.imageProcessingConfiguration.colorCurvesEnabled=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(D){this.imageProcessingConfiguration.colorGradingEnabled=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraToneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(D){this._imageProcessingConfiguration.toneMappingEnabled=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraExposure",{get:function(){return this._imageProcessingConfiguration.exposure},set:function(D){this._imageProcessingConfiguration.exposure=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraContrast",{get:function(){return this._imageProcessingConfiguration.contrast},set:function(D){this._imageProcessingConfiguration.contrast=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorGradingTexture",{get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(D){this._imageProcessingConfiguration.colorGradingTexture=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorCurves",{get:function(){return this._imageProcessingConfiguration.colorCurves},set:function(D){this._imageProcessingConfiguration.colorCurves=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasRenderTargetTextures",{get:function(){return!!(t.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||!!(t.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"StandardMaterial"},Object.defineProperty(t.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth},set:function(D){this._useLogarithmicDepth=D&&this.getScene().getEngine().getCaps().fragmentDepthSupported,this._markAllSubMeshesAsMiscDirty()},enumerable:!0,configurable:!0}),t.prototype.needAlphaBlending=function(){return this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled},t.prototype.needAlphaTesting=function(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha},t.prototype._shouldUseAlphaFromDiffuseTexture=function(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha&&this._useAlphaFromDiffuseTexture},t.prototype.getAlphaTestTexture=function(){return this._diffuseTexture},t.prototype.isReadyForSubMesh=function(D,w,N){if(void 0===N&&(N=!1),w.effect&&this.isFrozen&&w.effect._wasPreviouslyReady)return!0;w._materialDefines||(w._materialDefines=new pe);var F=this.getScene(),k=w._materialDefines;if(!this.checkReadyOnEveryCall&&w.effect&&k._renderId===F.getRenderId())return!0;var j=F.getEngine();if(k._needNormals=$.a.PrepareDefinesForLights(F,D,k,!0,this._maxSimultaneousLights,this._disableLighting),$.a.PrepareDefinesForMultiview(F,k),k._areTexturesDirty){if(k._needUVs=!1,k.MAINUV1=!1,k.MAINUV2=!1,F.texturesEnabled){if(this._diffuseTexture&&t.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;$.a.PrepareDefinesForMergedUV(this._diffuseTexture,k,"DIFFUSE")}else k.DIFFUSE=!1;if(this._ambientTexture&&t.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;$.a.PrepareDefinesForMergedUV(this._ambientTexture,k,"AMBIENT")}else k.AMBIENT=!1;if(this._opacityTexture&&t.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;$.a.PrepareDefinesForMergedUV(this._opacityTexture,k,"OPACITY"),k.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else k.OPACITY=!1;if(this._reflectionTexture&&t.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(k._needNormals=!0,k.REFLECTION=!0,k.ROUGHNESS=this._roughness>0,k.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,k.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===te.a.INVCUBIC_MODE,k.REFLECTIONMAP_3D=this._reflectionTexture.isCube,this._reflectionTexture.coordinatesMode){case te.a.EXPLICIT_MODE:k.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case te.a.PLANAR_MODE:k.setReflectionMode("REFLECTIONMAP_PLANAR");break;case te.a.PROJECTION_MODE:k.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case te.a.SKYBOX_MODE:k.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case te.a.SPHERICAL_MODE:k.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case te.a.EQUIRECTANGULAR_MODE:k.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case te.a.FIXED_EQUIRECTANGULAR_MODE:k.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case te.a.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:k.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case te.a.CUBIC_MODE:case te.a.INVCUBIC_MODE:default:k.setReflectionMode("REFLECTIONMAP_CUBIC")}k.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else k.REFLECTION=!1;if(this._emissiveTexture&&t.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;$.a.PrepareDefinesForMergedUV(this._emissiveTexture,k,"EMISSIVE")}else k.EMISSIVE=!1;if(this._lightmapTexture&&t.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;$.a.PrepareDefinesForMergedUV(this._lightmapTexture,k,"LIGHTMAP"),k.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap}else k.LIGHTMAP=!1;if(this._specularTexture&&t.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;$.a.PrepareDefinesForMergedUV(this._specularTexture,k,"SPECULAR"),k.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else k.SPECULAR=!1;if(F.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&t.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;$.a.PrepareDefinesForMergedUV(this._bumpTexture,k,"BUMP"),k.PARALLAX=this._useParallax,k.PARALLAXOCCLUSION=this._useParallaxOcclusion,k.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else k.BUMP=!1;if(this._refractionTexture&&t.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;k._needUVs=!0,k.REFRACTION=!0,k.REFRACTIONMAP_3D=this._refractionTexture.isCube}else k.REFRACTION=!1;k.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else k.DIFFUSE=!1,k.AMBIENT=!1,k.OPACITY=!1,k.REFLECTION=!1,k.EMISSIVE=!1,k.LIGHTMAP=!1,k.BUMP=!1,k.REFRACTION=!1;k.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),k.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,k.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,k.SPECULAROVERALPHA=this._useSpecularOverAlpha,k.PREMULTIPLYALPHA=this.alphaMode===he.a.ALPHA_PREMULTIPLIED||this.alphaMode===he.a.ALPHA_PREMULTIPLIED_PORTERDUFF}if(k._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(k),k.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,k.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}if(k._areFresnelDirty&&(t.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(k.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,k.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,k.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,k.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,k.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,k.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,k._needNormals=!0,k.FRESNEL=!0):k.FRESNEL=!1),$.a.PrepareDefinesForMisc(D,F,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(D),k),$.a.PrepareDefinesForAttributes(D,k,!0,!0,!0),$.a.PrepareDefinesForFrameBoundValues(F,j,k,N),k.isDirty){var z=k._areLightsDisposed;k.markAsProcessed();var G=new fe.a;k.REFLECTION&&G.addFallback(0,"REFLECTION"),k.SPECULAR&&G.addFallback(0,"SPECULAR"),k.BUMP&&G.addFallback(0,"BUMP"),k.PARALLAX&&G.addFallback(1,"PARALLAX"),k.PARALLAXOCCLUSION&&G.addFallback(0,"PARALLAXOCCLUSION"),k.SPECULAROVERALPHA&&G.addFallback(0,"SPECULAROVERALPHA"),k.FOG&&G.addFallback(1,"FOG"),k.POINTSIZE&&G.addFallback(0,"POINTSIZE"),k.LOGARITHMICDEPTH&&G.addFallback(0,"LOGARITHMICDEPTH"),$.a.HandleFallbacksForShadows(k,G,this._maxSimultaneousLights),k.SPECULARTERM&&G.addFallback(0,"SPECULARTERM"),k.DIFFUSEFRESNEL&&G.addFallback(1,"DIFFUSEFRESNEL"),k.OPACITYFRESNEL&&G.addFallback(2,"OPACITYFRESNEL"),k.REFLECTIONFRESNEL&&G.addFallback(3,"REFLECTIONFRESNEL"),k.EMISSIVEFRESNEL&&G.addFallback(4,"EMISSIVEFRESNEL"),k.FRESNEL&&G.addFallback(4,"FRESNEL"),k.MULTIVIEW&&G.addFallback(0,"MULTIVIEW");var H=[X.b.PositionKind];k.NORMAL&&H.push(X.b.NormalKind),k.UV1&&H.push(X.b.UVKind),k.UV2&&H.push(X.b.UV2Kind),k.VERTEXCOLOR&&H.push(X.b.ColorKind),$.a.PrepareAttributesForBones(H,D,k,G),$.a.PrepareAttributesForInstances(H,k),$.a.PrepareAttributesForMorphTargets(H,D,k);var Z="default",J=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth"],ie=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler"],oe=["Material","Scene"];q.a&&(q.a.PrepareUniforms(J,k),q.a.PrepareSamplers(ie,k)),$.a.PrepareUniformsAndSamplersList({uniformsNames:J,uniformBuffersNames:oe,samplers:ie,defines:k,maxSimultaneousLights:this._maxSimultaneousLights}),this.customShaderNameResolve&&(Z=this.customShaderNameResolve(Z,J,oe,ie,k));var ce=k.toString(),_e=w.effect,ve=F.getEngine().createEffect(Z,{attributes:H,uniformsNames:J,uniformBuffersNames:oe,samplers:ie,defines:ce,fallbacks:G,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:k.NUM_MORPH_INFLUENCERS}},j);if(ve)if(this.allowShaderHotSwapping&&_e&&!ve.isReady()){if(ve=_e,this._rebuildInParallel=!0,k.markAsUnprocessed(),z)return k._areLightsDisposed=!0,!1}else this._rebuildInParallel=!1,F.resetCachedMaterial(),w.setEffect(ve,k),this.buildUniformLayout()}return!(!w.effect||!w.effect.isReady()||(k._renderId=F.getRenderId(),w.effect._wasPreviouslyReady=!0,0))},t.prototype.buildUniformLayout=function(){var D=this._uniformBuffer;D.addUniform("diffuseLeftColor",4),D.addUniform("diffuseRightColor",4),D.addUniform("opacityParts",4),D.addUniform("reflectionLeftColor",4),D.addUniform("reflectionRightColor",4),D.addUniform("refractionLeftColor",4),D.addUniform("refractionRightColor",4),D.addUniform("emissiveLeftColor",4),D.addUniform("emissiveRightColor",4),D.addUniform("vDiffuseInfos",2),D.addUniform("vAmbientInfos",2),D.addUniform("vOpacityInfos",2),D.addUniform("vReflectionInfos",2),D.addUniform("vReflectionPosition",3),D.addUniform("vReflectionSize",3),D.addUniform("vEmissiveInfos",2),D.addUniform("vLightmapInfos",2),D.addUniform("vSpecularInfos",2),D.addUniform("vBumpInfos",3),D.addUniform("diffuseMatrix",16),D.addUniform("ambientMatrix",16),D.addUniform("opacityMatrix",16),D.addUniform("reflectionMatrix",16),D.addUniform("emissiveMatrix",16),D.addUniform("lightmapMatrix",16),D.addUniform("specularMatrix",16),D.addUniform("bumpMatrix",16),D.addUniform("vTangentSpaceParams",2),D.addUniform("pointSize",1),D.addUniform("refractionMatrix",16),D.addUniform("vRefractionInfos",4),D.addUniform("vSpecularColor",4),D.addUniform("vEmissiveColor",3),D.addUniform("visibility",1),D.addUniform("vDiffuseColor",4),D.create()},t.prototype.unbind=function(){if(this._activeEffect){var w=!1;this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&(this._activeEffect.setTexture("reflection2DSampler",null),w=!0),this._refractionTexture&&this._refractionTexture.isRenderTarget&&(this._activeEffect.setTexture("refraction2DSampler",null),w=!0),w&&this._markAllSubMeshesAsTexturesDirty()}D.prototype.unbind.call(this)},t.prototype.bindForSubMesh=function(D,w,N){var F=this.getScene(),k=N._materialDefines;if(k){var j=N.effect;if(j){this._activeEffect=j,k.INSTANCES||this.bindOnlyWorldMatrix(D),k.OBJECTSPACE_NORMALMAP&&(D.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));var G=this._mustRebind(F,j,w.visibility);$.a.BindBonesParameters(w,j);var X=this._uniformBuffer;if(G){if(X.bindToEffect(j,"Material"),this.bindViewProjection(j),!X.useUbo||!this.isFrozen||!X.isSync){if(t.FresnelEnabled&&k.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(X.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),X.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&X.updateColor4("opacityParts",new H.a(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(X.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),X.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(X.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),X.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(X.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),X.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),F.texturesEnabled){if(this._diffuseTexture&&t.DiffuseTextureEnabled&&(X.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),$.a.BindTextureMatrix(this._diffuseTexture,X,"diffuse"),this._diffuseTexture.hasAlpha&&j.setFloat("alphaCutOff",this.alphaCutOff)),this._ambientTexture&&t.AmbientTextureEnabled&&(X.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),$.a.BindTextureMatrix(this._ambientTexture,X,"ambient")),this._opacityTexture&&t.OpacityTextureEnabled&&(X.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),$.a.BindTextureMatrix(this._opacityTexture,X,"opacity")),this._reflectionTexture&&t.ReflectionTextureEnabled&&(X.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),X.updateMatrix("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize)){var q=this._reflectionTexture;X.updateVector3("vReflectionPosition",q.boundingBoxPosition),X.updateVector3("vReflectionSize",q.boundingBoxSize)}if(this._emissiveTexture&&t.EmissiveTextureEnabled&&(X.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),$.a.BindTextureMatrix(this._emissiveTexture,X,"emissive")),this._lightmapTexture&&t.LightmapTextureEnabled&&(X.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),$.a.BindTextureMatrix(this._lightmapTexture,X,"lightmap")),this._specularTexture&&t.SpecularTextureEnabled&&(X.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),$.a.BindTextureMatrix(this._specularTexture,X,"specular")),this._bumpTexture&&F.getEngine().getCaps().standardDerivatives&&t.BumpTextureEnabled&&(X.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),$.a.BindTextureMatrix(this._bumpTexture,X,"bump"),F._mirroredCameraPosition?X.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):X.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&t.RefractionTextureEnabled){var Z=1;this._refractionTexture.isCube||(X.updateMatrix("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(Z=this._refractionTexture.depth)),X.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,Z,this.invertRefractionY?-1:1)}}this.pointsCloud&&X.updateFloat("pointSize",this.pointSize),k.SPECULARTERM&&X.updateColor4("vSpecularColor",this.specularColor,this.specularPower),X.updateColor3("vEmissiveColor",t.EmissiveTextureEnabled?this.emissiveColor:H.a.BlackReadOnly),X.updateFloat("visibility",w.visibility),X.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha)}F.texturesEnabled&&(this._diffuseTexture&&t.DiffuseTextureEnabled&&j.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&t.AmbientTextureEnabled&&j.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&t.OpacityTextureEnabled&&j.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&t.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?j.setTexture("reflectionCubeSampler",this._reflectionTexture):j.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&t.EmissiveTextureEnabled&&j.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&t.LightmapTextureEnabled&&j.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&t.SpecularTextureEnabled&&j.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&F.getEngine().getCaps().standardDerivatives&&t.BumpTextureEnabled&&j.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&t.RefractionTextureEnabled)&&(Z=1,this._refractionTexture.isCube?j.setTexture("refractionCubeSampler",this._refractionTexture):j.setTexture("refraction2DSampler",this._refractionTexture)),$.a.BindClipPlane(j,F),F.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),$.a.BindEyePosition(j,F),j.setColor3("vAmbientColor",this._globalAmbientColor)}!G&&this.isFrozen||(F.lightsEnabled&&!this._disableLighting&&$.a.BindLights(F,w,j,k,this._maxSimultaneousLights,this._rebuildInParallel),(F.fogEnabled&&w.applyFog&&F.fogMode!==z.a.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture)&&this.bindView(j),$.a.BindFogParameters(F,w,j),k.NUM_MORPH_INFLUENCERS&&$.a.BindMorphTargetParameters(w,j),this.useLogarithmicDepth&&$.a.BindLogDepth(k,j,F),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)),X.update(),this._afterBind(w,this._activeEffect)}}},t.prototype.getAnimatables=function(){var D=[];return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&D.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&D.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&D.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&D.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&D.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&D.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&D.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&D.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&D.push(this._refractionTexture),D},t.prototype.getActiveTextures=function(){var w=D.prototype.getActiveTextures.call(this);return this._diffuseTexture&&w.push(this._diffuseTexture),this._ambientTexture&&w.push(this._ambientTexture),this._opacityTexture&&w.push(this._opacityTexture),this._reflectionTexture&&w.push(this._reflectionTexture),this._emissiveTexture&&w.push(this._emissiveTexture),this._specularTexture&&w.push(this._specularTexture),this._bumpTexture&&w.push(this._bumpTexture),this._lightmapTexture&&w.push(this._lightmapTexture),this._refractionTexture&&w.push(this._refractionTexture),w},t.prototype.hasTexture=function(w){return!!D.prototype.hasTexture.call(this,w)||this._diffuseTexture===w||this._ambientTexture===w||this._opacityTexture===w||this._reflectionTexture===w||this._emissiveTexture===w||this._specularTexture===w||this._bumpTexture===w||this._lightmapTexture===w||this._refractionTexture===w},t.prototype.dispose=function(w,N){N&&(this._diffuseTexture&&this._diffuseTexture.dispose(),this._ambientTexture&&this._ambientTexture.dispose(),this._opacityTexture&&this._opacityTexture.dispose(),this._reflectionTexture&&this._reflectionTexture.dispose(),this._emissiveTexture&&this._emissiveTexture.dispose(),this._specularTexture&&this._specularTexture.dispose(),this._bumpTexture&&this._bumpTexture.dispose(),this._lightmapTexture&&this._lightmapTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose()),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),D.prototype.dispose.call(this,w,N)},t.prototype.clone=function(D){var w=this,N=k.a.Clone((function(){return new t(D,w.getScene())}),this);return N.name=D,N.id=D,N},t.prototype.serialize=function(){return k.a.Serialize(this)},t.Parse=function(D,w,N){return k.a.Parse((function(){return new t(D.name,w)}),D,w,N)},Object.defineProperty(t,"DiffuseTextureEnabled",{get:function(){return oe.a.DiffuseTextureEnabled},set:function(D){oe.a.DiffuseTextureEnabled=D},enumerable:!0,configurable:!0}),Object.defineProperty(t,"AmbientTextureEnabled",{get:function(){return oe.a.AmbientTextureEnabled},set:function(D){oe.a.AmbientTextureEnabled=D},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OpacityTextureEnabled",{get:function(){return oe.a.OpacityTextureEnabled},set:function(D){oe.a.OpacityTextureEnabled=D},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ReflectionTextureEnabled",{get:function(){return oe.a.ReflectionTextureEnabled},set:function(D){oe.a.ReflectionTextureEnabled=D},enumerable:!0,configurable:!0}),Object.defineProperty(t,"EmissiveTextureEnabled",{get:function(){return oe.a.EmissiveTextureEnabled},set:function(D){oe.a.EmissiveTextureEnabled=D},enumerable:!0,configurable:!0}),Object.defineProperty(t,"SpecularTextureEnabled",{get:function(){return oe.a.SpecularTextureEnabled},set:function(D){oe.a.SpecularTextureEnabled=D},enumerable:!0,configurable:!0}),Object.defineProperty(t,"BumpTextureEnabled",{get:function(){return oe.a.BumpTextureEnabled},set:function(D){oe.a.BumpTextureEnabled=D},enumerable:!0,configurable:!0}),Object.defineProperty(t,"LightmapTextureEnabled",{get:function(){return oe.a.LightmapTextureEnabled},set:function(D){oe.a.LightmapTextureEnabled=D},enumerable:!0,configurable:!0}),Object.defineProperty(t,"RefractionTextureEnabled",{get:function(){return oe.a.RefractionTextureEnabled},set:function(D){oe.a.RefractionTextureEnabled=D},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ColorGradingTextureEnabled",{get:function(){return oe.a.ColorGradingTextureEnabled},set:function(D){oe.a.ColorGradingTextureEnabled=D},enumerable:!0,configurable:!0}),Object.defineProperty(t,"FresnelEnabled",{get:function(){return oe.a.FresnelEnabled},set:function(D){oe.a.FresnelEnabled=D},enumerable:!0,configurable:!0}),Object(F.c)([Object(k.m)("diffuseTexture")],t.prototype,"_diffuseTexture",void 0),Object(F.c)([Object(k.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],t.prototype,"diffuseTexture",void 0),Object(F.c)([Object(k.m)("ambientTexture")],t.prototype,"_ambientTexture",void 0),Object(F.c)([Object(k.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"ambientTexture",void 0),Object(F.c)([Object(k.m)("opacityTexture")],t.prototype,"_opacityTexture",void 0),Object(F.c)([Object(k.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],t.prototype,"opacityTexture",void 0),Object(F.c)([Object(k.m)("reflectionTexture")],t.prototype,"_reflectionTexture",void 0),Object(F.c)([Object(k.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionTexture",void 0),Object(F.c)([Object(k.m)("emissiveTexture")],t.prototype,"_emissiveTexture",void 0),Object(F.c)([Object(k.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"emissiveTexture",void 0),Object(F.c)([Object(k.m)("specularTexture")],t.prototype,"_specularTexture",void 0),Object(F.c)([Object(k.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"specularTexture",void 0),Object(F.c)([Object(k.m)("bumpTexture")],t.prototype,"_bumpTexture",void 0),Object(F.c)([Object(k.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"bumpTexture",void 0),Object(F.c)([Object(k.m)("lightmapTexture")],t.prototype,"_lightmapTexture",void 0),Object(F.c)([Object(k.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"lightmapTexture",void 0),Object(F.c)([Object(k.m)("refractionTexture")],t.prototype,"_refractionTexture",void 0),Object(F.c)([Object(k.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"refractionTexture",void 0),Object(F.c)([Object(k.e)("ambient")],t.prototype,"ambientColor",void 0),Object(F.c)([Object(k.e)("diffuse")],t.prototype,"diffuseColor",void 0),Object(F.c)([Object(k.e)("specular")],t.prototype,"specularColor",void 0),Object(F.c)([Object(k.e)("emissive")],t.prototype,"emissiveColor",void 0),Object(F.c)([Object(k.c)()],t.prototype,"specularPower",void 0),Object(F.c)([Object(k.c)("useAlphaFromDiffuseTexture")],t.prototype,"_useAlphaFromDiffuseTexture",void 0),Object(F.c)([Object(k.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useAlphaFromDiffuseTexture",void 0),Object(F.c)([Object(k.c)("useEmissiveAsIllumination")],t.prototype,"_useEmissiveAsIllumination",void 0),Object(F.c)([Object(k.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useEmissiveAsIllumination",void 0),Object(F.c)([Object(k.c)("linkEmissiveWithDiffuse")],t.prototype,"_linkEmissiveWithDiffuse",void 0),Object(F.c)([Object(k.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"linkEmissiveWithDiffuse",void 0),Object(F.c)([Object(k.c)("useSpecularOverAlpha")],t.prototype,"_useSpecularOverAlpha",void 0),Object(F.c)([Object(k.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useSpecularOverAlpha",void 0),Object(F.c)([Object(k.c)("useReflectionOverAlpha")],t.prototype,"_useReflectionOverAlpha",void 0),Object(F.c)([Object(k.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useReflectionOverAlpha",void 0),Object(F.c)([Object(k.c)("disableLighting")],t.prototype,"_disableLighting",void 0),Object(F.c)([Object(k.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"disableLighting",void 0),Object(F.c)([Object(k.c)("useObjectSpaceNormalMap")],t.prototype,"_useObjectSpaceNormalMap",void 0),Object(F.c)([Object(k.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useObjectSpaceNormalMap",void 0),Object(F.c)([Object(k.c)("useParallax")],t.prototype,"_useParallax",void 0),Object(F.c)([Object(k.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useParallax",void 0),Object(F.c)([Object(k.c)("useParallaxOcclusion")],t.prototype,"_useParallaxOcclusion",void 0),Object(F.c)([Object(k.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useParallaxOcclusion",void 0),Object(F.c)([Object(k.c)()],t.prototype,"parallaxScaleBias",void 0),Object(F.c)([Object(k.c)("roughness")],t.prototype,"_roughness",void 0),Object(F.c)([Object(k.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"roughness",void 0),Object(F.c)([Object(k.c)()],t.prototype,"indexOfRefraction",void 0),Object(F.c)([Object(k.c)()],t.prototype,"invertRefractionY",void 0),Object(F.c)([Object(k.c)()],t.prototype,"alphaCutOff",void 0),Object(F.c)([Object(k.c)("useLightmapAsShadowmap")],t.prototype,"_useLightmapAsShadowmap",void 0),Object(F.c)([Object(k.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useLightmapAsShadowmap",void 0),Object(F.c)([Object(k.h)("diffuseFresnelParameters")],t.prototype,"_diffuseFresnelParameters",void 0),Object(F.c)([Object(k.b)("_markAllSubMeshesAsFresnelDirty")],t.prototype,"diffuseFresnelParameters",void 0),Object(F.c)([Object(k.h)("opacityFresnelParameters")],t.prototype,"_opacityFresnelParameters",void 0),Object(F.c)([Object(k.b)("_markAllSubMeshesAsFresnelAndMiscDirty")],t.prototype,"opacityFresnelParameters",void 0),Object(F.c)([Object(k.h)("reflectionFresnelParameters")],t.prototype,"_reflectionFresnelParameters",void 0),Object(F.c)([Object(k.b)("_markAllSubMeshesAsFresnelDirty")],t.prototype,"reflectionFresnelParameters",void 0),Object(F.c)([Object(k.h)("refractionFresnelParameters")],t.prototype,"_refractionFresnelParameters",void 0),Object(F.c)([Object(k.b)("_markAllSubMeshesAsFresnelDirty")],t.prototype,"refractionFresnelParameters",void 0),Object(F.c)([Object(k.h)("emissiveFresnelParameters")],t.prototype,"_emissiveFresnelParameters",void 0),Object(F.c)([Object(k.b)("_markAllSubMeshesAsFresnelDirty")],t.prototype,"emissiveFresnelParameters",void 0),Object(F.c)([Object(k.c)("useReflectionFresnelFromSpecular")],t.prototype,"_useReflectionFresnelFromSpecular",void 0),Object(F.c)([Object(k.b)("_markAllSubMeshesAsFresnelDirty")],t.prototype,"useReflectionFresnelFromSpecular",void 0),Object(F.c)([Object(k.c)("useGlossinessFromSpecularMapAlpha")],t.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),Object(F.c)([Object(k.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useGlossinessFromSpecularMapAlpha",void 0),Object(F.c)([Object(k.c)("maxSimultaneousLights")],t.prototype,"_maxSimultaneousLights",void 0),Object(F.c)([Object(k.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"maxSimultaneousLights",void 0),Object(F.c)([Object(k.c)("invertNormalMapX")],t.prototype,"_invertNormalMapX",void 0),Object(F.c)([Object(k.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"invertNormalMapX",void 0),Object(F.c)([Object(k.c)("invertNormalMapY")],t.prototype,"_invertNormalMapY",void 0),Object(F.c)([Object(k.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"invertNormalMapY",void 0),Object(F.c)([Object(k.c)("twoSidedLighting")],t.prototype,"_twoSidedLighting",void 0),Object(F.c)([Object(k.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"twoSidedLighting",void 0),Object(F.c)([Object(k.c)()],t.prototype,"useLogarithmicDepth",null),t}(J.a);ie.a.RegisteredTypes["BABYLON.StandardMaterial"]=_e,z.a.DefaultMaterialFactory=function(D){return new _e("default material",D)}},function(D,w,N){"use strict";N.d(w,"a",(function(){return k}));var F=N(36),r=function(D,w){return D?D.getClassName&&"Mesh"===D.getClassName()?null:D.getClassName&&"SubMesh"===D.getClassName()?D.clone(w):D.clone?D.clone():null:null},k=function(){function e(){}return e.DeepCopy=function(D,w,N,k){for(var j in D)if(("_"!==j[0]||k&&-1!==k.indexOf(j))&&!(F.a.EndsWith(j,"Observable")||N&&-1!==N.indexOf(j))){var z=D[j],G=typeof z;if("function"!==G)try{if("object"===G)if(z instanceof Array){if(w[j]=[],z.length>0)if("object"==typeof z[0])for(var H=0;H<z.length;H++){var X=r(z[H],w);-1===w[j].indexOf(X)&&w[j].push(X)}else w[j]=z.slice(0)}else w[j]=r(z,w);else w[j]=z}catch(D){}}},e}()},function(D,w,N){"use strict";N.d(w,"a",(function(){return k})),N.d(w,"b",(function(){return j}));var F=N(1),k=function(){function e(D){this.length=0,this.data=new Array(D),this._id=e._GlobalId++}return e.prototype.push=function(D){this.data[this.length++]=D,this.length>this.data.length&&(this.data.length*=2)},e.prototype.forEach=function(D){for(var w=0;w<this.length;w++)D(this.data[w])},e.prototype.sort=function(D){this.data.sort(D)},e.prototype.reset=function(){this.length=0},e.prototype.dispose=function(){this.reset(),this.data&&(this.data.length=0,this.data=[])},e.prototype.concat=function(D){if(0!==D.length){this.length+D.length>this.data.length&&(this.data.length=2*(this.length+D.length));for(var w=0;w<D.length;w++)this.data[this.length++]=(D.data||D)[w]}},e.prototype.indexOf=function(D){var w=this.data.indexOf(D);return w>=this.length?-1:w},e.prototype.contains=function(D){return-1!==this.indexOf(D)},e._GlobalId=0,e}(),j=function(D){function t(){var w=null!==D&&D.apply(this,arguments)||this;return w._duplicateId=0,w}return Object(F.d)(t,D),t.prototype.push=function(w){D.prototype.push.call(this,w),w.__smartArrayFlags||(w.__smartArrayFlags={}),w.__smartArrayFlags[this._id]=this._duplicateId},t.prototype.pushNoDuplicate=function(D){return!(D.__smartArrayFlags&&D.__smartArrayFlags[this._id]===this._duplicateId||(this.push(D),0))},t.prototype.reset=function(){D.prototype.reset.call(this),this._duplicateId++},t.prototype.concatWithNoDuplicate=function(D){if(0!==D.length){this.length+D.length>this.data.length&&(this.data.length=2*(this.length+D.length));for(var w=0;w<D.length;w++){var N=(D.data||D)[w];this.pushNoDuplicate(N)}}},t}(k)},function(D,w,N){"use strict";N.d(w,"a",(function(){return k}));var F=N(125),k=function(){function e(){}return e.EnableFor=function(D){D._tags=D._tags||{},D.hasTags=function(){return e.HasTags(D)},D.addTags=function(w){return e.AddTagsTo(D,w)},D.removeTags=function(w){return e.RemoveTagsFrom(D,w)},D.matchesTagsQuery=function(w){return e.MatchesQuery(D,w)}},e.DisableFor=function(D){delete D._tags,delete D.hasTags,delete D.addTags,delete D.removeTags,delete D.matchesTagsQuery},e.HasTags=function(D){if(!D._tags)return!1;var w=D._tags;for(var N in w)if(w.hasOwnProperty(N))return!0;return!1},e.GetTags=function(D,w){if(void 0===w&&(w=!0),!D._tags)return null;if(w){var N=[];for(var F in D._tags)D._tags.hasOwnProperty(F)&&!0===D._tags[F]&&N.push(F);return N.join(" ")}return D._tags},e.AddTagsTo=function(D,w){w&&"string"==typeof w&&w.split(" ").forEach((function(w,N,F){e._AddTagTo(D,w)}))},e._AddTagTo=function(D,w){""!==(w=w.trim())&&"true"!==w&&"false"!==w&&(w.match(/[\s]/)||w.match(/^([!]|([|]|[&]){2})/)||(e.EnableFor(D),D._tags[w]=!0))},e.RemoveTagsFrom=function(D,w){if(e.HasTags(D)){var N=w.split(" ");for(var F in N)e._RemoveTagFrom(D,N[F])}},e._RemoveTagFrom=function(D,w){delete D._tags[w]},e.MatchesQuery=function(D,w){return void 0===w||(""===w?e.HasTags(D):F.a.Eval(w,(function(w){return e.HasTags(D)&&D._tags[w]})))},e}()},function(D,w,N){"use strict";N.d(w,"a",(function(){return F}));var F=function(){function e(){}return e.EndsWith=function(D,w){return-1!==D.indexOf(w,D.length-w.length)},e.StartsWith=function(D,w){return 0===D.indexOf(w)},e.Decode=function(D){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(D);for(var w="",N=0;N<D.byteLength;N++)w+=String.fromCharCode(D[N]);return w},e.EncodeArrayBufferToBase64=function(D){for(var w,N,F,k,j,z,G,H="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",X="",q=0,Z=ArrayBuffer.isView(D)?new Uint8Array(D.buffer,D.byteOffset,D.byteLength):new Uint8Array(D);q<Z.length;)k=(w=Z[q++])>>2,j=(3&w)<<4|(N=q<Z.length?Z[q++]:Number.NaN)>>4,z=(15&N)<<2|(F=q<Z.length?Z[q++]:Number.NaN)>>6,G=63&F,isNaN(N)?z=G=64:isNaN(F)&&(G=64),X+=H.charAt(k)+H.charAt(j)+H.charAt(z)+H.charAt(G);return X},e}()},function(D,w,N){"use strict";N.d(w,"a",(function(){return F}));var F=function(){function e(){this.rootNodes=new Array,this.cameras=new Array,this.lights=new Array,this.meshes=new Array,this.skeletons=new Array,this.particleSystems=new Array,this.animations=[],this.animationGroups=new Array,this.multiMaterials=new Array,this.materials=new Array,this.morphTargetManagers=new Array,this.geometries=new Array,this.transformNodes=new Array,this.actionManagers=new Array,this.textures=new Array,this.environmentTexture=null}return e.AddParser=function(D,w){this._BabylonFileParsers[D]=w},e.GetParser=function(D){return this._BabylonFileParsers[D]?this._BabylonFileParsers[D]:null},e.AddIndividualParser=function(D,w){this._IndividualBabylonFileParsers[D]=w},e.GetIndividualParser=function(D){return this._IndividualBabylonFileParsers[D]?this._IndividualBabylonFileParsers[D]:null},e.Parse=function(D,w,N,F){for(var k in this._BabylonFileParsers)this._BabylonFileParsers.hasOwnProperty(k)&&this._BabylonFileParsers[k](D,w,N,F)},e.prototype.getNodes=function(){var D=new Array;return D=(D=(D=(D=D.concat(this.meshes)).concat(this.lights)).concat(this.cameras)).concat(this.transformNodes),this.skeletons.forEach((function(w){return D=D.concat(w.bones)})),D},e._BabylonFileParsers={},e._IndividualBabylonFileParsers={},e}()},function(D,w,N){"use strict";N.d(w,"a",(function(){return F}));var F=function(){function e(){}return e.IsWindowObjectExist=function(){return"undefined"!=typeof window},e.IsNavigatorAvailable=function(){return"undefined"!=typeof navigator},e.GetDOMTextContent=function(D){for(var w="",N=D.firstChild;N;)3===N.nodeType&&(w+=N.textContent),N=N.nextSibling;return w},e}()},function(D,w,N){"use strict";N.d(w,"a",(function(){return X}));var F=N(42),k=N(0),j=N(53),z=N(105),G=N(18),H=N(24),X=function(){function e(D,w,N){void 0===N&&(N=Number.MAX_VALUE),this.origin=D,this.direction=w,this.length=N}return e.prototype.intersectsBoxMinMax=function(D,w,N){void 0===N&&(N=0);var F,k,j,z,G=e.TmpVector3[0].copyFromFloats(D.x-N,D.y-N,D.z-N),H=e.TmpVector3[1].copyFromFloats(w.x+N,w.y+N,w.z+N),X=0,q=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<G.x||this.origin.x>H.x)return!1}else if(F=1/this.direction.x,k=(G.x-this.origin.x)*F,(j=(H.x-this.origin.x)*F)==-1/0&&(j=1/0),k>j&&(z=k,k=j,j=z),(X=Math.max(k,X))>(q=Math.min(j,q)))return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<G.y||this.origin.y>H.y)return!1}else if(F=1/this.direction.y,k=(G.y-this.origin.y)*F,(j=(H.y-this.origin.y)*F)==-1/0&&(j=1/0),k>j&&(z=k,k=j,j=z),(X=Math.max(k,X))>(q=Math.min(j,q)))return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<G.z||this.origin.z>H.z)return!1}else if(F=1/this.direction.z,k=(G.z-this.origin.z)*F,(j=(H.z-this.origin.z)*F)==-1/0&&(j=1/0),k>j&&(z=k,k=j,j=z),(X=Math.max(k,X))>(q=Math.min(j,q)))return!1;return!0},e.prototype.intersectsBox=function(D,w){return void 0===w&&(w=0),this.intersectsBoxMinMax(D.minimum,D.maximum,w)},e.prototype.intersectsSphere=function(D,w){void 0===w&&(w=0);var N=D.center.x-this.origin.x,F=D.center.y-this.origin.y,k=D.center.z-this.origin.z,j=N*N+F*F+k*k,z=D.radius+w,G=z*z;if(j<=G)return!0;var H=N*this.direction.x+F*this.direction.y+k*this.direction.z;return!(H<0)&&j-H*H<=G},e.prototype.intersectsTriangle=function(D,w,N){var F=e.TmpVector3[0],j=e.TmpVector3[1],G=e.TmpVector3[2],H=e.TmpVector3[3],X=e.TmpVector3[4];w.subtractToRef(D,F),N.subtractToRef(D,j),k.e.CrossToRef(this.direction,j,G);var q=k.e.Dot(F,G);if(0===q)return null;var Z=1/q;this.origin.subtractToRef(D,H);var J=k.e.Dot(H,G)*Z;if(J<0||J>1)return null;k.e.CrossToRef(H,F,X);var $=k.e.Dot(this.direction,X)*Z;if($<0||J+$>1)return null;var te=k.e.Dot(j,X)*Z;return te>this.length?null:new z.a(1-J-$,J,te)},e.prototype.intersectsPlane=function(D){var w,N=k.e.Dot(D.normal,this.direction);if(Math.abs(N)<9.99999997475243e-7)return null;var F=k.e.Dot(D.normal,this.origin);return(w=(-D.d-F)/N)<0?w<-9.99999997475243e-7?null:0:w},e.prototype.intersectsAxis=function(D,w){switch(void 0===w&&(w=0),D){case"y":return(N=(this.origin.y-w)/this.direction.y)>0?null:new k.e(this.origin.x+this.direction.x*-N,w,this.origin.z+this.direction.z*-N);case"x":return(N=(this.origin.x-w)/this.direction.x)>0?null:new k.e(w,this.origin.y+this.direction.y*-N,this.origin.z+this.direction.z*-N);case"z":var N;return(N=(this.origin.z-w)/this.direction.z)>0?null:new k.e(this.origin.x+this.direction.x*-N,this.origin.y+this.direction.y*-N,w);default:return null}},e.prototype.intersectsMesh=function(D,w){var N=k.c.Matrix[0];return D.getWorldMatrix().invertToRef(N),this._tmpRay?e.TransformToRef(this,N,this._tmpRay):this._tmpRay=e.Transform(this,N),D.intersects(this._tmpRay,w)},e.prototype.intersectsMeshes=function(D,w,N){N?N.length=0:N=[];for(var F=0;F<D.length;F++){var k=this.intersectsMesh(D[F],w);k.hit&&N.push(k)}return N.sort(this._comparePickingInfo),N},e.prototype._comparePickingInfo=function(D,w){return D.distance<w.distance?-1:D.distance>w.distance?1:0},e.prototype.intersectionSegment=function(D,w,N){var F=this.origin,j=k.c.Vector3[0],z=k.c.Vector3[1],G=k.c.Vector3[2],H=k.c.Vector3[3];w.subtractToRef(D,j),this.direction.scaleToRef(e.rayl,G),F.addToRef(G,z),D.subtractToRef(F,H);var X,q,Z,J,$=k.e.Dot(j,j),te=k.e.Dot(j,G),ie=k.e.Dot(G,G),oe=k.e.Dot(j,H),ce=k.e.Dot(G,H),he=$*ie-te*te,fe=he,pe=he;he<e.smallnum?(q=0,fe=1,J=ce,pe=ie):(J=$*ce-te*oe,(q=te*ce-ie*oe)<0?(q=0,J=ce,pe=ie):q>fe&&(q=fe,J=ce+te,pe=ie)),J<0?(J=0,-oe<0?q=0:-oe>$?q=fe:(q=-oe,fe=$)):J>pe&&(J=pe,-oe+te<0?q=0:-oe+te>$?q=fe:(q=-oe+te,fe=$)),X=Math.abs(q)<e.smallnum?0:q/fe,Z=Math.abs(J)<e.smallnum?0:J/pe;var _e=k.c.Vector3[4];G.scaleToRef(Z,_e);var ve=k.c.Vector3[5];j.scaleToRef(X,ve),ve.addInPlace(H);var ye=k.c.Vector3[6];return ve.subtractToRef(_e,ye),Z>0&&Z<=this.length&&ye.lengthSquared()<N*N?ve.length():-1},e.prototype.update=function(D,w,N,F,k,j,z){return this.unprojectRayToRef(D,w,N,F,k,j,z),this},e.Zero=function(){return new e(k.e.Zero(),k.e.Zero())},e.CreateNew=function(D,w,N,F,k,j,z){return e.Zero().update(D,w,N,F,k,j,z)},e.CreateNewFromTo=function(D,w,N){void 0===N&&(N=k.a.IdentityReadOnly);var F=w.subtract(D),j=Math.sqrt(F.x*F.x+F.y*F.y+F.z*F.z);return F.normalize(),e.Transform(new e(D,F,j),N)},e.Transform=function(D,w){var N=new e(new k.e(0,0,0),new k.e(0,0,0));return e.TransformToRef(D,w,N),N},e.TransformToRef=function(D,w,N){k.e.TransformCoordinatesToRef(D.origin,w,N.origin),k.e.TransformNormalToRef(D.direction,w,N.direction),N.length=D.length;var F=N.direction,j=F.length();if(0!==j&&1!==j){var z=1/j;F.x*=z,F.y*=z,F.z*=z,N.length*=j}},e.prototype.unprojectRayToRef=function(D,w,N,F,j,z,G){var H=k.c.Matrix[0];j.multiplyToRef(z,H),H.multiplyToRef(G,H),H.invert();var X=k.c.Vector3[0];X.x=D/N*2-1,X.y=-(w/F*2-1),X.z=-1;var q=k.c.Vector3[1].copyFromFloats(X.x,X.y,1),Z=k.c.Vector3[2],J=k.c.Vector3[3];k.e._UnprojectFromInvertedMatrixToRef(X,H,Z),k.e._UnprojectFromInvertedMatrixToRef(q,H,J),this.origin.copyFrom(Z),J.subtractToRef(Z,this.direction),this.direction.normalize()},e.TmpVector3=F.a.BuildArray(6,k.e.Zero),e.smallnum=1e-8,e.rayl=1e9,e}();G.a.prototype.createPickingRay=function(D,w,N,F,k){void 0===k&&(k=!1);var j=X.Zero();return this.createPickingRayToRef(D,w,N,j,F,k),j},G.a.prototype.createPickingRayToRef=function(D,w,N,F,j,z){void 0===z&&(z=!1);var G=this.getEngine();if(!j){if(!this.activeCamera)return this;j=this.activeCamera}var H=j.viewport.toGlobal(G.getRenderWidth(),G.getRenderHeight());return D=D/G.getHardwareScalingLevel()-H.x,w=w/G.getHardwareScalingLevel()-(G.getRenderHeight()-H.y-H.height),F.update(D,w,H.width,H.height,N||k.a.IdentityReadOnly,z?k.a.IdentityReadOnly:j.getViewMatrix(),j.getProjectionMatrix()),this},G.a.prototype.createPickingRayInCameraSpace=function(D,w,N){var F=X.Zero();return this.createPickingRayInCameraSpaceToRef(D,w,F,N),F},G.a.prototype.createPickingRayInCameraSpaceToRef=function(D,w,N,F){if(!j.a)return this;var z=this.getEngine();if(!F){if(!this.activeCamera)throw new Error("Active camera not set");F=this.activeCamera}var G=F.viewport.toGlobal(z.getRenderWidth(),z.getRenderHeight()),H=k.a.Identity();return D=D/z.getHardwareScalingLevel()-G.x,w=w/z.getHardwareScalingLevel()-(z.getRenderHeight()-G.y-G.height),N.update(D,w,G.width,G.height,H,H,F.getProjectionMatrix()),this},G.a.prototype._internalPick=function(D,w,N,F){if(!j.a)return null;for(var k=null,z=0;z<this.meshes.length;z++){var G=this.meshes[z];if(w){if(!w(G))continue}else if(!G.isEnabled()||!G.isVisible||!G.isPickable)continue;var H=D(G.getWorldMatrix()),X=G.intersects(H,N,F);if(X&&X.hit&&(N||null==k||!(X.distance>=k.distance))&&(k=X,N))break}return k||new j.a},G.a.prototype._internalMultiPick=function(D,w,N){if(!j.a)return null;for(var F=new Array,k=0;k<this.meshes.length;k++){var z=this.meshes[k];if(w){if(!w(z))continue}else if(!z.isEnabled()||!z.isVisible||!z.isPickable)continue;var G=D(z.getWorldMatrix()),H=z.intersects(G,!1,N);H&&H.hit&&F.push(H)}return F},G.a.prototype.pick=function(D,w,N,F,z,G){var H=this;if(!j.a)return null;var q=this._internalPick((function(N){return H._tempPickingRay||(H._tempPickingRay=X.Zero()),H.createPickingRayToRef(D,w,N,H._tempPickingRay,z||null),H._tempPickingRay}),N,F,G);return q&&(q.ray=this.createPickingRay(D,w,k.a.Identity(),z||null)),q},G.a.prototype.pickWithRay=function(D,w,N,F){var j=this,z=this._internalPick((function(w){return j._pickWithRayInverseMatrix||(j._pickWithRayInverseMatrix=k.a.Identity()),w.invertToRef(j._pickWithRayInverseMatrix),j._cachedRayForTransform||(j._cachedRayForTransform=X.Zero()),X.TransformToRef(D,j._pickWithRayInverseMatrix,j._cachedRayForTransform),j._cachedRayForTransform}),w,N,F);return z&&(z.ray=D),z},G.a.prototype.multiPick=function(D,w,N,F,k){var j=this;return this._internalMultiPick((function(N){return j.createPickingRay(D,w,N,F||null)}),N,k)},G.a.prototype.multiPickWithRay=function(D,w,N){var F=this;return this._internalMultiPick((function(w){return F._pickWithRayInverseMatrix||(F._pickWithRayInverseMatrix=k.a.Identity()),w.invertToRef(F._pickWithRayInverseMatrix),F._cachedRayForTransform||(F._cachedRayForTransform=X.Zero()),X.TransformToRef(D,F._pickWithRayInverseMatrix,F._cachedRayForTransform),F._cachedRayForTransform}),w,N)},H.a.prototype.getForwardRay=function(D,w,N){void 0===D&&(D=100),w||(w=this.getWorldMatrix()),N||(N=this.position);var F=this._scene.useRightHandedSystem?new k.e(0,0,-1):new k.e(0,0,1),j=k.e.TransformNormal(F,w),z=k.e.Normalize(j);return new X(N,z,D)}},function(D,w,N){"use strict";N.d(w,"b",(function(){return q})),N.d(w,"a",(function(){return Z}));var F=N(1),k=N(3),j=N(6),z=N(13),G=N(10),H=N(73),X=N(111),q=function(D){function t(){var w=D.call(this)||this;return w.IMAGEPROCESSING=!1,w.VIGNETTE=!1,w.VIGNETTEBLENDMODEMULTIPLY=!1,w.VIGNETTEBLENDMODEOPAQUE=!1,w.TONEMAPPING=!1,w.TONEMAPPING_ACES=!1,w.CONTRAST=!1,w.COLORCURVES=!1,w.COLORGRADING=!1,w.COLORGRADING3D=!1,w.SAMPLER3DGREENDEPTH=!1,w.SAMPLER3DBGRMAP=!1,w.IMAGEPROCESSINGPOSTPROCESS=!1,w.EXPOSURE=!1,w.rebuild(),w}return Object(F.d)(t,D),t}(H.a),Z=function(){function e(){this.colorCurves=new X.a,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=e.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCentreX=0,this.vignetteCentreY=0,this.vignetteWeight=1.5,this.vignetteColor=new G.b(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=e.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.onUpdateParameters=new j.c}return Object.defineProperty(e.prototype,"colorCurvesEnabled",{get:function(){return this._colorCurvesEnabled},set:function(D){this._colorCurvesEnabled!==D&&(this._colorCurvesEnabled=D,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"colorGradingTexture",{get:function(){return this._colorGradingTexture},set:function(D){this._colorGradingTexture!==D&&(this._colorGradingTexture=D,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"colorGradingEnabled",{get:function(){return this._colorGradingEnabled},set:function(D){this._colorGradingEnabled!==D&&(this._colorGradingEnabled=D,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"colorGradingWithGreenDepth",{get:function(){return this._colorGradingWithGreenDepth},set:function(D){this._colorGradingWithGreenDepth!==D&&(this._colorGradingWithGreenDepth=D,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"colorGradingBGR",{get:function(){return this._colorGradingBGR},set:function(D){this._colorGradingBGR!==D&&(this._colorGradingBGR=D,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"exposure",{get:function(){return this._exposure},set:function(D){this._exposure!==D&&(this._exposure=D,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"toneMappingEnabled",{get:function(){return this._toneMappingEnabled},set:function(D){this._toneMappingEnabled!==D&&(this._toneMappingEnabled=D,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"toneMappingType",{get:function(){return this._toneMappingType},set:function(D){this._toneMappingType!==D&&(this._toneMappingType=D,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contrast",{get:function(){return this._contrast},set:function(D){this._contrast!==D&&(this._contrast=D,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vignetteBlendMode",{get:function(){return this._vignetteBlendMode},set:function(D){this._vignetteBlendMode!==D&&(this._vignetteBlendMode=D,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vignetteEnabled",{get:function(){return this._vignetteEnabled},set:function(D){this._vignetteEnabled!==D&&(this._vignetteEnabled=D,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"applyByPostProcess",{get:function(){return this._applyByPostProcess},set:function(D){this._applyByPostProcess!==D&&(this._applyByPostProcess=D,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(D){this._isEnabled!==D&&(this._isEnabled=D,this._updateParameters())},enumerable:!0,configurable:!0}),e.prototype._updateParameters=function(){this.onUpdateParameters.notifyObservers(this)},e.prototype.getClassName=function(){return"ImageProcessingConfiguration"},e.PrepareUniforms=function(D,w){w.EXPOSURE&&D.push("exposureLinear"),w.CONTRAST&&D.push("contrast"),w.COLORGRADING&&D.push("colorTransformSettings"),w.VIGNETTE&&(D.push("vInverseScreenSize"),D.push("vignetteSettings1"),D.push("vignetteSettings2")),w.COLORCURVES&&X.a.PrepareUniforms(D)},e.PrepareSamplers=function(D,w){w.COLORGRADING&&D.push("txColorTransform")},e.prototype.prepareDefines=function(D,w){if(void 0===w&&(w=!1),w!==this.applyByPostProcess||!this._isEnabled)return D.VIGNETTE=!1,D.TONEMAPPING=!1,D.TONEMAPPING_ACES=!1,D.CONTRAST=!1,D.EXPOSURE=!1,D.COLORCURVES=!1,D.COLORGRADING=!1,D.COLORGRADING3D=!1,D.IMAGEPROCESSING=!1,void(D.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);switch(D.VIGNETTE=this.vignetteEnabled,D.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===e._VIGNETTEMODE_MULTIPLY,D.VIGNETTEBLENDMODEOPAQUE=!D.VIGNETTEBLENDMODEMULTIPLY,D.TONEMAPPING=this.toneMappingEnabled,this._toneMappingType){case e.TONEMAPPING_ACES:D.TONEMAPPING_ACES=!0;break;default:D.TONEMAPPING_ACES=!1}D.CONTRAST=1!==this.contrast,D.EXPOSURE=1!==this.exposure,D.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,D.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,D.COLORGRADING?D.COLORGRADING3D=this.colorGradingTexture.is3D:D.COLORGRADING3D=!1,D.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,D.SAMPLER3DBGRMAP=this.colorGradingBGR,D.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,D.IMAGEPROCESSING=D.VIGNETTE||D.TONEMAPPING||D.CONTRAST||D.EXPOSURE||D.COLORCURVES||D.COLORGRADING},e.prototype.isReady=function(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()},e.prototype.bind=function(D,w){if(this._colorCurvesEnabled&&this.colorCurves&&X.a.Bind(this.colorCurves,D),this._vignetteEnabled){var N=1/D.getEngine().getRenderWidth(),F=1/D.getEngine().getRenderHeight();D.setFloat2("vInverseScreenSize",N,F);var k=null!=w?w:F/N,j=Math.tan(.5*this.vignetteCameraFov),G=j*k,H=Math.sqrt(G*j);G=z.b.Mix(G,H,this.vignetteStretch),j=z.b.Mix(j,H,this.vignetteStretch),D.setFloat4("vignetteSettings1",G,j,-G*this.vignetteCentreX,-j*this.vignetteCentreY);var q=-2*this.vignetteWeight;D.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,q)}if(D.setFloat("exposureLinear",this.exposure),D.setFloat("contrast",this.contrast),this.colorGradingTexture){D.setTexture("txColorTransform",this.colorGradingTexture);var Z=this.colorGradingTexture.getSize().height;D.setFloat4("colorTransformSettings",(Z-1)/Z,.5/Z,Z,this.colorGradingTexture.level)}},e.prototype.clone=function(){return k.a.Clone((function(){return new e}),this)},e.prototype.serialize=function(){return k.a.Serialize(this)},e.Parse=function(D){return k.a.Parse((function(){return new e}),D,null,null)},Object.defineProperty(e,"VIGNETTEMODE_MULTIPLY",{get:function(){return this._VIGNETTEMODE_MULTIPLY},enumerable:!0,configurable:!0}),Object.defineProperty(e,"VIGNETTEMODE_OPAQUE",{get:function(){return this._VIGNETTEMODE_OPAQUE},enumerable:!0,configurable:!0}),e.TONEMAPPING_STANDARD=0,e.TONEMAPPING_ACES=1,e._VIGNETTEMODE_MULTIPLY=0,e._VIGNETTEMODE_OPAQUE=1,Object(F.c)([Object(k.g)()],e.prototype,"colorCurves",void 0),Object(F.c)([Object(k.c)()],e.prototype,"_colorCurvesEnabled",void 0),Object(F.c)([Object(k.m)("colorGradingTexture")],e.prototype,"_colorGradingTexture",void 0),Object(F.c)([Object(k.c)()],e.prototype,"_colorGradingEnabled",void 0),Object(F.c)([Object(k.c)()],e.prototype,"_colorGradingWithGreenDepth",void 0),Object(F.c)([Object(k.c)()],e.prototype,"_colorGradingBGR",void 0),Object(F.c)([Object(k.c)()],e.prototype,"_exposure",void 0),Object(F.c)([Object(k.c)()],e.prototype,"_toneMappingEnabled",void 0),Object(F.c)([Object(k.c)()],e.prototype,"_toneMappingType",void 0),Object(F.c)([Object(k.c)()],e.prototype,"_contrast",void 0),Object(F.c)([Object(k.c)()],e.prototype,"vignetteStretch",void 0),Object(F.c)([Object(k.c)()],e.prototype,"vignetteCentreX",void 0),Object(F.c)([Object(k.c)()],e.prototype,"vignetteCentreY",void 0),Object(F.c)([Object(k.c)()],e.prototype,"vignetteWeight",void 0),Object(F.c)([Object(k.f)()],e.prototype,"vignetteColor",void 0),Object(F.c)([Object(k.c)()],e.prototype,"vignetteCameraFov",void 0),Object(F.c)([Object(k.c)()],e.prototype,"_vignetteBlendMode",void 0),Object(F.c)([Object(k.c)()],e.prototype,"_vignetteEnabled",void 0),Object(F.c)([Object(k.c)()],e.prototype,"_applyByPostProcess",void 0),Object(F.c)([Object(k.c)()],e.prototype,"_isEnabled",void 0),e}();k.a._ImageProcessingConfigurationParser=Z.Parse},function(D,w,N){"use strict";N.d(w,"a",(function(){return q}));var F=N(18),k=N(6),j=N(20),z=N(23),G=N(80),H=N(0),X=N(10),q=function(){function e(D,w){var N=this;void 0===w&&(w=!0),this.originalScene=D,this._pointerCaptures={},this._lastPointerEvents={},this._sharedGizmoLight=null,this._renderCamera=null,this.pickUtilitySceneFirst=!0,this.shouldRender=!0,this.onlyCheckPointerDownEvents=!0,this.processAllEvents=!1,this.onPointerOutObservable=new k.c,this.utilityLayerScene=new F.a(D.getEngine(),{virtual:!0}),this.utilityLayerScene.useRightHandedSystem=D.useRightHandedSystem,this.utilityLayerScene._allowPostProcessClearColor=!1,this.utilityLayerScene.detachControl(),w&&(this._originalPointerObserver=D.onPrePointerObservable.add((function(w,F){if(N.utilityLayerScene.activeCamera&&(N.processAllEvents||w.type===j.a.POINTERMOVE||w.type===j.a.POINTERUP||w.type===j.a.POINTERDOWN)){N.utilityLayerScene.pointerX=D.pointerX,N.utilityLayerScene.pointerY=D.pointerY;var k=w.event;if(D.isPointerCaptured(k.pointerId))N._pointerCaptures[k.pointerId]=!1;else{var z=w.ray?N.utilityLayerScene.pickWithRay(w.ray):N.utilityLayerScene.pick(D.pointerX,D.pointerY);if(!w.ray&&z&&(w.ray=z.ray),N.utilityLayerScene.onPrePointerObservable.notifyObservers(w),N.onlyCheckPointerDownEvents&&w.type!=j.a.POINTERDOWN)return w.skipOnPointerObservable||N.utilityLayerScene.onPointerObservable.notifyObservers(new j.b(w.type,w.event,z)),void(w.type===j.a.POINTERUP&&N._pointerCaptures[k.pointerId]&&(N._pointerCaptures[k.pointerId]=!1));if(N.utilityLayerScene.autoClearDepthAndStencil||N.pickUtilitySceneFirst)z&&z.hit&&(w.skipOnPointerObservable||N.utilityLayerScene.onPointerObservable.notifyObservers(new j.b(w.type,w.event,z)),w.skipOnPointerObservable=!0);else{var G=w.ray?D.pickWithRay(w.ray):D.pick(D.pointerX,D.pointerY),H=w.event;G&&z&&(0===z.distance&&G.pickedMesh?N.mainSceneTrackerPredicate&&N.mainSceneTrackerPredicate(G.pickedMesh)?(N._notifyObservers(w,G,H),w.skipOnPointerObservable=!0):w.type===j.a.POINTERDOWN?N._pointerCaptures[H.pointerId]=!0:N._lastPointerEvents[H.pointerId]&&(N.onPointerOutObservable.notifyObservers(H.pointerId),delete N._lastPointerEvents[H.pointerId]):!N._pointerCaptures[H.pointerId]&&(z.distance<G.distance||0===G.distance)?(N._notifyObservers(w,z,H),w.skipOnPointerObservable||(w.skipOnPointerObservable=z.distance>0)):!N._pointerCaptures[H.pointerId]&&z.distance>G.distance&&(N.mainSceneTrackerPredicate&&N.mainSceneTrackerPredicate(G.pickedMesh)?(N._notifyObservers(w,G,H),w.skipOnPointerObservable=!0):N._lastPointerEvents[H.pointerId]&&(N.onPointerOutObservable.notifyObservers(H.pointerId),delete N._lastPointerEvents[H.pointerId])),w.type===j.a.POINTERUP&&N._pointerCaptures[H.pointerId]&&(N._pointerCaptures[H.pointerId]=!1))}}}})),this._originalPointerObserver&&D.onPrePointerObservable.makeObserverTopPriority(this._originalPointerObserver)),this.utilityLayerScene.autoClear=!1,this._afterRenderObserver=this.originalScene.onAfterCameraRenderObservable.add((function(D){N.shouldRender&&D==N.getRenderCamera()&&N.render()})),this._sceneDisposeObserver=this.originalScene.onDisposeObservable.add((function(){N.dispose()})),this._updateCamera()}return e.prototype.getRenderCamera=function(D){return this._renderCamera?this._renderCamera:(w=this.originalScene.activeCameras.length>1?this.originalScene.activeCameras[this.originalScene.activeCameras.length-1]:this.originalScene.activeCamera,D&&w&&w.isRigCamera?w.rigParent:w);var w},e.prototype.setRenderCamera=function(D){this._renderCamera=D},e.prototype._getSharedGizmoLight=function(){return this._sharedGizmoLight||(this._sharedGizmoLight=new G.a("shared gizmo light",new H.e(0,1,0),this.utilityLayerScene),this._sharedGizmoLight.intensity=2,this._sharedGizmoLight.groundColor=X.a.Gray()),this._sharedGizmoLight},Object.defineProperty(e,"DefaultUtilityLayer",{get:function(){return null==e._DefaultUtilityLayer&&(e._DefaultUtilityLayer=new e(z.a.LastCreatedScene),e._DefaultUtilityLayer.originalScene.onDisposeObservable.addOnce((function(){e._DefaultUtilityLayer=null}))),e._DefaultUtilityLayer},enumerable:!0,configurable:!0}),Object.defineProperty(e,"DefaultKeepDepthUtilityLayer",{get:function(){return null==e._DefaultKeepDepthUtilityLayer&&(e._DefaultKeepDepthUtilityLayer=new e(z.a.LastCreatedScene),e._DefaultKeepDepthUtilityLayer.utilityLayerScene.autoClearDepthAndStencil=!1,e._DefaultKeepDepthUtilityLayer.originalScene.onDisposeObservable.addOnce((function(){e._DefaultKeepDepthUtilityLayer=null}))),e._DefaultKeepDepthUtilityLayer},enumerable:!0,configurable:!0}),e.prototype._notifyObservers=function(D,w,N){D.skipOnPointerObservable||(this.utilityLayerScene.onPointerObservable.notifyObservers(new j.b(D.type,D.event,w)),this._lastPointerEvents[N.pointerId]=!0)},e.prototype.render=function(){if(this._updateCamera(),this.utilityLayerScene.activeCamera){var D=this.utilityLayerScene.activeCamera.getScene(),w=this.utilityLayerScene.activeCamera;w._scene=this.utilityLayerScene,w.leftCamera&&(w.leftCamera._scene=this.utilityLayerScene),w.rightCamera&&(w.rightCamera._scene=this.utilityLayerScene),this.utilityLayerScene.render(!1),w._scene=D,w.leftCamera&&(w.leftCamera._scene=D),w.rightCamera&&(w.rightCamera._scene=D)}},e.prototype.dispose=function(){this.onPointerOutObservable.clear(),this._afterRenderObserver&&this.originalScene.onAfterCameraRenderObservable.remove(this._afterRenderObserver),this._sceneDisposeObserver&&this.originalScene.onDisposeObservable.remove(this._sceneDisposeObserver),this._originalPointerObserver&&this.originalScene.onPrePointerObservable.remove(this._originalPointerObserver),this.utilityLayerScene.dispose()},e.prototype._updateCamera=function(){this.utilityLayerScene.cameraToUseForPointers=this.getRenderCamera(),this.utilityLayerScene.activeCamera=this.getRenderCamera()},e._DefaultUtilityLayer=null,e._DefaultKeepDepthUtilityLayer=null,e}()},function(D,w,N){"use strict";N.d(w,"a",(function(){return F}));var F=function(){function e(){}return e.BuildArray=function(D,w){for(var N=[],F=0;F<D;++F)N.push(w());return N},e}()},function(D,w,N){"use strict";N.d(w,"a",(function(){return X}));var F=N(1),k=N(3),j=N(6),z=N(0),G=N(26),H=N(22),X=function(D){function t(w,N,F){void 0===N&&(N=null),void 0===F&&(F=!0);var k=D.call(this,w,N)||this;return k._forward=new z.e(0,0,1),k._forwardInverted=new z.e(0,0,-1),k._up=new z.e(0,1,0),k._right=new z.e(1,0,0),k._rightInverted=new z.e(-1,0,0),k._position=z.e.Zero(),k._rotation=z.e.Zero(),k._rotationQuaternion=null,k._scaling=z.e.One(),k._isDirty=!1,k._transformToBoneReferal=null,k._isAbsoluteSynced=!1,k._billboardMode=t.BILLBOARDMODE_NONE,k._preserveParentRotationForBillboard=!1,k.scalingDeterminant=1,k._infiniteDistance=!1,k.ignoreNonUniformScaling=!1,k.reIntegrateRotationIntoRotationQuaternion=!1,k._poseMatrix=null,k._localMatrix=z.a.Zero(),k._usePivotMatrix=!1,k._absolutePosition=z.e.Zero(),k._absoluteScaling=z.e.Zero(),k._absoluteRotationQuaternion=z.b.Identity(),k._pivotMatrix=z.a.Identity(),k._postMultiplyPivotMatrix=!1,k._isWorldMatrixFrozen=!1,k._indexInSceneTransformNodesArray=-1,k.onAfterWorldMatrixUpdateObservable=new j.c,k._nonUniformScaling=!1,F&&k.getScene().addTransformNode(k),k}return Object(F.d)(t,D),Object.defineProperty(t.prototype,"billboardMode",{get:function(){return this._billboardMode},set:function(D){this._billboardMode!==D&&(this._billboardMode=D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"preserveParentRotationForBillboard",{get:function(){return this._preserveParentRotationForBillboard},set:function(D){D!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"infiniteDistance",{get:function(){return this._infiniteDistance},set:function(D){this._infiniteDistance!==D&&(this._infiniteDistance=D)},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"TransformNode"},Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(D){this._position=D,this._isDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotation",{get:function(){return this._rotation},set:function(D){this._rotation=D,this._rotationQuaternion=null,this._isDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaling",{get:function(){return this._scaling},set:function(D){this._scaling=D,this._isDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotationQuaternion",{get:function(){return this._rotationQuaternion},set:function(D){this._rotationQuaternion=D,D&&this._rotation.setAll(0),this._isDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"forward",{get:function(){return z.e.Normalize(z.e.TransformNormal(this.getScene().useRightHandedSystem?this._forwardInverted:this._forward,this.getWorldMatrix()))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"up",{get:function(){return z.e.Normalize(z.e.TransformNormal(this._up,this.getWorldMatrix()))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return z.e.Normalize(z.e.TransformNormal(this.getScene().useRightHandedSystem?this._rightInverted:this._right,this.getWorldMatrix()))},enumerable:!0,configurable:!0}),t.prototype.updatePoseMatrix=function(D){return this._poseMatrix?(this._poseMatrix.copyFrom(D),this):(this._poseMatrix=D.clone(),this)},t.prototype.getPoseMatrix=function(){return this._poseMatrix||(this._poseMatrix=z.a.Identity()),this._poseMatrix},t.prototype._isSynchronized=function(){var D=this._cache;if(this.billboardMode!==D.billboardMode||this.billboardMode!==t.BILLBOARDMODE_NONE)return!1;if(D.pivotMatrixUpdated)return!1;if(this.infiniteDistance)return!1;if(!D.position.equals(this._position))return!1;if(this._rotationQuaternion){if(!D.rotationQuaternion.equals(this._rotationQuaternion))return!1}else if(!D.rotation.equals(this._rotation))return!1;return!!D.scaling.equals(this._scaling)},t.prototype._initCache=function(){D.prototype._initCache.call(this);var w=this._cache;w.localMatrixUpdated=!1,w.position=z.e.Zero(),w.scaling=z.e.Zero(),w.rotation=z.e.Zero(),w.rotationQuaternion=new z.b(0,0,0,0),w.billboardMode=-1,w.infiniteDistance=!1},t.prototype.markAsDirty=function(D){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this},Object.defineProperty(t.prototype,"absolutePosition",{get:function(){return this._absolutePosition},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"absoluteScaling",{get:function(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"absoluteRotationQuaternion",{get:function(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion},enumerable:!0,configurable:!0}),t.prototype.setPreTransformMatrix=function(D){return this.setPivotMatrix(D,!1)},t.prototype.setPivotMatrix=function(D,w){return void 0===w&&(w=!0),this._pivotMatrix.copyFrom(D),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=w,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=z.a.Invert(this._pivotMatrix)),this},t.prototype.getPivotMatrix=function(){return this._pivotMatrix},t.prototype.instantiateHierarchy=function(D,w,N){void 0===D&&(D=null);var F=this.clone("Clone of "+(this.name||this.id),D||this.parent,!0);F&&N&&N(this,F);for(var k=0,j=this.getChildTransformNodes(!0);k<j.length;k++)j[k].instantiateHierarchy(F,w,N);return F},t.prototype.freezeWorldMatrix=function(D){return void 0===D&&(D=null),D?this._worldMatrix=D:(this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this},t.prototype.unfreezeWorldMatrix=function(){return this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this},Object.defineProperty(t.prototype,"isWorldMatrixFrozen",{get:function(){return this._isWorldMatrixFrozen},enumerable:!0,configurable:!0}),t.prototype.getAbsolutePosition=function(){return this.computeWorldMatrix(),this._absolutePosition},t.prototype.setAbsolutePosition=function(D){if(!D)return this;var w,N,F;if(void 0===D.x){if(arguments.length<3)return this;w=arguments[0],N=arguments[1],F=arguments[2]}else w=D.x,N=D.y,F=D.z;if(this.parent){var k=z.c.Matrix[0];this.parent.getWorldMatrix().invertToRef(k),z.e.TransformCoordinatesFromFloatsToRef(w,N,F,k,this.position)}else this.position.x=w,this.position.y=N,this.position.z=F;return this},t.prototype.setPositionWithLocalVector=function(D){return this.computeWorldMatrix(),this.position=z.e.TransformNormal(D,this._localMatrix),this},t.prototype.getPositionExpressedInLocalSpace=function(){this.computeWorldMatrix();var D=z.c.Matrix[0];return this._localMatrix.invertToRef(D),z.e.TransformNormal(this.position,D)},t.prototype.locallyTranslate=function(D){return this.computeWorldMatrix(!0),this.position=z.e.TransformCoordinates(D,this._localMatrix),this},t.prototype.lookAt=function(D,w,N,F,k){void 0===w&&(w=0),void 0===N&&(N=0),void 0===F&&(F=0),void 0===k&&(k=H.b.LOCAL);var j=t._lookAtVectorCache,G=k===H.b.LOCAL?this.position:this.getAbsolutePosition();if(D.subtractToRef(G,j),this.setDirection(j,w,N,F),k===H.b.WORLD&&this.parent)if(this.rotationQuaternion){var X=z.c.Matrix[0];this.rotationQuaternion.toRotationMatrix(X);var q=z.c.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(q),q.invert(),X.multiplyToRef(q,X),this.rotationQuaternion.fromRotationMatrix(X)}else{var Z=z.c.Quaternion[0];z.b.FromEulerVectorToRef(this.rotation,Z),X=z.c.Matrix[0],Z.toRotationMatrix(X),q=z.c.Matrix[1],this.parent.getWorldMatrix().getRotationMatrixToRef(q),q.invert(),X.multiplyToRef(q,X),Z.fromRotationMatrix(X),Z.toEulerAnglesToRef(this.rotation)}return this},t.prototype.getDirection=function(D){var w=z.e.Zero();return this.getDirectionToRef(D,w),w},t.prototype.getDirectionToRef=function(D,w){return z.e.TransformNormalToRef(D,this.getWorldMatrix(),w),this},t.prototype.setDirection=function(D,w,N,F){void 0===w&&(w=0),void 0===N&&(N=0),void 0===F&&(F=0);var k=-Math.atan2(D.z,D.x)+Math.PI/2,j=Math.sqrt(D.x*D.x+D.z*D.z),G=-Math.atan2(D.y,j);return this.rotationQuaternion?z.b.RotationYawPitchRollToRef(k+w,G+N,F,this.rotationQuaternion):(this.rotation.x=G+N,this.rotation.y=k+w,this.rotation.z=F),this},t.prototype.setPivotPoint=function(D,w){void 0===w&&(w=H.b.LOCAL),0==this.getScene().getRenderId()&&this.computeWorldMatrix(!0);var N=this.getWorldMatrix();if(w==H.b.WORLD){var F=z.c.Matrix[0];N.invertToRef(F),D=z.e.TransformCoordinates(D,F)}return this.setPivotMatrix(z.a.Translation(-D.x,-D.y,-D.z),!0)},t.prototype.getPivotPoint=function(){var D=z.e.Zero();return this.getPivotPointToRef(D),D},t.prototype.getPivotPointToRef=function(D){return D.x=-this._pivotMatrix.m[12],D.y=-this._pivotMatrix.m[13],D.z=-this._pivotMatrix.m[14],this},t.prototype.getAbsolutePivotPoint=function(){var D=z.e.Zero();return this.getAbsolutePivotPointToRef(D),D},t.prototype.getAbsolutePivotPointToRef=function(D){return D.x=this._pivotMatrix.m[12],D.y=this._pivotMatrix.m[13],D.z=this._pivotMatrix.m[14],this.getPivotPointToRef(D),z.e.TransformCoordinatesToRef(D,this.getWorldMatrix(),D),this},t.prototype.setParent=function(D){if(!D&&!this.parent)return this;var w=z.c.Quaternion[0],N=z.c.Vector3[0],F=z.c.Vector3[1];if(D){var k=z.c.Matrix[0],j=z.c.Matrix[1];this.computeWorldMatrix(!0),D.computeWorldMatrix(!0),D.getWorldMatrix().invertToRef(j),this.getWorldMatrix().multiplyToRef(j,k),k.decompose(F,w,N)}else this.computeWorldMatrix(!0),this.getWorldMatrix().decompose(F,w,N);return this.rotationQuaternion?this.rotationQuaternion.copyFrom(w):w.toEulerAnglesToRef(this.rotation),this.scaling.copyFrom(F),this.position.copyFrom(N),this.parent=D,this},Object.defineProperty(t.prototype,"nonUniformScaling",{get:function(){return this._nonUniformScaling},enumerable:!0,configurable:!0}),t.prototype._updateNonUniformScalingState=function(D){return this._nonUniformScaling!==D&&(this._nonUniformScaling=D,!0)},t.prototype.attachToBone=function(D,w){return this._transformToBoneReferal=w,this.parent=D,D.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this},t.prototype.detachFromBone=function(){return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=null,this):this},t.prototype.rotate=function(D,w,N){var F;if(D.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.setAll(0)),N&&N!==H.b.LOCAL){if(this.parent){var k=z.c.Matrix[0];this.parent.getWorldMatrix().invertToRef(k),D=z.e.TransformNormal(D,k)}(F=z.b.RotationAxisToRef(D,w,t._rotationAxisCache)).multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else F=z.b.RotationAxisToRef(D,w,t._rotationAxisCache),this.rotationQuaternion.multiplyToRef(F,this.rotationQuaternion);return this},t.prototype.rotateAround=function(D,w,N){w.normalize(),this.rotationQuaternion||(this.rotationQuaternion=z.b.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.setAll(0));var F=z.c.Vector3[0],k=z.c.Vector3[1],j=z.c.Vector3[2],G=z.c.Quaternion[0],H=z.c.Matrix[0],X=z.c.Matrix[1],q=z.c.Matrix[2],Z=z.c.Matrix[3];return D.subtractToRef(this.position,F),z.a.TranslationToRef(F.x,F.y,F.z,H),z.a.TranslationToRef(-F.x,-F.y,-F.z,X),z.a.RotationAxisToRef(w,N,q),X.multiplyToRef(q,Z),Z.multiplyToRef(H,Z),Z.decompose(k,G,j),this.position.addInPlace(j),G.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this},t.prototype.translate=function(D,w,N){var F=D.scale(w);if(N&&N!==H.b.LOCAL)this.setAbsolutePosition(this.getAbsolutePosition().add(F));else{var k=this.getPositionExpressedInLocalSpace().add(F);this.setPositionWithLocalVector(k)}return this},t.prototype.addRotation=function(D,w,N){var F;this.rotationQuaternion?F=this.rotationQuaternion:(F=z.c.Quaternion[1],z.b.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,F));var k=z.c.Quaternion[0];return z.b.RotationYawPitchRollToRef(w,D,N,k),F.multiplyInPlace(k),this.rotationQuaternion||F.toEulerAnglesToRef(this.rotation),this},t.prototype._getEffectiveParent=function(){return this.parent},t.prototype.computeWorldMatrix=function(D){if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;var w=this.getScene().getRenderId();if(!this._isDirty&&!D&&this.isSynchronized())return this._currentRenderId=w,this._worldMatrix;var N=this.getScene().activeCamera,F=0!=(this._billboardMode&t.BILLBOARDMODE_USE_POSITION),k=this._billboardMode!==t.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard;k&&N&&F&&(this.lookAt(N.position),(this.billboardMode&t.BILLBOARDMODE_X)!==t.BILLBOARDMODE_X&&(this.rotation.x=0),(this.billboardMode&t.BILLBOARDMODE_Y)!==t.BILLBOARDMODE_Y&&(this.rotation.y=0),(this.billboardMode&t.BILLBOARDMODE_Z)!==t.BILLBOARDMODE_Z&&(this.rotation.z=0)),this._updateCache();var j=this._cache;j.pivotMatrixUpdated=!1,j.billboardMode=this.billboardMode,j.infiniteDistance=this.infiniteDistance,this._currentRenderId=w,this._childUpdateId++,this._isDirty=!1;var G=this._getEffectiveParent(),H=j.scaling,X=j.position;if(this._infiniteDistance)if(!this.parent&&N){var q=N.getWorldMatrix(),Z=new z.e(q.m[12],q.m[13],q.m[14]);X.copyFromFloats(this._position.x+Z.x,this._position.y+Z.y,this._position.z+Z.z)}else X.copyFrom(this._position);else X.copyFrom(this._position);H.copyFromFloats(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant);var J=j.rotationQuaternion;if(this._rotationQuaternion?(this.reIntegrateRotationIntoRotationQuaternion&&this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(z.b.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.copyFromFloats(0,0,0)),J.copyFrom(this._rotationQuaternion)):(z.b.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,J),j.rotation.copyFrom(this._rotation)),this._usePivotMatrix){var $=z.c.Matrix[1];z.a.ScalingToRef(H.x,H.y,H.z,$);var te=z.c.Matrix[0];J.toRotationMatrix(te),this._pivotMatrix.multiplyToRef($,z.c.Matrix[4]),z.c.Matrix[4].multiplyToRef(te,this._localMatrix),this._postMultiplyPivotMatrix&&this._localMatrix.multiplyToRef(this._pivotMatrixInverse,this._localMatrix),this._localMatrix.addTranslationFromFloats(X.x,X.y,X.z)}else z.a.ComposeToRef(H,J,X,this._localMatrix);if(G&&G.getWorldMatrix){if(D&&G.computeWorldMatrix(),k){this._transformToBoneReferal?G.getWorldMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),z.c.Matrix[7]):z.c.Matrix[7].copyFrom(G.getWorldMatrix());var ie=z.c.Vector3[5],oe=z.c.Vector3[6];z.c.Matrix[7].decompose(oe,void 0,ie),z.a.ScalingToRef(oe.x,oe.y,oe.z,z.c.Matrix[7]),z.c.Matrix[7].setTranslation(ie),this._localMatrix.multiplyToRef(z.c.Matrix[7],this._worldMatrix)}else this._transformToBoneReferal?(this._localMatrix.multiplyToRef(G.getWorldMatrix(),z.c.Matrix[6]),z.c.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)):this._localMatrix.multiplyToRef(G.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.copyFrom(this._localMatrix);if(k&&N&&this.billboardMode&&!F){var ce=z.c.Vector3[0];if(this._worldMatrix.getTranslationToRef(ce),z.c.Matrix[1].copyFrom(N.getViewMatrix()),z.c.Matrix[1].setTranslationFromFloats(0,0,0),z.c.Matrix[1].invertToRef(z.c.Matrix[0]),(this.billboardMode&t.BILLBOARDMODE_ALL)!==t.BILLBOARDMODE_ALL){z.c.Matrix[0].decompose(void 0,z.c.Quaternion[0],void 0);var he=z.c.Vector3[1];z.c.Quaternion[0].toEulerAnglesToRef(he),(this.billboardMode&t.BILLBOARDMODE_X)!==t.BILLBOARDMODE_X&&(he.x=0),(this.billboardMode&t.BILLBOARDMODE_Y)!==t.BILLBOARDMODE_Y&&(he.y=0),(this.billboardMode&t.BILLBOARDMODE_Z)!==t.BILLBOARDMODE_Z&&(he.z=0),z.a.RotationYawPitchRollToRef(he.y,he.x,he.z,z.c.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(z.c.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(z.c.Vector3[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniform?this._updateNonUniformScalingState(!0):G&&G._nonUniformScaling?this._updateNonUniformScalingState(G._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=z.a.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix},t.prototype.resetLocalMatrix=function(D){if(void 0===D&&(D=!0),this.computeWorldMatrix(),D)for(var w=this.getChildren(),N=0;N<w.length;++N){var F=w[N];if(F){F.computeWorldMatrix();var k=z.c.Matrix[0];F._localMatrix.multiplyToRef(this._localMatrix,k);var j=z.c.Quaternion[0];k.decompose(F.scaling,j,F.position),F.rotationQuaternion?F.rotationQuaternion=j:j.toEulerAnglesToRef(F.rotation)}}this.scaling.copyFromFloats(1,1,1),this.position.copyFromFloats(0,0,0),this.rotation.copyFromFloats(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=z.b.Identity()),this._worldMatrix=z.a.Identity()},t.prototype._afterComputeWorldMatrix=function(){},t.prototype.registerAfterWorldMatrixUpdate=function(D){return this.onAfterWorldMatrixUpdateObservable.add(D),this},t.prototype.unregisterAfterWorldMatrixUpdate=function(D){return this.onAfterWorldMatrixUpdateObservable.removeCallback(D),this},t.prototype.getPositionInCameraSpace=function(D){return void 0===D&&(D=null),D||(D=this.getScene().activeCamera),z.e.TransformCoordinates(this.absolutePosition,D.getViewMatrix())},t.prototype.getDistanceToCamera=function(D){return void 0===D&&(D=null),D||(D=this.getScene().activeCamera),this.absolutePosition.subtract(D.globalPosition).length()},t.prototype.clone=function(D,w,N){var F=this,j=k.a.Clone((function(){return new t(D,F.getScene())}),this);if(j.name=D,j.id=D,w&&(j.parent=w),!N)for(var z=this.getDescendants(!0),G=0;G<z.length;G++){var H=z[G];H.clone&&H.clone(D+"."+H.name,j)}return j},t.prototype.serialize=function(D){var w=k.a.Serialize(this,D);return w.type=this.getClassName(),this.parent&&(w.parentId=this.parent.id),w.localMatrix=this.getPivotMatrix().asArray(),w.isEnabled=this.isEnabled(),this.parent&&(w.parentId=this.parent.id),w},t.Parse=function(D,w,N){var F=k.a.Parse((function(){return new t(D.name,w)}),D,w,N);return D.localMatrix?F.setPreTransformMatrix(z.a.FromArray(D.localMatrix)):D.pivotMatrix&&F.setPivotMatrix(z.a.FromArray(D.pivotMatrix)),F.setEnabled(D.isEnabled),D.parentId&&(F._waitingParentId=D.parentId),F},t.prototype.getChildTransformNodes=function(D,w){var N=[];return this._getDescendants(N,D,(function(D){return(!w||w(D))&&D instanceof t})),N},t.prototype.dispose=function(w,N){if(void 0===N&&(N=!1),this.getScene().stopAnimation(this),this.getScene().removeTransformNode(this),this.onAfterWorldMatrixUpdateObservable.clear(),w)for(var F=0,k=this.getChildTransformNodes(!0);F<k.length;F++){var j=k[F];j.parent=null,j.computeWorldMatrix(!0)}D.prototype.dispose.call(this,w,N)},t.prototype.normalizeToUnitCube=function(D,w,N){void 0===D&&(D=!0),void 0===w&&(w=!1);var F=null,k=null;w&&(this.rotationQuaternion?(k=this.rotationQuaternion.clone(),this.rotationQuaternion.copyFromFloats(0,0,0,1)):this.rotation&&(F=this.rotation.clone(),this.rotation.copyFromFloats(0,0,0)));var j=this.getHierarchyBoundingVectors(D,N),z=j.max.subtract(j.min),G=Math.max(z.x,z.y,z.z);if(0===G)return this;var H=1/G;return this.scaling.scaleInPlace(H),w&&(this.rotationQuaternion&&k?this.rotationQuaternion.copyFrom(k):this.rotation&&F&&this.rotation.copyFrom(F)),this},t.prototype._syncAbsoluteScalingAndRotation=function(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)},t.BILLBOARDMODE_NONE=0,t.BILLBOARDMODE_X=1,t.BILLBOARDMODE_Y=2,t.BILLBOARDMODE_Z=4,t.BILLBOARDMODE_ALL=7,t.BILLBOARDMODE_USE_POSITION=128,t._lookAtVectorCache=new z.e(0,0,0),t._rotationAxisCache=new z.b,Object(F.c)([Object(k.o)("position")],t.prototype,"_position",void 0),Object(F.c)([Object(k.o)("rotation")],t.prototype,"_rotation",void 0),Object(F.c)([Object(k.l)("rotationQuaternion")],t.prototype,"_rotationQuaternion",void 0),Object(F.c)([Object(k.o)("scaling")],t.prototype,"_scaling",void 0),Object(F.c)([Object(k.c)("billboardMode")],t.prototype,"_billboardMode",void 0),Object(F.c)([Object(k.c)()],t.prototype,"scalingDeterminant",void 0),Object(F.c)([Object(k.c)("infiniteDistance")],t.prototype,"_infiniteDistance",void 0),Object(F.c)([Object(k.c)()],t.prototype,"ignoreNonUniformScaling",void 0),Object(F.c)([Object(k.c)()],t.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0),t}(G.a)},function(D,w,N){"use strict";N.d(w,"a",(function(){return q}));var F=N(42),k=N(0),j=N(2),z=N(96),G=N(104),H={min:0,max:0},X={min:0,max:0},u=function(D,w,N){var F=k.e.Dot(w.centerWorld,D),j=Math.abs(k.e.Dot(w.directions[0],D))*w.extendSize.x+Math.abs(k.e.Dot(w.directions[1],D))*w.extendSize.y+Math.abs(k.e.Dot(w.directions[2],D))*w.extendSize.z;N.min=F-j,N.max=F+j},h=function(D,w,N){return u(D,w,H),u(D,N,X),!(H.min>X.max||X.min>H.max)},q=function(){function e(D,w,N){this._isLocked=!1,this.boundingBox=new z.a(D,w,N),this.boundingSphere=new G.a(D,w,N)}return e.prototype.reConstruct=function(D,w,N){this.boundingBox.reConstruct(D,w,N),this.boundingSphere.reConstruct(D,w,N)},Object.defineProperty(e.prototype,"minimum",{get:function(){return this.boundingBox.minimum},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maximum",{get:function(){return this.boundingBox.maximum},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isLocked",{get:function(){return this._isLocked},set:function(D){this._isLocked=D},enumerable:!0,configurable:!0}),e.prototype.update=function(D){this._isLocked||(this.boundingBox._update(D),this.boundingSphere._update(D))},e.prototype.centerOn=function(D,w){var N=e.TmpVector3[0].copyFrom(D).subtractInPlace(w),F=e.TmpVector3[1].copyFrom(D).addInPlace(w);return this.boundingBox.reConstruct(N,F,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(N,F,this.boundingBox.getWorldMatrix()),this},e.prototype.scale=function(D){return this.boundingBox.scale(D),this.boundingSphere.scale(D),this},e.prototype.isInFrustum=function(D,w){return void 0===w&&(w=j.a.MESHES_CULLINGSTRATEGY_STANDARD),!(w!==j.a.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION&&w!==j.a.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY||!this.boundingSphere.isCenterInFrustum(D))||!!this.boundingSphere.isInFrustum(D)&&(!(w!==j.a.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY&&w!==j.a.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY)||this.boundingBox.isInFrustum(D))},Object.defineProperty(e.prototype,"diagonalLength",{get:function(){var D=this.boundingBox;return D.maximumWorld.subtractToRef(D.minimumWorld,e.TmpVector3[0]).length()},enumerable:!0,configurable:!0}),e.prototype.isCompletelyInFrustum=function(D){return this.boundingBox.isCompletelyInFrustum(D)},e.prototype._checkCollision=function(D){return D._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)},e.prototype.intersectsPoint=function(D){return!!this.boundingSphere.centerWorld&&!!this.boundingSphere.intersectsPoint(D)&&!!this.boundingBox.intersectsPoint(D)},e.prototype.intersects=function(D,w){if(!G.a.Intersects(this.boundingSphere,D.boundingSphere))return!1;if(!z.a.Intersects(this.boundingBox,D.boundingBox))return!1;if(!w)return!0;var N=this.boundingBox,F=D.boundingBox;return!!(h(N.directions[0],N,F)&&h(N.directions[1],N,F)&&h(N.directions[2],N,F)&&h(F.directions[0],N,F)&&h(F.directions[1],N,F)&&h(F.directions[2],N,F)&&h(k.e.Cross(N.directions[0],F.directions[0]),N,F)&&h(k.e.Cross(N.directions[0],F.directions[1]),N,F)&&h(k.e.Cross(N.directions[0],F.directions[2]),N,F)&&h(k.e.Cross(N.directions[1],F.directions[0]),N,F)&&h(k.e.Cross(N.directions[1],F.directions[1]),N,F)&&h(k.e.Cross(N.directions[1],F.directions[2]),N,F)&&h(k.e.Cross(N.directions[2],F.directions[0]),N,F)&&h(k.e.Cross(N.directions[2],F.directions[1]),N,F)&&h(k.e.Cross(N.directions[2],F.directions[2]),N,F))},e.TmpVector3=F.a.BuildArray(2,k.e.Zero),e}()},function(D,w,N){"use strict";N.d(w,"a",(function(){return F}));var F=function(){function e(D,w,N,F,k,j){this.source=D,this.pointerX=w,this.pointerY=N,this.meshUnderPointer=F,this.sourceEvent=k,this.additionalData=j}return e.CreateNew=function(D,w,N){var F=D.getScene();return new e(D,F.pointerX,F.pointerY,F.meshUnderPointer||D,w,N)},e.CreateNewFromSprite=function(D,w,N,F){return new e(D,w.pointerX,w.pointerY,w.meshUnderPointer,N,F)},e.CreateNewFromScene=function(D,w){return new e(null,D.pointerX,D.pointerY,D.meshUnderPointer,w)},e.CreateNewFromPrimitive=function(D,w,N,F){return new e(D,w.x,w.y,null,N,F)},e}()},function(D,w,N){"use strict";N.d(w,"a",(function(){return H}));var F=N(0),k=N(5),j=N(15),z=N(92),G=N(4);j.a.CreateLineSystem=function(D){for(var w=[],N=[],F=D.lines,k=D.colors,z=[],G=0,H=0;H<F.length;H++)for(var X=F[H],q=0;q<X.length;q++){if(N.push(X[q].x,X[q].y,X[q].z),k){var Z=k[H];z.push(Z[q].r,Z[q].g,Z[q].b,Z[q].a)}q>0&&(w.push(G-1),w.push(G)),G++}var J=new j.a;return J.indices=w,J.positions=N,k&&(J.colors=z),J},j.a.CreateDashedLines=function(D){var w,N,k=D.dashSize||3,z=D.gapSize||1,G=D.dashNb||200,H=D.points,X=new Array,q=new Array,Z=F.e.Zero(),J=0,$=0,te=0,ie=0,oe=0;for(oe=0;oe<H.length-1;oe++)H[oe+1].subtractToRef(H[oe],Z),J+=Z.length();for(N=k*(w=J/G)/(k+z),oe=0;oe<H.length-1;oe++){H[oe+1].subtractToRef(H[oe],Z),$=Math.floor(Z.length()/w),Z.normalize();for(var ce=0;ce<$;ce++)te=w*ce,X.push(H[oe].x+te*Z.x,H[oe].y+te*Z.y,H[oe].z+te*Z.z),X.push(H[oe].x+(te+N)*Z.x,H[oe].y+(te+N)*Z.y,H[oe].z+(te+N)*Z.z),q.push(ie,ie+1),ie+=2}var he=new j.a;return he.positions=X,he.indices=q,he},k.a.CreateLines=function(D,w,N,F,k){void 0===N&&(N=null),void 0===F&&(F=!1),void 0===k&&(k=null);var j={points:w,updatable:F,instance:k};return H.CreateLines(D,j,N)},k.a.CreateDashedLines=function(D,w,N,F,k,j,z,G){void 0===j&&(j=null);var X={points:w,dashSize:N,gapSize:F,dashNb:k,updatable:z,instance:G};return H.CreateDashedLines(D,X,j)};var H=function(){function e(){}return e.CreateLineSystem=function(D,w,N){var F=w.instance,k=w.lines,H=w.colors;if(F){var X,q,Z=F.getVerticesData(G.b.PositionKind);H&&(X=F.getVerticesData(G.b.ColorKind));for(var J=0,$=0,te=0;te<k.length;te++)for(var ie=k[te],oe=0;oe<ie.length;oe++)Z[J]=ie[oe].x,Z[J+1]=ie[oe].y,Z[J+2]=ie[oe].z,H&&X&&(q=H[te],X[$]=q[oe].r,X[$+1]=q[oe].g,X[$+2]=q[oe].b,X[$+3]=q[oe].a,$+=4),J+=3;return F.updateVerticesData(G.b.PositionKind,Z,!1,!1),H&&X&&F.updateVerticesData(G.b.ColorKind,X,!1,!1),F}var ce=!!H,he=new z.b(D,N,null,void 0,void 0,ce,w.useVertexAlpha);return j.a.CreateLineSystem(w).applyToMesh(he,w.updatable),he},e.CreateLines=function(D,w,N){void 0===N&&(N=null);var F=w.colors?[w.colors]:null;return e.CreateLineSystem(D,{lines:[w.points],updatable:w.updatable,instance:w.instance,colors:F,useVertexAlpha:w.useVertexAlpha},N)},e.CreateDashedLines=function(D,w,N){void 0===N&&(N=null);var G=w.points,H=w.instance,X=w.gapSize||1,q=w.dashSize||3;if(H)return H.updateMeshPositions((function(D){var w,N,k=F.e.Zero(),j=D.length/6,z=0,X=0,q=0,Z=0,J=0,$=0;for(J=0;J<G.length-1;J++)G[J+1].subtractToRef(G[J],k),z+=k.length();w=z/j;var te=H._creationDataStorage.dashSize;for(N=te*w/(te+H._creationDataStorage.gapSize),J=0;J<G.length-1;J++)for(G[J+1].subtractToRef(G[J],k),X=Math.floor(k.length()/w),k.normalize(),$=0;$<X&&Z<D.length;)q=w*$,D[Z]=G[J].x+q*k.x,D[Z+1]=G[J].y+q*k.y,D[Z+2]=G[J].z+q*k.z,D[Z+3]=G[J].x+(q+N)*k.x,D[Z+4]=G[J].y+(q+N)*k.y,D[Z+5]=G[J].z+(q+N)*k.z,Z+=6,$++;for(;Z<D.length;)D[Z]=G[J].x,D[Z+1]=G[J].y,D[Z+2]=G[J].z,Z+=3}),!1),H;var Z=new z.b(D,N,null,void 0,void 0,void 0,w.useVertexAlpha);return j.a.CreateDashedLines(w).applyToMesh(Z,w.updatable),Z._creationDataStorage=new k.b,Z._creationDataStorage.dashSize=q,Z._creationDataStorage.gapSize=X,Z},e}()},function(D,w,N){"use strict";N.d(w,"e",(function(){return k})),N.d(w,"a",(function(){return j})),N.d(w,"d",(function(){return z})),N.d(w,"c",(function(){return G})),N.d(w,"b",(function(){return H}));var F=N(1),k=function(){function e(D,w){this.type=D,this.jointData=w,w.nativeParams=w.nativeParams||{}}return Object.defineProperty(e.prototype,"physicsJoint",{get:function(){return this._physicsJoint},set:function(D){this._physicsJoint,this._physicsJoint=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"physicsPlugin",{set:function(D){this._physicsPlugin=D},enumerable:!0,configurable:!0}),e.prototype.executeNativeFunction=function(D){D(this._physicsPlugin.world,this._physicsJoint)},e.DistanceJoint=0,e.HingeJoint=1,e.BallAndSocketJoint=2,e.WheelJoint=3,e.SliderJoint=4,e.PrismaticJoint=5,e.UniversalJoint=6,e.Hinge2Joint=e.WheelJoint,e.PointToPointJoint=8,e.SpringJoint=9,e.LockJoint=10,e}(),j=function(D){function t(w){return D.call(this,k.DistanceJoint,w)||this}return Object(F.d)(t,D),t.prototype.updateDistance=function(D,w){this._physicsPlugin.updateDistanceJoint(this,D,w)},t}(k),z=function(D){function t(w,N){return D.call(this,w,N)||this}return Object(F.d)(t,D),t.prototype.setMotor=function(D,w){this._physicsPlugin.setMotor(this,D||0,w)},t.prototype.setLimit=function(D,w){this._physicsPlugin.setLimit(this,D,w)},t}(k),G=function(D){function t(w){return D.call(this,k.HingeJoint,w)||this}return Object(F.d)(t,D),t.prototype.setMotor=function(D,w){this._physicsPlugin.setMotor(this,D||0,w)},t.prototype.setLimit=function(D,w){this._physicsPlugin.setLimit(this,D,w)},t}(z),H=function(D){function t(w){return D.call(this,k.Hinge2Joint,w)||this}return Object(F.d)(t,D),t.prototype.setMotor=function(D,w,N){void 0===N&&(N=0),this._physicsPlugin.setMotor(this,D||0,w,N)},t.prototype.setLimit=function(D,w,N){void 0===N&&(N=0),this._physicsPlugin.setLimit(this,D,w,N)},t}(z)},function(D,w,N){"use strict";N.d(w,"a",(function(){return z}));var F=N(0),k=N(5),j=N(15);j.a.CreateSphere=function(D){for(var w=D.segments||32,N=D.diameterX||D.diameter||1,k=D.diameterY||D.diameter||1,z=D.diameterZ||D.diameter||1,G=D.arc&&(D.arc<=0||D.arc>1)?1:D.arc||1,H=D.slice&&D.slice<=0?1:D.slice||1,X=0===D.sideOrientation?0:D.sideOrientation||j.a.DEFAULTSIDE,q=new F.e(N/2,k/2,z/2),Z=2+w,J=2*Z,$=[],te=[],ie=[],oe=[],ce=0;ce<=Z;ce++){for(var he=ce/Z,fe=he*Math.PI*H,pe=0;pe<=J;pe++){var _e=pe/J,ve=_e*Math.PI*2*G,ye=F.a.RotationZ(-fe),be=F.a.RotationY(ve),Te=F.e.TransformCoordinates(F.e.Up(),ye),Ee=F.e.TransformCoordinates(Te,be),Se=Ee.multiply(q),Me=Ee.divide(q).normalize();te.push(Se.x,Se.y,Se.z),ie.push(Me.x,Me.y,Me.z),oe.push(_e,he)}if(ce>0)for(var xe=te.length/3,Ae=xe-2*(J+1);Ae+J+2<xe;Ae++)$.push(Ae),$.push(Ae+1),$.push(Ae+J+1),$.push(Ae+J+1),$.push(Ae+1),$.push(Ae+J+2)}j.a._ComputeSides(X,te,$,ie,oe,D.frontUVs,D.backUVs);var Pe=new j.a;return Pe.indices=$,Pe.positions=te,Pe.normals=ie,Pe.uvs=oe,Pe},k.a.CreateSphere=function(D,w,N,F,k,j){var G={segments:w,diameterX:N,diameterY:N,diameterZ:N,sideOrientation:j,updatable:k};return z.CreateSphere(D,G,F)};var z=function(){function e(){}return e.CreateSphere=function(D,w,N){void 0===N&&(N=null);var F=new k.a(D,N);return w.sideOrientation=k.a._GetDefaultSideOrientation(w.sideOrientation),F._originalBuilderSideOrientation=w.sideOrientation,j.a.CreateSphere(w).applyToMesh(F,w.updatable),F},e}()},function(D,w,N){"use strict";N.d(w,"a",(function(){return Z}));var F=N(1),k=N(3),j=N(6),z=N(0),G=N(23),H=N(2),X=N(137),q=N(68),Z=(N(54),function(){function e(D){this.metadata=null,this.reservedDataStore=null,this._hasAlpha=!1,this.getAlphaFromRGB=!1,this.level=1,this.coordinatesIndex=0,this._coordinatesMode=H.a.TEXTURE_EXPLICIT_MODE,this.wrapU=H.a.TEXTURE_WRAP_ADDRESSMODE,this.wrapV=H.a.TEXTURE_WRAP_ADDRESSMODE,this.wrapR=H.a.TEXTURE_WRAP_ADDRESSMODE,this.anisotropicFilteringLevel=e.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,this.gammaSpace=!0,this.invertZ=!1,this.lodLevelInAlpha=!1,this.isRenderTarget=!1,this.animations=new Array,this.onDisposeObservable=new j.c,this._onDisposeObserver=null,this.delayLoadState=H.a.DELAYLOADSTATE_NONE,this._scene=null,this._texture=null,this._uid=null,this._cachedSize=q.a.Zero(),this._scene=D||G.a.LastCreatedScene,this._scene&&(this.uniqueId=this._scene.getUniqueId(),this._scene.addTexture(this)),this._uid=null}return Object.defineProperty(e.prototype,"hasAlpha",{get:function(){return this._hasAlpha},set:function(D){this._hasAlpha!==D&&(this._hasAlpha=D,this._scene&&this._scene.markAllMaterialsAsDirty(H.a.MATERIAL_TextureDirtyFlag|H.a.MATERIAL_MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"coordinatesMode",{get:function(){return this._coordinatesMode},set:function(D){this._coordinatesMode!==D&&(this._coordinatesMode=D,this._scene&&this._scene.markAllMaterialsAsDirty(H.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isCube",{get:function(){return!!this._texture&&this._texture.isCube},set:function(D){this._texture&&(this._texture.isCube=D)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"is3D",{get:function(){return!!this._texture&&this._texture.is3D},set:function(D){this._texture&&(this._texture.is3D=D)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"is2DArray",{get:function(){return!!this._texture&&this._texture.is2DArray},set:function(D){this._texture&&(this._texture.is2DArray=D)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isRGBD",{get:function(){return null!=this._texture&&this._texture._isRGBD},set:function(D){this._texture&&(this._texture._isRGBD=D)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"noMipmap",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lodGenerationOffset",{get:function(){return this._texture?this._texture._lodGenerationOffset:0},set:function(D){this._texture&&(this._texture._lodGenerationOffset=D)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lodGenerationScale",{get:function(){return this._texture?this._texture._lodGenerationScale:0},set:function(D){this._texture&&(this._texture._lodGenerationScale=D)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"linearSpecularLOD",{get:function(){return!!this._texture&&this._texture._linearSpecularLOD},set:function(D){this._texture&&(this._texture._linearSpecularLOD=D)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"irradianceTexture",{get:function(){return this._texture?this._texture._irradianceTexture:null},set:function(D){this._texture&&(this._texture._irradianceTexture=D)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uid",{get:function(){return this._uid||(this._uid=X.a.RandomId()),this._uid},enumerable:!0,configurable:!0}),e.prototype.toString=function(){return this.name},e.prototype.getClassName=function(){return"BaseTexture"},Object.defineProperty(e.prototype,"onDispose",{set:function(D){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(D)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isBlocking",{get:function(){return!0},enumerable:!0,configurable:!0}),e.prototype.getScene=function(){return this._scene},e.prototype.getTextureMatrix=function(){return z.a.IdentityReadOnly},e.prototype.getReflectionTextureMatrix=function(){return z.a.IdentityReadOnly},e.prototype.getInternalTexture=function(){return this._texture},e.prototype.isReadyOrNotBlocking=function(){return!this.isBlocking||this.isReady()},e.prototype.isReady=function(){return this.delayLoadState===H.a.DELAYLOADSTATE_NOTLOADED?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady},e.prototype.getSize=function(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize},e.prototype.getBaseSize=function(){return this.isReady()&&this._texture?this._texture._size?new q.a(this._texture._size,this._texture._size):new q.a(this._texture.baseWidth,this._texture.baseHeight):q.a.Zero()},e.prototype.updateSamplingMode=function(D){if(this._texture){var w=this.getScene();w&&w.getEngine().updateTextureSamplingMode(D,this._texture)}},e.prototype.scale=function(D){},Object.defineProperty(e.prototype,"canRescale",{get:function(){return!1},enumerable:!0,configurable:!0}),e.prototype._getFromCache=function(D,w,N,F){if(!this._scene)return null;for(var k=this._scene.getEngine().getLoadedTexturesCache(),j=0;j<k.length;j++){var z=k[j];if(!(void 0!==F&&F!==z.invertY||z.url!==D||z.generateMipMaps!==!w||N&&N!==z.samplingMode))return z.incrementReferences(),z}return null},e.prototype._rebuild=function(){},e.prototype.delayLoad=function(){},e.prototype.clone=function(){return null},Object.defineProperty(e.prototype,"textureType",{get:function(){return this._texture&&void 0!==this._texture.type?this._texture.type:H.a.TEXTURETYPE_UNSIGNED_INT},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textureFormat",{get:function(){return this._texture&&void 0!==this._texture.format?this._texture.format:H.a.TEXTUREFORMAT_RGBA},enumerable:!0,configurable:!0}),e.prototype._markAllSubMeshesAsTexturesDirty=function(){var D=this.getScene();D&&D.markAllMaterialsAsDirty(H.a.MATERIAL_TextureDirtyFlag)},e.prototype.readPixels=function(D,w,N){if(void 0===D&&(D=0),void 0===w&&(w=0),void 0===N&&(N=null),!this._texture)return null;var F=this.getSize(),k=F.width,j=F.height,z=this.getScene();if(!z)return null;var G=z.getEngine();return 0!=w&&(k/=Math.pow(2,w),j/=Math.pow(2,w),k=Math.round(k),j=Math.round(j)),this._texture.isCube?G._readTexturePixels(this._texture,k,j,D,w,N):G._readTexturePixels(this._texture,k,j,-1,w,N)},e.prototype.releaseInternalTexture=function(){this._texture&&(this._texture.dispose(),this._texture=null)},Object.defineProperty(e.prototype,"_lodTextureHigh",{get:function(){return this._texture?this._texture._lodTextureHigh:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_lodTextureMid",{get:function(){return this._texture?this._texture._lodTextureMid:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_lodTextureLow",{get:function(){return this._texture?this._texture._lodTextureLow:null},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene._removePendingData(this);var D=this._scene.textures.indexOf(this);D>=0&&this._scene.textures.splice(D,1),this._scene.onTextureRemovedObservable.notifyObservers(this)}void 0!==this._texture&&(this.releaseInternalTexture(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear())},e.prototype.serialize=function(){if(!this.name)return null;var D=k.a.Serialize(this);return k.a.AppendSerializedAnimations(this,D),D},e.WhenAllReady=function(D,w){var N=D.length;if(0!==N)for(var F,k,o=function(){if((F=D[j]).isReady())0==--N&&w();else if(k=F.onLoadObservable){var o=function(){k.removeCallback(o),0==--N&&w()};k.add(o)}},j=0;j<D.length;j++)o();else w()},e.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,Object(F.c)([Object(k.c)()],e.prototype,"uniqueId",void 0),Object(F.c)([Object(k.c)()],e.prototype,"name",void 0),Object(F.c)([Object(k.c)()],e.prototype,"metadata",void 0),Object(F.c)([Object(k.c)("hasAlpha")],e.prototype,"_hasAlpha",void 0),Object(F.c)([Object(k.c)()],e.prototype,"getAlphaFromRGB",void 0),Object(F.c)([Object(k.c)()],e.prototype,"level",void 0),Object(F.c)([Object(k.c)()],e.prototype,"coordinatesIndex",void 0),Object(F.c)([Object(k.c)("coordinatesMode")],e.prototype,"_coordinatesMode",void 0),Object(F.c)([Object(k.c)()],e.prototype,"wrapU",void 0),Object(F.c)([Object(k.c)()],e.prototype,"wrapV",void 0),Object(F.c)([Object(k.c)()],e.prototype,"wrapR",void 0),Object(F.c)([Object(k.c)()],e.prototype,"anisotropicFilteringLevel",void 0),Object(F.c)([Object(k.c)()],e.prototype,"isCube",null),Object(F.c)([Object(k.c)()],e.prototype,"is3D",null),Object(F.c)([Object(k.c)()],e.prototype,"is2DArray",null),Object(F.c)([Object(k.c)(),Object(k.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"gammaSpace",void 0),Object(F.c)([Object(k.c)()],e.prototype,"invertZ",void 0),Object(F.c)([Object(k.c)()],e.prototype,"lodLevelInAlpha",void 0),Object(F.c)([Object(k.c)()],e.prototype,"lodGenerationOffset",null),Object(F.c)([Object(k.c)()],e.prototype,"lodGenerationScale",null),Object(F.c)([Object(k.c)()],e.prototype,"linearSpecularLOD",null),Object(F.c)([Object(k.m)()],e.prototype,"irradianceTexture",null),Object(F.c)([Object(k.c)()],e.prototype,"isRenderTarget",void 0),e}())},function(D,w,N){"use strict";N.d(w,"a",(function(){return q}));var F=N(1),k=N(3),j=N(0),z=N(10),G=N(26),H=N(83),X=N(12),q=function(D){function t(w,N){var F=D.call(this,w,N)||this;return F.diffuse=new z.a(1,1,1),F.specular=new z.a(1,1,1),F.falloffType=t.FALLOFF_DEFAULT,F.intensity=1,F._range=Number.MAX_VALUE,F._inverseSquaredRange=0,F._photometricScale=1,F._intensityMode=t.INTENSITYMODE_AUTOMATIC,F._radius=1e-5,F.renderPriority=0,F._shadowEnabled=!0,F._excludeWithLayerMask=0,F._includeOnlyWithLayerMask=0,F._lightmapMode=0,F._excludedMeshesIds=new Array,F._includedOnlyMeshesIds=new Array,F._isLight=!0,F.getScene().addLight(F),F._uniformBuffer=new H.a(F.getScene().getEngine()),F._buildUniformLayout(),F.includedOnlyMeshes=new Array,F.excludedMeshes=new Array,F._resyncMeshes(),F}return Object(F.d)(t,D),Object.defineProperty(t.prototype,"range",{get:function(){return this._range},set:function(D){this._range=D,this._inverseSquaredRange=1/(this.range*this.range)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"intensityMode",{get:function(){return this._intensityMode},set:function(D){this._intensityMode=D,this._computePhotometricScale()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"radius",{get:function(){return this._radius},set:function(D){this._radius=D,this._computePhotometricScale()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowEnabled",{get:function(){return this._shadowEnabled},set:function(D){this._shadowEnabled!==D&&(this._shadowEnabled=D,this._markMeshesAsLightDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"includedOnlyMeshes",{get:function(){return this._includedOnlyMeshes},set:function(D){this._includedOnlyMeshes=D,this._hookArrayForIncludedOnly(D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"excludedMeshes",{get:function(){return this._excludedMeshes},set:function(D){this._excludedMeshes=D,this._hookArrayForExcluded(D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"excludeWithLayerMask",{get:function(){return this._excludeWithLayerMask},set:function(D){this._excludeWithLayerMask=D,this._resyncMeshes()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"includeOnlyWithLayerMask",{get:function(){return this._includeOnlyWithLayerMask},set:function(D){this._includeOnlyWithLayerMask=D,this._resyncMeshes()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lightmapMode",{get:function(){return this._lightmapMode},set:function(D){this._lightmapMode!==D&&(this._lightmapMode=D,this._markMeshesAsLightDirty())},enumerable:!0,configurable:!0}),t.prototype.transferTexturesToEffect=function(D,w){return this},t.prototype._bindLight=function(D,w,N,F,k){void 0===k&&(k=!1);var j=D.toString(),G=!1;if(!k||!this._uniformBuffer._alreadyBound){if(this._uniformBuffer.bindToEffect(N,"Light"+j),this._renderId!==w.getRenderId()||!this._uniformBuffer.useUbo){this._renderId=w.getRenderId();var H=this.getScaledIntensity();this.transferToEffect(N,j),this.diffuse.scaleToRef(H,z.c.Color3[0]),this._uniformBuffer.updateColor4("vLightDiffuse",z.c.Color3[0],this.range,j),F&&(this.specular.scaleToRef(H,z.c.Color3[1]),this._uniformBuffer.updateColor4("vLightSpecular",z.c.Color3[1],this.radius,j)),G=!0}if(this.transferTexturesToEffect(N,j),w.shadowsEnabled&&this.shadowEnabled){var X=this.getShadowGenerator();X&&(X.bindShadowLight(j,N),G=!0)}G&&this._uniformBuffer.update()}},t.prototype.getClassName=function(){return"Light"},t.prototype.toString=function(D){var w="Name: "+this.name;if(w+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(var N=0;N<this.animations.length;N++)w+=", animation[0]: "+this.animations[N].toString(D);return w},t.prototype._syncParentEnabledState=function(){D.prototype._syncParentEnabledState.call(this),this.isDisposed()||this._resyncMeshes()},t.prototype.setEnabled=function(w){D.prototype.setEnabled.call(this,w),this._resyncMeshes()},t.prototype.getShadowGenerator=function(){return this._shadowGenerator},t.prototype.getAbsolutePosition=function(){return j.e.Zero()},t.prototype.canAffectMesh=function(D){return!(D&&(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(D)||this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(D)||0!==this.includeOnlyWithLayerMask&&0==(this.includeOnlyWithLayerMask&D.layerMask)||0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&D.layerMask))},t.CompareLightsPriority=function(D,w){return D.shadowEnabled!==w.shadowEnabled?(w.shadowEnabled?1:0)-(D.shadowEnabled?1:0):w.renderPriority-D.renderPriority},t.prototype.dispose=function(w,N){void 0===N&&(N=!1),this._shadowGenerator&&(this._shadowGenerator.dispose(),this._shadowGenerator=null),this.getScene().stopAnimation(this);for(var F=0,k=this.getScene().meshes;F<k.length;F++)k[F]._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.getScene().removeLight(this),D.prototype.dispose.call(this,w,N)},t.prototype.getTypeID=function(){return 0},t.prototype.getScaledIntensity=function(){return this._photometricScale*this.intensity},t.prototype.clone=function(D){var w=t.GetConstructorFromName(this.getTypeID(),D,this.getScene());return w?k.a.Clone(w,this):null},t.prototype.serialize=function(){var D=k.a.Serialize(this);return D.type=this.getTypeID(),this.parent&&(D.parentId=this.parent.id),this.excludedMeshes.length>0&&(D.excludedMeshesIds=[],this.excludedMeshes.forEach((function(w){D.excludedMeshesIds.push(w.id)}))),this.includedOnlyMeshes.length>0&&(D.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach((function(w){D.includedOnlyMeshesIds.push(w.id)}))),k.a.AppendSerializedAnimations(this,D),D.ranges=this.serializeAnimationRanges(),D},t.GetConstructorFromName=function(D,w,N){return G.a.Construct("Light_Type_"+D,w,N)||null},t.Parse=function(D,w){var N=t.GetConstructorFromName(D.type,D.name,w);if(!N)return null;var F=k.a.Parse(N,D,w);if(D.excludedMeshesIds&&(F._excludedMeshesIds=D.excludedMeshesIds),D.includedOnlyMeshesIds&&(F._includedOnlyMeshesIds=D.includedOnlyMeshesIds),D.parentId&&(F._waitingParentId=D.parentId),void 0!==D.falloffType&&(F.falloffType=D.falloffType),void 0!==D.lightmapMode&&(F.lightmapMode=D.lightmapMode),D.animations){for(var j=0;j<D.animations.length;j++){var z=D.animations[j],H=X.a.GetClass("BABYLON.Animation");H&&F.animations.push(H.Parse(z))}G.a.ParseAnimationRanges(F,D,w)}return D.autoAnimate&&w.beginAnimation(F,D.autoAnimateFrom,D.autoAnimateTo,D.autoAnimateLoop,D.autoAnimateSpeed||1),F},t.prototype._hookArrayForExcluded=function(D){var w=this,N=D.push;D.push=function(){for(var F=[],k=0;k<arguments.length;k++)F[k]=arguments[k];for(var j=N.apply(D,F),z=0,G=F;z<G.length;z++){var H=G[z];H._resyncLightSource(w)}return j};var F=D.splice;D.splice=function(N,k){for(var j=F.apply(D,[N,k]),z=0,G=j;z<G.length;z++)G[z]._resyncLightSource(w);return j};for(var k=0,j=D;k<j.length;k++)j[k]._resyncLightSource(this)},t.prototype._hookArrayForIncludedOnly=function(D){var w=this,N=D.push;D.push=function(){for(var F=[],k=0;k<arguments.length;k++)F[k]=arguments[k];var j=N.apply(D,F);return w._resyncMeshes(),j};var F=D.splice;D.splice=function(N,k){var j=F.apply(D,[N,k]);return w._resyncMeshes(),j},this._resyncMeshes()},t.prototype._resyncMeshes=function(){for(var D=0,w=this.getScene().meshes;D<w.length;D++)w[D]._resyncLightSource(this)},t.prototype._markMeshesAsLightDirty=function(){for(var D=0,w=this.getScene().meshes;D<w.length;D++){var N=w[D];-1!==N.lightSources.indexOf(this)&&N._markSubMeshesAsLightDirty()}},t.prototype._computePhotometricScale=function(){this._photometricScale=this._getPhotometricScale(),this.getScene().resetCachedMaterial()},t.prototype._getPhotometricScale=function(){var D=0,w=this.getTypeID(),N=this.intensityMode;switch(N===t.INTENSITYMODE_AUTOMATIC&&(N=w===t.LIGHTTYPEID_DIRECTIONALLIGHT?t.INTENSITYMODE_ILLUMINANCE:t.INTENSITYMODE_LUMINOUSINTENSITY),w){case t.LIGHTTYPEID_POINTLIGHT:case t.LIGHTTYPEID_SPOTLIGHT:switch(N){case t.INTENSITYMODE_LUMINOUSPOWER:D=1/(4*Math.PI);break;case t.INTENSITYMODE_LUMINOUSINTENSITY:D=1;break;case t.INTENSITYMODE_LUMINANCE:D=this.radius*this.radius}break;case t.LIGHTTYPEID_DIRECTIONALLIGHT:switch(N){case t.INTENSITYMODE_ILLUMINANCE:D=1;break;case t.INTENSITYMODE_LUMINANCE:var F=this.radius;F=Math.max(F,.001),D=2*Math.PI*(1-Math.cos(F))}break;case t.LIGHTTYPEID_HEMISPHERICLIGHT:D=1}return D},t.prototype._reorderLightsInScene=function(){var D=this.getScene();0!=this._renderPriority&&(D.requireLightSorting=!0),this.getScene().sortLightsByPriority()},t.FALLOFF_DEFAULT=0,t.FALLOFF_PHYSICAL=1,t.FALLOFF_GLTF=2,t.FALLOFF_STANDARD=3,t.LIGHTMAP_DEFAULT=0,t.LIGHTMAP_SPECULAR=1,t.LIGHTMAP_SHADOWSONLY=2,t.INTENSITYMODE_AUTOMATIC=0,t.INTENSITYMODE_LUMINOUSPOWER=1,t.INTENSITYMODE_LUMINOUSINTENSITY=2,t.INTENSITYMODE_ILLUMINANCE=3,t.INTENSITYMODE_LUMINANCE=4,t.LIGHTTYPEID_POINTLIGHT=0,t.LIGHTTYPEID_DIRECTIONALLIGHT=1,t.LIGHTTYPEID_SPOTLIGHT=2,t.LIGHTTYPEID_HEMISPHERICLIGHT=3,Object(F.c)([Object(k.e)()],t.prototype,"diffuse",void 0),Object(F.c)([Object(k.e)()],t.prototype,"specular",void 0),Object(F.c)([Object(k.c)()],t.prototype,"falloffType",void 0),Object(F.c)([Object(k.c)()],t.prototype,"intensity",void 0),Object(F.c)([Object(k.c)()],t.prototype,"range",null),Object(F.c)([Object(k.c)()],t.prototype,"intensityMode",null),Object(F.c)([Object(k.c)()],t.prototype,"radius",null),Object(F.c)([Object(k.c)()],t.prototype,"_renderPriority",void 0),Object(F.c)([Object(k.b)("_reorderLightsInScene")],t.prototype,"renderPriority",void 0),Object(F.c)([Object(k.c)("shadowEnabled")],t.prototype,"_shadowEnabled",void 0),Object(F.c)([Object(k.c)("excludeWithLayerMask")],t.prototype,"_excludeWithLayerMask",void 0),Object(F.c)([Object(k.c)("includeOnlyWithLayerMask")],t.prototype,"_includeOnlyWithLayerMask",void 0),Object(F.c)([Object(k.c)("lightmapMode")],t.prototype,"_lightmapMode",void 0),t}(G.a)},function(D,w,N){"use strict";N.d(w,"a",(function(){return k}));var F=N(52),k=function(){function e(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}return Object.defineProperty(e.prototype,"min",{get:function(){return this._min},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"max",{get:function(){return this._max},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"average",{get:function(){return this._average},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lastSecAverage",{get:function(){return this._lastSecAverage},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"current",{get:function(){return this._current},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"total",{get:function(){return this._totalAccumulated},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"count",{get:function(){return this._totalValueCount},enumerable:!0,configurable:!0}),e.prototype.fetchNewFrame=function(){this._totalValueCount++,this._current=0,this._lastSecValueCount++},e.prototype.addCount=function(D,w){e.Enabled&&(this._current+=D,w&&this._fetchResult())},e.prototype.beginMonitoring=function(){e.Enabled&&(this._startMonitoringTime=F.a.Now)},e.prototype.endMonitoring=function(D){if(void 0===D&&(D=!0),e.Enabled){D&&this.fetchNewFrame();var w=F.a.Now;this._current=w-this._startMonitoringTime,D&&this._fetchResult()}},e.prototype._fetchResult=function(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;var D=F.a.Now;D-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=D,this._lastSecAccumulated=0,this._lastSecValueCount=0)},e.Enabled=!0,e}()},function(D,w,N){"use strict";N.d(w,"a",(function(){return k}));var F=N(38),k=function(){function e(){}return Object.defineProperty(e,"Now",{get:function(){return F.a.IsWindowObjectExist()&&window.performance&&window.performance.now?window.performance.now():Date.now()},enumerable:!0,configurable:!0}),e}()},function(D,w,N){"use strict";N.d(w,"a",(function(){return j}));var F=N(0),k=N(4),j=function(){function e(){this._pickingUnavailable=!1,this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshId=0,this.pickedSprite=null,this.originMesh=null,this.ray=null}return e.prototype.getNormal=function(D,w){if(void 0===D&&(D=!1),void 0===w&&(w=!0),!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(k.b.NormalKind))return null;var N,j=this.pickedMesh.getIndices();if(!j)return null;if(w){var z=this.pickedMesh.getVerticesData(k.b.NormalKind),G=F.e.FromArray(z,3*j[3*this.faceId]),H=F.e.FromArray(z,3*j[3*this.faceId+1]),X=F.e.FromArray(z,3*j[3*this.faceId+2]);G=G.scale(this.bu),H=H.scale(this.bv),X=X.scale(1-this.bu-this.bv),N=new F.e(G.x+H.x+X.x,G.y+H.y+X.y,G.z+H.z+X.z)}else{var q=this.pickedMesh.getVerticesData(k.b.PositionKind),Z=F.e.FromArray(q,3*j[3*this.faceId]),J=F.e.FromArray(q,3*j[3*this.faceId+1]),$=F.e.FromArray(q,3*j[3*this.faceId+2]),te=Z.subtract(J),ie=$.subtract(J);N=F.e.Cross(te,ie)}if(D){var oe=this.pickedMesh.getWorldMatrix();this.pickedMesh.nonUniformScaling&&(F.c.Matrix[0].copyFrom(oe),(oe=F.c.Matrix[0]).setTranslationFromFloats(0,0,0),oe.invert(),oe.transposeToRef(F.c.Matrix[1]),oe=F.c.Matrix[1]),N=F.e.TransformNormal(N,oe)}return N.normalize(),N},e.prototype.getTextureCoordinates=function(){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(k.b.UVKind))return null;var D=this.pickedMesh.getIndices();if(!D)return null;var w=this.pickedMesh.getVerticesData(k.b.UVKind);if(!w)return null;var N=F.d.FromArray(w,2*D[3*this.faceId]),j=F.d.FromArray(w,2*D[3*this.faceId+1]),z=F.d.FromArray(w,2*D[3*this.faceId+2]);return N=N.scale(this.bu),j=j.scale(this.bv),z=z.scale(1-this.bu-this.bv),new F.d(N.x+j.x+z.x,N.y+j.y+z.y)},e}()},function(D,w,N){"use strict";var F=N(1),k=N(65),j=N(38),z=N(6),G=N(76),H=N(126),X=function(D){function t(){return null!==D&&D.apply(this,arguments)||this}return Object(F.d)(t,D),t._setPrototypeOf=Object.setPrototypeOf||function(D,w){return D.__proto__=w,D},t}(Error),q=N(36),Z=N(31),J=N(116);N.d(w,"b",(function(){return $})),N.d(w,"d",(function(){return te})),N.d(w,"c",(function(){return ie})),N.d(w,"a",(function(){return oe}));var $=function(D){function t(w,N){var F=D.call(this,w)||this;return F.name="LoadFileError",X._setPrototypeOf(F,t.prototype),N instanceof k.a?F.request=N:F.file=N,F}return Object(F.d)(t,D),t}(X),te=function(D){function t(w,N){var F=D.call(this,w)||this;return F.request=N,F.name="RequestFileError",X._setPrototypeOf(F,t.prototype),F}return Object(F.d)(t,D),t}(X),ie=function(D){function t(w,N){var F=D.call(this,w)||this;return F.file=N,F.name="ReadFileError",X._setPrototypeOf(F,t.prototype),F}return Object(F.d)(t,D),t}(X),oe=function(){function e(){}return e._CleanUrl=function(D){return D.replace(/#/gm,"%23")},e.SetCorsBehavior=function(D,w){if((!D||0!==D.indexOf("data:"))&&e.CorsBehavior)if("string"==typeof e.CorsBehavior||this.CorsBehavior instanceof String)w.crossOrigin=e.CorsBehavior;else{var N=e.CorsBehavior(D);N&&(w.crossOrigin=N)}},e.LoadImage=function(D,w,N,F,k){var j;void 0===k&&(k="");var z=!1;if(D instanceof ArrayBuffer||ArrayBuffer.isView(D)?"undefined"!=typeof Blob?(j=URL.createObjectURL(new Blob([D],{type:k})),z=!0):j="data:"+k+";base64,"+q.a.EncodeArrayBufferToBase64(D):D instanceof Blob?(j=URL.createObjectURL(D),z=!0):(j=e._CleanUrl(D),j=e.PreprocessUrl(D)),"undefined"==typeof Image)return e.LoadFile(j,(function(F){createImageBitmap(new Blob([F],{type:k})).then((function(D){w(D),z&&URL.revokeObjectURL(j)})).catch((function(w){N&&N("Error while trying to load image: "+D,w)}))}),void 0,F||void 0,!0,(function(w,F){N&&N("Error while trying to load image: "+D,F)})),null;var H=new Image;e.SetCorsBehavior(j,H);var h=function(){H.removeEventListener("load",h),H.removeEventListener("error",d),w(H),z&&H.src&&URL.revokeObjectURL(H.src)},d=function(w){H.removeEventListener("load",h),H.removeEventListener("error",d),N&&N("Error while trying to load image: "+D,w),z&&H.src&&URL.revokeObjectURL(H.src)};H.addEventListener("load",h),H.addEventListener("error",d);var f=function(){H.src=j};if("data:"!==j.substr(0,5)&&F&&F.enableTexturesOffline)F.open((function(){F&&F.loadImage(j,H)}),f);else{if(-1!==j.indexOf("file:")){var X=decodeURIComponent(j.substring(5).toLowerCase());if(G.a.FilesToLoad[X]){try{var Z;try{Z=URL.createObjectURL(G.a.FilesToLoad[X])}catch(D){Z=URL.createObjectURL(G.a.FilesToLoad[X])}H.src=Z,z=!0}catch(D){H.src=""}return H}}f()}return H},e.ReadFile=function(D,w,N,F,k){var j=new FileReader,G={onCompleteObservable:new z.c,abort:function(){return j.abort()}};return j.onloadend=function(D){return G.onCompleteObservable.notifyObservers(G)},k&&(j.onerror=function(w){k(new ie("Unable to read "+D.name,D))}),j.onload=function(D){w(D.target.result)},N&&(j.onprogress=N),F?j.readAsArrayBuffer(D):j.readAsText(D),G},e.LoadFile=function(D,w,N,F,k,j){if(-1!==D.indexOf("file:")){var z=decodeURIComponent(D.substring(5).toLowerCase());0===z.indexOf("./")&&(z=z.substring(2));var H=G.a.FilesToLoad[z];if(H)return e.ReadFile(H,w,N,k,j?function(D){return j(void 0,new $(D.message,D.file))}:void 0)}return e.RequestFile(D,(function(D,N){w(D,N?N.responseURL:void 0)}),N,F,k,j?function(D){j(D.request,new $(D.message,D.request))}:void 0)},e.RequestFile=function(D,w,N,F,G,H,X){D=e._CleanUrl(D),D=e.PreprocessUrl(D);var q=e.BaseUrl+D,Z=!1,J={onCompleteObservable:new z.c,abort:function(){return Z=!0}},_=function(){var D=new k.a,F=null;J.abort=function(){Z=!0,D.readyState!==(XMLHttpRequest.DONE||4)&&D.abort(),null!==F&&(clearTimeout(F),F=null)};var s=function(z){D.open("GET",q),X&&X(D),G&&(D.responseType="arraybuffer"),N&&D.addEventListener("progress",N);var m=function(){D.removeEventListener("loadend",m),J.onCompleteObservable.notifyObservers(J),J.onCompleteObservable.clear()};D.addEventListener("loadend",m);var g=function(){if(!Z&&D.readyState===(XMLHttpRequest.DONE||4)){if(D.removeEventListener("readystatechange",g),D.status>=200&&D.status<300||0===D.status&&(!j.a.IsWindowObjectExist()||e.IsFileURL()))return void w(G?D.response:D.responseText,D);var N=e.DefaultRetryStrategy;if(N){var X=N(q,D,z);if(-1!==X)return D.removeEventListener("loadend",m),D=new k.a,void(F=setTimeout((function(){return s(z+1)}),X))}var J=new te("Error status: "+D.status+" "+D.statusText+" - Unable to load "+q,D);H&&H(J)}};D.addEventListener("readystatechange",g),D.send()};s(0)};if(F&&F.enableSceneOffline){var m=function(D){D&&D.status>400?H&&H(D):_()};F.open((function(){F&&F.loadFile(e.BaseUrl+D,(function(D){Z||w(D),J.onCompleteObservable.notifyObservers(J)}),N?function(D){Z||N(D)}:void 0,m,G)}),m)}else _();return J},e.IsFileURL=function(){return"file:"===location.protocol},e.DefaultRetryStrategy=H.a.ExponentialBackoff(),e.BaseUrl="",e.CorsBehavior="anonymous",e.PreprocessUrl=function(D){return D},e}();Z.a._FileToolsLoadImage=oe.LoadImage.bind(oe),Z.a._FileToolsLoadFile=oe.LoadFile.bind(oe),J.a._FileToolsLoadFile=oe.LoadFile.bind(oe)},function(D,w,N){"use strict";N.d(w,"a",(function(){return k}));var F=N(0),k=function(){function e(){}return e._RemoveAndStorePivotPoint=function(D){D&&0===e._PivotCached&&(D.getPivotPointToRef(e._OldPivotPoint),e._OldPivotPoint.equalsToFloats(0,0,0)||(D.setPivotMatrix(F.a.IdentityReadOnly),e._OldPivotPoint.subtractToRef(D.getPivotPoint(),e._PivotTranslation),e._PivotTmpVector.copyFromFloats(1,1,1),e._PivotTmpVector.subtractInPlace(D.scaling),e._PivotTmpVector.multiplyInPlace(e._PivotTranslation),D.position.addInPlace(e._PivotTmpVector))),e._PivotCached++},e._RestorePivotPoint=function(D){D&&!e._OldPivotPoint.equalsToFloats(0,0,0)&&1===e._PivotCached&&(D.setPivotPoint(e._OldPivotPoint),e._PivotTmpVector.copyFromFloats(1,1,1),e._PivotTmpVector.subtractInPlace(D.scaling),e._PivotTmpVector.multiplyInPlace(e._PivotTranslation),D.position.subtractInPlace(e._PivotTmpVector)),this._PivotCached--},e._PivotCached=0,e._OldPivotPoint=new F.e,e._PivotTranslation=new F.e,e._PivotTmpVector=new F.e,e}()},function(D,w,N){"use strict";N.d(w,"a",(function(){return z}));var F=N(0),k=N(5),j=N(41),z=function(){function e(D){var w=this;void 0===D&&(D=j.a.DefaultUtilityLayer),this.gizmoLayer=D,this._attachedMesh=null,this.scaleRatio=1,this._customMeshSet=!1,this.updateGizmoRotationToMatchAttachedMesh=!0,this.updateGizmoPositionToMatchAttachedMesh=!0,this.updateScale=!0,this._interactionsEnabled=!0,this._tempVector=new F.e,this._rootMesh=new k.a("gizmoRootNode",D.utilityLayerScene),this._rootMesh.rotationQuaternion=F.b.Identity(),this._beforeRenderObserver=this.gizmoLayer.utilityLayerScene.onBeforeRenderObservable.add((function(){w._update()}))}return Object.defineProperty(e.prototype,"attachedMesh",{get:function(){return this._attachedMesh},set:function(D){this._attachedMesh=D,this._rootMesh.setEnabled(!!D),this._attachedMeshChanged(D)},enumerable:!0,configurable:!0}),e.prototype.setCustomMesh=function(D){if(D.getScene()!=this.gizmoLayer.utilityLayerScene)throw"When setting a custom mesh on a gizmo, the custom meshes scene must be the same as the gizmos (eg. gizmo.gizmoLayer.utilityLayerScene)";this._rootMesh.getChildMeshes().forEach((function(D){D.dispose()})),D.parent=this._rootMesh,this._customMeshSet=!0},e.prototype._attachedMeshChanged=function(D){},e.prototype._update=function(){if(this.attachedMesh){var D=this.attachedMesh._effectiveMesh||this.attachedMesh;if(this.updateGizmoPositionToMatchAttachedMesh&&this._rootMesh.position.copyFrom(D.absolutePosition),this.updateGizmoRotationToMatchAttachedMesh?D.getWorldMatrix().decompose(void 0,this._rootMesh.rotationQuaternion):this._rootMesh.rotationQuaternion.set(0,0,0,1),this.updateScale){var w=this.gizmoLayer.utilityLayerScene.activeCamera,N=w.globalPosition;w.devicePosition&&(N=w.devicePosition),this._rootMesh.position.subtractToRef(N,this._tempVector);var F=this._tempVector.length()*this.scaleRatio;this._rootMesh.scaling.set(F,F,F),D._getWorldMatrixDeterminant()<0&&(this._rootMesh.scaling.y*=-1)}else this._rootMesh.scaling.setAll(this.scaleRatio)}},e.prototype.dispose=function(){this._rootMesh.dispose(),this._beforeRenderObserver&&this.gizmoLayer.utilityLayerScene.onBeforeRenderObservable.remove(this._beforeRenderObserver)},e}()},function(D,w,N){"use strict";N.d(w,"a",(function(){return X})),N.d(w,"b",(function(){return q}));var F=N(1),k=N(4),j=N(105),z=N(44),G=N(2),H=N(110),X=function(){function e(){this._materialDefines=null,this._materialEffect=null}return Object.defineProperty(e.prototype,"materialDefines",{get:function(){return this._materialDefines},set:function(D){this._materialDefines=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"effect",{get:function(){return this._materialEffect},enumerable:!0,configurable:!0}),e.prototype.setEffect=function(D,w){void 0===w&&(w=null),this._materialEffect!==D?(this._materialDefines=w,this._materialEffect=D):D||(this._materialDefines=null)},e}(),q=function(D){function t(w,N,F,k,j,z,G,H){void 0===H&&(H=!0);var X=D.call(this)||this;return X.materialIndex=w,X.verticesStart=N,X.verticesCount=F,X.indexStart=k,X.indexCount=j,X._linesIndexCount=0,X._linesIndexBuffer=null,X._lastColliderWorldVertices=null,X._lastColliderTransformMatrix=null,X._renderId=0,X._alphaIndex=0,X._distanceToCamera=0,X._currentMaterial=null,X._mesh=z,X._renderingMesh=G||z,z.subMeshes.push(X),X._trianglePlanes=[],X._id=z.subMeshes.length-1,H&&(X.refreshBoundingInfo(),z.computeWorldMatrix(!0)),X}return Object(F.d)(t,D),t.AddToMesh=function(D,w,N,F,k,j,z,G){return void 0===G&&(G=!0),new t(D,w,N,F,k,j,z,G)},Object.defineProperty(t.prototype,"IsGlobal",{get:function(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()},enumerable:!0,configurable:!0}),t.prototype.getBoundingInfo=function(){return this.IsGlobal?this._mesh.getBoundingInfo():this._boundingInfo},t.prototype.setBoundingInfo=function(D){return this._boundingInfo=D,this},t.prototype.getMesh=function(){return this._mesh},t.prototype.getRenderingMesh=function(){return this._renderingMesh},t.prototype.getMaterial=function(){var D=this._renderingMesh.material;if(null==D)return this._mesh.getScene().defaultMaterial;if(D.getSubMaterial){var w=D.getSubMaterial(this.materialIndex);return this._currentMaterial!==w&&(this._currentMaterial=w,this._materialDefines=null),w}return D},t.prototype.refreshBoundingInfo=function(D){if(void 0===D&&(D=null),this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.geometry)return this;if(D||(D=this._renderingMesh.getVerticesData(k.b.PositionKind)),!D)return this._boundingInfo=this._mesh.getBoundingInfo(),this;var w,N=this._renderingMesh.getIndices();if(0===this.indexStart&&this.indexCount===N.length){var F=this._renderingMesh.getBoundingInfo();w={minimum:F.minimum.clone(),maximum:F.maximum.clone()}}else w=Object(H.b)(D,N,this.indexStart,this.indexCount,this._renderingMesh.geometry.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(w.minimum,w.maximum):this._boundingInfo=new z.a(w.minimum,w.maximum),this},t.prototype._checkCollision=function(D){return this.getBoundingInfo()._checkCollision(D)},t.prototype.updateBoundingInfo=function(D){var w=this.getBoundingInfo();return w||(this.refreshBoundingInfo(),w=this.getBoundingInfo()),w&&w.update(D),this},t.prototype.isInFrustum=function(D){var w=this.getBoundingInfo();return!!w&&w.isInFrustum(D,this._mesh.cullingStrategy)},t.prototype.isCompletelyInFrustum=function(D){var w=this.getBoundingInfo();return!!w&&w.isCompletelyInFrustum(D)},t.prototype.render=function(D){return this._renderingMesh.render(this,D,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this},t.prototype._getLinesIndexBuffer=function(D,w){if(!this._linesIndexBuffer){for(var N=[],F=this.indexStart;F<this.indexStart+this.indexCount;F+=3)N.push(D[F],D[F+1],D[F+1],D[F+2],D[F+2],D[F]);this._linesIndexBuffer=w.createIndexBuffer(N),this._linesIndexCount=N.length}return this._linesIndexBuffer},t.prototype.canIntersects=function(D){var w=this.getBoundingInfo();return!!w&&D.intersectsBox(w.boundingBox)},t.prototype.intersects=function(D,w,N,F,k){var j=this.getMaterial();if(!j)return null;var z=3,H=!1;switch(j.fillMode){case G.a.MATERIAL_PointListDrawMode:case G.a.MATERIAL_LineListDrawMode:case G.a.MATERIAL_LineLoopDrawMode:case G.a.MATERIAL_LineStripDrawMode:case G.a.MATERIAL_TriangleFanDrawMode:return null;case G.a.MATERIAL_TriangleStripDrawMode:z=1,H=!0}return"InstancedLinesMesh"===this._mesh.getClassName()||"LinesMesh"===this._mesh.getClassName()?N.length?this._intersectLines(D,w,N,this._mesh.intersectionThreshold,F):this._intersectUnIndexedLines(D,w,N,this._mesh.intersectionThreshold,F):!N.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(D,w,N,F,k):this._intersectTriangles(D,w,N,z,H,F,k)},t.prototype._intersectLines=function(D,w,N,F,k){for(var z=null,G=this.indexStart;G<this.indexStart+this.indexCount;G+=2){var H=w[N[G]],X=w[N[G+1]],q=D.intersectionSegment(H,X,F);if(!(q<0)&&(k||!z||q<z.distance)&&((z=new j.a(null,null,q)).faceId=G/2,k))break}return z},t.prototype._intersectUnIndexedLines=function(D,w,N,F,k){for(var z=null,G=this.verticesStart;G<this.verticesStart+this.verticesCount;G+=2){var H=w[G],X=w[G+1],q=D.intersectionSegment(H,X,F);if(!(q<0)&&(k||!z||q<z.distance)&&((z=new j.a(null,null,q)).faceId=G/2,k))break}return z},t.prototype._intersectTriangles=function(D,w,N,F,k,j,z){for(var G=null,H=-1,X=this.indexStart;X<this.indexStart+this.indexCount;X+=F){H++;var q=N[X],Z=N[X+1],J=N[X+2];if(k&&4294967295===J)X+=2;else{var $=w[q],te=w[Z],ie=w[J];if(!z||z($,te,ie,D)){var oe=D.intersectsTriangle($,te,ie);if(oe){if(oe.distance<0)continue;if((j||!G||oe.distance<G.distance)&&((G=oe).faceId=H,j))break}}}}return G},t.prototype._intersectUnIndexedTriangles=function(D,w,N,F,k){for(var j=null,z=this.verticesStart;z<this.verticesStart+this.verticesCount;z+=3){var G=w[z],H=w[z+1],X=w[z+2];if(!k||k(G,H,X,D)){var q=D.intersectsTriangle(G,H,X);if(q){if(q.distance<0)continue;if((F||!j||q.distance<j.distance)&&((j=q).faceId=z/3,F))break}}}return j},t.prototype._rebuild=function(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)},t.prototype.clone=function(D,w){var N=new t(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,D,w,!1);if(!this.IsGlobal){var F=this.getBoundingInfo();if(!F)return N;N._boundingInfo=new z.a(F.minimum,F.maximum)}return N},t.prototype.dispose=function(){this._linesIndexBuffer&&(this._mesh.getScene().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);var D=this._mesh.subMeshes.indexOf(this);this._mesh.subMeshes.splice(D,1)},t.prototype.getClassName=function(){return"SubMesh"},t.CreateFromIndices=function(D,w,N,F,k){for(var j=Number.MAX_VALUE,z=-Number.MAX_VALUE,G=(k||F).getIndices(),H=w;H<w+N;H++){var X=G[H];X<j&&(j=X),X>z&&(z=X)}return new t(D,j,z-j+1,w,N,F,k)},t}(X)},function(D,w,N){"use strict";N(8).a.IncludesShadersStore.helperFunctions="const float PI=3.1415926535897932384626433832795;\nconst float LinearEncodePowerApprox=2.2;\nconst float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;\nconst vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);\nconst float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {\nvec3 i0=inMatrix[0];\nvec3 i1=inMatrix[1];\nvec3 i2=inMatrix[2];\nmat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);\nreturn outMatrix;\n}\n\nmat3 inverseMat3(mat3 inMatrix) {\nfloat a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];\nfloat a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];\nfloat a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];\nfloat b01=a22*a11-a12*a21;\nfloat b11=-a22*a10+a12*a20;\nfloat b21=a21*a10-a11*a20;\nfloat det=a00*b01+a01*b11+a02*b21;\nreturn mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;\n}\nvec3 toLinearSpace(vec3 color)\n{\nreturn pow(color,vec3(LinearEncodePowerApprox));\n}\nvec3 toGammaSpace(vec3 color)\n{\nreturn pow(color,vec3(GammaEncodePowerApprox));\n}\nfloat toGammaSpace(float color)\n{\nreturn pow(color,GammaEncodePowerApprox);\n}\nfloat square(float value)\n{\nreturn value*value;\n}\nfloat pow5(float value) {\nfloat sq=value*value;\nreturn sq*sq*value;\n}\nfloat getLuminance(vec3 color)\n{\nreturn clamp(dot(color,LuminanceEncodeApprox),0.,1.);\n}\n\nfloat getRand(vec2 seed) {\nreturn fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);\n}\nfloat dither(vec2 seed,float varianceAmount) {\nfloat rand=getRand(seed);\nfloat dither=mix(-varianceAmount/255.0,varianceAmount/255.0,rand);\nreturn dither;\n}\n\nconst float rgbdMaxRange=255.0;\nvec4 toRGBD(vec3 color) {\nfloat maxRGB=maxEps(max(color.r,max(color.g,color.b)));\nfloat D=max(rgbdMaxRange/maxRGB,1.);\nD=clamp(floor(D)/255.0,0.,1.);\n\nvec3 rgb=color.rgb*D;\n\nrgb=toGammaSpace(rgb);\nreturn vec4(rgb,D);\n}\nvec3 fromRGBD(vec4 rgbd) {\n\nrgbd.rgb=toLinearSpace(rgbd.rgb);\n\nreturn rgbd.rgb/rgbd.a;\n}\n"},function(D,w,N){"use strict";N.d(w,"a",(function(){return X}));var F=N(0),k=N(10),j=N(5),z=N(15),G=N(18),H=N(22);z.a.CreateCylinder=function(D){var w=D.height||2,N=0===D.diameterTop?0:D.diameterTop||D.diameter||1,G=0===D.diameterBottom?0:D.diameterBottom||D.diameter||1;N=N||1e-5,G=G||1e-5;var X,q=D.tessellation||24,Z=D.subdivisions||1,J=!!D.hasRings,$=!!D.enclose,te=0===D.cap?0:D.cap||j.a.CAP_ALL,ie=D.arc&&(D.arc<=0||D.arc>1)?1:D.arc||1,oe=0===D.sideOrientation?0:D.sideOrientation||z.a.DEFAULTSIDE,ce=D.faceUV||new Array(3),he=D.faceColors,fe=2+(1+(1!==ie&&$?2:0))*(J?Z:1);for(X=0;X<fe;X++)he&&void 0===he[X]&&(he[X]=new k.b(1,1,1,1));for(X=0;X<fe;X++)ce&&void 0===ce[X]&&(ce[X]=new F.f(0,0,1,1));var pe,_e,ve,ye,be,Te,Ee=new Array,Se=new Array,Me=new Array,xe=new Array,Ae=new Array,Pe=2*Math.PI*ie/q,Oe=(G-N)/2/w,Re=F.e.Zero(),De=F.e.Zero(),Ie=F.e.Zero(),Le=F.e.Zero(),we=F.e.Zero(),Ne=H.a.Y,Fe=1,Be=1,Ue=0,Ve=0;for(ye=0;ye<=Z;ye++)for(ve=((_e=ye/Z)*(N-G)+G)/2,Fe=J&&0!==ye&&ye!==Z?2:1,Te=0;Te<Fe;Te++){for(J&&(Be+=Te),$&&(Be+=2*Te),be=0;be<=q;be++)pe=be*Pe,Re.x=Math.cos(-pe)*ve,Re.y=-w/2+_e*w,Re.z=Math.sin(-pe)*ve,0===N&&ye===Z?(De.x=Me[Me.length-3*(q+1)],De.y=Me[Me.length-3*(q+1)+1],De.z=Me[Me.length-3*(q+1)+2]):(De.x=Re.x,De.z=Re.z,De.y=Math.sqrt(De.x*De.x+De.z*De.z)*Oe,De.normalize()),0===be&&(Ie.copyFrom(Re),Le.copyFrom(De)),Se.push(Re.x,Re.y,Re.z),Me.push(De.x,De.y,De.z),Ve=J?Ue!==Be?ce[Be].y:ce[Be].w:ce[Be].y+(ce[Be].w-ce[Be].y)*_e,xe.push(ce[Be].x+(ce[Be].z-ce[Be].x)*be/q,Ve),he&&Ae.push(he[Be].r,he[Be].g,he[Be].b,he[Be].a);1!==ie&&$&&(Se.push(Re.x,Re.y,Re.z),Se.push(0,Re.y,0),Se.push(0,Re.y,0),Se.push(Ie.x,Ie.y,Ie.z),F.e.CrossToRef(Ne,De,we),we.normalize(),Me.push(we.x,we.y,we.z,we.x,we.y,we.z),F.e.CrossToRef(Le,Ne,we),we.normalize(),Me.push(we.x,we.y,we.z,we.x,we.y,we.z),Ve=J?Ue!==Be?ce[Be+1].y:ce[Be+1].w:ce[Be+1].y+(ce[Be+1].w-ce[Be+1].y)*_e,xe.push(ce[Be+1].x,Ve),xe.push(ce[Be+1].z,Ve),Ve=J?Ue!==Be?ce[Be+2].y:ce[Be+2].w:ce[Be+2].y+(ce[Be+2].w-ce[Be+2].y)*_e,xe.push(ce[Be+2].x,Ve),xe.push(ce[Be+2].z,Ve),he&&(Ae.push(he[Be+1].r,he[Be+1].g,he[Be+1].b,he[Be+1].a),Ae.push(he[Be+1].r,he[Be+1].g,he[Be+1].b,he[Be+1].a),Ae.push(he[Be+2].r,he[Be+2].g,he[Be+2].b,he[Be+2].a),Ae.push(he[Be+2].r,he[Be+2].g,he[Be+2].b,he[Be+2].a))),Ue!==Be&&(Ue=Be)}var ze=1!==ie&&$?q+4:q;for(ye=0,Be=0;Be<Z;Be++){var Ge=0,Ye=0,He=0,We=0;for(be=0;be<q;be++)Ge=ye*(ze+1)+be,Ye=(ye+1)*(ze+1)+be,He=ye*(ze+1)+(be+1),We=(ye+1)*(ze+1)+(be+1),Ee.push(Ge,Ye,He),Ee.push(We,He,Ye);1!==ie&&$&&(Ee.push(Ge+2,Ye+2,He+2),Ee.push(We+2,He+2,Ye+2),Ee.push(Ge+4,Ye+4,He+4),Ee.push(We+4,He+4,Ye+4)),ye=J?ye+2:ye+1}var K=function(D){var k=D?N/2:G/2;if(0!==k){var j,z,H,X=D?ce[fe-1]:ce[0],Z=null;he&&(Z=D?he[fe-1]:he[0]);var J=Se.length/3,$=D?w/2:-w/2,te=new F.e(0,$,0);Se.push(te.x,te.y,te.z),Me.push(0,D?1:-1,0),xe.push(X.x+.5*(X.z-X.x),X.y+.5*(X.w-X.y)),Z&&Ae.push(Z.r,Z.g,Z.b,Z.a);var oe=new F.d(.5,.5);for(H=0;H<=q;H++){j=2*Math.PI*H*ie/q;var pe=Math.cos(-j),_e=Math.sin(-j);z=new F.e(pe*k,$,_e*k);var ve=new F.d(pe*oe.x+.5,_e*oe.y+.5);Se.push(z.x,z.y,z.z),Me.push(0,D?1:-1,0),xe.push(X.x+(X.z-X.x)*ve.x,X.y+(X.w-X.y)*ve.y),Z&&Ae.push(Z.r,Z.g,Z.b,Z.a)}for(H=0;H<q;H++)D?(Ee.push(J),Ee.push(J+(H+2)),Ee.push(J+(H+1))):(Ee.push(J),Ee.push(J+(H+1)),Ee.push(J+(H+2)))}};te!==j.a.CAP_START&&te!==j.a.CAP_ALL||K(!1),te!==j.a.CAP_END&&te!==j.a.CAP_ALL||K(!0),z.a._ComputeSides(oe,Se,Ee,Me,xe,D.frontUVs,D.backUVs);var Xe=new z.a;return Xe.indices=Ee,Xe.positions=Se,Xe.normals=Me,Xe.uvs=xe,he&&(Xe.colors=Ae),Xe},j.a.CreateCylinder=function(D,w,N,F,k,z,H,q,Z){void 0!==H&&H instanceof G.a||(void 0!==H&&(Z=q||j.a.DEFAULTSIDE,q=H),H=z,z=1);var J={height:w,diameterTop:N,diameterBottom:F,tessellation:k,subdivisions:z,sideOrientation:Z,updatable:q};return X.CreateCylinder(D,J,H)};var X=function(){function e(){}return e.CreateCylinder=function(D,w,N){var F=new j.a(D,N);return w.sideOrientation=j.a._GetDefaultSideOrientation(w.sideOrientation),F._originalBuilderSideOrientation=w.sideOrientation,z.a.CreateCylinder(w).applyToMesh(F,w.updatable),F},e}()},function(D,w,N){"use strict";N.d(w,"a",(function(){return k}));var F=N(0),k=function(){function e(D,w,N,k){this.normal=new F.e(D,w,N),this.d=k}return e.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},e.prototype.clone=function(){return new e(this.normal.x,this.normal.y,this.normal.z,this.d)},e.prototype.getClassName=function(){return"Plane"},e.prototype.getHashCode=function(){var D=this.normal.getHashCode();return 397*D^(0|this.d)},e.prototype.normalize=function(){var D=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),w=0;return 0!==D&&(w=1/D),this.normal.x*=w,this.normal.y*=w,this.normal.z*=w,this.d*=w,this},e.prototype.transform=function(D){var w=e._TmpMatrix;F.a.TransposeToRef(D,w);var N=w.m,k=this.normal.x,j=this.normal.y,z=this.normal.z,G=this.d;return new e(k*N[0]+j*N[1]+z*N[2]+G*N[3],k*N[4]+j*N[5]+z*N[6]+G*N[7],k*N[8]+j*N[9]+z*N[10]+G*N[11],k*N[12]+j*N[13]+z*N[14]+G*N[15])},e.prototype.dotCoordinate=function(D){return this.normal.x*D.x+this.normal.y*D.y+this.normal.z*D.z+this.d},e.prototype.copyFromPoints=function(D,w,N){var F,k=w.x-D.x,j=w.y-D.y,z=w.z-D.z,G=N.x-D.x,H=N.y-D.y,X=N.z-D.z,q=j*X-z*H,Z=z*G-k*X,J=k*H-j*G,$=Math.sqrt(q*q+Z*Z+J*J);return F=0!==$?1/$:0,this.normal.x=q*F,this.normal.y=Z*F,this.normal.z=J*F,this.d=-(this.normal.x*D.x+this.normal.y*D.y+this.normal.z*D.z),this},e.prototype.isFrontFacingTo=function(D,w){return F.e.Dot(this.normal,D)<=w},e.prototype.signedDistanceTo=function(D){return F.e.Dot(D,this.normal)+this.d},e.FromArray=function(D){return new e(D[0],D[1],D[2],D[3])},e.FromPoints=function(D,w,N){var F=new e(0,0,0,0);return F.copyFromPoints(D,w,N),F},e.FromPositionAndNormal=function(D,w){var N=new e(0,0,0,0);return w.normalize(),N.normal=w,N.d=-(w.x*D.x+w.y*D.y+w.z*D.z),N},e.SignedDistanceToPlaneFromPositionAndNormal=function(D,w,N){var k=-(w.x*D.x+w.y*D.y+w.z*D.z);return F.e.Dot(N,w)+k},e._TmpMatrix=F.a.Identity(),e}()},function(D,w,N){"use strict";N.d(w,"a",(function(){return F}));var F=function(){function e(D,w,N,F){this.x=D,this.y=w,this.width=N,this.height=F}return e.prototype.toGlobal=function(D,w){return new e(this.x*D,this.y*w,this.width*D,this.height*w)},e.prototype.toGlobalToRef=function(D,w,N){return N.x=this.x*D,N.y=this.y*w,N.width=this.width*D,N.height=this.height*w,this},e.prototype.clone=function(){return new e(this.x,this.y,this.width,this.height)},e}()},function(D,w,N){"use strict";N.d(w,"a",(function(){return q}));var F=N(5),k=N(18),j=N(6),z=N(0),G=N(20),H=N(39),X=N(55),q=(N(79),function(){function e(D){this._useAlternatePickedPointAboveMaxDragAngleDragSpeed=-1.1,this.maxDragAngle=0,this._useAlternatePickedPointAboveMaxDragAngle=!1,this.currentDraggingPointerID=-1,this.dragging=!1,this.dragDeltaRatio=.2,this.updateDragPlane=!0,this._debugMode=!1,this._moving=!1,this.onDragObservable=new j.c,this.onDragStartObservable=new j.c,this.onDragEndObservable=new j.c,this.moveAttached=!0,this.enabled=!0,this.startAndReleaseDragOnPointerEvents=!0,this.detachCameraControls=!0,this.useObjectOrientationForDragging=!0,this.validateDrag=function(D){return!0},this._tmpVector=new z.e(0,0,0),this._alternatePickedPoint=new z.e(0,0,0),this._worldDragAxis=new z.e(0,0,0),this._targetPosition=new z.e(0,0,0),this._attachedElement=null,this._startDragRay=new H.a(new z.e,new z.e),this._lastPointerRay={},this._dragDelta=new z.e,this._pointA=new z.e(0,0,0),this._pointB=new z.e(0,0,0),this._pointC=new z.e(0,0,0),this._lineA=new z.e(0,0,0),this._lineB=new z.e(0,0,0),this._localAxis=new z.e(0,0,0),this._lookAt=new z.e(0,0,0),this._options=D||{};var w=0;if(this._options.dragAxis&&w++,this._options.dragPlaneNormal&&w++,w>1)throw"Multiple drag modes specified in dragBehavior options. Only one expected"}return Object.defineProperty(e.prototype,"options",{get:function(){return this._options},set:function(D){this._options=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return"PointerDrag"},enumerable:!0,configurable:!0}),e.prototype.init=function(){},e.prototype.attach=function(D,w){var N=this;this._scene=D.getScene(),this.attachedNode=D,e._planeScene||(this._debugMode?e._planeScene=this._scene:(e._planeScene=new k.a(this._scene.getEngine(),{virtual:!0}),e._planeScene.detachControl(),this._scene.onDisposeObservable.addOnce((function(){e._planeScene.dispose(),e._planeScene=null})))),this._dragPlane=F.a.CreatePlane("pointerDragPlane",this._debugMode?1:1e4,e._planeScene,!1,F.a.DOUBLESIDE),this.lastDragPosition=new z.e(0,0,0);var j=w||function(D){return N.attachedNode==D||D.isDescendantOf(N.attachedNode)};this._pointerObserver=this._scene.onPointerObservable.add((function(D,w){if(N.enabled)if(D.type==G.a.POINTERDOWN)N.startAndReleaseDragOnPointerEvents&&!N.dragging&&D.pickInfo&&D.pickInfo.hit&&D.pickInfo.pickedMesh&&D.pickInfo.pickedPoint&&D.pickInfo.ray&&j(D.pickInfo.pickedMesh)&&N._startDrag(D.event.pointerId,D.pickInfo.ray,D.pickInfo.pickedPoint);else if(D.type==G.a.POINTERUP)N.startAndReleaseDragOnPointerEvents&&N.currentDraggingPointerID==D.event.pointerId&&N.releaseDrag();else if(D.type==G.a.POINTERMOVE){var F=D.event.pointerId;N.currentDraggingPointerID===e._AnyMouseID&&F!==e._AnyMouseID&&"mouse"==D.event.pointerType&&(N._lastPointerRay[N.currentDraggingPointerID]&&(N._lastPointerRay[F]=N._lastPointerRay[N.currentDraggingPointerID],delete N._lastPointerRay[N.currentDraggingPointerID]),N.currentDraggingPointerID=F),N._lastPointerRay[F]||(N._lastPointerRay[F]=new H.a(new z.e,new z.e)),D.pickInfo&&D.pickInfo.ray&&(N._lastPointerRay[F].origin.copyFrom(D.pickInfo.ray.origin),N._lastPointerRay[F].direction.copyFrom(D.pickInfo.ray.direction),N.currentDraggingPointerID==F&&N.dragging&&N._moveDrag(D.pickInfo.ray))}})),this._beforeRenderObserver=this._scene.onBeforeRenderObservable.add((function(){N._moving&&N.moveAttached&&(X.a._RemoveAndStorePivotPoint(N.attachedNode),N._targetPosition.subtractToRef(N.attachedNode.absolutePosition,N._tmpVector),N._tmpVector.scaleInPlace(N.dragDeltaRatio),N.attachedNode.getAbsolutePosition().addToRef(N._tmpVector,N._tmpVector),N.validateDrag(N._tmpVector)&&N.attachedNode.setAbsolutePosition(N._tmpVector),X.a._RestorePivotPoint(N.attachedNode))}))},e.prototype.releaseDrag=function(){this.dragging&&(this.onDragEndObservable.notifyObservers({dragPlanePoint:this.lastDragPosition,pointerId:this.currentDraggingPointerID}),this.dragging=!1),this.currentDraggingPointerID=-1,this._moving=!1,this.detachCameraControls&&this._attachedElement&&this._scene.activeCamera&&!this._scene.activeCamera.leftCamera&&this._scene.activeCamera.attachControl(this._attachedElement,!this._scene.activeCamera.inputs||this._scene.activeCamera.inputs.noPreventDefault)},e.prototype.startDrag=function(D,w,N){void 0===D&&(D=e._AnyMouseID),this._startDrag(D,w,N);var F=this._lastPointerRay[D];D===e._AnyMouseID&&(F=this._lastPointerRay[Object.keys(this._lastPointerRay)[0]]),F&&this._moveDrag(F)},e.prototype._startDrag=function(D,w,N){if(this._scene.activeCamera&&!this.dragging&&this.attachedNode){X.a._RemoveAndStorePivotPoint(this.attachedNode),w?(this._startDragRay.direction.copyFrom(w.direction),this._startDragRay.origin.copyFrom(w.origin)):(this._startDragRay.origin.copyFrom(this._scene.activeCamera.position),this.attachedNode.getWorldMatrix().getTranslationToRef(this._tmpVector),this._tmpVector.subtractToRef(this._scene.activeCamera.position,this._startDragRay.direction)),this._updateDragPlanePosition(this._startDragRay,N||this._tmpVector);var F=this._pickWithRayOnDragPlane(this._startDragRay);F&&(this.dragging=!0,this.currentDraggingPointerID=D,this.lastDragPosition.copyFrom(F),this.onDragStartObservable.notifyObservers({dragPlanePoint:F,pointerId:this.currentDraggingPointerID}),this._targetPosition.copyFrom(this.attachedNode.absolutePosition),this.detachCameraControls&&this._scene.activeCamera&&this._scene.activeCamera.inputs&&!this._scene.activeCamera.leftCamera&&(this._scene.activeCamera.inputs.attachedElement?(this._attachedElement=this._scene.activeCamera.inputs.attachedElement,this._scene.activeCamera.detachControl(this._scene.activeCamera.inputs.attachedElement)):this._attachedElement=null)),X.a._RestorePivotPoint(this.attachedNode)}},e.prototype._moveDrag=function(D){this._moving=!0;var w=this._pickWithRayOnDragPlane(D);if(w){this.updateDragPlane&&this._updateDragPlanePosition(D,w);var N=0;this._options.dragAxis?(this.useObjectOrientationForDragging?z.e.TransformCoordinatesToRef(this._options.dragAxis,this.attachedNode.getWorldMatrix().getRotationMatrix(),this._worldDragAxis):this._worldDragAxis.copyFrom(this._options.dragAxis),w.subtractToRef(this.lastDragPosition,this._tmpVector),N=z.e.Dot(this._tmpVector,this._worldDragAxis),this._worldDragAxis.scaleToRef(N,this._dragDelta)):(N=this._dragDelta.length(),w.subtractToRef(this.lastDragPosition,this._dragDelta)),this._targetPosition.addInPlace(this._dragDelta),this.onDragObservable.notifyObservers({dragDistance:N,delta:this._dragDelta,dragPlanePoint:w,dragPlaneNormal:this._dragPlane.forward,pointerId:this.currentDraggingPointerID}),this.lastDragPosition.copyFrom(w)}},e.prototype._pickWithRayOnDragPlane=function(D){var w=this;if(!D)return null;var N=Math.acos(z.e.Dot(this._dragPlane.forward,D.direction));if(N>Math.PI/2&&(N=Math.PI-N),this.maxDragAngle>0&&N>this.maxDragAngle){if(this._useAlternatePickedPointAboveMaxDragAngle){this._tmpVector.copyFrom(D.direction),this.attachedNode.absolutePosition.subtractToRef(D.origin,this._alternatePickedPoint),this._alternatePickedPoint.normalize(),this._alternatePickedPoint.scaleInPlace(this._useAlternatePickedPointAboveMaxDragAngleDragSpeed*z.e.Dot(this._alternatePickedPoint,this._tmpVector)),this._tmpVector.addInPlace(this._alternatePickedPoint);var F=z.e.Dot(this._dragPlane.forward,this._tmpVector);return this._dragPlane.forward.scaleToRef(-F,this._alternatePickedPoint),this._alternatePickedPoint.addInPlace(this._tmpVector),this._alternatePickedPoint.addInPlace(this.attachedNode.absolutePosition),this._alternatePickedPoint}return null}var k=e._planeScene.pickWithRay(D,(function(D){return D==w._dragPlane}));return k&&k.hit&&k.pickedMesh&&k.pickedPoint?k.pickedPoint:null},e.prototype._updateDragPlanePosition=function(D,w){this._pointA.copyFrom(w),this._options.dragAxis?(this.useObjectOrientationForDragging?z.e.TransformCoordinatesToRef(this._options.dragAxis,this.attachedNode.getWorldMatrix().getRotationMatrix(),this._localAxis):this._localAxis.copyFrom(this._options.dragAxis),this._pointA.addToRef(this._localAxis,this._pointB),D.origin.subtractToRef(this._pointA,this._pointC),this._pointA.addToRef(this._pointC.normalize(),this._pointC),this._pointB.subtractToRef(this._pointA,this._lineA),this._pointC.subtractToRef(this._pointA,this._lineB),z.e.CrossToRef(this._lineA,this._lineB,this._lookAt),z.e.CrossToRef(this._lineA,this._lookAt,this._lookAt),this._lookAt.normalize(),this._dragPlane.position.copyFrom(this._pointA),this._pointA.addToRef(this._lookAt,this._lookAt),this._dragPlane.lookAt(this._lookAt)):this._options.dragPlaneNormal?(this.useObjectOrientationForDragging?z.e.TransformCoordinatesToRef(this._options.dragPlaneNormal,this.attachedNode.getWorldMatrix().getRotationMatrix(),this._localAxis):this._localAxis.copyFrom(this._options.dragPlaneNormal),this._dragPlane.position.copyFrom(this._pointA),this._pointA.addToRef(this._localAxis,this._lookAt),this._dragPlane.lookAt(this._lookAt)):(this._dragPlane.position.copyFrom(this._pointA),this._dragPlane.lookAt(D.origin)),this._dragPlane.position.copyFrom(this.attachedNode.absolutePosition),this._dragPlane.computeWorldMatrix(!0)},e.prototype.detach=function(){this._pointerObserver&&this._scene.onPointerObservable.remove(this._pointerObserver),this._beforeRenderObserver&&this._scene.onBeforeRenderObservable.remove(this._beforeRenderObserver),this.releaseDrag()},e._AnyMouseID=-2,e}())},function(D,w,N){"use strict";N.d(w,"a",(function(){return k})),N.d(w,"b",(function(){return o})),N.d(w,"c",(function(){return j}));var F=N(1),k=function(){function e(){}return e.KEYDOWN=1,e.KEYUP=2,e}(),o=function(D,w){this.type=D,this.event=w},j=function(D){function t(w,N){var F=D.call(this,w,N)||this;return F.type=w,F.event=N,F.skipOnPointerObservable=!1,F}return Object(F.d)(t,D),t}(o)},function(D,w,N){"use strict";N.d(w,"a",(function(){return F}));var F=function(){function e(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}return e.prototype.unBindMesh=function(){this._mesh=null},e.prototype.addFallback=function(D,w){this._defines[D]||(D<this._currentRank&&(this._currentRank=D),D>this._maxRank&&(this._maxRank=D),this._defines[D]=new Array),this._defines[D].push(w)},e.prototype.addCPUSkinningFallback=function(D,w){this._mesh=w,D<this._currentRank&&(this._currentRank=D),D>this._maxRank&&(this._maxRank=D)},Object.defineProperty(e.prototype,"hasMoreFallbacks",{get:function(){return this._currentRank<=this._maxRank},enumerable:!0,configurable:!0}),e.prototype.reduce=function(D,w){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,D=D.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),w._bonesComputationForcedToCPU=!0;for(var N=this._mesh.getScene(),F=0;F<N.meshes.length;F++){var k=N.meshes[F];if(k.material){if(k.computeBonesUsingShaders&&0!==k.numBoneInfluencers)if(k.material.getEffect()===w)k.computeBonesUsingShaders=!1;else if(k.subMeshes)for(var j=0,z=k.subMeshes;j<z.length;j++)if(z[j].effect===w){k.computeBonesUsingShaders=!1;break}}else!this._mesh.material&&k.computeBonesUsingShaders&&k.numBoneInfluencers>0&&(k.computeBonesUsingShaders=!1)}}else{var G=this._defines[this._currentRank];if(G)for(F=0;F<G.length;F++)D=D.replace("#define "+G[F],"");this._currentRank++}return D},e}()},function(D,w,N){"use strict";N.d(w,"a",(function(){return F}));var F=function(){function e(){this._xhr=new XMLHttpRequest}return e.prototype._injectCustomRequestHeaders=function(){for(var D in e.CustomRequestHeaders){var w=e.CustomRequestHeaders[D];w&&this._xhr.setRequestHeader(D,w)}},Object.defineProperty(e.prototype,"onprogress",{get:function(){return this._xhr.onprogress},set:function(D){this._xhr.onprogress=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"readyState",{get:function(){return this._xhr.readyState},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"status",{get:function(){return this._xhr.status},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"statusText",{get:function(){return this._xhr.statusText},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"response",{get:function(){return this._xhr.response},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"responseURL",{get:function(){return this._xhr.responseURL},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"responseText",{get:function(){return this._xhr.responseText},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"responseType",{get:function(){return this._xhr.responseType},set:function(D){this._xhr.responseType=D},enumerable:!0,configurable:!0}),e.prototype.addEventListener=function(D,w,N){this._xhr.addEventListener(D,w,N)},e.prototype.removeEventListener=function(D,w,N){this._xhr.removeEventListener(D,w,N)},e.prototype.abort=function(){this._xhr.abort()},e.prototype.send=function(D){e.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(D)},e.prototype.open=function(D,w){for(var N=0,F=e.CustomRequestModifiers;N<F.length;N++)(0,F[N])(this._xhr,w);return w=(w=w.replace("file:http:","http:")).replace("file:https:","https:"),this._xhr.open(D,w,!0)},e.prototype.setRequestHeader=function(D,w){this._xhr.setRequestHeader(D,w)},e.prototype.getResponseHeader=function(D){return this._xhr.getResponseHeader(D)},e.CustomRequestHeaders={},e.CustomRequestModifiers=new Array,e}()},function(D,w,N){"use strict";N.d(w,"a",(function(){return G}));var F=N(0),k=N(10),j=N(5),z=N(15);z.a.CreateBox=function(D){var w,N=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],j=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],G=[],H=D.width||D.size||1,X=D.height||D.size||1,q=D.depth||D.size||1,Z=D.wrap||!1,J=void 0===D.topBaseAt?1:D.topBaseAt,$=void 0===D.bottomBaseAt?0:D.bottomBaseAt,te=[2,0,3,1][J=(J+4)%4],ie=[2,0,1,3][$=($+4)%4],oe=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(Z){N=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],oe=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];for(var ce=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],he=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]],fe=[17,18,19,16],pe=[22,23,20,21];te>0;)ce.unshift(ce.pop()),fe.unshift(fe.pop()),te--;for(;ie>0;)he.unshift(he.pop()),pe.unshift(pe.pop()),ie--;ce=ce.flat(),he=he.flat(),oe=oe.concat(ce).concat(he),N.push(fe[0],fe[2],fe[3],fe[0],fe[1],fe[2]),N.push(pe[0],pe[2],pe[3],pe[0],pe[1],pe[2])}var _e=[H/2,X/2,q/2];w=oe.reduce((function(D,w,N){return D.concat(w*_e[N%3])}),[]);for(var ve=0===D.sideOrientation?0:D.sideOrientation||z.a.DEFAULTSIDE,ye=D.faceUV||new Array(6),be=D.faceColors,Te=[],Ee=0;Ee<6;Ee++)void 0===ye[Ee]&&(ye[Ee]=new F.f(0,0,1,1)),be&&void 0===be[Ee]&&(be[Ee]=new k.b(1,1,1,1));for(var Se=0;Se<6;Se++)if(G.push(ye[Se].z,ye[Se].w),G.push(ye[Se].x,ye[Se].w),G.push(ye[Se].x,ye[Se].y),G.push(ye[Se].z,ye[Se].y),be)for(var Me=0;Me<4;Me++)Te.push(be[Se].r,be[Se].g,be[Se].b,be[Se].a);z.a._ComputeSides(ve,w,N,j,G,D.frontUVs,D.backUVs);var xe=new z.a;if(xe.indices=N,xe.positions=w,xe.normals=j,xe.uvs=G,be){var Ae=ve===z.a.DOUBLESIDE?Te.concat(Te):Te;xe.colors=Ae}return xe},j.a.CreateBox=function(D,w,N,F,k){void 0===N&&(N=null);var j={size:w,sideOrientation:k,updatable:F};return G.CreateBox(D,j,N)};var G=function(){function e(){}return e.CreateBox=function(D,w,N){void 0===N&&(N=null);var F=new j.a(D,N);return w.sideOrientation=j.a._GetDefaultSideOrientation(w.sideOrientation),F._originalBuilderSideOrientation=w.sideOrientation,z.a.CreateBox(w).applyToMesh(F,w.updatable),F},e}()},function(D,w,N){"use strict";N.d(w,"a",(function(){return k}));var F=N(2),k=function(){function e(){}return Object.defineProperty(e,"ForceFullSceneLoadingForIncremental",{get:function(){return e._ForceFullSceneLoadingForIncremental},set:function(D){e._ForceFullSceneLoadingForIncremental=D},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ShowLoadingScreen",{get:function(){return e._ShowLoadingScreen},set:function(D){e._ShowLoadingScreen=D},enumerable:!0,configurable:!0}),Object.defineProperty(e,"loggingLevel",{get:function(){return e._loggingLevel},set:function(D){e._loggingLevel=D},enumerable:!0,configurable:!0}),Object.defineProperty(e,"CleanBoneMatrixWeights",{get:function(){return e._CleanBoneMatrixWeights},set:function(D){e._CleanBoneMatrixWeights=D},enumerable:!0,configurable:!0}),e._ForceFullSceneLoadingForIncremental=!1,e._ShowLoadingScreen=!0,e._CleanBoneMatrixWeights=!1,e._loggingLevel=F.a.SCENELOADER_NO_LOGGING,e}()},function(D,w,N){"use strict";N.d(w,"a",(function(){return F}));var F=function(){function e(D,w){this.width=D,this.height=w}return e.prototype.toString=function(){return"{W: "+this.width+", H: "+this.height+"}"},e.prototype.getClassName=function(){return"Size"},e.prototype.getHashCode=function(){var D=0|this.width;return 397*D^(0|this.height)},e.prototype.copyFrom=function(D){this.width=D.width,this.height=D.height},e.prototype.copyFromFloats=function(D,w){return this.width=D,this.height=w,this},e.prototype.set=function(D,w){return this.copyFromFloats(D,w)},e.prototype.multiplyByFloats=function(D,w){return new e(this.width*D,this.height*w)},e.prototype.clone=function(){return new e(this.width,this.height)},e.prototype.equals=function(D){return!!D&&this.width===D.width&&this.height===D.height},Object.defineProperty(e.prototype,"surface",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),e.Zero=function(){return new e(0,0)},e.prototype.add=function(D){return new e(this.width+D.width,this.height+D.height)},e.prototype.subtract=function(D){return new e(this.width-D.width,this.height-D.height)},e.Lerp=function(D,w,N){return new e(D.width+(w.width-D.width)*N,D.height+(w.height-D.height)*N)},e}()},function(D,w,N){"use strict";N.d(w,"a",(function(){return te}));var F=N(0),k=N(10),j=N(15),z=N(4),G=N(57),H=N(67),X=N(44),q=N(2),Z=N(13),J=N(35),$=N(110),te=function(){function e(D,w,N,F,k){void 0===F&&(F=!1),void 0===k&&(k=null),this.delayLoadState=q.a.DELAYLOADSTATE_NONE,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this.id=D,this.uniqueId=w.getUniqueId(),this._engine=w.getEngine(),this._meshes=[],this._scene=w,this._vertexBuffers={},this._indices=[],this._updatable=F,N?this.setAllVerticesData(N,F):(this._totalVertices=0,this._indices=[]),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),k&&(this.applyToMesh(k),k.computeWorldMatrix(!0))}return Object.defineProperty(e.prototype,"boundingBias",{get:function(){return this._boundingBias},set:function(D){this._boundingBias?this._boundingBias.copyFrom(D):this._boundingBias=D.clone(),this._updateBoundingInfo(!0,null)},enumerable:!0,configurable:!0}),e.CreateGeometryForMesh=function(D){var w=new e(e.RandomId(),D.getScene());return w.applyToMesh(D),w},Object.defineProperty(e.prototype,"extend",{get:function(){return this._extend},enumerable:!0,configurable:!0}),e.prototype.getScene=function(){return this._scene},e.prototype.getEngine=function(){return this._engine},e.prototype.isReady=function(){return this.delayLoadState===q.a.DELAYLOADSTATE_LOADED||this.delayLoadState===q.a.DELAYLOADSTATE_NONE},Object.defineProperty(e.prototype,"doNotSerialize",{get:function(){for(var D=0;D<this._meshes.length;D++)if(!this._meshes[D].doNotSerialize)return!1;return!0},enumerable:!0,configurable:!0}),e.prototype._rebuild=function(){for(var D in this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),this._vertexBuffers)this._vertexBuffers[D]._rebuild()},e.prototype.setAllVerticesData=function(D,w){D.applyToGeometry(this,w),this.notifyUpdate()},e.prototype.setVerticesData=function(D,w,N,F){void 0===N&&(N=!1);var k=new z.b(this._engine,w,D,N,0===this._meshes.length,F);this.setVerticesBuffer(k)},e.prototype.removeVerticesData=function(D){this._vertexBuffers[D]&&(this._vertexBuffers[D].dispose(),delete this._vertexBuffers[D])},e.prototype.setVerticesBuffer=function(D,w){void 0===w&&(w=null);var N=D.getKind();if(this._vertexBuffers[N]&&this._vertexBuffers[N].dispose(),this._vertexBuffers[N]=D,N===z.b.PositionKind){var F=D.getData();null!=w?this._totalVertices=w:null!=F&&(this._totalVertices=F.length/(D.byteStride/4)),this._updateExtend(F),this._resetPointsArrayCache();for(var k=this._meshes,j=k.length,G=0;G<j;G++){var H=k[G];H._boundingInfo=new X.a(this._extend.minimum,this._extend.maximum),H._createGlobalSubMesh(!1),H.computeWorldMatrix(!0)}}this.notifyUpdate(N),this._vertexArrayObjects&&(this._disposeVertexArrayObjects(),this._vertexArrayObjects={})},e.prototype.updateVerticesDataDirectly=function(D,w,N,F){void 0===F&&(F=!1);var k=this.getVertexBuffer(D);k&&(k.updateDirectly(w,N,F),this.notifyUpdate(D))},e.prototype.updateVerticesData=function(D,w,N){void 0===N&&(N=!1);var F=this.getVertexBuffer(D);F&&(F.update(w),D===z.b.PositionKind&&this._updateBoundingInfo(N,w),this.notifyUpdate(D))},e.prototype._updateBoundingInfo=function(D,w){if(D&&this._updateExtend(w),this._resetPointsArrayCache(),D)for(var N=0,F=this._meshes;N<F.length;N++){var k=F[N];k._boundingInfo?k._boundingInfo.reConstruct(this._extend.minimum,this._extend.maximum):k._boundingInfo=new X.a(this._extend.minimum,this._extend.maximum);for(var j=0,z=k.subMeshes;j<z.length;j++)z[j].refreshBoundingInfo()}},e.prototype._bind=function(D,w){if(D){void 0===w&&(w=this._indexBuffer);var N=this.getVertexBuffers();N&&(w==this._indexBuffer&&this._vertexArrayObjects?(this._vertexArrayObjects[D.key]||(this._vertexArrayObjects[D.key]=this._engine.recordVertexArrayObject(N,w,D)),this._engine.bindVertexArrayObject(this._vertexArrayObjects[D.key],w)):this._engine.bindBuffers(N,w,D))}},e.prototype.getTotalVertices=function(){return this.isReady()?this._totalVertices:0},e.prototype.getVerticesData=function(D,w,N){var F=this.getVertexBuffer(D);if(!F)return null;var k=F.getData();if(!k)return null;var j=F.getSize()*z.b.GetTypeByteLength(F.type),G=this._totalVertices*F.getSize();if(F.type!==z.b.FLOAT||F.byteStride!==j){var H=[];return F.forEach(G,(function(D){return H.push(D)})),H}if(!(k instanceof Array||k instanceof Float32Array)||0!==F.byteOffset||k.length!==G){if(k instanceof Array){var X=F.byteOffset/4;return Z.b.Slice(k,X,X+G)}if(k instanceof ArrayBuffer)return new Float32Array(k,F.byteOffset,G);if(X=k.byteOffset+F.byteOffset,N||w&&1!==this._meshes.length){var q=new Float32Array(G),J=new Float32Array(k.buffer,X,G);return q.set(J),q}return new Float32Array(k.buffer,X,G)}return N||w&&1!==this._meshes.length?Z.b.Slice(k):k},e.prototype.isVertexBufferUpdatable=function(D){var w=this._vertexBuffers[D];return!!w&&w.isUpdatable()},e.prototype.getVertexBuffer=function(D){return this.isReady()?this._vertexBuffers[D]:null},e.prototype.getVertexBuffers=function(){return this.isReady()?this._vertexBuffers:null},e.prototype.isVerticesDataPresent=function(D){return this._vertexBuffers?void 0!==this._vertexBuffers[D]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(D)},e.prototype.getVerticesDataKinds=function(){var D,w=[];if(!this._vertexBuffers&&this._delayInfo)for(D in this._delayInfo)w.push(D);else for(D in this._vertexBuffers)w.push(D);return w},e.prototype.updateIndices=function(D,w,N){if(void 0===N&&(N=!1),this._indexBuffer)if(this._indexBufferIsUpdatable){var F=D.length!==this._indices.length;if(N||(this._indices=D.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,D,w),F)for(var k=0,j=this._meshes;k<j.length;k++)j[k]._createGlobalSubMesh(!0)}else this.setIndices(D,null,!0)},e.prototype.setIndices=function(D,w,N){void 0===w&&(w=null),void 0===N&&(N=!1),this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._disposeVertexArrayObjects(),this._indices=D,this._indexBufferIsUpdatable=N,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,N)),null!=w&&(this._totalVertices=w);for(var F=0,k=this._meshes;F<k.length;F++)k[F]._createGlobalSubMesh(!0);this.notifyUpdate()},e.prototype.getTotalIndices=function(){return this.isReady()?this._indices.length:0},e.prototype.getIndices=function(D,w){if(!this.isReady())return null;var N=this._indices;if(w||D&&1!==this._meshes.length){for(var F=N.length,k=[],j=0;j<F;j++)k.push(N[j]);return k}return N},e.prototype.getIndexBuffer=function(){return this.isReady()?this._indexBuffer:null},e.prototype._releaseVertexArrayObject=function(D){void 0===D&&(D=null),D&&this._vertexArrayObjects&&this._vertexArrayObjects[D.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[D.key]),delete this._vertexArrayObjects[D.key])},e.prototype.releaseForMesh=function(D,w){var N=this._meshes,F=N.indexOf(D);-1!==F&&(N.splice(F,1),D._geometry=null,0===N.length&&w&&this.dispose())},e.prototype.applyToMesh=function(D){if(D._geometry!==this){var w=D._geometry;w&&w.releaseForMesh(D);var N=this._meshes;D._geometry=this,this._scene.pushGeometry(this),N.push(D),this.isReady()?this._applyToMesh(D):D._boundingInfo=this._boundingInfo}},e.prototype._updateExtend=function(D){void 0===D&&(D=null),D||(D=this.getVerticesData(z.b.PositionKind)),this._extend=Object($.a)(D,0,this._totalVertices,this.boundingBias,3)},e.prototype._applyToMesh=function(D){var w=this._meshes.length;for(var N in this._vertexBuffers){1===w&&this._vertexBuffers[N].create();var F=this._vertexBuffers[N].getBuffer();F&&(F.references=w),N===z.b.PositionKind&&(this._extend||this._updateExtend(),D._boundingInfo=new X.a(this._extend.minimum,this._extend.maximum),D._createGlobalSubMesh(!1),D._updateBoundingInfo())}1===w&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),this._indexBuffer&&(this._indexBuffer.references=w),D._syncGeometryWithMorphTargetManager(),D.synchronizeInstances()},e.prototype.notifyUpdate=function(D){this.onGeometryUpdated&&this.onGeometryUpdated(this,D);for(var w=0,N=this._meshes;w<N.length;w++)N[w]._markSubMeshesAsAttributesDirty()},e.prototype.load=function(D,w){this.delayLoadState!==q.a.DELAYLOADSTATE_LOADING&&(this.isReady()?w&&w():(this.delayLoadState=q.a.DELAYLOADSTATE_LOADING,this._queueLoad(D,w)))},e.prototype._queueLoad=function(D,w){var N=this;this.delayLoadingFile&&(D._addPendingData(this),D._loadFile(this.delayLoadingFile,(function(F){if(N._delayLoadingFunction){N._delayLoadingFunction(JSON.parse(F),N),N.delayLoadState=q.a.DELAYLOADSTATE_LOADED,N._delayInfo=[],D._removePendingData(N);for(var k=N._meshes,j=k.length,z=0;z<j;z++)N._applyToMesh(k[z]);w&&w()}}),void 0,!0))},e.prototype.toLeftHanded=function(){var D=this.getIndices(!1);if(null!=D&&D.length>0){for(var w=0;w<D.length;w+=3){var N=D[w+0];D[w+0]=D[w+2],D[w+2]=N}this.setIndices(D)}var F=this.getVerticesData(z.b.PositionKind,!1);if(null!=F&&F.length>0){for(w=0;w<F.length;w+=3)F[w+2]=-F[w+2];this.setVerticesData(z.b.PositionKind,F,!1)}var k=this.getVerticesData(z.b.NormalKind,!1);if(null!=k&&k.length>0){for(w=0;w<k.length;w+=3)k[w+2]=-k[w+2];this.setVerticesData(z.b.NormalKind,k,!1)}},e.prototype._resetPointsArrayCache=function(){this._positions=null},e.prototype._generatePointsArray=function(){if(this._positions)return!0;var D=this.getVerticesData(z.b.PositionKind);if(!D||0===D.length)return!1;this._positions=[];for(var w=0;w<D.length;w+=3)this._positions.push(F.e.FromArray(D,w));return!0},e.prototype.isDisposed=function(){return this._isDisposed},e.prototype._disposeVertexArrayObjects=function(){if(this._vertexArrayObjects){for(var D in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[D]);this._vertexArrayObjects={}}},e.prototype.dispose=function(){var D,w=this._meshes,N=w.length;for(D=0;D<N;D++)this.releaseForMesh(w[D]);for(var F in this._meshes=[],this._disposeVertexArrayObjects(),this._vertexBuffers)this._vertexBuffers[F].dispose();this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=q.a.DELAYLOADSTATE_NONE,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._isDisposed=!0},e.prototype.copy=function(D){var w=new j.a;w.indices=[];var N=this.getIndices();if(N)for(var F=0;F<N.length;F++)w.indices.push(N[F]);var k,z=!1,G=!1;for(k in this._vertexBuffers){var H=this.getVerticesData(k);if(H&&(H instanceof Float32Array?w.set(new Float32Array(H),k):w.set(H.slice(0),k),!G)){var q=this.getVertexBuffer(k);q&&(G=!(z=q.isUpdatable()))}}var Z=new e(D,this._scene,w,z);for(k in Z.delayLoadState=this.delayLoadState,Z.delayLoadingFile=this.delayLoadingFile,Z._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)Z._delayInfo=Z._delayInfo||[],Z._delayInfo.push(k);return Z._boundingInfo=new X.a(this._extend.minimum,this._extend.maximum),Z},e.prototype.serialize=function(){var D={};return D.id=this.id,D.updatable=this._updatable,J.a&&J.a.HasTags(this)&&(D.tags=J.a.GetTags(this)),D},e.prototype.toNumberArray=function(D){return Array.isArray(D)?D:Array.prototype.slice.call(D)},e.prototype.serializeVerticeData=function(){var D=this.serialize();return this.isVerticesDataPresent(z.b.PositionKind)&&(D.positions=this.toNumberArray(this.getVerticesData(z.b.PositionKind)),this.isVertexBufferUpdatable(z.b.PositionKind)&&(D.positions._updatable=!0)),this.isVerticesDataPresent(z.b.NormalKind)&&(D.normals=this.toNumberArray(this.getVerticesData(z.b.NormalKind)),this.isVertexBufferUpdatable(z.b.NormalKind)&&(D.normals._updatable=!0)),this.isVerticesDataPresent(z.b.TangentKind)&&(D.tangets=this.toNumberArray(this.getVerticesData(z.b.TangentKind)),this.isVertexBufferUpdatable(z.b.TangentKind)&&(D.tangets._updatable=!0)),this.isVerticesDataPresent(z.b.UVKind)&&(D.uvs=this.toNumberArray(this.getVerticesData(z.b.UVKind)),this.isVertexBufferUpdatable(z.b.UVKind)&&(D.uvs._updatable=!0)),this.isVerticesDataPresent(z.b.UV2Kind)&&(D.uv2s=this.toNumberArray(this.getVerticesData(z.b.UV2Kind)),this.isVertexBufferUpdatable(z.b.UV2Kind)&&(D.uv2s._updatable=!0)),this.isVerticesDataPresent(z.b.UV3Kind)&&(D.uv3s=this.toNumberArray(this.getVerticesData(z.b.UV3Kind)),this.isVertexBufferUpdatable(z.b.UV3Kind)&&(D.uv3s._updatable=!0)),this.isVerticesDataPresent(z.b.UV4Kind)&&(D.uv4s=this.toNumberArray(this.getVerticesData(z.b.UV4Kind)),this.isVertexBufferUpdatable(z.b.UV4Kind)&&(D.uv4s._updatable=!0)),this.isVerticesDataPresent(z.b.UV5Kind)&&(D.uv5s=this.toNumberArray(this.getVerticesData(z.b.UV5Kind)),this.isVertexBufferUpdatable(z.b.UV5Kind)&&(D.uv5s._updatable=!0)),this.isVerticesDataPresent(z.b.UV6Kind)&&(D.uv6s=this.toNumberArray(this.getVerticesData(z.b.UV6Kind)),this.isVertexBufferUpdatable(z.b.UV6Kind)&&(D.uv6s._updatable=!0)),this.isVerticesDataPresent(z.b.ColorKind)&&(D.colors=this.toNumberArray(this.getVerticesData(z.b.ColorKind)),this.isVertexBufferUpdatable(z.b.ColorKind)&&(D.colors._updatable=!0)),this.isVerticesDataPresent(z.b.MatricesIndicesKind)&&(D.matricesIndices=this.toNumberArray(this.getVerticesData(z.b.MatricesIndicesKind)),D.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(z.b.MatricesIndicesKind)&&(D.matricesIndices._updatable=!0)),this.isVerticesDataPresent(z.b.MatricesWeightsKind)&&(D.matricesWeights=this.toNumberArray(this.getVerticesData(z.b.MatricesWeightsKind)),this.isVertexBufferUpdatable(z.b.MatricesWeightsKind)&&(D.matricesWeights._updatable=!0)),D.indices=this.toNumberArray(this.getIndices()),D},e.ExtractFromMesh=function(D,w){var N=D._geometry;return N?N.copy(w):null},e.RandomId=function(){return Z.b.RandomId()},e._ImportGeometry=function(D,w){var N=w.getScene(),F=D.geometryId;if(F){var j=N.getGeometryByID(F);j&&j.applyToMesh(w)}else if(D instanceof ArrayBuffer){var H=w._binaryInfo;if(H.positionsAttrDesc&&H.positionsAttrDesc.count>0){var X=new Float32Array(D,H.positionsAttrDesc.offset,H.positionsAttrDesc.count);w.setVerticesData(z.b.PositionKind,X,!1)}if(H.normalsAttrDesc&&H.normalsAttrDesc.count>0){var q=new Float32Array(D,H.normalsAttrDesc.offset,H.normalsAttrDesc.count);w.setVerticesData(z.b.NormalKind,q,!1)}if(H.tangetsAttrDesc&&H.tangetsAttrDesc.count>0){var Z=new Float32Array(D,H.tangetsAttrDesc.offset,H.tangetsAttrDesc.count);w.setVerticesData(z.b.TangentKind,Z,!1)}if(H.uvsAttrDesc&&H.uvsAttrDesc.count>0){var J=new Float32Array(D,H.uvsAttrDesc.offset,H.uvsAttrDesc.count);w.setVerticesData(z.b.UVKind,J,!1)}if(H.uvs2AttrDesc&&H.uvs2AttrDesc.count>0){var $=new Float32Array(D,H.uvs2AttrDesc.offset,H.uvs2AttrDesc.count);w.setVerticesData(z.b.UV2Kind,$,!1)}if(H.uvs3AttrDesc&&H.uvs3AttrDesc.count>0){var te=new Float32Array(D,H.uvs3AttrDesc.offset,H.uvs3AttrDesc.count);w.setVerticesData(z.b.UV3Kind,te,!1)}if(H.uvs4AttrDesc&&H.uvs4AttrDesc.count>0){var ie=new Float32Array(D,H.uvs4AttrDesc.offset,H.uvs4AttrDesc.count);w.setVerticesData(z.b.UV4Kind,ie,!1)}if(H.uvs5AttrDesc&&H.uvs5AttrDesc.count>0){var oe=new Float32Array(D,H.uvs5AttrDesc.offset,H.uvs5AttrDesc.count);w.setVerticesData(z.b.UV5Kind,oe,!1)}if(H.uvs6AttrDesc&&H.uvs6AttrDesc.count>0){var ce=new Float32Array(D,H.uvs6AttrDesc.offset,H.uvs6AttrDesc.count);w.setVerticesData(z.b.UV6Kind,ce,!1)}if(H.colorsAttrDesc&&H.colorsAttrDesc.count>0){var he=new Float32Array(D,H.colorsAttrDesc.offset,H.colorsAttrDesc.count);w.setVerticesData(z.b.ColorKind,he,!1,H.colorsAttrDesc.stride)}if(H.matricesIndicesAttrDesc&&H.matricesIndicesAttrDesc.count>0){for(var fe=new Int32Array(D,H.matricesIndicesAttrDesc.offset,H.matricesIndicesAttrDesc.count),pe=[],_e=0;_e<fe.length;_e++){var ve=fe[_e];pe.push(255&ve),pe.push((65280&ve)>>8),pe.push((16711680&ve)>>16),pe.push(ve>>24)}w.setVerticesData(z.b.MatricesIndicesKind,pe,!1)}if(H.matricesWeightsAttrDesc&&H.matricesWeightsAttrDesc.count>0){var ye=new Float32Array(D,H.matricesWeightsAttrDesc.offset,H.matricesWeightsAttrDesc.count);w.setVerticesData(z.b.MatricesWeightsKind,ye,!1)}if(H.indicesAttrDesc&&H.indicesAttrDesc.count>0){var be=new Int32Array(D,H.indicesAttrDesc.offset,H.indicesAttrDesc.count);w.setIndices(be,null)}if(H.subMeshesAttrDesc&&H.subMeshesAttrDesc.count>0){var Te=new Int32Array(D,H.subMeshesAttrDesc.offset,5*H.subMeshesAttrDesc.count);for(w.subMeshes=[],_e=0;_e<H.subMeshesAttrDesc.count;_e++){var Ee=Te[5*_e+0],Se=Te[5*_e+1],Me=Te[5*_e+2],xe=Te[5*_e+3],Ae=Te[5*_e+4];G.b.AddToMesh(Ee,Se,Me,xe,Ae,w)}}}else if(D.positions&&D.normals&&D.indices){if(w.setVerticesData(z.b.PositionKind,D.positions,D.positions._updatable),w.setVerticesData(z.b.NormalKind,D.normals,D.normals._updatable),D.tangents&&w.setVerticesData(z.b.TangentKind,D.tangents,D.tangents._updatable),D.uvs&&w.setVerticesData(z.b.UVKind,D.uvs,D.uvs._updatable),D.uvs2&&w.setVerticesData(z.b.UV2Kind,D.uvs2,D.uvs2._updatable),D.uvs3&&w.setVerticesData(z.b.UV3Kind,D.uvs3,D.uvs3._updatable),D.uvs4&&w.setVerticesData(z.b.UV4Kind,D.uvs4,D.uvs4._updatable),D.uvs5&&w.setVerticesData(z.b.UV5Kind,D.uvs5,D.uvs5._updatable),D.uvs6&&w.setVerticesData(z.b.UV6Kind,D.uvs6,D.uvs6._updatable),D.colors&&w.setVerticesData(z.b.ColorKind,k.b.CheckColors4(D.colors,D.positions.length/3),D.colors._updatable),D.matricesIndices)if(D.matricesIndices._isExpanded)delete D.matricesIndices._isExpanded,w.setVerticesData(z.b.MatricesIndicesKind,D.matricesIndices,D.matricesIndices._updatable);else{for(pe=[],_e=0;_e<D.matricesIndices.length;_e++){var Pe=D.matricesIndices[_e];pe.push(255&Pe),pe.push((65280&Pe)>>8),pe.push((16711680&Pe)>>16),pe.push(Pe>>24)}w.setVerticesData(z.b.MatricesIndicesKind,pe,D.matricesIndices._updatable)}if(D.matricesIndicesExtra)if(D.matricesIndicesExtra._isExpanded)delete D.matricesIndices._isExpanded,w.setVerticesData(z.b.MatricesIndicesExtraKind,D.matricesIndicesExtra,D.matricesIndicesExtra._updatable);else{for(pe=[],_e=0;_e<D.matricesIndicesExtra.length;_e++)Pe=D.matricesIndicesExtra[_e],pe.push(255&Pe),pe.push((65280&Pe)>>8),pe.push((16711680&Pe)>>16),pe.push(Pe>>24);w.setVerticesData(z.b.MatricesIndicesExtraKind,pe,D.matricesIndicesExtra._updatable)}D.matricesWeights&&(e._CleanMatricesWeights(D,w),w.setVerticesData(z.b.MatricesWeightsKind,D.matricesWeights,D.matricesWeights._updatable)),D.matricesWeightsExtra&&w.setVerticesData(z.b.MatricesWeightsExtraKind,D.matricesWeightsExtra,D.matricesWeights._updatable),w.setIndices(D.indices,null)}if(D.subMeshes){w.subMeshes=[];for(var Oe=0;Oe<D.subMeshes.length;Oe++){var Re=D.subMeshes[Oe];G.b.AddToMesh(Re.materialIndex,Re.verticesStart,Re.verticesCount,Re.indexStart,Re.indexCount,w)}}w._shouldGenerateFlatShading&&(w.convertToFlatShadedMesh(),delete w._shouldGenerateFlatShading),w.computeWorldMatrix(!0),N.onMeshImportedObservable.notifyObservers(w)},e._CleanMatricesWeights=function(D,w){if(H.a.CleanBoneMatrixWeights){var N=0;if(D.skeletonId>-1){var F=w.getScene().getLastSkeletonByID(D.skeletonId);if(F){N=F.bones.length;for(var k=w.getVerticesData(z.b.MatricesIndicesKind),j=w.getVerticesData(z.b.MatricesIndicesExtraKind),G=D.matricesWeights,X=D.matricesWeightsExtra,q=D.numBoneInfluencer,Z=G.length,J=0;J<Z;J+=4){for(var $=0,te=-1,ie=0;ie<4;ie++)$+=oe=G[J+ie],oe<.001&&te<0&&(te=ie);if(X)for(ie=0;ie<4;ie++){var oe;$+=oe=X[J+ie],oe<.001&&te<0&&(te=ie+4)}if((te<0||te>q-1)&&(te=q-1),$>.001){var ce=1/$;for(ie=0;ie<4;ie++)G[J+ie]*=ce;if(X)for(ie=0;ie<4;ie++)X[J+ie]*=ce}else te>=4?(X[J+te-4]=1-$,j[J+te-4]=N):(G[J+te]=1-$,k[J+te]=N)}w.setVerticesData(z.b.MatricesIndicesKind,k),D.matricesWeightsExtra&&w.setVerticesData(z.b.MatricesIndicesExtraKind,j)}}}},e.Parse=function(D,w,N){if(w.getGeometryByID(D.id))return null;var k=new e(D.id,w,void 0,D.updatable);return J.a&&J.a.AddTagsTo(k,D.tags),D.delayLoadingFile?(k.delayLoadState=q.a.DELAYLOADSTATE_NOTLOADED,k.delayLoadingFile=N+D.delayLoadingFile,k._boundingInfo=new X.a(F.e.FromArray(D.boundingBoxMinimum),F.e.FromArray(D.boundingBoxMaximum)),k._delayInfo=[],D.hasUVs&&k._delayInfo.push(z.b.UVKind),D.hasUVs2&&k._delayInfo.push(z.b.UV2Kind),D.hasUVs3&&k._delayInfo.push(z.b.UV3Kind),D.hasUVs4&&k._delayInfo.push(z.b.UV4Kind),D.hasUVs5&&k._delayInfo.push(z.b.UV5Kind),D.hasUVs6&&k._delayInfo.push(z.b.UV6Kind),D.hasColors&&k._delayInfo.push(z.b.ColorKind),D.hasMatricesIndices&&k._delayInfo.push(z.b.MatricesIndicesKind),D.hasMatricesWeights&&k._delayInfo.push(z.b.MatricesWeightsKind),k._delayLoadingFunction=j.a.ImportVertexData):j.a.ImportVertexData(D,k),w.pushGeometry(k,!0),k},e}()},function(D,w,N){"use strict";N.d(w,"a",(function(){return F}));var F=function(){function e(){}return e.CreateCanvas=function(D,w){if("undefined"==typeof document)return new OffscreenCanvas(D,w);var N=document.createElement("canvas");return N.width=D,N.height=w,N},e}()},function(D,w,N){"use strict";N.d(w,"a",(function(){return G}));var F=N(1),k=N(29),j=N(35),z=N(12),G=function(D){function t(w,N){var F=D.call(this,w,N,!0)||this;return N.multiMaterials.push(F),F.subMaterials=new Array,F._storeEffectOnSubMeshes=!0,F}return Object(F.d)(t,D),Object.defineProperty(t.prototype,"subMaterials",{get:function(){return this._subMaterials},set:function(D){this._subMaterials=D,this._hookArray(D)},enumerable:!0,configurable:!0}),t.prototype.getChildren=function(){return this.subMaterials},t.prototype._hookArray=function(D){var w=this,N=D.push;D.push=function(){for(var F=[],k=0;k<arguments.length;k++)F[k]=arguments[k];var j=N.apply(D,F);return w._markAllSubMeshesAsTexturesDirty(),j};var F=D.splice;D.splice=function(N,k){var j=F.apply(D,[N,k]);return w._markAllSubMeshesAsTexturesDirty(),j}},t.prototype.getSubMaterial=function(D){return D<0||D>=this.subMaterials.length?this.getScene().defaultMaterial:this.subMaterials[D]},t.prototype.getActiveTextures=function(){var w;return(w=D.prototype.getActiveTextures.call(this)).concat.apply(w,this.subMaterials.map((function(D){return D?D.getActiveTextures():[]})))},t.prototype.getClassName=function(){return"MultiMaterial"},t.prototype.isReadyForSubMesh=function(D,w,N){for(var F=0;F<this.subMaterials.length;F++){var k=this.subMaterials[F];if(k){if(k._storeEffectOnSubMeshes){if(!k.isReadyForSubMesh(D,w,N))return!1;continue}if(!k.isReady(D))return!1}}return!0},t.prototype.clone=function(D,w){for(var N=new t(D,this.getScene()),F=0;F<this.subMaterials.length;F++){var k,j=this.subMaterials[F];k=w&&j?j.clone(D+"-"+j.name):this.subMaterials[F],N.subMaterials.push(k)}return N},t.prototype.serialize=function(){var D={};D.name=this.name,D.id=this.id,j.a&&(D.tags=j.a.GetTags(this)),D.materials=[];for(var w=0;w<this.subMaterials.length;w++){var N=this.subMaterials[w];N?D.materials.push(N.id):D.materials.push(null)}return D},t.prototype.dispose=function(w,N,F){var k=this.getScene();if(k){if(F)for(var j=0;j<this.subMaterials.length;j++){var z=this.subMaterials[j];z&&z.dispose(w,N)}(j=k.multiMaterials.indexOf(this))>=0&&k.multiMaterials.splice(j,1),D.prototype.dispose.call(this,w,N)}},t.ParseMultiMaterial=function(D,w){var N=new t(D.name,w);N.id=D.id,j.a&&j.a.AddTagsTo(N,D.tags);for(var F=0;F<D.materials.length;F++){var k=D.materials[F];k?N.subMaterials.push(w.getLastMaterialByID(k)):N.subMaterials.push(null)}return N},t}(k.a);z.a.RegisteredTypes["BABYLON.MultiMaterial"]=G},function(D,w,N){"use strict";N.d(w,"a",(function(){return $}));var F=N(1),k=N(6),j=N(0),z=N(43),G=N(59),H=N(62),X=N(56),q=N(41),Z=N(32),J=N(10),$=function(D){function t(w,N,F,z){void 0===N&&(N=J.a.Gray()),void 0===F&&(F=q.a.DefaultUtilityLayer),void 0===z&&(z=null);var G=D.call(this,F)||this;G._pointerObserver=null,G.snapDistance=0,G.onSnapObservable=new k.c,G._isEnabled=!0,G._parent=null,G._parent=z,G._coloredMaterial=new Z.a("",F.utilityLayerScene),G._coloredMaterial.diffuseColor=N,G._coloredMaterial.specularColor=N.subtract(new J.a(.1,.1,.1)),G._hoverMaterial=new Z.a("",F.utilityLayerScene),G._hoverMaterial.diffuseColor=N.add(new J.a(.3,.3,.3)),G._arrow=t._CreateArrow(F.utilityLayerScene,G._coloredMaterial),G._arrow.lookAt(G._rootMesh.position.add(w)),G._arrow.scaling.scaleInPlace(1/3),G._arrow.parent=G._rootMesh;var X=0,$=new j.e,te={snapDistance:0};G.dragBehavior=new H.a({dragAxis:w}),G.dragBehavior.moveAttached=!1,G._rootMesh.addBehavior(G.dragBehavior);var ie=new j.e,oe=new j.a;G.dragBehavior.onDragObservable.add((function(D){if(G.attachedMesh)if(G.attachedMesh.parent?(G.attachedMesh.parent.computeWorldMatrix().invertToRef(oe),oe.setTranslationFromFloats(0,0,0),j.e.TransformCoordinatesToRef(D.delta,oe,ie)):ie.copyFrom(D.delta),0==G.snapDistance)G.attachedMesh.position.addInPlace(ie);else if(X+=D.dragDistance,Math.abs(X)>G.snapDistance){var w=Math.floor(Math.abs(X)/G.snapDistance);X%=G.snapDistance,ie.normalizeToRef($),$.scaleInPlace(G.snapDistance*w),G.attachedMesh.position.addInPlace($),te.snapDistance=G.snapDistance*w,G.onSnapObservable.notifyObservers(te)}})),G._pointerObserver=F.utilityLayerScene.onPointerObservable.add((function(D){if(!G._customMeshSet){var w=D.pickInfo&&-1!=G._rootMesh.getChildMeshes().indexOf(D.pickInfo.pickedMesh)?G._hoverMaterial:G._coloredMaterial;G._rootMesh.getChildMeshes().forEach((function(D){D.material=w,D.color&&(D.color=w.diffuseColor)}))}}));var ce=F._getSharedGizmoLight();return ce.includedOnlyMeshes=ce.includedOnlyMeshes.concat(G._rootMesh.getChildMeshes(!1)),G}return Object(F.d)(t,D),t._CreateArrow=function(D,w){var N=new z.a("arrow",D),F=G.a.CreateCylinder("cylinder",{diameterTop:0,height:.075,diameterBottom:.0375,tessellation:96},D),k=G.a.CreateCylinder("cylinder",{diameterTop:.005,height:.275,diameterBottom:.005,tessellation:96},D);return k.material=w,F.parent=N,k.parent=N,F.material=w,F.rotation.x=Math.PI/2,F.position.z+=.3,k.position.z+=.1375,k.rotation.x=Math.PI/2,N},t._CreateArrowInstance=function(D,w){for(var N=new z.a("arrow",D),F=0,k=w.getChildMeshes();F<k.length;F++){var j=k[F];j.createInstance(j.name).parent=N}return N},t.prototype._attachedMeshChanged=function(D){this.dragBehavior&&(this.dragBehavior.enabled=!!D)},Object.defineProperty(t.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(D){this._isEnabled=D,D?this._parent&&(this.attachedMesh=this._parent.attachedMesh):this.attachedMesh=null},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this.onSnapObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.dragBehavior.detach(),this._arrow&&this._arrow.dispose(),[this._coloredMaterial,this._hoverMaterial].forEach((function(D){D&&D.dispose()})),D.prototype.dispose.call(this)},t}(X.a)},function(D,w,N){"use strict";N.d(w,"a",(function(){return F}));var F=function(){function e(){this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1}return Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._isDirty},enumerable:!0,configurable:!0}),e.prototype.markAsProcessed=function(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._areImageProcessingDirty=!1},e.prototype.markAsUnprocessed=function(){this._isDirty=!0},e.prototype.markAllAsDirty=function(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._areImageProcessingDirty=!0,this._isDirty=!0},e.prototype.markAsImageProcessingDirty=function(){this._areImageProcessingDirty=!0,this._isDirty=!0},e.prototype.markAsLightDirty=function(D){void 0===D&&(D=!1),this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||D,this._isDirty=!0},e.prototype.markAsAttributesDirty=function(){this._areAttributesDirty=!0,this._isDirty=!0},e.prototype.markAsTexturesDirty=function(){this._areTexturesDirty=!0,this._isDirty=!0},e.prototype.markAsFresnelDirty=function(){this._areFresnelDirty=!0,this._isDirty=!0},e.prototype.markAsMiscDirty=function(){this._areMiscDirty=!0,this._isDirty=!0},e.prototype.rebuild=function(){this._keys&&delete this._keys,this._keys=[];for(var D=0,w=Object.keys(this);D<w.length;D++){var N=w[D];"_"!==N[0]&&this._keys.push(N)}},e.prototype.isEqual=function(D){if(this._keys.length!==D._keys.length)return!1;for(var w=0;w<this._keys.length;w++){var N=this._keys[w];if(this[N]!==D[N])return!1}return!0},e.prototype.cloneTo=function(D){this._keys.length!==D._keys.length&&(D._keys=this._keys.slice(0));for(var w=0;w<this._keys.length;w++){var N=this._keys[w];D[N]=this[N]}},e.prototype.reset=function(){for(var D=0;D<this._keys.length;D++){var w=this._keys[D];switch(typeof this[w]){case"number":this[w]=0;break;case"string":this[w]="";break;default:this[w]=!1}}},e.prototype.toString=function(){for(var D="",w=0;w<this._keys.length;w++){var N=this._keys[w],F=this[N];switch(typeof F){case"number":case"string":D+="#define "+N+" "+F+"\n";break;default:F&&(D+="#define "+N+"\n")}}return D},e}()},function(D,w,N){"use strict";N(8).a.IncludesShadersStore.bonesDeclaration="#if NUM_BONE_INFLUENCERS>0\n#ifdef BONETEXTURE\nuniform sampler2D boneSampler;\nuniform float boneTextureWidth;\n#else\nuniform mat4 mBones[BonesPerMesh];\n#endif\nattribute vec4 matricesIndices;\nattribute vec4 matricesWeights;\n#if NUM_BONE_INFLUENCERS>4\nattribute vec4 matricesIndicesExtra;\nattribute vec4 matricesWeightsExtra;\n#endif\n#ifdef BONETEXTURE\nmat4 readMatrixFromRawSampler(sampler2D smp,float index)\n{\nfloat offset=index*4.0;\nfloat dx=1.0/boneTextureWidth;\nvec4 m0=texture2D(smp,vec2(dx*(offset+0.5),0.));\nvec4 m1=texture2D(smp,vec2(dx*(offset+1.5),0.));\nvec4 m2=texture2D(smp,vec2(dx*(offset+2.5),0.));\nvec4 m3=texture2D(smp,vec2(dx*(offset+3.5),0.));\nreturn mat4(m0,m1,m2,m3);\n}\n#endif\n#endif"},function(D,w,N){"use strict";N(8).a.IncludesShadersStore.bonesVertex="#if NUM_BONE_INFLUENCERS>0\nmat4 influence;\n#ifdef BONETEXTURE\ninfluence=readMatrixFromRawSampler(boneSampler,matricesIndices[0])*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndices[1])*matricesWeights[1];\n#endif\n#if NUM_BONE_INFLUENCERS>2\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndices[2])*matricesWeights[2];\n#endif\n#if NUM_BONE_INFLUENCERS>3\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndices[3])*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[0])*matricesWeightsExtra[0];\n#endif\n#if NUM_BONE_INFLUENCERS>5\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[1])*matricesWeightsExtra[1];\n#endif\n#if NUM_BONE_INFLUENCERS>6\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[2])*matricesWeightsExtra[2];\n#endif\n#if NUM_BONE_INFLUENCERS>7\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[3])*matricesWeightsExtra[3];\n#endif\n#else\ninfluence=mBones[int(matricesIndices[0])]*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\ninfluence+=mBones[int(matricesIndices[1])]*matricesWeights[1];\n#endif\n#if NUM_BONE_INFLUENCERS>2\ninfluence+=mBones[int(matricesIndices[2])]*matricesWeights[2];\n#endif\n#if NUM_BONE_INFLUENCERS>3\ninfluence+=mBones[int(matricesIndices[3])]*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\ninfluence+=mBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];\n#endif\n#if NUM_BONE_INFLUENCERS>5\ninfluence+=mBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];\n#endif\n#if NUM_BONE_INFLUENCERS>6\ninfluence+=mBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];\n#endif\n#if NUM_BONE_INFLUENCERS>7\ninfluence+=mBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];\n#endif\n#endif\nfinalWorld=finalWorld*influence;\n#endif"},function(D,w,N){"use strict";N.d(w,"a",(function(){return F}));var F=function(){function e(){}return e.FilesToLoad={},e}()},function(D,w,N){"use strict";N(8).a.IncludesShadersStore.instancesDeclaration="#ifdef INSTANCES\nattribute vec4 world0;\nattribute vec4 world1;\nattribute vec4 world2;\nattribute vec4 world3;\n#else\nuniform mat4 world;\n#endif"},function(D,w,N){"use strict";N(8).a.IncludesShadersStore.instancesVertex="#ifdef INSTANCES\nmat4 finalWorld=mat4(world0,world1,world2,world3);\n#else\nmat4 finalWorld=world;\n#endif"},function(D,w,N){"use strict";N.d(w,"a",(function(){return j}));var F=N(5),k=N(15);k.a.CreatePlane=function(D){var w=[],N=[],F=[],j=[],z=D.width||D.size||1,G=D.height||D.size||1,H=0===D.sideOrientation?0:D.sideOrientation||k.a.DEFAULTSIDE,X=z/2,q=G/2;N.push(-X,-q,0),F.push(0,0,-1),j.push(0,0),N.push(X,-q,0),F.push(0,0,-1),j.push(1,0),N.push(X,q,0),F.push(0,0,-1),j.push(1,1),N.push(-X,q,0),F.push(0,0,-1),j.push(0,1),w.push(0),w.push(1),w.push(2),w.push(0),w.push(2),w.push(3),k.a._ComputeSides(H,N,w,F,j,D.frontUVs,D.backUVs);var Z=new k.a;return Z.indices=w,Z.positions=N,Z.normals=F,Z.uvs=j,Z},F.a.CreatePlane=function(D,w,N,F,k){var z={size:w,width:w,height:w,sideOrientation:k,updatable:F};return j.CreatePlane(D,z,N)};var j=function(){function e(){}return e.CreatePlane=function(D,w,N){void 0===N&&(N=null);var j=new F.a(D,N);return w.sideOrientation=F.a._GetDefaultSideOrientation(w.sideOrientation),j._originalBuilderSideOrientation=w.sideOrientation,k.a.CreatePlane(w).applyToMesh(j,w.updatable),w.sourcePlane&&(j.translate(w.sourcePlane.normal,-w.sourcePlane.d),j.setDirection(w.sourcePlane.normal.scale(-1))),j},e}()},function(D,w,N){"use strict";N.d(w,"a",(function(){return X}));var F=N(1),k=N(3),j=N(0),z=N(10),G=N(26),H=N(50);G.a.AddNodeConstructor("Light_Type_3",(function(D,w){return function(){return new X(D,j.e.Zero(),w)}}));var X=function(D){function t(w,N,F){var k=D.call(this,w,F)||this;return k.groundColor=new z.a(0,0,0),k.direction=N||j.e.Up(),k}return Object(F.d)(t,D),t.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},t.prototype.getClassName=function(){return"HemisphericLight"},t.prototype.setDirectionToTarget=function(D){return this.direction=j.e.Normalize(D.subtract(j.e.Zero())),this.direction},t.prototype.getShadowGenerator=function(){return null},t.prototype.transferToEffect=function(D,w){var N=j.e.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",N.x,N.y,N.z,0,w),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.intensity),w),this},t.prototype.transferToNodeMaterialEffect=function(D,w){var N=j.e.Normalize(this.direction);return D.setFloat3(w,N.x,N.y,N.z),this},t.prototype.computeWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=j.a.Identity()),this._worldMatrix},t.prototype.getTypeID=function(){return H.a.LIGHTTYPEID_HEMISPHERICLIGHT},t.prototype.prepareLightSpecificDefines=function(D,w){D["HEMILIGHT"+w]=!0},Object(F.c)([Object(k.e)()],t.prototype,"groundColor",void 0),Object(F.c)([Object(k.o)()],t.prototype,"direction",void 0),t}(H.a)},function(D,w,N){"use strict";N.d(w,"a",(function(){return j}));var F=N(1),k=N(0),j=function(D){function t(w,N){var F=D.call(this,w,N)||this;return F._normalMatrix=new k.a,F.allowShaderHotSwapping=!0,F._storeEffectOnSubMeshes=!0,F}return Object(F.d)(t,D),t.prototype.getEffect=function(){return this._activeEffect},t.prototype.isReady=function(D,w){return!!D&&(!D.subMeshes||0===D.subMeshes.length||this.isReadyForSubMesh(D,D.subMeshes[0],w))},t.prototype.bindOnlyWorldMatrix=function(D){this._activeEffect.setMatrix("world",D)},t.prototype.bindOnlyNormalMatrix=function(D){this._activeEffect.setMatrix("normalMatrix",D)},t.prototype.bind=function(D,w){w&&this.bindForSubMesh(D,w,w.subMeshes[0])},t.prototype._afterBind=function(w,N){void 0===N&&(N=null),D.prototype._afterBind.call(this,w),this.getScene()._cachedEffect=N},t.prototype._mustRebind=function(D,w,N){return void 0===N&&(N=1),D.isCachedMaterialInvalid(this,w,N)},t}(N(29).a)},function(D,w,N){"use strict";N.d(w,"a",(function(){return $}));var F=N(1),k=N(3),j=N(0),z=N(4),G=N(9),H=N(16),X=N(29),q=N(12),Z=N(10),J=N(64),$=function(D){function t(w,N,k,z){void 0===z&&(z={});var G=D.call(this,w,N)||this;return G._textures={},G._textureArrays={},G._floats={},G._ints={},G._floatsArrays={},G._colors3={},G._colors3Arrays={},G._colors4={},G._colors4Arrays={},G._vectors2={},G._vectors3={},G._vectors4={},G._matrices={},G._matrixArrays={},G._matrices3x3={},G._matrices2x2={},G._vectors2Arrays={},G._vectors3Arrays={},G._vectors4Arrays={},G._cachedWorldViewMatrix=new j.a,G._cachedWorldViewProjectionMatrix=new j.a,G._multiview=!1,G._shaderPath=k,G._options=Object(F.a)({needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","normal","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],defines:[]},z),G}return Object(F.d)(t,D),Object.defineProperty(t.prototype,"shaderPath",{get:function(){return this._shaderPath},set:function(D){this._shaderPath=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"options",{get:function(){return this._options},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"ShaderMaterial"},t.prototype.needAlphaBlending=function(){return this.alpha<1||this._options.needAlphaBlending},t.prototype.needAlphaTesting=function(){return this._options.needAlphaTesting},t.prototype._checkUniform=function(D){-1===this._options.uniforms.indexOf(D)&&this._options.uniforms.push(D)},t.prototype.setTexture=function(D,w){return-1===this._options.samplers.indexOf(D)&&this._options.samplers.push(D),this._textures[D]=w,this},t.prototype.setTextureArray=function(D,w){return-1===this._options.samplers.indexOf(D)&&this._options.samplers.push(D),this._checkUniform(D),this._textureArrays[D]=w,this},t.prototype.setFloat=function(D,w){return this._checkUniform(D),this._floats[D]=w,this},t.prototype.setInt=function(D,w){return this._checkUniform(D),this._ints[D]=w,this},t.prototype.setFloats=function(D,w){return this._checkUniform(D),this._floatsArrays[D]=w,this},t.prototype.setColor3=function(D,w){return this._checkUniform(D),this._colors3[D]=w,this},t.prototype.setColor3Array=function(D,w){return this._checkUniform(D),this._colors3Arrays[D]=w.reduce((function(D,w){return w.toArray(D,D.length),D}),[]),this},t.prototype.setColor4=function(D,w){return this._checkUniform(D),this._colors4[D]=w,this},t.prototype.setColor4Array=function(D,w){return this._checkUniform(D),this._colors4Arrays[D]=w.reduce((function(D,w){return w.toArray(D,D.length),D}),[]),this},t.prototype.setVector2=function(D,w){return this._checkUniform(D),this._vectors2[D]=w,this},t.prototype.setVector3=function(D,w){return this._checkUniform(D),this._vectors3[D]=w,this},t.prototype.setVector4=function(D,w){return this._checkUniform(D),this._vectors4[D]=w,this},t.prototype.setMatrix=function(D,w){return this._checkUniform(D),this._matrices[D]=w,this},t.prototype.setMatrices=function(D,w){this._checkUniform(D);for(var N=new Float32Array(16*w.length),F=0;F<w.length;F++)w[F].copyToArray(N,16*F);return this._matrixArrays[D]=N,this},t.prototype.setMatrix3x3=function(D,w){return this._checkUniform(D),this._matrices3x3[D]=w,this},t.prototype.setMatrix2x2=function(D,w){return this._checkUniform(D),this._matrices2x2[D]=w,this},t.prototype.setArray2=function(D,w){return this._checkUniform(D),this._vectors2Arrays[D]=w,this},t.prototype.setArray3=function(D,w){return this._checkUniform(D),this._vectors3Arrays[D]=w,this},t.prototype.setArray4=function(D,w){return this._checkUniform(D),this._vectors4Arrays[D]=w,this},t.prototype._checkCache=function(D,w){return!D||!this._effect||-1!==this._effect.defines.indexOf("#define INSTANCES")===w},t.prototype.isReadyForSubMesh=function(D,w,N){return this.isReady(D,N)},t.prototype.isReady=function(D,w){if(this._effect&&this.isFrozen&&this._effect._wasPreviouslyReady)return!0;var N=this.getScene(),F=N.getEngine();if(!this.checkReadyOnEveryCall&&this._renderId===N.getRenderId()&&this._checkCache(D,w))return!0;var k=[],j=[],G=new J.a;F.getCaps().multiview&&N.activeCamera&&N.activeCamera.outputRenderTarget&&N.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,k.push("#define MULTIVIEW"),-1!==this._options.uniforms.indexOf("viewProjection")&&-1===this._options.uniforms.push("viewProjectionR")&&this._options.uniforms.push("viewProjectionR"));for(var X=0;X<this._options.defines.length;X++)k.push(this._options.defines[X]);for(X=0;X<this._options.attributes.length;X++)j.push(this._options.attributes[X]);if(D&&D.isVerticesDataPresent(z.b.ColorKind)&&(j.push(z.b.ColorKind),k.push("#define VERTEXCOLOR")),w&&(k.push("#define INSTANCES"),H.a.PushAttributesForInstances(j)),D&&D.useBones&&D.computeBonesUsingShaders&&D.skeleton){j.push(z.b.MatricesIndicesKind),j.push(z.b.MatricesWeightsKind),D.numBoneInfluencers>4&&(j.push(z.b.MatricesIndicesExtraKind),j.push(z.b.MatricesWeightsExtraKind));var q=D.skeleton;k.push("#define NUM_BONE_INFLUENCERS "+D.numBoneInfluencers),G.addCPUSkinningFallback(0,D),q.isUsingTextureForMatrices?(k.push("#define BONETEXTURE"),-1===this._options.uniforms.indexOf("boneTextureWidth")&&this._options.uniforms.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(k.push("#define BonesPerMesh "+(q.bones.length+1)),-1===this._options.uniforms.indexOf("mBones")&&this._options.uniforms.push("mBones"))}else k.push("#define NUM_BONE_INFLUENCERS 0");for(var Z in this._textures)if(!this._textures[Z].isReady())return!1;D&&this._shouldTurnAlphaTestOn(D)&&k.push("#define ALPHATEST");var $=this._effect,te=k.join("\n");return this._effect=F.createEffect(this._shaderPath,{attributes:j,uniformsNames:this._options.uniforms,uniformBuffersNames:this._options.uniformBuffers,samplers:this._options.samplers,defines:te,fallbacks:G,onCompiled:this.onCompiled,onError:this.onError},F),!!this._effect.isReady()&&($!==this._effect&&N.resetCachedMaterial(),this._renderId=N.getRenderId(),this._effect._wasPreviouslyReady=!0,!0)},t.prototype.bindOnlyWorldMatrix=function(D){var w=this.getScene();this._effect&&(-1!==this._options.uniforms.indexOf("world")&&this._effect.setMatrix("world",D),-1!==this._options.uniforms.indexOf("worldView")&&(D.multiplyToRef(w.getViewMatrix(),this._cachedWorldViewMatrix),this._effect.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==this._options.uniforms.indexOf("worldViewProjection")&&(D.multiplyToRef(w.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),this._effect.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)))},t.prototype.bind=function(D,w){if(this.bindOnlyWorldMatrix(D),this._effect&&this.getScene().getCachedMaterial()!==this){var N;for(N in-1!==this._options.uniforms.indexOf("view")&&this._effect.setMatrix("view",this.getScene().getViewMatrix()),-1!==this._options.uniforms.indexOf("projection")&&this._effect.setMatrix("projection",this.getScene().getProjectionMatrix()),-1!==this._options.uniforms.indexOf("viewProjection")&&(this._effect.setMatrix("viewProjection",this.getScene().getTransformMatrix()),this._multiview&&this._effect.setMatrix("viewProjectionR",this.getScene()._transformMatrixR)),this.getScene().activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&this._effect.setVector3("cameraPosition",this.getScene().activeCamera.globalPosition),H.a.BindBonesParameters(w,this._effect),this._textures)this._effect.setTexture(N,this._textures[N]);for(N in this._textureArrays)this._effect.setTextureArray(N,this._textureArrays[N]);for(N in this._ints)this._effect.setInt(N,this._ints[N]);for(N in this._floats)this._effect.setFloat(N,this._floats[N]);for(N in this._floatsArrays)this._effect.setArray(N,this._floatsArrays[N]);for(N in this._colors3)this._effect.setColor3(N,this._colors3[N]);for(N in this._colors3Arrays)this._effect.setArray3(N,this._colors3Arrays[N]);for(N in this._colors4){var F=this._colors4[N];this._effect.setFloat4(N,F.r,F.g,F.b,F.a)}for(N in this._colors4Arrays)this._effect.setArray4(N,this._colors4Arrays[N]);for(N in this._vectors2)this._effect.setVector2(N,this._vectors2[N]);for(N in this._vectors3)this._effect.setVector3(N,this._vectors3[N]);for(N in this._vectors4)this._effect.setVector4(N,this._vectors4[N]);for(N in this._matrices)this._effect.setMatrix(N,this._matrices[N]);for(N in this._matrixArrays)this._effect.setMatrices(N,this._matrixArrays[N]);for(N in this._matrices3x3)this._effect.setMatrix3x3(N,this._matrices3x3[N]);for(N in this._matrices2x2)this._effect.setMatrix2x2(N,this._matrices2x2[N]);for(N in this._vectors2Arrays)this._effect.setArray2(N,this._vectors2Arrays[N]);for(N in this._vectors3Arrays)this._effect.setArray3(N,this._vectors3Arrays[N]);for(N in this._vectors4Arrays)this._effect.setArray4(N,this._vectors4Arrays[N])}this._afterBind(w)},t.prototype.getActiveTextures=function(){var w=D.prototype.getActiveTextures.call(this);for(var N in this._textures)w.push(this._textures[N]);for(var N in this._textureArrays)for(var F=this._textureArrays[N],k=0;k<F.length;k++)w.push(F[k]);return w},t.prototype.hasTexture=function(w){if(D.prototype.hasTexture.call(this,w))return!0;for(var N in this._textures)if(this._textures[N]===w)return!0;for(var N in this._textureArrays)for(var F=this._textureArrays[N],k=0;k<F.length;k++)if(F[k]===w)return!0;return!1},t.prototype.clone=function(D){var w=this,N=k.a.Clone((function(){return new t(D,w.getScene(),w._shaderPath,w._options)}),this);for(var j in N.name=D,N.id=D,"object"==typeof N._shaderPath&&(N._shaderPath=Object(F.a)({},N._shaderPath)),this._options=Object(F.a)({},this._options),Object.keys(this._options).forEach((function(D){var N=w._options[D];Array.isArray(N)&&(w._options[D]=N.slice(0))})),this._textures)N.setTexture(j,this._textures[j]);for(var j in this._floats)N.setFloat(j,this._floats[j]);for(var j in this._floatsArrays)N.setFloats(j,this._floatsArrays[j]);for(var j in this._colors3)N.setColor3(j,this._colors3[j]);for(var j in this._colors4)N.setColor4(j,this._colors4[j]);for(var j in this._vectors2)N.setVector2(j,this._vectors2[j]);for(var j in this._vectors3)N.setVector3(j,this._vectors3[j]);for(var j in this._vectors4)N.setVector4(j,this._vectors4[j]);for(var j in this._matrices)N.setMatrix(j,this._matrices[j]);for(var j in this._matrices3x3)N.setMatrix3x3(j,this._matrices3x3[j]);for(var j in this._matrices2x2)N.setMatrix2x2(j,this._matrices2x2[j]);return N},t.prototype.dispose=function(w,N,F){if(N){var k;for(k in this._textures)this._textures[k].dispose();for(k in this._textureArrays)for(var j=this._textureArrays[k],z=0;z<j.length;z++)j[z].dispose()}this._textures={},D.prototype.dispose.call(this,w,N,F)},t.prototype.serialize=function(){var D,w=k.a.Serialize(this);for(D in w.customType="BABYLON.ShaderMaterial",w.options=this._options,w.shaderPath=this._shaderPath,w.textures={},this._textures)w.textures[D]=this._textures[D].serialize();for(D in w.textureArrays={},this._textureArrays){w.textureArrays[D]=[];for(var N=this._textureArrays[D],F=0;F<N.length;F++)w.textureArrays[D].push(N[F].serialize())}for(D in w.floats={},this._floats)w.floats[D]=this._floats[D];for(D in w.FloatArrays={},this._floatsArrays)w.FloatArrays[D]=this._floatsArrays[D];for(D in w.colors3={},this._colors3)w.colors3[D]=this._colors3[D].asArray();for(D in w.colors3Arrays={},this._colors3Arrays)w.colors3Arrays[D]=this._colors3Arrays[D];for(D in w.colors4={},this._colors4)w.colors4[D]=this._colors4[D].asArray();for(D in w.colors4Arrays={},this._colors4Arrays)w.colors4Arrays[D]=this._colors4Arrays[D];for(D in w.vectors2={},this._vectors2)w.vectors2[D]=this._vectors2[D].asArray();for(D in w.vectors3={},this._vectors3)w.vectors3[D]=this._vectors3[D].asArray();for(D in w.vectors4={},this._vectors4)w.vectors4[D]=this._vectors4[D].asArray();for(D in w.matrices={},this._matrices)w.matrices[D]=this._matrices[D].asArray();for(D in w.matrixArray={},this._matrixArrays)w.matrixArray[D]=this._matrixArrays[D];for(D in w.matrices3x3={},this._matrices3x3)w.matrices3x3[D]=this._matrices3x3[D];for(D in w.matrices2x2={},this._matrices2x2)w.matrices2x2[D]=this._matrices2x2[D];for(D in w.vectors2Arrays={},this._vectors2Arrays)w.vectors2Arrays[D]=this._vectors2Arrays[D];for(D in w.vectors3Arrays={},this._vectors3Arrays)w.vectors3Arrays[D]=this._vectors3Arrays[D];for(D in w.vectors4Arrays={},this._vectors4Arrays)w.vectors4Arrays[D]=this._vectors4Arrays[D];return w},t.Parse=function(D,w,N){var F,z=k.a.Parse((function(){return new t(D.name,w,D.shaderPath,D.options)}),D,w,N);for(F in D.textures)z.setTexture(F,G.a.Parse(D.textures[F],w,N));for(F in D.textureArrays){for(var H=D.textureArrays[F],X=new Array,q=0;q<H.length;q++)X.push(G.a.Parse(H[q],w,N));z.setTextureArray(F,X)}for(F in D.floats)z.setFloat(F,D.floats[F]);for(F in D.floatsArrays)z.setFloats(F,D.floatsArrays[F]);for(F in D.colors3)z.setColor3(F,Z.a.FromArray(D.colors3[F]));for(F in D.colors3Arrays){var J=D.colors3Arrays[F].reduce((function(D,w,N){return N%3==0?D.push([w]):D[D.length-1].push(w),D}),[]).map((function(D){return Z.a.FromArray(D)}));z.setColor3Array(F,J)}for(F in D.colors4)z.setColor4(F,Z.b.FromArray(D.colors4[F]));for(F in D.colors4Arrays)J=D.colors4Arrays[F].reduce((function(D,w,N){return N%4==0?D.push([w]):D[D.length-1].push(w),D}),[]).map((function(D){return Z.b.FromArray(D)})),z.setColor4Array(F,J);for(F in D.vectors2)z.setVector2(F,j.d.FromArray(D.vectors2[F]));for(F in D.vectors3)z.setVector3(F,j.e.FromArray(D.vectors3[F]));for(F in D.vectors4)z.setVector4(F,j.f.FromArray(D.vectors4[F]));for(F in D.matrices)z.setMatrix(F,j.a.FromArray(D.matrices[F]));for(F in D.matrixArray)z._matrixArrays[F]=new Float32Array(D.matrixArray[F]);for(F in D.matrices3x3)z.setMatrix3x3(F,D.matrices3x3[F]);for(F in D.matrices2x2)z.setMatrix2x2(F,D.matrices2x2[F]);for(F in D.vectors2Arrays)z.setArray2(F,D.vectors2Arrays[F]);for(F in D.vectors3Arrays)z.setArray3(F,D.vectors3Arrays[F]);for(F in D.vectors4Arrays)z.setArray4(F,D.vectors4Arrays[F]);return z},t}(X.a);q.a.RegisteredTypes["BABYLON.ShaderMaterial"]=$},function(D,w,N){"use strict";var F=N(7),k=N(31),j=N(84);k.a.prototype.createUniformBuffer=function(D){var w=this._gl.createBuffer();if(!w)throw new Error("Unable to create uniform buffer");var N=new j.a(w);return this.bindUniformBuffer(N),D instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,D,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(D),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),N.references=1,N},k.a.prototype.createDynamicUniformBuffer=function(D){var w=this._gl.createBuffer();if(!w)throw new Error("Unable to create dynamic uniform buffer");var N=new j.a(w);return this.bindUniformBuffer(N),D instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,D,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(D),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),N.references=1,N},k.a.prototype.updateUniformBuffer=function(D,w,N,F){this.bindUniformBuffer(D),void 0===N&&(N=0),void 0===F?w instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,N,w):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,N,new Float32Array(w)):w instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,w.subarray(N,N+F)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(w).subarray(N,N+F)),this.bindUniformBuffer(null)},k.a.prototype.bindUniformBuffer=function(D){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,D?D.underlyingResource:null)},k.a.prototype.bindUniformBufferBase=function(D,w){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,w,D?D.underlyingResource:null)},k.a.prototype.bindUniformBlock=function(D,w,N){var F=D.program,k=this._gl.getUniformBlockIndex(F,w);this._gl.uniformBlockBinding(F,k,N)},N.d(w,"a",(function(){return z}));var z=function(){function e(D,w,N){this._alreadyBound=!1,this._valueCache={},this._engine=D,this._noUBO=!D.supportsUniformBuffers,this._dynamic=N,this._data=w||[],this._uniformLocations={},this._uniformSizes={},this._uniformLocationPointer=0,this._needSync=!1,this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateMatrix=this._updateMatrixForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateMatrix=this._updateMatrixForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform)}return Object.defineProperty(e.prototype,"useUbo",{get:function(){return!this._noUBO},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSync",{get:function(){return!this._needSync},enumerable:!0,configurable:!0}),e.prototype.isDynamic=function(){return void 0!==this._dynamic},e.prototype.getData=function(){return this._bufferData},e.prototype.getBuffer=function(){return this._buffer},e.prototype._fillAlignment=function(D){var w;if(w=D<=2?D:4,this._uniformLocationPointer%w!=0){var N=this._uniformLocationPointer;this._uniformLocationPointer+=w-this._uniformLocationPointer%w;for(var F=this._uniformLocationPointer-N,k=0;k<F;k++)this._data.push(0)}},e.prototype.addUniform=function(D,w){if(!this._noUBO&&void 0===this._uniformLocations[D]){var N;if(w instanceof Array)w=(N=w).length;else{w=w,N=[];for(var F=0;F<w;F++)N.push(0)}for(this._fillAlignment(w),this._uniformSizes[D]=w,this._uniformLocations[D]=this._uniformLocationPointer,this._uniformLocationPointer+=w,F=0;F<w;F++)this._data.push(N[F]);this._needSync=!0}},e.prototype.addMatrix=function(D,w){this.addUniform(D,Array.prototype.slice.call(w.toArray()))},e.prototype.addFloat2=function(D,w,N){var F=[w,N];this.addUniform(D,F)},e.prototype.addFloat3=function(D,w,N,F){var k=[w,N,F];this.addUniform(D,k)},e.prototype.addColor3=function(D,w){var N=new Array;w.toArray(N),this.addUniform(D,N)},e.prototype.addColor4=function(D,w,N){var F=new Array;w.toArray(F),F.push(N),this.addUniform(D,F)},e.prototype.addVector3=function(D,w){var N=new Array;w.toArray(N),this.addUniform(D,N)},e.prototype.addMatrix3x3=function(D){this.addUniform(D,12)},e.prototype.addMatrix2x2=function(D){this.addUniform(D,8)},e.prototype.create=function(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)},e.prototype._rebuild=function(){!this._noUBO&&this._bufferData&&(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData):this._buffer=this._engine.createUniformBuffer(this._bufferData))},e.prototype.update=function(){this._buffer?(this._dynamic||this._needSync)&&(this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._needSync=!1):this.create()},e.prototype.updateUniform=function(D,w,N){var k=this._uniformLocations[D];if(void 0===k){if(this._buffer)return void F.a.Error("Cannot add an uniform after UBO has been created.");this.addUniform(D,N),k=this._uniformLocations[D]}if(this._buffer||this.create(),this._dynamic)for(z=0;z<N;z++)this._bufferData[k+z]=w[z];else{for(var j=!1,z=0;z<N;z++)16!==N&&this._bufferData[k+z]===w[z]||(j=!0,this._bufferData[k+z]=w[z]);this._needSync=this._needSync||j}},e.prototype._cacheMatrix=function(D,w){var N=this._valueCache[D],F=w.updateFlag;return(void 0===N||N!==F)&&(this._valueCache[D]=F,!0)},e.prototype._updateMatrix3x3ForUniform=function(D,w){for(var N=0;N<3;N++)e._tempBuffer[4*N]=w[3*N],e._tempBuffer[4*N+1]=w[3*N+1],e._tempBuffer[4*N+2]=w[3*N+2],e._tempBuffer[4*N+3]=0;this.updateUniform(D,e._tempBuffer,12)},e.prototype._updateMatrix3x3ForEffect=function(D,w){this._currentEffect.setMatrix3x3(D,w)},e.prototype._updateMatrix2x2ForEffect=function(D,w){this._currentEffect.setMatrix2x2(D,w)},e.prototype._updateMatrix2x2ForUniform=function(D,w){for(var N=0;N<2;N++)e._tempBuffer[4*N]=w[2*N],e._tempBuffer[4*N+1]=w[2*N+1],e._tempBuffer[4*N+2]=0,e._tempBuffer[4*N+3]=0;this.updateUniform(D,e._tempBuffer,8)},e.prototype._updateFloatForEffect=function(D,w){this._currentEffect.setFloat(D,w)},e.prototype._updateFloatForUniform=function(D,w){e._tempBuffer[0]=w,this.updateUniform(D,e._tempBuffer,1)},e.prototype._updateFloat2ForEffect=function(D,w,N,F){void 0===F&&(F=""),this._currentEffect.setFloat2(D+F,w,N)},e.prototype._updateFloat2ForUniform=function(D,w,N){e._tempBuffer[0]=w,e._tempBuffer[1]=N,this.updateUniform(D,e._tempBuffer,2)},e.prototype._updateFloat3ForEffect=function(D,w,N,F,k){void 0===k&&(k=""),this._currentEffect.setFloat3(D+k,w,N,F)},e.prototype._updateFloat3ForUniform=function(D,w,N,F){e._tempBuffer[0]=w,e._tempBuffer[1]=N,e._tempBuffer[2]=F,this.updateUniform(D,e._tempBuffer,3)},e.prototype._updateFloat4ForEffect=function(D,w,N,F,k,j){void 0===j&&(j=""),this._currentEffect.setFloat4(D+j,w,N,F,k)},e.prototype._updateFloat4ForUniform=function(D,w,N,F,k){e._tempBuffer[0]=w,e._tempBuffer[1]=N,e._tempBuffer[2]=F,e._tempBuffer[3]=k,this.updateUniform(D,e._tempBuffer,4)},e.prototype._updateMatrixForEffect=function(D,w){this._currentEffect.setMatrix(D,w)},e.prototype._updateMatrixForUniform=function(D,w){this._cacheMatrix(D,w)&&this.updateUniform(D,w.toArray(),16)},e.prototype._updateVector3ForEffect=function(D,w){this._currentEffect.setVector3(D,w)},e.prototype._updateVector3ForUniform=function(D,w){w.toArray(e._tempBuffer),this.updateUniform(D,e._tempBuffer,3)},e.prototype._updateVector4ForEffect=function(D,w){this._currentEffect.setVector4(D,w)},e.prototype._updateVector4ForUniform=function(D,w){w.toArray(e._tempBuffer),this.updateUniform(D,e._tempBuffer,4)},e.prototype._updateColor3ForEffect=function(D,w,N){void 0===N&&(N=""),this._currentEffect.setColor3(D+N,w)},e.prototype._updateColor3ForUniform=function(D,w){w.toArray(e._tempBuffer),this.updateUniform(D,e._tempBuffer,3)},e.prototype._updateColor4ForEffect=function(D,w,N,F){void 0===F&&(F=""),this._currentEffect.setColor4(D+F,w,N)},e.prototype._updateColor4ForUniform=function(D,w,N){w.toArray(e._tempBuffer),e._tempBuffer[3]=N,this.updateUniform(D,e._tempBuffer,4)},e.prototype.setTexture=function(D,w){this._currentEffect.setTexture(D,w)},e.prototype.updateUniformDirectly=function(D,w){this.updateUniform(D,w,w.length),this.update()},e.prototype.bindToEffect=function(D,w){this._currentEffect=D,!this._noUBO&&this._buffer&&(this._alreadyBound=!0,D.bindUniformBuffer(this._buffer,w))},e.prototype.dispose=function(){if(!this._noUBO){var D=this._engine._uniformBuffers,w=D.indexOf(this);-1!==w&&(D[w]=D[D.length-1],D.pop()),this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}},e._MAX_UNIFORM_SIZE=256,e._tempBuffer=new Float32Array(e._MAX_UNIFORM_SIZE),e}()},function(D,w,N){"use strict";N.d(w,"a",(function(){return k}));var F=N(1),k=function(D){function t(w){var N=D.call(this)||this;return N._buffer=w,N}return Object(F.d)(t,D),Object.defineProperty(t.prototype,"underlyingResource",{get:function(){return this._buffer},enumerable:!0,configurable:!0}),t}(N(85).a)},function(D,w,N){"use strict";N.d(w,"a",(function(){return F}));var F=function(){function e(){this.references=0,this.capacity=0,this.is32Bits=!1}return Object.defineProperty(e.prototype,"underlyingResource",{get:function(){return null},enumerable:!0,configurable:!0}),e}()},function(D,w,N){"use strict";N.d(w,"a",(function(){return k}));var F=N(60),k=function(){function e(){}return e.GetPlanes=function(D){for(var w=[],N=0;N<6;N++)w.push(new F.a(0,0,0,0));return e.GetPlanesToRef(D,w),w},e.GetNearPlaneToRef=function(D,w){var N=D.m;w.normal.x=N[3]+N[2],w.normal.y=N[7]+N[6],w.normal.z=N[11]+N[10],w.d=N[15]+N[14],w.normalize()},e.GetFarPlaneToRef=function(D,w){var N=D.m;w.normal.x=N[3]-N[2],w.normal.y=N[7]-N[6],w.normal.z=N[11]-N[10],w.d=N[15]-N[14],w.normalize()},e.GetLeftPlaneToRef=function(D,w){var N=D.m;w.normal.x=N[3]+N[0],w.normal.y=N[7]+N[4],w.normal.z=N[11]+N[8],w.d=N[15]+N[12],w.normalize()},e.GetRightPlaneToRef=function(D,w){var N=D.m;w.normal.x=N[3]-N[0],w.normal.y=N[7]-N[4],w.normal.z=N[11]-N[8],w.d=N[15]-N[12],w.normalize()},e.GetTopPlaneToRef=function(D,w){var N=D.m;w.normal.x=N[3]-N[1],w.normal.y=N[7]-N[5],w.normal.z=N[11]-N[9],w.d=N[15]-N[13],w.normalize()},e.GetBottomPlaneToRef=function(D,w){var N=D.m;w.normal.x=N[3]+N[1],w.normal.y=N[7]+N[5],w.normal.z=N[11]+N[9],w.d=N[15]+N[13],w.normalize()},e.GetPlanesToRef=function(D,w){e.GetNearPlaneToRef(D,w[0]),e.GetFarPlaneToRef(D,w[1]),e.GetLeftPlaneToRef(D,w[2]),e.GetRightPlaneToRef(D,w[3]),e.GetTopPlaneToRef(D,w[4]),e.GetBottomPlaneToRef(D,w[5])},e}()},function(D,w,N){"use strict";N.d(w,"a",(function(){return k}));var F=N(2),k=function(){function e(){this.hoverCursor="",this.actions=new Array,this.isRecursive=!1}return Object.defineProperty(e,"HasTriggers",{get:function(){for(var D in e.Triggers)if(e.Triggers.hasOwnProperty(D))return!0;return!1},enumerable:!0,configurable:!0}),Object.defineProperty(e,"HasPickTriggers",{get:function(){for(var D in e.Triggers)if(e.Triggers.hasOwnProperty(D)){var w=parseInt(D);if(w>=F.a.ACTION_OnPickTrigger&&w<=F.a.ACTION_OnPickUpTrigger)return!0}return!1},enumerable:!0,configurable:!0}),e.HasSpecificTrigger=function(D){for(var w in e.Triggers)if(e.Triggers.hasOwnProperty(w)&&parseInt(w)===D)return!0;return!1},e.Triggers={},e}()},function(D,w,N){"use strict";N(8).a.IncludesShadersStore.morphTargetsVertexGlobalDeclaration="#ifdef MORPHTARGETS\nuniform float morphTargetInfluences[NUM_MORPH_INFLUENCERS];\n#endif"},function(D,w,N){"use strict";N(8).a.IncludesShadersStore.morphTargetsVertexDeclaration="#ifdef MORPHTARGETS\nattribute vec3 position{X};\n#ifdef MORPHTARGETS_NORMAL\nattribute vec3 normal{X};\n#endif\n#ifdef MORPHTARGETS_TANGENT\nattribute vec3 tangent{X};\n#endif\n#ifdef MORPHTARGETS_UV\nattribute vec2 uv_{X};\n#endif\n#endif"},function(D,w,N){"use strict";N.d(w,"a",(function(){return z}));var F=N(29),k=N(4),j=N(2),z=function(){function e(D){this._vertexBuffers={},this._scene=D}return e.prototype._prepareBuffers=function(){if(!this._vertexBuffers[k.b.PositionKind]){var D=[];D.push(1,1),D.push(-1,1),D.push(-1,-1),D.push(1,-1),this._vertexBuffers[k.b.PositionKind]=new k.b(this._scene.getEngine(),D,k.b.PositionKind,!1,!1,2),this._buildIndexBuffer()}},e.prototype._buildIndexBuffer=function(){var D=[];D.push(0),D.push(1),D.push(2),D.push(0),D.push(2),D.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(D)},e.prototype._rebuild=function(){var D=this._vertexBuffers[k.b.PositionKind];D&&(D._rebuild(),this._buildIndexBuffer())},e.prototype._prepareFrame=function(D,w){void 0===D&&(D=null),void 0===w&&(w=null);var N=this._scene.activeCamera;return!(!N||!(w=w||N._postProcesses.filter((function(D){return null!=D})))||0===w.length||!this._scene.postProcessesEnabled||(w[0].activate(N,D,null!=w),0))},e.prototype.directRender=function(D,w,N,k,j){void 0===w&&(w=null),void 0===N&&(N=!1),void 0===k&&(k=0),void 0===j&&(j=0);for(var z=this._scene.getEngine(),G=0;G<D.length;G++){G<D.length-1?D[G+1].activate(this._scene.activeCamera,w):w?z.bindFramebuffer(w,k,void 0,void 0,N,j):z.restoreDefaultFramebuffer();var H=D[G],X=H.apply();X&&(H.onBeforeRenderObservable.notifyObservers(X),this._prepareBuffers(),z.bindBuffers(this._vertexBuffers,this._indexBuffer,X),z.drawElementsType(F.a.TriangleFillMode,0,6),H.onAfterRenderObservable.notifyObservers(X))}z.setDepthBuffer(!0),z.setDepthWrite(!0)},e.prototype._finalizeFrame=function(D,w,N,k,z){void 0===z&&(z=!1);var G=this._scene.activeCamera;if(G&&0!==(k=k||G._postProcesses.filter((function(D){return null!=D}))).length&&this._scene.postProcessesEnabled){for(var H=this._scene.getEngine(),X=0,q=k.length;X<q;X++){var Z=k[X];if(X<q-1?Z._outputTexture=k[X+1].activate(G,w):w?(H.bindFramebuffer(w,N,void 0,void 0,z),Z._outputTexture=w):(H.restoreDefaultFramebuffer(),Z._outputTexture=null),D)break;var J=Z.apply();J&&(Z.onBeforeRenderObservable.notifyObservers(J),this._prepareBuffers(),H.bindBuffers(this._vertexBuffers,this._indexBuffer,J),H.drawElementsType(F.a.TriangleFillMode,0,6),Z.onAfterRenderObservable.notifyObservers(J))}H.setDepthBuffer(!0),H.setDepthWrite(!0),H.setAlphaMode(j.a.ALPHA_DISABLE)}},e.prototype.dispose=function(){var D=this._vertexBuffers[k.b.PositionKind];D&&(D.dispose(),this._vertexBuffers[k.b.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)},e}()},function(D,w,N){"use strict";N.d(w,"a",(function(){return r})),N.d(w,"b",(function(){return k}));var F=N(134),r=function(){},k=function(){function e(D){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new r,this._scene=D;for(var w=e.MIN_RENDERINGGROUPS;w<e.MAX_RENDERINGGROUPS;w++)this._autoClearDepthStencil[w]={autoClear:!0,depth:!0,stencil:!0}}return e.prototype._clearDepthStencilBuffer=function(D,w){void 0===D&&(D=!0),void 0===w&&(w=!0),this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,D,w),this._depthStencilBufferAlreadyCleaned=!0)},e.prototype.render=function(D,w,N,F){var k=this._renderingGroupInfo;if(k.scene=this._scene,k.camera=this._scene.activeCamera,this._scene.spriteManagers&&F)for(var j=0;j<this._scene.spriteManagers.length;j++){var z=this._scene.spriteManagers[j];this.dispatchSprites(z)}for(j=e.MIN_RENDERINGGROUPS;j<e.MAX_RENDERINGGROUPS;j++){this._depthStencilBufferAlreadyCleaned=j===e.MIN_RENDERINGGROUPS;var G=this._renderingGroups[j];if(G){var H=Math.pow(2,j);if(k.renderingGroupId=j,this._scene.onBeforeRenderingGroupObservable.notifyObservers(k,H),e.AUTOCLEAR){var X=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(j):this._autoClearDepthStencil[j];X&&X.autoClear&&this._clearDepthStencilBuffer(X.depth,X.stencil)}for(var q=0,Z=this._scene._beforeRenderingGroupDrawStage;q<Z.length;q++)Z[q].action(j);G.render(D,F,N,w);for(var J=0,$=this._scene._afterRenderingGroupDrawStage;J<$.length;J++)$[J].action(j);this._scene.onAfterRenderingGroupObservable.notifyObservers(k,H)}}},e.prototype.reset=function(){for(var D=e.MIN_RENDERINGGROUPS;D<e.MAX_RENDERINGGROUPS;D++){var w=this._renderingGroups[D];w&&w.prepare()}},e.prototype.dispose=function(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null},e.prototype.freeRenderingGroups=function(){for(var D=e.MIN_RENDERINGGROUPS;D<e.MAX_RENDERINGGROUPS;D++){var w=this._renderingGroups[D];w&&w.dispose()}},e.prototype._prepareRenderingGroup=function(D){void 0===this._renderingGroups[D]&&(this._renderingGroups[D]=new F.a(D,this._scene,this._customOpaqueSortCompareFn[D],this._customAlphaTestSortCompareFn[D],this._customTransparentSortCompareFn[D]))},e.prototype.dispatchSprites=function(D){var w=D.renderingGroupId||0;this._prepareRenderingGroup(w),this._renderingGroups[w].dispatchSprites(D)},e.prototype.dispatchParticles=function(D){var w=D.renderingGroupId||0;this._prepareRenderingGroup(w),this._renderingGroups[w].dispatchParticles(D)},e.prototype.dispatch=function(D,w,N){void 0===w&&(w=D.getMesh());var F=w.renderingGroupId||0;this._prepareRenderingGroup(F),this._renderingGroups[F].dispatch(D,w,N)},e.prototype.setRenderingOrder=function(D,w,N,F){if(void 0===w&&(w=null),void 0===N&&(N=null),void 0===F&&(F=null),this._customOpaqueSortCompareFn[D]=w,this._customAlphaTestSortCompareFn[D]=N,this._customTransparentSortCompareFn[D]=F,this._renderingGroups[D]){var k=this._renderingGroups[D];k.opaqueSortCompareFn=this._customOpaqueSortCompareFn[D],k.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[D],k.transparentSortCompareFn=this._customTransparentSortCompareFn[D]}},e.prototype.setRenderingAutoClearDepthStencil=function(D,w,N,F){void 0===N&&(N=!0),void 0===F&&(F=!0),this._autoClearDepthStencil[D]={autoClear:w,depth:N,stencil:F}},e.prototype.getAutoClearDepthStencilSetup=function(D){return this._autoClearDepthStencil[D]},e.MAX_RENDERINGGROUPS=4,e.MIN_RENDERINGGROUPS=0,e.AUTOCLEAR=!0,e}()},function(D,w,N){"use strict";N.d(w,"b",(function(){return Z})),N.d(w,"a",(function(){return J}));var F=N(1),k=N(10),j=N(4),z=N(5),G=N(136),H=N(29),X=N(82),q=N(16),Z=(N(148),N(149),function(D){function t(w,N,F,z,G,H,q){void 0===N&&(N=null),void 0===F&&(F=null),void 0===z&&(z=null);var Z=D.call(this,w,N,F,z,G)||this;Z.useVertexColor=H,Z.useVertexAlpha=q,Z.color=new k.a(1,1,1),Z.alpha=1,z&&(Z.color=z.color.clone(),Z.alpha=z.alpha,Z.useVertexColor=z.useVertexColor,Z.useVertexAlpha=z.useVertexAlpha),Z.intersectionThreshold=.1;var J={attributes:[j.b.PositionKind,"world0","world1","world2","world3"],uniforms:["vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","world","viewProjection"],needAlphaBlending:!0,defines:[]};return!1===q&&(J.needAlphaBlending=!1),H?(J.defines.push("#define VERTEXCOLOR"),J.attributes.push(j.b.ColorKind)):(J.uniforms.push("color"),Z.color4=new k.b),Z._colorShader=new X.a("colorShader",Z.getScene(),"color",J),Z}return Object(F.d)(t,D),t.prototype._addClipPlaneDefine=function(D){var w="#define "+D;-1===this._colorShader.options.defines.indexOf(w)&&this._colorShader.options.defines.push(w)},t.prototype._removeClipPlaneDefine=function(D){var w="#define "+D,N=this._colorShader.options.defines.indexOf(w);-1!==N&&this._colorShader.options.defines.splice(N,1)},t.prototype.isReady=function(){var w=this.getScene();return w.clipPlane?this._addClipPlaneDefine("CLIPPLANE"):this._removeClipPlaneDefine("CLIPPLANE"),w.clipPlane2?this._addClipPlaneDefine("CLIPPLANE2"):this._removeClipPlaneDefine("CLIPPLANE2"),w.clipPlane3?this._addClipPlaneDefine("CLIPPLANE3"):this._removeClipPlaneDefine("CLIPPLANE3"),w.clipPlane4?this._addClipPlaneDefine("CLIPPLANE4"):this._removeClipPlaneDefine("CLIPPLANE4"),w.clipPlane5?this._addClipPlaneDefine("CLIPPLANE5"):this._removeClipPlaneDefine("CLIPPLANE5"),w.clipPlane6?this._addClipPlaneDefine("CLIPPLANE6"):this._removeClipPlaneDefine("CLIPPLANE6"),!!this._colorShader.isReady()&&D.prototype.isReady.call(this)},t.prototype.getClassName=function(){return"LinesMesh"},Object.defineProperty(t.prototype,"material",{get:function(){return this._colorShader},set:function(D){},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"checkCollisions",{get:function(){return!1},enumerable:!0,configurable:!0}),t.prototype._bind=function(D,w,N){if(!this._geometry)return this;var F=this._colorShader.getEffect(),k=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(this._geometry._bind(F,k),!this.useVertexColor){var j=this.color,z=j.r,G=j.g,H=j.b;this.color4.set(z,G,H,this.alpha),this._colorShader.setColor4("color",this.color4)}return q.a.BindClipPlane(F,this.getScene()),this},t.prototype._draw=function(D,w,N){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;var F=this.getScene().getEngine();return this._unIndexed?F.drawArraysType(H.a.LineListDrawMode,D.verticesStart,D.verticesCount,N):F.drawElementsType(H.a.LineListDrawMode,D.indexStart,D.indexCount,N),this},t.prototype.dispose=function(w){this._colorShader.dispose(!1,!1,!0),D.prototype.dispose.call(this,w)},t.prototype.clone=function(D,w,N){return void 0===w&&(w=null),new t(D,this.getScene(),w,this,N)},t.prototype.createInstance=function(D){return new J(D,this)},t}(z.a)),J=function(D){function t(w,N){var F=D.call(this,w,N)||this;return F.intersectionThreshold=N.intersectionThreshold,F}return Object(F.d)(t,D),t.prototype.getClassName=function(){return"InstancedLinesMesh"},t}(G.a)},function(D,w,N){"use strict";N.r(w);var F,k=N(0),j=N(32),z=N(72),G=N(10),H=function(){function e(D,w,N,F,H,X){if(void 0===w&&(w=1),void 0===N&&(N=2),this._scaleLinesFactor=4,this._instanced=!1,this.scaleLines=1,this.scaleLines=w,!F){var q=new j.a("",D);q.disableLighting=!0,q.emissiveColor=G.a.Red().scale(.5),F=z.a._CreateArrow(D,q)}if(!H){var Z=new j.a("",D);Z.disableLighting=!0,Z.emissiveColor=G.a.Green().scale(.5),H=z.a._CreateArrow(D,Z)}if(!X){var J=new j.a("",D);J.disableLighting=!0,J.emissiveColor=G.a.Blue().scale(.5),X=z.a._CreateArrow(D,J)}this._xAxis=F,this._xAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor),this._yAxis=H,this._yAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor),this._zAxis=X,this._zAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor),null!=N&&(e._SetRenderingGroupId(this._xAxis,N),e._SetRenderingGroupId(this._yAxis,N),e._SetRenderingGroupId(this._zAxis,N)),this.scene=D,this.update(new k.e,k.e.Right(),k.e.Up(),k.e.Forward())}return Object.defineProperty(e.prototype,"xAxis",{get:function(){return this._xAxis},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"yAxis",{get:function(){return this._yAxis},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"zAxis",{get:function(){return this._zAxis},enumerable:!0,configurable:!0}),e.prototype.update=function(D,w,N,F){this._xAxis.position.copyFrom(D),this._xAxis.setDirection(w),this._xAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor),this._yAxis.position.copyFrom(D),this._yAxis.setDirection(N),this._yAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor),this._zAxis.position.copyFrom(D),this._zAxis.setDirection(F),this._zAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor)},e.prototype.createInstance=function(){var D=z.a._CreateArrowInstance(this.scene,this._xAxis),w=z.a._CreateArrowInstance(this.scene,this._yAxis),N=z.a._CreateArrowInstance(this.scene,this._zAxis),F=new e(this.scene,this.scaleLines,null,D,w,N);return F._instanced=!0,F},e.prototype.dispose=function(){this._xAxis&&(this._xAxis.dispose(!1,!this._instanced),delete this._xAxis),this._yAxis&&(this._yAxis.dispose(!1,!this._instanced),delete this._yAxis),this._zAxis&&(this._zAxis.dispose(!1,!this._instanced),delete this._zAxis),delete this.scene},e._SetRenderingGroupId=function(D,w){D.getChildMeshes().forEach((function(D){D.renderingGroupId=w}))},e}(),X=N(1),q=N(22),Z=function(D){function t(w,N,F,j){void 0===j&&(j=1);var z=D.call(this,w,j)||this;return z.pos=k.e.Zero(),z.xaxis=k.e.Zero(),z.yaxis=k.e.Zero(),z.zaxis=k.e.Zero(),z.mesh=F,z.bone=N,z}return Object(X.d)(t,D),t.prototype.update=function(){if(this.mesh&&this.bone){var w=this.bone;w._markAsDirtyAndCompose(),w.getAbsolutePositionToRef(this.mesh,this.pos),w.getDirectionToRef(q.a.X,this.mesh,this.xaxis),w.getDirectionToRef(q.a.Y,this.mesh,this.yaxis),w.getDirectionToRef(q.a.Z,this.mesh,this.zaxis),D.prototype.update.call(this,this.pos,this.xaxis,this.yaxis,this.zaxis)}},t.prototype.dispose=function(){this.mesh&&(this.mesh=null,this.bone=null,D.prototype.dispose.call(this))},t}(H),J=N(13),$=N(6),te=N(18),ie=N(11);Object.defineProperty(te.a.prototype,"debugLayer",{get:function(){return this._debugLayer||(this._debugLayer=new oe(this)),this._debugLayer},enumerable:!0,configurable:!0}),function(D){D[D.Properties=0]="Properties",D[D.Debug=1]="Debug",D[D.Statistics=2]="Statistics",D[D.Tools=3]="Tools",D[D.Settings=4]="Settings"}(F||(F={}));var oe=function(){function e(D){var w=this;this.BJSINSPECTOR=this._getGlobalInspector(),this._scene=D,this._scene.onDisposeObservable.add((function(){w._scene._debugLayer&&w._scene._debugLayer.hide()}))}return Object.defineProperty(e.prototype,"onPropertyChangedObservable",{get:function(){return this.BJSINSPECTOR&&this.BJSINSPECTOR.Inspector?this.BJSINSPECTOR.Inspector.OnPropertyChangedObservable:(this._onPropertyChangedObservable||(this._onPropertyChangedObservable=new $.c),this._onPropertyChangedObservable)},enumerable:!0,configurable:!0}),e.prototype._createInspector=function(D){if(!this.isVisible()){if(this._onPropertyChangedObservable){for(var w=0,N=this._onPropertyChangedObservable.observers;w<N.length;w++){var F=N[w];this.BJSINSPECTOR.Inspector.OnPropertyChangedObservable.add(F)}this._onPropertyChangedObservable.clear(),this._onPropertyChangedObservable=void 0}var k=Object(X.a)({overlay:!1,showExplorer:!0,showInspector:!0,embedMode:!1,handleResize:!0,enablePopup:!0},D);this.BJSINSPECTOR=this.BJSINSPECTOR||this._getGlobalInspector(),this.BJSINSPECTOR.Inspector.Show(this._scene,k)}},e.prototype.select=function(D,w){this.BJSINSPECTOR&&(this.BJSINSPECTOR.Inspector.MarkLineContainerTitleForHighlighting(w),this.BJSINSPECTOR.Inspector.OnSelectionChangeObservable.notifyObservers(D))},e.prototype._getGlobalInspector=function(){return"undefined"!=typeof INSPECTOR?INSPECTOR:"undefined"!=typeof BABYLON&&void 0!==BABYLON.Inspector?BABYLON:void 0},e.prototype.isVisible=function(){return this.BJSINSPECTOR&&this.BJSINSPECTOR.Inspector.IsVisible},e.prototype.hide=function(){this.BJSINSPECTOR&&this.BJSINSPECTOR.Inspector.Hide()},e.prototype.show=function(D){var w=this;return new Promise((function(N,F){if(void 0===w.BJSINSPECTOR){var k=D&&D.inspectorURL?D.inspectorURL:e.InspectorURL;J.b.LoadScript(k,(function(){w._createInspector(D),N(w)}))}else w._createInspector(D),N(w)}))},e.InspectorURL="https://unpkg.com/babylonjs-inspector@"+ie.a.Version+"/babylon.inspector.bundle.js",e}(),ce=N(5),he=N(66),fe=N(48),pe=N(23),_e=N(30),ve=N(41),ye=N(59),be=function(){function e(D){this._impostors=[],this._meshes=[],this._numMeshes=0,this._debugMeshMeshes=new Array,this._scene=D||pe.a.LastCreatedScene;var w=this._scene.getPhysicsEngine();w&&(this._physicsEnginePlugin=w.getPhysicsPlugin()),this._utilityLayer=new ve.a(this._scene,!1),this._utilityLayer.pickUtilitySceneFirst=!1,this._utilityLayer.utilityLayerScene.autoClearDepthAndStencil=!0}return e.prototype._updateDebugMeshes=function(){for(var D=this._physicsEnginePlugin,w=0;w<this._numMeshes;w++){var N=this._impostors[w];if(N)if(N.isDisposed)this.hideImpostor(this._impostors[w--]);else{if(N.type===_e.a.MeshImpostor)continue;var F=this._meshes[w];F&&D&&D.syncMeshWithImpostor(F,N)}}},e.prototype.showImpostor=function(D,w){if(!this._scene)return null;for(var N=0;N<this._numMeshes;N++)if(this._impostors[N]==D)return null;var F=this._getDebugMesh(D,w);return F&&(this._impostors[this._numMeshes]=D,this._meshes[this._numMeshes]=F,0===this._numMeshes&&(this._renderFunction=this._updateDebugMeshes.bind(this),this._scene.registerBeforeRender(this._renderFunction)),this._numMeshes++),F},e.prototype.hideImpostor=function(D){if(D&&this._scene&&this._utilityLayer){for(var w=!1,N=this._utilityLayer.utilityLayerScene,F=0;F<this._numMeshes;F++)if(this._impostors[F]==D){var k=this._meshes[F];if(!k)continue;N.removeMesh(k),k.dispose();var j=this._debugMeshMeshes.indexOf(k);j>-1&&this._debugMeshMeshes.splice(j,1),this._numMeshes--,this._numMeshes>0?(this._meshes[F]=this._meshes[this._numMeshes],this._impostors[F]=this._impostors[this._numMeshes],this._meshes[this._numMeshes]=null,this._impostors[this._numMeshes]=null):(this._meshes[0]=null,this._impostors[0]=null),w=!0;break}w&&0===this._numMeshes&&this._scene.unregisterBeforeRender(this._renderFunction)}},e.prototype._getDebugMaterial=function(D){return this._debugMaterial||(this._debugMaterial=new j.a("",D),this._debugMaterial.wireframe=!0,this._debugMaterial.emissiveColor=G.a.White(),this._debugMaterial.disableLighting=!0),this._debugMaterial},e.prototype._getDebugBoxMesh=function(D){return this._debugBoxMesh||(this._debugBoxMesh=he.a.CreateBox("physicsBodyBoxViewMesh",{size:1},D),this._debugBoxMesh.rotationQuaternion=k.b.Identity(),this._debugBoxMesh.material=this._getDebugMaterial(D),this._debugBoxMesh.setEnabled(!1)),this._debugBoxMesh.createInstance("physicsBodyBoxViewInstance")},e.prototype._getDebugSphereMesh=function(D){return this._debugSphereMesh||(this._debugSphereMesh=fe.a.CreateSphere("physicsBodySphereViewMesh",{diameter:1},D),this._debugSphereMesh.rotationQuaternion=k.b.Identity(),this._debugSphereMesh.material=this._getDebugMaterial(D),this._debugSphereMesh.setEnabled(!1)),this._debugSphereMesh.createInstance("physicsBodyBoxViewInstance")},e.prototype._getDebugCylinderMesh=function(D){return this._debugCylinderMesh||(this._debugCylinderMesh=ye.a.CreateCylinder("physicsBodyCylinderViewMesh",{diameterTop:1,diameterBottom:1,height:1},D),this._debugCylinderMesh.rotationQuaternion=k.b.Identity(),this._debugCylinderMesh.material=this._getDebugMaterial(D),this._debugCylinderMesh.setEnabled(!1)),this._debugCylinderMesh.createInstance("physicsBodyBoxViewInstance")},e.prototype._getDebugMeshMesh=function(D,w){var N=new ce.a(D.name,w,null,D);return N.position=k.e.Zero(),N.setParent(D),N.material=this._getDebugMaterial(w),this._debugMeshMeshes.push(N),N},e.prototype._getDebugMesh=function(D,w){var N=this;if(!this._utilityLayer)return null;if(w&&w.parent&&w.parent.physicsImpostor)return null;var F=null,k=this._utilityLayer.utilityLayerScene;switch(D.type){case _e.a.BoxImpostor:F=this._getDebugBoxMesh(k),D.getBoxSizeToRef(F.scaling);break;case _e.a.SphereImpostor:F=this._getDebugSphereMesh(k);var j=D.getRadius();F.scaling.x=2*j,F.scaling.y=2*j,F.scaling.z=2*j;break;case _e.a.MeshImpostor:w&&(F=this._getDebugMeshMesh(w,k));break;case _e.a.NoImpostor:w&&w.getChildMeshes().filter((function(D){return D.physicsImpostor?1:0})).forEach((function(D){N._getDebugBoxMesh(k).parent=D}));break;case _e.a.CylinderImpostor:F=this._getDebugCylinderMesh(k);var z=D.object.getBoundingInfo();F.scaling.x=z.boundingBox.maximum.x-z.boundingBox.minimum.x,F.scaling.y=z.boundingBox.maximum.y-z.boundingBox.minimum.y,F.scaling.z=z.boundingBox.maximum.z-z.boundingBox.minimum.z}return F},e.prototype.dispose=function(){for(var D=this._numMeshes,w=0;w<D;w++)this.hideImpostor(this._impostors[0]);this._debugBoxMesh&&this._debugBoxMesh.dispose(),this._debugSphereMesh&&this._debugSphereMesh.dispose(),this._debugCylinderMesh&&this._debugCylinderMesh.dispose(),this._debugMaterial&&this._debugMaterial.dispose(),this._impostors.length=0,this._scene=null,this._physicsEnginePlugin=null,this._utilityLayer&&(this._utilityLayer.dispose(),this._utilityLayer=null)},e}(),Te=N(46),Ee=function(){function e(D){this.ray=D}return e.CreateAndShow=function(D,w,N){var F=new e(D);return F.show(w,N),F},e.prototype.show=function(D,w){if(!this._renderFunction&&this.ray){var N=this.ray;this._renderFunction=this._render.bind(this),this._scene=D,this._renderPoints=[N.origin,N.origin.add(N.direction.scale(N.length))],this._renderLine=ce.a.CreateLines("ray",this._renderPoints,D,!0),this._renderFunction&&this._scene.registerBeforeRender(this._renderFunction)}w&&this._renderLine&&this._renderLine.color.copyFrom(w)},e.prototype.hide=function(){this._renderFunction&&this._scene&&(this._scene.unregisterBeforeRender(this._renderFunction),this._scene=null,this._renderFunction=null,this._renderLine&&(this._renderLine.dispose(),this._renderLine=null),this._renderPoints=[])},e.prototype._render=function(){var D=this.ray;if(D){var w=this._renderPoints[1],N=Math.min(D.length,1e6);w.copyFrom(D.direction),w.scaleInPlace(N),w.addInPlace(D.origin),ce.a.CreateLines("ray",this._renderPoints,this._scene,!0,this._renderLine)}},e.prototype.attachToMesh=function(D,w,N,F){this._attachedToMesh=D;var j=this.ray;j&&(j.direction||(j.direction=k.e.Zero()),j.origin||(j.origin=k.e.Zero()),F&&(j.length=F),N||(N=k.e.Zero()),w||(w=new k.e(0,0,-1)),this._meshSpaceDirection?(this._meshSpaceDirection.copyFrom(w),this._meshSpaceOrigin.copyFrom(N)):(this._meshSpaceDirection=w.clone(),this._meshSpaceOrigin=N.clone()),this._updateToMeshFunction||(this._updateToMeshFunction=this._updateToMesh.bind(this),this._attachedToMesh.getScene().registerBeforeRender(this._updateToMeshFunction)),this._updateToMesh())},e.prototype.detachFromMesh=function(){this._attachedToMesh&&(this._updateToMeshFunction&&this._attachedToMesh.getScene().unregisterBeforeRender(this._updateToMeshFunction),this._attachedToMesh=null,this._updateToMeshFunction=null)},e.prototype._updateToMesh=function(){var D=this.ray;this._attachedToMesh&&D&&(this._attachedToMesh._isDisposed?this.detachFromMesh():(this._attachedToMesh.getDirectionToRef(this._meshSpaceDirection,D.direction),k.e.TransformCoordinatesToRef(this._meshSpaceOrigin,this._attachedToMesh.getWorldMatrix(),D.origin)))},e.prototype.dispose=function(){this.hide(),this.detachFromMesh(),this.ray=null},e}(),Se=function(){function e(D,w,N,F,k){void 0===F&&(F=!0),void 0===k&&(k=1),this.skeleton=D,this.mesh=w,this.autoUpdateBonesMatrices=F,this.renderingGroupId=k,this.color=G.a.White(),this._debugLines=new Array,this._isEnabled=!1,this._scene=N,this._utilityLayer=new ve.a(this._scene,!1),this._utilityLayer.pickUtilitySceneFirst=!1,this._utilityLayer.utilityLayerScene.autoClearDepthAndStencil=!0,this.update(),this._renderFunction=this.update.bind(this)}return Object.defineProperty(e.prototype,"debugMesh",{get:function(){return this._debugMesh},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(D){this._isEnabled!==D&&(this._isEnabled=D,D?this._scene.registerBeforeRender(this._renderFunction):this._scene.unregisterBeforeRender(this._renderFunction))},enumerable:!0,configurable:!0}),e.prototype._getBonePosition=function(D,w,N,F,j,z){void 0===F&&(F=0),void 0===j&&(j=0),void 0===z&&(z=0);var G=k.c.Matrix[0],H=w.getParent();if(G.copyFrom(w.getLocalMatrix()),0!==F||0!==j||0!==z){var X=k.c.Matrix[1];k.a.IdentityToRef(X),X.setTranslationFromFloats(F,j,z),X.multiplyToRef(G,G)}H&&G.multiplyToRef(H.getAbsoluteTransform(),G),G.multiplyToRef(N,G),D.x=G.m[12],D.y=G.m[13],D.z=G.m[14]},e.prototype._getLinesForBonesWithLength=function(D,w){for(var N=D.length,F=this.mesh._effectiveMesh.position,j=0;j<N;j++){var z=D[j],G=this._debugLines[j];G||(G=[k.e.Zero(),k.e.Zero()],this._debugLines[j]=G),this._getBonePosition(G[0],z,w),this._getBonePosition(G[1],z,w,0,z.length,0),G[0].subtractInPlace(F),G[1].subtractInPlace(F)}},e.prototype._getLinesForBonesNoLength=function(D,w){for(var N=D.length,F=0,j=this.mesh._effectiveMesh,z=j.position,G=N-1;G>=0;G--){var H=D[G],X=H.getParent();if(X){var q=this._debugLines[F];q||(q=[k.e.Zero(),k.e.Zero()],this._debugLines[F]=q),H.getAbsolutePositionToRef(j,q[0]),X.getAbsolutePositionToRef(j,q[1]),q[0].subtractInPlace(z),q[1].subtractInPlace(z),F++}}},e.prototype.update=function(){if(this._utilityLayer){this.autoUpdateBonesMatrices&&this.skeleton.computeAbsoluteTransforms();var D=this.mesh._effectiveMesh;void 0===this.skeleton.bones[0].length?this._getLinesForBonesNoLength(this.skeleton.bones,D.getWorldMatrix()):this._getLinesForBonesWithLength(this.skeleton.bones,D.getWorldMatrix());var w=this._utilityLayer.utilityLayerScene;this._debugMesh?Te.a.CreateLineSystem("",{lines:this._debugLines,updatable:!0,instance:this._debugMesh},w):(this._debugMesh=Te.a.CreateLineSystem("",{lines:this._debugLines,updatable:!0,instance:null},w),this._debugMesh.renderingGroupId=this.renderingGroupId),this._debugMesh.position.copyFrom(this.mesh.position),this._debugMesh.color=this.color}},e.prototype.dispose=function(){this.isEnabled=!1,this._debugMesh&&(this.isEnabled=!1,this._debugMesh.dispose(),this._debugMesh=null),this._utilityLayer&&(this._utilityLayer.dispose(),this._utilityLayer=null)},e}();N.d(w,"AxesViewer",(function(){return H})),N.d(w,"BoneAxesViewer",(function(){return Z})),N.d(w,"DebugLayerTab",(function(){return F})),N.d(w,"DebugLayer",(function(){return oe})),N.d(w,"PhysicsViewer",(function(){return be})),N.d(w,"RayHelper",(function(){return Ee})),N.d(w,"SkeletonViewer",(function(){return Se}))},function(D,w,N){"use strict";N(8).a.IncludesShadersStore.morphTargetsVertex="#ifdef MORPHTARGETS\npositionUpdated+=(position{X}-position)*morphTargetInfluences[{X}];\n#ifdef MORPHTARGETS_NORMAL\nnormalUpdated+=(normal{X}-normal)*morphTargetInfluences[{X}];\n#endif\n#ifdef MORPHTARGETS_TANGENT\ntangentUpdated.xyz+=(tangent{X}-tangent.xyz)*morphTargetInfluences[{X}];\n#endif\n#ifdef MORPHTARGETS_UV\nuvUpdated+=(uv_{X}-uv)*morphTargetInfluences[{X}];\n#endif\n#endif"},function(D,w,N){"use strict";N.d(w,"a",(function(){return n}));var n=function(){}},function(D,w,N){"use strict";N.d(w,"a",(function(){return z}));var F=N(42),k=N(0),j=N(28),z=function(){function e(D,w,N){this.vectors=F.a.BuildArray(8,k.e.Zero),this.center=k.e.Zero(),this.centerWorld=k.e.Zero(),this.extendSize=k.e.Zero(),this.extendSizeWorld=k.e.Zero(),this.directions=F.a.BuildArray(3,k.e.Zero),this.vectorsWorld=F.a.BuildArray(8,k.e.Zero),this.minimumWorld=k.e.Zero(),this.maximumWorld=k.e.Zero(),this.minimum=k.e.Zero(),this.maximum=k.e.Zero(),this.reConstruct(D,w,N)}return e.prototype.reConstruct=function(D,w,N){var F=D.x,j=D.y,z=D.z,G=w.x,H=w.y,X=w.z,q=this.vectors;this.minimum.copyFromFloats(F,j,z),this.maximum.copyFromFloats(G,H,X),q[0].copyFromFloats(F,j,z),q[1].copyFromFloats(G,H,X),q[2].copyFromFloats(G,j,z),q[3].copyFromFloats(F,H,z),q[4].copyFromFloats(F,j,X),q[5].copyFromFloats(G,H,z),q[6].copyFromFloats(F,H,X),q[7].copyFromFloats(G,j,X),w.addToRef(D,this.center).scaleInPlace(.5),w.subtractToRef(D,this.extendSize).scaleInPlace(.5),this._worldMatrix=N||k.a.IdentityReadOnly,this._update(this._worldMatrix)},e.prototype.scale=function(D){var w=e.TmpVector3,N=this.maximum.subtractToRef(this.minimum,w[0]),F=N.length();N.normalizeFromLength(F);var k=F*D,j=N.scaleInPlace(.5*k),z=this.center.subtractToRef(j,w[1]),G=this.center.addToRef(j,w[2]);return this.reConstruct(z,G,this._worldMatrix),this},e.prototype.getWorldMatrix=function(){return this._worldMatrix},e.prototype._update=function(D){var w=this.minimumWorld,N=this.maximumWorld,F=this.directions,j=this.vectorsWorld,z=this.vectors;if(D.isIdentity()){for(w.copyFrom(this.minimum),N.copyFrom(this.maximum),G=0;G<8;++G)j[G].copyFrom(z[G]);this.extendSizeWorld.copyFrom(this.extendSize),this.centerWorld.copyFrom(this.center)}else{w.setAll(Number.MAX_VALUE),N.setAll(-Number.MAX_VALUE);for(var G=0;G<8;++G){var H=j[G];k.e.TransformCoordinatesToRef(z[G],D,H),w.minimizeInPlace(H),N.maximizeInPlace(H)}N.subtractToRef(w,this.extendSizeWorld).scaleInPlace(.5),N.addToRef(w,this.centerWorld).scaleInPlace(.5)}k.e.FromArrayToRef(D.m,0,F[0]),k.e.FromArrayToRef(D.m,4,F[1]),k.e.FromArrayToRef(D.m,8,F[2]),this._worldMatrix=D},e.prototype.isInFrustum=function(D){return e.IsInFrustum(this.vectorsWorld,D)},e.prototype.isCompletelyInFrustum=function(D){return e.IsCompletelyInFrustum(this.vectorsWorld,D)},e.prototype.intersectsPoint=function(D){var w=this.minimumWorld,N=this.maximumWorld,F=w.x,k=w.y,z=w.z,G=N.x,H=N.y,X=N.z,q=D.x,Z=D.y,J=D.z,$=-j.a;return!(G-q<$||$>q-F||H-Z<$||$>Z-k||X-J<$||$>J-z)},e.prototype.intersectsSphere=function(D){return e.IntersectsSphere(this.minimumWorld,this.maximumWorld,D.centerWorld,D.radiusWorld)},e.prototype.intersectsMinMax=function(D,w){var N=this.minimumWorld,F=this.maximumWorld,k=N.x,j=N.y,z=N.z,G=F.x,H=F.y,X=F.z,q=D.x,Z=D.y,J=D.z,$=w.x,te=w.y,ie=w.z;return!(G<q||k>$||H<Z||j>te||X<J||z>ie)},e.Intersects=function(D,w){return D.intersectsMinMax(w.minimumWorld,w.maximumWorld)},e.IntersectsSphere=function(D,w,N,F){var j=e.TmpVector3[0];return k.e.ClampToRef(N,D,w,j),k.e.DistanceSquared(N,j)<=F*F},e.IsCompletelyInFrustum=function(D,w){for(var N=0;N<6;++N)for(var F=w[N],k=0;k<8;++k)if(F.dotCoordinate(D[k])<0)return!1;return!0},e.IsInFrustum=function(D,w){for(var N=0;N<6;++N){for(var F=!0,k=w[N],j=0;j<8;++j)if(k.dotCoordinate(D[j])>=0){F=!1;break}if(F)return!1}return!0},e.TmpVector3=F.a.BuildArray(3,k.e.Zero),e}()},function(D,w,N){"use strict";N(8).a.IncludesShadersStore.lightFragmentDeclaration="#ifdef LIGHT{X}\nuniform vec4 vLightData{X};\nuniform vec4 vLightDiffuse{X};\n#ifdef SPECULARTERM\nuniform vec4 vLightSpecular{X};\n#else\nvec4 vLightSpecular{X}=vec4(0.);\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nuniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float viewFrustumZ{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float frustumLengths{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float cascadeBlendFactor{X};\nvarying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying vec4 vPositionFromCamera{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DArrayShadow shadowSampler{X};\nuniform highp sampler2DArray depthSampler{X};\nuniform vec2 lightSizeUVCorrection{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float depthCorrection{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float penumbraDarkness{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DArrayShadow shadowSampler{X};\n#else\nuniform highp sampler2DArray shadowSampler{X};\n#endif\n#ifdef SHADOWCSMDEBUG{X}\nconst vec3 vCascadeColorsMultiplier{X}[8]=vec3[8]\n(\nvec3 ( 1.5,0.0,0.0 ),\nvec3 ( 0.0,1.5,0.0 ),\nvec3 ( 0.0,0.0,5.5 ),\nvec3 ( 1.5,0.0,5.5 ),\nvec3 ( 1.5,1.5,0.0 ),\nvec3 ( 1.0,1.0,1.0 ),\nvec3 ( 0.0,1.0,5.5 ),\nvec3 ( 0.5,3.5,0.75 )\n);\nvec3 shadowDebug{X};\n#endif\n#ifdef SHADOWCSMUSESHADOWMAXZ{X}\nint index{X}=-1;\n#else\nint index{X}=SHADOWCSMNUM_CASCADES{X}-1;\n#endif\nfloat diff{X}=0.;\n#elif defined(SHADOWCUBE{X})\nuniform samplerCube shadowSampler{X};\n#else\nvarying vec4 vPositionFromLight{X};\nvarying float vDepthMetric{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DShadow shadowSampler{X};\nuniform highp sampler2D depthSampler{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DShadow shadowSampler{X};\n#else\nuniform sampler2D shadowSampler{X};\n#endif\nuniform mat4 lightMatrix{X};\n#endif\nuniform vec4 shadowsInfo{X};\nuniform vec2 depthValues{X};\n#endif\n#ifdef SPOTLIGHT{X}\nuniform vec4 vLightDirection{X};\nuniform vec4 vLightFalloff{X};\n#elif defined(POINTLIGHT{X})\nuniform vec4 vLightFalloff{X};\n#elif defined(HEMILIGHT{X})\nuniform vec3 vLightGround{X};\n#endif\n#ifdef PROJECTEDLIGHTTEXTURE{X}\nuniform mat4 textureProjectionMatrix{X};\nuniform sampler2D projectionLightSampler{X};\n#endif\n#endif"},function(D,w,N){"use strict";N(8).a.IncludesShadersStore.lightUboDeclaration="#ifdef LIGHT{X}\nuniform Light{X}\n{\nvec4 vLightData;\nvec4 vLightDiffuse;\nvec4 vLightSpecular;\n#ifdef SPOTLIGHT{X}\nvec4 vLightDirection;\nvec4 vLightFalloff;\n#elif defined(POINTLIGHT{X})\nvec4 vLightFalloff;\n#elif defined(HEMILIGHT{X})\nvec3 vLightGround;\n#endif\nvec4 shadowsInfo;\nvec2 depthValues;\n} light{X};\n#ifdef PROJECTEDLIGHTTEXTURE{X}\nuniform mat4 textureProjectionMatrix{X};\nuniform sampler2D projectionLightSampler{X};\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nuniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float viewFrustumZ{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float frustumLengths{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float cascadeBlendFactor{X};\nvarying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying vec4 vPositionFromCamera{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DArrayShadow shadowSampler{X};\nuniform highp sampler2DArray depthSampler{X};\nuniform vec2 lightSizeUVCorrection{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float depthCorrection{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float penumbraDarkness{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DArrayShadow shadowSampler{X};\n#else\nuniform highp sampler2DArray shadowSampler{X};\n#endif\n#ifdef SHADOWCSMDEBUG{X}\nconst vec3 vCascadeColorsMultiplier{X}[8]=vec3[8]\n(\nvec3 ( 1.5,0.0,0.0 ),\nvec3 ( 0.0,1.5,0.0 ),\nvec3 ( 0.0,0.0,5.5 ),\nvec3 ( 1.5,0.0,5.5 ),\nvec3 ( 1.5,1.5,0.0 ),\nvec3 ( 1.0,1.0,1.0 ),\nvec3 ( 0.0,1.0,5.5 ),\nvec3 ( 0.5,3.5,0.75 )\n);\nvec3 shadowDebug{X};\n#endif\n#ifdef SHADOWCSMUSESHADOWMAXZ{X}\nint index{X}=-1;\n#else\nint index{X}=SHADOWCSMNUM_CASCADES{X}-1;\n#endif\nfloat diff{X}=0.;\n#elif defined(SHADOWCUBE{X})\nuniform samplerCube shadowSampler{X};\n#else\nvarying vec4 vPositionFromLight{X};\nvarying float vDepthMetric{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DShadow shadowSampler{X};\nuniform highp sampler2D depthSampler{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DShadow shadowSampler{X};\n#else\nuniform sampler2D shadowSampler{X};\n#endif\nuniform mat4 lightMatrix{X};\n#endif\n#endif\n#endif"},function(D,w,N){"use strict";N(8).a.IncludesShadersStore.imageProcessingDeclaration="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#ifdef VIGNETTE\nuniform vec2 vInverseScreenSize;\nuniform vec4 vignetteSettings1;\nuniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;\nuniform vec4 vCameraColorCurveNeutral;\nuniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif"},function(D,w,N){"use strict";N(8).a.IncludesShadersStore.imageProcessingFunctions="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{\nfloat sliceSize=2.0*sampler3dSetting.x;\n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);\n\n\nfloat sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;\nsliceUV.x+=sliceInteger*sliceSize;\nsliceUV=saturate(sliceUV);\nvec4 slice0Color=texture2D(colorTransform,sliceUV);\nsliceUV.x+=sliceSize;\nsliceUV=saturate(sliceUV);\nvec4 slice1Color=texture2D(colorTransform,sliceUV);\nvec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;\n}\n#endif\n#ifdef TONEMAPPING_ACES\n\n\n\n\n\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);\n\nconst mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108,1.10813,-0.07276),\nvec3(-0.07367,-0.00605,1.07602)\n);\nvec3 RRTAndODTFit(vec3 v)\n{\nvec3 a=v*(v+0.0245786)-0.000090537;\nvec3 b=v*(0.983729*v+0.4329510)+0.238081;\nreturn a/b;\n}\nvec3 ACESFitted(vec3 color)\n{\ncolor=ACESInputMat*color;\n\ncolor=RRTAndODTFit(color);\ncolor=ACESOutputMat*color;\n\ncolor=saturate(color);\nreturn color;\n}\n#endif\nvec4 applyImageProcessing(vec4 result) {\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\n\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;\nviewportXY=viewportXY*2.0-1.0;\nvec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);\nfloat vignetteTerm=dot(vignetteXY1,vignetteXY1);\nfloat vignette=pow(vignetteTerm,vignetteSettings2.w);\n\nvec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);\nresult.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#ifdef TONEMAPPING\n#ifdef TONEMAPPING_ACES\nresult.rgb=ACESFitted(result.rgb);\n#else\nconst float tonemappingCalibration=1.590579;\nresult.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\n#endif\n\nresult.rgb=toGammaSpace(result.rgb);\nresult.rgb=saturate(result.rgb);\n#ifdef CONTRAST\n\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);\nif (contrast<1.0) {\n\nresult.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);\n} else {\n\nresult.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);\n}\n#endif\n\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\n\nfloat luma=getLuminance(result.rgb);\nvec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));\nvec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;\nresult.rgb*=colorCurve.rgb;\nresult.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\nreturn result;\n}"},function(D,w,N){"use strict";N(8).a.IncludesShadersStore.clipPlaneFragment="#ifdef CLIPPLANE\nif (fClipDistance>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE2\nif (fClipDistance2>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE3\nif (fClipDistance3>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE4\nif (fClipDistance4>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE5\nif (fClipDistance5>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE6\nif (fClipDistance6>0.0)\n{\ndiscard;\n}\n#endif"},function(D,w,N){"use strict";N(8).a.IncludesShadersStore.clipPlaneVertex="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif"},function(D,w,N){"use strict";N.d(w,"a",(function(){return F}));var F=function(){function e(){this._count=0,this._data={}}return e.prototype.copyFrom=function(D){var w=this;this.clear(),D.forEach((function(D,N){return w.add(D,N)}))},e.prototype.get=function(D){var w=this._data[D];if(void 0!==w)return w},e.prototype.getOrAddWithFactory=function(D,w){var N=this.get(D);return void 0!==N||(N=w(D))&&this.add(D,N),N},e.prototype.getOrAdd=function(D,w){var N=this.get(D);return void 0!==N?N:(this.add(D,w),w)},e.prototype.contains=function(D){return void 0!==this._data[D]},e.prototype.add=function(D,w){return void 0===this._data[D]&&(this._data[D]=w,++this._count,!0)},e.prototype.set=function(D,w){return void 0!==this._data[D]&&(this._data[D]=w,!0)},e.prototype.getAndRemove=function(D){var w=this.get(D);return void 0!==w?(delete this._data[D],--this._count,w):null},e.prototype.remove=function(D){return!!this.contains(D)&&(delete this._data[D],--this._count,!0)},e.prototype.clear=function(){this._data={},this._count=0},Object.defineProperty(e.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0}),e.prototype.forEach=function(D){for(var w in this._data)D(w,this._data[w])},e.prototype.first=function(D){for(var w in this._data){var N=D(w,this._data[w]);if(N)return N}return null},e}()},function(D,w,N){"use strict";N.d(w,"a",(function(){return j}));var F=N(42),k=N(0),j=function(){function e(D,w,N){this.center=k.e.Zero(),this.centerWorld=k.e.Zero(),this.minimum=k.e.Zero(),this.maximum=k.e.Zero(),this.reConstruct(D,w,N)}return e.prototype.reConstruct=function(D,w,N){this.minimum.copyFrom(D),this.maximum.copyFrom(w);var F=k.e.Distance(D,w);w.addToRef(D,this.center).scaleInPlace(.5),this.radius=.5*F,this._update(N||k.a.IdentityReadOnly)},e.prototype.scale=function(D){var w=this.radius*D,N=e.TmpVector3,F=N[0].setAll(w),k=this.center.subtractToRef(F,N[1]),j=this.center.addToRef(F,N[2]);return this.reConstruct(k,j,this._worldMatrix),this},e.prototype.getWorldMatrix=function(){return this._worldMatrix},e.prototype._update=function(D){if(D.isIdentity())this.centerWorld.copyFrom(this.center),this.radiusWorld=this.radius;else{k.e.TransformCoordinatesToRef(this.center,D,this.centerWorld);var w=e.TmpVector3[0];k.e.TransformNormalFromFloatsToRef(1,1,1,D,w),this.radiusWorld=Math.max(Math.abs(w.x),Math.abs(w.y),Math.abs(w.z))*this.radius}},e.prototype.isInFrustum=function(D){for(var w=this.centerWorld,N=this.radiusWorld,F=0;F<6;F++)if(D[F].dotCoordinate(w)<=-N)return!1;return!0},e.prototype.isCenterInFrustum=function(D){for(var w=this.centerWorld,N=0;N<6;N++)if(D[N].dotCoordinate(w)<0)return!1;return!0},e.prototype.intersectsPoint=function(D){var w=k.e.DistanceSquared(this.centerWorld,D);return!(this.radiusWorld*this.radiusWorld<w)},e.Intersects=function(D,w){var N=k.e.DistanceSquared(D.centerWorld,w.centerWorld),F=D.radiusWorld+w.radiusWorld;return!(F*F<N)},e.TmpVector3=F.a.BuildArray(3,k.e.Zero),e}()},function(D,w,N){"use strict";N.d(w,"a",(function(){return n}));var n=function(D,w,N){this.bu=D,this.bv=w,this.distance=N,this.faceId=0,this.subMeshId=0}},function(D,w,N){"use strict";N(8).a.IncludesShadersStore.clipPlaneFragmentDeclaration="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif"},function(D,w,N){"use strict";N(8).a.IncludesShadersStore.logDepthDeclaration="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;\nvarying float vFragmentDepth;\n#endif"},function(D,w,N){"use strict";N(8).a.IncludesShadersStore.clipPlaneVertexDeclaration="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;\nvarying float fClipDistance6;\n#endif"},function(D,w,N){"use strict";N.d(w,"a",(function(){return F}));var F=function(){function e(){}return e.prototype.attributeProcessor=function(D){return D.replace("attribute","in")},e.prototype.varyingProcessor=function(D,w){return D.replace("varying",w?"in":"out")},e.prototype.postProcessor=function(D,w,N){var F=-1!==D.search(/#extension.+GL_EXT_draw_buffers.+require/);if(D=(D=D.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),N)D=(D=(D=(D=(D=(D=(D=D.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(F?"":"out vec4 glFragColor;\n")+"void main(");else if(-1!==w.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+D;return D},e}()},function(D,w,N){"use strict";N.d(w,"b",(function(){return r})),N.d(w,"a",(function(){return o}));var F=N(0);function r(D,w,N,k,j){void 0===j&&(j=null);for(var z=new F.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),G=new F.e(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),H=N;H<N+k;H++){var X=3*w[H],q=D[X],Z=D[X+1],J=D[X+2];z.minimizeInPlaceFromFloats(q,Z,J),G.maximizeInPlaceFromFloats(q,Z,J)}return j&&(z.x-=z.x*j.x+j.y,z.y-=z.y*j.x+j.y,z.z-=z.z*j.x+j.y,G.x+=G.x*j.x+j.y,G.y+=G.y*j.x+j.y,G.z+=G.z*j.x+j.y),{minimum:z,maximum:G}}function o(D,w,N,k,j){void 0===k&&(k=null);var z=new F.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),G=new F.e(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);j||(j=3);for(var H=w,X=w*j;H<w+N;H++,X+=j){var q=D[X],Z=D[X+1],J=D[X+2];z.minimizeInPlaceFromFloats(q,Z,J),G.maximizeInPlaceFromFloats(q,Z,J)}return k&&(z.x-=z.x*k.x+k.y,z.y-=z.y*k.x+k.y,z.z-=z.z*k.x+k.y,G.x+=G.x*k.x+k.y,G.y+=G.y*k.x+k.y,G.z+=G.z*k.x+k.y),{minimum:z,maximum:G}}},function(D,w,N){"use strict";N.d(w,"a",(function(){return z}));var F=N(1),k=N(3),j=N(10),z=function(){function e(){this._dirty=!0,this._tempColor=new j.b(0,0,0,0),this._globalCurve=new j.b(0,0,0,0),this._highlightsCurve=new j.b(0,0,0,0),this._midtonesCurve=new j.b(0,0,0,0),this._shadowsCurve=new j.b(0,0,0,0),this._positiveCurve=new j.b(0,0,0,0),this._negativeCurve=new j.b(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}return Object.defineProperty(e.prototype,"globalHue",{get:function(){return this._globalHue},set:function(D){this._globalHue=D,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"globalDensity",{get:function(){return this._globalDensity},set:function(D){this._globalDensity=D,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"globalSaturation",{get:function(){return this._globalSaturation},set:function(D){this._globalSaturation=D,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"globalExposure",{get:function(){return this._globalExposure},set:function(D){this._globalExposure=D,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"highlightsHue",{get:function(){return this._highlightsHue},set:function(D){this._highlightsHue=D,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"highlightsDensity",{get:function(){return this._highlightsDensity},set:function(D){this._highlightsDensity=D,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"highlightsSaturation",{get:function(){return this._highlightsSaturation},set:function(D){this._highlightsSaturation=D,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"highlightsExposure",{get:function(){return this._highlightsExposure},set:function(D){this._highlightsExposure=D,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"midtonesHue",{get:function(){return this._midtonesHue},set:function(D){this._midtonesHue=D,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"midtonesDensity",{get:function(){return this._midtonesDensity},set:function(D){this._midtonesDensity=D,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"midtonesSaturation",{get:function(){return this._midtonesSaturation},set:function(D){this._midtonesSaturation=D,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"midtonesExposure",{get:function(){return this._midtonesExposure},set:function(D){this._midtonesExposure=D,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shadowsHue",{get:function(){return this._shadowsHue},set:function(D){this._shadowsHue=D,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shadowsDensity",{get:function(){return this._shadowsDensity},set:function(D){this._shadowsDensity=D,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shadowsSaturation",{get:function(){return this._shadowsSaturation},set:function(D){this._shadowsSaturation=D,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shadowsExposure",{get:function(){return this._shadowsExposure},set:function(D){this._shadowsExposure=D,this._dirty=!0},enumerable:!0,configurable:!0}),e.prototype.getClassName=function(){return"ColorCurves"},e.Bind=function(D,w,N,F,k){void 0===N&&(N="vCameraColorCurvePositive"),void 0===F&&(F="vCameraColorCurveNeutral"),void 0===k&&(k="vCameraColorCurveNegative"),D._dirty&&(D._dirty=!1,D.getColorGradingDataToRef(D._globalHue,D._globalDensity,D._globalSaturation,D._globalExposure,D._globalCurve),D.getColorGradingDataToRef(D._highlightsHue,D._highlightsDensity,D._highlightsSaturation,D._highlightsExposure,D._tempColor),D._tempColor.multiplyToRef(D._globalCurve,D._highlightsCurve),D.getColorGradingDataToRef(D._midtonesHue,D._midtonesDensity,D._midtonesSaturation,D._midtonesExposure,D._tempColor),D._tempColor.multiplyToRef(D._globalCurve,D._midtonesCurve),D.getColorGradingDataToRef(D._shadowsHue,D._shadowsDensity,D._shadowsSaturation,D._shadowsExposure,D._tempColor),D._tempColor.multiplyToRef(D._globalCurve,D._shadowsCurve),D._highlightsCurve.subtractToRef(D._midtonesCurve,D._positiveCurve),D._midtonesCurve.subtractToRef(D._shadowsCurve,D._negativeCurve)),w&&(w.setFloat4(N,D._positiveCurve.r,D._positiveCurve.g,D._positiveCurve.b,D._positiveCurve.a),w.setFloat4(F,D._midtonesCurve.r,D._midtonesCurve.g,D._midtonesCurve.b,D._midtonesCurve.a),w.setFloat4(k,D._negativeCurve.r,D._negativeCurve.g,D._negativeCurve.b,D._negativeCurve.a))},e.PrepareUniforms=function(D){D.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")},e.prototype.getColorGradingDataToRef=function(D,w,N,F,k){null!=D&&(D=e.clamp(D,0,360),w=e.clamp(w,-100,100),N=e.clamp(N,-100,100),F=e.clamp(F,-100,100),w=e.applyColorGradingSliderNonlinear(w),w*=.5,F=e.applyColorGradingSliderNonlinear(F),w<0&&(w*=-1,D=(D+180)%360),e.fromHSBToRef(D,w,50+.25*F,k),k.scaleToRef(2,k),k.a=1+.01*N)},e.applyColorGradingSliderNonlinear=function(D){D/=100;var w=Math.abs(D);return w=Math.pow(w,2),D<0&&(w*=-1),100*w},e.fromHSBToRef=function(D,w,N,F){var k=e.clamp(D,0,360),j=e.clamp(w/100,0,1),z=e.clamp(N/100,0,1);if(0===j)F.r=z,F.g=z,F.b=z;else{k/=60;var G=Math.floor(k),H=k-G,X=z*(1-j),q=z*(1-j*H),Z=z*(1-j*(1-H));switch(G){case 0:F.r=z,F.g=Z,F.b=X;break;case 1:F.r=q,F.g=z,F.b=X;break;case 2:F.r=X,F.g=z,F.b=Z;break;case 3:F.r=X,F.g=q,F.b=z;break;case 4:F.r=Z,F.g=X,F.b=z;break;default:F.r=z,F.g=X,F.b=q}}F.a=1},e.clamp=function(D,w,N){return Math.min(Math.max(D,w),N)},e.prototype.clone=function(){return k.a.Clone((function(){return new e}),this)},e.prototype.serialize=function(){return k.a.Serialize(this)},e.Parse=function(D){return k.a.Parse((function(){return new e}),D,null,null)},Object(F.c)([Object(k.c)()],e.prototype,"_globalHue",void 0),Object(F.c)([Object(k.c)()],e.prototype,"_globalDensity",void 0),Object(F.c)([Object(k.c)()],e.prototype,"_globalSaturation",void 0),Object(F.c)([Object(k.c)()],e.prototype,"_globalExposure",void 0),Object(F.c)([Object(k.c)()],e.prototype,"_highlightsHue",void 0),Object(F.c)([Object(k.c)()],e.prototype,"_highlightsDensity",void 0),Object(F.c)([Object(k.c)()],e.prototype,"_highlightsSaturation",void 0),Object(F.c)([Object(k.c)()],e.prototype,"_highlightsExposure",void 0),Object(F.c)([Object(k.c)()],e.prototype,"_midtonesHue",void 0),Object(F.c)([Object(k.c)()],e.prototype,"_midtonesDensity",void 0),Object(F.c)([Object(k.c)()],e.prototype,"_midtonesSaturation",void 0),Object(F.c)([Object(k.c)()],e.prototype,"_midtonesExposure",void 0),e}();k.a._ColorCurvesParser=z.Parse},function(D,w,N){"use strict";N.d(w,"a",(function(){return j}));var F=N(7),k=N(12),j=function(){function e(){}return e.Instantiate=function(D){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[D])return this.RegisteredExternalClasses[D];var w=k.a.GetClass(D);if(w)return w;F.a.Warn(D+" not found, you may have missed an import.");for(var N=D.split("."),j=window||this,z=0,G=N.length;z<G;z++)j=j[N[z]];return"function"!=typeof j?null:j},e.RegisteredExternalClasses={},e}()},function(D,w,N){"use strict";N(8).a.IncludesShadersStore.fogFragmentDeclaration="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;\nuniform vec3 vFogColor;\nvarying vec3 vFogDistance;\nfloat CalcFogFactor()\n{\nfloat fogCoeff=1.0;\nfloat fogStart=vFogInfos.y;\nfloat fogEnd=vFogInfos.z;\nfloat fogDensity=vFogInfos.w;\nfloat fogDistance=length(vFogDistance);\nif (FOGMODE_LINEAR == vFogInfos.x)\n{\nfogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);\n}\nelse if (FOGMODE_EXP == vFogInfos.x)\n{\nfogCoeff=1.0/pow(E,fogDistance*fogDensity);\n}\nelse if (FOGMODE_EXP2 == vFogInfos.x)\n{\nfogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);\n}\nreturn clamp(fogCoeff,0.0,1.0);\n}\n#endif"},function(D,w,N){"use strict";N.r(w);var F=N(37),k=N(87),j=N(6),z=N(0),G=N(10),H=N(12),X=function(){function e(D,w){this.triggerOptions=D,this.onBeforeExecuteObservable=new j.c,D.parameter?(this.trigger=D.trigger,this._triggerParameter=D.parameter):D.trigger?this.trigger=D.trigger:this.trigger=D,this._nextActiveAction=this,this._condition=w}return e.prototype._prepare=function(){},e.prototype.getTriggerParameter=function(){return this._triggerParameter},e.prototype._executeCurrent=function(D){if(this._nextActiveAction._condition){var w=this._nextActiveAction._condition,N=this._actionManager.getScene().getRenderId();if(w._evaluationId===N){if(!w._currentResult)return}else{if(w._evaluationId=N,!w.isValid())return void(w._currentResult=!1);w._currentResult=!0}}this.onBeforeExecuteObservable.notifyObservers(this),this._nextActiveAction.execute(D),this.skipToNextActiveAction()},e.prototype.execute=function(D){},e.prototype.skipToNextActiveAction=function(){this._nextActiveAction._child?(this._nextActiveAction._child._actionManager||(this._nextActiveAction._child._actionManager=this._actionManager),this._nextActiveAction=this._nextActiveAction._child):this._nextActiveAction=this},e.prototype.then=function(D){return this._child=D,D._actionManager=this._actionManager,D._prepare(),D},e.prototype._getProperty=function(D){return this._actionManager._getProperty(D)},e.prototype._getEffectiveTarget=function(D,w){return this._actionManager._getEffectiveTarget(D,w)},e.prototype.serialize=function(D){},e.prototype._serialize=function(D,w){var N={type:1,children:[],name:D.name,properties:D.properties||[]};if(this._child&&this._child.serialize(N),this._condition){var F=this._condition.serialize();return F.children.push(N),w&&w.children.push(F),F}return w&&w.children.push(N),N},e._SerializeValueAsString=function(D){return"number"==typeof D?D.toString():"boolean"==typeof D?D?"true":"false":D instanceof z.d?D.x+", "+D.y:D instanceof z.e?D.x+", "+D.y+", "+D.z:D instanceof G.a?D.r+", "+D.g+", "+D.b:D instanceof G.b?D.r+", "+D.g+", "+D.b+", "+D.a:D},e._GetTargetProperty=function(D){return{name:"target",targetType:D._isMesh?"MeshProperties":D._isLight?"LightProperties":D._isCamera?"CameraProperties":"SceneProperties",value:D._isScene?"Scene":D.name}},e}();H.a.RegisteredTypes["BABYLON.Action"]=X;var q=N(45),Z=N(1),J=function(){function e(D){this._actionManager=D}return e.prototype.isValid=function(){return!0},e.prototype._getProperty=function(D){return this._actionManager._getProperty(D)},e.prototype._getEffectiveTarget=function(D,w){return this._actionManager._getEffectiveTarget(D,w)},e.prototype.serialize=function(){},e.prototype._serialize=function(D){return{type:2,children:[],name:D.name,properties:D.properties}},e}(),$=function(D){function t(w,N,F,k,j){void 0===j&&(j=t.IsEqual);var z=D.call(this,w)||this;return z.propertyPath=F,z.value=k,z.operator=j,z._target=N,z._effectiveTarget=z._getEffectiveTarget(N,z.propertyPath),z._property=z._getProperty(z.propertyPath),z}return Object(Z.d)(t,D),Object.defineProperty(t,"IsEqual",{get:function(){return t._IsEqual},enumerable:!0,configurable:!0}),Object.defineProperty(t,"IsDifferent",{get:function(){return t._IsDifferent},enumerable:!0,configurable:!0}),Object.defineProperty(t,"IsGreater",{get:function(){return t._IsGreater},enumerable:!0,configurable:!0}),Object.defineProperty(t,"IsLesser",{get:function(){return t._IsLesser},enumerable:!0,configurable:!0}),t.prototype.isValid=function(){switch(this.operator){case t.IsGreater:return this._effectiveTarget[this._property]>this.value;case t.IsLesser:return this._effectiveTarget[this._property]<this.value;case t.IsEqual:case t.IsDifferent:var D;return D=this.value.equals?this.value.equals(this._effectiveTarget[this._property]):this.value===this._effectiveTarget[this._property],this.operator===t.IsEqual?D:!D}return!1},t.prototype.serialize=function(){return this._serialize({name:"ValueCondition",properties:[X._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:X._SerializeValueAsString(this.value)},{name:"operator",value:t.GetOperatorName(this.operator)}]})},t.GetOperatorName=function(D){switch(D){case t._IsEqual:return"IsEqual";case t._IsDifferent:return"IsDifferent";case t._IsGreater:return"IsGreater";case t._IsLesser:return"IsLesser";default:return""}},t._IsEqual=0,t._IsDifferent=1,t._IsGreater=2,t._IsLesser=3,t}(J),te=function(D){function t(w,N){var F=D.call(this,w)||this;return F.predicate=N,F}return Object(Z.d)(t,D),t.prototype.isValid=function(){return this.predicate()},t}(J),ie=function(D){function t(w,N,F){var k=D.call(this,w)||this;return k.value=F,k._target=N,k}return Object(Z.d)(t,D),t.prototype.isValid=function(){return this._target.state===this.value},t.prototype.serialize=function(){return this._serialize({name:"StateCondition",properties:[X._GetTargetProperty(this._target),{name:"value",value:this.value}]})},t}(J);H.a.RegisteredTypes["BABYLON.ValueCondition"]=$,H.a.RegisteredTypes["BABYLON.PredicateCondition"]=te,H.a.RegisteredTypes["BABYLON.StateCondition"]=ie;var oe=N(7),ce=N(2),he=function(D){function t(w,N,F,k){var j=D.call(this,w,k)||this;return j.propertyPath=F,j._target=j._effectiveTarget=N,j}return Object(Z.d)(t,D),t.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath)},t.prototype.execute=function(){this._effectiveTarget[this._property]=!this._effectiveTarget[this._property]},t.prototype.serialize=function(w){return D.prototype._serialize.call(this,{name:"SwitchBooleanAction",properties:[X._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath}]},w)},t}(X),fe=function(D){function t(w,N,F,k){var j=D.call(this,w,k)||this;return j.value=F,j._target=N,j}return Object(Z.d)(t,D),t.prototype.execute=function(){this._target.state=this.value},t.prototype.serialize=function(w){return D.prototype._serialize.call(this,{name:"SetStateAction",properties:[X._GetTargetProperty(this._target),{name:"value",value:this.value}]},w)},t}(X),pe=function(D){function t(w,N,F,k,j){var z=D.call(this,w,j)||this;return z.propertyPath=F,z.value=k,z._target=z._effectiveTarget=N,z}return Object(Z.d)(t,D),t.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath)},t.prototype.execute=function(){this._effectiveTarget[this._property]=this.value,this._target.markAsDirty&&this._target.markAsDirty(this._property)},t.prototype.serialize=function(w){return D.prototype._serialize.call(this,{name:"SetValueAction",properties:[X._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:X._SerializeValueAsString(this.value)}]},w)},t}(X),_e=function(D){function t(w,N,F,k,j){var z=D.call(this,w,j)||this;return z.propertyPath=F,z.value=k,z._target=z._effectiveTarget=N,z}return Object(Z.d)(t,D),t.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath),"number"!=typeof this._effectiveTarget[this._property]&&oe.a.Warn("Warning: IncrementValueAction can only be used with number values")},t.prototype.execute=function(){this._effectiveTarget[this._property]+=this.value,this._target.markAsDirty&&this._target.markAsDirty(this._property)},t.prototype.serialize=function(w){return D.prototype._serialize.call(this,{name:"IncrementValueAction",properties:[X._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:X._SerializeValueAsString(this.value)}]},w)},t}(X),ve=function(D){function t(w,N,F,k,j,z){var G=D.call(this,w,z)||this;return G.from=F,G.to=k,G.loop=j,G._target=N,G}return Object(Z.d)(t,D),t.prototype._prepare=function(){},t.prototype.execute=function(){this._actionManager.getScene().beginAnimation(this._target,this.from,this.to,this.loop)},t.prototype.serialize=function(w){return D.prototype._serialize.call(this,{name:"PlayAnimationAction",properties:[X._GetTargetProperty(this._target),{name:"from",value:String(this.from)},{name:"to",value:String(this.to)},{name:"loop",value:X._SerializeValueAsString(this.loop)||!1}]},w)},t}(X),ye=function(D){function t(w,N,F){var k=D.call(this,w,F)||this;return k._target=N,k}return Object(Z.d)(t,D),t.prototype._prepare=function(){},t.prototype.execute=function(){this._actionManager.getScene().stopAnimation(this._target)},t.prototype.serialize=function(w){return D.prototype._serialize.call(this,{name:"StopAnimationAction",properties:[X._GetTargetProperty(this._target)]},w)},t}(X),be=function(D){function t(w,N){return void 0===w&&(w=ce.a.ACTION_NothingTrigger),D.call(this,w,N)||this}return Object(Z.d)(t,D),t.prototype.execute=function(){},t.prototype.serialize=function(w){return D.prototype._serialize.call(this,{name:"DoNothingAction",properties:[]},w)},t}(X),Te=function(D){function t(w,N,F){var k=D.call(this,w,F)||this;return k.children=N,k}return Object(Z.d)(t,D),t.prototype._prepare=function(){for(var D=0;D<this.children.length;D++)this.children[D]._actionManager=this._actionManager,this.children[D]._prepare()},t.prototype.execute=function(D){for(var w=0;w<this.children.length;w++)this.children[w].execute(D)},t.prototype.serialize=function(w){for(var N=D.prototype._serialize.call(this,{name:"CombineAction",properties:[],combine:[]},w),F=0;F<this.children.length;F++)N.combine.push(this.children[F].serialize(null));return N},t}(X),Ee=function(D){function t(w,N,F){var k=D.call(this,w,F)||this;return k.func=N,k}return Object(Z.d)(t,D),t.prototype.execute=function(D){this.func(D)},t}(X),Se=function(D){function t(w,N,F,k){var j=D.call(this,w,k)||this;return j._target=N,j._parent=F,j}return Object(Z.d)(t,D),t.prototype._prepare=function(){},t.prototype.execute=function(){if(this._target.parent!==this._parent){var D=this._parent.getWorldMatrix().clone();D.invert(),this._target.position=z.e.TransformCoordinates(this._target.position,D),this._target.parent=this._parent}},t.prototype.serialize=function(w){return D.prototype._serialize.call(this,{name:"SetParentAction",properties:[X._GetTargetProperty(this._target),X._GetTargetProperty(this._parent)]},w)},t}(X);H.a.RegisteredTypes["BABYLON.SetParentAction"]=Se,H.a.RegisteredTypes["BABYLON.ExecuteCodeAction"]=Ee,H.a.RegisteredTypes["BABYLON.DoNothingAction"]=be,H.a.RegisteredTypes["BABYLON.StopAnimationAction"]=ye,H.a.RegisteredTypes["BABYLON.PlayAnimationAction"]=ve,H.a.RegisteredTypes["BABYLON.IncrementValueAction"]=_e,H.a.RegisteredTypes["BABYLON.SetValueAction"]=pe,H.a.RegisteredTypes["BABYLON.SetStateAction"]=fe,H.a.RegisteredTypes["BABYLON.SetParentAction"]=Se;var Me=N(23),xe=N(33),Ae=function(D){function t(w){var N=D.call(this)||this;return N._scene=w||Me.a.LastCreatedScene,w.actionManagers.push(N),N}return Object(Z.d)(t,D),t.prototype.dispose=function(){for(var D=this._scene.actionManagers.indexOf(this),w=0;w<this.actions.length;w++){var N=this.actions[w];t.Triggers[N.trigger]--,0===t.Triggers[N.trigger]&&delete t.Triggers[N.trigger]}D>-1&&this._scene.actionManagers.splice(D,1)},t.prototype.getScene=function(){return this._scene},t.prototype.hasSpecificTriggers=function(D){for(var w=0;w<this.actions.length;w++){var N=this.actions[w];if(D.indexOf(N.trigger)>-1)return!0}return!1},t.prototype.hasSpecificTriggers2=function(D,w){for(var N=0;N<this.actions.length;N++){var F=this.actions[N];if(D==F.trigger||w==F.trigger)return!0}return!1},t.prototype.hasSpecificTrigger=function(D,w){for(var N=0;N<this.actions.length;N++){var F=this.actions[N];if(F.trigger===D){if(!w)return!0;if(w(F.getTriggerParameter()))return!0}}return!1},Object.defineProperty(t.prototype,"hasPointerTriggers",{get:function(){for(var D=0;D<this.actions.length;D++){var w=this.actions[D];if(w.trigger>=t.OnPickTrigger&&w.trigger<=t.OnPointerOutTrigger)return!0}return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasPickTriggers",{get:function(){for(var D=0;D<this.actions.length;D++){var w=this.actions[D];if(w.trigger>=t.OnPickTrigger&&w.trigger<=t.OnPickUpTrigger)return!0}return!1},enumerable:!0,configurable:!0}),t.prototype.registerAction=function(D){return D.trigger===t.OnEveryFrameTrigger&&this.getScene().actionManager!==this?(oe.a.Warn("OnEveryFrameTrigger can only be used with scene.actionManager"),null):(this.actions.push(D),t.Triggers[D.trigger]?t.Triggers[D.trigger]++:t.Triggers[D.trigger]=1,D._actionManager=this,D._prepare(),D)},t.prototype.unregisterAction=function(D){var w=this.actions.indexOf(D);return-1!==w&&(this.actions.splice(w,1),t.Triggers[D.trigger]-=1,0===t.Triggers[D.trigger]&&delete t.Triggers[D.trigger],delete D._actionManager,!0)},t.prototype.processTrigger=function(D,w){for(var N=0;N<this.actions.length;N++){var F=this.actions[N];if(F.trigger===D){if(w&&(D===t.OnKeyUpTrigger||D===t.OnKeyDownTrigger)){var k=F.getTriggerParameter();if(k&&k!==w.sourceEvent.keyCode){if(!k.toLowerCase)continue;var j=k.toLowerCase();if(j!==w.sourceEvent.key){var z=w.sourceEvent.charCode?w.sourceEvent.charCode:w.sourceEvent.keyCode;if(String.fromCharCode(z).toLowerCase()!==j)continue}}}F._executeCurrent(w)}}},t.prototype._getEffectiveTarget=function(D,w){for(var N=w.split("."),F=0;F<N.length-1;F++)D=D[N[F]];return D},t.prototype._getProperty=function(D){var w=D.split(".");return w[w.length-1]},t.prototype.serialize=function(D){for(var w={children:new Array,name:D,type:3,properties:new Array},N=0;N<this.actions.length;N++){var F={type:0,children:new Array,name:t.GetTriggerName(this.actions[N].trigger),properties:new Array},k=this.actions[N].triggerOptions;if(k&&"number"!=typeof k)if(k.parameter instanceof Node)F.properties.push(X._GetTargetProperty(k.parameter));else{var j={};xe.a.DeepCopy(k.parameter,j,["mesh"]),k.parameter&&k.parameter.mesh&&(j._meshId=k.parameter.mesh.id),F.properties.push({name:"parameter",targetType:null,value:j})}this.actions[N].serialize(F),w.children.push(F)}return w},t.Parse=function(D,w,N){var F=new t(N);null===w?N.actionManager=F:w.actionManager=F;for(var o=function(D,w,N,F){if(null===F){var k=parseFloat(w);return"true"===w||"false"===w?"true"===w:isNaN(k)?w:k}for(var j=F.split("."),H=w.split(","),X=0;X<j.length;X++)N=N[j[X]];if("boolean"==typeof N)return"true"===H[0];if("string"==typeof N)return H[0];var q=new Array;for(X=0;X<H.length;X++)q.push(parseFloat(H[X]));return N instanceof z.e?z.e.FromArray(q):N instanceof z.f?z.f.FromArray(q):N instanceof G.a?G.a.FromArray(q):N instanceof G.b?G.b.FromArray(q):parseFloat(H[0])},l=function(D,w,k,j,z){if(void 0===z&&(z=null),!D.detached){var G=new Array,X=null,q=null,Z=D.combine&&D.combine.length>0;if(2===D.type?G.push(F):G.push(w),Z){for(var te=new Array,ie=0;ie<D.combine.length;ie++)l(D.combine[ie],t.NothingTrigger,k,j,te);G.push(te)}else for(var oe=0;oe<D.properties.length;oe++){var ce=D.properties[oe].value,he=D.properties[oe].name,fe=D.properties[oe].targetType;"target"===he?ce=X=null!==fe&&"SceneProperties"===fe?N:N.getNodeByName(ce):"parent"===he?ce=N.getNodeByName(ce):"sound"===he?N.getSoundByName&&(ce=N.getSoundByName(ce)):"propertyPath"!==he?ce=2===D.type&&"operator"===he?$[ce]:o(0,ce,X,"value"===he?q:null):q=ce,G.push(ce)}if(null===z?G.push(k):G.push(null),"InterpolateValueAction"===D.name){var pe=G[G.length-2];G[G.length-1]=pe,G[G.length-2]=k}var _e=function(D,w){var N=H.a.GetClass("BABYLON."+D);if(N){var F=Object.create(N.prototype);return F.constructor.apply(F,w),F}}(D.name,G);if(_e instanceof J&&null!==k){var ve=new be(w,k);j?j.then(ve):F.registerAction(ve),j=ve}for(null===z?_e instanceof J?(k=_e,_e=j):(k=null,j?j.then(_e):F.registerAction(_e)):z.push(_e),oe=0;oe<D.children.length;oe++)l(D.children[oe],w,k,_e,null)}},k=0;k<D.children.length;k++){var j,X=D.children[k];if(X.properties.length>0){var q=X.properties[0].value,Z=null===X.properties[0].targetType?q:N.getMeshByName(q);Z._meshId&&(Z.mesh=N.getMeshByID(Z._meshId)),j={trigger:t[X.name],parameter:Z}}else j=t[X.name];for(var te=0;te<X.children.length;te++)X.detached||l(X.children[te],j,null,null)}},t.GetTriggerName=function(D){switch(D){case 0:return"NothingTrigger";case 1:return"OnPickTrigger";case 2:return"OnLeftPickTrigger";case 3:return"OnRightPickTrigger";case 4:return"OnCenterPickTrigger";case 5:return"OnPickDownTrigger";case 6:return"OnPickUpTrigger";case 7:return"OnLongPressTrigger";case 8:return"OnPointerOverTrigger";case 9:return"OnPointerOutTrigger";case 10:return"OnEveryFrameTrigger";case 11:return"OnIntersectionEnterTrigger";case 12:return"OnIntersectionExitTrigger";case 13:return"OnKeyDownTrigger";case 14:return"OnKeyUpTrigger";case 15:return"OnPickOutTrigger";default:return""}},t.NothingTrigger=ce.a.ACTION_NothingTrigger,t.OnPickTrigger=ce.a.ACTION_OnPickTrigger,t.OnLeftPickTrigger=ce.a.ACTION_OnLeftPickTrigger,t.OnRightPickTrigger=ce.a.ACTION_OnRightPickTrigger,t.OnCenterPickTrigger=ce.a.ACTION_OnCenterPickTrigger,t.OnPickDownTrigger=ce.a.ACTION_OnPickDownTrigger,t.OnDoublePickTrigger=ce.a.ACTION_OnDoublePickTrigger,t.OnPickUpTrigger=ce.a.ACTION_OnPickUpTrigger,t.OnPickOutTrigger=ce.a.ACTION_OnPickOutTrigger,t.OnLongPressTrigger=ce.a.ACTION_OnLongPressTrigger,t.OnPointerOverTrigger=ce.a.ACTION_OnPointerOverTrigger,t.OnPointerOutTrigger=ce.a.ACTION_OnPointerOutTrigger,t.OnEveryFrameTrigger=ce.a.ACTION_OnEveryFrameTrigger,t.OnIntersectionEnterTrigger=ce.a.ACTION_OnIntersectionEnterTrigger,t.OnIntersectionExitTrigger=ce.a.ACTION_OnIntersectionExitTrigger,t.OnKeyDownTrigger=ce.a.ACTION_OnKeyDownTrigger,t.OnKeyUpTrigger=15,t}(k.a),Pe=function(D){function t(w,N,F){var k=D.call(this,w,F)||this;return k._sound=N,k}return Object(Z.d)(t,D),t.prototype._prepare=function(){},t.prototype.execute=function(){void 0!==this._sound&&this._sound.play()},t.prototype.serialize=function(w){return D.prototype._serialize.call(this,{name:"PlaySoundAction",properties:[{name:"sound",value:this._sound.name}]},w)},t}(X),Oe=function(D){function t(w,N,F){var k=D.call(this,w,F)||this;return k._sound=N,k}return Object(Z.d)(t,D),t.prototype._prepare=function(){},t.prototype.execute=function(){void 0!==this._sound&&this._sound.stop()},t.prototype.serialize=function(w){return D.prototype._serialize.call(this,{name:"StopSoundAction",properties:[{name:"sound",value:this._sound.name}]},w)},t}(X);H.a.RegisteredTypes["BABYLON.PlaySoundAction"]=Oe,H.a.RegisteredTypes["BABYLON.StopSoundAction"]=Oe;var Re,De=N(14),Ie=N(3);!function(D){D[D.STEP=1]="STEP"}(Re||(Re={}));var Le=function(){function e(D,w,N){this.name=D,this.from=w,this.to=N}return e.prototype.clone=function(){return new e(this.name,this.from,this.to)},e}(),we=N(26),Ne=N(68),V=function(){},Fe=function(){function e(D,w,N,F,k,j){this.name=D,this.targetProperty=w,this.framePerSecond=N,this.dataType=F,this.loopMode=k,this.enableBlending=j,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=w.split("."),this.dataType=F,this.loopMode=void 0===k?e.ANIMATIONLOOPMODE_CYCLE:k}return e._PrepareAnimation=function(D,w,N,F,k,j,H,X){var q=void 0;if(!isNaN(parseFloat(k))&&isFinite(k)?q=e.ANIMATIONTYPE_FLOAT:k instanceof z.b?q=e.ANIMATIONTYPE_QUATERNION:k instanceof z.e?q=e.ANIMATIONTYPE_VECTOR3:k instanceof z.d?q=e.ANIMATIONTYPE_VECTOR2:k instanceof G.a?q=e.ANIMATIONTYPE_COLOR3:k instanceof G.b?q=e.ANIMATIONTYPE_COLOR4:k instanceof Ne.a&&(q=e.ANIMATIONTYPE_SIZE),null==q)return null;var Z=new e(D,w,N,q,H),J=[{frame:0,value:k},{frame:F,value:j}];return Z.setKeys(J),void 0!==X&&Z.setEasingFunction(X),Z},e.CreateAnimation=function(D,w,N,F){var k=new e(D+"Animation",D,N,w,e.ANIMATIONLOOPMODE_CONSTANT);return k.setEasingFunction(F),k},e.CreateAndStartAnimation=function(D,w,N,F,k,j,z,G,H,X){var q=e._PrepareAnimation(D,N,F,k,j,z,G,H);return q?w.getScene().beginDirectAnimation(w,[q],0,k,1===q.loopMode,1,X):null},e.CreateAndStartHierarchyAnimation=function(D,w,N,F,k,j,z,G,H,X,q){var Z=e._PrepareAnimation(D,F,k,j,z,G,H,X);return Z?w.getScene().beginDirectHierarchyAnimation(w,N,[Z],0,j,1===Z.loopMode,1,q):null},e.CreateMergeAndStartAnimation=function(D,w,N,F,k,j,z,G,H,X){var q=e._PrepareAnimation(D,N,F,k,j,z,G,H);return q?(w.animations.push(q),w.getScene().beginAnimation(w,0,k,1===q.loopMode,1,X)):null},e.TransitionTo=function(D,w,N,F,k,j,z,G){if(void 0===G&&(G=null),z<=0)return N[D]=w,G&&G(),null;var H=k*(z/1e3);j.setKeys([{frame:0,value:N[D].clone?N[D].clone():N[D]},{frame:H,value:w}]),N.animations||(N.animations=[]),N.animations.push(j);var X=F.beginAnimation(N,0,H,!1);return X.onAnimationEnd=G,X},Object.defineProperty(e.prototype,"runtimeAnimations",{get:function(){return this._runtimeAnimations},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasRunningRuntimeAnimations",{get:function(){for(var D=0,w=this._runtimeAnimations;D<w.length;D++)if(!w[D].isStopped)return!0;return!1},enumerable:!0,configurable:!0}),e.prototype.toString=function(D){var w="Name: "+this.name+", property: "+this.targetProperty;if(w+=", datatype: "+["Float","Vector3","Quaternion","Matrix","Color3","Vector2"][this.dataType],w+=", nKeys: "+(this._keys?this._keys.length:"none"),w+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),D){w+=", Ranges: {";var N=!0;for(var F in this._ranges)N&&(w+=", ",N=!1),w+=F;w+="}"}return w},e.prototype.addEvent=function(D){this._events.push(D)},e.prototype.removeEvents=function(D){for(var w=0;w<this._events.length;w++)this._events[w].frame===D&&(this._events.splice(w,1),w--)},e.prototype.getEvents=function(){return this._events},e.prototype.createRange=function(D,w,N){this._ranges[D]||(this._ranges[D]=new Le(D,w,N))},e.prototype.deleteRange=function(D,w){void 0===w&&(w=!0);var N=this._ranges[D];if(N){if(w)for(var F=N.from,k=N.to,j=this._keys.length-1;j>=0;j--)this._keys[j].frame>=F&&this._keys[j].frame<=k&&this._keys.splice(j,1);this._ranges[D]=null}},e.prototype.getRange=function(D){return this._ranges[D]},e.prototype.getKeys=function(){return this._keys},e.prototype.getHighestFrame=function(){for(var D=0,w=0,N=this._keys.length;w<N;w++)D<this._keys[w].frame&&(D=this._keys[w].frame);return D},e.prototype.getEasingFunction=function(){return this._easingFunction},e.prototype.setEasingFunction=function(D){this._easingFunction=D},e.prototype.floatInterpolateFunction=function(D,w,N){return De.a.Lerp(D,w,N)},e.prototype.floatInterpolateFunctionWithTangents=function(D,w,N,F,k){return De.a.Hermite(D,w,N,F,k)},e.prototype.quaternionInterpolateFunction=function(D,w,N){return z.b.Slerp(D,w,N)},e.prototype.quaternionInterpolateFunctionWithTangents=function(D,w,N,F,k){return z.b.Hermite(D,w,N,F,k).normalize()},e.prototype.vector3InterpolateFunction=function(D,w,N){return z.e.Lerp(D,w,N)},e.prototype.vector3InterpolateFunctionWithTangents=function(D,w,N,F,k){return z.e.Hermite(D,w,N,F,k)},e.prototype.vector2InterpolateFunction=function(D,w,N){return z.d.Lerp(D,w,N)},e.prototype.vector2InterpolateFunctionWithTangents=function(D,w,N,F,k){return z.d.Hermite(D,w,N,F,k)},e.prototype.sizeInterpolateFunction=function(D,w,N){return Ne.a.Lerp(D,w,N)},e.prototype.color3InterpolateFunction=function(D,w,N){return G.a.Lerp(D,w,N)},e.prototype.color4InterpolateFunction=function(D,w,N){return G.b.Lerp(D,w,N)},e.prototype._getKeyValue=function(D){return"function"==typeof D?D():D},e.prototype._interpolate=function(D,w){if(w.loopMode===e.ANIMATIONLOOPMODE_CONSTANT&&w.repeatCount>0)return w.highLimitValue.clone?w.highLimitValue.clone():w.highLimitValue;var N=this._keys;if(1===N.length)return this._getKeyValue(N[0].value);var F=w.key;if(N[F].frame>=D)for(;F-1>=0&&N[F].frame>=D;)F--;for(var k=F;k<N.length;k++){var j=N[k+1];if(j.frame>=D){w.key=k;var z=N[k],G=this._getKeyValue(z.value);if(z.interpolation===Re.STEP)return G;var H=this._getKeyValue(j.value),X=void 0!==z.outTangent&&void 0!==j.inTangent,q=j.frame-z.frame,Z=(D-z.frame)/q,J=this.getEasingFunction();switch(null!=J&&(Z=J.ease(Z)),this.dataType){case e.ANIMATIONTYPE_FLOAT:var $=X?this.floatInterpolateFunctionWithTangents(G,z.outTangent*q,H,j.inTangent*q,Z):this.floatInterpolateFunction(G,H,Z);switch(w.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:return $;case e.ANIMATIONLOOPMODE_RELATIVE:return w.offsetValue*w.repeatCount+$}break;case e.ANIMATIONTYPE_QUATERNION:var te=X?this.quaternionInterpolateFunctionWithTangents(G,z.outTangent.scale(q),H,j.inTangent.scale(q),Z):this.quaternionInterpolateFunction(G,H,Z);switch(w.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:return te;case e.ANIMATIONLOOPMODE_RELATIVE:return te.addInPlace(w.offsetValue.scale(w.repeatCount))}return te;case e.ANIMATIONTYPE_VECTOR3:var ie=X?this.vector3InterpolateFunctionWithTangents(G,z.outTangent.scale(q),H,j.inTangent.scale(q),Z):this.vector3InterpolateFunction(G,H,Z);switch(w.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:return ie;case e.ANIMATIONLOOPMODE_RELATIVE:return ie.add(w.offsetValue.scale(w.repeatCount))}case e.ANIMATIONTYPE_VECTOR2:var oe=X?this.vector2InterpolateFunctionWithTangents(G,z.outTangent.scale(q),H,j.inTangent.scale(q),Z):this.vector2InterpolateFunction(G,H,Z);switch(w.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:return oe;case e.ANIMATIONLOOPMODE_RELATIVE:return oe.add(w.offsetValue.scale(w.repeatCount))}case e.ANIMATIONTYPE_SIZE:switch(w.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:return this.sizeInterpolateFunction(G,H,Z);case e.ANIMATIONLOOPMODE_RELATIVE:return this.sizeInterpolateFunction(G,H,Z).add(w.offsetValue.scale(w.repeatCount))}case e.ANIMATIONTYPE_COLOR3:switch(w.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:return this.color3InterpolateFunction(G,H,Z);case e.ANIMATIONLOOPMODE_RELATIVE:return this.color3InterpolateFunction(G,H,Z).add(w.offsetValue.scale(w.repeatCount))}case e.ANIMATIONTYPE_COLOR4:switch(w.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:return this.color4InterpolateFunction(G,H,Z);case e.ANIMATIONLOOPMODE_RELATIVE:return this.color4InterpolateFunction(G,H,Z).add(w.offsetValue.scale(w.repeatCount))}case e.ANIMATIONTYPE_MATRIX:switch(w.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:if(e.AllowMatricesInterpolation)return this.matrixInterpolateFunction(G,H,Z,w.workValue);case e.ANIMATIONLOOPMODE_RELATIVE:return G}}break}}return this._getKeyValue(N[N.length-1].value)},e.prototype.matrixInterpolateFunction=function(D,w,N,F){return e.AllowMatrixDecomposeForInterpolation?F?(z.a.DecomposeLerpToRef(D,w,N,F),F):z.a.DecomposeLerp(D,w,N):F?(z.a.LerpToRef(D,w,N,F),F):z.a.Lerp(D,w,N)},e.prototype.clone=function(){var D=new e(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(D.enableBlending=this.enableBlending,D.blendingSpeed=this.blendingSpeed,this._keys&&D.setKeys(this._keys),this._ranges)for(var w in D._ranges={},this._ranges){var N=this._ranges[w];N&&(D._ranges[w]=N.clone())}return D},e.prototype.setKeys=function(D){this._keys=D.slice(0)},e.prototype.serialize=function(){var D={};D.name=this.name,D.property=this.targetProperty,D.framePerSecond=this.framePerSecond,D.dataType=this.dataType,D.loopBehavior=this.loopMode,D.enableBlending=this.enableBlending,D.blendingSpeed=this.blendingSpeed;var w=this.dataType;D.keys=[];for(var N=this.getKeys(),F=0;F<N.length;F++){var k=N[F],j={};switch(j.frame=k.frame,w){case e.ANIMATIONTYPE_FLOAT:j.values=[k.value];break;case e.ANIMATIONTYPE_QUATERNION:case e.ANIMATIONTYPE_MATRIX:case e.ANIMATIONTYPE_VECTOR3:case e.ANIMATIONTYPE_COLOR3:case e.ANIMATIONTYPE_COLOR4:j.values=k.value.asArray()}D.keys.push(j)}for(var z in D.ranges=[],this._ranges){var G=this._ranges[z];if(G){var H={};H.name=z,H.from=G.from,H.to=G.to,D.ranges.push(H)}}return D},e._UniversalLerp=function(D,w,N){var F=D.constructor;return F.Lerp?F.Lerp(D,w,N):F.Slerp?F.Slerp(D,w,N):D.toFixed?D*(1-N)+N*w:w},e.Parse=function(D){var w,N,F=new e(D.name,D.property,D.framePerSecond,D.dataType,D.loopBehavior),k=D.dataType,j=[];for(D.enableBlending&&(F.enableBlending=D.enableBlending),D.blendingSpeed&&(F.blendingSpeed=D.blendingSpeed),N=0;N<D.keys.length;N++){var H,X,q=D.keys[N];switch(k){case e.ANIMATIONTYPE_FLOAT:w=q.values[0],q.values.length>=1&&(H=q.values[1]),q.values.length>=2&&(X=q.values[2]);break;case e.ANIMATIONTYPE_QUATERNION:if(w=z.b.FromArray(q.values),q.values.length>=8){var Z=z.b.FromArray(q.values.slice(4,8));Z.equals(z.b.Zero())||(H=Z)}if(q.values.length>=12){var J=z.b.FromArray(q.values.slice(8,12));J.equals(z.b.Zero())||(X=J)}break;case e.ANIMATIONTYPE_MATRIX:w=z.a.FromArray(q.values);break;case e.ANIMATIONTYPE_COLOR3:w=G.a.FromArray(q.values);break;case e.ANIMATIONTYPE_COLOR4:w=G.b.FromArray(q.values);break;case e.ANIMATIONTYPE_VECTOR3:default:w=z.e.FromArray(q.values)}var $={};$.frame=q.frame,$.value=w,null!=H&&($.inTangent=H),null!=X&&($.outTangent=X),j.push($)}if(F.setKeys(j),D.ranges)for(N=0;N<D.ranges.length;N++)w=D.ranges[N],F.createRange(w.name,w.from,w.to);return F},e.AppendSerializedAnimations=function(D,w){Ie.a.AppendSerializedAnimations(D,w)},e.AllowMatricesInterpolation=!1,e.AllowMatrixDecomposeForInterpolation=!0,e.ANIMATIONTYPE_FLOAT=0,e.ANIMATIONTYPE_VECTOR3=1,e.ANIMATIONTYPE_QUATERNION=2,e.ANIMATIONTYPE_MATRIX=3,e.ANIMATIONTYPE_COLOR3=4,e.ANIMATIONTYPE_COLOR4=7,e.ANIMATIONTYPE_VECTOR2=5,e.ANIMATIONTYPE_SIZE=6,e.ANIMATIONLOOPMODE_RELATIVE=0,e.ANIMATIONLOOPMODE_CYCLE=1,e.ANIMATIONLOOPMODE_CONSTANT=2,e}();H.a.RegisteredTypes["BABYLON.Animation"]=Fe,we.a._AnimationRangeFactory=function(D,w,N){return new Le(D,w,N)};var Be=function(D){function t(w,N,F,k,z,G,H,X){void 0===z&&(z=1e3);var q=D.call(this,w,G)||this;return q.duration=1e3,q.onInterpolationDoneObservable=new j.c,q.propertyPath=F,q.value=k,q.duration=z,q.stopOtherAnimations=H,q.onInterpolationDone=X,q._target=q._effectiveTarget=N,q}return Object(Z.d)(t,D),t.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath)},t.prototype.execute=function(){var D,w=this,N=this._actionManager.getScene(),F=[{frame:0,value:this._effectiveTarget[this._property]},{frame:100,value:this.value}];if("number"==typeof this.value)D=Fe.ANIMATIONTYPE_FLOAT;else if(this.value instanceof G.a)D=Fe.ANIMATIONTYPE_COLOR3;else if(this.value instanceof z.e)D=Fe.ANIMATIONTYPE_VECTOR3;else if(this.value instanceof z.a)D=Fe.ANIMATIONTYPE_MATRIX;else{if(!(this.value instanceof z.b))return void oe.a.Warn("InterpolateValueAction: Unsupported type ("+typeof this.value+")");D=Fe.ANIMATIONTYPE_QUATERNION}var k=new Fe("InterpolateValueAction",this._property,1e3/this.duration*100,D,Fe.ANIMATIONLOOPMODE_CONSTANT);k.setKeys(F),this.stopOtherAnimations&&N.stopAnimation(this._effectiveTarget),N.beginDirectAnimation(this._effectiveTarget,[k],0,100,!1,1,(function(){w.onInterpolationDoneObservable.notifyObservers(w),w.onInterpolationDone&&w.onInterpolationDone()}))},t.prototype.serialize=function(w){return D.prototype._serialize.call(this,{name:"InterpolateValueAction",properties:[X._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:X._SerializeValueAsString(this.value)},{name:"duration",value:X._SerializeValueAsString(this.duration)},{name:"stopOtherAnimations",value:X._SerializeValueAsString(this.stopOtherAnimations)||!1}]},w)},t}(X);H.a.RegisteredTypes["BABYLON.InterpolateValueAction"]=Be;var Ue=Object.freeze(new z.b(0,0,0,0)),Ve=Object.freeze(z.e.Zero()),ze=Object.freeze(z.d.Zero()),Ge=Object.freeze(Ne.a.Zero()),Ye=Object.freeze(G.a.Black()),He=function(){function e(D,w,N,F){var k=this;if(this._events=new Array,this._currentFrame=0,this._originalValue=new Array,this._originalBlendValue=null,this._offsetsCache={},this._highLimitsCache={},this._stopped=!1,this._blendingFactor=0,this._currentValue=null,this._currentActiveTarget=null,this._directTarget=null,this._targetPath="",this._weight=1,this._ratioOffset=0,this._previousDelay=0,this._previousRatio=0,this._targetIsArray=!1,this._animation=w,this._target=D,this._scene=N,this._host=F,this._activeTargets=[],w._runtimeAnimations.push(this),this._animationState={key:0,repeatCount:0,loopMode:this._getCorrectLoopMode()},this._animation.dataType===Fe.ANIMATIONTYPE_MATRIX&&(this._animationState.workValue=z.a.Zero()),this._keys=this._animation.getKeys(),this._minFrame=this._keys[0].frame,this._maxFrame=this._keys[this._keys.length-1].frame,this._minValue=this._keys[0].value,this._maxValue=this._keys[this._keys.length-1].value,0!==this._minFrame){var j={frame:0,value:this._minValue};this._keys.splice(0,0,j)}if(this._target instanceof Array){for(var G=0,H=0,X=this._target;H<X.length;H++){var q=X[H];this._preparePath(q,G),this._getOriginalValues(G),G++}this._targetIsArray=!0}else this._preparePath(this._target),this._getOriginalValues(),this._targetIsArray=!1,this._directTarget=this._activeTargets[0];var Z=w.getEvents();Z&&Z.length>0&&Z.forEach((function(D){k._events.push(D._clone())})),this._enableBlending=D&&D.animationPropertiesOverride?D.animationPropertiesOverride.enableBlending:this._animation.enableBlending}return Object.defineProperty(e.prototype,"currentFrame",{get:function(){return this._currentFrame},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"weight",{get:function(){return this._weight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentValue",{get:function(){return this._currentValue},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"targetPath",{get:function(){return this._targetPath},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this._currentActiveTarget},enumerable:!0,configurable:!0}),e.prototype._preparePath=function(D,w){void 0===w&&(w=0);var N=this._animation.targetPropertyPath;if(N.length>1){for(var F=D[N[0]],k=1;k<N.length-1;k++)F=F[N[k]];this._targetPath=N[N.length-1],this._activeTargets[w]=F}else this._targetPath=N[0],this._activeTargets[w]=D},Object.defineProperty(e.prototype,"animation",{get:function(){return this._animation},enumerable:!0,configurable:!0}),e.prototype.reset=function(D){if(void 0===D&&(D=!1),D)if(this._target instanceof Array)for(var w=0,N=0,F=this._target;N<F.length;N++){var k=F[N];void 0!==this._originalValue[w]&&this._setValue(k,this._activeTargets[w],this._originalValue[w],-1,w),w++}else void 0!==this._originalValue[0]&&this._setValue(this._target,this._directTarget,this._originalValue[0],-1,0);for(this._offsetsCache={},this._highLimitsCache={},this._currentFrame=0,this._blendingFactor=0,w=0;w<this._events.length;w++)this._events[w].isDone=!1},e.prototype.isStopped=function(){return this._stopped},e.prototype.dispose=function(){var D=this._animation.runtimeAnimations.indexOf(this);D>-1&&this._animation.runtimeAnimations.splice(D,1)},e.prototype.setValue=function(D,w){if(this._targetIsArray)for(var N=0;N<this._target.length;N++){var F=this._target[N];this._setValue(F,this._activeTargets[N],D,w,N)}else this._setValue(this._target,this._directTarget,D,w,0)},e.prototype._getOriginalValues=function(D){var w;void 0===D&&(D=0);var N=this._activeTargets[D];(w=N.getRestPose&&"_matrix"===this._targetPath?N.getRestPose():N[this._targetPath])&&w.clone?this._originalValue[D]=w.clone():this._originalValue[D]=w},e.prototype._setValue=function(D,w,N,F,k){if(this._currentActiveTarget=w,this._weight=F,this._enableBlending&&this._blendingFactor<=1){if(!this._originalBlendValue){var j=w[this._targetPath];j.clone?this._originalBlendValue=j.clone():this._originalBlendValue=j}this._originalBlendValue.m?Fe.AllowMatrixDecomposeForInterpolation?this._currentValue?z.a.DecomposeLerpToRef(this._originalBlendValue,N,this._blendingFactor,this._currentValue):this._currentValue=z.a.DecomposeLerp(this._originalBlendValue,N,this._blendingFactor):this._currentValue?z.a.LerpToRef(this._originalBlendValue,N,this._blendingFactor,this._currentValue):this._currentValue=z.a.Lerp(this._originalBlendValue,N,this._blendingFactor):this._currentValue=Fe._UniversalLerp(this._originalBlendValue,N,this._blendingFactor);var G=D&&D.animationPropertiesOverride?D.animationPropertiesOverride.blendingSpeed:this._animation.blendingSpeed;this._blendingFactor+=G}else this._currentValue=N;-1!==F?this._scene._registerTargetForLateAnimationBinding(this,this._originalValue[k]):w[this._targetPath]=this._currentValue,D.markAsDirty&&D.markAsDirty(this._animation.targetProperty)},e.prototype._getCorrectLoopMode=function(){return this._target&&this._target.animationPropertiesOverride?this._target.animationPropertiesOverride.loopMode:this._animation.loopMode},e.prototype.goToFrame=function(D){var w=this._animation.getKeys();D<w[0].frame?D=w[0].frame:D>w[w.length-1].frame&&(D=w[w.length-1].frame);var N=this._events;if(N.length)for(var F=0;F<N.length;F++)N[F].onlyOnce||(N[F].isDone=N[F].frame<D);this._currentFrame=D;var k=this._animation._interpolate(D,this._animationState);this.setValue(k,-1)},e.prototype._prepareForSpeedRatioChange=function(D){var w=this._previousDelay*(this._animation.framePerSecond*D)/1e3;this._ratioOffset=this._previousRatio-w},e.prototype.animate=function(D,w,N,F,k,j){void 0===j&&(j=-1);var z=this._animation,G=z.targetPropertyPath;if(!G||G.length<1)return this._stopped=!0,!1;var H=!0;(w<this._minFrame||w>this._maxFrame)&&(w=this._minFrame),(N<this._minFrame||N>this._maxFrame)&&(N=this._maxFrame);var X,q,Z=N-w,J=D*(z.framePerSecond*k)/1e3+this._ratioOffset,$=0;if(this._previousDelay=D,this._previousRatio=J,!F&&N>=w&&J>=Z)H=!1,$=z._getKeyValue(this._maxValue);else if(!F&&w>=N&&J<=Z)H=!1,$=z._getKeyValue(this._minValue);else if(this._animationState.loopMode!==Fe.ANIMATIONLOOPMODE_CYCLE){var te=N.toString()+w.toString();if(!this._offsetsCache[te]){this._animationState.repeatCount=0,this._animationState.loopMode=Fe.ANIMATIONLOOPMODE_CYCLE;var ie=z._interpolate(w,this._animationState),oe=z._interpolate(N,this._animationState);switch(this._animationState.loopMode=this._getCorrectLoopMode(),z.dataType){case Fe.ANIMATIONTYPE_FLOAT:this._offsetsCache[te]=oe-ie;break;case Fe.ANIMATIONTYPE_QUATERNION:this._offsetsCache[te]=oe.subtract(ie);break;case Fe.ANIMATIONTYPE_VECTOR3:this._offsetsCache[te]=oe.subtract(ie);case Fe.ANIMATIONTYPE_VECTOR2:this._offsetsCache[te]=oe.subtract(ie);case Fe.ANIMATIONTYPE_SIZE:this._offsetsCache[te]=oe.subtract(ie);case Fe.ANIMATIONTYPE_COLOR3:this._offsetsCache[te]=oe.subtract(ie)}this._highLimitsCache[te]=oe}$=this._highLimitsCache[te],X=this._offsetsCache[te]}if(void 0===X)switch(z.dataType){case Fe.ANIMATIONTYPE_FLOAT:X=0;break;case Fe.ANIMATIONTYPE_QUATERNION:X=Ue;break;case Fe.ANIMATIONTYPE_VECTOR3:X=Ve;break;case Fe.ANIMATIONTYPE_VECTOR2:X=ze;break;case Fe.ANIMATIONTYPE_SIZE:X=Ge;break;case Fe.ANIMATIONTYPE_COLOR3:X=Ye}if(this._host&&this._host.syncRoot){var ce=this._host.syncRoot;q=w+(N-w)*((ce.masterFrame-ce.fromFrame)/(ce.toFrame-ce.fromFrame))}else q=H&&0!==Z?w+J%Z:N;var he=this._events;if((Z>0&&this.currentFrame>q||Z<0&&this.currentFrame<q)&&(this._onLoop(),he.length))for(var fe=0;fe<he.length;fe++)he[fe].onlyOnce||(he[fe].isDone=!1);this._currentFrame=q,this._animationState.repeatCount=0===Z?0:J/Z>>0,this._animationState.highLimitValue=$,this._animationState.offsetValue=X;var pe=z._interpolate(q,this._animationState);if(this.setValue(pe,j),he.length)for(fe=0;fe<he.length;fe++)if(Z>0&&q>=he[fe].frame&&he[fe].frame>=w||Z<0&&q<=he[fe].frame&&he[fe].frame<=w){var _e=he[fe];_e.isDone||(_e.onlyOnce&&(he.splice(fe,1),fe--),_e.isDone=!0,_e.action(q))}return H||(this._stopped=!0),H},e}(),We=N(18),Xe=N(52),Ke=N(42),Qe=N(22),Ze=function(D){function t(w,N,F,k,j,G,H){void 0===F&&(F=null),void 0===k&&(k=null),void 0===j&&(j=null),void 0===G&&(G=null),void 0===H&&(H=null);var X=D.call(this,w,N.getScene())||this;return X.name=w,X.children=new Array,X.animations=new Array,X._index=null,X._absoluteTransform=new z.a,X._invertedAbsoluteTransform=new z.a,X._scalingDeterminant=1,X._worldTransform=new z.a,X._needToDecompose=!0,X._needToCompose=!1,X._linkedTransformNode=null,X._waitingTransformNodeId=null,X._skeleton=N,X._localMatrix=k?k.clone():z.a.Identity(),X._restPose=j||X._localMatrix.clone(),X._baseMatrix=G||X._localMatrix.clone(),X._index=H,N.bones.push(X),X.setParent(F,!1),(G||k)&&X._updateDifferenceMatrix(),X}return Object(Z.d)(t,D),Object.defineProperty(t.prototype,"_matrix",{get:function(){return this._compose(),this._localMatrix},set:function(D){this._localMatrix.copyFrom(D),this._needToDecompose=!0},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"Bone"},t.prototype.getSkeleton=function(){return this._skeleton},t.prototype.getParent=function(){return this._parent},t.prototype.getChildren=function(){return this.children},t.prototype.getIndex=function(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index},t.prototype.setParent=function(D,w){if(void 0===w&&(w=!0),this._parent!==D){if(this._parent){var N=this._parent.children.indexOf(this);-1!==N&&this._parent.children.splice(N,1)}this._parent=D,this._parent&&this._parent.children.push(this),w&&this._updateDifferenceMatrix(),this.markAsDirty()}},t.prototype.getLocalMatrix=function(){return this._compose(),this._localMatrix},t.prototype.getBaseMatrix=function(){return this._baseMatrix},t.prototype.getRestPose=function(){return this._restPose},t.prototype.getWorldMatrix=function(){return this._worldTransform},t.prototype.returnToRest=function(){this.updateMatrix(this._restPose.clone())},t.prototype.getInvertedAbsoluteTransform=function(){return this._invertedAbsoluteTransform},t.prototype.getAbsoluteTransform=function(){return this._absoluteTransform},t.prototype.linkTransformNode=function(D){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=D,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++},t.prototype.getTransformNode=function(){return this._linkedTransformNode},Object.defineProperty(t.prototype,"position",{get:function(){return this._decompose(),this._localPosition},set:function(D){this._decompose(),this._localPosition.copyFrom(D),this._markAsDirtyAndCompose()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotation",{get:function(){return this.getRotation()},set:function(D){this.setRotation(D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotationQuaternion",{get:function(){return this._decompose(),this._localRotation},set:function(D){this.setRotationQuaternion(D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaling",{get:function(){return this.getScale()},set:function(D){this.setScale(D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"animationPropertiesOverride",{get:function(){return this._skeleton.animationPropertiesOverride},enumerable:!0,configurable:!0}),t.prototype._decompose=function(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=z.e.Zero(),this._localRotation=z.b.Zero(),this._localPosition=z.e.Zero()),this._localMatrix.decompose(this._localScaling,this._localRotation,this._localPosition))},t.prototype._compose=function(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,z.a.ComposeToRef(this._localScaling,this._localRotation,this._localPosition,this._localMatrix)):this._needToCompose=!1)},t.prototype.updateMatrix=function(D,w,N){void 0===w&&(w=!0),void 0===N&&(N=!0),this._baseMatrix.copyFrom(D),w&&this._updateDifferenceMatrix(),N?(this._localMatrix.copyFrom(D),this._markAsDirtyAndDecompose()):this.markAsDirty()},t.prototype._updateDifferenceMatrix=function(D,w){if(void 0===w&&(w=!0),D||(D=this._baseMatrix),this._parent?D.multiplyToRef(this._parent._absoluteTransform,this._absoluteTransform):this._absoluteTransform.copyFrom(D),this._absoluteTransform.invertToRef(this._invertedAbsoluteTransform),w)for(var N=0;N<this.children.length;N++)this.children[N]._updateDifferenceMatrix();this._scalingDeterminant=this._absoluteTransform.determinant()<0?-1:1},t.prototype.markAsDirty=function(){this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty()},t.prototype._markAsDirtyAndCompose=function(){this.markAsDirty(),this._needToCompose=!0},t.prototype._markAsDirtyAndDecompose=function(){this.markAsDirty(),this._needToDecompose=!0},t.prototype.translate=function(D,w,N){void 0===w&&(w=Qe.b.LOCAL);var F=this.getLocalMatrix();if(w==Qe.b.LOCAL)F.addAtIndex(12,D.x),F.addAtIndex(13,D.y),F.addAtIndex(14,D.z);else{var k=null;N&&(k=N.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var j=t._tmpMats[0],G=t._tmpVecs[0];this._parent&&(N&&k?(j.copyFrom(this._parent.getAbsoluteTransform()),j.multiplyToRef(k,j)):j.copyFrom(this._parent.getAbsoluteTransform())),j.setTranslationFromFloats(0,0,0),j.invert(),z.e.TransformCoordinatesToRef(D,j,G),F.addAtIndex(12,G.x),F.addAtIndex(13,G.y),F.addAtIndex(14,G.z)}this._markAsDirtyAndDecompose()},t.prototype.setPosition=function(D,w,N){void 0===w&&(w=Qe.b.LOCAL);var F=this.getLocalMatrix();if(w==Qe.b.LOCAL)F.setTranslationFromFloats(D.x,D.y,D.z);else{var k=null;N&&(k=N.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var j=t._tmpMats[0],G=t._tmpVecs[0];this._parent&&(N&&k?(j.copyFrom(this._parent.getAbsoluteTransform()),j.multiplyToRef(k,j)):j.copyFrom(this._parent.getAbsoluteTransform())),j.invert(),z.e.TransformCoordinatesToRef(D,j,G),F.setTranslationFromFloats(G.x,G.y,G.z)}this._markAsDirtyAndDecompose()},t.prototype.setAbsolutePosition=function(D,w){this.setPosition(D,Qe.b.WORLD,w)},t.prototype.scale=function(D,w,N,F){void 0===F&&(F=!1);var k=this.getLocalMatrix(),j=t._tmpMats[0];z.a.ScalingToRef(D,w,N,j),j.multiplyToRef(k,k),j.invert();for(var G=0,H=this.children;G<H.length;G++){var X=(J=H[G]).getLocalMatrix();X.multiplyToRef(j,X),X.multiplyAtIndex(12,D),X.multiplyAtIndex(13,w),X.multiplyAtIndex(14,N),J._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),F)for(var q=0,Z=this.children;q<Z.length;q++){var J;(J=Z[q]).scale(D,w,N,F)}},t.prototype.setScale=function(D){this._decompose(),this._localScaling.copyFrom(D),this._markAsDirtyAndCompose()},t.prototype.getScale=function(){return this._decompose(),this._localScaling},t.prototype.getScaleToRef=function(D){this._decompose(),D.copyFrom(this._localScaling)},t.prototype.setYawPitchRoll=function(D,w,N,F,k){if(void 0===F&&(F=Qe.b.LOCAL),F===Qe.b.LOCAL){var j=t._tmpQuat;return z.b.RotationYawPitchRollToRef(D,w,N,j),void this.setRotationQuaternion(j,F,k)}var G=t._tmpMats[0];if(this._getNegativeRotationToRef(G,k)){var H=t._tmpMats[1];z.a.RotationYawPitchRollToRef(D,w,N,H),G.multiplyToRef(H,H),this._rotateWithMatrix(H,F,k)}},t.prototype.rotate=function(D,w,N,F){void 0===N&&(N=Qe.b.LOCAL);var k=t._tmpMats[0];k.setTranslationFromFloats(0,0,0),z.a.RotationAxisToRef(D,w,k),this._rotateWithMatrix(k,N,F)},t.prototype.setAxisAngle=function(D,w,N,F){if(void 0===N&&(N=Qe.b.LOCAL),N===Qe.b.LOCAL){var k=t._tmpQuat;return z.b.RotationAxisToRef(D,w,k),void this.setRotationQuaternion(k,N,F)}var j=t._tmpMats[0];if(this._getNegativeRotationToRef(j,F)){var G=t._tmpMats[1];z.a.RotationAxisToRef(D,w,G),j.multiplyToRef(G,G),this._rotateWithMatrix(G,N,F)}},t.prototype.setRotation=function(D,w,N){void 0===w&&(w=Qe.b.LOCAL),this.setYawPitchRoll(D.y,D.x,D.z,w,N)},t.prototype.setRotationQuaternion=function(D,w,N){if(void 0===w&&(w=Qe.b.LOCAL),w===Qe.b.LOCAL)return this._decompose(),this._localRotation.copyFrom(D),void this._markAsDirtyAndCompose();var F=t._tmpMats[0];if(this._getNegativeRotationToRef(F,N)){var k=t._tmpMats[1];z.a.FromQuaternionToRef(D,k),F.multiplyToRef(k,k),this._rotateWithMatrix(k,w,N)}},t.prototype.setRotationMatrix=function(D,w,N){if(void 0===w&&(w=Qe.b.LOCAL),w===Qe.b.LOCAL){var F=t._tmpQuat;return z.b.FromRotationMatrixToRef(D,F),void this.setRotationQuaternion(F,w,N)}var k=t._tmpMats[0];if(this._getNegativeRotationToRef(k,N)){var j=t._tmpMats[1];j.copyFrom(D),k.multiplyToRef(D,j),this._rotateWithMatrix(j,w,N)}},t.prototype._rotateWithMatrix=function(D,w,N){void 0===w&&(w=Qe.b.LOCAL);var F=this.getLocalMatrix(),k=F.m[12],j=F.m[13],z=F.m[14],G=this.getParent(),H=t._tmpMats[3],X=t._tmpMats[4];G&&w==Qe.b.WORLD?(N?(H.copyFrom(N.getWorldMatrix()),G.getAbsoluteTransform().multiplyToRef(H,H)):H.copyFrom(G.getAbsoluteTransform()),X.copyFrom(H),X.invert(),F.multiplyToRef(H,F),F.multiplyToRef(D,F),F.multiplyToRef(X,F)):w==Qe.b.WORLD&&N?(H.copyFrom(N.getWorldMatrix()),X.copyFrom(H),X.invert(),F.multiplyToRef(H,F),F.multiplyToRef(D,F),F.multiplyToRef(X,F)):F.multiplyToRef(D,F),F.setTranslationFromFloats(k,j,z),this.computeAbsoluteTransforms(),this._markAsDirtyAndDecompose()},t.prototype._getNegativeRotationToRef=function(D,w){var N=t._tmpMats[2];return D.copyFrom(this.getAbsoluteTransform()),w&&(D.multiplyToRef(w.getWorldMatrix(),D),z.a.ScalingToRef(w.scaling.x,w.scaling.y,w.scaling.z,N)),D.invert(),!isNaN(D.m[0])&&(N.multiplyAtIndex(0,this._scalingDeterminant),D.multiplyToRef(N,D),!0)},t.prototype.getPosition=function(D,w){void 0===D&&(D=Qe.b.LOCAL),void 0===w&&(w=null);var N=z.e.Zero();return this.getPositionToRef(D,w,N),N},t.prototype.getPositionToRef=function(D,w,N){if(void 0===D&&(D=Qe.b.LOCAL),D==Qe.b.LOCAL){var F=this.getLocalMatrix();N.x=F.m[12],N.y=F.m[13],N.z=F.m[14]}else{var k=null;w&&(k=w.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var j=t._tmpMats[0];w&&k?(j.copyFrom(this.getAbsoluteTransform()),j.multiplyToRef(k,j)):j=this.getAbsoluteTransform(),N.x=j.m[12],N.y=j.m[13],N.z=j.m[14]}},t.prototype.getAbsolutePosition=function(D){void 0===D&&(D=null);var w=z.e.Zero();return this.getPositionToRef(Qe.b.WORLD,D,w),w},t.prototype.getAbsolutePositionToRef=function(D,w){this.getPositionToRef(Qe.b.WORLD,D,w)},t.prototype.computeAbsoluteTransforms=function(){if(this._compose(),this._parent)this._localMatrix.multiplyToRef(this._parent._absoluteTransform,this._absoluteTransform);else{this._absoluteTransform.copyFrom(this._localMatrix);var D=this._skeleton.getPoseMatrix();D&&this._absoluteTransform.multiplyToRef(D,this._absoluteTransform)}for(var w=this.children,N=w.length,F=0;F<N;F++)w[F].computeAbsoluteTransforms()},t.prototype.getDirection=function(D,w){void 0===w&&(w=null);var N=z.e.Zero();return this.getDirectionToRef(D,w,N),N},t.prototype.getDirectionToRef=function(D,w,N){void 0===w&&(w=null);var F=null;w&&(F=w.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var k=t._tmpMats[0];k.copyFrom(this.getAbsoluteTransform()),w&&F&&k.multiplyToRef(F,k),z.e.TransformNormalToRef(D,k,N),N.normalize()},t.prototype.getRotation=function(D,w){void 0===D&&(D=Qe.b.LOCAL),void 0===w&&(w=null);var N=z.e.Zero();return this.getRotationToRef(D,w,N),N},t.prototype.getRotationToRef=function(D,w,N){void 0===D&&(D=Qe.b.LOCAL),void 0===w&&(w=null);var F=t._tmpQuat;this.getRotationQuaternionToRef(D,w,F),F.toEulerAnglesToRef(N)},t.prototype.getRotationQuaternion=function(D,w){void 0===D&&(D=Qe.b.LOCAL),void 0===w&&(w=null);var N=z.b.Identity();return this.getRotationQuaternionToRef(D,w,N),N},t.prototype.getRotationQuaternionToRef=function(D,w,N){if(void 0===D&&(D=Qe.b.LOCAL),void 0===w&&(w=null),D==Qe.b.LOCAL)this._decompose(),N.copyFrom(this._localRotation);else{var F=t._tmpMats[0],k=this.getAbsoluteTransform();w?k.multiplyToRef(w.getWorldMatrix(),F):F.copyFrom(k),F.multiplyAtIndex(0,this._scalingDeterminant),F.multiplyAtIndex(1,this._scalingDeterminant),F.multiplyAtIndex(2,this._scalingDeterminant),F.decompose(void 0,N,void 0)}},t.prototype.getRotationMatrix=function(D,w){void 0===D&&(D=Qe.b.LOCAL);var N=z.a.Identity();return this.getRotationMatrixToRef(D,w,N),N},t.prototype.getRotationMatrixToRef=function(D,w,N){if(void 0===D&&(D=Qe.b.LOCAL),D==Qe.b.LOCAL)this.getLocalMatrix().getRotationMatrixToRef(N);else{var F=t._tmpMats[0],k=this.getAbsoluteTransform();w?k.multiplyToRef(w.getWorldMatrix(),F):F.copyFrom(k),F.multiplyAtIndex(0,this._scalingDeterminant),F.multiplyAtIndex(1,this._scalingDeterminant),F.multiplyAtIndex(2,this._scalingDeterminant),F.getRotationMatrixToRef(N)}},t.prototype.getAbsolutePositionFromLocal=function(D,w){void 0===w&&(w=null);var N=z.e.Zero();return this.getAbsolutePositionFromLocalToRef(D,w,N),N},t.prototype.getAbsolutePositionFromLocalToRef=function(D,w,N){void 0===w&&(w=null);var F=null;w&&(F=w.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var k=t._tmpMats[0];w&&F?(k.copyFrom(this.getAbsoluteTransform()),k.multiplyToRef(F,k)):k=this.getAbsoluteTransform(),z.e.TransformCoordinatesToRef(D,k,N)},t.prototype.getLocalPositionFromAbsolute=function(D,w){void 0===w&&(w=null);var N=z.e.Zero();return this.getLocalPositionFromAbsoluteToRef(D,w,N),N},t.prototype.getLocalPositionFromAbsoluteToRef=function(D,w,N){void 0===w&&(w=null);var F=null;w&&(F=w.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var k=t._tmpMats[0];k.copyFrom(this.getAbsoluteTransform()),w&&F&&k.multiplyToRef(F,k),k.invert(),z.e.TransformCoordinatesToRef(D,k,N)},t._tmpVecs=Ke.a.BuildArray(2,z.e.Zero),t._tmpQuat=z.b.Identity(),t._tmpMats=Ke.a.BuildArray(5,z.a.Identity),t}(we.a),Je=function(){function e(D,w,N,F,k,z,G,H,X){void 0===N&&(N=0),void 0===F&&(F=100),void 0===k&&(k=!1),void 0===z&&(z=1),this.target=w,this.fromFrame=N,this.toFrame=F,this.loopAnimation=k,this.onAnimationEnd=G,this.onAnimationLoop=X,this._localDelayOffset=null,this._pausedDelay=null,this._runtimeAnimations=new Array,this._paused=!1,this._speedRatio=1,this._weight=-1,this._syncRoot=null,this.disposeOnEnd=!0,this.animationStarted=!1,this.onAnimationEndObservable=new j.c,this.onAnimationLoopObservable=new j.c,this._scene=D,H&&this.appendAnimations(w,H),this._speedRatio=z,D._activeAnimatables.push(this)}return Object.defineProperty(e.prototype,"syncRoot",{get:function(){return this._syncRoot},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"masterFrame",{get:function(){return 0===this._runtimeAnimations.length?0:this._runtimeAnimations[0].currentFrame},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"weight",{get:function(){return this._weight},set:function(D){this._weight=-1!==D?Math.min(Math.max(D,0),1):-1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"speedRatio",{get:function(){return this._speedRatio},set:function(D){for(var w=0;w<this._runtimeAnimations.length;w++)this._runtimeAnimations[w]._prepareForSpeedRatioChange(D);this._speedRatio=D},enumerable:!0,configurable:!0}),e.prototype.syncWith=function(D){if(this._syncRoot=D,D){var w=this._scene._activeAnimatables.indexOf(this);w>-1&&(this._scene._activeAnimatables.splice(w,1),this._scene._activeAnimatables.push(this))}return this},e.prototype.getAnimations=function(){return this._runtimeAnimations},e.prototype.appendAnimations=function(D,w){for(var N=this,F=0;F<w.length;F++){var k=w[F],j=new He(D,k,this._scene,this);j._onLoop=function(){N.onAnimationLoopObservable.notifyObservers(N),N.onAnimationLoop&&N.onAnimationLoop()},this._runtimeAnimations.push(j)}},e.prototype.getAnimationByTargetProperty=function(D){for(var w=this._runtimeAnimations,N=0;N<w.length;N++)if(w[N].animation.targetProperty===D)return w[N].animation;return null},e.prototype.getRuntimeAnimationByTargetProperty=function(D){for(var w=this._runtimeAnimations,N=0;N<w.length;N++)if(w[N].animation.targetProperty===D)return w[N];return null},e.prototype.reset=function(){for(var D=this._runtimeAnimations,w=0;w<D.length;w++)D[w].reset(!0);this._localDelayOffset=null,this._pausedDelay=null},e.prototype.enableBlending=function(D){for(var w=this._runtimeAnimations,N=0;N<w.length;N++)w[N].animation.enableBlending=!0,w[N].animation.blendingSpeed=D},e.prototype.disableBlending=function(){for(var D=this._runtimeAnimations,w=0;w<D.length;w++)D[w].animation.enableBlending=!1},e.prototype.goToFrame=function(D){var w=this._runtimeAnimations;if(w[0]){var N=w[0].animation.framePerSecond,F=D-w[0].currentFrame,k=0!==this.speedRatio?1e3*F/(N*this.speedRatio):0;null===this._localDelayOffset&&(this._localDelayOffset=0),this._localDelayOffset-=k}for(var j=0;j<w.length;j++)w[j].goToFrame(D)},e.prototype.pause=function(){this._paused||(this._paused=!0)},e.prototype.restart=function(){this._paused=!1},e.prototype._raiseOnAnimationEnd=function(){this.onAnimationEnd&&this.onAnimationEnd(),this.onAnimationEndObservable.notifyObservers(this)},e.prototype.stop=function(D,w){if(D||w){var N=this._scene._activeAnimatables.indexOf(this);if(N>-1){for(var F=(j=this._runtimeAnimations).length-1;F>=0;F--){var k=j[F];D&&k.animation.name!=D||w&&!w(k.target)||(k.dispose(),j.splice(F,1))}0==j.length&&(this._scene._activeAnimatables.splice(N,1),this._raiseOnAnimationEnd())}}else if((F=this._scene._activeAnimatables.indexOf(this))>-1){this._scene._activeAnimatables.splice(F,1);var j=this._runtimeAnimations;for(F=0;F<j.length;F++)j[F].dispose();this._raiseOnAnimationEnd()}},e.prototype.waitAsync=function(){var D=this;return new Promise((function(w,N){D.onAnimationEndObservable.add((function(){w(D)}),void 0,void 0,D,!0)}))},e.prototype._animate=function(D){if(this._paused)return this.animationStarted=!1,null===this._pausedDelay&&(this._pausedDelay=D),!0;if(null===this._localDelayOffset?(this._localDelayOffset=D,this._pausedDelay=null):null!==this._pausedDelay&&(this._localDelayOffset+=D-this._pausedDelay,this._pausedDelay=null),0===this._weight)return!0;var w,N=!1,F=this._runtimeAnimations;for(w=0;w<F.length;w++){var k=F[w].animate(D-this._localDelayOffset,this.fromFrame,this.toFrame,this.loopAnimation,this._speedRatio,this._weight);N=N||k}if(this.animationStarted=N,!N){if(this.disposeOnEnd)for(w=this._scene._activeAnimatables.indexOf(this),this._scene._activeAnimatables.splice(w,1),w=0;w<F.length;w++)F[w].dispose();this._raiseOnAnimationEnd(),this.disposeOnEnd&&(this.onAnimationEnd=null,this.onAnimationLoop=null,this.onAnimationLoopObservable.clear(),this.onAnimationEndObservable.clear())}return N},e}();We.a.prototype._animate=function(){if(this.animationsEnabled){var D=Xe.a.Now;if(!this._animationTimeLast){if(this._pendingData.length>0)return;this._animationTimeLast=D}this.deltaTime=this.useConstantAnimationDeltaTime?16:(D-this._animationTimeLast)*this.animationTimeScale,this._animationTimeLast=D;var w=this._activeAnimatables;if(0!==w.length){this._animationTime+=this.deltaTime;for(var N=this._animationTime,F=0;F<w.length;F++){var k=w[F];!k._animate(N)&&k.disposeOnEnd&&F--}this._processLateAnimationBindings()}}},We.a.prototype.beginWeightedAnimation=function(D,w,N,F,k,j,z,G,H,X){void 0===F&&(F=1),void 0===j&&(j=1);var q=this.beginAnimation(D,w,N,k,j,z,G,!1,H,X);return q.weight=F,q},We.a.prototype.beginAnimation=function(D,w,N,F,k,j,z,G,H,X){void 0===k&&(k=1),void 0===G&&(G=!0),w>N&&k>0&&(k*=-1),G&&this.stopAnimation(D,void 0,H),z||(z=new Je(this,D,w,N,F,k,j,void 0,X));var q=!H||H(D);if(D.animations&&q&&z.appendAnimations(D,D.animations),D.getAnimatables)for(var Z=D.getAnimatables(),J=0;J<Z.length;J++)this.beginAnimation(Z[J],w,N,F,k,j,z,G,H,X);return z.reset(),z},We.a.prototype.beginHierarchyAnimation=function(D,w,N,F,k,j,z,G,H,X,q){void 0===j&&(j=1),void 0===H&&(H=!0);var Z=D.getDescendants(w),J=[];J.push(this.beginAnimation(D,N,F,k,j,z,G,H,X));for(var $=0,te=Z;$<te.length;$++){var ie=te[$];J.push(this.beginAnimation(ie,N,F,k,j,z,G,H,X))}return J},We.a.prototype.beginDirectAnimation=function(D,w,N,F,k,j,z,G){return void 0===j&&(j=1),N>F&&j>0&&(j*=-1),new Je(this,D,N,F,k,j,z,w,G)},We.a.prototype.beginDirectHierarchyAnimation=function(D,w,N,F,k,j,z,G,H){var X=D.getDescendants(w),q=[];q.push(this.beginDirectAnimation(D,N,F,k,j,z,G,H));for(var Z=0,J=X;Z<J.length;Z++){var $=J[Z];q.push(this.beginDirectAnimation($,N,F,k,j,z,G,H))}return q},We.a.prototype.getAnimatableByTarget=function(D){for(var w=0;w<this._activeAnimatables.length;w++)if(this._activeAnimatables[w].target===D)return this._activeAnimatables[w];return null},We.a.prototype.getAllAnimatablesByTarget=function(D){for(var w=[],N=0;N<this._activeAnimatables.length;N++)this._activeAnimatables[N].target===D&&w.push(this._activeAnimatables[N]);return w},We.a.prototype.stopAnimation=function(D,w,N){for(var F=0,k=this.getAllAnimatablesByTarget(D);F<k.length;F++)k[F].stop(w,N)},We.a.prototype.stopAllAnimations=function(){if(this._activeAnimatables){for(var D=0;D<this._activeAnimatables.length;D++)this._activeAnimatables[D].stop();this._activeAnimatables=[]}for(var w=0,N=this.animationGroups;w<N.length;w++)N[w].stop()},We.a.prototype._registerTargetForLateAnimationBinding=function(D,w){var N=D.target;this._registeredForLateAnimationBindings.pushNoDuplicate(N),N._lateAnimationHolders||(N._lateAnimationHolders={}),N._lateAnimationHolders[D.targetPath]||(N._lateAnimationHolders[D.targetPath]={totalWeight:0,animations:[],originalValue:w}),N._lateAnimationHolders[D.targetPath].animations.push(D),N._lateAnimationHolders[D.targetPath].totalWeight+=D.weight},We.a.prototype._processLateAnimationBindingsForMatrices=function(D){var w=1,N=z.c.Vector3[0],F=z.c.Vector3[1],k=z.c.Quaternion[0],j=0,G=D.animations[0],H=D.originalValue,X=1;if(D.totalWeight<1)H.decompose(F,k,N),X=1-D.totalWeight;else if(j=1,w=D.totalWeight,G.currentValue.decompose(F,k,N),1==(X=G.weight/w))return G.currentValue;F.scaleInPlace(X),N.scaleInPlace(X),k.scaleInPlace(X);for(var q=j;q<D.animations.length;q++){var Z=D.animations[q],J=(X=Z.weight/w,z.c.Vector3[2]),$=z.c.Vector3[3],te=z.c.Quaternion[1];Z.currentValue.decompose($,te,J),$.scaleAndAddToRef(X,F),te.scaleAndAddToRef(X,k),J.scaleAndAddToRef(X,N)}var ie=G._animationState.workValue;return z.a.ComposeToRef(F,k,N,ie),ie},We.a.prototype._processLateAnimationBindingsForQuaternions=function(D,w){var N=D.animations[0],F=D.originalValue;if(1===D.animations.length)return z.b.SlerpToRef(F,N.currentValue,Math.min(1,D.totalWeight),w),w;var k,j,G=1;if(D.totalWeight<1){var H=1-D.totalWeight;j=[],(k=[]).push(F),j.push(H)}else{if(2===D.animations.length)return z.b.SlerpToRef(D.animations[0].currentValue,D.animations[1].currentValue,D.animations[1].weight/D.totalWeight,w),w;k=[],j=[],G=D.totalWeight}for(var X=0;X<D.animations.length;X++){var q=D.animations[X];k.push(q.currentValue),j.push(q.weight/G)}for(var Z=0,J=null,$=0;$<k.length;)J?(Z+=j[$],z.b.SlerpToRef(J,k[$],j[$]/Z,J),$++):(z.b.SlerpToRef(k[$],k[$+1],j[$+1]/(j[$]+j[$+1]),w),J=w,Z=j[$]+j[$+1],$+=2);return J},We.a.prototype._processLateAnimationBindings=function(){if(this._registeredForLateAnimationBindings.length){for(var D=0;D<this._registeredForLateAnimationBindings.length;D++){var w=this._registeredForLateAnimationBindings.data[D];for(var N in w._lateAnimationHolders){var F=w._lateAnimationHolders[N],k=F.animations[0],j=F.originalValue,G=Fe.AllowMatrixDecomposeForInterpolation&&j.m,H=w[N];if(G)H=this._processLateAnimationBindingsForMatrices(F);else if(void 0!==j.w)H=this._processLateAnimationBindingsForQuaternions(F,H||z.b.Identity());else{var X=0,q=1;if(F.totalWeight<1)H=j.scale?j.scale(1-F.totalWeight):j*(1-F.totalWeight);else{q=F.totalWeight;var Z=k.weight/q;H=1!==Z?k.currentValue.scale?k.currentValue.scale(Z):k.currentValue*Z:k.currentValue,X=1}for(var J=X;J<F.animations.length;J++){var $=F.animations[J],te=$.weight/q;$.currentValue.scaleAndAddToRef?$.currentValue.scaleAndAddToRef(te,H):H+=$.currentValue*te}}w[N]=H}w._lateAnimationHolders={}}this._registeredForLateAnimationBindings.reset()}},Ze.prototype.copyAnimationRange=function(D,w,N,F,k){void 0===F&&(F=!1),void 0===k&&(k=null),0===this.animations.length&&(this.animations.push(new Fe(this.name,"_matrix",D.animations[0].framePerSecond,Fe.ANIMATIONTYPE_MATRIX,0)),this.animations[0].setKeys([]));var j=D.animations[0].getRange(w);if(!j)return!1;for(var z,G,H,X=j.from,q=j.to,Z=D.animations[0].getKeys(),J=D.length,$=D.getParent(),te=this.getParent(),ie=F&&$&&J&&this.length&&J!==this.length,oe=ie&&te&&$?te.length/$.length:1,ce=F&&!te&&k&&(1!==k.x||1!==k.y||1!==k.z),he=this.animations[0].getKeys(),fe=0,pe=Z.length;fe<pe;fe++)(z=Z[fe]).frame>=X&&z.frame<=q&&(F?(H=z.value.clone(),ie?(G=H.getTranslation(),H.setTranslation(G.scaleInPlace(oe))):ce&&k?(G=H.getTranslation(),H.setTranslation(G.multiplyInPlace(k))):H=z.value):H=z.value,he.push({frame:z.frame+N,value:H}));return this.animations[0].createRange(w,X+N,q+N),!0};var $e,et=function(){function e(){}return e.prototype.serialize=function(){var D={};return D.animation=this.animation.serialize(),D.targetId=this.target.id,D},e}(),tt=function(){function e(D,w){void 0===w&&(w=null),this.name=D,this._targetedAnimations=new Array,this._animatables=new Array,this._from=Number.MAX_VALUE,this._to=-Number.MAX_VALUE,this._speedRatio=1,this._loopAnimation=!1,this.onAnimationEndObservable=new j.c,this.onAnimationLoopObservable=new j.c,this.onAnimationGroupLoopObservable=new j.c,this.onAnimationGroupEndObservable=new j.c,this.onAnimationGroupPauseObservable=new j.c,this.onAnimationGroupPlayObservable=new j.c,this._scene=w||Me.a.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._scene.animationGroups.push(this)}return Object.defineProperty(e.prototype,"from",{get:function(){return this._from},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"to",{get:function(){return this._to},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isStarted",{get:function(){return this._isStarted},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isPlaying",{get:function(){return this._isStarted&&!this._isPaused},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"speedRatio",{get:function(){return this._speedRatio},set:function(D){if(this._speedRatio!==D){this._speedRatio=D;for(var w=0;w<this._animatables.length;w++)this._animatables[w].speedRatio=this._speedRatio}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loopAnimation",{get:function(){return this._loopAnimation},set:function(D){if(this._loopAnimation!==D){this._loopAnimation=D;for(var w=0;w<this._animatables.length;w++)this._animatables[w].loopAnimation=this._loopAnimation}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"targetedAnimations",{get:function(){return this._targetedAnimations},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animatables",{get:function(){return this._animatables},enumerable:!0,configurable:!0}),e.prototype.addTargetedAnimation=function(D,w){var N=new et;N.animation=D,N.target=w;var F=D.getKeys();return this._from>F[0].frame&&(this._from=F[0].frame),this._to<F[F.length-1].frame&&(this._to=F[F.length-1].frame),this._targetedAnimations.push(N),N},e.prototype.normalize=function(D,w){void 0===D&&(D=null),void 0===w&&(w=null),null==D&&(D=this._from),null==w&&(w=this._to);for(var N=0;N<this._targetedAnimations.length;N++){var F=this._targetedAnimations[N].animation.getKeys(),k=F[0],j=F[F.length-1];if(k.frame>D){var z={frame:D,value:k.value,inTangent:k.inTangent,outTangent:k.outTangent,interpolation:k.interpolation};F.splice(0,0,z)}j.frame<w&&(z={frame:w,value:j.value,inTangent:j.outTangent,outTangent:j.outTangent,interpolation:j.interpolation},F.push(z))}return this._from=D,this._to=w,this},e.prototype._processLoop=function(D,w,N){var F=this;D.onAnimationLoop=function(){F.onAnimationLoopObservable.notifyObservers(w),F._animationLoopFlags[N]||(F._animationLoopFlags[N]=!0,F._animationLoopCount++,F._animationLoopCount===F._targetedAnimations.length&&(F.onAnimationGroupLoopObservable.notifyObservers(F),F._animationLoopCount=0,F._animationLoopFlags=[]))}},e.prototype.start=function(D,w,N,F){var k=this;if(void 0===D&&(D=!1),void 0===w&&(w=1),this._isStarted||0===this._targetedAnimations.length)return this;this._loopAnimation=D,this._animationLoopCount=0,this._animationLoopFlags=[];for(var o=function(){var G=j._targetedAnimations[z],H=j._scene.beginDirectAnimation(G.target,[G.animation],void 0!==N?N:j._from,void 0!==F?F:j._to,D,w);H.onAnimationEnd=function(){k.onAnimationEndObservable.notifyObservers(G),k._checkAnimationGroupEnded(H)},j._processLoop(H,G,z),j._animatables.push(H)},j=this,z=0;z<this._targetedAnimations.length;z++)o();if(this._speedRatio=w,void 0!==N&&void 0!==F)if(N<F&&this._speedRatio<0){var G=F;F=N,N=G}else N>F&&this._speedRatio>0&&(this._speedRatio=-w);return this._isStarted=!0,this._isPaused=!1,this.onAnimationGroupPlayObservable.notifyObservers(this),this},e.prototype.pause=function(){if(!this._isStarted)return this;this._isPaused=!0;for(var D=0;D<this._animatables.length;D++)this._animatables[D].pause();return this.onAnimationGroupPauseObservable.notifyObservers(this),this},e.prototype.play=function(D){return this.isStarted&&this._animatables.length===this._targetedAnimations.length?(void 0!==D&&(this.loopAnimation=D),this.restart()):(this.stop(),this.start(D,this._speedRatio)),this._isPaused=!1,this},e.prototype.reset=function(){if(!this._isStarted)return this;for(var D=0;D<this._animatables.length;D++)this._animatables[D].reset();return this},e.prototype.restart=function(){if(!this._isStarted)return this;for(var D=0;D<this._animatables.length;D++)this._animatables[D].restart();return this.onAnimationGroupPlayObservable.notifyObservers(this),this},e.prototype.stop=function(){if(!this._isStarted)return this;for(var D=this._animatables.slice(),w=0;w<D.length;w++)D[w].stop();return this._isStarted=!1,this},e.prototype.setWeightForAllAnimatables=function(D){for(var w=0;w<this._animatables.length;w++)this._animatables[w].weight=D;return this},e.prototype.syncAllAnimationsWith=function(D){for(var w=0;w<this._animatables.length;w++)this._animatables[w].syncWith(D);return this},e.prototype.goToFrame=function(D){if(!this._isStarted)return this;for(var w=0;w<this._animatables.length;w++)this._animatables[w].goToFrame(D);return this},e.prototype.dispose=function(){this._targetedAnimations=[],this._animatables=[];var D=this._scene.animationGroups.indexOf(this);D>-1&&this._scene.animationGroups.splice(D,1),this.onAnimationEndObservable.clear(),this.onAnimationGroupEndObservable.clear(),this.onAnimationGroupPauseObservable.clear(),this.onAnimationGroupPlayObservable.clear(),this.onAnimationLoopObservable.clear(),this.onAnimationGroupLoopObservable.clear()},e.prototype._checkAnimationGroupEnded=function(D){var w=this._animatables.indexOf(D);w>-1&&this._animatables.splice(w,1),0===this._animatables.length&&(this._isStarted=!1,this.onAnimationGroupEndObservable.notifyObservers(this))},e.prototype.clone=function(D,w){for(var N=new e(D||this.name,this._scene),F=0,k=this._targetedAnimations;F<k.length;F++){var j=k[F];N.addTargetedAnimation(j.animation.clone(),w?w(j.target):j.target)}return N},e.prototype.serialize=function(){var D={};D.name=this.name,D.from=this.from,D.to=this.to,D.targetedAnimations=[];for(var w=0;w<this.targetedAnimations.length;w++){var N=this.targetedAnimations[w];D.targetedAnimations[w]=N.serialize()}return D},e.Parse=function(D,w){for(var N=new e(D.name,w),F=0;F<D.targetedAnimations.length;F++){var k=D.targetedAnimations[F],j=Fe.Parse(k.animation),z=k.targetId;if("influence"===k.animation.property){var G=w.getMorphTargetById(z);G&&N.addTargetedAnimation(j,G)}else{var H=w.getNodeByID(z);null!=H&&N.addTargetedAnimation(j,H)}}return null!==D.from&&null!==D.to&&N.normalize(D.from,D.to),N},e.prototype.getClassName=function(){return"AnimationGroup"},e.prototype.toString=function(D){var w="Name: "+this.name;return w+=", type: "+this.getClassName(),D&&(w+=", from: "+this._from,w+=", to: "+this._to,w+=", isStarted: "+this._isStarted,w+=", speedRatio: "+this._speedRatio,w+=", targetedAnimations length: "+this._targetedAnimations.length,w+=", animatables length: "+this._animatables),w},e}(),ne=function(){this.enableBlending=!1,this.blendingSpeed=.01,this.loopMode=Fe.ANIMATIONLOOPMODE_CYCLE},rt=N(28);!function(D){D[D.CW=0]="CW",D[D.CCW=1]="CCW"}($e||($e={}));var ot=function(){function e(){}return e.Interpolate=function(D,w,N,F,k){for(var j=1-3*F+3*w,z=3*F-6*w,G=3*w,H=D,X=0;X<5;X++){var q=H*H;H-=1/(3*j*q+2*z*H+G)*(j*(q*H)+z*q+G*H-D),H=Math.min(1,Math.max(0,H))}return 3*Math.pow(1-H,2)*H*N+3*(1-H)*Math.pow(H,2)*k+Math.pow(H,3)},e}(),at=function(){function e(D){this._radians=D,this._radians<0&&(this._radians+=2*Math.PI)}return e.prototype.degrees=function(){return 180*this._radians/Math.PI},e.prototype.radians=function(){return this._radians},e.BetweenTwoPoints=function(D,w){var N=w.subtract(D);return new e(Math.atan2(N.y,N.x))},e.FromRadians=function(D){return new e(D)},e.FromDegrees=function(D){return new e(D*Math.PI/180)},e}(),se=function(D,w,N){this.startPoint=D,this.midPoint=w,this.endPoint=N;var F=Math.pow(w.x,2)+Math.pow(w.y,2),k=(Math.pow(D.x,2)+Math.pow(D.y,2)-F)/2,j=(F-Math.pow(N.x,2)-Math.pow(N.y,2))/2,G=(D.x-w.x)*(w.y-N.y)-(w.x-N.x)*(D.y-w.y);this.centerPoint=new z.d((k*(w.y-N.y)-j*(D.y-w.y))/G,((D.x-w.x)*j-(w.x-N.x)*k)/G),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=at.BetweenTwoPoints(this.centerPoint,this.startPoint);var H=this.startAngle.degrees(),X=at.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),q=at.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();X-H>180&&(X-=360),X-H<-180&&(X+=360),q-X>180&&(q-=360),q-X<-180&&(q+=360),this.orientation=X-H<0?$e.CW:$e.CCW,this.angle=at.FromDegrees(this.orientation===$e.CW?H-q:q-H)},st=function(){function e(D,w){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new z.d(D,w))}return e.prototype.addLineTo=function(D,w){if(this.closed)return this;var N=new z.d(D,w),F=this._points[this._points.length-1];return this._points.push(N),this._length+=N.subtract(F).length(),this},e.prototype.addArcTo=function(D,w,N,F,k){if(void 0===k&&(k=36),this.closed)return this;var j=this._points[this._points.length-1],G=new z.d(D,w),H=new z.d(N,F),X=new se(j,G,H),q=X.angle.radians()/k;X.orientation===$e.CW&&(q*=-1);for(var Z=X.startAngle.radians()+q,J=0;J<k;J++){var $=Math.cos(Z)*X.radius+X.centerPoint.x,te=Math.sin(Z)*X.radius+X.centerPoint.y;this.addLineTo($,te),Z+=q}return this},e.prototype.close=function(){return this.closed=!0,this},e.prototype.length=function(){var D=this._length;if(this.closed){var w=this._points[this._points.length-1];D+=this._points[0].subtract(w).length()}return D},e.prototype.getPoints=function(){return this._points},e.prototype.getPointAtLengthPosition=function(D){if(D<0||D>1)return z.d.Zero();for(var w=D*this.length(),N=0,F=0;F<this._points.length;F++){var k=(F+1)%this._points.length,j=this._points[F],G=this._points[k].subtract(j),H=G.length()+N;if(w>=N&&w<=H){var X=G.normalize(),q=w-N;return new z.d(j.x+X.x*q,j.y+X.y*q)}N=H}return z.d.Zero()},e.StartingAt=function(D,w){return new e(D,w)},e}(),ut=function(){function e(D,w,N,F){void 0===w&&(w=null),void 0===F&&(F=!1),this.path=D,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array,this._pointAtData={id:0,point:z.e.Zero(),previousPointArrayIndex:0,position:0,subPosition:0,interpolateReady:!1,interpolationMatrix:z.a.Identity()};for(var k=0;k<D.length;k++)this._curve[k]=D[k].clone();this._raw=N||!1,this._alignTangentsWithPath=F,this._compute(w,F)}return e.prototype.getCurve=function(){return this._curve},e.prototype.getPoints=function(){return this._curve},e.prototype.length=function(){return this._distances[this._distances.length-1]},e.prototype.getTangents=function(){return this._tangents},e.prototype.getNormals=function(){return this._normals},e.prototype.getBinormals=function(){return this._binormals},e.prototype.getDistances=function(){return this._distances},e.prototype.getPointAt=function(D){return this._updatePointAtData(D).point},e.prototype.getTangentAt=function(D,w){return void 0===w&&(w=!1),this._updatePointAtData(D,w),w?z.e.TransformCoordinates(z.e.Forward(),this._pointAtData.interpolationMatrix):this._tangents[this._pointAtData.previousPointArrayIndex]},e.prototype.getNormalAt=function(D,w){return void 0===w&&(w=!1),this._updatePointAtData(D,w),w?z.e.TransformCoordinates(z.e.Right(),this._pointAtData.interpolationMatrix):this._normals[this._pointAtData.previousPointArrayIndex]},e.prototype.getBinormalAt=function(D,w){return void 0===w&&(w=!1),this._updatePointAtData(D,w),w?z.e.TransformCoordinates(z.e.UpReadOnly,this._pointAtData.interpolationMatrix):this._binormals[this._pointAtData.previousPointArrayIndex]},e.prototype.getDistanceAt=function(D){return this.length()*D},e.prototype.getPreviousPointIndexAt=function(D){return this._updatePointAtData(D),this._pointAtData.previousPointArrayIndex},e.prototype.getSubPositionAt=function(D){return this._updatePointAtData(D),this._pointAtData.subPosition},e.prototype.getClosestPositionTo=function(D){for(var w=Number.MAX_VALUE,N=0,F=0;F<this._curve.length-1;F++){var k=this._curve[F+0],j=this._curve[F+1].subtract(k).normalize(),G=this._distances[F+1]-this._distances[F+0],H=Math.min(Math.max(z.e.Dot(j,D.subtract(k).normalize()),0)*z.e.Distance(k,D)/G,1),X=z.e.Distance(k.add(j.scale(H*G)),D);X<w&&(w=X,N=(this._distances[F+0]+G*H)/this.length())}return N},e.prototype.slice=function(D,w){if(void 0===D&&(D=0),void 0===w&&(w=1),D<0&&(D=1- -1*D%1),w<0&&(w=1- -1*w%1),D>w){var N=D;D=w,w=N}var F=this.getCurve(),k=this.getPointAt(D),j=this.getPreviousPointIndexAt(D),z=this.getPointAt(w),G=this.getPreviousPointIndexAt(w)+1,H=[];return 0!==D&&(j++,H.push(k)),H.push.apply(H,F.slice(j,G)),1===w&&1!==D||H.push(z),new e(H,this.getNormalAt(D),this._raw,this._alignTangentsWithPath)},e.prototype.update=function(D,w,N){void 0===w&&(w=null),void 0===N&&(N=!1);for(var F=0;F<D.length;F++)this._curve[F].x=D[F].x,this._curve[F].y=D[F].y,this._curve[F].z=D[F].z;return this._compute(w,N),this},e.prototype._compute=function(D,w){void 0===w&&(w=!1);var N=this._curve.length;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[N-1]=this._curve[N-1].subtract(this._curve[N-2]),this._raw||this._tangents[N-1].normalize();var F,k,j,G,H,X=this._tangents[0],q=this._normalVector(X,D);this._normals[0]=q,this._raw||this._normals[0].normalize(),this._binormals[0]=z.e.Cross(X,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(var Z=1;Z<N;Z++)F=this._getLastNonNullVector(Z),Z<N-1&&(k=this._getFirstNonNullVector(Z),this._tangents[Z]=w?k:F.add(k),this._tangents[Z].normalize()),this._distances[Z]=this._distances[Z-1]+F.length(),j=this._tangents[Z],H=this._binormals[Z-1],this._normals[Z]=z.e.Cross(H,j),this._raw||(0===this._normals[Z].length()?(G=this._normals[Z-1],this._normals[Z]=G.clone()):this._normals[Z].normalize()),this._binormals[Z]=z.e.Cross(j,this._normals[Z]),this._raw||this._binormals[Z].normalize();this._pointAtData.id=NaN},e.prototype._getFirstNonNullVector=function(D){for(var w=1,N=this._curve[D+w].subtract(this._curve[D]);0===N.length()&&D+w+1<this._curve.length;)w++,N=this._curve[D+w].subtract(this._curve[D]);return N},e.prototype._getLastNonNullVector=function(D){for(var w=1,N=this._curve[D].subtract(this._curve[D-w]);0===N.length()&&D>w+1;)w++,N=this._curve[D].subtract(this._curve[D-w]);return N},e.prototype._normalVector=function(D,w){var N,F,k=D.length();return 0===k&&(k=1),null==w?(F=De.a.WithinEpsilon(Math.abs(D.y)/k,1,rt.a)?De.a.WithinEpsilon(Math.abs(D.x)/k,1,rt.a)?De.a.WithinEpsilon(Math.abs(D.z)/k,1,rt.a)?z.e.Zero():new z.e(0,0,1):new z.e(1,0,0):new z.e(0,-1,0),N=z.e.Cross(D,F)):(N=z.e.Cross(D,w),z.e.CrossToRef(N,D,N)),N.normalize(),N},e.prototype._updatePointAtData=function(D,w){if(void 0===w&&(w=!1),this._pointAtData.id===D)return this._pointAtData.interpolateReady||this._updateInterpolationMatrix(),this._pointAtData;this._pointAtData.id=D;var N=this.getPoints();if(D<=0)return this._setPointAtData(0,0,N[0],0,w);if(D>=1)return this._setPointAtData(1,1,N[N.length-1],N.length-1,w);for(var F,k=N[0],j=0,G=D*this.length(),H=1;H<N.length;H++){F=N[H];var X=z.e.Distance(k,F);if((j+=X)===G)return this._setPointAtData(D,1,F,H,w);if(j>G){var q=(j-G)/X,Z=k.subtract(F),J=F.add(Z.scaleInPlace(q));return this._setPointAtData(D,1-q,J,H-1,w)}k=F}return this._pointAtData},e.prototype._setPointAtData=function(D,w,N,F,k){return this._pointAtData.point=N,this._pointAtData.position=D,this._pointAtData.subPosition=w,this._pointAtData.previousPointArrayIndex=F,this._pointAtData.interpolateReady=k,k&&this._updateInterpolationMatrix(),this._pointAtData},e.prototype._updateInterpolationMatrix=function(){this._pointAtData.interpolationMatrix=z.a.Identity();var D=this._pointAtData.previousPointArrayIndex;if(D!==this._tangents.length-1){var w=D+1,N=this._tangents[D].clone(),F=this._normals[D].clone(),k=this._binormals[D].clone(),j=this._tangents[w].clone(),G=this._normals[w].clone(),H=this._binormals[w].clone(),X=z.b.RotationQuaternionFromAxis(F,k,N),q=z.b.RotationQuaternionFromAxis(G,H,j);z.b.Slerp(X,q,this._pointAtData.subPosition).toRotationMatrix(this._pointAtData.interpolationMatrix)}},e}(),lt=function(){function e(D){this._length=0,this._points=D,this._length=this._computeLength(D)}return e.CreateQuadraticBezier=function(D,w,N,F){F=F>2?F:3;for(var k=new Array,s=function(D,w,N,F){return(1-D)*(1-D)*w+2*D*(1-D)*N+D*D*F},j=0;j<=F;j++)k.push(new z.e(s(j/F,D.x,w.x,N.x),s(j/F,D.y,w.y,N.y),s(j/F,D.z,w.z,N.z)));return new e(k)},e.CreateCubicBezier=function(D,w,N,F,k){k=k>3?k:4;for(var j=new Array,c=function(D,w,N,F,k){return(1-D)*(1-D)*(1-D)*w+3*D*(1-D)*(1-D)*N+3*D*D*(1-D)*F+D*D*D*k},G=0;G<=k;G++)j.push(new z.e(c(G/k,D.x,w.x,N.x,F.x),c(G/k,D.y,w.y,N.y,F.y),c(G/k,D.z,w.z,N.z,F.z)));return new e(j)},e.CreateHermiteSpline=function(D,w,N,F,k){for(var j=new Array,G=1/k,H=0;H<=k;H++)j.push(z.e.Hermite(D,w,N,F,H*G));return new e(j)},e.CreateCatmullRomSpline=function(D,w,N){var F=new Array,k=1/w,j=0;if(N){for(var G=D.length,H=0;H<G;H++){j=0;for(var X=0;X<w;X++)F.push(z.e.CatmullRom(D[H%G],D[(H+1)%G],D[(H+2)%G],D[(H+3)%G],j)),j+=k}F.push(F[0])}else{var q=new Array;for(q.push(D[0].clone()),Array.prototype.push.apply(q,D),q.push(D[D.length-1].clone()),H=0;H<q.length-3;H++)for(j=0,X=0;X<w;X++)F.push(z.e.CatmullRom(q[H],q[H+1],q[H+2],q[H+3],j)),j+=k;H--,F.push(z.e.CatmullRom(q[H],q[H+1],q[H+2],q[H+3],j))}return new e(F)},e.prototype.getPoints=function(){return this._points},e.prototype.length=function(){return this._length},e.prototype.continue=function(D){for(var w=this._points[this._points.length-1],N=this._points.slice(),F=D.getPoints(),k=1;k<F.length;k++)N.push(F[k].subtract(F[0]).add(w));return new e(N)},e.prototype._computeLength=function(D){for(var w=0,N=1;N<D.length;N++)w+=D[N].subtract(D[N-1]).length();return w},e}(),ht=function(){function e(){this._easingMode=e.EASINGMODE_EASEIN}return e.prototype.setEasingMode=function(D){var w=Math.min(Math.max(D,0),2);this._easingMode=w},e.prototype.getEasingMode=function(){return this._easingMode},e.prototype.easeInCore=function(D){throw new Error("You must implement this method")},e.prototype.ease=function(D){switch(this._easingMode){case e.EASINGMODE_EASEIN:return this.easeInCore(D);case e.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-D)}return D>=.5?.5*(1-this.easeInCore(2*(1-D)))+.5:.5*this.easeInCore(2*D)},e.EASINGMODE_EASEIN=0,e.EASINGMODE_EASEOUT=1,e.EASINGMODE_EASEINOUT=2,e}(),dt=function(D){function t(){return null!==D&&D.apply(this,arguments)||this}return Object(Z.d)(t,D),t.prototype.easeInCore=function(D){return D=Math.max(0,Math.min(1,D)),1-Math.sqrt(1-D*D)},t}(ht),ft=function(D){function t(w){void 0===w&&(w=1);var N=D.call(this)||this;return N.amplitude=w,N}return Object(Z.d)(t,D),t.prototype.easeInCore=function(D){var w=Math.max(0,this.amplitude);return Math.pow(D,3)-D*w*Math.sin(3.141592653589793*D)},t}(ht),pt=function(D){function t(w,N){void 0===w&&(w=3),void 0===N&&(N=2);var F=D.call(this)||this;return F.bounces=w,F.bounciness=N,F}return Object(Z.d)(t,D),t.prototype.easeInCore=function(D){var w=Math.max(0,this.bounces),N=this.bounciness;N<=1&&(N=1.001);var F=Math.pow(N,w),k=1-N,j=(1-F)/k+.5*F,z=D*j,G=Math.log(-z*(1-N)+1)/Math.log(N),H=Math.floor(G),X=H+1,q=(1-Math.pow(N,H))/(k*j),Z=.5*(q+(1-Math.pow(N,X))/(k*j)),J=D-Z,$=Z-q;return-Math.pow(1/N,w-H)/($*$)*(J-$)*(J+$)},t}(ht),_t=function(D){function t(){return null!==D&&D.apply(this,arguments)||this}return Object(Z.d)(t,D),t.prototype.easeInCore=function(D){return D*D*D},t}(ht),mt=function(D){function t(w,N){void 0===w&&(w=3),void 0===N&&(N=3);var F=D.call(this)||this;return F.oscillations=w,F.springiness=N,F}return Object(Z.d)(t,D),t.prototype.easeInCore=function(D){var w=Math.max(0,this.oscillations),N=Math.max(0,this.springiness);return(0==N?D:(Math.exp(N*D)-1)/(Math.exp(N)-1))*Math.sin((6.283185307179586*w+1.5707963267948966)*D)},t}(ht),gt=function(D){function t(w){void 0===w&&(w=2);var N=D.call(this)||this;return N.exponent=w,N}return Object(Z.d)(t,D),t.prototype.easeInCore=function(D){return this.exponent<=0?D:(Math.exp(this.exponent*D)-1)/(Math.exp(this.exponent)-1)},t}(ht),vt=function(D){function t(w){void 0===w&&(w=2);var N=D.call(this)||this;return N.power=w,N}return Object(Z.d)(t,D),t.prototype.easeInCore=function(D){var w=Math.max(0,this.power);return Math.pow(D,w)},t}(ht),yt=function(D){function t(){return null!==D&&D.apply(this,arguments)||this}return Object(Z.d)(t,D),t.prototype.easeInCore=function(D){return D*D},t}(ht),bt=function(D){function t(){return null!==D&&D.apply(this,arguments)||this}return Object(Z.d)(t,D),t.prototype.easeInCore=function(D){return D*D*D*D},t}(ht),Tt=function(D){function t(){return null!==D&&D.apply(this,arguments)||this}return Object(Z.d)(t,D),t.prototype.easeInCore=function(D){return D*D*D*D*D},t}(ht),Et=function(D){function t(){return null!==D&&D.apply(this,arguments)||this}return Object(Z.d)(t,D),t.prototype.easeInCore=function(D){return 1-Math.sin(1.5707963267948966*(1-D))},t}(ht),St=function(D){function t(w,N,F,k){void 0===w&&(w=0),void 0===N&&(N=0),void 0===F&&(F=1),void 0===k&&(k=1);var j=D.call(this)||this;return j.x1=w,j.y1=N,j.x2=F,j.y2=k,j}return Object(Z.d)(t,D),t.prototype.easeInCore=function(D){return ot.Interpolate(D,this.x1,this.y1,this.x2,this.y2)},t}(ht),Mt=function(){function e(D,w,N){this.frame=D,this.action=w,this.onlyOnce=N,this.isDone=!1}return e.prototype._clone=function(){return new e(this.frame,this.action,this.onlyOnce)},e}(),xt=N(5),At=function(D){function t(){return null!==D&&D.apply(this,arguments)||this}return Object(Z.d)(t,D),t}(F.a),Ce=function(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]},Pt=function(D){function t(w){var N=D.call(this)||this;return N._wasAddedToScene=!1,N.scene=w,N.sounds=[],N.effectLayers=[],N.layers=[],N.lensFlareSystems=[],N.proceduralTextures=[],N.reflectionProbes=[],w.onDisposeObservable.add((function(){N._wasAddedToScene||N.dispose()})),N}return Object(Z.d)(t,D),t.prototype.instantiateModelsToScene=function(D,w){var N=this;void 0===w&&(w=!1);var F={},k={},j=new Ce,z=[],G=[],H={doNotInstantiate:!0},l=function(w,N){if(F[w.uniqueId]=N.uniqueId,k[N.uniqueId]=N,D&&(N.name=D(w.name)),N instanceof xt.a){var j=N;if(j.morphTargetManager){var z=w.morphTargetManager;j.morphTargetManager=z.clone();for(var G=0;G<z.numTargets;G++){var H=z.getTarget(G),X=j.morphTargetManager.getTarget(G);F[H.uniqueId]=X.uniqueId,k[X.uniqueId]=X}}}};return this.transformNodes.forEach((function(D){if(!D.parent){var w=D.instantiateHierarchy(null,H,(function(D,w){l(D,w)}));w&&j.rootNodes.push(w)}})),this.meshes.forEach((function(z){if(!z.parent){var X=z.instantiateHierarchy(null,H,(function(j,z){if(l(j,z),z.material){var H=z;if(H.material)if(w){var X=j.material;if(-1===G.indexOf(X)){var q=X.clone(D?D(X.name):"Clone of "+X.name);if(G.push(X),F[X.uniqueId]=q.uniqueId,k[q.uniqueId]=q,"MultiMaterial"===X.getClassName())for(var Z=0,J=X.subMaterials;Z<J.length;Z++){var $=J[Z];$&&(q=$.clone(D?D($.name):"Clone of "+$.name),G.push($),F[$.uniqueId]=q.uniqueId,k[q.uniqueId]=q)}}H.material=k[F[X.uniqueId]]}else"MultiMaterial"===H.material.getClassName()?-1===N.scene.multiMaterials.indexOf(H.material)&&N.scene.addMultiMaterial(H.material):-1===N.scene.materials.indexOf(H.material)&&N.scene.addMaterial(H.material)}}));X&&j.rootNodes.push(X)}})),this.skeletons.forEach((function(w){var G=w.clone(D?D(w.name):"Clone of "+w.name);w.overrideMesh&&(G.overrideMesh=k[F[w.overrideMesh.uniqueId]]);for(var H=0,X=N.meshes;H<X.length;H++){var q=X[H];if(q.skeleton===w&&!q.isAnInstance){if(k[F[q.uniqueId]].skeleton=G,-1!==z.indexOf(G))continue;z.push(G);for(var Z=0,J=G.bones;Z<J.length;Z++){var $=J[Z];$._linkedTransformNode&&($._linkedTransformNode=k[F[$._linkedTransformNode.uniqueId]])}}}j.skeletons.push(G)})),this.animationGroups.forEach((function(D){var w=D.clone(D.name,(function(D){return k[F[D.uniqueId]]||D}));j.animationGroups.push(w)})),j},t.prototype.addAllToScene=function(){var D=this;this._wasAddedToScene=!0,this.cameras.forEach((function(w){D.scene.addCamera(w)})),this.lights.forEach((function(w){D.scene.addLight(w)})),this.meshes.forEach((function(w){D.scene.addMesh(w)})),this.skeletons.forEach((function(w){D.scene.addSkeleton(w)})),this.animations.forEach((function(w){D.scene.addAnimation(w)})),this.animationGroups.forEach((function(w){D.scene.addAnimationGroup(w)})),this.multiMaterials.forEach((function(w){D.scene.addMultiMaterial(w)})),this.materials.forEach((function(w){D.scene.addMaterial(w)})),this.morphTargetManagers.forEach((function(w){D.scene.addMorphTargetManager(w)})),this.geometries.forEach((function(w){D.scene.addGeometry(w)})),this.transformNodes.forEach((function(w){D.scene.addTransformNode(w)})),this.actionManagers.forEach((function(w){D.scene.addActionManager(w)})),this.textures.forEach((function(w){D.scene.addTexture(w)})),this.reflectionProbes.forEach((function(w){D.scene.addReflectionProbe(w)})),this.environmentTexture&&(this.scene.environmentTexture=this.environmentTexture);for(var w=0,N=this.scene._serializableComponents;w<N.length;w++)N[w].addFromContainer(this)},t.prototype.removeAllFromScene=function(){var D=this;this._wasAddedToScene=!1,this.cameras.forEach((function(w){D.scene.removeCamera(w)})),this.lights.forEach((function(w){D.scene.removeLight(w)})),this.meshes.forEach((function(w){D.scene.removeMesh(w)})),this.skeletons.forEach((function(w){D.scene.removeSkeleton(w)})),this.animations.forEach((function(w){D.scene.removeAnimation(w)})),this.animationGroups.forEach((function(w){D.scene.removeAnimationGroup(w)})),this.multiMaterials.forEach((function(w){D.scene.removeMultiMaterial(w)})),this.materials.forEach((function(w){D.scene.removeMaterial(w)})),this.morphTargetManagers.forEach((function(w){D.scene.removeMorphTargetManager(w)})),this.geometries.forEach((function(w){D.scene.removeGeometry(w)})),this.transformNodes.forEach((function(w){D.scene.removeTransformNode(w)})),this.actionManagers.forEach((function(w){D.scene.removeActionManager(w)})),this.textures.forEach((function(w){D.scene.removeTexture(w)})),this.reflectionProbes.forEach((function(w){D.scene.removeReflectionProbe(w)})),this.environmentTexture===this.scene.environmentTexture&&(this.scene.environmentTexture=null);for(var w=0,N=this.scene._serializableComponents;w<N.length;w++)N[w].removeFromContainer(this)},t.prototype.dispose=function(){this.cameras.forEach((function(D){D.dispose()})),this.cameras=[],this.lights.forEach((function(D){D.dispose()})),this.lights=[],this.meshes.forEach((function(D){D.dispose()})),this.meshes=[],this.skeletons.forEach((function(D){D.dispose()})),this.skeletons=[],this.animationGroups.forEach((function(D){D.dispose()})),this.animationGroups=[],this.multiMaterials.forEach((function(D){D.dispose()})),this.multiMaterials=[],this.materials.forEach((function(D){D.dispose()})),this.materials=[],this.geometries.forEach((function(D){D.dispose()})),this.geometries=[],this.transformNodes.forEach((function(D){D.dispose()})),this.transformNodes=[],this.actionManagers.forEach((function(D){D.dispose()})),this.actionManagers=[],this.textures.forEach((function(D){D.dispose()})),this.textures=[],this.reflectionProbes.forEach((function(D){D.dispose()})),this.reflectionProbes=[],this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(var D=0,w=this.scene._serializableComponents;D<w.length;D++)w[D].removeFromContainer(this,!0)},t.prototype._moveAssets=function(D,w,N){if(D)for(var F=0,k=D;F<k.length;F++){var j=k[F],z=!0;if(N)for(var G=0,H=N;G<H.length;G++)if(j===H[G]){z=!1;break}z&&w.push(j)}},t.prototype.moveAllFromScene=function(D){for(var w in this._wasAddedToScene=!1,void 0===D&&(D=new At),this)this.hasOwnProperty(w)&&(this[w]=this[w]||("environmentTexture"===w?null:[]),this._moveAssets(this.scene[w],this[w],D[w]));this.removeAllFromScene()},t.prototype.createRootMesh=function(){var D=new xt.a("assetContainerRootMesh",this.scene);return this.meshes.forEach((function(w){w.parent||D.addChild(w)})),this.meshes.unshift(D),D},t.prototype.mergeAnimationsTo=function(D,w,N){if(void 0===D&&(D=Me.a.LastCreatedScene),void 0===N&&(N=null),D){var F=N||function(w){return D.getBoneByName(w.name)||D.getNodeByName(w.name)};this.getNodes().forEach((function(D){var w=F(D);if(null!==w){for(var i=function(D){for(var N=0,F=w.animations.filter((function(w){return w.targetProperty===D.targetProperty}));N<F.length;N++){var k=F[N],j=w.animations.indexOf(k,0);j>-1&&w.animations.splice(j,1)}},N=0,k=D.animations;N<k.length;N++)i(k[N]);w.animations=w.animations.concat(D.animations)}})),this.animationGroups.slice().forEach((function(D){D.clone(D.name,F),D.animatables.forEach((function(D){D.stop()}))})),w.forEach((function(w){var N=F(w.target);N&&(D.beginAnimation(N,w.fromFrame,w.toFrame,w.loopAnimation,w.speedRatio,w.onAnimationEnd?w.onAnimationEnd:void 0,void 0,!0,void 0,w.onAnimationLoop?w.onAnimationLoop:void 0),D.stopAnimation(w.target))}))}else oe.a.Error("No scene available to merge animations to")},t}(F.a),Ct=N(11),Ot=function(){function e(D){this.SMOOTHING=.75,this.FFT_SIZE=512,this.BARGRAPHAMPLITUDE=256,this.DEBUGCANVASPOS={x:20,y:20},this.DEBUGCANVASSIZE={width:320,height:200},this._scene=D,this._audioEngine=Ct.a.audioEngine,this._audioEngine.canUseWebAudio&&this._audioEngine.audioContext&&(this._webAudioAnalyser=this._audioEngine.audioContext.createAnalyser(),this._webAudioAnalyser.minDecibels=-140,this._webAudioAnalyser.maxDecibels=0,this._byteFreqs=new Uint8Array(this._webAudioAnalyser.frequencyBinCount),this._byteTime=new Uint8Array(this._webAudioAnalyser.frequencyBinCount),this._floatFreqs=new Float32Array(this._webAudioAnalyser.frequencyBinCount))}return e.prototype.getFrequencyBinCount=function(){return this._audioEngine.canUseWebAudio?this._webAudioAnalyser.frequencyBinCount:0},e.prototype.getByteFrequencyData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getByteFrequencyData(this._byteFreqs)),this._byteFreqs},e.prototype.getByteTimeDomainData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getByteTimeDomainData(this._byteTime)),this._byteTime},e.prototype.getFloatFrequencyData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getFloatFrequencyData(this._floatFreqs)),this._floatFreqs},e.prototype.drawDebugCanvas=function(){var D=this;if(this._audioEngine.canUseWebAudio&&(this._debugCanvas||(this._debugCanvas=document.createElement("canvas"),this._debugCanvas.width=this.DEBUGCANVASSIZE.width,this._debugCanvas.height=this.DEBUGCANVASSIZE.height,this._debugCanvas.style.position="absolute",this._debugCanvas.style.top=this.DEBUGCANVASPOS.y+"px",this._debugCanvas.style.left=this.DEBUGCANVASPOS.x+"px",this._debugCanvasContext=this._debugCanvas.getContext("2d"),document.body.appendChild(this._debugCanvas),this._registerFunc=function(){D.drawDebugCanvas()},this._scene.registerBeforeRender(this._registerFunc)),this._registerFunc&&this._debugCanvasContext)){var w=this.getByteFrequencyData();this._debugCanvasContext.fillStyle="rgb(0, 0, 0)",this._debugCanvasContext.fillRect(0,0,this.DEBUGCANVASSIZE.width,this.DEBUGCANVASSIZE.height);for(var N=0;N<this.getFrequencyBinCount();N++){var F=w[N]/this.BARGRAPHAMPLITUDE,k=this.DEBUGCANVASSIZE.height*F,j=this.DEBUGCANVASSIZE.height-k-1,z=this.DEBUGCANVASSIZE.width/this.getFrequencyBinCount(),G=N/this.getFrequencyBinCount()*360;this._debugCanvasContext.fillStyle="hsl("+G+", 100%, 50%)",this._debugCanvasContext.fillRect(N*z,j,z,k)}}},e.prototype.stopDebugCanvas=function(){this._debugCanvas&&(this._registerFunc&&(this._scene.unregisterBeforeRender(this._registerFunc),this._registerFunc=null),document.body.removeChild(this._debugCanvas),this._debugCanvas=null,this._debugCanvasContext=null)},e.prototype.connectAudioNodes=function(D,w){this._audioEngine.canUseWebAudio&&(D.connect(this._webAudioAnalyser),this._webAudioAnalyser.connect(w))},e.prototype.dispose=function(){this._audioEngine.canUseWebAudio&&this._webAudioAnalyser.disconnect()},e}();Ct.a.AudioEngineFactory=function(D){return new Rt(D)};var Rt=function(){function e(D){var w=this;void 0===D&&(D=null),this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!0,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new j.c,this.onAudioLockedObservable=new j.c,this._tryToRun=!1,this._onResize=function(){w._moveButtonToTopLeft()},void 0===window.AudioContext&&void 0===window.webkitAudioContext||(window.AudioContext=window.AudioContext||window.webkitAudioContext,this.canUseWebAudio=!0);var N=document.createElement("audio");this._hostElement=D;try{N&&N.canPlayType&&N.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")&&(this.isMP3supported=!0)}catch(D){}try{N&&N.canPlayType&&N.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(D){}}return Object.defineProperty(e.prototype,"audioContext",{get:function(){return this._audioContextInitialized?this.unlocked||this._muteButton||this._displayMuteButton():this._initializeAudioContext(),this._audioContext},enumerable:!0,configurable:!0}),e.prototype.lock=function(){this._triggerSuspendedState()},e.prototype.unlock=function(){this._triggerRunningState()},e.prototype._resumeAudioContext=function(){var D;return this._audioContext.resume&&(D=this._audioContext.resume()),D||Promise.resolve()},e.prototype._initializeAudioContext=function(){try{this.canUseWebAudio&&(this._audioContext=new AudioContext,this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this.masterGain.connect(this._audioContext.destination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningState())}catch(D){this.canUseWebAudio=!1,oe.a.Error("Web Audio: "+D.message)}},e.prototype._triggerRunningState=function(){var D=this;this._tryToRun||(this._tryToRun=!0,this._resumeAudioContext().then((function(){D._tryToRun=!1,D._muteButton&&D._hideMuteButton()})).catch((function(){D._tryToRun=!1,D.unlocked=!1})),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this))},e.prototype._triggerSuspendedState=function(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()},e.prototype._displayMuteButton=function(){var D=this;if(!this.useCustomUnlockedButton&&!this._muteButton){this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";var w=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",N=document.createElement("style");N.appendChild(document.createTextNode(w)),document.getElementsByTagName("head")[0].appendChild(N),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(function(){D._triggerRunningState()}),!0),this._muteButton.addEventListener("click",(function(){D._triggerRunningState()}),!0),window.addEventListener("resize",this._onResize)}},e.prototype._moveButtonToTopLeft=function(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")},e.prototype._hideMuteButton=function(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)},e.prototype.dispose=function(){this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear()},e.prototype.getGlobalVolume=function(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1},e.prototype.setGlobalVolume=function(D){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=D)},e.prototype.connectToAnalyser=function(D){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=D,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))},e}(),Dt=N(13),It=N(19),Lt=function(){function e(D,w,N,F,k){var G=this;if(void 0===F&&(F=null),this.autoplay=!1,this.loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.spatialSound=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.onEndedObservable=new j.c,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._startOffset=0,this._position=z.e.Zero(),this._positionInEmitterSpace=!1,this._localDirection=new z.e(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=D,this._scene=N,e._SceneComponentInitialization(N),this._readyToPlayCallback=F,this._customAttenuationFunction=function(D,w,N,F,k){return w<N?D*(1-w/N):0},k&&(this.autoplay=k.autoplay||!1,this.loop=k.loop||!1,void 0!==k.volume&&(this._volume=k.volume),this.spatialSound=k.spatialSound||!1,this.maxDistance=k.maxDistance||100,this.useCustomAttenuation=k.useCustomAttenuation||!1,this.rolloffFactor=k.rolloffFactor||1,this.refDistance=k.refDistance||1,this.distanceModel=k.distanceModel||"linear",this._playbackRate=k.playbackRate||1,this._streaming=k.streaming||!1,this._length=k.length,this._offset=k.offset),Ct.a.audioEngine.canUseWebAudio&&Ct.a.audioEngine.audioContext){this._soundGain=Ct.a.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this.spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.AddSound(this);var H=!0;if(w)try{"string"==typeof w?this._urlType="String":w instanceof ArrayBuffer?this._urlType="ArrayBuffer":w instanceof MediaStream?this._urlType="MediaStream":Array.isArray(w)&&(this._urlType="Array");var X=[],q=!1;switch(this._urlType){case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Ct.a.audioEngine.audioContext.createMediaStreamSource(w),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":w.byteLength>0&&(q=!0,this._soundLoaded(w));break;case"String":X.push(w);case"Array":0===X.length&&(X=w);for(var Z=0;Z<X.length;Z++){var J=X[Z];if(q=k&&k.skipCodecCheck||-1!==J.indexOf(".mp3",J.length-4)&&Ct.a.audioEngine.isMP3supported||-1!==J.indexOf(".ogg",J.length-4)&&Ct.a.audioEngine.isOGGsupported||-1!==J.indexOf(".wav",J.length-4)||-1!==J.indexOf("blob:")){this._streaming?(this._htmlAudioElement=new Audio(J),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,Dt.b.SetCorsBehavior(J,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(function(){G._isReadyToPlay=!0,G.autoplay&&G.play(0,G._offset,G._length),G._readyToPlayCallback&&G._readyToPlayCallback()})),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(J,(function(D){G._soundLoaded(D)}),void 0,!0,!0,(function(D){D&&oe.a.Error("XHR "+D.status+" error on: "+J+"."),oe.a.Error("Sound creation aborted."),G._scene.mainSoundTrack.RemoveSound(G)}));break}}break;default:H=!1}H?q||(this._isReadyToPlay=!0,this._readyToPlayCallback&&window.setTimeout((function(){G._readyToPlayCallback&&G._readyToPlayCallback()}),1e3)):oe.a.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(D){oe.a.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.RemoveSound(this)}}else this._scene.mainSoundTrack.AddSound(this),Ct.a.audioEngine.WarnedWebAudioUnsupported||(oe.a.Error("Web Audio is not supported by your browser."),Ct.a.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&window.setTimeout((function(){G._readyToPlayCallback&&G._readyToPlayCallback()}),1e3)}return e.prototype.dispose=function(){Ct.a.audioEngine.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.RemoveSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].RemoveSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement)),this._streamingSource&&this._streamingSource.disconnect(),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null))},e.prototype.isReady=function(){return this._isReadyToPlay},e.prototype._soundLoaded=function(D){var w=this;Ct.a.audioEngine.audioContext&&Ct.a.audioEngine.audioContext.decodeAudioData(D,(function(D){w._audioBuffer=D,w._isReadyToPlay=!0,w.autoplay&&w.play(0,w._offset,w._length),w._readyToPlayCallback&&w._readyToPlayCallback()}),(function(D){oe.a.Error("Error while decoding audio data for: "+w.name+" / Error: "+D)}))},e.prototype.setAudioBuffer=function(D){Ct.a.audioEngine.canUseWebAudio&&(this._audioBuffer=D,this._isReadyToPlay=!0)},e.prototype.updateOptions=function(D){D&&(this.loop=D.loop||this.loop,this.maxDistance=D.maxDistance||this.maxDistance,this.useCustomAttenuation=D.useCustomAttenuation||this.useCustomAttenuation,this.rolloffFactor=D.rolloffFactor||this.rolloffFactor,this.refDistance=D.refDistance||this.refDistance,this.distanceModel=D.distanceModel||this.distanceModel,this._playbackRate=D.playbackRate||this._playbackRate,this._length=D.length?D.length/1e3:void 0,this._offset=D.offset?D.offset/1e3:void 0,this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate)))},e.prototype._createSpatialParameters=function(){Ct.a.audioEngine.canUseWebAudio&&Ct.a.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=Ct.a.audioEngine.audioContext.createPanner(),this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner)},e.prototype._updateSpatialParameters=function(){this.spatialSound&&this._soundPanner&&(this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel))},e.prototype.switchPanningModelToHRTF=function(){this._panningModel="HRTF",this._switchPanningModel()},e.prototype.switchPanningModelToEqualPower=function(){this._panningModel="equalpower",this._switchPanningModel()},e.prototype._switchPanningModel=function(){Ct.a.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)},e.prototype.connectToSoundTrackAudioNode=function(D){Ct.a.audioEngine.canUseWebAudio&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(D),this._isOutputConnected=!0)},e.prototype.setDirectionalCone=function(D,w,N){w<D?oe.a.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=D,this._coneOuterAngle=w,this._coneOuterGain=N,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))},Object.defineProperty(e.prototype,"directionalConeInnerAngle",{get:function(){return this._coneInnerAngle},set:function(D){if(D!=this._coneInnerAngle){if(this._coneOuterAngle<D)return void oe.a.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=D,Ct.a.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"directionalConeOuterAngle",{get:function(){return this._coneOuterAngle},set:function(D){if(D!=this._coneOuterAngle){if(D<this._coneInnerAngle)return void oe.a.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=D,Ct.a.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}},enumerable:!0,configurable:!0}),e.prototype.setPosition=function(D){this._position=D,Ct.a.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&this._soundPanner.setPosition(this._position.x,this._position.y,this._position.z)},e.prototype.setLocalDirectionToMesh=function(D){this._localDirection=D,Ct.a.audioEngine.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()},e.prototype._updateDirection=function(){if(this._connectedTransformNode&&this._soundPanner){var D=this._connectedTransformNode.getWorldMatrix(),w=z.e.TransformNormal(this._localDirection,D);w.normalize(),this._soundPanner.setOrientation(w.x,w.y,w.z)}},e.prototype.updateDistanceFromListener=function(){if(Ct.a.audioEngine.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){var D=this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,D,this.maxDistance,this.refDistance,this.rolloffFactor)}},e.prototype.setAttenuationFunction=function(D){this._customAttenuationFunction=D},e.prototype.play=function(D,w,N){var F=this;if(this._isReadyToPlay&&this._scene.audioEnabled&&Ct.a.audioEngine.audioContext)try{this._startOffset<0&&(D=-this._startOffset,this._startOffset=0);var k=D?Ct.a.audioEngine.audioContext.currentTime+D:Ct.a.audioEngine.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this.spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||this._soundPanner.setPosition(this._position.x,this._position.y,this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming)this._streamingSource||(this._streamingSource=Ct.a.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=function(){F._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource.disconnect(),this._streamingSource.connect(this._inputAudioNode),this._htmlAudioElement&&(o=function(){if(Ct.a.audioEngine.unlocked){var D=F._htmlAudioElement.play();void 0!==D&&D.catch((function(D){Ct.a.audioEngine.lock(),(F.loop||F.autoplay)&&Ct.a.audioEngine.onAudioUnlockedObservable.addOnce((function(){o()}))}))}else(F.loop||F.autoplay)&&Ct.a.audioEngine.onAudioUnlockedObservable.addOnce((function(){o()}))})();else{var o=function(){if(Ct.a.audioEngine.audioContext){N=N||F._length,w=w||F._offset,F._soundSource=Ct.a.audioEngine.audioContext.createBufferSource(),F._soundSource.buffer=F._audioBuffer,F._soundSource.connect(F._inputAudioNode),F._soundSource.loop=F.loop,void 0!==w&&(F._soundSource.loopStart=w),void 0!==N&&(F._soundSource.loopEnd=(0|w)+N),F._soundSource.playbackRate.value=F._playbackRate,F._soundSource.onended=function(){F._onended()},k=D?Ct.a.audioEngine.audioContext.currentTime+D:Ct.a.audioEngine.audioContext.currentTime;var j=F.isPaused?F._startOffset%F._soundSource.buffer.duration:w||0;F._soundSource.start(k,j,F.loop?void 0:N)}};"suspended"===Ct.a.audioEngine.audioContext.state?setTimeout((function(){"suspended"===Ct.a.audioEngine.audioContext.state?(Ct.a.audioEngine.lock(),(F.loop||F.autoplay)&&Ct.a.audioEngine.onAudioUnlockedObservable.addOnce((function(){o()}))):o()}),500):o()}this._startTime=k,this.isPlaying=!0,this.isPaused=!1}catch(D){oe.a.Error("Error while trying to play audio: "+this.name+", "+D.message)}},e.prototype._onended=function(){this.isPlaying=!1,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)},e.prototype.stop=function(D){var w=this;if(this.isPlaying)if(this._streaming)this._htmlAudioElement?(this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0)):this._streamingSource.disconnect(),this.isPlaying=!1;else if(Ct.a.audioEngine.audioContext&&this._soundSource){var N=D?Ct.a.audioEngine.audioContext.currentTime+D:Ct.a.audioEngine.audioContext.currentTime;this._soundSource.stop(N),this._soundSource.onended=function(){w.isPlaying=!1},this.isPaused||(this._startOffset=0)}},e.prototype.pause=function(){this.isPlaying&&(this.isPaused=!0,this._streaming?this._htmlAudioElement?this._htmlAudioElement.pause():this._streamingSource.disconnect():Ct.a.audioEngine.audioContext&&(this.stop(0),this._startOffset+=Ct.a.audioEngine.audioContext.currentTime-this._startTime))},e.prototype.setVolume=function(D,w){Ct.a.audioEngine.canUseWebAudio&&this._soundGain&&(w&&Ct.a.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(Ct.a.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,Ct.a.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(D,Ct.a.audioEngine.audioContext.currentTime+w)):this._soundGain.gain.value=D),this._volume=D},e.prototype.setPlaybackRate=function(D){this._playbackRate=D,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))},e.prototype.getVolume=function(){return this._volume},e.prototype.attachToMesh=function(D){var w=this;this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=D,this.spatialSound||(this.spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=function(D){return w._onRegisterAfterWorldMatrixUpdate(D)},this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)},e.prototype.detachFromMesh=function(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)},e.prototype._onRegisterAfterWorldMatrixUpdate=function(D){if(D.getBoundingInfo){var w=D;if(this._positionInEmitterSpace)w.worldMatrixFromCache.invertToRef(z.c.Matrix[0]),this.setPosition(z.c.Matrix[0].getTranslation());else{var N=w.getBoundingInfo();this.setPosition(N.boundingSphere.centerWorld)}Ct.a.audioEngine.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}},e.prototype.clone=function(){var D=this;if(this._streaming)return null;var i=function(){D._isReadyToPlay?(N._audioBuffer=D.getAudioBuffer(),N._isReadyToPlay=!0,N.autoplay&&N.play(0,D._offset,D._length)):window.setTimeout(i,300)},w={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this.spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},N=new e(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,w);return this.useCustomAttenuation&&N.setAttenuationFunction(this._customAttenuationFunction),N.setPosition(this._position),N.setPlaybackRate(this._playbackRate),i(),N},e.prototype.getAudioBuffer=function(){return this._audioBuffer},e.prototype.serialize=function(){var D={name:this.name,url:this.name,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this.spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId};return this.spatialSound&&(this._connectedTransformNode&&(D.connectedMeshId=this._connectedTransformNode.id),D.position=this._position.asArray(),D.refDistance=this.refDistance,D.distanceModel=this.distanceModel,D.isDirectional=this._isDirectional,D.localDirectionToMesh=this._localDirection.asArray(),D.coneInnerAngle=this._coneInnerAngle,D.coneOuterAngle=this._coneOuterAngle,D.coneOuterGain=this._coneOuterGain),D},e.Parse=function(D,w,N,F){var k,j=D.name;k=D.url?N+D.url:N+j;var G,H={autoplay:D.autoplay,loop:D.loop,volume:D.volume,spatialSound:D.spatialSound,maxDistance:D.maxDistance,rolloffFactor:D.rolloffFactor,refDistance:D.refDistance,distanceModel:D.distanceModel,playbackRate:D.playbackRate};if(F){var u=function(){F._isReadyToPlay?(G._audioBuffer=F.getAudioBuffer(),G._isReadyToPlay=!0,G.autoplay&&G.play(0,G._offset,G._length)):window.setTimeout(u,300)};G=new e(j,new ArrayBuffer(0),w,null,H),u()}else G=new e(j,k,w,(function(){w._removePendingData(G)}),H),w._addPendingData(G);if(D.position){var X=z.e.FromArray(D.position);G.setPosition(X)}if(D.isDirectional&&(G.setDirectionalCone(D.coneInnerAngle||360,D.coneOuterAngle||360,D.coneOuterGain||0),D.localDirectionToMesh)){var q=z.e.FromArray(D.localDirectionToMesh);G.setLocalDirectionToMesh(q)}if(D.connectedMeshId){var Z=w.getMeshByID(D.connectedMeshId);Z&&G.attachToMesh(Z)}return G},e._SceneComponentInitialization=function(D){throw It.a.WarnImport("AudioSceneComponent")},e}(),wt=function(){function e(D,w){void 0===w&&(w={}),this.id=-1,this._isInitialized=!1,this._scene=D,this.soundCollection=new Array,this._options=w,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1)}return e.prototype._initializeSoundTrackAudioGraph=function(){Ct.a.audioEngine.canUseWebAudio&&Ct.a.audioEngine.audioContext&&(this._outputAudioNode=Ct.a.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(Ct.a.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)},e.prototype.dispose=function(){if(Ct.a.audioEngine&&Ct.a.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}},e.prototype.AddSound=function(D){this._isInitialized||this._initializeSoundTrackAudioGraph(),Ct.a.audioEngine.canUseWebAudio&&this._outputAudioNode&&D.connectToSoundTrackAudioNode(this._outputAudioNode),D.soundTrackId&&(-1===D.soundTrackId?this._scene.mainSoundTrack.RemoveSound(D):this._scene.soundTracks&&this._scene.soundTracks[D.soundTrackId].RemoveSound(D)),this.soundCollection.push(D),D.soundTrackId=this.id},e.prototype.RemoveSound=function(D){var w=this.soundCollection.indexOf(D);-1!==w&&this.soundCollection.splice(w,1)},e.prototype.setVolume=function(D){Ct.a.audioEngine.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=D)},e.prototype.switchPanningModelToHRTF=function(){if(Ct.a.audioEngine.canUseWebAudio)for(var D=0;D<this.soundCollection.length;D++)this.soundCollection[D].switchPanningModelToHRTF()},e.prototype.switchPanningModelToEqualPower=function(){if(Ct.a.audioEngine.canUseWebAudio)for(var D=0;D<this.soundCollection.length;D++)this.soundCollection[D].switchPanningModelToEqualPower()},e.prototype.connectToAnalyser=function(D){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=D,Ct.a.audioEngine.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,Ct.a.audioEngine.masterGain))},e}(),Nt=N(17);F.a.AddParser(Nt.a.NAME_AUDIO,(function(D,w,N,F){var k,j=[];if(N.sounds=N.sounds||[],void 0!==D.sounds&&null!==D.sounds)for(var z=0,G=D.sounds.length;z<G;z++){var H=D.sounds[z];Ct.a.audioEngine.canUseWebAudio?(H.url||(H.url=H.name),j[H.url]?N.sounds.push(Lt.Parse(H,w,F,j[H.url])):(k=Lt.Parse(H,w,F),j[H.url]=k,N.sounds.push(k))):N.sounds.push(new Lt(H.name,null,w))}j=[]})),Object.defineProperty(We.a.prototype,"mainSoundTrack",{get:function(){var D=this._getComponent(Nt.a.NAME_AUDIO);return D||(D=new Ft(this),this._addComponent(D)),this._mainSoundTrack||(this._mainSoundTrack=new wt(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),We.a.prototype.getSoundByName=function(D){var w;for(w=0;w<this.mainSoundTrack.soundCollection.length;w++)if(this.mainSoundTrack.soundCollection[w].name===D)return this.mainSoundTrack.soundCollection[w];if(this.soundTracks)for(var N=0;N<this.soundTracks.length;N++)for(w=0;w<this.soundTracks[N].soundCollection.length;w++)if(this.soundTracks[N].soundCollection[w].name===D)return this.soundTracks[N].soundCollection[w];return null},Object.defineProperty(We.a.prototype,"audioEnabled",{get:function(){var D=this._getComponent(Nt.a.NAME_AUDIO);return D||(D=new Ft(this),this._addComponent(D)),D.audioEnabled},set:function(D){var w=this._getComponent(Nt.a.NAME_AUDIO);w||(w=new Ft(this),this._addComponent(w)),D?w.enableAudio():w.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(We.a.prototype,"headphone",{get:function(){var D=this._getComponent(Nt.a.NAME_AUDIO);return D||(D=new Ft(this),this._addComponent(D)),D.headphone},set:function(D){var w=this._getComponent(Nt.a.NAME_AUDIO);w||(w=new Ft(this),this._addComponent(w)),D?w.switchAudioModeForHeadphones():w.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(We.a.prototype,"audioListenerPositionProvider",{get:function(){var D=this._getComponent(Nt.a.NAME_AUDIO);return D||(D=new Ft(this),this._addComponent(D)),D.audioListenerPositionProvider},set:function(D){var w=this._getComponent(Nt.a.NAME_AUDIO);if(w||(w=new Ft(this),this._addComponent(w)),"function"!=typeof D)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");w.audioListenerPositionProvider=D},enumerable:!0,configurable:!0}),Object.defineProperty(We.a.prototype,"audioPositioningRefreshRate",{get:function(){var D=this._getComponent(Nt.a.NAME_AUDIO);return D||(D=new Ft(this),this._addComponent(D)),D.audioPositioningRefreshRate},set:function(D){var w=this._getComponent(Nt.a.NAME_AUDIO);w||(w=new Ft(this),this._addComponent(w)),w.audioPositioningRefreshRate=D},enumerable:!0,configurable:!0});var Ft=function(){function e(D){this.name=Nt.a.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this._audioListenerPositionProvider=null,this._cachedCameraDirection=new z.e,this._cachedCameraPosition=new z.e,this._lastCheck=0,this.scene=D,D.soundTracks=new Array,D.sounds=new Array}return Object.defineProperty(e.prototype,"audioEnabled",{get:function(){return this._audioEnabled},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"headphone",{get:function(){return this._headphone},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"audioListenerPositionProvider",{get:function(){return this._audioListenerPositionProvider},set:function(D){this._audioListenerPositionProvider=D},enumerable:!0,configurable:!0}),e.prototype.register=function(){this.scene._afterRenderStage.registerStep(Nt.a.STEP_AFTERRENDER_AUDIO,this,this._afterRender)},e.prototype.rebuild=function(){},e.prototype.serialize=function(D){if(D.sounds=[],this.scene.soundTracks)for(var w=0;w<this.scene.soundTracks.length;w++)for(var N=this.scene.soundTracks[w],F=0;F<N.soundCollection.length;F++)D.sounds.push(N.soundCollection[F].serialize())},e.prototype.addFromContainer=function(D){var w=this;D.sounds&&D.sounds.forEach((function(D){D.play(),D.autoplay=!0,w.scene.mainSoundTrack.AddSound(D)}))},e.prototype.removeFromContainer=function(D,w){var N=this;void 0===w&&(w=!1),D.sounds&&D.sounds.forEach((function(D){D.stop(),D.autoplay=!1,N.scene.mainSoundTrack.RemoveSound(D),w&&D.dispose()}))},e.prototype.dispose=function(){var D=this.scene;if(D._mainSoundTrack&&D.mainSoundTrack.dispose(),D.soundTracks)for(var w=0;w<D.soundTracks.length;w++)D.soundTracks[w].dispose()},e.prototype.disableAudio=function(){var D,w=this.scene;for(this._audioEnabled=!1,Ct.a.audioEngine&&Ct.a.audioEngine.audioContext&&Ct.a.audioEngine.audioContext.suspend(),D=0;D<w.mainSoundTrack.soundCollection.length;D++)w.mainSoundTrack.soundCollection[D].pause();if(w.soundTracks)for(D=0;D<w.soundTracks.length;D++)for(var N=0;N<w.soundTracks[D].soundCollection.length;N++)w.soundTracks[D].soundCollection[N].pause()},e.prototype.enableAudio=function(){var D,w=this.scene;for(this._audioEnabled=!0,Ct.a.audioEngine&&Ct.a.audioEngine.audioContext&&Ct.a.audioEngine.audioContext.resume(),D=0;D<w.mainSoundTrack.soundCollection.length;D++)w.mainSoundTrack.soundCollection[D].isPaused&&w.mainSoundTrack.soundCollection[D].play();if(w.soundTracks)for(D=0;D<w.soundTracks.length;D++)for(var N=0;N<w.soundTracks[D].soundCollection.length;N++)w.soundTracks[D].soundCollection[N].isPaused&&w.soundTracks[D].soundCollection[N].play()},e.prototype.switchAudioModeForHeadphones=function(){var D=this.scene;if(this._headphone=!0,D.mainSoundTrack.switchPanningModelToHRTF(),D.soundTracks)for(var w=0;w<D.soundTracks.length;w++)D.soundTracks[w].switchPanningModelToHRTF()},e.prototype.switchAudioModeForNormalSpeakers=function(){var D=this.scene;if(this._headphone=!1,D.mainSoundTrack.switchPanningModelToEqualPower(),D.soundTracks)for(var w=0;w<D.soundTracks.length;w++)D.soundTracks[w].switchPanningModelToEqualPower()},e.prototype._afterRender=function(){var D=Xe.a.Now;if(!(this._lastCheck&&D-this._lastCheck<this.audioPositioningRefreshRate)){this._lastCheck=D;var w=this.scene;if(this._audioEnabled&&w._mainSoundTrack&&w.soundTracks&&(0!==w._mainSoundTrack.soundCollection.length||1!==w.soundTracks.length)){var N=Ct.a.audioEngine;if(N.audioContext){if(this._audioListenerPositionProvider){var F=this._audioListenerPositionProvider();F.x=F.x||0,F.y=F.y||0,F.z=F.z||0,N.audioContext.listener.setPosition(F.x,F.y,F.z)}else{var k;if(k=w.activeCameras.length>0?w.activeCameras[0]:w.activeCamera){this._cachedCameraPosition.equals(k.globalPosition)||(this._cachedCameraPosition.copyFrom(k.globalPosition),N.audioContext.listener.setPosition(k.globalPosition.x,k.globalPosition.y,k.globalPosition.z)),k.rigCameras&&k.rigCameras.length>0&&(k=k.rigCameras[0]);var j=z.a.Invert(k.getViewMatrix()),G=z.e.TransformNormal(new z.e(0,0,-1),j);G.normalize(),isNaN(G.x)||isNaN(G.y)||isNaN(G.z)||this._cachedCameraDirection.equals(G)||(this._cachedCameraDirection.copyFrom(G),N.audioContext.listener.setOrientation(G.x,G.y,G.z,0,1,0))}else N.audioContext.listener.setPosition(0,0,0)}var H;for(H=0;H<w.mainSoundTrack.soundCollection.length;H++){var X=w.mainSoundTrack.soundCollection[H];X.useCustomAttenuation&&X.updateDistanceFromListener()}if(w.soundTracks)for(H=0;H<w.soundTracks.length;H++)for(var q=0;q<w.soundTracks[H].soundCollection.length;q++)(X=w.soundTracks[H].soundCollection[q]).useCustomAttenuation&&X.updateDistanceFromListener()}}}},e}();Lt._SceneComponentInitialization=function(D){var w=D._getComponent(Nt.a.NAME_AUDIO);w||(w=new Ft(D),D._addComponent(w))};var Bt=function(){function e(D,w,N){var F=this;if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],w.length!==N.length)throw new Error("Sounds length does not equal weights length");this.loop=D,this._weights=N;for(var k=0,j=0,z=N;j<z.length;j++)k+=z[j];for(var G=k>0?1/k:0,H=0;H<this._weights.length;H++)this._weights[H]*=G;this._sounds=w;for(var X=0,q=this._sounds;X<q.length;X++)q[X].onEndedObservable.add((function(){F._onended()}))}return Object.defineProperty(e.prototype,"directionalConeInnerAngle",{get:function(){return this._coneInnerAngle},set:function(D){if(D!==this._coneInnerAngle){if(this._coneOuterAngle<D)return void oe.a.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=D;for(var w=0,N=this._sounds;w<N.length;w++)N[w].directionalConeInnerAngle=D}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"directionalConeOuterAngle",{get:function(){return this._coneOuterAngle},set:function(D){if(D!==this._coneOuterAngle){if(D<this._coneInnerAngle)return void oe.a.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=D;for(var w=0,N=this._sounds;w<N.length;w++)N[w].directionalConeOuterAngle=D}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"volume",{get:function(){return this._volume},set:function(D){if(D!==this._volume)for(var w=0,N=this._sounds;w<N.length;w++)N[w].setVolume(D)},enumerable:!0,configurable:!0}),e.prototype._onended=function(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1},e.prototype.pause=function(){this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause()},e.prototype.stop=function(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()},e.prototype.play=function(D){if(!this.isPaused){this.stop();for(var w=Math.random(),N=0,F=0;F<this._weights.length;F++)if(w<=(N+=this._weights[F])){this._currentIndex=F;break}}var k=this._sounds[this._currentIndex];k.isReady()?k.play(0,this.isPaused?void 0:D):k.autoplay=!0,this.isPlaying=!0,this.isPaused=!1},e}(),kt=N(20),Ut=function(){function e(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}return Object.defineProperty(e.prototype,"name",{get:function(){return"AutoRotation"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"zoomStopsAnimation",{get:function(){return this._zoomStopsAnimation},set:function(D){this._zoomStopsAnimation=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"idleRotationSpeed",{get:function(){return this._idleRotationSpeed},set:function(D){this._idleRotationSpeed=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"idleRotationWaitTime",{get:function(){return this._idleRotationWaitTime},set:function(D){this._idleRotationWaitTime=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"idleRotationSpinupTime",{get:function(){return this._idleRotationSpinupTime},set:function(D){this._idleRotationSpinupTime=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationInProgress",{get:function(){return Math.abs(this._cameraRotationSpeed)>0},enumerable:!0,configurable:!0}),e.prototype.init=function(){},e.prototype.attach=function(D){var w=this;this._attachedCamera=D;var N=this._attachedCamera.getScene();this._onPrePointerObservableObserver=N.onPrePointerObservable.add((function(D){D.type!==kt.a.POINTERDOWN?D.type===kt.a.POINTERUP&&(w._isPointerDown=!1):w._isPointerDown=!0})),this._onAfterCheckInputsObserver=D.onAfterCheckInputsObservable.add((function(){var D=Xe.a.Now,N=0;null!=w._lastFrameTime&&(N=D-w._lastFrameTime),w._lastFrameTime=D,w._applyUserInteraction();var F=D-w._lastInteractionTime-w._idleRotationWaitTime,k=Math.max(Math.min(F/w._idleRotationSpinupTime,1),0);w._cameraRotationSpeed=w._idleRotationSpeed*k,w._attachedCamera&&(w._attachedCamera.alpha-=w._cameraRotationSpeed*(N/1e3))}))},e.prototype.detach=function(){if(this._attachedCamera){var D=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&D.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null}},e.prototype._userIsZooming=function(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset},e.prototype._shouldAnimationStopForInteraction=function(){if(!this._attachedCamera)return!1;var D=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(D=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?D:this._userIsZooming()},e.prototype._applyUserInteraction=function(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=Xe.a.Now)},e.prototype._userIsMoving=function(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)},e}(),Vt=function(){function e(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}return Object.defineProperty(e.prototype,"name",{get:function(){return"Bouncing"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"autoTransitionRange",{get:function(){return this._autoTransitionRange},set:function(D){var w=this;if(this._autoTransitionRange!==D){this._autoTransitionRange=D;var N=this._attachedCamera;N&&(D?this._onMeshTargetChangedObserver=N.onMeshTargetChangedObservable.add((function(D){if(D){D.computeWorldMatrix(!0);var N=D.getBoundingInfo().diagonalLength;w.lowerRadiusTransitionRange=.05*N,w.upperRadiusTransitionRange=.05*N}})):this._onMeshTargetChangedObserver&&N.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}},enumerable:!0,configurable:!0}),e.prototype.init=function(){},e.prototype.attach=function(D){var w=this;this._attachedCamera=D,this._onAfterCheckInputsObserver=D.onAfterCheckInputsObservable.add((function(){w._attachedCamera&&(w._isRadiusAtLimit(w._attachedCamera.lowerRadiusLimit)&&w._applyBoundRadiusAnimation(w.lowerRadiusTransitionRange),w._isRadiusAtLimit(w._attachedCamera.upperRadiusLimit)&&w._applyBoundRadiusAnimation(w.upperRadiusTransitionRange))}))},e.prototype.detach=function(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)},e.prototype._isRadiusAtLimit=function(D){return!!this._attachedCamera&&this._attachedCamera.radius===D&&!this._radiusIsAnimating},e.prototype._applyBoundRadiusAnimation=function(D){var w=this;if(this._attachedCamera){this._radiusBounceTransition||(e.EasingFunction.setEasingMode(e.EasingMode),this._radiusBounceTransition=Fe.CreateAnimation("radius",Fe.ANIMATIONTYPE_FLOAT,60,e.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;var N=Fe.TransitionTo("radius",this._attachedCamera.radius+D,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusBounceTransition,this.transitionDuration,(function(){return w._clearAnimationLocks()}));N&&this._animatables.push(N)}},e.prototype._clearAnimationLocks=function(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)},e.prototype.stopAllAnimations=function(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()},e.EasingFunction=new ft(.3),e.EasingMode=ht.EASINGMODE_EASEOUT,e}(),jt=function(){function e(){this._mode=e.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}return Object.defineProperty(e.prototype,"name",{get:function(){return"Framing"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mode",{get:function(){return this._mode},set:function(D){this._mode=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"radiusScale",{get:function(){return this._radiusScale},set:function(D){this._radiusScale=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"positionScale",{get:function(){return this._positionScale},set:function(D){this._positionScale=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"defaultElevation",{get:function(){return this._defaultElevation},set:function(D){this._defaultElevation=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"elevationReturnTime",{get:function(){return this._elevationReturnTime},set:function(D){this._elevationReturnTime=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"elevationReturnWaitTime",{get:function(){return this._elevationReturnWaitTime},set:function(D){this._elevationReturnWaitTime=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"zoomStopsAnimation",{get:function(){return this._zoomStopsAnimation},set:function(D){this._zoomStopsAnimation=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"framingTime",{get:function(){return this._framingTime},set:function(D){this._framingTime=D},enumerable:!0,configurable:!0}),e.prototype.init=function(){},e.prototype.attach=function(D){var w=this;this._attachedCamera=D;var N=this._attachedCamera.getScene();e.EasingFunction.setEasingMode(e.EasingMode),this._onPrePointerObservableObserver=N.onPrePointerObservable.add((function(D){D.type!==kt.a.POINTERDOWN?D.type===kt.a.POINTERUP&&(w._isPointerDown=!1):w._isPointerDown=!0})),this._onMeshTargetChangedObserver=D.onMeshTargetChangedObservable.add((function(D){D&&w.zoomOnMesh(D)})),this._onAfterCheckInputsObserver=D.onAfterCheckInputsObservable.add((function(){w._applyUserInteraction(),w._maintainCameraAboveGround()}))},e.prototype.detach=function(){if(this._attachedCamera){var D=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&D.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}},e.prototype.zoomOnMesh=function(D,w,N){void 0===w&&(w=!1),void 0===N&&(N=null),D.computeWorldMatrix(!0);var F=D.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(F.minimumWorld,F.maximumWorld,w,N)},e.prototype.zoomOnMeshHierarchy=function(D,w,N){void 0===w&&(w=!1),void 0===N&&(N=null),D.computeWorldMatrix(!0);var F=D.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(F.min,F.max,w,N)},e.prototype.zoomOnMeshesHierarchy=function(D,w,N){void 0===w&&(w=!1),void 0===N&&(N=null);for(var F=new z.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),k=new z.e(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),j=0;j<D.length;j++){var G=D[j].getHierarchyBoundingVectors(!0);z.e.CheckExtends(G.min,F,k),z.e.CheckExtends(G.max,F,k)}this.zoomOnBoundingInfo(F,k,w,N)},e.prototype.zoomOnBoundingInfo=function(D,w,N,F){var k,j=this;if(void 0===N&&(N=!1),void 0===F&&(F=null),this._attachedCamera){var G=D.y,H=G+(w.y-G)*this._positionScale,X=w.subtract(D).scale(.5);if(N)k=new z.e(0,H,0);else{var q=D.add(X);k=new z.e(q.x,H,q.z)}this._vectorTransition||(this._vectorTransition=Fe.CreateAnimation("target",Fe.ANIMATIONTYPE_VECTOR3,60,e.EasingFunction)),this._betaIsAnimating=!0;var Z=Fe.TransitionTo("target",k,this._attachedCamera,this._attachedCamera.getScene(),60,this._vectorTransition,this._framingTime);Z&&this._animatables.push(Z);var J=0;if(this._mode===e.FitFrustumSidesMode){var $=this._calculateLowerRadiusFromModelBoundingSphere(D,w);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=X.length()+this._attachedCamera.minZ),J=$}else this._mode===e.IgnoreBoundsSizeMode&&(J=this._calculateLowerRadiusFromModelBoundingSphere(D,w),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.minZ));if(this.autoCorrectCameraLimitsAndSensibility){var te=w.subtract(D).length();this._attachedCamera.panningSensibility=5e3/te,this._attachedCamera.wheelPrecision=100/J}this._radiusTransition||(this._radiusTransition=Fe.CreateAnimation("radius",Fe.ANIMATIONTYPE_FLOAT,60,e.EasingFunction)),(Z=Fe.TransitionTo("radius",J,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusTransition,this._framingTime,(function(){j.stopAllAnimations(),F&&F(),j._attachedCamera&&j._attachedCamera.useInputToRestoreState&&j._attachedCamera.storeState()})))&&this._animatables.push(Z)}},e.prototype._calculateLowerRadiusFromModelBoundingSphere=function(D,w){var N=w.subtract(D).length(),F=this._getFrustumSlope(),k=.5*N*this._radiusScale,j=k*Math.sqrt(1+1/(F.x*F.x)),z=k*Math.sqrt(1+1/(F.y*F.y)),G=Math.max(j,z),H=this._attachedCamera;return H?(H.lowerRadiusLimit&&this._mode===e.IgnoreBoundsSizeMode&&(G=G<H.lowerRadiusLimit?H.lowerRadiusLimit:G),H.upperRadiusLimit&&(G=G>H.upperRadiusLimit?H.upperRadiusLimit:G),G):0},e.prototype._maintainCameraAboveGround=function(){var D=this;if(!(this._elevationReturnTime<0)){var w=Xe.a.Now-this._lastInteractionTime,N=.5*Math.PI-this._defaultElevation,F=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>F&&w>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=Fe.CreateAnimation("beta",Fe.ANIMATIONTYPE_FLOAT,60,e.EasingFunction));var k=Fe.TransitionTo("beta",N,this._attachedCamera,this._attachedCamera.getScene(),60,this._betaTransition,this._elevationReturnTime,(function(){D._clearAnimationLocks(),D.stopAllAnimations()}));k&&this._animatables.push(k)}}},e.prototype._getFrustumSlope=function(){var D=this._attachedCamera;if(!D)return z.d.Zero();var w=D.getScene().getEngine().getAspectRatio(D),N=Math.tan(D.fov/2),F=N*w;return new z.d(F,N)},e.prototype._clearAnimationLocks=function(){this._betaIsAnimating=!1},e.prototype._applyUserInteraction=function(){this.isUserIsMoving&&(this._lastInteractionTime=Xe.a.Now,this.stopAllAnimations(),this._clearAnimationLocks())},e.prototype.stopAllAnimations=function(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()},Object.defineProperty(e.prototype,"isUserIsMoving",{get:function(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)},enumerable:!0,configurable:!0}),e.EasingFunction=new gt,e.EasingMode=ht.EASINGMODE_EASEINOUT,e.IgnoreBoundsSizeMode=0,e.FitFrustumSidesMode=1,e}(),je=function(D,w,N,F){void 0===w&&(w=new z.e),void 0===N&&(N=0),void 0===F&&(F=!1),this.direction=D,this.rotatedDirection=w,this.diff=N,this.ignore=F},zt=function(){function e(D){this.ui=D,this.name="AttachToBoxBehavior",this.distanceAwayFromFace=.15,this.distanceAwayFromBottomOfFace=.15,this._faceVectors=[new je(z.e.Up()),new je(z.e.Down()),new je(z.e.Left()),new je(z.e.Right()),new je(z.e.Forward()),new je(z.e.Forward().scaleInPlace(-1))],this._tmpMatrix=new z.a,this._tmpVector=new z.e,this._zeroVector=z.e.Zero(),this._lookAtTmpMatrix=new z.a}return e.prototype.init=function(){},e.prototype._closestFace=function(D){var w=this;return this._faceVectors.forEach((function(N){w._target.rotationQuaternion||(w._target.rotationQuaternion=z.b.RotationYawPitchRoll(w._target.rotation.y,w._target.rotation.x,w._target.rotation.z)),w._target.rotationQuaternion.toRotationMatrix(w._tmpMatrix),z.e.TransformCoordinatesToRef(N.direction,w._tmpMatrix,N.rotatedDirection),N.diff=z.e.GetAngleBetweenVectors(N.rotatedDirection,D,z.e.Cross(N.rotatedDirection,D))})),this._faceVectors.reduce((function(D,w){return D.ignore?w:w.ignore||D.diff<w.diff?D:w}),this._faceVectors[0])},e.prototype._lookAtToRef=function(D,w,N){void 0===w&&(w=new z.e(0,1,0)),z.a.LookAtLHToRef(this._zeroVector,D,w,this._lookAtTmpMatrix),this._lookAtTmpMatrix.invert(),z.b.FromRotationMatrixToRef(this._lookAtTmpMatrix,N)},e.prototype.attach=function(D){var w=this;this._target=D,this._scene=this._target.getScene(),this._onRenderObserver=this._scene.onBeforeRenderObservable.add((function(){if(w._scene.activeCamera){var N=w._scene.activeCamera.position;w._scene.activeCamera.devicePosition&&(N=w._scene.activeCamera.devicePosition);var F=w._closestFace(N.subtract(D.position));w._scene.activeCamera.leftCamera?w._scene.activeCamera.leftCamera.computeWorldMatrix().getRotationMatrixToRef(w._tmpMatrix):w._scene.activeCamera.computeWorldMatrix().getRotationMatrixToRef(w._tmpMatrix),z.e.TransformCoordinatesToRef(z.e.Up(),w._tmpMatrix,w._tmpVector),w._faceVectors.forEach((function(D){F.direction.x&&D.direction.x&&(D.ignore=!0),F.direction.y&&D.direction.y&&(D.ignore=!0),F.direction.z&&D.direction.z&&(D.ignore=!0)}));var k=w._closestFace(w._tmpVector);w._faceVectors.forEach((function(D){D.ignore=!1})),w.ui.position.copyFrom(D.position),F.direction.x&&(F.rotatedDirection.scaleToRef(D.scaling.x/2+w.distanceAwayFromFace,w._tmpVector),w.ui.position.addInPlace(w._tmpVector)),F.direction.y&&(F.rotatedDirection.scaleToRef(D.scaling.y/2+w.distanceAwayFromFace,w._tmpVector),w.ui.position.addInPlace(w._tmpVector)),F.direction.z&&(F.rotatedDirection.scaleToRef(D.scaling.z/2+w.distanceAwayFromFace,w._tmpVector),w.ui.position.addInPlace(w._tmpVector)),w.ui.rotationQuaternion||(w.ui.rotationQuaternion=z.b.RotationYawPitchRoll(w.ui.rotation.y,w.ui.rotation.x,w.ui.rotation.z)),F.rotatedDirection.scaleToRef(-1,w._tmpVector),w._lookAtToRef(w._tmpVector,k.rotatedDirection,w.ui.rotationQuaternion),k.direction.x&&w.ui.up.scaleToRef(w.distanceAwayFromBottomOfFace-D.scaling.x/2,w._tmpVector),k.direction.y&&w.ui.up.scaleToRef(w.distanceAwayFromBottomOfFace-D.scaling.y/2,w._tmpVector),k.direction.z&&w.ui.up.scaleToRef(w.distanceAwayFromBottomOfFace-D.scaling.z/2,w._tmpVector),w.ui.position.addInPlace(w._tmpVector)}}))},e.prototype.detach=function(){this._scene.onBeforeRenderObservable.remove(this._onRenderObserver)},e}(),Gt=function(){function e(){var D=this;this.delay=0,this.fadeInTime=300,this._millisecondsPerFrame=1e3/60,this._hovered=!1,this._hoverValue=0,this._ownerNode=null,this._update=function(){if(D._ownerNode){if(D._hoverValue+=D._hovered?D._millisecondsPerFrame:-D._millisecondsPerFrame,D._setAllVisibility(D._ownerNode,(D._hoverValue-D.delay)/D.fadeInTime),D._ownerNode.visibility>1)return D._setAllVisibility(D._ownerNode,1),void(D._hoverValue=D.fadeInTime+D.delay);if(D._ownerNode.visibility<0&&(D._setAllVisibility(D._ownerNode,0),D._hoverValue<0))return void(D._hoverValue=0);setTimeout(D._update,D._millisecondsPerFrame)}}}return Object.defineProperty(e.prototype,"name",{get:function(){return"FadeInOut"},enumerable:!0,configurable:!0}),e.prototype.init=function(){},e.prototype.attach=function(D){this._ownerNode=D,this._setAllVisibility(this._ownerNode,0)},e.prototype.detach=function(){this._ownerNode=null},e.prototype.fadeIn=function(D){this._hovered=D,this._update()},e.prototype._setAllVisibility=function(D,w){var N=this;D.visibility=w,D.getChildMeshes().forEach((function(D){N._setAllVisibility(D,w)}))},e}(),Yt=N(62),Ht=function(){function e(){this._startDistance=0,this._initialScale=new z.e(0,0,0),this._targetScale=new z.e(0,0,0),this._sceneRenderObserver=null,this._dragBehaviorA=new Yt.a({}),this._dragBehaviorA.moveAttached=!1,this._dragBehaviorB=new Yt.a({}),this._dragBehaviorB.moveAttached=!1}return Object.defineProperty(e.prototype,"name",{get:function(){return"MultiPointerScale"},enumerable:!0,configurable:!0}),e.prototype.init=function(){},e.prototype._getCurrentDistance=function(){return this._dragBehaviorA.lastDragPosition.subtract(this._dragBehaviorB.lastDragPosition).length()},e.prototype.attach=function(D){var w=this;this._ownerNode=D,this._dragBehaviorA.onDragStartObservable.add((function(N){w._dragBehaviorA.dragging&&w._dragBehaviorB.dragging&&(w._dragBehaviorA.currentDraggingPointerID==w._dragBehaviorB.currentDraggingPointerID?w._dragBehaviorA.releaseDrag():(w._initialScale.copyFrom(D.scaling),w._startDistance=w._getCurrentDistance()))})),this._dragBehaviorB.onDragStartObservable.add((function(N){w._dragBehaviorA.dragging&&w._dragBehaviorB.dragging&&(w._dragBehaviorA.currentDraggingPointerID==w._dragBehaviorB.currentDraggingPointerID?w._dragBehaviorB.releaseDrag():(w._initialScale.copyFrom(D.scaling),w._startDistance=w._getCurrentDistance()))})),[this._dragBehaviorA,this._dragBehaviorB].forEach((function(D){D.onDragObservable.add((function(){if(w._dragBehaviorA.dragging&&w._dragBehaviorB.dragging){var D=w._getCurrentDistance()/w._startDistance;w._initialScale.scaleToRef(D,w._targetScale)}}))})),D.addBehavior(this._dragBehaviorA),D.addBehavior(this._dragBehaviorB),this._sceneRenderObserver=D.getScene().onBeforeRenderObservable.add((function(){if(w._dragBehaviorA.dragging&&w._dragBehaviorB.dragging){var N=w._targetScale.subtract(D.scaling).scaleInPlace(.1);N.length()>.01&&D.scaling.addInPlace(N)}}))},e.prototype.detach=function(){var D=this;this._ownerNode.getScene().onBeforeRenderObservable.remove(this._sceneRenderObserver),[this._dragBehaviorA,this._dragBehaviorB].forEach((function(w){w.onDragStartObservable.clear(),w.onDragObservable.clear(),D._ownerNode.removeBehavior(w)}))},e}(),Wt=N(27),Xt=N(24),Kt=N(55),Qt=function(){function e(){this._sceneRenderObserver=null,this._targetPosition=new z.e(0,0,0),this._moving=!1,this._startingOrientation=new z.b,this.zDragFactor=3,this.rotateDraggedObject=!0,this.dragging=!1,this.dragDeltaRatio=.2,this.currentDraggingPointerID=-1,this.detachCameraControls=!0,this.onDragStartObservable=new j.c,this.onDragEndObservable=new j.c}return Object.defineProperty(e.prototype,"name",{get:function(){return"SixDofDrag"},enumerable:!0,configurable:!0}),e.prototype.init=function(){},Object.defineProperty(e.prototype,"_pointerCamera",{get:function(){return this._scene.cameraToUseForPointers?this._scene.cameraToUseForPointers:this._scene.activeCamera},enumerable:!0,configurable:!0}),e.prototype.attach=function(D){var w=this;this._ownerNode=D,this._scene=this._ownerNode.getScene(),e._virtualScene||(e._virtualScene=new We.a(this._scene.getEngine()),e._virtualScene.detachControl(),this._scene.getEngine().scenes.pop());var N=null,F=new z.e(0,0,0);this._virtualOriginMesh=new Wt.a("",e._virtualScene),this._virtualOriginMesh.rotationQuaternion=new z.b,this._virtualDragMesh=new Wt.a("",e._virtualScene),this._virtualDragMesh.rotationQuaternion=new z.b;var k=null;this._pointerObserver=this._scene.onPointerObservable.add((function(D,j){if(D.type==kt.a.POINTERDOWN){if(!w.dragging&&D.pickInfo&&D.pickInfo.hit&&D.pickInfo.pickedMesh&&D.pickInfo.ray&&(Z=D.pickInfo.pickedMesh,w._ownerNode==Z||Z.isDescendantOf(w._ownerNode))){w._pointerCamera&&w._pointerCamera.cameraRigMode==Xt.a.RIG_MODE_NONE&&D.pickInfo.ray.origin.copyFrom(w._pointerCamera.globalPosition),N=w._ownerNode,Kt.a._RemoveAndStorePivotPoint(N),F.copyFrom(D.pickInfo.ray.origin),w._virtualOriginMesh.position.copyFrom(D.pickInfo.ray.origin),w._virtualOriginMesh.lookAt(D.pickInfo.ray.origin.add(D.pickInfo.ray.direction)),w._virtualOriginMesh.removeChild(w._virtualDragMesh),N.computeWorldMatrix(),w._virtualDragMesh.position.copyFrom(N.absolutePosition),N.rotationQuaternion||(N.rotationQuaternion=z.b.RotationYawPitchRoll(N.rotation.y,N.rotation.x,N.rotation.z));var G=N.parent;N.setParent(null),w._virtualDragMesh.rotationQuaternion.copyFrom(N.rotationQuaternion),N.setParent(G),w._virtualOriginMesh.addChild(w._virtualDragMesh),w._targetPosition.copyFrom(w._virtualDragMesh.absolutePosition),w.dragging=!0,w.currentDraggingPointerID=D.event.pointerId,w.detachCameraControls&&w._pointerCamera&&!w._pointerCamera.leftCamera&&(w._pointerCamera.inputs.attachedElement?(k=w._pointerCamera.inputs.attachedElement,w._pointerCamera.detachControl(w._pointerCamera.inputs.attachedElement)):k=null),Kt.a._RestorePivotPoint(N),w.onDragStartObservable.notifyObservers({})}}else if(D.type==kt.a.POINTERUP)w.currentDraggingPointerID==D.event.pointerId&&(w.dragging=!1,w._moving=!1,w.currentDraggingPointerID=-1,N=null,w._virtualOriginMesh.removeChild(w._virtualDragMesh),w.detachCameraControls&&k&&w._pointerCamera&&!w._pointerCamera.leftCamera&&w._pointerCamera.attachControl(k,!0),w.onDragEndObservable.notifyObservers({}));else if(D.type==kt.a.POINTERMOVE&&w.currentDraggingPointerID==D.event.pointerId&&w.dragging&&D.pickInfo&&D.pickInfo.ray&&N){var H=w.zDragFactor;w._pointerCamera&&w._pointerCamera.cameraRigMode==Xt.a.RIG_MODE_NONE&&(D.pickInfo.ray.origin.copyFrom(w._pointerCamera.globalPosition),H=0);var X=D.pickInfo.ray.origin.subtract(F);F.copyFrom(D.pickInfo.ray.origin);var q=-z.e.Dot(X,D.pickInfo.ray.direction);w._virtualOriginMesh.addChild(w._virtualDragMesh),w._virtualDragMesh.position.z-=w._virtualDragMesh.position.z<1?q*w.zDragFactor:q*H*w._virtualDragMesh.position.z,w._virtualDragMesh.position.z<0&&(w._virtualDragMesh.position.z=0),w._virtualOriginMesh.position.copyFrom(D.pickInfo.ray.origin),w._virtualOriginMesh.lookAt(D.pickInfo.ray.origin.add(D.pickInfo.ray.direction)),w._virtualOriginMesh.removeChild(w._virtualDragMesh),w._targetPosition.copyFrom(w._virtualDragMesh.absolutePosition),N.parent&&z.e.TransformCoordinatesToRef(w._targetPosition,z.a.Invert(N.parent.getWorldMatrix()),w._targetPosition),w._moving||w._startingOrientation.copyFrom(w._virtualDragMesh.rotationQuaternion),w._moving=!0}var Z}));var j=new z.b;this._sceneRenderObserver=D.getScene().onBeforeRenderObservable.add((function(){if(w.dragging&&w._moving&&N){if(Kt.a._RemoveAndStorePivotPoint(N),N.position.addInPlace(w._targetPosition.subtract(N.position).scale(w.dragDeltaRatio)),w.rotateDraggedObject){j.copyFrom(w._startingOrientation),j.x=-j.x,j.y=-j.y,j.z=-j.z,w._virtualDragMesh.rotationQuaternion.multiplyToRef(j,j),z.b.RotationYawPitchRollToRef(j.toEulerAngles("xyz").y,0,0,j),j.multiplyToRef(w._startingOrientation,j);var D=N.parent;(!D||D.scaling&&!D.scaling.isNonUniformWithinEpsilon(.001))&&(N.setParent(null),z.b.SlerpToRef(N.rotationQuaternion,j,w.dragDeltaRatio,N.rotationQuaternion),N.setParent(D))}Kt.a._RestorePivotPoint(N)}}))},e.prototype.detach=function(){this._scene&&this._scene.onPointerObservable.remove(this._pointerObserver),this._ownerNode&&this._ownerNode.getScene().onBeforeRenderObservable.remove(this._sceneRenderObserver),this._virtualOriginMesh&&this._virtualOriginMesh.dispose(),this._virtualDragMesh&&this._virtualDragMesh.dispose(),this.onDragEndObservable.clear(),this.onDragStartObservable.clear()},e}(),qt=function(){function e(D,w,N){if(this.targetPosition=z.e.Zero(),this.poleTargetPosition=z.e.Zero(),this.poleTargetLocalOffset=z.e.Zero(),this.poleAngle=0,this.slerpAmount=1,this._bone1Quat=z.b.Identity(),this._bone1Mat=z.a.Identity(),this._bone2Ang=Math.PI,this._maxAngle=Math.PI,this._rightHandedSystem=!1,this._bendAxis=z.e.Right(),this._slerping=!1,this._adjustRoll=0,this._bone2=w,this._bone1=w.getParent(),this._bone1){this.mesh=D;var F=w.getPosition();if(w.getAbsoluteTransform().determinant()>0&&(this._rightHandedSystem=!0,this._bendAxis.x=0,this._bendAxis.y=0,this._bendAxis.z=-1,F.x>F.y&&F.x>F.z&&(this._adjustRoll=.5*Math.PI,this._bendAxis.z=1)),this._bone1.length){var k=this._bone1.getScale(),j=this._bone2.getScale();this._bone1Length=this._bone1.length*k.y*this.mesh.scaling.y,this._bone2Length=this._bone2.length*j.y*this.mesh.scaling.y}else if(this._bone1.children[0]){D.computeWorldMatrix(!0);var G=this._bone2.children[0].getAbsolutePosition(D),H=this._bone2.getAbsolutePosition(D),X=this._bone1.getAbsolutePosition(D);this._bone1Length=z.e.Distance(G,H),this._bone2Length=z.e.Distance(H,X)}this._bone1.getRotationMatrixToRef(Qe.b.WORLD,D,this._bone1Mat),this.maxAngle=Math.PI,N&&(N.targetMesh&&(this.targetMesh=N.targetMesh,this.targetMesh.computeWorldMatrix(!0)),N.poleTargetMesh?(this.poleTargetMesh=N.poleTargetMesh,this.poleTargetMesh.computeWorldMatrix(!0)):N.poleTargetBone?this.poleTargetBone=N.poleTargetBone:this._bone1.getParent()&&(this.poleTargetBone=this._bone1.getParent()),N.poleTargetLocalOffset&&this.poleTargetLocalOffset.copyFrom(N.poleTargetLocalOffset),N.poleAngle&&(this.poleAngle=N.poleAngle),N.bendAxis&&this._bendAxis.copyFrom(N.bendAxis),N.maxAngle&&(this.maxAngle=N.maxAngle),N.slerpAmount&&(this.slerpAmount=N.slerpAmount))}}return Object.defineProperty(e.prototype,"maxAngle",{get:function(){return this._maxAngle},set:function(D){this._setMaxAngle(D)},enumerable:!0,configurable:!0}),e.prototype._setMaxAngle=function(D){D<0&&(D=0),(D>Math.PI||null==D)&&(D=Math.PI),this._maxAngle=D;var w=this._bone1Length,N=this._bone2Length;this._maxReach=Math.sqrt(w*w+N*N-2*w*N*Math.cos(D))},e.prototype.update=function(){var D=this._bone1;if(D){var w=this.targetPosition,N=this.poleTargetPosition,F=e._tmpMats[0],k=e._tmpMats[1];this.targetMesh&&w.copyFrom(this.targetMesh.getAbsolutePosition()),this.poleTargetBone?this.poleTargetBone.getAbsolutePositionFromLocalToRef(this.poleTargetLocalOffset,this.mesh,N):this.poleTargetMesh&&z.e.TransformCoordinatesToRef(this.poleTargetLocalOffset,this.poleTargetMesh.getWorldMatrix(),N);var j=e._tmpVecs[0],G=e._tmpVecs[1],H=e._tmpVecs[2],X=e._tmpVecs[3],q=e._tmpVecs[4],Z=e._tmpQuat;D.getAbsolutePositionToRef(this.mesh,j),N.subtractToRef(j,q),0==q.x&&0==q.y&&0==q.z?q.y=1:q.normalize(),w.subtractToRef(j,X),X.normalize(),z.e.CrossToRef(X,q,G),G.normalize(),z.e.CrossToRef(X,G,H),H.normalize(),z.a.FromXYZAxesToRef(H,X,G,F);var J=this._bone1Length,$=this._bone2Length,te=z.e.Distance(j,w);this._maxReach>0&&(te=Math.min(this._maxReach,te));var ie=($*$+te*te-J*J)/(2*$*te),oe=(te*te+J*J-$*$)/(2*te*J);ie>1&&(ie=1),oe>1&&(oe=1),ie<-1&&(ie=-1),oe<-1&&(oe=-1);var ce=Math.acos(ie),he=Math.acos(oe),fe=-ce-he;if(this._rightHandedSystem)z.a.RotationYawPitchRollToRef(0,0,this._adjustRoll,k),k.multiplyToRef(F,F),z.a.RotationAxisToRef(this._bendAxis,he,k),k.multiplyToRef(F,F);else{var pe=e._tmpVecs[5];pe.copyFrom(this._bendAxis),pe.x*=-1,z.a.RotationAxisToRef(pe,-he,k),k.multiplyToRef(F,F)}this.poleAngle&&(z.a.RotationAxisToRef(X,this.poleAngle,k),F.multiplyToRef(k,F)),this._bone1&&(this.slerpAmount<1?(this._slerping||z.b.FromRotationMatrixToRef(this._bone1Mat,this._bone1Quat),z.b.FromRotationMatrixToRef(F,Z),z.b.SlerpToRef(this._bone1Quat,Z,this.slerpAmount,this._bone1Quat),fe=this._bone2Ang*(1-this.slerpAmount)+fe*this.slerpAmount,this._bone1.setRotationQuaternion(this._bone1Quat,Qe.b.WORLD,this.mesh),this._slerping=!0):(this._bone1.setRotationMatrix(F,Qe.b.WORLD,this.mesh),this._bone1Mat.copyFrom(F),this._slerping=!1)),this._bone2.setAxisAngle(this._bendAxis,fe,Qe.b.LOCAL),this._bone2Ang=fe}},e._tmpVecs=[z.e.Zero(),z.e.Zero(),z.e.Zero(),z.e.Zero(),z.e.Zero(),z.e.Zero()],e._tmpQuat=z.b.Identity(),e._tmpMats=[z.a.Identity(),z.a.Identity()],e}(),Zt=function(){function e(D,w,N,F){if(this.upAxis=z.e.Up(),this.upAxisSpace=Qe.b.LOCAL,this.adjustYaw=0,this.adjustPitch=0,this.adjustRoll=0,this.slerpAmount=1,this._boneQuat=z.b.Identity(),this._slerping=!1,this._firstFrameSkipped=!1,this._fowardAxis=z.e.Forward(),this.mesh=D,this.bone=w,this.target=N,F&&(F.adjustYaw&&(this.adjustYaw=F.adjustYaw),F.adjustPitch&&(this.adjustPitch=F.adjustPitch),F.adjustRoll&&(this.adjustRoll=F.adjustRoll),null!=F.maxYaw?this.maxYaw=F.maxYaw:this.maxYaw=Math.PI,null!=F.minYaw?this.minYaw=F.minYaw:this.minYaw=-Math.PI,null!=F.maxPitch?this.maxPitch=F.maxPitch:this.maxPitch=Math.PI,null!=F.minPitch?this.minPitch=F.minPitch:this.minPitch=-Math.PI,null!=F.slerpAmount&&(this.slerpAmount=F.slerpAmount),null!=F.upAxis&&(this.upAxis=F.upAxis),null!=F.upAxisSpace&&(this.upAxisSpace=F.upAxisSpace),null!=F.yawAxis||null!=F.pitchAxis)){var k=Qe.a.Y,j=Qe.a.X;null!=F.yawAxis&&(k=F.yawAxis.clone()).normalize(),null!=F.pitchAxis&&(j=F.pitchAxis.clone()).normalize();var G=z.e.Cross(j,k);this._transformYawPitch=z.a.Identity(),z.a.FromXYZAxesToRef(j,k,G,this._transformYawPitch),this._transformYawPitchInv=this._transformYawPitch.clone(),this._transformYawPitch.invert()}w.getParent()||this.upAxisSpace!=Qe.b.BONE||(this.upAxisSpace=Qe.b.LOCAL)}return Object.defineProperty(e.prototype,"minYaw",{get:function(){return this._minYaw},set:function(D){this._minYaw=D,this._minYawSin=Math.sin(D),this._minYawCos=Math.cos(D),null!=this._maxYaw&&(this._midYawConstraint=.5*this._getAngleDiff(this._minYaw,this._maxYaw)+this._minYaw,this._yawRange=this._maxYaw-this._minYaw)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxYaw",{get:function(){return this._maxYaw},set:function(D){this._maxYaw=D,this._maxYawSin=Math.sin(D),this._maxYawCos=Math.cos(D),null!=this._minYaw&&(this._midYawConstraint=.5*this._getAngleDiff(this._minYaw,this._maxYaw)+this._minYaw,this._yawRange=this._maxYaw-this._minYaw)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minPitch",{get:function(){return this._minPitch},set:function(D){this._minPitch=D,this._minPitchTan=Math.tan(D)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxPitch",{get:function(){return this._maxPitch},set:function(D){this._maxPitch=D,this._maxPitchTan=Math.tan(D)},enumerable:!0,configurable:!0}),e.prototype.update=function(){if(this.slerpAmount<1&&!this._firstFrameSkipped)this._firstFrameSkipped=!0;else{var D=this.bone,w=e._tmpVecs[0];D.getAbsolutePositionToRef(this.mesh,w);var N=this.target,F=e._tmpMats[0],k=e._tmpMats[1],j=this.mesh,G=D.getParent(),H=e._tmpVecs[1];H.copyFrom(this.upAxis),this.upAxisSpace==Qe.b.BONE&&G?(this._transformYawPitch&&z.e.TransformCoordinatesToRef(H,this._transformYawPitchInv,H),G.getDirectionToRef(H,this.mesh,H)):this.upAxisSpace==Qe.b.LOCAL&&(j.getDirectionToRef(H,H),1==j.scaling.x&&1==j.scaling.y&&1==j.scaling.z||H.normalize());var X=!1,q=!1;if(this._maxYaw==Math.PI&&this._minYaw==-Math.PI||(X=!0),this._maxPitch==Math.PI&&this._minPitch==-Math.PI||(q=!0),X||q){var Z=e._tmpMats[2],J=e._tmpMats[3];if(this.upAxisSpace==Qe.b.BONE&&1==H.y&&G)G.getRotationMatrixToRef(Qe.b.WORLD,this.mesh,Z);else if(this.upAxisSpace!=Qe.b.LOCAL||1!=H.y||G){(te=e._tmpVecs[2]).copyFrom(this._fowardAxis),this._transformYawPitch&&z.e.TransformCoordinatesToRef(te,this._transformYawPitchInv,te),G?G.getDirectionToRef(te,this.mesh,te):j.getDirectionToRef(te,te);var $=z.e.Cross(H,te);$.normalize();var te=z.e.Cross($,H);z.a.FromXYZAxesToRef($,H,te,Z)}else Z.copyFrom(j.getWorldMatrix());Z.invertToRef(J);var ie=null;if(q){var oe=e._tmpVecs[3];N.subtractToRef(w,oe),z.e.TransformCoordinatesToRef(oe,J,oe),ie=Math.sqrt(oe.x*oe.x+oe.z*oe.z);var ce=Math.atan2(oe.y,ie),he=ce;ce>this._maxPitch?(oe.y=this._maxPitchTan*ie,he=this._maxPitch):ce<this._minPitch&&(oe.y=this._minPitchTan*ie,he=this._minPitch),ce!=he&&(z.e.TransformCoordinatesToRef(oe,Z,oe),oe.addInPlace(w),N=oe)}if(X){oe=e._tmpVecs[4],N.subtractToRef(w,oe),z.e.TransformCoordinatesToRef(oe,J,oe);var fe=Math.atan2(oe.x,oe.z),pe=fe;if((fe>this._maxYaw||fe<this._minYaw)&&(null==ie&&(ie=Math.sqrt(oe.x*oe.x+oe.z*oe.z)),this._yawRange>Math.PI?this._isAngleBetween(fe,this._maxYaw,this._midYawConstraint)?(oe.z=this._maxYawCos*ie,oe.x=this._maxYawSin*ie,pe=this._maxYaw):this._isAngleBetween(fe,this._midYawConstraint,this._minYaw)&&(oe.z=this._minYawCos*ie,oe.x=this._minYawSin*ie,pe=this._minYaw):fe>this._maxYaw?(oe.z=this._maxYawCos*ie,oe.x=this._maxYawSin*ie,pe=this._maxYaw):fe<this._minYaw&&(oe.z=this._minYawCos*ie,oe.x=this._minYawSin*ie,pe=this._minYaw)),this._slerping&&this._yawRange>Math.PI){var _e=e._tmpVecs[8];_e.copyFrom(Qe.a.Z),this._transformYawPitch&&z.e.TransformCoordinatesToRef(_e,this._transformYawPitchInv,_e);var ve=e._tmpMats[4];this._boneQuat.toRotationMatrix(ve),this.mesh.getWorldMatrix().multiplyToRef(ve,ve),z.e.TransformCoordinatesToRef(_e,ve,_e),z.e.TransformCoordinatesToRef(_e,J,_e);var ye=Math.atan2(_e.x,_e.z);if(this._getAngleBetween(ye,fe)>this._getAngleBetween(ye,this._midYawConstraint)){null==ie&&(ie=Math.sqrt(oe.x*oe.x+oe.z*oe.z));var be=this._getAngleBetween(ye,this._maxYaw);this._getAngleBetween(ye,this._minYaw)<be?(pe=ye+.75*Math.PI,oe.z=Math.cos(pe)*ie,oe.x=Math.sin(pe)*ie):(pe=ye-.75*Math.PI,oe.z=Math.cos(pe)*ie,oe.x=Math.sin(pe)*ie)}}fe!=pe&&(z.e.TransformCoordinatesToRef(oe,Z,oe),oe.addInPlace(w),N=oe)}}var Te=e._tmpVecs[5],Ee=e._tmpVecs[6],Se=e._tmpVecs[7],Me=e._tmpQuat;N.subtractToRef(w,Te),Te.normalize(),z.e.CrossToRef(H,Te,Ee),Ee.normalize(),z.e.CrossToRef(Te,Ee,Se),Se.normalize(),z.a.FromXYZAxesToRef(Ee,Se,Te,F),0===Ee.x&&0===Ee.y&&0===Ee.z||0===Se.x&&0===Se.y&&0===Se.z||0===Te.x&&0===Te.y&&0===Te.z||((this.adjustYaw||this.adjustPitch||this.adjustRoll)&&(z.a.RotationYawPitchRollToRef(this.adjustYaw,this.adjustPitch,this.adjustRoll,k),k.multiplyToRef(F,F)),this.slerpAmount<1?(this._slerping||this.bone.getRotationQuaternionToRef(Qe.b.WORLD,this.mesh,this._boneQuat),this._transformYawPitch&&this._transformYawPitch.multiplyToRef(F,F),z.b.FromRotationMatrixToRef(F,Me),z.b.SlerpToRef(this._boneQuat,Me,this.slerpAmount,this._boneQuat),this.bone.setRotationQuaternion(this._boneQuat,Qe.b.WORLD,this.mesh),this._slerping=!0):(this._transformYawPitch&&this._transformYawPitch.multiplyToRef(F,F),this.bone.setRotationMatrix(F,Qe.b.WORLD,this.mesh),this._slerping=!1))}},e.prototype._getAngleDiff=function(D,w){var N=w-D;return(N%=2*Math.PI)>Math.PI?N-=2*Math.PI:N<-Math.PI&&(N+=2*Math.PI),N},e.prototype._getAngleBetween=function(D,w){var N=0;return(N=(D=(D%=2*Math.PI)<0?D+2*Math.PI:D)<(w=(w%=2*Math.PI)<0?w+2*Math.PI:w)?w-D:D-w)>Math.PI&&(N=2*Math.PI-N),N},e.prototype._isAngleBetween=function(D,w,N){if(D=(D%=2*Math.PI)<0?D+2*Math.PI:D,(w=(w%=2*Math.PI)<0?w+2*Math.PI:w)<(N=(N%=2*Math.PI)<0?N+2*Math.PI:N)){if(D>w&&D<N)return!0}else if(D>N&&D<w)return!0;return!1},e._tmpVecs=Ke.a.BuildArray(10,z.e.Zero),e._tmpQuat=z.b.Identity(),e._tmpMats=Ke.a.BuildArray(5,z.a.Identity),e}(),Jt=N(9),$t=N(25);function it(D){return function(w,N,F,k,j,z,G,H,X,q){void 0===X&&(X=null),void 0===q&&(q=ce.a.TEXTURETYPE_UNSIGNED_INT);var Z=D?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,J=D?$t.b.Raw3D:$t.b.Raw2DArray,$=new $t.a(this,J);$.baseWidth=N,$.baseHeight=F,$.baseDepth=k,$.width=N,$.height=F,$.depth=k,$.format=j,$.type=q,$.generateMipMaps=z,$.samplingMode=H,D?$.is3D=!0:$.is2DArray=!0,this._doNotHandleContextLost||($._bufferView=w),D?this.updateRawTexture3D($,w,j,G,X,q):this.updateRawTexture2DArray($,w,j,G,X,q),this._bindTextureDirectly(Z,$,!0);var te=this._getSamplingParameters(H,z);return this._gl.texParameteri(Z,this._gl.TEXTURE_MAG_FILTER,te.mag),this._gl.texParameteri(Z,this._gl.TEXTURE_MIN_FILTER,te.min),z&&this._gl.generateMipmap(Z),this._bindTextureDirectly(Z,null),this._internalTexturesCache.push($),$}}function nt(D){return function(w,N,F,k,j,z){void 0===j&&(j=null),void 0===z&&(z=ce.a.TEXTURETYPE_UNSIGNED_INT);var G=D?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,H=this._getWebGLTextureType(z),X=this._getInternalFormat(F),q=this._getRGBABufferInternalSizedFormat(z,F);this._bindTextureDirectly(G,w,!0),this._unpackFlipY(void 0===k||!!k),this._doNotHandleContextLost||(w._bufferView=N,w.format=F,w.invertY=k,w._compression=j),w.width%4!=0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),j&&N?this._gl.compressedTexImage3D(G,0,this.getCaps().s3tc[j],w.width,w.height,w.depth,0,N):this._gl.texImage3D(G,0,q,w.width,w.height,w.depth,0,X,H,N),w.generateMipMaps&&this._gl.generateMipmap(G),this._bindTextureDirectly(G,null),w.isReady=!0}}Ct.a.prototype.updateRawTexture=function(D,w,N,F,k,j){if(void 0===k&&(k=null),void 0===j&&(j=ce.a.TEXTURETYPE_UNSIGNED_INT),D){var z=this._getRGBABufferInternalSizedFormat(j,N),G=this._getInternalFormat(N),H=this._getWebGLTextureType(j);this._bindTextureDirectly(this._gl.TEXTURE_2D,D,!0),this._unpackFlipY(void 0===F||!!F),this._doNotHandleContextLost||(D._bufferView=w,D.format=N,D.type=j,D.invertY=F,D._compression=k),D.width%4!=0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),k&&w?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[k],D.width,D.height,0,w):this._gl.texImage2D(this._gl.TEXTURE_2D,0,z,D.width,D.height,0,G,H,w),D.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),D.isReady=!0}},Ct.a.prototype.createRawTexture=function(D,w,N,F,k,j,z,G,H){void 0===G&&(G=null),void 0===H&&(H=ce.a.TEXTURETYPE_UNSIGNED_INT);var X=new $t.a(this,$t.b.Raw);X.baseWidth=w,X.baseHeight=N,X.width=w,X.height=N,X.format=F,X.generateMipMaps=k,X.samplingMode=z,X.invertY=j,X._compression=G,X.type=H,this._doNotHandleContextLost||(X._bufferView=D),this.updateRawTexture(X,D,F,j,G,H),this._bindTextureDirectly(this._gl.TEXTURE_2D,X,!0);var q=this._getSamplingParameters(z,k);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,q.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,q.min),k&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(X),X},Ct.a.prototype.createRawCubeTexture=function(D,w,N,F,k,j,z,G){void 0===G&&(G=null);var H=this._gl,X=new $t.a(this,$t.b.CubeRaw);X.isCube=!0,X.format=N,X.type=F,this._doNotHandleContextLost||(X._bufferViewArray=D);var q=this._getWebGLTextureType(F),Z=this._getInternalFormat(N);Z===H.RGB&&(Z=H.RGBA),q!==H.FLOAT||this._caps.textureFloatLinearFiltering?q!==this._gl.HALF_FLOAT_OES||this._caps.textureHalfFloatLinearFiltering?q!==H.FLOAT||this._caps.textureFloatRender?q!==H.HALF_FLOAT||this._caps.colorBufferFloat||(k=!1,oe.a.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")):(k=!1,oe.a.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):(k=!1,z=ce.a.TEXTURE_NEAREST_SAMPLINGMODE,oe.a.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):(k=!1,z=ce.a.TEXTURE_NEAREST_SAMPLINGMODE,oe.a.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively."));var J=w,$=J;X.width=J,X.height=$,!this.needPOTTextures||Dt.b.IsExponentOfTwo(X.width)&&Dt.b.IsExponentOfTwo(X.height)||(k=!1),D&&this.updateRawCubeTexture(X,D,N,F,j,G),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,X,!0),D&&k&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);var te=this._getSamplingParameters(z,k);return H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_MAG_FILTER,te.mag),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_MIN_FILTER,te.min),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_WRAP_S,H.CLAMP_TO_EDGE),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_WRAP_T,H.CLAMP_TO_EDGE),this._bindTextureDirectly(H.TEXTURE_CUBE_MAP,null),X.generateMipMaps=k,X},Ct.a.prototype.updateRawCubeTexture=function(D,w,N,F,k,j,z){void 0===j&&(j=null),void 0===z&&(z=0),D._bufferViewArray=w,D.format=N,D.type=F,D.invertY=k,D._compression=j;var G=this._gl,H=this._getWebGLTextureType(F),X=this._getInternalFormat(N),q=this._getRGBABufferInternalSizedFormat(F),Z=!1;X===G.RGB&&(X=G.RGBA,Z=!0),this._bindTextureDirectly(G.TEXTURE_CUBE_MAP,D,!0),this._unpackFlipY(void 0===k||!!k),D.width%4!=0&&G.pixelStorei(G.UNPACK_ALIGNMENT,1);for(var J=0;J<6;J++){var $=w[J];j?G.compressedTexImage2D(G.TEXTURE_CUBE_MAP_POSITIVE_X+J,z,this.getCaps().s3tc[j],D.width,D.height,0,$):(Z&&($=this._convertRGBtoRGBATextureData($,D.width,D.height,F)),G.texImage2D(G.TEXTURE_CUBE_MAP_POSITIVE_X+J,z,q,D.width,D.height,0,X,H,$))}(!this.needPOTTextures||Dt.b.IsExponentOfTwo(D.width)&&Dt.b.IsExponentOfTwo(D.height))&&D.generateMipMaps&&0===z&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),D.isReady=!0},Ct.a.prototype.createRawCubeTextureFromUrl=function(D,w,N,F,k,j,z,G,H,X,q,Z){var J=this;void 0===H&&(H=null),void 0===X&&(X=null),void 0===q&&(q=ce.a.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===Z&&(Z=!1);var $=this._gl,te=this.createRawCubeTexture(null,N,F,k,!j,Z,q,null);return w._addPendingData(te),te.url=D,this._internalTexturesCache.push(te),this._loadFile(D,(function(D){!function(D){var N=te.width,j=z(D);if(j){if(G){var X=J._getWebGLTextureType(k),q=J._getInternalFormat(F),ie=J._getRGBABufferInternalSizedFormat(k),oe=!1;q===$.RGB&&(q=$.RGBA,oe=!0),J._bindTextureDirectly($.TEXTURE_CUBE_MAP,te,!0),J._unpackFlipY(!1);for(var ce=G(j),he=0;he<ce.length;he++)for(var fe=N>>he,pe=0;pe<6;pe++){var _e=ce[he][pe];oe&&(_e=J._convertRGBtoRGBATextureData(_e,fe,fe,k)),$.texImage2D(pe,he,ie,fe,fe,0,q,X,_e)}J._bindTextureDirectly($.TEXTURE_CUBE_MAP,null)}else J.updateRawCubeTexture(te,j,F,k,Z);te.isReady=!0,w._removePendingData(te),H&&H()}}(D)}),void 0,w.offlineProvider,!0,(function(D,N){w._removePendingData(te),X&&D&&X(D.status+" "+D.statusText,N)})),te},Ct.a.prototype.createRawTexture2DArray=it(!1),Ct.a.prototype.createRawTexture3D=it(!0),Ct.a.prototype.updateRawTexture2DArray=nt(!1),Ct.a.prototype.updateRawTexture3D=nt(!0);var en=function(D){function t(w,N,F,k,j,z,G,H,X){void 0===z&&(z=!0),void 0===G&&(G=!1),void 0===H&&(H=ce.a.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===X&&(X=ce.a.TEXTURETYPE_UNSIGNED_INT);var q=D.call(this,null,j,!z,G)||this;return q.format=k,q._engine=j.getEngine(),q._texture=j.getEngine().createRawTexture(w,N,F,k,z,G,H,null,X),q.wrapU=Jt.a.CLAMP_ADDRESSMODE,q.wrapV=Jt.a.CLAMP_ADDRESSMODE,q}return Object(Z.d)(t,D),t.prototype.update=function(D){this._engine.updateRawTexture(this._texture,D,this._texture.format,this._texture.invertY,null,this._texture.type)},t.CreateLuminanceTexture=function(D,w,N,F,k,j,z){return void 0===k&&(k=!0),void 0===j&&(j=!1),void 0===z&&(z=ce.a.TEXTURE_TRILINEAR_SAMPLINGMODE),new t(D,w,N,ce.a.TEXTUREFORMAT_LUMINANCE,F,k,j,z)},t.CreateLuminanceAlphaTexture=function(D,w,N,F,k,j,z){return void 0===k&&(k=!0),void 0===j&&(j=!1),void 0===z&&(z=ce.a.TEXTURE_TRILINEAR_SAMPLINGMODE),new t(D,w,N,ce.a.TEXTUREFORMAT_LUMINANCE_ALPHA,F,k,j,z)},t.CreateAlphaTexture=function(D,w,N,F,k,j,z){return void 0===k&&(k=!0),void 0===j&&(j=!1),void 0===z&&(z=ce.a.TEXTURE_TRILINEAR_SAMPLINGMODE),new t(D,w,N,ce.a.TEXTUREFORMAT_ALPHA,F,k,j,z)},t.CreateRGBTexture=function(D,w,N,F,k,j,z,G){return void 0===k&&(k=!0),void 0===j&&(j=!1),void 0===z&&(z=ce.a.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===G&&(G=ce.a.TEXTURETYPE_UNSIGNED_INT),new t(D,w,N,ce.a.TEXTUREFORMAT_RGB,F,k,j,z,G)},t.CreateRGBATexture=function(D,w,N,F,k,j,z,G){return void 0===k&&(k=!0),void 0===j&&(j=!1),void 0===z&&(z=ce.a.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===G&&(G=ce.a.TEXTURETYPE_UNSIGNED_INT),new t(D,w,N,ce.a.TEXTUREFORMAT_RGBA,F,k,j,z,G)},t.CreateRTexture=function(D,w,N,F,k,j,z,G){return void 0===k&&(k=!0),void 0===j&&(j=!1),void 0===z&&(z=Jt.a.TRILINEAR_SAMPLINGMODE),void 0===G&&(G=ce.a.TEXTURETYPE_FLOAT),new t(D,w,N,ce.a.TEXTUREFORMAT_R,F,k,j,z,G)},t}(Jt.a),tn=function(){function e(D,w,N){this.name=D,this.id=w,this.bones=new Array,this.needInitialSkinMatrix=!1,this.overrideMesh=null,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=z.a.Identity(),this._ranges={},this._lastAbsoluteTransformsUpdateId=-1,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new j.c,this.bones=[],this._scene=N||Me.a.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;var F=this._scene.getEngine().getCaps();this._canUseTextureForBones=F.textureFloat&&F.maxVertexTextureImageUnits>0}return Object.defineProperty(e.prototype,"useTextureToStoreBoneMatrices",{get:function(){return this._useTextureToStoreBoneMatrices},set:function(D){this._useTextureToStoreBoneMatrices=D,this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride},set:function(D){this._animationPropertiesOverride=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isUsingTextureForMatrices",{get:function(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!0,configurable:!0}),e.prototype.getClassName=function(){return"Skeleton"},e.prototype.getChildren=function(){return this.bones.filter((function(D){return!D.getParent()}))},e.prototype.getTransformMatrices=function(D){return this.needInitialSkinMatrix&&D._bonesTransformMatrices?D._bonesTransformMatrices:(this._transformMatrices||this.prepare(),this._transformMatrices)},e.prototype.getTransformMatrixTexture=function(D){return this.needInitialSkinMatrix&&D._transformMatrixTexture?D._transformMatrixTexture:this._transformMatrixTexture},e.prototype.getScene=function(){return this._scene},e.prototype.toString=function(D){var w="Name: "+this.name+", nBones: "+this.bones.length;if(w+=", nAnimationRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),D){w+=", Ranges: {";var N=!0;for(var F in this._ranges)N&&(w+=", ",N=!1),w+=F;w+="}"}return w},e.prototype.getBoneIndexByName=function(D){for(var w=0,N=this.bones.length;w<N;w++)if(this.bones[w].name===D)return w;return-1},e.prototype.createAnimationRange=function(D,w,N){if(!this._ranges[D]){this._ranges[D]=new Le(D,w,N);for(var F=0,k=this.bones.length;F<k;F++)this.bones[F].animations[0]&&this.bones[F].animations[0].createRange(D,w,N)}},e.prototype.deleteAnimationRange=function(D,w){void 0===w&&(w=!0);for(var N=0,F=this.bones.length;N<F;N++)this.bones[N].animations[0]&&this.bones[N].animations[0].deleteRange(D,w);this._ranges[D]=null},e.prototype.getAnimationRange=function(D){return this._ranges[D]},e.prototype.getAnimationRanges=function(){var D,w=[];for(D in this._ranges)w.push(this._ranges[D]);return w},e.prototype.copyAnimationRange=function(D,w,N){if(void 0===N&&(N=!1),this._ranges[w]||!D.getAnimationRange(w))return!1;var F,k,j=!0,z=this._getHighestAnimationFrame()+1,G={},H=D.bones;for(k=0,F=H.length;k<F;k++)G[H[k].name]=H[k];this.bones.length!==H.length&&(oe.a.Warn("copyAnimationRange: this rig has "+this.bones.length+" bones, while source as "+H.length),j=!1);var X=N&&this.dimensionsAtRest&&D.dimensionsAtRest?this.dimensionsAtRest.divide(D.dimensionsAtRest):null;for(k=0,F=this.bones.length;k<F;k++){var q=this.bones[k].name,Z=G[q];Z?j=j&&this.bones[k].copyAnimationRange(Z,w,z,N,X):(oe.a.Warn("copyAnimationRange: not same rig, missing source bone "+q),j=!1)}var J=D.getAnimationRange(w);return J&&(this._ranges[w]=new Le(w,J.from+z,J.to+z)),j},e.prototype.returnToRest=function(){for(var D=0;D<this.bones.length;D++)this.bones[D].returnToRest()},e.prototype._getHighestAnimationFrame=function(){for(var D=0,w=0,N=this.bones.length;w<N;w++)if(this.bones[w].animations[0]){var F=this.bones[w].animations[0].getHighestFrame();D<F&&(D=F)}return D},e.prototype.beginAnimation=function(D,w,N,F){var k=this.getAnimationRange(D);return k?this._scene.beginAnimation(this,k.from,k.to,w,N,F):null},e.prototype._markAsDirty=function(){this._isDirty=!0},e.prototype._registerMeshWithPoseMatrix=function(D){this._meshesWithPoseMatrix.push(D)},e.prototype._unregisterMeshWithPoseMatrix=function(D){var w=this._meshesWithPoseMatrix.indexOf(D);w>-1&&this._meshesWithPoseMatrix.splice(w,1)},e.prototype._computeTransformMatrices=function(D,w){this.onBeforeComputeObservable.notifyObservers(this);for(var N=0;N<this.bones.length;N++){var F=this.bones[N];F._childUpdateId++;var k=F.getParent();if(k?F.getLocalMatrix().multiplyToRef(k.getWorldMatrix(),F.getWorldMatrix()):w?F.getLocalMatrix().multiplyToRef(w,F.getWorldMatrix()):F.getWorldMatrix().copyFrom(F.getLocalMatrix()),-1!==F._index){var j=null===F._index?N:F._index;F.getInvertedAbsoluteTransform().multiplyToArray(F.getWorldMatrix(),D,16*j)}}this._identity.copyToArray(D,16*this.bones.length)},e.prototype.prepare=function(){if(this._numBonesWithLinkedTransformNode>0)for(var D=0,w=this.bones;D<w.length;D++){var N=w[D];N._linkedTransformNode&&(N._linkedTransformNode.computeWorldMatrix(),N._matrix=N._linkedTransformNode._localMatrix,N.markAsDirty())}if(this._isDirty){if(this.needInitialSkinMatrix)for(var F=0;F<this._meshesWithPoseMatrix.length;F++){var k=this._meshesWithPoseMatrix[F],j=k.getPoseMatrix();if(k._bonesTransformMatrices&&k._bonesTransformMatrices.length===16*(this.bones.length+1)||(k._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1))),this._synchronizedWithMesh!==k){this._synchronizedWithMesh=k;for(var G=0;G<this.bones.length;G++){var H=this.bones[G];H.getParent()||(H.getBaseMatrix().multiplyToRef(j,z.c.Matrix[1]),H._updateDifferenceMatrix(z.c.Matrix[1]))}if(this.isUsingTextureForMatrices){var X=4*(this.bones.length+1);k._transformMatrixTexture&&k._transformMatrixTexture.getSize().width===X||(k._transformMatrixTexture&&k._transformMatrixTexture.dispose(),k._transformMatrixTexture=en.CreateRGBATexture(k._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,ce.a.TEXTURE_NEAREST_SAMPLINGMODE,ce.a.TEXTURETYPE_FLOAT))}}this._computeTransformMatrices(k._bonesTransformMatrices,j),this.isUsingTextureForMatrices&&k._transformMatrixTexture&&k._transformMatrixTexture.update(k._bonesTransformMatrices)}else this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=en.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,ce.a.TEXTURE_NEAREST_SAMPLINGMODE,ce.a.TEXTURETYPE_FLOAT))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices);this._isDirty=!1,this._scene._activeBones.addCount(this.bones.length,!1)}},e.prototype.getAnimatables=function(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(var D=0;D<this.bones.length;D++)this._animatables.push(this.bones[D])}return this._animatables},e.prototype.clone=function(D,w){var N=new e(D,w||D,this._scene);N.needInitialSkinMatrix=this.needInitialSkinMatrix,N.overrideMesh=this.overrideMesh;for(var F=0;F<this.bones.length;F++){var k=this.bones[F],j=null,z=k.getParent();if(z){var G=this.bones.indexOf(z);j=N.bones[G]}var H=new Ze(k.name,N,j,k.getBaseMatrix().clone(),k.getRestPose().clone());H._index=k._index,k._linkedTransformNode&&H.linkTransformNode(k._linkedTransformNode),xe.a.DeepCopy(k.animations,H.animations)}if(this._ranges)for(var X in N._ranges={},this._ranges){var q=this._ranges[X];q&&(N._ranges[X]=q.clone())}return this._isDirty=!0,N},e.prototype.enableBlending=function(D){void 0===D&&(D=.01),this.bones.forEach((function(w){w.animations.forEach((function(w){w.enableBlending=!0,w.blendingSpeed=D}))}))},e.prototype.dispose=function(){this._meshesWithPoseMatrix=[],this.getScene().stopAnimation(this),this.getScene().removeSkeleton(this),this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)},e.prototype.serialize=function(){var D={};D.name=this.name,D.id=this.id,this.dimensionsAtRest&&(D.dimensionsAtRest=this.dimensionsAtRest.asArray()),D.bones=[],D.needInitialSkinMatrix=this.needInitialSkinMatrix;for(var w=0;w<this.bones.length;w++){var N=this.bones[w],F=N.getParent(),k={parentBoneIndex:F?this.bones.indexOf(F):-1,name:N.name,matrix:N.getBaseMatrix().toArray(),rest:N.getRestPose().toArray()};for(var j in D.bones.push(k),N.length&&(k.length=N.length),N.metadata&&(k.metadata=N.metadata),N.animations&&N.animations.length>0&&(k.animation=N.animations[0].serialize()),D.ranges=[],this._ranges){var z=this._ranges[j];if(z){var G={};G.name=j,G.from=z.from,G.to=z.to,D.ranges.push(G)}}}return D},e.Parse=function(D,w){var N,F=new e(D.name,D.id,w);for(D.dimensionsAtRest&&(F.dimensionsAtRest=z.e.FromArray(D.dimensionsAtRest)),F.needInitialSkinMatrix=D.needInitialSkinMatrix,N=0;N<D.bones.length;N++){var k=D.bones[N],j=null;k.parentBoneIndex>-1&&(j=F.bones[k.parentBoneIndex]);var G=k.rest?z.a.FromArray(k.rest):null,H=new Ze(k.name,F,j,z.a.FromArray(k.matrix),G);void 0!==k.id&&null!==k.id&&(H.id=k.id),k.length&&(H.length=k.length),k.metadata&&(H.metadata=k.metadata),k.animation&&H.animations.push(Fe.Parse(k.animation)),void 0!==k.linkedTransformNodeId&&null!==k.linkedTransformNodeId&&(F._hasWaitingData=!0,H._waitingTransformNodeId=k.linkedTransformNodeId)}if(D.ranges)for(N=0;N<D.ranges.length;N++){var X=D.ranges[N];F.createAnimationRange(X.name,X.from,X.to)}return F},e.prototype.computeAbsoluteTransforms=function(D){void 0===D&&(D=!1);var w=this._scene.getRenderId();(this._lastAbsoluteTransformsUpdateId!=w||D)&&(this.bones[0].computeAbsoluteTransforms(),this._lastAbsoluteTransformsUpdateId=w)},e.prototype.getPoseMatrix=function(){var D=null;return this._meshesWithPoseMatrix.length>0&&(D=this._meshesWithPoseMatrix[0].getPoseMatrix()),D},e.prototype.sortBones=function(){for(var D=new Array,w=new Array(this.bones.length),N=0;N<this.bones.length;N++)this._sortBones(N,D,w);this.bones=D},e.prototype._sortBones=function(D,w,N){if(!N[D]){N[D]=!0;var F=this.bones[D];void 0===F._index&&(F._index=D);var k=F.getParent();k&&this._sortBones(this.bones.indexOf(k),w,N),w.push(F)}},e}(),nn={},rn=function(){function e(D){this.attached={},this.camera=D,this.checkInputs=function(){}}return e.prototype.add=function(D){var w=D.getSimpleName();this.attached[w]?oe.a.Warn("camera input of type "+w+" already exists on camera"):(this.attached[w]=D,D.camera=this.camera,D.checkInputs&&(this.checkInputs=this._addCheckInputs(D.checkInputs.bind(D))),this.attachedElement&&D.attachControl(this.attachedElement))},e.prototype.remove=function(D){for(var w in this.attached){var N=this.attached[w];N===D&&(N.detachControl(this.attachedElement),N.camera=null,delete this.attached[w],this.rebuildInputCheck())}},e.prototype.removeByType=function(D){for(var w in this.attached){var N=this.attached[w];N.getClassName()===D&&(N.detachControl(this.attachedElement),N.camera=null,delete this.attached[w],this.rebuildInputCheck())}},e.prototype._addCheckInputs=function(D){var w=this.checkInputs;return function(){w(),D()}},e.prototype.attachInput=function(D){this.attachedElement&&D.attachControl(this.attachedElement,this.noPreventDefault)},e.prototype.attachElement=function(D,w){if(void 0===w&&(w=!1),!this.attachedElement)for(var N in w=!Xt.a.ForceAttachControlToAlwaysPreventDefault&&w,this.attachedElement=D,this.noPreventDefault=w,this.attached)this.attached[N].attachControl(D,w)},e.prototype.detachElement=function(D,w){if(void 0===w&&(w=!1),this.attachedElement===D){for(var N in this.attached)this.attached[N].detachControl(D),w&&(this.attached[N].camera=null);this.attachedElement=null}},e.prototype.rebuildInputCheck=function(){for(var D in this.checkInputs=function(){},this.attached){var w=this.attached[D];w.checkInputs&&(this.checkInputs=this._addCheckInputs(w.checkInputs.bind(w)))}},e.prototype.clear=function(){this.attachedElement&&this.detachElement(this.attachedElement,!0),this.attached={},this.attachedElement=null,this.checkInputs=function(){}},e.prototype.serialize=function(D){var w={};for(var N in this.attached){var F=this.attached[N],k=Ie.a.Serialize(F);w[F.getClassName()]=k}D.inputsmgr=w},e.prototype.parse=function(D){var w=D.inputsmgr;if(w){for(var N in this.clear(),w)if(j=nn[N]){var F=w[N],k=Ie.a.Parse((function(){return new j}),F,null);this.add(k)}}else for(var N in this.attached){var j;(j=nn[this.attached[N].getClassName()])&&(k=Ie.a.Parse((function(){return new j}),D,null),this.remove(this.attached[N]),this.add(k))}},e}(),ct=function(D,w){this.x=D,this.y=w},on=function(){function e(D,w,N,F,k,j,z){void 0===F&&(F=0),void 0===k&&(k=1),void 0===j&&(j=2),void 0===z&&(z=3),this.id=D,this.index=w,this.browserGamepad=N,this._leftStick={x:0,y:0},this._rightStick={x:0,y:0},this._isConnected=!0,this._invertLeftStickY=!1,this.type=e.GAMEPAD,this._leftStickAxisX=F,this._leftStickAxisY=k,this._rightStickAxisX=j,this._rightStickAxisY=z,this.browserGamepad.axes.length>=2&&(this._leftStick={x:this.browserGamepad.axes[this._leftStickAxisX],y:this.browserGamepad.axes[this._leftStickAxisY]}),this.browserGamepad.axes.length>=4&&(this._rightStick={x:this.browserGamepad.axes[this._rightStickAxisX],y:this.browserGamepad.axes[this._rightStickAxisY]})}return Object.defineProperty(e.prototype,"isConnected",{get:function(){return this._isConnected},enumerable:!0,configurable:!0}),e.prototype.onleftstickchanged=function(D){this._onleftstickchanged=D},e.prototype.onrightstickchanged=function(D){this._onrightstickchanged=D},Object.defineProperty(e.prototype,"leftStick",{get:function(){return this._leftStick},set:function(D){!this._onleftstickchanged||this._leftStick.x===D.x&&this._leftStick.y===D.y||this._onleftstickchanged(D),this._leftStick=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightStick",{get:function(){return this._rightStick},set:function(D){!this._onrightstickchanged||this._rightStick.x===D.x&&this._rightStick.y===D.y||this._onrightstickchanged(D),this._rightStick=D},enumerable:!0,configurable:!0}),e.prototype.update=function(){this._leftStick&&(this.leftStick={x:this.browserGamepad.axes[this._leftStickAxisX],y:this.browserGamepad.axes[this._leftStickAxisY]},this._invertLeftStickY&&(this.leftStick.y*=-1)),this._rightStick&&(this.rightStick={x:this.browserGamepad.axes[this._rightStickAxisX],y:this.browserGamepad.axes[this._rightStickAxisY]})},e.prototype.dispose=function(){},e.GAMEPAD=0,e.GENERIC=1,e.XBOX=2,e.POSE_ENABLED=3,e.DUALSHOCK=4,e}(),an=function(D){function t(w,N,F){var k=D.call(this,w,N,F)||this;return k.onButtonDownObservable=new j.c,k.onButtonUpObservable=new j.c,k.type=on.GENERIC,k._buttons=new Array(F.buttons.length),k}return Object(Z.d)(t,D),t.prototype.onbuttondown=function(D){this._onbuttondown=D},t.prototype.onbuttonup=function(D){this._onbuttonup=D},t.prototype._setButtonValue=function(D,w,N){return D!==w&&(1===D&&(this._onbuttondown&&this._onbuttondown(N),this.onButtonDownObservable.notifyObservers(N)),0===D&&(this._onbuttonup&&this._onbuttonup(N),this.onButtonUpObservable.notifyObservers(N))),D},t.prototype.update=function(){D.prototype.update.call(this);for(var w=0;w<this._buttons.length;w++)this._buttons[w]=this._setButtonValue(this.browserGamepad.buttons[w].value,this._buttons[w],w)},t.prototype.dispose=function(){D.prototype.dispose.call(this),this.onButtonDownObservable.clear(),this.onButtonUpObservable.clear()},t}(on),sn=function(){function e(){this.gamepadRotationSensibility=80,this.gamepadMoveSensibility=40,this._yAxisScale=1}return Object.defineProperty(e.prototype,"invertYAxis",{get:function(){return 1!==this._yAxisScale},set:function(D){this._yAxisScale=D?-1:1},enumerable:!0,configurable:!0}),e.prototype.attachControl=function(D,w){var N=this,F=this.camera.getScene().gamepadManager;this._onGamepadConnectedObserver=F.onGamepadConnectedObservable.add((function(D){D.type!==on.POSE_ENABLED&&(N.gamepad&&D.type!==on.XBOX||(N.gamepad=D))})),this._onGamepadDisconnectedObserver=F.onGamepadDisconnectedObservable.add((function(D){N.gamepad===D&&(N.gamepad=null)})),this.gamepad=F.getGamepadByType(on.XBOX)},e.prototype.detachControl=function(D){this.camera.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.camera.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),this.gamepad=null},e.prototype.checkInputs=function(){if(this.gamepad){var D=this.camera,w=this.gamepad.rightStick;if(w){if(0!=w.x){var N=w.x/this.gamepadRotationSensibility;0!=N&&Math.abs(N)>.005&&(D.inertialAlphaOffset+=N)}if(0!=w.y){var F=w.y/this.gamepadRotationSensibility*this._yAxisScale;0!=F&&Math.abs(F)>.005&&(D.inertialBetaOffset+=F)}}var k=this.gamepad.leftStick;if(k&&0!=k.y){var j=k.y/this.gamepadMoveSensibility;0!=j&&Math.abs(j)>.005&&(this.camera.inertialRadiusOffset-=j)}}},e.prototype.getClassName=function(){return"ArcRotateCameraGamepadInput"},e.prototype.getSimpleName=function(){return"gamepad"},Object(Z.c)([Object(Ie.c)()],e.prototype,"gamepadRotationSensibility",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"gamepadMoveSensibility",void 0),e}();nn.ArcRotateCameraGamepadInput=sn;var cn=N(63),un=function(){function e(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}return e.prototype.attachControl=function(D,w){var N=this;this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((function(){N._keys=[]})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((function(D){var F,k=D.event;k.metaKey||(D.type===cn.a.KEYDOWN?(N._ctrlPressed=k.ctrlKey,N._altPressed=k.altKey,(-1!==N.keysUp.indexOf(k.keyCode)||-1!==N.keysDown.indexOf(k.keyCode)||-1!==N.keysLeft.indexOf(k.keyCode)||-1!==N.keysRight.indexOf(k.keyCode)||-1!==N.keysReset.indexOf(k.keyCode))&&(-1===(F=N._keys.indexOf(k.keyCode))&&N._keys.push(k.keyCode),k.preventDefault&&(w||k.preventDefault()))):-1===N.keysUp.indexOf(k.keyCode)&&-1===N.keysDown.indexOf(k.keyCode)&&-1===N.keysLeft.indexOf(k.keyCode)&&-1===N.keysRight.indexOf(k.keyCode)&&-1===N.keysReset.indexOf(k.keyCode)||((F=N._keys.indexOf(k.keyCode))>=0&&N._keys.splice(F,1),k.preventDefault&&(w||k.preventDefault())))})))},e.prototype.detachControl=function(D){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},e.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var D=this.camera,w=0;w<this._keys.length;w++){var N=this._keys[w];-1!==this.keysLeft.indexOf(N)?this._ctrlPressed&&this.camera._useCtrlForPanning?D.inertialPanningX-=1/this.panningSensibility:D.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(N)?this._ctrlPressed&&this.camera._useCtrlForPanning?D.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?D.inertialRadiusOffset+=1/this.zoomingSensibility:D.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(N)?this._ctrlPressed&&this.camera._useCtrlForPanning?D.inertialPanningX+=1/this.panningSensibility:D.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(N)?this._ctrlPressed&&this.camera._useCtrlForPanning?D.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?D.inertialRadiusOffset-=1/this.zoomingSensibility:D.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(N)&&D.useInputToRestoreState&&D.restoreState()}},e.prototype.getClassName=function(){return"ArcRotateCameraKeyboardMoveInput"},e.prototype.getSimpleName=function(){return"keyboard"},Object(Z.c)([Object(Ie.c)()],e.prototype,"keysUp",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"keysDown",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"keysLeft",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"keysRight",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"keysReset",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"panningSensibility",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"zoomingSensibility",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"useAltToZoom",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"angularSpeed",void 0),e}();nn.ArcRotateCameraKeyboardMoveInput=un;var ln=function(){function e(){this.wheelPrecision=3,this.wheelDeltaPercentage=0}return e.prototype.computeDeltaFromMouseWheelLegacyEvent=function(D,w){var N=.01*D*this.wheelDeltaPercentage*w;return D>0?N/(1+this.wheelDeltaPercentage):N*(1+this.wheelDeltaPercentage)},e.prototype.attachControl=function(D,w){var N=this;this._wheel=function(D,F){if(D.type===kt.a.POINTERWHEEL){var k,j=D.event,z=0,G=j;if(k=G.wheelDelta?G.wheelDelta:60*-(j.deltaY||j.detail),N.wheelDeltaPercentage){if((z=N.computeDeltaFromMouseWheelLegacyEvent(k,N.camera.radius))>0){for(var H=N.camera.radius,X=N.camera.inertialRadiusOffset+z,q=0;q<20&&Math.abs(X)>.001;q++)H-=X,X*=N.camera.inertia;H=De.a.Clamp(H,0,Number.MAX_VALUE),z=N.computeDeltaFromMouseWheelLegacyEvent(k,H)}}else z=k/(40*N.wheelPrecision);z&&(N.camera.inertialRadiusOffset+=z),j.preventDefault&&(w||j.preventDefault())}},this._observer=this.camera.getScene().onPointerObservable.add(this._wheel,kt.a.POINTERWHEEL)},e.prototype.detachControl=function(D){this._observer&&D&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._wheel=null)},e.prototype.getClassName=function(){return"ArcRotateCameraMouseWheelInput"},e.prototype.getSimpleName=function(){return"mousewheel"},Object(Z.c)([Object(Ie.c)()],e.prototype,"wheelPrecision",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"wheelDeltaPercentage",void 0),e}();nn.ArcRotateCameraMouseWheelInput=ln;var hn=function(){function e(){this.buttons=[0,1,2]}return e.prototype.attachControl=function(D,w){var N=this,F=this.camera.getEngine(),k=0,j=null;this.pointA=null,this.pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=function(z,G){var H=z.event,X="touch"===H.pointerType;if(!F.isInVRExclusivePointerMode&&(z.type===kt.a.POINTERMOVE||-1!==N.buttons.indexOf(H.button))){var q=H.srcElement||H.target;if(N._altKey=H.altKey,N._ctrlKey=H.ctrlKey,N._metaKey=H.metaKey,N._shiftKey=H.shiftKey,N._buttonsPressed=H.buttons,F.isPointerLock){var Z=H.movementX||H.mozMovementX||H.webkitMovementX||H.msMovementX||0,J=H.movementY||H.mozMovementY||H.webkitMovementY||H.msMovementY||0;N.onTouch(null,Z,J),N.pointA=null,N.pointB=null}else if(z.type===kt.a.POINTERDOWN&&q){try{q.setPointerCapture(H.pointerId)}catch(D){}null===N.pointA?N.pointA={x:H.clientX,y:H.clientY,pointerId:H.pointerId,type:H.pointerType}:null===N.pointB&&(N.pointB={x:H.clientX,y:H.clientY,pointerId:H.pointerId,type:H.pointerType}),N.onButtonDown(H),w||(H.preventDefault(),D.focus())}else if(z.type===kt.a.POINTERDOUBLETAP)N.onDoubleTap(H.pointerType);else if(z.type===kt.a.POINTERUP&&q){try{q.releasePointerCapture(H.pointerId)}catch(D){}X||(N.pointB=null),F._badOS?N.pointA=N.pointB=null:N.pointB&&N.pointA&&N.pointA.pointerId==H.pointerId?(N.pointA=N.pointB,N.pointB=null):N.pointA&&N.pointB&&N.pointB.pointerId==H.pointerId?N.pointB=null:N.pointA=N.pointB=null,(0!==k||j)&&(N.onMultiTouch(N.pointA,N.pointB,k,0,j,null),k=0,j=null),N.onButtonUp(H),w||H.preventDefault()}else if(z.type===kt.a.POINTERMOVE)if(w||H.preventDefault(),N.pointA&&null===N.pointB)Z=H.clientX-N.pointA.x,J=H.clientY-N.pointA.y,N.onTouch(N.pointA,Z,J),N.pointA.x=H.clientX,N.pointA.y=H.clientY;else if(N.pointA&&N.pointB){var $=N.pointA.pointerId===H.pointerId?N.pointA:N.pointB;$.x=H.clientX,$.y=H.clientY;var te=N.pointA.x-N.pointB.x,ie=N.pointA.y-N.pointB.y,oe=te*te+ie*ie,ce={x:(N.pointA.x+N.pointB.x)/2,y:(N.pointA.y+N.pointB.y)/2,pointerId:H.pointerId,type:z.type};N.onMultiTouch(N.pointA,N.pointB,k,oe,j,ce),j=ce,k=oe}}},this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,kt.a.POINTERDOWN|kt.a.POINTERUP|kt.a.POINTERMOVE),this._onLostFocus=function(){N.pointA=N.pointB=null,k=0,j=null,N.onLostFocus()},D.addEventListener("contextmenu",this.onContextMenu.bind(this),!1);var z=this.camera.getScene().getEngine().getHostWindow();z&&Dt.b.RegisterTopRootEvents(z,[{name:"blur",handler:this._onLostFocus}])},e.prototype.detachControl=function(D){if(this._onLostFocus){var w=this.camera.getScene().getEngine().getHostWindow();w&&Dt.b.UnregisterTopRootEvents(w,[{name:"blur",handler:this._onLostFocus}])}D&&this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this.onContextMenu&&D.removeEventListener("contextmenu",this.onContextMenu),this._onLostFocus=null),this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0},e.prototype.getClassName=function(){return"BaseCameraPointersInput"},e.prototype.getSimpleName=function(){return"pointers"},e.prototype.onDoubleTap=function(D){},e.prototype.onTouch=function(D,w,N){},e.prototype.onMultiTouch=function(D,w,N,F,k,j){},e.prototype.onContextMenu=function(D){D.preventDefault()},e.prototype.onButtonDown=function(D){},e.prototype.onButtonUp=function(D){},e.prototype.onLostFocus=function(){},Object(Z.c)([Object(Ie.c)()],e.prototype,"buttons",void 0),e}(),dn=function(D){function t(){var w=null!==D&&D.apply(this,arguments)||this;return w.buttons=[0,1,2],w.angularSensibilityX=1e3,w.angularSensibilityY=1e3,w.pinchPrecision=12,w.pinchDeltaPercentage=0,w.useNaturalPinchZoom=!1,w.panningSensibility=1e3,w.multiTouchPanning=!0,w.multiTouchPanAndZoom=!0,w.pinchInwards=!0,w._isPanClick=!1,w._twoFingerActivityCount=0,w._isPinching=!1,w}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"ArcRotateCameraPointersInput"},t.prototype.onTouch=function(D,w,N){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-w/this.panningSensibility,this.camera.inertialPanningY+=N/this.panningSensibility):(this.camera.inertialAlphaOffset-=w/this.angularSensibilityX,this.camera.inertialBetaOffset-=N/this.angularSensibilityY)},t.prototype.onDoubleTap=function(D){this.camera.useInputToRestoreState&&this.camera.restoreState()},t.prototype.onMultiTouch=function(D,w,N,F,k,j){if(!(0===N&&null===k||0===F&&null===j)){var z=this.pinchInwards?1:-1;if(this.multiTouchPanAndZoom){if(this.useNaturalPinchZoom?this.camera.radius=this.camera.radius*Math.sqrt(N)/Math.sqrt(F):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(F-N)*this.camera.radius*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(F-N)/(this.pinchPrecision*z*(this.angularSensibilityX+this.angularSensibilityY)/2),0!==this.panningSensibility&&k&&j){var G=j.x-k.x,H=j.y-k.y;this.camera.inertialPanningX+=-G/this.panningSensibility,this.camera.inertialPanningY+=H/this.panningSensibility}}else{this._twoFingerActivityCount++;var X=Math.sqrt(N),q=Math.sqrt(F);this._isPinching||this._twoFingerActivityCount<20&&Math.abs(q-X)>this.camera.pinchToPanMaxDistance?(this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(F-N)*this.camera.radius*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(F-N)/(this.pinchPrecision*z*(this.angularSensibilityX+this.angularSensibilityY)/2),this._isPinching=!0):0!==this.panningSensibility&&this.multiTouchPanning&&j&&k&&(G=j.x-k.x,H=j.y-k.y,this.camera.inertialPanningX+=-G/this.panningSensibility,this.camera.inertialPanningY+=H/this.panningSensibility)}}},t.prototype.onButtonDown=function(D){this._isPanClick=D.button===this.camera._panningMouseButton},t.prototype.onButtonUp=function(D){this._twoFingerActivityCount=0,this._isPinching=!1},t.prototype.onLostFocus=function(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1},Object(Z.c)([Object(Ie.c)()],t.prototype,"buttons",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"angularSensibilityX",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"angularSensibilityY",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"pinchPrecision",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"pinchDeltaPercentage",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"useNaturalPinchZoom",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"panningSensibility",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"multiTouchPanning",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"multiTouchPanAndZoom",void 0),t}(hn);nn.ArcRotateCameraPointersInput=dn;var _n=function(D){function t(w){return D.call(this,w)||this}return Object(Z.d)(t,D),t.prototype.addMouseWheel=function(){return this.add(new ln),this},t.prototype.addPointers=function(){return this.add(new dn),this},t.prototype.addKeyboard=function(){return this.add(new un),this},t}(rn);_n.prototype.addVRDeviceOrientation=function(){return this.add(new mn),this};var mn=function(){function e(){this.alphaCorrection=1,this.gammaCorrection=1,this._alpha=0,this._gamma=0,this._dirty=!1,this._deviceOrientationHandler=this._onOrientationEvent.bind(this)}return e.prototype.attachControl=function(D,w){var N=this;this.camera.attachControl(D,w);var F=this.camera.getScene().getEngine().getHostWindow();F&&("undefined"!=typeof DeviceOrientationEvent&&"function"==typeof DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((function(D){"granted"===D?F.addEventListener("deviceorientation",N._deviceOrientationHandler):Dt.b.Warn("Permission not granted.")})).catch((function(D){Dt.b.Error(D)})):F.addEventListener("deviceorientation",this._deviceOrientationHandler))},e.prototype._onOrientationEvent=function(D){null!==D.alpha&&(this._alpha=(0|+D.alpha)*this.alphaCorrection),null!==D.gamma&&(this._gamma=(0|+D.gamma)*this.gammaCorrection),this._dirty=!0},e.prototype.checkInputs=function(){this._dirty&&(this._dirty=!1,this._gamma<0&&(this._gamma=180+this._gamma),this.camera.alpha=-this._alpha/180*Math.PI%Math.PI*2,this.camera.beta=this._gamma/180*Math.PI)},e.prototype.detachControl=function(D){window.removeEventListener("deviceorientation",this._deviceOrientationHandler)},e.prototype.getClassName=function(){return"ArcRotateCameraVRDeviceOrientationInput"},e.prototype.getSimpleName=function(){return"VRDeviceOrientation"},e}();nn.ArcRotateCameraVRDeviceOrientationInput=mn;var gn=function(){function e(){this.keysForward=[87],this.keysBackward=[83],this.keysUp=[69],this.keysDown=[81],this.keysRight=[68],this.keysLeft=[65],this._keys=new Array}return e.prototype.attachControl=function(D,w){var N=this;this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((function(){N._keys=[]})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((function(D){var F,k=D.event;D.type===cn.a.KEYDOWN?-1===N.keysForward.indexOf(k.keyCode)&&-1===N.keysBackward.indexOf(k.keyCode)&&-1===N.keysUp.indexOf(k.keyCode)&&-1===N.keysDown.indexOf(k.keyCode)&&-1===N.keysLeft.indexOf(k.keyCode)&&-1===N.keysRight.indexOf(k.keyCode)||(-1===(F=N._keys.indexOf(k.keyCode))&&N._keys.push(k.keyCode),w||k.preventDefault()):-1===N.keysForward.indexOf(k.keyCode)&&-1===N.keysBackward.indexOf(k.keyCode)&&-1===N.keysUp.indexOf(k.keyCode)&&-1===N.keysDown.indexOf(k.keyCode)&&-1===N.keysLeft.indexOf(k.keyCode)&&-1===N.keysRight.indexOf(k.keyCode)||((F=N._keys.indexOf(k.keyCode))>=0&&N._keys.splice(F,1),w||k.preventDefault())})))},e.prototype.detachControl=function(D){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},e.prototype.getClassName=function(){return"FlyCameraKeyboardInput"},e.prototype._onLostFocus=function(D){this._keys=[]},e.prototype.getSimpleName=function(){return"keyboard"},e.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var D=this.camera,w=0;w<this._keys.length;w++){var N=this._keys[w],F=D._computeLocalCameraSpeed();-1!==this.keysForward.indexOf(N)?D._localDirection.copyFromFloats(0,0,F):-1!==this.keysBackward.indexOf(N)?D._localDirection.copyFromFloats(0,0,-F):-1!==this.keysUp.indexOf(N)?D._localDirection.copyFromFloats(0,F,0):-1!==this.keysDown.indexOf(N)?D._localDirection.copyFromFloats(0,-F,0):-1!==this.keysRight.indexOf(N)?D._localDirection.copyFromFloats(F,0,0):-1!==this.keysLeft.indexOf(N)&&D._localDirection.copyFromFloats(-F,0,0),D.getScene().useRightHandedSystem&&(D._localDirection.z*=-1),D.getViewMatrix().invertToRef(D._cameraTransformMatrix),z.e.TransformNormalToRef(D._localDirection,D._cameraTransformMatrix,D._transformedDirection),D.cameraDirection.addInPlace(D._transformedDirection)}},Object(Z.c)([Object(Ie.c)()],e.prototype,"keysForward",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"keysBackward",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"keysUp",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"keysDown",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"keysRight",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"keysLeft",void 0),e}();nn.FlyCameraKeyboardInput=gn;var vn=function(){function e(D){void 0===D&&(D=!0),this.buttons=[0,1,2],this.buttonsYaw=[-1,0,1],this.buttonsPitch=[-1,0,1],this.buttonsRoll=[2],this.activeButton=-1,this.angularSensibility=1e3,this.previousPosition=null}return e.prototype.attachControl=function(D,w){var N=this;this.element=D,this.noPreventDefault=w,this._observer=this.camera.getScene().onPointerObservable.add((function(D,w){N._pointerInput(D,w)}),kt.a.POINTERDOWN|kt.a.POINTERUP|kt.a.POINTERMOVE),this._rollObserver=this.camera.getScene().onBeforeRenderObservable.add((function(){N.camera.rollCorrect&&N.camera.restoreRoll(N.camera.rollCorrect)})),this._mousemoveCallback=function(D){N._onMouseMove(D)},D.addEventListener("mousemove",this._mousemoveCallback,!1)},e.prototype.detachControl=function(D){this._observer&&D&&(this.camera.getScene().onPointerObservable.remove(this._observer),this.camera.getScene().onBeforeRenderObservable.remove(this._rollObserver),this._mousemoveCallback&&D.removeEventListener("mousemove",this._mousemoveCallback),this._observer=null,this._rollObserver=null,this.previousPosition=null,this.noPreventDefault=void 0)},e.prototype.getClassName=function(){return"FlyCameraMouseInput"},e.prototype.getSimpleName=function(){return"mouse"},e.prototype._pointerInput=function(D,w){var N=D.event,F=this.camera.getEngine();if(!F.isInVRExclusivePointerMode&&(this.touchEnabled||"touch"!==N.pointerType)&&(D.type===kt.a.POINTERMOVE||-1!==this.buttons.indexOf(N.button))){var k=N.srcElement||N.target;if(D.type===kt.a.POINTERDOWN&&k){try{k.setPointerCapture(N.pointerId)}catch(N){}this.previousPosition={x:N.clientX,y:N.clientY},this.activeButton=N.button,this.noPreventDefault||(N.preventDefault(),this.element.focus())}else if(D.type===kt.a.POINTERUP&&k){try{k.releasePointerCapture(N.pointerId)}catch(N){}this.activeButton=-1,this.previousPosition=null,this.noPreventDefault||N.preventDefault()}else if(D.type===kt.a.POINTERMOVE){if(!this.previousPosition||F.isPointerLock)return;var j=N.clientX-this.previousPosition.x,z=N.clientY-this.previousPosition.y;this.rotateCamera(j,z),this.previousPosition={x:N.clientX,y:N.clientY},this.noPreventDefault||N.preventDefault()}}},e.prototype._onMouseMove=function(D){var w=this.camera.getEngine();if(w.isPointerLock&&!w.isInVRExclusivePointerMode){var N=D.movementX||D.mozMovementX||D.webkitMovementX||D.msMovementX||0,F=D.movementY||D.mozMovementY||D.webkitMovementY||D.msMovementY||0;this.rotateCamera(N,F),this.previousPosition=null,this.noPreventDefault||D.preventDefault()}},e.prototype.rotateCamera=function(D,w){var N=this,F=this.camera;this.camera.getScene().useRightHandedSystem&&(D*=-1),F.parent&&F.parent._getWorldMatrixDeterminant()<0&&(D*=-1);var k,j=D/this.angularSensibility,G=w/this.angularSensibility,H=z.b.RotationYawPitchRoll(F.rotation.y,F.rotation.x,F.rotation.z);if(this.buttonsPitch.some((function(D){return D===N.activeButton}))&&(k=z.b.RotationAxis(Qe.a.X,G),H.multiplyInPlace(k)),this.buttonsYaw.some((function(D){return D===N.activeButton}))){k=z.b.RotationAxis(Qe.a.Y,j),H.multiplyInPlace(k);var X=F.bankedTurnLimit+F._trackRoll;if(F.bankedTurn&&-X<F.rotation.z&&F.rotation.z<X){var q=F.bankedTurnMultiplier*-j;k=z.b.RotationAxis(Qe.a.Z,q),H.multiplyInPlace(k)}}this.buttonsRoll.some((function(D){return D===N.activeButton}))&&(k=z.b.RotationAxis(Qe.a.Z,-j),F._trackRoll-=j,H.multiplyInPlace(k)),H.toEulerAnglesToRef(F.rotation)},Object(Z.c)([Object(Ie.c)()],e.prototype,"buttons",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"angularSensibility",void 0),e}();nn.FlyCameraMouseInput=vn;var yn=function(){function e(){this.keysHeightOffsetIncr=[38],this.keysHeightOffsetDecr=[40],this.keysHeightOffsetModifierAlt=!1,this.keysHeightOffsetModifierCtrl=!1,this.keysHeightOffsetModifierShift=!1,this.keysRotationOffsetIncr=[37],this.keysRotationOffsetDecr=[39],this.keysRotationOffsetModifierAlt=!1,this.keysRotationOffsetModifierCtrl=!1,this.keysRotationOffsetModifierShift=!1,this.keysRadiusIncr=[40],this.keysRadiusDecr=[38],this.keysRadiusModifierAlt=!0,this.keysRadiusModifierCtrl=!1,this.keysRadiusModifierShift=!1,this.heightSensibility=1,this.rotationSensibility=1,this.radiusSensibility=1,this._keys=new Array}return e.prototype.attachControl=function(D,w){var N=this;this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((function(){N._keys=[]})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((function(D){var F,k=D.event;k.metaKey||(D.type===cn.a.KEYDOWN?(N._ctrlPressed=k.ctrlKey,N._altPressed=k.altKey,N._shiftPressed=k.shiftKey,(-1!==N.keysHeightOffsetIncr.indexOf(k.keyCode)||-1!==N.keysHeightOffsetDecr.indexOf(k.keyCode)||-1!==N.keysRotationOffsetIncr.indexOf(k.keyCode)||-1!==N.keysRotationOffsetDecr.indexOf(k.keyCode)||-1!==N.keysRadiusIncr.indexOf(k.keyCode)||-1!==N.keysRadiusDecr.indexOf(k.keyCode))&&(-1===(F=N._keys.indexOf(k.keyCode))&&N._keys.push(k.keyCode),k.preventDefault&&(w||k.preventDefault()))):-1===N.keysHeightOffsetIncr.indexOf(k.keyCode)&&-1===N.keysHeightOffsetDecr.indexOf(k.keyCode)&&-1===N.keysRotationOffsetIncr.indexOf(k.keyCode)&&-1===N.keysRotationOffsetDecr.indexOf(k.keyCode)&&-1===N.keysRadiusIncr.indexOf(k.keyCode)&&-1===N.keysRadiusDecr.indexOf(k.keyCode)||((F=N._keys.indexOf(k.keyCode))>=0&&N._keys.splice(F,1),k.preventDefault&&(w||k.preventDefault())))})))},e.prototype.detachControl=function(D){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},e.prototype.checkInputs=function(){var D=this;this._onKeyboardObserver&&this._keys.forEach((function(w){-1!==D.keysHeightOffsetIncr.indexOf(w)&&D._modifierHeightOffset()?D.camera.heightOffset+=D.heightSensibility:-1!==D.keysHeightOffsetDecr.indexOf(w)&&D._modifierHeightOffset()?D.camera.heightOffset-=D.heightSensibility:-1!==D.keysRotationOffsetIncr.indexOf(w)&&D._modifierRotationOffset()?(D.camera.rotationOffset+=D.rotationSensibility,D.camera.rotationOffset%=360):-1!==D.keysRotationOffsetDecr.indexOf(w)&&D._modifierRotationOffset()?(D.camera.rotationOffset-=D.rotationSensibility,D.camera.rotationOffset%=360):-1!==D.keysRadiusIncr.indexOf(w)&&D._modifierRadius()?D.camera.radius+=D.radiusSensibility:-1!==D.keysRadiusDecr.indexOf(w)&&D._modifierRadius()&&(D.camera.radius-=D.radiusSensibility)}))},e.prototype.getClassName=function(){return"FollowCameraKeyboardMoveInput"},e.prototype.getSimpleName=function(){return"keyboard"},e.prototype._modifierHeightOffset=function(){return this.keysHeightOffsetModifierAlt===this._altPressed&&this.keysHeightOffsetModifierCtrl===this._ctrlPressed&&this.keysHeightOffsetModifierShift===this._shiftPressed},e.prototype._modifierRotationOffset=function(){return this.keysRotationOffsetModifierAlt===this._altPressed&&this.keysRotationOffsetModifierCtrl===this._ctrlPressed&&this.keysRotationOffsetModifierShift===this._shiftPressed},e.prototype._modifierRadius=function(){return this.keysRadiusModifierAlt===this._altPressed&&this.keysRadiusModifierCtrl===this._ctrlPressed&&this.keysRadiusModifierShift===this._shiftPressed},Object(Z.c)([Object(Ie.c)()],e.prototype,"keysHeightOffsetIncr",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"keysHeightOffsetDecr",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"keysHeightOffsetModifierAlt",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"keysHeightOffsetModifierCtrl",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"keysHeightOffsetModifierShift",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"keysRotationOffsetIncr",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"keysRotationOffsetDecr",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"keysRotationOffsetModifierAlt",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"keysRotationOffsetModifierCtrl",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"keysRotationOffsetModifierShift",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"keysRadiusIncr",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"keysRadiusDecr",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"keysRadiusModifierAlt",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"keysRadiusModifierCtrl",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"keysRadiusModifierShift",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"heightSensibility",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"rotationSensibility",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"radiusSensibility",void 0),e}();nn.FollowCameraKeyboardMoveInput=yn;var bn=function(){function e(){this.axisControlRadius=!0,this.axisControlHeight=!1,this.axisControlRotation=!1,this.wheelPrecision=3,this.wheelDeltaPercentage=0}return e.prototype.attachControl=function(D,w){var N=this;this._wheel=function(D,F){if(D.type===kt.a.POINTERWHEEL){var k=D.event,j=0,z=Math.max(-1,Math.min(1,k.deltaY||k.wheelDelta||-k.detail));N.wheelDeltaPercentage?(console.assert(N.axisControlRadius+N.axisControlHeight+N.axisControlRotation<=1,"wheelDeltaPercentage only usable when mouse wheel controlls ONE axis. Currently enabled: axisControlRadius: "+N.axisControlRadius+", axisControlHeightOffset: "+N.axisControlHeight+", axisControlRotationOffset: "+N.axisControlRotation),N.axisControlRadius?j=.01*z*N.wheelDeltaPercentage*N.camera.radius:N.axisControlHeight?j=.01*z*N.wheelDeltaPercentage*N.camera.heightOffset:N.axisControlRotation&&(j=.01*z*N.wheelDeltaPercentage*N.camera.rotationOffset)):j=z*N.wheelPrecision,j&&(N.axisControlRadius?N.camera.radius+=j:N.axisControlHeight?N.camera.heightOffset-=j:N.axisControlRotation&&(N.camera.rotationOffset-=j)),k.preventDefault&&(w||k.preventDefault())}},this._observer=this.camera.getScene().onPointerObservable.add(this._wheel,kt.a.POINTERWHEEL)},e.prototype.detachControl=function(D){this._observer&&D&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._wheel=null)},e.prototype.getClassName=function(){return"ArcRotateCameraMouseWheelInput"},e.prototype.getSimpleName=function(){return"mousewheel"},Object(Z.c)([Object(Ie.c)()],e.prototype,"axisControlRadius",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"axisControlHeight",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"axisControlRotation",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"wheelPrecision",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"wheelDeltaPercentage",void 0),e}();nn.FollowCameraMouseWheelInput=bn;var Tn=function(D){function t(){var w=null!==D&&D.apply(this,arguments)||this;return w.angularSensibilityX=1,w.angularSensibilityY=1,w.pinchPrecision=1e4,w.pinchDeltaPercentage=0,w.axisXControlRadius=!1,w.axisXControlHeight=!1,w.axisXControlRotation=!0,w.axisYControlRadius=!1,w.axisYControlHeight=!0,w.axisYControlRotation=!1,w.axisPinchControlRadius=!0,w.axisPinchControlHeight=!1,w.axisPinchControlRotation=!1,w.warningEnable=!0,w._warningCounter=0,w}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"FollowCameraPointersInput"},t.prototype.onTouch=function(D,w,N){this._warning(),this.axisXControlRotation?this.camera.rotationOffset+=w/this.angularSensibilityX:this.axisYControlRotation&&(this.camera.rotationOffset+=N/this.angularSensibilityX),this.axisXControlHeight?this.camera.heightOffset+=w/this.angularSensibilityY:this.axisYControlHeight&&(this.camera.heightOffset+=N/this.angularSensibilityY),this.axisXControlRadius?this.camera.radius-=w/this.angularSensibilityY:this.axisYControlRadius&&(this.camera.radius-=N/this.angularSensibilityY)},t.prototype.onMultiTouch=function(D,w,N,F,k,j){if(!(0===N&&null===k||0===F&&null===j)){var z=(F-N)/(this.pinchPrecision*(this.angularSensibilityX+this.angularSensibilityY)/2);this.pinchDeltaPercentage?(z*=.01*this.pinchDeltaPercentage,this.axisPinchControlRotation&&(this.camera.rotationOffset+=z*this.camera.rotationOffset),this.axisPinchControlHeight&&(this.camera.heightOffset+=z*this.camera.heightOffset),this.axisPinchControlRadius&&(this.camera.radius-=z*this.camera.radius)):(this.axisPinchControlRotation&&(this.camera.rotationOffset+=z),this.axisPinchControlHeight&&(this.camera.heightOffset+=z),this.axisPinchControlRadius&&(this.camera.radius-=z))}},t.prototype._warning=function(){if(this.warningEnable&&this._warningCounter++%100==0){var D="It probably only makes sense to control ONE camera property with each pointer axis. Set 'warningEnable = false' if you are sure. Currently enabled: ";console.assert(this.axisXControlRotation+this.axisXControlHeight+this.axisXControlRadius<=1,D+"axisXControlRotation: "+this.axisXControlRotation+", axisXControlHeight: "+this.axisXControlHeight+", axisXControlRadius: "+this.axisXControlRadius),console.assert(this.axisYControlRotation+this.axisYControlHeight+this.axisYControlRadius<=1,D+"axisYControlRotation: "+this.axisYControlRotation+", axisYControlHeight: "+this.axisYControlHeight+", axisYControlRadius: "+this.axisYControlRadius),console.assert(this.axisPinchControlRotation+this.axisPinchControlHeight+this.axisPinchControlRadius<=1,D+"axisPinchControlRotation: "+this.axisPinchControlRotation+", axisPinchControlHeight: "+this.axisPinchControlHeight+", axisPinchControlRadius: "+this.axisPinchControlRadius)}},Object(Z.c)([Object(Ie.c)()],t.prototype,"angularSensibilityX",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"angularSensibilityY",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"pinchPrecision",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"pinchDeltaPercentage",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"axisXControlRadius",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"axisXControlHeight",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"axisXControlRotation",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"axisYControlRadius",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"axisYControlHeight",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"axisYControlRotation",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"axisPinchControlRadius",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"axisPinchControlHeight",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"axisPinchControlRotation",void 0),t}(hn);nn.FollowCameraPointersInput=Tn;var En=function(){function e(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this._keys=new Array}return e.prototype.attachControl=function(D,w){var N=this;this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((function(){N._keys=[]})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((function(D){var F,k=D.event;k.metaKey||(D.type===cn.a.KEYDOWN?-1===N.keysUp.indexOf(k.keyCode)&&-1===N.keysDown.indexOf(k.keyCode)&&-1===N.keysLeft.indexOf(k.keyCode)&&-1===N.keysRight.indexOf(k.keyCode)||(-1===(F=N._keys.indexOf(k.keyCode))&&N._keys.push(k.keyCode),w||k.preventDefault()):-1===N.keysUp.indexOf(k.keyCode)&&-1===N.keysDown.indexOf(k.keyCode)&&-1===N.keysLeft.indexOf(k.keyCode)&&-1===N.keysRight.indexOf(k.keyCode)||((F=N._keys.indexOf(k.keyCode))>=0&&N._keys.splice(F,1),w||k.preventDefault()))})))},e.prototype.detachControl=function(D){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},e.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var D=this.camera,w=0;w<this._keys.length;w++){var N=this._keys[w],F=D._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(N)?D._localDirection.copyFromFloats(-F,0,0):-1!==this.keysUp.indexOf(N)?D._localDirection.copyFromFloats(0,0,F):-1!==this.keysRight.indexOf(N)?D._localDirection.copyFromFloats(F,0,0):-1!==this.keysDown.indexOf(N)&&D._localDirection.copyFromFloats(0,0,-F),D.getScene().useRightHandedSystem&&(D._localDirection.z*=-1),D.getViewMatrix().invertToRef(D._cameraTransformMatrix),z.e.TransformNormalToRef(D._localDirection,D._cameraTransformMatrix,D._transformedDirection),D.cameraDirection.addInPlace(D._transformedDirection)}},e.prototype.getClassName=function(){return"FreeCameraKeyboardMoveInput"},e.prototype._onLostFocus=function(){this._keys=[]},e.prototype.getSimpleName=function(){return"keyboard"},Object(Z.c)([Object(Ie.c)()],e.prototype,"keysUp",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"keysDown",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"keysLeft",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"keysRight",void 0),e}();nn.FreeCameraKeyboardMoveInput=En;var Sn=function(){function e(D){void 0===D&&(D=!0),this.touchEnabled=D,this.buttons=[0,1,2],this.angularSensibility=2e3,this.previousPosition=null,this.onPointerMovedObservable=new j.c,this._allowCameraRotation=!0}return e.prototype.attachControl=function(D,w){var N=this,F=this.camera.getEngine();this._pointerInput||(this._pointerInput=function(k){var j=k.event;if(!F.isInVRExclusivePointerMode&&(N.touchEnabled||"touch"!==j.pointerType)&&(k.type===kt.a.POINTERMOVE||-1!==N.buttons.indexOf(j.button))){var z=j.srcElement||j.target;if(k.type===kt.a.POINTERDOWN&&z){try{z.setPointerCapture(j.pointerId)}catch(D){}N.previousPosition={x:j.clientX,y:j.clientY},w||(j.preventDefault(),D.focus())}else if(k.type===kt.a.POINTERUP&&z){try{z.releasePointerCapture(j.pointerId)}catch(D){}N.previousPosition=null,w||j.preventDefault()}else if(k.type===kt.a.POINTERMOVE){if(!N.previousPosition||F.isPointerLock)return;var G=j.clientX-N.previousPosition.x,H=j.clientY-N.previousPosition.y;N.camera.getScene().useRightHandedSystem&&(G*=-1),N.camera.parent&&N.camera.parent._getWorldMatrixDeterminant()<0&&(G*=-1),N._allowCameraRotation&&(N.camera.cameraRotation.y+=G/N.angularSensibility,N.camera.cameraRotation.x+=H/N.angularSensibility),N.onPointerMovedObservable.notifyObservers({offsetX:G,offsetY:H}),N.previousPosition={x:j.clientX,y:j.clientY},w||j.preventDefault()}}}),this._onMouseMove=function(D){if(F.isPointerLock&&!F.isInVRExclusivePointerMode){var k=D.movementX||D.mozMovementX||D.webkitMovementX||D.msMovementX||0;N.camera.getScene().useRightHandedSystem&&(k*=-1),N.camera.parent&&N.camera.parent._getWorldMatrixDeterminant()<0&&(k*=-1),N.camera.cameraRotation.y+=k/N.angularSensibility;var j=D.movementY||D.mozMovementY||D.webkitMovementY||D.msMovementY||0;N.camera.cameraRotation.x+=j/N.angularSensibility,N.previousPosition=null,w||D.preventDefault()}},this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,kt.a.POINTERDOWN|kt.a.POINTERUP|kt.a.POINTERMOVE),D.addEventListener("mousemove",this._onMouseMove,!1),D.addEventListener("contextmenu",this.onContextMenu.bind(this),!1)},e.prototype.onContextMenu=function(D){D.preventDefault()},e.prototype.detachControl=function(D){this._observer&&D&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._onMouseMove&&D.removeEventListener("mousemove",this._onMouseMove),this.onContextMenu&&D.removeEventListener("contextmenu",this.onContextMenu),this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this.previousPosition=null)},e.prototype.getClassName=function(){return"FreeCameraMouseInput"},e.prototype.getSimpleName=function(){return"mouse"},Object(Z.c)([Object(Ie.c)()],e.prototype,"buttons",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"angularSensibility",void 0),e}();nn.FreeCameraMouseInput=Sn;var Mn=function(){function e(){this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array}return e.prototype.attachControl=function(D,w){var N=this,F=null;void 0===this._pointerInput&&(this._onLostFocus=function(){N._offsetX=null,N._offsetY=null},this._pointerInput=function(D){var k=D.event;if("mouse"!==k.pointerType)if(D.type===kt.a.POINTERDOWN){if(w||k.preventDefault(),N._pointerPressed.push(k.pointerId),1!==N._pointerPressed.length)return;F={x:k.clientX,y:k.clientY}}else if(D.type===kt.a.POINTERUP){if(w||k.preventDefault(),-1===(j=N._pointerPressed.indexOf(k.pointerId)))return;if(N._pointerPressed.splice(j,1),0!=j)return;F=null,N._offsetX=null,N._offsetY=null}else if(D.type===kt.a.POINTERMOVE){if(w||k.preventDefault(),!F)return;var j;if(0!=(j=N._pointerPressed.indexOf(k.pointerId)))return;N._offsetX=k.clientX-F.x,N._offsetY=-(k.clientY-F.y)}}),this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,kt.a.POINTERDOWN|kt.a.POINTERUP|kt.a.POINTERMOVE),this._onLostFocus&&D.addEventListener("blur",this._onLostFocus)},e.prototype.detachControl=function(D){this._pointerInput&&D&&(this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null),this._onLostFocus&&(D.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null),this._pointerPressed=[],this._offsetX=null,this._offsetY=null)},e.prototype.checkInputs=function(){if(this._offsetX&&this._offsetY){var D=this.camera;if(D.cameraRotation.y+=this._offsetX/this.touchAngularSensibility,this._pointerPressed.length>1)D.cameraRotation.x+=-this._offsetY/this.touchAngularSensibility;else{var w=D._computeLocalCameraSpeed(),N=new z.e(0,0,w*this._offsetY/this.touchMoveSensibility);z.a.RotationYawPitchRollToRef(D.rotation.y,D.rotation.x,0,D._cameraRotationMatrix),D.cameraDirection.addInPlace(z.e.TransformCoordinates(N,D._cameraRotationMatrix))}}},e.prototype.getClassName=function(){return"FreeCameraTouchInput"},e.prototype.getSimpleName=function(){return"touch"},Object(Z.c)([Object(Ie.c)()],e.prototype,"touchAngularSensibility",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"touchMoveSensibility",void 0),e}();nn.FreeCameraTouchInput=Mn;var xn=function(D){function t(w){var N=D.call(this,w)||this;return N._mouseInput=null,N}return Object(Z.d)(t,D),t.prototype.addKeyboard=function(){return this.add(new En),this},t.prototype.addMouse=function(D){return void 0===D&&(D=!0),this._mouseInput||(this._mouseInput=new Sn(D),this.add(this._mouseInput)),this},t.prototype.removeMouse=function(){return this._mouseInput&&this.remove(this._mouseInput),this},t.prototype.addTouch=function(){return this.add(new Mn),this},t.prototype.clear=function(){D.prototype.clear.call(this),this._mouseInput=null},t}(rn);xn.prototype.addDeviceOrientation=function(){return this._deviceOrientationInput||(this._deviceOrientationInput=new An,this.add(this._deviceOrientationInput)),this};var An=function(){function e(){var D=this;this._screenOrientationAngle=0,this._screenQuaternion=new z.b,this._alpha=0,this._beta=0,this._gamma=0,this._onDeviceOrientationChangedObservable=new j.c,this._orientationChanged=function(){D._screenOrientationAngle=void 0!==window.orientation?+window.orientation:window.screen.orientation&&window.screen.orientation.angle?window.screen.orientation.angle:0,D._screenOrientationAngle=-Dt.b.ToRadians(D._screenOrientationAngle/2),D._screenQuaternion.copyFromFloats(0,Math.sin(D._screenOrientationAngle),0,Math.cos(D._screenOrientationAngle))},this._deviceOrientation=function(w){D._alpha=null!==w.alpha?w.alpha:0,D._beta=null!==w.beta?w.beta:0,D._gamma=null!==w.gamma?w.gamma:0,null!==w.alpha&&D._onDeviceOrientationChangedObservable.notifyObservers()},this._constantTranform=new z.b(-Math.sqrt(.5),0,0,Math.sqrt(.5)),this._orientationChanged()}return e.WaitForOrientationChangeAsync=function(D){return new Promise((function(w,N){var F=!1,r=function(){window.removeEventListener("deviceorientation",r),F=!0,w()};D&&setTimeout((function(){F||(window.removeEventListener("deviceorientation",r),N("WaitForOrientationChangeAsync timed out"))}),D),"undefined"!=typeof DeviceOrientationEvent&&"function"==typeof DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((function(D){"granted"==D?window.addEventListener("deviceorientation",r):Dt.b.Warn("Permission not granted.")})).catch((function(D){Dt.b.Error(D)})):window.addEventListener("deviceorientation",r)}))},Object.defineProperty(e.prototype,"camera",{get:function(){return this._camera},set:function(D){var w=this;this._camera=D,null==this._camera||this._camera.rotationQuaternion||(this._camera.rotationQuaternion=new z.b),this._camera&&this._camera.onDisposeObservable.add((function(){w._onDeviceOrientationChangedObservable.clear()}))},enumerable:!0,configurable:!0}),e.prototype.attachControl=function(D,w){var N=this,F=this.camera.getScene().getEngine().getHostWindow();if(F){var r=function(){F.addEventListener("orientationchange",N._orientationChanged),F.addEventListener("deviceorientation",N._deviceOrientation),N._orientationChanged()};"undefined"!=typeof DeviceOrientationEvent&&"function"==typeof DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((function(D){"granted"===D?r():Dt.b.Warn("Permission not granted.")})).catch((function(D){Dt.b.Error(D)})):r()}},e.prototype.detachControl=function(D){window.removeEventListener("orientationchange",this._orientationChanged),window.removeEventListener("deviceorientation",this._deviceOrientation),this._alpha=0},e.prototype.checkInputs=function(){this._alpha&&(z.b.RotationYawPitchRollToRef(Dt.b.ToRadians(this._alpha),Dt.b.ToRadians(this._beta),-Dt.b.ToRadians(this._gamma),this.camera.rotationQuaternion),this._camera.rotationQuaternion.multiplyInPlace(this._screenQuaternion),this._camera.rotationQuaternion.multiplyInPlace(this._constantTranform),this._camera.rotationQuaternion.z*=-1,this._camera.rotationQuaternion.w*=-1)},e.prototype.getClassName=function(){return"FreeCameraDeviceOrientationInput"},e.prototype.getSimpleName=function(){return"deviceOrientation"},e}();nn.FreeCameraDeviceOrientationInput=An;var Pn=function(){function e(){this.gamepadAngularSensibility=200,this.gamepadMoveSensibility=40,this._yAxisScale=1,this._cameraTransform=z.a.Identity(),this._deltaTransform=z.e.Zero(),this._vector3=z.e.Zero(),this._vector2=z.d.Zero()}return Object.defineProperty(e.prototype,"invertYAxis",{get:function(){return 1!==this._yAxisScale},set:function(D){this._yAxisScale=D?-1:1},enumerable:!0,configurable:!0}),e.prototype.attachControl=function(D,w){var N=this,F=this.camera.getScene().gamepadManager;this._onGamepadConnectedObserver=F.onGamepadConnectedObservable.add((function(D){D.type!==on.POSE_ENABLED&&(N.gamepad&&D.type!==on.XBOX||(N.gamepad=D))})),this._onGamepadDisconnectedObserver=F.onGamepadDisconnectedObservable.add((function(D){N.gamepad===D&&(N.gamepad=null)})),this.gamepad=F.getGamepadByType(on.XBOX)},e.prototype.detachControl=function(D){this.camera.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.camera.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),this.gamepad=null},e.prototype.checkInputs=function(){if(this.gamepad&&this.gamepad.leftStick){var D=this.camera,w=this.gamepad.leftStick,N=w.x/this.gamepadMoveSensibility,F=w.y/this.gamepadMoveSensibility;w.x=Math.abs(N)>.005?0+N:0,w.y=Math.abs(F)>.005?0+F:0;var k=this.gamepad.rightStick;if(k){var j=k.x/this.gamepadAngularSensibility,G=k.y/this.gamepadAngularSensibility*this._yAxisScale;k.x=Math.abs(j)>.001?0+j:0,k.y=Math.abs(G)>.001?0+G:0}else k={x:0,y:0};D.rotationQuaternion?D.rotationQuaternion.toRotationMatrix(this._cameraTransform):z.a.RotationYawPitchRollToRef(D.rotation.y,D.rotation.x,0,this._cameraTransform);var H=50*D._computeLocalCameraSpeed();this._vector3.copyFromFloats(w.x*H,0,-w.y*H),z.e.TransformCoordinatesToRef(this._vector3,this._cameraTransform,this._deltaTransform),D.cameraDirection.addInPlace(this._deltaTransform),this._vector2.copyFromFloats(k.y,k.x),D.cameraRotation.addInPlace(this._vector2)}},e.prototype.getClassName=function(){return"FreeCameraGamepadInput"},e.prototype.getSimpleName=function(){return"gamepad"},Object(Z.c)([Object(Ie.c)()],e.prototype,"gamepadAngularSensibility",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"gamepadMoveSensibility",void 0),e}();nn.FreeCameraGamepadInput=Pn;var Cn,On=N(103);!function(D){D[D.X=0]="X",D[D.Y=1]="Y",D[D.Z=2]="Z"}(Cn||(Cn={}));var Rn=function(){function e(D){var w=this;if(this._leftJoystick=!!D,e._globalJoystickIndex++,this._axisTargetedByLeftAndRight=Cn.X,this._axisTargetedByUpAndDown=Cn.Y,this.reverseLeftRight=!1,this.reverseUpDown=!1,this._touches=new On.a,this.deltaPosition=z.e.Zero(),this._joystickSensibility=25,this._inversedSensibility=1/(this._joystickSensibility/1e3),this._onResize=function(D){e.vjCanvasWidth=window.innerWidth,e.vjCanvasHeight=window.innerHeight,e.Canvas&&(e.Canvas.width=e.vjCanvasWidth,e.Canvas.height=e.vjCanvasHeight),e.halfWidth=e.vjCanvasWidth/2},!e.Canvas){window.addEventListener("resize",this._onResize,!1),e.Canvas=document.createElement("canvas"),e.vjCanvasWidth=window.innerWidth,e.vjCanvasHeight=window.innerHeight,e.Canvas.width=window.innerWidth,e.Canvas.height=window.innerHeight,e.Canvas.style.width="100%",e.Canvas.style.height="100%",e.Canvas.style.position="absolute",e.Canvas.style.backgroundColor="transparent",e.Canvas.style.top="0px",e.Canvas.style.left="0px",e.Canvas.style.zIndex="5",e.Canvas.style.msTouchAction="none",e.Canvas.setAttribute("touch-action","none");var N=e.Canvas.getContext("2d");if(!N)throw new Error("Unable to create canvas for virtual joystick");e.vjCanvasContext=N,e.vjCanvasContext.strokeStyle="#ffffff",e.vjCanvasContext.lineWidth=2,document.body.appendChild(e.Canvas)}e.halfWidth=e.Canvas.width/2,this.pressed=!1,this._joystickColor="cyan",this._joystickPointerID=-1,this._joystickPointerPos=new z.d(0,0),this._joystickPreviousPointerPos=new z.d(0,0),this._joystickPointerStartPos=new z.d(0,0),this._deltaJoystickVector=new z.d(0,0),this._onPointerDownHandlerRef=function(D){w._onPointerDown(D)},this._onPointerMoveHandlerRef=function(D){w._onPointerMove(D)},this._onPointerUpHandlerRef=function(D){w._onPointerUp(D)},e.Canvas.addEventListener("pointerdown",this._onPointerDownHandlerRef,!1),e.Canvas.addEventListener("pointermove",this._onPointerMoveHandlerRef,!1),e.Canvas.addEventListener("pointerup",this._onPointerUpHandlerRef,!1),e.Canvas.addEventListener("pointerout",this._onPointerUpHandlerRef,!1),e.Canvas.addEventListener("contextmenu",(function(D){D.preventDefault()}),!1),requestAnimationFrame((function(){w._drawVirtualJoystick()}))}return e.prototype.setJoystickSensibility=function(D){this._joystickSensibility=D,this._inversedSensibility=1/(this._joystickSensibility/1e3)},e.prototype._onPointerDown=function(D){D.preventDefault(),(!0===this._leftJoystick?D.clientX<e.halfWidth:D.clientX>e.halfWidth)&&this._joystickPointerID<0?(this._joystickPointerID=D.pointerId,this._joystickPointerStartPos.x=D.clientX,this._joystickPointerStartPos.y=D.clientY,this._joystickPointerPos=this._joystickPointerStartPos.clone(),this._joystickPreviousPointerPos=this._joystickPointerStartPos.clone(),this._deltaJoystickVector.x=0,this._deltaJoystickVector.y=0,this.pressed=!0,this._touches.add(D.pointerId.toString(),D)):e._globalJoystickIndex<2&&this._action&&(this._action(),this._touches.add(D.pointerId.toString(),{x:D.clientX,y:D.clientY,prevX:D.clientX,prevY:D.clientY}))},e.prototype._onPointerMove=function(D){if(this._joystickPointerID==D.pointerId){this._joystickPointerPos.x=D.clientX,this._joystickPointerPos.y=D.clientY,this._deltaJoystickVector=this._joystickPointerPos.clone(),this._deltaJoystickVector=this._deltaJoystickVector.subtract(this._joystickPointerStartPos);var w=(this.reverseLeftRight?-1:1)*this._deltaJoystickVector.x/this._inversedSensibility;switch(this._axisTargetedByLeftAndRight){case Cn.X:this.deltaPosition.x=Math.min(1,Math.max(-1,w));break;case Cn.Y:this.deltaPosition.y=Math.min(1,Math.max(-1,w));break;case Cn.Z:this.deltaPosition.z=Math.min(1,Math.max(-1,w))}var N=(this.reverseUpDown?1:-1)*this._deltaJoystickVector.y/this._inversedSensibility;switch(this._axisTargetedByUpAndDown){case Cn.X:this.deltaPosition.x=Math.min(1,Math.max(-1,N));break;case Cn.Y:this.deltaPosition.y=Math.min(1,Math.max(-1,N));break;case Cn.Z:this.deltaPosition.z=Math.min(1,Math.max(-1,N))}}else{var F=this._touches.get(D.pointerId.toString());F&&(F.x=D.clientX,F.y=D.clientY)}},e.prototype._onPointerUp=function(D){if(this._joystickPointerID==D.pointerId)e.vjCanvasContext.clearRect(this._joystickPointerStartPos.x-64,this._joystickPointerStartPos.y-64,128,128),e.vjCanvasContext.clearRect(this._joystickPreviousPointerPos.x-42,this._joystickPreviousPointerPos.y-42,84,84),this._joystickPointerID=-1,this.pressed=!1;else{var w=this._touches.get(D.pointerId.toString());w&&e.vjCanvasContext.clearRect(w.prevX-44,w.prevY-44,88,88)}this._deltaJoystickVector.x=0,this._deltaJoystickVector.y=0,this._touches.remove(D.pointerId.toString())},e.prototype.setJoystickColor=function(D){this._joystickColor=D},e.prototype.setActionOnTouch=function(D){this._action=D},e.prototype.setAxisForLeftRight=function(D){switch(D){case Cn.X:case Cn.Y:case Cn.Z:this._axisTargetedByLeftAndRight=D;break;default:this._axisTargetedByLeftAndRight=Cn.X}},e.prototype.setAxisForUpDown=function(D){switch(D){case Cn.X:case Cn.Y:case Cn.Z:this._axisTargetedByUpAndDown=D;break;default:this._axisTargetedByUpAndDown=Cn.Y}},e.prototype._drawVirtualJoystick=function(){var D=this;this.pressed&&this._touches.forEach((function(w,N){N.pointerId===D._joystickPointerID?(e.vjCanvasContext.clearRect(D._joystickPointerStartPos.x-64,D._joystickPointerStartPos.y-64,128,128),e.vjCanvasContext.clearRect(D._joystickPreviousPointerPos.x-42,D._joystickPreviousPointerPos.y-42,84,84),e.vjCanvasContext.beginPath(),e.vjCanvasContext.lineWidth=6,e.vjCanvasContext.strokeStyle=D._joystickColor,e.vjCanvasContext.arc(D._joystickPointerStartPos.x,D._joystickPointerStartPos.y,40,0,2*Math.PI,!0),e.vjCanvasContext.stroke(),e.vjCanvasContext.closePath(),e.vjCanvasContext.beginPath(),e.vjCanvasContext.strokeStyle=D._joystickColor,e.vjCanvasContext.lineWidth=2,e.vjCanvasContext.arc(D._joystickPointerStartPos.x,D._joystickPointerStartPos.y,60,0,2*Math.PI,!0),e.vjCanvasContext.stroke(),e.vjCanvasContext.closePath(),e.vjCanvasContext.beginPath(),e.vjCanvasContext.strokeStyle=D._joystickColor,e.vjCanvasContext.arc(D._joystickPointerPos.x,D._joystickPointerPos.y,40,0,2*Math.PI,!0),e.vjCanvasContext.stroke(),e.vjCanvasContext.closePath(),D._joystickPreviousPointerPos=D._joystickPointerPos.clone()):(e.vjCanvasContext.clearRect(N.prevX-44,N.prevY-44,88,88),e.vjCanvasContext.beginPath(),e.vjCanvasContext.fillStyle="white",e.vjCanvasContext.beginPath(),e.vjCanvasContext.strokeStyle="red",e.vjCanvasContext.lineWidth=6,e.vjCanvasContext.arc(N.x,N.y,40,0,2*Math.PI,!0),e.vjCanvasContext.stroke(),e.vjCanvasContext.closePath(),N.prevX=N.x,N.prevY=N.y)})),requestAnimationFrame((function(){D._drawVirtualJoystick()}))},e.prototype.releaseCanvas=function(){e.Canvas&&(e.Canvas.removeEventListener("pointerdown",this._onPointerDownHandlerRef),e.Canvas.removeEventListener("pointermove",this._onPointerMoveHandlerRef),e.Canvas.removeEventListener("pointerup",this._onPointerUpHandlerRef),e.Canvas.removeEventListener("pointerout",this._onPointerUpHandlerRef),window.removeEventListener("resize",this._onResize),document.body.removeChild(e.Canvas),e.Canvas=null)},e._globalJoystickIndex=0,e}();xn.prototype.addVirtualJoystick=function(){return this.add(new Ln),this};var Ln=function(){function e(){}return e.prototype.getLeftJoystick=function(){return this._leftjoystick},e.prototype.getRightJoystick=function(){return this._rightjoystick},e.prototype.checkInputs=function(){if(this._leftjoystick){var D=this.camera,w=50*D._computeLocalCameraSpeed(),N=z.a.RotationYawPitchRoll(D.rotation.y,D.rotation.x,0),F=z.e.TransformCoordinates(new z.e(this._leftjoystick.deltaPosition.x*w,this._leftjoystick.deltaPosition.y*w,this._leftjoystick.deltaPosition.z*w),N);D.cameraDirection=D.cameraDirection.add(F),D.cameraRotation=D.cameraRotation.addVector3(this._rightjoystick.deltaPosition),this._leftjoystick.pressed||(this._leftjoystick.deltaPosition=this._leftjoystick.deltaPosition.scale(.9)),this._rightjoystick.pressed||(this._rightjoystick.deltaPosition=this._rightjoystick.deltaPosition.scale(.9))}},e.prototype.attachControl=function(D,w){this._leftjoystick=new Rn(!0),this._leftjoystick.setAxisForUpDown(Cn.Z),this._leftjoystick.setAxisForLeftRight(Cn.X),this._leftjoystick.setJoystickSensibility(.15),this._rightjoystick=new Rn(!1),this._rightjoystick.setAxisForUpDown(Cn.X),this._rightjoystick.setAxisForLeftRight(Cn.Y),this._rightjoystick.reverseUpDown=!0,this._rightjoystick.setJoystickSensibility(.05),this._rightjoystick.setJoystickColor("yellow")},e.prototype.detachControl=function(D){this._leftjoystick.releaseCanvas(),this._rightjoystick.releaseCanvas()},e.prototype.getClassName=function(){return"FreeCameraVirtualJoystickInput"},e.prototype.getSimpleName=function(){return"virtualJoystick"},e}();nn.FreeCameraVirtualJoystickInput=Ln;var Nn=function(D){function t(w,N,F,k){void 0===k&&(k=!0);var j=D.call(this,w,N,F,k)||this;return j.cameraDirection=new z.e(0,0,0),j.cameraRotation=new z.d(0,0),j.updateUpVectorFromRotation=!1,j._tmpQuaternion=new z.b,j.rotation=new z.e(0,0,0),j.speed=2,j.noRotationConstraint=!1,j.lockedTarget=null,j._currentTarget=z.e.Zero(),j._initialFocalDistance=1,j._viewMatrix=z.a.Zero(),j._camMatrix=z.a.Zero(),j._cameraTransformMatrix=z.a.Zero(),j._cameraRotationMatrix=z.a.Zero(),j._referencePoint=new z.e(0,0,1),j._transformedReferencePoint=z.e.Zero(),j._globalCurrentTarget=z.e.Zero(),j._globalCurrentUpVector=z.e.Zero(),j._defaultUp=z.e.Up(),j._cachedRotationZ=0,j._cachedQuaternionRotationZ=0,j}return Object(Z.d)(t,D),t.prototype.getFrontPosition=function(D){this.getWorldMatrix();var w=this.getTarget().subtract(this.position);return w.normalize(),w.scaleInPlace(D),this.globalPosition.add(w)},t.prototype._getLockedTargetPosition=function(){return this.lockedTarget?(this.lockedTarget.absolutePosition&&this.lockedTarget.computeWorldMatrix(),this.lockedTarget.absolutePosition||this.lockedTarget):null},t.prototype.storeState=function(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),D.prototype.storeState.call(this)},t.prototype._restoreStateValues=function(){return!!D.prototype._restoreStateValues.call(this)&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.copyFromFloats(0,0,0),this.cameraRotation.copyFromFloats(0,0),!0)},t.prototype._initCache=function(){D.prototype._initCache.call(this),this._cache.lockedTarget=new z.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new z.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new z.b(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},t.prototype._updateCache=function(w){w||D.prototype._updateCache.call(this);var N=this._getLockedTargetPosition();N?this._cache.lockedTarget?this._cache.lockedTarget.copyFrom(N):this._cache.lockedTarget=N.clone():this._cache.lockedTarget=null,this._cache.rotation.copyFrom(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)},t.prototype._isSynchronizedViewMatrix=function(){if(!D.prototype._isSynchronizedViewMatrix.call(this))return!1;var w=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(w):!w)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))},t.prototype._computeLocalCameraSpeed=function(){var D=this.getEngine();return this.speed*Math.sqrt(D.getDeltaTime()/(100*D.getFps()))},t.prototype.setTarget=function(D){this.upVector.normalize(),this._initialFocalDistance=D.subtract(this.position).length(),this.position.z===D.z&&(this.position.z+=rt.a),z.a.LookAtLHToRef(this.position,D,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);var w=D.subtract(this.position);w.x>=0?this.rotation.y=-Math.atan(w.z/w.x)+Math.PI/2:this.rotation.y=-Math.atan(w.z/w.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&z.b.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)},t.prototype.getTarget=function(){return this._currentTarget},t.prototype._decideIfNeedsToMove=function(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},t.prototype._updatePosition=function(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(z.c.Matrix[0]),z.e.TransformNormalToRef(this.cameraDirection,z.c.Matrix[0],z.c.Vector3[0]),void this.position.addInPlace(z.c.Vector3[0]);this.position.addInPlace(this.cameraDirection)},t.prototype._checkInputs=function(){var w=this._decideIfNeedsToMove(),N=Math.abs(this.cameraRotation.x)>0||Math.abs(this.cameraRotation.y)>0;w&&this._updatePosition(),N&&(this.rotation.x+=this.cameraRotation.x,this.rotation.y+=this.cameraRotation.y,this.rotationQuaternion&&this.rotation.lengthSquared()&&z.b.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion),this.noRotationConstraint||(this.rotation.x>1.570796&&(this.rotation.x=1.570796),this.rotation.x<-1.570796&&(this.rotation.x=-1.570796))),w&&(Math.abs(this.cameraDirection.x)<this.speed*rt.a&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*rt.a&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*rt.a&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),N&&(Math.abs(this.cameraRotation.x)<this.speed*rt.a&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*rt.a&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),D.prototype._checkInputs.call(this)},t.prototype._updateCameraRotationMatrix=function(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):z.a.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)},t.prototype._rotateUpVectorWithCameraRotationMatrix=function(){return z.e.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this},t.prototype._getViewMatrix=function(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!=this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),z.e.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?Qe.a.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(z.b.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),Qe.a.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix},t.prototype._computeViewMatrix=function(D,w,N){if(this.parent){var F=this.parent.getWorldMatrix();z.e.TransformCoordinatesToRef(D,F,this._globalPosition),z.e.TransformCoordinatesToRef(w,F,this._globalCurrentTarget),z.e.TransformNormalToRef(N,F,this._globalCurrentUpVector),this._markSyncedWithParent()}else this._globalPosition.copyFrom(D),this._globalCurrentTarget.copyFrom(w),this._globalCurrentUpVector.copyFrom(N);this.getScene().useRightHandedSystem?z.a.LookAtRHToRef(this._globalPosition,this._globalCurrentTarget,this._globalCurrentUpVector,this._viewMatrix):z.a.LookAtLHToRef(this._globalPosition,this._globalCurrentTarget,this._globalCurrentUpVector,this._viewMatrix)},t.prototype.createRigCamera=function(D,w){if(this.cameraRigMode!==Xt.a.RIG_MODE_NONE){var N=new t(D,this.position.clone(),this.getScene());return N.isRigCamera=!0,N.rigParent=this,this.cameraRigMode!==Xt.a.RIG_MODE_VR&&this.cameraRigMode!==Xt.a.RIG_MODE_WEBVR||(this.rotationQuaternion||(this.rotationQuaternion=new z.b),N._cameraRigParams={},N.rotationQuaternion=new z.b),N}return null},t.prototype._updateRigCameras=function(){var w=this._rigCameras[0],N=this._rigCameras[1];switch(this.computeWorldMatrix(),this.cameraRigMode){case Xt.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case Xt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case Xt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case Xt.a.RIG_MODE_STEREOSCOPIC_OVERUNDER:case Xt.a.RIG_MODE_STEREOSCOPIC_INTERLACED:var F=this.cameraRigMode===Xt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,k=this.cameraRigMode===Xt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*F,w),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*k,N);break;case Xt.a.RIG_MODE_VR:w.rotationQuaternion?(w.rotationQuaternion.copyFrom(this.rotationQuaternion),N.rotationQuaternion.copyFrom(this.rotationQuaternion)):(w.rotation.copyFrom(this.rotation),N.rotation.copyFrom(this.rotation)),w.position.copyFrom(this.position),N.position.copyFrom(this.position)}D.prototype._updateRigCameras.call(this)},t.prototype._getRigCamPositionAndTarget=function(D,w){this.getTarget().subtractToRef(this.position,t._TargetFocalPoint),t._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);var N=t._TargetFocalPoint.addInPlace(this.position);z.a.TranslationToRef(-N.x,-N.y,-N.z,t._TargetTransformMatrix),t._TargetTransformMatrix.multiplyToRef(z.a.RotationY(D),t._RigCamTransformMatrix),z.a.TranslationToRef(N.x,N.y,N.z,t._TargetTransformMatrix),t._RigCamTransformMatrix.multiplyToRef(t._TargetTransformMatrix,t._RigCamTransformMatrix),z.e.TransformCoordinatesToRef(this.position,t._RigCamTransformMatrix,w.position),w.setTarget(N)},t.prototype.getClassName=function(){return"TargetCamera"},t._RigCamTransformMatrix=new z.a,t._TargetTransformMatrix=new z.a,t._TargetFocalPoint=new z.e,Object(Z.c)([Object(Ie.o)()],t.prototype,"rotation",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"speed",void 0),Object(Z.c)([Object(Ie.k)("lockedTargetId")],t.prototype,"lockedTarget",void 0),t}(Xt.a),Fn=function(D){function t(w,N,F,k){void 0===k&&(k=!0);var j=D.call(this,w,N,F,k)||this;return j.ellipsoid=new z.e(.5,1,.5),j.ellipsoidOffset=new z.e(0,0,0),j.checkCollisions=!1,j.applyGravity=!1,j._needMoveForGravity=!1,j._oldPosition=z.e.Zero(),j._diffPosition=z.e.Zero(),j._newPosition=z.e.Zero(),j._collisionMask=-1,j._onCollisionPositionChange=function(D,w,N){var F;void 0===N&&(N=null),F=w,j._newPosition.copyFrom(F),j._newPosition.subtractToRef(j._oldPosition,j._diffPosition),j._diffPosition.length()>Ct.a.CollisionsEpsilon&&(j.position.addInPlace(j._diffPosition),j.onCollide&&N&&j.onCollide(N))},j.inputs=new xn(j),j.inputs.addKeyboard().addMouse(),j}return Object(Z.d)(t,D),Object.defineProperty(t.prototype,"angularSensibility",{get:function(){var D=this.inputs.attached.mouse;return D?D.angularSensibility:0},set:function(D){var w=this.inputs.attached.mouse;w&&(w.angularSensibility=D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keysUp",{get:function(){var D=this.inputs.attached.keyboard;return D?D.keysUp:[]},set:function(D){var w=this.inputs.attached.keyboard;w&&(w.keysUp=D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keysDown",{get:function(){var D=this.inputs.attached.keyboard;return D?D.keysDown:[]},set:function(D){var w=this.inputs.attached.keyboard;w&&(w.keysDown=D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keysLeft",{get:function(){var D=this.inputs.attached.keyboard;return D?D.keysLeft:[]},set:function(D){var w=this.inputs.attached.keyboard;w&&(w.keysLeft=D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keysRight",{get:function(){var D=this.inputs.attached.keyboard;return D?D.keysRight:[]},set:function(D){var w=this.inputs.attached.keyboard;w&&(w.keysRight=D)},enumerable:!0,configurable:!0}),t.prototype.attachControl=function(D,w){this.inputs.attachElement(D,w)},t.prototype.detachControl=function(D){this.inputs.detachElement(D),this.cameraDirection=new z.e(0,0,0),this.cameraRotation=new z.d(0,0)},Object.defineProperty(t.prototype,"collisionMask",{get:function(){return this._collisionMask},set:function(D){this._collisionMask=isNaN(D)?-1:D},enumerable:!0,configurable:!0}),t.prototype._collideWithWorld=function(D){(this.parent?z.e.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position).subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);var w=this.getScene().collisionCoordinator;this._collider||(this._collider=w.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;var N=D;this.applyGravity&&(N=D.add(this.getScene().gravity)),w.getNewPosition(this._oldPosition,N,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)},t.prototype._checkInputs=function(){this._localDirection||(this._localDirection=z.e.Zero(),this._transformedDirection=z.e.Zero()),this.inputs.checkInputs(),D.prototype._checkInputs.call(this)},t.prototype._decideIfNeedsToMove=function(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},t.prototype._updatePosition=function(){this.checkCollisions&&this.getScene().collisionsEnabled?this._collideWithWorld(this.cameraDirection):D.prototype._updatePosition.call(this)},t.prototype.dispose=function(){this.inputs.clear(),D.prototype.dispose.call(this)},t.prototype.getClassName=function(){return"FreeCamera"},Object(Z.c)([Object(Ie.o)()],t.prototype,"ellipsoid",void 0),Object(Z.c)([Object(Ie.o)()],t.prototype,"ellipsoidOffset",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"checkCollisions",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"applyGravity",void 0),t}(Nn);we.a.AddNodeConstructor("TouchCamera",(function(D,w){return function(){return new Bn(D,z.e.Zero(),w)}}));var Bn=function(D){function t(w,N,F){var k=D.call(this,w,N,F)||this;return k.inputs.addTouch(),k._setupInputs(),k}return Object(Z.d)(t,D),Object.defineProperty(t.prototype,"touchAngularSensibility",{get:function(){var D=this.inputs.attached.touch;return D?D.touchAngularSensibility:0},set:function(D){var w=this.inputs.attached.touch;w&&(w.touchAngularSensibility=D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"touchMoveSensibility",{get:function(){var D=this.inputs.attached.touch;return D?D.touchMoveSensibility:0},set:function(D){var w=this.inputs.attached.touch;w&&(w.touchMoveSensibility=D)},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"TouchCamera"},t.prototype._setupInputs=function(){var D=this.inputs.attached.mouse;D&&(D.touchEnabled=!1)},t}(Fn);we.a.AddNodeConstructor("ArcRotateCamera",(function(D,w){return function(){return new kn(D,0,0,1,z.e.Zero(),w)}}));var kn=function(D){function t(w,N,F,k,G,H,X){void 0===X&&(X=!0);var q=D.call(this,w,z.e.Zero(),H,X)||this;return q._upVector=z.e.Up(),q.inertialAlphaOffset=0,q.inertialBetaOffset=0,q.inertialRadiusOffset=0,q.lowerAlphaLimit=null,q.upperAlphaLimit=null,q.lowerBetaLimit=.01,q.upperBetaLimit=Math.PI-.01,q.lowerRadiusLimit=null,q.upperRadiusLimit=null,q.inertialPanningX=0,q.inertialPanningY=0,q.pinchToPanMaxDistance=20,q.panningDistanceLimit=null,q.panningOriginTarget=z.e.Zero(),q.panningInertia=.9,q.zoomOnFactor=1,q.targetScreenOffset=z.d.Zero(),q.allowUpsideDown=!0,q.useInputToRestoreState=!0,q._viewMatrix=new z.a,q.panningAxis=new z.e(1,1,0),q.onMeshTargetChangedObservable=new j.c,q.checkCollisions=!1,q.collisionRadius=new z.e(.5,.5,.5),q._previousPosition=z.e.Zero(),q._collisionVelocity=z.e.Zero(),q._newPosition=z.e.Zero(),q._computationVector=z.e.Zero(),q._onCollisionPositionChange=function(D,w,N){void 0===N&&(N=null),N?(q.setPosition(w),q.onCollide&&q.onCollide(N)):q._previousPosition.copyFrom(q._position);var F=Math.cos(q.alpha),k=Math.sin(q.alpha),j=Math.cos(q.beta),z=Math.sin(q.beta);0===z&&(z=1e-4);var G=q._getTargetPosition();q._computationVector.copyFromFloats(q.radius*F*z,q.radius*j,q.radius*k*z),G.addToRef(q._computationVector,q._newPosition),q._position.copyFrom(q._newPosition);var H=q.upVector;q.allowUpsideDown&&q.beta<0&&(H=(H=H.clone()).negate()),q._computeViewMatrix(q._position,G,H),q._viewMatrix.addAtIndex(12,q.targetScreenOffset.x),q._viewMatrix.addAtIndex(13,q.targetScreenOffset.y),q._collisionTriggered=!1},q._target=z.e.Zero(),G&&q.setTarget(G),q.alpha=N,q.beta=F,q.radius=k,q.getViewMatrix(),q.inputs=new _n(q),q.inputs.addKeyboard().addMouseWheel().addPointers(),q}return Object(Z.d)(t,D),Object.defineProperty(t.prototype,"target",{get:function(){return this._target},set:function(D){this.setTarget(D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(D){this.setPosition(D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"upVector",{get:function(){return this._upVector},set:function(D){this._upToYMatrix||(this._YToUpMatrix=new z.a,this._upToYMatrix=new z.a,this._upVector=z.e.Zero()),D.normalize(),this._upVector.copyFrom(D),this.setMatUp()},enumerable:!0,configurable:!0}),t.prototype.setMatUp=function(){z.a.RotationAlignToRef(z.e.UpReadOnly,this._upVector,this._YToUpMatrix),z.a.RotationAlignToRef(this._upVector,z.e.UpReadOnly,this._upToYMatrix)},Object.defineProperty(t.prototype,"angularSensibilityX",{get:function(){var D=this.inputs.attached.pointers;return D?D.angularSensibilityX:0},set:function(D){var w=this.inputs.attached.pointers;w&&(w.angularSensibilityX=D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"angularSensibilityY",{get:function(){var D=this.inputs.attached.pointers;return D?D.angularSensibilityY:0},set:function(D){var w=this.inputs.attached.pointers;w&&(w.angularSensibilityY=D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pinchPrecision",{get:function(){var D=this.inputs.attached.pointers;return D?D.pinchPrecision:0},set:function(D){var w=this.inputs.attached.pointers;w&&(w.pinchPrecision=D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pinchDeltaPercentage",{get:function(){var D=this.inputs.attached.pointers;return D?D.pinchDeltaPercentage:0},set:function(D){var w=this.inputs.attached.pointers;w&&(w.pinchDeltaPercentage=D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useNaturalPinchZoom",{get:function(){var D=this.inputs.attached.pointers;return!!D&&D.useNaturalPinchZoom},set:function(D){var w=this.inputs.attached.pointers;w&&(w.useNaturalPinchZoom=D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"panningSensibility",{get:function(){var D=this.inputs.attached.pointers;return D?D.panningSensibility:0},set:function(D){var w=this.inputs.attached.pointers;w&&(w.panningSensibility=D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keysUp",{get:function(){var D=this.inputs.attached.keyboard;return D?D.keysUp:[]},set:function(D){var w=this.inputs.attached.keyboard;w&&(w.keysUp=D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keysDown",{get:function(){var D=this.inputs.attached.keyboard;return D?D.keysDown:[]},set:function(D){var w=this.inputs.attached.keyboard;w&&(w.keysDown=D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keysLeft",{get:function(){var D=this.inputs.attached.keyboard;return D?D.keysLeft:[]},set:function(D){var w=this.inputs.attached.keyboard;w&&(w.keysLeft=D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keysRight",{get:function(){var D=this.inputs.attached.keyboard;return D?D.keysRight:[]},set:function(D){var w=this.inputs.attached.keyboard;w&&(w.keysRight=D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"wheelPrecision",{get:function(){var D=this.inputs.attached.mousewheel;return D?D.wheelPrecision:0},set:function(D){var w=this.inputs.attached.mousewheel;w&&(w.wheelPrecision=D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"wheelDeltaPercentage",{get:function(){var D=this.inputs.attached.mousewheel;return D?D.wheelDeltaPercentage:0},set:function(D){var w=this.inputs.attached.mousewheel;w&&(w.wheelDeltaPercentage=D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bouncingBehavior",{get:function(){return this._bouncingBehavior},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useBouncingBehavior",{get:function(){return null!=this._bouncingBehavior},set:function(D){D!==this.useBouncingBehavior&&(D?(this._bouncingBehavior=new Vt,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"framingBehavior",{get:function(){return this._framingBehavior},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useFramingBehavior",{get:function(){return null!=this._framingBehavior},set:function(D){D!==this.useFramingBehavior&&(D?(this._framingBehavior=new jt,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"autoRotationBehavior",{get:function(){return this._autoRotationBehavior},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useAutoRotationBehavior",{get:function(){return null!=this._autoRotationBehavior},set:function(D){D!==this.useAutoRotationBehavior&&(D?(this._autoRotationBehavior=new Ut,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))},enumerable:!0,configurable:!0}),t.prototype._initCache=function(){D.prototype._initCache.call(this),this._cache._target=new z.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=z.d.Zero()},t.prototype._updateCache=function(w){w||D.prototype._updateCache.call(this),this._cache._target.copyFrom(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.copyFrom(this.targetScreenOffset)},t.prototype._getTargetPosition=function(){if(this._targetHost&&this._targetHost.getAbsolutePosition){var D=this._targetHost.absolutePosition;this._targetBoundingCenter?D.addToRef(this._targetBoundingCenter,this._target):this._target.copyFrom(D)}return this._getLockedTargetPosition()||this._target},t.prototype.storeState=function(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),D.prototype.storeState.call(this)},t.prototype._restoreStateValues=function(){return!!D.prototype._restoreStateValues.call(this)&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)},t.prototype._isSynchronizedViewMatrix=function(){return!!D.prototype._isSynchronizedViewMatrix.call(this)&&this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset)},t.prototype.attachControl=function(D,w,N,F){var k=this;void 0===N&&(N=!0),void 0===F&&(F=2),this._useCtrlForPanning=N,this._panningMouseButton=F,this.inputs.attachElement(D,w),this._reset=function(){k.inertialAlphaOffset=0,k.inertialBetaOffset=0,k.inertialRadiusOffset=0,k.inertialPanningX=0,k.inertialPanningY=0}},t.prototype.detachControl=function(D){this.inputs.detachElement(D),this._reset&&this._reset()},t.prototype._checkInputs=function(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){var w=this.inertialAlphaOffset;this.beta<=0&&(w*=-1),this.getScene().useRightHandedSystem&&(w*=-1),this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(w*=-1),this.alpha+=w,this.beta+=this.inertialBetaOffset,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<rt.a&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<rt.a&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*rt.a&&(this.inertialRadiusOffset=0)}0===this.inertialPanningX&&0===this.inertialPanningY||(this._localDirection||(this._localDirection=z.e.Zero(),this._transformedDirection=z.e.Zero()),this._localDirection.copyFromFloats(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY),this._localDirection.multiplyInPlace(this.panningAxis),this._viewMatrix.invertToRef(this._cameraTransformMatrix),z.e.TransformNormalToRef(this._localDirection,this._cameraTransformMatrix,this._transformedDirection),this.panningAxis.y||(this._transformedDirection.y=0),this._targetHost||(this.panningDistanceLimit?(this._transformedDirection.addInPlace(this._target),z.e.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.copyFrom(this._transformedDirection)):this._target.addInPlace(this._transformedDirection)),this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*rt.a&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*rt.a&&(this.inertialPanningY=0)),this._checkLimits(),D.prototype._checkInputs.call(this)}},t.prototype._checkLimits=function(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0)},t.prototype.rebuildAnglesAndRadius=function(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||z.e.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4),0===this._computationVector.x&&0===this._computationVector.z?this.alpha=Math.PI/2:this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha),this.beta=Math.acos(this._computationVector.y/this.radius),this._checkLimits()},t.prototype.setPosition=function(D){this._position.equals(D)||(this._position.copyFrom(D),this.rebuildAnglesAndRadius())},t.prototype.setTarget=function(D,w,N){if(void 0===w&&(w=!1),void 0===N&&(N=!1),D.getBoundingInfo)this._targetBoundingCenter=w?D.getBoundingInfo().boundingBox.centerWorld.clone():null,D.computeWorldMatrix(),this._targetHost=D,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{var F=D,k=this._getTargetPosition();if(k&&!N&&k.equals(F))return;this._targetHost=null,this._target=F,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}this.rebuildAnglesAndRadius()},t.prototype._getViewMatrix=function(){var D=Math.cos(this.alpha),w=Math.sin(this.alpha),N=Math.cos(this.beta),F=Math.sin(this.beta);0===F&&(F=1e-4);var k=this._getTargetPosition();if(this._computationVector.copyFromFloats(this.radius*D*F,this.radius*N,this.radius*w*F),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||z.e.TransformCoordinatesToRef(this._computationVector,this._YToUpMatrix,this._computationVector),k.addToRef(this._computationVector,this._newPosition),this.getScene().collisionsEnabled&&this.checkCollisions){var j=this.getScene().collisionCoordinator;this._collider||(this._collider=j.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,j.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.copyFrom(this._newPosition);var G=this.upVector;this.allowUpsideDown&&F<0&&(G=G.negate()),this._computeViewMatrix(this._position,k,G),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=k,this._viewMatrix},t.prototype.zoomOn=function(D,w){void 0===w&&(w=!1),D=D||this.getScene().meshes;var N=xt.a.MinMax(D),F=z.e.Distance(N.min,N.max);this.radius=F*this.zoomOnFactor,this.focusOn({min:N.min,max:N.max,distance:F},w)},t.prototype.focusOn=function(D,w){var N,F;if(void 0===w&&(w=!1),void 0===D.min){var k=D||this.getScene().meshes;N=xt.a.MinMax(k),F=z.e.Distance(N.min,N.max)}else N=D,F=D.distance;this._target=xt.a.Center(N),w||(this.maxZ=2*F)},t.prototype.createRigCamera=function(D,w){var N=0;switch(this.cameraRigMode){case Xt.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case Xt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case Xt.a.RIG_MODE_STEREOSCOPIC_OVERUNDER:case Xt.a.RIG_MODE_STEREOSCOPIC_INTERLACED:case Xt.a.RIG_MODE_VR:N=this._cameraRigParams.stereoHalfAngle*(0===w?1:-1);break;case Xt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:N=this._cameraRigParams.stereoHalfAngle*(0===w?-1:1)}var F=new t(D,this.alpha+N,this.beta,this.radius,this._target,this.getScene());return F._cameraRigParams={},F.isRigCamera=!0,F.rigParent=this,F},t.prototype._updateRigCameras=function(){var w=this._rigCameras[0],N=this._rigCameras[1];switch(w.beta=N.beta=this.beta,this.cameraRigMode){case Xt.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case Xt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case Xt.a.RIG_MODE_STEREOSCOPIC_OVERUNDER:case Xt.a.RIG_MODE_STEREOSCOPIC_INTERLACED:case Xt.a.RIG_MODE_VR:w.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,N.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case Xt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:w.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,N.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}D.prototype._updateRigCameras.call(this)},t.prototype.dispose=function(){this.inputs.clear(),D.prototype.dispose.call(this)},t.prototype.getClassName=function(){return"ArcRotateCamera"},Object(Z.c)([Object(Ie.c)()],t.prototype,"alpha",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"beta",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"radius",void 0),Object(Z.c)([Object(Ie.o)("target")],t.prototype,"_target",void 0),Object(Z.c)([Object(Ie.o)("upVector")],t.prototype,"_upVector",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"inertialAlphaOffset",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"inertialBetaOffset",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"inertialRadiusOffset",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"lowerAlphaLimit",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"upperAlphaLimit",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"lowerBetaLimit",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"upperBetaLimit",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"lowerRadiusLimit",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"upperRadiusLimit",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"inertialPanningX",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"inertialPanningY",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"pinchToPanMaxDistance",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"panningDistanceLimit",void 0),Object(Z.c)([Object(Ie.o)()],t.prototype,"panningOriginTarget",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"panningInertia",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"zoomOnFactor",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"targetScreenOffset",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"allowUpsideDown",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"useInputToRestoreState",void 0),t}(Nn);we.a.AddNodeConstructor("DeviceOrientationCamera",(function(D,w){return function(){return new Un(D,z.e.Zero(),w)}}));var Un=function(D){function t(w,N,F){var k=D.call(this,w,N,F)||this;return k._tmpDragQuaternion=new z.b,k._disablePointerInputWhenUsingDeviceOrientation=!0,k._dragFactor=0,k._quaternionCache=new z.b,k.inputs.addDeviceOrientation(),k.inputs._deviceOrientationInput&&k.inputs._deviceOrientationInput._onDeviceOrientationChangedObservable.addOnce((function(){k._disablePointerInputWhenUsingDeviceOrientation&&k.inputs._mouseInput&&(k.inputs._mouseInput._allowCameraRotation=!1,k.inputs._mouseInput.onPointerMovedObservable.add((function(D){0!=k._dragFactor&&(k._initialQuaternion||(k._initialQuaternion=new z.b),z.b.FromEulerAnglesToRef(0,D.offsetX*k._dragFactor,0,k._tmpDragQuaternion),k._initialQuaternion.multiplyToRef(k._tmpDragQuaternion,k._initialQuaternion))})))})),k}return Object(Z.d)(t,D),Object.defineProperty(t.prototype,"disablePointerInputWhenUsingDeviceOrientation",{get:function(){return this._disablePointerInputWhenUsingDeviceOrientation},set:function(D){this._disablePointerInputWhenUsingDeviceOrientation=D},enumerable:!0,configurable:!0}),t.prototype.enableHorizontalDragging=function(D){void 0===D&&(D=1/300),this._dragFactor=D},t.prototype.getClassName=function(){return"DeviceOrientationCamera"},t.prototype._checkInputs=function(){D.prototype._checkInputs.call(this),this._quaternionCache.copyFrom(this.rotationQuaternion),this._initialQuaternion&&this._initialQuaternion.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)},t.prototype.resetToCurrentRotation=function(D){var w=this;void 0===D&&(D=Qe.a.Y),this.rotationQuaternion&&(this._initialQuaternion||(this._initialQuaternion=new z.b),this._initialQuaternion.copyFrom(this._quaternionCache||this.rotationQuaternion),["x","y","z"].forEach((function(N){D[N]?w._initialQuaternion[N]*=-1:w._initialQuaternion[N]=0})),this._initialQuaternion.normalize(),this._initialQuaternion.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion))},t}(Fn),jn=function(D){function t(w){return D.call(this,w)||this}return Object(Z.d)(t,D),t.prototype.addKeyboard=function(){return this.add(new gn),this},t.prototype.addMouse=function(D){return void 0===D&&(D=!0),this.add(new vn(D)),this},t}(rn),zn=function(D){function t(w,N,F,k){void 0===k&&(k=!0);var j=D.call(this,w,N,F,k)||this;return j.ellipsoid=new z.e(1,1,1),j.ellipsoidOffset=new z.e(0,0,0),j.checkCollisions=!1,j.applyGravity=!1,j.cameraDirection=z.e.Zero(),j._trackRoll=0,j.rollCorrect=100,j.bankedTurn=!1,j.bankedTurnLimit=Math.PI/2,j.bankedTurnMultiplier=1,j._needMoveForGravity=!1,j._oldPosition=z.e.Zero(),j._diffPosition=z.e.Zero(),j._newPosition=z.e.Zero(),j._collisionMask=-1,j._onCollisionPositionChange=function(D,w,N){var F;void 0===N&&(N=null),F=w,j._newPosition.copyFrom(F),j._newPosition.subtractToRef(j._oldPosition,j._diffPosition),j._diffPosition.length()>Ct.a.CollisionsEpsilon&&(j.position.addInPlace(j._diffPosition),j.onCollide&&N&&j.onCollide(N))},j.inputs=new jn(j),j.inputs.addKeyboard().addMouse(),j}return Object(Z.d)(t,D),Object.defineProperty(t.prototype,"angularSensibility",{get:function(){var D=this.inputs.attached.mouse;return D?D.angularSensibility:0},set:function(D){var w=this.inputs.attached.mouse;w&&(w.angularSensibility=D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keysForward",{get:function(){var D=this.inputs.attached.keyboard;return D?D.keysForward:[]},set:function(D){var w=this.inputs.attached.keyboard;w&&(w.keysForward=D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keysBackward",{get:function(){var D=this.inputs.attached.keyboard;return D?D.keysBackward:[]},set:function(D){var w=this.inputs.attached.keyboard;w&&(w.keysBackward=D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keysUp",{get:function(){var D=this.inputs.attached.keyboard;return D?D.keysUp:[]},set:function(D){var w=this.inputs.attached.keyboard;w&&(w.keysUp=D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keysDown",{get:function(){var D=this.inputs.attached.keyboard;return D?D.keysDown:[]},set:function(D){var w=this.inputs.attached.keyboard;w&&(w.keysDown=D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keysLeft",{get:function(){var D=this.inputs.attached.keyboard;return D?D.keysLeft:[]},set:function(D){var w=this.inputs.attached.keyboard;w&&(w.keysLeft=D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keysRight",{get:function(){var D=this.inputs.attached.keyboard;return D?D.keysRight:[]},set:function(D){var w=this.inputs.attached.keyboard;w&&(w.keysRight=D)},enumerable:!0,configurable:!0}),t.prototype.attachControl=function(D,w){this.inputs.attachElement(D,w)},t.prototype.detachControl=function(D){this.inputs.detachElement(D),this.cameraDirection=new z.e(0,0,0)},Object.defineProperty(t.prototype,"collisionMask",{get:function(){return this._collisionMask},set:function(D){this._collisionMask=isNaN(D)?-1:D},enumerable:!0,configurable:!0}),t.prototype._collideWithWorld=function(D){(this.parent?z.e.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position).subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);var w=this.getScene().collisionCoordinator;this._collider||(this._collider=w.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;var N=D;this.applyGravity&&(N=D.add(this.getScene().gravity)),w.getNewPosition(this._oldPosition,N,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)},t.prototype._checkInputs=function(){this._localDirection||(this._localDirection=z.e.Zero(),this._transformedDirection=z.e.Zero()),this.inputs.checkInputs(),D.prototype._checkInputs.call(this)},t.prototype._decideIfNeedsToMove=function(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},t.prototype._updatePosition=function(){this.checkCollisions&&this.getScene().collisionsEnabled?this._collideWithWorld(this.cameraDirection):D.prototype._updatePosition.call(this)},t.prototype.restoreRoll=function(D){var w=this._trackRoll,N=w-this.rotation.z;Math.abs(N)>=.001&&(this.rotation.z+=N/D,Math.abs(w-this.rotation.z)<=.001&&(this.rotation.z=w))},t.prototype.dispose=function(){this.inputs.clear(),D.prototype.dispose.call(this)},t.prototype.getClassName=function(){return"FlyCamera"},Object(Z.c)([Object(Ie.o)()],t.prototype,"ellipsoid",void 0),Object(Z.c)([Object(Ie.o)()],t.prototype,"ellipsoidOffset",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"checkCollisions",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"applyGravity",void 0),t}(Nn),Gn=function(D){function t(w){return D.call(this,w)||this}return Object(Z.d)(t,D),t.prototype.addKeyboard=function(){return this.add(new yn),this},t.prototype.addMouseWheel=function(){return this.add(new bn),this},t.prototype.addPointers=function(){return this.add(new Tn),this},t.prototype.addVRDeviceOrientation=function(){return console.warn("DeviceOrientation support not yet implemented for FollowCamera."),this},t}(rn);we.a.AddNodeConstructor("FollowCamera",(function(D,w){return function(){return new Hn(D,z.e.Zero(),w)}})),we.a.AddNodeConstructor("ArcFollowCamera",(function(D,w){return function(){return new Xn(D,0,0,1,null,w)}}));var Yn,Hn=function(D){function t(w,N,F,k){void 0===k&&(k=null);var j=D.call(this,w,N,F)||this;return j.radius=12,j.lowerRadiusLimit=null,j.upperRadiusLimit=null,j.rotationOffset=0,j.lowerRotationOffsetLimit=null,j.upperRotationOffsetLimit=null,j.heightOffset=4,j.lowerHeightOffsetLimit=null,j.upperHeightOffsetLimit=null,j.cameraAcceleration=.05,j.maxCameraSpeed=20,j.lockedTarget=k,j.inputs=new Gn(j),j.inputs.addKeyboard().addMouseWheel().addPointers(),j}return Object(Z.d)(t,D),t.prototype._follow=function(D){if(D){var w;if(D.rotationQuaternion){var N=new z.a;D.rotationQuaternion.toRotationMatrix(N),w=Math.atan2(N.m[8],N.m[10])}else w=D.rotation.y;var F=Dt.b.ToRadians(this.rotationOffset)+w,k=D.getAbsolutePosition(),j=k.x+Math.sin(F)*this.radius,G=k.z+Math.cos(F)*this.radius,H=j-this.position.x,X=k.y+this.heightOffset-this.position.y,q=G-this.position.z,Z=H*this.cameraAcceleration*2,J=X*this.cameraAcceleration,$=q*this.cameraAcceleration*2;(Z>this.maxCameraSpeed||Z<-this.maxCameraSpeed)&&(Z=Z<1?-this.maxCameraSpeed:this.maxCameraSpeed),(J>this.maxCameraSpeed||J<-this.maxCameraSpeed)&&(J=J<1?-this.maxCameraSpeed:this.maxCameraSpeed),($>this.maxCameraSpeed||$<-this.maxCameraSpeed)&&($=$<1?-this.maxCameraSpeed:this.maxCameraSpeed),this.position=new z.e(this.position.x+Z,this.position.y+J,this.position.z+$),this.setTarget(k)}},t.prototype.attachControl=function(D,w){this.inputs.attachElement(D,w),this._reset=function(){}},t.prototype.detachControl=function(D){this.inputs.detachElement(D),this._reset&&this._reset()},t.prototype._checkInputs=function(){this.inputs.checkInputs(),this._checkLimits(),D.prototype._checkInputs.call(this),this.lockedTarget&&this._follow(this.lockedTarget)},t.prototype._checkLimits=function(){null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit),null!==this.lowerHeightOffsetLimit&&this.heightOffset<this.lowerHeightOffsetLimit&&(this.heightOffset=this.lowerHeightOffsetLimit),null!==this.upperHeightOffsetLimit&&this.heightOffset>this.upperHeightOffsetLimit&&(this.heightOffset=this.upperHeightOffsetLimit),null!==this.lowerRotationOffsetLimit&&this.rotationOffset<this.lowerRotationOffsetLimit&&(this.rotationOffset=this.lowerRotationOffsetLimit),null!==this.upperRotationOffsetLimit&&this.rotationOffset>this.upperRotationOffsetLimit&&(this.rotationOffset=this.upperRotationOffsetLimit)},t.prototype.getClassName=function(){return"FollowCamera"},Object(Z.c)([Object(Ie.c)()],t.prototype,"radius",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"lowerRadiusLimit",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"upperRadiusLimit",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"rotationOffset",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"lowerRotationOffsetLimit",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"upperRotationOffsetLimit",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"heightOffset",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"lowerHeightOffsetLimit",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"upperHeightOffsetLimit",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"cameraAcceleration",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"maxCameraSpeed",void 0),Object(Z.c)([Object(Ie.k)("lockedTargetId")],t.prototype,"lockedTarget",void 0),t}(Nn),Xn=function(D){function t(w,N,F,k,j,G){var H=D.call(this,w,z.e.Zero(),G)||this;return H.alpha=N,H.beta=F,H.radius=k,H.target=j,H._cartesianCoordinates=z.e.Zero(),H._follow(),H}return Object(Z.d)(t,D),t.prototype._follow=function(){if(this.target){this._cartesianCoordinates.x=this.radius*Math.cos(this.alpha)*Math.cos(this.beta),this._cartesianCoordinates.y=this.radius*Math.sin(this.beta),this._cartesianCoordinates.z=this.radius*Math.sin(this.alpha)*Math.cos(this.beta);var D=this.target.getAbsolutePosition();this.position=D.add(this._cartesianCoordinates),this.setTarget(D)}},t.prototype._checkInputs=function(){D.prototype._checkInputs.call(this),this._follow()},t.prototype.getClassName=function(){return"ArcFollowCamera"},t}(Nn),Kn=N(38),Qn=N(39);!function(D){D[D.VIVE=0]="VIVE",D[D.OCULUS=1]="OCULUS",D[D.WINDOWS=2]="WINDOWS",D[D.GEAR_VR=3]="GEAR_VR",D[D.DAYDREAM=4]="DAYDREAM",D[D.GENERIC=5]="GENERIC"}(Yn||(Yn={}));var qn,Zn,Jn=function(){function e(){}return e.InitiateController=function(D){for(var w=0,N=this._ControllerFactories;w<N.length;w++){var F=N[w];if(F.canCreate(D))return F.create(D)}if(this._DefaultControllerFactory)return this._DefaultControllerFactory(D);throw"The type of gamepad you are trying to load needs to be imported first or is not supported."},e._ControllerFactories=[],e._DefaultControllerFactory=null,e}(),$n=function(D){function t(w){var N=D.call(this,w.id,w.index,w)||this;return N.isXR=!1,N._deviceRoomPosition=z.e.Zero(),N._deviceRoomRotationQuaternion=new z.b,N.devicePosition=z.e.Zero(),N.deviceRotationQuaternion=new z.b,N.deviceScaleFactor=1,N._trackPosition=!0,N._maxRotationDistFromHeadset=Math.PI/5,N._draggedRoomRotation=0,N._leftHandSystemQuaternion=new z.b,N._deviceToWorld=z.a.Identity(),N._pointingPoseNode=null,N._workingMatrix=z.a.Identity(),N._meshAttachedObservable=new j.c,N.type=on.POSE_ENABLED,N.controllerType=Yn.GENERIC,N.position=z.e.Zero(),N.rotationQuaternion=new z.b,N._calculatedPosition=z.e.Zero(),N._calculatedRotation=new z.b,z.b.RotationYawPitchRollToRef(Math.PI,0,0,N._leftHandSystemQuaternion),N}return Object(Z.d)(t,D),t.prototype._disableTrackPosition=function(D){this._trackPosition&&(this._calculatedPosition.copyFrom(D),this._trackPosition=!1)},t.prototype.update=function(){D.prototype.update.call(this),this._updatePoseAndMesh()},t.prototype._updatePoseAndMesh=function(){if(!this.isXR){var D=this.browserGamepad.pose;if(this.updateFromDevice(D),!this._trackPosition&&Me.a.LastCreatedScene&&Me.a.LastCreatedScene.activeCamera&&Me.a.LastCreatedScene.activeCamera.devicePosition&&((w=Me.a.LastCreatedScene.activeCamera)._computeDevicePosition(),this._deviceToWorld.setTranslation(w.devicePosition),w.deviceRotationQuaternion)){var w;(w=w)._deviceRoomRotationQuaternion.toEulerAnglesToRef(z.c.Vector3[0]);var N=Math.atan2(Math.sin(z.c.Vector3[0].y-this._draggedRoomRotation),Math.cos(z.c.Vector3[0].y-this._draggedRoomRotation));if(Math.abs(N)>this._maxRotationDistFromHeadset){var F=N-(N<0?-this._maxRotationDistFromHeadset:this._maxRotationDistFromHeadset);this._draggedRoomRotation+=F;var k=Math.sin(-F),j=Math.cos(-F);this._calculatedPosition.x=this._calculatedPosition.x*j-this._calculatedPosition.z*k,this._calculatedPosition.z=this._calculatedPosition.x*k+this._calculatedPosition.z*j}}z.e.TransformCoordinatesToRef(this._calculatedPosition,this._deviceToWorld,this.devicePosition),this._deviceToWorld.getRotationMatrixToRef(this._workingMatrix),z.b.FromRotationMatrixToRef(this._workingMatrix,this.deviceRotationQuaternion),this.deviceRotationQuaternion.multiplyInPlace(this._calculatedRotation),this._mesh&&(this._mesh.position.copyFrom(this.devicePosition),this._mesh.rotationQuaternion&&this._mesh.rotationQuaternion.copyFrom(this.deviceRotationQuaternion))}},t.prototype.updateFromDevice=function(D){if(!this.isXR&&D){this.rawPose=D,D.position&&(this._deviceRoomPosition.copyFromFloats(D.position[0],D.position[1],-D.position[2]),this._mesh&&this._mesh.getScene().useRightHandedSystem&&(this._deviceRoomPosition.z*=-1),this._trackPosition&&this._deviceRoomPosition.scaleToRef(this.deviceScaleFactor,this._calculatedPosition),this._calculatedPosition.addInPlace(this.position));var w=this.rawPose;D.orientation&&w.orientation&&4===w.orientation.length&&(this._deviceRoomRotationQuaternion.copyFromFloats(w.orientation[0],w.orientation[1],-w.orientation[2],-w.orientation[3]),this._mesh&&(this._mesh.getScene().useRightHandedSystem?(this._deviceRoomRotationQuaternion.z*=-1,this._deviceRoomRotationQuaternion.w*=-1):this._deviceRoomRotationQuaternion.multiplyToRef(this._leftHandSystemQuaternion,this._deviceRoomRotationQuaternion)),this._deviceRoomRotationQuaternion.multiplyToRef(this.rotationQuaternion,this._calculatedRotation))}},t.prototype.attachToMesh=function(D){if(this._mesh&&(this._mesh.parent=null),this._mesh=D,this._poseControlledCamera&&(this._mesh.parent=this._poseControlledCamera),this._mesh.rotationQuaternion||(this._mesh.rotationQuaternion=new z.b),!this.isXR&&(this._updatePoseAndMesh(),this._pointingPoseNode)){for(var w=[],N=this._pointingPoseNode;N.parent;)w.push(N.parent),N=N.parent;w.reverse().forEach((function(D){D.computeWorldMatrix(!0)}))}this._meshAttachedObservable.notifyObservers(D)},t.prototype.attachToPoseControlledCamera=function(D){this._poseControlledCamera=D,this._mesh&&(this._mesh.parent=this._poseControlledCamera)},t.prototype.dispose=function(){this._mesh&&this._mesh.dispose(),this._mesh=null,D.prototype.dispose.call(this)},Object.defineProperty(t.prototype,"mesh",{get:function(){return this._mesh},enumerable:!0,configurable:!0}),t.prototype.getForwardRay=function(D){if(void 0===D&&(D=100),!this.mesh)return new Qn.a(z.e.Zero(),new z.e(0,0,1),D);var w=this._pointingPoseNode?this._pointingPoseNode.getWorldMatrix():this.mesh.getWorldMatrix(),N=w.getTranslation(),F=new z.e(0,0,-1),k=z.e.TransformNormal(F,w),j=z.e.Normalize(k);return new Qn.a(N,j,D)},t.POINTING_POSE="POINTING_POSE",t}(on);!function(D){D[D.A=0]="A",D[D.B=1]="B",D[D.X=2]="X",D[D.Y=3]="Y",D[D.LB=4]="LB",D[D.RB=5]="RB",D[D.Back=8]="Back",D[D.Start=9]="Start",D[D.LeftStick=10]="LeftStick",D[D.RightStick=11]="RightStick"}(qn||(qn={})),function(D){D[D.Up=12]="Up",D[D.Down=13]="Down",D[D.Left=14]="Left",D[D.Right=15]="Right"}(Zn||(Zn={}));var ei,ti,ni=function(D){function t(w,N,F,k){void 0===k&&(k=!1);var z=D.call(this,w,N,F,0,1,2,3)||this;return z._leftTrigger=0,z._rightTrigger=0,z.onButtonDownObservable=new j.c,z.onButtonUpObservable=new j.c,z.onPadDownObservable=new j.c,z.onPadUpObservable=new j.c,z._buttonA=0,z._buttonB=0,z._buttonX=0,z._buttonY=0,z._buttonBack=0,z._buttonStart=0,z._buttonLB=0,z._buttonRB=0,z._buttonLeftStick=0,z._buttonRightStick=0,z._dPadUp=0,z._dPadDown=0,z._dPadLeft=0,z._dPadRight=0,z._isXboxOnePad=!1,z.type=on.XBOX,z._isXboxOnePad=k,z}return Object(Z.d)(t,D),t.prototype.onlefttriggerchanged=function(D){this._onlefttriggerchanged=D},t.prototype.onrighttriggerchanged=function(D){this._onrighttriggerchanged=D},Object.defineProperty(t.prototype,"leftTrigger",{get:function(){return this._leftTrigger},set:function(D){this._onlefttriggerchanged&&this._leftTrigger!==D&&this._onlefttriggerchanged(D),this._leftTrigger=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rightTrigger",{get:function(){return this._rightTrigger},set:function(D){this._onrighttriggerchanged&&this._rightTrigger!==D&&this._onrighttriggerchanged(D),this._rightTrigger=D},enumerable:!0,configurable:!0}),t.prototype.onbuttondown=function(D){this._onbuttondown=D},t.prototype.onbuttonup=function(D){this._onbuttonup=D},t.prototype.ondpaddown=function(D){this._ondpaddown=D},t.prototype.ondpadup=function(D){this._ondpadup=D},t.prototype._setButtonValue=function(D,w,N){return D!==w&&(1===D&&(this._onbuttondown&&this._onbuttondown(N),this.onButtonDownObservable.notifyObservers(N)),0===D&&(this._onbuttonup&&this._onbuttonup(N),this.onButtonUpObservable.notifyObservers(N))),D},t.prototype._setDPadValue=function(D,w,N){return D!==w&&(1===D&&(this._ondpaddown&&this._ondpaddown(N),this.onPadDownObservable.notifyObservers(N)),0===D&&(this._ondpadup&&this._ondpadup(N),this.onPadUpObservable.notifyObservers(N))),D},Object.defineProperty(t.prototype,"buttonA",{get:function(){return this._buttonA},set:function(D){this._buttonA=this._setButtonValue(D,this._buttonA,qn.A)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonB",{get:function(){return this._buttonB},set:function(D){this._buttonB=this._setButtonValue(D,this._buttonB,qn.B)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonX",{get:function(){return this._buttonX},set:function(D){this._buttonX=this._setButtonValue(D,this._buttonX,qn.X)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonY",{get:function(){return this._buttonY},set:function(D){this._buttonY=this._setButtonValue(D,this._buttonY,qn.Y)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonStart",{get:function(){return this._buttonStart},set:function(D){this._buttonStart=this._setButtonValue(D,this._buttonStart,qn.Start)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonBack",{get:function(){return this._buttonBack},set:function(D){this._buttonBack=this._setButtonValue(D,this._buttonBack,qn.Back)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonLB",{get:function(){return this._buttonLB},set:function(D){this._buttonLB=this._setButtonValue(D,this._buttonLB,qn.LB)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonRB",{get:function(){return this._buttonRB},set:function(D){this._buttonRB=this._setButtonValue(D,this._buttonRB,qn.RB)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonLeftStick",{get:function(){return this._buttonLeftStick},set:function(D){this._buttonLeftStick=this._setButtonValue(D,this._buttonLeftStick,qn.LeftStick)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonRightStick",{get:function(){return this._buttonRightStick},set:function(D){this._buttonRightStick=this._setButtonValue(D,this._buttonRightStick,qn.RightStick)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dPadUp",{get:function(){return this._dPadUp},set:function(D){this._dPadUp=this._setDPadValue(D,this._dPadUp,Zn.Up)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dPadDown",{get:function(){return this._dPadDown},set:function(D){this._dPadDown=this._setDPadValue(D,this._dPadDown,Zn.Down)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dPadLeft",{get:function(){return this._dPadLeft},set:function(D){this._dPadLeft=this._setDPadValue(D,this._dPadLeft,Zn.Left)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dPadRight",{get:function(){return this._dPadRight},set:function(D){this._dPadRight=this._setDPadValue(D,this._dPadRight,Zn.Right)},enumerable:!0,configurable:!0}),t.prototype.update=function(){D.prototype.update.call(this),this._isXboxOnePad,this.buttonA=this.browserGamepad.buttons[0].value,this.buttonB=this.browserGamepad.buttons[1].value,this.buttonX=this.browserGamepad.buttons[2].value,this.buttonY=this.browserGamepad.buttons[3].value,this.buttonLB=this.browserGamepad.buttons[4].value,this.buttonRB=this.browserGamepad.buttons[5].value,this.leftTrigger=this.browserGamepad.buttons[6].value,this.rightTrigger=this.browserGamepad.buttons[7].value,this.buttonBack=this.browserGamepad.buttons[8].value,this.buttonStart=this.browserGamepad.buttons[9].value,this.buttonLeftStick=this.browserGamepad.buttons[10].value,this.buttonRightStick=this.browserGamepad.buttons[11].value,this.dPadUp=this.browserGamepad.buttons[12].value,this.dPadDown=this.browserGamepad.buttons[13].value,this.dPadLeft=this.browserGamepad.buttons[14].value,this.dPadRight=this.browserGamepad.buttons[15].value},t.prototype.dispose=function(){D.prototype.dispose.call(this),this.onButtonDownObservable.clear(),this.onButtonUpObservable.clear(),this.onPadDownObservable.clear(),this.onPadUpObservable.clear()},t}(on);!function(D){D[D.Cross=0]="Cross",D[D.Circle=1]="Circle",D[D.Square=2]="Square",D[D.Triangle=3]="Triangle",D[D.L1=4]="L1",D[D.R1=5]="R1",D[D.Share=8]="Share",D[D.Options=9]="Options",D[D.LeftStick=10]="LeftStick",D[D.RightStick=11]="RightStick"}(ei||(ei={})),function(D){D[D.Up=12]="Up",D[D.Down=13]="Down",D[D.Left=14]="Left",D[D.Right=15]="Right"}(ti||(ti={}));var ii=function(D){function t(w,N,F){var k=D.call(this,w.replace("STANDARD GAMEPAD","SONY PLAYSTATION DUALSHOCK"),N,F,0,1,2,3)||this;return k._leftTrigger=0,k._rightTrigger=0,k.onButtonDownObservable=new j.c,k.onButtonUpObservable=new j.c,k.onPadDownObservable=new j.c,k.onPadUpObservable=new j.c,k._buttonCross=0,k._buttonCircle=0,k._buttonSquare=0,k._buttonTriangle=0,k._buttonShare=0,k._buttonOptions=0,k._buttonL1=0,k._buttonR1=0,k._buttonLeftStick=0,k._buttonRightStick=0,k._dPadUp=0,k._dPadDown=0,k._dPadLeft=0,k._dPadRight=0,k.type=on.DUALSHOCK,k}return Object(Z.d)(t,D),t.prototype.onlefttriggerchanged=function(D){this._onlefttriggerchanged=D},t.prototype.onrighttriggerchanged=function(D){this._onrighttriggerchanged=D},Object.defineProperty(t.prototype,"leftTrigger",{get:function(){return this._leftTrigger},set:function(D){this._onlefttriggerchanged&&this._leftTrigger!==D&&this._onlefttriggerchanged(D),this._leftTrigger=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rightTrigger",{get:function(){return this._rightTrigger},set:function(D){this._onrighttriggerchanged&&this._rightTrigger!==D&&this._onrighttriggerchanged(D),this._rightTrigger=D},enumerable:!0,configurable:!0}),t.prototype.onbuttondown=function(D){this._onbuttondown=D},t.prototype.onbuttonup=function(D){this._onbuttonup=D},t.prototype.ondpaddown=function(D){this._ondpaddown=D},t.prototype.ondpadup=function(D){this._ondpadup=D},t.prototype._setButtonValue=function(D,w,N){return D!==w&&(1===D&&(this._onbuttondown&&this._onbuttondown(N),this.onButtonDownObservable.notifyObservers(N)),0===D&&(this._onbuttonup&&this._onbuttonup(N),this.onButtonUpObservable.notifyObservers(N))),D},t.prototype._setDPadValue=function(D,w,N){return D!==w&&(1===D&&(this._ondpaddown&&this._ondpaddown(N),this.onPadDownObservable.notifyObservers(N)),0===D&&(this._ondpadup&&this._ondpadup(N),this.onPadUpObservable.notifyObservers(N))),D},Object.defineProperty(t.prototype,"buttonCross",{get:function(){return this._buttonCross},set:function(D){this._buttonCross=this._setButtonValue(D,this._buttonCross,ei.Cross)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonCircle",{get:function(){return this._buttonCircle},set:function(D){this._buttonCircle=this._setButtonValue(D,this._buttonCircle,ei.Circle)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonSquare",{get:function(){return this._buttonSquare},set:function(D){this._buttonSquare=this._setButtonValue(D,this._buttonSquare,ei.Square)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonTriangle",{get:function(){return this._buttonTriangle},set:function(D){this._buttonTriangle=this._setButtonValue(D,this._buttonTriangle,ei.Triangle)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonOptions",{get:function(){return this._buttonOptions},set:function(D){this._buttonOptions=this._setButtonValue(D,this._buttonOptions,ei.Options)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonShare",{get:function(){return this._buttonShare},set:function(D){this._buttonShare=this._setButtonValue(D,this._buttonShare,ei.Share)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonL1",{get:function(){return this._buttonL1},set:function(D){this._buttonL1=this._setButtonValue(D,this._buttonL1,ei.L1)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonR1",{get:function(){return this._buttonR1},set:function(D){this._buttonR1=this._setButtonValue(D,this._buttonR1,ei.R1)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonLeftStick",{get:function(){return this._buttonLeftStick},set:function(D){this._buttonLeftStick=this._setButtonValue(D,this._buttonLeftStick,ei.LeftStick)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonRightStick",{get:function(){return this._buttonRightStick},set:function(D){this._buttonRightStick=this._setButtonValue(D,this._buttonRightStick,ei.RightStick)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dPadUp",{get:function(){return this._dPadUp},set:function(D){this._dPadUp=this._setDPadValue(D,this._dPadUp,ti.Up)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dPadDown",{get:function(){return this._dPadDown},set:function(D){this._dPadDown=this._setDPadValue(D,this._dPadDown,ti.Down)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dPadLeft",{get:function(){return this._dPadLeft},set:function(D){this._dPadLeft=this._setDPadValue(D,this._dPadLeft,ti.Left)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dPadRight",{get:function(){return this._dPadRight},set:function(D){this._dPadRight=this._setDPadValue(D,this._dPadRight,ti.Right)},enumerable:!0,configurable:!0}),t.prototype.update=function(){D.prototype.update.call(this),this.buttonCross=this.browserGamepad.buttons[0].value,this.buttonCircle=this.browserGamepad.buttons[1].value,this.buttonSquare=this.browserGamepad.buttons[2].value,this.buttonTriangle=this.browserGamepad.buttons[3].value,this.buttonL1=this.browserGamepad.buttons[4].value,this.buttonR1=this.browserGamepad.buttons[5].value,this.leftTrigger=this.browserGamepad.buttons[6].value,this.rightTrigger=this.browserGamepad.buttons[7].value,this.buttonShare=this.browserGamepad.buttons[8].value,this.buttonOptions=this.browserGamepad.buttons[9].value,this.buttonLeftStick=this.browserGamepad.buttons[10].value,this.buttonRightStick=this.browserGamepad.buttons[11].value,this.dPadUp=this.browserGamepad.buttons[12].value,this.dPadDown=this.browserGamepad.buttons[13].value,this.dPadLeft=this.browserGamepad.buttons[14].value,this.dPadRight=this.browserGamepad.buttons[15].value},t.prototype.dispose=function(){D.prototype.dispose.call(this),this.onButtonDownObservable.clear(),this.onButtonUpObservable.clear(),this.onPadDownObservable.clear(),this.onPadUpObservable.clear()},t}(on),ri=function(){function e(D){var w=this;if(this._scene=D,this._babylonGamepads=[],this._oneGamepadConnected=!1,this._isMonitoring=!1,this.onGamepadDisconnectedObservable=new j.c,Kn.a.IsWindowObjectExist()?(this._gamepadEventSupported="GamepadEvent"in window,this._gamepadSupport=navigator.getGamepads||navigator.webkitGetGamepads||navigator.msGetGamepads||navigator.webkitGamepads):this._gamepadEventSupported=!1,this.onGamepadConnectedObservable=new j.c((function(D){for(var N in w._babylonGamepads){var F=w._babylonGamepads[N];F&&F._isConnected&&w.onGamepadConnectedObservable.notifyObserver(D,F)}})),this._onGamepadConnectedEvent=function(D){var N,F=D.gamepad;F.index in w._babylonGamepads&&w._babylonGamepads[F.index].isConnected||(w._babylonGamepads[F.index]?((N=w._babylonGamepads[F.index]).browserGamepad=F,N._isConnected=!0):N=w._addNewGamepad(F),w.onGamepadConnectedObservable.notifyObservers(N),w._startMonitoringGamepads())},this._onGamepadDisconnectedEvent=function(D){var N=D.gamepad;for(var F in w._babylonGamepads)if(w._babylonGamepads[F].index===N.index){var k=w._babylonGamepads[F];k._isConnected=!1,w.onGamepadDisconnectedObservable.notifyObservers(k),k.dispose&&k.dispose();break}},this._gamepadSupport)if(this._updateGamepadObjects(),this._babylonGamepads.length&&this._startMonitoringGamepads(),this._gamepadEventSupported){var N=this._scene?this._scene.getEngine().getHostWindow():window;N&&(N.addEventListener("gamepadconnected",this._onGamepadConnectedEvent,!1),N.addEventListener("gamepaddisconnected",this._onGamepadDisconnectedEvent,!1))}else this._startMonitoringGamepads()}return Object.defineProperty(e.prototype,"gamepads",{get:function(){return this._babylonGamepads},enumerable:!0,configurable:!0}),e.prototype.getGamepadByType=function(D){void 0===D&&(D=on.XBOX);for(var w=0,N=this._babylonGamepads;w<N.length;w++){var F=N[w];if(F&&F.type===D)return F}return null},e.prototype.dispose=function(){this._gamepadEventSupported&&(this._onGamepadConnectedEvent&&window.removeEventListener("gamepadconnected",this._onGamepadConnectedEvent),this._onGamepadDisconnectedEvent&&window.removeEventListener("gamepaddisconnected",this._onGamepadDisconnectedEvent),this._onGamepadConnectedEvent=null,this._onGamepadDisconnectedEvent=null),this._babylonGamepads.forEach((function(D){D.dispose()})),this.onGamepadConnectedObservable.clear(),this.onGamepadDisconnectedObservable.clear(),this._oneGamepadConnected=!1,this._stopMonitoringGamepads(),this._babylonGamepads=[]},e.prototype._addNewGamepad=function(D){var w;this._oneGamepadConnected||(this._oneGamepadConnected=!0);var N=-1!==D.id.search("054c"),F=-1!==D.id.search("Xbox One");return w=F||-1!==D.id.search("Xbox 360")||-1!==D.id.search("xinput")?new ni(D.id,D.index,D,F):N?new ii(D.id,D.index,D):D.pose?Jn.InitiateController(D):new an(D.id,D.index,D),this._babylonGamepads[w.index]=w,w},e.prototype._startMonitoringGamepads=function(){this._isMonitoring||(this._isMonitoring=!0,this._scene||this._checkGamepadsStatus())},e.prototype._stopMonitoringGamepads=function(){this._isMonitoring=!1},e.prototype._checkGamepadsStatus=function(){var D=this;for(var w in this._updateGamepadObjects(),this._babylonGamepads){var N=this._babylonGamepads[w];N&&N.isConnected&&N.update()}this._isMonitoring&&!this._scene&&Ct.a.QueueNewFrame((function(){D._checkGamepadsStatus()}))},e.prototype._updateGamepadObjects=function(){for(var D=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[],w=0;w<D.length;w++){var N=D[w];if(N)if(this._babylonGamepads[N.index])this._babylonGamepads[w].browserGamepad=N,this._babylonGamepads[w].isConnected||(this._babylonGamepads[w]._isConnected=!0,this.onGamepadConnectedObservable.notifyObservers(this._babylonGamepads[w]));else{var F=this._addNewGamepad(N);this.onGamepadConnectedObservable.notifyObservers(F)}}},e}();Object.defineProperty(We.a.prototype,"gamepadManager",{get:function(){if(!this._gamepadManager){this._gamepadManager=new ri(this);var D=this._getComponent(Nt.a.NAME_GAMEPAD);D||(D=new oi(this),this._addComponent(D))}return this._gamepadManager},enumerable:!0,configurable:!0}),xn.prototype.addGamepad=function(){return this.add(new Pn),this},_n.prototype.addGamepad=function(){return this.add(new sn),this};var oi=function(){function e(D){this.name=Nt.a.NAME_GAMEPAD,this.scene=D}return e.prototype.register=function(){this.scene._beforeCameraUpdateStage.registerStep(Nt.a.STEP_BEFORECAMERAUPDATE_GAMEPAD,this,this._beforeCameraUpdate)},e.prototype.rebuild=function(){},e.prototype.dispose=function(){var D=this.scene._gamepadManager;D&&(D.dispose(),this.scene._gamepadManager=null)},e.prototype._beforeCameraUpdate=function(){var D=this.scene._gamepadManager;D&&D._isMonitoring&&D._checkGamepadsStatus()},e}();we.a.AddNodeConstructor("FreeCamera",(function(D,w){return function(){return new ai(D,z.e.Zero(),w)}}));var ai=function(D){function t(w,N,F){var k=D.call(this,w,N,F)||this;return k.inputs.addGamepad(),k}return Object(Z.d)(t,D),Object.defineProperty(t.prototype,"gamepadAngularSensibility",{get:function(){var D=this.inputs.attached.gamepad;return D?D.gamepadAngularSensibility:0},set:function(D){var w=this.inputs.attached.gamepad;w&&(w.gamepadAngularSensibility=D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gamepadMoveSensibility",{get:function(){var D=this.inputs.attached.gamepad;return D?D.gamepadMoveSensibility:0},set:function(D){var w=this.inputs.attached.gamepad;w&&(w.gamepadMoveSensibility=D)},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"UniversalCamera"},t}(Bn);Xt.a._createDefaultParsedCamera=function(D,w){return new ai(D,z.e.Zero(),w)},we.a.AddNodeConstructor("GamepadCamera",(function(D,w){return function(){return new si(D,z.e.Zero(),w)}}));var si=function(D){function t(w,N,F){return D.call(this,w,N,F)||this}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"GamepadCamera"},t}(ai),ui=N(34),li=N(8);li.a.ShadersStore.postprocessVertexShader="\nattribute vec2 position;\nuniform vec2 scale;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) {\nvUV=(position*madd+madd)*scale;\ngl_Position=vec4(position,0.0,1.0);\n}";var hi=N(95),di=N(31);di.a.prototype.createRenderTargetTexture=function(D,w){var N=new hi.a;void 0!==w&&"object"==typeof w?(N.generateMipMaps=w.generateMipMaps,N.generateDepthBuffer=!!w.generateDepthBuffer,N.generateStencilBuffer=!!w.generateStencilBuffer,N.type=void 0===w.type?ce.a.TEXTURETYPE_UNSIGNED_INT:w.type,N.samplingMode=void 0===w.samplingMode?ce.a.TEXTURE_TRILINEAR_SAMPLINGMODE:w.samplingMode,N.format=void 0===w.format?ce.a.TEXTUREFORMAT_RGBA:w.format):(N.generateMipMaps=w,N.generateDepthBuffer=!0,N.generateStencilBuffer=!1,N.type=ce.a.TEXTURETYPE_UNSIGNED_INT,N.samplingMode=ce.a.TEXTURE_TRILINEAR_SAMPLINGMODE,N.format=ce.a.TEXTUREFORMAT_RGBA),(N.type!==ce.a.TEXTURETYPE_FLOAT||this._caps.textureFloatLinearFiltering)&&(N.type!==ce.a.TEXTURETYPE_HALF_FLOAT||this._caps.textureHalfFloatLinearFiltering)||(N.samplingMode=ce.a.TEXTURE_NEAREST_SAMPLINGMODE),N.type!==ce.a.TEXTURETYPE_FLOAT||this._caps.textureFloat||(N.type=ce.a.TEXTURETYPE_UNSIGNED_INT,oe.a.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type"));var F=this._gl,k=new $t.a(this,$t.b.RenderTarget),j=D.width||D,z=D.height||D,G=D.layers||0,H=this._getSamplingParameters(N.samplingMode,!!N.generateMipMaps),X=0!==G?F.TEXTURE_2D_ARRAY:F.TEXTURE_2D,q=this._getRGBABufferInternalSizedFormat(N.type,N.format),Z=this._getInternalFormat(N.format),J=this._getWebGLTextureType(N.type);this._bindTextureDirectly(X,k),0!==G?(k.is2DArray=!0,F.texImage3D(X,0,q,j,z,G,0,Z,J,null)):F.texImage2D(X,0,q,j,z,0,Z,J,null),F.texParameteri(X,F.TEXTURE_MAG_FILTER,H.mag),F.texParameteri(X,F.TEXTURE_MIN_FILTER,H.min),F.texParameteri(X,F.TEXTURE_WRAP_S,F.CLAMP_TO_EDGE),F.texParameteri(X,F.TEXTURE_WRAP_T,F.CLAMP_TO_EDGE),N.generateMipMaps&&this._gl.generateMipmap(X),this._bindTextureDirectly(X,null);var $=F.createFramebuffer();return this._bindUnboundFramebuffer($),k._depthStencilBuffer=this._setupFramebufferDepthAttachments(!!N.generateStencilBuffer,N.generateDepthBuffer,j,z),k.is2DArray||F.framebufferTexture2D(F.FRAMEBUFFER,F.COLOR_ATTACHMENT0,F.TEXTURE_2D,k._webGLTexture,0),this._bindUnboundFramebuffer(null),k._framebuffer=$,k.baseWidth=j,k.baseHeight=z,k.width=j,k.height=z,k.depth=G,k.isReady=!0,k.samples=1,k.generateMipMaps=!!N.generateMipMaps,k.samplingMode=N.samplingMode,k.type=N.type,k.format=N.format,k._generateDepthBuffer=N.generateDepthBuffer,k._generateStencilBuffer=!!N.generateStencilBuffer,this._internalTexturesCache.push(k),k},di.a.prototype.createDepthStencilTexture=function(D,w){if(w.isCube){var N=D.width||D;return this._createDepthStencilCubeTexture(N,w)}return this._createDepthStencilTexture(D,w)},di.a.prototype._createDepthStencilTexture=function(D,w){var N=this._gl,F=D.layers||0,k=0!==F?N.TEXTURE_2D_ARRAY:N.TEXTURE_2D,j=new $t.a(this,$t.b.Depth);if(!this._caps.depthTextureExtension)return oe.a.Error("Depth texture is not supported by your browser or hardware."),j;var z=Object(Z.a)({bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1},w);this._bindTextureDirectly(k,j,!0),this._setupDepthStencilTexture(j,D,z.generateStencil,z.bilinearFiltering,z.comparisonFunction);var G=z.generateStencil?N.UNSIGNED_INT_24_8:N.UNSIGNED_INT,H=z.generateStencil?N.DEPTH_STENCIL:N.DEPTH_COMPONENT,X=H;return this.webGLVersion>1&&(X=z.generateStencil?N.DEPTH24_STENCIL8:N.DEPTH_COMPONENT24),j.is2DArray?N.texImage3D(k,0,X,j.width,j.height,F,0,H,G,null):N.texImage2D(k,0,X,j.width,j.height,0,H,G,null),this._bindTextureDirectly(k,null),j};var fi=function(){function e(D,w,N,F,k,G,H,X,q,Z,J,$,te,ie,oe){void 0===H&&(H=ce.a.TEXTURE_NEAREST_SAMPLINGMODE),void 0===Z&&(Z=null),void 0===J&&(J=ce.a.TEXTURETYPE_UNSIGNED_INT),void 0===$&&($="postprocess"),void 0===ie&&(ie=!1),void 0===oe&&(oe=ce.a.TEXTUREFORMAT_RGBA),this.name=D,this.width=-1,this.height=-1,this._outputTexture=null,this.autoClear=!0,this.alphaMode=ce.a.ALPHA_DISABLE,this.animations=new Array,this.enablePixelPerfectMode=!1,this.forceFullscreenViewport=!0,this.scaleMode=ce.a.SCALEMODE_FLOOR,this.alwaysForcePOT=!1,this._samples=1,this.adaptScaleToCurrentViewport=!1,this._reusable=!1,this._textures=new ui.a(2),this._currentRenderTextureInd=0,this._scaleRatio=new z.d(1,1),this._texelSize=z.d.Zero(),this.onActivateObservable=new j.c,this.onSizeChangedObservable=new j.c,this.onApplyObservable=new j.c,this.onBeforeRenderObservable=new j.c,this.onAfterRenderObservable=new j.c,null!=G?(this._camera=G,this._scene=G.getScene(),G.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this),this.uniqueId=this._scene.getUniqueId()):X&&(this._engine=X,this._engine.postProcesses.push(this)),this._options=k,this.renderTargetSamplingMode=H||ce.a.TEXTURE_NEAREST_SAMPLINGMODE,this._reusable=q||!1,this._textureType=J,this._textureFormat=oe,this._samplers=F||[],this._samplers.push("textureSampler"),this._fragmentUrl=w,this._vertexUrl=$,this._parameters=N||[],this._parameters.push("scale"),this._indexParameters=te,ie||this.updateEffect(Z)}return Object.defineProperty(e.prototype,"samples",{get:function(){return this._samples},set:function(D){var w=this;this._samples=Math.min(D,this._engine.getCaps().maxMSAASamples),this._textures.forEach((function(D){D.samples!==w._samples&&w._engine.updateRenderTargetTextureSampleCount(D,w._samples)}))},enumerable:!0,configurable:!0}),e.prototype.getEffectName=function(){return this._fragmentUrl},Object.defineProperty(e.prototype,"onActivate",{set:function(D){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),D&&(this._onActivateObserver=this.onActivateObservable.add(D))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onSizeChanged",{set:function(D){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(D)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onApply",{set:function(D){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(D)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onBeforeRender",{set:function(D){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(D)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onAfterRender",{set:function(D){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(D)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputTexture",{get:function(){return this._textures.data[this._currentRenderTextureInd]},set:function(D){this._forcedOutputTexture=D},enumerable:!0,configurable:!0}),e.prototype.getCamera=function(){return this._camera},Object.defineProperty(e.prototype,"texelSize",{get:function(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.copyFromFloats(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)},enumerable:!0,configurable:!0}),e.prototype.getClassName=function(){return"PostProcess"},e.prototype.getEngine=function(){return this._engine},e.prototype.getEffect=function(){return this._effect},e.prototype.shareOutputWith=function(D){return this._disposeTextures(),this._shareOutputWithPostProcess=D,this},e.prototype.useOwnOutput=function(){0==this._textures.length&&(this._textures=new ui.a(2)),this._shareOutputWithPostProcess=null},e.prototype.updateEffect=function(D,w,N,F,k,j){void 0===D&&(D=null),void 0===w&&(w=null),void 0===N&&(N=null),this._effect=this._engine.createEffect({vertex:this._vertexUrl,fragment:this._fragmentUrl},["position"],w||this._parameters,N||this._samplers,null!==D?D:"",void 0,k,j,F||this._indexParameters)},e.prototype.isReusable=function(){return this._reusable},e.prototype.markTextureDirty=function(){this.width=-1},e.prototype.activate=function(D,w,N){var F=this;void 0===w&&(w=null);var k=(D=D||this._camera).getScene(),j=k.getEngine(),z=j.getCaps().maxTextureSize,G=(w?w.width:this._engine.getRenderWidth(!0))*this._options|0,H=(w?w.height:this._engine.getRenderHeight(!0))*this._options|0,X=D.parent;!X||X.leftCamera!=D&&X.rightCamera!=D||(G/=2);var q,Z=this._options.width||G,J=this._options.height||H,$=this.renderTargetSamplingMode!==ce.a.TEXTURE_NEAREST_LINEAR&&this.renderTargetSamplingMode!==ce.a.TEXTURE_NEAREST_NEAREST&&this.renderTargetSamplingMode!==ce.a.TEXTURE_LINEAR_LINEAR;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){var te=j.currentViewport;te&&(Z*=te.width,J*=te.height)}if(($||this.alwaysForcePOT)&&(this._options.width||(Z=j.needPOTTextures?Ct.a.GetExponentOfTwo(Z,z,this.scaleMode):Z),this._options.height||(J=j.needPOTTextures?Ct.a.GetExponentOfTwo(J,z,this.scaleMode):J)),this.width!==Z||this.height!==J){if(this._textures.length>0){for(var ie=0;ie<this._textures.length;ie++)this._engine._releaseTexture(this._textures.data[ie]);this._textures.reset()}this.width=Z,this.height=J;var oe={width:this.width,height:this.height},he={generateMipMaps:$,generateDepthBuffer:N||0===D._postProcesses.indexOf(this),generateStencilBuffer:(N||0===D._postProcesses.indexOf(this))&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType,format:this._textureFormat};this._textures.push(this._engine.createRenderTargetTexture(oe,he)),this._reusable&&this._textures.push(this._engine.createRenderTargetTexture(oe,he)),this._texelSize.copyFromFloats(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)}this._textures.forEach((function(D){D.samples!==F.samples&&F._engine.updateRenderTargetTextureSampleCount(D,F.samples)}))}return this._shareOutputWithPostProcess?q=this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?(q=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height):q=this.inputTexture,this.enablePixelPerfectMode?(this._scaleRatio.copyFromFloats(G/Z,H/J),this._engine.bindFramebuffer(q,0,G,H,this.forceFullscreenViewport)):(this._scaleRatio.copyFromFloats(1,1),this._engine.bindFramebuffer(q,0,void 0,void 0,this.forceFullscreenViewport)),this.onActivateObservable.notifyObservers(D),this.autoClear&&this.alphaMode===ce.a.ALPHA_DISABLE&&this._engine.clear(this.clearColor?this.clearColor:k.clearColor,k._allowPostProcessClearColor,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2),q},Object.defineProperty(e.prototype,"isSupported",{get:function(){return this._effect.isSupported},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"aspectRatio",{get:function(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height},enumerable:!0,configurable:!0}),e.prototype.isReady=function(){return this._effect&&this._effect.isReady()},e.prototype.apply=function(){return this._effect&&this._effect.isReady()?(this._engine.enableEffect(this._effect),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this._engine.setAlphaMode(this.alphaMode),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a),D=this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?this._forcedOutputTexture:this.inputTexture,this._effect._bindTexture("textureSampler",D),this._effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._effect),this._effect):null;var D},e.prototype._disposeTextures=function(){if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this._textures.length>0)for(var D=0;D<this._textures.length;D++)this._engine._releaseTexture(this._textures.data[D]);this._textures.dispose()}},e.prototype.dispose=function(D){if(D=D||this._camera,this._disposeTextures(),this._scene){var w=this._scene.postProcesses.indexOf(this);-1!==w&&this._scene.postProcesses.splice(w,1)}else{var N=this._engine.postProcesses.indexOf(this);-1!==N&&this._engine.postProcesses.splice(N,1)}if(D){if(D.detachPostProcess(this),0===D._postProcesses.indexOf(this)&&D._postProcesses.length>0){var F=this._camera._getFirstPostProcess();F&&F.markTextureDirty()}this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear()}},e}();li.a.ShadersStore.passPixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nvoid main(void)\n{\ngl_FragColor=texture2D(textureSampler,vUV);\n}",li.a.ShadersStore.passCubePixelShader="\nvarying vec2 vUV;\nuniform samplerCube textureSampler;\nvoid main(void)\n{\nvec2 uv=vUV*2.0-1.0;\n#ifdef POSITIVEX\ngl_FragColor=textureCube(textureSampler,vec3(1.001,uv.y,uv.x));\n#endif\n#ifdef NEGATIVEX\ngl_FragColor=textureCube(textureSampler,vec3(-1.001,uv.y,uv.x));\n#endif\n#ifdef POSITIVEY\ngl_FragColor=textureCube(textureSampler,vec3(uv.y,1.001,uv.x));\n#endif\n#ifdef NEGATIVEY\ngl_FragColor=textureCube(textureSampler,vec3(uv.y,-1.001,uv.x));\n#endif\n#ifdef POSITIVEZ\ngl_FragColor=textureCube(textureSampler,vec3(uv,1.001));\n#endif\n#ifdef NEGATIVEZ\ngl_FragColor=textureCube(textureSampler,vec3(uv,-1.001));\n#endif\n}";var pi=function(D){function t(w,N,F,k,j,z,G,H){return void 0===F&&(F=null),void 0===G&&(G=ce.a.TEXTURETYPE_UNSIGNED_INT),void 0===H&&(H=!1),D.call(this,w,"pass",null,null,N,F,k,j,z,void 0,G,void 0,null,H)||this}return Object(Z.d)(t,D),t}(fi),_i=function(D){function t(w,N,F,k,j,z,G,H){void 0===F&&(F=null),void 0===G&&(G=ce.a.TEXTURETYPE_UNSIGNED_INT),void 0===H&&(H=!1);var X=D.call(this,w,"passCube",null,null,N,F,k,j,z,"#define POSITIVEX",G,void 0,null,H)||this;return X._face=0,X}return Object(Z.d)(t,D),Object.defineProperty(t.prototype,"face",{get:function(){return this._face},set:function(D){if(!(D<0||D>5))switch(this._face=D,this._face){case 0:this.updateEffect("#define POSITIVEX");break;case 1:this.updateEffect("#define NEGATIVEX");break;case 2:this.updateEffect("#define POSITIVEY");break;case 3:this.updateEffect("#define NEGATIVEY");break;case 4:this.updateEffect("#define POSITIVEZ");break;case 5:this.updateEffect("#define NEGATIVEZ")}},enumerable:!0,configurable:!0}),t}(fi);Ct.a._RescalePostProcessFactory=function(D){return new pi("rescale",1,null,ce.a.TEXTURE_BILINEAR_SAMPLINGMODE,D,!1,ce.a.TEXTURETYPE_UNSIGNED_INT)},li.a.ShadersStore.anaglyphPixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D leftSampler;\nvoid main(void)\n{\nvec4 leftFrag=texture2D(leftSampler,vUV);\nleftFrag=vec4(1.0,leftFrag.g,leftFrag.b,1.0);\nvec4 rightFrag=texture2D(textureSampler,vUV);\nrightFrag=vec4(rightFrag.r,1.0,1.0,1.0);\ngl_FragColor=vec4(rightFrag.rgb*leftFrag.rgb,1.0);\n}";var mi=function(D){function t(w,N,F,k,j,z){var G=D.call(this,w,"anaglyph",null,["leftSampler"],N,F[1],k,j,z)||this;return G._passedProcess=F[0]._rigPostProcess,G.onApplyObservable.add((function(D){D.setTextureFromPostProcess("leftSampler",G._passedProcess)})),G}return Object(Z.d)(t,D),t}(fi);Xt.a._setStereoscopicAnaglyphRigMode=function(D){D._rigCameras[0]._rigPostProcess=new pi(D.name+"_passthru",1,D._rigCameras[0]),D._rigCameras[1]._rigPostProcess=new mi(D.name+"_anaglyph",1,D._rigCameras)},we.a.AddNodeConstructor("AnaglyphArcRotateCamera",(function(D,w,N){return function(){return new gi(D,0,0,1,z.e.Zero(),N.interaxial_distance,w)}}));var gi=function(D){function t(w,N,F,k,j,z,G){var H=D.call(this,w,N,F,k,j,G)||this;return H.interaxialDistance=z,H.setCameraRigMode(Xt.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:z}),H}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"AnaglyphArcRotateCamera"},t}(kn);we.a.AddNodeConstructor("AnaglyphFreeCamera",(function(D,w,N){return function(){return new vi(D,z.e.Zero(),N.interaxial_distance,w)}}));var vi=function(D){function t(w,N,F,k){var j=D.call(this,w,N,k)||this;return j.interaxialDistance=F,j.setCameraRigMode(Xt.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:F}),j}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"AnaglyphFreeCamera"},t}(Fn);we.a.AddNodeConstructor("AnaglyphGamepadCamera",(function(D,w,N){return function(){return new yi(D,z.e.Zero(),N.interaxial_distance,w)}}));var yi=function(D){function t(w,N,F,k){var j=D.call(this,w,N,k)||this;return j.interaxialDistance=F,j.setCameraRigMode(Xt.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:F}),j}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"AnaglyphGamepadCamera"},t}(si);we.a.AddNodeConstructor("AnaglyphUniversalCamera",(function(D,w,N){return function(){return new bi(D,z.e.Zero(),N.interaxial_distance,w)}}));var bi=function(D){function t(w,N,F,k){var j=D.call(this,w,N,k)||this;return j.interaxialDistance=F,j.setCameraRigMode(Xt.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:F}),j}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"AnaglyphUniversalCamera"},t}(ai);li.a.ShadersStore.stereoscopicInterlacePixelShader="const vec3 TWO=vec3(2.0,2.0,2.0);\nvarying vec2 vUV;\nuniform sampler2D camASampler;\nuniform sampler2D textureSampler;\nuniform vec2 stepSize;\nvoid main(void)\n{\nbool useCamA;\nbool useCamB;\nvec2 texCoord1;\nvec2 texCoord2;\nvec3 frag1;\nvec3 frag2;\n#ifdef IS_STEREOSCOPIC_HORIZ\nuseCamB=vUV.x>0.5;\nuseCamA=!useCamB;\ntexCoord1=vec2(useCamB ? (vUV.x-0.5)*2.0 : vUV.x*2.0,vUV.y);\ntexCoord2=vec2(texCoord1.x+stepSize.x,vUV.y);\n#else\n#ifdef IS_STEREOSCOPIC_INTERLACED\nfloat rowNum=floor(vUV.y/stepSize.y);\nuseCamA=mod(rowNum,2.0) == 1.0;\nuseCamB=mod(rowNum,2.0) == 0.0;\ntexCoord1=vec2(vUV.x,vUV.y);\ntexCoord2=vec2(vUV.x,vUV.y);\n#else\nuseCamB=vUV.y>0.5;\nuseCamA=!useCamB;\ntexCoord1=vec2(vUV.x,useCamB ? (vUV.y-0.5)*2.0 : vUV.y*2.0);\ntexCoord2=vec2(vUV.x,texCoord1.y+stepSize.y);\n#endif\n#endif\n\nif (useCamB){\nfrag1=texture2D(textureSampler,texCoord1).rgb;\nfrag2=texture2D(textureSampler,texCoord2).rgb;\n}else if (useCamA){\nfrag1=texture2D(camASampler ,texCoord1).rgb;\nfrag2=texture2D(camASampler ,texCoord2).rgb;\n}else {\ndiscard;\n}\ngl_FragColor=vec4((frag1+frag2)/TWO,1.0);\n}\n";var Ti=function(D){function t(w,N,F,k,j,G,H){var X=D.call(this,w,"stereoscopicInterlace",["stepSize"],["camASampler"],1,N[1],j,G,H,k?"#define IS_STEREOSCOPIC_INTERLACED 1":F?"#define IS_STEREOSCOPIC_HORIZ 1":void 0)||this;return X._passedProcess=N[0]._rigPostProcess,X._stepSize=new z.d(1/X.width,1/X.height),X.onSizeChangedObservable.add((function(){X._stepSize=new z.d(1/X.width,1/X.height)})),X.onApplyObservable.add((function(D){D.setTextureFromPostProcess("camASampler",X._passedProcess),D.setFloat2("stepSize",X._stepSize.x,X._stepSize.y)})),X}return Object(Z.d)(t,D),t}(fi),Ei=function(D){function t(w,N,F,k,j,G){var H=D.call(this,w,"stereoscopicInterlace",["stepSize"],["camASampler"],1,N[1],k,j,G,F?"#define IS_STEREOSCOPIC_HORIZ 1":void 0)||this;return H._passedProcess=N[0]._rigPostProcess,H._stepSize=new z.d(1/H.width,1/H.height),H.onSizeChangedObservable.add((function(){H._stepSize=new z.d(1/H.width,1/H.height)})),H.onApplyObservable.add((function(D){D.setTextureFromPostProcess("camASampler",H._passedProcess),D.setFloat2("stepSize",H._stepSize.x,H._stepSize.y)})),H}return Object(Z.d)(t,D),t}(fi);Xt.a._setStereoscopicRigMode=function(D){var w=D.cameraRigMode===Xt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL||D.cameraRigMode===Xt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED,N=D.cameraRigMode===Xt.a.RIG_MODE_STEREOSCOPIC_INTERLACED;D._rigCameras[0]._rigPostProcess=new pi(D.name+"_passthru",1,D._rigCameras[0]),D._rigCameras[1]._rigPostProcess=new Ti(D.name+"_stereoInterlace",D._rigCameras,w,N)},we.a.AddNodeConstructor("StereoscopicArcRotateCamera",(function(D,w,N){return function(){return new Si(D,0,0,1,z.e.Zero(),N.interaxial_distance,N.isStereoscopicSideBySide,w)}}));var Si=function(D){function t(w,N,F,k,j,z,G,H){var X=D.call(this,w,N,F,k,j,H)||this;return X.interaxialDistance=z,X.isStereoscopicSideBySide=G,X.setCameraRigMode(G?Xt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:Xt.a.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:z}),X}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"StereoscopicArcRotateCamera"},t}(kn);we.a.AddNodeConstructor("StereoscopicFreeCamera",(function(D,w,N){return function(){return new Mi(D,z.e.Zero(),N.interaxial_distance,N.isStereoscopicSideBySide,w)}}));var Mi=function(D){function t(w,N,F,k,j){var z=D.call(this,w,N,j)||this;return z.interaxialDistance=F,z.isStereoscopicSideBySide=k,z.setCameraRigMode(k?Xt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:Xt.a.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:F}),z}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"StereoscopicFreeCamera"},t}(Fn);we.a.AddNodeConstructor("StereoscopicGamepadCamera",(function(D,w,N){return function(){return new xi(D,z.e.Zero(),N.interaxial_distance,N.isStereoscopicSideBySide,w)}}));var xi=function(D){function t(w,N,F,k,j){var z=D.call(this,w,N,j)||this;return z.interaxialDistance=F,z.isStereoscopicSideBySide=k,z.setCameraRigMode(k?Xt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:Xt.a.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:F}),z}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"StereoscopicGamepadCamera"},t}(si);we.a.AddNodeConstructor("StereoscopicFreeCamera",(function(D,w,N){return function(){return new Ai(D,z.e.Zero(),N.interaxial_distance,N.isStereoscopicSideBySide,w)}}));var Ai=function(D){function t(w,N,F,k,j){var z=D.call(this,w,N,j)||this;return z.interaxialDistance=F,z.isStereoscopicSideBySide=k,z.setCameraRigMode(k?Xt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:Xt.a.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:F}),z}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"StereoscopicUniversalCamera"},t}(ai);we.a.AddNodeConstructor("VirtualJoysticksCamera",(function(D,w){return function(){return new Pi(D,z.e.Zero(),w)}}));var Pi=function(D){function t(w,N,F){var k=D.call(this,w,N,F)||this;return k.inputs.addVirtualJoystick(),k}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"VirtualJoysticksCamera"},t}(Fn),Ci=function(){function e(){this.compensateDistortion=!0,this.multiviewEnabled=!1}return Object.defineProperty(e.prototype,"aspectRatio",{get:function(){return this.hResolution/(2*this.vResolution)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"aspectRatioFov",{get:function(){return 2*Math.atan(this.postProcessScaleFactor*this.vScreenSize/(2*this.eyeToScreenDistance))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leftHMatrix",{get:function(){var D=4*(this.hScreenSize/4-this.lensSeparationDistance/2)/this.hScreenSize;return z.a.Translation(D,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightHMatrix",{get:function(){var D=4*(this.hScreenSize/4-this.lensSeparationDistance/2)/this.hScreenSize;return z.a.Translation(-D,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leftPreViewMatrix",{get:function(){return z.a.Translation(.5*this.interpupillaryDistance,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightPreViewMatrix",{get:function(){return z.a.Translation(-.5*this.interpupillaryDistance,0,0)},enumerable:!0,configurable:!0}),e.GetDefault=function(){var D=new e;return D.hResolution=1280,D.vResolution=800,D.hScreenSize=.149759993,D.vScreenSize=.0935999975,D.vScreenCenter=.0467999987,D.eyeToScreenDistance=.0410000011,D.lensSeparationDistance=.063500002,D.interpupillaryDistance=.064000003,D.distortionK=[1,.219999999,.239999995,0],D.chromaAbCorrection=[.995999992,-.00400000019,1.01400006,0],D.postProcessScaleFactor=1.714605507808412,D.lensCenterOffset=.151976421,D},e}();li.a.ShadersStore.vrDistortionCorrectionPixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform vec2 LensCenter;\nuniform vec2 Scale;\nuniform vec2 ScaleIn;\nuniform vec4 HmdWarpParam;\nvec2 HmdWarp(vec2 in01) {\nvec2 theta=(in01-LensCenter)*ScaleIn;\nfloat rSq=theta.x*theta.x+theta.y*theta.y;\nvec2 rvector=theta*(HmdWarpParam.x+HmdWarpParam.y*rSq+HmdWarpParam.z*rSq*rSq+HmdWarpParam.w*rSq*rSq*rSq);\nreturn LensCenter+Scale*rvector;\n}\nvoid main(void)\n{\nvec2 tc=HmdWarp(vUV);\nif (tc.x <0.0 || tc.x>1.0 || tc.y<0.0 || tc.y>1.0)\ngl_FragColor=vec4(0.0,0.0,0.0,0.0);\nelse{\ngl_FragColor=texture2D(textureSampler,tc);\n}\n}";var Oi=function(D){function t(w,N,F,k){var j=D.call(this,w,"vrDistortionCorrection",["LensCenter","Scale","ScaleIn","HmdWarpParam"],null,k.postProcessScaleFactor,N,Jt.a.BILINEAR_SAMPLINGMODE)||this;return j._isRightEye=F,j._distortionFactors=k.distortionK,j._postProcessScaleFactor=k.postProcessScaleFactor,j._lensCenterOffset=k.lensCenterOffset,j.adaptScaleToCurrentViewport=!0,j.onSizeChangedObservable.add((function(){j._scaleIn=new z.d(2,2/j.aspectRatio),j._scaleFactor=new z.d(1/j._postProcessScaleFactor*.5,1/j._postProcessScaleFactor*.5*j.aspectRatio),j._lensCenter=new z.d(j._isRightEye?.5-.5*j._lensCenterOffset:.5+.5*j._lensCenterOffset,.5)})),j.onApplyObservable.add((function(D){D.setFloat2("LensCenter",j._lensCenter.x,j._lensCenter.y),D.setFloat2("Scale",j._scaleFactor.x,j._scaleFactor.y),D.setFloat2("ScaleIn",j._scaleIn.x,j._scaleIn.y),D.setFloat4("HmdWarpParam",j._distortionFactors[0],j._distortionFactors[1],j._distortionFactors[2],j._distortionFactors[3])})),j}return Object(Z.d)(t,D),t}(fi);li.a.ShadersStore.vrMultiviewToSingleviewPixelShader="precision mediump sampler2DArray;\nvarying vec2 vUV;\nuniform sampler2DArray multiviewSampler;\nuniform int imageIndex;\nvoid main(void)\n{\ngl_FragColor=texture(multiviewSampler,vec3(vUV,imageIndex));\n}";var Ri=N(83),Di=N(90),Ii=N(91);di.a.prototype.createRenderTargetCubeTexture=function(D,w){var N=Object(Z.a)({generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:ce.a.TEXTURETYPE_UNSIGNED_INT,samplingMode:ce.a.TEXTURE_TRILINEAR_SAMPLINGMODE,format:ce.a.TEXTUREFORMAT_RGBA},w);N.generateStencilBuffer=N.generateDepthBuffer&&N.generateStencilBuffer,(N.type!==ce.a.TEXTURETYPE_FLOAT||this._caps.textureFloatLinearFiltering)&&(N.type!==ce.a.TEXTURETYPE_HALF_FLOAT||this._caps.textureHalfFloatLinearFiltering)||(N.samplingMode=ce.a.TEXTURE_NEAREST_SAMPLINGMODE);var F=this._gl,k=new $t.a(this,$t.b.RenderTarget);this._bindTextureDirectly(F.TEXTURE_CUBE_MAP,k,!0);var j=this._getSamplingParameters(N.samplingMode,N.generateMipMaps);N.type!==ce.a.TEXTURETYPE_FLOAT||this._caps.textureFloat||(N.type=ce.a.TEXTURETYPE_UNSIGNED_INT,oe.a.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),F.texParameteri(F.TEXTURE_CUBE_MAP,F.TEXTURE_MAG_FILTER,j.mag),F.texParameteri(F.TEXTURE_CUBE_MAP,F.TEXTURE_MIN_FILTER,j.min),F.texParameteri(F.TEXTURE_CUBE_MAP,F.TEXTURE_WRAP_S,F.CLAMP_TO_EDGE),F.texParameteri(F.TEXTURE_CUBE_MAP,F.TEXTURE_WRAP_T,F.CLAMP_TO_EDGE);for(var z=0;z<6;z++)F.texImage2D(F.TEXTURE_CUBE_MAP_POSITIVE_X+z,0,this._getRGBABufferInternalSizedFormat(N.type,N.format),D,D,0,this._getInternalFormat(N.format),this._getWebGLTextureType(N.type),null);var G=F.createFramebuffer();return this._bindUnboundFramebuffer(G),k._depthStencilBuffer=this._setupFramebufferDepthAttachments(N.generateStencilBuffer,N.generateDepthBuffer,D,D),N.generateMipMaps&&F.generateMipmap(F.TEXTURE_CUBE_MAP),this._bindTextureDirectly(F.TEXTURE_CUBE_MAP,null),this._bindUnboundFramebuffer(null),k._framebuffer=G,k.width=D,k.height=D,k.isReady=!0,k.isCube=!0,k.samples=1,k.generateMipMaps=N.generateMipMaps,k.samplingMode=N.samplingMode,k.type=N.type,k.format=N.format,k._generateDepthBuffer=N.generateDepthBuffer,k._generateStencilBuffer=N.generateStencilBuffer,this._internalTexturesCache.push(k),k};var Li=function(D){function t(w,N,F,k,G,H,X,q,Z,J,$,te,ie){void 0===G&&(G=!0),void 0===H&&(H=ce.a.TEXTURETYPE_UNSIGNED_INT),void 0===X&&(X=!1),void 0===q&&(q=Jt.a.TRILINEAR_SAMPLINGMODE),void 0===Z&&(Z=!0),void 0===J&&(J=!1),void 0===$&&($=!1),void 0===te&&(te=ce.a.TEXTUREFORMAT_RGBA),void 0===ie&&(ie=!1);var oe=D.call(this,null,F,!k)||this;return oe.isCube=X,oe.renderParticles=!0,oe.renderSprites=!1,oe.coordinatesMode=Jt.a.PROJECTION_MODE,oe.ignoreCameraViewport=!1,oe.onBeforeBindObservable=new j.c,oe.onAfterUnbindObservable=new j.c,oe.onBeforeRenderObservable=new j.c,oe.onAfterRenderObservable=new j.c,oe.onClearObservable=new j.c,oe.onResizeObservable=new j.c,oe._currentRefreshId=-1,oe._refreshRate=1,oe._samples=1,oe.boundingBoxPosition=z.e.Zero(),(F=oe.getScene())?(oe.renderList=new Array,oe._engine=F.getEngine(),oe.name=w,oe.isRenderTarget=!0,oe._initialSizeParameter=N,oe._processSizeParameter(N),oe._resizeObserver=oe.getScene().getEngine().onResizeObservable.add((function(){})),oe._generateMipMaps=!!k,oe._doNotChangeAspectRatio=G,oe._renderingManager=new Ii.b(F),oe._renderingManager._useSceneAutoClearSetup=!0,$||(oe._renderTargetOptions={generateMipMaps:k,type:H,format:te,samplingMode:q,generateDepthBuffer:Z,generateStencilBuffer:J},q===Jt.a.NEAREST_SAMPLINGMODE&&(oe.wrapU=Jt.a.CLAMP_ADDRESSMODE,oe.wrapV=Jt.a.CLAMP_ADDRESSMODE),ie||(X?(oe._texture=F.getEngine().createRenderTargetCubeTexture(oe.getRenderSize(),oe._renderTargetOptions),oe.coordinatesMode=Jt.a.INVCUBIC_MODE,oe._textureMatrix=z.a.Identity()):oe._texture=F.getEngine().createRenderTargetTexture(oe._size,oe._renderTargetOptions))),oe):oe}return Object(Z.d)(t,D),Object.defineProperty(t.prototype,"renderList",{get:function(){return this._renderList},set:function(D){this._renderList=D,this._renderList&&this._hookArray(this._renderList)},enumerable:!0,configurable:!0}),t.prototype._hookArray=function(D){var w=this,N=D.push;D.push=function(){for(var F=[],k=0;k<arguments.length;k++)F[k]=arguments[k];var j=0===D.length,z=N.apply(D,F);return j&&w.getScene().meshes.forEach((function(D){D._markSubMeshesAsLightDirty()})),z};var F=D.splice;D.splice=function(N,k){var j=F.apply(D,[N,k]);return 0===D.length&&w.getScene().meshes.forEach((function(D){D._markSubMeshesAsLightDirty()})),j}},Object.defineProperty(t.prototype,"onAfterUnbind",{set:function(D){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onBeforeRender",{set:function(D){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onAfterRender",{set:function(D){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onClear",{set:function(D){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderTargetOptions",{get:function(){return this._renderTargetOptions},enumerable:!0,configurable:!0}),t.prototype._onRatioRescale=function(){this._sizeRatio&&this.resize(this._initialSizeParameter)},Object.defineProperty(t.prototype,"boundingBoxSize",{get:function(){return this._boundingBoxSize},set:function(D){if(!this._boundingBoxSize||!this._boundingBoxSize.equals(D)){this._boundingBoxSize=D;var w=this.getScene();w&&w.markAllMaterialsAsDirty(ce.a.MATERIAL_TextureDirtyFlag)}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"depthStencilTexture",{get:function(){var D;return(null===(D=this.getInternalTexture())||void 0===D?void 0:D._depthStencilTexture)||null},enumerable:!0,configurable:!0}),t.prototype.createDepthStencilTexture=function(D,w,N){void 0===D&&(D=0),void 0===w&&(w=!0),void 0===N&&(N=!1);var F=this.getInternalTexture();if(this.getScene()&&F){var k=this.getScene().getEngine();F._depthStencilTexture=k.createDepthStencilTexture(this._size,{bilinearFiltering:w,comparisonFunction:D,generateStencil:N,isCube:this.isCube})}},t.prototype._processSizeParameter=function(D){D.ratio?(this._sizeRatio=D.ratio,this._size={width:this._bestReflectionRenderTargetDimension(this._engine.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(this._engine.getRenderHeight(),this._sizeRatio)}):this._size=D},Object.defineProperty(t.prototype,"samples",{get:function(){return this._samples},set:function(D){if(this._samples!==D){var w=this.getScene();w&&(this._samples=w.getEngine().updateRenderTargetTextureSampleCount(this._texture,D))}},enumerable:!0,configurable:!0}),t.prototype.resetRefreshCounter=function(){this._currentRefreshId=-1},Object.defineProperty(t.prototype,"refreshRate",{get:function(){return this._refreshRate},set:function(D){this._refreshRate=D,this.resetRefreshCounter()},enumerable:!0,configurable:!0}),t.prototype.addPostProcess=function(D){if(!this._postProcessManager){var w=this.getScene();if(!w)return;this._postProcessManager=new Di.a(w),this._postProcesses=new Array}this._postProcesses.push(D),this._postProcesses[0].autoClear=!1},t.prototype.clearPostProcesses=function(D){if(void 0===D&&(D=!1),this._postProcesses){if(D)for(var w=0,N=this._postProcesses;w<N.length;w++)N[w].dispose();this._postProcesses=[]}},t.prototype.removePostProcess=function(D){if(this._postProcesses){var w=this._postProcesses.indexOf(D);-1!==w&&(this._postProcesses.splice(w,1),this._postProcesses.length>0&&(this._postProcesses[0].autoClear=!1))}},t.prototype._shouldRender=function(){return-1===this._currentRefreshId||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)},t.prototype.getRenderSize=function(){return this.getRenderWidth()},t.prototype.getRenderWidth=function(){return this._size.width?this._size.width:this._size},t.prototype.getRenderHeight=function(){return this._size.width?this._size.height:this._size},t.prototype.getRenderLayers=function(){return this._size.layers||0},Object.defineProperty(t.prototype,"canRescale",{get:function(){return!0},enumerable:!0,configurable:!0}),t.prototype.scale=function(D){var w=Math.max(1,this.getRenderSize()*D);this.resize(w)},t.prototype.getReflectionTextureMatrix=function(){return this.isCube?this._textureMatrix:D.prototype.getReflectionTextureMatrix.call(this)},t.prototype.resize=function(D){var w=this.isCube;this.releaseInternalTexture();var N=this.getScene();N&&(this._processSizeParameter(D),this._texture=w?N.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):N.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this))},t.prototype.render=function(D,w){if(void 0===D&&(D=!1),void 0===w&&(w=!1),G=this.getScene()){var N,F=G.getEngine();if(void 0!==this.useCameraPostProcesses&&(D=this.useCameraPostProcesses),this._waitingRenderList){this.renderList=[];for(var k=0;k<this._waitingRenderList.length;k++){var j=this._waitingRenderList[k],z=G.getMeshByID(j);z&&this.renderList.push(z)}delete this._waitingRenderList}if(this.renderListPredicate){var G;if(this.renderList?this.renderList.length=0:this.renderList=[],!(G=this.getScene()))return;var H=G.meshes;for(k=0;k<H.length;k++){var X=H[k];this.renderListPredicate(X)&&this.renderList.push(X)}}if(this.onBeforeBindObservable.notifyObservers(this),this.activeCamera?(N=this.activeCamera,F.setViewport(this.activeCamera.viewport,this.getRenderWidth(),this.getRenderHeight()),this.activeCamera!==G.activeCamera&&G.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(!0))):(N=G.activeCamera)&&F.setViewport(N.viewport,this.getRenderWidth(),this.getRenderHeight()),this._defaultRenderListPrepared=!1,this.is2DArray)for(var q=0;q<this.getRenderLayers();q++)this.renderToTarget(0,D,w,q,N),G.incrementRenderId(),G.resetCachedMaterial();else if(this.isCube)for(var Z=0;Z<6;Z++)this.renderToTarget(Z,D,w,void 0,N),G.incrementRenderId(),G.resetCachedMaterial();else this.renderToTarget(0,D,w,void 0,N);this.onAfterUnbindObservable.notifyObservers(this),G.activeCamera&&((G.getEngine().scenes.length>1||this.activeCamera&&this.activeCamera!==G.activeCamera)&&G.setTransformMatrix(G.activeCamera.getViewMatrix(),G.activeCamera.getProjectionMatrix(!0)),F.setViewport(G.activeCamera.viewport)),G.resetCachedMaterial()}},t.prototype._bestReflectionRenderTargetDimension=function(D,w){var N=D*w,F=Ct.a.NearestPOT(N+16384/(128+N));return Math.min(Ct.a.FloorPOT(D),F)},t.prototype._prepareRenderingManager=function(D,w,N,F){var k=this.getScene();if(k){this._renderingManager.reset();for(var j=k.getRenderId(),z=0;z<w;z++){var G=D[z];if(G){if(!G.isReady(0===this.refreshRate)){this.resetRefreshCounter();continue}var H;if(G._preActivateForIntermediateRendering(j),H=!(!F||!N)&&0==(G.layerMask&N.layerMask),G.isEnabled()&&G.isVisible&&G.subMeshes&&!H&&G._activate(j,!0)&&G.subMeshes.length){G.isAnInstance?G=G.sourceMesh:G._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!1,G._internalAbstractMeshDataInfo._isActiveIntermediate=!0;for(var X=0;X<G.subMeshes.length;X++){var q=G.subMeshes[X];this._renderingManager.dispatch(q,G)}}}}for(var Z=0;Z<k.particleSystems.length;Z++){var J=k.particleSystems[Z],$=J.emitter;J.isStarted()&&$&&$.position&&$.isEnabled()&&D.indexOf($)>=0&&this._renderingManager.dispatchParticles(J)}}},t.prototype._bindFrameBuffer=function(D,w){void 0===D&&(D=0),void 0===w&&(w=0);var N=this.getScene();if(N){var F=N.getEngine();this._texture&&F.bindFramebuffer(this._texture,this.isCube?D:void 0,void 0,void 0,this.ignoreCameraViewport,0,w)}},t.prototype.unbindFrameBuffer=function(D,w){var N=this;this._texture&&D.unBindFramebuffer(this._texture,this.isCube,(function(){N.onAfterRenderObservable.notifyObservers(w)}))},t.prototype.renderToTarget=function(D,w,N,F,k){void 0===F&&(F=0),void 0===k&&(k=null);var j=this.getScene();if(j){var z=j.getEngine();if(this._texture){this._postProcessManager?this._postProcessManager._prepareFrame(this._texture,this._postProcesses):w&&j.postProcessManager._prepareFrame(this._texture)||this._bindFrameBuffer(D,F),this.is2DArray?this.onBeforeRenderObservable.notifyObservers(F):this.onBeforeRenderObservable.notifyObservers(D);var G=null,H=this.renderList?this.renderList:j.getActiveMeshes().data,X=this.renderList?this.renderList.length:j.getActiveMeshes().length;this.getCustomRenderList&&(G=this.getCustomRenderList(this.is2DArray?F:D,H,X)),G?this._prepareRenderingManager(G,G.length,k,!1):(this._defaultRenderListPrepared||(this._prepareRenderingManager(H,X,k,!this.renderList),this._defaultRenderListPrepared=!0),G=H),this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(z):z.clear(this.clearColor||j.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||j.updateTransformMatrix(!0);for(var q=0,Z=j._beforeRenderTargetDrawStage;q<Z.length;q++)Z[q].action(this);this._renderingManager.render(this.customRenderFunction,G,this.renderParticles,this.renderSprites);for(var J=0,$=j._afterRenderTargetDrawStage;J<$.length;J++)$[J].action(this);this._postProcessManager?this._postProcessManager._finalizeFrame(!1,this._texture,D,this._postProcesses,this.ignoreCameraViewport):w&&j.postProcessManager._finalizeFrame(!1,this._texture,D),this._doNotChangeAspectRatio||j.updateTransformMatrix(!0),N&&Dt.b.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),z),this.isCube&&5!==D?this.onAfterRenderObservable.notifyObservers(D):(this.isCube&&5===D&&z.generateMipMapsForCubemap(this._texture),this.unbindFrameBuffer(z,D))}}},t.prototype.setRenderingOrder=function(D,w,N,F){void 0===w&&(w=null),void 0===N&&(N=null),void 0===F&&(F=null),this._renderingManager.setRenderingOrder(D,w,N,F)},t.prototype.setRenderingAutoClearDepthStencil=function(D,w){this._renderingManager.setRenderingAutoClearDepthStencil(D,w),this._renderingManager._useSceneAutoClearSetup=!1},t.prototype.clone=function(){var D=this.getSize(),w=new t(this.name,D,this.getScene(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer);return w.hasAlpha=this.hasAlpha,w.level=this.level,w.coordinatesMode=this.coordinatesMode,this.renderList&&(w.renderList=this.renderList.slice(0)),w},t.prototype.serialize=function(){if(!this.name)return null;var w=D.prototype.serialize.call(this);if(w.renderTargetSize=this.getRenderSize(),w.renderList=[],this.renderList)for(var N=0;N<this.renderList.length;N++)w.renderList.push(this.renderList[N].id);return w},t.prototype.disposeFramebufferObjects=function(){var D=this.getInternalTexture(),w=this.getScene();D&&w&&w.getEngine()._releaseFramebufferObjects(D)},t.prototype.dispose=function(){this.onResizeObservable.clear(),this.onClearObservable.clear(),this.onAfterRenderObservable.clear(),this.onAfterUnbindObservable.clear(),this.onBeforeBindObservable.clear(),this.onBeforeRenderObservable.clear(),this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this.clearPostProcesses(!0),this._resizeObserver&&(this.getScene().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this.renderList=null;var w=this.getScene();if(w){var N=w.customRenderTargets.indexOf(this);N>=0&&w.customRenderTargets.splice(N,1);for(var F=0,k=w.cameras;F<k.length;F++){var j=k[F];(N=j.customRenderTargets.indexOf(this))>=0&&j.customRenderTargets.splice(N,1)}this.depthStencilTexture&&this.getScene().getEngine()._releaseTexture(this.depthStencilTexture),D.prototype.dispose.call(this)}},t.prototype._rebuild=function(){this.refreshRate===t.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=t.REFRESHRATE_RENDER_ONCE),this._postProcessManager&&this._postProcessManager._rebuild()},t.prototype.freeRenderingGroups=function(){this._renderingManager&&this._renderingManager.freeRenderingGroups()},t.prototype.getViewCount=function(){return 1},t.REFRESHRATE_RENDER_ONCE=0,t.REFRESHRATE_RENDER_ONEVERYFRAME=1,t.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,t}(Jt.a);Jt.a._CreateRenderTargetTexture=function(D,w,N,F){return new Li(D,w,N,F)};var wi=function(D){function t(w,N){void 0===N&&(N=512);var F=D.call(this,"multiview rtt",N,w,!1,!0,$t.b.Unknown,!1,void 0,!1,!1,!0,void 0,!0)||this,k=w.getEngine().createMultiviewRenderTargetTexture(F.getRenderWidth(),F.getRenderHeight());return k.isMultiview=!0,k.format=ce.a.TEXTUREFORMAT_RGBA,F._texture=k,F.samples=F._engine.getCaps().maxSamples||F.samples,F}return Object(Z.d)(t,D),t.prototype._bindFrameBuffer=function(D){void 0===D&&(D=0),this._texture&&this.getScene().getEngine().bindMultiviewFramebuffer(this._texture)},t.prototype.getViewCount=function(){return 2},t}(Li),Ni=N(86);Ct.a.prototype.createMultiviewRenderTargetTexture=function(D,w){var N=this._gl;if(!this.getCaps().multiview)throw"Multiview is not supported";var F=new $t.a(this,$t.b.Unknown,!0);return F.width=D,F.height=w,F._framebuffer=N.createFramebuffer(),F._colorTextureArray=N.createTexture(),N.bindTexture(N.TEXTURE_2D_ARRAY,F._colorTextureArray),N.texStorage3D(N.TEXTURE_2D_ARRAY,1,N.RGBA8,D,w,2),F._depthStencilTextureArray=N.createTexture(),N.bindTexture(N.TEXTURE_2D_ARRAY,F._depthStencilTextureArray),N.texStorage3D(N.TEXTURE_2D_ARRAY,1,N.DEPTH32F_STENCIL8,D,w,2),F.isReady=!0,F},Ct.a.prototype.bindMultiviewFramebuffer=function(D){var w=this._gl,N=this.getCaps().oculusMultiview||this.getCaps().multiview;if(this.bindFramebuffer(D,void 0,void 0,void 0,!0),w.bindFramebuffer(w.DRAW_FRAMEBUFFER,D._framebuffer),!D._colorTextureArray||!D._depthStencilTextureArray)throw"Invalid multiview frame buffer";this.getCaps().oculusMultiview?(N.framebufferTextureMultisampleMultiviewOVR(w.DRAW_FRAMEBUFFER,w.COLOR_ATTACHMENT0,D._colorTextureArray,0,D.samples,0,2),N.framebufferTextureMultisampleMultiviewOVR(w.DRAW_FRAMEBUFFER,w.DEPTH_STENCIL_ATTACHMENT,D._depthStencilTextureArray,0,D.samples,0,2)):(N.framebufferTextureMultiviewOVR(w.DRAW_FRAMEBUFFER,w.COLOR_ATTACHMENT0,D._colorTextureArray,0,0,2),N.framebufferTextureMultiviewOVR(w.DRAW_FRAMEBUFFER,w.DEPTH_STENCIL_ATTACHMENT,D._depthStencilTextureArray,0,0,2))},Xt.a.prototype._useMultiviewToSingleView=!1,Xt.a.prototype._multiviewTexture=null,Xt.a.prototype._resizeOrCreateMultiviewTexture=function(D,w){this._multiviewTexture?this._multiviewTexture.getRenderWidth()==D&&this._multiviewTexture.getRenderHeight()==w||(this._multiviewTexture.dispose(),this._multiviewTexture=new wi(this.getScene(),{width:D,height:w})):this._multiviewTexture=new wi(this.getScene(),{width:D,height:w})},We.a.prototype._transformMatrixR=z.a.Zero(),We.a.prototype._multiviewSceneUbo=null,We.a.prototype._createMultiviewUbo=function(){this._multiviewSceneUbo=new Ri.a(this.getEngine(),void 0,!0),this._multiviewSceneUbo.addUniform("viewProjection",16),this._multiviewSceneUbo.addUniform("viewProjectionR",16),this._multiviewSceneUbo.addUniform("view",16)},We.a.prototype._updateMultiviewUbo=function(D,w){D&&w&&D.multiplyToRef(w,this._transformMatrixR),D&&w&&(D.multiplyToRef(w,z.c.Matrix[0]),Ni.a.GetRightPlaneToRef(z.c.Matrix[0],this._frustumPlanes[3])),this._multiviewSceneUbo&&(this._multiviewSceneUbo.updateMatrix("viewProjection",this.getTransformMatrix()),this._multiviewSceneUbo.updateMatrix("viewProjectionR",this._transformMatrixR),this._multiviewSceneUbo.updateMatrix("view",this._viewMatrix),this._multiviewSceneUbo.update())},We.a.prototype._renderMultiviewToSingleView=function(D){D._resizeOrCreateMultiviewTexture(D._rigPostProcess&&D._rigPostProcess&&D._rigPostProcess.width>0?D._rigPostProcess.width:this.getEngine().getRenderWidth(!0),D._rigPostProcess&&D._rigPostProcess&&D._rigPostProcess.height>0?D._rigPostProcess.height:this.getEngine().getRenderHeight(!0)),this._multiviewSceneUbo||this._createMultiviewUbo(),D.outputRenderTarget=D._multiviewTexture,this._renderForCamera(D),D.outputRenderTarget=null;for(var w=0;w<D._rigCameras.length;w++){var N=this.getEngine();this._activeCamera=D._rigCameras[w],N.setViewport(this._activeCamera.viewport),this.postProcessManager&&(this.postProcessManager._prepareFrame(),this.postProcessManager._finalizeFrame(this._activeCamera.isIntermediate))}};var Fi=function(D){function t(w,N,F){var k=D.call(this,w,"vrMultiviewToSingleview",["imageIndex"],["multiviewSampler"],F,N,Jt.a.BILINEAR_SAMPLINGMODE)||this;return k.onSizeChangedObservable.add((function(){})),k.onApplyObservable.add((function(D){N._scene.activeCamera&&N._scene.activeCamera.isLeftCamera?D.setInt("imageIndex",0):D.setInt("imageIndex",1),D.setTexture("multiviewSampler",N._multiviewTexture)})),k}return Object(Z.d)(t,D),t}(fi),Bi=N(61);Xt.a._setVRRigMode=function(D,w){var N=w.vrCameraMetrics||Ci.GetDefault();D._rigCameras[0]._cameraRigParams.vrMetrics=N,D._rigCameras[0].viewport=new Bi.a(0,0,.5,1),D._rigCameras[0]._cameraRigParams.vrWorkMatrix=new z.a,D._rigCameras[0]._cameraRigParams.vrHMatrix=N.leftHMatrix,D._rigCameras[0]._cameraRigParams.vrPreViewMatrix=N.leftPreViewMatrix,D._rigCameras[0].getProjectionMatrix=D._rigCameras[0]._getVRProjectionMatrix,D._rigCameras[1]._cameraRigParams.vrMetrics=N,D._rigCameras[1].viewport=new Bi.a(.5,0,.5,1),D._rigCameras[1]._cameraRigParams.vrWorkMatrix=new z.a,D._rigCameras[1]._cameraRigParams.vrHMatrix=N.rightHMatrix,D._rigCameras[1]._cameraRigParams.vrPreViewMatrix=N.rightPreViewMatrix,D._rigCameras[1].getProjectionMatrix=D._rigCameras[1]._getVRProjectionMatrix,N.multiviewEnabled&&(D.getScene().getEngine().getCaps().multiview?(D._useMultiviewToSingleView=!0,D._rigPostProcess=new Fi("VRMultiviewToSingleview",D,N.postProcessScaleFactor)):(oe.a.Warn("Multiview is not supported, falling back to standard rendering"),N.multiviewEnabled=!1)),N.compensateDistortion&&(D._rigCameras[0]._rigPostProcess=new Oi("VR_Distort_Compensation_Left",D._rigCameras[0],!1,N),D._rigCameras[1]._rigPostProcess=new Oi("VR_Distort_Compensation_Right",D._rigCameras[1],!0,N))},we.a.AddNodeConstructor("VRDeviceOrientationFreeCamera",(function(D,w){return function(){return new ki(D,0,0,1,z.e.Zero(),w)}}));var ki=function(D){function t(w,N,F,k,j,z,G,H){void 0===G&&(G=!0),void 0===H&&(H=Ci.GetDefault());var X=D.call(this,w,N,F,k,j,z)||this;return H.compensateDistortion=G,X.setCameraRigMode(Xt.a.RIG_MODE_VR,{vrCameraMetrics:H}),X.inputs.addVRDeviceOrientation(),X}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"VRDeviceOrientationArcRotateCamera"},t}(kn);we.a.AddNodeConstructor("VRDeviceOrientationFreeCamera",(function(D,w){return function(){return new Ui(D,z.e.Zero(),w)}}));var Ui=function(D){function t(w,N,F,k,j){void 0===k&&(k=!0),void 0===j&&(j=Ci.GetDefault());var z=D.call(this,w,N,F)||this;return j.compensateDistortion=k,z.setCameraRigMode(Xt.a.RIG_MODE_VR,{vrCameraMetrics:j}),z}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"VRDeviceOrientationFreeCamera"},t}(Un);we.a.AddNodeConstructor("VRDeviceOrientationGamepadCamera",(function(D,w){return function(){return new Vi(D,z.e.Zero(),w)}}));var Vi=function(D){function t(w,N,F,k,j){void 0===k&&(k=!0),void 0===j&&(j=Ci.GetDefault());var z=D.call(this,w,N,F,k,j)||this;return z.inputs.addGamepad(),z}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"VRDeviceOrientationGamepadCamera"},t}(Ui),ji=N(80);Xt.a._setWebVRRigMode=function(D,w){if(w.vrDisplay){var N=w.vrDisplay.getEyeParameters("left"),F=w.vrDisplay.getEyeParameters("right");D._rigCameras[0].viewport=new Bi.a(0,0,.5,1),D._rigCameras[0].setCameraRigParameter("left",!0),D._rigCameras[0].setCameraRigParameter("specs",w.specs),D._rigCameras[0].setCameraRigParameter("eyeParameters",N),D._rigCameras[0].setCameraRigParameter("frameData",w.frameData),D._rigCameras[0].setCameraRigParameter("parentCamera",w.parentCamera),D._rigCameras[0]._cameraRigParams.vrWorkMatrix=new z.a,D._rigCameras[0].getProjectionMatrix=D._getWebVRProjectionMatrix,D._rigCameras[0].parent=D,D._rigCameras[0]._getViewMatrix=D._getWebVRViewMatrix,D._rigCameras[1].viewport=new Bi.a(.5,0,.5,1),D._rigCameras[1].setCameraRigParameter("eyeParameters",F),D._rigCameras[1].setCameraRigParameter("specs",w.specs),D._rigCameras[1].setCameraRigParameter("frameData",w.frameData),D._rigCameras[1].setCameraRigParameter("parentCamera",w.parentCamera),D._rigCameras[1]._cameraRigParams.vrWorkMatrix=new z.a,D._rigCameras[1].getProjectionMatrix=D._getWebVRProjectionMatrix,D._rigCameras[1].parent=D,D._rigCameras[1]._getViewMatrix=D._getWebVRViewMatrix}},Object.defineProperty(Ct.a.prototype,"isInVRExclusivePointerMode",{get:function(){return this._vrExclusivePointerMode},enumerable:!0,configurable:!0}),Ct.a.prototype._prepareVRComponent=function(){this._vrSupported=!1,this._vrExclusivePointerMode=!1,this.onVRDisplayChangedObservable=new j.c,this.onVRRequestPresentComplete=new j.c,this.onVRRequestPresentStart=new j.c},Ct.a.prototype.isVRDevicePresent=function(){return!!this._vrDisplay},Ct.a.prototype.getVRDevice=function(){return this._vrDisplay},Ct.a.prototype.initWebVR=function(){return this.initWebVRAsync(),this.onVRDisplayChangedObservable},Ct.a.prototype.initWebVRAsync=function(){var D=this,t=function(){var w={vrDisplay:D._vrDisplay,vrSupported:D._vrSupported};D.onVRDisplayChangedObservable.notifyObservers(w),D._webVRInitPromise=new Promise((function(D){D(w)}))};if(!this._onVrDisplayConnect){this._onVrDisplayConnect=function(w){D._vrDisplay=w.display,t()},this._onVrDisplayDisconnect=function(){D._vrDisplay.cancelAnimationFrame(D._frameHandler),D._vrDisplay=void 0,D._frameHandler=Ct.a.QueueNewFrame(D._boundRenderFunction),t()},this._onVrDisplayPresentChange=function(){D._vrExclusivePointerMode=D._vrDisplay&&D._vrDisplay.isPresenting};var w=this.getHostWindow();w&&(w.addEventListener("vrdisplayconnect",this._onVrDisplayConnect),w.addEventListener("vrdisplaydisconnect",this._onVrDisplayDisconnect),w.addEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange))}return this._webVRInitPromise=this._webVRInitPromise||this._getVRDisplaysAsync(),this._webVRInitPromise.then(t),this._webVRInitPromise},Ct.a.prototype._getVRDisplaysAsync=function(){var D=this;return new Promise((function(w){navigator.getVRDisplays?navigator.getVRDisplays().then((function(N){D._vrSupported=!0,D._vrDisplay=N[0],w({vrDisplay:D._vrDisplay,vrSupported:D._vrSupported})})):(D._vrDisplay=void 0,D._vrSupported=!1,w({vrDisplay:D._vrDisplay,vrSupported:D._vrSupported}))}))},Ct.a.prototype.enableVR=function(D){var w=this;if(this._vrDisplay&&!this._vrDisplay.isPresenting){this.onVRRequestPresentStart.notifyObservers(this);var N={highRefreshRate:!!this.vrPresentationAttributes&&this.vrPresentationAttributes.highRefreshRate,foveationLevel:this.vrPresentationAttributes?this.vrPresentationAttributes.foveationLevel:1,multiview:(this.getCaps().multiview||this.getCaps().oculusMultiview)&&D.useMultiview};this._vrDisplay.requestPresent([Object(Z.a)({source:this.getRenderingCanvas(),attributes:N},N)]).then((function(){w.onVRRequestPresentComplete.notifyObservers(!0),w._onVRFullScreenTriggered()})).catch((function(){w.onVRRequestPresentComplete.notifyObservers(!1)}))}},Ct.a.prototype._onVRFullScreenTriggered=function(){if(this._vrDisplay&&this._vrDisplay.isPresenting){this._oldSize=new Ne.a(this.getRenderWidth(),this.getRenderHeight()),this._oldHardwareScaleFactor=this.getHardwareScalingLevel();var D=this._vrDisplay.getEyeParameters("left");this.setHardwareScalingLevel(1),this.setSize(2*D.renderWidth,D.renderHeight)}else this.setHardwareScalingLevel(this._oldHardwareScaleFactor),this.setSize(this._oldSize.width,this._oldSize.height)},Ct.a.prototype.disableVR=function(){var D=this;this._vrDisplay&&this._vrDisplay.isPresenting&&this._vrDisplay.exitPresent().then((function(){return D._onVRFullScreenTriggered()})).catch((function(){return D._onVRFullScreenTriggered()})),Kn.a.IsWindowObjectExist()&&(window.removeEventListener("vrdisplaypointerrestricted",this._onVRDisplayPointerRestricted),window.removeEventListener("vrdisplaypointerunrestricted",this._onVRDisplayPointerUnrestricted),this._onVrDisplayConnect&&(window.removeEventListener("vrdisplayconnect",this._onVrDisplayConnect),this._onVrDisplayDisconnect&&window.removeEventListener("vrdisplaydisconnect",this._onVrDisplayDisconnect),this._onVrDisplayPresentChange&&window.removeEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange),this._onVrDisplayConnect=null,this._onVrDisplayDisconnect=null))},Ct.a.prototype._connectVREvents=function(D,w){var N=this;if(this._onVRDisplayPointerRestricted=function(){D&&D.requestPointerLock()},this._onVRDisplayPointerUnrestricted=function(){if(w)w.exitPointerLock&&w.exitPointerLock();else{var D=N.getHostWindow();D.document&&D.document.exitPointerLock&&D.document.exitPointerLock()}},Kn.a.IsWindowObjectExist()){var F=this.getHostWindow();F.addEventListener("vrdisplaypointerrestricted",this._onVRDisplayPointerRestricted,!1),F.addEventListener("vrdisplaypointerunrestricted",this._onVRDisplayPointerUnrestricted,!1)}},Ct.a.prototype._submitVRFrame=function(){if(this._vrDisplay&&this._vrDisplay.isPresenting)try{this._vrDisplay.submitFrame()}catch(D){Dt.b.Warn("webVR submitFrame has had an unexpected failure: "+D)}},Ct.a.prototype.isVRPresenting=function(){return this._vrDisplay&&this._vrDisplay.isPresenting},Ct.a.prototype._requestVRFrame=function(){this._frameHandler=Ct.a.QueueNewFrame(this._boundRenderFunction,this._vrDisplay)},we.a.AddNodeConstructor("WebVRFreeCamera",(function(D,w){return function(){return new zi(D,z.e.Zero(),w)}})),we.a.AddNodeConstructor("WebVRGamepadCamera",(function(D,w){return function(){return new zi(D,z.e.Zero(),w)}}));var zi=function(D){function t(w,N,F,k){void 0===k&&(k={});var G=D.call(this,w,N,F)||this;G.webVROptions=k,G._vrDevice=null,G.rawPose=null,G._specsVersion="1.1",G._attached=!1,G._descendants=[],G._deviceRoomPosition=z.e.Zero(),G._deviceRoomRotationQuaternion=z.b.Identity(),G._standingMatrix=null,G.devicePosition=z.e.Zero(),G.deviceRotationQuaternion=z.b.Identity(),G.deviceScaleFactor=1,G._deviceToWorld=z.a.Identity(),G._worldToDevice=z.a.Identity(),G.controllers=[],G.onControllersAttachedObservable=new j.c,G.onControllerMeshLoadedObservable=new j.c,G.onPoseUpdatedFromDeviceObservable=new j.c,G._poseSet=!1,G.rigParenting=!0,G._defaultHeight=void 0,G._htmlElementAttached=null,G._detachIfAttached=function(){var D=G.getEngine().getVRDevice();D&&!D.isPresenting&&G._htmlElementAttached&&G.detachControl(G._htmlElementAttached)},G._workingVector=z.e.Zero(),G._oneVector=z.e.One(),G._workingMatrix=z.a.Identity(),G._tmpMatrix=new z.a,G._cache.position=z.e.Zero(),k.defaultHeight&&(G._defaultHeight=k.defaultHeight,G.position.y=G._defaultHeight),G.minZ=.1,5===arguments.length&&(G.webVROptions=arguments[4]),null==G.webVROptions.trackPosition&&(G.webVROptions.trackPosition=!0),null==G.webVROptions.controllerMeshes&&(G.webVROptions.controllerMeshes=!0),null==G.webVROptions.defaultLightingOnControllers&&(G.webVROptions.defaultLightingOnControllers=!0),G.rotationQuaternion=new z.b,G.webVROptions&&G.webVROptions.positionScale&&(G.deviceScaleFactor=G.webVROptions.positionScale);var H=G.getEngine();return G._onVREnabled=function(D){D&&G.initControllers()},H.onVRRequestPresentComplete.add(G._onVREnabled),H.initWebVR().add((function(D){D.vrDisplay&&G._vrDevice!==D.vrDisplay&&(G._vrDevice=D.vrDisplay,G.setCameraRigMode(Xt.a.RIG_MODE_WEBVR,{parentCamera:G,vrDisplay:G._vrDevice,frameData:G._frameData,specs:G._specsVersion}),G._attached&&G.getEngine().enableVR(G.webVROptions))})),"undefined"!=typeof VRFrameData&&(G._frameData=new VRFrameData),k.useMultiview&&(G.getScene().getEngine().getCaps().multiview?(G._useMultiviewToSingleView=!0,G._rigPostProcess=new Fi("VRMultiviewToSingleview",G,1)):(oe.a.Warn("Multiview is not supported, falling back to standard rendering"),G._useMultiviewToSingleView=!1)),F.onBeforeCameraRenderObservable.add((function(D){D.parent===G&&G.rigParenting&&(G._descendants=G.getDescendants(!0,(function(D){var w=G.controllers.some((function(w){return w._mesh===D})),N=-1!==G._rigCameras.indexOf(D);return!w&&!N})),G._descendants.forEach((function(w){w.parent=D})))})),F.onAfterCameraRenderObservable.add((function(D){D.parent===G&&G.rigParenting&&G._descendants.forEach((function(D){D.parent=G}))})),G}return Object(Z.d)(t,D),t.prototype.deviceDistanceToRoomGround=function(){return this._standingMatrix?(this._standingMatrix.getTranslationToRef(this._workingVector),this._deviceRoomPosition.y+this._workingVector.y):this._defaultHeight||0},t.prototype.useStandingMatrix=function(D){var w=this;void 0===D&&(D=function(D){}),this.getEngine().initWebVRAsync().then((function(N){N.vrDisplay&&N.vrDisplay.stageParameters&&N.vrDisplay.stageParameters.sittingToStandingTransform&&w.webVROptions.trackPosition?(w._standingMatrix=new z.a,z.a.FromFloat32ArrayToRefScaled(N.vrDisplay.stageParameters.sittingToStandingTransform,0,1,w._standingMatrix),w.getScene().useRightHandedSystem||w._standingMatrix&&w._standingMatrix.toggleModelMatrixHandInPlace(),D(!0)):D(!1)}))},t.prototype.useStandingMatrixAsync=function(){var D=this;return new Promise((function(w){D.useStandingMatrix((function(D){w(D)}))}))},t.prototype.dispose=function(){this._detachIfAttached(),this.getEngine().onVRRequestPresentComplete.removeCallback(this._onVREnabled),this._updateCacheWhenTrackingDisabledObserver&&this._scene.onBeforeRenderObservable.remove(this._updateCacheWhenTrackingDisabledObserver),D.prototype.dispose.call(this)},t.prototype.getControllerByName=function(D){for(var w=0,N=this.controllers;w<N.length;w++){var F=N[w];if(F.hand===D)return F}return null},Object.defineProperty(t.prototype,"leftController",{get:function(){return this._leftController||(this._leftController=this.getControllerByName("left")),this._leftController},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rightController",{get:function(){return this._rightController||(this._rightController=this.getControllerByName("right")),this._rightController},enumerable:!0,configurable:!0}),t.prototype.getForwardRay=function(w){return void 0===w&&(w=100),this.leftCamera?D.prototype.getForwardRay.call(this,w,this.leftCamera.getWorldMatrix(),this.leftCamera.globalPosition):D.prototype.getForwardRay.call(this,w)},t.prototype._checkInputs=function(){this._vrDevice&&this._vrDevice.isPresenting&&(this._vrDevice.getFrameData(this._frameData),this.updateFromDevice(this._frameData.pose)),D.prototype._checkInputs.call(this)},t.prototype.updateFromDevice=function(D){D&&D.orientation&&4===D.orientation.length&&(this.rawPose=D,this._deviceRoomRotationQuaternion.copyFromFloats(D.orientation[0],D.orientation[1],-D.orientation[2],-D.orientation[3]),this.getScene().useRightHandedSystem&&(this._deviceRoomRotationQuaternion.z*=-1,this._deviceRoomRotationQuaternion.w*=-1),this.webVROptions.trackPosition&&this.rawPose.position&&(this._deviceRoomPosition.copyFromFloats(this.rawPose.position[0],this.rawPose.position[1],-this.rawPose.position[2]),this.getScene().useRightHandedSystem&&(this._deviceRoomPosition.z*=-1)),this._poseSet=!0)},t.prototype.attachControl=function(w,N){D.prototype.attachControl.call(this,w,N),this._attached=!0,this._htmlElementAttached=w,N=!Xt.a.ForceAttachControlToAlwaysPreventDefault&&N,this._vrDevice&&this.getEngine().enableVR(this.webVROptions);var F=this._scene.getEngine().getHostWindow();F&&F.addEventListener("vrdisplaypresentchange",this._detachIfAttached)},t.prototype.detachControl=function(w){this.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),D.prototype.detachControl.call(this,w),this._attached=!1,this.getEngine().disableVR(),window.removeEventListener("vrdisplaypresentchange",this._detachIfAttached)},t.prototype.getClassName=function(){return"WebVRFreeCamera"},t.prototype.resetToCurrentRotation=function(){this._vrDevice.resetPose()},t.prototype._updateRigCameras=function(){var D=this._rigCameras[0],w=this._rigCameras[1];D.rotationQuaternion.copyFrom(this._deviceRoomRotationQuaternion),w.rotationQuaternion.copyFrom(this._deviceRoomRotationQuaternion),D.position.copyFrom(this._deviceRoomPosition),w.position.copyFrom(this._deviceRoomPosition)},t.prototype._correctPositionIfNotTrackPosition=function(D,w){void 0===w&&(w=!1),this.rawPose&&this.rawPose.position&&!this.webVROptions.trackPosition&&(z.a.TranslationToRef(this.rawPose.position[0],this.rawPose.position[1],-this.rawPose.position[2],this._tmpMatrix),w||this._tmpMatrix.invert(),this._tmpMatrix.multiplyToRef(D,D))},t.prototype._updateCache=function(w){var N=this;this.rotationQuaternion.equals(this._cache.rotationQuaternion)&&this.position.equals(this._cache.position)||(this.updateCacheCalled||(this.updateCacheCalled=!0,this.update()),this.rotationQuaternion.toRotationMatrix(this._workingMatrix),z.e.TransformCoordinatesToRef(this._deviceRoomPosition,this._workingMatrix,this._workingVector),this.devicePosition.subtractToRef(this._workingVector,this._workingVector),z.a.ComposeToRef(this._oneVector,this.rotationQuaternion,this._workingVector,this._deviceToWorld),this._deviceToWorld.getTranslationToRef(this._workingVector),this._workingVector.addInPlace(this.position),this._workingVector.subtractInPlace(this._cache.position),this._deviceToWorld.setTranslation(this._workingVector),this._deviceToWorld.invertToRef(this._worldToDevice),this.controllers.forEach((function(D){D._deviceToWorld.copyFrom(N._deviceToWorld),N._correctPositionIfNotTrackPosition(D._deviceToWorld),D.update()}))),w||D.prototype._updateCache.call(this),this.updateCacheCalled=!1},t.prototype._computeDevicePosition=function(){z.e.TransformCoordinatesToRef(this._deviceRoomPosition,this._deviceToWorld,this.devicePosition)},t.prototype.update=function(){this._computeDevicePosition(),z.a.FromQuaternionToRef(this._deviceRoomRotationQuaternion,this._workingMatrix),this._workingMatrix.multiplyToRef(this._deviceToWorld,this._workingMatrix),z.b.FromRotationMatrixToRef(this._workingMatrix,this.deviceRotationQuaternion),this._poseSet&&this.onPoseUpdatedFromDeviceObservable.notifyObservers(null),D.prototype.update.call(this)},t.prototype._getViewMatrix=function(){return z.a.Identity()},t.prototype._getWebVRViewMatrix=function(){var D=this._cameraRigParams.parentCamera;D._updateCache();var w=this._cameraRigParams.left?this._cameraRigParams.frameData.leftViewMatrix:this._cameraRigParams.frameData.rightViewMatrix;return z.a.FromArrayToRef(w,0,this._webvrViewMatrix),this.getScene().useRightHandedSystem||this._webvrViewMatrix.toggleModelMatrixHandInPlace(),this._webvrViewMatrix.getRotationMatrixToRef(this._cameraRotationMatrix),z.e.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),1!==D.deviceScaleFactor&&(this._webvrViewMatrix.invert(),D.deviceScaleFactor&&(this._webvrViewMatrix.multiplyAtIndex(12,D.deviceScaleFactor),this._webvrViewMatrix.multiplyAtIndex(13,D.deviceScaleFactor),this._webvrViewMatrix.multiplyAtIndex(14,D.deviceScaleFactor)),this._webvrViewMatrix.invert()),D._correctPositionIfNotTrackPosition(this._webvrViewMatrix,!0),D._worldToDevice.multiplyToRef(this._webvrViewMatrix,this._webvrViewMatrix),this._workingMatrix=this._workingMatrix||z.a.Identity(),this._webvrViewMatrix.invertToRef(this._workingMatrix),this._workingMatrix.multiplyToRef(D.getWorldMatrix(),this._workingMatrix),this._workingMatrix.getTranslationToRef(this._globalPosition),this._markSyncedWithParent(),this._webvrViewMatrix},t.prototype._getWebVRProjectionMatrix=function(){var D=this.parent;D._vrDevice.depthNear=D.minZ,D._vrDevice.depthFar=D.maxZ;var w=this._cameraRigParams.left?this._cameraRigParams.frameData.leftProjectionMatrix:this._cameraRigParams.frameData.rightProjectionMatrix;return z.a.FromArrayToRef(w,0,this._projectionMatrix),this.getScene().useRightHandedSystem||this._projectionMatrix.toggleProjectionMatrixHandInPlace(),this._projectionMatrix},t.prototype.initControllers=function(){var D=this;this.controllers=[];var w=this.getScene().gamepadManager;this._onGamepadDisconnectedObserver=w.onGamepadDisconnectedObservable.add((function(w){if(w.type===on.POSE_ENABLED){var N=w;N.defaultModel&&N.defaultModel.setEnabled(!1),"right"===N.hand&&(D._rightController=null),"left"===N.hand&&(D._leftController=null);var F=D.controllers.indexOf(N);-1!==F&&D.controllers.splice(F,1)}})),this._onGamepadConnectedObserver=w.onGamepadConnectedObservable.add((function(w){if(w.type===on.POSE_ENABLED){var N=w;if(D.webVROptions.trackPosition||(N._disableTrackPosition(new z.e("left"==N.hand?-.15:.15,-.5,.25)),D._updateCacheWhenTrackingDisabledObserver||(D._updateCacheWhenTrackingDisabledObserver=D._scene.onBeforeRenderObservable.add((function(){D._updateCache()})))),N.deviceScaleFactor=D.deviceScaleFactor,N._deviceToWorld.copyFrom(D._deviceToWorld),D._correctPositionIfNotTrackPosition(N._deviceToWorld),D.webVROptions.controllerMeshes&&(N.defaultModel?N.defaultModel.setEnabled(!0):N.initControllerMesh(D.getScene(),(function(w){if(w.scaling.scaleInPlace(D.deviceScaleFactor),D.onControllerMeshLoadedObservable.notifyObservers(N),D.webVROptions.defaultLightingOnControllers){D._lightOnControllers||(D._lightOnControllers=new ji.a("vrControllersLight",new z.e(0,1,0),D.getScene()));var n=function(D,w){var N=D.getChildren();N&&0!==N.length&&N.forEach((function(D){w.includedOnlyMeshes.push(D),n(D,w)}))};D._lightOnControllers.includedOnlyMeshes.push(w),n(w,D._lightOnControllers)}}))),N.attachToPoseControlledCamera(D),-1===D.controllers.indexOf(N)){D.controllers.push(N);for(var F=!1,k=0;k<D.controllers.length;k++)D.controllers[k].controllerType===Yn.VIVE&&(F?D.controllers[k].hand="right":(F=!0,D.controllers[k].hand="left"));D.controllers.length>=2&&D.onControllersAttachedObservable.notifyObservers(D.controllers)}}}))},t}(Fn),Gi=function(D){function t(w){var N=D.call(this,w)||this;return N.onTriggerStateChangedObservable=new j.c,N.onMainButtonStateChangedObservable=new j.c,N.onSecondaryButtonStateChangedObservable=new j.c,N.onPadStateChangedObservable=new j.c,N.onPadValuesChangedObservable=new j.c,N.pad={x:0,y:0},N._changes={pressChanged:!1,touchChanged:!1,valueChanged:!1,changed:!1},N._buttons=new Array(w.buttons.length),N.hand=w.hand,N}return Object(Z.d)(t,D),t.prototype.onButtonStateChange=function(D){this._onButtonStateChange=D},Object.defineProperty(t.prototype,"defaultModel",{get:function(){return this._defaultModel},enumerable:!0,configurable:!0}),t.prototype.update=function(){D.prototype.update.call(this);for(var w=0;w<this._buttons.length;w++)this._setButtonValue(this.browserGamepad.buttons[w],this._buttons[w],w);this.leftStick.x===this.pad.x&&this.leftStick.y===this.pad.y||(this.pad.x=this.leftStick.x,this.pad.y=this.leftStick.y,this.onPadValuesChangedObservable.notifyObservers(this.pad))},t.prototype._setButtonValue=function(D,w,N){D||(D={pressed:!1,touched:!1,value:0}),w?(this._checkChanges(D,w),this._changes.changed&&(this._onButtonStateChange&&this._onButtonStateChange(this.index,N,D),this._handleButtonChange(N,D,this._changes)),this._buttons[N].pressed=D.pressed,this._buttons[N].touched=D.touched,this._buttons[N].value=D.value<1e-8?0:D.value):this._buttons[N]={pressed:D.pressed,touched:D.touched,value:D.value}},t.prototype._checkChanges=function(D,w){return this._changes.pressChanged=D.pressed!==w.pressed,this._changes.touchChanged=D.touched!==w.touched,this._changes.valueChanged=D.value!==w.value,this._changes.changed=this._changes.pressChanged||this._changes.touchChanged||this._changes.valueChanged,this._changes},t.prototype.dispose=function(){D.prototype.dispose.call(this),this._defaultModel=null,this.onTriggerStateChangedObservable.clear(),this.onMainButtonStateChangedObservable.clear(),this.onSecondaryButtonStateChangedObservable.clear(),this.onPadStateChangedObservable.clear(),this.onPadValuesChangedObservable.clear()},t}($n),Yi=N(40),Hi=N(32);di.a.prototype.createDynamicTexture=function(D,w,N,F){var k=new $t.a(this,$t.b.Dynamic);return k.baseWidth=D,k.baseHeight=w,N&&(D=this.needPOTTextures?di.a.GetExponentOfTwo(D,this._caps.maxTextureSize):D,w=this.needPOTTextures?di.a.GetExponentOfTwo(w,this._caps.maxTextureSize):w),k.width=D,k.height=w,k.isReady=!1,k.generateMipMaps=N,k.samplingMode=F,this.updateTextureSamplingMode(F,k),this._internalTexturesCache.push(k),k},di.a.prototype.updateDynamicTexture=function(D,w,N,F,k,j){if(void 0===F&&(F=!1),void 0===j&&(j=!1),D){this._bindTextureDirectly(this._gl.TEXTURE_2D,D,!0,j),this._unpackFlipY(N),F&&this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);var z=k?this._getInternalFormat(k):this._gl.RGBA;this._gl.texImage2D(this._gl.TEXTURE_2D,0,z,z,this._gl.UNSIGNED_BYTE,w),D.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),F&&this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),D.isReady=!0}};var Wi=N(70),Xi=function(D){function t(w,N,F,k,j,z){void 0===F&&(F=null),void 0===j&&(j=ce.a.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===z&&(z=ce.a.TEXTUREFORMAT_RGBA);var G=D.call(this,null,F,!k,void 0,j,void 0,void 0,void 0,void 0,z)||this;G.name=w,G._engine=G.getScene().getEngine(),G.wrapU=Jt.a.CLAMP_ADDRESSMODE,G.wrapV=Jt.a.CLAMP_ADDRESSMODE,G._generateMipMaps=k,N.getContext?(G._canvas=N,G._texture=G._engine.createDynamicTexture(N.width,N.height,k,j)):(G._canvas=Wi.a.CreateCanvas(1,1),N.width||0===N.width?G._texture=G._engine.createDynamicTexture(N.width,N.height,k,j):G._texture=G._engine.createDynamicTexture(N,N,k,j));var H=G.getSize();return G._canvas.width=H.width,G._canvas.height=H.height,G._context=G._canvas.getContext("2d"),G}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"DynamicTexture"},Object.defineProperty(t.prototype,"canRescale",{get:function(){return!0},enumerable:!0,configurable:!0}),t.prototype._recreate=function(D){this._canvas.width=D.width,this._canvas.height=D.height,this.releaseInternalTexture(),this._texture=this._engine.createDynamicTexture(D.width,D.height,this._generateMipMaps,this.samplingMode)},t.prototype.scale=function(D){var w=this.getSize();w.width*=D,w.height*=D,this._recreate(w)},t.prototype.scaleTo=function(D,w){var N=this.getSize();N.width=D,N.height=w,this._recreate(N)},t.prototype.getContext=function(){return this._context},t.prototype.clear=function(){var D=this.getSize();this._context.fillRect(0,0,D.width,D.height)},t.prototype.update=function(D,w){void 0===w&&(w=!1),this._engine.updateDynamicTexture(this._texture,this._canvas,void 0===D||D,w,this._format||void 0)},t.prototype.drawText=function(D,w,N,F,k,j,z,G){void 0===G&&(G=!0);var H=this.getSize();if(j&&(this._context.fillStyle=j,this._context.fillRect(0,0,H.width,H.height)),this._context.font=F,null==w){var X=this._context.measureText(D);w=(H.width-X.width)/2}if(null==N){var q=parseInt(F.replace(/\D/g,""));N=H.height/2+q/3.65}this._context.fillStyle=k,this._context.fillText(D,w,N),G&&this.update(z)},t.prototype.clone=function(){var D=this.getScene();if(!D)return this;var w=this.getSize(),N=new t(this.name,w,D,this._generateMipMaps);return N.hasAlpha=this.hasAlpha,N.level=this.level,N.wrapU=this.wrapU,N.wrapV=this.wrapV,N},t.prototype.serialize=function(){var w=this.getScene();w&&!w.isReady()&&oe.a.Warn("The scene must be ready before serializing the dynamic texture");var N=D.prototype.serialize.call(this);return this._canvas.toDataURL&&(N.base64String=this._canvas.toDataURL()),N.invertY=this._invertY,N.samplingMode=this.samplingMode,N},t.prototype._rebuild=function(){this.update()},t}(Jt.a),Ki=(N(99),N(58),N(100),"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n#include<imageProcessingDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\nvoid main(void)\n{\nvec4 result=texture2D(textureSampler,vUV);\n#ifdef IMAGEPROCESSING\n#ifndef FROMLINEARSPACE\n\nresult.rgb=toLinearSpace(result.rgb);\n#endif\nresult=applyImageProcessing(result);\n#else\n\n#ifdef FROMLINEARSPACE\nresult=applyImageProcessing(result);\n#endif\n#endif\ngl_FragColor=result;\n}");li.a.ShadersStore.imageProcessingPixelShader=Ki;var Qi=function(D){function t(w,N,F,k,j,z,G,H){void 0===F&&(F=null),void 0===G&&(G=ce.a.TEXTURETYPE_UNSIGNED_INT);var X=D.call(this,w,"imageProcessing",[],[],N,F,k,j,z,null,G,"postprocess",null,!0)||this;return X._fromLinearSpace=!0,X._defines={IMAGEPROCESSING:!1,VIGNETTE:!1,VIGNETTEBLENDMODEMULTIPLY:!1,VIGNETTEBLENDMODEOPAQUE:!1,TONEMAPPING:!1,TONEMAPPING_ACES:!1,CONTRAST:!1,COLORCURVES:!1,COLORGRADING:!1,COLORGRADING3D:!1,FROMLINEARSPACE:!1,SAMPLER3DGREENDEPTH:!1,SAMPLER3DBGRMAP:!1,IMAGEPROCESSINGPOSTPROCESS:!1,EXPOSURE:!1},H?(H.applyByPostProcess=!0,X._attachImageProcessingConfiguration(H,!0),X.fromLinearSpace=!1):(X._attachImageProcessingConfiguration(null,!0),X.imageProcessingConfiguration.applyByPostProcess=!0),X.onApply=function(D){X.imageProcessingConfiguration.bind(D,X.aspectRatio)},X}return Object(Z.d)(t,D),Object.defineProperty(t.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(D){D.applyByPostProcess=!0,this._attachImageProcessingConfiguration(D)},enumerable:!0,configurable:!0}),t.prototype._attachImageProcessingConfiguration=function(D,w){var N=this;if(void 0===w&&(w=!1),D!==this._imageProcessingConfiguration){if(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),D)this._imageProcessingConfiguration=D;else{var F=null,k=this.getEngine(),j=this.getCamera();if(j)F=j.getScene();else if(k&&k.scenes){var z=k.scenes;F=z[z.length-1]}else F=Me.a.LastCreatedScene;this._imageProcessingConfiguration=F.imageProcessingConfiguration}this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((function(){N._updateParameters()}))),w||this._updateParameters()}},Object.defineProperty(t.prototype,"colorCurves",{get:function(){return this.imageProcessingConfiguration.colorCurves},set:function(D){this.imageProcessingConfiguration.colorCurves=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"colorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(D){this.imageProcessingConfiguration.colorCurvesEnabled=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"colorGradingTexture",{get:function(){return this.imageProcessingConfiguration.colorGradingTexture},set:function(D){this.imageProcessingConfiguration.colorGradingTexture=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"colorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(D){this.imageProcessingConfiguration.colorGradingEnabled=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"exposure",{get:function(){return this.imageProcessingConfiguration.exposure},set:function(D){this.imageProcessingConfiguration.exposure=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"toneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(D){this._imageProcessingConfiguration.toneMappingEnabled=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"toneMappingType",{get:function(){return this._imageProcessingConfiguration.toneMappingType},set:function(D){this._imageProcessingConfiguration.toneMappingType=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"contrast",{get:function(){return this.imageProcessingConfiguration.contrast},set:function(D){this.imageProcessingConfiguration.contrast=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"vignetteStretch",{get:function(){return this.imageProcessingConfiguration.vignetteStretch},set:function(D){this.imageProcessingConfiguration.vignetteStretch=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"vignetteCentreX",{get:function(){return this.imageProcessingConfiguration.vignetteCentreX},set:function(D){this.imageProcessingConfiguration.vignetteCentreX=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"vignetteCentreY",{get:function(){return this.imageProcessingConfiguration.vignetteCentreY},set:function(D){this.imageProcessingConfiguration.vignetteCentreY=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"vignetteWeight",{get:function(){return this.imageProcessingConfiguration.vignetteWeight},set:function(D){this.imageProcessingConfiguration.vignetteWeight=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"vignetteColor",{get:function(){return this.imageProcessingConfiguration.vignetteColor},set:function(D){this.imageProcessingConfiguration.vignetteColor=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"vignetteCameraFov",{get:function(){return this.imageProcessingConfiguration.vignetteCameraFov},set:function(D){this.imageProcessingConfiguration.vignetteCameraFov=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"vignetteBlendMode",{get:function(){return this.imageProcessingConfiguration.vignetteBlendMode},set:function(D){this.imageProcessingConfiguration.vignetteBlendMode=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"vignetteEnabled",{get:function(){return this.imageProcessingConfiguration.vignetteEnabled},set:function(D){this.imageProcessingConfiguration.vignetteEnabled=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fromLinearSpace",{get:function(){return this._fromLinearSpace},set:function(D){this._fromLinearSpace!==D&&(this._fromLinearSpace=D,this._updateParameters())},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"ImageProcessingPostProcess"},t.prototype._updateParameters=function(){this._defines.FROMLINEARSPACE=this._fromLinearSpace,this.imageProcessingConfiguration.prepareDefines(this._defines,!0);var D="";for(var w in this._defines)this._defines[w]&&(D+="#define "+w+";\r\n");var N=["textureSampler"],F=["scale"];Yi.a&&(Yi.a.PrepareSamplers(N,this._defines),Yi.a.PrepareUniforms(F,this._defines)),this.updateEffect(D,F,N)},t.prototype.dispose=function(w){D.prototype.dispose.call(this,w),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration&&(this.imageProcessingConfiguration.applyByPostProcess=!1)},Object(Z.c)([Object(Ie.c)()],t.prototype,"_fromLinearSpace",void 0),t}(fi),qi=N(15),Zi=N(4);xt.a._GroundMeshParser=function(D,w){return Ji.Parse(D,w)};var Ji=function(D){function t(w,N){var F=D.call(this,w,N)||this;return F.generateOctree=!1,F}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"GroundMesh"},Object.defineProperty(t.prototype,"subdivisions",{get:function(){return Math.min(this._subdivisionsX,this._subdivisionsY)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"subdivisionsX",{get:function(){return this._subdivisionsX},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"subdivisionsY",{get:function(){return this._subdivisionsY},enumerable:!0,configurable:!0}),t.prototype.optimize=function(D,w){void 0===w&&(w=32),this._subdivisionsX=D,this._subdivisionsY=D,this.subdivide(D),this.createOrUpdateSubmeshesOctree&&this.createOrUpdateSubmeshesOctree(w)},t.prototype.getHeightAtCoordinates=function(D,w){var N=this.getWorldMatrix(),F=z.c.Matrix[5];N.invertToRef(F);var k=z.c.Vector3[8];if(z.e.TransformCoordinatesFromFloatsToRef(D,0,w,F,k),D=k.x,w=k.z,D<this._minX||D>this._maxX||w<this._minZ||w>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());var j=this._getFacetAt(D,w),G=-(j.x*D+j.z*w+j.w)/j.y;return z.e.TransformCoordinatesFromFloatsToRef(0,G,0,N,k),k.y},t.prototype.getNormalAtCoordinates=function(D,w){var N=new z.e(0,1,0);return this.getNormalAtCoordinatesToRef(D,w,N),N},t.prototype.getNormalAtCoordinatesToRef=function(D,w,N){var F=this.getWorldMatrix(),k=z.c.Matrix[5];F.invertToRef(k);var j=z.c.Vector3[8];if(z.e.TransformCoordinatesFromFloatsToRef(D,0,w,k,j),D=j.x,w=j.z,D<this._minX||D>this._maxX||w<this._minZ||w>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());var G=this._getFacetAt(D,w);return z.e.TransformNormalFromFloatsToRef(G.x,G.y,G.z,F,N),this},t.prototype.updateCoordinateHeights=function(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this},t.prototype._getFacetAt=function(D,w){var N=Math.floor((D+this._maxX)*this._subdivisionsX/this._width),F=Math.floor(-(w+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),k=this._heightQuads[F*this._subdivisionsX+N];return w<k.slope.x*D+k.slope.y?k.facet1:k.facet2},t.prototype._initHeightQuads=function(){var D=this._subdivisionsX,w=this._subdivisionsY;this._heightQuads=new Array;for(var N=0;N<w;N++)for(var F=0;F<D;F++){var k={slope:z.d.Zero(),facet1:new z.f(0,0,0,0),facet2:new z.f(0,0,0,0)};this._heightQuads[N*D+F]=k}return this},t.prototype._computeHeightQuads=function(){var D=this.getVerticesData(Zi.b.PositionKind);if(!D)return this;for(var w=z.c.Vector3[3],N=z.c.Vector3[2],F=z.c.Vector3[1],k=z.c.Vector3[0],j=z.c.Vector3[4],G=z.c.Vector3[5],H=z.c.Vector3[6],X=z.c.Vector3[7],q=z.c.Vector3[8],Z=0,J=0,$=0,te=0,ie=0,oe=0,ce=0,he=this._subdivisionsX,fe=this._subdivisionsY,pe=0;pe<fe;pe++)for(var _e=0;_e<he;_e++){Z=3*_e,J=pe*(he+1)*3,$=(pe+1)*(he+1)*3,w.x=D[J+Z],w.y=D[J+Z+1],w.z=D[J+Z+2],N.x=D[J+Z+3],N.y=D[J+Z+4],N.z=D[J+Z+5],F.x=D[$+Z],F.y=D[$+Z+1],F.z=D[$+Z+2],k.x=D[$+Z+3],k.y=D[$+Z+4],k.z=D[$+Z+5],te=(k.z-w.z)/(k.x-w.x),ie=w.z-te*w.x,N.subtractToRef(w,j),F.subtractToRef(w,G),k.subtractToRef(w,H),z.e.CrossToRef(H,G,X),z.e.CrossToRef(j,H,q),X.normalize(),q.normalize(),oe=-(X.x*w.x+X.y*w.y+X.z*w.z),ce=-(q.x*N.x+q.y*N.y+q.z*N.z);var ve=this._heightQuads[pe*he+_e];ve.slope.copyFromFloats(te,ie),ve.facet1.copyFromFloats(X.x,X.y,X.z,oe),ve.facet2.copyFromFloats(q.x,q.y,q.z,ce)}return this},t.prototype.serialize=function(w){D.prototype.serialize.call(this,w),w.subdivisionsX=this._subdivisionsX,w.subdivisionsY=this._subdivisionsY,w.minX=this._minX,w.maxX=this._maxX,w.minZ=this._minZ,w.maxZ=this._maxZ,w.width=this._width,w.height=this._height},t.Parse=function(D,w){var N=new t(D.name,w);return N._subdivisionsX=D.subdivisionsX||1,N._subdivisionsY=D.subdivisionsY||1,N._minX=D.minX,N._maxX=D.maxX,N._minZ=D.minZ,N._maxZ=D.maxZ,N._width=D.width,N._height=D.height,N},t}(xt.a);qi.a.CreateGround=function(D){var w,N,F=[],k=[],j=[],G=[],H=D.width||1,X=D.height||1,q=D.subdivisionsX||D.subdivisions||1,Z=D.subdivisionsY||D.subdivisions||1;for(w=0;w<=Z;w++)for(N=0;N<=q;N++){var J=new z.e(N*H/q-H/2,0,(Z-w)*X/Z-X/2),$=new z.e(0,1,0);k.push(J.x,J.y,J.z),j.push($.x,$.y,$.z),G.push(N/q,1-w/Z)}for(w=0;w<Z;w++)for(N=0;N<q;N++)F.push(N+1+(w+1)*(q+1)),F.push(N+1+w*(q+1)),F.push(N+w*(q+1)),F.push(N+(w+1)*(q+1)),F.push(N+1+(w+1)*(q+1)),F.push(N+w*(q+1));var te=new qi.a;return te.indices=F,te.positions=k,te.normals=j,te.uvs=G,te},qi.a.CreateTiledGround=function(D){var w,N,F,k,j=void 0!==D.xmin&&null!==D.xmin?D.xmin:-1,G=void 0!==D.zmin&&null!==D.zmin?D.zmin:-1,H=void 0!==D.xmax&&null!==D.xmax?D.xmax:1,X=void 0!==D.zmax&&null!==D.zmax?D.zmax:1,q=D.subdivisions||{w:1,h:1},Z=D.precision||{w:1,h:1},J=new Array,$=new Array,te=new Array,ie=new Array;q.h=q.h<1?1:q.h,q.w=q.w<1?1:q.w,Z.w=Z.w<1?1:Z.w,Z.h=Z.h<1?1:Z.h;var oe=(H-j)/q.w,ce=(X-G)/q.h;function v(D,F,k,j){var G=$.length/3,H=Z.w+1;for(w=0;w<Z.h;w++)for(N=0;N<Z.w;N++){var X=[G+N+w*H,G+(N+1)+w*H,G+(N+1)+(w+1)*H,G+N+(w+1)*H];J.push(X[1]),J.push(X[2]),J.push(X[3]),J.push(X[0]),J.push(X[1]),J.push(X[3])}var q=z.e.Zero(),oe=new z.e(0,1,0);for(w=0;w<=Z.h;w++)for(q.z=w*(j-F)/Z.h+F,N=0;N<=Z.w;N++)q.x=N*(k-D)/Z.w+D,q.y=0,$.push(q.x,q.y,q.z),te.push(oe.x,oe.y,oe.z),ie.push(N/Z.w,w/Z.h)}for(F=0;F<q.h;F++)for(k=0;k<q.w;k++)v(j+k*oe,G+F*ce,j+(k+1)*oe,G+(F+1)*ce);var he=new qi.a;return he.indices=J,he.positions=$,he.normals=te,he.uvs=ie,he},qi.a.CreateGroundFromHeightMap=function(D){var w,N,F=[],k=[],j=[],H=[],X=D.colorFilter||new G.a(.3,.59,.11),q=D.alphaFilter||0,Z=!1;if(D.minHeight>D.maxHeight){Z=!0;var J=D.maxHeight;D.maxHeight=D.minHeight,D.minHeight=J}for(w=0;w<=D.subdivisions;w++)for(N=0;N<=D.subdivisions;N++){var $=new z.e(N*D.width/D.subdivisions-D.width/2,0,(D.subdivisions-w)*D.height/D.subdivisions-D.height/2),te=4*((($.x+D.width/2)/D.width*(D.bufferWidth-1)|0)+((1-($.z+D.height/2)/D.height)*(D.bufferHeight-1)|0)*D.bufferWidth),ie=D.buffer[te]/255,oe=D.buffer[te+1]/255,ce=D.buffer[te+2]/255,he=D.buffer[te+3]/255;Z&&(ie=1-ie,oe=1-oe,ce=1-ce);var fe=ie*X.r+oe*X.g+ce*X.b;$.y=he>=q?D.minHeight+(D.maxHeight-D.minHeight)*fe:D.minHeight-rt.a,k.push($.x,$.y,$.z),j.push(0,0,0),H.push(N/D.subdivisions,1-w/D.subdivisions)}for(w=0;w<D.subdivisions;w++)for(N=0;N<D.subdivisions;N++){var pe=N+1+(w+1)*(D.subdivisions+1),_e=N+1+w*(D.subdivisions+1),ve=N+w*(D.subdivisions+1),ye=N+(w+1)*(D.subdivisions+1),be=k[3*pe+1]>=D.minHeight,Te=k[3*_e+1]>=D.minHeight,Ee=k[3*ve+1]>=D.minHeight;be&&Te&&Ee&&(F.push(pe),F.push(_e),F.push(ve)),k[3*ye+1]>=D.minHeight&&be&&Ee&&(F.push(ye),F.push(pe),F.push(ve))}qi.a.ComputeNormals(k,F,j);var Se=new qi.a;return Se.indices=F,Se.positions=k,Se.normals=j,Se.uvs=H,Se},xt.a.CreateGround=function(D,w,N,F,k,j){var z={width:w,height:N,subdivisions:F,updatable:j};return $i.CreateGround(D,z,k)},xt.a.CreateTiledGround=function(D,w,N,F,k,j,z,G,H){var X={xmin:w,zmin:N,xmax:F,zmax:k,subdivisions:j,precision:z,updatable:H};return $i.CreateTiledGround(D,X,G)},xt.a.CreateGroundFromHeightMap=function(D,w,N,F,k,j,z,G,H,X,q){var Z={width:N,height:F,subdivisions:k,minHeight:j,maxHeight:z,updatable:H,onReady:X,alphaFilter:q};return $i.CreateGroundFromHeightMap(D,w,Z,G)};var $i=function(){function e(){}return e.CreateGround=function(D,w,N){var F=new Ji(D,N);return F._setReady(!1),F._subdivisionsX=w.subdivisionsX||w.subdivisions||1,F._subdivisionsY=w.subdivisionsY||w.subdivisions||1,F._width=w.width||1,F._height=w.height||1,F._maxX=F._width/2,F._maxZ=F._height/2,F._minX=-F._maxX,F._minZ=-F._maxZ,qi.a.CreateGround(w).applyToMesh(F,w.updatable),F._setReady(!0),F},e.CreateTiledGround=function(D,w,N){void 0===N&&(N=null);var F=new xt.a(D,N);return qi.a.CreateTiledGround(w).applyToMesh(F,w.updatable),F},e.CreateGroundFromHeightMap=function(D,w,N,F){void 0===F&&(F=null);var k=N.width||10,j=N.height||10,z=N.subdivisions||1,H=N.minHeight||0,X=N.maxHeight||1,q=N.colorFilter||new G.a(.3,.59,.11),Z=N.alphaFilter||0,J=N.updatable,$=N.onReady;F=F||Me.a.LastCreatedScene;var te=new Ji(D,F);return te._subdivisionsX=z,te._subdivisionsY=z,te._width=k,te._height=j,te._maxX=te._width/2,te._maxZ=te._height/2,te._minX=-te._maxX,te._minZ=-te._maxZ,te._setReady(!1),Dt.b.LoadImage(w,(function(D){var w=D.width,N=D.height,G=Wi.a.CreateCanvas(w,N).getContext("2d");if(!G)throw new Error("Unable to get 2d context for CreateGroundFromHeightMap");if(!F.isDisposed){G.drawImage(D,0,0);var ie=G.getImageData(0,0,w,N).data;qi.a.CreateGroundFromHeightMap({width:k,height:j,subdivisions:z,minHeight:H,maxHeight:X,colorFilter:q,buffer:ie,bufferWidth:w,bufferHeight:N,alphaFilter:Z}).applyToMesh(te,J),$&&$(te),te._setReady(!0)}}),(function(){}),F.offlineProvider),te},e}();qi.a.CreateTorus=function(D){for(var w=[],N=[],F=[],k=[],j=D.diameter||1,G=D.thickness||.5,H=D.tessellation||16,X=0===D.sideOrientation?0:D.sideOrientation||qi.a.DEFAULTSIDE,q=H+1,Z=0;Z<=H;Z++)for(var J=Z/H,$=Z*Math.PI*2/H-Math.PI/2,te=z.a.Translation(j/2,0,0).multiply(z.a.RotationY($)),ie=0;ie<=H;ie++){var oe=1-ie/H,ce=ie*Math.PI*2/H+Math.PI,he=Math.cos(ce),fe=Math.sin(ce),pe=new z.e(he,fe,0),_e=pe.scale(G/2),ve=new z.d(J,oe);_e=z.e.TransformCoordinates(_e,te),pe=z.e.TransformNormal(pe,te),N.push(_e.x,_e.y,_e.z),F.push(pe.x,pe.y,pe.z),k.push(ve.x,ve.y);var ye=(Z+1)%q,be=(ie+1)%q;w.push(Z*q+ie),w.push(Z*q+be),w.push(ye*q+ie),w.push(Z*q+be),w.push(ye*q+be),w.push(ye*q+ie)}qi.a._ComputeSides(X,N,w,F,k,D.frontUVs,D.backUVs);var Te=new qi.a;return Te.indices=w,Te.positions=N,Te.normals=F,Te.uvs=k,Te},xt.a.CreateTorus=function(D,w,N,F,k,j,z){var G={diameter:w,thickness:N,tessellation:F,sideOrientation:z,updatable:j};return tr.CreateTorus(D,G,k)};var er,tr=function(){function e(){}return e.CreateTorus=function(D,w,N){var F=new xt.a(D,N);return w.sideOrientation=xt.a._GetDefaultSideOrientation(w.sideOrientation),F._originalBuilderSideOrientation=w.sideOrientation,qi.a.CreateTorus(w).applyToMesh(F,w.updatable),F},e}(),nr=N(59),ir=function(){function e(){}return e.GetDefaults=function(){var D=new e;return D.canvasOptions={antialias:!0,depth:!0,stencil:!1,alpha:!0,multiview:!1,framebufferScaleFactor:1},D.newCanvasCssStyle="position:absolute; bottom:0px;right:0px;z-index:10;width:90%;height:100%;background-color: #000000;",D},e}(),rr=function(){function e(D,w){var N=this;if(void 0===w&&(w=ir.GetDefaults()),this._options=w,this._canvas=null,this.xrLayer=null,this._engine=D.scene.getEngine(),w.canvasElement)this._setManagedOutputCanvas(w.canvasElement);else{var F=document.createElement("canvas");F.style.cssText=this._options.newCanvasCssStyle||"position:absolute; bottom:0px;right:0px;",this._setManagedOutputCanvas(F)}D.onXRSessionInit.add((function(){N._addCanvas()})),D.onXRSessionEnded.add((function(){N._removeCanvas()}))}return e.prototype.dispose=function(){this._removeCanvas(),this._setManagedOutputCanvas(null)},e.prototype.initializeXRLayerAsync=function(D){var w=this,i=function(){return new XRWebGLLayer(D,w.canvasContext,w._options.canvasOptions)};return this.canvasContext.makeXRCompatible?this.canvasContext.makeXRCompatible().then((function(){return w.xrLayer=i(),w.xrLayer})):(this.xrLayer=i(),Promise.resolve(this.xrLayer))},e.prototype._addCanvas=function(){this._canvas&&this._canvas!==this._engine.getRenderingCanvas()&&document.body.appendChild(this._canvas)},e.prototype._removeCanvas=function(){this._canvas&&document.body.contains(this._canvas)&&this._canvas!==this._engine.getRenderingCanvas()&&document.body.removeChild(this._canvas)},e.prototype._setManagedOutputCanvas=function(D){this._removeCanvas(),D?(this._canvas=D,this.canvasContext=this._canvas.getContext("webgl2"),this.canvasContext||(this.canvasContext=this._canvas.getContext("webgl"))):(this._canvas=null,this.canvasContext=null)},e}(),or=function(){function e(D){this.scene=D,this._sessionEnded=!1,this.baseLayer=null,this.currentTimestamp=-1,this.defaultHeightCompensation=1.7,this.onXRFrameObservable=new j.c,this.onXRReferenceSpaceChanged=new j.c,this.onXRSessionEnded=new j.c,this.onXRSessionInit=new j.c}return Object.defineProperty(e.prototype,"referenceSpace",{get:function(){return this._referenceSpace},set:function(D){this._referenceSpace=D,this.onXRReferenceSpaceChanged.notifyObservers(this._referenceSpace)},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this._sessionEnded||this.exitXRAsync(),this.onXRFrameObservable.clear(),this.onXRSessionEnded.clear(),this.onXRReferenceSpaceChanged.clear(),this.onXRSessionInit.clear()},e.prototype.exitXRAsync=function(){return this.session&&!this._sessionEnded?this.session.end().catch((function(D){oe.a.Warn("could not end XR session. It has ended already.")})):Promise.resolve()},e.prototype.getRenderTargetTextureForEye=function(D){return this._rttProvider.getRenderTargetForEye(D)},e.prototype.getWebXRRenderTarget=function(D){var w=this.scene.getEngine();return this._xrNavigator.xr.native?this._xrNavigator.xr.getWebXRRenderTarget(w):((D=D||{}).canvasElement=w.getRenderingCanvas()||void 0,new rr(this,D))},e.prototype.initializeAsync=function(){return this._xrNavigator=navigator,this._xrNavigator.xr?Promise.resolve():Promise.reject("WebXR not available")},e.prototype.initializeSessionAsync=function(D,w){var N=this;return void 0===D&&(D="immersive-vr"),void 0===w&&(w={}),this._xrNavigator.xr.requestSession(D,w).then((function(D){return N.session=D,N.onXRSessionInit.notifyObservers(D),N._sessionEnded=!1,N.session.addEventListener("end",(function(){var D=N.scene.getEngine();N._sessionEnded=!0,N._rttProvider=null,D.framebufferDimensionsObject=null,D.restoreDefaultFramebuffer(),D.customAnimationFrameRequester=null,N.onXRSessionEnded.notifyObservers(null),D._renderLoop()}),{once:!0}),N.session}))},e.prototype.isSessionSupportedAsync=function(D){return e.IsSessionSupportedAsync(D)},e.prototype.resetReferenceSpace=function(){this.referenceSpace=this.baseReferenceSpace},e.prototype.runXRRenderLoop=function(){var D=this,w=this.scene.getEngine();if(w.customAnimationFrameRequester={requestAnimationFrame:this.session.requestAnimationFrame.bind(this.session),renderFunction:function(N,F){D._sessionEnded||(D.currentFrame=F,D.currentTimestamp=N,F&&(D.onXRFrameObservable.notifyObservers(F),w.framebufferDimensionsObject=D.baseLayer,w._renderLoop(),w.framebufferDimensionsObject=null))}},this._xrNavigator.xr.native)this._rttProvider=this._xrNavigator.xr.getNativeRenderTargetProvider(this.session,this._createRenderTargetTexture.bind(this));else{var N=this._createRenderTargetTexture(this.baseLayer.framebufferWidth,this.baseLayer.framebufferHeight,this.baseLayer.framebuffer);this._rttProvider={getRenderTargetForEye:function(){return N}},w.framebufferDimensionsObject=this.baseLayer}window.cancelAnimationFrame&&window.cancelAnimationFrame(w._frameHandler),w._renderLoop()},e.prototype.setReferenceSpaceTypeAsync=function(D){var w=this;return void 0===D&&(D="local-floor"),this.session.requestReferenceSpace(D).then((function(D){return D}),(function(D){return oe.a.Error("XR.requestReferenceSpace failed for the following reason: "),oe.a.Error(D),oe.a.Log('Defaulting to universally-supported "viewer" reference space type.'),w.session.requestReferenceSpace("viewer").then((function(D){var N=new XRRigidTransform({x:0,y:-w.defaultHeightCompensation,z:0});return D.getOffsetReferenceSpace(N)}),(function(D){throw oe.a.Error(D),'XR initialization failed: required "viewer" reference space type not supported.'}))})).then((function(D){return w.referenceSpace=w.baseReferenceSpace=D,w.session.requestReferenceSpace("viewer").then((function(D){w.viewerReferenceSpace=D})),w.referenceSpace}))},e.prototype.updateRenderStateAsync=function(D){return D.baseLayer&&(this.baseLayer=D.baseLayer),this.session.updateRenderState(D)},e.IsSessionSupportedAsync=function(D){if(!navigator.xr)return Promise.resolve(!1);var w=navigator.xr.isSessionSupported||navigator.xr.supportsSession;return w?w.call(navigator.xr,D).then((function(D){var w=void 0===D||D;return Promise.resolve(w)})).catch((function(D){return oe.a.Warn(D),Promise.resolve(!1)})):Promise.resolve(!1)},e.prototype._createRenderTargetTexture=function(D,w,N){void 0===N&&(N=null);var F=new $t.a(this.scene.getEngine(),$t.b.Unknown,!0);F.width=D,F.height=w,F._framebuffer=N;var k=new Li("XR renderTargetTexture",{width:D,height:w},this.scene,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,!0);return k._texture=F,k},e}();!function(D){D[D.ENTERING_XR=0]="ENTERING_XR",D[D.EXITING_XR=1]="EXITING_XR",D[D.IN_XR=2]="IN_XR",D[D.NOT_IN_XR=3]="NOT_IN_XR"}(er||(er={}));var ar,sr=function(){function e(D,w){if(void 0===w&&(w=null),this.scene=D,this._pointerDownOnMeshAsked=!1,this._isActionableMesh=!1,this._teleportationRequestInitiated=!1,this._teleportationBackRequestInitiated=!1,this._rotationRightAsked=!1,this._rotationLeftAsked=!1,this._dpadPressed=!0,this._activePointer=!1,this._id=e._idCounter++,w)this._gazeTracker=w.clone("gazeTracker");else{this._gazeTracker=xt.a.CreateTorus("gazeTracker",.0035,.0025,20,D,!1),this._gazeTracker.bakeCurrentTransformIntoVertices(),this._gazeTracker.isPickable=!1,this._gazeTracker.isVisible=!1;var N=new Hi.a("targetMat",D);N.specularColor=G.a.Black(),N.emissiveColor=new G.a(.7,.7,.7),N.backFaceCulling=!1,this._gazeTracker.material=N}}return e.prototype._getForwardRay=function(D){return new Qn.a(z.e.Zero(),new z.e(0,0,D))},e.prototype._selectionPointerDown=function(){this._pointerDownOnMeshAsked=!0,this._currentHit&&this.scene.simulatePointerDown(this._currentHit,{pointerId:this._id})},e.prototype._selectionPointerUp=function(){this._currentHit&&this.scene.simulatePointerUp(this._currentHit,{pointerId:this._id}),this._pointerDownOnMeshAsked=!1},e.prototype._activatePointer=function(){this._activePointer=!0},e.prototype._deactivatePointer=function(){this._activePointer=!1},e.prototype._updatePointerDistance=function(D){void 0===D&&(D=100)},e.prototype.dispose=function(){this._interactionsEnabled=!1,this._teleportationEnabled=!1,this._gazeTracker&&this._gazeTracker.dispose()},e._idCounter=0,e}(),cr=function(D){function t(w,N,F){var k=D.call(this,N,F)||this;k.webVRController=w,k._laserPointer=xt.a.CreateCylinder("laserPointer",1,.004,2e-4,20,1,N,!1);var j=new Hi.a("laserPointerMat",N);if(j.emissiveColor=new G.a(.7,.7,.7),j.alpha=.6,k._laserPointer.material=j,k._laserPointer.rotation.x=Math.PI/2,k._laserPointer.position.z=-.5,k._laserPointer.isVisible=!1,k._laserPointer.isPickable=!1,!w.mesh){var z=new xt.a("preloadControllerMesh",N),H=new xt.a($n.POINTING_POSE,N);H.rotation.x=-.7,z.addChild(H),w.attachToMesh(z)}return k._setLaserPointerParent(w.mesh),k._meshAttachedObserver=w._meshAttachedObservable.add((function(D){k._setLaserPointerParent(D)})),k}return Object(Z.d)(t,D),t.prototype._getForwardRay=function(D){return this.webVRController.getForwardRay(D)},t.prototype._activatePointer=function(){D.prototype._activatePointer.call(this),this._laserPointer.isVisible=!0},t.prototype._deactivatePointer=function(){D.prototype._deactivatePointer.call(this),this._laserPointer.isVisible=!1},t.prototype._setLaserPointerColor=function(D){this._laserPointer.material.emissiveColor=D},t.prototype._setLaserPointerLightingDisabled=function(D){this._laserPointer.material.disableLighting=D},t.prototype._setLaserPointerParent=function(D){var t=function(D){D.isPickable=!1,D.getChildMeshes().forEach((function(D){t(D)}))};t(D);var w=D.getChildren(void 0,!1),N=D;this.webVRController._pointingPoseNode=null;for(var F=0;F<w.length;F++)if(w[F].name&&w[F].name.indexOf($n.POINTING_POSE)>=0){N=w[F],this.webVRController._pointingPoseNode=N;break}this._laserPointer.parent=N},t.prototype._updatePointerDistance=function(D){void 0===D&&(D=100),this._laserPointer.scaling.y=D,this._laserPointer.position.z=-D/2},t.prototype.dispose=function(){D.prototype.dispose.call(this),this._laserPointer.dispose(),this._meshAttachedObserver&&this.webVRController._meshAttachedObservable.remove(this._meshAttachedObserver)},t}(sr),ur=function(D){function t(w,N){var F=D.call(this,N)||this;return F.getCamera=w,F}return Object(Z.d)(t,D),t.prototype._getForwardRay=function(D){var w=this.getCamera();return w?w.getForwardRay(D):new Qn.a(z.e.Zero(),z.e.Forward())},t}(sr),pn=function(){},lr=function(){function e(D,w){var N=this;if(void 0===w&&(w={}),this.webVROptions=w,this._webVRsupported=!1,this._webVRready=!1,this._webVRrequesting=!1,this._webVRpresenting=!1,this._fullscreenVRpresenting=!1,this.enableGazeEvenWhenNoPointerLock=!1,this.exitVROnDoubleTap=!0,this.onEnteringVRObservable=new j.c,this.onAfterEnteringVRObservable=new j.c,this.onExitingVRObservable=new j.c,this.onControllerMeshLoadedObservable=new j.c,this._useCustomVRButton=!1,this._teleportationRequested=!1,this._teleportActive=!1,this._floorMeshesCollection=[],this._teleportationMode=e.TELEPORTATIONMODE_CONSTANTTIME,this._teleportationTime=122,this._teleportationSpeed=20,this._rotationAllowed=!0,this._teleportBackwardsVector=new z.e(0,-1,-1),this._isDefaultTeleportationTarget=!0,this._teleportationFillColor="#444444",this._teleportationBorderColor="#FFFFFF",this._rotationAngle=0,this._haloCenter=new z.e(0,0,0),this._padSensibilityUp=.65,this._padSensibilityDown=.35,this._leftController=null,this._rightController=null,this._gazeColor=new G.a(.7,.7,.7),this._laserColor=new G.a(.7,.7,.7),this._pickedLaserColor=new G.a(.2,.2,1),this._pickedGazeColor=new G.a(0,0,1),this.onNewMeshSelected=new j.c,this.onMeshSelectedWithController=new j.c,this.onNewMeshPicked=new j.c,this.onBeforeCameraTeleport=new j.c,this.onAfterCameraTeleport=new j.c,this.onSelectedMeshUnselected=new j.c,this.teleportationEnabled=!0,this._teleportationInitialized=!1,this._interactionsEnabled=!1,this._interactionsRequested=!1,this._displayGaze=!0,this._displayLaserPointer=!0,this.updateGazeTrackerScale=!0,this.updateGazeTrackerColor=!0,this.updateControllerLaserColor=!0,this.requestPointerLockOnFullScreen=!0,this.xrTestDone=!1,this._onResize=function(){N.moveButtonToBottomRight(),N._fullscreenVRpresenting&&N._webVRready&&N.exitVR()},this._onFullscreenChange=function(){var D=document;void 0!==D.fullscreen?N._fullscreenVRpresenting=document.fullscreen:void 0!==D.mozFullScreen?N._fullscreenVRpresenting=D.mozFullScreen:void 0!==D.webkitIsFullScreen?N._fullscreenVRpresenting=D.webkitIsFullScreen:void 0!==D.msIsFullScreen?N._fullscreenVRpresenting=D.msIsFullScreen:void 0!==document.msFullscreenElement&&(N._fullscreenVRpresenting=document.msFullscreenElement),!N._fullscreenVRpresenting&&N._inputElement&&(N.exitVR(),!N._useCustomVRButton&&N._btnVR&&(N._btnVR.style.top=N._inputElement.offsetTop+N._inputElement.offsetHeight-70+"px",N._btnVR.style.left=N._inputElement.offsetLeft+N._inputElement.offsetWidth-100+"px",N.updateButtonVisibility()))},this._cachedAngularSensibility={angularSensibilityX:null,angularSensibilityY:null,angularSensibility:null},this.beforeRender=function(){N._leftController&&N._leftController._activePointer&&N._castRayAndSelectObject(N._leftController),N._rightController&&N._rightController._activePointer&&N._castRayAndSelectObject(N._rightController),N._noControllerIsActive&&(N._scene.getEngine().isPointerLock||N.enableGazeEvenWhenNoPointerLock)?N._castRayAndSelectObject(N._cameraGazer):N._cameraGazer._gazeTracker.isVisible=!1},this._onNewGamepadConnected=function(D){if(D.type!==on.POSE_ENABLED)D.leftStick&&D.onleftstickchanged((function(D){N._teleportationInitialized&&N.teleportationEnabled&&(!N._leftController&&!N._rightController||N._leftController&&!N._leftController._activePointer&&N._rightController&&!N._rightController._activePointer)&&(N._checkTeleportWithRay(D,N._cameraGazer),N._checkTeleportBackwards(D,N._cameraGazer))})),D.rightStick&&D.onrightstickchanged((function(D){N._teleportationInitialized&&N._checkRotate(D,N._cameraGazer)})),D.type===on.XBOX&&(D.onbuttondown((function(D){N._interactionsEnabled&&D===qn.A&&N._cameraGazer._selectionPointerDown()})),D.onbuttonup((function(D){N._interactionsEnabled&&D===qn.A&&N._cameraGazer._selectionPointerUp()})));else{var w=D,F=new cr(w,N._scene,N._cameraGazer._gazeTracker);"right"===w.hand||N._leftController&&N._leftController.webVRController!=w?N._rightController=F:N._leftController=F,N._tryEnableInteractionOnController(F)}},this._tryEnableInteractionOnController=function(D){N._interactionsRequested&&!D._interactionsEnabled&&N._enableInteractionOnController(D),N._teleportationRequested&&!D._teleportationEnabled&&N._enableTeleportationOnController(D)},this._onNewGamepadDisconnected=function(D){D instanceof Gi&&("left"===D.hand&&null!=N._leftController&&(N._leftController.dispose(),N._leftController=null),"right"===D.hand&&null!=N._rightController&&(N._rightController.dispose(),N._rightController=null))},this._workingVector=z.e.Zero(),this._workingQuaternion=z.b.Identity(),this._workingMatrix=z.a.Identity(),this._scene=D,this._inputElement=D.getEngine().getInputElement(),"getVRDisplays"in navigator||(w.useXR=!0),void 0===w.createFallbackVRDeviceOrientationFreeCamera&&(w.createFallbackVRDeviceOrientationFreeCamera=!0),void 0===w.createDeviceOrientationCamera&&(w.createDeviceOrientationCamera=!0),void 0===w.laserToggle&&(w.laserToggle=!0),void 0===w.defaultHeight&&(w.defaultHeight=1.7),w.useCustomVRButton&&(this._useCustomVRButton=!0,w.customVRButton&&(this._btnVR=w.customVRButton)),w.rayLength&&(this._rayLength=w.rayLength),this._defaultHeight=w.defaultHeight,w.positionScale&&(this._rayLength*=w.positionScale,this._defaultHeight*=w.positionScale),this._hasEnteredVR=!1,this._scene.activeCamera?this._position=this._scene.activeCamera.position.clone():this._position=new z.e(0,this._defaultHeight,0),w.createDeviceOrientationCamera||!this._scene.activeCamera){if(this._deviceOrientationCamera=new Un("deviceOrientationVRHelper",this._position.clone(),D),this._scene.activeCamera&&(this._deviceOrientationCamera.minZ=this._scene.activeCamera.minZ,this._deviceOrientationCamera.maxZ=this._scene.activeCamera.maxZ,this._scene.activeCamera instanceof Nn&&this._scene.activeCamera.rotation)){var F=this._scene.activeCamera;F.rotationQuaternion?this._deviceOrientationCamera.rotationQuaternion.copyFrom(F.rotationQuaternion):this._deviceOrientationCamera.rotationQuaternion.copyFrom(z.b.RotationYawPitchRoll(F.rotation.y,F.rotation.x,F.rotation.z)),this._deviceOrientationCamera.rotation=F.rotation.clone()}this._scene.activeCamera=this._deviceOrientationCamera,this._inputElement&&this._scene.activeCamera.attachControl(this._inputElement)}else this._existingCamera=this._scene.activeCamera;this.webVROptions.useXR&&navigator.xr?or.IsSessionSupportedAsync("immersive-vr").then((function(F){F?(oe.a.Log("Using WebXR. It is recommended to use the WebXRDefaultExperience directly"),D.createDefaultXRExperienceAsync({floorMeshes:w.floorMeshes||[]}).then((function(w){N.xr=w,N.xrTestDone=!0,N._cameraGazer=new ur((function(){return N.xr.baseExperience.camera}),D),N.xr.baseExperience.onStateChangedObservable.add((function(D){switch(D){case er.ENTERING_XR:N.onEnteringVRObservable.notifyObservers(N),N._interactionsEnabled||N.xr.pointerSelection.detach(),N.xr.pointerSelection.displayLaserPointer=N._displayLaserPointer;break;case er.EXITING_XR:N.onExitingVRObservable.notifyObservers(N),N._scene.getEngine().resize();break;case er.IN_XR:N._hasEnteredVR=!0;break;case er.NOT_IN_XR:N._hasEnteredVR=!1}}))}))):N.completeVRInit(D,w)})):this.completeVRInit(D,w)}return Object.defineProperty(e.prototype,"onEnteringVR",{get:function(){return this.onEnteringVRObservable},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onExitingVR",{get:function(){return this.onExitingVRObservable},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onControllerMeshLoaded",{get:function(){return this.onControllerMeshLoadedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"teleportationTarget",{get:function(){return this._teleportationTarget},set:function(D){D&&(D.name="teleportationTarget",this._isDefaultTeleportationTarget=!1,this._teleportationTarget=D)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gazeTrackerMesh",{get:function(){return this._cameraGazer._gazeTracker},set:function(D){D&&(this._cameraGazer._gazeTracker&&this._cameraGazer._gazeTracker.dispose(),this._leftController&&this._leftController._gazeTracker&&this._leftController._gazeTracker.dispose(),this._rightController&&this._rightController._gazeTracker&&this._rightController._gazeTracker.dispose(),this._cameraGazer._gazeTracker=D,this._cameraGazer._gazeTracker.bakeCurrentTransformIntoVertices(),this._cameraGazer._gazeTracker.isPickable=!1,this._cameraGazer._gazeTracker.isVisible=!1,this._cameraGazer._gazeTracker.name="gazeTracker",this._leftController&&(this._leftController._gazeTracker=this._cameraGazer._gazeTracker.clone("gazeTracker")),this._rightController&&(this._rightController._gazeTracker=this._cameraGazer._gazeTracker.clone("gazeTracker")))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leftControllerGazeTrackerMesh",{get:function(){return this._leftController?this._leftController._gazeTracker:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightControllerGazeTrackerMesh",{get:function(){return this._rightController?this._rightController._gazeTracker:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayGaze",{get:function(){return this._displayGaze},set:function(D){this._displayGaze=D,D||(this._cameraGazer._gazeTracker.isVisible=!1,this._leftController&&(this._leftController._gazeTracker.isVisible=!1),this._rightController&&(this._rightController._gazeTracker.isVisible=!1))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayLaserPointer",{get:function(){return this._displayLaserPointer},set:function(D){this._displayLaserPointer=D,D?(this._rightController&&this._rightController._activatePointer(),this._leftController&&this._leftController._activatePointer()):(this._rightController&&(this._rightController._deactivatePointer(),this._rightController._gazeTracker.isVisible=!1),this._leftController&&(this._leftController._deactivatePointer(),this._leftController._gazeTracker.isVisible=!1))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"deviceOrientationCamera",{get:function(){return this._deviceOrientationCamera},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentVRCamera",{get:function(){return this._webVRready?this._webVRCamera:this._scene.activeCamera},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"webVRCamera",{get:function(){return this._webVRCamera},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vrDeviceOrientationCamera",{get:function(){return this._vrDeviceOrientationCamera},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vrButton",{get:function(){return this._btnVR},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_teleportationRequestInitiated",{get:function(){return this._cameraGazer._teleportationRequestInitiated||null!==this._leftController&&this._leftController._teleportationRequestInitiated||null!==this._rightController&&this._rightController._teleportationRequestInitiated},enumerable:!0,configurable:!0}),e.prototype.completeVRInit=function(D,w){var N=this;if(this.xrTestDone=!0,w.createFallbackVRDeviceOrientationFreeCamera&&(w.useMultiview&&(w.vrDeviceOrientationCameraMetrics||(w.vrDeviceOrientationCameraMetrics=Ci.GetDefault()),w.vrDeviceOrientationCameraMetrics.multiviewEnabled=!0),this._vrDeviceOrientationCamera=new Ui("VRDeviceOrientationVRHelper",this._position,this._scene,!0,w.vrDeviceOrientationCameraMetrics),this._vrDeviceOrientationCamera.angularSensibility=Number.MAX_VALUE),this._webVRCamera=new zi("WebVRHelper",this._position,this._scene,w),this._webVRCamera.useStandingMatrix(),this._cameraGazer=new ur((function(){return N.currentVRCamera}),D),!this._useCustomVRButton){this._btnVR=document.createElement("BUTTON"),this._btnVR.className="babylonVRicon",this._btnVR.id="babylonVRiconbtn",this._btnVR.title="Click to switch to VR";var F=".babylonVRicon { position: absolute; right: 20px; height: 50px; width: 80px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%222048%22%20height%3D%221152%22%20viewBox%3D%220%200%202048%201152%22%20version%3D%221.1%22%3E%3Cpath%20transform%3D%22rotate%28180%201024%2C576.0000000000001%29%22%20d%3D%22m1109%2C896q17%2C0%2030%2C-12t13%2C-30t-12.5%2C-30.5t-30.5%2C-12.5l-170%2C0q-18%2C0%20-30.5%2C12.5t-12.5%2C30.5t13%2C30t30%2C12l170%2C0zm-85%2C256q59%2C0%20132.5%2C-1.5t154.5%2C-5.5t164.5%2C-11.5t163%2C-20t150%2C-30t124.5%2C-41.5q23%2C-11%2042%2C-24t38%2C-30q27%2C-25%2041%2C-61.5t14%2C-72.5l0%2C-257q0%2C-123%20-47%2C-232t-128%2C-190t-190%2C-128t-232%2C-47l-81%2C0q-37%2C0%20-68.5%2C14t-60.5%2C34.5t-55.5%2C45t-53%2C45t-53%2C34.5t-55.5%2C14t-55.5%2C-14t-53%2C-34.5t-53%2C-45t-55.5%2C-45t-60.5%2C-34.5t-68.5%2C-14l-81%2C0q-123%2C0%20-232%2C47t-190%2C128t-128%2C190t-47%2C232l0%2C257q0%2C68%2038%2C115t97%2C73q54%2C24%20124.5%2C41.5t150%2C30t163%2C20t164.5%2C11.5t154.5%2C5.5t132.5%2C1.5zm939%2C-298q0%2C39%20-24.5%2C67t-58.5%2C42q-54%2C23%20-122%2C39.5t-143.5%2C28t-155.5%2C19t-157%2C11t-148.5%2C5t-129.5%2C1.5q-59%2C0%20-130%2C-1.5t-148%2C-5t-157%2C-11t-155.5%2C-19t-143.5%2C-28t-122%2C-39.5q-34%2C-14%20-58.5%2C-42t-24.5%2C-67l0%2C-257q0%2C-106%2040.5%2C-199t110%2C-162.5t162.5%2C-109.5t199%2C-40l81%2C0q27%2C0%2052%2C14t50%2C34.5t51%2C44.5t55.5%2C44.5t63.5%2C34.5t74%2C14t74%2C-14t63.5%2C-34.5t55.5%2C-44.5t51%2C-44.5t50%2C-34.5t52%2C-14l14%2C0q37%2C0%2070%2C0.5t64.5%2C4.5t63.5%2C12t68%2C23q71%2C30%20128.5%2C78.5t98.5%2C110t63.5%2C133.5t22.5%2C149l0%2C257z%22%20fill%3D%22white%22%20/%3E%3C/svg%3E%0A":"https://cdn.babylonjs.com/Assets/vrButton.png")+"); background-size: 80%; background-repeat:no-repeat; background-position: center; border: none; outline: none; transition: transform 0.125s ease-out } .babylonVRicon:hover { transform: scale(1.05) } .babylonVRicon:active {background-color: rgba(51,51,51,1) } .babylonVRicon:focus {background-color: rgba(51,51,51,1) }";F+=".babylonVRicon.vrdisplaypresenting { display: none; }";var k=document.createElement("style");k.appendChild(document.createTextNode(F)),document.getElementsByTagName("head")[0].appendChild(k),this.moveButtonToBottomRight()}this._btnVR&&this._btnVR.addEventListener("click",(function(){N.isInVRMode?N._scene.getEngine().disableVR():N.enterVR()}));var j=this._scene.getEngine().getHostWindow();j&&(j.addEventListener("resize",this._onResize),document.addEventListener("fullscreenchange",this._onFullscreenChange,!1),document.addEventListener("mozfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("msfullscreenchange",this._onFullscreenChange,!1),document.onmsfullscreenchange=this._onFullscreenChange,w.createFallbackVRDeviceOrientationFreeCamera?this.displayVRButton():this._scene.getEngine().onVRDisplayChangedObservable.add((function(D){D.vrDisplay&&N.displayVRButton()})),this._onKeyDown=function(D){27===D.keyCode&&N.isInVRMode&&N.exitVR()},document.addEventListener("keydown",this._onKeyDown),this._scene.onPrePointerObservable.add((function(){N._hasEnteredVR&&N.exitVROnDoubleTap&&(N.exitVR(),N._fullscreenVRpresenting&&N._scene.getEngine().exitFullscreen())}),kt.a.POINTERDOUBLETAP,!1),this._onVRDisplayChanged=function(D){return N.onVRDisplayChanged(D)},this._onVrDisplayPresentChange=function(){return N.onVrDisplayPresentChange()},this._onVRRequestPresentStart=function(){N._webVRrequesting=!0,N.updateButtonVisibility()},this._onVRRequestPresentComplete=function(){N._webVRrequesting=!1,N.updateButtonVisibility()},D.getEngine().onVRDisplayChangedObservable.add(this._onVRDisplayChanged),D.getEngine().onVRRequestPresentStart.add(this._onVRRequestPresentStart),D.getEngine().onVRRequestPresentComplete.add(this._onVRRequestPresentComplete),j.addEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange),D.onDisposeObservable.add((function(){N.dispose()})),this._webVRCamera.onControllerMeshLoadedObservable.add((function(D){return N._onDefaultMeshLoaded(D)})),this._scene.gamepadManager.onGamepadConnectedObservable.add(this._onNewGamepadConnected),this._scene.gamepadManager.onGamepadDisconnectedObservable.add(this._onNewGamepadDisconnected),this.updateButtonVisibility(),this._circleEase=new dt,this._circleEase.setEasingMode(ht.EASINGMODE_EASEINOUT),this._teleportationEasing=this._circleEase,D.onPointerObservable.add((function(w){N._interactionsEnabled&&D.activeCamera===N.vrDeviceOrientationCamera&&"mouse"===w.event.pointerType&&(w.type===kt.a.POINTERDOWN?N._cameraGazer._selectionPointerDown():w.type===kt.a.POINTERUP&&N._cameraGazer._selectionPointerUp())})),this.webVROptions.floorMeshes&&this.enableTeleportation({floorMeshes:this.webVROptions.floorMeshes}))},e.prototype._onDefaultMeshLoaded=function(D){this._leftController&&this._leftController.webVRController==D&&D.mesh&&this._leftController._setLaserPointerParent(D.mesh),this._rightController&&this._rightController.webVRController==D&&D.mesh&&this._rightController._setLaserPointerParent(D.mesh);try{this.onControllerMeshLoadedObservable.notifyObservers(D)}catch(D){oe.a.Warn("Error in your custom logic onControllerMeshLoaded: "+D)}},Object.defineProperty(e.prototype,"isInVRMode",{get:function(){return this.xr&&this.webVROptions.useXR&&this.xr.baseExperience.state===er.IN_XR||this._webVRpresenting||this._fullscreenVRpresenting},enumerable:!0,configurable:!0}),e.prototype.onVrDisplayPresentChange=function(){var D=this._scene.getEngine().getVRDevice();if(D){var w=this._webVRpresenting;this._webVRpresenting=D.isPresenting,w&&!this._webVRpresenting&&this.exitVR()}else oe.a.Warn("Detected VRDisplayPresentChange on an unknown VRDisplay. Did you can enterVR on the vrExperienceHelper?");this.updateButtonVisibility()},e.prototype.onVRDisplayChanged=function(D){this._webVRsupported=D.vrSupported,this._webVRready=!!D.vrDisplay,this._webVRpresenting=D.vrDisplay&&D.vrDisplay.isPresenting,this.updateButtonVisibility()},e.prototype.moveButtonToBottomRight=function(){if(this._inputElement&&!this._useCustomVRButton&&this._btnVR){var D=this._inputElement.getBoundingClientRect();this._btnVR.style.top=D.top+D.height-70+"px",this._btnVR.style.left=D.left+D.width-100+"px"}},e.prototype.displayVRButton=function(){this._useCustomVRButton||this._btnVRDisplayed||!this._btnVR||(document.body.appendChild(this._btnVR),this._btnVRDisplayed=!0)},e.prototype.updateButtonVisibility=function(){this._btnVR&&!this._useCustomVRButton&&(this._btnVR.className="babylonVRicon",this.isInVRMode?this._btnVR.className+=" vrdisplaypresenting":(this._webVRready&&(this._btnVR.className+=" vrdisplayready"),this._webVRsupported&&(this._btnVR.className+=" vrdisplaysupported"),this._webVRrequesting&&(this._btnVR.className+=" vrdisplayrequesting")))},e.prototype.enterVR=function(){var D=this;if(this.xr)this.xr.baseExperience.enterXRAsync("immersive-vr","local-floor",this.xr.renderTarget);else{if(this.onEnteringVRObservable)try{this.onEnteringVRObservable.notifyObservers(this)}catch(D){oe.a.Warn("Error in your custom logic onEnteringVR: "+D)}if(this._scene.activeCamera){if(this._position=this._scene.activeCamera.position.clone(),this.vrDeviceOrientationCamera&&(this.vrDeviceOrientationCamera.rotation=z.b.FromRotationMatrix(this._scene.activeCamera.getWorldMatrix().getRotationMatrix()).toEulerAngles(),this.vrDeviceOrientationCamera.angularSensibility=2e3),this.webVRCamera){var w=this.webVRCamera.deviceRotationQuaternion.toEulerAngles().y,N=z.b.FromRotationMatrix(this._scene.activeCamera.getWorldMatrix().getRotationMatrix()).toEulerAngles().y-w,F=this.webVRCamera.rotationQuaternion.toEulerAngles().y;this.webVRCamera.rotationQuaternion=z.b.FromEulerAngles(0,F+N,0)}this._existingCamera=this._scene.activeCamera,this._existingCamera.angularSensibilityX&&(this._cachedAngularSensibility.angularSensibilityX=this._existingCamera.angularSensibilityX,this._existingCamera.angularSensibilityX=Number.MAX_VALUE),this._existingCamera.angularSensibilityY&&(this._cachedAngularSensibility.angularSensibilityY=this._existingCamera.angularSensibilityY,this._existingCamera.angularSensibilityY=Number.MAX_VALUE),this._existingCamera.angularSensibility&&(this._cachedAngularSensibility.angularSensibility=this._existingCamera.angularSensibility,this._existingCamera.angularSensibility=Number.MAX_VALUE)}this._webVRrequesting||(this._webVRready?this._webVRpresenting||(this._scene.getEngine().onVRRequestPresentComplete.addOnce((function(w){D.onAfterEnteringVRObservable.notifyObservers({success:w})})),this._webVRCamera.position=this._position,this._scene.activeCamera=this._webVRCamera):this._vrDeviceOrientationCamera&&(this._vrDeviceOrientationCamera.position=this._position,this._scene.activeCamera&&(this._vrDeviceOrientationCamera.minZ=this._scene.activeCamera.minZ),this._scene.activeCamera=this._vrDeviceOrientationCamera,this._scene.getEngine().enterFullscreen(this.requestPointerLockOnFullScreen),this.updateButtonVisibility(),this._vrDeviceOrientationCamera.onViewMatrixChangedObservable.addOnce((function(){D.onAfterEnteringVRObservable.notifyObservers({success:!0})}))),this._scene.activeCamera&&this._inputElement&&this._scene.activeCamera.attachControl(this._inputElement),this._interactionsEnabled&&this._scene.registerBeforeRender(this.beforeRender),this._displayLaserPointer&&[this._leftController,this._rightController].forEach((function(D){D&&D._activatePointer()})),this._hasEnteredVR=!0)}},e.prototype.exitVR=function(){if(this.xr)this.xr.baseExperience.exitXRAsync();else if(this._hasEnteredVR){if(this.onExitingVRObservable)try{this.onExitingVRObservable.notifyObservers(this)}catch(D){oe.a.Warn("Error in your custom logic onExitingVR: "+D)}this._webVRpresenting&&this._scene.getEngine().disableVR(),this._scene.activeCamera&&(this._position=this._scene.activeCamera.position.clone()),this.vrDeviceOrientationCamera&&(this.vrDeviceOrientationCamera.angularSensibility=Number.MAX_VALUE),this._deviceOrientationCamera?(this._deviceOrientationCamera.position=this._position,this._scene.activeCamera=this._deviceOrientationCamera,this._cachedAngularSensibility.angularSensibilityX&&(this._deviceOrientationCamera.angularSensibilityX=this._cachedAngularSensibility.angularSensibilityX,this._cachedAngularSensibility.angularSensibilityX=null),this._cachedAngularSensibility.angularSensibilityY&&(this._deviceOrientationCamera.angularSensibilityY=this._cachedAngularSensibility.angularSensibilityY,this._cachedAngularSensibility.angularSensibilityY=null),this._cachedAngularSensibility.angularSensibility&&(this._deviceOrientationCamera.angularSensibility=this._cachedAngularSensibility.angularSensibility,this._cachedAngularSensibility.angularSensibility=null)):this._existingCamera&&(this._existingCamera.position=this._position,this._scene.activeCamera=this._existingCamera,this._inputElement&&this._scene.activeCamera.attachControl(this._inputElement),this._cachedAngularSensibility.angularSensibilityX&&(this._existingCamera.angularSensibilityX=this._cachedAngularSensibility.angularSensibilityX,this._cachedAngularSensibility.angularSensibilityX=null),this._cachedAngularSensibility.angularSensibilityY&&(this._existingCamera.angularSensibilityY=this._cachedAngularSensibility.angularSensibilityY,this._cachedAngularSensibility.angularSensibilityY=null),this._cachedAngularSensibility.angularSensibility&&(this._existingCamera.angularSensibility=this._cachedAngularSensibility.angularSensibility,this._cachedAngularSensibility.angularSensibility=null)),this.updateButtonVisibility(),this._interactionsEnabled&&(this._scene.unregisterBeforeRender(this.beforeRender),this._cameraGazer._gazeTracker.isVisible=!1,this._leftController&&(this._leftController._gazeTracker.isVisible=!1),this._rightController&&(this._rightController._gazeTracker.isVisible=!1)),this._scene.getEngine().resize(),[this._leftController,this._rightController].forEach((function(D){D&&D._deactivatePointer()})),this._hasEnteredVR=!1;var D=this._scene.getEngine();D._onVrDisplayPresentChange&&D._onVrDisplayPresentChange()}},Object.defineProperty(e.prototype,"position",{get:function(){return this._position},set:function(D){this._position=D,this._scene.activeCamera&&(this._scene.activeCamera.position=D)},enumerable:!0,configurable:!0}),e.prototype.enableInteractions=function(){var D=this;if(!this._interactionsEnabled){if(this._interactionsRequested=!0,this.xr)return void(this.xr.baseExperience.state===er.IN_XR&&this.xr.pointerSelection.attach());this._leftController&&this._enableInteractionOnController(this._leftController),this._rightController&&this._enableInteractionOnController(this._rightController),this.raySelectionPredicate=function(w){return w.isVisible&&(w.isPickable||w.name===D._floorMeshName)},this.meshSelectionPredicate=function(){return!0},this._raySelectionPredicate=function(w){return!!(D._isTeleportationFloor(w)||-1===w.name.indexOf("gazeTracker")&&-1===w.name.indexOf("teleportationTarget")&&-1===w.name.indexOf("torusTeleportation"))&&D.raySelectionPredicate(w)},this._interactionsEnabled=!0}},Object.defineProperty(e.prototype,"_noControllerIsActive",{get:function(){return!(this._leftController&&this._leftController._activePointer||this._rightController&&this._rightController._activePointer)},enumerable:!0,configurable:!0}),e.prototype._isTeleportationFloor=function(D){for(var w=0;w<this._floorMeshesCollection.length;w++)if(this._floorMeshesCollection[w].id===D.id)return!0;return!(!this._floorMeshName||D.name!==this._floorMeshName)},e.prototype.addFloorMesh=function(D){this._floorMeshesCollection&&(this._floorMeshesCollection.indexOf(D)>-1||this._floorMeshesCollection.push(D))},e.prototype.removeFloorMesh=function(D){if(this._floorMeshesCollection){var w=this._floorMeshesCollection.indexOf(D);-1!==w&&this._floorMeshesCollection.splice(w,1)}},e.prototype.enableTeleportation=function(D){var w=this;if(void 0===D&&(D={}),!this._teleportationInitialized){if(this._teleportationRequested=!0,this.enableInteractions(),this.webVROptions.useXR&&(D.floorMeshes||D.floorMeshName)){var N=D.floorMeshes||[];if(!N.length){var F=this._scene.getMeshByName(D.floorMeshName);F&&N.push(F)}if(this.xr)return N.forEach((function(D){w.xr.teleportation.addFloorMesh(D)})),void(this.xr.teleportation.attached||this.xr.teleportation.attach());if(!this.xrTestDone){var r=function(){w.xrTestDone&&(w._scene.unregisterBeforeRender(r),w.xr?w.xr.teleportation.attached||w.xr.teleportation.attach():w.enableTeleportation(D))};return void this._scene.registerBeforeRender(r)}}D.floorMeshName&&(this._floorMeshName=D.floorMeshName),D.floorMeshes&&(this._floorMeshesCollection=D.floorMeshes),D.teleportationMode&&(this._teleportationMode=D.teleportationMode),D.teleportationTime&&D.teleportationTime>0&&(this._teleportationTime=D.teleportationTime),D.teleportationSpeed&&D.teleportationSpeed>0&&(this._teleportationSpeed=D.teleportationSpeed),void 0!==D.easingFunction&&(this._teleportationEasing=D.easingFunction),null!=this._leftController&&this._enableTeleportationOnController(this._leftController),null!=this._rightController&&this._enableTeleportationOnController(this._rightController);var k=new Yi.a;k.vignetteColor=new G.b(0,0,0,0),k.vignetteEnabled=!0,this._postProcessMove=new Qi("postProcessMove",1,this._webVRCamera,void 0,void 0,void 0,void 0,k),this._webVRCamera.detachPostProcess(this._postProcessMove),this._teleportationInitialized=!0,this._isDefaultTeleportationTarget&&(this._createTeleportationCircles(),this._teleportationTarget.scaling.scaleInPlace(this._webVRCamera.deviceScaleFactor))}},e.prototype._enableInteractionOnController=function(D){var w=this;D.webVRController.mesh&&(D._interactionsEnabled=!0,this.isInVRMode&&this._displayLaserPointer&&D._activatePointer(),this.webVROptions.laserToggle&&D.webVRController.onMainButtonStateChangedObservable.add((function(N){w._displayLaserPointer&&1===N.value&&(D._activePointer?D._deactivatePointer():D._activatePointer(),w.displayGaze&&(D._gazeTracker.isVisible=D._activePointer))})),D.webVRController.onTriggerStateChangedObservable.add((function(N){var F=D;w._noControllerIsActive&&(F=w._cameraGazer),F._pointerDownOnMeshAsked?N.value<w._padSensibilityDown&&F._selectionPointerUp():N.value>w._padSensibilityUp&&F._selectionPointerDown()})))},e.prototype._checkTeleportWithRay=function(D,w){this._teleportationRequestInitiated&&!w._teleportationRequestInitiated||(w._teleportationRequestInitiated?Math.sqrt(D.y*D.y+D.x*D.x)<this._padSensibilityDown&&(this._teleportActive&&this.teleportCamera(this._haloCenter),w._teleportationRequestInitiated=!1):D.y<-this._padSensibilityUp&&w._dpadPressed&&(w._activatePointer(),w._teleportationRequestInitiated=!0))},e.prototype._checkRotate=function(D,w){w._teleportationRequestInitiated||(w._rotationLeftAsked?D.x>-this._padSensibilityDown&&(w._rotationLeftAsked=!1):D.x<-this._padSensibilityUp&&w._dpadPressed&&(w._rotationLeftAsked=!0,this._rotationAllowed&&this._rotateCamera(!1)),w._rotationRightAsked?D.x<this._padSensibilityDown&&(w._rotationRightAsked=!1):D.x>this._padSensibilityUp&&w._dpadPressed&&(w._rotationRightAsked=!0,this._rotationAllowed&&this._rotateCamera(!0)))},e.prototype._checkTeleportBackwards=function(D,w){if(!w._teleportationRequestInitiated)if(D.y>this._padSensibilityUp&&w._dpadPressed){if(!w._teleportationBackRequestInitiated){if(!this.currentVRCamera)return;var N=z.b.FromRotationMatrix(this.currentVRCamera.getWorldMatrix().getRotationMatrix()),F=this.currentVRCamera.position;this.currentVRCamera.devicePosition&&this.currentVRCamera.deviceRotationQuaternion&&(N=this.currentVRCamera.deviceRotationQuaternion,F=this.currentVRCamera.devicePosition),N.toEulerAnglesToRef(this._workingVector),this._workingVector.z=0,this._workingVector.x=0,z.b.RotationYawPitchRollToRef(this._workingVector.y,this._workingVector.x,this._workingVector.z,this._workingQuaternion),this._workingQuaternion.toRotationMatrix(this._workingMatrix),z.e.TransformCoordinatesToRef(this._teleportBackwardsVector,this._workingMatrix,this._workingVector);var k=new Qn.a(F,this._workingVector),j=this._scene.pickWithRay(k,this._raySelectionPredicate);j&&j.pickedPoint&&j.pickedMesh&&this._isTeleportationFloor(j.pickedMesh)&&j.distance<5&&this.teleportCamera(j.pickedPoint),w._teleportationBackRequestInitiated=!0}}else w._teleportationBackRequestInitiated=!1},e.prototype._enableTeleportationOnController=function(D){var w=this;D.webVRController.mesh&&(D._interactionsEnabled||this._enableInteractionOnController(D),D._interactionsEnabled=!0,D._teleportationEnabled=!0,D.webVRController.controllerType===Yn.VIVE&&(D._dpadPressed=!1,D.webVRController.onPadStateChangedObservable.add((function(w){D._dpadPressed=w.pressed,D._dpadPressed||(D._rotationLeftAsked=!1,D._rotationRightAsked=!1,D._teleportationBackRequestInitiated=!1)}))),D.webVRController.onPadValuesChangedObservable.add((function(N){w.teleportationEnabled&&(w._checkTeleportBackwards(N,D),w._checkTeleportWithRay(N,D)),w._checkRotate(N,D)})))},e.prototype._createTeleportationCircles=function(){this._teleportationTarget=xt.a.CreateGround("teleportationTarget",2,2,2,this._scene),this._teleportationTarget.isPickable=!1;var D=new Xi("DynamicTexture",512,this._scene,!0);D.hasAlpha=!0;var w=D.getContext();w.beginPath(),w.arc(256,256,200,0,2*Math.PI,!1),w.fillStyle=this._teleportationFillColor,w.fill(),w.lineWidth=10,w.strokeStyle=this._teleportationBorderColor,w.stroke(),w.closePath(),D.update();var N=new Hi.a("TextPlaneMaterial",this._scene);N.diffuseTexture=D,this._teleportationTarget.material=N;var F=xt.a.CreateTorus("torusTeleportation",.75,.1,25,this._scene,!1);F.isPickable=!1,F.parent=this._teleportationTarget;var k=new Fe("animationInnerCircle","position.y",30,Fe.ANIMATIONTYPE_FLOAT,Fe.ANIMATIONLOOPMODE_CYCLE),j=[];j.push({frame:0,value:0}),j.push({frame:30,value:.4}),j.push({frame:60,value:0}),k.setKeys(j);var z=new Et;z.setEasingMode(ht.EASINGMODE_EASEINOUT),k.setEasingFunction(z),F.animations=[],F.animations.push(k),this._scene.beginAnimation(F,0,60,!0),this._hideTeleportationTarget()},e.prototype._displayTeleportationTarget=function(){this._teleportActive=!0,this._teleportationInitialized&&(this._teleportationTarget.isVisible=!0,this._isDefaultTeleportationTarget&&(this._teleportationTarget.getChildren()[0].isVisible=!0))},e.prototype._hideTeleportationTarget=function(){this._teleportActive=!1,this._teleportationInitialized&&(this._teleportationTarget.isVisible=!1,this._isDefaultTeleportationTarget&&(this._teleportationTarget.getChildren()[0].isVisible=!1))},e.prototype._rotateCamera=function(D){var w=this;if(this.currentVRCamera instanceof Fn){D?this._rotationAngle++:this._rotationAngle--,this.currentVRCamera.animations=[];var N=z.b.FromRotationMatrix(z.a.RotationY(Math.PI/4*this._rotationAngle)),F=new Fe("animationRotation","rotationQuaternion",90,Fe.ANIMATIONTYPE_QUATERNION,Fe.ANIMATIONLOOPMODE_CONSTANT),k=[];k.push({frame:0,value:this.currentVRCamera.rotationQuaternion}),k.push({frame:6,value:N}),F.setKeys(k),F.setEasingFunction(this._circleEase),this.currentVRCamera.animations.push(F),this._postProcessMove.animations=[];var j=new Fe("animationPP","vignetteWeight",90,Fe.ANIMATIONTYPE_FLOAT,Fe.ANIMATIONLOOPMODE_CONSTANT),G=[];G.push({frame:0,value:0}),G.push({frame:3,value:4}),G.push({frame:6,value:0}),j.setKeys(G),j.setEasingFunction(this._circleEase),this._postProcessMove.animations.push(j);var H=new Fe("animationPP2","vignetteStretch",90,Fe.ANIMATIONTYPE_FLOAT,Fe.ANIMATIONLOOPMODE_CONSTANT),X=[];X.push({frame:0,value:0}),X.push({frame:3,value:10}),X.push({frame:6,value:0}),H.setKeys(X),H.setEasingFunction(this._circleEase),this._postProcessMove.animations.push(H),this._postProcessMove.imageProcessingConfiguration.vignetteWeight=0,this._postProcessMove.imageProcessingConfiguration.vignetteStretch=0,this._postProcessMove.samples=4,this._webVRCamera.attachPostProcess(this._postProcessMove),this._scene.beginAnimation(this._postProcessMove,0,6,!1,1,(function(){w._webVRCamera.detachPostProcess(w._postProcessMove)})),this._scene.beginAnimation(this.currentVRCamera,0,6,!1,1)}},e.prototype._moveTeleportationSelectorTo=function(D,w,N){if(D.pickedPoint){w._teleportationRequestInitiated&&(this._displayTeleportationTarget(),this._haloCenter.copyFrom(D.pickedPoint),this._teleportationTarget.position.copyFrom(D.pickedPoint));var F=this._convertNormalToDirectionOfRay(D.getNormal(!0,!1),N);if(F){var k=z.e.Cross(Qe.a.Y,F),j=z.e.Cross(F,k);z.e.RotationFromAxisToRef(j,F,k,this._teleportationTarget.rotation)}this._teleportationTarget.position.y+=.1}},e.prototype.teleportCamera=function(D){var w=this;if(this.currentVRCamera instanceof Fn){var N,F;if(this.webVRCamera.leftCamera?(this._workingVector.copyFrom(this.webVRCamera.leftCamera.globalPosition),this._workingVector.subtractInPlace(this.webVRCamera.position),D.subtractToRef(this._workingVector,this._workingVector)):this._workingVector.copyFrom(D),this.isInVRMode?this._workingVector.y+=this.webVRCamera.deviceDistanceToRoomGround()*this._webVRCamera.deviceScaleFactor:this._workingVector.y+=this._defaultHeight,this.onBeforeCameraTeleport.notifyObservers(this._workingVector),this._teleportationMode==e.TELEPORTATIONMODE_CONSTANTSPEED){F=90;var k=z.e.Distance(this.currentVRCamera.position,this._workingVector);N=this._teleportationSpeed/k}else F=Math.round(90*this._teleportationTime/1e3),N=1;this.currentVRCamera.animations=[];var j=new Fe("animationCameraTeleportation","position",90,Fe.ANIMATIONTYPE_VECTOR3,Fe.ANIMATIONLOOPMODE_CONSTANT),G=[{frame:0,value:this.currentVRCamera.position},{frame:F,value:this._workingVector}];j.setKeys(G),j.setEasingFunction(this._teleportationEasing),this.currentVRCamera.animations.push(j),this._postProcessMove.animations=[];var H=Math.round(F/2),X=new Fe("animationPP","vignetteWeight",90,Fe.ANIMATIONTYPE_FLOAT,Fe.ANIMATIONLOOPMODE_CONSTANT),q=[];q.push({frame:0,value:0}),q.push({frame:H,value:8}),q.push({frame:F,value:0}),X.setKeys(q),this._postProcessMove.animations.push(X);var Z=new Fe("animationPP2","vignetteStretch",90,Fe.ANIMATIONTYPE_FLOAT,Fe.ANIMATIONLOOPMODE_CONSTANT),J=[];J.push({frame:0,value:0}),J.push({frame:H,value:10}),J.push({frame:F,value:0}),Z.setKeys(J),this._postProcessMove.animations.push(Z),this._postProcessMove.imageProcessingConfiguration.vignetteWeight=0,this._postProcessMove.imageProcessingConfiguration.vignetteStretch=0,this._webVRCamera.attachPostProcess(this._postProcessMove),this._scene.beginAnimation(this._postProcessMove,0,F,!1,N,(function(){w._webVRCamera.detachPostProcess(w._postProcessMove)})),this._scene.beginAnimation(this.currentVRCamera,0,F,!1,N,(function(){w.onAfterCameraTeleport.notifyObservers(w._workingVector)})),this._hideTeleportationTarget()}},e.prototype._convertNormalToDirectionOfRay=function(D,w){return D&&Math.acos(z.e.Dot(D,w.direction))<Math.PI/2&&D.scaleInPlace(-1),D},e.prototype._castRayAndSelectObject=function(D){if(this.currentVRCamera instanceof Fn){var w=D._getForwardRay(this._rayLength),N=this._scene.pickWithRay(w,this._raySelectionPredicate);if(N&&(D._laserPointer&&(N.originMesh=D._laserPointer.parent),this._scene.simulatePointerMove(N,{pointerId:D._id})),D._currentHit=N,N&&N.pickedPoint){if(this._displayGaze){var F=1;D._gazeTracker.isVisible=!0,D._isActionableMesh&&(F=3),this.updateGazeTrackerScale&&(D._gazeTracker.scaling.x=N.distance*F,D._gazeTracker.scaling.y=N.distance*F,D._gazeTracker.scaling.z=N.distance*F);var k=this._convertNormalToDirectionOfRay(N.getNormal(),w);if(k){var j=z.e.Cross(Qe.a.Y,k),G=z.e.Cross(k,j);z.e.RotationFromAxisToRef(G,k,j,D._gazeTracker.rotation)}D._gazeTracker.position.copyFrom(N.pickedPoint),D._gazeTracker.position.x<0?D._gazeTracker.position.x+=.002:D._gazeTracker.position.x-=.002,D._gazeTracker.position.y<0?D._gazeTracker.position.y+=.002:D._gazeTracker.position.y-=.002,D._gazeTracker.position.z<0?D._gazeTracker.position.z+=.002:D._gazeTracker.position.z-=.002}D._updatePointerDistance(N.distance)}else D._updatePointerDistance(),D._gazeTracker.isVisible=!1;if(N&&N.pickedMesh){if(this._teleportationInitialized&&this._isTeleportationFloor(N.pickedMesh)&&N.pickedPoint)return D._currentMeshSelected&&!this._isTeleportationFloor(D._currentMeshSelected)&&this._notifySelectedMeshUnselected(D._currentMeshSelected),D._currentMeshSelected=null,void(D._teleportationRequestInitiated&&this._moveTeleportationSelectorTo(N,D,w));if(N.pickedMesh!==D._currentMeshSelected)if(this.meshSelectionPredicate(N.pickedMesh)){this.onNewMeshPicked.notifyObservers(N),D._currentMeshSelected=N.pickedMesh,N.pickedMesh.isPickable&&N.pickedMesh.actionManager?(this.changeGazeColor(this._pickedGazeColor),this.changeLaserColor(this._pickedLaserColor),D._isActionableMesh=!0):(this.changeGazeColor(this._gazeColor),this.changeLaserColor(this._laserColor),D._isActionableMesh=!1);try{this.onNewMeshSelected.notifyObservers(N.pickedMesh);var H=D;H.webVRController&&this.onMeshSelectedWithController.notifyObservers({mesh:N.pickedMesh,controller:H.webVRController})}catch(D){oe.a.Warn("Error while raising onNewMeshSelected or onMeshSelectedWithController: "+D)}}else this._notifySelectedMeshUnselected(D._currentMeshSelected),D._currentMeshSelected=null,this.changeGazeColor(this._gazeColor),this.changeLaserColor(this._laserColor)}else this._notifySelectedMeshUnselected(D._currentMeshSelected),D._currentMeshSelected=null,this.changeGazeColor(this._gazeColor),this.changeLaserColor(this._laserColor)}},e.prototype._notifySelectedMeshUnselected=function(D){D&&this.onSelectedMeshUnselected.notifyObservers(D)},e.prototype.setLaserColor=function(D,w){void 0===w&&(w=this._pickedLaserColor),this._laserColor=D,this._pickedLaserColor=w},e.prototype.setLaserLightingState=function(D){void 0===D&&(D=!0),this._leftController&&this._leftController._setLaserPointerLightingDisabled(!D),this._rightController&&this._rightController._setLaserPointerLightingDisabled(!D)},e.prototype.setGazeColor=function(D,w){void 0===w&&(w=this._pickedGazeColor),this._gazeColor=D,this._pickedGazeColor=w},e.prototype.changeLaserColor=function(D){this.updateControllerLaserColor&&(this._leftController&&this._leftController._setLaserPointerColor(D),this._rightController&&this._rightController._setLaserPointerColor(D))},e.prototype.changeGazeColor=function(D){this.updateGazeTrackerColor&&this._cameraGazer._gazeTracker.material&&(this._cameraGazer._gazeTracker.material.emissiveColor=D,this._leftController&&(this._leftController._gazeTracker.material.emissiveColor=D),this._rightController&&(this._rightController._gazeTracker.material.emissiveColor=D))},e.prototype.dispose=function(){this.isInVRMode&&this.exitVR(),this._postProcessMove&&this._postProcessMove.dispose(),this._webVRCamera&&this._webVRCamera.dispose(),this._vrDeviceOrientationCamera&&this._vrDeviceOrientationCamera.dispose(),!this._useCustomVRButton&&this._btnVR&&this._btnVR.parentNode&&document.body.removeChild(this._btnVR),this._deviceOrientationCamera&&this._scene.activeCamera!=this._deviceOrientationCamera&&this._deviceOrientationCamera.dispose(),this._cameraGazer&&this._cameraGazer.dispose(),this._leftController&&this._leftController.dispose(),this._rightController&&this._rightController.dispose(),this._teleportationTarget&&this._teleportationTarget.dispose(),this.xr&&this.xr.dispose(),this._floorMeshesCollection=[],document.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange),window.removeEventListener("resize",this._onResize),document.removeEventListener("fullscreenchange",this._onFullscreenChange),document.removeEventListener("mozfullscreenchange",this._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange),document.removeEventListener("msfullscreenchange",this._onFullscreenChange),document.onmsfullscreenchange=null,this._scene.getEngine().onVRDisplayChangedObservable.removeCallback(this._onVRDisplayChanged),this._scene.getEngine().onVRRequestPresentStart.removeCallback(this._onVRRequestPresentStart),this._scene.getEngine().onVRRequestPresentComplete.removeCallback(this._onVRRequestPresentComplete),window.removeEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange),this._scene.gamepadManager.onGamepadConnectedObservable.removeCallback(this._onNewGamepadConnected),this._scene.gamepadManager.onGamepadDisconnectedObservable.removeCallback(this._onNewGamepadDisconnected),this._scene.unregisterBeforeRender(this.beforeRender)},e.prototype.getClassName=function(){return"VRExperienceHelper"},e.TELEPORTATIONMODE_CONSTANTTIME=0,e.TELEPORTATIONMODE_CONSTANTSPEED=1,e}(),hr=N(60),dr=(ar={root:0,found:!1},function(D,w,N,F){ar.root=0,ar.found=!1;var k=w*w-4*D*N;if(k<0)return ar;var j=Math.sqrt(k),z=(-w-j)/(2*D),G=(-w+j)/(2*D);if(z>G){var H=G;G=z,z=H}return z>0&&z<F?(ar.root=z,ar.found=!0,ar):G>0&&G<F?(ar.root=G,ar.found=!0,ar):ar}),fr=function(){function e(){this._collisionPoint=z.e.Zero(),this._planeIntersectionPoint=z.e.Zero(),this._tempVector=z.e.Zero(),this._tempVector2=z.e.Zero(),this._tempVector3=z.e.Zero(),this._tempVector4=z.e.Zero(),this._edge=z.e.Zero(),this._baseToVertex=z.e.Zero(),this._destinationPoint=z.e.Zero(),this._slidePlaneNormal=z.e.Zero(),this._displacementVector=z.e.Zero(),this._radius=z.e.One(),this._retry=0,this._basePointWorld=z.e.Zero(),this._velocityWorld=z.e.Zero(),this._normalizedVelocity=z.e.Zero(),this._collisionMask=-1}return Object.defineProperty(e.prototype,"collisionMask",{get:function(){return this._collisionMask},set:function(D){this._collisionMask=isNaN(D)?-1:D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"slidePlaneNormal",{get:function(){return this._slidePlaneNormal},enumerable:!0,configurable:!0}),e.prototype._initialize=function(D,w,N){this._velocity=w,z.e.NormalizeToRef(w,this._normalizedVelocity),this._basePoint=D,D.multiplyToRef(this._radius,this._basePointWorld),w.multiplyToRef(this._radius,this._velocityWorld),this._velocityWorldLength=this._velocityWorld.length(),this._epsilon=N,this.collisionFound=!1},e.prototype._checkPointInTriangle=function(D,w,N,F,k){w.subtractToRef(D,this._tempVector),N.subtractToRef(D,this._tempVector2),z.e.CrossToRef(this._tempVector,this._tempVector2,this._tempVector4);var j=z.e.Dot(this._tempVector4,k);return!(j<0)&&(F.subtractToRef(D,this._tempVector3),z.e.CrossToRef(this._tempVector2,this._tempVector3,this._tempVector4),!((j=z.e.Dot(this._tempVector4,k))<0)&&(z.e.CrossToRef(this._tempVector3,this._tempVector,this._tempVector4),(j=z.e.Dot(this._tempVector4,k))>=0))},e.prototype._canDoCollision=function(D,w,N,F){var k=z.e.Distance(this._basePointWorld,D),j=Math.max(this._radius.x,this._radius.y,this._radius.z);return!(k>this._velocityWorldLength+j+w||!function(D,w,N,F){return!(D.x>N.x+F||N.x-F>w.x||D.y>N.y+F||N.y-F>w.y||D.z>N.z+F||N.z-F>w.z)}(N,F,this._basePointWorld,this._velocityWorldLength+j))},e.prototype._testTriangle=function(D,w,N,F,k,j,G){var H,X=!1;w||(w=[]),w[D]||(w[D]=new hr.a(0,0,0,0),w[D].copyFromPoints(N,F,k));var q=w[D];if(j||q.isFrontFacingTo(this._normalizedVelocity,0)){var Z=q.signedDistanceTo(this._basePoint),J=z.e.Dot(q.normal,this._velocity);if(0==J){if(Math.abs(Z)>=1)return;X=!0,H=0}else{var $=(1-Z)/J;if((H=(-1-Z)/J)>$){var te=$;$=H,H=te}if(H>1||$<0)return;H<0&&(H=0),H>1&&(H=1)}this._collisionPoint.copyFromFloats(0,0,0);var ie=!1,oe=1;if(X||(this._basePoint.subtractToRef(q.normal,this._planeIntersectionPoint),this._velocity.scaleToRef(H,this._tempVector),this._planeIntersectionPoint.addInPlace(this._tempVector),this._checkPointInTriangle(this._planeIntersectionPoint,N,F,k,q.normal)&&(ie=!0,oe=H,this._collisionPoint.copyFrom(this._planeIntersectionPoint))),!ie){var ce=this._velocity.lengthSquared(),he=ce;this._basePoint.subtractToRef(N,this._tempVector);var fe=2*z.e.Dot(this._velocity,this._tempVector),pe=this._tempVector.lengthSquared()-1,_e=dr(he,fe,pe,oe);_e.found&&(oe=_e.root,ie=!0,this._collisionPoint.copyFrom(N)),this._basePoint.subtractToRef(F,this._tempVector),fe=2*z.e.Dot(this._velocity,this._tempVector),pe=this._tempVector.lengthSquared()-1,(_e=dr(he,fe,pe,oe)).found&&(oe=_e.root,ie=!0,this._collisionPoint.copyFrom(F)),this._basePoint.subtractToRef(k,this._tempVector),fe=2*z.e.Dot(this._velocity,this._tempVector),pe=this._tempVector.lengthSquared()-1,(_e=dr(he,fe,pe,oe)).found&&(oe=_e.root,ie=!0,this._collisionPoint.copyFrom(k)),F.subtractToRef(N,this._edge),N.subtractToRef(this._basePoint,this._baseToVertex);var ve=this._edge.lengthSquared(),ye=z.e.Dot(this._edge,this._velocity),be=z.e.Dot(this._edge,this._baseToVertex);if(he=ve*-ce+ye*ye,fe=ve*(2*z.e.Dot(this._velocity,this._baseToVertex))-2*ye*be,pe=ve*(1-this._baseToVertex.lengthSquared())+be*be,(_e=dr(he,fe,pe,oe)).found){var Te=(ye*_e.root-be)/ve;Te>=0&&Te<=1&&(oe=_e.root,ie=!0,this._edge.scaleInPlace(Te),N.addToRef(this._edge,this._collisionPoint))}k.subtractToRef(F,this._edge),F.subtractToRef(this._basePoint,this._baseToVertex),ve=this._edge.lengthSquared(),ye=z.e.Dot(this._edge,this._velocity),be=z.e.Dot(this._edge,this._baseToVertex),he=ve*-ce+ye*ye,fe=ve*(2*z.e.Dot(this._velocity,this._baseToVertex))-2*ye*be,pe=ve*(1-this._baseToVertex.lengthSquared())+be*be,(_e=dr(he,fe,pe,oe)).found&&(Te=(ye*_e.root-be)/ve)>=0&&Te<=1&&(oe=_e.root,ie=!0,this._edge.scaleInPlace(Te),F.addToRef(this._edge,this._collisionPoint)),N.subtractToRef(k,this._edge),k.subtractToRef(this._basePoint,this._baseToVertex),ve=this._edge.lengthSquared(),ye=z.e.Dot(this._edge,this._velocity),be=z.e.Dot(this._edge,this._baseToVertex),he=ve*-ce+ye*ye,fe=ve*(2*z.e.Dot(this._velocity,this._baseToVertex))-2*ye*be,pe=ve*(1-this._baseToVertex.lengthSquared())+be*be,(_e=dr(he,fe,pe,oe)).found&&(Te=(ye*_e.root-be)/ve)>=0&&Te<=1&&(oe=_e.root,ie=!0,this._edge.scaleInPlace(Te),k.addToRef(this._edge,this._collisionPoint))}if(ie){var Ee=oe*this._velocity.length();(!this.collisionFound||Ee<this._nearestDistance)&&(this.intersectionPoint?this.intersectionPoint.copyFrom(this._collisionPoint):this.intersectionPoint=this._collisionPoint.clone(),this._nearestDistance=Ee,this.collisionFound=!0,this.collidedMesh=G)}}},e.prototype._collide=function(D,w,N,F,k,j,z,G){for(var H=F;H<k;H+=3){var X=w[N[H]-j],q=w[N[H+1]-j],Z=w[N[H+2]-j];this._testTriangle(H,D,Z,q,X,z,G)}},e.prototype._getResponse=function(D,w){D.addToRef(w,this._destinationPoint),w.scaleInPlace(this._nearestDistance/w.length()),this._basePoint.addToRef(w,D),D.subtractToRef(this.intersectionPoint,this._slidePlaneNormal),this._slidePlaneNormal.normalize(),this._slidePlaneNormal.scaleToRef(this._epsilon,this._displacementVector),D.addInPlace(this._displacementVector),this.intersectionPoint.addInPlace(this._displacementVector),this._slidePlaneNormal.scaleInPlace(hr.a.SignedDistanceToPlaneFromPositionAndNormal(this.intersectionPoint,this._slidePlaneNormal,this._destinationPoint)),this._destinationPoint.subtractInPlace(this._slidePlaneNormal),this._destinationPoint.subtractToRef(this.intersectionPoint,w)},e}(),pr=function(){function e(){this._scaledPosition=z.e.Zero(),this._scaledVelocity=z.e.Zero(),this._finalPosition=z.e.Zero()}return e.prototype.getNewPosition=function(D,w,N,F,k,j,z){D.divideToRef(N._radius,this._scaledPosition),w.divideToRef(N._radius,this._scaledVelocity),N.collidedMesh=null,N._retry=0,N._initialVelocity=this._scaledVelocity,N._initialPosition=this._scaledPosition,this._collideWithWorld(this._scaledPosition,this._scaledVelocity,N,F,this._finalPosition,k),this._finalPosition.multiplyInPlace(N._radius),j(z,this._finalPosition,N.collidedMesh)},e.prototype.createCollider=function(){return new fr},e.prototype.init=function(D){this._scene=D},e.prototype._collideWithWorld=function(D,w,N,F,k,j){void 0===j&&(j=null);var z=10*Ct.a.CollisionsEpsilon;if(N._retry>=F)k.copyFrom(D);else{var G=j?j.collisionMask:N.collisionMask;N._initialize(D,w,z);for(var H=0;H<this._scene.meshes.length;H++){var X=this._scene.meshes[H];X.isEnabled()&&X.checkCollisions&&X.subMeshes&&X!==j&&0!=(G&X.collisionGroup)&&X._checkCollision(N)}N.collisionFound?(0===w.x&&0===w.y&&0===w.z||N._getResponse(D,w),w.length()<=z?k.copyFrom(D):(N._retry++,this._collideWithWorld(D,w,N,F,k,j))):D.addToRef(w,k)}},e}();We.a.CollisionCoordinatorFactory=function(){return new pr};var _r=N(53),mr=N(105),gr=N(133),vr=N(96),yr=N(44),Tr=N(104),Er=function(){function e(D,w,N,F,k,j){this.entries=new Array,this._boundingVectors=new Array,this._capacity=N,this._depth=F,this._maxDepth=k,this._creationFunc=j,this._minPoint=D,this._maxPoint=w,this._boundingVectors.push(D.clone()),this._boundingVectors.push(w.clone()),this._boundingVectors.push(D.clone()),this._boundingVectors[2].x=w.x,this._boundingVectors.push(D.clone()),this._boundingVectors[3].y=w.y,this._boundingVectors.push(D.clone()),this._boundingVectors[4].z=w.z,this._boundingVectors.push(w.clone()),this._boundingVectors[5].z=D.z,this._boundingVectors.push(w.clone()),this._boundingVectors[6].x=D.x,this._boundingVectors.push(w.clone()),this._boundingVectors[7].y=D.y}return Object.defineProperty(e.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minPoint",{get:function(){return this._minPoint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxPoint",{get:function(){return this._maxPoint},enumerable:!0,configurable:!0}),e.prototype.addEntry=function(D){if(this.blocks)for(var w=0;w<this.blocks.length;w++)this.blocks[w].addEntry(D);else this._creationFunc(D,this),this.entries.length>this.capacity&&this._depth<this._maxDepth&&this.createInnerBlocks()},e.prototype.removeEntry=function(D){if(this.blocks)for(var w=0;w<this.blocks.length;w++)this.blocks[w].removeEntry(D);else{var N=this.entries.indexOf(D);N>-1&&this.entries.splice(N,1)}},e.prototype.addEntries=function(D){for(var w=0;w<D.length;w++){var N=D[w];this.addEntry(N)}},e.prototype.select=function(D,w,N){if(vr.a.IsInFrustum(this._boundingVectors,D)){if(this.blocks){for(var F=0;F<this.blocks.length;F++)this.blocks[F].select(D,w,N);return}N?w.concat(this.entries):w.concatWithNoDuplicate(this.entries)}},e.prototype.intersects=function(D,w,N,F){if(vr.a.IntersectsSphere(this._minPoint,this._maxPoint,D,w)){if(this.blocks){for(var k=0;k<this.blocks.length;k++)this.blocks[k].intersects(D,w,N,F);return}F?N.concat(this.entries):N.concatWithNoDuplicate(this.entries)}},e.prototype.intersectsRay=function(D,w){if(D.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.blocks){for(var N=0;N<this.blocks.length;N++)this.blocks[N].intersectsRay(D,w);return}w.concatWithNoDuplicate(this.entries)}},e.prototype.createInnerBlocks=function(){e._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc)},e._CreateBlocks=function(D,w,N,F,k,j,G,H){G.blocks=new Array;for(var X=new z.e((w.x-D.x)/2,(w.y-D.y)/2,(w.z-D.z)/2),q=0;q<2;q++)for(var Z=0;Z<2;Z++)for(var J=0;J<2;J++){var $=new e(D.add(X.multiplyByFloats(q,Z,J)),D.add(X.multiplyByFloats(q+1,Z+1,J+1)),F,k+1,j,H);$.addEntries(N),G.blocks.push($)}},e}(),Sr=function(){function e(D,w,N){void 0===N&&(N=2),this.maxDepth=N,this.dynamicContent=new Array,this._maxBlockCapacity=w||64,this._selectionContent=new ui.b(1024),this._creationFunc=D}return e.prototype.update=function(D,w,N){Er._CreateBlocks(D,w,N,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)},e.prototype.addMesh=function(D){for(var w=0;w<this.blocks.length;w++)this.blocks[w].addEntry(D)},e.prototype.removeMesh=function(D){for(var w=0;w<this.blocks.length;w++)this.blocks[w].removeEntry(D)},e.prototype.select=function(D,w){this._selectionContent.reset();for(var N=0;N<this.blocks.length;N++)this.blocks[N].select(D,this._selectionContent,w);return w?this._selectionContent.concat(this.dynamicContent):this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},e.prototype.intersects=function(D,w,N){this._selectionContent.reset();for(var F=0;F<this.blocks.length;F++)this.blocks[F].intersects(D,w,this._selectionContent,N);return N?this._selectionContent.concat(this.dynamicContent):this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},e.prototype.intersectsRay=function(D){this._selectionContent.reset();for(var w=0;w<this.blocks.length;w++)this.blocks[w].intersectsRay(D,this._selectionContent);return this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},e.CreationFuncForMeshes=function(D,w){var N=D.getBoundingInfo();!D.isBlocked&&N.boundingBox.intersectsMinMax(w.minPoint,w.maxPoint)&&w.entries.push(D)},e.CreationFuncForSubMeshes=function(D,w){D.getBoundingInfo().boundingBox.intersectsMinMax(w.minPoint,w.maxPoint)&&w.entries.push(D)},e}();We.a.prototype.createOrUpdateSelectionOctree=function(D,w){void 0===D&&(D=64),void 0===w&&(w=2);var N=this._getComponent(Nt.a.NAME_OCTREE);N||(N=new Mr(this),this._addComponent(N)),this._selectionOctree||(this._selectionOctree=new Sr(Sr.CreationFuncForMeshes,D,w));var F=this.getWorldExtends();return this._selectionOctree.update(F.min,F.max,this.meshes),this._selectionOctree},Object.defineProperty(We.a.prototype,"selectionOctree",{get:function(){return this._selectionOctree},enumerable:!0,configurable:!0}),Wt.a.prototype.createOrUpdateSubmeshesOctree=function(D,w){void 0===D&&(D=64),void 0===w&&(w=2);var N=this.getScene(),F=N._getComponent(Nt.a.NAME_OCTREE);F||(F=new Mr(N),N._addComponent(F)),this._submeshesOctree||(this._submeshesOctree=new Sr(Sr.CreationFuncForSubMeshes,D,w)),this.computeWorldMatrix(!0);var k=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(k.minimumWorld,k.maximumWorld,this.subMeshes),this._submeshesOctree};var Mr=function(){function e(D){this.name=Nt.a.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new Qn.a(z.e.Zero(),new z.e(1,1,1)),this.scene=D,this.scene.getActiveMeshCandidates=this.getActiveMeshCandidates.bind(this),this.scene.getActiveSubMeshCandidates=this.getActiveSubMeshCandidates.bind(this),this.scene.getCollidingSubMeshCandidates=this.getCollidingSubMeshCandidates.bind(this),this.scene.getIntersectingSubMeshCandidates=this.getIntersectingSubMeshCandidates.bind(this)}return e.prototype.register=function(){var D=this;this.scene.onMeshRemovedObservable.add((function(w){var N=D.scene.selectionOctree;if(null!=N){var F=N.dynamicContent.indexOf(w);-1!==F&&N.dynamicContent.splice(F,1)}})),this.scene.onMeshImportedObservable.add((function(w){var N=D.scene.selectionOctree;null!=N&&N.addMesh(w)}))},e.prototype.getActiveMeshCandidates=function(){return this.scene._selectionOctree?this.scene._selectionOctree.select(this.scene.frustumPlanes):this.scene._getDefaultMeshCandidates()},e.prototype.getActiveSubMeshCandidates=function(D){return D._submeshesOctree&&D.useOctreeForRenderingSelection?D._submeshesOctree.select(this.scene.frustumPlanes):this.scene._getDefaultSubMeshCandidates(D)},e.prototype.getIntersectingSubMeshCandidates=function(D,w){return D._submeshesOctree&&D.useOctreeForPicking?(Qn.a.TransformToRef(w,D.getWorldMatrix(),this._tempRay),D._submeshesOctree.intersectsRay(this._tempRay)):this.scene._getDefaultSubMeshCandidates(D)},e.prototype.getCollidingSubMeshCandidates=function(D,w){if(D._submeshesOctree&&D.useOctreeForCollisions){var N=w._velocityWorldLength+Math.max(w._radius.x,w._radius.y,w._radius.z);return D._submeshesOctree.intersects(w._basePointWorld,N)}return this.scene._getDefaultSubMeshCandidates(D)},e.prototype.rebuild=function(){},e.prototype.dispose=function(){},e}(),xr=N(93),Ar=N(150),In=function(){this._timeElapsedQueryEnded=!1},Dn=function(){this.occlusionInternalRetryCounter=0,this.isOcclusionQueryInProgress=!1,this.isOccluded=!1,this.occlusionRetryCount=-1,this.occlusionType=Wt.a.OCCLUSION_TYPE_NONE,this.occlusionQueryAlgorithmType=Wt.a.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE};Ct.a.prototype.createQuery=function(){return this._gl.createQuery()},Ct.a.prototype.deleteQuery=function(D){return this._gl.deleteQuery(D),this},Ct.a.prototype.isQueryResultAvailable=function(D){return this._gl.getQueryParameter(D,this._gl.QUERY_RESULT_AVAILABLE)},Ct.a.prototype.getQueryResult=function(D){return this._gl.getQueryParameter(D,this._gl.QUERY_RESULT)},Ct.a.prototype.beginOcclusionQuery=function(D,w){var N=this._getGlAlgorithmType(D);return this._gl.beginQuery(N,w),this},Ct.a.prototype.endOcclusionQuery=function(D){var w=this._getGlAlgorithmType(D);return this._gl.endQuery(w),this},Ct.a.prototype._createTimeQuery=function(){var D=this.getCaps().timerQuery;return D.createQueryEXT?D.createQueryEXT():this.createQuery()},Ct.a.prototype._deleteTimeQuery=function(D){var w=this.getCaps().timerQuery;w.deleteQueryEXT?w.deleteQueryEXT(D):this.deleteQuery(D)},Ct.a.prototype._getTimeQueryResult=function(D){var w=this.getCaps().timerQuery;return w.getQueryObjectEXT?w.getQueryObjectEXT(D,w.QUERY_RESULT_EXT):this.getQueryResult(D)},Ct.a.prototype._getTimeQueryAvailability=function(D){var w=this.getCaps().timerQuery;return w.getQueryObjectEXT?w.getQueryObjectEXT(D,w.QUERY_RESULT_AVAILABLE_EXT):this.isQueryResultAvailable(D)},Ct.a.prototype.startTimeQuery=function(){var D=this.getCaps(),w=D.timerQuery;if(!w)return null;var N=new In;if(this._gl.getParameter(w.GPU_DISJOINT_EXT),D.canUseTimestampForTimerQuery)N._startTimeQuery=this._createTimeQuery(),w.queryCounterEXT(N._startTimeQuery,w.TIMESTAMP_EXT);else{if(this._currentNonTimestampToken)return this._currentNonTimestampToken;N._timeElapsedQuery=this._createTimeQuery(),w.beginQueryEXT?w.beginQueryEXT(w.TIME_ELAPSED_EXT,N._timeElapsedQuery):this._gl.beginQuery(w.TIME_ELAPSED_EXT,N._timeElapsedQuery),this._currentNonTimestampToken=N}return N},Ct.a.prototype.endTimeQuery=function(D){var w=this.getCaps(),N=w.timerQuery;if(!N||!D)return-1;if(w.canUseTimestampForTimerQuery){if(!D._startTimeQuery)return-1;D._endTimeQuery||(D._endTimeQuery=this._createTimeQuery(),N.queryCounterEXT(D._endTimeQuery,N.TIMESTAMP_EXT))}else if(!D._timeElapsedQueryEnded){if(!D._timeElapsedQuery)return-1;N.endQueryEXT?N.endQueryEXT(N.TIME_ELAPSED_EXT):this._gl.endQuery(N.TIME_ELAPSED_EXT),D._timeElapsedQueryEnded=!0}var F=this._gl.getParameter(N.GPU_DISJOINT_EXT),k=!1;if(D._endTimeQuery?k=this._getTimeQueryAvailability(D._endTimeQuery):D._timeElapsedQuery&&(k=this._getTimeQueryAvailability(D._timeElapsedQuery)),k&&!F){var j=0;if(w.canUseTimestampForTimerQuery){if(!D._startTimeQuery||!D._endTimeQuery)return-1;var z=this._getTimeQueryResult(D._startTimeQuery);j=this._getTimeQueryResult(D._endTimeQuery)-z,this._deleteTimeQuery(D._startTimeQuery),this._deleteTimeQuery(D._endTimeQuery),D._startTimeQuery=null,D._endTimeQuery=null}else{if(!D._timeElapsedQuery)return-1;j=this._getTimeQueryResult(D._timeElapsedQuery),this._deleteTimeQuery(D._timeElapsedQuery),D._timeElapsedQuery=null,D._timeElapsedQueryEnded=!1,this._currentNonTimestampToken=null}return j}return-1},Ct.a.prototype._getGlAlgorithmType=function(D){return D===Wt.a.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE?this._gl.ANY_SAMPLES_PASSED_CONSERVATIVE:this._gl.ANY_SAMPLES_PASSED},Object.defineProperty(Wt.a.prototype,"isOcclusionQueryInProgress",{get:function(){return this._occlusionDataStorage.isOcclusionQueryInProgress},set:function(D){this._occlusionDataStorage.isOcclusionQueryInProgress=D},enumerable:!1,configurable:!0}),Object.defineProperty(Wt.a.prototype,"_occlusionDataStorage",{get:function(){return this.__occlusionDataStorage||(this.__occlusionDataStorage=new Dn),this.__occlusionDataStorage},enumerable:!1,configurable:!0}),Object.defineProperty(Wt.a.prototype,"isOccluded",{get:function(){return this._occlusionDataStorage.isOccluded},set:function(D){this._occlusionDataStorage.isOccluded=D},enumerable:!0,configurable:!0}),Object.defineProperty(Wt.a.prototype,"occlusionQueryAlgorithmType",{get:function(){return this._occlusionDataStorage.occlusionQueryAlgorithmType},set:function(D){this._occlusionDataStorage.occlusionQueryAlgorithmType=D},enumerable:!0,configurable:!0}),Object.defineProperty(Wt.a.prototype,"occlusionType",{get:function(){return this._occlusionDataStorage.occlusionType},set:function(D){this._occlusionDataStorage.occlusionType=D},enumerable:!0,configurable:!0}),Object.defineProperty(Wt.a.prototype,"occlusionRetryCount",{get:function(){return this._occlusionDataStorage.occlusionRetryCount},set:function(D){this._occlusionDataStorage.occlusionRetryCount=D},enumerable:!0,configurable:!0}),Wt.a.prototype._checkOcclusionQuery=function(){var D=this._occlusionDataStorage;if(D.occlusionType===Wt.a.OCCLUSION_TYPE_NONE)return D.isOccluded=!1,!1;var w=this.getEngine();if(w.webGLVersion<2)return D.isOccluded=!1,!1;if(!w.isQueryResultAvailable)return D.isOccluded=!1,!1;if(this.isOcclusionQueryInProgress&&this._occlusionQuery)if(w.isQueryResultAvailable(this._occlusionQuery)){var N=w.getQueryResult(this._occlusionQuery);D.isOcclusionQueryInProgress=!1,D.occlusionInternalRetryCounter=0,D.isOccluded=1!==N}else{if(D.occlusionInternalRetryCounter++,!(-1!==D.occlusionRetryCount&&D.occlusionInternalRetryCounter>D.occlusionRetryCount))return!1;D.isOcclusionQueryInProgress=!1,D.occlusionInternalRetryCounter=0,D.isOccluded=D.occlusionType!==Wt.a.OCCLUSION_TYPE_OPTIMISTIC&&D.isOccluded}var F=this.getScene();if(F.getBoundingBoxRenderer){var k=F.getBoundingBoxRenderer();this._occlusionQuery||(this._occlusionQuery=w.createQuery()),w.beginOcclusionQuery(D.occlusionQueryAlgorithmType,this._occlusionQuery),k.renderOcclusionBoundingBox(this),w.endOcclusionQuery(D.occlusionQueryAlgorithmType),this._occlusionDataStorage.isOcclusionQueryInProgress=!0}return D.isOccluded},Ct.a.prototype.createTransformFeedback=function(){return this._gl.createTransformFeedback()},Ct.a.prototype.deleteTransformFeedback=function(D){this._gl.deleteTransformFeedback(D)},Ct.a.prototype.bindTransformFeedback=function(D){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,D)},Ct.a.prototype.beginTransformFeedback=function(D){void 0===D&&(D=!0),this._gl.beginTransformFeedback(D?this._gl.POINTS:this._gl.TRIANGLES)},Ct.a.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},Ct.a.prototype.setTranformFeedbackVaryings=function(D,w){this._gl.transformFeedbackVaryings(D,w,this._gl.INTERLEAVED_ATTRIBS)},Ct.a.prototype.bindTransformFeedbackBuffer=function(D){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,D?D.underlyingResource:null)};var wn=function(){};Ct.a.prototype.getInputElement=function(){return this.inputElement||this.getRenderingCanvas()},Ct.a.prototype.registerView=function(D,w){var N=this;this.views||(this.views=[]);for(var F=0,k=this.views;F<k.length;F++){var j=k[F];if(j.target===D)return j}var z=this.getRenderingCanvas();z&&(D.width=z.width,D.height=z.height);var G={target:D,camera:w};return this.views.push(G),w&&w.onDisposeObservable.add((function(){N.unRegisterView(D)})),G},Ct.a.prototype.unRegisterView=function(D){if(!this.views)return this;for(var w=0,N=this.views;w<N.length;w++){var F=N[w];if(F.target===D){var k=this.views.indexOf(F);-1!==k&&this.views.splice(k,1);break}}return this},Ct.a.prototype._renderViews=function(){if(!this.views)return!1;var D=this.getRenderingCanvas();if(!D)return!1;for(var w=0,N=this.views;w<N.length;w++){var F=N[w],k=F.target,j=k.getContext("2d");if(j){var z=F.camera,G=null,H=null;if(z){if((H=z.getScene()).activeCameras.length)continue;this.activeView=F,G=H.activeCamera,H.activeCamera=z}k.width=k.clientWidth,k.height=k.clientHeight,D.width=k.clientWidth,D.height=k.clientHeight,this._renderFrame(),j.drawImage(D,0,0),G&&H&&(H.activeCamera=G)}}return this.activeView=null,!0};var Pr=N(130),Cr=N(109),Or=N(85),Rr=[Math.sqrt(1/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(3/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(15/(4*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(5/(16*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(15/(16*Math.PI))],Dr=[function(D){return 1},function(D){return D.y},function(D){return D.z},function(D){return D.x},function(D){return D.x*D.y},function(D){return D.y*D.z},function(D){return 3*D.z*D.z-1},function(D){return D.x*D.z},function(D){return D.x*D.x-D.y*D.y}],Vn=function(D,w){return Rr[D]*Dr[D](w)},Ir=[Math.PI,2*Math.PI/3,2*Math.PI/3,2*Math.PI/3,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4],Lr=function(){function e(){this.preScaled=!1,this.l00=z.e.Zero(),this.l1_1=z.e.Zero(),this.l10=z.e.Zero(),this.l11=z.e.Zero(),this.l2_2=z.e.Zero(),this.l2_1=z.e.Zero(),this.l20=z.e.Zero(),this.l21=z.e.Zero(),this.l22=z.e.Zero()}return e.prototype.addLight=function(D,w,N){var F=new z.e(w.r,w.g,w.b).scale(N);this.l00=this.l00.add(F.scale(Vn(0,D))),this.l1_1=this.l1_1.add(F.scale(Vn(1,D))),this.l10=this.l10.add(F.scale(Vn(2,D))),this.l11=this.l11.add(F.scale(Vn(3,D))),this.l2_2=this.l2_2.add(F.scale(Vn(4,D))),this.l2_1=this.l2_1.add(F.scale(Vn(5,D))),this.l20=this.l20.add(F.scale(Vn(6,D))),this.l21=this.l21.add(F.scale(Vn(7,D))),this.l22=this.l22.add(F.scale(Vn(8,D)))},e.prototype.scaleInPlace=function(D){this.l00.scaleInPlace(D),this.l1_1.scaleInPlace(D),this.l10.scaleInPlace(D),this.l11.scaleInPlace(D),this.l2_2.scaleInPlace(D),this.l2_1.scaleInPlace(D),this.l20.scaleInPlace(D),this.l21.scaleInPlace(D),this.l22.scaleInPlace(D)},e.prototype.convertIncidentRadianceToIrradiance=function(){this.l00.scaleInPlace(Ir[0]),this.l1_1.scaleInPlace(Ir[1]),this.l10.scaleInPlace(Ir[2]),this.l11.scaleInPlace(Ir[3]),this.l2_2.scaleInPlace(Ir[4]),this.l2_1.scaleInPlace(Ir[5]),this.l20.scaleInPlace(Ir[6]),this.l21.scaleInPlace(Ir[7]),this.l22.scaleInPlace(Ir[8])},e.prototype.convertIrradianceToLambertianRadiance=function(){this.scaleInPlace(1/Math.PI)},e.prototype.preScaleForRendering=function(){this.preScaled=!0,this.l00.scaleInPlace(Rr[0]),this.l1_1.scaleInPlace(Rr[1]),this.l10.scaleInPlace(Rr[2]),this.l11.scaleInPlace(Rr[3]),this.l2_2.scaleInPlace(Rr[4]),this.l2_1.scaleInPlace(Rr[5]),this.l20.scaleInPlace(Rr[6]),this.l21.scaleInPlace(Rr[7]),this.l22.scaleInPlace(Rr[8])},e.FromArray=function(D){var w=new e;return z.e.FromArrayToRef(D[0],0,w.l00),z.e.FromArrayToRef(D[1],0,w.l1_1),z.e.FromArrayToRef(D[2],0,w.l10),z.e.FromArrayToRef(D[3],0,w.l11),z.e.FromArrayToRef(D[4],0,w.l2_2),z.e.FromArrayToRef(D[5],0,w.l2_1),z.e.FromArrayToRef(D[6],0,w.l20),z.e.FromArrayToRef(D[7],0,w.l21),z.e.FromArrayToRef(D[8],0,w.l22),w},e.FromPolynomial=function(D){var w=new e;return w.l00=D.xx.scale(.376127).add(D.yy.scale(.376127)).add(D.zz.scale(.376126)),w.l1_1=D.y.scale(.977204),w.l10=D.z.scale(.977204),w.l11=D.x.scale(.977204),w.l2_2=D.xy.scale(1.16538),w.l2_1=D.yz.scale(1.16538),w.l20=D.zz.scale(1.34567).subtract(D.xx.scale(.672834)).subtract(D.yy.scale(.672834)),w.l21=D.zx.scale(1.16538),w.l22=D.xx.scale(1.16538).subtract(D.yy.scale(1.16538)),w.l1_1.scaleInPlace(-1),w.l11.scaleInPlace(-1),w.l2_1.scaleInPlace(-1),w.l21.scaleInPlace(-1),w.scaleInPlace(Math.PI),w},e}(),wr=function(){function e(){this.x=z.e.Zero(),this.y=z.e.Zero(),this.z=z.e.Zero(),this.xx=z.e.Zero(),this.yy=z.e.Zero(),this.zz=z.e.Zero(),this.xy=z.e.Zero(),this.yz=z.e.Zero(),this.zx=z.e.Zero()}return Object.defineProperty(e.prototype,"preScaledHarmonics",{get:function(){return this._harmonics||(this._harmonics=Lr.FromPolynomial(this)),this._harmonics.preScaled||this._harmonics.preScaleForRendering(),this._harmonics},enumerable:!0,configurable:!0}),e.prototype.addAmbient=function(D){var w=new z.e(D.r,D.g,D.b);this.xx=this.xx.add(w),this.yy=this.yy.add(w),this.zz=this.zz.add(w)},e.prototype.scaleInPlace=function(D){this.x.scaleInPlace(D),this.y.scaleInPlace(D),this.z.scaleInPlace(D),this.xx.scaleInPlace(D),this.yy.scaleInPlace(D),this.zz.scaleInPlace(D),this.yz.scaleInPlace(D),this.zx.scaleInPlace(D),this.xy.scaleInPlace(D)},e.FromHarmonics=function(D){var w=new e;return w._harmonics=D,w.x=D.l11.scale(1.02333).scale(-1),w.y=D.l1_1.scale(1.02333).scale(-1),w.z=D.l10.scale(1.02333),w.xx=D.l00.scale(.886277).subtract(D.l20.scale(.247708)).add(D.l22.scale(.429043)),w.yy=D.l00.scale(.886277).subtract(D.l20.scale(.247708)).subtract(D.l22.scale(.429043)),w.zz=D.l00.scale(.886277).add(D.l20.scale(.495417)),w.yz=D.l2_1.scale(.858086).scale(-1),w.zx=D.l21.scale(.858086).scale(-1),w.xy=D.l2_2.scale(.858086),w.scaleInPlace(1/Math.PI),w},e.FromArray=function(D){var w=new e;return z.e.FromArrayToRef(D[0],0,w.x),z.e.FromArrayToRef(D[1],0,w.y),z.e.FromArrayToRef(D[2],0,w.z),z.e.FromArrayToRef(D[3],0,w.xx),z.e.FromArrayToRef(D[4],0,w.yy),z.e.FromArrayToRef(D[5],0,w.zz),z.e.FromArrayToRef(D[6],0,w.yz),z.e.FromArrayToRef(D[7],0,w.zx),z.e.FromArrayToRef(D[8],0,w.xy),w},e}(),Nr=N(49),Wn=function(D,w,N,F){this.name=D,this.worldAxisForNormal=w,this.worldAxisForFileX=N,this.worldAxisForFileY=F},Fr=function(){function e(){}return e.ConvertCubeMapTextureToSphericalPolynomial=function(D){if(!D.isCube)return null;var w,N,F=D.getSize().width,k=D.readPixels(0),j=D.readPixels(1);D.isRenderTarget?(w=D.readPixels(3),N=D.readPixels(2)):(w=D.readPixels(2),N=D.readPixels(3));var z=D.readPixels(4),G=D.readPixels(5),H=D.gammaSpace,X=ce.a.TEXTUREFORMAT_RGBA,q=ce.a.TEXTURETYPE_UNSIGNED_INT;D.textureType!=ce.a.TEXTURETYPE_FLOAT&&D.textureType!=ce.a.TEXTURETYPE_HALF_FLOAT||(q=ce.a.TEXTURETYPE_FLOAT);var Z={size:F,right:k,left:j,up:w,down:N,front:z,back:G,format:X,type:q,gammaSpace:H};return this.ConvertCubeMapToSphericalPolynomial(Z)},e.ConvertCubeMapToSphericalPolynomial=function(D){for(var w=new Lr,N=0,F=2/D.size,k=F,j=.5*F-1,z=0;z<6;z++)for(var H=this.FileFaces[z],X=D[H.name],q=j,Z=D.format===ce.a.TEXTUREFORMAT_RGBA?4:3,J=0;J<D.size;J++){for(var $=j,te=0;te<D.size;te++){var ie=H.worldAxisForFileX.scale($).add(H.worldAxisForFileY.scale(q)).add(H.worldAxisForNormal);ie.normalize();var oe=Math.pow(1+$*$+q*q,-1.5),he=X[J*D.size*Z+te*Z+0],fe=X[J*D.size*Z+te*Z+1],pe=X[J*D.size*Z+te*Z+2];isNaN(he)&&(he=0),isNaN(fe)&&(fe=0),isNaN(pe)&&(pe=0),D.type===ce.a.TEXTURETYPE_UNSIGNED_INT&&(he/=255,fe/=255,pe/=255),D.gammaSpace&&(he=Math.pow(De.a.Clamp(he),rt.c),fe=Math.pow(De.a.Clamp(fe),rt.c),pe=Math.pow(De.a.Clamp(pe),rt.c)),he=De.a.Clamp(he,0,4096),fe=De.a.Clamp(fe,0,4096),pe=De.a.Clamp(pe,0,4096);var _e=new G.a(he,fe,pe);w.addLight(ie,_e,oe),N+=oe,$+=F}q+=k}var ve=4*Math.PI*6/6/N;return w.scaleInPlace(ve),w.convertIncidentRadianceToIrradiance(),w.convertIrradianceToLambertianRadiance(),wr.FromHarmonics(w)},e.FileFaces=[new Wn("right",new z.e(1,0,0),new z.e(0,0,-1),new z.e(0,-1,0)),new Wn("left",new z.e(-1,0,0),new z.e(0,0,1),new z.e(0,-1,0)),new Wn("up",new z.e(0,1,0),new z.e(1,0,0),new z.e(0,0,1)),new Wn("down",new z.e(0,-1,0),new z.e(1,0,0),new z.e(0,0,-1)),new Wn("front",new z.e(0,0,1),new z.e(1,0,0),new z.e(0,-1,0)),new Wn("back",new z.e(0,0,-1),new z.e(-1,0,0),new z.e(0,-1,0))],e}();Object.defineProperty(Nr.a.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial)return this._texture._sphericalPolynomial;this._texture.isReady&&(this._texture._sphericalPolynomial=Fr.ConvertCubeMapTextureToSphericalPolynomial(this))}return null},set:function(D){this._texture&&(this._texture._sphericalPolynomial=D)},enumerable:!0,configurable:!0}),li.a.ShadersStore.rgbdEncodePixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n#include<helperFunctions>\nvoid main(void)\n{\ngl_FragColor=toRGBD(texture2D(textureSampler,vUV).rgb);\n}",li.a.ShadersStore.rgbdDecodePixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n#include<helperFunctions>\nvoid main(void)\n{\ngl_FragColor=vec4(fromRGBD(texture2D(textureSampler,vUV)),1.0);\n}";var Br,kr,Ur=function(){function e(){}return e.GetEnvInfo=function(D){for(var w=new DataView(D.buffer,D.byteOffset,D.byteLength),N=0,F=0;F<e._MagicBytes.length;F++)if(w.getUint8(N++)!==e._MagicBytes[F])return oe.a.Error("Not a babylon environment map"),null;for(var k="",j=0;j=w.getUint8(N++);)k+=String.fromCharCode(j);var z=JSON.parse(k);return z.specular&&(z.specular.specularDataPosition=N,z.specular.lodGenerationScale=z.specular.lodGenerationScale||.8),z},e.CreateEnvTextureAsync=function(D){var w=this,N=D.getInternalTexture();if(!N)return Promise.reject("The cube texture is invalid.");if(!D._prefiltered)return Promise.reject("The cube texture is invalid (not prefiltered).");var F=N.getEngine();if(F&&F.premultipliedAlpha)return Promise.reject("Env texture can only be created when the engine is created with the premultipliedAlpha option set to false.");if(D.textureType===ce.a.TEXTURETYPE_UNSIGNED_INT)return Promise.reject("The cube texture should allow HDR (Full Float or Half Float).");var k=F.getRenderingCanvas();if(!k)return Promise.reject("Env texture can only be created when the engine is associated to a canvas.");var j=ce.a.TEXTURETYPE_FLOAT;if(!F.getCaps().textureFloatRender&&(j=ce.a.TEXTURETYPE_HALF_FLOAT,!F.getCaps().textureHalfFloatRender))return Promise.reject("Env texture can only be created when the browser supports half float or full float rendering.");var z=N.width,G=new We.a(F),H={},X=[],q=De.a.Log2(N.width);q=Math.round(q);for(var d=function(w){for(var N=Math.pow(2,q-w),n=function(z){var q=D.readPixels(z,w),Z=F.createRawTexture(q,N,N,ce.a.TEXTUREFORMAT_RGBA,!1,!1,ce.a.TEXTURE_NEAREST_SAMPLINGMODE,null,j),J=new Promise((function(D,j){var X=new fi("rgbdEncode","rgbdEncode",null,null,1,null,ce.a.TEXTURE_NEAREST_SAMPLINGMODE,F,!1,void 0,ce.a.TEXTURETYPE_UNSIGNED_INT,void 0,null,!1);X.getEffect().executeWhenCompiled((function(){X.onApply=function(D){D._bindTexture("textureSampler",Z)};var j=F.getRenderWidth(),q=F.getRenderHeight();F.setSize(N,N),G.postProcessManager.directRender([X],null),Dt.b.ToBlob(k,(function(N){var F=new FileReader;F.onload=function(N){var F=N.target.result;H[6*w+z]=F,D()},F.readAsArrayBuffer(N)})),F.setSize(j,q)}))}));X.push(J)},z=0;z<6;z++)n(z)},Z=0;Z<=q;Z++)d(Z);return Promise.all(X).then((function(){G.dispose();for(var N={version:1,width:z,irradiance:w._CreateEnvTextureIrradiance(D),specular:{mipmaps:[],lodGenerationScale:D.lodGenerationScale}},F=0,k=0;k<=q;k++)for(var j=0;j<6;j++){var X=H[6*k+j].byteLength;N.specular.mipmaps.push({length:X,position:F}),F+=X}for(var Z=JSON.stringify(N),J=new ArrayBuffer(Z.length+1),$=new Uint8Array(J),te=(k=0,Z.length);k<te;k++)$[k]=Z.charCodeAt(k);$[Z.length]=0;var ie=e._MagicBytes.length+F+J.byteLength,oe=new ArrayBuffer(ie),ce=new Uint8Array(oe),he=new DataView(oe),fe=0;for(k=0;k<e._MagicBytes.length;k++)he.setUint8(fe++,e._MagicBytes[k]);for(ce.set(new Uint8Array(J),fe),fe+=J.byteLength,k=0;k<=q;k++)for(j=0;j<6;j++){var pe=H[6*k+j];ce.set(new Uint8Array(pe),fe),fe+=pe.byteLength}return oe}))},e._CreateEnvTextureIrradiance=function(D){var w=D.sphericalPolynomial;return null==w?null:{x:[w.x.x,w.x.y,w.x.z],y:[w.y.x,w.y.y,w.y.z],z:[w.z.x,w.z.y,w.z.z],xx:[w.xx.x,w.xx.y,w.xx.z],yy:[w.yy.x,w.yy.y,w.yy.z],zz:[w.zz.x,w.zz.y,w.zz.z],yz:[w.yz.x,w.yz.y,w.yz.z],zx:[w.zx.x,w.zx.y,w.zx.z],xy:[w.xy.x,w.xy.y,w.xy.z]}},e.CreateImageDataArrayBufferViews=function(D,w){if(1!==w.version)throw new Error('Unsupported babylon environment map version "'+w.version+'"');var N=w.specular,F=De.a.Log2(w.width);if(F=Math.round(F)+1,N.mipmaps.length!==6*F)throw new Error('Unsupported specular mipmaps number "'+N.mipmaps.length+'"');for(var k=new Array(F),j=0;j<F;j++){k[j]=new Array(6);for(var z=0;z<6;z++){var G=N.mipmaps[6*j+z];k[j][z]=new Uint8Array(D.buffer,D.byteOffset+N.specularDataPosition+G.position,G.length)}}return k},e.UploadEnvLevelsAsync=function(D,w,N){if(1!==N.version)throw new Error('Unsupported babylon environment map version "'+N.version+'"');var F=N.specular;if(!F)return Promise.resolve();D._lodGenerationScale=F.lodGenerationScale;var k=e.CreateImageDataArrayBufferViews(w,N);return e.UploadLevelsAsync(D,k)},e._OnImageReadyAsync=function(D,w,N,F,k,j,z,G,H,X,q){return new Promise((function(Z,J){if(N){var $=w.createTexture(null,!0,!0,null,ce.a.TEXTURE_NEAREST_SAMPLINGMODE,null,(function(D){J(D)}),D);F.getEffect().executeWhenCompiled((function(){F.onApply=function(D){D._bindTexture("textureSampler",$),D.setFloat2("scale",1,1)},w.scenes[0].postProcessManager.directRender([F],X,!0,j,z),w.restoreDefaultFramebuffer(),$.dispose(),URL.revokeObjectURL(k),Z()}))}else{if(w._uploadImageToTexture(q,D,j,z),G){var te=H[z];te&&w._uploadImageToTexture(te._texture,D,j,0)}Z()}}))},e.UploadLevelsAsync=function(D,w){var N=this;if(!Dt.b.IsExponentOfTwo(D.width))throw new Error("Texture size must be a power of two");var F=Math.round(De.a.Log2(D.width))+1,k=D.getEngine(),j=!1,z=!1,G=null,H=null,X=null,q=k.getCaps();if(D.format=ce.a.TEXTUREFORMAT_RGBA,D.type=ce.a.TEXTURETYPE_UNSIGNED_INT,D.generateMipMaps=!0,D._cachedAnisotropicFilteringLevel=null,k.updateTextureSamplingMode(ce.a.TEXTURE_TRILINEAR_SAMPLINGMODE,D),q.textureLOD?k.webGLVersion<2?j=!1:q.textureHalfFloatRender&&q.textureHalfFloatLinearFiltering?(j=!0,D.type=ce.a.TEXTURETYPE_HALF_FLOAT):q.textureFloatRender&&q.textureFloatLinearFiltering&&(j=!0,D.type=ce.a.TEXTURETYPE_FLOAT):(j=!1,z=!0,X={}),j)G=new fi("rgbdDecode","rgbdDecode",null,null,1,null,ce.a.TEXTURE_TRILINEAR_SAMPLINGMODE,k,!1,void 0,D.type,void 0,null,!1),D._isRGBD=!1,D.invertY=!1,H=k.createRenderTargetCubeTexture(D.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:ce.a.TEXTURE_TRILINEAR_SAMPLINGMODE,type:D.type,format:ce.a.TEXTUREFORMAT_RGBA});else if(D._isRGBD=!0,D.invertY=!0,z)for(var Z=D._lodGenerationScale,J=D._lodGenerationOffset,$=0;$<3;$++){var te=(F-1)*Z+J,ie=J+(te-J)*(1-$/2),oe=Math.round(Math.min(Math.max(ie,0),te)),he=new $t.a(k,$t.b.Temp);he.isCube=!0,he.invertY=!0,he.generateMipMaps=!1,k.updateTextureSamplingMode(ce.a.TEXTURE_LINEAR_LINEAR,he);var fe=new Nr.a(null);switch(fe.isCube=!0,fe._texture=he,X[oe]=fe,$){case 0:D._lodTextureLow=fe;break;case 1:D._lodTextureMid=fe;break;case 2:D._lodTextureHigh=fe}}var pe=[],T=function(F){for(var u=function(q){var Z=w[F][q],J=new Blob([Z],{type:"image/png"}),$=URL.createObjectURL(J),te=void 0;if("undefined"==typeof Image)te=createImageBitmap(J).then((function(w){return N._OnImageReadyAsync(w,k,j,G,$,q,F,z,X,H,D)}));else{var ie=new Image;ie.src=$,te=new Promise((function(w,Z){ie.onload=function(){N._OnImageReadyAsync(ie,k,j,G,$,q,F,z,X,H,D).then((function(){return w()})).catch((function(D){Z(D)}))},ie.onerror=function(D){Z(D)}}))}pe.push(te)},q=0;q<6;q++)u(q)};for($=0;$<w.length;$++)T($);if(w.length<F){var _e=void 0,ve=Math.pow(2,F-1-w.length),ye=ve*ve*4;switch(D.type){case ce.a.TEXTURETYPE_UNSIGNED_INT:_e=new Uint8Array(ye);break;case ce.a.TEXTURETYPE_HALF_FLOAT:_e=new Uint16Array(ye);break;case ce.a.TEXTURETYPE_FLOAT:_e=new Float32Array(ye)}for($=w.length;$<F;$++)for(var be=0;be<6;be++)k._uploadArrayBufferViewToTexture(D,_e,be,$)}return Promise.all(pe).then((function(){H&&(k._releaseFramebufferObjects(H),k._releaseTexture(D),H._swapAndDie(D)),G&&G.dispose(),z&&(D._lodTextureHigh&&D._lodTextureHigh._texture&&(D._lodTextureHigh._texture.isReady=!0),D._lodTextureMid&&D._lodTextureMid._texture&&(D._lodTextureMid._texture.isReady=!0),D._lodTextureLow&&D._lodTextureLow._texture&&(D._lodTextureLow._texture.isReady=!0))}))},e.UploadEnvSpherical=function(D,w){1!==w.version&&oe.a.Warn('Unsupported babylon environment map version "'+w.version+'"');var N=w.irradiance;if(N){var F=new wr;z.e.FromArrayToRef(N.x,0,F.x),z.e.FromArrayToRef(N.y,0,F.y),z.e.FromArrayToRef(N.z,0,F.z),z.e.FromArrayToRef(N.xx,0,F.xx),z.e.FromArrayToRef(N.yy,0,F.yy),z.e.FromArrayToRef(N.zz,0,F.zz),z.e.FromArrayToRef(N.yz,0,F.yz),z.e.FromArrayToRef(N.zx,0,F.zx),z.e.FromArrayToRef(N.xy,0,F.xy),D._sphericalPolynomial=F}},e._UpdateRGBDAsync=function(D,w,N,F,k){return D._source=$t.b.CubeRawRGBD,D._bufferViewArrayArray=w,D._lodGenerationScale=F,D._lodGenerationOffset=k,D._sphericalPolynomial=N,e.UploadLevelsAsync(D,w).then((function(){D.isReady=!0}))},e._MagicBytes=[134,22,135,150,246,214,150,54],e}();$t.a._UpdateRGBDAsync=Ur._UpdateRGBDAsync;var Vr,jr=((Br={})[Zi.b.PositionKind]=0,Br[Zi.b.NormalKind]=1,Br[Zi.b.TangentKind]=2,Br[Zi.b.UVKind]=10,Br[Zi.b.UV2Kind]=11,Br[Zi.b.UV3Kind]=12,Br[Zi.b.UV4Kind]=13,Br[Zi.b.ColorKind]=4,Br[Zi.b.MatricesIndicesKind]=8,Br[Zi.b.MatricesWeightsKind]=9,Br),zr=((kr={})[Zi.b.PositionKind]="a_position",kr[Zi.b.NormalKind]="a_normal",kr[Zi.b.TangentKind]="a_tangent",kr[Zi.b.UVKind]="a_texcoord0",kr[Zi.b.UV2Kind]="a_texcoord1",kr[Zi.b.UV3Kind]="a_texcoord2",kr[Zi.b.UV4Kind]="a_texcoord3",kr[Zi.b.ColorKind]="a_color0",kr[Zi.b.MatricesIndicesKind]="a_indices",kr[Zi.b.MatricesWeightsKind]="a_weight",kr),Gr=function(D){function t(){return null!==D&&D.apply(this,arguments)||this}return Object(Z.d)(t,D),t.prototype.lineProcessor=function(D){for(var w=0,N=this._replacements;w<N.length;w++){var F=N[w];D=D.replace(F.searchValue,F.replaceValue)}return D},t.prototype.attributeProcessor=function(w){var N=w.match(/attribute\s+[^\s]+\s+([^\s]+)\s*(?:\[.+\])?\s*;/)[1],F=jr[N];if(void 0===F&&(F=this._genericAttributeLocation++)>17)throw new Error("Exceeded maximum custom attributes");var k=zr[N];if(void 0===k)throw new Error("Can't find bgfx name mapping");return w=w.replace(N,k),this._replacements.push({searchValue:new RegExp("\\b"+N+"\\b","g"),replaceValue:""+k}),"layout(location="+F+") "+D.prototype.attributeProcessor.call(this,w)},t.prototype.varyingProcessor=function(w,N){var F;return N?F=this._varyingLocationMap[w]:(F=this._varyingLocationCount++,this._varyingLocationMap[w]=F),"layout(location="+F+") "+D.prototype.varyingProcessor.call(this,w,N)},t.prototype.uniformProcessor=function(D){var w=D.match(/uniform\s+([^\s]+)\s+([^\s]+)\s*(?:\[.+\])?\s*;/),N=w[1],F=w[2];switch(N){case"sampler2D":case"samplerCube":var k=N.substr(7),j=this._textureCount++;return this._replacements.push({searchValue:new RegExp("\\b"+F+"\\b"),replaceValue:"sampler"+k+"("+F+"Texture, "+F+")"}),"layout(binding="+j+") uniform texture"+k+" "+F+"Texture;\nlayout(binding="+j+") uniform sampler "+F+";";case"float":this._replacements.push({searchValue:new RegExp("\\b"+F+"\\b"),replaceValue:F+".x"}),D="uniform vec4 "+F+";";break;case"vec2":this._replacements.push({searchValue:new RegExp("\\b"+F+"\\b"),replaceValue:F+".xy"}),D="uniform vec4 "+F+";";break;case"vec3":this._replacements.push({searchValue:new RegExp("\\b"+F+"\\b"),replaceValue:F+".xyz"}),D="uniform vec4 "+F+";"}return this._uniforms.push(D),1===this._uniforms.length?"<UNIFORM>":""},t.prototype.preProcessor=function(D,w,N){return this._genericAttributeLocation=10,N||(this._varyingLocationCount=0,this._varyingLocationMap={}),this._replacements=[],this._textureCount=0,this._uniforms=[],D},t.prototype.postProcessor=function(w,N,F){return(w=(w=D.prototype.postProcessor.call(this,w,N,F)).replace("<UNIFORM>","layout(binding=0) uniform Frame {\n"+this._uniforms.join("\n")+"\n};")).replace("out vec4 glFragColor","layout(location=0) out vec4 glFragColor")},t}(Cr.a),Yr=function(){function e(){this.isAsync=!1,this.isReady=!1}return e.prototype._handlesSpectorRebuildCallback=function(D){throw new Error("Not implemented")},e}(),Hr=function(D){function t(){return null!==D&&D.apply(this,arguments)||this}return Object(Z.d)(t,D),t}(Or.a),Wr=function(){function e(){}return e.POINT=0,e.MINPOINT_MAGPOINT_MIPPOINT=e.POINT,e.BILINEAR=1,e.MINLINEAR_MAGLINEAR_MIPPOINT=e.BILINEAR,e.TRILINEAR=2,e.MINLINEAR_MAGLINEAR_MIPLINEAR=e.TRILINEAR,e.ANISOTROPIC=3,e.POINT_COMPARE=4,e.TRILINEAR_COMPARE=5,e.MINBILINEAR_MAGPOINT=6,e.MINLINEAR_MAGPOINT_MIPLINEAR=e.MINBILINEAR_MAGPOINT,e.MINPOINT_MAGPOINT_MIPLINEAR=7,e.MINPOINT_MAGLINEAR_MIPPOINT=8,e.MINPOINT_MAGLINEAR_MIPLINEAR=9,e.MINLINEAR_MAGPOINT_MIPPOINT=10,e}(),Xr=function(){function e(){}return e.CLEAR_COLOR=1,e.CLEAR_DEPTH=2,e.CLEAR_STENCIL=4,e}(),Kr=function(){function e(){}return e.WRAP=0,e.MIRROR=1,e.CLAMP=2,e.BORDER=3,e.MIRROR_ONCE=4,e}(),Qr=function(){function e(){}return e.RGBA8=0,e.RGBA32F=1,e}(),qr=function(D){function t(){return null!==D&&D.apply(this,arguments)||this}return Object(Z.d)(t,D),t.prototype.getInternalTexture=function(){return this},t.prototype.getViewCount=function(){return 1},t}($t.a),Zr=function(D){function t(){var w=D.call(this,null)||this;return w._native=new _native.Engine,w.INVALID_HANDLE=65535,w._webGLVersion=2,w.disableUniformBuffers=!0,w._caps={maxTexturesImageUnits:16,maxVertexTextureImageUnits:16,maxCombinedTexturesImageUnits:32,maxTextureSize:512,maxCubemapTextureSize:512,maxRenderTextureSize:512,maxVertexAttribs:16,maxVaryingVectors:16,maxFragmentUniformVectors:16,maxVertexUniformVectors:16,standardDerivatives:!0,astc:null,pvrtc:null,etc1:null,etc2:null,maxAnisotropy:16,uintIndices:!1,fragmentDepthSupported:!1,highPrecisionShaderSupported:!0,colorBufferFloat:!1,textureFloat:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloat:!1,textureHalfFloatLinearFiltering:!1,textureHalfFloatRender:!1,textureLOD:!0,drawBuffersExtension:!1,depthTextureExtension:!1,vertexArrayObject:!0,instancedArrays:!1,canUseTimestampForTimerQuery:!1,blendMinMax:!1,maxMSAASamples:1},Dt.b.Log("Babylon Native (v"+Ct.a.Version+") launched"),"undefined"==typeof URL&&(window.URL={createObjectURL:function(){},revokeObjectURL:function(){}}),"undefined"==typeof Blob&&(window.Blob=function(){}),w._shaderProcessor=new Gr,w}return Object(Z.d)(t,D),t.prototype.getHardwareScalingLevel=function(){return 1},t.prototype._queueNewFrame=function(D,w){return w.requestAnimationFrame?w.requestAnimationFrame(D):this._native.requestAnimationFrame(D),0},t.prototype._bindUnboundFramebuffer=function(D){this._currentFramebuffer!==D&&(this._currentFramebuffer&&this._native.unbindFramebuffer(this._currentFramebuffer),D&&this._native.bindFramebuffer(D),this._currentFramebuffer=D)},t.prototype.getHostDocument=function(){return null},t.prototype.clear=function(D,w,N,F){void 0===F&&(F=!1);var k=0;w&&D&&(this._native.clearColor(D.r,D.g,D.b,void 0!==D.a?D.a:1),k|=Xr.CLEAR_COLOR),N&&(this._native.clearDepth(1),k|=Xr.CLEAR_DEPTH),F&&(this._native.clearStencil(0),k|=Xr.CLEAR_STENCIL),this._native.clear(k)},t.prototype.createIndexBuffer=function(D){var w=this._normalizeIndexData(D),N=new Hr;if(N.references=1,N.is32Bits=4===w.BYTES_PER_ELEMENT,N.nativeIndexBuffer=this._native.createIndexBuffer(w),N.nativeVertexBuffer===this.INVALID_HANDLE)throw new Error("Could not create a native index buffer.");return N},t.prototype.createVertexBuffer=function(D){var w=new Hr;if(w.references=1,w.nativeVertexBuffer=this._native.createVertexBuffer(ArrayBuffer.isView(D)?D:new Float32Array(D)),w.nativeVertexBuffer===this.INVALID_HANDLE)throw new Error("Could not create a native vertex buffer.");return w},t.prototype.recordVertexArrayObject=function(D,w,N){var F=this._native.createVertexArray();w&&this._native.recordIndexBuffer(F,w.nativeIndexBuffer);for(var k=N.getAttributesNames(),j=0;j<k.length;j++){var z=N.getAttributeLocation(j);if(z>=0){var G=D[k[j]];if(G){var H=G.getBuffer();H&&this._native.recordVertexBuffer(F,H.nativeVertexBuffer,z,G.byteOffset,G.byteStride,G.getSize(),G.type,G.normalized)}}}return F},t.prototype.bindVertexArrayObject=function(D){this._native.bindVertexArray(D)},t.prototype.releaseVertexArrayObject=function(D){this._native.deleteVertexArray(D)},t.prototype.getAttributes=function(D,w){var N=D;return this._native.getAttributes(N.nativeProgram,w)},t.prototype.drawElementsType=function(D,w,N,F){this._drawCalls.addCount(1,!1),this._native.drawIndexed(D,w,N)},t.prototype.drawArraysType=function(D,w,N,F){this._drawCalls.addCount(1,!1),this._native.draw(D,w,N)},t.prototype.createPipelineContext=function(){return new Yr},t.prototype._preparePipelineContext=function(D,w,N,F,k,j,z){D.nativeProgram=F?this.createRawShaderProgram(D,w,N,void 0,z):this.createShaderProgram(D,w,N,j,void 0,z)},t.prototype._isRenderingStateCompiled=function(D){return!0},t.prototype._executeWhenRenderingStateIsCompiled=function(D,w){w()},t.prototype.createRawShaderProgram=function(D,w,N,F,k){throw void 0===k&&(k=null),new Error("Not Supported")},t.prototype.createShaderProgram=function(D,w,N,F,k,j){void 0===j&&(j=null),this.onBeforeShaderCompilationObservable.notifyObservers(this);var z=this._native.createProgram(di.a._ConcatenateShader(w,F),di.a._ConcatenateShader(N,F));return this.onAfterShaderCompilationObservable.notifyObservers(this),z},t.prototype._setProgram=function(D){this._currentProgram!==D&&(this._native.setProgram(D),this._currentProgram=D)},t.prototype._releaseEffect=function(D){},t.prototype._deletePipelineContext=function(D){},t.prototype.getUniforms=function(D,w){var N=D;return this._native.getUniforms(N.nativeProgram,w)},t.prototype.bindUniformBlock=function(D,w,N){throw new Error("Not Implemented")},t.prototype.bindSamplers=function(D){var w=D.getPipelineContext();this._setProgram(w.nativeProgram);for(var N=D.getSamplers(),F=0;F<N.length;F++){var k=D.getUniform(N[F]);k&&(this._boundUniforms[F]=k)}this._currentEffect=null},t.prototype.setMatrix=function(D,w){D&&this._native.setMatrix(D,w.toArray())},t.prototype.getRenderWidth=function(D){return void 0===D&&(D=!1),!D&&this._currentRenderTarget?this._currentRenderTarget.width:this._native.getRenderWidth()},t.prototype.getRenderHeight=function(D){return void 0===D&&(D=!1),!D&&this._currentRenderTarget?this._currentRenderTarget.height:this._native.getRenderHeight()},t.prototype.setViewport=function(D,w,N){this._cachedViewport=D,this._native.setViewPort(D.x,D.y,D.width,D.height)},t.prototype.setState=function(D,w,N,F){void 0===w&&(w=0),void 0===F&&(F=!1),this._native.setState(D,w,F)},t.prototype.setZOffset=function(D){this._native.setZOffset(D)},t.prototype.getZOffset=function(){return this._native.getZOffset()},t.prototype.setDepthBuffer=function(D){this._native.setDepthTest(D)},t.prototype.getDepthWrite=function(){return this._native.getDepthWrite()},t.prototype.setDepthWrite=function(D){this._native.setDepthWrite(D)},t.prototype.setColorWrite=function(D){this._native.setColorWrite(D),this._colorWrite=D},t.prototype.getColorWrite=function(){return this._colorWrite},t.prototype.setAlphaConstants=function(D,w,N,F){throw new Error("Setting alpha blend constant color not yet implemented.")},t.prototype.setAlphaMode=function(D,w){void 0===w&&(w=!1),this._alphaMode!==D&&(this._native.setBlendMode(D),w||this.setDepthWrite(D===ce.a.ALPHA_DISABLE),this._alphaMode=D)},t.prototype.getAlphaMode=function(){return this._alphaMode},t.prototype.setInt=function(D,w){D&&this._native.setInt(D,w)},t.prototype.setIntArray=function(D,w){D&&this._native.setIntArray(D,w)},t.prototype.setIntArray2=function(D,w){D&&this._native.setIntArray2(D,w)},t.prototype.setIntArray3=function(D,w){D&&this._native.setIntArray3(D,w)},t.prototype.setIntArray4=function(D,w){D&&this._native.setIntArray4(D,w)},t.prototype.setFloatArray=function(D,w){D&&this._native.setFloatArray(D,w)},t.prototype.setFloatArray2=function(D,w){D&&this._native.setFloatArray2(D,w)},t.prototype.setFloatArray3=function(D,w){D&&this._native.setFloatArray3(D,w)},t.prototype.setFloatArray4=function(D,w){D&&this._native.setFloatArray4(D,w)},t.prototype.setArray=function(D,w){D&&this._native.setFloatArray(D,w)},t.prototype.setArray2=function(D,w){D&&this._native.setFloatArray2(D,w)},t.prototype.setArray3=function(D,w){D&&this._native.setFloatArray3(D,w)},t.prototype.setArray4=function(D,w){D&&this._native.setFloatArray4(D,w)},t.prototype.setMatrices=function(D,w){D&&this._native.setMatrices(D,w)},t.prototype.setMatrix3x3=function(D,w){D&&this._native.setMatrix3x3(D,w)},t.prototype.setMatrix2x2=function(D,w){D&&this._native.setMatrix2x2(D,w)},t.prototype.setFloat=function(D,w){D&&this._native.setFloat(D,w)},t.prototype.setFloat2=function(D,w,N){D&&this._native.setFloat2(D,w,N)},t.prototype.setFloat3=function(D,w,N,F){D&&this._native.setFloat3(D,w,N,F)},t.prototype.setFloat4=function(D,w,N,F,k){D&&this._native.setFloat4(D,w,N,F,k)},t.prototype.setColor3=function(D,w){D&&this._native.setFloat3(D,w.r,w.g,w.b)},t.prototype.setColor4=function(D,w,N){D&&this._native.setFloat4(D,w.r,w.g,w.b,N)},t.prototype.wipeCaches=function(D){this.preventCacheWipeBetweenFrames||(this.resetTextureCache(),this._currentEffect=null,D&&(this._currentProgram=null,this._stencilState.reset(),this._depthCullingState.reset(),this._alphaState.reset()),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null)},t.prototype._createTexture=function(){return this._native.createTexture()},t.prototype._deleteTexture=function(D){this._native.deleteTexture(D)},t.prototype.createTexture=function(D,w,N,F,k,j,z,G,H,X,q,Z){var J=this;void 0===k&&(k=ce.a.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===j&&(j=null),void 0===z&&(z=null),void 0===G&&(G=null),void 0===H&&(H=null),void 0===X&&(X=null),void 0===q&&(q=null);for(var $=String(D),te="data:"===$.substr(0,5),ie="blob:"===$.substr(0,5),oe=H||new $t.a(this,$t.b.Url),he=$.lastIndexOf("."),fe=q||(he>-1?$.substring(he).toLowerCase():""),pe=null,_e=0,ve=Ct.a._TextureLoaders;_e<ve.length;_e++){var ye=ve[_e];if(ye.canLoad(fe)){pe=ye;break}}F&&F._addPendingData(oe),oe.url=$,oe.generateMipMaps=!w,oe.samplingMode=k,oe.invertY=N,this.doNotHandleContextLost||(oe._buffer=G);var be=null;if(j&&!H&&(be=oe.onLoadedObservable.add(j)),H||this._internalTexturesCache.push(oe),pe)throw new Error("Loading textures from IInternalTextureLoader not yet implemented.");var A=function(D,j){if("string"==typeof D)throw new Error("Loading textures from string data not yet implemented.");ie&&!J.doNotHandleContextLost&&(oe._buffer=D);var z=oe._webGLTexture;if(z){if(!J._native.loadTexture(z,D,!w,N))throw new Error("Could not load a native texture.");oe.baseWidth=J._native.getTextureWidth(z),oe.baseHeight=J._native.getTextureHeight(z),oe.width=oe.baseWidth,oe.height=oe.baseHeight,oe.isReady=!0;var G=J._getSamplingFilter(k);J._native.setTextureSampling(z,G),F&&F._removePendingData(oe),oe.onLoadedObservable.notifyObservers(oe),oe.onLoadedObservable.clear()}else F&&F._removePendingData(oe)};if(G instanceof ArrayBuffer)A(G);else if(ArrayBuffer.isView(G))A(G.buffer);else{if(G instanceof Blob)throw new Error("Loading texture from Blob not yet implemented.");te?A(Dt.b.DecodeBase64(G)):Dt.b.LoadFile($,A,void 0,void 0,!0,(function(D,j){!function(D,j){F&&F._removePendingData(oe),be&&oe.onLoadedObservable.remove(be),Dt.b.UseFallbackTexture&&J.createTexture(Dt.b.fallbackTexture,w,N,F,k,null,z,G,oe),z&&z(D||"Unknown error",j)}("Failed to retrieve "+$+".",j)}))}return oe},t.prototype.createCubeTexture=function(D,w,N,F,k,j,z,G,H,X,q,Z){var J=this;void 0===k&&(k=null),void 0===j&&(j=null),void 0===G&&(G=null),void 0===H&&(H=!1),void 0===X&&(X=0),void 0===q&&(q=0),void 0===Z&&(Z=null);var $=Z||new $t.a(this,$t.b.Cube);$.isCube=!0,$.url=D,$.generateMipMaps=!F,$._lodGenerationScale=X,$._lodGenerationOffset=q,this._doNotHandleContextLost||($._extension=G,$._files=N);var te=D.lastIndexOf(".");if(".env"===(G||(te>-1?D.substring(te).toLowerCase():""))){if(N&&6===N.length)throw new Error("Multi-file loading not allowed on env files.");this._loadFile(D,(function(D){return function(D){var w=Ur.GetEnvInfo(D);if($.width=w.width,$.height=w.width,Ur.UploadEnvSpherical($,w),1!==w.version)throw new Error('Unsupported babylon environment map version "'+w.version+'"');var N=w.specular;if(!N)throw new Error("Nothing else parsed so far");$._lodGenerationScale=N.lodGenerationScale;var F=Ur.CreateImageDataArrayBufferViews(D,w);if($.format=ce.a.TEXTUREFORMAT_RGBA,$.type=ce.a.TEXTURETYPE_UNSIGNED_INT,$.generateMipMaps=!0,$.getEngine().updateTextureSamplingMode(Jt.a.TRILINEAR_SAMPLINGMODE,$),$._isRGBD=!0,$.invertY=!0,!J._native.loadEnvTexture($._webGLTexture,F))throw new Error("Could not load a native cube texture.");$.isReady=!0,k&&k()}(new Uint8Array(D))}),void 0,void 0,!0,(function(D,w){j&&D&&j(D.status+" "+D.statusText,w)}))}else{if(!N||6!==N.length)throw new Error("Cannot load cubemap because 6 files were not defined");var ie=[N[0],N[3],N[1],N[4],N[2],N[5]];Promise.all(ie.map((function(D){return Dt.b.LoadFileAsync(D).then((function(D){return new Uint8Array(D)}))}))).then((function(D){J._native.loadCubeTexture($._webGLTexture,D,!F)})).then((function(){$.isReady=!0,k&&k()}),(function(D){j&&j("Failed to load cubemap: "+D.message,D)}))}return this._internalTexturesCache.push($),$},t.prototype._getSamplingFilter=function(D){switch(D){case ce.a.TEXTURE_BILINEAR_SAMPLINGMODE:return Wr.MINLINEAR_MAGLINEAR_MIPPOINT;case ce.a.TEXTURE_TRILINEAR_SAMPLINGMODE:return Wr.MINLINEAR_MAGLINEAR_MIPLINEAR;case ce.a.TEXTURE_NEAREST_SAMPLINGMODE:return Wr.MINPOINT_MAGPOINT_MIPLINEAR;case ce.a.TEXTURE_NEAREST_NEAREST_MIPNEAREST:return Wr.MINPOINT_MAGPOINT_MIPPOINT;case ce.a.TEXTURE_NEAREST_LINEAR_MIPNEAREST:return Wr.MINLINEAR_MAGPOINT_MIPPOINT;case ce.a.TEXTURE_NEAREST_LINEAR_MIPLINEAR:case ce.a.TEXTURE_NEAREST_LINEAR:return Wr.MINLINEAR_MAGPOINT_MIPLINEAR;case ce.a.TEXTURE_NEAREST_NEAREST:return Wr.MINPOINT_MAGPOINT_MIPPOINT;case ce.a.TEXTURE_LINEAR_NEAREST_MIPNEAREST:return Wr.MINPOINT_MAGLINEAR_MIPPOINT;case ce.a.TEXTURE_LINEAR_NEAREST_MIPLINEAR:return Wr.MINPOINT_MAGLINEAR_MIPLINEAR;case ce.a.TEXTURE_LINEAR_LINEAR:return Wr.MINLINEAR_MAGLINEAR_MIPLINEAR;case ce.a.TEXTURE_LINEAR_NEAREST:return Wr.MINPOINT_MAGLINEAR_MIPLINEAR;default:throw new Error("Unexpected sampling mode: "+D+".")}},t._GetNativeTextureFormat=function(D,w){if(D==ce.a.TEXTUREFORMAT_RGBA&&w==ce.a.TEXTURETYPE_UNSIGNED_INT)return Qr.RGBA8;if(D==ce.a.TEXTUREFORMAT_RGBA&&w==ce.a.TEXTURETYPE_FLOAT)return Qr.RGBA32F;throw new Error("Unexpected texture format or type: format "+D+", type "+w+".")},t.prototype.createRenderTargetTexture=function(D,w){var N=new hi.a;void 0!==w&&"object"==typeof w?(N.generateMipMaps=w.generateMipMaps,N.generateDepthBuffer=void 0===w.generateDepthBuffer||w.generateDepthBuffer,N.generateStencilBuffer=N.generateDepthBuffer&&w.generateStencilBuffer,N.type=void 0===w.type?ce.a.TEXTURETYPE_UNSIGNED_INT:w.type,N.samplingMode=void 0===w.samplingMode?ce.a.TEXTURE_TRILINEAR_SAMPLINGMODE:w.samplingMode,N.format=void 0===w.format?ce.a.TEXTUREFORMAT_RGBA:w.format):(N.generateMipMaps=w,N.generateDepthBuffer=!0,N.generateStencilBuffer=!1,N.type=ce.a.TEXTURETYPE_UNSIGNED_INT,N.samplingMode=ce.a.TEXTURE_TRILINEAR_SAMPLINGMODE,N.format=ce.a.TEXTUREFORMAT_RGBA),(N.type!==ce.a.TEXTURETYPE_FLOAT||this._caps.textureFloatLinearFiltering)&&(N.type!==ce.a.TEXTURETYPE_HALF_FLOAT||this._caps.textureHalfFloatLinearFiltering)||(N.samplingMode=ce.a.TEXTURE_NEAREST_SAMPLINGMODE);var F=new qr(this,$t.b.RenderTarget),k=D.width||D,j=D.height||D;N.type!==ce.a.TEXTURETYPE_FLOAT||this._caps.textureFloat||(N.type=ce.a.TEXTURETYPE_UNSIGNED_INT,oe.a.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type"));var z=this._native.createFramebuffer(F._webGLTexture,k,j,t._GetNativeTextureFormat(N.format,N.type),N.samplingMode,!!N.generateStencilBuffer,N.generateDepthBuffer,!!N.generateMipMaps);return F._framebuffer=z,F.baseWidth=k,F.baseHeight=j,F.width=k,F.height=j,F.isReady=!0,F.samples=1,F.generateMipMaps=!!N.generateMipMaps,F.samplingMode=N.samplingMode,F.type=N.type,F.format=N.format,F._generateDepthBuffer=N.generateDepthBuffer,F._generateStencilBuffer=!!N.generateStencilBuffer,this._internalTexturesCache.push(F),F},t.prototype.updateTextureSamplingMode=function(D,w){if(w._webGLTexture){var N=this._getSamplingFilter(D);this._native.setTextureSampling(w._webGLTexture,N)}w.samplingMode=D},t.prototype.bindFramebuffer=function(D,w,N,F,k){if(w)throw new Error("Cuboid frame buffers are not yet supported in NativeEngine.");if(N||F)throw new Error("Required width/height for frame buffers not yet supported in NativeEngine.");if(k)throw new Error("forceFullscreenViewport for frame buffers not yet supported in NativeEngine.");this._bindUnboundFramebuffer(D._framebuffer)},t.prototype.unBindFramebuffer=function(D,w,N){void 0===w&&(w=!1),w&&oe.a.Warn("Disabling mipmap generation not yet supported in NativeEngine. Ignoring."),N&&N(),this._bindUnboundFramebuffer(null)},t.prototype.createDynamicVertexBuffer=function(D){throw new Error("createDynamicVertexBuffer not yet implemented.")},t.prototype.updateDynamicIndexBuffer=function(D,w,N){throw void 0===N&&(N=0),new Error("updateDynamicIndexBuffer not yet implemented.")},t.prototype.updateDynamicVertexBuffer=function(D,w,N,F){throw new Error("updateDynamicVertexBuffer not yet implemented.")},t.prototype._setTexture=function(D,w,N,F){void 0===N&&(N=!1),void 0===F&&(F=!1);var k,j=this._boundUniforms[D];if(!j)return!1;if(!w)return null!=this._boundTexturesCache[D]&&(this._activeChannel=D,this._native.setTexture(j,null)),!1;if(w.video)this._activeChannel=D,w.update();else if(w.delayLoadState===ce.a.DELAYLOADSTATE_NOTLOADED)return w.delayLoad(),!1;return k=F?w.depthStencilTexture:w.isReady()?w.getInternalTexture():w.isCube?this.emptyCubeTexture:w.is3D?this.emptyTexture3D:w.is2DArray?this.emptyTexture2DArray:this.emptyTexture,this._activeChannel=D,!(!k||!k._webGLTexture||(this._native.setTextureWrapMode(k._webGLTexture,this._getAddressMode(w.wrapU),this._getAddressMode(w.wrapV),this._getAddressMode(w.wrapR)),this._updateAnisotropicLevel(w),this._native.setTexture(j,k._webGLTexture),0))},t.prototype._updateAnisotropicLevel=function(D){var w=D.getInternalTexture(),N=D.anisotropicFilteringLevel;w&&w._webGLTexture&&w._cachedAnisotropicFilteringLevel!==N&&(this._native.setTextureAnisotropicLevel(w._webGLTexture,N),w._cachedAnisotropicFilteringLevel=N)},t.prototype._getAddressMode=function(D){switch(D){case ce.a.TEXTURE_WRAP_ADDRESSMODE:return Kr.WRAP;case ce.a.TEXTURE_CLAMP_ADDRESSMODE:return Kr.CLAMP;case ce.a.TEXTURE_MIRROR_ADDRESSMODE:return Kr.MIRROR;default:throw new Error("Unexpected wrap mode: "+D+".")}},t.prototype._bindTexture=function(D,w){throw new Error("_bindTexture not implemented.")},t.prototype._deleteBuffer=function(D){D.nativeIndexBuffer&&(this._native.deleteIndexBuffer(D.nativeIndexBuffer),delete D.nativeIndexBuffer),D.nativeVertexBuffer&&(this._native.deleteVertexBuffer(D.nativeVertexBuffer),delete D.nativeVertexBuffer)},t.prototype.releaseEffects=function(){},t.prototype._uploadCompressedDataToTextureDirectly=function(D,w,N,F,k,j,z){throw void 0===j&&(j=0),void 0===z&&(z=0),new Error("_uploadCompressedDataToTextureDirectly not implemented.")},t.prototype._uploadDataToTextureDirectly=function(D,w,N,F){throw void 0===N&&(N=0),void 0===F&&(F=0),new Error("_uploadDataToTextureDirectly not implemented.")},t.prototype._uploadArrayBufferViewToTexture=function(D,w,N,F){throw void 0===N&&(N=0),void 0===F&&(F=0),new Error("_uploadArrayBufferViewToTexture not implemented.")},t.prototype._uploadImageToTexture=function(D,w,N,F){throw void 0===N&&(N=0),void 0===F&&(F=0),new Error("_uploadArrayBufferViewToTexture not implemented.")},t}(Ct.a),Jr=function(){function e(){}return e.COPY=1,e.CUT=2,e.PASTE=3,e}(),$r=function(){function e(D,w){this.type=D,this.event=w}return e.GetTypeFromCharacter=function(D){switch(D){case 67:return Jr.COPY;case 86:return Jr.PASTE;case 88:return Jr.CUT;default:return-1}},e}(),eo=N(76),no=N(67),io=function(){function e(D,w,N){this.lengthComputable=D,this.loaded=w,this.total=N}return e.FromProgressEvent=function(D){return new e(D.lengthComputable,D.loaded,D.total)},e}();!function(D){D[D.Clean=0]="Clean",D[D.Stop=1]="Stop",D[D.Sync=2]="Sync",D[D.NoSync=3]="NoSync"}(Vr||(Vr={}));var ro=function(){function e(){}return Object.defineProperty(e,"ForceFullSceneLoadingForIncremental",{get:function(){return no.a.ForceFullSceneLoadingForIncremental},set:function(D){no.a.ForceFullSceneLoadingForIncremental=D},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ShowLoadingScreen",{get:function(){return no.a.ShowLoadingScreen},set:function(D){no.a.ShowLoadingScreen=D},enumerable:!0,configurable:!0}),Object.defineProperty(e,"loggingLevel",{get:function(){return no.a.loggingLevel},set:function(D){no.a.loggingLevel=D},enumerable:!0,configurable:!0}),Object.defineProperty(e,"CleanBoneMatrixWeights",{get:function(){return no.a.CleanBoneMatrixWeights},set:function(D){no.a.CleanBoneMatrixWeights=D},enumerable:!0,configurable:!0}),e._getDefaultPlugin=function(){return e._registeredPlugins[".babylon"]},e._getPluginForExtension=function(D){return e._registeredPlugins[D]||(oe.a.Warn("Unable to find a plugin to load "+D+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: http://doc.babylonjs.com/how_to/load_from_any_file_type"),e._getDefaultPlugin())},e._getPluginForDirectLoad=function(D){for(var w in e._registeredPlugins){var N=e._registeredPlugins[w].plugin;if(N.canDirectLoad&&N.canDirectLoad(D))return e._registeredPlugins[w]}return e._getDefaultPlugin()},e._getPluginForFilename=function(D){var w=D.indexOf("?");-1!==w&&(D=D.substring(0,w));var N=D.lastIndexOf("."),F=D.substring(N,D.length).toLowerCase();return e._getPluginForExtension(F)},e._getDirectLoad=function(D){return"data:"===D.substr(0,5)?D.substr(5):null},e._loadData=function(D,w,N,F,k,j,z){var G,H=e._getDirectLoad(D.name),X=z?e._getPluginForExtension(z):H?e._getPluginForDirectLoad(D.name):e._getPluginForFilename(D.name);if(!(G=X.plugin.createPlugin?X.plugin.createPlugin():X.plugin))throw"The loader plugin corresponding to the file type you are trying to load has not been found. If using es6, please import the plugin you wish to use before.";if(e.OnPluginActivatedObservable.notifyObservers(G),H)return N(G,G.directLoad?G.directLoad(w,H):H),G;var q=X.isBinary,d=function(D,F){w.isDisposed?k("Scene has been disposed"):N(G,D,F)},Z=null,J=!1,$=G.onDisposeObservable;$&&$.add((function(){J=!0,Z&&(Z.abort(),Z=null),j()}));var te=F?function(D){F(io.FromProgressEvent(D))}:void 0,g=function(){if(!J){var e=function(D,w){d(D,w?w.responseURL:void 0)},n=function(D){k(D.message,D)};Z=G.requestFile?G.requestFile(w,D.url,e,te,q,n):w._requestFile(D.url,e,te,!0,q,n)}},ie=D.file||eo.a.FilesToLoad[D.name.toLowerCase()];if(-1===D.rootUrl.indexOf("file:")||-1!==D.rootUrl.indexOf("file:")&&!ie){var oe=w.getEngine(),ce=oe.enableOfflineSupport;if(ce){for(var he=!1,fe=0,pe=w.disableOfflineSupportExceptionRules;fe<pe.length;fe++)if(pe[fe].test(D.url)){he=!0;break}ce=!he}ce&&Ct.a.OfflineProviderFactory?w.offlineProvider=Ct.a.OfflineProviderFactory(D.url,g,oe.disableManifestCheck):g()}else if(ie){var P=function(D){k(D.message,D)};Z=G.readFile?G.readFile(w,ie,d,te,q,P):w._readFile(ie,d,te,q,P)}else k("Unable to find file named "+D.name);return G},e._getFileInfo=function(D,w){var N,F,k=null;if(w)if(w.name){var j=w;N=D+j.name,F=j.name,k=j}else{var z=w;if("/"===z.substr(0,1))return Dt.b.Error("Wrong sceneFilename parameter"),null;N=D+z,F=z}else N=D,F=Dt.b.GetFilename(D),D=Dt.b.GetFolderPath(D);return{url:N,rootUrl:D,name:F,file:k}},e.GetPluginForExtension=function(D){return e._getPluginForExtension(D).plugin},e.IsPluginForExtensionAvailable=function(D){return!!e._registeredPlugins[D]},e.RegisterPlugin=function(D){if("string"==typeof D.extensions){var w=D.extensions;e._registeredPlugins[w.toLowerCase()]={plugin:D,isBinary:!1}}else{var N=D.extensions;Object.keys(N).forEach((function(w){e._registeredPlugins[w.toLowerCase()]={plugin:D,isBinary:N[w].isBinary}}))}},e.ImportMesh=function(D,w,N,F,k,j,z,G){if(void 0===N&&(N=""),void 0===F&&(F=Me.a.LastCreatedScene),void 0===k&&(k=null),void 0===j&&(j=null),void 0===z&&(z=null),void 0===G&&(G=null),!F)return oe.a.Error("No scene available to import mesh to"),null;var H=e._getFileInfo(w,N);if(!H)return null;var X={};F._addPendingData(X);var h=function(){F._removePendingData(X)},d=function(D,w){var N="Unable to import meshes from "+H.url+": "+D;z?z(F,N,w):oe.a.Error(N),h()},q=j?function(D){try{j(D)}catch(D){d("Error in onProgress callback: "+D,D)}}:void 0,p=function(D,w,N,j){if(F.importedMeshesFiles.push(H.url),k)try{k(D,w,N,j)}catch(D){d("Error in onSuccess callback: "+D,D)}F._removePendingData(X)};return e._loadData(H,F,(function(w,N,k){if(w.rewriteRootURL&&(H.rootUrl=w.rewriteRootURL(H.rootUrl,k)),w.importMesh){var j=w,z=new Array,G=new Array,X=new Array;if(!j.importMesh(D,F,N,H.rootUrl,z,G,X,d))return;F.loadingPluginName=w.name,p(z,G,X,[])}else w.importMeshAsync(D,F,N,H.rootUrl,q,H.name).then((function(D){F.loadingPluginName=w.name,p(D.meshes,D.particleSystems,D.skeletons,D.animationGroups)})).catch((function(D){d(D.message,D)}))}),q,d,h,G)},e.ImportMeshAsync=function(D,w,N,F,k,j){return void 0===N&&(N=""),void 0===F&&(F=Me.a.LastCreatedScene),void 0===k&&(k=null),void 0===j&&(j=null),new Promise((function(z,G){e.ImportMesh(D,w,N,F,(function(D,w,N,F){z({meshes:D,particleSystems:w,skeletons:N,animationGroups:F})}),k,(function(D,w,N){G(N||new Error(w))}),j)}))},e.Load=function(D,w,N,F,k,j,z){return void 0===w&&(w=""),void 0===N&&(N=Me.a.LastCreatedEngine),void 0===F&&(F=null),void 0===k&&(k=null),void 0===j&&(j=null),void 0===z&&(z=null),N?e.Append(D,w,new We.a(N),F,k,j,z):(Dt.b.Error("No engine available"),null)},e.LoadAsync=function(D,w,N,F,k){return void 0===w&&(w=""),void 0===N&&(N=Me.a.LastCreatedEngine),void 0===F&&(F=null),void 0===k&&(k=null),new Promise((function(j,z){e.Load(D,w,N,(function(D){j(D)}),F,(function(D,w,N){z(N||new Error(w))}),k)}))},e.Append=function(D,w,N,F,k,j,z){if(void 0===w&&(w=""),void 0===N&&(N=Me.a.LastCreatedScene),void 0===F&&(F=null),void 0===k&&(k=null),void 0===j&&(j=null),void 0===z&&(z=null),!N)return oe.a.Error("No scene available to append to"),null;var G=e._getFileInfo(D,w);if(!G)return null;e.ShowLoadingScreen&&N.getEngine().displayLoadingUI();var H={};N._addPendingData(H);var u=function(){N._removePendingData(H),N.getEngine().hideLoadingUI()},h=function(D,w){var F="Unable to load from "+G.url+(D?": "+D:"");j?j(N,F,w):oe.a.Error(F),u()},X=k?function(D){try{k(D)}catch(D){h("Error in onProgress callback",D)}}:void 0,f=function(){if(F)try{F(N)}catch(D){h("Error in onSuccess callback",D)}N._removePendingData(H)};return e._loadData(G,N,(function(D,w){if(D.load){if(!D.load(N,w,G.rootUrl,h))return;N.loadingPluginName=D.name,f()}else D.loadAsync(N,w,G.rootUrl,X,G.name).then((function(){N.loadingPluginName=D.name,f()})).catch((function(D){h(D.message,D)}));e.ShowLoadingScreen&&N.executeWhenReady((function(){N.getEngine().hideLoadingUI()}))}),X,h,u,z)},e.AppendAsync=function(D,w,N,F,k){return void 0===w&&(w=""),void 0===N&&(N=Me.a.LastCreatedScene),void 0===F&&(F=null),void 0===k&&(k=null),new Promise((function(j,z){e.Append(D,w,N,(function(D){j(D)}),F,(function(D,w,N){z(N||new Error(w))}),k)}))},e.LoadAssetContainer=function(D,w,N,F,k,j,z){if(void 0===w&&(w=""),void 0===N&&(N=Me.a.LastCreatedScene),void 0===F&&(F=null),void 0===k&&(k=null),void 0===j&&(j=null),void 0===z&&(z=null),!N)return oe.a.Error("No scene available to load asset container to"),null;var G=e._getFileInfo(D,w);if(!G)return null;var H={};N._addPendingData(H);var u=function(){N._removePendingData(H)},h=function(D,w){var F="Unable to load assets from "+G.url+(D?": "+D:"");w&&w.message&&(F+=" ("+w.message+")"),j?j(N,F,w):oe.a.Error(F),u()},X=k?function(D){try{k(D)}catch(D){h("Error in onProgress callback",D)}}:void 0,f=function(D){if(F)try{F(D)}catch(D){h("Error in onSuccess callback",D)}N._removePendingData(H)};return e._loadData(G,N,(function(D,w){if(D.loadAssetContainer){var F=D.loadAssetContainer(N,w,G.rootUrl,h);if(!F)return;N.loadingPluginName=D.name,f(F)}else D.loadAssetContainerAsync?D.loadAssetContainerAsync(N,w,G.rootUrl,X,G.name).then((function(w){N.loadingPluginName=D.name,f(w)})).catch((function(D){h(D.message,D)})):h("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.");e.ShowLoadingScreen&&N.executeWhenReady((function(){N.getEngine().hideLoadingUI()}))}),X,h,u,z)},e.LoadAssetContainerAsync=function(D,w,N,F,k){return void 0===w&&(w=""),void 0===N&&(N=Me.a.LastCreatedScene),void 0===F&&(F=null),void 0===k&&(k=null),new Promise((function(j,z){e.LoadAssetContainer(D,w,N,(function(D){j(D)}),F,(function(D,w,N){z(N||new Error(w))}),k)}))},e.ImportAnimations=function(D,w,N,F,k,j,z,G,H){if(void 0===w&&(w=""),void 0===N&&(N=Me.a.LastCreatedScene),void 0===F&&(F=!0),void 0===k&&(k=Vr.Clean),void 0===j&&(j=null),void 0===z&&(z=null),void 0===G&&(G=null),void 0===H&&(H=null),N){if(F){for(var X=0,q=N.animatables;X<q.length;X++)q[X].reset();N.stopAllAnimations(),N.animationGroups.slice().forEach((function(D){D.dispose()})),N.getNodes().forEach((function(D){D.animations&&(D.animations=[])}))}else switch(k){case Vr.Clean:N.animationGroups.slice().forEach((function(D){D.dispose()}));break;case Vr.Stop:N.animationGroups.forEach((function(D){D.stop()}));break;case Vr.Sync:N.animationGroups.forEach((function(D){D.reset(),D.restart()}));break;case Vr.NoSync:break;default:return void oe.a.Error("Unknown animation group loading mode value '"+k+"'")}var Z=N.animatables.length;this.LoadAssetContainer(D,w,N,(function(D){D.mergeAnimationsTo(N,N.animatables.slice(Z),j),D.dispose(),N.onAnimationFileImportedObservable.notifyObservers(N),z&&z(N)}),G,H)}else oe.a.Error("No scene available to load animations to")},e.ImportAnimationsAsync=function(D,w,N,F,k,j,z,G,H){return void 0===w&&(w=""),void 0===N&&(N=Me.a.LastCreatedScene),void 0===F&&(F=!0),void 0===k&&(k=Vr.Clean),void 0===j&&(j=null),void 0===z&&(z=null),void 0===G&&(G=null),void 0===H&&(H=null),new Promise((function(z,H){e.ImportAnimations(D,w,N,F,k,j,(function(D){z(D)}),G,(function(D,w,N){H(N||new Error(w))}))}))},e.NO_LOGGING=ce.a.SCENELOADER_NO_LOGGING,e.MINIMAL_LOGGING=ce.a.SCENELOADER_MINIMAL_LOGGING,e.SUMMARY_LOGGING=ce.a.SCENELOADER_SUMMARY_LOGGING,e.DETAILED_LOGGING=ce.a.SCENELOADER_DETAILED_LOGGING,e.OnPluginActivatedObservable=new j.c,e._registeredPlugins={},e}(),oo=function(D){function t(w){var N=D.call(this,w)||this;return N.controllerType=Yn.DAYDREAM,N}return Object(Z.d)(t,D),t.prototype.initControllerMesh=function(D,w){var N=this;ro.ImportMesh("",t.MODEL_BASE_URL,t.MODEL_FILENAME,D,(function(D){N._defaultModel=D[1],N.attachToMesh(N._defaultModel),w&&w(N._defaultModel)}))},t.prototype._handleButtonChange=function(D,w,N){if(0===D){var F=this.onTriggerStateChangedObservable;F&&F.notifyObservers(w)}else oe.a.Warn("Unrecognized Daydream button index: "+D)},t.MODEL_BASE_URL="https://controllers.babylonjs.com/generic/",t.MODEL_FILENAME="generic.babylon",t.GAMEPAD_ID_PREFIX="Daydream",t}(Gi);Jn._ControllerFactories.push({canCreate:function(D){return 0===D.id.indexOf(oo.GAMEPAD_ID_PREFIX)},create:function(D){return new oo(D)}});var ao=function(D){function t(w){var N=D.call(this,w)||this;return N._buttonIndexToObservableNameMap=["onPadStateChangedObservable","onTriggerStateChangedObservable"],N.controllerType=Yn.GEAR_VR,N._calculatedPosition=new z.e("left"==N.hand?-.15:.15,-.5,.25),N._disableTrackPosition(N._calculatedPosition),N}return Object(Z.d)(t,D),t.prototype.initControllerMesh=function(D,w){var N=this;ro.ImportMesh("",t.MODEL_BASE_URL,t.MODEL_FILENAME,D,(function(F){var k=new xt.a("",D);F[1].parent=k,F[1].position.z=-.15,N._defaultModel=k,N.attachToMesh(N._defaultModel),w&&w(N._defaultModel)}))},t.prototype._handleButtonChange=function(D,w,N){if(D<this._buttonIndexToObservableNameMap.length){var F=this[this._buttonIndexToObservableNameMap[D]];F&&F.notifyObservers(w)}},t.MODEL_BASE_URL="https://controllers.babylonjs.com/generic/",t.MODEL_FILENAME="generic.babylon",t.GAMEPAD_ID_PREFIX="Gear VR",t}(Gi);Jn._ControllerFactories.push({canCreate:function(D){return 0===D.id.indexOf(ao.GAMEPAD_ID_PREFIX)||-1!==D.id.indexOf("Oculus Go")||-1!==D.id.indexOf("Vive Focus")},create:function(D){return new ao(D)}});var so=function(D){function t(w){return D.call(this,w)||this}return Object(Z.d)(t,D),t.prototype.initControllerMesh=function(D,w){var N=this;ro.ImportMesh("",t.MODEL_BASE_URL,t.MODEL_FILENAME,D,(function(D){N._defaultModel=D[1],N.attachToMesh(N._defaultModel),w&&w(N._defaultModel)}))},t.prototype._handleButtonChange=function(D,w,N){console.log("Button id: "+D+"state: "),console.dir(w)},t.MODEL_BASE_URL="https://controllers.babylonjs.com/generic/",t.MODEL_FILENAME="generic.babylon",t}(Gi);Jn._DefaultControllerFactory=function(D){return new so(D)};var co=function(D){function t(w){var N=D.call(this,w)||this;return N.onSecondaryTriggerStateChangedObservable=new j.c,N.onThumbRestChangedObservable=new j.c,N.controllerType=Yn.OCULUS,N}return Object(Z.d)(t,D),t.prototype.initControllerMesh=function(D,w){var N,F=this;N="left"===this.hand?t.MODEL_LEFT_FILENAME:t.MODEL_RIGHT_FILENAME,ro.ImportMesh("",t._IsQuest?t.QUEST_MODEL_BASE_URL:t.MODEL_BASE_URL,N,D,(function(D){F._defaultModel=t._IsQuest?D[0]:D[1],F.attachToMesh(F._defaultModel),w&&w(F._defaultModel)}))},Object.defineProperty(t.prototype,"onAButtonStateChangedObservable",{get:function(){if("right"===this.hand)return this.onMainButtonStateChangedObservable;throw new Error("No A button on left hand")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onBButtonStateChangedObservable",{get:function(){if("right"===this.hand)return this.onSecondaryButtonStateChangedObservable;throw new Error("No B button on left hand")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onXButtonStateChangedObservable",{get:function(){if("left"===this.hand)return this.onMainButtonStateChangedObservable;throw new Error("No X button on right hand")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onYButtonStateChangedObservable",{get:function(){if("left"===this.hand)return this.onSecondaryButtonStateChangedObservable;throw new Error("No Y button on right hand")},enumerable:!0,configurable:!0}),t.prototype._handleButtonChange=function(D,w,N){var F=w,k="right"===this.hand?-1:1;switch(D){case 0:return void this.onPadStateChangedObservable.notifyObservers(F);case 1:return!t._IsQuest&&this._defaultModel&&(this._defaultModel.getChildren()[3].rotation.x=.2*-F.value,this._defaultModel.getChildren()[3].position.y=.005*-F.value,this._defaultModel.getChildren()[3].position.z=.005*-F.value),void this.onTriggerStateChangedObservable.notifyObservers(F);case 2:return!t._IsQuest&&this._defaultModel&&(this._defaultModel.getChildren()[4].position.x=k*F.value*.0035),void this.onSecondaryTriggerStateChangedObservable.notifyObservers(F);case 3:return!t._IsQuest&&this._defaultModel&&(F.pressed?this._defaultModel.getChildren()[1].position.y=-.001:this._defaultModel.getChildren()[1].position.y=0),void this.onMainButtonStateChangedObservable.notifyObservers(F);case 4:return!t._IsQuest&&this._defaultModel&&(F.pressed?this._defaultModel.getChildren()[2].position.y=-.001:this._defaultModel.getChildren()[2].position.y=0),void this.onSecondaryButtonStateChangedObservable.notifyObservers(F);case 5:return void this.onThumbRestChangedObservable.notifyObservers(F)}},t.MODEL_BASE_URL="https://controllers.babylonjs.com/oculus/",t.MODEL_LEFT_FILENAME="left.babylon",t.MODEL_RIGHT_FILENAME="right.babylon",t.QUEST_MODEL_BASE_URL="https://controllers.babylonjs.com/oculusQuest/",t._IsQuest=!1,t}(Gi);Jn._ControllerFactories.push({canCreate:function(D){return Ct.a.LastCreatedEngine&&Ct.a.LastCreatedEngine._vrDisplay&&"Oculus Quest"===Ct.a.LastCreatedEngine._vrDisplay.displayName&&(co._IsQuest=!0),-1!==D.id.indexOf("Oculus Touch")},create:function(D){return new co(D)}});var uo=function(D){function t(w){var N=D.call(this,w)||this;return N.controllerType=Yn.VIVE,N._invertLeftStickY=!0,N}return Object(Z.d)(t,D),t.prototype.initControllerMesh=function(D,w){var N=this;ro.ImportMesh("",t.MODEL_BASE_URL,t.MODEL_FILENAME,D,(function(D){N._defaultModel=D[1],N.attachToMesh(N._defaultModel),w&&w(N._defaultModel)}))},Object.defineProperty(t.prototype,"onLeftButtonStateChangedObservable",{get:function(){return this.onMainButtonStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onRightButtonStateChangedObservable",{get:function(){return this.onMainButtonStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onMenuButtonStateChangedObservable",{get:function(){return this.onSecondaryButtonStateChangedObservable},enumerable:!0,configurable:!0}),t.prototype._handleButtonChange=function(D,w,N){var F=w;switch(D){case 0:return void this.onPadStateChangedObservable.notifyObservers(F);case 1:return this._defaultModel&&(this._defaultModel.getChildren()[6].rotation.x=.15*-F.value),void this.onTriggerStateChangedObservable.notifyObservers(F);case 2:return void this.onMainButtonStateChangedObservable.notifyObservers(F);case 3:return this._defaultModel&&(F.pressed?this._defaultModel.getChildren()[2].position.y=-.001:this._defaultModel.getChildren()[2].position.y=0),void this.onSecondaryButtonStateChangedObservable.notifyObservers(F)}},t.MODEL_BASE_URL="https://controllers.babylonjs.com/vive/",t.MODEL_FILENAME="wand.babylon",t}(Gi);Jn._ControllerFactories.push({canCreate:function(D){return-1!==D.id.toLowerCase().indexOf("openvr")},create:function(D){return new uo(D)}});var br=function(){this.buttonMeshes={},this.axisMeshes={}},lo=function(D){function t(w){var N=D.call(this,w)||this;return N._mapping={buttons:["thumbstick","trigger","grip","menu","trackpad"],buttonMeshNames:{trigger:"SELECT",menu:"MENU",grip:"GRASP",thumbstick:"THUMBSTICK_PRESS",trackpad:"TOUCHPAD_PRESS"},buttonObservableNames:{trigger:"onTriggerStateChangedObservable",menu:"onSecondaryButtonStateChangedObservable",grip:"onMainButtonStateChangedObservable",thumbstick:"onPadStateChangedObservable",trackpad:"onTrackpadChangedObservable"},axisMeshNames:["THUMBSTICK_X","THUMBSTICK_Y","TOUCHPAD_TOUCH_X","TOUCHPAD_TOUCH_Y"],pointingPoseMeshName:$n.POINTING_POSE},N.onTrackpadChangedObservable=new j.c,N.onTrackpadValuesChangedObservable=new j.c,N.trackpad={x:0,y:0},N.controllerType=Yn.WINDOWS,N._loadedMeshInfo=null,N}return Object(Z.d)(t,D),Object.defineProperty(t.prototype,"onTriggerButtonStateChangedObservable",{get:function(){return this.onTriggerStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onMenuButtonStateChangedObservable",{get:function(){return this.onSecondaryButtonStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onGripButtonStateChangedObservable",{get:function(){return this.onMainButtonStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onThumbstickButtonStateChangedObservable",{get:function(){return this.onPadStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onTouchpadButtonStateChangedObservable",{get:function(){return this.onTrackpadChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onTouchpadValuesChangedObservable",{get:function(){return this.onTrackpadValuesChangedObservable},enumerable:!0,configurable:!0}),t.prototype._updateTrackpad=function(){!this.browserGamepad.axes||this.browserGamepad.axes[2]==this.trackpad.x&&this.browserGamepad.axes[3]==this.trackpad.y||(this.trackpad.x=this.browserGamepad.axes[this._mapping.axisMeshNames.indexOf("TOUCHPAD_TOUCH_X")],this.trackpad.y=this.browserGamepad.axes[this._mapping.axisMeshNames.indexOf("TOUCHPAD_TOUCH_Y")],this.onTrackpadValuesChangedObservable.notifyObservers(this.trackpad))},t.prototype.update=function(){if(D.prototype.update.call(this),this.browserGamepad.axes&&(this._updateTrackpad(),this._loadedMeshInfo))for(var w=0;w<this._mapping.axisMeshNames.length;w++)this._lerpAxisTransform(w,this.browserGamepad.axes[w])},t.prototype._handleButtonChange=function(D,w,N){var F=this._mapping.buttons[D];if(F){this._updateTrackpad();var k=this[this._mapping.buttonObservableNames[F]];k&&k.notifyObservers(w),this._lerpButtonTransform(F,w.value)}},t.prototype._lerpButtonTransform=function(D,w){if(this._loadedMeshInfo){var N=this._loadedMeshInfo.buttonMeshes[D];N&&N.unpressed.rotationQuaternion&&N.pressed.rotationQuaternion&&N.value.rotationQuaternion&&(z.b.SlerpToRef(N.unpressed.rotationQuaternion,N.pressed.rotationQuaternion,w,N.value.rotationQuaternion),z.e.LerpToRef(N.unpressed.position,N.pressed.position,w,N.value.position))}},t.prototype._lerpAxisTransform=function(D,w){if(this._loadedMeshInfo){var N=this._loadedMeshInfo.axisMeshes[D];if(N&&N.min.rotationQuaternion&&N.max.rotationQuaternion&&N.value.rotationQuaternion){var F=.5*w+.5;z.b.SlerpToRef(N.min.rotationQuaternion,N.max.rotationQuaternion,F,N.value.rotationQuaternion),z.e.LerpToRef(N.min.position,N.max.position,F,N.value.position)}}},t.prototype.initControllerMesh=function(D,w,N){var F,k,j=this;if(void 0===N&&(N=!1),ro.IsPluginForExtensionAvailable(".glb")){var z="default";if(this.id&&!N){var G=this.id.match(t.GAMEPAD_ID_PATTERN);z=G&&G[0]||z}k="left"===this.hand?t.MODEL_LEFT_FILENAME:t.MODEL_RIGHT_FILENAME,F=t.MODEL_BASE_URL+z+"/"}else oe.a.Warn("You need to reference GLTF loader to load Windows Motion Controllers model. Falling back to generic models"),F=so.MODEL_BASE_URL,k=so.MODEL_FILENAME;ro.ImportMesh("",F,k,D,(function(N){j._loadedMeshInfo=j.processModel(D,N),j._loadedMeshInfo&&(j._defaultModel=j._loadedMeshInfo.rootNode,j.attachToMesh(j._defaultModel),w&&w(j._defaultModel))}),null,(function(D,z){oe.a.Log(z),oe.a.Warn("Failed to retrieve controller model from the remote server: "+F+k),N||j.initControllerMesh(D,w,!0)}))},t.prototype.processModel=function(D,w){for(var N=null,F=new xt.a(this.id+" "+this.hand,D),k=null,j=0;j<w.length;j++){var z=w[j];if(!z.parent){z.isPickable=!1,k=z;break}}return k?(k.setParent(F),N=this.createMeshInfo(F)):oe.a.Warn("Could not find root node in model file."),N},t.prototype.createMeshInfo=function(D){var w,N=new br;for(N.rootNode=D,N.buttonMeshes={},N.axisMeshes={},w=0;w<this._mapping.buttons.length;w++){var F=this._mapping.buttonMeshNames[this._mapping.buttons[w]];if(F){var k=l(D,F);if(k){var j={index:w,value:u(k,"VALUE"),pressed:u(k,"PRESSED"),unpressed:u(k,"UNPRESSED")};j.value&&j.pressed&&j.unpressed?N.buttonMeshes[this._mapping.buttons[w]]=j:oe.a.Warn("Missing button submesh under mesh with name: "+F+"(VALUE: "+!!j.value+", PRESSED: "+!!j.pressed+", UNPRESSED:"+!!j.unpressed+")")}else oe.a.Warn("Missing button mesh with name: "+F)}else oe.a.Log("Skipping unknown button at index: "+w+" with mapped name: "+this._mapping.buttons[w])}for(w=0;w<this._mapping.axisMeshNames.length;w++){var z=this._mapping.axisMeshNames[w];if(z){var G=l(D,z);if(G){var H={index:w,value:u(G,"VALUE"),min:u(G,"MIN"),max:u(G,"MAX")};H.value&&H.min&&H.max?N.axisMeshes[w]=H:oe.a.Warn("Missing axis submesh under mesh with name: "+z+"(VALUE: "+!!H.value+", MIN: "+!!H.min+", MAX:"+!!H.max+")")}else oe.a.Warn("Missing axis mesh with name: "+z)}else oe.a.Log("Skipping unknown axis at index: "+w)}return N.pointingPoseNode=l(D,this._mapping.pointingPoseMeshName),N.pointingPoseNode?this._pointingPoseNode=N.pointingPoseNode:oe.a.Warn("Missing pointing pose mesh with name: "+this._mapping.pointingPoseMeshName),N;function l(D,w){return D.getChildren((function(D){return D.name===w}),!1)[0]}function u(D,w){return D.getChildren((function(D){return D.name==w}),!0)[0]}},t.prototype.getForwardRay=function(w){if(void 0===w&&(w=100),!this._loadedMeshInfo||!this._loadedMeshInfo.pointingPoseNode)return D.prototype.getForwardRay.call(this,w);var N=this._loadedMeshInfo.pointingPoseNode.getWorldMatrix(),F=N.getTranslation(),k=new z.e(0,0,-1),j=z.e.TransformNormal(k,N),G=z.e.Normalize(j);return new Qn.a(F,G,w)},t.prototype.dispose=function(){D.prototype.dispose.call(this),this.onTrackpadChangedObservable.clear(),this.onTrackpadValuesChangedObservable.clear()},t.MODEL_BASE_URL="https://controllers.babylonjs.com/microsoft/",t.MODEL_LEFT_FILENAME="left.glb",t.MODEL_RIGHT_FILENAME="right.glb",t.GAMEPAD_ID_PREFIX="Spatial Controller (Spatial Interaction Source) ",t.GAMEPAD_ID_PATTERN=/([0-9a-zA-Z]+-[0-9a-zA-Z]+)$/,t}(Gi),ho=function(D){function t(w){var N=D.call(this,w)||this;return N._mapping={buttons:["trigger","grip","trackpad","thumbstick","menu"],buttonMeshNames:{trigger:"SELECT",menu:"MENU",grip:"GRASP",thumbstick:"THUMBSTICK_PRESS",trackpad:"TOUCHPAD_PRESS"},buttonObservableNames:{trigger:"onTriggerStateChangedObservable",menu:"onSecondaryButtonStateChangedObservable",grip:"onMainButtonStateChangedObservable",thumbstick:"onThumbstickStateChangedObservable",trackpad:"onTrackpadChangedObservable"},axisMeshNames:["TOUCHPAD_TOUCH_X","TOUCHPAD_TOUCH_Y","THUMBSTICK_X","THUMBSTICK_Y"],pointingPoseMeshName:$n.POINTING_POSE},N.thumbstickValues={x:0,y:0},N.onThumbstickStateChangedObservable=new j.c,N.onThumbstickValuesChangedObservable=new j.c,N.onTrackpadChangedObservable=N.onPadStateChangedObservable,N.onTrackpadValuesChangedObservable=N.onPadValuesChangedObservable,N}return Object(Z.d)(t,D),Object.defineProperty(t.prototype,"onThumbstickButtonStateChangedObservable",{get:function(){return this.onThumbstickStateChangedObservable},enumerable:!0,configurable:!0}),t.prototype._updateTrackpad=function(){!this.browserGamepad.axes||this.browserGamepad.axes[2]==this.thumbstickValues.x&&this.browserGamepad.axes[3]==this.thumbstickValues.y||(this.trackpad.x=this.browserGamepad.axes[2],this.trackpad.y=this.browserGamepad.axes[3],this.onThumbstickValuesChangedObservable.notifyObservers(this.trackpad))},t.prototype.dispose=function(){D.prototype.dispose.call(this),this.onThumbstickStateChangedObservable.clear(),this.onThumbstickValuesChangedObservable.clear()},t}(lo);Jn._ControllerFactories.push({canCreate:function(D){return 0===D.id.indexOf(lo.GAMEPAD_ID_PREFIX)},create:function(D){return new lo(D)}});var fo=N(72),po=N(66),_o=N(56),mo=N(41),go=function(D){function t(w,N,F,k){void 0===N&&(N=G.a.Gray()),void 0===F&&(F=mo.a.DefaultUtilityLayer),void 0===k&&(k=null);var H=D.call(this,F)||this;H._pointerObserver=null,H.snapDistance=0,H.onSnapObservable=new j.c,H.uniformScaling=!1,H.sensitivity=1,H._isEnabled=!0,H._parent=null,H._parent=k,H._coloredMaterial=new Hi.a("",F.utilityLayerScene),H._coloredMaterial.diffuseColor=N,H._coloredMaterial.specularColor=N.subtract(new G.a(.1,.1,.1)),H._hoverMaterial=new Hi.a("",F.utilityLayerScene),H._hoverMaterial.diffuseColor=N.add(new G.a(.3,.3,.3)),H._arrow=new Wt.a("",F.utilityLayerScene);var X=po.a.CreateBox("yPosMesh",{size:.4},F.utilityLayerScene),q=nr.a.CreateCylinder("cylinder",{diameterTop:.005,height:.275,diameterBottom:.005,tessellation:96},F.utilityLayerScene);q.material=H._coloredMaterial,H._arrow.addChild(X),H._arrow.addChild(q),X.scaling.scaleInPlace(.1),X.material=H._coloredMaterial,X.rotation.x=Math.PI/2,X.position.z+=.3,q.position.z+=.1375,q.rotation.x=Math.PI/2,H._arrow.lookAt(H._rootMesh.position.add(w)),H._rootMesh.addChild(H._arrow),H._arrow.scaling.scaleInPlace(1/3),H.dragBehavior=new Yt.a({dragAxis:w}),H.dragBehavior.moveAttached=!1,H._rootMesh.addBehavior(H.dragBehavior);var Z=0,J=new z.e,$={snapDistance:0};H.dragBehavior.onDragObservable.add((function(D){if(H.attachedMesh){var N=H.sensitivity*D.dragDistance*(3*H.scaleRatio/H._rootMesh.scaling.length()),F=!1,k=0;H.uniformScaling?(H.attachedMesh.scaling.normalizeToRef(J),J.y<0&&J.scaleInPlace(-1)):J.copyFrom(w),0==H.snapDistance?J.scaleToRef(N,J):(Z+=N,Math.abs(Z)>H.snapDistance?(k=Math.floor(Math.abs(Z)/H.snapDistance),Z<0&&(k*=-1),Z%=H.snapDistance,J.scaleToRef(H.snapDistance*k,J),F=!0):J.scaleInPlace(0)),H.attachedMesh.scaling.addInPlace(J),F&&($.snapDistance=H.snapDistance*k,H.onSnapObservable.notifyObservers($))}})),H._pointerObserver=F.utilityLayerScene.onPointerObservable.add((function(D){if(!H._customMeshSet){var w=D.pickInfo&&-1!=H._rootMesh.getChildMeshes().indexOf(D.pickInfo.pickedMesh)?H._hoverMaterial:H._coloredMaterial;H._rootMesh.getChildMeshes().forEach((function(D){D.material=w,D.color&&(D.color=w.diffuseColor)}))}}));var te=F._getSharedGizmoLight();return te.includedOnlyMeshes=te.includedOnlyMeshes.concat(H._rootMesh.getChildMeshes()),H}return Object(Z.d)(t,D),t.prototype._attachedMeshChanged=function(D){this.dragBehavior&&(this.dragBehavior.enabled=!!D)},Object.defineProperty(t.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(D){this._isEnabled=D,D?this._parent&&(this.attachedMesh=this._parent.attachedMesh):this.attachedMesh=null},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this.onSnapObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.dragBehavior.detach(),this._arrow&&this._arrow.dispose(),[this._coloredMaterial,this._hoverMaterial].forEach((function(D){D&&D.dispose()})),D.prototype.dispose.call(this)},t.prototype.setCustomMesh=function(w,N){var F=this;void 0===N&&(N=!1),D.prototype.setCustomMesh.call(this,w),N&&(this._rootMesh.getChildMeshes().forEach((function(D){D.material=F._coloredMaterial,D.color&&(D.color=F._coloredMaterial.diffuseColor)})),this._customMeshSet=!1)},t}(_o.a),vo=N(48),yo=N(46),bo=function(D){function t(w,N){void 0===w&&(w=G.a.Gray()),void 0===N&&(N=mo.a.DefaultKeepDepthUtilityLayer);var F=D.call(this,N)||this;F._boundingDimensions=new z.e(1,1,1),F._renderObserver=null,F._pointerObserver=null,F._scaleDragSpeed=.2,F._tmpQuaternion=new z.b,F._tmpVector=new z.e(0,0,0),F._tmpRotationMatrix=new z.a,F.ignoreChildren=!1,F.includeChildPredicate=null,F.rotationSphereSize=.1,F.scaleBoxSize=.1,F.fixedDragMeshScreenSize=!1,F.fixedDragMeshScreenSizeDistanceFactor=10,F.onDragStartObservable=new j.c,F.onScaleBoxDragObservable=new j.c,F.onScaleBoxDragEndObservable=new j.c,F.onRotationSphereDragObservable=new j.c,F.onRotationSphereDragEndObservable=new j.c,F.scalePivot=null,F._existingMeshScale=new z.e,F._dragMesh=null,F.pointerDragBehavior=new Yt.a,F.updateScale=!1,F._anchorMesh=new Wt.a("anchor",N.utilityLayerScene),F.coloredMaterial=new Hi.a("",N.utilityLayerScene),F.coloredMaterial.disableLighting=!0,F.hoverColoredMaterial=new Hi.a("",N.utilityLayerScene),F.hoverColoredMaterial.disableLighting=!0,F._lineBoundingBox=new Wt.a("",N.utilityLayerScene),F._lineBoundingBox.rotationQuaternion=new z.b;var k=[];k.push(yo.a.CreateLines("lines",{points:[new z.e(0,0,0),new z.e(F._boundingDimensions.x,0,0)]},N.utilityLayerScene)),k.push(yo.a.CreateLines("lines",{points:[new z.e(0,0,0),new z.e(0,F._boundingDimensions.y,0)]},N.utilityLayerScene)),k.push(yo.a.CreateLines("lines",{points:[new z.e(0,0,0),new z.e(0,0,F._boundingDimensions.z)]},N.utilityLayerScene)),k.push(yo.a.CreateLines("lines",{points:[new z.e(F._boundingDimensions.x,0,0),new z.e(F._boundingDimensions.x,F._boundingDimensions.y,0)]},N.utilityLayerScene)),k.push(yo.a.CreateLines("lines",{points:[new z.e(F._boundingDimensions.x,0,0),new z.e(F._boundingDimensions.x,0,F._boundingDimensions.z)]},N.utilityLayerScene)),k.push(yo.a.CreateLines("lines",{points:[new z.e(0,F._boundingDimensions.y,0),new z.e(F._boundingDimensions.x,F._boundingDimensions.y,0)]},N.utilityLayerScene)),k.push(yo.a.CreateLines("lines",{points:[new z.e(0,F._boundingDimensions.y,0),new z.e(0,F._boundingDimensions.y,F._boundingDimensions.z)]},N.utilityLayerScene)),k.push(yo.a.CreateLines("lines",{points:[new z.e(0,0,F._boundingDimensions.z),new z.e(F._boundingDimensions.x,0,F._boundingDimensions.z)]},N.utilityLayerScene)),k.push(yo.a.CreateLines("lines",{points:[new z.e(0,0,F._boundingDimensions.z),new z.e(0,F._boundingDimensions.y,F._boundingDimensions.z)]},N.utilityLayerScene)),k.push(yo.a.CreateLines("lines",{points:[new z.e(F._boundingDimensions.x,F._boundingDimensions.y,F._boundingDimensions.z),new z.e(0,F._boundingDimensions.y,F._boundingDimensions.z)]},N.utilityLayerScene)),k.push(yo.a.CreateLines("lines",{points:[new z.e(F._boundingDimensions.x,F._boundingDimensions.y,F._boundingDimensions.z),new z.e(F._boundingDimensions.x,0,F._boundingDimensions.z)]},N.utilityLayerScene)),k.push(yo.a.CreateLines("lines",{points:[new z.e(F._boundingDimensions.x,F._boundingDimensions.y,F._boundingDimensions.z),new z.e(F._boundingDimensions.x,F._boundingDimensions.y,0)]},N.utilityLayerScene)),k.forEach((function(D){D.color=w,D.position.addInPlace(new z.e(-F._boundingDimensions.x/2,-F._boundingDimensions.y/2,-F._boundingDimensions.z/2)),D.isPickable=!1,F._lineBoundingBox.addChild(D)})),F._rootMesh.addChild(F._lineBoundingBox),F.setColor(w),F._rotateSpheresParent=new Wt.a("",N.utilityLayerScene),F._rotateSpheresParent.rotationQuaternion=new z.b;for(var c=function(D){var w=vo.a.CreateSphere("",{diameter:1},N.utilityLayerScene);w.rotationQuaternion=new z.b,w.material=H.coloredMaterial,(J=new Yt.a({})).moveAttached=!1,J.updateDragPlane=!1,w.addBehavior(J);var k=new z.e(1,0,0),j=0;J.onDragStartObservable.add((function(){k.copyFrom(w.forward),j=0})),J.onDragObservable.add((function(w){if(F.onRotationSphereDragObservable.notifyObservers({}),F.attachedMesh){var N=F.attachedMesh.parent;if(N&&N.scaling&&N.scaling.isNonUniformWithinEpsilon(.001))return void oe.a.Warn("BoundingBoxGizmo controls are not supported on child meshes with non-uniform parent scaling");Kt.a._RemoveAndStorePivotPoint(F.attachedMesh);var G=k,H=w.dragPlaneNormal.scale(z.e.Dot(w.dragPlaneNormal,G)),X=G.subtract(H).normalizeToNew(),q=z.e.Dot(X,w.delta)<0?Math.abs(w.delta.length()):-Math.abs(w.delta.length());q=q/F._boundingDimensions.length()*F._anchorMesh.scaling.length(),F.attachedMesh.rotationQuaternion||(F.attachedMesh.rotationQuaternion=z.b.RotationYawPitchRoll(F.attachedMesh.rotation.y,F.attachedMesh.rotation.x,F.attachedMesh.rotation.z)),F._anchorMesh.rotationQuaternion||(F._anchorMesh.rotationQuaternion=z.b.RotationYawPitchRoll(F._anchorMesh.rotation.y,F._anchorMesh.rotation.x,F._anchorMesh.rotation.z)),j+=q,Math.abs(j)<=2*Math.PI&&(D>=8?z.b.RotationYawPitchRollToRef(0,0,q,F._tmpQuaternion):D>=4?z.b.RotationYawPitchRollToRef(q,0,0,F._tmpQuaternion):z.b.RotationYawPitchRollToRef(0,q,0,F._tmpQuaternion),F._anchorMesh.addChild(F.attachedMesh),F._anchorMesh.rotationQuaternion.multiplyToRef(F._tmpQuaternion,F._anchorMesh.rotationQuaternion),F._anchorMesh.removeChild(F.attachedMesh),F.attachedMesh.setParent(N)),F.updateBoundingBox(),Kt.a._RestorePivotPoint(F.attachedMesh)}F._updateDummy()})),J.onDragStartObservable.add((function(){F.onDragStartObservable.notifyObservers({}),F._selectNode(w)})),J.onDragEndObservable.add((function(){F.onRotationSphereDragEndObservable.notifyObservers({}),F._selectNode(null),F._updateDummy()})),H._rotateSpheresParent.addChild(w)},H=this,X=0;X<12;X++)c(X);F._rootMesh.addChild(F._rotateSpheresParent),F._scaleBoxesParent=new Wt.a("",N.utilityLayerScene),F._scaleBoxesParent.rotationQuaternion=new z.b;for(var q=0;q<2;q++)for(var Z=0;Z<2;Z++)for(var J,p=function(){var D=po.a.CreateBox("",{size:1},N.utilityLayerScene);D.material=$.coloredMaterial;var w=new z.e(0==q?-1:1,0==Z?-1:1,0==te?-1:1);(J=new Yt.a({dragAxis:w})).moveAttached=!1,D.addBehavior(J),J.onDragObservable.add((function(w){if(F.onScaleBoxDragObservable.notifyObservers({}),F.attachedMesh){var N=F.attachedMesh.parent;if(N&&N.scaling&&N.scaling.isNonUniformWithinEpsilon(.001))return void oe.a.Warn("BoundingBoxGizmo controls are not supported on child meshes with non-uniform parent scaling");Kt.a._RemoveAndStorePivotPoint(F.attachedMesh);var k=w.dragDistance/F._boundingDimensions.length()*F._anchorMesh.scaling.length(),j=new z.e(k,k,k);j.scaleInPlace(F._scaleDragSpeed),F.updateBoundingBox(),F.scalePivot?(F.attachedMesh.getWorldMatrix().getRotationMatrixToRef(F._tmpRotationMatrix),F._boundingDimensions.scaleToRef(.5,F._tmpVector),z.e.TransformCoordinatesToRef(F._tmpVector,F._tmpRotationMatrix,F._tmpVector),F._anchorMesh.position.subtractInPlace(F._tmpVector),F._boundingDimensions.multiplyToRef(F.scalePivot,F._tmpVector),z.e.TransformCoordinatesToRef(F._tmpVector,F._tmpRotationMatrix,F._tmpVector),F._anchorMesh.position.addInPlace(F._tmpVector)):(D.absolutePosition.subtractToRef(F._anchorMesh.position,F._tmpVector),F._anchorMesh.position.subtractInPlace(F._tmpVector)),F._anchorMesh.addChild(F.attachedMesh),F._anchorMesh.scaling.addInPlace(j),(F._anchorMesh.scaling.x<0||F._anchorMesh.scaling.y<0||F._anchorMesh.scaling.z<0)&&F._anchorMesh.scaling.subtractInPlace(j),F._anchorMesh.removeChild(F.attachedMesh),F.attachedMesh.setParent(N),Kt.a._RestorePivotPoint(F.attachedMesh)}F._updateDummy()})),J.onDragStartObservable.add((function(){F.onDragStartObservable.notifyObservers({}),F._selectNode(D)})),J.onDragEndObservable.add((function(){F.onScaleBoxDragEndObservable.notifyObservers({}),F._selectNode(null),F._updateDummy()})),$._scaleBoxesParent.addChild(D)},$=this,te=0;te<2;te++)p();F._rootMesh.addChild(F._scaleBoxesParent);var ie=new Array;return F._pointerObserver=N.utilityLayerScene.onPointerObservable.add((function(D){ie[D.event.pointerId]?D.pickInfo&&D.pickInfo.pickedMesh!=ie[D.event.pointerId]&&(ie[D.event.pointerId].material=F.coloredMaterial,delete ie[D.event.pointerId]):F._rotateSpheresParent.getChildMeshes().concat(F._scaleBoxesParent.getChildMeshes()).forEach((function(w){D.pickInfo&&D.pickInfo.pickedMesh==w&&(ie[D.event.pointerId]=w,w.material=F.hoverColoredMaterial)}))})),F._renderObserver=F.gizmoLayer.originalScene.onBeforeRenderObservable.add((function(){F.attachedMesh&&!F._existingMeshScale.equals(F.attachedMesh.scaling)?F.updateBoundingBox():F.fixedDragMeshScreenSize&&(F._updateRotationSpheres(),F._updateScaleBoxes()),F._dragMesh&&F.attachedMesh&&F.pointerDragBehavior.dragging&&(F._lineBoundingBox.position.rotateByQuaternionToRef(F._rootMesh.rotationQuaternion,F._tmpVector),F.attachedMesh.setAbsolutePosition(F._dragMesh.position.add(F._tmpVector.scale(-1))))})),F.updateBoundingBox(),F}return Object(Z.d)(t,D),t.prototype.setColor=function(D){this.coloredMaterial.emissiveColor=D,this.hoverColoredMaterial.emissiveColor=D.clone().add(new G.a(.3,.3,.3)),this._lineBoundingBox.getChildren().forEach((function(w){w.color&&(w.color=D)}))},t.prototype._attachedMeshChanged=function(D){var w=this;if(D){Kt.a._RemoveAndStorePivotPoint(D);var N=D.parent;this._anchorMesh.addChild(D),this._anchorMesh.removeChild(D),D.setParent(N),Kt.a._RestorePivotPoint(D),this.updateBoundingBox(),D.getChildMeshes(!1).forEach((function(D){D.markAsDirty("scaling")})),this.gizmoLayer.utilityLayerScene.onAfterRenderObservable.addOnce((function(){w._updateDummy()}))}},t.prototype._selectNode=function(D){this._rotateSpheresParent.getChildMeshes().concat(this._scaleBoxesParent.getChildMeshes()).forEach((function(w){w.isVisible=!D||w==D}))},t.prototype.updateBoundingBox=function(){if(this.attachedMesh){Kt.a._RemoveAndStorePivotPoint(this.attachedMesh);var D=this.attachedMesh.parent;this.attachedMesh.setParent(null);var w=null;this.attachedMesh.skeleton&&(w=this.attachedMesh.skeleton.overrideMesh,this.attachedMesh.skeleton.overrideMesh=null),this._update(),this.attachedMesh.rotationQuaternion||(this.attachedMesh.rotationQuaternion=z.b.RotationYawPitchRoll(this.attachedMesh.rotation.y,this.attachedMesh.rotation.x,this.attachedMesh.rotation.z)),this._anchorMesh.rotationQuaternion||(this._anchorMesh.rotationQuaternion=z.b.RotationYawPitchRoll(this._anchorMesh.rotation.y,this._anchorMesh.rotation.x,this._anchorMesh.rotation.z)),this._anchorMesh.rotationQuaternion.copyFrom(this.attachedMesh.rotationQuaternion),this._tmpQuaternion.copyFrom(this.attachedMesh.rotationQuaternion),this._tmpVector.copyFrom(this.attachedMesh.position),this.attachedMesh.rotationQuaternion.set(0,0,0,1),this.attachedMesh.position.set(0,0,0);var N=this.attachedMesh.getHierarchyBoundingVectors(!this.ignoreChildren,this.includeChildPredicate);N.max.subtractToRef(N.min,this._boundingDimensions),this._lineBoundingBox.scaling.copyFrom(this._boundingDimensions),this._lineBoundingBox.position.set((N.max.x+N.min.x)/2,(N.max.y+N.min.y)/2,(N.max.z+N.min.z)/2),this._rotateSpheresParent.position.copyFrom(this._lineBoundingBox.position),this._scaleBoxesParent.position.copyFrom(this._lineBoundingBox.position),this._lineBoundingBox.computeWorldMatrix(),this._anchorMesh.position.copyFrom(this._lineBoundingBox.absolutePosition),this.attachedMesh.rotationQuaternion.copyFrom(this._tmpQuaternion),this.attachedMesh.position.copyFrom(this._tmpVector),this.attachedMesh.setParent(D),this.attachedMesh.skeleton&&(this.attachedMesh.skeleton.overrideMesh=w)}this._updateRotationSpheres(),this._updateScaleBoxes(),this.attachedMesh&&(this._existingMeshScale.copyFrom(this.attachedMesh.scaling),Kt.a._RestorePivotPoint(this.attachedMesh))},t.prototype._updateRotationSpheres=function(){for(var D=this._rotateSpheresParent.getChildMeshes(),w=0;w<3;w++)for(var N=0;N<2;N++)for(var F=0;F<2;F++){var k=4*w+2*N+F;if(0==w&&(D[k].position.set(this._boundingDimensions.x/2,this._boundingDimensions.y*N,this._boundingDimensions.z*F),D[k].position.addInPlace(new z.e(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),D[k].lookAt(z.e.Cross(D[k].position.normalizeToNew(),z.e.Right()).normalizeToNew().add(D[k].position))),1==w&&(D[k].position.set(this._boundingDimensions.x*N,this._boundingDimensions.y/2,this._boundingDimensions.z*F),D[k].position.addInPlace(new z.e(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),D[k].lookAt(z.e.Cross(D[k].position.normalizeToNew(),z.e.Up()).normalizeToNew().add(D[k].position))),2==w&&(D[k].position.set(this._boundingDimensions.x*N,this._boundingDimensions.y*F,this._boundingDimensions.z/2),D[k].position.addInPlace(new z.e(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),D[k].lookAt(z.e.Cross(D[k].position.normalizeToNew(),z.e.Forward()).normalizeToNew().add(D[k].position))),this.fixedDragMeshScreenSize&&this.gizmoLayer.utilityLayerScene.activeCamera){D[k].absolutePosition.subtractToRef(this.gizmoLayer.utilityLayerScene.activeCamera.position,this._tmpVector);var j=this.rotationSphereSize*this._tmpVector.length()/this.fixedDragMeshScreenSizeDistanceFactor;D[k].scaling.set(j,j,j)}else D[k].scaling.set(this.rotationSphereSize,this.rotationSphereSize,this.rotationSphereSize)}},t.prototype._updateScaleBoxes=function(){for(var D=this._scaleBoxesParent.getChildMeshes(),w=0;w<2;w++)for(var N=0;N<2;N++)for(var F=0;F<2;F++){var k=4*w+2*N+F;if(D[k])if(D[k].position.set(this._boundingDimensions.x*w,this._boundingDimensions.y*N,this._boundingDimensions.z*F),D[k].position.addInPlace(new z.e(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),this.fixedDragMeshScreenSize&&this.gizmoLayer.utilityLayerScene.activeCamera){D[k].absolutePosition.subtractToRef(this.gizmoLayer.utilityLayerScene.activeCamera.position,this._tmpVector);var j=this.scaleBoxSize*this._tmpVector.length()/this.fixedDragMeshScreenSizeDistanceFactor;D[k].scaling.set(j,j,j)}else D[k].scaling.set(this.scaleBoxSize,this.scaleBoxSize,this.scaleBoxSize)}},t.prototype.setEnabledRotationAxis=function(D){this._rotateSpheresParent.getChildMeshes().forEach((function(w,N){N<4?w.setEnabled(-1!=D.indexOf("x")):N<8?w.setEnabled(-1!=D.indexOf("y")):w.setEnabled(-1!=D.indexOf("z"))}))},t.prototype.setEnabledScaling=function(D){this._scaleBoxesParent.getChildMeshes().forEach((function(w,N){w.setEnabled(D)}))},t.prototype._updateDummy=function(){this._dragMesh&&(this._dragMesh.position.copyFrom(this._lineBoundingBox.getAbsolutePosition()),this._dragMesh.scaling.copyFrom(this._lineBoundingBox.scaling),this._dragMesh.rotationQuaternion.copyFrom(this._rootMesh.rotationQuaternion))},t.prototype.enableDragBehavior=function(){this._dragMesh=xt.a.CreateBox("dummy",1,this.gizmoLayer.utilityLayerScene),this._dragMesh.visibility=0,this._dragMesh.rotationQuaternion=new z.b,this.pointerDragBehavior.useObjectOrientationForDragging=!1,this._dragMesh.addBehavior(this.pointerDragBehavior)},t.prototype.dispose=function(){this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.gizmoLayer.originalScene.onBeforeRenderObservable.remove(this._renderObserver),this._lineBoundingBox.dispose(),this._rotateSpheresParent.dispose(),this._scaleBoxesParent.dispose(),this._dragMesh&&this._dragMesh.dispose(),D.prototype.dispose.call(this)},t.MakeNotPickableAndWrapInBoundingBox=function(D){var t=function(D){D.isPickable=!1,D.getChildMeshes().forEach((function(D){t(D)}))};t(D),D.rotationQuaternion||(D.rotationQuaternion=z.b.RotationYawPitchRoll(D.rotation.y,D.rotation.x,D.rotation.z));var w=D.position.clone(),N=D.rotationQuaternion.clone();D.rotationQuaternion.set(0,0,0,1),D.position.set(0,0,0);var F=po.a.CreateBox("box",{size:1},D.getScene()),k=D.getHierarchyBoundingVectors();return k.max.subtractToRef(k.min,F.scaling),0===F.scaling.y&&(F.scaling.y=rt.a),0===F.scaling.x&&(F.scaling.x=rt.a),0===F.scaling.z&&(F.scaling.z=rt.a),F.position.set((k.max.x+k.min.x)/2,(k.max.y+k.min.y)/2,(k.max.z+k.min.z)/2),D.addChild(F),D.rotationQuaternion.copyFrom(N),D.position.copyFrom(w),D.removeChild(F),F.addChild(D),F.visibility=0,F},t.prototype.setCustomMesh=function(D){oe.a.Error("Custom meshes are not supported on this gizmo")},t}(_o.a),To=function(D){function t(w,N,F,k,H,X){void 0===N&&(N=G.a.Gray()),void 0===F&&(F=mo.a.DefaultUtilityLayer),void 0===k&&(k=32),void 0===H&&(H=null),void 0===X&&(X=!1);var q=D.call(this,F)||this;q._pointerObserver=null,q.snapDistance=0,q.onSnapObservable=new j.c,q._isEnabled=!0,q._parent=null,q._parent=H;var Z=new Hi.a("",F.utilityLayerScene);Z.diffuseColor=N,Z.specularColor=N.subtract(new G.a(.1,.1,.1));var J=new Hi.a("",F.utilityLayerScene);J.diffuseColor=N.add(new G.a(.3,.3,.3));var $=new Wt.a("",F.utilityLayerScene),te=xt.a.CreateTorus("",.6,.03,k,F.utilityLayerScene);te.visibility=0;var ie=xt.a.CreateTorus("",.6,.005,k,F.utilityLayerScene);ie.material=Z,ie.rotation.x=Math.PI/2,te.rotation.x=Math.PI/2,$.addChild(ie),$.addChild(te),$.lookAt(q._rootMesh.position.add(w)),q._rootMesh.addChild($),$.scaling.scaleInPlace(1/3),q.dragBehavior=new Yt.a({dragPlaneNormal:w}),q.dragBehavior.moveAttached=!1,q.dragBehavior.maxDragAngle=9*Math.PI/20,q.dragBehavior._useAlternatePickedPointAboveMaxDragAngle=!0,q._rootMesh.addBehavior(q.dragBehavior);var oe=new z.e;q.dragBehavior.onDragStartObservable.add((function(D){q.attachedMesh&&oe.copyFrom(D.dragPlanePoint)}));var ce=new z.a,he=new z.e,fe=new z.e,pe={snapDistance:0},_e=0,ve=new z.a,ye=new z.e,be=new z.b;q.dragBehavior.onDragObservable.add((function(D){if(q.attachedMesh){q.attachedMesh.rotationQuaternion&&!X||(q.attachedMesh.rotationQuaternion=z.b.RotationYawPitchRoll(q.attachedMesh.rotation.y,q.attachedMesh.rotation.x,q.attachedMesh.rotation.z));var N=q.attachedMesh.parent;N&&q.attachedMesh.setParent(null);var k=D.dragPlanePoint.subtract(q.attachedMesh.absolutePosition).normalize(),j=oe.subtract(q.attachedMesh.absolutePosition).normalize(),G=z.e.Cross(k,j),H=z.e.Dot(k,j),Z=Math.atan2(G.length(),H);if(he.copyFrom(w),fe.copyFrom(w),q.updateGizmoRotationToMatchAttachedMesh&&(q.attachedMesh.rotationQuaternion.toRotationMatrix(ce),fe=z.e.TransformCoordinates(he,ce)),F.utilityLayerScene.activeCamera){var J=F.utilityLayerScene.activeCamera.position.subtract(q.attachedMesh.position);z.e.Dot(J,fe)>0&&(he.scaleInPlace(-1),fe.scaleInPlace(-1))}z.e.Dot(fe,G)>0&&(Z=-Z);var $=!1;if(0!=q.snapDistance)if(_e+=Z,Math.abs(_e)>q.snapDistance){var te=Math.floor(Math.abs(_e)/q.snapDistance);_e<0&&(te*=-1),_e%=q.snapDistance,Z=q.snapDistance*te,$=!0}else Z=0;ve.reset(),q.attachedMesh.parent&&(q.attachedMesh.parent.computeWorldMatrix().invertToRef(ve),ve.getRotationMatrixToRef(ve),z.e.TransformCoordinatesToRef(he,ve,he));var ie=Math.sin(Z/2);be.set(he.x*ie,he.y*ie,he.z*ie,Math.cos(Z/2)),ve.determinant()>0&&(be.toEulerAnglesToRef(ye),z.b.RotationYawPitchRollToRef(ye.y,-ye.x,-ye.z,be)),q.updateGizmoRotationToMatchAttachedMesh?q.attachedMesh.rotationQuaternion.multiplyToRef(be,q.attachedMesh.rotationQuaternion):be.multiplyToRef(q.attachedMesh.rotationQuaternion,q.attachedMesh.rotationQuaternion),X&&(q.attachedMesh.rotationQuaternion.toEulerAnglesToRef(ye),q.attachedMesh.rotationQuaternion=null,q.attachedMesh.rotation.copyFrom(ye)),oe.copyFrom(D.dragPlanePoint),$&&(pe.snapDistance=Z,q.onSnapObservable.notifyObservers(pe)),N&&q.attachedMesh.setParent(N)}})),q._pointerObserver=F.utilityLayerScene.onPointerObservable.add((function(D){if(!q._customMeshSet){var w=D.pickInfo&&-1!=q._rootMesh.getChildMeshes().indexOf(D.pickInfo.pickedMesh)?J:Z;q._rootMesh.getChildMeshes().forEach((function(D){D.material=w,D.color&&(D.color=w.diffuseColor)}))}}));var Te=F._getSharedGizmoLight();return Te.includedOnlyMeshes=Te.includedOnlyMeshes.concat(q._rootMesh.getChildMeshes(!1)),q}return Object(Z.d)(t,D),t.prototype._attachedMeshChanged=function(D){this.dragBehavior&&(this.dragBehavior.enabled=!!D)},Object.defineProperty(t.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(D){this._isEnabled=D,D?this._parent&&(this.attachedMesh=this._parent.attachedMesh):this.attachedMesh=null},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this.onSnapObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.dragBehavior.detach(),D.prototype.dispose.call(this)},t}(_o.a),Eo=function(D){function t(w,N,F){void 0===w&&(w=mo.a.DefaultUtilityLayer),void 0===N&&(N=32),void 0===F&&(F=!1);var k=D.call(this,w)||this;return k.onDragStartObservable=new j.c,k.onDragEndObservable=new j.c,k.xGizmo=new To(new z.e(1,0,0),G.a.Red().scale(.5),w,N,k,F),k.yGizmo=new To(new z.e(0,1,0),G.a.Green().scale(.5),w,N,k,F),k.zGizmo=new To(new z.e(0,0,1),G.a.Blue().scale(.5),w,N,k,F),[k.xGizmo,k.yGizmo,k.zGizmo].forEach((function(D){D.dragBehavior.onDragStartObservable.add((function(){k.onDragStartObservable.notifyObservers({})})),D.dragBehavior.onDragEndObservable.add((function(){k.onDragEndObservable.notifyObservers({})}))})),k.attachedMesh=null,k}return Object(Z.d)(t,D),Object.defineProperty(t.prototype,"attachedMesh",{get:function(){return this._meshAttached},set:function(D){this._meshAttached=D,[this.xGizmo,this.yGizmo,this.zGizmo].forEach((function(w){w.isEnabled?w.attachedMesh=D:w.attachedMesh=null}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updateGizmoRotationToMatchAttachedMesh",{get:function(){return this.xGizmo.updateGizmoRotationToMatchAttachedMesh},set:function(D){this.xGizmo&&(this.xGizmo.updateGizmoRotationToMatchAttachedMesh=D,this.yGizmo.updateGizmoRotationToMatchAttachedMesh=D,this.zGizmo.updateGizmoRotationToMatchAttachedMesh=D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"snapDistance",{get:function(){return this.xGizmo.snapDistance},set:function(D){this.xGizmo&&(this.xGizmo.snapDistance=D,this.yGizmo.snapDistance=D,this.zGizmo.snapDistance=D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleRatio",{get:function(){return this.xGizmo.scaleRatio},set:function(D){this.xGizmo&&(this.xGizmo.scaleRatio=D,this.yGizmo.scaleRatio=D,this.zGizmo.scaleRatio=D)},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this.xGizmo.dispose(),this.yGizmo.dispose(),this.zGizmo.dispose(),this.onDragStartObservable.clear(),this.onDragEndObservable.clear()},t.prototype.setCustomMesh=function(D){oe.a.Error("Custom meshes are not supported on this gizmo, please set the custom meshes on the gizmos contained within this one (gizmo.xGizmo, gizmo.yGizmo, gizmo.zGizmo)")},t}(_o.a),So=N(43),Mo=N(79),xo=function(D){function t(w,N,F,k){void 0===N&&(N=G.a.Gray()),void 0===F&&(F=mo.a.DefaultUtilityLayer),void 0===k&&(k=null);var H=D.call(this,F)||this;H._pointerObserver=null,H.snapDistance=0,H.onSnapObservable=new j.c,H._isEnabled=!1,H._parent=null,H._parent=k,H._coloredMaterial=new Hi.a("",F.utilityLayerScene),H._coloredMaterial.diffuseColor=N,H._coloredMaterial.specularColor=N.subtract(new G.a(.1,.1,.1)),H._hoverMaterial=new Hi.a("",F.utilityLayerScene),H._hoverMaterial.diffuseColor=N.add(new G.a(.3,.3,.3)),H._plane=t._CreatePlane(F.utilityLayerScene,H._coloredMaterial),H._plane.lookAt(H._rootMesh.position.add(w)),H._plane.scaling.scaleInPlace(1/3),H._plane.parent=H._rootMesh;var X=0,q=new z.e,Z={snapDistance:0};H.dragBehavior=new Yt.a({dragPlaneNormal:w}),H.dragBehavior.moveAttached=!1,H._rootMesh.addBehavior(H.dragBehavior);var J=new z.e,$=new z.a;H.dragBehavior.onDragObservable.add((function(D){if(H.attachedMesh)if(H.attachedMesh.parent?(H.attachedMesh.parent.computeWorldMatrix().invertToRef($),$.setTranslationFromFloats(0,0,0),z.e.TransformCoordinatesToRef(D.delta,$,J)):J.copyFrom(D.delta),0==H.snapDistance)H.attachedMesh.position.addInPlace(J);else if(X+=D.dragDistance,Math.abs(X)>H.snapDistance){var w=Math.floor(Math.abs(X)/H.snapDistance);X%=H.snapDistance,J.normalizeToRef(q),q.scaleInPlace(H.snapDistance*w),H.attachedMesh.position.addInPlace(q),Z.snapDistance=H.snapDistance*w,H.onSnapObservable.notifyObservers(Z)}})),H._pointerObserver=F.utilityLayerScene.onPointerObservable.add((function(D){if(!H._customMeshSet){var w=D.pickInfo&&-1!=H._rootMesh.getChildMeshes().indexOf(D.pickInfo.pickedMesh)?H._hoverMaterial:H._coloredMaterial;H._rootMesh.getChildMeshes().forEach((function(D){D.material=w}))}}));var te=F._getSharedGizmoLight();return te.includedOnlyMeshes=te.includedOnlyMeshes.concat(H._rootMesh.getChildMeshes(!1)),H}return Object(Z.d)(t,D),t._CreatePlane=function(D,w){var N=new So.a("plane",D),F=Mo.a.CreatePlane("dragPlane",{width:.1375,height:.1375,sideOrientation:2},D);return F.material=w,F.parent=N,F.material=w,N},t._CreateArrowInstance=function(D,w){for(var N=new So.a("arrow",D),F=0,k=w.getChildMeshes();F<k.length;F++){var j=k[F];j.createInstance(j.name).parent=N}return N},t.prototype._attachedMeshChanged=function(D){this.dragBehavior&&(this.dragBehavior.enabled=!!D)},Object.defineProperty(t.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(D){this._isEnabled=D,D?this._parent&&(this.attachedMesh=this._parent.attachedMesh):this.attachedMesh=null},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this.onSnapObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.dragBehavior.detach(),D.prototype.dispose.call(this),this._plane&&this._plane.dispose(),[this._coloredMaterial,this._hoverMaterial].forEach((function(D){D&&D.dispose()}))},t}(_o.a),Ao=function(D){function t(w){void 0===w&&(w=mo.a.DefaultUtilityLayer);var N=D.call(this,w)||this;return N._meshAttached=null,N.onDragStartObservable=new j.c,N.onDragEndObservable=new j.c,N._planarGizmoEnabled=!1,N.xGizmo=new fo.a(new z.e(1,0,0),G.a.Red().scale(.5),w,N),N.yGizmo=new fo.a(new z.e(0,1,0),G.a.Green().scale(.5),w,N),N.zGizmo=new fo.a(new z.e(0,0,1),G.a.Blue().scale(.5),w,N),N.xPlaneGizmo=new xo(new z.e(1,0,0),G.a.Red().scale(.5),N.gizmoLayer,N),N.yPlaneGizmo=new xo(new z.e(0,1,0),G.a.Green().scale(.5),N.gizmoLayer,N),N.zPlaneGizmo=new xo(new z.e(0,0,1),G.a.Blue().scale(.5),N.gizmoLayer,N),[N.xGizmo,N.yGizmo,N.zGizmo,N.xPlaneGizmo,N.yPlaneGizmo,N.zPlaneGizmo].forEach((function(D){D.dragBehavior.onDragStartObservable.add((function(){N.onDragStartObservable.notifyObservers({})})),D.dragBehavior.onDragEndObservable.add((function(){N.onDragEndObservable.notifyObservers({})}))})),N.attachedMesh=null,N}return Object(Z.d)(t,D),Object.defineProperty(t.prototype,"attachedMesh",{get:function(){return this._meshAttached},set:function(D){this._meshAttached=D,[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach((function(w){w.isEnabled?w.attachedMesh=D:w.attachedMesh=null}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"planarGizmoEnabled",{get:function(){return this._planarGizmoEnabled},set:function(D){var w=this;this._planarGizmoEnabled=D,[this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach((function(N){N&&(N.isEnabled=D,D&&(N.attachedMesh=w.attachedMesh))}),this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updateGizmoRotationToMatchAttachedMesh",{get:function(){return this._updateGizmoRotationToMatchAttachedMesh},set:function(D){this._updateGizmoRotationToMatchAttachedMesh=D,[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach((function(w){w&&(w.updateGizmoRotationToMatchAttachedMesh=D)}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"snapDistance",{get:function(){return this._snapDistance},set:function(D){this._snapDistance=D,[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach((function(w){w&&(w.snapDistance=D)}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleRatio",{get:function(){return this._scaleRatio},set:function(D){this._scaleRatio=D,[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach((function(w){w&&(w.scaleRatio=D)}))},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach((function(D){D&&D.dispose()})),this.onDragStartObservable.clear(),this.onDragEndObservable.clear()},t.prototype.setCustomMesh=function(D){oe.a.Error("Custom meshes are not supported on this gizmo, please set the custom meshes on the gizmos contained within this one (gizmo.xGizmo, gizmo.yGizmo, gizmo.zGizmo,gizmo.xPlaneGizmo, gizmo.yPlaneGizmo, gizmo.zPlaneGizmo)")},t}(_o.a);qi.a.CreatePolyhedron=function(D){var w=[];w[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},w[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},w[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},w[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},w[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},w[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},w[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},w[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},w[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},w[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},w[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},w[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},w[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},w[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},w[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};var N,F,k,j,H,X,q=D.type&&(D.type<0||D.type>=w.length)?0:D.type||0,Z=D.size,J=D.sizeX||Z||1,$=D.sizeY||Z||1,te=D.sizeZ||Z||1,ie=D.custom||w[q],oe=ie.face.length,ce=D.faceUV||new Array(oe),he=D.faceColors,fe=void 0===D.flat||D.flat,pe=0===D.sideOrientation?0:D.sideOrientation||qi.a.DEFAULTSIDE,_e=new Array,ve=new Array,ye=new Array,be=new Array,Te=new Array,Ee=0,Se=0,Me=new Array,xe=0,Ae=0;if(fe)for(Ae=0;Ae<oe;Ae++)he&&void 0===he[Ae]&&(he[Ae]=new G.b(1,1,1,1)),ce&&void 0===ce[Ae]&&(ce[Ae]=new z.f(0,0,1,1));if(fe)for(Ae=0;Ae<oe;Ae++){var Pe=ie.face[Ae].length;for(k=2*Math.PI/Pe,j=.5*Math.tan(k/2),H=.5,xe=0;xe<Pe;xe++)_e.push(ie.vertex[ie.face[Ae][xe]][0]*J,ie.vertex[ie.face[Ae][xe]][1]*$,ie.vertex[ie.face[Ae][xe]][2]*te),Me.push(Ee),Ee++,N=ce[Ae].x+(ce[Ae].z-ce[Ae].x)*(.5+j),F=ce[Ae].y+(ce[Ae].w-ce[Ae].y)*(H-.5),be.push(N,F),X=j*Math.cos(k)-H*Math.sin(k),H=j*Math.sin(k)+H*Math.cos(k),j=X,he&&Te.push(he[Ae].r,he[Ae].g,he[Ae].b,he[Ae].a);for(xe=0;xe<Pe-2;xe++)ve.push(Me[0+Se],Me[xe+2+Se],Me[xe+1+Se]);Se+=Pe}else{for(xe=0;xe<ie.vertex.length;xe++)_e.push(ie.vertex[xe][0]*J,ie.vertex[xe][1]*$,ie.vertex[xe][2]*te),be.push(0,0);for(Ae=0;Ae<oe;Ae++)for(xe=0;xe<ie.face[Ae].length-2;xe++)ve.push(ie.face[Ae][0],ie.face[Ae][xe+2],ie.face[Ae][xe+1])}qi.a.ComputeNormals(_e,ve,ye),qi.a._ComputeSides(pe,_e,ve,ye,be,D.frontUVs,D.backUVs);var Oe=new qi.a;return Oe.positions=_e,Oe.indices=ve,Oe.normals=ye,Oe.uvs=be,he&&fe&&(Oe.colors=Te),Oe},xt.a.CreatePolyhedron=function(D,w,N){return Po.CreatePolyhedron(D,w,N)};var Po=function(){function e(){}return e.CreatePolyhedron=function(D,w,N){void 0===N&&(N=null);var F=new xt.a(D,N);return w.sideOrientation=xt.a._GetDefaultSideOrientation(w.sideOrientation),F._originalBuilderSideOrientation=w.sideOrientation,qi.a.CreatePolyhedron(w).applyToMesh(F,w.updatable),F},e}(),Co=function(D){function t(w){void 0===w&&(w=mo.a.DefaultUtilityLayer);var N=D.call(this,w)||this;N._meshAttached=null,N._sensitivity=1,N.onDragStartObservable=new j.c,N.onDragEndObservable=new j.c,N.xGizmo=new go(new z.e(1,0,0),G.a.Red().scale(.5),w,N),N.yGizmo=new go(new z.e(0,1,0),G.a.Green().scale(.5),w,N),N.zGizmo=new go(new z.e(0,0,1),G.a.Blue().scale(.5),w,N),N.uniformScaleGizmo=new go(new z.e(0,1,0),G.a.Yellow().scale(.5),w,N),N.uniformScaleGizmo.updateGizmoRotationToMatchAttachedMesh=!1,N.uniformScaleGizmo.uniformScaling=!0,N._uniformScalingMesh=Po.CreatePolyhedron("",{type:1},N.uniformScaleGizmo.gizmoLayer.utilityLayerScene),N._uniformScalingMesh.scaling.scaleInPlace(.02),N._uniformScalingMesh.visibility=0,N._octahedron=Po.CreatePolyhedron("",{type:1},N.uniformScaleGizmo.gizmoLayer.utilityLayerScene),N._octahedron.scaling.scaleInPlace(.007),N._uniformScalingMesh.addChild(N._octahedron),N.uniformScaleGizmo.setCustomMesh(N._uniformScalingMesh,!0);var F=w._getSharedGizmoLight();return F.includedOnlyMeshes=F.includedOnlyMeshes.concat(N._octahedron),[N.xGizmo,N.yGizmo,N.zGizmo,N.uniformScaleGizmo].forEach((function(D){D.dragBehavior.onDragStartObservable.add((function(){N.onDragStartObservable.notifyObservers({})})),D.dragBehavior.onDragEndObservable.add((function(){N.onDragEndObservable.notifyObservers({})}))})),N.attachedMesh=null,N}return Object(Z.d)(t,D),Object.defineProperty(t.prototype,"attachedMesh",{get:function(){return this._meshAttached},set:function(D){this._meshAttached=D,[this.xGizmo,this.yGizmo,this.zGizmo,this.uniformScaleGizmo].forEach((function(w){w.isEnabled?w.attachedMesh=D:w.attachedMesh=null}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updateGizmoRotationToMatchAttachedMesh",{get:function(){return this._updateGizmoRotationToMatchAttachedMesh},set:function(D){D?(this._updateGizmoRotationToMatchAttachedMesh=D,[this.xGizmo,this.yGizmo,this.zGizmo,this.uniformScaleGizmo].forEach((function(w){w&&(w.updateGizmoRotationToMatchAttachedMesh=D)}))):oe.a.Warn("Setting updateGizmoRotationToMatchAttachedMesh = false on scaling gizmo is not supported.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"snapDistance",{get:function(){return this._snapDistance},set:function(D){this._snapDistance=D,[this.xGizmo,this.yGizmo,this.zGizmo,this.uniformScaleGizmo].forEach((function(w){w&&(w.snapDistance=D)}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleRatio",{get:function(){return this._scaleRatio},set:function(D){this._scaleRatio=D,[this.xGizmo,this.yGizmo,this.zGizmo,this.uniformScaleGizmo].forEach((function(w){w&&(w.scaleRatio=D)}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sensitivity",{get:function(){return this._sensitivity},set:function(D){this._sensitivity=D,[this.xGizmo,this.yGizmo,this.zGizmo,this.uniformScaleGizmo].forEach((function(w){w&&(w.sensitivity=D)}))},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){[this.xGizmo,this.yGizmo,this.zGizmo,this.uniformScaleGizmo].forEach((function(D){D&&D.dispose()})),this.onDragStartObservable.clear(),this.onDragEndObservable.clear(),[this._uniformScalingMesh,this._octahedron].forEach((function(D){D&&D.dispose()}))},t}(_o.a),Oo=function(){function e(D){var w=this;this.scene=D,this.clearGizmoOnEmptyPointerEvent=!1,this.onAttachedToMeshObservable=new j.c,this._gizmosEnabled={positionGizmo:!1,rotationGizmo:!1,scaleGizmo:!1,boundingBoxGizmo:!1},this._pointerObserver=null,this._attachedMesh=null,this._boundingBoxColor=G.a.FromHexString("#0984e3"),this.boundingBoxDragBehavior=new Qt,this.attachableMeshes=null,this.usePointerToAttachGizmos=!0,this._defaultKeepDepthUtilityLayer=new mo.a(D),this._defaultKeepDepthUtilityLayer.utilityLayerScene.autoClearDepthAndStencil=!1,this._defaultUtilityLayer=new mo.a(D),this.gizmos={positionGizmo:null,rotationGizmo:null,scaleGizmo:null,boundingBoxGizmo:null},this._pointerObserver=D.onPointerObservable.add((function(D){if(w.usePointerToAttachGizmos&&D.type==kt.a.POINTERDOWN)if(D.pickInfo&&D.pickInfo.pickedMesh){var N=D.pickInfo.pickedMesh;if(null==w.attachableMeshes)for(;N&&null!=N.parent;)N=N.parent;else{var F=!1;w.attachableMeshes.forEach((function(D){N&&(N==D||N.isDescendantOf(D))&&(N=D,F=!0)})),F||(N=null)}N instanceof Wt.a?w._attachedMesh!=N&&w.attachToMesh(N):w.clearGizmoOnEmptyPointerEvent&&w.attachToMesh(null)}else w.clearGizmoOnEmptyPointerEvent&&w.attachToMesh(null)}))}return Object.defineProperty(e.prototype,"keepDepthUtilityLayer",{get:function(){return this._defaultKeepDepthUtilityLayer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"utilityLayer",{get:function(){return this._defaultUtilityLayer},enumerable:!0,configurable:!0}),e.prototype.attachToMesh=function(D){for(var w in this._attachedMesh&&this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior),this._attachedMesh=D,this.gizmos){var N=this.gizmos[w];N&&this._gizmosEnabled[w]&&(N.attachedMesh=D)}this.boundingBoxGizmoEnabled&&this._attachedMesh&&this._attachedMesh.addBehavior(this.boundingBoxDragBehavior),this.onAttachedToMeshObservable.notifyObservers(D)},Object.defineProperty(e.prototype,"positionGizmoEnabled",{get:function(){return this._gizmosEnabled.positionGizmo},set:function(D){D?(this.gizmos.positionGizmo||(this.gizmos.positionGizmo=new Ao(this._defaultUtilityLayer)),this.gizmos.positionGizmo.attachedMesh=this._attachedMesh):this.gizmos.positionGizmo&&(this.gizmos.positionGizmo.attachedMesh=null),this._gizmosEnabled.positionGizmo=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationGizmoEnabled",{get:function(){return this._gizmosEnabled.rotationGizmo},set:function(D){D?(this.gizmos.rotationGizmo||(this.gizmos.rotationGizmo=new Eo(this._defaultUtilityLayer)),this.gizmos.rotationGizmo.attachedMesh=this._attachedMesh):this.gizmos.rotationGizmo&&(this.gizmos.rotationGizmo.attachedMesh=null),this._gizmosEnabled.rotationGizmo=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleGizmoEnabled",{get:function(){return this._gizmosEnabled.scaleGizmo},set:function(D){D?(this.gizmos.scaleGizmo=this.gizmos.scaleGizmo||new Co(this._defaultUtilityLayer),this.gizmos.scaleGizmo.attachedMesh=this._attachedMesh):this.gizmos.scaleGizmo&&(this.gizmos.scaleGizmo.attachedMesh=null),this._gizmosEnabled.scaleGizmo=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boundingBoxGizmoEnabled",{get:function(){return this._gizmosEnabled.boundingBoxGizmo},set:function(D){D?(this.gizmos.boundingBoxGizmo=this.gizmos.boundingBoxGizmo||new bo(this._boundingBoxColor,this._defaultKeepDepthUtilityLayer),this.gizmos.boundingBoxGizmo.attachedMesh=this._attachedMesh,this._attachedMesh&&(this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior),this._attachedMesh.addBehavior(this.boundingBoxDragBehavior))):this.gizmos.boundingBoxGizmo&&(this._attachedMesh&&this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior),this.gizmos.boundingBoxGizmo.attachedMesh=null),this._gizmosEnabled.boundingBoxGizmo=D},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){for(var D in this.scene.onPointerObservable.remove(this._pointerObserver),this.gizmos){var w=this.gizmos[D];w&&w.dispose()}this._defaultKeepDepthUtilityLayer.dispose(),this._defaultUtilityLayer.dispose(),this.boundingBoxDragBehavior.detach(),this.onAttachedToMeshObservable.clear()},e}(),Ro=N(50),Do=function(D){function t(){var w=null!==D&&D.apply(this,arguments)||this;return w._needProjectionMatrixCompute=!0,w}return Object(Z.d)(t,D),t.prototype._setPosition=function(D){this._position=D},Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(D){this._setPosition(D)},enumerable:!0,configurable:!0}),t.prototype._setDirection=function(D){this._direction=D},Object.defineProperty(t.prototype,"direction",{get:function(){return this._direction},set:function(D){this._setDirection(D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowMinZ",{get:function(){return this._shadowMinZ},set:function(D){this._shadowMinZ=D,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowMaxZ",{get:function(){return this._shadowMaxZ},set:function(D){this._shadowMaxZ=D,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),t.prototype.computeTransformedInformation=function(){return!(!this.parent||!this.parent.getWorldMatrix||(this.transformedPosition||(this.transformedPosition=z.e.Zero()),z.e.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=z.e.Zero()),z.e.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),0))},t.prototype.getDepthScale=function(){return 50},t.prototype.getShadowDirection=function(D){return this.transformedDirection?this.transformedDirection:this.direction},t.prototype.getAbsolutePosition=function(){return this.transformedPosition?this.transformedPosition:this.position},t.prototype.setDirectionToTarget=function(D){return this.direction=z.e.Normalize(D.subtract(this.position)),this.direction},t.prototype.getRotation=function(){this.direction.normalize();var D=z.e.Cross(this.direction,Qe.a.Y),w=z.e.Cross(D,this.direction);return z.e.RotationFromAxis(D,w,this.direction)},t.prototype.needCube=function(){return!1},t.prototype.needProjectionMatrixCompute=function(){return this._needProjectionMatrixCompute},t.prototype.forceProjectionMatrixCompute=function(){this._needProjectionMatrixCompute=!0},t.prototype._initCache=function(){D.prototype._initCache.call(this),this._cache.position=z.e.Zero()},t.prototype._isSynchronized=function(){return!!this._cache.position.equals(this.position)},t.prototype.computeWorldMatrix=function(D){return!D&&this.isSynchronized()?(this._currentRenderId=this.getScene().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.copyFrom(this.position),this._worldMatrix||(this._worldMatrix=z.a.Identity()),z.a.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)},t.prototype.getDepthMinZ=function(D){return void 0!==this.shadowMinZ?this.shadowMinZ:D.minZ},t.prototype.getDepthMaxZ=function(D){return void 0!==this.shadowMaxZ?this.shadowMaxZ:D.maxZ},t.prototype.setShadowProjectionMatrix=function(D,w,N){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(w,N,D):this._setDefaultShadowProjectionMatrix(D,w,N),this},Object(Z.c)([Object(Ie.o)()],t.prototype,"position",null),Object(Z.c)([Object(Ie.o)()],t.prototype,"direction",null),Object(Z.c)([Object(Ie.c)()],t.prototype,"shadowMinZ",null),Object(Z.c)([Object(Ie.c)()],t.prototype,"shadowMaxZ",null),t}(Ro.a);we.a.AddNodeConstructor("Light_Type_1",(function(D,w){return function(){return new Io(D,z.e.Zero(),w)}}));var Io=function(D){function t(w,N,F){var k=D.call(this,w,F)||this;return k._shadowFrustumSize=0,k._shadowOrthoScale=.1,k.autoUpdateExtends=!0,k.autoCalcShadowZBounds=!1,k._orthoLeft=Number.MAX_VALUE,k._orthoRight=Number.MIN_VALUE,k._orthoTop=Number.MIN_VALUE,k._orthoBottom=Number.MAX_VALUE,k.position=N.scale(-1),k.direction=N,k}return Object(Z.d)(t,D),Object.defineProperty(t.prototype,"shadowFrustumSize",{get:function(){return this._shadowFrustumSize},set:function(D){this._shadowFrustumSize=D,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowOrthoScale",{get:function(){return this._shadowOrthoScale},set:function(D){this._shadowOrthoScale=D,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"DirectionalLight"},t.prototype.getTypeID=function(){return Ro.a.LIGHTTYPEID_DIRECTIONALLIGHT},t.prototype._setDefaultShadowProjectionMatrix=function(D,w,N){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(D):this._setDefaultAutoExtendShadowProjectionMatrix(D,w,N)},t.prototype._setDefaultFixedFrustumShadowProjectionMatrix=function(D){var w=this.getScene().activeCamera;w&&z.a.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:w.minZ,void 0!==this.shadowMaxZ?this.shadowMaxZ:w.maxZ,D)},t.prototype._setDefaultAutoExtendShadowProjectionMatrix=function(D,w,N){var F=this.getScene().activeCamera;if(F){if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){var k=z.e.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE;for(var j=Number.MAX_VALUE,G=Number.MIN_VALUE,H=0;H<N.length;H++){var X=N[H];if(X)for(var q=X.getBoundingInfo().boundingBox,Z=0;Z<q.vectorsWorld.length;Z++)z.e.TransformCoordinatesToRef(q.vectorsWorld[Z],w,k),k.x<this._orthoLeft&&(this._orthoLeft=k.x),k.y<this._orthoBottom&&(this._orthoBottom=k.y),k.x>this._orthoRight&&(this._orthoRight=k.x),k.y>this._orthoTop&&(this._orthoTop=k.y),this.autoCalcShadowZBounds&&(k.z<j&&(j=k.z),k.z>G&&(G=k.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=j,this._shadowMaxZ=G)}var J=this._orthoRight-this._orthoLeft,$=this._orthoTop-this._orthoBottom;z.a.OrthoOffCenterLHToRef(this._orthoLeft-J*this.shadowOrthoScale,this._orthoRight+J*this.shadowOrthoScale,this._orthoBottom-$*this.shadowOrthoScale,this._orthoTop+$*this.shadowOrthoScale,void 0!==this.shadowMinZ?this.shadowMinZ:F.minZ,void 0!==this.shadowMaxZ?this.shadowMaxZ:F.maxZ,D)}},t.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},t.prototype.transferToEffect=function(D,w){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,w),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,w),this)},t.prototype.transferToNodeMaterialEffect=function(D,w){return this.computeTransformedInformation()?(D.setFloat3(w,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(D.setFloat3(w,this.direction.x,this.direction.y,this.direction.z),this)},t.prototype.getDepthMinZ=function(D){return 1},t.prototype.getDepthMaxZ=function(D){return 1},t.prototype.prepareLightSpecificDefines=function(D,w){D["DIRLIGHT"+w]=!0},Object(Z.c)([Object(Ie.c)()],t.prototype,"shadowFrustumSize",null),Object(Z.c)([Object(Ie.c)()],t.prototype,"shadowOrthoScale",null),Object(Z.c)([Object(Ie.c)()],t.prototype,"autoUpdateExtends",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"autoCalcShadowZBounds",void 0),t}(Do);xt.a.CreateHemisphere=function(D,w,N,F){var k={segments:w,diameter:N};return Lo.CreateHemisphere(D,k,F)};var Lo=function(){function e(){}return e.CreateHemisphere=function(D,w,N){w.diameter||(w.diameter=1),w.segments||(w.segments=16);var F=vo.a.CreateSphere("",{slice:.5,diameter:w.diameter,segments:w.segments},N),k=xt.a.CreateDisc("",w.diameter/2,3*w.segments+(4-w.segments),N);k.rotation.x=-Math.PI/2,k.parent=F;var j=xt.a.MergeMeshes([k,F],!0);return j.name=D,j},e}();we.a.AddNodeConstructor("Light_Type_2",(function(D,w){return function(){return new wo(D,z.e.Zero(),z.e.Zero(),0,0,w)}}));var wo=function(D){function t(w,N,F,k,j,G){var H=D.call(this,w,G)||this;return H._innerAngle=0,H._projectionTextureMatrix=z.a.Zero(),H._projectionTextureLightNear=1e-6,H._projectionTextureLightFar=1e3,H._projectionTextureUpDirection=z.e.Up(),H._projectionTextureViewLightDirty=!0,H._projectionTextureProjectionLightDirty=!0,H._projectionTextureDirty=!0,H._projectionTextureViewTargetVector=z.e.Zero(),H._projectionTextureViewLightMatrix=z.a.Zero(),H._projectionTextureProjectionLightMatrix=z.a.Zero(),H._projectionTextureScalingMatrix=z.a.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),H.position=N,H.direction=F,H.angle=k,H.exponent=j,H}return Object(Z.d)(t,D),Object.defineProperty(t.prototype,"angle",{get:function(){return this._angle},set:function(D){this._angle=D,this._cosHalfAngle=Math.cos(.5*D),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"innerAngle",{get:function(){return this._innerAngle},set:function(D){this._innerAngle=D,this._computeAngleValues()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowAngleScale",{get:function(){return this._shadowAngleScale},set:function(D){this._shadowAngleScale=D,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"projectionTextureMatrix",{get:function(){return this._projectionTextureMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"projectionTextureLightNear",{get:function(){return this._projectionTextureLightNear},set:function(D){this._projectionTextureLightNear=D,this._projectionTextureProjectionLightDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"projectionTextureLightFar",{get:function(){return this._projectionTextureLightFar},set:function(D){this._projectionTextureLightFar=D,this._projectionTextureProjectionLightDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"projectionTextureUpDirection",{get:function(){return this._projectionTextureUpDirection},set:function(D){this._projectionTextureUpDirection=D,this._projectionTextureProjectionLightDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"projectionTexture",{get:function(){return this._projectionTexture},set:function(D){var w=this;if(this._projectionTexture!==D&&(this._projectionTexture=D,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady())){var N=this._projectionTexture;N.onLoadObservable&&N.onLoadObservable.addOnce((function(){w._markMeshesAsLightDirty()}))}},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"SpotLight"},t.prototype.getTypeID=function(){return Ro.a.LIGHTTYPEID_SPOTLIGHT},t.prototype._setDirection=function(w){D.prototype._setDirection.call(this,w),this._projectionTextureViewLightDirty=!0},t.prototype._setPosition=function(w){D.prototype._setPosition.call(this,w),this._projectionTextureViewLightDirty=!0},t.prototype._setDefaultShadowProjectionMatrix=function(D,w,N){var F=this.getScene().activeCamera;if(F){this._shadowAngleScale=this._shadowAngleScale||1;var k=this._shadowAngleScale*this._angle;z.a.PerspectiveFovLHToRef(k,1,this.getDepthMinZ(F),this.getDepthMaxZ(F),D)}},t.prototype._computeProjectionTextureViewLightMatrix=function(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.position.addToRef(this.direction,this._projectionTextureViewTargetVector),z.a.LookAtLHToRef(this.position,this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)},t.prototype._computeProjectionTextureProjectionLightMatrix=function(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;var D=this.projectionTextureLightFar,w=this.projectionTextureLightNear,N=D/(D-w),F=-N*w,k=1/Math.tan(this._angle/2);z.a.FromValuesToRef(k/1,0,0,0,0,k,0,0,0,0,N,1,0,0,F,0,this._projectionTextureProjectionLightMatrix)},t.prototype._computeProjectionTextureMatrix=function(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof Jt.a){var D=this._projectionTexture.uScale/2,w=this._projectionTexture.vScale/2;z.a.FromValuesToRef(D,0,0,0,0,w,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)},t.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},t.prototype._computeAngleValues=function(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale},t.prototype.transferTexturesToEffect=function(D,w){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),D.setMatrix("textureProjectionMatrix"+w,this._projectionTextureMatrix),D.setTexture("projectionLightSampler"+w,this.projectionTexture)),this},t.prototype.transferToEffect=function(D,w){var N;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,w),N=z.e.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,w),N=z.e.Normalize(this.direction)),this.getScene().useRightHandedSystem?this._uniformBuffer.updateFloat4("vLightDirection",-N.x,-N.y,-N.z,this._cosHalfAngle,w):this._uniformBuffer.updateFloat4("vLightDirection",N.x,N.y,N.z,this._cosHalfAngle,w),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,w),this},t.prototype.transferToNodeMaterialEffect=function(D,w){var N;return N=this.computeTransformedInformation()?z.e.Normalize(this.transformedDirection):z.e.Normalize(this.direction),this.getScene().useRightHandedSystem?D.setFloat3(w,-N.x,-N.y,-N.z):D.setFloat3(w,N.x,N.y,N.z),this},t.prototype.dispose=function(){D.prototype.dispose.call(this),this._projectionTexture&&this._projectionTexture.dispose()},t.prototype.prepareLightSpecificDefines=function(D,w){D["SPOTLIGHT"+w]=!0,D["PROJECTEDLIGHTTEXTURE"+w]=!(!this.projectionTexture||!this.projectionTexture.isReady())},Object(Z.c)([Object(Ie.c)()],t.prototype,"angle",null),Object(Z.c)([Object(Ie.c)()],t.prototype,"innerAngle",null),Object(Z.c)([Object(Ie.c)()],t.prototype,"shadowAngleScale",null),Object(Z.c)([Object(Ie.c)()],t.prototype,"exponent",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"projectionTextureLightNear",null),Object(Z.c)([Object(Ie.c)()],t.prototype,"projectionTextureLightFar",null),Object(Z.c)([Object(Ie.c)()],t.prototype,"projectionTextureUpDirection",null),Object(Z.c)([Object(Ie.m)("projectedLightTexture")],t.prototype,"_projectionTexture",void 0),t}(Do),No=function(D){function t(w){var N=D.call(this,w)||this;return N._cachedPosition=new z.e,N._cachedForward=new z.e(0,0,1),N._light=null,N.attachedMesh=new Wt.a("",N.gizmoLayer.utilityLayerScene),N._attachedMeshParent=new So.a("parent",N.gizmoLayer.originalScene),N.attachedMesh.parent=N._attachedMeshParent,N._material=new Hi.a("light",N.gizmoLayer.originalScene),N._material.diffuseColor=new G.a(.5,.5,.5),N._material.specularColor=new G.a(.1,.1,.1),N}return Object(Z.d)(t,D),Object.defineProperty(t.prototype,"light",{get:function(){return this._light},set:function(D){var w=this;if(this._light=D,D){this._lightMesh&&this._lightMesh.dispose(),D instanceof ji.a?this._lightMesh=t._CreateHemisphericLightMesh(this.gizmoLayer.utilityLayerScene):this._lightMesh=D instanceof Io?t._CreateDirectionalLightMesh(this.gizmoLayer.utilityLayerScene):D instanceof wo?t._CreateSpotLightMesh(this.gizmoLayer.utilityLayerScene):t._CreatePointLightMesh(this.gizmoLayer.utilityLayerScene),this._lightMesh.getChildMeshes(!1).forEach((function(D){D.material=w._material})),this._lightMesh.parent=this._rootMesh;var N=this.gizmoLayer._getSharedGizmoLight();N.includedOnlyMeshes=N.includedOnlyMeshes.concat(this._lightMesh.getChildMeshes(!1)),this._lightMesh.rotationQuaternion=new z.b,this.attachedMesh.reservedDataStore||(this.attachedMesh.reservedDataStore={}),this.attachedMesh.reservedDataStore.lightGizmo=this,D.parent&&this._attachedMeshParent.freezeWorldMatrix(D.parent.getWorldMatrix()),D.position&&(this.attachedMesh.position.copyFrom(D.position),this.attachedMesh.computeWorldMatrix(!0),this._cachedPosition.copyFrom(this.attachedMesh.position)),D.direction&&(this.attachedMesh.setDirection(D.direction),this.attachedMesh.computeWorldMatrix(!0),this._cachedForward.copyFrom(this.attachedMesh.forward)),this._update()}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"material",{get:function(){return this._material},enumerable:!0,configurable:!0}),t.prototype._update=function(){D.prototype._update.call(this),this._light&&(this._light.parent&&this._attachedMeshParent.freezeWorldMatrix(this._light.parent.getWorldMatrix()),this._light.position&&(this.attachedMesh.position.equals(this._cachedPosition)?(this.attachedMesh.position.copyFrom(this._light.position),this.attachedMesh.computeWorldMatrix(!0),this._cachedPosition.copyFrom(this.attachedMesh.position)):(this._light.position.copyFrom(this.attachedMesh.position),this._cachedPosition.copyFrom(this.attachedMesh.position))),this._light.direction&&(z.e.DistanceSquared(this.attachedMesh.forward,this._cachedForward)>1e-4?(this._light.direction.copyFrom(this.attachedMesh.forward),this._cachedForward.copyFrom(this.attachedMesh.forward)):z.e.DistanceSquared(this.attachedMesh.forward,this._light.direction)>1e-4&&(this.attachedMesh.setDirection(this._light.direction),this.attachedMesh.computeWorldMatrix(!0),this._cachedForward.copyFrom(this.attachedMesh.forward))),this._light.isEnabled()?this._material.diffuseColor.set(this._light.diffuse.r/3,this._light.diffuse.g/3,this._light.diffuse.b/3):this._material.diffuseColor.set(0,0,0))},t.prototype.dispose=function(){this._material.dispose(),D.prototype.dispose.call(this),this._attachedMeshParent.dispose()},t._CreateHemisphericLightMesh=function(D){var w=new xt.a("hemisphereLight",D),N=Lo.CreateHemisphere(w.name,{segments:10,diameter:1},D);N.position.z=-.15,N.rotation.x=Math.PI/2,N.parent=w;var F=this._CreateLightLines(3,D);return F.parent=w,F.position.z,w.scaling.scaleInPlace(t._Scale),w.rotation.x=Math.PI/2,w},t._CreatePointLightMesh=function(D){var w=new xt.a("pointLight",D),N=vo.a.CreateSphere(w.name,{segments:10,diameter:1},D);return N.rotation.x=Math.PI/2,N.parent=w,this._CreateLightLines(5,D).parent=w,w.scaling.scaleInPlace(t._Scale),w.rotation.x=Math.PI/2,w},t._CreateSpotLightMesh=function(D){var w=new xt.a("spotLight",D);vo.a.CreateSphere(w.name,{segments:10,diameter:1},D).parent=w;var N=Lo.CreateHemisphere(w.name,{segments:10,diameter:2},D);return N.parent=w,N.rotation.x=-Math.PI/2,this._CreateLightLines(2,D).parent=w,w.scaling.scaleInPlace(t._Scale),w.rotation.x=Math.PI/2,w},t._CreateDirectionalLightMesh=function(D){var w=new xt.a("directionalLight",D),N=new xt.a(w.name,D);N.parent=w,vo.a.CreateSphere(w.name,{diameter:1.2,segments:10},D).parent=N;var F=xt.a.CreateCylinder(w.name,6,.3,.3,6,1,D);F.parent=N,(k=F.clone(w.name)).scaling.y=.5,k.position.x+=1.25,(j=F.clone(w.name)).scaling.y=.5,j.position.x+=-1.25;var k,j,z=xt.a.CreateCylinder(w.name,1,0,.6,6,1,D);return z.position.y+=3,z.parent=N,(k=z.clone(w.name)).position.y=1.5,k.position.x+=1.25,(j=z.clone(w.name)).position.y=1.5,j.position.x+=-1.25,N.scaling.scaleInPlace(t._Scale),N.rotation.z=Math.PI/2,N.rotation.y=Math.PI/2,w},t._Scale=.007,t._CreateLightLines=function(D,w){var N=new xt.a("root",w);N.rotation.x=Math.PI/2;var F=new xt.a("linePivot",w);F.parent=N;var k=xt.a.CreateCylinder("line",2,.2,.3,6,1,w);if(k.position.y=k.scaling.y/2+1.2,k.parent=F,D<2)return F;for(var j=0;j<4;j++)(z=F.clone("lineParentClone")).rotation.z=Math.PI/4,z.rotation.y=Math.PI/2+Math.PI/2*j,z.getChildMeshes()[0].scaling.y=.5,z.getChildMeshes()[0].scaling.x=z.getChildMeshes()[0].scaling.z=.8,z.getChildMeshes()[0].position.y=z.getChildMeshes()[0].scaling.y/2+1.2;if(D<3)return N;for(j=0;j<4;j++)(z=F.clone("linePivotClone")).rotation.z=Math.PI/2,z.rotation.y=Math.PI/2*j;if(D<4)return N;for(j=0;j<4;j++){var z;(z=F.clone("linePivotClone")).rotation.z=Math.PI+Math.PI/4,z.rotation.y=Math.PI/2+Math.PI/2*j,z.getChildMeshes()[0].scaling.y=.5,z.getChildMeshes()[0].scaling.x=z.getChildMeshes()[0].scaling.z=.8,z.getChildMeshes()[0].position.y=z.getChildMeshes()[0].scaling.y/2+1.2}return D<5||((z=F.clone("linePivotClone")).rotation.z=Math.PI),N},t}(_o.a);li.a.IncludesShadersStore.kernelBlurVaryingDeclaration="varying vec2 sampleCoord{X};",li.a.IncludesShadersStore.packingFunctions="vec4 pack(float depth)\n{\nconst vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);\nconst vec4 bit_mask=vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);\nvec4 res=fract(depth*bit_shift);\nres-=res.xxyz*bit_mask;\nreturn res;\n}\nfloat unpack(vec4 color)\n{\nconst vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);\nreturn dot(color,bit_shift);\n}",li.a.IncludesShadersStore.kernelBlurFragment="#ifdef DOF\nfactor=sampleCoC(sampleCoord{X});\ncomputedWeight=KERNEL_WEIGHT{X}*factor;\nsumOfWeights+=computedWeight;\n#else\ncomputedWeight=KERNEL_WEIGHT{X};\n#endif\n#ifdef PACKEDFLOAT\nblend+=unpack(texture2D(textureSampler,sampleCoord{X}))*computedWeight;\n#else\nblend+=texture2D(textureSampler,sampleCoord{X})*computedWeight;\n#endif",li.a.IncludesShadersStore.kernelBlurFragment2="#ifdef DOF\nfactor=sampleCoC(sampleCenter+delta*KERNEL_DEP_OFFSET{X});\ncomputedWeight=KERNEL_DEP_WEIGHT{X}*factor;\nsumOfWeights+=computedWeight;\n#else\ncomputedWeight=KERNEL_DEP_WEIGHT{X};\n#endif\n#ifdef PACKEDFLOAT\nblend+=unpack(texture2D(textureSampler,sampleCenter+delta*KERNEL_DEP_OFFSET{X}))*computedWeight;\n#else\nblend+=texture2D(textureSampler,sampleCenter+delta*KERNEL_DEP_OFFSET{X})*computedWeight;\n#endif",li.a.ShadersStore.kernelBlurPixelShader="\nuniform sampler2D textureSampler;\nuniform vec2 delta;\n\nvarying vec2 sampleCenter;\n#ifdef DOF\nuniform sampler2D circleOfConfusionSampler;\nuniform vec2 cameraMinMaxZ;\nfloat sampleDistance(const in vec2 offset) {\nfloat depth=texture2D(circleOfConfusionSampler,offset).g;\nreturn cameraMinMaxZ.x+(cameraMinMaxZ.y-cameraMinMaxZ.x)*depth;\n}\nfloat sampleCoC(const in vec2 offset) {\nfloat coc=texture2D(circleOfConfusionSampler,offset).r;\nreturn coc;\n}\n#endif\n#include<kernelBlurVaryingDeclaration>[0..varyingCount]\n#ifdef PACKEDFLOAT\n#include<packingFunctions>\n#endif\nvoid main(void)\n{\nfloat computedWeight=0.0;\n#ifdef PACKEDFLOAT\nfloat blend=0.;\n#else\nvec4 blend=vec4(0.);\n#endif\n#ifdef DOF\nfloat sumOfWeights=CENTER_WEIGHT;\nfloat factor=0.0;\n\n#ifdef PACKEDFLOAT\nblend+=unpack(texture2D(textureSampler,sampleCenter))*CENTER_WEIGHT;\n#else\nblend+=texture2D(textureSampler,sampleCenter)*CENTER_WEIGHT;\n#endif\n#endif\n#include<kernelBlurFragment>[0..varyingCount]\n#include<kernelBlurFragment2>[0..depCount]\n#ifdef PACKEDFLOAT\ngl_FragColor=pack(blend);\n#else\ngl_FragColor=blend;\n#endif\n#ifdef DOF\ngl_FragColor/=sumOfWeights;\n#endif\n}",li.a.IncludesShadersStore.kernelBlurVertex="sampleCoord{X}=sampleCenter+delta*KERNEL_OFFSET{X};",li.a.ShadersStore.kernelBlurVertexShader="\nattribute vec2 position;\n\nuniform vec2 delta;\n\nvarying vec2 sampleCenter;\n#include<kernelBlurVaryingDeclaration>[0..varyingCount]\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) {\nsampleCenter=(position*madd+madd);\n#include<kernelBlurVertex>[0..varyingCount]\ngl_Position=vec4(position,0.0,1.0);\n}";var Fo=function(D){function t(w,N,F,k,j,z,G,H,X,q,Z){void 0===z&&(z=Jt.a.BILINEAR_SAMPLINGMODE),void 0===X&&(X=ce.a.TEXTURETYPE_UNSIGNED_INT),void 0===q&&(q=""),void 0===Z&&(Z=!1);var J=D.call(this,w,"kernelBlur",["delta","direction","cameraMinMaxZ"],["circleOfConfusionSampler"],k,j,z,G,H,null,X,"kernelBlur",{varyingCount:0,depCount:0},!0)||this;return J.direction=N,J.blockCompilation=Z,J._packedFloat=!1,J._staticDefines="",J._staticDefines=q,J.onApplyObservable.add((function(D){J._outputTexture?D.setFloat2("delta",1/J._outputTexture.width*J.direction.x,1/J._outputTexture.height*J.direction.y):D.setFloat2("delta",1/J.width*J.direction.x,1/J.height*J.direction.y)})),J.kernel=F,J}return Object(Z.d)(t,D),Object.defineProperty(t.prototype,"kernel",{get:function(){return this._idealKernel},set:function(D){this._idealKernel!==D&&(D=Math.max(D,1),this._idealKernel=D,this._kernel=this._nearestBestKernel(D),this.blockCompilation||this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"packedFloat",{get:function(){return this._packedFloat},set:function(D){this._packedFloat!==D&&(this._packedFloat=D,this.blockCompilation||this._updateParameters())},enumerable:!0,configurable:!0}),t.prototype.updateEffect=function(D,w,N,F,k,j){void 0===D&&(D=null),void 0===w&&(w=null),void 0===N&&(N=null),this._updateParameters(k,j)},t.prototype._updateParameters=function(w,N){for(var F=this._kernel,k=(F-1)/2,j=[],z=[],G=0,H=0;H<F;H++){var X=H/(F-1),q=this._gaussianWeight(2*X-1);j[H]=H-k,z[H]=q,G+=q}for(H=0;H<z.length;H++)z[H]/=G;var Z=[],J=[],$=[];for(H=0;H<=k;H+=2){var te=Math.min(H+1,Math.floor(k));if(H===te)$.push({o:j[H],w:z[H]});else{var ie=te===k,oe=z[H]+z[te]*(ie?.5:1),ce=j[H]+1/(1+z[H]/z[te]);0===ce?($.push({o:j[H],w:z[H]}),$.push({o:j[H+1],w:z[H+1]})):($.push({o:ce,w:oe}),$.push({o:-ce,w:oe}))}}for(H=0;H<$.length;H++)J[H]=$[H].o,Z[H]=$[H].w;j=J,z=Z;var he=this.getEngine().getCaps().maxVaryingVectors,fe=Math.max(he,0)-1,pe=Math.min(j.length,fe),_e="";for(_e+=this._staticDefines,-1!=this._staticDefines.indexOf("DOF")&&(_e+="#define CENTER_WEIGHT "+this._glslFloat(z[pe-1])+"\r\n",pe--),H=0;H<pe;H++)_e+="#define KERNEL_OFFSET"+H+" "+this._glslFloat(j[H])+"\r\n",_e+="#define KERNEL_WEIGHT"+H+" "+this._glslFloat(z[H])+"\r\n";var ve=0;for(H=fe;H<j.length;H++)_e+="#define KERNEL_DEP_OFFSET"+ve+" "+this._glslFloat(j[H])+"\r\n",_e+="#define KERNEL_DEP_WEIGHT"+ve+" "+this._glslFloat(z[H])+"\r\n",ve++;this.packedFloat&&(_e+="#define PACKEDFLOAT 1"),this.blockCompilation=!1,D.prototype.updateEffect.call(this,_e,null,null,{varyingCount:pe,depCount:ve},w,N)},t.prototype._nearestBestKernel=function(D){for(var w=Math.round(D),N=0,F=[w,w-1,w+1,w-2,w+2];N<F.length;N++){var k=F[N];if(k%2!=0&&Math.floor(k/2)%2==0&&k>0)return Math.max(k,3)}return Math.max(w,3)},t.prototype._gaussianWeight=function(D){var w=-D*D/(1/3*2*(1/3));return 1/(Math.sqrt(2*Math.PI)*(1/3))*Math.exp(w)},t.prototype._glslFloat=function(D,w){return void 0===w&&(w=8),D.toFixed(w).replace(/0+$/,"")},t}(fi),Bo=function(D){function t(w,N,F,k,j,G,H){void 0===j&&(j=ce.a.TEXTURETYPE_UNSIGNED_INT),void 0===G&&(G=Jt.a.BILINEAR_SAMPLINGMODE),void 0===H&&(H=!0);var X=D.call(this,w,N,F,k,!0,j,!1,G,H)||this;return X.scene=F,X.mirrorPlane=new hr.a(0,1,0,1),X._transformMatrix=z.a.Zero(),X._mirrorMatrix=z.a.Zero(),X._adaptiveBlurKernel=0,X._blurKernelX=0,X._blurKernelY=0,X._blurRatio=1,X.ignoreCameraViewport=!0,X._updateGammaSpace(),X._imageProcessingConfigChangeObserver=F.imageProcessingConfiguration.onUpdateParameters.add((function(){X._updateGammaSpace})),X.onBeforeRenderObservable.add((function(){z.a.ReflectionToRef(X.mirrorPlane,X._mirrorMatrix),X._savedViewMatrix=F.getViewMatrix(),X._mirrorMatrix.multiplyToRef(X._savedViewMatrix,X._transformMatrix),F.setTransformMatrix(X._transformMatrix,F.getProjectionMatrix()),F.clipPlane=X.mirrorPlane,F.getEngine().cullBackFaces=!1,F._mirroredCameraPosition=z.e.TransformCoordinates(F.activeCamera.globalPosition,X._mirrorMatrix)})),X.onAfterRenderObservable.add((function(){F.setTransformMatrix(X._savedViewMatrix,F.getProjectionMatrix()),F.getEngine().cullBackFaces=!0,F._mirroredCameraPosition=null,F.clipPlane=null})),X}return Object(Z.d)(t,D),Object.defineProperty(t.prototype,"blurRatio",{get:function(){return this._blurRatio},set:function(D){this._blurRatio!==D&&(this._blurRatio=D,this._preparePostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"adaptiveBlurKernel",{set:function(D){this._adaptiveBlurKernel=D,this._autoComputeBlurKernel()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"blurKernel",{set:function(D){this.blurKernelX=D,this.blurKernelY=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"blurKernelX",{get:function(){return this._blurKernelX},set:function(D){this._blurKernelX!==D&&(this._blurKernelX=D,this._preparePostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"blurKernelY",{get:function(){return this._blurKernelY},set:function(D){this._blurKernelY!==D&&(this._blurKernelY=D,this._preparePostProcesses())},enumerable:!0,configurable:!0}),t.prototype._autoComputeBlurKernel=function(){var D=this.getScene().getEngine(),w=this.getRenderWidth()/D.getRenderWidth(),N=this.getRenderHeight()/D.getRenderHeight();this.blurKernelX=this._adaptiveBlurKernel*w,this.blurKernelY=this._adaptiveBlurKernel*N},t.prototype._onRatioRescale=function(){this._sizeRatio&&(this.resize(this._initialSizeParameter),this._adaptiveBlurKernel||this._preparePostProcesses()),this._adaptiveBlurKernel&&this._autoComputeBlurKernel()},t.prototype._updateGammaSpace=function(){this.gammaSpace=!this.scene.imageProcessingConfiguration.isEnabled||!this.scene.imageProcessingConfiguration.applyByPostProcess},t.prototype._preparePostProcesses=function(){if(this.clearPostProcesses(!0),this._blurKernelX&&this._blurKernelY){var D=this.getScene().getEngine(),w=D.getCaps().textureFloatRender?ce.a.TEXTURETYPE_FLOAT:ce.a.TEXTURETYPE_HALF_FLOAT;this._blurX=new Fo("horizontal blur",new z.d(1,0),this._blurKernelX,this._blurRatio,null,Jt.a.BILINEAR_SAMPLINGMODE,D,!1,w),this._blurX.autoClear=!1,1===this._blurRatio&&this.samples<2&&this._texture?this._blurX.inputTexture=this._texture:this._blurX.alwaysForcePOT=!0,this._blurY=new Fo("vertical blur",new z.d(0,1),this._blurKernelY,this._blurRatio,null,Jt.a.BILINEAR_SAMPLINGMODE,D,!1,w),this._blurY.autoClear=!1,this._blurY.alwaysForcePOT=1!==this._blurRatio,this.addPostProcess(this._blurX),this.addPostProcess(this._blurY)}else this._blurY&&(this.removePostProcess(this._blurY),this._blurY.dispose(),this._blurY=null),this._blurX&&(this.removePostProcess(this._blurX),this._blurX.dispose(),this._blurX=null)},t.prototype.clone=function(){var D=this.getScene();if(!D)return this;var w=this.getSize(),N=new t(this.name,w.width,D,this._renderTargetOptions.generateMipMaps,this._renderTargetOptions.type,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer);return N.hasAlpha=this.hasAlpha,N.level=this.level,N.mirrorPlane=this.mirrorPlane.clone(),this.renderList&&(N.renderList=this.renderList.slice(0)),N},t.prototype.serialize=function(){if(!this.name)return null;var w=D.prototype.serialize.call(this);return w.mirrorPlane=this.mirrorPlane.asArray(),w},t.prototype.dispose=function(){D.prototype.dispose.call(this),this.scene.imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingConfigChangeObserver)},t}(Li);Jt.a._CreateMirror=function(D,w,N,F){return new Bo(D,w,N,F)};var ko=N(54);di.a.prototype._createDepthStencilCubeTexture=function(D,w){var N=new $t.a(this,$t.b.Unknown);if(N.isCube=!0,1===this.webGLVersion)return oe.a.Error("Depth cube texture is not supported by WebGL 1."),N;var F=Object(Z.a)({bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1},w),k=this._gl;this._bindTextureDirectly(k.TEXTURE_CUBE_MAP,N,!0),this._setupDepthStencilTexture(N,D,F.generateStencil,F.bilinearFiltering,F.comparisonFunction);for(var j=0;j<6;j++)F.generateStencil?k.texImage2D(k.TEXTURE_CUBE_MAP_POSITIVE_X+j,0,k.DEPTH24_STENCIL8,D,D,0,k.DEPTH_STENCIL,k.UNSIGNED_INT_24_8,null):k.texImage2D(k.TEXTURE_CUBE_MAP_POSITIVE_X+j,0,k.DEPTH_COMPONENT24,D,D,0,k.DEPTH_COMPONENT,k.UNSIGNED_INT,null);return this._bindTextureDirectly(k.TEXTURE_CUBE_MAP,null),N},di.a.prototype._partialLoadFile=function(D,w,N,F,k){void 0===k&&(k=null),this._loadFile(D,(function(D){N[w]=D,N._internalCount++,6===N._internalCount&&F(N)}),void 0,void 0,!0,(function(D,w){k&&D&&k(D.status+" "+D.statusText,w)}))},di.a.prototype._cascadeLoadFiles=function(D,w,N,F){void 0===F&&(F=null);var k=[];k._internalCount=0;for(var j=0;j<6;j++)this._partialLoadFile(N[j],j,k,w,F)},di.a.prototype._cascadeLoadImgs=function(D,w,N,F,k){void 0===F&&(F=null);var j=[];j._internalCount=0;for(var z=0;z<6;z++)this._partialLoadImg(N[z],z,j,D,w,F,k)},di.a.prototype._partialLoadImg=function(D,w,N,F,k,j,z){var G;void 0===j&&(j=null),G=ko.a.LoadImage(D,(function(){G&&(N[w]=G,N._internalCount++,F&&F._removePendingData(G)),6===N._internalCount&&k(N)}),(function(D,w){F&&F._removePendingData(G),j&&j(D,w)}),F?F.offlineProvider:null,z),F&&G&&F._addPendingData(G)},di.a.prototype._setCubeMapTextureParams=function(D){var w=this._gl;w.texParameteri(w.TEXTURE_CUBE_MAP,w.TEXTURE_MAG_FILTER,w.LINEAR),w.texParameteri(w.TEXTURE_CUBE_MAP,w.TEXTURE_MIN_FILTER,D?w.LINEAR_MIPMAP_LINEAR:w.LINEAR),w.texParameteri(w.TEXTURE_CUBE_MAP,w.TEXTURE_WRAP_S,w.CLAMP_TO_EDGE),w.texParameteri(w.TEXTURE_CUBE_MAP,w.TEXTURE_WRAP_T,w.CLAMP_TO_EDGE),this._bindTextureDirectly(w.TEXTURE_CUBE_MAP,null)},di.a.prototype.createCubeTexture=function(D,w,N,F,k,j,z,G,H,X,q,Z){var J=this;void 0===k&&(k=null),void 0===j&&(j=null),void 0===G&&(G=null),void 0===H&&(H=!1),void 0===X&&(X=0),void 0===q&&(q=0),void 0===Z&&(Z=null);var $=this._gl,te=Z||new $t.a(this,$t.b.Cube);te.isCube=!0,te.url=D,te.generateMipMaps=!F,te._lodGenerationScale=X,te._lodGenerationOffset=q,this._doNotHandleContextLost||(te._extension=G,te._files=N);for(var ie=D.lastIndexOf("."),ce=G||(ie>-1?D.substring(ie).toLowerCase():""),he=null,fe=0,pe=di.a._TextureLoaders;fe<pe.length;fe++){var _e=pe[fe];if(_e.canLoad(ce)){he=_e;break}}if(he){var E=function(D){J._bindTextureDirectly($.TEXTURE_CUBE_MAP,te,!0),he.loadCubeData(D,te,H,k,j)};N&&6===N.length?he.supportCascades?this._cascadeLoadFiles(w,(function(D){return E(D.map((function(D){return new Uint8Array(D)})))}),N,j):j?j("Textures type does not support cascades."):oe.a.Warn("Texture loader does not support cascades."):this._loadFile(D,(function(D){return E(new Uint8Array(D))}),void 0,void 0,!0,(function(D,w){j&&D&&j(D.status+" "+D.statusText,w)}))}else{if(!N)throw new Error("Cannot load cubemap because files were not defined");this._cascadeLoadImgs(w,(function(D){var w=J.needPOTTextures?di.a.GetExponentOfTwo(D[0].width,J._caps.maxCubemapTextureSize):D[0].width,N=w,j=[$.TEXTURE_CUBE_MAP_POSITIVE_X,$.TEXTURE_CUBE_MAP_POSITIVE_Y,$.TEXTURE_CUBE_MAP_POSITIVE_Z,$.TEXTURE_CUBE_MAP_NEGATIVE_X,$.TEXTURE_CUBE_MAP_NEGATIVE_Y,$.TEXTURE_CUBE_MAP_NEGATIVE_Z];J._bindTextureDirectly($.TEXTURE_CUBE_MAP,te,!0),J._unpackFlipY(!1);for(var G=z?J._getInternalFormat(z):J._gl.RGBA,H=0;H<j.length;H++)if(D[H].width!==w||D[H].height!==N){if(J._prepareWorkingCanvas(),!J._workingCanvas||!J._workingContext)return void oe.a.Warn("Cannot create canvas to resize texture.");J._workingCanvas.width=w,J._workingCanvas.height=N,J._workingContext.drawImage(D[H],0,0,D[H].width,D[H].height,0,0,w,N),$.texImage2D(j[H],0,G,G,$.UNSIGNED_BYTE,J._workingCanvas)}else $.texImage2D(j[H],0,G,G,$.UNSIGNED_BYTE,D[H]);F||$.generateMipmap($.TEXTURE_CUBE_MAP),J._setCubeMapTextureParams(!F),te.width=w,te.height=N,te.isReady=!0,z&&(te.format=z),te.onLoadedObservable.notifyObservers(te),te.onLoadedObservable.clear(),k&&k()}),N,j)}return this._internalTexturesCache.push(te),te};var Uo=N(36),Vo=function(D){function t(w,N,F,k,G,H,X,q,Z,J,$,te,ie){var oe;void 0===F&&(F=null),void 0===k&&(k=!1),void 0===G&&(G=null),void 0===H&&(H=null),void 0===X&&(X=null),void 0===q&&(q=ce.a.TEXTUREFORMAT_RGBA),void 0===Z&&(Z=!1),void 0===J&&(J=null),void 0===$&&($=!1),void 0===te&&(te=.8),void 0===ie&&(ie=0);var he=D.call(this,N)||this;if(he.onLoadObservable=new j.c,he.boundingBoxPosition=z.e.Zero(),he._rotationY=0,he._files=null,he._forcedExtension=null,he._extensions=null,he._prefiltered=!1,he.name=w,he.url=w,he._noMipmap=k,he.hasAlpha=!1,he._format=q,he.isCube=!0,he._textureMatrix=z.a.Identity(),he._createPolynomials=$,he.coordinatesMode=Jt.a.CUBIC_MODE,he._extensions=F,he._files=G,he._forcedExtension=J,!w&&!G)return he;var fe=w.lastIndexOf("."),pe=J||(fe>-1?w.substring(fe).toLowerCase():""),_e=".dds"===pe,ve=".env"===pe;if(ve?(he.gammaSpace=!1,he._prefiltered=!1,he.anisotropicFilteringLevel=1):(he._prefiltered=Z,Z&&(he.gammaSpace=!1,he.anisotropicFilteringLevel=1)),he._texture=he._getFromCache(w,k),!G&&(ve||_e||F||(F=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),G=[],F))for(var ye=0;ye<F.length;ye++)G.push(w+F[ye]);he._files=G;var P=function(){he.onLoadObservable.notifyObservers(he),H&&H()};return he._texture?he._texture.isReady?Dt.b.SetImmediate((function(){return P()})):he._texture.onLoadedObservable.add((function(){return P()})):N.useDelayedTextureLoading?he.delayLoadState=ce.a.DELAYLOADSTATE_NOTLOADED:(he._texture=Z?N.getEngine().createPrefilteredCubeTexture(w,N,te,ie,H,X,q,J,he._createPolynomials):N.getEngine().createCubeTexture(w,N,G,k,H,X,he._format,J,!1,te,ie),null===(oe=he._texture)||void 0===oe||oe.onLoadedObservable.add((function(){return he.onLoadObservable.notifyObservers(he)}))),he}return Object(Z.d)(t,D),Object.defineProperty(t.prototype,"boundingBoxSize",{get:function(){return this._boundingBoxSize},set:function(D){if(!this._boundingBoxSize||!this._boundingBoxSize.equals(D)){this._boundingBoxSize=D;var w=this.getScene();w&&w.markAllMaterialsAsDirty(ce.a.MATERIAL_TextureDirtyFlag)}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotationY",{get:function(){return this._rotationY},set:function(D){this._rotationY=D,this.setReflectionTextureMatrix(z.a.RotationY(this._rotationY))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"noMipmap",{get:function(){return this._noMipmap},enumerable:!0,configurable:!0}),t.CreateFromImages=function(D,w,N){var F="";return D.forEach((function(D){return F+=D})),new t(F,w,null,N,D)},t.CreateFromPrefilteredData=function(D,w,N,F){void 0===N&&(N=null),void 0===F&&(F=!0);var k=w.useDelayedTextureLoading;w.useDelayedTextureLoading=!1;var j=new t(D,w,null,!1,null,null,null,void 0,!0,N,F);return w.useDelayedTextureLoading=k,j},Object.defineProperty(t.prototype,"isPrefiltered",{get:function(){return this._prefiltered},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"CubeTexture"},t.prototype.updateURL=function(D,w,N,F){void 0===F&&(F=!1),this.url&&(this.releaseInternalTexture(),this.getScene().markAllMaterialsAsDirty(ce.a.MATERIAL_TextureDirtyFlag)),this.name&&!Uo.a.StartsWith(this.name,"data:")||(this.name=D),this.url=D,this.delayLoadState=ce.a.DELAYLOADSTATE_NOTLOADED,this._prefiltered=F,this._prefiltered&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1),this._forcedExtension=w||null,N&&(this._delayedOnLoad=N),this.delayLoad(w)},t.prototype.delayLoad=function(D){var w,N=this;if(this.delayLoadState===ce.a.DELAYLOADSTATE_NOTLOADED){var F=this.getScene();F&&(this.delayLoadState=ce.a.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap),this._texture||(this._prefiltered?this._texture=F.getEngine().createPrefilteredCubeTexture(this.url,F,.8,0,this._delayedOnLoad,void 0,this._format,void 0,this._createPolynomials):this._texture=F.getEngine().createCubeTexture(this.url,F,this._files,this._noMipmap,this._delayedOnLoad,null,this._format,D),null===(w=this._texture)||void 0===w||w.onLoadedObservable.add((function(){return N.onLoadObservable.notifyObservers(N)}))))}},t.prototype.getReflectionTextureMatrix=function(){return this._textureMatrix},t.prototype.setReflectionTextureMatrix=function(D){var w=this;D.updateFlag!==this._textureMatrix.updateFlag&&(D.isIdentity()!==this._textureMatrix.isIdentity()&&this.getScene().markAllMaterialsAsDirty(ce.a.MATERIAL_TextureDirtyFlag,(function(D){return-1!==D.getActiveTextures().indexOf(w)})),this._textureMatrix=D)},t.Parse=function(D,w,N){var F=Ie.a.Parse((function(){var F=!1;return D.prefiltered&&(F=D.prefiltered),new t(N+D.name,w,D.extensions,!1,D.files||null,null,null,void 0,F,D.forcedExtension)}),D,w);if(D.boundingBoxPosition&&(F.boundingBoxPosition=z.e.FromArray(D.boundingBoxPosition)),D.boundingBoxSize&&(F.boundingBoxSize=z.e.FromArray(D.boundingBoxSize)),D.animations)for(var k=0;k<D.animations.length;k++){var j=D.animations[k],G=H.a.GetClass("BABYLON.Animation");G&&F.animations.push(G.Parse(j))}return F},t.prototype.clone=function(){var D=this,w=this.getScene(),N=0,F=Ie.a.Clone((function(){if(!w)return D;var F=new t(D.url,w,D._extensions,D._noMipmap,D._files);return N=F.uniqueId,F}),this);return F.uniqueId=N,F},Object(Z.c)([Object(Ie.c)("rotationY")],t.prototype,"rotationY",null),Object(Z.c)([Object(Ie.c)("files")],t.prototype,"_files",void 0),Object(Z.c)([Object(Ie.c)("forcedExtension")],t.prototype,"_forcedExtension",void 0),Object(Z.c)([Object(Ie.c)("extensions")],t.prototype,"_extensions",void 0),Object(Z.c)([Object(Ie.j)("textureMatrix")],t.prototype,"_textureMatrix",void 0),t}(Nr.a);Jt.a._CubeTextureParser=Vo.Parse,H.a.RegisteredTypes["BABYLON.CubeTexture"]=Vo;var jo=N(16),zo=N(73),Yo=N(81),Ho=N(21);li.a.IncludesShadersStore.backgroundFragmentDeclaration=" uniform vec4 vPrimaryColor;\n#ifdef USEHIGHLIGHTANDSHADOWCOLORS\nuniform vec4 vPrimaryColorShadow;\n#endif\nuniform float shadowLevel;\nuniform float alpha;\n#ifdef DIFFUSE\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\nuniform mat4 reflectionMatrix;\nuniform vec3 vReflectionMicrosurfaceInfos;\n#endif\n#if defined(REFLECTIONFRESNEL) || defined(OPACITYFRESNEL)\nuniform vec3 vBackgroundCenter;\n#endif\n#ifdef REFLECTIONFRESNEL\nuniform vec4 vReflectionControl;\n#endif\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)\nuniform mat4 view;\n#endif",li.a.IncludesShadersStore.backgroundUboDeclaration="layout(std140,column_major) uniform;\nuniform Material\n{\nuniform vec4 vPrimaryColor;\nuniform vec4 vPrimaryColorShadow;\nuniform vec2 vDiffuseInfos;\nuniform vec2 vReflectionInfos;\nuniform mat4 diffuseMatrix;\nuniform mat4 reflectionMatrix;\nuniform vec3 vReflectionMicrosurfaceInfos;\nuniform float fFovMultiplier;\nuniform float pointSize;\nuniform float shadowLevel;\nuniform float alpha;\n#if defined(REFLECTIONFRESNEL) || defined(OPACITYFRESNEL)\nuniform vec3 vBackgroundCenter;\n#endif\n#ifdef REFLECTIONFRESNEL\nuniform vec4 vReflectionControl;\n#endif\n};\nuniform Scene {\nmat4 viewProjection;\n#ifdef MULTIVIEW\nmat4 viewProjectionR;\n#endif\nmat4 view;\n};",N(118),N(97),N(98),N(139),N(117),N(106),N(113),N(101),N(121),N(122),li.a.ShadersStore.backgroundPixelShader="#ifdef TEXTURELODSUPPORT\n#extension GL_EXT_shader_texture_lod : enable\n#endif\nprecision highp float;\n#include<__decl__backgroundFragment>\n#define RECIPROCAL_PI2 0.15915494\n\nuniform vec3 vEyePosition;\n\nvarying vec3 vPositionW;\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif\n#ifdef MAINUV2\nvarying vec2 vMainUV2;\n#endif\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef DIFFUSE\n#if DIFFUSEDIRECTUV == 1\n#define vDiffuseUV vMainUV1\n#elif DIFFUSEDIRECTUV == 2\n#define vDiffuseUV vMainUV2\n#else\nvarying vec2 vDiffuseUV;\n#endif\nuniform sampler2D diffuseSampler;\n#endif\n\n#ifdef REFLECTION\n#ifdef REFLECTIONMAP_3D\n#define sampleReflection(s,c) textureCube(s,c)\nuniform samplerCube reflectionSampler;\n#ifdef TEXTURELODSUPPORT\n#define sampleReflectionLod(s,c,l) textureCubeLodEXT(s,c,l)\n#else\nuniform samplerCube reflectionSamplerLow;\nuniform samplerCube reflectionSamplerHigh;\n#endif\n#else\n#define sampleReflection(s,c) texture2D(s,c)\nuniform sampler2D reflectionSampler;\n#ifdef TEXTURELODSUPPORT\n#define sampleReflectionLod(s,c,l) texture2DLodEXT(s,c,l)\n#else\nuniform samplerCube reflectionSamplerLow;\nuniform samplerCube reflectionSamplerHigh;\n#endif\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#endif\n#include<reflectionFunction>\n#endif\n\n#ifndef FROMLINEARSPACE\n#define FROMLINEARSPACE;\n#endif\n\n#ifndef SHADOWONLY\n#define SHADOWONLY;\n#endif\n#include<imageProcessingDeclaration>\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<helperFunctions>\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n#include<imageProcessingFunctions>\n#include<clipPlaneFragmentDeclaration>\n\n#include<fogFragmentDeclaration>\n#ifdef REFLECTIONFRESNEL\n#define FRESNEL_MAXIMUM_ON_ROUGH 0.25\nvec3 fresnelSchlickEnvironmentGGX(float VdotN,vec3 reflectance0,vec3 reflectance90,float smoothness)\n{\n\nfloat weight=mix(FRESNEL_MAXIMUM_ON_ROUGH,1.0,smoothness);\nreturn reflectance0+weight*(reflectance90-reflectance0)*pow5(saturate(1.0-VdotN));\n}\n#endif\nvoid main(void) {\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(0.0,1.0,0.0);\n#endif\n\nfloat shadow=1.;\nfloat globalShadow=0.;\nfloat shadowLightCount=0.;\n#include<lightFragment>[0..maxSimultaneousLights]\n#ifdef SHADOWINUSE\nglobalShadow/=shadowLightCount;\n#else\nglobalShadow=1.0;\n#endif\n\nvec4 reflectionColor=vec4(1.,1.,1.,1.);\n#ifdef REFLECTION\nvec3 reflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#ifdef REFLECTIONMAP_OPPOSITEZ\nreflectionVector.z*=-1.0;\n#endif\n\n#ifdef REFLECTIONMAP_3D\nvec3 reflectionCoords=reflectionVector;\n#else\nvec2 reflectionCoords=reflectionVector.xy;\n#ifdef REFLECTIONMAP_PROJECTION\nreflectionCoords/=reflectionVector.z;\n#endif\nreflectionCoords.y=1.0-reflectionCoords.y;\n#endif\n#ifdef REFLECTIONBLUR\nfloat reflectionLOD=vReflectionInfos.y;\n#ifdef TEXTURELODSUPPORT\n\nreflectionLOD=reflectionLOD*log2(vReflectionMicrosurfaceInfos.x)*vReflectionMicrosurfaceInfos.y+vReflectionMicrosurfaceInfos.z;\nreflectionColor=sampleReflectionLod(reflectionSampler,reflectionCoords,reflectionLOD);\n#else\nfloat lodReflectionNormalized=saturate(reflectionLOD);\nfloat lodReflectionNormalizedDoubled=lodReflectionNormalized*2.0;\nvec4 reflectionSpecularMid=sampleReflection(reflectionSampler,reflectionCoords);\nif(lodReflectionNormalizedDoubled<1.0){\nreflectionColor=mix(\nsampleReflection(reflectionSamplerHigh,reflectionCoords),\nreflectionSpecularMid,\nlodReflectionNormalizedDoubled\n);\n} else {\nreflectionColor=mix(\nreflectionSpecularMid,\nsampleReflection(reflectionSamplerLow,reflectionCoords),\nlodReflectionNormalizedDoubled-1.0\n);\n}\n#endif\n#else\nvec4 reflectionSample=sampleReflection(reflectionSampler,reflectionCoords);\nreflectionColor=reflectionSample;\n#endif\n#ifdef RGBDREFLECTION\nreflectionColor.rgb=fromRGBD(reflectionColor);\n#endif\n#ifdef GAMMAREFLECTION\nreflectionColor.rgb=toLinearSpace(reflectionColor.rgb);\n#endif\n#ifdef REFLECTIONBGR\nreflectionColor.rgb=reflectionColor.bgr;\n#endif\n\nreflectionColor.rgb*=vReflectionInfos.x;\n#endif\n\nvec3 diffuseColor=vec3(1.,1.,1.);\nfloat finalAlpha=alpha;\n#ifdef DIFFUSE\nvec4 diffuseMap=texture2D(diffuseSampler,vDiffuseUV);\n#ifdef GAMMADIFFUSE\ndiffuseMap.rgb=toLinearSpace(diffuseMap.rgb);\n#endif\n\ndiffuseMap.rgb*=vDiffuseInfos.y;\n#ifdef DIFFUSEHASALPHA\nfinalAlpha*=diffuseMap.a;\n#endif\ndiffuseColor=diffuseMap.rgb;\n#endif\n\n#ifdef REFLECTIONFRESNEL\nvec3 colorBase=diffuseColor;\n#else\nvec3 colorBase=reflectionColor.rgb*diffuseColor;\n#endif\ncolorBase=max(colorBase,0.0);\n\n#ifdef USERGBCOLOR\nvec3 finalColor=colorBase;\n#else\n#ifdef USEHIGHLIGHTANDSHADOWCOLORS\nvec3 mainColor=mix(vPrimaryColorShadow.rgb,vPrimaryColor.rgb,colorBase);\n#else\nvec3 mainColor=vPrimaryColor.rgb;\n#endif\nvec3 finalColor=colorBase*mainColor;\n#endif\n\n#ifdef REFLECTIONFRESNEL\nvec3 reflectionAmount=vReflectionControl.xxx;\nvec3 reflectionReflectance0=vReflectionControl.yyy;\nvec3 reflectionReflectance90=vReflectionControl.zzz;\nfloat VdotN=dot(normalize(vEyePosition),normalW);\nvec3 planarReflectionFresnel=fresnelSchlickEnvironmentGGX(saturate(VdotN),reflectionReflectance0,reflectionReflectance90,1.0);\nreflectionAmount*=planarReflectionFresnel;\n#ifdef REFLECTIONFALLOFF\nfloat reflectionDistanceFalloff=1.0-saturate(length(vPositionW.xyz-vBackgroundCenter)*vReflectionControl.w);\nreflectionDistanceFalloff*=reflectionDistanceFalloff;\nreflectionAmount*=reflectionDistanceFalloff;\n#endif\nfinalColor=mix(finalColor,reflectionColor.rgb,saturate(reflectionAmount));\n#endif\n#ifdef OPACITYFRESNEL\nfloat viewAngleToFloor=dot(normalW,normalize(vEyePosition-vBackgroundCenter));\n\nconst float startAngle=0.1;\nfloat fadeFactor=saturate(viewAngleToFloor/startAngle);\nfinalAlpha*=fadeFactor*fadeFactor;\n#endif\n\n#ifdef SHADOWINUSE\nfinalColor=mix(finalColor*shadowLevel,finalColor,globalShadow);\n#endif\n\nvec4 color=vec4(finalColor,finalAlpha);\n#include<fogFragment>\n#ifdef IMAGEPROCESSINGPOSTPROCESS\n\n\ncolor.rgb=clamp(color.rgb,0.,30.0);\n#else\n\ncolor=applyImageProcessing(color);\n#endif\n#ifdef PREMULTIPLYALPHA\n\ncolor.rgb*=color.a;\n#endif\n#ifdef NOISE\ncolor.rgb+=dither(vPositionW.xy,0.5);\ncolor=max(color,0.0);\n#endif\ngl_FragColor=color;\n}\n",li.a.IncludesShadersStore.backgroundVertexDeclaration="uniform mat4 view;\nuniform mat4 viewProjection;\nuniform float shadowLevel;\n#ifdef DIFFUSE\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\nuniform mat4 reflectionMatrix;\nuniform vec3 vReflectionMicrosurfaceInfos;\nuniform float fFovMultiplier;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif",N(74),N(77),N(108),N(123),N(78),N(75),N(102),N(142),N(124),li.a.ShadersStore.backgroundVertexShader="precision highp float;\n#include<__decl__backgroundVertex>\n#include<helperFunctions>\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif\n#ifdef MAINUV2\nvarying vec2 vMainUV2;\n#endif\n#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0\nvarying vec2 vDiffuseUV;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\nvoid main(void) {\n#ifdef REFLECTIONMAP_SKYBOX\nvPositionUVW=position;\n#endif\n#include<instancesVertex>\n#include<bonesVertex>\n#ifdef MULTIVIEW\nif (gl_ViewID_OVR == 0u) {\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\n} else {\ngl_Position=viewProjectionR*finalWorld*vec4(position,1.0);\n}\n#else\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\n#endif\nvec4 worldPos=finalWorld*vec4(position,1.0);\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nmat3 normalWorld=mat3(finalWorld);\n#ifdef NONUNIFORMSCALING\nnormalWorld=transposeMat3(inverseMat3(normalWorld));\n#endif\nvNormalW=normalize(normalWorld*normal);\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvDirectionW=normalize(vec3(finalWorld*vec4(position,0.0)));\n#ifdef EQUIRECTANGULAR_RELFECTION_FOV\nmat3 screenToWorld=inverseMat3(mat3(finalWorld*viewProjection));\nvec3 segment=mix(vDirectionW,screenToWorld*vec3(0.0,0.0,1.0),abs(fFovMultiplier-1.0));\nif (fFovMultiplier<=1.0) {\nvDirectionW=normalize(segment);\n} else {\nvDirectionW=normalize(vDirectionW+(vDirectionW-segment));\n}\n#endif\n#endif\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef MAINUV1\nvMainUV1=uv;\n#endif\n#ifdef MAINUV2\nvMainUV2=uv2;\n#endif\n#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0\nif (vDiffuseInfos.x == 0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n}\n";var Wo=N(64),Xo=function(D){function t(){var w=D.call(this)||this;return w.DIFFUSE=!1,w.DIFFUSEDIRECTUV=0,w.GAMMADIFFUSE=!1,w.DIFFUSEHASALPHA=!1,w.OPACITYFRESNEL=!1,w.REFLECTIONBLUR=!1,w.REFLECTIONFRESNEL=!1,w.REFLECTIONFALLOFF=!1,w.TEXTURELODSUPPORT=!1,w.PREMULTIPLYALPHA=!1,w.USERGBCOLOR=!1,w.USEHIGHLIGHTANDSHADOWCOLORS=!1,w.NOISE=!1,w.REFLECTIONBGR=!1,w.IMAGEPROCESSING=!1,w.VIGNETTE=!1,w.VIGNETTEBLENDMODEMULTIPLY=!1,w.VIGNETTEBLENDMODEOPAQUE=!1,w.TONEMAPPING=!1,w.TONEMAPPING_ACES=!1,w.CONTRAST=!1,w.COLORCURVES=!1,w.COLORGRADING=!1,w.COLORGRADING3D=!1,w.SAMPLER3DGREENDEPTH=!1,w.SAMPLER3DBGRMAP=!1,w.IMAGEPROCESSINGPOSTPROCESS=!1,w.EXPOSURE=!1,w.MULTIVIEW=!1,w.REFLECTION=!1,w.REFLECTIONMAP_3D=!1,w.REFLECTIONMAP_SPHERICAL=!1,w.REFLECTIONMAP_PLANAR=!1,w.REFLECTIONMAP_CUBIC=!1,w.REFLECTIONMAP_PROJECTION=!1,w.REFLECTIONMAP_SKYBOX=!1,w.REFLECTIONMAP_EXPLICIT=!1,w.REFLECTIONMAP_EQUIRECTANGULAR=!1,w.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,w.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,w.INVERTCUBICMAP=!1,w.REFLECTIONMAP_OPPOSITEZ=!1,w.LODINREFLECTIONALPHA=!1,w.GAMMAREFLECTION=!1,w.RGBDREFLECTION=!1,w.EQUIRECTANGULAR_RELFECTION_FOV=!1,w.MAINUV1=!1,w.MAINUV2=!1,w.UV1=!1,w.UV2=!1,w.CLIPPLANE=!1,w.CLIPPLANE2=!1,w.CLIPPLANE3=!1,w.CLIPPLANE4=!1,w.CLIPPLANE5=!1,w.CLIPPLANE6=!1,w.POINTSIZE=!1,w.FOG=!1,w.NORMAL=!1,w.NUM_BONE_INFLUENCERS=0,w.BonesPerMesh=0,w.INSTANCES=!1,w.SHADOWFLOAT=!1,w.rebuild(),w}return Object(Z.d)(t,D),t}(zo.a),Ko=function(D){function t(w,N){var F=D.call(this,w,N)||this;return F.primaryColor=G.a.White(),F._primaryColorShadowLevel=0,F._primaryColorHighlightLevel=0,F.reflectionTexture=null,F.reflectionBlur=0,F.diffuseTexture=null,F._shadowLights=null,F.shadowLights=null,F.shadowLevel=0,F.sceneCenter=z.e.Zero(),F.opacityFresnel=!0,F.reflectionFresnel=!1,F.reflectionFalloffDistance=0,F.reflectionAmount=1,F.reflectionReflectance0=.05,F.reflectionReflectance90=.5,F.useRGBColor=!0,F.enableNoise=!1,F._fovMultiplier=1,F.useEquirectangularFOV=!1,F._maxSimultaneousLights=4,F.maxSimultaneousLights=4,F._imageProcessingObserver=null,F.switchToBGR=!1,F._renderTargets=new ui.a(16),F._reflectionControls=z.f.Zero(),F._white=G.a.White(),F._primaryShadowColor=G.a.Black(),F._primaryHighlightColor=G.a.Black(),F._attachImageProcessingConfiguration(null),F.getRenderTargetTextures=function(){return F._renderTargets.reset(),F._diffuseTexture&&F._diffuseTexture.isRenderTarget&&F._renderTargets.push(F._diffuseTexture),F._reflectionTexture&&F._reflectionTexture.isRenderTarget&&F._renderTargets.push(F._reflectionTexture),F._renderTargets},F}return Object(Z.d)(t,D),Object.defineProperty(t.prototype,"_perceptualColor",{get:function(){return this.__perceptualColor},set:function(D){this.__perceptualColor=D,this._computePrimaryColorFromPerceptualColor(),this._markAllSubMeshesAsLightsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"primaryColorShadowLevel",{get:function(){return this._primaryColorShadowLevel},set:function(D){this._primaryColorShadowLevel=D,this._computePrimaryColors(),this._markAllSubMeshesAsLightsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"primaryColorHighlightLevel",{get:function(){return this._primaryColorHighlightLevel},set:function(D){this._primaryColorHighlightLevel=D,this._computePrimaryColors(),this._markAllSubMeshesAsLightsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"reflectionStandardFresnelWeight",{set:function(D){var w=D;w<.5?(w*=2,this.reflectionReflectance0=t.StandardReflectance0*w,this.reflectionReflectance90=t.StandardReflectance90*w):(w=2*w-1,this.reflectionReflectance0=t.StandardReflectance0+(1-t.StandardReflectance0)*w,this.reflectionReflectance90=t.StandardReflectance90+(1-t.StandardReflectance90)*w)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fovMultiplier",{get:function(){return this._fovMultiplier},set:function(D){isNaN(D)&&(D=1),this._fovMultiplier=Math.max(0,Math.min(2,D))},enumerable:!0,configurable:!0}),t.prototype._attachImageProcessingConfiguration=function(D){var w=this;D!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=D||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((function(){w._computePrimaryColorFromPerceptualColor(),w._markAllSubMeshesAsImageProcessingDirty()}))))},Object.defineProperty(t.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(D){this._attachImageProcessingConfiguration(D),this._markAllSubMeshesAsTexturesDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(D){this.imageProcessingConfiguration.colorCurvesEnabled=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(D){this.imageProcessingConfiguration.colorGradingEnabled=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraToneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(D){this._imageProcessingConfiguration.toneMappingEnabled=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraExposure",{get:function(){return this._imageProcessingConfiguration.exposure},set:function(D){this._imageProcessingConfiguration.exposure=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraContrast",{get:function(){return this._imageProcessingConfiguration.contrast},set:function(D){this._imageProcessingConfiguration.contrast=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorGradingTexture",{get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(D){this.imageProcessingConfiguration.colorGradingTexture=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorCurves",{get:function(){return this.imageProcessingConfiguration.colorCurves},set:function(D){this.imageProcessingConfiguration.colorCurves=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasRenderTargetTextures",{get:function(){return!(!this._diffuseTexture||!this._diffuseTexture.isRenderTarget)||!(!this._reflectionTexture||!this._reflectionTexture.isRenderTarget)},enumerable:!0,configurable:!0}),t.prototype.needAlphaTesting=function(){return!0},t.prototype.needAlphaBlending=function(){return this.alpha<0||null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha},t.prototype.isReadyForSubMesh=function(D,w,N){var F=this;if(void 0===N&&(N=!1),w.effect&&this.isFrozen&&w.effect._wasPreviouslyReady)return!0;w._materialDefines||(w._materialDefines=new Xo);var k=this.getScene(),j=w._materialDefines;if(!this.checkReadyOnEveryCall&&w.effect&&j._renderId===k.getRenderId())return!0;var z=k.getEngine();if(jo.a.PrepareDefinesForLights(k,D,j,!1,this._maxSimultaneousLights),j._needNormals=!0,jo.a.PrepareDefinesForMultiview(k,j),j._areTexturesDirty){if(j._needUVs=!1,k.texturesEnabled){if(k.getEngine().getCaps().textureLOD&&(j.TEXTURELODSUPPORT=!0),this._diffuseTexture&&Ho.a.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;jo.a.PrepareDefinesForMergedUV(this._diffuseTexture,j,"DIFFUSE"),j.DIFFUSEHASALPHA=this._diffuseTexture.hasAlpha,j.GAMMADIFFUSE=this._diffuseTexture.gammaSpace,j.OPACITYFRESNEL=this._opacityFresnel}else j.DIFFUSE=!1,j.DIFFUSEHASALPHA=!1,j.GAMMADIFFUSE=!1,j.OPACITYFRESNEL=!1;var G=this._reflectionTexture;if(G&&Ho.a.ReflectionTextureEnabled){if(!G.isReadyOrNotBlocking())return!1;switch(j.REFLECTION=!0,j.GAMMAREFLECTION=G.gammaSpace,j.RGBDREFLECTION=G.isRGBD,j.REFLECTIONBLUR=this._reflectionBlur>0,j.REFLECTIONMAP_OPPOSITEZ=this.getScene().useRightHandedSystem?!G.invertZ:G.invertZ,j.LODINREFLECTIONALPHA=G.lodLevelInAlpha,j.EQUIRECTANGULAR_RELFECTION_FOV=this.useEquirectangularFOV,j.REFLECTIONBGR=this.switchToBGR,G.coordinatesMode===Jt.a.INVCUBIC_MODE&&(j.INVERTCUBICMAP=!0),j.REFLECTIONMAP_3D=G.isCube,G.coordinatesMode){case Jt.a.EXPLICIT_MODE:j.REFLECTIONMAP_EXPLICIT=!0;break;case Jt.a.PLANAR_MODE:j.REFLECTIONMAP_PLANAR=!0;break;case Jt.a.PROJECTION_MODE:j.REFLECTIONMAP_PROJECTION=!0;break;case Jt.a.SKYBOX_MODE:j.REFLECTIONMAP_SKYBOX=!0;break;case Jt.a.SPHERICAL_MODE:j.REFLECTIONMAP_SPHERICAL=!0;break;case Jt.a.EQUIRECTANGULAR_MODE:j.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case Jt.a.FIXED_EQUIRECTANGULAR_MODE:j.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case Jt.a.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:j.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case Jt.a.CUBIC_MODE:case Jt.a.INVCUBIC_MODE:default:j.REFLECTIONMAP_CUBIC=!0}this.reflectionFresnel?(j.REFLECTIONFRESNEL=!0,j.REFLECTIONFALLOFF=this.reflectionFalloffDistance>0,this._reflectionControls.x=this.reflectionAmount,this._reflectionControls.y=this.reflectionReflectance0,this._reflectionControls.z=this.reflectionReflectance90,this._reflectionControls.w=1/this.reflectionFalloffDistance):(j.REFLECTIONFRESNEL=!1,j.REFLECTIONFALLOFF=!1)}else j.REFLECTION=!1,j.REFLECTIONFRESNEL=!1,j.REFLECTIONFALLOFF=!1,j.REFLECTIONBLUR=!1,j.REFLECTIONMAP_3D=!1,j.REFLECTIONMAP_SPHERICAL=!1,j.REFLECTIONMAP_PLANAR=!1,j.REFLECTIONMAP_CUBIC=!1,j.REFLECTIONMAP_PROJECTION=!1,j.REFLECTIONMAP_SKYBOX=!1,j.REFLECTIONMAP_EXPLICIT=!1,j.REFLECTIONMAP_EQUIRECTANGULAR=!1,j.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,j.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,j.INVERTCUBICMAP=!1,j.REFLECTIONMAP_OPPOSITEZ=!1,j.LODINREFLECTIONALPHA=!1,j.GAMMAREFLECTION=!1,j.RGBDREFLECTION=!1}j.PREMULTIPLYALPHA=this.alphaMode===ce.a.ALPHA_PREMULTIPLIED||this.alphaMode===ce.a.ALPHA_PREMULTIPLIED_PORTERDUFF,j.USERGBCOLOR=this._useRGBColor,j.NOISE=this._enableNoise}if(j._areLightsDirty&&(j.USEHIGHLIGHTANDSHADOWCOLORS=!this._useRGBColor&&(0!==this._primaryColorShadowLevel||0!==this._primaryColorHighlightLevel)),j._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(j)}if(jo.a.PrepareDefinesForMisc(D,k,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(D),j),jo.a.PrepareDefinesForFrameBoundValues(k,z,j,N),jo.a.PrepareDefinesForAttributes(D,j,!1,!0,!1)&&D&&(k.getEngine().getCaps().standardDerivatives||D.isVerticesDataPresent(Zi.b.NormalKind)||(D.createNormals(!0),oe.a.Warn("BackgroundMaterial: Normals have been created for the mesh: "+D.name))),j.isDirty){j.markAsProcessed(),k.resetCachedMaterial();var H=new Wo.a;j.FOG&&H.addFallback(0,"FOG"),j.POINTSIZE&&H.addFallback(1,"POINTSIZE"),j.MULTIVIEW&&H.addFallback(0,"MULTIVIEW"),jo.a.HandleFallbacksForShadows(j,H,this._maxSimultaneousLights);var X=[Zi.b.PositionKind];j.NORMAL&&X.push(Zi.b.NormalKind),j.UV1&&X.push(Zi.b.UVKind),j.UV2&&X.push(Zi.b.UV2Kind),jo.a.PrepareAttributesForBones(X,D,j,H),jo.a.PrepareAttributesForInstances(X,j);var q=["world","view","viewProjection","vEyePosition","vLightsType","vFogInfos","vFogColor","pointSize","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","mBones","vPrimaryColor","vPrimaryColorShadow","vReflectionInfos","reflectionMatrix","vReflectionMicrosurfaceInfos","fFovMultiplier","shadowLevel","alpha","vBackgroundCenter","vReflectionControl","vDiffuseInfos","diffuseMatrix"],Z=["diffuseSampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh"],J=["Material","Scene"];Yi.a&&(Yi.a.PrepareUniforms(q,j),Yi.a.PrepareSamplers(Z,j)),jo.a.PrepareUniformsAndSamplersList({uniformsNames:q,uniformBuffersNames:J,samplers:Z,defines:j,maxSimultaneousLights:this._maxSimultaneousLights});var $=j.toString();w.setEffect(k.getEngine().createEffect("background",{attributes:X,uniformsNames:q,uniformBuffersNames:J,samplers:Z,defines:$,fallbacks:H,onCompiled:function(D){F.onCompiled&&F.onCompiled(D),F.bindSceneUniformBuffer(D,k.getSceneUniformBuffer())},onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights}},z),j),this.buildUniformLayout()}return!(!w.effect||!w.effect.isReady()||(j._renderId=k.getRenderId(),w.effect._wasPreviouslyReady=!0,0))},t.prototype._computePrimaryColorFromPerceptualColor=function(){this.__perceptualColor&&(this._primaryColor.copyFrom(this.__perceptualColor),this._primaryColor.toLinearSpaceToRef(this._primaryColor),this._imageProcessingConfiguration&&this._primaryColor.scaleToRef(1/this._imageProcessingConfiguration.exposure,this._primaryColor),this._computePrimaryColors())},t.prototype._computePrimaryColors=function(){0===this._primaryColorShadowLevel&&0===this._primaryColorHighlightLevel||(this._primaryColor.scaleToRef(this._primaryColorShadowLevel,this._primaryShadowColor),this._primaryColor.subtractToRef(this._primaryShadowColor,this._primaryShadowColor),this._white.subtractToRef(this._primaryColor,this._primaryHighlightColor),this._primaryHighlightColor.scaleToRef(this._primaryColorHighlightLevel,this._primaryHighlightColor),this._primaryColor.addToRef(this._primaryHighlightColor,this._primaryHighlightColor))},t.prototype.buildUniformLayout=function(){this._uniformBuffer.addUniform("vPrimaryColor",4),this._uniformBuffer.addUniform("vPrimaryColorShadow",4),this._uniformBuffer.addUniform("vDiffuseInfos",2),this._uniformBuffer.addUniform("vReflectionInfos",2),this._uniformBuffer.addUniform("diffuseMatrix",16),this._uniformBuffer.addUniform("reflectionMatrix",16),this._uniformBuffer.addUniform("vReflectionMicrosurfaceInfos",3),this._uniformBuffer.addUniform("fFovMultiplier",1),this._uniformBuffer.addUniform("pointSize",1),this._uniformBuffer.addUniform("shadowLevel",1),this._uniformBuffer.addUniform("alpha",1),this._uniformBuffer.addUniform("vBackgroundCenter",3),this._uniformBuffer.addUniform("vReflectionControl",4),this._uniformBuffer.create()},t.prototype.unbind=function(){this._diffuseTexture&&this._diffuseTexture.isRenderTarget&&this._uniformBuffer.setTexture("diffuseSampler",null),this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._uniformBuffer.setTexture("reflectionSampler",null),D.prototype.unbind.call(this)},t.prototype.bindOnlyWorldMatrix=function(D){this._activeEffect.setMatrix("world",D)},t.prototype.bindForSubMesh=function(D,w,N){var F=this.getScene(),k=N._materialDefines;if(k){var j=N.effect;if(j){this._activeEffect=j,this.bindOnlyWorldMatrix(D),jo.a.BindBonesParameters(w,this._activeEffect);var z=this._mustRebind(F,j,w.visibility);if(z){this._uniformBuffer.bindToEffect(j,"Material"),this.bindViewProjection(j);var G=this._reflectionTexture;this._uniformBuffer.useUbo&&this.isFrozen&&this._uniformBuffer.isSync||(F.texturesEnabled&&(this._diffuseTexture&&Ho.a.DiffuseTextureEnabled&&(this._uniformBuffer.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),jo.a.BindTextureMatrix(this._diffuseTexture,this._uniformBuffer,"diffuse")),G&&Ho.a.ReflectionTextureEnabled&&(this._uniformBuffer.updateMatrix("reflectionMatrix",G.getReflectionTextureMatrix()),this._uniformBuffer.updateFloat2("vReflectionInfos",G.level,this._reflectionBlur),this._uniformBuffer.updateFloat3("vReflectionMicrosurfaceInfos",G.getSize().width,G.lodGenerationScale,G.lodGenerationOffset))),this.shadowLevel>0&&this._uniformBuffer.updateFloat("shadowLevel",this.shadowLevel),this._uniformBuffer.updateFloat("alpha",this.alpha),this.pointsCloud&&this._uniformBuffer.updateFloat("pointSize",this.pointSize),k.USEHIGHLIGHTANDSHADOWCOLORS?(this._uniformBuffer.updateColor4("vPrimaryColor",this._primaryHighlightColor,1),this._uniformBuffer.updateColor4("vPrimaryColorShadow",this._primaryShadowColor,1)):this._uniformBuffer.updateColor4("vPrimaryColor",this._primaryColor,1)),this._uniformBuffer.updateFloat("fFovMultiplier",this._fovMultiplier),F.texturesEnabled&&(this._diffuseTexture&&Ho.a.DiffuseTextureEnabled&&this._uniformBuffer.setTexture("diffuseSampler",this._diffuseTexture),G&&Ho.a.ReflectionTextureEnabled&&(k.REFLECTIONBLUR&&k.TEXTURELODSUPPORT?this._uniformBuffer.setTexture("reflectionSampler",G):k.REFLECTIONBLUR?(this._uniformBuffer.setTexture("reflectionSampler",G._lodTextureMid||G),this._uniformBuffer.setTexture("reflectionSamplerLow",G._lodTextureLow||G),this._uniformBuffer.setTexture("reflectionSamplerHigh",G._lodTextureHigh||G)):this._uniformBuffer.setTexture("reflectionSampler",G),k.REFLECTIONFRESNEL&&(this._uniformBuffer.updateFloat3("vBackgroundCenter",this.sceneCenter.x,this.sceneCenter.y,this.sceneCenter.z),this._uniformBuffer.updateFloat4("vReflectionControl",this._reflectionControls.x,this._reflectionControls.y,this._reflectionControls.z,this._reflectionControls.w)))),jo.a.BindClipPlane(this._activeEffect,F),jo.a.BindEyePosition(j,F)}!z&&this.isFrozen||(F.lightsEnabled&&jo.a.BindLights(F,w,this._activeEffect,k,this._maxSimultaneousLights,!1),this.bindView(j),jo.a.BindFogParameters(F,w,this._activeEffect,!0),this._imageProcessingConfiguration&&this._imageProcessingConfiguration.bind(this._activeEffect)),this._uniformBuffer.update(),this._afterBind(w,this._activeEffect)}}},t.prototype.hasTexture=function(w){return!!D.prototype.hasTexture.call(this,w)||this._reflectionTexture===w||this._diffuseTexture===w},t.prototype.dispose=function(w,N){void 0===w&&(w=!1),void 0===N&&(N=!1),N&&(this.diffuseTexture&&this.diffuseTexture.dispose(),this.reflectionTexture&&this.reflectionTexture.dispose()),this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),D.prototype.dispose.call(this,w)},t.prototype.clone=function(D){var w=this;return Ie.a.Clone((function(){return new t(D,w.getScene())}),this)},t.prototype.serialize=function(){var D=Ie.a.Serialize(this);return D.customType="BABYLON.BackgroundMaterial",D},t.prototype.getClassName=function(){return"BackgroundMaterial"},t.Parse=function(D,w,N){return Ie.a.Parse((function(){return new t(D.name,w)}),D,w,N)},t.StandardReflectance0=.05,t.StandardReflectance90=.5,Object(Z.c)([Object(Ie.e)()],t.prototype,"_primaryColor",void 0),Object(Z.c)([Object(Ie.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"primaryColor",void 0),Object(Z.c)([Object(Ie.e)()],t.prototype,"__perceptualColor",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"_primaryColorShadowLevel",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"_primaryColorHighlightLevel",void 0),Object(Z.c)([Object(Ie.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"primaryColorHighlightLevel",null),Object(Z.c)([Object(Ie.m)()],t.prototype,"_reflectionTexture",void 0),Object(Z.c)([Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionTexture",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"_reflectionBlur",void 0),Object(Z.c)([Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionBlur",void 0),Object(Z.c)([Object(Ie.m)()],t.prototype,"_diffuseTexture",void 0),Object(Z.c)([Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture",void 0),Object(Z.c)([Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"shadowLights",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"_shadowLevel",void 0),Object(Z.c)([Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"shadowLevel",void 0),Object(Z.c)([Object(Ie.o)()],t.prototype,"_sceneCenter",void 0),Object(Z.c)([Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"sceneCenter",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"_opacityFresnel",void 0),Object(Z.c)([Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"opacityFresnel",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"_reflectionFresnel",void 0),Object(Z.c)([Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionFresnel",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"_reflectionFalloffDistance",void 0),Object(Z.c)([Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionFalloffDistance",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"_reflectionAmount",void 0),Object(Z.c)([Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionAmount",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"_reflectionReflectance0",void 0),Object(Z.c)([Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionReflectance0",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"_reflectionReflectance90",void 0),Object(Z.c)([Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionReflectance90",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"_useRGBColor",void 0),Object(Z.c)([Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useRGBColor",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"_enableNoise",void 0),Object(Z.c)([Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"enableNoise",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"_maxSimultaneousLights",void 0),Object(Z.c)([Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"maxSimultaneousLights",void 0),Object(Z.c)([Object(Ie.i)()],t.prototype,"_imageProcessingConfiguration",void 0),t}(Yo.a);H.a.RegisteredTypes["BABYLON.BackgroundMaterial"]=Ko;var Qo=function(){function e(D,w){var N=this;this._errorHandler=function(D,w){N.onErrorObservable.notifyObservers({message:D,exception:w})},this._options=Object(Z.a)(Object(Z.a)({},e._getDefaultOptions()),D),this._scene=w,this.onErrorObservable=new j.c,this._setupBackground(),this._setupImageProcessing()}return e._getDefaultOptions=function(){return{createGround:!0,groundSize:15,groundTexture:this._groundTextureCDNUrl,groundColor:new G.a(.2,.2,.3).toLinearSpace().scale(3),groundOpacity:.9,enableGroundShadow:!0,groundShadowLevel:.5,enableGroundMirror:!1,groundMirrorSizeRatio:.3,groundMirrorBlurKernel:64,groundMirrorAmount:1,groundMirrorFresnelWeight:1,groundMirrorFallOffDistance:0,groundMirrorTextureType:ce.a.TEXTURETYPE_UNSIGNED_INT,groundYBias:1e-5,createSkybox:!0,skyboxSize:20,skyboxTexture:this._skyboxTextureCDNUrl,skyboxColor:new G.a(.2,.2,.3).toLinearSpace().scale(3),backgroundYRotation:0,sizeAuto:!0,rootPosition:z.e.Zero(),setupImageProcessing:!0,environmentTexture:this._environmentTextureCDNUrl,cameraExposure:.8,cameraContrast:1.2,toneMappingEnabled:!0}},Object.defineProperty(e.prototype,"rootMesh",{get:function(){return this._rootMesh},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skybox",{get:function(){return this._skybox},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skyboxTexture",{get:function(){return this._skyboxTexture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skyboxMaterial",{get:function(){return this._skyboxMaterial},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ground",{get:function(){return this._ground},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"groundTexture",{get:function(){return this._groundTexture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"groundMirror",{get:function(){return this._groundMirror},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"groundMirrorRenderList",{get:function(){return this._groundMirror?this._groundMirror.renderList:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"groundMaterial",{get:function(){return this._groundMaterial},enumerable:!0,configurable:!0}),e.prototype.updateOptions=function(D){var w=Object(Z.a)(Object(Z.a)({},this._options),D);this._ground&&!w.createGround&&(this._ground.dispose(),this._ground=null),this._groundMaterial&&!w.createGround&&(this._groundMaterial.dispose(),this._groundMaterial=null),this._groundTexture&&this._options.groundTexture!=w.groundTexture&&(this._groundTexture.dispose(),this._groundTexture=null),this._skybox&&!w.createSkybox&&(this._skybox.dispose(),this._skybox=null),this._skyboxMaterial&&!w.createSkybox&&(this._skyboxMaterial.dispose(),this._skyboxMaterial=null),this._skyboxTexture&&this._options.skyboxTexture!=w.skyboxTexture&&(this._skyboxTexture.dispose(),this._skyboxTexture=null),this._groundMirror&&!w.enableGroundMirror&&(this._groundMirror.dispose(),this._groundMirror=null),this._scene.environmentTexture&&this._options.environmentTexture!=w.environmentTexture&&this._scene.environmentTexture.dispose(),this._options=w,this._setupBackground(),this._setupImageProcessing()},e.prototype.setMainColor=function(D){this.groundMaterial&&(this.groundMaterial.primaryColor=D),this.skyboxMaterial&&(this.skyboxMaterial.primaryColor=D),this.groundMirror&&(this.groundMirror.clearColor=new G.b(D.r,D.g,D.b,1))},e.prototype._setupImageProcessing=function(){this._options.setupImageProcessing&&(this._scene.imageProcessingConfiguration.contrast=this._options.cameraContrast,this._scene.imageProcessingConfiguration.exposure=this._options.cameraExposure,this._scene.imageProcessingConfiguration.toneMappingEnabled=this._options.toneMappingEnabled,this._setupEnvironmentTexture())},e.prototype._setupEnvironmentTexture=function(){if(!this._scene.environmentTexture)if(this._options.environmentTexture instanceof Nr.a)this._scene.environmentTexture=this._options.environmentTexture;else{var D=Vo.CreateFromPrefilteredData(this._options.environmentTexture,this._scene);this._scene.environmentTexture=D}},e.prototype._setupBackground=function(){this._rootMesh||(this._rootMesh=new xt.a("BackgroundHelper",this._scene)),this._rootMesh.rotation.y=this._options.backgroundYRotation;var D=this._getSceneSize();this._options.createGround&&(this._setupGround(D),this._setupGroundMaterial(),this._setupGroundDiffuseTexture(),this._options.enableGroundMirror&&this._setupGroundMirrorTexture(D),this._setupMirrorInGroundMaterial()),this._options.createSkybox&&(this._setupSkybox(D),this._setupSkyboxMaterial(),this._setupSkyboxReflectionTexture()),this._rootMesh.position.x=D.rootPosition.x,this._rootMesh.position.z=D.rootPosition.z,this._rootMesh.position.y=D.rootPosition.y},e.prototype._getSceneSize=function(){var D=this,w=this._options.groundSize,N=this._options.skyboxSize,F=this._options.rootPosition;if(!this._scene.meshes||1===this._scene.meshes.length)return{groundSize:w,skyboxSize:N,rootPosition:F};var k=this._scene.getWorldExtends((function(w){return w!==D._ground&&w!==D._rootMesh&&w!==D._skybox})),j=k.max.subtract(k.min);if(this._options.sizeAuto){this._scene.activeCamera instanceof kn&&this._scene.activeCamera.upperRadiusLimit&&(N=w=2*this._scene.activeCamera.upperRadiusLimit);var z=j.length();z>w&&(N=w=2*z),w*=1.1,N*=1.5,(F=k.min.add(j.scale(.5))).y=k.min.y-this._options.groundYBias}return{groundSize:w,skyboxSize:N,rootPosition:F}},e.prototype._setupGround=function(D){var w=this;this._ground&&!this._ground.isDisposed()||(this._ground=xt.a.CreatePlane("BackgroundPlane",D.groundSize,this._scene),this._ground.rotation.x=Math.PI/2,this._ground.parent=this._rootMesh,this._ground.onDisposeObservable.add((function(){w._ground=null}))),this._ground.receiveShadows=this._options.enableGroundShadow},e.prototype._setupGroundMaterial=function(){this._groundMaterial||(this._groundMaterial=new Ko("BackgroundPlaneMaterial",this._scene)),this._groundMaterial.alpha=this._options.groundOpacity,this._groundMaterial.alphaMode=ce.a.ALPHA_PREMULTIPLIED_PORTERDUFF,this._groundMaterial.shadowLevel=this._options.groundShadowLevel,this._groundMaterial.primaryColor=this._options.groundColor,this._groundMaterial.useRGBColor=!1,this._groundMaterial.enableNoise=!0,this._ground&&(this._ground.material=this._groundMaterial)},e.prototype._setupGroundDiffuseTexture=function(){if(this._groundMaterial&&!this._groundTexture)if(this._options.groundTexture instanceof Nr.a)this._groundMaterial.diffuseTexture=this._options.groundTexture;else{var D=new Jt.a(this._options.groundTexture,this._scene,void 0,void 0,void 0,void 0,this._errorHandler);D.gammaSpace=!1,D.hasAlpha=!0,this._groundMaterial.diffuseTexture=D}},e.prototype._setupGroundMirrorTexture=function(D){var w=Jt.a.CLAMP_ADDRESSMODE;if(!this._groundMirror&&(this._groundMirror=new Bo("BackgroundPlaneMirrorTexture",{ratio:this._options.groundMirrorSizeRatio},this._scene,!1,this._options.groundMirrorTextureType,Jt.a.BILINEAR_SAMPLINGMODE,!0),this._groundMirror.mirrorPlane=new hr.a(0,-1,0,D.rootPosition.y),this._groundMirror.anisotropicFilteringLevel=1,this._groundMirror.wrapU=w,this._groundMirror.wrapV=w,this._groundMirror.gammaSpace=!1,this._groundMirror.renderList))for(var N=0;N<this._scene.meshes.length;N++){var F=this._scene.meshes[N];F!==this._ground&&F!==this._skybox&&F!==this._rootMesh&&this._groundMirror.renderList.push(F)}this._groundMirror.clearColor=new G.b(this._options.groundColor.r,this._options.groundColor.g,this._options.groundColor.b,1),this._groundMirror.adaptiveBlurKernel=this._options.groundMirrorBlurKernel},e.prototype._setupMirrorInGroundMaterial=function(){this._groundMaterial&&(this._groundMaterial.reflectionTexture=this._groundMirror,this._groundMaterial.reflectionFresnel=!0,this._groundMaterial.reflectionAmount=this._options.groundMirrorAmount,this._groundMaterial.reflectionStandardFresnelWeight=this._options.groundMirrorFresnelWeight,this._groundMaterial.reflectionFalloffDistance=this._options.groundMirrorFallOffDistance)},e.prototype._setupSkybox=function(D){var w=this;this._skybox&&!this._skybox.isDisposed()||(this._skybox=xt.a.CreateBox("BackgroundSkybox",D.skyboxSize,this._scene,void 0,xt.a.BACKSIDE),this._skybox.onDisposeObservable.add((function(){w._skybox=null}))),this._skybox.parent=this._rootMesh},e.prototype._setupSkyboxMaterial=function(){this._skybox&&(this._skyboxMaterial||(this._skyboxMaterial=new Ko("BackgroundSkyboxMaterial",this._scene)),this._skyboxMaterial.useRGBColor=!1,this._skyboxMaterial.primaryColor=this._options.skyboxColor,this._skyboxMaterial.enableNoise=!0,this._skybox.material=this._skyboxMaterial)},e.prototype._setupSkyboxReflectionTexture=function(){this._skyboxMaterial&&(this._skyboxTexture||(this._options.skyboxTexture instanceof Nr.a?this._skyboxMaterial.reflectionTexture=this._options.skyboxTexture:(this._skyboxTexture=new Vo(this._options.skyboxTexture,this._scene,void 0,void 0,void 0,void 0,this._errorHandler),this._skyboxTexture.coordinatesMode=Jt.a.SKYBOX_MODE,this._skyboxTexture.gammaSpace=!1,this._skyboxMaterial.reflectionTexture=this._skyboxTexture)))},e.prototype.dispose=function(){this._groundMaterial&&this._groundMaterial.dispose(!0,!0),this._skyboxMaterial&&this._skyboxMaterial.dispose(!0,!0),this._rootMesh.dispose(!1)},e._groundTextureCDNUrl="https://assets.babylonjs.com/environments/backgroundGround.png",e._skyboxTextureCDNUrl="https://assets.babylonjs.com/environments/backgroundSkybox.dds",e._environmentTextureCDNUrl="https://assets.babylonjs.com/environments/environmentSpecular.env",e}(),qo=function(D){function t(w,N,F,k,G){void 0===G&&(G=null);var H=D.call(this,w,k)||this;H._useDirectMapping=!1,H.onLoadErrorObservable=new j.c,H._imageMode=t.MODE_MONOSCOPIC,H._onBeforeCameraRenderObserver=null,w=w||"photoDome",F.resolution=0|Math.abs(F.resolution)||32,F.size=Math.abs(F.size)||(k.activeCamera?.48*k.activeCamera.maxZ:1e3),void 0===F.useDirectMapping?H._useDirectMapping=!0:H._useDirectMapping=F.useDirectMapping,void 0===F.faceForward&&(F.faceForward=!0),H._setReady(!1);var X=H._material=new Ko(w+"_material",k);if(H._mesh=xt.a.CreateSphere(w+"_mesh",F.resolution,F.size,k,!1,xt.a.BACKSIDE),X.opacityFresnel=!1,X.useEquirectangularFOV=!0,X.fovMultiplier=1,H.photoTexture=new Jt.a(N,k,!0,!H._useDirectMapping,void 0,void 0,(function(D,w){H.onLoadErrorObservable.notifyObservers(D||"Unknown error occured"),G&&G(D,w)})),H.photoTexture.anisotropicFilteringLevel=1,H.photoTexture.onLoadObservable.addOnce((function(){H._setReady(!0)})),H._mesh.material=X,H._mesh.parent=H,F.faceForward&&k.activeCamera){var q=k.activeCamera,Z=z.e.Forward(),J=z.e.TransformNormal(Z,q.getViewMatrix());J.normalize(),H.rotation.y=Math.acos(z.e.Dot(Z,J))}return H}return Object(Z.d)(t,D),Object.defineProperty(t.prototype,"photoTexture",{get:function(){return this._photoTexture},set:function(D){this._photoTexture!==D&&(this._photoTexture=D,this._useDirectMapping?(this._photoTexture.wrapU=Jt.a.CLAMP_ADDRESSMODE,this._photoTexture.wrapV=Jt.a.CLAMP_ADDRESSMODE,this._material.diffuseTexture=this._photoTexture):(this._photoTexture.coordinatesMode=Jt.a.FIXED_EQUIRECTANGULAR_MIRRORED_MODE,this._photoTexture.wrapV=Jt.a.CLAMP_ADDRESSMODE,this._material.reflectionTexture=this._photoTexture))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mesh",{get:function(){return this._mesh},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fovMultiplier",{get:function(){return this._material.fovMultiplier},set:function(D){this._material.fovMultiplier=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageMode",{get:function(){return this._imageMode},set:function(D){this._imageMode!==D&&this._changeImageMode(D)},enumerable:!0,configurable:!0}),t.prototype._changeImageMode=function(D){var w=this;switch(this._scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._imageMode=D,this._photoTexture.uScale=1,this._photoTexture.vScale=1,this._photoTexture.uOffset=0,this._photoTexture.vOffset=0,D){case t.MODE_SIDEBYSIDE:this._photoTexture.uScale=.5,this._onBeforeCameraRenderObserver=this._scene.onBeforeCameraRenderObservable.add((function(D){w._photoTexture.uOffset=D.isRightCamera?.5:0}));break;case t.MODE_TOPBOTTOM:this._photoTexture.vScale=.5,this._onBeforeCameraRenderObserver=this._scene.onBeforeCameraRenderObservable.add((function(D){w._photoTexture.vOffset=D.isRightCamera?.5:0}))}},t.prototype.dispose=function(w,N){void 0===N&&(N=!1),this._photoTexture.dispose(),this._mesh.dispose(),this._material.dispose(),this.onLoadErrorObservable.clear(),this._scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),D.prototype.dispose.call(this,w,N)},t.MODE_MONOSCOPIC=0,t.MODE_TOPBOTTOM=1,t.MODE_SIDEBYSIDE=2,t}(So.a),Zo=function(){function e(){}return e.ExpandRGBDTexture=function(D){var w=D._texture;if(w&&D.isRGBD){var N=w.getEngine(),F=N.getCaps(),k=!1;F.textureHalfFloatRender&&F.textureHalfFloatLinearFiltering?(k=!0,w.type=ce.a.TEXTURETYPE_HALF_FLOAT):F.textureFloatRender&&F.textureFloatLinearFiltering&&(k=!0,w.type=ce.a.TEXTURETYPE_FLOAT),k&&(w.isReady=!1,w._isRGBD=!1,w.invertY=!1),D.onLoadObservable.addOnce((function(){if(k){var F=new fi("rgbdDecode","rgbdDecode",null,null,1,null,ce.a.TEXTURE_TRILINEAR_SAMPLINGMODE,N,!1,void 0,w.type,void 0,null,!1),j=N.createRenderTargetTexture(w.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:w.samplingMode,type:w.type,format:ce.a.TEXTUREFORMAT_RGBA});F.getEffect().executeWhenCompiled((function(){F.onApply=function(D){D._bindTexture("textureSampler",w),D.setFloat2("scale",1,1)},D.getScene().postProcessManager.directRender([F],j,!0),N.restoreDefaultFramebuffer(),N._releaseTexture(w),N._releaseFramebufferObjects(j),F&&F.dispose(),j._swapAndDie(w),w.isReady=!0}))}}))}},e}(),Jo=function(){function e(){}return e.GetEnvironmentBRDFTexture=function(D){if(!D.environmentBRDFTexture){var w=D.useDelayedTextureLoading;D.useDelayedTextureLoading=!1;var N=D._blockEntityCollection;D._blockEntityCollection=!1;var F=Jt.a.CreateFromBase64String(this._environmentBRDFBase64Texture,"EnvironmentBRDFTexture",D,!0,!1,Jt.a.BILINEAR_SAMPLINGMODE);D._blockEntityCollection=N;var k=D.getEngine().getLoadedTexturesCache(),j=k.indexOf(F.getInternalTexture());-1!==j&&k.splice(j,1),F.isRGBD=!0,F.wrapU=Jt.a.CLAMP_ADDRESSMODE,F.wrapV=Jt.a.CLAMP_ADDRESSMODE,D.environmentBRDFTexture=F,D.useDelayedTextureLoading=w,Zo.ExpandRGBDTexture(F)}return D.environmentBRDFTexture},e._environmentBRDFBase64Texture="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==",e}(),$o=function(){function e(D){this._isEnabled=!1,this.isEnabled=!1,this.intensity=1,this.roughness=0,this._indexOfRefraction=e._DefaultIndexOfRefraction,this.indexOfRefraction=e._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=G.a.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=D}return e.prototype._markAllSubMeshesAsTexturesDirty=function(){this._internalMarkAllSubMeshesAsTexturesDirty()},e.prototype.isReadyForSubMesh=function(D,w,N,F){if(D._areTexturesDirty&&w.texturesEnabled){if(this._texture&&Ho.a.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(N.getCaps().standardDerivatives&&this._bumpTexture&&Ho.a.ClearCoatBumpTextureEnabled&&!F&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&Ho.a.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0},e.prototype.prepareDefines=function(D,w){this._isEnabled?(D.CLEARCOAT=!0,D._areTexturesDirty&&w.texturesEnabled&&(this._texture&&Ho.a.ClearCoatTextureEnabled?jo.a.PrepareDefinesForMergedUV(this._texture,D,"CLEARCOAT_TEXTURE"):D.CLEARCOAT_TEXTURE=!1,this._bumpTexture&&Ho.a.ClearCoatBumpTextureEnabled?jo.a.PrepareDefinesForMergedUV(this._bumpTexture,D,"CLEARCOAT_BUMP"):D.CLEARCOAT_BUMP=!1,D.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===e._DefaultIndexOfRefraction,this._isTintEnabled?(D.CLEARCOAT_TINT=!0,this._tintTexture&&Ho.a.ClearCoatTintTextureEnabled?jo.a.PrepareDefinesForMergedUV(this._tintTexture,D,"CLEARCOAT_TINT_TEXTURE"):D.CLEARCOAT_TINT_TEXTURE=!1):(D.CLEARCOAT_TINT=!1,D.CLEARCOAT_TINT_TEXTURE=!1))):(D.CLEARCOAT=!1,D.CLEARCOAT_TEXTURE=!1,D.CLEARCOAT_BUMP=!1,D.CLEARCOAT_TINT=!1,D.CLEARCOAT_TINT_TEXTURE=!1)},e.prototype.bindForSubMesh=function(D,w,N,F,k,j,z){if(!D.useUbo||!k||!D.isSync){this._texture&&Ho.a.ClearCoatTextureEnabled&&(D.updateFloat2("vClearCoatInfos",this._texture.coordinatesIndex,this._texture.level),jo.a.BindTextureMatrix(this._texture,D,"clearCoat")),this._bumpTexture&&N.getCaps().standardDerivatives&&Ho.a.ClearCoatTextureEnabled&&!F&&(D.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),jo.a.BindTextureMatrix(this._bumpTexture,D,"clearCoatBump"),w._mirroredCameraPosition?D.updateFloat2("vClearCoatTangentSpaceParams",j?1:-1,z?1:-1):D.updateFloat2("vClearCoatTangentSpaceParams",j?-1:1,z?-1:1)),this._tintTexture&&Ho.a.ClearCoatTintTextureEnabled&&(D.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),jo.a.BindTextureMatrix(this._tintTexture,D,"clearCoatTint")),D.updateFloat2("vClearCoatParams",this.intensity,this.roughness);var G=1-this._indexOfRefraction,H=1+this._indexOfRefraction,X=Math.pow(-G/H,2),q=1/this._indexOfRefraction;D.updateFloat4("vClearCoatRefractionParams",X,q,G,H),this._isTintEnabled&&(D.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),D.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}w.texturesEnabled&&(this._texture&&Ho.a.ClearCoatTextureEnabled&&D.setTexture("clearCoatSampler",this._texture),this._bumpTexture&&N.getCaps().standardDerivatives&&Ho.a.ClearCoatBumpTextureEnabled&&!F&&D.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&Ho.a.ClearCoatTintTextureEnabled&&D.setTexture("clearCoatTintSampler",this._tintTexture))},e.prototype.hasTexture=function(D){return this._texture===D||this._bumpTexture===D||this._tintTexture===D},e.prototype.getActiveTextures=function(D){this._texture&&D.push(this._texture),this._bumpTexture&&D.push(this._bumpTexture),this._tintTexture&&D.push(this._tintTexture)},e.prototype.getAnimatables=function(D){this._texture&&this._texture.animations&&this._texture.animations.length>0&&D.push(this._texture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&D.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&D.push(this._tintTexture)},e.prototype.dispose=function(D){D&&(this._texture&&this._texture.dispose(),this._bumpTexture&&this._bumpTexture.dispose(),this._tintTexture&&this._tintTexture.dispose())},e.prototype.getClassName=function(){return"PBRClearCoatConfiguration"},e.AddFallbacks=function(D,w,N){return D.CLEARCOAT_BUMP&&w.addFallback(N++,"CLEARCOAT_BUMP"),D.CLEARCOAT_TINT&&w.addFallback(N++,"CLEARCOAT_TINT"),D.CLEARCOAT&&w.addFallback(N++,"CLEARCOAT"),N},e.AddUniforms=function(D){D.push("vClearCoatTangentSpaceParams","vClearCoatParams","vClearCoatRefractionParams","vClearCoatTintParams","clearCoatColorAtDistance","clearCoatMatrix","clearCoatBumpMatrix","clearCoatTintMatrix","vClearCoatInfos","vClearCoatBumpInfos","vClearCoatTintInfos")},e.AddSamplers=function(D){D.push("clearCoatSampler","clearCoatBumpSampler","clearCoatTintSampler")},e.PrepareUniformBuffer=function(D){D.addUniform("vClearCoatParams",2),D.addUniform("vClearCoatRefractionParams",4),D.addUniform("vClearCoatInfos",2),D.addUniform("clearCoatMatrix",16),D.addUniform("vClearCoatBumpInfos",2),D.addUniform("vClearCoatTangentSpaceParams",2),D.addUniform("clearCoatBumpMatrix",16),D.addUniform("vClearCoatTintParams",4),D.addUniform("clearCoatColorAtDistance",1),D.addUniform("vClearCoatTintInfos",2),D.addUniform("clearCoatTintMatrix",16)},e.prototype.copyTo=function(D){Ie.a.Clone((function(){return D}),this)},e.prototype.serialize=function(){return Ie.a.Serialize(this)},e.prototype.parse=function(D,w,N){var F=this;Ie.a.Parse((function(){return F}),D,w,N)},e._DefaultIndexOfRefraction=1.5,Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"isEnabled",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"intensity",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"roughness",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"indexOfRefraction",void 0),Object(Z.c)([Object(Ie.m)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"texture",void 0),Object(Z.c)([Object(Ie.m)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"bumpTexture",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"isTintEnabled",void 0),Object(Z.c)([Object(Ie.e)()],e.prototype,"tintColor",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"tintColorAtDistance",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"tintThickness",void 0),Object(Z.c)([Object(Ie.m)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"tintTexture",void 0),e}(),ra=function(){function e(D){this._isEnabled=!1,this.isEnabled=!1,this.intensity=1,this.direction=new z.d(1,0),this._texture=null,this.texture=null,this._internalMarkAllSubMeshesAsTexturesDirty=D}return e.prototype._markAllSubMeshesAsTexturesDirty=function(){this._internalMarkAllSubMeshesAsTexturesDirty()},e.prototype.isReadyForSubMesh=function(D,w){return!(D._areTexturesDirty&&w.texturesEnabled&&this._texture&&Ho.a.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())},e.prototype.prepareDefines=function(D,w,N){this._isEnabled?(D.ANISOTROPIC=this._isEnabled,this._isEnabled&&!w.isVerticesDataPresent(Zi.b.TangentKind)&&(D._needUVs=!0,D.MAINUV1=!0),D._areTexturesDirty&&N.texturesEnabled&&(this._texture&&Ho.a.AnisotropicTextureEnabled?jo.a.PrepareDefinesForMergedUV(this._texture,D,"ANISOTROPIC_TEXTURE"):D.ANISOTROPIC_TEXTURE=!1)):(D.ANISOTROPIC=!1,D.ANISOTROPIC_TEXTURE=!1)},e.prototype.bindForSubMesh=function(D,w,N){D.useUbo&&N&&D.isSync||(this._texture&&Ho.a.AnisotropicTextureEnabled&&(D.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),jo.a.BindTextureMatrix(this._texture,D,"anisotropy")),D.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.intensity)),w.texturesEnabled&&this._texture&&Ho.a.AnisotropicTextureEnabled&&D.setTexture("anisotropySampler",this._texture)},e.prototype.hasTexture=function(D){return this._texture===D},e.prototype.getActiveTextures=function(D){this._texture&&D.push(this._texture)},e.prototype.getAnimatables=function(D){this._texture&&this._texture.animations&&this._texture.animations.length>0&&D.push(this._texture)},e.prototype.dispose=function(D){D&&this._texture&&this._texture.dispose()},e.prototype.getClassName=function(){return"PBRAnisotropicConfiguration"},e.AddFallbacks=function(D,w,N){return D.ANISOTROPIC&&w.addFallback(N++,"ANISOTROPIC"),N},e.AddUniforms=function(D){D.push("vAnisotropy","vAnisotropyInfos","anisotropyMatrix")},e.PrepareUniformBuffer=function(D){D.addUniform("vAnisotropy",3),D.addUniform("vAnisotropyInfos",2),D.addUniform("anisotropyMatrix",16)},e.AddSamplers=function(D){D.push("anisotropySampler")},e.prototype.copyTo=function(D){Ie.a.Clone((function(){return D}),this)},e.prototype.serialize=function(){return Ie.a.Serialize(this)},e.prototype.parse=function(D,w,N){var F=this;Ie.a.Parse((function(){return F}),D,w,N)},Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"isEnabled",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"intensity",void 0),Object(Z.c)([Object(Ie.n)()],e.prototype,"direction",void 0),Object(Z.c)([Object(Ie.m)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"texture",void 0),e}(),aa=function(){function e(D){this._useEnergyConservation=e.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=e.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=e.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=e.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=e.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=e.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=e.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=e.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._internalMarkAllSubMeshesAsMiscDirty=D}return e.prototype._markAllSubMeshesAsMiscDirty=function(){this._internalMarkAllSubMeshesAsMiscDirty()},e.prototype.prepareDefines=function(D){D.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,D.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,D.SPHERICAL_HARMONICS=this._useSphericalHarmonics,D.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation},e.prototype.getClassName=function(){return"PBRBRDFConfiguration"},e.prototype.copyTo=function(D){Ie.a.Clone((function(){return D}),this)},e.prototype.serialize=function(){return Ie.a.Serialize(this)},e.prototype.parse=function(D,w,N){var F=this;Ie.a.Parse((function(){return F}),D,w,N)},e.DEFAULT_USE_ENERGY_CONSERVATION=!0,e.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,e.DEFAULT_USE_SPHERICAL_HARMONICS=!0,e.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsMiscDirty")],e.prototype,"useEnergyConservation",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsMiscDirty")],e.prototype,"useSmithVisibilityHeightCorrelated",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsMiscDirty")],e.prototype,"useSphericalHarmonics",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsMiscDirty")],e.prototype,"useSpecularGlossinessInputEnergyConservation",void 0),e}(),la=function(){function e(D){this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.intensity=1,this.color=G.a.White(),this._texture=null,this.texture=null,this._internalMarkAllSubMeshesAsTexturesDirty=D}return e.prototype._markAllSubMeshesAsTexturesDirty=function(){this._internalMarkAllSubMeshesAsTexturesDirty()},e.prototype.isReadyForSubMesh=function(D,w){return!(D._areTexturesDirty&&w.texturesEnabled&&this._texture&&Ho.a.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())},e.prototype.prepareDefines=function(D,w){this._isEnabled?(D.SHEEN=this._isEnabled,D.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,D._areTexturesDirty&&w.texturesEnabled&&(this._texture&&Ho.a.SheenTextureEnabled?jo.a.PrepareDefinesForMergedUV(this._texture,D,"SHEEN_TEXTURE"):D.SHEEN_TEXTURE=!1)):(D.SHEEN=!1,D.SHEEN_TEXTURE=!1,D.SHEEN_LINKWITHALBEDO=!1)},e.prototype.bindForSubMesh=function(D,w,N){D.useUbo&&N&&D.isSync||(this._texture&&Ho.a.SheenTextureEnabled&&(D.updateFloat2("vSheenInfos",this._texture.coordinatesIndex,this._texture.level),jo.a.BindTextureMatrix(this._texture,D,"sheen")),D.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.intensity)),w.texturesEnabled&&this._texture&&Ho.a.SheenTextureEnabled&&D.setTexture("sheenSampler",this._texture)},e.prototype.hasTexture=function(D){return this._texture===D},e.prototype.getActiveTextures=function(D){this._texture&&D.push(this._texture)},e.prototype.getAnimatables=function(D){this._texture&&this._texture.animations&&this._texture.animations.length>0&&D.push(this._texture)},e.prototype.dispose=function(D){D&&this._texture&&this._texture.dispose()},e.prototype.getClassName=function(){return"PBRSheenConfiguration"},e.AddFallbacks=function(D,w,N){return D.SHEEN&&w.addFallback(N++,"SHEEN"),N},e.AddUniforms=function(D){D.push("vSheenColor","vSheenInfos","sheenMatrix")},e.PrepareUniformBuffer=function(D){D.addUniform("vSheenColor",4),D.addUniform("vSheenInfos",2),D.addUniform("sheenMatrix",16)},e.AddSamplers=function(D){D.push("sheenSampler")},e.prototype.copyTo=function(D){Ie.a.Clone((function(){return D}),this)},e.prototype.serialize=function(){return Ie.a.Serialize(this)},e.prototype.parse=function(D,w,N){var F=this;Ie.a.Parse((function(){return F}),D,w,N)},Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"isEnabled",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"linkSheenWithAlbedo",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"intensity",void 0),Object(Z.c)([Object(Ie.e)()],e.prototype,"color",void 0),Object(Z.c)([Object(Ie.m)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"texture",void 0),e}(),ha=function(){function e(D){this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isScatteringEnabled=!1,this.refractionIntensity=1,this.translucencyIntensity=1,this.scatteringIntensity=1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1,this.indexOfRefraction=1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.tintColor=G.a.White(),this.tintColorAtDistance=1,this.diffusionDistance=G.a.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._internalMarkAllSubMeshesAsTexturesDirty=D}return e.prototype._markAllSubMeshesAsTexturesDirty=function(){this._internalMarkAllSubMeshesAsTexturesDirty()},e.prototype.isReadyForSubMesh=function(D,w){if(D._areTexturesDirty&&w.texturesEnabled){if(this._thicknessTexture&&Ho.a.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;var N=this._getRefractionTexture(w);if(N&&Ho.a.RefractionTextureEnabled&&!N.isReadyOrNotBlocking())return!1}return!0},e.prototype.prepareDefines=function(D,w){if(D._areTexturesDirty&&(D.SUBSURFACE=!1,D.SS_TRANSLUCENCY=this._isTranslucencyEnabled,D.SS_SCATERRING=this._isScatteringEnabled,D.SS_THICKNESSANDMASK_TEXTURE=!1,D.SS_MASK_FROM_THICKNESS_TEXTURE=!1,D.SS_REFRACTION=!1,D.SS_REFRACTIONMAP_3D=!1,D.SS_GAMMAREFRACTION=!1,D.SS_RGBDREFRACTION=!1,D.SS_LINEARSPECULARREFRACTION=!1,D.SS_REFRACTIONMAP_OPPOSITEZ=!1,D.SS_LODINREFRACTIONALPHA=!1,D.SS_LINKREFRACTIONTOTRANSPARENCY=!1,(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)&&(D.SUBSURFACE=!0,D._areTexturesDirty&&w.texturesEnabled&&this._thicknessTexture&&Ho.a.ThicknessTextureEnabled&&jo.a.PrepareDefinesForMergedUV(this._thicknessTexture,D,"SS_THICKNESSANDMASK_TEXTURE"),D.SS_MASK_FROM_THICKNESS_TEXTURE=this._useMaskFromThicknessTexture),this._isRefractionEnabled&&w.texturesEnabled)){var N=this._getRefractionTexture(w);N&&Ho.a.RefractionTextureEnabled&&(D.SS_REFRACTION=!0,D.SS_REFRACTIONMAP_3D=N.isCube,D.SS_GAMMAREFRACTION=N.gammaSpace,D.SS_RGBDREFRACTION=N.isRGBD,D.SS_LINEARSPECULARREFRACTION=N.linearSpecularLOD,D.SS_REFRACTIONMAP_OPPOSITEZ=N.invertZ,D.SS_LODINREFRACTIONALPHA=N.lodLevelInAlpha,D.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency)}},e.prototype.bindForSubMesh=function(D,w,N,F,k){var j=this._getRefractionTexture(w);if(!D.useUbo||!F||!D.isSync){if(this._thicknessTexture&&Ho.a.ThicknessTextureEnabled&&(D.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),jo.a.BindTextureMatrix(this._thicknessTexture,D,"thickness")),D.updateFloat2("vThicknessParam",this.minimumThickness,this.maximumThickness-this.minimumThickness),j&&Ho.a.RefractionTextureEnabled){D.updateMatrix("refractionMatrix",j.getReflectionTextureMatrix());var z=1;j.isCube||j.depth&&(z=j.depth),D.updateFloat4("vRefractionInfos",j.level,1/this._indexOfRefraction,z,this._invertRefractionY?-1:1),D.updateFloat3("vRefractionMicrosurfaceInfos",j.getSize().width,j.lodGenerationScale,j.lodGenerationOffset)}D.updateColor3("vDiffusionDistance",this.diffusionDistance),D.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,this.tintColorAtDistance),D.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,this.scatteringIntensity)}w.texturesEnabled&&(this._thicknessTexture&&Ho.a.ThicknessTextureEnabled&&D.setTexture("thicknessSampler",this._thicknessTexture),j&&Ho.a.RefractionTextureEnabled&&(k?D.setTexture("refractionSampler",j):(D.setTexture("refractionSampler",j._lodTextureMid||j),D.setTexture("refractionSamplerLow",j._lodTextureLow||j),D.setTexture("refractionSamplerHigh",j._lodTextureHigh||j))))},e.prototype.unbind=function(D){return!(!this._refractionTexture||!this._refractionTexture.isRenderTarget||(D.setTexture("refractionSampler",null),0))},e.prototype._getRefractionTexture=function(D){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?D.environmentTexture:null},Object.defineProperty(e.prototype,"disableAlphaBlending",{get:function(){return this.isRefractionEnabled&&this._linkRefractionWithTransparency},enumerable:!0,configurable:!0}),e.prototype.fillRenderTargetTextures=function(D){Ho.a.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&D.push(this._refractionTexture)},e.prototype.hasTexture=function(D){return this._thicknessTexture===D||this._refractionTexture===D},e.prototype.hasRenderTargetTextures=function(){return!!(Ho.a.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)},e.prototype.getActiveTextures=function(D){this._thicknessTexture&&D.push(this._thicknessTexture),this._refractionTexture&&D.push(this._refractionTexture)},e.prototype.getAnimatables=function(D){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&D.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&D.push(this._refractionTexture)},e.prototype.dispose=function(D){D&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose())},e.prototype.getClassName=function(){return"PBRSubSurfaceConfiguration"},e.AddFallbacks=function(D,w,N){return D.SS_SCATERRING&&w.addFallback(N++,"SS_SCATERRING"),D.SS_TRANSLUCENCY&&w.addFallback(N++,"SS_TRANSLUCENCY"),N},e.AddUniforms=function(D){D.push("vDiffusionDistance","vTintColor","vSubSurfaceIntensity","vRefractionMicrosurfaceInfos","vRefractionInfos","vThicknessInfos","vThicknessParam","refractionMatrix","thicknessMatrix")},e.AddSamplers=function(D){D.push("thicknessSampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh")},e.PrepareUniformBuffer=function(D){D.addUniform("vRefractionMicrosurfaceInfos",3),D.addUniform("vRefractionInfos",4),D.addUniform("refractionMatrix",16),D.addUniform("vThicknessInfos",2),D.addUniform("thicknessMatrix",16),D.addUniform("vThicknessParam",2),D.addUniform("vDiffusionDistance",3),D.addUniform("vTintColor",4),D.addUniform("vSubSurfaceIntensity",3)},e.prototype.copyTo=function(D){Ie.a.Clone((function(){return D}),this)},e.prototype.serialize=function(){return Ie.a.Serialize(this)},e.prototype.parse=function(D,w,N){var F=this;Ie.a.Parse((function(){return F}),D,w,N)},Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"isRefractionEnabled",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"isTranslucencyEnabled",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"refractionIntensity",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"translucencyIntensity",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"scatteringIntensity",void 0),Object(Z.c)([Object(Ie.m)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"thicknessTexture",void 0),Object(Z.c)([Object(Ie.m)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"refractionTexture",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"indexOfRefraction",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"invertRefractionY",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"linkRefractionWithTransparency",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"minimumThickness",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"maximumThickness",void 0),Object(Z.c)([Object(Ie.e)()],e.prototype,"tintColor",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"tintColorAtDistance",void 0),Object(Z.c)([Object(Ie.e)()],e.prototype,"diffusionDistance",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"useMaskFromThicknessTexture",void 0),e}();li.a.IncludesShadersStore.pbrFragmentDeclaration="uniform vec3 vReflectionColor;\nuniform vec4 vAlbedoColor;\n\nuniform vec4 vLightingIntensity;\nuniform vec4 vReflectivityColor;\nuniform vec3 vEmissiveColor;\nuniform float visibility;\n\n#ifdef ALBEDO\nuniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nuniform vec4 vAmbientInfos;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform vec2 vTangentSpaceParams;\n#endif\n#ifdef OPACITY\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\n#endif\n#ifdef REFLECTIVITY\nuniform vec3 vReflectivityInfos;\n#endif\n#ifdef MICROSURFACEMAP\nuniform vec2 vMicroSurfaceSamplerInfos;\n#endif\n\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(SS_REFRACTION)\nuniform mat4 view;\n#endif\n\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\nuniform mat4 reflectionMatrix;\nuniform vec3 vReflectionMicrosurfaceInfos;\n#if defined(USE_LOCAL_REFLECTIONMAP_CUBIC) && defined(REFLECTIONMAP_CUBIC)\nuniform vec3 vReflectionPosition;\nuniform vec3 vReflectionSize;\n#endif\n#endif\n\n#ifdef CLEARCOAT\nuniform vec2 vClearCoatParams;\nuniform vec4 vClearCoatRefractionParams;\n#ifdef CLEARCOAT_TEXTURE\nuniform vec2 vClearCoatInfos;\nuniform mat4 clearCoatMatrix;\n#endif\n#ifdef CLEARCOAT_BUMP\nuniform vec2 vClearCoatBumpInfos;\nuniform vec2 vClearCoatTangentSpaceParams;\nuniform mat4 clearCoatBumpMatrix;\n#endif\n#ifdef CLEARCOAT_TINT\nuniform vec4 vClearCoatTintParams;\nuniform float clearCoatColorAtDistance;\n#ifdef CLEARCOAT_TINT_TEXTURE\nuniform vec2 vClearCoatTintInfos;\nuniform mat4 clearCoatTintMatrix;\n#endif\n#endif\n#endif\n\n#ifdef ANISOTROPIC\nuniform vec3 vAnisotropy;\n#ifdef ANISOTROPIC_TEXTURE\nuniform vec2 vAnisotropyInfos;\nuniform mat4 anisotropyMatrix;\n#endif\n#endif\n\n#ifdef SHEEN\nuniform vec4 vSheenColor;\n#ifdef SHEEN_TEXTURE\nuniform vec2 vSheenInfos;\nuniform mat4 sheenMatrix;\n#endif\n#endif\n\n#ifdef SUBSURFACE\n#ifdef SS_REFRACTION\nuniform vec3 vRefractionMicrosurfaceInfos;\nuniform vec4 vRefractionInfos;\nuniform mat4 refractionMatrix;\n#endif\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nuniform vec2 vThicknessInfos;\nuniform mat4 thicknessMatrix;\n#endif\nuniform vec2 vThicknessParam;\nuniform vec3 vDiffusionDistance;\nuniform vec4 vTintColor;\nuniform vec3 vSubSurfaceIntensity;\n#endif",li.a.IncludesShadersStore.pbrUboDeclaration="layout(std140,column_major) uniform;\nuniform Material\n{\nuniform vec2 vAlbedoInfos;\nuniform vec4 vAmbientInfos;\nuniform vec2 vOpacityInfos;\nuniform vec2 vEmissiveInfos;\nuniform vec2 vLightmapInfos;\nuniform vec3 vReflectivityInfos;\nuniform vec2 vMicroSurfaceSamplerInfos;\nuniform vec2 vReflectionInfos;\nuniform vec3 vReflectionPosition;\nuniform vec3 vReflectionSize;\nuniform vec3 vBumpInfos;\nuniform mat4 albedoMatrix;\nuniform mat4 ambientMatrix;\nuniform mat4 opacityMatrix;\nuniform mat4 emissiveMatrix;\nuniform mat4 lightmapMatrix;\nuniform mat4 reflectivityMatrix;\nuniform mat4 microSurfaceSamplerMatrix;\nuniform mat4 bumpMatrix;\nuniform vec2 vTangentSpaceParams;\nuniform mat4 reflectionMatrix;\nuniform vec3 vReflectionColor;\nuniform vec4 vAlbedoColor;\nuniform vec4 vLightingIntensity;\nuniform vec3 vReflectionMicrosurfaceInfos;\nuniform float pointSize;\nuniform vec4 vReflectivityColor;\nuniform vec3 vEmissiveColor;\nuniform float visibility;\nuniform vec2 vClearCoatParams;\nuniform vec4 vClearCoatRefractionParams;\nuniform vec2 vClearCoatInfos;\nuniform mat4 clearCoatMatrix;\nuniform vec2 vClearCoatBumpInfos;\nuniform vec2 vClearCoatTangentSpaceParams;\nuniform mat4 clearCoatBumpMatrix;\nuniform vec4 vClearCoatTintParams;\nuniform float clearCoatColorAtDistance;\nuniform vec2 vClearCoatTintInfos;\nuniform mat4 clearCoatTintMatrix;\nuniform vec3 vAnisotropy;\nuniform vec2 vAnisotropyInfos;\nuniform mat4 anisotropyMatrix;\nuniform vec4 vSheenColor;\nuniform vec2 vSheenInfos;\nuniform mat4 sheenMatrix;\nuniform vec3 vRefractionMicrosurfaceInfos;\nuniform vec4 vRefractionInfos;\nuniform mat4 refractionMatrix;\nuniform vec2 vThicknessInfos;\nuniform mat4 thicknessMatrix;\nuniform vec2 vThicknessParam;\nuniform vec3 vDiffusionDistance;\nuniform vec4 vTintColor;\nuniform vec3 vSubSurfaceIntensity;\n};\nuniform Scene {\nmat4 viewProjection;\n#ifdef MULTIVIEW\nmat4 viewProjectionR;\n#endif\nmat4 view;\n};",li.a.IncludesShadersStore.pbrFragmentExtraDeclaration="uniform vec4 vEyePosition;\nuniform vec3 vAmbientColor;\nuniform vec4 vCameraInfos;\n\nvarying vec3 vPositionW;\n#if DEBUGMODE>0\nuniform vec2 vDebugMode;\nvarying vec4 vClipSpacePosition;\n#endif\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif\n#ifdef MAINUV2\nvarying vec2 vMainUV2;\n#endif\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvarying vec3 vEnvironmentIrradiance;\n#endif\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif",li.a.IncludesShadersStore.pbrFragmentSamplersDeclaration="#ifdef ALBEDO\n#if ALBEDODIRECTUV == 1\n#define vAlbedoUV vMainUV1\n#elif ALBEDODIRECTUV == 2\n#define vAlbedoUV vMainUV2\n#else\nvarying vec2 vAlbedoUV;\n#endif\nuniform sampler2D albedoSampler;\n#endif\n#ifdef AMBIENT\n#if AMBIENTDIRECTUV == 1\n#define vAmbientUV vMainUV1\n#elif AMBIENTDIRECTUV == 2\n#define vAmbientUV vMainUV2\n#else\nvarying vec2 vAmbientUV;\n#endif\nuniform sampler2D ambientSampler;\n#endif\n#ifdef OPACITY\n#if OPACITYDIRECTUV == 1\n#define vOpacityUV vMainUV1\n#elif OPACITYDIRECTUV == 2\n#define vOpacityUV vMainUV2\n#else\nvarying vec2 vOpacityUV;\n#endif\nuniform sampler2D opacitySampler;\n#endif\n#ifdef EMISSIVE\n#if EMISSIVEDIRECTUV == 1\n#define vEmissiveUV vMainUV1\n#elif EMISSIVEDIRECTUV == 2\n#define vEmissiveUV vMainUV2\n#else\nvarying vec2 vEmissiveUV;\n#endif\nuniform sampler2D emissiveSampler;\n#endif\n#ifdef LIGHTMAP\n#if LIGHTMAPDIRECTUV == 1\n#define vLightmapUV vMainUV1\n#elif LIGHTMAPDIRECTUV == 2\n#define vLightmapUV vMainUV2\n#else\nvarying vec2 vLightmapUV;\n#endif\nuniform sampler2D lightmapSampler;\n#endif\n#ifdef REFLECTIVITY\n#if REFLECTIVITYDIRECTUV == 1\n#define vReflectivityUV vMainUV1\n#elif REFLECTIVITYDIRECTUV == 2\n#define vReflectivityUV vMainUV2\n#else\nvarying vec2 vReflectivityUV;\n#endif\nuniform sampler2D reflectivitySampler;\n#endif\n#ifdef MICROSURFACEMAP\n#if MICROSURFACEMAPDIRECTUV == 1\n#define vMicroSurfaceSamplerUV vMainUV1\n#elif MICROSURFACEMAPDIRECTUV == 2\n#define vMicroSurfaceSamplerUV vMainUV2\n#else\nvarying vec2 vMicroSurfaceSamplerUV;\n#endif\nuniform sampler2D microSurfaceSampler;\n#endif\n#ifdef CLEARCOAT\n#ifdef CLEARCOAT_TEXTURE\n#if CLEARCOAT_TEXTUREDIRECTUV == 1\n#define vClearCoatUV vMainUV1\n#elif CLEARCOAT_TEXTUREDIRECTUV == 2\n#define vClearCoatUV vMainUV2\n#else\nvarying vec2 vClearCoatUV;\n#endif\nuniform sampler2D clearCoatSampler;\n#endif\n#ifdef CLEARCOAT_BUMP\n#if CLEARCOAT_BUMPDIRECTUV == 1\n#define vClearCoatBumpUV vMainUV1\n#elif CLEARCOAT_BUMPDIRECTUV == 2\n#define vClearCoatBumpUV vMainUV2\n#else\nvarying vec2 vClearCoatBumpUV;\n#endif\nuniform sampler2D clearCoatBumpSampler;\n#endif\n#ifdef CLEARCOAT_TINT_TEXTURE\n#if CLEARCOAT_TINT_TEXTUREDIRECTUV == 1\n#define vClearCoatTintUV vMainUV1\n#elif CLEARCOAT_TINT_TEXTUREDIRECTUV == 2\n#define vClearCoatTintUV vMainUV2\n#else\nvarying vec2 vClearCoatTintUV;\n#endif\nuniform sampler2D clearCoatTintSampler;\n#endif\n#endif\n#ifdef SHEEN\n#ifdef SHEEN_TEXTURE\n#if SHEEN_TEXTUREDIRECTUV == 1\n#define vSheenUV vMainUV1\n#elif SHEEN_TEXTUREDIRECTUV == 2\n#define vSheenUV vMainUV2\n#else\nvarying vec2 vSheenUV;\n#endif\nuniform sampler2D sheenSampler;\n#endif\n#endif\n#ifdef ANISOTROPIC\n#ifdef ANISOTROPIC_TEXTURE\n#if ANISOTROPIC_TEXTUREDIRECTUV == 1\n#define vAnisotropyUV vMainUV1\n#elif ANISOTROPIC_TEXTUREDIRECTUV == 2\n#define vAnisotropyUV vMainUV2\n#else\nvarying vec2 vAnisotropyUV;\n#endif\nuniform sampler2D anisotropySampler;\n#endif\n#endif\n\n#ifdef REFLECTION\n#ifdef REFLECTIONMAP_3D\n#define sampleReflection(s,c) textureCube(s,c)\nuniform samplerCube reflectionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleReflectionLod(s,c,l) textureCubeLodEXT(s,c,l)\n#else\nuniform samplerCube reflectionSamplerLow;\nuniform samplerCube reflectionSamplerHigh;\n#endif\n#ifdef USEIRRADIANCEMAP\nuniform samplerCube irradianceSampler;\n#endif\n#else\n#define sampleReflection(s,c) texture2D(s,c)\nuniform sampler2D reflectionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleReflectionLod(s,c,l) texture2DLodEXT(s,c,l)\n#else\nuniform sampler2D reflectionSamplerLow;\nuniform sampler2D reflectionSamplerHigh;\n#endif\n#ifdef USEIRRADIANCEMAP\nuniform sampler2D irradianceSampler;\n#endif\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#endif\n#endif\n#ifdef ENVIRONMENTBRDF\nuniform sampler2D environmentBrdfSampler;\n#endif\n\n#ifdef SUBSURFACE\n#ifdef SS_REFRACTION\n#ifdef SS_REFRACTIONMAP_3D\n#define sampleRefraction(s,c) textureCube(s,c)\nuniform samplerCube refractionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleRefractionLod(s,c,l) textureCubeLodEXT(s,c,l)\n#else\nuniform samplerCube refractionSamplerLow;\nuniform samplerCube refractionSamplerHigh;\n#endif\n#else\n#define sampleRefraction(s,c) texture2D(s,c)\nuniform sampler2D refractionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleRefractionLod(s,c,l) texture2DLodEXT(s,c,l)\n#else\nuniform samplerCube refractionSamplerLow;\nuniform samplerCube refractionSamplerHigh;\n#endif\n#endif\n#endif\n#ifdef SS_THICKNESSANDMASK_TEXTURE\n#if SS_THICKNESSANDMASK_TEXTUREDIRECTUV == 1\n#define vThicknessUV vMainUV1\n#elif SS_THICKNESSANDMASK_TEXTUREDIRECTUV == 2\n#define vThicknessUV vMainUV2\n#else\nvarying vec2 vThicknessUV;\n#endif\nuniform sampler2D thicknessSampler;\n#endif\n#endif",N(107),li.a.IncludesShadersStore.pbrHelperFunctions="\n#define RECIPROCAL_PI2 0.15915494\n#define RECIPROCAL_PI 0.31830988618\n\n#define MINIMUMVARIANCE 0.0005\nfloat convertRoughnessToAverageSlope(float roughness)\n{\n\nreturn square(roughness)+MINIMUMVARIANCE;\n}\nfloat fresnelGrazingReflectance(float reflectance0) {\n\n\nfloat reflectance90=saturate(reflectance0*25.0);\nreturn reflectance90;\n}\nvec2 getAARoughnessFactors(vec3 normalVector) {\n#ifdef SPECULARAA\nvec3 nDfdx=dFdx(normalVector.xyz);\nvec3 nDfdy=dFdy(normalVector.xyz);\nfloat slopeSquare=max(dot(nDfdx,nDfdx),dot(nDfdy,nDfdy));\n\nfloat geometricRoughnessFactor=pow(saturate(slopeSquare),0.333);\n\nfloat geometricAlphaGFactor=sqrt(slopeSquare);\n\ngeometricAlphaGFactor*=0.75;\nreturn vec2(geometricRoughnessFactor,geometricAlphaGFactor);\n#else\nreturn vec2(0.);\n#endif\n}\n#ifdef ANISOTROPIC\n\n\nvec2 getAnisotropicRoughness(float alphaG,float anisotropy) {\nfloat alphaT=max(alphaG*(1.0+anisotropy),MINIMUMVARIANCE);\nfloat alphaB=max(alphaG*(1.0-anisotropy),MINIMUMVARIANCE);\nreturn vec2(alphaT,alphaB);\n}\n\n\nvec3 getAnisotropicBentNormals(const vec3 T,const vec3 B,const vec3 N,const vec3 V,float anisotropy) {\nvec3 anisotropicFrameDirection=anisotropy>=0.0 ? B : T;\nvec3 anisotropicFrameTangent=cross(normalize(anisotropicFrameDirection),V);\nvec3 anisotropicFrameNormal=cross(anisotropicFrameTangent,anisotropicFrameDirection);\nvec3 anisotropicNormal=normalize(mix(N,anisotropicFrameNormal,abs(anisotropy)));\nreturn anisotropicNormal;\n\n}\n#endif\n#if defined(CLEARCOAT) || defined(SS_REFRACTION)\n\n\n\nvec3 cocaLambert(vec3 alpha,float distance) {\nreturn exp(-alpha*distance);\n}\n\nvec3 cocaLambert(float NdotVRefract,float NdotLRefract,vec3 alpha,float thickness) {\nreturn cocaLambert(alpha,(thickness*((NdotLRefract+NdotVRefract)/(NdotLRefract*NdotVRefract))));\n}\n\nvec3 computeColorAtDistanceInMedia(vec3 color,float distance) {\nreturn -log(color)/distance;\n}\nvec3 computeClearCoatAbsorption(float NdotVRefract,float NdotLRefract,vec3 clearCoatColor,float clearCoatThickness,float clearCoatIntensity) {\nvec3 clearCoatAbsorption=mix(vec3(1.0),\ncocaLambert(NdotVRefract,NdotLRefract,clearCoatColor,clearCoatThickness),\nclearCoatIntensity);\nreturn clearCoatAbsorption;\n}\n#endif\n\n\n\n\n#ifdef MICROSURFACEAUTOMATIC\nfloat computeDefaultMicroSurface(float microSurface,vec3 reflectivityColor)\n{\nconst float kReflectivityNoAlphaWorkflow_SmoothnessMax=0.95;\nfloat reflectivityLuminance=getLuminance(reflectivityColor);\nfloat reflectivityLuma=sqrt(reflectivityLuminance);\nmicroSurface=reflectivityLuma*kReflectivityNoAlphaWorkflow_SmoothnessMax;\nreturn microSurface;\n}\n#endif",li.a.IncludesShadersStore.harmonicsFunctions="#ifdef USESPHERICALFROMREFLECTIONMAP\n#ifdef SPHERICAL_HARMONICS\nuniform vec3 vSphericalL00;\nuniform vec3 vSphericalL1_1;\nuniform vec3 vSphericalL10;\nuniform vec3 vSphericalL11;\nuniform vec3 vSphericalL2_2;\nuniform vec3 vSphericalL2_1;\nuniform vec3 vSphericalL20;\nuniform vec3 vSphericalL21;\nuniform vec3 vSphericalL22;\n\n\n\n\n\n\n\nvec3 computeEnvironmentIrradiance(vec3 normal) {\nreturn vSphericalL00\n+vSphericalL1_1*(normal.y)\n+vSphericalL10*(normal.z)\n+vSphericalL11*(normal.x)\n+vSphericalL2_2*(normal.y*normal.x)\n+vSphericalL2_1*(normal.y*normal.z)\n+vSphericalL20*((3.0*normal.z*normal.z)-1.0)\n+vSphericalL21*(normal.z*normal.x)\n+vSphericalL22*(normal.x*normal.x-(normal.y*normal.y));\n}\n#else\nuniform vec3 vSphericalX;\nuniform vec3 vSphericalY;\nuniform vec3 vSphericalZ;\nuniform vec3 vSphericalXX_ZZ;\nuniform vec3 vSphericalYY_ZZ;\nuniform vec3 vSphericalZZ;\nuniform vec3 vSphericalXY;\nuniform vec3 vSphericalYZ;\nuniform vec3 vSphericalZX;\n\nvec3 computeEnvironmentIrradiance(vec3 normal) {\n\n\n\n\n\n\n\n\n\nfloat Nx=normal.x;\nfloat Ny=normal.y;\nfloat Nz=normal.z;\nvec3 C1=vSphericalZZ.rgb;\nvec3 Cx=vSphericalX.rgb;\nvec3 Cy=vSphericalY.rgb;\nvec3 Cz=vSphericalZ.rgb;\nvec3 Cxx_zz=vSphericalXX_ZZ.rgb;\nvec3 Cyy_zz=vSphericalYY_ZZ.rgb;\nvec3 Cxy=vSphericalXY.rgb;\nvec3 Cyz=vSphericalYZ.rgb;\nvec3 Czx=vSphericalZX.rgb;\nvec3 a1=Cyy_zz*Ny+Cy;\nvec3 a2=Cyz*Nz+a1;\nvec3 b1=Czx*Nz+Cx;\nvec3 b2=Cxy*Ny+b1;\nvec3 b3=Cxx_zz*Nx+b2;\nvec3 t1=Cz*Nz+C1;\nvec3 t2=a2*Ny+t1;\nvec3 t3=b3*Nx+t2;\nreturn t3;\n}\n#endif\n#endif",li.a.IncludesShadersStore.pbrDirectLightingSetupFunctions="\nstruct preLightingInfo\n{\n\nvec3 lightOffset;\nfloat lightDistanceSquared;\nfloat lightDistance;\n\nfloat attenuation;\n\nvec3 L;\nvec3 H;\nfloat NdotV;\nfloat NdotLUnclamped;\nfloat NdotL;\nfloat VdotH;\nfloat roughness;\n};\npreLightingInfo computePointAndSpotPreLightingInfo(vec4 lightData,vec3 V,vec3 N) {\npreLightingInfo result;\n\nresult.lightOffset=lightData.xyz-vPositionW;\nresult.lightDistanceSquared=dot(result.lightOffset,result.lightOffset);\n\nresult.lightDistance=sqrt(result.lightDistanceSquared);\n\nresult.L=normalize(result.lightOffset);\nresult.H=normalize(V+result.L);\nresult.VdotH=saturate(dot(V,result.H));\nresult.NdotLUnclamped=dot(N,result.L);\nresult.NdotL=saturateEps(result.NdotLUnclamped);\nreturn result;\n}\npreLightingInfo computeDirectionalPreLightingInfo(vec4 lightData,vec3 V,vec3 N) {\npreLightingInfo result;\n\nresult.lightDistance=length(-lightData.xyz);\n\nresult.L=normalize(-lightData.xyz);\nresult.H=normalize(V+result.L);\nresult.VdotH=saturate(dot(V,result.H));\nresult.NdotLUnclamped=dot(N,result.L);\nresult.NdotL=saturateEps(result.NdotLUnclamped);\nreturn result;\n}\npreLightingInfo computeHemisphericPreLightingInfo(vec4 lightData,vec3 V,vec3 N) {\npreLightingInfo result;\n\n\nresult.NdotL=dot(N,lightData.xyz)*0.5+0.5;\nresult.NdotL=saturateEps(result.NdotL);\nresult.NdotLUnclamped=result.NdotL;\n#ifdef SPECULARTERM\nresult.L=normalize(lightData.xyz);\nresult.H=normalize(V+result.L);\nresult.VdotH=saturate(dot(V,result.H));\n#endif\nreturn result;\n}",li.a.IncludesShadersStore.pbrDirectLightingFalloffFunctions="float computeDistanceLightFalloff_Standard(vec3 lightOffset,float range)\n{\nreturn max(0.,1.0-length(lightOffset)/range);\n}\nfloat computeDistanceLightFalloff_Physical(float lightDistanceSquared)\n{\nreturn 1.0/maxEps(lightDistanceSquared);\n}\nfloat computeDistanceLightFalloff_GLTF(float lightDistanceSquared,float inverseSquaredRange)\n{\nfloat lightDistanceFalloff=1.0/maxEps(lightDistanceSquared);\nfloat factor=lightDistanceSquared*inverseSquaredRange;\nfloat attenuation=saturate(1.0-factor*factor);\nattenuation*=attenuation;\n\nlightDistanceFalloff*=attenuation;\nreturn lightDistanceFalloff;\n}\nfloat computeDistanceLightFalloff(vec3 lightOffset,float lightDistanceSquared,float range,float inverseSquaredRange)\n{\n#ifdef USEPHYSICALLIGHTFALLOFF\nreturn computeDistanceLightFalloff_Physical(lightDistanceSquared);\n#elif defined(USEGLTFLIGHTFALLOFF)\nreturn computeDistanceLightFalloff_GLTF(lightDistanceSquared,inverseSquaredRange);\n#else\nreturn computeDistanceLightFalloff_Standard(lightOffset,range);\n#endif\n}\nfloat computeDirectionalLightFalloff_Standard(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle,float exponent)\n{\nfloat falloff=0.0;\nfloat cosAngle=maxEps(dot(-lightDirection,directionToLightCenterW));\nif (cosAngle>=cosHalfAngle)\n{\nfalloff=max(0.,pow(cosAngle,exponent));\n}\nreturn falloff;\n}\nfloat computeDirectionalLightFalloff_Physical(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle)\n{\nconst float kMinusLog2ConeAngleIntensityRatio=6.64385618977;\n\n\n\n\n\nfloat concentrationKappa=kMinusLog2ConeAngleIntensityRatio/(1.0-cosHalfAngle);\n\n\nvec4 lightDirectionSpreadSG=vec4(-lightDirection*concentrationKappa,-concentrationKappa);\nfloat falloff=exp2(dot(vec4(directionToLightCenterW,1.0),lightDirectionSpreadSG));\nreturn falloff;\n}\nfloat computeDirectionalLightFalloff_GLTF(vec3 lightDirection,vec3 directionToLightCenterW,float lightAngleScale,float lightAngleOffset)\n{\n\n\n\nfloat cd=dot(-lightDirection,directionToLightCenterW);\nfloat falloff=saturate(cd*lightAngleScale+lightAngleOffset);\n\nfalloff*=falloff;\nreturn falloff;\n}\nfloat computeDirectionalLightFalloff(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle,float exponent,float lightAngleScale,float lightAngleOffset)\n{\n#ifdef USEPHYSICALLIGHTFALLOFF\nreturn computeDirectionalLightFalloff_Physical(lightDirection,directionToLightCenterW,cosHalfAngle);\n#elif defined(USEGLTFLIGHTFALLOFF)\nreturn computeDirectionalLightFalloff_GLTF(lightDirection,directionToLightCenterW,lightAngleScale,lightAngleOffset);\n#else\nreturn computeDirectionalLightFalloff_Standard(lightDirection,directionToLightCenterW,cosHalfAngle,exponent);\n#endif\n}",li.a.IncludesShadersStore.pbrBRDFFunctions="\n#define FRESNEL_MAXIMUM_ON_ROUGH 0.25\n\n\n\n\n#ifdef MS_BRDF_ENERGY_CONSERVATION\n\n\nvec3 getEnergyConservationFactor(const vec3 specularEnvironmentR0,const vec3 environmentBrdf) {\nreturn 1.0+specularEnvironmentR0*(1.0/environmentBrdf.y-1.0);\n}\n#endif\n#ifdef ENVIRONMENTBRDF\nvec3 getBRDFLookup(float NdotV,float perceptualRoughness) {\n\nvec2 UV=vec2(NdotV,perceptualRoughness);\n\nvec4 brdfLookup=texture2D(environmentBrdfSampler,UV);\n#ifdef ENVIRONMENTBRDF_RGBD\nbrdfLookup.rgb=fromRGBD(brdfLookup.rgba);\n#endif\nreturn brdfLookup.rgb;\n}\nvec3 getReflectanceFromBRDFLookup(const vec3 specularEnvironmentR0,const vec3 environmentBrdf) {\n#ifdef BRDF_V_HEIGHT_CORRELATED\nvec3 reflectance=mix(environmentBrdf.xxx,environmentBrdf.yyy,specularEnvironmentR0);\n#else\nvec3 reflectance=specularEnvironmentR0*environmentBrdf.x+environmentBrdf.y;\n#endif\nreturn reflectance;\n}\n#endif\n#if !defined(ENVIRONMENTBRDF) || defined(REFLECTIONMAP_SKYBOX) || defined(ALPHAFRESNEL)\nvec3 getReflectanceFromAnalyticalBRDFLookup_Jones(float VdotN,vec3 reflectance0,vec3 reflectance90,float smoothness)\n{\n\nfloat weight=mix(FRESNEL_MAXIMUM_ON_ROUGH,1.0,smoothness);\nreturn reflectance0+weight*(reflectance90-reflectance0)*pow5(saturate(1.0-VdotN));\n}\n#endif\n#if defined(SHEEN) && defined(REFLECTION)\n\nvec3 getSheenReflectanceFromBRDFLookup(const vec3 reflectance0,const vec3 environmentBrdf) {\nvec3 sheenEnvironmentReflectance=reflectance0*environmentBrdf.b;\nreturn sheenEnvironmentReflectance;\n}\n#endif\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nvec3 fresnelSchlickGGX(float VdotH,vec3 reflectance0,vec3 reflectance90)\n{\nreturn reflectance0+(reflectance90-reflectance0)*pow5(1.0-VdotH);\n}\nfloat fresnelSchlickGGX(float VdotH,float reflectance0,float reflectance90)\n{\nreturn reflectance0+(reflectance90-reflectance0)*pow5(1.0-VdotH);\n}\n#ifdef CLEARCOAT\n\n\n\n\n\nvec3 getR0RemappedForClearCoat(vec3 f0) {\n#ifdef CLEARCOAT_DEFAULTIOR\n#ifdef MOBILE\nreturn saturate(f0*(f0*0.526868+0.529324)-0.0482256);\n#else\nreturn saturate(f0*(f0*(0.941892-0.263008*f0)+0.346479)-0.0285998);\n#endif\n#else\nvec3 s=sqrt(f0);\nvec3 t=(vClearCoatRefractionParams.z+vClearCoatRefractionParams.w*s)/(vClearCoatRefractionParams.w+vClearCoatRefractionParams.z*s);\nreturn t*t;\n#endif\n}\n#endif\n\n\n\n\n\n\nfloat normalDistributionFunction_TrowbridgeReitzGGX(float NdotH,float alphaG)\n{\n\n\n\nfloat a2=square(alphaG);\nfloat d=NdotH*NdotH*(a2-1.0)+1.0;\nreturn a2/(PI*d*d);\n}\n#ifdef SHEEN\n\nfloat normalDistributionFunction_CharlieSheen(float NdotH,float alphaG)\n{\nfloat invR=1./alphaG;\nfloat cos2h=NdotH*NdotH;\nfloat sin2h=1.-cos2h;\nreturn (2.+invR)*pow(sin2h,invR*.5)/(2.*PI);\n}\n#endif\n#ifdef ANISOTROPIC\n\n\nfloat normalDistributionFunction_BurleyGGX_Anisotropic(float NdotH,float TdotH,float BdotH,const vec2 alphaTB) {\nfloat a2=alphaTB.x*alphaTB.y;\nvec3 v=vec3(alphaTB.y*TdotH,alphaTB.x*BdotH,a2*NdotH);\nfloat v2=dot(v,v);\nfloat w2=a2/v2;\nreturn a2*w2*w2*RECIPROCAL_PI;\n}\n#endif\n\n\n\n\n#ifdef BRDF_V_HEIGHT_CORRELATED\n\n\n\nfloat smithVisibility_GGXCorrelated(float NdotL,float NdotV,float alphaG) {\n#ifdef MOBILE\n\nfloat GGXV=NdotL*(NdotV*(1.0-alphaG)+alphaG);\nfloat GGXL=NdotV*(NdotL*(1.0-alphaG)+alphaG);\nreturn 0.5/(GGXV+GGXL);\n#else\nfloat a2=alphaG*alphaG;\nfloat GGXV=NdotL*sqrt(NdotV*(NdotV-a2*NdotV)+a2);\nfloat GGXL=NdotV*sqrt(NdotL*(NdotL-a2*NdotL)+a2);\nreturn 0.5/(GGXV+GGXL);\n#endif\n}\n#else\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nfloat smithVisibilityG1_TrowbridgeReitzGGXFast(float dot,float alphaG)\n{\n#ifdef MOBILE\n\nreturn 1.0/(dot+alphaG+(1.0-alphaG)*dot ));\n#else\nfloat alphaSquared=alphaG*alphaG;\nreturn 1.0/(dot+sqrt(alphaSquared+(1.0-alphaSquared)*dot*dot));\n#endif\n}\nfloat smithVisibility_TrowbridgeReitzGGXFast(float NdotL,float NdotV,float alphaG)\n{\nfloat visibility=smithVisibilityG1_TrowbridgeReitzGGXFast(NdotL,alphaG)*smithVisibilityG1_TrowbridgeReitzGGXFast(NdotV,alphaG);\n\nreturn visibility;\n}\n#endif\n#ifdef ANISOTROPIC\n\n\nfloat smithVisibility_GGXCorrelated_Anisotropic(float NdotL,float NdotV,float TdotV,float BdotV,float TdotL,float BdotL,const vec2 alphaTB) {\nfloat lambdaV=NdotL*length(vec3(alphaTB.x*TdotV,alphaTB.y*BdotV,NdotV));\nfloat lambdaL=NdotV*length(vec3(alphaTB.x*TdotL,alphaTB.y*BdotL,NdotL));\nfloat v=0.5/(lambdaV+lambdaL);\nreturn v;\n}\n#endif\n#ifdef CLEARCOAT\nfloat visibility_Kelemen(float VdotH) {\n\n\n\nreturn 0.25/(VdotH*VdotH);\n}\n#endif\n#ifdef SHEEN\n\n\n\nfloat visibility_Ashikhmin(float NdotL,float NdotV)\n{\nreturn 1./(4.*(NdotL+NdotV-NdotL*NdotV));\n}\n#endif\n\n\n\n\n\n\n\nfloat diffuseBRDF_Burley(float NdotL,float NdotV,float VdotH,float roughness) {\n\n\nfloat diffuseFresnelNV=pow5(saturateEps(1.0-NdotL));\nfloat diffuseFresnelNL=pow5(saturateEps(1.0-NdotV));\nfloat diffuseFresnel90=0.5+2.0*VdotH*VdotH*roughness;\nfloat fresnel =\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNL) *\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNV);\nreturn fresnel/PI;\n}\n#ifdef SS_TRANSLUCENCY\n\n\nvec3 transmittanceBRDF_Burley(const vec3 tintColor,const vec3 diffusionDistance,float thickness) {\nvec3 S=1./maxEps(diffusionDistance);\nvec3 temp=exp((-0.333333333*thickness)*S);\nreturn tintColor.rgb*0.25*(temp*temp*temp+3.0*temp);\n}\n\n\nfloat computeWrappedDiffuseNdotL(float NdotL,float w) {\nfloat t=1.0+w;\nfloat invt2=1.0/square(t);\nreturn saturate((NdotL+w)*invt2);\n}\n#endif\n",li.a.IncludesShadersStore.pbrDirectLightingFunctions="#define CLEARCOATREFLECTANCE90 1.0\n\nstruct lightingInfo\n{\nvec3 diffuse;\n#ifdef SPECULARTERM\nvec3 specular;\n#endif\n#ifdef CLEARCOAT\n\n\nvec4 clearCoat;\n#endif\n#ifdef SHEEN\nvec3 sheen;\n#endif\n};\n\nfloat adjustRoughnessFromLightProperties(float roughness,float lightRadius,float lightDistance) {\n#if defined(USEPHYSICALLIGHTFALLOFF) || defined(USEGLTFLIGHTFALLOFF)\n\nfloat lightRoughness=lightRadius/lightDistance;\n\nfloat totalRoughness=saturate(lightRoughness+roughness);\nreturn totalRoughness;\n#else\nreturn roughness;\n#endif\n}\nvec3 computeHemisphericDiffuseLighting(preLightingInfo info,vec3 lightColor,vec3 groundColor) {\nreturn mix(groundColor,lightColor,info.NdotL);\n}\nvec3 computeDiffuseLighting(preLightingInfo info,vec3 lightColor) {\nfloat diffuseTerm=diffuseBRDF_Burley(info.NdotL,info.NdotV,info.VdotH,info.roughness);\nreturn diffuseTerm*info.attenuation*info.NdotL*lightColor;\n}\nvec3 computeProjectionTextureDiffuseLighting(sampler2D projectionLightSampler,mat4 textureProjectionMatrix){\nvec4 strq=textureProjectionMatrix*vec4(vPositionW,1.0);\nstrq/=strq.w;\nvec3 textureColor=texture2D(projectionLightSampler,strq.xy).rgb;\nreturn toLinearSpace(textureColor);\n}\n#ifdef SS_TRANSLUCENCY\nvec3 computeDiffuseAndTransmittedLighting(preLightingInfo info,vec3 lightColor,vec3 transmittance) {\nfloat NdotL=absEps(info.NdotLUnclamped);\n\nfloat wrapNdotL=computeWrappedDiffuseNdotL(NdotL,0.02);\n\nfloat trAdapt=step(0.,info.NdotLUnclamped);\nvec3 transmittanceNdotL=mix(transmittance*wrapNdotL,vec3(wrapNdotL),trAdapt);\nfloat diffuseTerm=diffuseBRDF_Burley(NdotL,info.NdotV,info.VdotH,info.roughness);\nreturn diffuseTerm*transmittanceNdotL*info.attenuation*lightColor;\n}\n#endif\n#ifdef SPECULARTERM\nvec3 computeSpecularLighting(preLightingInfo info,vec3 N,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,vec3 lightColor) {\nfloat NdotH=saturateEps(dot(N,info.H));\nfloat roughness=max(info.roughness,geometricRoughnessFactor);\nfloat alphaG=convertRoughnessToAverageSlope(roughness);\nvec3 fresnel=fresnelSchlickGGX(info.VdotH,reflectance0,reflectance90);\nfloat distribution=normalDistributionFunction_TrowbridgeReitzGGX(NdotH,alphaG);\n#ifdef BRDF_V_HEIGHT_CORRELATED\nfloat smithVisibility=smithVisibility_GGXCorrelated(info.NdotL,info.NdotV,alphaG);\n#else\nfloat smithVisibility=smithVisibility_TrowbridgeReitzGGXFast(info.NdotL,info.NdotV,alphaG);\n#endif\nvec3 specTerm=fresnel*distribution*smithVisibility;\nreturn specTerm*info.attenuation*info.NdotL*lightColor;\n}\n#endif\n#ifdef ANISOTROPIC\nvec3 computeAnisotropicSpecularLighting(preLightingInfo info,vec3 V,vec3 N,vec3 T,vec3 B,float anisotropy,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,vec3 lightColor) {\nfloat NdotH=saturateEps(dot(N,info.H));\nfloat TdotH=dot(T,info.H);\nfloat BdotH=dot(B,info.H);\nfloat TdotV=dot(T,V);\nfloat BdotV=dot(B,V);\nfloat TdotL=dot(T,info.L);\nfloat BdotL=dot(B,info.L);\nfloat alphaG=convertRoughnessToAverageSlope(info.roughness);\nvec2 alphaTB=getAnisotropicRoughness(alphaG,anisotropy);\nalphaTB=max(alphaTB,square(geometricRoughnessFactor));\nvec3 fresnel=fresnelSchlickGGX(info.VdotH,reflectance0,reflectance90);\nfloat distribution=normalDistributionFunction_BurleyGGX_Anisotropic(NdotH,TdotH,BdotH,alphaTB);\nfloat smithVisibility=smithVisibility_GGXCorrelated_Anisotropic(info.NdotL,info.NdotV,TdotV,BdotV,TdotL,BdotL,alphaTB);\nvec3 specTerm=fresnel*distribution*smithVisibility;\nreturn specTerm*info.attenuation*info.NdotL*lightColor;\n}\n#endif\n#ifdef CLEARCOAT\nvec4 computeClearCoatLighting(preLightingInfo info,vec3 Ncc,float geometricRoughnessFactor,float clearCoatIntensity,vec3 lightColor) {\nfloat NccdotL=saturateEps(dot(Ncc,info.L));\nfloat NccdotH=saturateEps(dot(Ncc,info.H));\nfloat clearCoatRoughness=max(info.roughness,geometricRoughnessFactor);\nfloat alphaG=convertRoughnessToAverageSlope(clearCoatRoughness);\nfloat fresnel=fresnelSchlickGGX(info.VdotH,vClearCoatRefractionParams.x,CLEARCOATREFLECTANCE90);\nfresnel*=clearCoatIntensity;\nfloat distribution=normalDistributionFunction_TrowbridgeReitzGGX(NccdotH,alphaG);\nfloat kelemenVisibility=visibility_Kelemen(info.VdotH);\nfloat clearCoatTerm=fresnel*distribution*kelemenVisibility;\nreturn vec4(\nclearCoatTerm*info.attenuation*NccdotL*lightColor,\n1.0-fresnel\n);\n}\nvec3 computeClearCoatLightingAbsorption(float NdotVRefract,vec3 L,vec3 Ncc,vec3 clearCoatColor,float clearCoatThickness,float clearCoatIntensity) {\nvec3 LRefract=-refract(L,Ncc,vClearCoatRefractionParams.y);\nfloat NdotLRefract=saturateEps(dot(Ncc,LRefract));\nvec3 absorption=computeClearCoatAbsorption(NdotVRefract,NdotLRefract,clearCoatColor,clearCoatThickness,clearCoatIntensity);\nreturn absorption;\n}\n#endif\n#ifdef SHEEN\nvec3 computeSheenLighting(preLightingInfo info,vec3 N,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,vec3 lightColor) {\nfloat NdotH=saturateEps(dot(N,info.H));\nfloat roughness=max(info.roughness,geometricRoughnessFactor);\nfloat alphaG=convertRoughnessToAverageSlope(roughness);\n\n\nfloat fresnel=1.;\nfloat distribution=normalDistributionFunction_CharlieSheen(NdotH,alphaG);\nfloat ashikhminvisibility=visibility_Ashikhmin(info.NdotL,info.NdotV);\nfloat sheenTerm=fresnel*distribution*ashikhminvisibility;\nreturn sheenTerm*info.attenuation*info.NdotL*lightColor;\n}\n#endif\n",li.a.IncludesShadersStore.pbrIBLFunctions="#if defined(REFLECTION) || defined(SS_REFRACTION)\nfloat getLodFromAlphaG(float cubeMapDimensionPixels,float microsurfaceAverageSlope) {\nfloat microsurfaceAverageSlopeTexels=cubeMapDimensionPixels*microsurfaceAverageSlope;\nfloat lod=log2(microsurfaceAverageSlopeTexels);\nreturn lod;\n}\nfloat getLinearLodFromRoughness(float cubeMapDimensionPixels,float roughness) {\nfloat lod=log2(cubeMapDimensionPixels)*roughness;\nreturn lod;\n}\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(RADIANCEOCCLUSION)\nfloat environmentRadianceOcclusion(float ambientOcclusion,float NdotVUnclamped) {\n\n\nfloat temp=NdotVUnclamped+ambientOcclusion;\nreturn saturate(square(temp)-1.0+ambientOcclusion);\n}\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(HORIZONOCCLUSION)\nfloat environmentHorizonOcclusion(vec3 view,vec3 normal) {\n\nvec3 reflection=reflect(view,normal);\nfloat temp=saturate(1.0+1.1*dot(reflection,normal));\nreturn square(temp);\n}\n#endif\n\n\n\n\n#if defined(LODINREFLECTIONALPHA) || defined(SS_LODINREFRACTIONALPHA)\n\n\n#define UNPACK_LOD(x) (1.0-x)*255.0\nfloat getLodFromAlphaG(float cubeMapDimensionPixels,float alphaG,float NdotV) {\nfloat microsurfaceAverageSlope=alphaG;\n\n\n\n\n\n\nmicrosurfaceAverageSlope*=sqrt(abs(NdotV));\nreturn getLodFromAlphaG(cubeMapDimensionPixels,microsurfaceAverageSlope);\n}\n#endif",N(119),N(120),N(146),N(140),li.a.IncludesShadersStore.pbrDebug="#if DEBUGMODE>0\nif (vClipSpacePosition.x/vClipSpacePosition.w<vDebugMode.x) {\nreturn;\n}\n\n#if DEBUGMODE == 1\ngl_FragColor.rgb=vPositionW.rgb;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE == 2 && defined(NORMAL)\ngl_FragColor.rgb=vNormalW.rgb;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE == 3 && (defined(BUMP) || defined(PARALLAX) || defined(ANISOTROPIC))\n\ngl_FragColor.rgb=TBN[0];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE == 4 && (defined(BUMP) || defined(PARALLAX) || defined(ANISOTROPIC))\n\ngl_FragColor.rgb=TBN[1];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE == 5\n\ngl_FragColor.rgb=normalW;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE == 6 && defined(MAINUV1)\ngl_FragColor.rgb=vec3(vMainUV1,0.0);\n#elif DEBUGMODE == 7 && defined(MAINUV2)\ngl_FragColor.rgb=vec3(vMainUV2,0.0);\n#elif DEBUGMODE == 8 && defined(CLEARCOAT) && defined(CLEARCOAT_BUMP)\n\ngl_FragColor.rgb=TBNClearCoat[0];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE == 9 && defined(CLEARCOAT) && defined(CLEARCOAT_BUMP)\n\ngl_FragColor.rgb=TBNClearCoat[1];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE == 10 && defined(CLEARCOAT)\n\ngl_FragColor.rgb=clearCoatNormalW;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE == 11 && defined(ANISOTROPIC)\ngl_FragColor.rgb=anisotropicNormal;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE == 12 && defined(ANISOTROPIC)\ngl_FragColor.rgb=anisotropicTangent;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE == 13 && defined(ANISOTROPIC)\ngl_FragColor.rgb=anisotropicBitangent;\n#define DEBUGMODE_NORMALIZE\n\n#elif DEBUGMODE == 20 && defined(ALBEDO)\ngl_FragColor.rgb=albedoTexture.rgb;\n#elif DEBUGMODE == 21 && defined(AMBIENT)\ngl_FragColor.rgb=ambientOcclusionColorMap.rgb;\n#elif DEBUGMODE == 22 && defined(OPACITY)\ngl_FragColor.rgb=opacityMap.rgb;\n#elif DEBUGMODE == 23 && defined(EMISSIVE)\ngl_FragColor.rgb=emissiveColorTex.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 24 && defined(LIGHTMAP)\ngl_FragColor.rgb=lightmapColor.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 25 && defined(REFLECTIVITY) && defined(METALLICWORKFLOW)\ngl_FragColor.rgb=surfaceMetallicColorMap.rgb;\n#elif DEBUGMODE == 26 && defined(REFLECTIVITY) && !defined(METALLICWORKFLOW)\ngl_FragColor.rgb=surfaceReflectivityColorMap.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 27 && defined(CLEARCOAT) && defined(CLEARCOAT_TEXTURE)\ngl_FragColor.rgb=vec3(clearCoatMapData.rg,0.0);\n#elif DEBUGMODE == 28 && defined(CLEARCOAT) && defined(CLEARCOAT_TINT) && defined(CLEARCOAT_TINT_TEXTURE)\ngl_FragColor.rgb=clearCoatTintMapData.rgb;\n#elif DEBUGMODE == 29 && defined(SHEEN) && defined(SHEEN_TEXTURE)\ngl_FragColor.rgb=sheenMapData.rgb;\n#elif DEBUGMODE == 30 && defined(ANISOTROPIC) && defined(ANISOTROPIC_TEXTURE)\ngl_FragColor.rgb=anisotropyMapData.rgb;\n#elif DEBUGMODE == 31 && defined(SUBSURFACE) && defined(SS_THICKNESSANDMASK_TEXTURE)\ngl_FragColor.rgb=thicknessMap.rgb;\n\n#elif DEBUGMODE == 40 && defined(SS_REFRACTION)\n\ngl_FragColor.rgb=environmentRefraction.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 41 && defined(REFLECTION)\ngl_FragColor.rgb=environmentRadiance.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 42 && defined(CLEARCOAT) && defined(REFLECTION)\ngl_FragColor.rgb=environmentClearCoatRadiance;\n#define DEBUGMODE_GAMMA\n\n#elif DEBUGMODE == 50\ngl_FragColor.rgb=diffuseBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 51 && defined(SPECULARTERM)\ngl_FragColor.rgb=specularBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 52 && defined(CLEARCOAT)\ngl_FragColor.rgb=clearCoatBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 53 && defined(SHEEN)\ngl_FragColor.rgb=sheenBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 54 && defined(REFLECTION)\ngl_FragColor.rgb=environmentIrradiance.rgb;\n#define DEBUGMODE_GAMMA\n\n#elif DEBUGMODE == 60\ngl_FragColor.rgb=surfaceAlbedo.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 61\ngl_FragColor.rgb=specularEnvironmentR0;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 62 && defined(METALLICWORKFLOW)\ngl_FragColor.rgb=vec3(metallicRoughness.r);\n#elif DEBUGMODE == 71 && defined(METALLICWORKFLOW)\ngl_FragColor.rgb=metallicF0;\n#elif DEBUGMODE == 63\ngl_FragColor.rgb=vec3(roughness);\n#elif DEBUGMODE == 64\ngl_FragColor.rgb=vec3(alphaG);\n#elif DEBUGMODE == 65\ngl_FragColor.rgb=vec3(NdotV);\n#elif DEBUGMODE == 66 && defined(CLEARCOAT) && defined(CLEARCOAT_TINT)\ngl_FragColor.rgb=clearCoatColor.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 67 && defined(CLEARCOAT)\ngl_FragColor.rgb=vec3(clearCoatRoughness);\n#elif DEBUGMODE == 68 && defined(CLEARCOAT)\ngl_FragColor.rgb=vec3(clearCoatNdotV);\n#elif DEBUGMODE == 69 && defined(SUBSURFACE) && defined(SS_TRANSLUCENCY)\ngl_FragColor.rgb=transmittance;\n#elif DEBUGMODE == 70 && defined(SUBSURFACE) && defined(SS_REFRACTION)\ngl_FragColor.rgb=refractionTransmittance;\n\n#elif DEBUGMODE == 80 && defined(RADIANCEOCCLUSION)\ngl_FragColor.rgb=vec3(seo);\n#elif DEBUGMODE == 81 && defined(HORIZONOCCLUSION)\ngl_FragColor.rgb=vec3(eho);\n#elif DEBUGMODE == 82 && defined(MS_BRDF_ENERGY_CONSERVATION)\ngl_FragColor.rgb=vec3(energyConservationFactor);\n#elif DEBUGMODE == 83 && defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\ngl_FragColor.rgb=specularEnvironmentReflectance;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 84 && defined(CLEARCOAT) && defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\ngl_FragColor.rgb=clearCoatEnvironmentReflectance;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 85 && defined(SHEEN) && defined(REFLECTION)\ngl_FragColor.rgb=sheenEnvironmentReflectance;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 86 && defined(ALPHABLEND)\ngl_FragColor.rgb=vec3(luminanceOverAlpha);\n#elif DEBUGMODE == 87\ngl_FragColor.rgb=vec3(alpha);\n#endif\ngl_FragColor.rgb*=vDebugMode.y;\n#ifdef DEBUGMODE_NORMALIZE\ngl_FragColor.rgb=normalize(gl_FragColor.rgb)*0.5+0.5;\n#endif\n#ifdef DEBUGMODE_GAMMA\ngl_FragColor.rgb=toGammaSpace(gl_FragColor.rgb);\n#endif\ngl_FragColor.a=1.0;\n#endif",li.a.ShadersStore.pbrPixelShader="#if defined(BUMP) || !defined(NORMAL) || defined(FORCENORMALFORWARD) || defined(SPECULARAA) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)\n#extension GL_OES_standard_derivatives : enable\n#endif\n#ifdef LODBASEDMICROSFURACE\n#extension GL_EXT_shader_texture_lod : enable\n#endif\n#define CUSTOM_FRAGMENT_BEGIN\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nprecision highp float;\n\n#ifndef FROMLINEARSPACE\n#define FROMLINEARSPACE\n#endif\n\n#include<__decl__pbrFragment>\n#include<pbrFragmentExtraDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<pbrFragmentSamplersDeclaration>\n#include<imageProcessingDeclaration>\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\n\n#include<helperFunctions>\n#include<pbrHelperFunctions>\n#include<imageProcessingFunctions>\n#include<shadowsFragmentFunctions>\n#include<harmonicsFunctions>\n#include<pbrDirectLightingSetupFunctions>\n#include<pbrDirectLightingFalloffFunctions>\n#include<pbrBRDFFunctions>\n#include<pbrDirectLightingFunctions>\n#include<pbrIBLFunctions>\n#include<bumpFragmentFunctions>\n#ifdef REFLECTION\n#include<reflectionFunction>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\n\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n\nvec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=normalize(cross(dFdx(vPositionW),dFdy(vPositionW)))*vEyePosition.w;\n#endif\n#ifdef CLEARCOAT\n\nvec3 clearCoatNormalW=normalW;\n#endif\n#include<bumpFragment>\n#if defined(FORCENORMALFORWARD) && defined(NORMAL)\nvec3 faceNormal=normalize(cross(dFdx(vPositionW),dFdy(vPositionW)))*vEyePosition.w;\n#if defined(TWOSIDEDLIGHTING)\nfaceNormal=gl_FrontFacing ? faceNormal : -faceNormal;\n#endif\nnormalW*=sign(dot(normalW,faceNormal));\n#endif\n#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)\nnormalW=gl_FrontFacing ? normalW : -normalW;\n#endif\n\n\nvec3 surfaceAlbedo=vAlbedoColor.rgb;\n\nfloat alpha=vAlbedoColor.a;\n#ifdef ALBEDO\nvec4 albedoTexture=texture2D(albedoSampler,vAlbedoUV+uvOffset);\n#if defined(ALPHAFROMALBEDO) || defined(ALPHATEST)\nalpha*=albedoTexture.a;\n#endif\n#ifdef GAMMAALBEDO\nsurfaceAlbedo*=toLinearSpace(albedoTexture.rgb);\n#else\nsurfaceAlbedo*=albedoTexture.rgb;\n#endif\nsurfaceAlbedo*=vAlbedoInfos.y;\n#endif\n#ifdef VERTEXCOLOR\nsurfaceAlbedo*=vColor.rgb;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_ALBEDO\n\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);\n#ifdef OPACITYRGB\nalpha=getLuminance(opacityMap.rgb);\n#else\nalpha*=opacityMap.a;\n#endif\nalpha*=vOpacityInfos.y;\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#if !defined(SS_LINKREFRACTIONTOTRANSPARENCY) && !defined(ALPHAFRESNEL)\n#ifdef ALPHATEST\nif (alpha<ALPHATESTVALUE)\ndiscard;\n#ifndef ALPHABLEND\n\nalpha=1.0;\n#endif\n#endif\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_ALPHA\n#include<depthPrePass>\n#define CUSTOM_FRAGMENT_BEFORE_LIGHTS\n\nvec3 ambientOcclusionColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nvec3 ambientOcclusionColorMap=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb*vAmbientInfos.y;\n#ifdef AMBIENTINGRAYSCALE\nambientOcclusionColorMap=vec3(ambientOcclusionColorMap.r,ambientOcclusionColorMap.r,ambientOcclusionColorMap.r);\n#endif\nambientOcclusionColor=mix(ambientOcclusionColor,ambientOcclusionColorMap,vAmbientInfos.z);\n#endif\n#ifdef UNLIT\nvec3 diffuseBase=vec3(1.,1.,1.);\n#else\n\nfloat microSurface=vReflectivityColor.a;\nvec3 surfaceReflectivityColor=vReflectivityColor.rgb;\n#ifdef METALLICWORKFLOW\nvec2 metallicRoughness=surfaceReflectivityColor.rg;\n#ifdef REFLECTIVITY\nvec4 surfaceMetallicColorMap=texture2D(reflectivitySampler,vReflectivityUV+uvOffset);\n#ifdef AOSTOREINMETALMAPRED\nvec3 aoStoreInMetalMap=vec3(surfaceMetallicColorMap.r,surfaceMetallicColorMap.r,surfaceMetallicColorMap.r);\nambientOcclusionColor=mix(ambientOcclusionColor,aoStoreInMetalMap,vReflectivityInfos.z);\n#endif\n#ifdef METALLNESSSTOREINMETALMAPBLUE\nmetallicRoughness.r*=surfaceMetallicColorMap.b;\n#else\nmetallicRoughness.r*=surfaceMetallicColorMap.r;\n#endif\n#ifdef ROUGHNESSSTOREINMETALMAPALPHA\nmetallicRoughness.g*=surfaceMetallicColorMap.a;\n#else\n#ifdef ROUGHNESSSTOREINMETALMAPGREEN\nmetallicRoughness.g*=surfaceMetallicColorMap.g;\n#endif\n#endif\n#endif\n#ifdef MICROSURFACEMAP\nvec4 microSurfaceTexel=texture2D(microSurfaceSampler,vMicroSurfaceSamplerUV+uvOffset)*vMicroSurfaceSamplerInfos.y;\nmetallicRoughness.g*=microSurfaceTexel.r;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_METALLICROUGHNESS\n\nmicroSurface=1.0-metallicRoughness.g;\n\nvec3 baseColor=surfaceAlbedo;\n#ifdef REFLECTANCE\n\n\n\n\n\nsurfaceAlbedo=baseColor.rgb*(1.0-metallicRoughness.r);\n\nsurfaceReflectivityColor=mix(0.16*reflectance*reflectance,baseColor,metallicRoughness.r);\n#else\nvec3 metallicF0=vec3(vReflectivityColor.a,vReflectivityColor.a,vReflectivityColor.a);\n#ifdef METALLICF0FACTORFROMMETALLICMAP\n#ifdef REFLECTIVITY\nmetallicF0*=surfaceMetallicColorMap.a;\n#endif\n#endif\n\nsurfaceAlbedo=mix(baseColor.rgb*(1.0-metallicF0.r),vec3(0.,0.,0.),metallicRoughness.r);\n\nsurfaceReflectivityColor=mix(metallicF0,baseColor,metallicRoughness.r);\n#endif\n#else\n#ifdef REFLECTIVITY\nvec4 surfaceReflectivityColorMap=texture2D(reflectivitySampler,vReflectivityUV+uvOffset);\nsurfaceReflectivityColor*=toLinearSpace(surfaceReflectivityColorMap.rgb);\nsurfaceReflectivityColor*=vReflectivityInfos.y;\n#ifdef MICROSURFACEFROMREFLECTIVITYMAP\nmicroSurface*=surfaceReflectivityColorMap.a;\nmicroSurface*=vReflectivityInfos.z;\n#else\n#ifdef MICROSURFACEAUTOMATIC\nmicroSurface*=computeDefaultMicroSurface(microSurface,surfaceReflectivityColor);\n#endif\n#ifdef MICROSURFACEMAP\nvec4 microSurfaceTexel=texture2D(microSurfaceSampler,vMicroSurfaceSamplerUV+uvOffset)*vMicroSurfaceSamplerInfos.y;\nmicroSurface*=microSurfaceTexel.r;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_MICROSURFACE\n#endif\n#endif\n#endif\n\nmicroSurface=saturate(microSurface);\n\nfloat roughness=1.-microSurface;\n\n#ifdef ALPHAFRESNEL\n#if defined(ALPHATEST) || defined(ALPHABLEND)\n\n\n\nfloat opacityPerceptual=alpha;\n#ifdef LINEARALPHAFRESNEL\nfloat opacity0=opacityPerceptual;\n#else\nfloat opacity0=opacityPerceptual*opacityPerceptual;\n#endif\nfloat opacity90=fresnelGrazingReflectance(opacity0);\nvec3 normalForward=faceforward(normalW,-viewDirectionW,normalW);\n\nalpha=getReflectanceFromAnalyticalBRDFLookup_Jones(saturate(dot(viewDirectionW,normalForward)),vec3(opacity0),vec3(opacity90),sqrt(microSurface)).x;\n#ifdef ALPHATEST\nif (alpha<ALPHATESTVALUE)\ndiscard;\n#ifndef ALPHABLEND\n\nalpha=1.0;\n#endif\n#endif\n#endif\n#endif\n\nfloat NdotVUnclamped=dot(normalW,viewDirectionW);\n\nfloat NdotV=absEps(NdotVUnclamped);\nfloat alphaG=convertRoughnessToAverageSlope(roughness);\nvec2 AARoughnessFactors=getAARoughnessFactors(normalW.xyz);\n#ifdef SPECULARAA\n\nalphaG+=AARoughnessFactors.y;\n#endif\n#ifdef ANISOTROPIC\nfloat anisotropy=vAnisotropy.b;\nvec3 anisotropyDirection=vec3(vAnisotropy.xy,0.);\n#ifdef ANISOTROPIC_TEXTURE\nvec3 anisotropyMapData=texture2D(anisotropySampler,vAnisotropyUV+uvOffset).rgb*vAnisotropyInfos.y;\nanisotropy*=anisotropyMapData.b;\nanisotropyDirection.rg*=anisotropyMapData.rg*2.0-1.0;\n#endif\nmat3 anisoTBN=mat3(normalize(TBN[0]),normalize(TBN[1]),normalize(TBN[2]));\nvec3 anisotropicTangent=normalize(anisoTBN*anisotropyDirection);\nvec3 anisotropicBitangent=normalize(cross(anisoTBN[2],anisotropicTangent));\nvec3 anisotropicNormal=getAnisotropicBentNormals(anisotropicTangent,anisotropicBitangent,normalW,viewDirectionW,anisotropy);\n#endif\n\n#ifdef SS_REFRACTION\nvec4 environmentRefraction=vec4(0.,0.,0.,0.);\n#ifdef ANISOTROPIC\nvec3 refractionVector=refract(-viewDirectionW,anisotropicNormal,vRefractionInfos.y);\n#else\nvec3 refractionVector=refract(-viewDirectionW,normalW,vRefractionInfos.y);\n#endif\n#ifdef SS_REFRACTIONMAP_OPPOSITEZ\nrefractionVector.z*=-1.0;\n#endif\n\n#ifdef SS_REFRACTIONMAP_3D\nrefractionVector.y=refractionVector.y*vRefractionInfos.w;\nvec3 refractionCoords=refractionVector;\nrefractionCoords=vec3(refractionMatrix*vec4(refractionCoords,0));\n#else\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));\nvec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;\nrefractionCoords.y=1.0-refractionCoords.y;\n#endif\n#ifdef SS_LODINREFRACTIONALPHA\nfloat refractionLOD=getLodFromAlphaG(vRefractionMicrosurfaceInfos.x,alphaG,NdotVUnclamped);\n#elif defined(SS_LINEARSPECULARREFRACTION)\nfloat refractionLOD=getLinearLodFromRoughness(vRefractionMicrosurfaceInfos.x,roughness);\n#else\nfloat refractionLOD=getLodFromAlphaG(vRefractionMicrosurfaceInfos.x,alphaG);\n#endif\n#ifdef LODBASEDMICROSFURACE\n\nrefractionLOD=refractionLOD*vRefractionMicrosurfaceInfos.y+vRefractionMicrosurfaceInfos.z;\n#ifdef SS_LODINREFRACTIONALPHA\n\n\n\n\n\n\n\n\n\nfloat automaticRefractionLOD=UNPACK_LOD(sampleRefraction(refractionSampler,refractionCoords).a);\nfloat requestedRefractionLOD=max(automaticRefractionLOD,refractionLOD);\n#else\nfloat requestedRefractionLOD=refractionLOD;\n#endif\nenvironmentRefraction=sampleRefractionLod(refractionSampler,refractionCoords,requestedRefractionLOD);\n#else\nfloat lodRefractionNormalized=saturate(refractionLOD/log2(vRefractionMicrosurfaceInfos.x));\nfloat lodRefractionNormalizedDoubled=lodRefractionNormalized*2.0;\nvec4 environmentRefractionMid=sampleRefraction(refractionSampler,refractionCoords);\nif(lodRefractionNormalizedDoubled<1.0){\nenvironmentRefraction=mix(\nsampleRefraction(refractionSamplerHigh,refractionCoords),\nenvironmentRefractionMid,\nlodRefractionNormalizedDoubled\n);\n}else{\nenvironmentRefraction=mix(\nenvironmentRefractionMid,\nsampleRefraction(refractionSamplerLow,refractionCoords),\nlodRefractionNormalizedDoubled-1.0\n);\n}\n#endif\n#ifdef SS_RGBDREFRACTION\nenvironmentRefraction.rgb=fromRGBD(environmentRefraction);\n#endif\n#ifdef SS_GAMMAREFRACTION\nenvironmentRefraction.rgb=toLinearSpace(environmentRefraction.rgb);\n#endif\n\nenvironmentRefraction.rgb*=vRefractionInfos.x;\n#endif\n\n#ifdef REFLECTION\nvec4 environmentRadiance=vec4(0.,0.,0.,0.);\nvec3 environmentIrradiance=vec3(0.,0.,0.);\n#ifdef ANISOTROPIC\nvec3 reflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),anisotropicNormal);\n#else\nvec3 reflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#endif\n#ifdef REFLECTIONMAP_OPPOSITEZ\nreflectionVector.z*=-1.0;\n#endif\n\n#ifdef REFLECTIONMAP_3D\nvec3 reflectionCoords=reflectionVector;\n#else\nvec2 reflectionCoords=reflectionVector.xy;\n#ifdef REFLECTIONMAP_PROJECTION\nreflectionCoords/=reflectionVector.z;\n#endif\nreflectionCoords.y=1.0-reflectionCoords.y;\n#endif\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nfloat reflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,alphaG,NdotVUnclamped);\n#elif defined(LINEARSPECULARREFLECTION)\nfloat reflectionLOD=getLinearLodFromRoughness(vReflectionMicrosurfaceInfos.x,roughness);\n#else\nfloat reflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,alphaG);\n#endif\n#ifdef LODBASEDMICROSFURACE\n\nreflectionLOD=reflectionLOD*vReflectionMicrosurfaceInfos.y+vReflectionMicrosurfaceInfos.z;\n#ifdef LODINREFLECTIONALPHA\n\n\n\n\n\n\n\n\n\nfloat automaticReflectionLOD=UNPACK_LOD(sampleReflection(reflectionSampler,reflectionCoords).a);\nfloat requestedReflectionLOD=max(automaticReflectionLOD,reflectionLOD);\n#else\nfloat requestedReflectionLOD=reflectionLOD;\n#endif\nenvironmentRadiance=sampleReflectionLod(reflectionSampler,reflectionCoords,requestedReflectionLOD);\n#else\nfloat lodReflectionNormalized=saturate(reflectionLOD/log2(vReflectionMicrosurfaceInfos.x));\nfloat lodReflectionNormalizedDoubled=lodReflectionNormalized*2.0;\nvec4 environmentSpecularMid=sampleReflection(reflectionSampler,reflectionCoords);\nif(lodReflectionNormalizedDoubled<1.0){\nenvironmentRadiance=mix(\nsampleReflection(reflectionSamplerHigh,reflectionCoords),\nenvironmentSpecularMid,\nlodReflectionNormalizedDoubled\n);\n}else{\nenvironmentRadiance=mix(\nenvironmentSpecularMid,\nsampleReflection(reflectionSamplerLow,reflectionCoords),\nlodReflectionNormalizedDoubled-1.0\n);\n}\n#endif\n#ifdef RGBDREFLECTION\nenvironmentRadiance.rgb=fromRGBD(environmentRadiance);\n#endif\n#ifdef GAMMAREFLECTION\nenvironmentRadiance.rgb=toLinearSpace(environmentRadiance.rgb);\n#endif\n\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if defined(NORMAL) && defined(USESPHERICALINVERTEX)\nenvironmentIrradiance=vEnvironmentIrradiance;\n#else\n#ifdef ANISOTROPIC\nvec3 irradianceVector=vec3(reflectionMatrix*vec4(anisotropicNormal,0)).xyz;\n#else\nvec3 irradianceVector=vec3(reflectionMatrix*vec4(normalW,0)).xyz;\n#endif\n#ifdef REFLECTIONMAP_OPPOSITEZ\nirradianceVector.z*=-1.0;\n#endif\nenvironmentIrradiance=computeEnvironmentIrradiance(irradianceVector);\n#endif\n#elif defined(USEIRRADIANCEMAP)\nenvironmentIrradiance=sampleReflection(irradianceSampler,reflectionCoords).rgb;\n#ifdef RGBDREFLECTION\nenvironmentIrradiance.rgb=fromRGBD(environmentIrradiance);\n#endif\n#ifdef GAMMAREFLECTION\nenvironmentIrradiance.rgb=toLinearSpace(environmentIrradiance.rgb);\n#endif\n#endif\n\nenvironmentRadiance.rgb*=vReflectionInfos.x;\nenvironmentRadiance.rgb*=vReflectionColor.rgb;\nenvironmentIrradiance*=vReflectionColor.rgb;\n#endif\n\nfloat reflectance=max(max(surfaceReflectivityColor.r,surfaceReflectivityColor.g),surfaceReflectivityColor.b);\nfloat reflectance90=fresnelGrazingReflectance(reflectance);\nvec3 specularEnvironmentR0=surfaceReflectivityColor.rgb;\nvec3 specularEnvironmentR90=vec3(1.0,1.0,1.0)*reflectance90;\n\n#ifdef SHEEN\nfloat sheenIntensity=vSheenColor.a;\n#ifdef SHEEN_TEXTURE\nvec4 sheenMapData=texture2D(sheenSampler,vSheenUV+uvOffset)*vSheenInfos.y;\nsheenIntensity*=sheenMapData.a;\n#endif\n#ifdef SHEEN_LINKWITHALBEDO\nfloat sheenFactor=pow5(1.0-sheenIntensity);\nvec3 sheenColor=baseColor.rgb*(1.0-sheenFactor);\nfloat sheenRoughness=sheenIntensity;\n\nsurfaceAlbedo.rgb*=sheenFactor;\n#else\nvec3 sheenColor=vSheenColor.rgb;\n#ifdef SHEEN_TEXTURE\nsheenColor.rgb*=toLinearSpace(sheenMapData.rgb);\n#endif\nfloat sheenRoughness=roughness;\n\nsheenIntensity*=(1.-reflectance);\n\nsheenColor*=sheenIntensity;\n#endif\n\n#if defined(REFLECTION)\nfloat sheenAlphaG=convertRoughnessToAverageSlope(sheenRoughness);\n#ifdef SPECULARAA\n\nsheenAlphaG+=AARoughnessFactors.y;\n#endif\nvec4 environmentSheenRadiance=vec4(0.,0.,0.,0.);\n\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nfloat sheenReflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,sheenAlphaG,NdotVUnclamped);\n#elif defined(LINEARSPECULARREFLECTION)\nfloat sheenReflectionLOD=getLinearLodFromRoughness(vReflectionMicrosurfaceInfos.x,sheenRoughness);\n#else\nfloat sheenReflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,sheenAlphaG);\n#endif\n#ifdef LODBASEDMICROSFURACE\n\nsheenReflectionLOD=sheenReflectionLOD*vReflectionMicrosurfaceInfos.y+vReflectionMicrosurfaceInfos.z;\nenvironmentSheenRadiance=sampleReflectionLod(reflectionSampler,reflectionCoords,sheenReflectionLOD);\n#else\nfloat lodSheenReflectionNormalized=saturate(sheenReflectionLOD/log2(vReflectionMicrosurfaceInfos.x));\nfloat lodSheenReflectionNormalizedDoubled=lodSheenReflectionNormalized*2.0;\nvec4 environmentSheenMid=sampleReflection(reflectionSampler,reflectionCoords);\nif(lodSheenReflectionNormalizedDoubled<1.0){\nenvironmentSheenRadiance=mix(\nsampleReflection(reflectionSamplerHigh,reflectionCoords),\nenvironmentSheenMid,\nlodSheenReflectionNormalizedDoubled\n);\n}else{\nenvironmentSheenRadiance=mix(\nenvironmentSheenMid,\nsampleReflection(reflectionSamplerLow,reflectionCoords),\nlodSheenReflectionNormalizedDoubled-1.0\n);\n}\n#endif\n#ifdef RGBDREFLECTION\nenvironmentSheenRadiance.rgb=fromRGBD(environmentSheenRadiance);\n#endif\n#ifdef GAMMAREFLECTION\nenvironmentSheenRadiance.rgb=toLinearSpace(environmentSheenRadiance.rgb);\n#endif\n\nenvironmentSheenRadiance.rgb*=vReflectionInfos.x;\nenvironmentSheenRadiance.rgb*=vReflectionColor.rgb;\n#endif\n#endif\n\n#ifdef CLEARCOAT\n\nfloat clearCoatIntensity=vClearCoatParams.x;\nfloat clearCoatRoughness=vClearCoatParams.y;\n#ifdef CLEARCOAT_TEXTURE\nvec2 clearCoatMapData=texture2D(clearCoatSampler,vClearCoatUV+uvOffset).rg*vClearCoatInfos.y;\nclearCoatIntensity*=clearCoatMapData.x;\nclearCoatRoughness*=clearCoatMapData.y;\n#endif\n#ifdef CLEARCOAT_TINT\nvec3 clearCoatColor=vClearCoatTintParams.rgb;\nfloat clearCoatThickness=vClearCoatTintParams.a;\n#ifdef CLEARCOAT_TINT_TEXTURE\nvec4 clearCoatTintMapData=texture2D(clearCoatTintSampler,vClearCoatTintUV+uvOffset);\nclearCoatColor*=toLinearSpace(clearCoatTintMapData.rgb);\nclearCoatThickness*=clearCoatTintMapData.a;\n#endif\nclearCoatColor=computeColorAtDistanceInMedia(clearCoatColor,clearCoatColorAtDistance);\n#endif\n\n\n\n\nvec3 specularEnvironmentR0Updated=getR0RemappedForClearCoat(specularEnvironmentR0);\nspecularEnvironmentR0=mix(specularEnvironmentR0,specularEnvironmentR0Updated,clearCoatIntensity);\n#ifdef CLEARCOAT_BUMP\n#ifdef NORMALXYSCALE\nfloat clearCoatNormalScale=1.0;\n#else\nfloat clearCoatNormalScale=vClearCoatBumpInfos.y;\n#endif\n#if defined(TANGENT) && defined(NORMAL)\nmat3 TBNClearCoat=vTBN;\n#else\nmat3 TBNClearCoat=cotangent_frame(clearCoatNormalW*clearCoatNormalScale,vPositionW,vClearCoatBumpUV,vClearCoatTangentSpaceParams);\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\nclearCoatNormalW=normalize(texture2D(clearCoatBumpSampler,vClearCoatBumpUV+uvOffset).xyz*2.0-1.0);\nclearCoatNormalW=normalize(mat3(normalMatrix)*clearCoatNormalW);\n#else\nclearCoatNormalW=perturbNormal(TBNClearCoat,texture2D(clearCoatBumpSampler,vClearCoatBumpUV+uvOffset).xyz,vClearCoatBumpInfos.y);\n#endif\n#endif\n#if defined(FORCENORMALFORWARD) && defined(NORMAL)\nclearCoatNormalW*=sign(dot(clearCoatNormalW,faceNormal));\n#endif\n#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)\nclearCoatNormalW=gl_FrontFacing ? clearCoatNormalW : -clearCoatNormalW;\n#endif\n\nvec2 clearCoatAARoughnessFactors=getAARoughnessFactors(clearCoatNormalW.xyz);\n\nfloat clearCoatNdotVUnclamped=dot(clearCoatNormalW,viewDirectionW);\n\nfloat clearCoatNdotV=absEps(clearCoatNdotVUnclamped);\n#ifdef CLEARCOAT_TINT\n\nvec3 clearCoatVRefract=-refract(vPositionW,clearCoatNormalW,vClearCoatRefractionParams.y);\n\nfloat clearCoatNdotVRefract=absEps(dot(clearCoatNormalW,clearCoatVRefract));\nvec3 absorption=vec3(0.);\n#endif\n\n#if defined(REFLECTION)\nfloat clearCoatAlphaG=convertRoughnessToAverageSlope(clearCoatRoughness);\n#ifdef SPECULARAA\n\nclearCoatAlphaG+=clearCoatAARoughnessFactors.y;\n#endif\nvec4 environmentClearCoatRadiance=vec4(0.,0.,0.,0.);\nvec3 clearCoatReflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),clearCoatNormalW);\n#ifdef REFLECTIONMAP_OPPOSITEZ\nclearCoatReflectionVector.z*=-1.0;\n#endif\n\n#ifdef REFLECTIONMAP_3D\nvec3 clearCoatReflectionCoords=clearCoatReflectionVector;\n#else\nvec2 clearCoatReflectionCoords=clearCoatReflectionVector.xy;\n#ifdef REFLECTIONMAP_PROJECTION\nclearCoatReflectionCoords/=clearCoatReflectionVector.z;\n#endif\nclearCoatReflectionCoords.y=1.0-clearCoatReflectionCoords.y;\n#endif\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nfloat clearCoatReflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,clearCoatAlphaG,clearCoatNdotVUnclamped);\n#elif defined(LINEARSPECULARREFLECTION)\nfloat sheenReflectionLOD=getLinearLodFromRoughness(vReflectionMicrosurfaceInfos.x,clearCoatRoughness);\n#else\nfloat clearCoatReflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,clearCoatAlphaG);\n#endif\n#ifdef LODBASEDMICROSFURACE\n\nclearCoatReflectionLOD=clearCoatReflectionLOD*vReflectionMicrosurfaceInfos.y+vReflectionMicrosurfaceInfos.z;\nfloat requestedClearCoatReflectionLOD=clearCoatReflectionLOD;\nenvironmentClearCoatRadiance=sampleReflectionLod(reflectionSampler,clearCoatReflectionCoords,requestedClearCoatReflectionLOD);\n#else\nfloat lodClearCoatReflectionNormalized=saturate(clearCoatReflectionLOD/log2(vReflectionMicrosurfaceInfos.x));\nfloat lodClearCoatReflectionNormalizedDoubled=lodClearCoatReflectionNormalized*2.0;\nvec4 environmentClearCoatMid=sampleReflection(reflectionSampler,reflectionCoords);\nif(lodClearCoatReflectionNormalizedDoubled<1.0){\nenvironmentClearCoatRadiance=mix(\nsampleReflection(reflectionSamplerHigh,clearCoatReflectionCoords),\nenvironmentClearCoatMid,\nlodClearCoatReflectionNormalizedDoubled\n);\n}else{\nenvironmentClearCoatRadiance=mix(\nenvironmentClearCoatMid,\nsampleReflection(reflectionSamplerLow,clearCoatReflectionCoords),\nlodClearCoatReflectionNormalizedDoubled-1.0\n);\n}\n#endif\n#ifdef RGBDREFLECTION\nenvironmentClearCoatRadiance.rgb=fromRGBD(environmentClearCoatRadiance);\n#endif\n#ifdef GAMMAREFLECTION\nenvironmentClearCoatRadiance.rgb=toLinearSpace(environmentClearCoatRadiance.rgb);\n#endif\n\nenvironmentClearCoatRadiance.rgb*=vReflectionInfos.x;\nenvironmentClearCoatRadiance.rgb*=vReflectionColor.rgb;\n#endif\n#endif\n\n#if defined(ENVIRONMENTBRDF)\n\nvec3 environmentBrdf=getBRDFLookup(NdotV,roughness);\n#ifdef MS_BRDF_ENERGY_CONSERVATION\nvec3 energyConservationFactor=getEnergyConservationFactor(specularEnvironmentR0,environmentBrdf);\n#endif\n#endif\n\n#ifdef SUBSURFACE\n#ifdef SS_REFRACTION\nfloat refractionIntensity=vSubSurfaceIntensity.x;\n#ifdef SS_LINKREFRACTIONTOTRANSPARENCY\nrefractionIntensity*=(1.0-alpha);\n\nalpha=1.0;\n#endif\n#endif\n#ifdef SS_TRANSLUCENCY\nfloat translucencyIntensity=vSubSurfaceIntensity.y;\n#endif\n#ifdef SS_SCATTERING\nfloat scatteringIntensity=vSubSurfaceIntensity.z;\n#endif\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nvec4 thicknessMap=texture2D(thicknessSampler,vThicknessUV+uvOffset);\nfloat thickness=thicknessMap.r*vThicknessParam.y+vThicknessParam.x;\n#ifdef SS_MASK_FROM_THICKNESS_TEXTURE\n#ifdef SS_REFRACTION\nrefractionIntensity*=thicknessMap.g;\n#endif\n#ifdef SS_TRANSLUCENCY\ntranslucencyIntensity*=thicknessMap.b;\n#endif\n#ifdef SS_SCATTERING\nscatteringIntensity*=thicknessMap.a;\n#endif\n#endif\n#else\nfloat thickness=vThicknessParam.y;\n#endif\n#ifdef SS_TRANSLUCENCY\nthickness=maxEps(thickness);\nvec3 transmittance=transmittanceBRDF_Burley(vTintColor.rgb,vDiffusionDistance,thickness);\ntransmittance*=translucencyIntensity;\n#endif\n#endif\n\n\nvec3 diffuseBase=vec3(0.,0.,0.);\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\n#ifdef CLEARCOAT\nvec3 clearCoatBase=vec3(0.,0.,0.);\n#endif\n#ifdef SHEEN\nvec3 sheenBase=vec3(0.,0.,0.);\n#endif\n#ifdef LIGHTMAP\nvec4 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset);\n#ifdef RGBDLIGHTMAP\nlightmapColor.rgb=fromRGBD(lightmapColor);\n#endif\n#ifdef GAMMALIGHTMAP\nlightmapColor.rgb=toLinearSpace(lightmapColor.rgb);\n#endif\nlightmapColor.rgb*=vLightmapInfos.y;\n#endif\n\npreLightingInfo preInfo;\nlightingInfo info;\nfloat shadow=1.;\n#include<lightFragment>[0..maxSimultaneousLights]\n\n#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\nvec3 specularEnvironmentReflectance=getReflectanceFromBRDFLookup(specularEnvironmentR0,environmentBrdf);\n#ifdef RADIANCEOCCLUSION\n#ifdef AMBIENTINGRAYSCALE\nfloat ambientMonochrome=ambientOcclusionColor.r;\n#else\nfloat ambientMonochrome=getLuminance(ambientOcclusionColor);\n#endif\nfloat seo=environmentRadianceOcclusion(ambientMonochrome,NdotVUnclamped);\nspecularEnvironmentReflectance*=seo;\n#endif\n#ifdef HORIZONOCCLUSION\n#ifdef BUMP\n#ifdef REFLECTIONMAP_3D\nfloat eho=environmentHorizonOcclusion(-viewDirectionW,normalW);\nspecularEnvironmentReflectance*=eho;\n#endif\n#endif\n#endif\n#else\n\nvec3 specularEnvironmentReflectance=getReflectanceFromAnalyticalBRDFLookup_Jones(NdotV,specularEnvironmentR0,specularEnvironmentR90,sqrt(microSurface));\n#endif\n\n#if defined(SHEEN) && defined(REFLECTION)\nvec3 sheenEnvironmentReflectance=getSheenReflectanceFromBRDFLookup(sheenColor,environmentBrdf);\n#ifdef RADIANCEOCCLUSION\nsheenEnvironmentReflectance*=seo;\n#endif\n#ifdef HORIZONOCCLUSION\n#ifdef BUMP\n#ifdef REFLECTIONMAP_3D\nsheenEnvironmentReflectance*=eho;\n#endif\n#endif\n#endif\n#endif\n\n#ifdef CLEARCOAT\n#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\n\nvec3 environmentClearCoatBrdf=getBRDFLookup(clearCoatNdotV,clearCoatRoughness);\nvec3 clearCoatEnvironmentReflectance=getReflectanceFromBRDFLookup(vec3(vClearCoatRefractionParams.x),environmentClearCoatBrdf);\n#ifdef RADIANCEOCCLUSION\nfloat clearCoatSeo=environmentRadianceOcclusion(ambientMonochrome,clearCoatNdotVUnclamped);\nclearCoatEnvironmentReflectance*=clearCoatSeo;\n#endif\n#ifdef HORIZONOCCLUSION\n#ifdef BUMP\n#ifdef REFLECTIONMAP_3D\nfloat clearCoatEho=environmentHorizonOcclusion(-viewDirectionW,clearCoatNormalW);\nclearCoatEnvironmentReflectance*=clearCoatEho;\n#endif\n#endif\n#endif\n#else\n\nvec3 clearCoatEnvironmentReflectance=getReflectanceFromAnalyticalBRDFLookup_Jones(clearCoatNdotV,vec3(1.),vec3(1.),sqrt(1.-clearCoatRoughness));\n#endif\nclearCoatEnvironmentReflectance*=clearCoatIntensity;\n#if defined(CLEARCOAT_TINT)\n\nabsorption=computeClearCoatAbsorption(clearCoatNdotVRefract,clearCoatNdotVRefract,clearCoatColor,clearCoatThickness,clearCoatIntensity);\n#ifdef REFLECTION\nenvironmentIrradiance*=absorption;\n#ifdef SHEEN\nsheenEnvironmentReflectance*=absorption;\n#endif\n#endif\nspecularEnvironmentReflectance*=absorption;\n#endif\n\nfloat fresnelIBLClearCoat=fresnelSchlickGGX(clearCoatNdotV,vClearCoatRefractionParams.x,CLEARCOATREFLECTANCE90);\nfresnelIBLClearCoat*=clearCoatIntensity;\nfloat conservationFactor=(1.-fresnelIBLClearCoat);\n#ifdef REFLECTION\nenvironmentIrradiance*=conservationFactor;\n#ifdef SHEEN\nsheenEnvironmentReflectance*=conservationFactor;\n#endif\n#endif\nspecularEnvironmentReflectance*=conservationFactor;\n#endif\n\n#ifdef SS_REFRACTION\nvec3 refractionTransmittance=vec3(refractionIntensity);\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nvec3 volumeAlbedo=computeColorAtDistanceInMedia(vTintColor.rgb,vTintColor.w);\n\n\n\n\n\nrefractionTransmittance*=cocaLambert(volumeAlbedo,thickness);\n#elif defined(SS_LINKREFRACTIONTOTRANSPARENCY)\n\nfloat maxChannel=max(max(surfaceAlbedo.r,surfaceAlbedo.g),surfaceAlbedo.b);\nvec3 volumeAlbedo=saturate(maxChannel*surfaceAlbedo);\n\nenvironmentRefraction.rgb*=volumeAlbedo;\n#else\n\nvec3 volumeAlbedo=computeColorAtDistanceInMedia(vTintColor.rgb,vTintColor.w);\nrefractionTransmittance*=cocaLambert(volumeAlbedo,vThicknessParam.y);\n#endif\n\nsurfaceAlbedo*=(1.-refractionIntensity);\n#ifdef REFLECTION\n\nenvironmentIrradiance*=(1.-refractionIntensity);\n#endif\n\nvec3 bounceSpecularEnvironmentReflectance=(2.0*specularEnvironmentReflectance)/(1.0+specularEnvironmentReflectance);\nspecularEnvironmentReflectance=mix(bounceSpecularEnvironmentReflectance,specularEnvironmentReflectance,refractionIntensity);\n\nrefractionTransmittance*=1.0-specularEnvironmentReflectance;\n#endif\n\n#if defined(REFLECTION) && defined(SS_TRANSLUCENCY)\n#if defined(USESPHERICALINVERTEX)\nvec3 irradianceVector=vec3(reflectionMatrix*vec4(normalW,0)).xyz;\n#ifdef REFLECTIONMAP_OPPOSITEZ\nirradianceVector.z*=-1.0;\n#endif\n#endif\n#if defined(USESPHERICALFROMREFLECTIONMAP)\nvec3 refractionIrradiance=computeEnvironmentIrradiance(-irradianceVector);\n#elif defined(USEIRRADIANCEMAP)\nvec3 refractionIrradiance=sampleReflection(irradianceSampler,-irradianceVector).rgb;\n#ifdef RGBDREFLECTION\nrefractionIrradiance.rgb=fromRGBD(refractionIrradiance);\n#endif\n#ifdef GAMMAREFLECTION\nrefractionIrradiance.rgb=toLinearSpace(refractionIrradiance.rgb);\n#endif\n#else\nvec3 refractionIrradiance=vec3(0.);\n#endif\nrefractionIrradiance*=transmittance;\n#endif\n\n\n\n#ifndef METALLICWORKFLOW\n#ifdef SPECULAR_GLOSSINESS_ENERGY_CONSERVATION\nsurfaceAlbedo.rgb=(1.-reflectance)*surfaceAlbedo.rgb;\n#endif\n#endif\n\n#ifdef REFLECTION\nvec3 finalIrradiance=environmentIrradiance;\n#if defined(SS_TRANSLUCENCY)\nfinalIrradiance+=refractionIrradiance;\n#endif\nfinalIrradiance*=surfaceAlbedo.rgb;\n#endif\n\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase;\nfinalSpecular=max(finalSpecular,0.0);\n\nvec3 finalSpecularScaled=finalSpecular*vLightingIntensity.x*vLightingIntensity.w;\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\nfinalSpecularScaled*=energyConservationFactor;\n#endif\n#endif\n\n#ifdef REFLECTION\nvec3 finalRadiance=environmentRadiance.rgb;\nfinalRadiance*=specularEnvironmentReflectance;\n\nvec3 finalRadianceScaled=finalRadiance*vLightingIntensity.z;\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\nfinalRadianceScaled*=energyConservationFactor;\n#endif\n#endif\n\n#ifdef SS_REFRACTION\nvec3 finalRefraction=environmentRefraction.rgb;\nfinalRefraction*=refractionTransmittance;\n#endif\n\n#ifdef CLEARCOAT\nvec3 finalClearCoat=clearCoatBase;\nfinalClearCoat=max(finalClearCoat,0.0);\n\nvec3 finalClearCoatScaled=finalClearCoat*vLightingIntensity.x*vLightingIntensity.w;\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\nfinalClearCoatScaled*=energyConservationFactor;\n#endif\n\n#ifdef REFLECTION\nvec3 finalClearCoatRadiance=environmentClearCoatRadiance.rgb;\nfinalClearCoatRadiance*=clearCoatEnvironmentReflectance;\n\nvec3 finalClearCoatRadianceScaled=finalClearCoatRadiance*vLightingIntensity.z;\n#endif\n#ifdef SS_REFRACTION\nfinalRefraction*=conservationFactor;\n#ifdef CLEARCOAT_TINT\nfinalRefraction*=absorption;\n#endif\n#endif\n#endif\n\n#ifdef SHEEN\nvec3 finalSheen=sheenBase*sheenColor;\nfinalSheen=max(finalSheen,0.0);\nvec3 finalSheenScaled=finalSheen*vLightingIntensity.x*vLightingIntensity.w;\n\n\n\n\n\n#ifdef REFLECTION\nvec3 finalSheenRadiance=environmentSheenRadiance.rgb;\nfinalSheenRadiance*=sheenEnvironmentReflectance;\n\nvec3 finalSheenRadianceScaled=finalSheenRadiance*vLightingIntensity.z;\n#endif\n#endif\n\n#ifdef ALPHABLEND\nfloat luminanceOverAlpha=0.0;\n#if defined(REFLECTION) && defined(RADIANCEOVERALPHA)\nluminanceOverAlpha+=getLuminance(finalRadianceScaled);\n#if defined(CLEARCOAT)\nluminanceOverAlpha+=getLuminance(finalClearCoatRadianceScaled);\n#endif\n#endif\n#if defined(SPECULARTERM) && defined(SPECULAROVERALPHA)\nluminanceOverAlpha+=getLuminance(finalSpecularScaled);\n#endif\n#if defined(CLEARCOAT) && defined(CLEARCOATOVERALPHA)\nluminanceOverAlpha+=getLuminance(finalClearCoatScaled);\n#endif\n#if defined(RADIANCEOVERALPHA) || defined(SPECULAROVERALPHA)\nalpha=saturate(alpha+luminanceOverAlpha*luminanceOverAlpha);\n#endif\n#endif\n#endif\n\n\nvec3 finalDiffuse=diffuseBase;\nfinalDiffuse*=surfaceAlbedo.rgb;\nfinalDiffuse=max(finalDiffuse,0.0);\n\nvec3 finalAmbient=vAmbientColor;\nfinalAmbient*=surfaceAlbedo.rgb;\n\nvec3 finalEmissive=vEmissiveColor;\n#ifdef EMISSIVE\nvec3 emissiveColorTex=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb;\nfinalEmissive*=toLinearSpace(emissiveColorTex.rgb);\nfinalEmissive*=vEmissiveInfos.y;\n#endif\n\n#ifdef AMBIENT\nvec3 ambientOcclusionForDirectDiffuse=mix(vec3(1.),ambientOcclusionColor,vAmbientInfos.w);\n#else\nvec3 ambientOcclusionForDirectDiffuse=ambientOcclusionColor;\n#endif\n\n\n\nvec4 finalColor=vec4(\nfinalAmbient*ambientOcclusionColor +\nfinalDiffuse*ambientOcclusionForDirectDiffuse*vLightingIntensity.x +\n#ifndef UNLIT\n#ifdef REFLECTION\nfinalIrradiance*ambientOcclusionColor*vLightingIntensity.z +\n#endif\n#ifdef SPECULARTERM\n\n\nfinalSpecularScaled +\n#endif\n#ifdef CLEARCOAT\n\n\nfinalClearCoatScaled +\n#endif\n#ifdef SHEEN\n\n\nfinalSheenScaled +\n#endif\n#ifdef REFLECTION\n\n\nfinalRadianceScaled +\n#ifdef CLEARCOAT\n\n\nfinalClearCoatRadianceScaled +\n#endif\n#ifdef SHEEN\n\n\nfinalSheenRadianceScaled +\n#endif\n#endif\n#ifdef SS_REFRACTION\nfinalRefraction*vLightingIntensity.z +\n#endif\n#endif\nfinalEmissive*vLightingIntensity.y,\nalpha);\n\n#ifdef LIGHTMAP\n#ifndef LIGHTMAPEXCLUDED\n#ifdef USELIGHTMAPASSHADOWMAP\nfinalColor.rgb*=lightmapColor.rgb;\n#else\nfinalColor.rgb+=lightmapColor.rgb;\n#endif\n#endif\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_FOG\n\nfinalColor=max(finalColor,0.0);\n#include<logDepthFragment>\n#include<fogFragment>(color,finalColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\n\n\nfinalColor.rgb=clamp(finalColor.rgb,0.,30.0);\n#else\n\nfinalColor=applyImageProcessing(finalColor);\n#endif\nfinalColor.a*=visibility;\n#ifdef PREMULTIPLYALPHA\n\nfinalColor.rgb*=finalColor.a;\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR\ngl_FragColor=finalColor;\n#include<pbrDebug>\n}\n",li.a.IncludesShadersStore.pbrVertexDeclaration="uniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef ALBEDO\nuniform mat4 albedoMatrix;\nuniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nuniform mat4 ambientMatrix;\nuniform vec4 vAmbientInfos;\n#endif\n#ifdef OPACITY\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\nuniform mat4 lightmapMatrix;\n#endif\n#ifdef REFLECTIVITY\nuniform vec3 vReflectivityInfos;\nuniform mat4 reflectivityMatrix;\n#endif\n#ifdef MICROSURFACEMAP\nuniform vec2 vMicroSurfaceSamplerInfos;\nuniform mat4 microSurfaceSamplerMatrix;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform mat4 bumpMatrix;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\nuniform mat4 reflectionMatrix;\n#endif\n\n#ifdef CLEARCOAT\n#ifdef CLEARCOAT_TEXTURE\nuniform vec2 vClearCoatInfos;\nuniform mat4 clearCoatMatrix;\n#endif\n#ifdef CLEARCOAT_BUMP\nuniform vec2 vClearCoatBumpInfos;\nuniform mat4 clearCoatBumpMatrix;\n#endif\n#ifdef CLEARCOAT_TINT_TEXTURE\nuniform vec2 vClearCoatTintInfos;\nuniform mat4 clearCoatTintMatrix;\n#endif\n#endif\n\n#ifdef ANISOTROPIC\n#ifdef ANISOTROPIC_TEXTURE\nuniform vec2 vAnisotropyInfos;\nuniform mat4 anisotropyMatrix;\n#endif\n#endif\n\n#ifdef SHEEN\n#ifdef SHEEN_TEXTURE\nuniform vec2 vSheenInfos;\nuniform mat4 sheenMatrix;\n#endif\n#endif\n\n#ifdef SUBSURFACE\n#ifdef SS_REFRACTION\nuniform vec4 vRefractionInfos;\nuniform mat4 refractionMatrix;\n#endif\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nuniform vec2 vThicknessInfos;\nuniform mat4 thicknessMatrix;\n#endif\n#endif\n",N(147),N(88),N(89),N(94),N(141),N(143),li.a.ShadersStore.pbrVertexShader="precision highp float;\n#include<__decl__pbrVertex>\n#define CUSTOM_VERTEX_BEGIN\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef TANGENT\nattribute vec4 tangent;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif\n#ifdef MAINUV2\nvarying vec2 vMainUV2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<helperFunctions>\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\n#if defined(ALBEDO) && ALBEDODIRECTUV == 0\nvarying vec2 vAlbedoUV;\n#endif\n#if defined(AMBIENT) && AMBIENTDIRECTUV == 0\nvarying vec2 vAmbientUV;\n#endif\n#if defined(OPACITY) && OPACITYDIRECTUV == 0\nvarying vec2 vOpacityUV;\n#endif\n#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0\nvarying vec2 vEmissiveUV;\n#endif\n#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0\nvarying vec2 vLightmapUV;\n#endif\n#if defined(REFLECTIVITY) && REFLECTIVITYDIRECTUV == 0\nvarying vec2 vReflectivityUV;\n#endif\n#if defined(MICROSURFACEMAP) && MICROSURFACEMAPDIRECTUV == 0\nvarying vec2 vMicroSurfaceSamplerUV;\n#endif\n#if defined(BUMP) && BUMPDIRECTUV == 0\nvarying vec2 vBumpUV;\n#endif\n#ifdef CLEARCOAT\n#if defined(CLEARCOAT_TEXTURE) && CLEARCOAT_TEXTUREDIRECTUV == 0\nvarying vec2 vClearCoatUV;\n#endif\n#if defined(CLEARCOAT_BUMP) && CLEARCOAT_BUMPDIRECTUV == 0\nvarying vec2 vClearCoatBumpUV;\n#endif\n#if defined(CLEARCOAT_TINT_TEXTURE) && CLEARCOAT_TINT_TEXTUREDIRECTUV == 0\nvarying vec2 vClearCoatTintUV;\n#endif\n#endif\n#ifdef SHEEN\n#if defined(SHEEN_TEXTURE) && SHEEN_TEXTUREDIRECTUV == 0\nvarying vec2 vSheenUV;\n#endif\n#endif\n#ifdef ANISOTROPIC\n#if defined(ANISOTROPIC_TEXTURE) && ANISOTROPIC_TEXTUREDIRECTUV == 0\nvarying vec2 vAnisotropyUV;\n#endif\n#endif\n#ifdef SUBSURFACE\n#if defined(SS_THICKNESSANDMASK_TEXTURE) && SS_THICKNESSANDMASK_TEXTUREDIRECTUV == 0\nvarying vec2 vThicknessUV;\n#endif\n#endif\n\nvarying vec3 vPositionW;\n#if DEBUGMODE>0\nvarying vec4 vClipSpacePosition;\n#endif\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvarying vec3 vEnvironmentIrradiance;\n#include<harmonicsFunctions>\n#endif\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<bumpVertexDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#include<logDepthDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec3 positionUpdated=position;\n#ifdef NORMAL\nvec3 normalUpdated=normal;\n#endif\n#ifdef TANGENT\nvec4 tangentUpdated=tangent;\n#endif\n#ifdef UV1\nvec2 uvUpdated=uv;\n#endif\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvPositionUVW=positionUpdated;\n#endif\n#define CUSTOM_VERTEX_UPDATE_POSITION\n#define CUSTOM_VERTEX_UPDATE_NORMAL\n#include<instancesVertex>\n#include<bonesVertex>\n#ifdef MULTIVIEW\nif (gl_ViewID_OVR == 0u) {\ngl_Position=viewProjection*finalWorld*vec4(positionUpdated,1.0);\n} else {\ngl_Position=viewProjectionR*finalWorld*vec4(positionUpdated,1.0);\n}\n#else\ngl_Position=viewProjection*finalWorld*vec4(positionUpdated,1.0);\n#endif\n#if DEBUGMODE>0\nvClipSpacePosition=gl_Position;\n#endif\nvec4 worldPos=finalWorld*vec4(positionUpdated,1.0);\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nmat3 normalWorld=mat3(finalWorld);\n#ifdef NONUNIFORMSCALING\nnormalWorld=transposeMat3(inverseMat3(normalWorld));\n#endif\nvNormalW=normalize(normalWorld*normalUpdated);\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvec3 reflectionVector=vec3(reflectionMatrix*vec4(vNormalW,0)).xyz;\n#ifdef REFLECTIONMAP_OPPOSITEZ\nreflectionVector.z*=-1.0;\n#endif\nvEnvironmentIrradiance=computeEnvironmentIrradiance(reflectionVector);\n#endif\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvDirectionW=normalize(vec3(finalWorld*vec4(positionUpdated,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uvUpdated=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef MAINUV1\nvMainUV1=uvUpdated;\n#endif\n#ifdef MAINUV2\nvMainUV2=uv2;\n#endif\n#if defined(ALBEDO) && ALBEDODIRECTUV == 0\nif (vAlbedoInfos.x == 0.)\n{\nvAlbedoUV=vec2(albedoMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvAlbedoUV=vec2(albedoMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(AMBIENT) && AMBIENTDIRECTUV == 0\nif (vAmbientInfos.x == 0.)\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(OPACITY) && OPACITYDIRECTUV == 0\nif (vOpacityInfos.x == 0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0\nif (vEmissiveInfos.x == 0.)\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0\nif (vLightmapInfos.x == 0.)\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(REFLECTIVITY) && REFLECTIVITYDIRECTUV == 0\nif (vReflectivityInfos.x == 0.)\n{\nvReflectivityUV=vec2(reflectivityMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvReflectivityUV=vec2(reflectivityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(MICROSURFACEMAP) && MICROSURFACEMAPDIRECTUV == 0\nif (vMicroSurfaceSamplerInfos.x == 0.)\n{\nvMicroSurfaceSamplerUV=vec2(microSurfaceSamplerMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvMicroSurfaceSamplerUV=vec2(microSurfaceSamplerMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(BUMP) && BUMPDIRECTUV == 0\nif (vBumpInfos.x == 0.)\n{\nvBumpUV=vec2(bumpMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef CLEARCOAT\n#if defined(CLEARCOAT_TEXTURE) && CLEARCOAT_TEXTUREDIRECTUV == 0\nif (vClearCoatInfos.x == 0.)\n{\nvClearCoatUV=vec2(clearCoatMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvClearCoatUV=vec2(clearCoatMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(CLEARCOAT_BUMP) && CLEARCOAT_BUMPDIRECTUV == 0\nif (vClearCoatBumpInfos.x == 0.)\n{\nvClearCoatBumpUV=vec2(clearCoatBumpMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvClearCoatBumpUV=vec2(clearCoatBumpMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(CLEARCOAT_TINT_TEXTURE) && CLEARCOAT_TINT_TEXTUREDIRECTUV == 0\nif (vClearCoatTintInfos.x == 0.)\n{\nvClearCoatTintUV=vec2(clearCoatTintMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvClearCoatTintUV=vec2(clearCoatTintMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#endif\n#ifdef SHEEN\n#if defined(SHEEN_TEXTURE) && SHEEN_TEXTUREDIRECTUV == 0\nif (vSheenInfos.x == 0.)\n{\nvSheenUV=vec2(sheenMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvSheenUV=vec2(sheenMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#endif\n#ifdef ANISOTROPIC\n#if defined(ANISOTROPIC_TEXTURE) && ANISOTROPIC_TEXTUREDIRECTUV == 0\nif (vAnisotropyInfos.x == 0.)\n{\nvAnisotropyUV=vec2(anisotropyMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvAnisotropyUV=vec2(anisotropyMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#endif\n#ifdef SUBSURFACE\n#if defined(SS_THICKNESSANDMASK_TEXTURE) && SS_THICKNESSANDMASK_TEXTUREDIRECTUV == 0\nif (vThicknessInfos.x == 0.)\n{\nvThicknessUV=vec2(thicknessMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvThicknessUV=vec2(thicknessMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#endif\n\n#include<bumpVertex>\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";var fa=function(D){function t(){var w=D.call(this)||this;return w.PBR=!0,w.MAINUV1=!1,w.MAINUV2=!1,w.UV1=!1,w.UV2=!1,w.ALBEDO=!1,w.GAMMAALBEDO=!1,w.ALBEDODIRECTUV=0,w.VERTEXCOLOR=!1,w.AMBIENT=!1,w.AMBIENTDIRECTUV=0,w.AMBIENTINGRAYSCALE=!1,w.OPACITY=!1,w.VERTEXALPHA=!1,w.OPACITYDIRECTUV=0,w.OPACITYRGB=!1,w.ALPHATEST=!1,w.DEPTHPREPASS=!1,w.ALPHABLEND=!1,w.ALPHAFROMALBEDO=!1,w.ALPHATESTVALUE="0.5",w.SPECULAROVERALPHA=!1,w.RADIANCEOVERALPHA=!1,w.ALPHAFRESNEL=!1,w.LINEARALPHAFRESNEL=!1,w.PREMULTIPLYALPHA=!1,w.EMISSIVE=!1,w.EMISSIVEDIRECTUV=0,w.REFLECTIVITY=!1,w.REFLECTIVITYDIRECTUV=0,w.SPECULARTERM=!1,w.MICROSURFACEFROMREFLECTIVITYMAP=!1,w.MICROSURFACEAUTOMATIC=!1,w.LODBASEDMICROSFURACE=!1,w.MICROSURFACEMAP=!1,w.MICROSURFACEMAPDIRECTUV=0,w.METALLICWORKFLOW=!1,w.ROUGHNESSSTOREINMETALMAPALPHA=!1,w.ROUGHNESSSTOREINMETALMAPGREEN=!1,w.METALLNESSSTOREINMETALMAPBLUE=!1,w.AOSTOREINMETALMAPRED=!1,w.METALLICF0FACTORFROMMETALLICMAP=!1,w.ENVIRONMENTBRDF=!1,w.ENVIRONMENTBRDF_RGBD=!1,w.NORMAL=!1,w.TANGENT=!1,w.BUMP=!1,w.BUMPDIRECTUV=0,w.OBJECTSPACE_NORMALMAP=!1,w.PARALLAX=!1,w.PARALLAXOCCLUSION=!1,w.NORMALXYSCALE=!0,w.LIGHTMAP=!1,w.LIGHTMAPDIRECTUV=0,w.USELIGHTMAPASSHADOWMAP=!1,w.GAMMALIGHTMAP=!1,w.RGBDLIGHTMAP=!1,w.REFLECTION=!1,w.REFLECTIONMAP_3D=!1,w.REFLECTIONMAP_SPHERICAL=!1,w.REFLECTIONMAP_PLANAR=!1,w.REFLECTIONMAP_CUBIC=!1,w.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,w.REFLECTIONMAP_PROJECTION=!1,w.REFLECTIONMAP_SKYBOX=!1,w.REFLECTIONMAP_EXPLICIT=!1,w.REFLECTIONMAP_EQUIRECTANGULAR=!1,w.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,w.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,w.INVERTCUBICMAP=!1,w.USESPHERICALFROMREFLECTIONMAP=!1,w.USEIRRADIANCEMAP=!1,w.SPHERICAL_HARMONICS=!1,w.USESPHERICALINVERTEX=!1,w.REFLECTIONMAP_OPPOSITEZ=!1,w.LODINREFLECTIONALPHA=!1,w.GAMMAREFLECTION=!1,w.RGBDREFLECTION=!1,w.LINEARSPECULARREFLECTION=!1,w.RADIANCEOCCLUSION=!1,w.HORIZONOCCLUSION=!1,w.INSTANCES=!1,w.NUM_BONE_INFLUENCERS=0,w.BonesPerMesh=0,w.BONETEXTURE=!1,w.NONUNIFORMSCALING=!1,w.MORPHTARGETS=!1,w.MORPHTARGETS_NORMAL=!1,w.MORPHTARGETS_TANGENT=!1,w.MORPHTARGETS_UV=!1,w.NUM_MORPH_INFLUENCERS=0,w.IMAGEPROCESSING=!1,w.VIGNETTE=!1,w.VIGNETTEBLENDMODEMULTIPLY=!1,w.VIGNETTEBLENDMODEOPAQUE=!1,w.TONEMAPPING=!1,w.TONEMAPPING_ACES=!1,w.CONTRAST=!1,w.COLORCURVES=!1,w.COLORGRADING=!1,w.COLORGRADING3D=!1,w.SAMPLER3DGREENDEPTH=!1,w.SAMPLER3DBGRMAP=!1,w.IMAGEPROCESSINGPOSTPROCESS=!1,w.EXPOSURE=!1,w.MULTIVIEW=!1,w.USEPHYSICALLIGHTFALLOFF=!1,w.USEGLTFLIGHTFALLOFF=!1,w.TWOSIDEDLIGHTING=!1,w.SHADOWFLOAT=!1,w.CLIPPLANE=!1,w.CLIPPLANE2=!1,w.CLIPPLANE3=!1,w.CLIPPLANE4=!1,w.CLIPPLANE5=!1,w.CLIPPLANE6=!1,w.POINTSIZE=!1,w.FOG=!1,w.LOGARITHMICDEPTH=!1,w.FORCENORMALFORWARD=!1,w.SPECULARAA=!1,w.CLEARCOAT=!1,w.CLEARCOAT_DEFAULTIOR=!1,w.CLEARCOAT_TEXTURE=!1,w.CLEARCOAT_TEXTUREDIRECTUV=0,w.CLEARCOAT_BUMP=!1,w.CLEARCOAT_BUMPDIRECTUV=0,w.CLEARCOAT_TINT=!1,w.CLEARCOAT_TINT_TEXTURE=!1,w.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,w.ANISOTROPIC=!1,w.ANISOTROPIC_TEXTURE=!1,w.ANISOTROPIC_TEXTUREDIRECTUV=0,w.BRDF_V_HEIGHT_CORRELATED=!1,w.MS_BRDF_ENERGY_CONSERVATION=!1,w.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1,w.SHEEN=!1,w.SHEEN_TEXTURE=!1,w.SHEEN_TEXTUREDIRECTUV=0,w.SHEEN_LINKWITHALBEDO=!1,w.SUBSURFACE=!1,w.SS_REFRACTION=!1,w.SS_TRANSLUCENCY=!1,w.SS_SCATERRING=!1,w.SS_THICKNESSANDMASK_TEXTURE=!1,w.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,w.SS_REFRACTIONMAP_3D=!1,w.SS_REFRACTIONMAP_OPPOSITEZ=!1,w.SS_LODINREFRACTIONALPHA=!1,w.SS_GAMMAREFRACTION=!1,w.SS_RGBDREFRACTION=!1,w.SS_LINEARSPECULARREFRACTION=!1,w.SS_LINKREFRACTIONTOTRANSPARENCY=!1,w.SS_MASK_FROM_THICKNESS_TEXTURE=!1,w.UNLIT=!1,w.DEBUGMODE=0,w.rebuild(),w}return Object(Z.d)(t,D),t.prototype.reset=function(){D.prototype.reset.call(this),this.ALPHATESTVALUE="0.5",this.PBR=!0},t}(zo.a),pa=function(D){function t(w,N){var F=D.call(this,w,N)||this;return F._directIntensity=1,F._emissiveIntensity=1,F._environmentIntensity=1,F._specularIntensity=1,F._lightingInfos=new z.f(F._directIntensity,F._emissiveIntensity,F._environmentIntensity,F._specularIntensity),F._disableBumpMap=!1,F._albedoTexture=null,F._ambientTexture=null,F._ambientTextureStrength=1,F._ambientTextureImpactOnAnalyticalLights=t.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,F._opacityTexture=null,F._reflectionTexture=null,F._emissiveTexture=null,F._reflectivityTexture=null,F._metallicTexture=null,F._metallic=null,F._roughness=null,F._metallicF0Factor=.5,F._useMetallicF0FactorFromMetallicTexture=!1,F._microSurfaceTexture=null,F._bumpTexture=null,F._lightmapTexture=null,F._ambientColor=new G.a(0,0,0),F._albedoColor=new G.a(1,1,1),F._reflectivityColor=new G.a(1,1,1),F._reflectionColor=new G.a(1,1,1),F._emissiveColor=new G.a(0,0,0),F._microSurface=.9,F._useLightmapAsShadowmap=!1,F._useHorizonOcclusion=!0,F._useRadianceOcclusion=!0,F._useAlphaFromAlbedoTexture=!1,F._useSpecularOverAlpha=!0,F._useMicroSurfaceFromReflectivityMapAlpha=!1,F._useRoughnessFromMetallicTextureAlpha=!0,F._useRoughnessFromMetallicTextureGreen=!1,F._useMetallnessFromMetallicTextureBlue=!1,F._useAmbientOcclusionFromMetallicTextureRed=!1,F._useAmbientInGrayScale=!1,F._useAutoMicroSurfaceFromReflectivityMap=!1,F._lightFalloff=t.LIGHTFALLOFF_PHYSICAL,F._useRadianceOverAlpha=!0,F._useObjectSpaceNormalMap=!1,F._useParallax=!1,F._useParallaxOcclusion=!1,F._parallaxScaleBias=.05,F._disableLighting=!1,F._maxSimultaneousLights=4,F._invertNormalMapX=!1,F._invertNormalMapY=!1,F._twoSidedLighting=!1,F._alphaCutOff=.4,F._forceAlphaTest=!1,F._useAlphaFresnel=!1,F._useLinearAlphaFresnel=!1,F._transparencyMode=null,F._environmentBRDFTexture=null,F._forceIrradianceInFragment=!1,F._forceNormalForward=!1,F._enableSpecularAntiAliasing=!1,F._imageProcessingObserver=null,F._renderTargets=new ui.a(16),F._globalAmbientColor=new G.a(0,0,0),F._useLogarithmicDepth=!1,F._unlit=!1,F._debugMode=0,F.debugMode=0,F.debugLimit=-1,F.debugFactor=1,F.clearCoat=new $o(F._markAllSubMeshesAsTexturesDirty.bind(F)),F.anisotropy=new ra(F._markAllSubMeshesAsTexturesDirty.bind(F)),F.brdf=new aa(F._markAllSubMeshesAsMiscDirty.bind(F)),F.sheen=new la(F._markAllSubMeshesAsTexturesDirty.bind(F)),F.subSurface=new ha(F._markAllSubMeshesAsTexturesDirty.bind(F)),F._rebuildInParallel=!1,F._attachImageProcessingConfiguration(null),F.getRenderTargetTextures=function(){return F._renderTargets.reset(),Ho.a.ReflectionTextureEnabled&&F._reflectionTexture&&F._reflectionTexture.isRenderTarget&&F._renderTargets.push(F._reflectionTexture),F.subSurface.fillRenderTargetTextures(F._renderTargets),F._renderTargets},F._environmentBRDFTexture=Jo.GetEnvironmentBRDFTexture(N),F}return Object(Z.d)(t,D),t.prototype._attachImageProcessingConfiguration=function(D){var w=this;D!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=D||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((function(){w._markAllSubMeshesAsImageProcessingDirty()}))))},Object.defineProperty(t.prototype,"hasRenderTargetTextures",{get:function(){return!!(Ho.a.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this.subSurface.hasRenderTargetTextures()},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"PBRBaseMaterial"},Object.defineProperty(t.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth},set:function(D){this._useLogarithmicDepth=D&&this.getScene().getEngine().getCaps().fragmentDepthSupported},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"transparencyMode",{get:function(){return this._transparencyMode},set:function(D){this._transparencyMode!==D&&(this._transparencyMode=D,this._forceAlphaTest=D===t.PBRMATERIAL_ALPHATESTANDBLEND,this._markAllSubMeshesAsTexturesAndMiscDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_disableAlphaBlending",{get:function(){return this.subSurface.disableAlphaBlending||this._transparencyMode===t.PBRMATERIAL_OPAQUE||this._transparencyMode===t.PBRMATERIAL_ALPHATEST},enumerable:!0,configurable:!0}),t.prototype.needAlphaBlending=function(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())},t.prototype.needAlphaBlendingForMesh=function(w){return!(this._disableAlphaBlending&&w.visibility>=1)&&D.prototype.needAlphaBlendingForMesh.call(this,w)},t.prototype.needAlphaTesting=function(){return!!this._forceAlphaTest||!this.subSurface.disableAlphaBlending&&null!=this._albedoTexture&&this._albedoTexture.hasAlpha&&(null==this._transparencyMode||this._transparencyMode===t.PBRMATERIAL_ALPHATEST)},t.prototype._shouldUseAlphaFromAlbedoTexture=function(){return null!=this._albedoTexture&&this._albedoTexture.hasAlpha&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==t.PBRMATERIAL_OPAQUE},t.prototype.getAlphaTestTexture=function(){return this._albedoTexture},t.prototype.isReadyForSubMesh=function(D,w,N){if(w.effect&&this.isFrozen&&w.effect._wasPreviouslyReady)return!0;w._materialDefines||(w._materialDefines=new fa);var F=w._materialDefines;if(!this.checkReadyOnEveryCall&&w.effect&&F._renderId===this.getScene().getRenderId())return!0;var k=this.getScene(),j=k.getEngine();if(F._areTexturesDirty&&k.texturesEnabled){if(this._albedoTexture&&Ho.a.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&Ho.a.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&Ho.a.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;var z=this._getReflectionTexture();if(z&&Ho.a.ReflectionTextureEnabled){if(!z.isReadyOrNotBlocking())return!1;if(z.irradianceTexture&&!z.irradianceTexture.isReadyOrNotBlocking())return!1}if(this._lightmapTexture&&Ho.a.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&Ho.a.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(Ho.a.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(j.getCaps().standardDerivatives&&this._bumpTexture&&Ho.a.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&Ho.a.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(!(this.subSurface.isReadyForSubMesh(F,k)&&this.clearCoat.isReadyForSubMesh(F,k,j,this._disableBumpMap)&&this.sheen.isReadyForSubMesh(F,k)&&this.anisotropy.isReadyForSubMesh(F,k)))return!1;if(F._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;j.getCaps().standardDerivatives||D.isVerticesDataPresent(Zi.b.NormalKind)||(D.createNormals(!0),oe.a.Warn("PBRMaterial: Normals have been created for the mesh: "+D.name));var G=w.effect,H=F._areLightsDisposed,X=this._prepareEffect(D,F,this.onCompiled,this.onError,N);if(X)if(this.allowShaderHotSwapping&&G&&!X.isReady()){if(X=G,this._rebuildInParallel=!0,F.markAsUnprocessed(),H)return F._areLightsDisposed=!0,!1}else this._rebuildInParallel=!1,k.resetCachedMaterial(),w.setEffect(X,F),this.buildUniformLayout();return!(!w.effect||!w.effect.isReady()||(F._renderId=k.getRenderId(),w.effect._wasPreviouslyReady=!0,0))},t.prototype.isMetallicWorkflow=function(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)},t.prototype._prepareEffect=function(D,w,N,F,k,j){if(void 0===N&&(N=null),void 0===F&&(F=null),void 0===k&&(k=null),void 0===j&&(j=null),this._prepareDefines(D,w,k,j),!w.isDirty)return null;w.markAsProcessed();var z=this.getScene().getEngine(),G=new Wo.a,H=0;w.USESPHERICALINVERTEX&&G.addFallback(H++,"USESPHERICALINVERTEX"),w.FOG&&G.addFallback(H,"FOG"),w.SPECULARAA&&G.addFallback(H,"SPECULARAA"),w.POINTSIZE&&G.addFallback(H,"POINTSIZE"),w.LOGARITHMICDEPTH&&G.addFallback(H,"LOGARITHMICDEPTH"),w.PARALLAX&&G.addFallback(H,"PARALLAX"),w.PARALLAXOCCLUSION&&G.addFallback(H++,"PARALLAXOCCLUSION"),H=ra.AddFallbacks(w,G,H),H=ra.AddFallbacks(w,G,H),H=ha.AddFallbacks(w,G,H),H=la.AddFallbacks(w,G,H),w.ENVIRONMENTBRDF&&G.addFallback(H++,"ENVIRONMENTBRDF"),w.TANGENT&&G.addFallback(H++,"TANGENT"),w.BUMP&&G.addFallback(H++,"BUMP"),H=jo.a.HandleFallbacksForShadows(w,G,this._maxSimultaneousLights,H++),w.SPECULARTERM&&G.addFallback(H++,"SPECULARTERM"),w.USESPHERICALFROMREFLECTIONMAP&&G.addFallback(H++,"USESPHERICALFROMREFLECTIONMAP"),w.USEIRRADIANCEMAP&&G.addFallback(H++,"USEIRRADIANCEMAP"),w.LIGHTMAP&&G.addFallback(H++,"LIGHTMAP"),w.NORMAL&&G.addFallback(H++,"NORMAL"),w.AMBIENT&&G.addFallback(H++,"AMBIENT"),w.EMISSIVE&&G.addFallback(H++,"EMISSIVE"),w.VERTEXCOLOR&&G.addFallback(H++,"VERTEXCOLOR"),w.MORPHTARGETS&&G.addFallback(H++,"MORPHTARGETS"),w.MULTIVIEW&&G.addFallback(0,"MULTIVIEW");var X=[Zi.b.PositionKind];w.NORMAL&&X.push(Zi.b.NormalKind),w.TANGENT&&X.push(Zi.b.TangentKind),w.UV1&&X.push(Zi.b.UVKind),w.UV2&&X.push(Zi.b.UV2Kind),w.VERTEXCOLOR&&X.push(Zi.b.ColorKind),jo.a.PrepareAttributesForBones(X,D,w,G),jo.a.PrepareAttributesForInstances(X,w),jo.a.PrepareAttributesForMorphTargets(X,D,w);var q="pbr",Z=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","vReflectivityColor","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","albedoMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vTangentSpaceParams","boneTextureWidth","vDebugMode"],J=["albedoSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler"],$=["Material","Scene"];ha.AddUniforms(Z),ha.AddSamplers(J),$o.AddUniforms(Z),$o.AddSamplers(J),ra.AddUniforms(Z),ra.AddSamplers(J),la.AddUniforms(Z),la.AddSamplers(J),Yi.a&&(Yi.a.PrepareUniforms(Z,w),Yi.a.PrepareSamplers(J,w)),jo.a.PrepareUniformsAndSamplersList({uniformsNames:Z,uniformBuffersNames:$,samplers:J,defines:w,maxSimultaneousLights:this._maxSimultaneousLights}),this.customShaderNameResolve&&(q=this.customShaderNameResolve(q,Z,$,J,w));var te=w.toString();return z.createEffect(q,{attributes:X,uniformsNames:Z,uniformBuffersNames:$,samplers:J,defines:te,fallbacks:G,onCompiled:N,onError:F,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:w.NUM_MORPH_INFLUENCERS}},z)},t.prototype._prepareDefines=function(D,w,N,F){void 0===N&&(N=null),void 0===F&&(F=null);var k=this.getScene(),j=k.getEngine();if(jo.a.PrepareDefinesForLights(k,D,w,!0,this._maxSimultaneousLights,this._disableLighting),w._needNormals=!0,jo.a.PrepareDefinesForMultiview(k,w),w.METALLICWORKFLOW=this.isMetallicWorkflow(),w._areTexturesDirty){if(w._needUVs=!1,k.texturesEnabled){k.getEngine().getCaps().textureLOD&&(w.LODBASEDMICROSFURACE=!0),this._albedoTexture&&Ho.a.DiffuseTextureEnabled?(jo.a.PrepareDefinesForMergedUV(this._albedoTexture,w,"ALBEDO"),w.GAMMAALBEDO=this._albedoTexture.gammaSpace):w.ALBEDO=!1,this._ambientTexture&&Ho.a.AmbientTextureEnabled?(jo.a.PrepareDefinesForMergedUV(this._ambientTexture,w,"AMBIENT"),w.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):w.AMBIENT=!1,this._opacityTexture&&Ho.a.OpacityTextureEnabled?(jo.a.PrepareDefinesForMergedUV(this._opacityTexture,w,"OPACITY"),w.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):w.OPACITY=!1;var z=this._getReflectionTexture();if(z&&Ho.a.ReflectionTextureEnabled){switch(w.REFLECTION=!0,w.GAMMAREFLECTION=z.gammaSpace,w.RGBDREFLECTION=z.isRGBD,w.REFLECTIONMAP_OPPOSITEZ=this.getScene().useRightHandedSystem?!z.invertZ:z.invertZ,w.LODINREFLECTIONALPHA=z.lodLevelInAlpha,w.LINEARSPECULARREFLECTION=z.linearSpecularLOD,z.coordinatesMode===Jt.a.INVCUBIC_MODE&&(w.INVERTCUBICMAP=!0),w.REFLECTIONMAP_3D=z.isCube,w.REFLECTIONMAP_CUBIC=!1,w.REFLECTIONMAP_EXPLICIT=!1,w.REFLECTIONMAP_PLANAR=!1,w.REFLECTIONMAP_PROJECTION=!1,w.REFLECTIONMAP_SKYBOX=!1,w.REFLECTIONMAP_SPHERICAL=!1,w.REFLECTIONMAP_EQUIRECTANGULAR=!1,w.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,w.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,z.coordinatesMode){case Jt.a.EXPLICIT_MODE:w.REFLECTIONMAP_EXPLICIT=!0;break;case Jt.a.PLANAR_MODE:w.REFLECTIONMAP_PLANAR=!0;break;case Jt.a.PROJECTION_MODE:w.REFLECTIONMAP_PROJECTION=!0;break;case Jt.a.SKYBOX_MODE:w.REFLECTIONMAP_SKYBOX=!0;break;case Jt.a.SPHERICAL_MODE:w.REFLECTIONMAP_SPHERICAL=!0;break;case Jt.a.EQUIRECTANGULAR_MODE:w.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case Jt.a.FIXED_EQUIRECTANGULAR_MODE:w.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case Jt.a.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:w.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case Jt.a.CUBIC_MODE:case Jt.a.INVCUBIC_MODE:default:w.REFLECTIONMAP_CUBIC=!0,w.USE_LOCAL_REFLECTIONMAP_CUBIC=!!z.boundingBoxSize}z.coordinatesMode!==Jt.a.SKYBOX_MODE&&(z.irradianceTexture?(w.USEIRRADIANCEMAP=!0,w.USESPHERICALFROMREFLECTIONMAP=!1):z.isCube&&(w.USESPHERICALFROMREFLECTIONMAP=!0,w.USEIRRADIANCEMAP=!1,this._forceIrradianceInFragment||k.getEngine().getCaps().maxVaryingVectors<=8?w.USESPHERICALINVERTEX=!1:w.USESPHERICALINVERTEX=!0))}else w.REFLECTION=!1,w.REFLECTIONMAP_3D=!1,w.REFLECTIONMAP_SPHERICAL=!1,w.REFLECTIONMAP_PLANAR=!1,w.REFLECTIONMAP_CUBIC=!1,w.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,w.REFLECTIONMAP_PROJECTION=!1,w.REFLECTIONMAP_SKYBOX=!1,w.REFLECTIONMAP_EXPLICIT=!1,w.REFLECTIONMAP_EQUIRECTANGULAR=!1,w.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,w.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,w.INVERTCUBICMAP=!1,w.USESPHERICALFROMREFLECTIONMAP=!1,w.USEIRRADIANCEMAP=!1,w.USESPHERICALINVERTEX=!1,w.REFLECTIONMAP_OPPOSITEZ=!1,w.LODINREFLECTIONALPHA=!1,w.GAMMAREFLECTION=!1,w.RGBDREFLECTION=!1,w.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&Ho.a.LightmapTextureEnabled?(jo.a.PrepareDefinesForMergedUV(this._lightmapTexture,w,"LIGHTMAP"),w.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,w.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,w.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):w.LIGHTMAP=!1,this._emissiveTexture&&Ho.a.EmissiveTextureEnabled?jo.a.PrepareDefinesForMergedUV(this._emissiveTexture,w,"EMISSIVE"):w.EMISSIVE=!1,Ho.a.SpecularTextureEnabled?(this._metallicTexture?(jo.a.PrepareDefinesForMergedUV(this._metallicTexture,w,"REFLECTIVITY"),w.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,w.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,w.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,w.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,w.METALLICF0FACTORFROMMETALLICMAP=this._useMetallicF0FactorFromMetallicTexture):this._reflectivityTexture?(jo.a.PrepareDefinesForMergedUV(this._reflectivityTexture,w,"REFLECTIVITY"),w.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,w.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap):w.REFLECTIVITY=!1,this._microSurfaceTexture?jo.a.PrepareDefinesForMergedUV(this._microSurfaceTexture,w,"MICROSURFACEMAP"):w.MICROSURFACEMAP=!1):(w.REFLECTIVITY=!1,w.MICROSURFACEMAP=!1),k.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&Ho.a.BumpTextureEnabled&&!this._disableBumpMap?(jo.a.PrepareDefinesForMergedUV(this._bumpTexture,w,"BUMP"),this._useParallax&&this._albedoTexture&&Ho.a.DiffuseTextureEnabled?(w.PARALLAX=!0,w.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):w.PARALLAX=!1,w.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):w.BUMP=!1,this._environmentBRDFTexture&&Ho.a.ReflectionTextureEnabled?(w.ENVIRONMENTBRDF=!0,w.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(w.ENVIRONMENTBRDF=!1,w.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?w.ALPHAFROMALBEDO=!0:w.ALPHAFROMALBEDO=!1}w.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===t.LIGHTFALLOFF_STANDARD?(w.USEPHYSICALLIGHTFALLOFF=!1,w.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===t.LIGHTFALLOFF_GLTF?(w.USEPHYSICALLIGHTFALLOFF=!1,w.USEGLTFLIGHTFALLOFF=!0):(w.USEPHYSICALLIGHTFALLOFF=!0,w.USEGLTFLIGHTFALLOFF=!1),w.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.backFaceCulling&&this._twoSidedLighting?w.TWOSIDEDLIGHTING=!0:w.TWOSIDEDLIGHTING=!1,w.SPECULARAA=k.getEngine().getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(w._areTexturesDirty||w._areMiscDirty)&&(w.ALPHATESTVALUE=this._alphaCutOff+(this._alphaCutOff%1==0?".":""),w.PREMULTIPLYALPHA=this.alphaMode===ce.a.ALPHA_PREMULTIPLIED||this.alphaMode===ce.a.ALPHA_PREMULTIPLIED_PORTERDUFF,w.ALPHABLEND=this.needAlphaBlendingForMesh(D),w.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,w.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),w._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(w),w.FORCENORMALFORWARD=this._forceNormalForward,w.RADIANCEOCCLUSION=this._useRadianceOcclusion,w.HORIZONOCCLUSION=this._useHorizonOcclusion,w._areMiscDirty&&(jo.a.PrepareDefinesForMisc(D,k,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(D)||this._forceAlphaTest,w),w.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!D.isVerticesDataPresent(Zi.b.NormalKind),w.DEBUGMODE=this._debugMode),this.subSurface.prepareDefines(w,k),this.clearCoat.prepareDefines(w,k),this.anisotropy.prepareDefines(w,D,k),this.brdf.prepareDefines(w),this.sheen.prepareDefines(w,k),jo.a.PrepareDefinesForFrameBoundValues(k,j,w,!!N,F),jo.a.PrepareDefinesForAttributes(D,w,!0,!0,!0,this._transparencyMode!==t.PBRMATERIAL_OPAQUE)},t.prototype.forceCompilation=function(D,w,N){var F=this,k=Object(Z.a)({clipPlane:!1,useInstances:!1},N),j=new fa,z=this._prepareEffect(D,j,void 0,void 0,k.useInstances,k.clipPlane);z.isReady()?w&&w(this):z.onCompileObservable.add((function(){w&&w(F)}))},t.prototype.buildUniformLayout=function(){var D=this._uniformBuffer;D.addUniform("vAlbedoInfos",2),D.addUniform("vAmbientInfos",4),D.addUniform("vOpacityInfos",2),D.addUniform("vEmissiveInfos",2),D.addUniform("vLightmapInfos",2),D.addUniform("vReflectivityInfos",3),D.addUniform("vMicroSurfaceSamplerInfos",2),D.addUniform("vReflectionInfos",2),D.addUniform("vReflectionPosition",3),D.addUniform("vReflectionSize",3),D.addUniform("vBumpInfos",3),D.addUniform("albedoMatrix",16),D.addUniform("ambientMatrix",16),D.addUniform("opacityMatrix",16),D.addUniform("emissiveMatrix",16),D.addUniform("lightmapMatrix",16),D.addUniform("reflectivityMatrix",16),D.addUniform("microSurfaceSamplerMatrix",16),D.addUniform("bumpMatrix",16),D.addUniform("vTangentSpaceParams",2),D.addUniform("reflectionMatrix",16),D.addUniform("vReflectionColor",3),D.addUniform("vAlbedoColor",4),D.addUniform("vLightingIntensity",4),D.addUniform("vReflectionMicrosurfaceInfos",3),D.addUniform("pointSize",1),D.addUniform("vReflectivityColor",4),D.addUniform("vEmissiveColor",3),D.addUniform("visibility",1),$o.PrepareUniformBuffer(D),ra.PrepareUniformBuffer(D),la.PrepareUniformBuffer(D),ha.PrepareUniformBuffer(D),D.create()},t.prototype.unbind=function(){if(this._activeEffect){var w=!1;this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&(this._activeEffect.setTexture("reflection2DSampler",null),w=!0),this.subSurface.unbind(this._activeEffect)&&(w=!0),w&&this._markAllSubMeshesAsTexturesDirty()}D.prototype.unbind.call(this)},t.prototype.bindForSubMesh=function(D,w,N){var F=this.getScene(),k=N._materialDefines;if(k){var j=N.effect;if(j){this._activeEffect=j,k.INSTANCES||this.bindOnlyWorldMatrix(D),k.OBJECTSPACE_NORMALMAP&&(D.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));var z=this._mustRebind(F,j,w.visibility);jo.a.BindBonesParameters(w,this._activeEffect);var H=null,X=this._uniformBuffer;if(z){var q=F.getEngine();if(X.bindToEffect(j,"Material"),this.bindViewProjection(j),H=this._getReflectionTexture(),!X.useUbo||!this.isFrozen||!X.isSync){if(F.texturesEnabled){if(this._albedoTexture&&Ho.a.DiffuseTextureEnabled&&(X.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),jo.a.BindTextureMatrix(this._albedoTexture,X,"albedo")),this._ambientTexture&&Ho.a.AmbientTextureEnabled&&(X.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),jo.a.BindTextureMatrix(this._ambientTexture,X,"ambient")),this._opacityTexture&&Ho.a.OpacityTextureEnabled&&(X.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),jo.a.BindTextureMatrix(this._opacityTexture,X,"opacity")),H&&Ho.a.ReflectionTextureEnabled){if(X.updateMatrix("reflectionMatrix",H.getReflectionTextureMatrix()),X.updateFloat2("vReflectionInfos",H.level,0),H.boundingBoxSize){var Z=H;X.updateVector3("vReflectionPosition",Z.boundingBoxPosition),X.updateVector3("vReflectionSize",Z.boundingBoxSize)}if(!k.USEIRRADIANCEMAP){var J=H.sphericalPolynomial;if(k.USESPHERICALFROMREFLECTIONMAP&&J)if(k.SPHERICAL_HARMONICS){var $=J.preScaledHarmonics;this._activeEffect.setVector3("vSphericalL00",$.l00),this._activeEffect.setVector3("vSphericalL1_1",$.l1_1),this._activeEffect.setVector3("vSphericalL10",$.l10),this._activeEffect.setVector3("vSphericalL11",$.l11),this._activeEffect.setVector3("vSphericalL2_2",$.l2_2),this._activeEffect.setVector3("vSphericalL2_1",$.l2_1),this._activeEffect.setVector3("vSphericalL20",$.l20),this._activeEffect.setVector3("vSphericalL21",$.l21),this._activeEffect.setVector3("vSphericalL22",$.l22)}else this._activeEffect.setFloat3("vSphericalX",J.x.x,J.x.y,J.x.z),this._activeEffect.setFloat3("vSphericalY",J.y.x,J.y.y,J.y.z),this._activeEffect.setFloat3("vSphericalZ",J.z.x,J.z.y,J.z.z),this._activeEffect.setFloat3("vSphericalXX_ZZ",J.xx.x-J.zz.x,J.xx.y-J.zz.y,J.xx.z-J.zz.z),this._activeEffect.setFloat3("vSphericalYY_ZZ",J.yy.x-J.zz.x,J.yy.y-J.zz.y,J.yy.z-J.zz.z),this._activeEffect.setFloat3("vSphericalZZ",J.zz.x,J.zz.y,J.zz.z),this._activeEffect.setFloat3("vSphericalXY",J.xy.x,J.xy.y,J.xy.z),this._activeEffect.setFloat3("vSphericalYZ",J.yz.x,J.yz.y,J.yz.z),this._activeEffect.setFloat3("vSphericalZX",J.zx.x,J.zx.y,J.zx.z)}X.updateFloat3("vReflectionMicrosurfaceInfos",H.getSize().width,H.lodGenerationScale,H.lodGenerationOffset)}this._emissiveTexture&&Ho.a.EmissiveTextureEnabled&&(X.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),jo.a.BindTextureMatrix(this._emissiveTexture,X,"emissive")),this._lightmapTexture&&Ho.a.LightmapTextureEnabled&&(X.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),jo.a.BindTextureMatrix(this._lightmapTexture,X,"lightmap")),Ho.a.SpecularTextureEnabled&&(this._metallicTexture?(X.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),jo.a.BindTextureMatrix(this._metallicTexture,X,"reflectivity")):this._reflectivityTexture&&(X.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),jo.a.BindTextureMatrix(this._reflectivityTexture,X,"reflectivity")),this._microSurfaceTexture&&(X.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),jo.a.BindTextureMatrix(this._microSurfaceTexture,X,"microSurfaceSampler"))),this._bumpTexture&&q.getCaps().standardDerivatives&&Ho.a.BumpTextureEnabled&&!this._disableBumpMap&&(X.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),jo.a.BindTextureMatrix(this._bumpTexture,X,"bump"),F._mirroredCameraPosition?X.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):X.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&X.updateFloat("pointSize",this.pointSize),k.METALLICWORKFLOW){G.c.Color3[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,G.c.Color3[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness;var te=.08*this._metallicF0Factor;X.updateColor4("vReflectivityColor",G.c.Color3[0],te)}else X.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);X.updateColor3("vEmissiveColor",Ho.a.EmissiveTextureEnabled?this._emissiveColor:G.a.BlackReadOnly),X.updateColor3("vReflectionColor",this._reflectionColor),!k.SS_REFRACTION&&this.subSurface.linkRefractionWithTransparency?X.updateColor4("vAlbedoColor",this._albedoColor,1):X.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),X.updateFloat("visibility",w.visibility),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*F.environmentIntensity,this._lightingInfos.w=this._specularIntensity,X.updateVector4("vLightingIntensity",this._lightingInfos)}F.texturesEnabled&&(this._albedoTexture&&Ho.a.DiffuseTextureEnabled&&X.setTexture("albedoSampler",this._albedoTexture),this._ambientTexture&&Ho.a.AmbientTextureEnabled&&X.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&Ho.a.OpacityTextureEnabled&&X.setTexture("opacitySampler",this._opacityTexture),H&&Ho.a.ReflectionTextureEnabled&&(k.LODBASEDMICROSFURACE?X.setTexture("reflectionSampler",H):(X.setTexture("reflectionSampler",H._lodTextureMid||H),X.setTexture("reflectionSamplerLow",H._lodTextureLow||H),X.setTexture("reflectionSamplerHigh",H._lodTextureHigh||H)),k.USEIRRADIANCEMAP&&X.setTexture("irradianceSampler",H.irradianceTexture)),k.ENVIRONMENTBRDF&&X.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&Ho.a.EmissiveTextureEnabled&&X.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&Ho.a.LightmapTextureEnabled&&X.setTexture("lightmapSampler",this._lightmapTexture),Ho.a.SpecularTextureEnabled&&(this._metallicTexture?X.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&X.setTexture("reflectivitySampler",this._reflectivityTexture),this._microSurfaceTexture&&X.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&q.getCaps().standardDerivatives&&Ho.a.BumpTextureEnabled&&!this._disableBumpMap&&X.setTexture("bumpSampler",this._bumpTexture)),this.subSurface.bindForSubMesh(X,F,q,this.isFrozen,k.LODBASEDMICROSFURACE),this.clearCoat.bindForSubMesh(X,F,q,this._disableBumpMap,this.isFrozen,this._invertNormalMapX,this._invertNormalMapY),this.anisotropy.bindForSubMesh(X,F,this.isFrozen),this.sheen.bindForSubMesh(X,F,this.isFrozen),jo.a.BindClipPlane(this._activeEffect,F),F.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor);var ie=F._forcedViewPosition?F._forcedViewPosition:F._mirroredCameraPosition?F._mirroredCameraPosition:F.activeCamera.globalPosition,oe=F.useRightHandedSystem===(null!=F._mirroredCameraPosition);j.setFloat4("vEyePosition",ie.x,ie.y,ie.z,oe?-1:1),j.setColor3("vAmbientColor",this._globalAmbientColor),j.setFloat2("vDebugMode",this.debugLimit,this.debugFactor)}!z&&this.isFrozen||(F.lightsEnabled&&!this._disableLighting&&jo.a.BindLights(F,w,this._activeEffect,k,this._maxSimultaneousLights,this._rebuildInParallel),(F.fogEnabled&&w.applyFog&&F.fogMode!==We.a.FOGMODE_NONE||H)&&this.bindView(j),jo.a.BindFogParameters(F,w,this._activeEffect,!0),k.NUM_MORPH_INFLUENCERS&&jo.a.BindMorphTargetParameters(w,this._activeEffect),this._imageProcessingConfiguration.bind(this._activeEffect),jo.a.BindLogDepth(k,this._activeEffect,F)),X.update(),this._afterBind(w,this._activeEffect)}}},t.prototype.getAnimatables=function(){var D=[];return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&D.push(this._albedoTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&D.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&D.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&D.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&D.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?D.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&D.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&D.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&D.push(this._lightmapTexture),this.subSurface.getAnimatables(D),this.clearCoat.getAnimatables(D),this.sheen.getAnimatables(D),this.anisotropy.getAnimatables(D),D},t.prototype._getReflectionTexture=function(){return this._reflectionTexture?this._reflectionTexture:this.getScene().environmentTexture},t.prototype.getActiveTextures=function(){var w=D.prototype.getActiveTextures.call(this);return this._albedoTexture&&w.push(this._albedoTexture),this._ambientTexture&&w.push(this._ambientTexture),this._opacityTexture&&w.push(this._opacityTexture),this._reflectionTexture&&w.push(this._reflectionTexture),this._emissiveTexture&&w.push(this._emissiveTexture),this._reflectivityTexture&&w.push(this._reflectivityTexture),this._metallicTexture&&w.push(this._metallicTexture),this._microSurfaceTexture&&w.push(this._microSurfaceTexture),this._bumpTexture&&w.push(this._bumpTexture),this._lightmapTexture&&w.push(this._lightmapTexture),this.subSurface.getActiveTextures(w),this.clearCoat.getActiveTextures(w),this.sheen.getActiveTextures(w),this.anisotropy.getActiveTextures(w),w},t.prototype.hasTexture=function(w){return!!D.prototype.hasTexture.call(this,w)||this._albedoTexture===w||this._ambientTexture===w||this._opacityTexture===w||this._reflectionTexture===w||this._reflectivityTexture===w||this._metallicTexture===w||this._microSurfaceTexture===w||this._bumpTexture===w||this._lightmapTexture===w||this.subSurface.hasTexture(w)||this.clearCoat.hasTexture(w)||this.sheen.hasTexture(w)||this.anisotropy.hasTexture(w)},t.prototype.dispose=function(w,N){N&&(this._albedoTexture&&this._albedoTexture.dispose(),this._ambientTexture&&this._ambientTexture.dispose(),this._opacityTexture&&this._opacityTexture.dispose(),this._reflectionTexture&&this._reflectionTexture.dispose(),this._environmentBRDFTexture&&this.getScene().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),this._emissiveTexture&&this._emissiveTexture.dispose(),this._metallicTexture&&this._metallicTexture.dispose(),this._reflectivityTexture&&this._reflectivityTexture.dispose(),this._bumpTexture&&this._bumpTexture.dispose(),this._lightmapTexture&&this._lightmapTexture.dispose()),this.subSurface.dispose(N),this.clearCoat.dispose(N),this.sheen.dispose(N),this.anisotropy.dispose(N),this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),D.prototype.dispose.call(this,w,N)},t.PBRMATERIAL_OPAQUE=0,t.PBRMATERIAL_ALPHATEST=1,t.PBRMATERIAL_ALPHABLEND=2,t.PBRMATERIAL_ALPHATESTANDBLEND=3,t.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,t.LIGHTFALLOFF_PHYSICAL=0,t.LIGHTFALLOFF_GLTF=1,t.LIGHTFALLOFF_STANDARD=2,Object(Z.c)([Object(Ie.i)()],t.prototype,"_imageProcessingConfiguration",void 0),Object(Z.c)([Object(Ie.b)("_markAllSubMeshesAsMiscDirty")],t.prototype,"debugMode",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"useLogarithmicDepth",null),Object(Z.c)([Object(Ie.c)()],t.prototype,"transparencyMode",null),t}(Yo.a),ga=function(D){function t(w,N){var F=D.call(this,w,N)||this;return F.directIntensity=1,F.emissiveIntensity=1,F.environmentIntensity=1,F.specularIntensity=1,F.disableBumpMap=!1,F.ambientTextureStrength=1,F.ambientTextureImpactOnAnalyticalLights=t.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,F.metallicF0Factor=.5,F.useMetallicF0FactorFromMetallicTexture=!1,F.ambientColor=new G.a(0,0,0),F.albedoColor=new G.a(1,1,1),F.reflectivityColor=new G.a(1,1,1),F.reflectionColor=new G.a(1,1,1),F.emissiveColor=new G.a(0,0,0),F.microSurface=1,F.useLightmapAsShadowmap=!1,F.useAlphaFromAlbedoTexture=!1,F.forceAlphaTest=!1,F.alphaCutOff=.4,F.useSpecularOverAlpha=!0,F.useMicroSurfaceFromReflectivityMapAlpha=!1,F.useRoughnessFromMetallicTextureAlpha=!0,F.useRoughnessFromMetallicTextureGreen=!1,F.useMetallnessFromMetallicTextureBlue=!1,F.useAmbientOcclusionFromMetallicTextureRed=!1,F.useAmbientInGrayScale=!1,F.useAutoMicroSurfaceFromReflectivityMap=!1,F.useRadianceOverAlpha=!0,F.useObjectSpaceNormalMap=!1,F.useParallax=!1,F.useParallaxOcclusion=!1,F.parallaxScaleBias=.05,F.disableLighting=!1,F.forceIrradianceInFragment=!1,F.maxSimultaneousLights=4,F.invertNormalMapX=!1,F.invertNormalMapY=!1,F.twoSidedLighting=!1,F.useAlphaFresnel=!1,F.useLinearAlphaFresnel=!1,F.environmentBRDFTexture=null,F.forceNormalForward=!1,F.enableSpecularAntiAliasing=!1,F.useHorizonOcclusion=!0,F.useRadianceOcclusion=!0,F.unlit=!1,F._environmentBRDFTexture=Jo.GetEnvironmentBRDFTexture(N),F}return Object(Z.d)(t,D),Object.defineProperty(t.prototype,"refractionTexture",{get:function(){return this.subSurface.refractionTexture},set:function(D){this.subSurface.refractionTexture=D,D?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"indexOfRefraction",{get:function(){return 1/this.subSurface.indexOfRefraction},set:function(D){this.subSurface.indexOfRefraction=1/D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"invertRefractionY",{get:function(){return this.subSurface.invertRefractionY},set:function(D){this.subSurface.invertRefractionY=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"linkRefractionWithTransparency",{get:function(){return this.subSurface.linkRefractionWithTransparency},set:function(D){this.subSurface.linkRefractionWithTransparency=D,D&&(this.subSurface.isRefractionEnabled=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"usePhysicalLightFalloff",{get:function(){return this._lightFalloff===pa.LIGHTFALLOFF_PHYSICAL},set:function(D){D!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=D?pa.LIGHTFALLOFF_PHYSICAL:pa.LIGHTFALLOFF_STANDARD)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useGLTFLightFalloff",{get:function(){return this._lightFalloff===pa.LIGHTFALLOFF_GLTF},set:function(D){D!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=D?pa.LIGHTFALLOFF_GLTF:pa.LIGHTFALLOFF_STANDARD)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(D){this._attachImageProcessingConfiguration(D),this._markAllSubMeshesAsTexturesDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(D){this.imageProcessingConfiguration.colorCurvesEnabled=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(D){this.imageProcessingConfiguration.colorGradingEnabled=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraToneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(D){this._imageProcessingConfiguration.toneMappingEnabled=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraExposure",{get:function(){return this._imageProcessingConfiguration.exposure},set:function(D){this._imageProcessingConfiguration.exposure=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraContrast",{get:function(){return this._imageProcessingConfiguration.contrast},set:function(D){this._imageProcessingConfiguration.contrast=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorGradingTexture",{get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(D){this._imageProcessingConfiguration.colorGradingTexture=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorCurves",{get:function(){return this._imageProcessingConfiguration.colorCurves},set:function(D){this._imageProcessingConfiguration.colorCurves=D},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"PBRMaterial"},t.prototype.clone=function(D){var w=this,N=Ie.a.Clone((function(){return new t(D,w.getScene())}),this);return N.id=D,N.name=D,this.clearCoat.copyTo(N.clearCoat),this.anisotropy.copyTo(N.anisotropy),this.brdf.copyTo(N.brdf),this.sheen.copyTo(N.sheen),this.subSurface.copyTo(N.subSurface),N},t.prototype.serialize=function(){var D=Ie.a.Serialize(this);return D.customType="BABYLON.PBRMaterial",D.clearCoat=this.clearCoat.serialize(),D.anisotropy=this.anisotropy.serialize(),D.brdf=this.brdf.serialize(),D.sheen=this.sheen.serialize(),D.subSurface=this.subSurface.serialize(),D},t.Parse=function(D,w,N){var F=Ie.a.Parse((function(){return new t(D.name,w)}),D,w,N);return D.clearCoat&&F.clearCoat.parse(D.clearCoat,w,N),D.anisotropy&&F.anisotropy.parse(D.anisotropy,w,N),D.brdf&&F.brdf.parse(D.brdf,w,N),D.sheen&&F.sheen.parse(D.sheen,w,N),D.subSurface&&F.subSurface.parse(D.subSurface,w,N),F},t.PBRMATERIAL_OPAQUE=pa.PBRMATERIAL_OPAQUE,t.PBRMATERIAL_ALPHATEST=pa.PBRMATERIAL_ALPHATEST,t.PBRMATERIAL_ALPHABLEND=pa.PBRMATERIAL_ALPHABLEND,t.PBRMATERIAL_ALPHATESTANDBLEND=pa.PBRMATERIAL_ALPHATESTANDBLEND,t.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=pa.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"directIntensity",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"emissiveIntensity",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"environmentIntensity",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"specularIntensity",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"disableBumpMap",void 0),Object(Z.c)([Object(Ie.m)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"albedoTexture",void 0),Object(Z.c)([Object(Ie.m)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"ambientTexture",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"ambientTextureStrength",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),Object(Z.c)([Object(Ie.m)(),Object(Ie.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],t.prototype,"opacityTexture",void 0),Object(Z.c)([Object(Ie.m)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionTexture",void 0),Object(Z.c)([Object(Ie.m)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"emissiveTexture",void 0),Object(Z.c)([Object(Ie.m)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectivityTexture",void 0),Object(Z.c)([Object(Ie.m)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"metallicTexture",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"metallic",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"roughness",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"metallicF0Factor",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useMetallicF0FactorFromMetallicTexture",void 0),Object(Z.c)([Object(Ie.m)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"microSurfaceTexture",void 0),Object(Z.c)([Object(Ie.m)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"bumpTexture",void 0),Object(Z.c)([Object(Ie.m)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty",null)],t.prototype,"lightmapTexture",void 0),Object(Z.c)([Object(Ie.e)("ambient"),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"ambientColor",void 0),Object(Z.c)([Object(Ie.e)("albedo"),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"albedoColor",void 0),Object(Z.c)([Object(Ie.e)("reflectivity"),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectivityColor",void 0),Object(Z.c)([Object(Ie.e)("reflection"),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionColor",void 0),Object(Z.c)([Object(Ie.e)("emissive"),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"emissiveColor",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"microSurface",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useLightmapAsShadowmap",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],t.prototype,"useAlphaFromAlbedoTexture",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],t.prototype,"forceAlphaTest",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],t.prototype,"alphaCutOff",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useSpecularOverAlpha",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useRoughnessFromMetallicTextureGreen",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useMetallnessFromMetallicTextureBlue",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useAmbientInGrayScale",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"usePhysicalLightFalloff",null),Object(Z.c)([Object(Ie.c)()],t.prototype,"useGLTFLightFalloff",null),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useRadianceOverAlpha",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useObjectSpaceNormalMap",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useParallax",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useParallaxOcclusion",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"parallaxScaleBias",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"disableLighting",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"forceIrradianceInFragment",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"maxSimultaneousLights",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"invertNormalMapX",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"invertNormalMapY",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"twoSidedLighting",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useAlphaFresnel",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useLinearAlphaFresnel",void 0),Object(Z.c)([Object(Ie.m)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"environmentBRDFTexture",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"forceNormalForward",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"enableSpecularAntiAliasing",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useHorizonOcclusion",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useRadianceOcclusion",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsMiscDirty")],t.prototype,"unlit",void 0),t}(pa);function Go(D){return D.charCodeAt(0)+(D.charCodeAt(1)<<8)+(D.charCodeAt(2)<<16)+(D.charCodeAt(3)<<24)}H.a.RegisteredTypes["BABYLON.PBRMaterial"]=ga;var xa=Go("DXT1"),Ia=Go("DXT3"),wa=Go("DXT5"),Na=Go("DX10"),ka=function(){function e(){}return e.GetDDSInfo=function(D){var w=new Int32Array(D.buffer,D.byteOffset,31),N=new Int32Array(D.buffer,D.byteOffset,35),F=1;131072&w[2]&&(F=Math.max(1,w[7]));var k=w[21],j=k===Na?N[32]:0,z=ce.a.TEXTURETYPE_UNSIGNED_INT;switch(k){case 113:z=ce.a.TEXTURETYPE_HALF_FLOAT;break;case 116:z=ce.a.TEXTURETYPE_FLOAT;break;case Na:if(10===j){z=ce.a.TEXTURETYPE_HALF_FLOAT;break}if(2===j){z=ce.a.TEXTURETYPE_FLOAT;break}}return{width:w[4],height:w[3],mipmapCount:F,isFourCC:4==(4&w[20]),isRGB:64==(64&w[20]),isLuminance:131072==(131072&w[20]),isCube:512==(512&w[28]),isCompressed:k===xa||k===Ia||k===wa,dxgiFormat:j,textureType:z}},e._ToHalfFloat=function(D){e._FloatView||(e._FloatView=new Float32Array(1),e._Int32View=new Int32Array(e._FloatView.buffer)),e._FloatView[0]=D;var w=e._Int32View[0],N=w>>16&32768,F=w>>12&2047,k=w>>23&255;return k<103?N:k>142?(N|=31744,N|=(255==k?0:1)&&8388607&w):k<113?N|=((F|=2048)>>114-k)+(F>>113-k&1):(N|=k-112<<10|F>>1,N+=1&F)},e._FromHalfFloat=function(D){var w=(32768&D)>>15,N=(31744&D)>>10,F=1023&D;return 0===N?(w?-1:1)*Math.pow(2,-14)*(F/Math.pow(2,10)):31==N?F?NaN:1/0*(w?-1:1):(w?-1:1)*Math.pow(2,N-15)*(1+F/Math.pow(2,10))},e._GetHalfFloatAsFloatRGBAArrayBuffer=function(D,w,N,F,k,j){for(var z=new Float32Array(F),G=new Uint16Array(k,N),H=0,X=0;X<w;X++)for(var q=0;q<D;q++){var Z=4*(q+X*D);z[H]=e._FromHalfFloat(G[Z]),z[H+1]=e._FromHalfFloat(G[Z+1]),z[H+2]=e._FromHalfFloat(G[Z+2]),e.StoreLODInAlphaChannel?z[H+3]=j:z[H+3]=e._FromHalfFloat(G[Z+3]),H+=4}return z},e._GetHalfFloatRGBAArrayBuffer=function(D,w,N,F,k,j){if(e.StoreLODInAlphaChannel){for(var z=new Uint16Array(F),G=new Uint16Array(k,N),H=0,X=0;X<w;X++)for(var q=0;q<D;q++){var Z=4*(q+X*D);z[H]=G[Z],z[H+1]=G[Z+1],z[H+2]=G[Z+2],z[H+3]=e._ToHalfFloat(j),H+=4}return z}return new Uint16Array(k,N,F)},e._GetFloatRGBAArrayBuffer=function(D,w,N,F,k,j){if(e.StoreLODInAlphaChannel){for(var z=new Float32Array(F),G=new Float32Array(k,N),H=0,X=0;X<w;X++)for(var q=0;q<D;q++){var Z=4*(q+X*D);z[H]=G[Z],z[H+1]=G[Z+1],z[H+2]=G[Z+2],z[H+3]=j,H+=4}return z}return new Float32Array(k,N,F)},e._GetFloatAsUIntRGBAArrayBuffer=function(D,w,N,F,k,j){for(var z=new Uint8Array(F),G=new Float32Array(k,N),H=0,X=0;X<w;X++)for(var q=0;q<D;q++){var Z=4*(q+X*D);z[H]=255*De.a.Clamp(G[Z]),z[H+1]=255*De.a.Clamp(G[Z+1]),z[H+2]=255*De.a.Clamp(G[Z+2]),e.StoreLODInAlphaChannel?z[H+3]=j:z[H+3]=255*De.a.Clamp(G[Z+3]),H+=4}return z},e._GetHalfFloatAsUIntRGBAArrayBuffer=function(D,w,N,F,k,j){for(var z=new Uint8Array(F),G=new Uint16Array(k,N),H=0,X=0;X<w;X++)for(var q=0;q<D;q++){var Z=4*(q+X*D);z[H]=255*De.a.Clamp(e._FromHalfFloat(G[Z])),z[H+1]=255*De.a.Clamp(e._FromHalfFloat(G[Z+1])),z[H+2]=255*De.a.Clamp(e._FromHalfFloat(G[Z+2])),e.StoreLODInAlphaChannel?z[H+3]=j:z[H+3]=255*De.a.Clamp(e._FromHalfFloat(G[Z+3])),H+=4}return z},e._GetRGBAArrayBuffer=function(D,w,N,F,k,j,z,G,H){for(var X=new Uint8Array(F),q=new Uint8Array(k,N),Z=0,J=0;J<w;J++)for(var $=0;$<D;$++){var te=4*($+J*D);X[Z]=q[te+j],X[Z+1]=q[te+z],X[Z+2]=q[te+G],X[Z+3]=q[te+H],Z+=4}return X},e._ExtractLongWordOrder=function(D){return 0===D||255===D||-16777216===D?0:1+e._ExtractLongWordOrder(D>>8)},e._GetRGBArrayBuffer=function(D,w,N,F,k,j,z,G){for(var H=new Uint8Array(F),X=new Uint8Array(k,N),q=0,Z=0;Z<w;Z++)for(var J=0;J<D;J++){var $=3*(J+Z*D);H[q]=X[$+j],H[q+1]=X[$+z],H[q+2]=X[$+G],q+=3}return H},e._GetLuminanceArrayBuffer=function(D,w,N,F,k){for(var j=new Uint8Array(F),z=new Uint8Array(k,N),G=0,H=0;H<w;H++)for(var X=0;X<D;X++){var q=X+H*D;j[G]=z[q],G++}return j},e.UploadDDSLevels=function(D,w,N,F,k,j,z,G){void 0===z&&(z=-1);var H=null;F.sphericalPolynomial&&(H=new Array);var X,q,Z,J,$,te,ie,he=D.getCaps().s3tc,fe=new Int32Array(N.buffer,N.byteOffset,31),pe=0,_e=0,ve=1;if(542327876===fe[0])if(F.isFourCC||F.isRGB||F.isLuminance)if(!F.isCompressed||he){var ye=fe[22];J=fe[1]+4;var be,Te=!1;if(F.isFourCC)switch(X=fe[21]){case xa:ve=8,_e=he.COMPRESSED_RGBA_S3TC_DXT1_EXT;break;case Ia:ve=16,_e=he.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case wa:ve=16,_e=he.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;case 113:case 116:Te=!0;break;case Na:J+=20;var Ee=!1;switch(F.dxgiFormat){case 10:case 2:Te=!0,Ee=!0;break;case 88:F.isRGB=!0,F.isFourCC=!1,ye=32,Ee=!0}if(Ee)break;default:return void console.error("Unsupported FourCC code:",(be=X,String.fromCharCode(255&be,be>>8&255,be>>16&255,be>>24&255)))}var Se=e._ExtractLongWordOrder(fe[23]),Me=e._ExtractLongWordOrder(fe[24]),xe=e._ExtractLongWordOrder(fe[25]),Ae=e._ExtractLongWordOrder(fe[26]);Te&&(_e=D._getRGBABufferInternalSizedFormat(F.textureType)),te=1,131072&fe[2]&&!1!==k&&(te=Math.max(1,fe[7]));for(var Pe=G||0;Pe<j;Pe++){for(q=fe[4],Z=fe[3],ie=0;ie<te;++ie){if(-1===z||z===ie){var Oe=-1===z?ie:0;if(!F.isCompressed&&F.isFourCC){w.format=ce.a.TEXTUREFORMAT_RGBA,pe=q*Z*4;var Re=null;D._badOS||D._badDesktopOS||!D.getCaps().textureHalfFloat&&!D.getCaps().textureFloat?(128===ye?(Re=e._GetFloatAsUIntRGBAArrayBuffer(q,Z,N.byteOffset+J,pe,N.buffer,Oe),H&&0==Oe&&H.push(e._GetFloatRGBAArrayBuffer(q,Z,N.byteOffset+J,pe,N.buffer,Oe))):64===ye&&(Re=e._GetHalfFloatAsUIntRGBAArrayBuffer(q,Z,N.byteOffset+J,pe,N.buffer,Oe),H&&0==Oe&&H.push(e._GetHalfFloatAsFloatRGBAArrayBuffer(q,Z,N.byteOffset+J,pe,N.buffer,Oe))),w.type=ce.a.TEXTURETYPE_UNSIGNED_INT):128===ye?(w.type=ce.a.TEXTURETYPE_FLOAT,Re=e._GetFloatRGBAArrayBuffer(q,Z,N.byteOffset+J,pe,N.buffer,Oe),H&&0==Oe&&H.push(Re)):64!==ye||D.getCaps().textureHalfFloat?(w.type=ce.a.TEXTURETYPE_HALF_FLOAT,Re=e._GetHalfFloatRGBAArrayBuffer(q,Z,N.byteOffset+J,pe,N.buffer,Oe),H&&0==Oe&&H.push(e._GetHalfFloatAsFloatRGBAArrayBuffer(q,Z,J,pe,N.buffer,Oe))):(w.type=ce.a.TEXTURETYPE_FLOAT,Re=e._GetHalfFloatAsFloatRGBAArrayBuffer(q,Z,N.byteOffset+J,pe,N.buffer,Oe),H&&0==Oe&&H.push(Re)),Re&&D._uploadDataToTextureDirectly(w,Re,Pe,Oe)}else if(F.isRGB)w.type=ce.a.TEXTURETYPE_UNSIGNED_INT,24===ye?(w.format=ce.a.TEXTUREFORMAT_RGB,pe=q*Z*3,$=e._GetRGBArrayBuffer(q,Z,N.byteOffset+J,pe,N.buffer,Se,Me,xe),D._uploadDataToTextureDirectly(w,$,Pe,Oe)):(w.format=ce.a.TEXTUREFORMAT_RGBA,pe=q*Z*4,$=e._GetRGBAArrayBuffer(q,Z,N.byteOffset+J,pe,N.buffer,Se,Me,xe,Ae),D._uploadDataToTextureDirectly(w,$,Pe,Oe));else if(F.isLuminance){var De=D._getUnpackAlignement(),Ie=q;pe=Math.floor((q+De-1)/De)*De*(Z-1)+Ie,$=e._GetLuminanceArrayBuffer(q,Z,N.byteOffset+J,pe,N.buffer),w.format=ce.a.TEXTUREFORMAT_LUMINANCE,w.type=ce.a.TEXTURETYPE_UNSIGNED_INT,D._uploadDataToTextureDirectly(w,$,Pe,Oe)}else pe=Math.max(4,q)/4*Math.max(4,Z)/4*ve,$=new Uint8Array(N.buffer,N.byteOffset+J,pe),w.type=ce.a.TEXTURETYPE_UNSIGNED_INT,D._uploadCompressedDataToTextureDirectly(w,_e,q,Z,$,Pe,Oe)}J+=ye?q*Z*(ye/8):pe,q*=.5,Z*=.5,q=Math.max(1,q),Z=Math.max(1,Z)}if(void 0!==G)break}H&&H.length>0?F.sphericalPolynomial=Fr.ConvertCubeMapToSphericalPolynomial({size:fe[4],right:H[0],left:H[1],up:H[2],down:H[3],front:H[4],back:H[5],format:ce.a.TEXTUREFORMAT_RGBA,type:ce.a.TEXTURETYPE_FLOAT,gammaSpace:!1}):F.sphericalPolynomial=void 0}else oe.a.Error("Compressed textures are not supported on this platform.");else oe.a.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");else oe.a.Error("Invalid magic number in DDS header")},e.StoreLODInAlphaChannel=!1,e}();di.a.prototype.createPrefilteredCubeTexture=function(D,w,N,F,k,j,z,G,H){var X=this;return void 0===k&&(k=null),void 0===j&&(j=null),void 0===G&&(G=null),void 0===H&&(H=!0),this.createCubeTexture(D,w,null,!1,(function(D){if(D){var j=D.texture;if(H?D.info.sphericalPolynomial&&(j._sphericalPolynomial=D.info.sphericalPolynomial):j._sphericalPolynomial=new wr,j._source=$t.b.CubePrefiltered,X.getCaps().textureLOD)k&&k(j);else{var z=X._gl,G=D.width;if(G){for(var q=[],Z=0;Z<3;Z++){var J=1-Z/2,$=F,te=De.a.Log2(G)*N+F,ie=$+(te-$)*J,ce=Math.round(Math.min(Math.max(ie,0),te)),he=new $t.a(X,$t.b.Temp);if(he.type=j.type,he.format=j.format,he.width=Math.pow(2,Math.max(De.a.Log2(G)-ce,0)),he.height=he.width,he.isCube=!0,X._bindTextureDirectly(z.TEXTURE_CUBE_MAP,he,!0),z.texParameteri(z.TEXTURE_CUBE_MAP,z.TEXTURE_MAG_FILTER,z.LINEAR),z.texParameteri(z.TEXTURE_CUBE_MAP,z.TEXTURE_MIN_FILTER,z.LINEAR),z.texParameteri(z.TEXTURE_CUBE_MAP,z.TEXTURE_WRAP_S,z.CLAMP_TO_EDGE),z.texParameteri(z.TEXTURE_CUBE_MAP,z.TEXTURE_WRAP_T,z.CLAMP_TO_EDGE),D.isDDS){var fe=D.info,pe=D.data;X._unpackFlipY(fe.isCompressed),ka.UploadDDSLevels(X,he,pe,fe,!0,6,ce)}else oe.a.Warn("DDS is the only prefiltered cube map supported so far.");X._bindTextureDirectly(z.TEXTURE_CUBE_MAP,null);var _e=new Nr.a(w);_e.isCube=!0,_e._texture=he,he.isReady=!0,q.push(_e)}j._lodTextureHigh=q[2],j._lodTextureMid=q[1],j._lodTextureLow=q[0],k&&k(j)}}}else k&&k(null)}),j,z,G,H,N,F)};var ja=function(){function e(){this.supportCascades=!0}return e.prototype.canLoad=function(D){return Uo.a.EndsWith(D,".dds")},e.prototype.loadCubeData=function(D,w,N,F,k){var j,z=w.getEngine(),G=!1;if(Array.isArray(D))for(var H=0;H<D.length;H++){var X=D[H];j=ka.GetDDSInfo(X),w.width=j.width,w.height=j.height,G=(j.isRGB||j.isLuminance||j.mipmapCount>1)&&w.generateMipMaps,z._unpackFlipY(j.isCompressed),ka.UploadDDSLevels(z,w,X,j,G,6,-1,H),j.isFourCC||1!==j.mipmapCount||z.generateMipMapsForCubemap(w)}else{var q=D;j=ka.GetDDSInfo(q),w.width=j.width,w.height=j.height,N&&(j.sphericalPolynomial=new wr),G=(j.isRGB||j.isLuminance||j.mipmapCount>1)&&w.generateMipMaps,z._unpackFlipY(j.isCompressed),ka.UploadDDSLevels(z,w,q,j,G,6),j.isFourCC||1!==j.mipmapCount||z.generateMipMapsForCubemap(w,!1)}z._setCubeMapTextureParams(G),w.isReady=!0,w.onLoadedObservable.notifyObservers(w),w.onLoadedObservable.clear(),F&&F({isDDS:!0,width:w.width,info:j,data:D,texture:w})},e.prototype.loadData=function(D,w,N){var F=ka.GetDDSInfo(D),k=(F.isRGB||F.isLuminance||F.mipmapCount>1)&&w.generateMipMaps&&F.width>>F.mipmapCount-1==1;N(F.width,F.height,k,F.isFourCC,(function(){ka.UploadDDSLevels(w.getEngine(),w,D,F,k,1)}))},e}();Ct.a._TextureLoaders.push(new ja);var Ya=function(){function e(){this.supportCascades=!1}return e.prototype.canLoad=function(D){return Uo.a.EndsWith(D,".env")},e.prototype.loadCubeData=function(D,w,N,F,k){if(!Array.isArray(D)){var j=Ur.GetEnvInfo(D);j?(w.width=j.width,w.height=j.width,Ur.UploadEnvSpherical(w,j),Ur.UploadEnvLevelsAsync(w,D,j).then((function(){w.isReady=!0,w.onLoadedObservable.notifyObservers(w),w.onLoadedObservable.clear(),F&&F()}))):k&&k("Can not parse the environment file",null)}},e.prototype.loadData=function(D,w,N){throw".env not supported in 2d."},e}();Ct.a._TextureLoaders.push(new Ya);var Xa=function(){function e(D,w,N,F){if(this.data=D,this.isInvalid=!1,!e.IsValid(D))return this.isInvalid=!0,void oe.a.Error("texture missing KTX identifier");var k=Uint32Array.BYTES_PER_ELEMENT,j=new DataView(this.data.buffer,this.data.byteOffset+12,13*k),z=67305985===j.getUint32(0,!0);this.glType=j.getUint32(1*k,z),this.glTypeSize=j.getUint32(2*k,z),this.glFormat=j.getUint32(3*k,z),this.glInternalFormat=j.getUint32(4*k,z),this.glBaseInternalFormat=j.getUint32(5*k,z),this.pixelWidth=j.getUint32(6*k,z),this.pixelHeight=j.getUint32(7*k,z),this.pixelDepth=j.getUint32(8*k,z),this.numberOfArrayElements=j.getUint32(9*k,z),this.numberOfFaces=j.getUint32(10*k,z),this.numberOfMipmapLevels=j.getUint32(11*k,z),this.bytesOfKeyValueData=j.getUint32(12*k,z),0===this.glType?(this.numberOfMipmapLevels=Math.max(1,this.numberOfMipmapLevels),0!==this.pixelHeight&&0===this.pixelDepth?0===this.numberOfArrayElements?this.numberOfFaces===w?this.loadType=e.COMPRESSED_2D:oe.a.Error("number of faces expected"+w+", but found "+this.numberOfFaces):oe.a.Error("texture arrays not currently supported"):oe.a.Error("only 2D textures currently supported")):oe.a.Error("only compressed formats currently supported")}return e.prototype.uploadLevels=function(D,w){switch(this.loadType){case e.COMPRESSED_2D:this._upload2DCompressedLevels(D,w);break;case e.TEX_2D:case e.COMPRESSED_3D:case e.TEX_3D:}},e.prototype._upload2DCompressedLevels=function(D,w){for(var N=e.HEADER_LEN+this.bytesOfKeyValueData,F=this.pixelWidth,k=this.pixelHeight,j=w?this.numberOfMipmapLevels:1,z=0;z<j;z++){var G=new Int32Array(this.data.buffer,this.data.byteOffset+N,1)[0];N+=4;for(var H=0;H<this.numberOfFaces;H++){var X=new Uint8Array(this.data.buffer,this.data.byteOffset+N,G);D.getEngine()._uploadCompressedDataToTextureDirectly(D,this.glInternalFormat,F,k,X,H,z),N+=G,N+=3-(G+3)%4}F=Math.max(1,.5*F),k=Math.max(1,.5*k)}},e.IsValid=function(D){if(D.byteLength>=12){var w=new Uint8Array(D.buffer,D.byteOffset,12);if(171===w[0]&&75===w[1]&&84===w[2]&&88===w[3]&&32===w[4]&&49===w[5]&&49===w[6]&&187===w[7]&&13===w[8]&&10===w[9]&&26===w[10]&&10===w[11])return!0}return!1},e.HEADER_LEN=64,e.COMPRESSED_2D=0,e.COMPRESSED_3D=1,e.TEX_2D=2,e.TEX_3D=3,e}(),qa=function(){function e(D){var w=this;e._ModulePromise||(e._ModulePromise=new Promise((function(N){LIBKTX().then((function(F){F.GL.makeContextCurrent(F.GL.registerContext(D._gl,{majorVersion:D._webGLVersion})),e._TranscodeFormat=w._determineTranscodeFormat(F.TranscodeTarget,D.getCaps()),N({module:F})}))})))}return e.prototype.uploadAsync=function(D,w){return e._ModulePromise.then((function(N){var F=new N.module.ktxTexture(D);try{F.isBasisSupercompressed&&F.transcodeBasis(e._TranscodeFormat,0),w.width=w.baseWidth=F.baseWidth,w.height=w.baseHeight=F.baseHeight,w.generateMipMaps=!1;var k=F.glUpload();if(0!==k.error)throw new Error("Failed to upload: "+k.error);w._webGLTexture=k.texture,w.isReady=!0}finally{F.delete()}}))},e.prototype._determineTranscodeFormat=function(D,w){if(w.s3tc)return D.BC1_OR_3;if(w.etc2)return D.ETC;throw new Error("No compatible format available")},e.IsValid=function(D){if(D.byteLength>=12){var w=new Uint8Array(D.buffer,D.byteOffset,12);if(171===w[0]&&75===w[1]&&84===w[2]&&88===w[3]&&32===w[4]&&50===w[5]&&48===w[6]&&187===w[7]&&13===w[8]&&10===w[9]&&26===w[10]&&10===w[11])return!0}return!1},e}(),Za=function(){function e(){this.supportCascades=!1}return e.prototype.canLoad=function(D){return Uo.a.EndsWith(D,".ktx")||Uo.a.EndsWith(D,".ktx2")},e.prototype.loadCubeData=function(D,w,N,F,k){if(!Array.isArray(D)){w._invertVScale=!w.invertY;var j=w.getEngine(),z=new Xa(D,6),G=z.numberOfMipmapLevels>1&&w.generateMipMaps;j._unpackFlipY(!0),z.uploadLevels(w,w.generateMipMaps),w.width=z.pixelWidth,w.height=z.pixelHeight,j._setCubeMapTextureParams(G),w.isReady=!0,w.onLoadedObservable.notifyObservers(w),w.onLoadedObservable.clear(),F&&F()}},e.prototype.loadData=function(D,w,N){if(Xa.IsValid(D)){w._invertVScale=!w.invertY;var F=new Xa(D,1);N(F.pixelWidth,F.pixelHeight,w.generateMipMaps,!0,(function(){F.uploadLevels(w,w.generateMipMaps)}),F.isInvalid)}else qa.IsValid(D)?new qa(w.getEngine()).uploadAsync(D,w).then((function(){N(w.width,w.height,!1,!0,(function(){}),!1)}),(function(D){oe.a.Warn("Failed to load KTX2 texture data: "+D.message),N(0,0,!1,!1,(function(){}),!0)})):N(0,0,!1,!1,(function(){}),!0)},e}();Ct.a._TextureLoaders.unshift(new Za);var $a=function(D){function t(w,N,F){var k=D.call(this,w,z.e.Zero(),N)||this;return k._xrSessionManager=F,k._firstFrame=!1,k._referenceQuaternion=z.b.Identity(),k._referencedPosition=new z.e,k._xrInvPositionCache=new z.e,k._xrInvQuaternionCache=z.b.Identity(),k.compensateOnFirstFrame=!0,k.minZ=.1,k.rotationQuaternion=new z.b,k.cameraRigMode=Xt.a.RIG_MODE_CUSTOM,k.updateUpVectorFromRotation=!0,k._updateNumberOfRigCameras(1),k._xrSessionManager.onXRSessionInit.add((function(){k._referencedPosition.copyFromFloats(0,0,0),k._referenceQuaternion.copyFromFloats(0,0,0,1),k._firstFrame=k.compensateOnFirstFrame})),k._xrSessionManager.onXRFrameObservable.add((function(D){k._firstFrame&&k._updateFromXRSession(),k._updateReferenceSpace(),k._updateFromXRSession()}),void 0,!0),k}return Object(Z.d)(t,D),Object.defineProperty(t.prototype,"realWorldHeight",{get:function(){var D=this._xrSessionManager.currentFrame&&this._xrSessionManager.currentFrame.getViewerPose(this._xrSessionManager.baseReferenceSpace);return D&&D.transform?D.transform.position.y:0},enumerable:!0,configurable:!0}),t.prototype._updateForDualEyeDebugging=function(){this._updateNumberOfRigCameras(2),this.rigCameras[0].viewport=new Bi.a(0,0,.5,1),this.rigCameras[0].outputRenderTarget=null,this.rigCameras[1].viewport=new Bi.a(.5,0,.5,1),this.rigCameras[1].outputRenderTarget=null},t.prototype.setTransformationFromNonVRCamera=function(D,w){void 0===D&&(D=this.getScene().activeCamera),void 0===w&&(w=!0),D&&D!==this&&(D.computeWorldMatrix().decompose(void 0,this.rotationQuaternion,this.position),this.position.y=0,z.b.FromEulerAnglesToRef(0,this.rotationQuaternion.toEulerAngles().y,0,this.rotationQuaternion),this._firstFrame=!0,w&&this._xrSessionManager.resetReferenceSpace())},t.prototype.getClassName=function(){return"WebXRCamera"},t.prototype._updateFromXRSession=function(){var D=this,w=this._xrSessionManager.currentFrame&&this._xrSessionManager.currentFrame.getViewerPose(this._xrSessionManager.referenceSpace);w&&(w.transform&&(this._referencedPosition.copyFrom(w.transform.position),this._referenceQuaternion.copyFrom(w.transform.orientation),this._scene.useRightHandedSystem||(this._referencedPosition.z*=-1,this._referenceQuaternion.z*=-1,this._referenceQuaternion.w*=-1),this._firstFrame?(this._firstFrame=!1,this.position.y+=this._referencedPosition.y,this._referenceQuaternion.copyFromFloats(0,0,0,1)):(this.rotationQuaternion.copyFrom(this._referenceQuaternion),this.position.copyFrom(this._referencedPosition))),this.rigCameras.length!==w.views.length&&this._updateNumberOfRigCameras(w.views.length),w.views.forEach((function(w,N){var F=D.rigCameras[N];if(F.isLeftCamera||F.isRightCamera||("right"===w.eye?F._isRightCamera=!0:"left"===w.eye&&(F._isLeftCamera=!0)),w.transform.position?(F.position.copyFrom(w.transform.position),F.rotationQuaternion.copyFrom(w.transform.orientation),D._scene.useRightHandedSystem||(F.position.z*=-1,F.rotationQuaternion.z*=-1,F.rotationQuaternion.w*=-1)):(z.a.FromFloat32ArrayToRefScaled(w.transform.matrix,0,1,F._computedViewMatrix),D._scene.useRightHandedSystem||F._computedViewMatrix.toggleModelMatrixHandInPlace()),z.a.FromFloat32ArrayToRefScaled(w.projectionMatrix,0,1,F._projectionMatrix),D._scene.useRightHandedSystem||F._projectionMatrix.toggleProjectionMatrixHandInPlace(),D._xrSessionManager.session.renderState.baseLayer){var k=D._xrSessionManager.session.renderState.baseLayer.getViewport(w),j=D._xrSessionManager.session.renderState.baseLayer.framebufferWidth,G=D._xrSessionManager.session.renderState.baseLayer.framebufferHeight;F.viewport.width=k.width/j,F.viewport.height=k.height/G,F.viewport.x=k.x/j,F.viewport.y=k.y/G}F.outputRenderTarget=D._xrSessionManager.getRenderTargetTextureForEye(w.eye)})))},t.prototype._updateNumberOfRigCameras=function(D){for(void 0===D&&(D=1);this.rigCameras.length<D;){var w=new Nn("XR-RigCamera: "+this.rigCameras.length,z.e.Zero(),this.getScene());w.minZ=.1,w.rotationQuaternion=new z.b,w.updateUpVectorFromRotation=!0,w.isRigCamera=!0,w.rigParent=this,this.rigCameras.push(w)}for(;this.rigCameras.length>D;){var N=this.rigCameras.pop();N&&N.dispose()}},t.prototype._updateReferenceSpace=function(){this.position.equals(this._referencedPosition)&&this.rotationQuaternion.equals(this._referenceQuaternion)||(this.position.subtractToRef(this._referencedPosition,this._referencedPosition),this._referenceQuaternion.conjugateInPlace(),this._referenceQuaternion.multiplyToRef(this.rotationQuaternion,this._referenceQuaternion),this._updateReferenceSpaceOffset(this._referencedPosition,this._referenceQuaternion.normalize()))},t.prototype._updateReferenceSpaceOffset=function(D,w,N){if(void 0===N&&(N=!1),this._xrSessionManager.referenceSpace&&this._xrSessionManager.currentFrame){this._xrInvPositionCache.copyFrom(D),w?this._xrInvQuaternionCache.copyFrom(w):this._xrInvQuaternionCache.copyFromFloats(0,0,0,1),this._scene.useRightHandedSystem||(this._xrInvPositionCache.z*=-1,this._xrInvQuaternionCache.z*=-1,this._xrInvQuaternionCache.w*=-1),this._xrInvPositionCache.negateInPlace(),this._xrInvQuaternionCache.conjugateInPlace(),this._xrInvPositionCache.rotateByQuaternionToRef(this._xrInvQuaternionCache,this._xrInvPositionCache),N&&(this._xrInvPositionCache.y=0);var F=new XRRigidTransform(Object(Z.a)({},this._xrInvPositionCache),Object(Z.a)({},this._xrInvQuaternionCache)),k=this._xrSessionManager.referenceSpace.getOffsetReferenceSpace(F),j=this._xrSessionManager.currentFrame&&this._xrSessionManager.currentFrame.getViewerPose(k);if(j){var G=new z.e;G.copyFrom(j.transform.position),this._scene.useRightHandedSystem||(G.z*=-1),this.position.subtractToRef(G,G),this._scene.useRightHandedSystem||(G.z*=-1),G.negateInPlace();var H=new XRRigidTransform(Object(Z.a)({},G));this._xrSessionManager.referenceSpace=k.getOffsetReferenceSpace(H)}}},t}(Fn),es=function(){function e(){}return e.ANCHOR_SYSTEM="xr-anchor-system",e.BACKGROUND_REMOVER="xr-background-remover",e.HIT_TEST="xr-hit-test",e.PHYSICS_CONTROLLERS="xr-physics-controller",e.PLANE_DETECTION="xr-plane-detection",e.POINTER_SELECTION="xr-controller-pointer-selection",e.TELEPORTATION="xr-controller-teleportation",e}(),ts=function(){function e(D){var w=this;this._xrSessionManager=D,this._features={},this._xrSessionManager.onXRSessionInit.add((function(){w.getEnabledFeatures().forEach((function(D){var N=w._features[D];!N.enabled||N.featureImplementation.attached||N.featureImplementation.disableAutoAttach||w.attachFeature(D)}))})),this._xrSessionManager.onXRSessionEnded.add((function(){w.getEnabledFeatures().forEach((function(D){var N=w._features[D];N.enabled&&N.featureImplementation.attached&&w.detachFeature(D)}))}))}return e.AddWebXRFeature=function(D,w,N,F){void 0===N&&(N=1),void 0===F&&(F=!1),this._AvailableFeatures[D]=this._AvailableFeatures[D]||{latest:N},N>this._AvailableFeatures[D].latest&&(this._AvailableFeatures[D].latest=N),F&&(this._AvailableFeatures[D].stable=N),this._AvailableFeatures[D][N]=w},e.ConstructFeature=function(D,w,N,F){void 0===w&&(w=1);var k=this._AvailableFeatures[D][w];if(!k)throw new Error("feature not found");return k(N,F)},e.GetAvailableFeatures=function(){return Object.keys(this._AvailableFeatures)},e.GetAvailableVersions=function(D){return Object.keys(this._AvailableFeatures[D])},e.GetLatestVersionOfFeature=function(D){return this._AvailableFeatures[D]&&this._AvailableFeatures[D].latest||-1},e.GetStableVersionOfFeature=function(D){return this._AvailableFeatures[D]&&this._AvailableFeatures[D].stable||-1},e.prototype.attachFeature=function(D){var w=this._features[D];w&&w.enabled&&!w.featureImplementation.attached&&w.featureImplementation.attach()},e.prototype.detachFeature=function(D){var w=this._features[D];w&&w.featureImplementation.attached&&w.featureImplementation.detach()},e.prototype.disableFeature=function(D){var w="string"==typeof D?D:D.Name,N=this._features[w];return!(!N||!N.enabled||(N.enabled=!1,this.detachFeature(w),N.featureImplementation.dispose(),0))},e.prototype.dispose=function(){var D=this;this.getEnabledFeatures().forEach((function(w){D.disableFeature(w),D._features[w].featureImplementation.dispose()}))},e.prototype.enableFeature=function(D,w,N,F){void 0===w&&(w="latest"),void 0===N&&(N={}),void 0===F&&(F=!0);var k="string"==typeof D?D:D.Name,j=0;if("string"==typeof w){if(!w)throw new Error("Error in provided version - "+k+" ("+w+")");if(-1===(j="stable"===w?e.GetStableVersionOfFeature(k):"latest"===w?e.GetLatestVersionOfFeature(k):+w)||isNaN(j))throw new Error("feature not found - "+k+" ("+w+")")}else j=w;var z=this._features[k],G=e.ConstructFeature(k,j,this._xrSessionManager,N);if(!G)throw new Error("feature not found - "+k);return z&&this.disableFeature(k),this._features[k]={featureImplementation:G(),enabled:!0,version:j},F?this._xrSessionManager.session&&!z.featureImplementation.attached&&this.attachFeature(k):this._features[k].featureImplementation.disableAutoAttach=!0,this._features[k].featureImplementation},e.prototype.getEnabledFeature=function(D){return this._features[D]&&this._features[D].featureImplementation},e.prototype.getEnabledFeatures=function(){return Object.keys(this._features)},e._AvailableFeatures={},e}(),ns=function(){function e(D){var w=this;this.scene=D,this._nonVRCamera=null,this._originalSceneAutoClear=!0,this._supported=!1,this.onInitialXRPoseSetObservable=new j.c,this.onStateChangedObservable=new j.c,this.state=er.NOT_IN_XR,this.sessionManager=new or(D),this.camera=new $a("",D,this.sessionManager),this.featuresManager=new ts(this.sessionManager),D.onDisposeObservable.add((function(){w.exitXRAsync()}))}return e.CreateAsync=function(D){var w=new e(D);return w.sessionManager.initializeAsync().then((function(){return w._supported=!0,w})).catch((function(D){throw w._setState(er.NOT_IN_XR),w.dispose(),D}))},e.prototype.dispose=function(){this.camera.dispose(),this.onStateChangedObservable.clear(),this.onInitialXRPoseSetObservable.clear(),this.sessionManager.dispose(),this._nonVRCamera&&(this.scene.activeCamera=this._nonVRCamera)},e.prototype.enterXRAsync=function(D,w,N){var F=this;if(void 0===N&&(N=this.sessionManager.getWebXRRenderTarget()),!this._supported)throw"WebXR not supported in this browser or environment";this._setState(er.ENTERING_XR);var k={optionalFeatures:"viewer"!==w&&"local"!==w?[w]:[]};return"immersive-ar"===D&&"local"!==w&&oe.a.Warn("We recommend using 'local' reference space type when using 'immersive-ar' session mode"),this.sessionManager.isSessionSupportedAsync(D).then((function(w){if(!w)throw new Error('Session mode "'+D+'" not supported in browser');return F.sessionManager.initializeSessionAsync(D,k)})).then((function(){return F.sessionManager.setReferenceSpaceTypeAsync(w)})).then((function(){return N.initializeXRLayerAsync(F.sessionManager.session)})).then((function(){return F.sessionManager.updateRenderStateAsync({depthFar:F.camera.maxZ,depthNear:F.camera.minZ,baseLayer:N.xrLayer})})).then((function(){return F.sessionManager.runXRRenderLoop(),F._originalSceneAutoClear=F.scene.autoClear,F._nonVRCamera=F.scene.activeCamera,F.scene.autoClear=!1,F.scene.activeCamera=F.camera,"immersive-ar"!==D?F._nonXRToXRCamera():F.camera.compensateOnFirstFrame=!1,F.sessionManager.onXRSessionEnded.addOnce((function(){F.camera.rigCameras.forEach((function(D){D.outputRenderTarget=null})),F.scene.autoClear=F._originalSceneAutoClear,F.scene.activeCamera=F._nonVRCamera,"immersive-ar"!==D&&F.camera.compensateOnFirstFrame&&(F._nonVRCamera.setPosition?F._nonVRCamera.setPosition(F.camera.position):F._nonVRCamera.position.copyFrom(F.camera.position)),F._setState(er.NOT_IN_XR)})),F.sessionManager.onXRFrameObservable.addOnce((function(){F._setState(er.IN_XR)})),F.sessionManager})).catch((function(D){throw console.log(D),console.log(D.message),F._setState(er.NOT_IN_XR),D}))},e.prototype.exitXRAsync=function(){return this._setState(er.EXITING_XR),this.sessionManager.exitXRAsync()},e.prototype._nonXRToXRCamera=function(){this.camera.setTransformationFromNonVRCamera(this._nonVRCamera),this.onInitialXRPoseSetObservable.notifyObservers(this.camera)},e.prototype._setState=function(D){this.state!==D&&(this.state=D,this.onStateChangedObservable.notifyObservers(this.state))},e}(),is=function(){function e(D,w,N,F){void 0===N&&(N=-1),void 0===F&&(F=[]),this.id=D,this.type=w,this._buttonIndex=N,this._axesIndices=F,this._axes={x:0,y:0},this._changes={},this._currentValue=0,this._hasChanges=!1,this._pressed=!1,this._touched=!1,this.onAxisValueChangedObservable=new j.c,this.onButtonStateChangedObservable=new j.c}return Object.defineProperty(e.prototype,"axes",{get:function(){return this._axes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"changes",{get:function(){return this._changes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasChanges",{get:function(){return this._hasChanges},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pressed",{get:function(){return this._pressed},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"touched",{get:function(){return this._touched},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this._currentValue},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this.onAxisValueChangedObservable.clear(),this.onButtonStateChangedObservable.clear()},e.prototype.isAxes=function(){return 0!==this._axesIndices.length},e.prototype.isButton=function(){return-1!==this._buttonIndex},e.prototype.update=function(D){var w=!1,N=!1;if(this._hasChanges=!1,this._changes={},this.isButton()){var F=D.buttons[this._buttonIndex];if(!F)return;this._currentValue!==F.value&&(this.changes.value={current:F.value,previous:this._currentValue},w=!0,this._currentValue=F.value),this._touched!==F.touched&&(this.changes.touched={current:F.touched,previous:this._touched},w=!0,this._touched=F.touched),this._pressed!==F.pressed&&(this.changes.pressed={current:F.pressed,previous:this._pressed},w=!0,this._pressed=F.pressed)}this.isAxes()&&(this._axes.x!==D.axes[this._axesIndices[0]]&&(this.changes.axes={current:{x:D.axes[this._axesIndices[0]],y:this._axes.y},previous:{x:this._axes.x,y:this._axes.y}},this._axes.x=D.axes[this._axesIndices[0]],N=!0),this._axes.y!==D.axes[this._axesIndices[1]]&&(this.changes.axes?this.changes.axes.current.y=D.axes[this._axesIndices[1]]:this.changes.axes={current:{x:this._axes.x,y:D.axes[this._axesIndices[1]]},previous:{x:this._axes.x,y:this._axes.y}},this._axes.y=D.axes[this._axesIndices[1]],N=!0)),w&&(this._hasChanges=!0,this.onButtonStateChangedObservable.notifyObservers(this)),N&&(this._hasChanges=!0,this.onAxisValueChangedObservable.notifyObservers(this._axes))},e.BUTTON_TYPE="button",e.SQUEEZE_TYPE="squeeze",e.THUMBSTICK_TYPE="thumbstick",e.TOUCHPAD_TYPE="touchpad",e.TRIGGER_TYPE="trigger",e}(),rs=function(){function e(D,w,N,F,k){var z=this;void 0===k&&(k=!1),this.scene=D,this.layout=w,this.gamepadObject=N,this.handness=F,this._initComponent=function(D){if(D){var w=z.layout.components[D],N=w.type,F=w.gamepadIndices.button,k=[];void 0!==w.gamepadIndices.xAxis&&void 0!==w.gamepadIndices.yAxis&&k.push(w.gamepadIndices.xAxis,w.gamepadIndices.yAxis),z.components[D]=new is(D,N,F,k)}},this._modelReady=!1,this.components={},this.disableAnimation=!1,this.onModelLoadedObservable=new j.c,w.components&&Object.keys(w.components).forEach(this._initComponent)}return e.prototype.dispose=function(){var D=this;this.getComponentIds().forEach((function(w){return D.getComponent(w).dispose()})),this.rootMesh&&this.rootMesh.dispose()},e.prototype.getAllComponentsOfType=function(D){var w=this;return this.getComponentIds().map((function(D){return w.components[D]})).filter((function(w){return w.type===D}))},e.prototype.getComponent=function(D){return this.components[D]},e.prototype.getComponentIds=function(){return Object.keys(this.components)},e.prototype.getComponentOfType=function(D){return this.getAllComponentsOfType(D)[0]||null},e.prototype.getMainComponent=function(){return this.getComponent(this.layout.selectComponentId)},e.prototype.loadModel=function(){return Object(Z.b)(this,void 0,void 0,(function(){var D,w,N=this;return Object(Z.e)(this,(function(F){return D=!this._getModelLoadingConstraints(),w=this._getGenericFilenameAndPath(),D?oe.a.Warn("Falling back to generic models"):w=this._getFilenameAndPath(),[2,new Promise((function(F,k){ro.ImportMesh("",w.path,w.filename,N.scene,(function(w){D?N._getGenericParentMesh(w):N._setRootMesh(w),N._processLoadedModel(w),N._modelReady=!0,N.onModelLoadedObservable.notifyObservers(N),F(!0)}),null,(function(D,F){oe.a.Log(F),oe.a.Warn("Failed to retrieve controller model of type "+N.profileId+" from the remote server: "+w.path+w.filename),k(F)}))}))]}))}))},e.prototype.updateFromXRFrame=function(D){var w=this;this.getComponentIds().forEach((function(D){return w.getComponent(D).update(w.gamepadObject)})),this.updateModel(D)},e.prototype._getChildByName=function(D,w){return D.getChildren((function(D){return D.name===w}),!1)[0]},e.prototype._getImmediateChildByName=function(D,w){return D.getChildren((function(D){return D.name==w}),!0)[0]},e.prototype._lerpTransform=function(D,w,N){if(D.minMesh&&D.maxMesh&&D.minMesh.rotationQuaternion&&D.maxMesh.rotationQuaternion&&D.valueMesh.rotationQuaternion){var F=N?.5*w+.5:w;z.b.SlerpToRef(D.minMesh.rotationQuaternion,D.maxMesh.rotationQuaternion,F,D.valueMesh.rotationQuaternion),z.e.LerpToRef(D.minMesh.position,D.maxMesh.position,F,D.valueMesh.position)}},e.prototype.updateModel=function(D){this._modelReady&&this._updateModel(D)},e.prototype._getGenericFilenameAndPath=function(){return{filename:"generic.babylon",path:"https://controllers.babylonjs.com/generic/"}},e.prototype._getGenericParentMesh=function(D){var w=this;this.rootMesh=new xt.a(this.profileId+" "+this.handness,this.scene),D.forEach((function(D){D.parent||(D.isPickable=!1,D.setParent(w.rootMesh))})),this.rootMesh.rotationQuaternion=z.b.FromEulerAngles(0,Math.PI,0)},e}(),os=function(D){function t(w,N,F){var k=D.call(this,w,ss[F],N,F)||this;return k.profileId=t.ProfileId,k}return Object(Z.d)(t,D),t.prototype._getFilenameAndPath=function(){return{filename:"generic.babylon",path:"https://controllers.babylonjs.com/generic/"}},t.prototype._getModelLoadingConstraints=function(){return!0},t.prototype._processLoadedModel=function(D){},t.prototype._setRootMesh=function(D){var w=this;this.rootMesh=new xt.a(this.profileId+" "+this.handness,this.scene),D.forEach((function(D){D.isPickable=!1,D.parent||D.setParent(w.rootMesh)})),this.rootMesh.rotationQuaternion=z.b.FromEulerAngles(0,Math.PI,0)},t.prototype._updateModel=function(){},t.ProfileId="generic-trigger",t}(rs),ss={left:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"generic-trigger-left",assetPath:"left.glb"},right:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"generic-trigger-right",assetPath:"right.glb"},none:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"generic-trigger-none",assetPath:"none.glb"}},cs=function(D){function t(w,N,F,k){var j=D.call(this,w,F.layouts[N.handedness||"none"],N.gamepad,N.handedness)||this;return j._repositoryUrl=k,j._buttonMeshMapping={},j._touchDots={},j.profileId=F.profileId,j}return Object(Z.d)(t,D),t.prototype.dispose=function(){var w=this;D.prototype.dispose.call(this),Object.keys(this._touchDots).forEach((function(D){w._touchDots[D].dispose()}))},t.prototype._getFilenameAndPath=function(){return{filename:this.layout.assetPath,path:this._repositoryUrl+"/profiles/"+this.profileId+"/"}},t.prototype._getModelLoadingConstraints=function(){var D=ro.IsPluginForExtensionAvailable(".glb");return D||oe.a.Warn("glTF / glb loaded was not registered, using generic controller instead"),D},t.prototype._processLoadedModel=function(D){var w=this;this.getComponentIds().forEach((function(D){var N=w.layout.components[D];w._buttonMeshMapping[D]={mainMesh:w._getChildByName(w.rootMesh,N.rootNodeName),states:{}},Object.keys(N.visualResponses).forEach((function(F){var k=N.visualResponses[F];if("transform"===k.valueNodeProperty)w._buttonMeshMapping[D].states[F]={valueMesh:w._getChildByName(w.rootMesh,k.valueNodeName),minMesh:w._getChildByName(w.rootMesh,k.minNodeName),maxMesh:w._getChildByName(w.rootMesh,k.maxNodeName)};else{var j=N.type===is.TOUCHPAD_TYPE&&N.touchPointNodeName?N.touchPointNodeName:k.valueNodeName;if(w._buttonMeshMapping[D].states[F]={valueMesh:w._getChildByName(w.rootMesh,j)},N.type===is.TOUCHPAD_TYPE&&!w._touchDots[F]){var z=vo.a.CreateSphere(F+"dot",{diameter:.0015,segments:8},w.scene);z.material=new Hi.a(F+"mat",w.scene),z.material.diffuseColor=G.a.Red(),z.parent=w._buttonMeshMapping[D].states[F].valueMesh,z.isVisible=!1,w._touchDots[F]=z}}}))}))},t.prototype._setRootMesh=function(D){var w;this.rootMesh=new xt.a(this.profileId+"-"+this.handness,this.scene),this.rootMesh.isPickable=!1;for(var N=0;N<D.length;N++){var F=D[N];F.isPickable=!1,F.parent||(w=F)}w&&w.setParent(this.rootMesh),this.rootMesh.rotate(Qe.a.Y,Math.PI,Qe.b.WORLD)},t.prototype._updateModel=function(D){var w=this;this.disableAnimation||this.getComponentIds().forEach((function(D){var N=w.getComponent(D);if(N.hasChanges){var F=w._buttonMeshMapping[D],k=w.layout.components[D];Object.keys(k.visualResponses).forEach((function(D){var j=k.visualResponses[D],z=N.value;"xAxis"===j.componentProperty?z=N.axes.x:"yAxis"===j.componentProperty&&(z=N.axes.y),"transform"===j.valueNodeProperty?w._lerpTransform(F.states[D],z,"button"!==j.componentProperty):(F.states[D].valueMesh.isVisible=N.touched||N.pressed,w._touchDots[D]&&(w._touchDots[D].isVisible=N.touched||N.pressed))}))}}))},t}(rs),us=function(){function e(){}return e.ClearProfilesCache=function(){delete this._ProfilesList,this._ProfileLoadingPromises={}},e.DefaultFallbacks=function(){this.RegisterFallbacksForProfileId("google-daydream",["generic-touchpad"]),this.RegisterFallbacksForProfileId("htc-vive-focus",["generic-trigger-touchpad"]),this.RegisterFallbacksForProfileId("htc-vive",["generic-trigger-squeeze-touchpad"]),this.RegisterFallbacksForProfileId("magicleap-one",["generic-trigger-squeeze-touchpad"]),this.RegisterFallbacksForProfileId("windows-mixed-reality",["generic-trigger-squeeze-touchpad-thumbstick"]),this.RegisterFallbacksForProfileId("microsoft-mixed-reality",["windows-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"]),this.RegisterFallbacksForProfileId("oculus-go",["generic-trigger-touchpad"]),this.RegisterFallbacksForProfileId("oculus-touch-v2",["oculus-touch","generic-trigger-squeeze-thumbstick"]),this.RegisterFallbacksForProfileId("oculus-touch",["generic-trigger-squeeze-thumbstick"]),this.RegisterFallbacksForProfileId("samsung-gearvr",["windows-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"]),this.RegisterFallbacksForProfileId("samsung-odyssey",["generic-touchpad"]),this.RegisterFallbacksForProfileId("valve-index",["generic-trigger-squeeze-touchpad-thumbstick"])},e.FindFallbackWithProfileId=function(D){var w=this._Fallbacks[D]||[];return w.unshift(D),w},e.GetMotionControllerWithXRInput=function(D,w,N){var F=this,k=[];if(N&&k.push(N),k.push.apply(k,D.profiles||[]),k.length&&!k[0]&&k.pop(),D.gamepad&&D.gamepad.id)switch(D.gamepad.id){case D.gamepad.id.match(/oculus touch/gi)?D.gamepad.id:void 0:k.push("oculus-touch-v2")}var j=k.indexOf("windows-mixed-reality");if(-1!==j&&k.splice(j,0,"microsoft-mixed-reality"),k.length||k.push("generic-trigger"),this.UseOnlineRepository){var z=this.PrioritizeOnlineRepository?this._LoadProfileFromRepository:this._LoadProfilesFromAvailableControllers,G=this.PrioritizeOnlineRepository?this._LoadProfilesFromAvailableControllers:this._LoadProfileFromRepository;return z.call(this,k,D,w).catch((function(){return G.call(F,k,D,w)}))}return this._LoadProfilesFromAvailableControllers(k,D,w)},e.RegisterController=function(D,w){this._AvailableControllers[D]=w},e.RegisterFallbacksForProfileId=function(D,w){var N;this._Fallbacks[D]?(N=this._Fallbacks[D]).push.apply(N,w):this._Fallbacks[D]=w},e.UpdateProfilesList=function(){return this._ProfilesList=Dt.b.LoadFileAsync(this.BaseRepositoryUrl+"/profiles/profilesList.json",!1).then((function(D){return JSON.parse(D.toString())})),this._ProfilesList},e._LoadProfileFromRepository=function(D,w,N){var F=this;return Promise.resolve().then((function(){return F._ProfilesList?F._ProfilesList:F.UpdateProfilesList()})).then((function(w){for(var N=0;N<D.length;++N)if(D[N]&&w[D[N]])return D[N];throw new Error("neither controller "+D[0]+" nor all fallbacks were found in the repository,")})).then((function(D){return F._ProfileLoadingPromises[D]||(F._ProfileLoadingPromises[D]=Dt.b.LoadFileAsync(F.BaseRepositoryUrl+"/profiles/"+D+"/profile.json",!1).then((function(D){return JSON.parse(D)}))),F._ProfileLoadingPromises[D]})).then((function(D){return new cs(N,w,D,F.BaseRepositoryUrl)}))},e._LoadProfilesFromAvailableControllers=function(D,w,N){for(var F=0;F<D.length;++F)if(D[F])for(var k=this.FindFallbackWithProfileId(D[F]),j=0;j<k.length;++j){var z=this._AvailableControllers[k[j]];if(z)return Promise.resolve(z(w,N))}throw new Error("no controller requested was found in the available controllers list")},e._AvailableControllers={},e._Fallbacks={},e._ProfileLoadingPromises={},e.BaseRepositoryUrl="https://immersive-web.github.io/webxr-input-profiles/packages/viewer/dist",e.PrioritizeOnlineRepository=!0,e.UseOnlineRepository=!0,e}();us.RegisterController(os.ProfileId,(function(D,w){return new os(w,D.gamepad,D.handedness)})),us.DefaultFallbacks();var ls=0,hs=function(){function e(D,w,N){var F=this;void 0===N&&(N={}),this._scene=D,this.inputSource=w,this._options=N,this._tmpQuaternion=new z.b,this._tmpVector=new z.e,this.onDisposeObservable=new j.c,this.onMeshLoadedObservable=new j.c,this.onMotionControllerInitObservable=new j.c,this._uniqueId="controller-"+ls+++"-"+w.targetRayMode+"-"+w.handedness,this.pointer=new Wt.a(this._uniqueId+"-pointer",D),this.pointer.rotationQuaternion=new z.b,this.inputSource.gripSpace&&(this.grip=new Wt.a(this._uniqueId+"-grip",this._scene),this.grip.rotationQuaternion=new z.b),this.inputSource.gamepad&&us.GetMotionControllerWithXRInput(w,D,this._options.forceControllerProfile).then((function(D){F.motionController=D,F.onMotionControllerInitObservable.notifyObservers(D),F._options.doNotLoadControllerMesh||F.motionController.loadModel().then((function(D){D&&(F.onMeshLoadedObservable.notifyObservers(F.motionController.rootMesh),F.motionController.rootMesh.parent=F.grip||F.pointer,F.motionController.disableAnimation=!!F._options.disableMotionControllerAnimation)}))}))}return Object.defineProperty(e.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this.grip&&this.grip.dispose(),this.motionController&&this.motionController.dispose(),this.pointer.dispose(),this.onMotionControllerInitObservable.clear(),this.onMeshLoadedObservable.clear(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()},e.prototype.getWorldPointerRayToRef=function(D,w){void 0===w&&(w=!1);var N=w&&this.grip?this.grip:this.pointer;N.computeWorldMatrix().decompose(void 0,this._tmpQuaternion,void 0),this._tmpVector.set(0,0,1),this._tmpVector.rotateByQuaternionToRef(this._tmpQuaternion,this._tmpVector),D.origin.copyFrom(N.absolutePosition),D.direction.copyFrom(this._tmpVector),D.length=1e3},e.prototype.updateFromXRFrame=function(D,w){var N=D.getPose(this.inputSource.targetRaySpace,w);if(N&&(this.pointer.position.copyFrom(N.transform.position),this.pointer.rotationQuaternion.copyFrom(N.transform.orientation),this._scene.useRightHandedSystem||(this.pointer.position.z*=-1,this.pointer.rotationQuaternion.z*=-1,this.pointer.rotationQuaternion.w*=-1)),this.inputSource.gripSpace&&this.grip){var F=D.getPose(this.inputSource.gripSpace,w);F&&(this.grip.position.copyFrom(F.transform.position),this.grip.rotationQuaternion.copyFrom(F.transform.orientation),this._scene.useRightHandedSystem||(this.grip.position.z*=-1,this.grip.rotationQuaternion.z*=-1,this.grip.rotationQuaternion.w*=-1))}this.motionController&&this.motionController.updateFromXRFrame(D)},e}(),ds=function(){function e(D,w,N){var F=this;void 0===N&&(N={}),this.xrSessionManager=D,this.xrCamera=w,this.options=N,this.controllers=[],this.onControllerAddedObservable=new j.c,this.onControllerRemovedObservable=new j.c,this._onInputSourcesChange=function(D){F._addAndRemoveControllers(D.added,D.removed)},this._sessionEndedObserver=this.xrSessionManager.onXRSessionEnded.add((function(){F._addAndRemoveControllers([],F.controllers.map((function(D){return D.inputSource})))})),this._sessionInitObserver=this.xrSessionManager.onXRSessionInit.add((function(D){D.addEventListener("inputsourceschange",F._onInputSourcesChange)})),this._frameObserver=this.xrSessionManager.onXRFrameObservable.add((function(D){F.controllers.forEach((function(w){w.updateFromXRFrame(D,F.xrSessionManager.referenceSpace)}))})),this.options.customControllersRepositoryURL&&(us.BaseRepositoryUrl=this.options.customControllersRepositoryURL),this.options.disableOnlineControllerRepository?us.UseOnlineRepository=!1:(us.UseOnlineRepository=!0,us.UpdateProfilesList())}return e.prototype._addAndRemoveControllers=function(D,w){for(var N=this,F=this.controllers.map((function(D){return D.inputSource})),k=0,j=D;k<j.length;k++){var z=j[k];if(-1===F.indexOf(z)){var G=new hs(this.xrSessionManager.scene,z,{forceControllerProfile:this.options.forceInputProfile,doNotLoadControllerMesh:this.options.doNotLoadControllerMeshes,disableMotionControllerAnimation:this.options.disableControllerAnimation});this.controllers.push(G),this.onControllerAddedObservable.notifyObservers(G)}}var H=[],X=[];this.controllers.forEach((function(D){-1===w.indexOf(D.inputSource)?H.push(D):X.push(D)})),this.controllers=H,X.forEach((function(D){N.onControllerRemovedObservable.notifyObservers(D),D.dispose()}))},e.prototype.dispose=function(){this.controllers.forEach((function(D){D.dispose()})),this.xrSessionManager.onXRFrameObservable.remove(this._frameObserver),this.xrSessionManager.onXRSessionInit.remove(this._sessionInitObserver),this.xrSessionManager.onXRSessionEnded.remove(this._sessionEndedObserver),this.onControllerAddedObservable.clear(),this.onControllerRemovedObservable.clear()},e}(),fs=function(){function e(D){this._xrSessionManager=D,this._attached=!1,this._removeOnDetach=[],this.disableAutoAttach=!1}return Object.defineProperty(e.prototype,"attached",{get:function(){return this._attached},enumerable:!0,configurable:!0}),e.prototype.attach=function(D){var w=this;if(D)this.attached&&this.detach();else if(this.attached)return!1;return this._attached=!0,this._addNewAttachObserver(this._xrSessionManager.onXRFrameObservable,(function(D){return w._onXRFrame(D)})),!0},e.prototype.detach=function(){return this._attached?(this._attached=!1,this._removeOnDetach.forEach((function(D){D.observable.remove(D.observer)})),!0):(this.disableAutoAttach=!0,!1)},e.prototype.dispose=function(){this.detach()},e.prototype._addNewAttachObserver=function(D,w){this._removeOnDetach.push({observable:D,observer:D.add(w)})},e}(),ps=function(D){function t(w,N){var F=D.call(this,w)||this;return F._options=N,F._attachController=function(D){if(!F._controllers[D.uniqueId]){var w=F._generateNewMeshPair(D),N=w.laserPointer,k=w.selectionMesh;switch(F._controllers[D.uniqueId]={xrController:D,laserPointer:N,selectionMesh:k,meshUnderPointer:null,pick:null,tmpRay:new Qn.a(new z.e,new z.e),id:t._idCounter++},D.inputSource.targetRayMode){case"tracked-pointer":return F._attachTrackedPointerRayMode(D);case"gaze":return F._attachGazeMode(D);case"screen":return F._attachScreenRayMode(D)}}},F._controllers={},F._tmpVectorForPickCompare=new z.e,F.disablePointerLighting=!0,F.disableSelectionMeshLighting=!0,F.displayLaserPointer=!0,F.displaySelectionMesh=!0,F.laserPointerPickedColor=new G.a(.9,.9,.9),F.lasterPointerDefaultColor=new G.a(.7,.7,.7),F.selectionMeshDefaultColor=new G.a(.8,.8,.8),F.selectionMeshPickedColor=new G.a(.3,.3,1),F._scene=F._xrSessionManager.scene,F}return Object(Z.d)(t,D),t.prototype.attach=function(){var w=this;return!!D.prototype.attach.call(this)&&(this._options.xrInput.controllers.forEach(this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerAddedObservable,this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerRemovedObservable,(function(D){w._detachController(D.uniqueId)})),!0)},t.prototype.detach=function(){var w=this;return!!D.prototype.detach.call(this)&&(Object.keys(this._controllers).forEach((function(D){w._detachController(D)})),!0)},t.prototype.getMeshUnderPointer=function(D){return this._controllers[D]?this._controllers[D].meshUnderPointer:null},t.prototype.getXRControllerByPointerId=function(D){for(var w=Object.keys(this._controllers),N=0;N<w.length;++N)if(this._controllers[w[N]].id===D)return this._controllers[w[N]].xrController;return null},t.prototype._onXRFrame=function(D){var w=this;Object.keys(this._controllers).forEach((function(D){var N=w._controllers[D];N.xrController.getWorldPointerRayToRef(N.tmpRay),N.pick=w._scene.pickWithRay(N.tmpRay);var F=N.pick;if(F&&F.pickedPoint&&F.hit){w._updatePointerDistance(N.laserPointer,F.distance),N.selectionMesh.position.copyFrom(F.pickedPoint),N.selectionMesh.scaling.x=Math.sqrt(F.distance),N.selectionMesh.scaling.y=Math.sqrt(F.distance),N.selectionMesh.scaling.z=Math.sqrt(F.distance);var k=w._convertNormalToDirectionOfRay(F.getNormal(!0),N.tmpRay);if(N.selectionMesh.position.copyFrom(F.pickedPoint),k){var j=z.e.Cross(Qe.a.Y,k),G=z.e.Cross(k,j);z.e.RotationFromAxisToRef(G,k,j,N.selectionMesh.rotation),N.selectionMesh.position.addInPlace(k.scale(.001))}N.selectionMesh.isVisible=w.displaySelectionMesh,N.meshUnderPointer=F.pickedMesh}else N.selectionMesh.isVisible=!1,N.meshUnderPointer=null}))},t.prototype._attachGazeMode=function(D){var w=this,N=this._controllers[D.uniqueId],F=this._options.timeToSelect||3e3,k=this._options.useUtilityLayer?this._options.customUtilityLayerScene||mo.a.DefaultUtilityLayer.utilityLayerScene:this._scene,j=new _r.a,z=tr.CreateTorus("selection",{diameter:.0525,thickness:.015,tessellation:20},k);z.isVisible=!1,z.isPickable=!1,z.parent=N.selectionMesh;var G=0,H=!1;N.onFrameObserver=this._xrSessionManager.onXRFrameObservable.add((function(){if(N.pick){if(z.isVisible=!1,N.pick.hit)if(w._pickingMoved(j,N.pick))H&&(w._options.disablePointerUpOnTouchOut||w._scene.simulatePointerUp(N.pick,{pointerId:N.id})),H=!1,G=0;else if(G>F/10&&(z.isVisible=!0),(G+=w._scene.getEngine().getDeltaTime())>=F)w._scene.simulatePointerDown(N.pick,{pointerId:N.id}),H=!0,w._options.disablePointerUpOnTouchOut&&w._scene.simulatePointerUp(N.pick,{pointerId:N.id}),z.isVisible=!1;else{var D=1-G/F;z.scaling.set(D,D,D)}else H=!1,G=0;w._scene.simulatePointerMove(N.pick,{pointerId:N.id}),j=N.pick}})),void 0!==this._options.renderingGroupId&&(z.renderingGroupId=this._options.renderingGroupId),D.onDisposeObservable.addOnce((function(){N.pick&&!w._options.disablePointerUpOnTouchOut&&H&&w._scene.simulatePointerUp(N.pick,{pointerId:N.id}),z.dispose()}))},t.prototype._attachScreenRayMode=function(D){var w=this,N=this._controllers[D.uniqueId],F=!1;N.onFrameObserver=this._xrSessionManager.onXRFrameObservable.add((function(){!N.pick||w._options.disablePointerUpOnTouchOut&&F||(F?w._scene.simulatePointerMove(N.pick,{pointerId:N.id}):(w._scene.simulatePointerDown(N.pick,{pointerId:N.id}),F=!0,w._options.disablePointerUpOnTouchOut&&w._scene.simulatePointerUp(N.pick,{pointerId:N.id})))})),D.onDisposeObservable.addOnce((function(){N.pick&&F&&!w._options.disablePointerUpOnTouchOut&&w._scene.simulatePointerUp(N.pick,{pointerId:N.id})}))},t.prototype._attachTrackedPointerRayMode=function(D){var w=this;D.onMotionControllerInitObservable.add((function(N){if(w._options.forceGazeMode)return w._attachGazeMode(D);var F=w._controllers[D.uniqueId];w._options.overrideButtonId&&(F.selectionComponent=N.getComponent(w._options.overrideButtonId)),F.selectionComponent||(F.selectionComponent=N.getMainComponent()),F.onFrameObserver=w._xrSessionManager.onXRFrameObservable.add((function(){F.selectionComponent&&F.selectionComponent.pressed?(F.selectionMesh.material.emissiveColor=w.selectionMeshPickedColor,F.laserPointer.material.emissiveColor=w.laserPointerPickedColor):(F.selectionMesh.material.emissiveColor=w.selectionMeshDefaultColor,F.laserPointer.material.emissiveColor=w.lasterPointerDefaultColor),F.laserPointer.isVisible=w.displayLaserPointer,F.laserPointer.material.disableLighting=w.disablePointerLighting,F.selectionMesh.material.disableLighting=w.disableSelectionMeshLighting,F.pick&&w._scene.simulatePointerMove(F.pick,{pointerId:F.id})})),F.onButtonChangedObserver=F.selectionComponent.onButtonStateChangedObservable.add((function(D){if(D.changes.pressed){var N=D.changes.pressed.current;F.pick&&(N?w._scene.simulatePointerDown(F.pick,{pointerId:F.id}):w._scene.simulatePointerUp(F.pick,{pointerId:F.id}))}}))}))},t.prototype._convertNormalToDirectionOfRay=function(D,w){return D&&Math.acos(z.e.Dot(D,w.direction))<Math.PI/2&&D.scaleInPlace(-1),D},t.prototype._detachController=function(D){var w=this._controllers[D];w&&(w.selectionComponent&&w.onButtonChangedObserver&&w.selectionComponent.onButtonStateChangedObservable.remove(w.onButtonChangedObserver),w.onFrameObserver&&this._xrSessionManager.onXRFrameObservable.remove(w.onFrameObserver),w.selectionMesh.dispose(),w.laserPointer.dispose(),delete this._controllers[D])},t.prototype._generateNewMeshPair=function(D){var w=this._options.useUtilityLayer?this._options.customUtilityLayerScene||mo.a.DefaultUtilityLayer.utilityLayerScene:this._scene,N=nr.a.CreateCylinder("laserPointer",{height:1,diameterTop:2e-4,diameterBottom:.004,tessellation:20,subdivisions:1},w);N.parent=D.pointer;var F=new Hi.a("laserPointerMat",w);F.emissiveColor=this.lasterPointerDefaultColor,F.alpha=.7,N.material=F,N.rotation.x=Math.PI/2,this._updatePointerDistance(N,1),N.isPickable=!1;var k=tr.CreateTorus("gazeTracker",{diameter:.0105,thickness:.0075,tessellation:20},w);k.bakeCurrentTransformIntoVertices(),k.isPickable=!1,k.isVisible=!1;var j=new Hi.a("targetMat",w);return j.specularColor=G.a.Black(),j.emissiveColor=this.selectionMeshDefaultColor,j.backFaceCulling=!1,k.material=j,void 0!==this._options.renderingGroupId&&(N.renderingGroupId=this._options.renderingGroupId,k.renderingGroupId=this._options.renderingGroupId),{laserPointer:N,selectionMesh:k}},t.prototype._pickingMoved=function(D,w){var N;if(!D.hit||!w.hit)return!0;if(!(D.pickedMesh&&D.pickedPoint&&w.pickedMesh&&w.pickedPoint))return!0;if(D.pickedMesh!==w.pickedMesh)return!0;null===(N=D.pickedPoint)||void 0===N||N.subtractToRef(w.pickedPoint,this._tmpVectorForPickCompare),this._tmpVectorForPickCompare.set(Math.abs(this._tmpVectorForPickCompare.x),Math.abs(this._tmpVectorForPickCompare.y),Math.abs(this._tmpVectorForPickCompare.z));var F=.01*(this._options.gazeModePointerMovedFactor||1)/w.distance;return this._tmpVectorForPickCompare.length()>F},t.prototype._updatePointerDistance=function(D,w){void 0===w&&(w=100),D.scaling.y=w,D.position.z=w/2+.05},t._idCounter=0,t.Name=es.POINTER_SELECTION,t.Version=1,t}(fs);ts.AddWebXRFeature(ps.Name,(function(D,w){return function(){return new ps(D,w)}}),ps.Version,!0);var _s=function(){function e(D,w,N){this.element=D,this.sessionMode=w,this.referenceSpaceType=N}return e.prototype.update=function(D){},e}(),_a=function(){},ms=function(){function e(D,w){var N=this;if(this.scene=D,this.options=w,this._activeButton=null,this._buttons=[],this.activeButtonChangedObservable=new j.c,this._overlay=document.createElement("div"),this._overlay.style.cssText="z-index:11;position: absolute; right: 20px;bottom: 50px;",w.customButtons)this._buttons=w.customButtons;else{var F=w.sessionMode||"immersive-vr",k=w.referenceSpaceType||"local-floor",z=".babylonVRicon { color: #868686; border-color: #868686; border-style: solid; margin-left: 10px; height: 50px; width: 80px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%222048%22%20height%3D%221152%22%20viewBox%3D%220%200%202048%201152%22%20version%3D%221.1%22%3E%3Cpath%20transform%3D%22rotate%28180%201024%2C576.0000000000001%29%22%20d%3D%22m1109%2C896q17%2C0%2030%2C-12t13%2C-30t-12.5%2C-30.5t-30.5%2C-12.5l-170%2C0q-18%2C0%20-30.5%2C12.5t-12.5%2C30.5t13%2C30t30%2C12l170%2C0zm-85%2C256q59%2C0%20132.5%2C-1.5t154.5%2C-5.5t164.5%2C-11.5t163%2C-20t150%2C-30t124.5%2C-41.5q23%2C-11%2042%2C-24t38%2C-30q27%2C-25%2041%2C-61.5t14%2C-72.5l0%2C-257q0%2C-123%20-47%2C-232t-128%2C-190t-190%2C-128t-232%2C-47l-81%2C0q-37%2C0%20-68.5%2C14t-60.5%2C34.5t-55.5%2C45t-53%2C45t-53%2C34.5t-55.5%2C14t-55.5%2C-14t-53%2C-34.5t-53%2C-45t-55.5%2C-45t-60.5%2C-34.5t-68.5%2C-14l-81%2C0q-123%2C0%20-232%2C47t-190%2C128t-128%2C190t-47%2C232l0%2C257q0%2C68%2038%2C115t97%2C73q54%2C24%20124.5%2C41.5t150%2C30t163%2C20t164.5%2C11.5t154.5%2C5.5t132.5%2C1.5zm939%2C-298q0%2C39%20-24.5%2C67t-58.5%2C42q-54%2C23%20-122%2C39.5t-143.5%2C28t-155.5%2C19t-157%2C11t-148.5%2C5t-129.5%2C1.5q-59%2C0%20-130%2C-1.5t-148%2C-5t-157%2C-11t-155.5%2C-19t-143.5%2C-28t-122%2C-39.5q-34%2C-14%20-58.5%2C-42t-24.5%2C-67l0%2C-257q0%2C-106%2040.5%2C-199t110%2C-162.5t162.5%2C-109.5t199%2C-40l81%2C0q27%2C0%2052%2C14t50%2C34.5t51%2C44.5t55.5%2C44.5t63.5%2C34.5t74%2C14t74%2C-14t63.5%2C-34.5t55.5%2C-44.5t51%2C-44.5t50%2C-34.5t52%2C-14l14%2C0q37%2C0%2070%2C0.5t64.5%2C4.5t63.5%2C12t68%2C23q71%2C30%20128.5%2C78.5t98.5%2C110t63.5%2C133.5t22.5%2C149l0%2C257z%22%20fill%3D%22white%22%20/%3E%3C/svg%3E%0A":"https://cdn.babylonjs.com/Assets/vrButton.png")+"); background-size: 80%; background-repeat:no-repeat; background-position: center; border: none; outline: none; transition: transform 0.125s ease-out } .babylonVRicon:hover { transform: scale(1.05) } .babylonVRicon:active {background-color: rgba(51,51,51,1) } .babylonVRicon:focus {background-color: rgba(51,51,51,1) }";z+='.babylonVRicon.vrdisplaypresenting { background-image: none;} .vrdisplaypresenting::after { content: "EXIT"} .xr-error::after { content: "ERROR"}';var G=document.createElement("style");G.appendChild(document.createTextNode(z)),document.getElementsByTagName("head")[0].appendChild(G);var H=document.createElement("button");H.className="babylonVRicon",H.title=F+" - "+k,this._buttons.push(new _s(H,F,k)),this._buttons[this._buttons.length-1].update=function(D){this.element.style.display=null===D||D===this?"":"none",H.className="babylonVRicon"+(D===this?" vrdisplaypresenting":"")},this._updateButtons(null)}var X=D.getEngine().getInputElement();X&&X.parentNode&&(X.parentNode.appendChild(this._overlay),D.onDisposeObservable.addOnce((function(){N.dispose()})))}return e.CreateAsync=function(D,w,N){var F=this,k=new e(D,N),j=k._buttons.map((function(D){return w.sessionManager.isSessionSupportedAsync(D.sessionMode)}));return w.onStateChangedObservable.add((function(D){D==er.NOT_IN_XR&&k._updateButtons(null)})),Promise.all(j).then((function(D){return D.forEach((function(D,j){D&&(k._overlay.appendChild(k._buttons[j].element),k._buttons[j].element.onclick=function(){return Object(Z.b)(F,void 0,void 0,(function(){var D,F;return Object(Z.e)(this,(function(z){switch(z.label){case 0:return w.state!=er.IN_XR?[3,2]:[4,w.exitXRAsync()];case 1:return z.sent(),k._updateButtons(null),[3,6];case 2:if(w.state!=er.NOT_IN_XR)return[3,6];if(!N.renderTarget)return[3,6];z.label=3;case 3:return z.trys.push([3,5,,6]),[4,w.enterXRAsync(k._buttons[j].sessionMode,k._buttons[j].referenceSpaceType,N.renderTarget)];case 4:return z.sent(),k._updateButtons(k._buttons[j]),[3,6];case 5:return z.sent(),k._updateButtons(null),D=k._buttons[j].element,F=D.title,D.title="Error entering XR session : "+F,D.classList.add("xr-error"),[3,6];case 6:return[2]}}))}))})})),k}))},e.prototype.dispose=function(){var D=this.scene.getEngine().getInputElement();D&&D.parentNode&&D.parentNode.contains(this._overlay)&&D.parentNode.removeChild(this._overlay),this.activeButtonChangedObservable.clear()},e.prototype._updateButtons=function(D){var w=this;this._activeButton=D,this._buttons.forEach((function(D){D.update(w._activeButton)})),this.activeButtonChangedObservable.notifyObservers(this._activeButton)},e}(),gs=function(D){function t(w,N){var F=D.call(this,w)||this;return F._options=N,F._controllers={},F._snappedToPoint=!1,F._tmpRay=new Qn.a(new z.e,new z.e),F._tmpVector=new z.e,F.backwardsMovementEnabled=!0,F.backwardsTeleportationDistance=.7,F.parabolicCheckRadius=5,F.parabolicRayEnabled=!0,F.rotationAngle=Math.PI/8,F.rotationEnabled=!0,F._attachController=function(D){if(!F._controllers[D.uniqueId]){F._controllers[D.uniqueId]={xrController:D,teleportationState:{forward:!1,backwards:!1,rotating:!1,currentRotation:0,baseRotation:0}};var w=F._controllers[D.uniqueId];D.onMotionControllerInitObservable.addOnce((function(){if(D.motionController){var N=D.motionController.getComponentOfType(is.THUMBSTICK_TYPE)||D.motionController.getComponentOfType(is.TOUCHPAD_TYPE);if(!N||F._options.useMainComponentOnly){var k=D.motionController.getMainComponent();if(!k)return;w.onButtonChangedObserver=k.onButtonStateChangedObservable.add((function(){if(k.changes.pressed)if(k.changes.pressed.current){w.teleportationState.forward=!0,F._currentTeleportationControllerId=w.xrController.uniqueId,w.teleportationState.baseRotation=F._options.xrInput.xrCamera.rotationQuaternion.toEulerAngles().y,w.teleportationState.currentRotation=0;var N=F._options.timeToTeleport||3e3,j=0,z=F._xrSessionManager.onXRFrameObservable.add((function(){k.pressed?((j+=F._xrSessionManager.scene.getEngine().getDeltaTime())>=N&&F._currentTeleportationControllerId===w.xrController.uniqueId&&w.teleportationState.forward&&F._teleportForward(D.uniqueId),j>=N&&F._xrSessionManager.onXRFrameObservable.remove(z)):F._xrSessionManager.onXRFrameObservable.remove(z)}))}else w.teleportationState.forward=!1,F._currentTeleportationControllerId=""}))}else w.onButtonChangedObserver=N.onButtonStateChangedObservable.add((function(){F._currentTeleportationControllerId===w.xrController.uniqueId&&w.teleportationState.forward&&!N.touched&&F._teleportForward(D.uniqueId)})),w.onAxisChangedObserver=N.onAxisValueChangedObservable.add((function(D){if(D.y<=.7&&w.teleportationState.backwards&&(w.teleportationState.backwards=!1),D.y>.7&&!w.teleportationState.forward&&F.backwardsMovementEnabled&&!F.snapPointsOnly&&!w.teleportationState.backwards){w.teleportationState.backwards=!0,F._tmpVector.set(0,0,F.backwardsTeleportationDistance),F._tmpVector.rotateByQuaternionToRef(F._options.xrInput.xrCamera.rotationQuaternion,F._tmpVector),F._tmpVector.addInPlace(F._options.xrInput.xrCamera.position),F._options.xrInput.xrCamera.position.subtractToRef(F._tmpVector,F._tmpVector),F._tmpRay.origin.copyFrom(F._tmpVector),F._tmpRay.direction.set(0,-1,0);var N=F._xrSessionManager.scene.pickWithRay(F._tmpRay,(function(D){return-1!==F._floorMeshes.indexOf(D)}));N&&N.pickedPoint&&F._options.xrInput.xrCamera.position.addInPlace(N.pickedPoint)}if(D.y<-.7&&!F._currentTeleportationControllerId&&!w.teleportationState.rotating&&(w.teleportationState.forward=!0,F._currentTeleportationControllerId=w.xrController.uniqueId,w.teleportationState.baseRotation=F._options.xrInput.xrCamera.rotationQuaternion.toEulerAngles().y),D.x){if(w.teleportationState.forward)F._currentTeleportationControllerId===w.xrController.uniqueId&&(F.rotationEnabled?setTimeout((function(){w.teleportationState.currentRotation=Math.atan2(D.x,-D.y)})):w.teleportationState.currentRotation=0);else if(!w.teleportationState.rotating&&Math.abs(D.x)>.7){w.teleportationState.rotating=!0;var k=F.rotationAngle*(D.x>0?1:-1);F._options.xrInput.xrCamera.rotationQuaternion.multiplyInPlace(z.b.FromEulerAngles(0,k,0))}}else w.teleportationState.rotating=!1}))}}))}},F._options.teleportationTargetMesh||F._createDefaultTargetMesh(),F._floorMeshes=F._options.floorMeshes||[],F._snapToPositions=F._options.snapPositions||[],F._setTargetMeshVisibility(!1),F}return Object(Z.d)(t,D),Object.defineProperty(t.prototype,"snapPointsOnly",{get:function(){return!!this._options.snapPointsOnly},set:function(D){this._options.snapPointsOnly=D},enumerable:!0,configurable:!0}),t.prototype.addFloorMesh=function(D){this._floorMeshes.push(D)},t.prototype.addSnapPoint=function(D){this._snapToPositions.push(D)},t.prototype.attach=function(){var w=this;return!!D.prototype.attach.call(this)&&(this._options.xrInput.controllers.forEach(this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerAddedObservable,this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerRemovedObservable,(function(D){w._detachController(D.uniqueId)})),!0)},t.prototype.detach=function(){var w=this;return!!D.prototype.detach.call(this)&&(Object.keys(this._controllers).forEach((function(D){w._detachController(D)})),this._setTargetMeshVisibility(!1),!0)},t.prototype.dispose=function(){D.prototype.dispose.call(this),this._options.teleportationTargetMesh&&this._options.teleportationTargetMesh.dispose(!1,!0)},t.prototype.removeFloorMesh=function(D){var w=this._floorMeshes.indexOf(D);-1!==w&&this._floorMeshes.splice(w,1)},t.prototype.removeFloorMeshByName=function(D){var w=this._xrSessionManager.scene.getMeshByName(D);w&&this.removeFloorMesh(w)},t.prototype.removeSnapPoint=function(D){var w=this._snapToPositions.indexOf(D);if(-1===w)for(var N=0;N<this._snapToPositions.length;++N)if(this._snapToPositions[N].equals(D)){w=N;break}return-1!==w&&(this._snapToPositions.splice(w,1),!0)},t.prototype.setSelectionFeature=function(D){this._selectionFeature=D},t.prototype._onXRFrame=function(D){var w=this,N=this._xrSessionManager.currentFrame,F=this._xrSessionManager.scene;if(this.attach&&N){var k=this._options.teleportationTargetMesh;if(this._currentTeleportationControllerId){if(!k)return;k.rotationQuaternion=k.rotationQuaternion||new z.b;var j=this._controllers[this._currentTeleportationControllerId];if(j.teleportationState.forward){z.b.RotationYawPitchRollToRef(j.teleportationState.currentRotation+j.teleportationState.baseRotation,0,0,k.rotationQuaternion);var G=!1;j.xrController.getWorldPointerRayToRef(this._tmpRay);var H=F.pickWithRay(this._tmpRay,(function(D){var N=w._floorMeshes.indexOf(D);return-1!==N&&w._floorMeshes[N].absolutePosition.y<w._options.xrInput.xrCamera.position.y}));if(H&&H.pickedPoint)G=!0,this._setTargetMeshPosition(H.pickedPoint),this._setTargetMeshVisibility(!0),this._showParabolicPath(H);else if(this.parabolicRayEnabled){var X=j.xrController.pointer.rotationQuaternion.toEulerAngles().x,q=Math.PI/2-Math.abs(X)+1,Z=this.parabolicCheckRadius*q;this._tmpRay.origin.addToRef(this._tmpRay.direction.scale(2*Z),this._tmpVector),this._tmpVector.y=this._tmpRay.origin.y,this._tmpRay.origin.addInPlace(this._tmpRay.direction.scale(Z)),this._tmpVector.subtractToRef(this._tmpRay.origin,this._tmpRay.direction),this._tmpRay.direction.normalize();var J=F.pickWithRay(this._tmpRay,(function(D){return-1!==w._floorMeshes.indexOf(D)}));J&&J.pickedPoint&&(G=!0,this._setTargetMeshPosition(J.pickedPoint),this._setTargetMeshVisibility(!0),this._showParabolicPath(J))}this._setTargetMeshVisibility(G)}else this._setTargetMeshVisibility(!1)}else this._setTargetMeshVisibility(!1)}},t.prototype._createDefaultTargetMesh=function(){this._options.defaultTargetMeshOptions=this._options.defaultTargetMeshOptions||{};var D=this._options.useUtilityLayer?this._options.customUtilityLayerScene||mo.a.DefaultUtilityLayer.utilityLayerScene:this._xrSessionManager.scene,w=$i.CreateGround("teleportationTarget",{width:2,height:2,subdivisions:2},D);w.isPickable=!1;var N=new Xi("teleportationPlaneDynamicTexture",512,D,!0);N.hasAlpha=!0;var F=N.getContext();F.beginPath(),F.arc(256,256,200,0,2*Math.PI,!1),F.fillStyle=this._options.defaultTargetMeshOptions.teleportationFillColor||"#444444",F.fill(),F.lineWidth=10,F.strokeStyle=this._options.defaultTargetMeshOptions.teleportationBorderColor||"#FFFFFF",F.stroke(),F.closePath(),N.update();var k=new Hi.a("teleportationPlaneMaterial",D);k.diffuseTexture=N,w.material=k;var j=tr.CreateTorus("torusTeleportation",{diameter:.75,thickness:.1,tessellation:20},D);if(j.isPickable=!1,j.parent=w,!this._options.defaultTargetMeshOptions.disableAnimation){var z=new Fe("animationInnerCircle","position.y",30,Fe.ANIMATIONTYPE_FLOAT,Fe.ANIMATIONLOOPMODE_CYCLE),H=[];H.push({frame:0,value:0}),H.push({frame:30,value:.4}),H.push({frame:60,value:0}),z.setKeys(H);var X=new Et;X.setEasingMode(ht.EASINGMODE_EASEINOUT),z.setEasingFunction(X),j.animations=[],j.animations.push(z),D.beginAnimation(j,0,60,!0)}var q=nr.a.CreateCylinder("cone",{diameterTop:0,tessellation:4},D);if(q.isPickable=!1,q.scaling.set(.5,.12,.2),q.rotate(Qe.a.X,Math.PI/2),q.position.z=.6,q.parent=j,this._options.defaultTargetMeshOptions.torusArrowMaterial)j.material=this._options.defaultTargetMeshOptions.torusArrowMaterial,q.material=this._options.defaultTargetMeshOptions.torusArrowMaterial;else{var Z=new Hi.a("torusConsMat",D);Z.disableLighting=!!this._options.defaultTargetMeshOptions.disableLighting,Z.disableLighting?Z.emissiveColor=new G.a(.3,.3,1):Z.diffuseColor=new G.a(.3,.3,1),Z.alpha=.9,j.material=Z,q.material=Z,this._teleportationRingMaterial=Z}void 0!==this._options.renderingGroupId&&(w.renderingGroupId=this._options.renderingGroupId,j.renderingGroupId=this._options.renderingGroupId,q.renderingGroupId=this._options.renderingGroupId),this._options.teleportationTargetMesh=w},t.prototype._detachController=function(D){var w=this._controllers[D];w&&(w.teleportationComponent&&(w.onAxisChangedObserver&&w.teleportationComponent.onAxisValueChangedObservable.remove(w.onAxisChangedObserver),w.onButtonChangedObserver&&w.teleportationComponent.onButtonStateChangedObservable.remove(w.onButtonChangedObserver)),delete this._controllers[D])},t.prototype._findClosestSnapPointWithRadius=function(D,w){void 0===w&&(w=this._options.snapToPositionRadius||.8);var N=null,F=Number.MAX_VALUE;if(this._snapToPositions.length){var k=w*w;this._snapToPositions.forEach((function(w){var j=z.e.DistanceSquared(w,D);j<=k&&j<F&&(F=j,N=w)}))}return N},t.prototype._setTargetMeshPosition=function(D){if(this._options.teleportationTargetMesh){var w=this._findClosestSnapPointWithRadius(D);this._snappedToPoint=!!w,this.snapPointsOnly&&!this._snappedToPoint&&this._teleportationRingMaterial?this._teleportationRingMaterial.diffuseColor.set(1,.3,.3):this.snapPointsOnly&&this._snappedToPoint&&this._teleportationRingMaterial&&this._teleportationRingMaterial.diffuseColor.set(.3,.3,1),this._options.teleportationTargetMesh.position.copyFrom(w||D),this._options.teleportationTargetMesh.position.y+=.01}},t.prototype._setTargetMeshVisibility=function(D){this._options.teleportationTargetMesh&&this._options.teleportationTargetMesh.isVisible!==D&&(this._options.teleportationTargetMesh.isVisible=D,this._options.teleportationTargetMesh.getChildren(void 0,!1).forEach((function(w){w.isVisible=D})),D?this._selectionFeature&&this._selectionFeature.detach():(this._quadraticBezierCurve&&this._quadraticBezierCurve.dispose(),this._selectionFeature&&this._selectionFeature.attach()))},t.prototype._showParabolicPath=function(D){if(D.pickedPoint){var w=this._controllers[this._currentTeleportationControllerId],N=lt.CreateQuadraticBezier(w.xrController.pointer.absolutePosition,D.ray.origin,D.pickedPoint,25);this._quadraticBezierCurve&&this._quadraticBezierCurve.dispose(),this._quadraticBezierCurve=yo.a.CreateLines("path line",{points:N.getPoints()}),this._quadraticBezierCurve.isPickable=!1}},t.prototype._teleportForward=function(D){var w=this._controllers[D];if(w.teleportationState.forward=!1,this._currentTeleportationControllerId="",(!this.snapPointsOnly||this._snappedToPoint)&&this._options.teleportationTargetMesh&&this._options.teleportationTargetMesh.isVisible){var N=this._options.xrInput.xrCamera.realWorldHeight;this._options.xrInput.xrCamera.position.copyFrom(this._options.teleportationTargetMesh.position),this._options.xrInput.xrCamera.position.y+=N,this._options.xrInput.xrCamera.rotationQuaternion.multiplyInPlace(z.b.FromEulerAngles(0,w.teleportationState.currentRotation,0))}},t.Name=es.TELEPORTATION,t.Version=1,t}(fs);ts.AddWebXRFeature(gs.Name,(function(D,w){return function(){return new gs(D,w)}}),gs.Version,!0);var va=function(){},vs=function(){function e(){}return e.CreateAsync=function(D,w){void 0===w&&(w={});var N=new e;return ns.CreateAsync(D).then((function(F){return N.baseExperience=F,w.ignoreNativeCameraTransformation&&(N.baseExperience.camera.compensateOnFirstFrame=!1),N.input=new ds(F.sessionManager,F.camera,w.inputOptions),N.pointerSelection=N.baseExperience.featuresManager.enableFeature(ps.Name,w.useStablePlugins?"stable":"latest",{xrInput:N.input}),w.disableTeleportation||(N.teleportation=N.baseExperience.featuresManager.enableFeature(gs.Name,w.useStablePlugins?"stable":"latest",{floorMeshes:w.floorMeshes,xrInput:N.input}),N.teleportation.setSelectionFeature(N.pointerSelection)),N.renderTarget=N.baseExperience.sessionManager.getWebXRRenderTarget(w.outputCanvasOptions),w.disableDefaultUI?void 0:(w.uiOptions&&(w.uiOptions.renderTarget=w.uiOptions.renderTarget||N.renderTarget),ms.CreateAsync(D,N.baseExperience,w.uiOptions||{renderTarget:N.renderTarget}).then((function(D){N.enterExitUI=D})))})).then((function(){return N})).catch((function(D){return oe.a.Error("Error initializing XR"),oe.a.Error(D),N}))},e.prototype.dispose=function(){this.baseExperience&&this.baseExperience.dispose(),this.input&&this.input.dispose(),this.enterExitUI&&this.enterExitUI.dispose(),this.renderTarget&&this.renderTarget.dispose()},e}();We.a.prototype.createDefaultLight=function(D){if(void 0===D&&(D=!1),D&&this.lights)for(var w=0;w<this.lights.length;w++)this.lights[w].dispose();0===this.lights.length&&new ji.a("default light",z.e.Up(),this)},We.a.prototype.createDefaultCamera=function(D,w,N){if(void 0===D&&(D=!1),void 0===w&&(w=!1),void 0===N&&(N=!1),w&&this.activeCamera&&(this.activeCamera.dispose(),this.activeCamera=null),!this.activeCamera){var F,k=this.getWorldExtends(),j=k.max.subtract(k.min),G=k.min.add(j.scale(.5)),H=1.5*j.length();if(isFinite(H)||(H=1,G.copyFromFloats(0,0,0)),D){var X=new kn("default camera",-Math.PI/2,Math.PI/2,H,G,this);X.lowerRadiusLimit=.01*H,X.wheelPrecision=100/H,F=X}else{var q=new Fn("default camera",new z.e(G.x,G.y,-H),this);q.setTarget(G),F=q}F.minZ=.01*H,F.maxZ=1e3*H,F.speed=.2*H,this.activeCamera=F;var Z=this.getEngine().getInputElement();N&&Z&&F.attachControl(Z)}},We.a.prototype.createDefaultCameraOrLight=function(D,w,N){void 0===D&&(D=!1),void 0===w&&(w=!1),void 0===N&&(N=!1),this.createDefaultLight(w),this.createDefaultCamera(D,w,N)},We.a.prototype.createDefaultSkybox=function(D,w,N,F,k){if(void 0===w&&(w=!1),void 0===N&&(N=1e3),void 0===F&&(F=0),void 0===k&&(k=!0),!D)return oe.a.Warn("Can not create default skybox without environment texture."),null;k&&D&&(this.environmentTexture=D);var j=xt.a.CreateBox("hdrSkyBox",N,this);if(w){var z=new ga("skyBox",this);z.backFaceCulling=!1,z.reflectionTexture=D.clone(),z.reflectionTexture&&(z.reflectionTexture.coordinatesMode=Jt.a.SKYBOX_MODE),z.microSurface=1-F,z.disableLighting=!0,z.twoSidedLighting=!0,j.infiniteDistance=!0,j.material=z}else{var G=new Hi.a("skyBox",this);G.backFaceCulling=!1,G.reflectionTexture=D.clone(),G.reflectionTexture&&(G.reflectionTexture.coordinatesMode=Jt.a.SKYBOX_MODE),G.disableLighting=!0,j.infiniteDistance=!0,j.material=G}return j.isPickable=!1,j},We.a.prototype.createDefaultEnvironment=function(D){return Qo?new Qo(D,this):null},We.a.prototype.createDefaultVRExperience=function(D){return void 0===D&&(D={}),new lr(this,D)},We.a.prototype.createDefaultXRExperienceAsync=function(D){return vs.CreateAsync(this,D).then((function(D){return D}))},di.a.prototype.updateVideoTexture=function(D,w,N){if(D&&!D._isDisabled){var F=this._bindTextureDirectly(this._gl.TEXTURE_2D,D,!0);this._unpackFlipY(!N);try{if(void 0===this._videoTextureSupported&&(this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,w),0!==this._gl.getError()?this._videoTextureSupported=!1:this._videoTextureSupported=!0),this._videoTextureSupported)this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,w);else{if(!D._workingCanvas){D._workingCanvas=Wi.a.CreateCanvas(D.width,D.height);var k=D._workingCanvas.getContext("2d");if(!k)throw new Error("Unable to get 2d context");D._workingContext=k,D._workingCanvas.width=D.width,D._workingCanvas.height=D.height}D._workingContext.drawImage(w,0,0,w.videoWidth,w.videoHeight,0,0,D.width,D.height),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,D._workingCanvas)}D.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),F||this._bindTextureDirectly(this._gl.TEXTURE_2D,null),D.isReady=!0}catch(w){D._isDisabled=!0}}};var ys=function(D){function t(w,N,F,k,j,z,G){void 0===k&&(k=!1),void 0===j&&(j=!1),void 0===z&&(z=Jt.a.TRILINEAR_SAMPLINGMODE),void 0===G&&(G={autoPlay:!0,loop:!0,autoUpdateTexture:!0});var H=D.call(this,null,F,!k,j)||this;H._onUserActionRequestedObservable=null,H._stillImageCaptured=!1,H._displayingPosterTexture=!1,H._frameId=-1,H._currentSrc=null,H._createInternalTexture=function(){if(null!=H._texture){if(!H._displayingPosterTexture)return;H._texture.dispose(),H._displayingPosterTexture=!1}if(!H._engine.needPOTTextures||Dt.b.IsExponentOfTwo(H.video.videoWidth)&&Dt.b.IsExponentOfTwo(H.video.videoHeight)?(H.wrapU=Jt.a.WRAP_ADDRESSMODE,H.wrapV=Jt.a.WRAP_ADDRESSMODE):(H.wrapU=Jt.a.CLAMP_ADDRESSMODE,H.wrapV=Jt.a.CLAMP_ADDRESSMODE,H._generateMipMaps=!1),H._texture=H._engine.createDynamicTexture(H.video.videoWidth,H.video.videoHeight,H._generateMipMaps,H.samplingMode),H.video.autoplay||H._settings.poster)H._texture.isReady=!0,H._updateInternalTexture(),H.onLoadObservable.hasObservers()&&H.onLoadObservable.notifyObservers(H);else{var D=H.video.onplaying,w=!1,N=H.video.muted;H.video.muted=!0,H.video.onplaying=function(){H.video.muted=N,H.video.onplaying=D,H._texture.isReady=!0,H._updateInternalTexture(),w||H.video.pause(),H.onLoadObservable.hasObservers()&&H.onLoadObservable.notifyObservers(H)};var F=H.video.play();F?F.then((function(){})).catch((function(){w=!0,H._onUserActionRequestedObservable&&H._onUserActionRequestedObservable.hasObservers()&&H._onUserActionRequestedObservable.notifyObservers(H)})):(H.video.onplaying=D,H._texture.isReady=!0,H._updateInternalTexture(),H.onLoadObservable.hasObservers()&&H.onLoadObservable.notifyObservers(H))}},H.reset=function(){null!=H._texture&&(H._displayingPosterTexture||(H._texture.dispose(),H._texture=null))},H._updateInternalTexture=function(){if(null!=H._texture&&H._texture.isReady&&!(H.video.readyState<H.video.HAVE_CURRENT_DATA||H._displayingPosterTexture)){var D=H.getScene().getFrameId();H._frameId!==D&&(H._frameId=D,H._engine.updateVideoTexture(H._texture,H.video,H._invertY))}},H._engine=H.getScene().getEngine(),H._generateMipMaps=k,H._initialSamplingMode=z,H.autoUpdateTexture=G.autoUpdateTexture,H._currentSrc=N,H.name=w||H._getName(N),H.video=H._getVideo(N),H._settings=G,G.poster&&(H.video.poster=G.poster),void 0!==G.autoPlay&&(H.video.autoplay=G.autoPlay),void 0!==G.loop&&(H.video.loop=G.loop),H.video.setAttribute("playsinline",""),H.video.addEventListener("paused",H._updateInternalTexture),H.video.addEventListener("seeked",H._updateInternalTexture),H.video.addEventListener("emptied",H.reset),H._createInternalTextureOnEvent=G.poster&&!G.autoPlay?"play":"canplay",H.video.addEventListener(H._createInternalTextureOnEvent,H._createInternalTexture);var X=H.video.readyState>=H.video.HAVE_CURRENT_DATA;return!G.poster||G.autoPlay&&X?X&&H._createInternalTexture():(H._texture=H._engine.createTexture(G.poster,!1,!H.invertY,F),H._displayingPosterTexture=!0),H}return Object(Z.d)(t,D),Object.defineProperty(t.prototype,"onUserActionRequestedObservable",{get:function(){return this._onUserActionRequestedObservable||(this._onUserActionRequestedObservable=new j.c),this._onUserActionRequestedObservable},enumerable:!0,configurable:!0}),t.prototype._getName=function(D){return D instanceof HTMLVideoElement?D.currentSrc:"object"==typeof D?D.toString():D},t.prototype._getVideo=function(D){if(D instanceof HTMLVideoElement)return Dt.b.SetCorsBehavior(D.currentSrc,D),D;var w=document.createElement("video");return"string"==typeof D?(Dt.b.SetCorsBehavior(D,w),w.src=D):(Dt.b.SetCorsBehavior(D[0],w),D.forEach((function(D){var N=document.createElement("source");N.src=D,w.appendChild(N)}))),w},t.prototype._rebuild=function(){this.update()},t.prototype.update=function(){this.autoUpdateTexture&&this.updateTexture(!0)},t.prototype.updateTexture=function(D){D&&(this.video.paused&&this._stillImageCaptured||(this._stillImageCaptured=!0,this._updateInternalTexture()))},t.prototype.updateURL=function(D){this.video.src=D,this._currentSrc=D},t.prototype.clone=function(){return new t(this.name,this._currentSrc,this.getScene(),this._generateMipMaps,this.invertY,this.samplingMode,this._settings)},t.prototype.dispose=function(){D.prototype.dispose.call(this),this._currentSrc=null,this._onUserActionRequestedObservable&&(this._onUserActionRequestedObservable.clear(),this._onUserActionRequestedObservable=null),this.video.removeEventListener(this._createInternalTextureOnEvent,this._createInternalTexture),this.video.removeEventListener("paused",this._updateInternalTexture),this.video.removeEventListener("seeked",this._updateInternalTexture),this.video.removeEventListener("emptied",this.reset),this.video.pause()},t.CreateFromStreamAsync=function(D,w){var N=document.createElement("video");return N.setAttribute("autoplay",""),N.setAttribute("muted","true"),N.setAttribute("playsinline",""),N.muted=!0,void 0!==N.mozSrcObject?N.mozSrcObject=w:"object"==typeof N.srcObject?N.srcObject=w:(window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,N.src=window.URL&&window.URL.createObjectURL(w)),new Promise((function(w){var r=function(){w(new t("video",N,D,!0,!0)),N.removeEventListener("playing",r)};N.addEventListener("playing",r),N.play()}))},t.CreateFromWebCamAsync=function(D,w,N){var F,k=this;return void 0===N&&(N=!1),w&&w.deviceId&&(F={exact:w.deviceId}),navigator.mediaDevices?navigator.mediaDevices.getUserMedia({video:w,audio:N}).then((function(w){return k.CreateFromStreamAsync(D,w)})):(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getUserMedia&&navigator.getUserMedia({video:{deviceId:F,width:{min:w&&w.minWidth||256,max:w&&w.maxWidth||640},height:{min:w&&w.minHeight||256,max:w&&w.maxHeight||480}},audio:N},(function(w){return k.CreateFromStreamAsync(D,w)}),(function(D){oe.a.Error(D.name)})),Promise.reject("No support for userMedia on this device"))},t.CreateFromWebCam=function(D,w,N,F){void 0===F&&(F=!1),this.CreateFromWebCamAsync(D,N,F).then((function(D){w&&w(D)})).catch((function(D){oe.a.Error(D.name)}))},t}(Jt.a),bs=function(){function e(D,w){void 0===D&&(D=z.e.Zero()),void 0===w&&(w=z.e.Up()),this.position=D,this.normal=w}return e.prototype.clone=function(){return new e(this.position.clone(),this.normal.clone())},e}(),Ts=function(){function e(D,w,N){void 0===D&&(D=z.e.Zero()),void 0===w&&(w=z.e.Up()),void 0===N&&(N=z.d.Zero()),this.position=D,this.normal=w,this.uv=N}return e.prototype.clone=function(){return new e(this.position.clone(),this.normal.clone(),this.uv.clone())},e}(),Es=function(D){function t(w,N,F,k){var j=D.call(this,w,k)||this;j._halfDome=!1,j._useDirectMapping=!1,j._videoMode=t.MODE_MONOSCOPIC,j._onBeforeCameraRenderObserver=null,k=j.getScene(),w=w||"videoDome",F.resolution=0|Math.abs(F.resolution)||32,F.clickToPlay=Boolean(F.clickToPlay),F.autoPlay=void 0===F.autoPlay||Boolean(F.autoPlay),F.loop=void 0===F.loop||Boolean(F.loop),F.size=Math.abs(F.size)||(k.activeCamera?.48*k.activeCamera.maxZ:1e3),void 0===F.useDirectMapping?j._useDirectMapping=!0:j._useDirectMapping=F.useDirectMapping,void 0===F.faceForward&&(F.faceForward=!0),j._setReady(!1);var G={loop:F.loop,autoPlay:F.autoPlay,autoUpdateTexture:!0,poster:F.poster},H=j._material=new Ko(w+"_material",k),X=j._videoTexture=new ys(w+"_texture",N,k,!1,j._useDirectMapping,Jt.a.TRILINEAR_SAMPLINGMODE,G);if(j._mesh=xt.a.CreateSphere(w+"_mesh",F.resolution,F.size,k,!1,xt.a.BACKSIDE),X.anisotropicFilteringLevel=1,X.onLoadObservable.addOnce((function(){j._setReady(!0)})),H.useEquirectangularFOV=!0,H.fovMultiplier=1,H.opacityFresnel=!1,j._useDirectMapping?(X.wrapU=Jt.a.CLAMP_ADDRESSMODE,X.wrapV=Jt.a.CLAMP_ADDRESSMODE,H.diffuseTexture=X):(X.coordinatesMode=Jt.a.FIXED_EQUIRECTANGULAR_MIRRORED_MODE,X.wrapV=Jt.a.CLAMP_ADDRESSMODE,H.reflectionTexture=X),j._mesh.material=H,j._mesh.parent=j,j._halfDomeMask=vo.a.CreateSphere("",{slice:.5,diameter:.99*F.size,segments:F.resolution,sideOrientation:xt.a.BACKSIDE},k),j._halfDomeMask.rotate(Qe.a.X,-Math.PI/2),j._halfDomeMask.parent=j._mesh,j._halfDome=!!F.halfDomeMode,j._halfDomeMask.setEnabled(j._halfDome),F.clickToPlay&&(k.onPointerUp=function(){j._videoTexture.video.play()}),F.faceForward&&k.activeCamera){var q=k.activeCamera,Z=z.e.Forward(),J=z.e.TransformNormal(Z,q.getViewMatrix());J.normalize(),j.rotation.y=Math.acos(z.e.Dot(Z,J))}return j}return Object(Z.d)(t,D),Object.defineProperty(t.prototype,"videoTexture",{get:function(){return this._videoTexture},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fovMultiplier",{get:function(){return this._material.fovMultiplier},set:function(D){this._material.fovMultiplier=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"videoMode",{get:function(){return this._videoMode},set:function(D){this._videoMode!==D&&this._changeVideoMode(D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"halfDome",{get:function(){return this._halfDome},set:function(D){this._halfDome=D,this._halfDomeMask.setEnabled(D)},enumerable:!0,configurable:!0}),t.prototype._changeVideoMode=function(D){var w=this;switch(this._scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._videoMode=D,this._videoTexture.uScale=1,this._videoTexture.vScale=1,this._videoTexture.uOffset=0,this._videoTexture.vOffset=0,D){case t.MODE_SIDEBYSIDE:this._videoTexture.uScale=this._halfDome?.99999:.5;var N=this._halfDome?0:.5,F=this._halfDome?.5:0;this._onBeforeCameraRenderObserver=this._scene.onBeforeCameraRenderObservable.add((function(D){w._videoTexture.uOffset=D.isRightCamera?N:F}));break;case t.MODE_TOPBOTTOM:this._videoTexture.vScale=this._halfDome?.99999:.5,this._onBeforeCameraRenderObserver=this._scene.onBeforeCameraRenderObservable.add((function(D){w._videoTexture.vOffset=D.isRightCamera?.5:0}))}},t.prototype.dispose=function(w,N){void 0===N&&(N=!1),this._videoTexture.dispose(),this._mesh.dispose(),this._material.dispose(),this._scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),D.prototype.dispose.call(this,w,N)},t.MODE_MONOSCOPIC=0,t.MODE_TOPBOTTOM=1,t.MODE_SIDEBYSIDE=2,t}(So.a),Ss=N(51),xs=function(){function e(D){this.engine=D,this._captureGPUFrameTime=!1,this._gpuFrameTime=new Ss.a,this._captureShaderCompilationTime=!1,this._shaderCompilationTime=new Ss.a,this._onBeginFrameObserver=null,this._onEndFrameObserver=null,this._onBeforeShaderCompilationObserver=null,this._onAfterShaderCompilationObserver=null}return Object.defineProperty(e.prototype,"gpuFrameTimeCounter",{get:function(){return this._gpuFrameTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureGPUFrameTime",{get:function(){return this._captureGPUFrameTime},set:function(D){var w=this;D!==this._captureGPUFrameTime&&(this._captureGPUFrameTime=D,D?(this._onBeginFrameObserver=this.engine.onBeginFrameObservable.add((function(){w._gpuFrameTimeToken||(w._gpuFrameTimeToken=w.engine.startTimeQuery())})),this._onEndFrameObserver=this.engine.onEndFrameObservable.add((function(){if(w._gpuFrameTimeToken){var D=w.engine.endTimeQuery(w._gpuFrameTimeToken);D>-1&&(w._gpuFrameTimeToken=null,w._gpuFrameTime.fetchNewFrame(),w._gpuFrameTime.addCount(D,!0))}}))):(this.engine.onBeginFrameObservable.remove(this._onBeginFrameObserver),this._onBeginFrameObserver=null,this.engine.onEndFrameObservable.remove(this._onEndFrameObserver),this._onEndFrameObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shaderCompilationTimeCounter",{get:function(){return this._shaderCompilationTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureShaderCompilationTime",{get:function(){return this._captureShaderCompilationTime},set:function(D){var w=this;D!==this._captureShaderCompilationTime&&(this._captureShaderCompilationTime=D,D?(this._onBeforeShaderCompilationObserver=this.engine.onBeforeShaderCompilationObservable.add((function(){w._shaderCompilationTime.fetchNewFrame(),w._shaderCompilationTime.beginMonitoring()})),this._onAfterShaderCompilationObserver=this.engine.onAfterShaderCompilationObservable.add((function(){w._shaderCompilationTime.endMonitoring()}))):(this.engine.onBeforeShaderCompilationObservable.remove(this._onBeforeShaderCompilationObserver),this._onBeforeShaderCompilationObserver=null,this.engine.onAfterShaderCompilationObservable.remove(this._onAfterShaderCompilationObserver),this._onAfterShaderCompilationObserver=null))},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this.engine.onBeginFrameObservable.remove(this._onBeginFrameObserver),this._onBeginFrameObserver=null,this.engine.onEndFrameObservable.remove(this._onEndFrameObserver),this._onEndFrameObserver=null,this.engine.onBeforeShaderCompilationObservable.remove(this._onBeforeShaderCompilationObserver),this._onBeforeShaderCompilationObserver=null,this.engine.onAfterShaderCompilationObservable.remove(this._onAfterShaderCompilationObserver),this._onAfterShaderCompilationObserver=null,this.engine=null},e}(),As=function(){function e(D){var w=this;this.scene=D,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new Ss.a,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new Ss.a,this._captureFrameTime=!1,this._frameTime=new Ss.a,this._captureRenderTime=!1,this._renderTime=new Ss.a,this._captureInterFrameTime=!1,this._interFrameTime=new Ss.a,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new Ss.a,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new Ss.a,this._capturePhysicsTime=!1,this._physicsTime=new Ss.a,this._captureAnimationsTime=!1,this._animationsTime=new Ss.a,this._captureCameraRenderTime=!1,this._cameraRenderTime=new Ss.a,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._onBeforeAnimationsObserver=D.onBeforeAnimationsObservable.add((function(){w._captureActiveMeshesEvaluationTime&&w._activeMeshesEvaluationTime.fetchNewFrame(),w._captureRenderTargetsRenderTime&&w._renderTargetsRenderTime.fetchNewFrame(),w._captureFrameTime&&(Dt.b.StartPerformanceCounter("Scene rendering"),w._frameTime.beginMonitoring()),w._captureInterFrameTime&&w._interFrameTime.endMonitoring(),w._captureParticlesRenderTime&&w._particlesRenderTime.fetchNewFrame(),w._captureSpritesRenderTime&&w._spritesRenderTime.fetchNewFrame(),w._captureAnimationsTime&&w._animationsTime.beginMonitoring(),w.scene.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=D.onAfterRenderObservable.add((function(){w._captureFrameTime&&(Dt.b.EndPerformanceCounter("Scene rendering"),w._frameTime.endMonitoring()),w._captureRenderTime&&w._renderTime.endMonitoring(!1),w._captureInterFrameTime&&w._interFrameTime.beginMonitoring()}))}return Object.defineProperty(e.prototype,"activeMeshesEvaluationTimeCounter",{get:function(){return this._activeMeshesEvaluationTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureActiveMeshesEvaluationTime",{get:function(){return this._captureActiveMeshesEvaluationTime},set:function(D){var w=this;D!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=D,D?(this._onBeforeActiveMeshesEvaluationObserver=this.scene.onBeforeActiveMeshesEvaluationObservable.add((function(){Dt.b.StartPerformanceCounter("Active meshes evaluation"),w._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.scene.onAfterActiveMeshesEvaluationObservable.add((function(){Dt.b.EndPerformanceCounter("Active meshes evaluation"),w._activeMeshesEvaluationTime.endMonitoring()}))):(this.scene.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.scene.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderTargetsRenderTimeCounter",{get:function(){return this._renderTargetsRenderTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureRenderTargetsRenderTime",{get:function(){return this._captureRenderTargetsRenderTime},set:function(D){var w=this;D!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=D,D?(this._onBeforeRenderTargetsRenderObserver=this.scene.onBeforeRenderTargetsRenderObservable.add((function(){Dt.b.StartPerformanceCounter("Render targets rendering"),w._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.scene.onAfterRenderTargetsRenderObservable.add((function(){Dt.b.EndPerformanceCounter("Render targets rendering"),w._renderTargetsRenderTime.endMonitoring(!1)}))):(this.scene.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.scene.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"particlesRenderTimeCounter",{get:function(){return this._particlesRenderTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureParticlesRenderTime",{get:function(){return this._captureParticlesRenderTime},set:function(D){var w=this;D!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=D,D?(this._onBeforeParticlesRenderingObserver=this.scene.onBeforeParticlesRenderingObservable.add((function(){Dt.b.StartPerformanceCounter("Particles"),w._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.scene.onAfterParticlesRenderingObservable.add((function(){Dt.b.EndPerformanceCounter("Particles"),w._particlesRenderTime.endMonitoring(!1)}))):(this.scene.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.scene.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"spritesRenderTimeCounter",{get:function(){return this._spritesRenderTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureSpritesRenderTime",{get:function(){return this._captureSpritesRenderTime},set:function(D){var w=this;D!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=D,this.scene.spriteManagers&&(D?(this._onBeforeSpritesRenderingObserver=this.scene.onBeforeSpritesRenderingObservable.add((function(){Dt.b.StartPerformanceCounter("Sprites"),w._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.scene.onAfterSpritesRenderingObservable.add((function(){Dt.b.EndPerformanceCounter("Sprites"),w._spritesRenderTime.endMonitoring(!1)}))):(this.scene.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.scene.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"physicsTimeCounter",{get:function(){return this._physicsTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"capturePhysicsTime",{get:function(){return this._capturePhysicsTime},set:function(D){var w=this;D!==this._capturePhysicsTime&&this.scene.onBeforePhysicsObservable&&(this._capturePhysicsTime=D,D?(this._onBeforePhysicsObserver=this.scene.onBeforePhysicsObservable.add((function(){Dt.b.StartPerformanceCounter("Physics"),w._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.scene.onAfterPhysicsObservable.add((function(){Dt.b.EndPerformanceCounter("Physics"),w._physicsTime.endMonitoring()}))):(this.scene.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.scene.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animationsTimeCounter",{get:function(){return this._animationsTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureAnimationsTime",{get:function(){return this._captureAnimationsTime},set:function(D){var w=this;D!==this._captureAnimationsTime&&(this._captureAnimationsTime=D,D?this._onAfterAnimationsObserver=this.scene.onAfterAnimationsObservable.add((function(){w._animationsTime.endMonitoring()})):(this.scene.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frameTimeCounter",{get:function(){return this._frameTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureFrameTime",{get:function(){return this._captureFrameTime},set:function(D){this._captureFrameTime=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"interFrameTimeCounter",{get:function(){return this._interFrameTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureInterFrameTime",{get:function(){return this._captureInterFrameTime},set:function(D){this._captureInterFrameTime=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderTimeCounter",{get:function(){return this._renderTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureRenderTime",{get:function(){return this._captureRenderTime},set:function(D){var w=this;D!==this._captureRenderTime&&(this._captureRenderTime=D,D?(this._onBeforeDrawPhaseObserver=this.scene.onBeforeDrawPhaseObservable.add((function(){w._renderTime.beginMonitoring(),Dt.b.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.scene.onAfterDrawPhaseObservable.add((function(){w._renderTime.endMonitoring(!1),Dt.b.EndPerformanceCounter("Main render")}))):(this.scene.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.scene.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cameraRenderTimeCounter",{get:function(){return this._cameraRenderTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureCameraRenderTime",{get:function(){return this._captureCameraRenderTime},set:function(D){var w=this;D!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=D,D?(this._onBeforeCameraRenderObserver=this.scene.onBeforeCameraRenderObservable.add((function(D){w._cameraRenderTime.beginMonitoring(),Dt.b.StartPerformanceCounter("Rendering camera "+D.name)})),this._onAfterCameraRenderObserver=this.scene.onAfterCameraRenderObservable.add((function(D){w._cameraRenderTime.endMonitoring(!1),Dt.b.EndPerformanceCounter("Rendering camera "+D.name)}))):(this.scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.scene.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"drawCallsCounter",{get:function(){return this.scene.getEngine()._drawCalls},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this.scene.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.scene.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.scene.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.scene.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.scene.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.scene.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.scene.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.scene.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.scene.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.scene.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.scene.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.scene.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.scene.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.scene.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.scene.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.scene.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.scene=null},e}(),Ps=N(29);li.a.ShadersStore.glowMapGenerationPixelShader="#ifdef DIFFUSE\nvarying vec2 vUVDiffuse;\nuniform sampler2D diffuseSampler;\n#endif\n#ifdef OPACITY\nvarying vec2 vUVOpacity;\nuniform sampler2D opacitySampler;\nuniform float opacityIntensity;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vUVEmissive;\nuniform sampler2D emissiveSampler;\n#endif\n#ifdef VERTEXALPHA\nvarying vec4 vColor;\n#endif\nuniform vec4 glowColor;\nvoid main(void)\n{\nvec4 finalColor=glowColor;\n\n#ifdef DIFFUSE\nvec4 albedoTexture=texture2D(diffuseSampler,vUVDiffuse);\nfinalColor.a*=albedoTexture.a;\n#endif\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vUVOpacity);\n#ifdef OPACITYRGB\nfinalColor.a*=getLuminance(opacityMap.rgb);\n#else\nfinalColor.a*=opacityMap.a;\n#endif\nfinalColor.a*=opacityIntensity;\n#endif\n#ifdef VERTEXALPHA\nfinalColor.a*=vColor.a;\n#endif\n#ifdef ALPHATEST\nif (finalColor.a<ALPHATESTVALUE)\ndiscard;\n#endif\n#ifdef EMISSIVE\ngl_FragColor=texture2D(emissiveSampler,vUVEmissive)*finalColor;\n#else\ngl_FragColor=finalColor;\n#endif\n}",li.a.ShadersStore.glowMapGenerationVertexShader="\nattribute vec3 position;\n#include<bonesDeclaration>\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\nvarying vec4 vPosition;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef DIFFUSE\nvarying vec2 vUVDiffuse;\nuniform mat4 diffuseMatrix;\n#endif\n#ifdef OPACITY\nvarying vec2 vUVOpacity;\nuniform mat4 opacityMatrix;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vUVEmissive;\nuniform mat4 emissiveMatrix;\n#endif\n#ifdef VERTEXALPHA\nattribute vec4 color;\nvarying vec4 vColor;\n#endif\nvoid main(void)\n{\nvec3 positionUpdated=position;\n#ifdef UV1\nvec2 uvUpdated=uv;\n#endif\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#include<instancesVertex>\n#include<bonesVertex>\n#ifdef CUBEMAP\nvPosition=finalWorld*vec4(positionUpdated,1.0);\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\n#else\nvPosition=viewProjection*finalWorld*vec4(positionUpdated,1.0);\ngl_Position=vPosition;\n#endif\n#ifdef DIFFUSE\n#ifdef DIFFUSEUV1\nvUVDiffuse=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));\n#endif\n#ifdef DIFFUSEUV2\nvUVDiffuse=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n#ifdef OPACITY\n#ifdef OPACITYUV1\nvUVOpacity=vec2(opacityMatrix*vec4(uvUpdated,1.0,0.0));\n#endif\n#ifdef OPACITYUV2\nvUVOpacity=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n#ifdef EMISSIVE\n#ifdef EMISSIVEUV1\nvUVEmissive=vec2(emissiveMatrix*vec4(uvUpdated,1.0,0.0));\n#endif\n#ifdef EMISSIVEUV2\nvUVEmissive=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n#ifdef VERTEXALPHA\nvColor=color;\n#endif\n}";var Cs=function(){function e(D,w){this._vertexBuffers={},this._maxSize=0,this._mainTextureDesiredSize={width:0,height:0},this._shouldRender=!0,this._postProcesses=[],this._textures=[],this._emissiveTextureAndColor={texture:null,color:new G.b},this.neutralColor=new G.b,this.isEnabled=!0,this.onDisposeObservable=new j.c,this.onBeforeRenderMainTextureObservable=new j.c,this.onBeforeComposeObservable=new j.c,this.onBeforeRenderMeshToEffect=new j.c,this.onAfterRenderMeshToEffect=new j.c,this.onAfterComposeObservable=new j.c,this.onSizeChangedObservable=new j.c,this.name=D,this._scene=w||Me.a.LastCreatedScene,e._SceneComponentInitialization(this._scene),this._engine=this._scene.getEngine(),this._maxSize=this._engine.getCaps().maxTextureSize,this._scene.effectLayers.push(this),this._generateIndexBuffer(),this._generateVertexBuffer()}return Object.defineProperty(e.prototype,"camera",{get:function(){return this._effectLayerOptions.camera},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderingGroupId",{get:function(){return this._effectLayerOptions.renderingGroupId},set:function(D){this._effectLayerOptions.renderingGroupId=D},enumerable:!0,configurable:!0}),e.prototype._init=function(D){this._effectLayerOptions=Object(Z.a)({mainTextureRatio:.5,alphaBlendingMode:ce.a.ALPHA_COMBINE,camera:null,renderingGroupId:-1},D),this._setMainTextureSize(),this._createMainTexture(),this._createTextureAndPostProcesses(),this._mergeEffect=this._createMergeEffect()},e.prototype._generateIndexBuffer=function(){var D=[];D.push(0),D.push(1),D.push(2),D.push(0),D.push(2),D.push(3),this._indexBuffer=this._engine.createIndexBuffer(D)},e.prototype._generateVertexBuffer=function(){var D=[];D.push(1,1),D.push(-1,1),D.push(-1,-1),D.push(1,-1);var w=new Zi.b(this._engine,D,Zi.b.PositionKind,!1,!1,2);this._vertexBuffers[Zi.b.PositionKind]=w},e.prototype._setMainTextureSize=function(){this._effectLayerOptions.mainTextureFixedSize?(this._mainTextureDesiredSize.width=this._effectLayerOptions.mainTextureFixedSize,this._mainTextureDesiredSize.height=this._effectLayerOptions.mainTextureFixedSize):(this._mainTextureDesiredSize.width=this._engine.getRenderWidth()*this._effectLayerOptions.mainTextureRatio,this._mainTextureDesiredSize.height=this._engine.getRenderHeight()*this._effectLayerOptions.mainTextureRatio,this._mainTextureDesiredSize.width=this._engine.needPOTTextures?Ct.a.GetExponentOfTwo(this._mainTextureDesiredSize.width,this._maxSize):this._mainTextureDesiredSize.width,this._mainTextureDesiredSize.height=this._engine.needPOTTextures?Ct.a.GetExponentOfTwo(this._mainTextureDesiredSize.height,this._maxSize):this._mainTextureDesiredSize.height),this._mainTextureDesiredSize.width=Math.floor(this._mainTextureDesiredSize.width),this._mainTextureDesiredSize.height=Math.floor(this._mainTextureDesiredSize.height)},e.prototype._createMainTexture=function(){var D=this;this._mainTexture=new Li("HighlightLayerMainRTT",{width:this._mainTextureDesiredSize.width,height:this._mainTextureDesiredSize.height},this._scene,!1,!0,ce.a.TEXTURETYPE_UNSIGNED_INT),this._mainTexture.activeCamera=this._effectLayerOptions.camera,this._mainTexture.wrapU=Jt.a.CLAMP_ADDRESSMODE,this._mainTexture.wrapV=Jt.a.CLAMP_ADDRESSMODE,this._mainTexture.anisotropicFilteringLevel=1,this._mainTexture.updateSamplingMode(Jt.a.BILINEAR_SAMPLINGMODE),this._mainTexture.renderParticles=!1,this._mainTexture.renderList=null,this._mainTexture.ignoreCameraViewport=!0,this._mainTexture.customRenderFunction=function(w,N,F,k){var j;D.onBeforeRenderMainTextureObservable.notifyObservers(D);var z=D._scene.getEngine();if(k.length){for(z.setColorWrite(!1),j=0;j<k.length;j++)D._renderSubMesh(k.data[j]);z.setColorWrite(!0)}for(j=0;j<w.length;j++)D._renderSubMesh(w.data[j]);for(j=0;j<N.length;j++)D._renderSubMesh(N.data[j]);var G=z.getAlphaMode();for(j=0;j<F.length;j++)D._renderSubMesh(F.data[j],!0);z.setAlphaMode(G)},this._mainTexture.onClearObservable.add((function(w){w.clear(D.neutralColor,!0,!0,!0)}))},e.prototype._addCustomEffectDefines=function(D){},e.prototype._isReady=function(D,w,N){var F=D.getMaterial();if(!F)return!1;if(!F.isReadyForSubMesh(D.getMesh(),D,w))return!1;var k=[],j=[Zi.b.PositionKind],z=D.getMesh(),G=!1,H=!1;if(F){var X=F.needAlphaTesting(),q=F.getAlphaTestTexture(),Z=q&&q.hasAlpha&&(F.useAlphaFromDiffuseTexture||F._useAlphaFromAlbedoTexture);q&&(X||Z)&&(k.push("#define DIFFUSE"),z.isVerticesDataPresent(Zi.b.UV2Kind)&&1===q.coordinatesIndex?(k.push("#define DIFFUSEUV2"),H=!0):z.isVerticesDataPresent(Zi.b.UVKind)&&(k.push("#define DIFFUSEUV1"),G=!0),X&&(k.push("#define ALPHATEST"),k.push("#define ALPHATESTVALUE 0.4")));var J=F.opacityTexture;J&&(k.push("#define OPACITY"),z.isVerticesDataPresent(Zi.b.UV2Kind)&&1===J.coordinatesIndex?(k.push("#define OPACITYUV2"),H=!0):z.isVerticesDataPresent(Zi.b.UVKind)&&(k.push("#define OPACITYUV1"),G=!0))}N&&(k.push("#define EMISSIVE"),z.isVerticesDataPresent(Zi.b.UV2Kind)&&1===N.coordinatesIndex?(k.push("#define EMISSIVEUV2"),H=!0):z.isVerticesDataPresent(Zi.b.UVKind)&&(k.push("#define EMISSIVEUV1"),G=!0)),z.isVerticesDataPresent(Zi.b.ColorKind)&&z.hasVertexAlpha&&(j.push(Zi.b.ColorKind),k.push("#define VERTEXALPHA")),G&&(j.push(Zi.b.UVKind),k.push("#define UV1")),H&&(j.push(Zi.b.UV2Kind),k.push("#define UV2"));var $=new Wo.a;if(z.useBones&&z.computeBonesUsingShaders){j.push(Zi.b.MatricesIndicesKind),j.push(Zi.b.MatricesWeightsKind),z.numBoneInfluencers>4&&(j.push(Zi.b.MatricesIndicesExtraKind),j.push(Zi.b.MatricesWeightsExtraKind)),k.push("#define NUM_BONE_INFLUENCERS "+z.numBoneInfluencers);var te=z.skeleton;te&&te.isUsingTextureForMatrices?k.push("#define BONETEXTURE"):k.push("#define BonesPerMesh "+(te?te.bones.length+1:0)),z.numBoneInfluencers>0&&$.addCPUSkinningFallback(0,z)}else k.push("#define NUM_BONE_INFLUENCERS 0");var ie=z.morphTargetManager,oe=0;ie&&ie.numInfluencers>0&&(k.push("#define MORPHTARGETS"),oe=ie.numInfluencers,k.push("#define NUM_MORPH_INFLUENCERS "+oe),jo.a.PrepareAttributesForMorphTargetsInfluencers(j,z,oe)),w&&(k.push("#define INSTANCES"),jo.a.PushAttributesForInstances(j)),this._addCustomEffectDefines(k);var ce=k.join("\n");return this._cachedDefines!==ce&&(this._cachedDefines=ce,this._effectLayerMapGenerationEffect=this._scene.getEngine().createEffect("glowMapGeneration",j,["world","mBones","viewProjection","glowColor","morphTargetInfluences","boneTextureWidth","diffuseMatrix","emissiveMatrix","opacityMatrix","opacityIntensity"],["diffuseSampler","emissiveSampler","opacitySampler","boneSampler"],ce,$,void 0,void 0,{maxSimultaneousMorphTargets:oe})),this._effectLayerMapGenerationEffect.isReady()},e.prototype.render=function(){var D=this._mergeEffect;if(D.isReady()){for(var w=0;w<this._postProcesses.length;w++)if(!this._postProcesses[w].isReady())return;var N=this._scene.getEngine();this.onBeforeComposeObservable.notifyObservers(this),N.enableEffect(D),N.setState(!1),N.bindBuffers(this._vertexBuffers,this._indexBuffer,D);var F=N.getAlphaMode();N.setAlphaMode(this._effectLayerOptions.alphaBlendingMode),this._internalRender(D),N.setAlphaMode(F),this.onAfterComposeObservable.notifyObservers(this);var k=this._mainTexture.getSize();this._setMainTextureSize(),k.width===this._mainTextureDesiredSize.width&&k.height===this._mainTextureDesiredSize.height||(this.onSizeChangedObservable.notifyObservers(this),this._disposeTextureAndPostProcesses(),this._createMainTexture(),this._createTextureAndPostProcesses())}},e.prototype.hasMesh=function(D){return-1===this.renderingGroupId||D.renderingGroupId===this.renderingGroupId},e.prototype.shouldRender=function(){return this.isEnabled&&this._shouldRender},e.prototype._shouldRenderMesh=function(D){return!0},e.prototype._canRenderMesh=function(D,w){return!w.needAlphaBlendingForMesh(D)},e.prototype._shouldRenderEmissiveTextureForMesh=function(){return!0},e.prototype._renderSubMesh=function(D,w){var N=this;if(void 0===w&&(w=!1),this.shouldRender()){var F=D.getMaterial(),k=D.getRenderingMesh(),j=this._scene,z=j.getEngine();if(k._internalAbstractMeshDataInfo._isActiveIntermediate=!1,F&&this._canRenderMesh(k,F)){z.setState(F.backFaceCulling);var G=k._getInstancesRenderList(D._id);if(!G.mustReturn&&this._shouldRenderMesh(k)){var H=G.hardwareInstancedRendering[D._id];if(this._setEmissiveTextureAndColor(k,D,F),this.onBeforeRenderMeshToEffect.notifyObservers(k),this._useMeshMaterial(k))k.render(D,H);else if(this._isReady(D,H,this._emissiveTextureAndColor.texture)){z.enableEffect(this._effectLayerMapGenerationEffect),k._bind(D,this._effectLayerMapGenerationEffect,Ps.a.TriangleFillMode),this._effectLayerMapGenerationEffect.setMatrix("viewProjection",j.getTransformMatrix()),this._effectLayerMapGenerationEffect.setFloat4("glowColor",this._emissiveTextureAndColor.color.r,this._emissiveTextureAndColor.color.g,this._emissiveTextureAndColor.color.b,this._emissiveTextureAndColor.color.a);var X=F.needAlphaTesting(),q=F.getAlphaTestTexture(),Z=q&&q.hasAlpha&&(F.useAlphaFromDiffuseTexture||F._useAlphaFromAlbedoTexture);q&&(X||Z)&&(this._effectLayerMapGenerationEffect.setTexture("diffuseSampler",q),(J=q.getTextureMatrix())&&this._effectLayerMapGenerationEffect.setMatrix("diffuseMatrix",J));var J,$=F.opacityTexture;if($&&(this._effectLayerMapGenerationEffect.setTexture("opacitySampler",$),this._effectLayerMapGenerationEffect.setFloat("opacityIntensity",$.level),(J=$.getTextureMatrix())&&this._effectLayerMapGenerationEffect.setMatrix("opacityMatrix",J)),this._emissiveTextureAndColor.texture&&(this._effectLayerMapGenerationEffect.setTexture("emissiveSampler",this._emissiveTextureAndColor.texture),this._effectLayerMapGenerationEffect.setMatrix("emissiveMatrix",this._emissiveTextureAndColor.texture.getTextureMatrix())),k.useBones&&k.computeBonesUsingShaders&&k.skeleton){var te=k.skeleton;if(te.isUsingTextureForMatrices){var ie=te.getTransformMatrixTexture(k);if(!ie)return;this._effectLayerMapGenerationEffect.setTexture("boneSampler",ie),this._effectLayerMapGenerationEffect.setFloat("boneTextureWidth",4*(te.bones.length+1))}else this._effectLayerMapGenerationEffect.setMatrices("mBones",te.getTransformMatrices(k))}jo.a.BindMorphTargetParameters(k,this._effectLayerMapGenerationEffect),w&&z.setAlphaMode(F.alphaMode),k._processRendering(D,this._effectLayerMapGenerationEffect,F.fillMode,G,H,(function(D,w){return N._effectLayerMapGenerationEffect.setMatrix("world",w)}))}else this._mainTexture.resetRefreshCounter();this.onAfterRenderMeshToEffect.notifyObservers(k)}}}},e.prototype._useMeshMaterial=function(D){return!1},e.prototype._rebuild=function(){var D=this._vertexBuffers[Zi.b.PositionKind];D&&D._rebuild(),this._generateIndexBuffer()},e.prototype._disposeTextureAndPostProcesses=function(){this._mainTexture.dispose();for(var D=0;D<this._postProcesses.length;D++)this._postProcesses[D]&&this._postProcesses[D].dispose();for(this._postProcesses=[],D=0;D<this._textures.length;D++)this._textures[D]&&this._textures[D].dispose();this._textures=[]},e.prototype.dispose=function(){var D=this._vertexBuffers[Zi.b.PositionKind];D&&(D.dispose(),this._vertexBuffers[Zi.b.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._disposeTextureAndPostProcesses();var w=this._scene.effectLayers.indexOf(this,0);w>-1&&this._scene.effectLayers.splice(w,1),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onBeforeRenderMainTextureObservable.clear(),this.onBeforeComposeObservable.clear(),this.onBeforeRenderMeshToEffect.clear(),this.onAfterRenderMeshToEffect.clear(),this.onAfterComposeObservable.clear(),this.onSizeChangedObservable.clear()},e.prototype.getClassName=function(){return"EffectLayer"},e.Parse=function(D,w,N){return Dt.b.Instantiate(D.customType).Parse(D,w,N)},e._SceneComponentInitialization=function(D){throw It.a.WarnImport("EffectLayerSceneComponent")},Object(Z.c)([Object(Ie.c)()],e.prototype,"name",void 0),Object(Z.c)([Object(Ie.f)()],e.prototype,"neutralColor",void 0),Object(Z.c)([Object(Ie.c)()],e.prototype,"isEnabled",void 0),Object(Z.c)([Object(Ie.d)()],e.prototype,"camera",null),Object(Z.c)([Object(Ie.c)()],e.prototype,"renderingGroupId",null),e}();F.a.AddParser(Nt.a.NAME_EFFECTLAYER,(function(D,w,N,F){if(D.effectLayers){N.effectLayers||(N.effectLayers=new Array);for(var k=0;k<D.effectLayers.length;k++){var j=Cs.Parse(D.effectLayers[k],w,F);N.effectLayers.push(j)}}})),F.a.prototype.removeEffectLayer=function(D){var w=this.effectLayers.indexOf(D);return-1!==w&&this.effectLayers.splice(w,1),w},F.a.prototype.addEffectLayer=function(D){this.effectLayers.push(D)};var Os=function(){function e(D){this.name=Nt.a.NAME_EFFECTLAYER,this._renderEffects=!1,this._needStencil=!1,this._previousStencilState=!1,this.scene=D,this._engine=D.getEngine(),D.effectLayers=new Array}return e.prototype.register=function(){this.scene._isReadyForMeshStage.registerStep(Nt.a.STEP_ISREADYFORMESH_EFFECTLAYER,this,this._isReadyForMesh),this.scene._cameraDrawRenderTargetStage.registerStep(Nt.a.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER,this,this._renderMainTexture),this.scene._beforeCameraDrawStage.registerStep(Nt.a.STEP_BEFORECAMERADRAW_EFFECTLAYER,this,this._setStencil),this.scene._afterRenderingGroupDrawStage.registerStep(Nt.a.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW,this,this._drawRenderingGroup),this.scene._afterCameraDrawStage.registerStep(Nt.a.STEP_AFTERCAMERADRAW_EFFECTLAYER,this,this._setStencilBack),this.scene._afterCameraDrawStage.registerStep(Nt.a.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW,this,this._drawCamera)},e.prototype.rebuild=function(){for(var D=0,w=this.scene.effectLayers;D<w.length;D++)w[D]._rebuild()},e.prototype.serialize=function(D){D.effectLayers=[];for(var w=0,N=this.scene.effectLayers;w<N.length;w++){var F=N[w];F.serialize&&D.effectLayers.push(F.serialize())}},e.prototype.addFromContainer=function(D){var w=this;D.effectLayers&&D.effectLayers.forEach((function(D){w.scene.addEffectLayer(D)}))},e.prototype.removeFromContainer=function(D,w){var N=this;D.effectLayers&&D.effectLayers.forEach((function(D){N.scene.removeEffectLayer(D),w&&D.dispose()}))},e.prototype.dispose=function(){for(var D=this.scene.effectLayers;D.length;)D[0].dispose()},e.prototype._isReadyForMesh=function(D,w){for(var N=0,F=this.scene.effectLayers;N<F.length;N++){var k=F[N];if(k.hasMesh(D))for(var j=0,z=D.subMeshes;j<z.length;j++){var G=z[j];if(!k.isReady(G,w))return!1}}return!0},e.prototype._renderMainTexture=function(D){this._renderEffects=!1,this._needStencil=!1;var w=!1,N=this.scene.effectLayers;if(N&&N.length>0){this._previousStencilState=this._engine.getStencilBuffer();for(var F=0,k=N;F<k.length;F++){var j=k[F];if(j.shouldRender()&&(!j.camera||j.camera.cameraRigMode===Xt.a.RIG_MODE_NONE&&D===j.camera||j.camera.cameraRigMode!==Xt.a.RIG_MODE_NONE&&j.camera._rigCameras.indexOf(D)>-1)){this._renderEffects=!0,this._needStencil=this._needStencil||j.needStencil();var z=j._mainTexture;z._shouldRender()&&(this.scene.incrementRenderId(),z.render(!1,!1),w=!0)}}this.scene.incrementRenderId()}return w},e.prototype._setStencil=function(){this._needStencil&&this._engine.setStencilBuffer(!0)},e.prototype._setStencilBack=function(){this._needStencil&&this._engine.setStencilBuffer(this._previousStencilState)},e.prototype._draw=function(D){if(this._renderEffects){this._engine.setDepthBuffer(!1);for(var w=this.scene.effectLayers,N=0;N<w.length;N++){var F=w[N];F.renderingGroupId===D&&F.shouldRender()&&F.render()}this._engine.setDepthBuffer(!0)}},e.prototype._drawCamera=function(){this._renderEffects&&this._draw(-1)},e.prototype._drawRenderingGroup=function(D){!this.scene._isInIntermediateRendering()&&this._renderEffects&&this._draw(D)},e}();Cs._SceneComponentInitialization=function(D){var w=D._getComponent(Nt.a.NAME_EFFECTLAYER);w||(w=new Os(D),D._addComponent(w))},li.a.ShadersStore.glowMapMergePixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n#ifdef EMISSIVE\nuniform sampler2D textureSampler2;\n#endif\n\nuniform float offset;\nvoid main(void) {\nvec4 baseColor=texture2D(textureSampler,vUV);\n#ifdef EMISSIVE\nbaseColor+=texture2D(textureSampler2,vUV);\nbaseColor*=offset;\n#else\nbaseColor.a=abs(offset-baseColor.a);\n#ifdef STROKE\nfloat alpha=smoothstep(.0,.1,baseColor.a);\nbaseColor.a=alpha;\nbaseColor.rgb=baseColor.rgb*alpha;\n#endif\n#endif\ngl_FragColor=baseColor;\n}",li.a.ShadersStore.glowMapMergeVertexShader="\nattribute vec2 position;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) {\nvUV=position*madd+madd;\ngl_Position=vec4(position,0.0,1.0);\n}",F.a.prototype.getGlowLayerByName=function(D){for(var w=0;w<this.effectLayers.length;w++)if(this.effectLayers[w].name===D&&this.effectLayers[w].getEffectName()===Rs.EffectName)return this.effectLayers[w];return null};var Rs=function(D){function t(w,N,F){var k=D.call(this,w,N)||this;return k._intensity=1,k._includedOnlyMeshes=[],k._excludedMeshes=[],k._meshesUsingTheirOwnMaterials=[],k.neutralColor=new G.b(0,0,0,1),k._options=Object(Z.a)({mainTextureRatio:t.DefaultTextureRatio,blurKernelSize:32,mainTextureFixedSize:void 0,camera:null,mainTextureSamples:1,renderingGroupId:-1},F),k._init({alphaBlendingMode:ce.a.ALPHA_ADD,camera:k._options.camera,mainTextureFixedSize:k._options.mainTextureFixedSize,mainTextureRatio:k._options.mainTextureRatio,renderingGroupId:k._options.renderingGroupId}),k}return Object(Z.d)(t,D),Object.defineProperty(t.prototype,"blurKernelSize",{get:function(){return this._horizontalBlurPostprocess1.kernel},set:function(D){this._horizontalBlurPostprocess1.kernel=D,this._verticalBlurPostprocess1.kernel=D,this._horizontalBlurPostprocess2.kernel=D,this._verticalBlurPostprocess2.kernel=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"intensity",{get:function(){return this._intensity},set:function(D){this._intensity=D},enumerable:!0,configurable:!0}),t.prototype.getEffectName=function(){return t.EffectName},t.prototype._createMergeEffect=function(){return this._engine.createEffect("glowMapMerge",[Zi.b.PositionKind],["offset"],["textureSampler","textureSampler2"],"#define EMISSIVE \n")},t.prototype._createTextureAndPostProcesses=function(){var D,w=this,N=this._mainTextureDesiredSize.width,F=this._mainTextureDesiredSize.height;N=this._engine.needPOTTextures?Ct.a.GetExponentOfTwo(N,this._maxSize):N,F=this._engine.needPOTTextures?Ct.a.GetExponentOfTwo(F,this._maxSize):F,D=this._engine.getCaps().textureHalfFloatRender?ce.a.TEXTURETYPE_HALF_FLOAT:ce.a.TEXTURETYPE_UNSIGNED_INT,this._blurTexture1=new Li("GlowLayerBlurRTT",{width:N,height:F},this._scene,!1,!0,D),this._blurTexture1.wrapU=Jt.a.CLAMP_ADDRESSMODE,this._blurTexture1.wrapV=Jt.a.CLAMP_ADDRESSMODE,this._blurTexture1.updateSamplingMode(Jt.a.BILINEAR_SAMPLINGMODE),this._blurTexture1.renderParticles=!1,this._blurTexture1.ignoreCameraViewport=!0;var k=Math.floor(N/2),j=Math.floor(F/2);this._blurTexture2=new Li("GlowLayerBlurRTT2",{width:k,height:j},this._scene,!1,!0,D),this._blurTexture2.wrapU=Jt.a.CLAMP_ADDRESSMODE,this._blurTexture2.wrapV=Jt.a.CLAMP_ADDRESSMODE,this._blurTexture2.updateSamplingMode(Jt.a.BILINEAR_SAMPLINGMODE),this._blurTexture2.renderParticles=!1,this._blurTexture2.ignoreCameraViewport=!0,this._textures=[this._blurTexture1,this._blurTexture2],this._horizontalBlurPostprocess1=new Fo("GlowLayerHBP1",new z.d(1,0),this._options.blurKernelSize/2,{width:N,height:F},null,Jt.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,D),this._horizontalBlurPostprocess1.width=N,this._horizontalBlurPostprocess1.height=F,this._horizontalBlurPostprocess1.onApplyObservable.add((function(D){D.setTexture("textureSampler",w._mainTexture)})),this._verticalBlurPostprocess1=new Fo("GlowLayerVBP1",new z.d(0,1),this._options.blurKernelSize/2,{width:N,height:F},null,Jt.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,D),this._horizontalBlurPostprocess2=new Fo("GlowLayerHBP2",new z.d(1,0),this._options.blurKernelSize/2,{width:k,height:j},null,Jt.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,D),this._horizontalBlurPostprocess2.width=k,this._horizontalBlurPostprocess2.height=j,this._horizontalBlurPostprocess2.onApplyObservable.add((function(D){D.setTexture("textureSampler",w._blurTexture1)})),this._verticalBlurPostprocess2=new Fo("GlowLayerVBP2",new z.d(0,1),this._options.blurKernelSize/2,{width:k,height:j},null,Jt.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,D),this._postProcesses=[this._horizontalBlurPostprocess1,this._verticalBlurPostprocess1,this._horizontalBlurPostprocess2,this._verticalBlurPostprocess2],this._postProcesses1=[this._horizontalBlurPostprocess1,this._verticalBlurPostprocess1],this._postProcesses2=[this._horizontalBlurPostprocess2,this._verticalBlurPostprocess2],this._mainTexture.samples=this._options.mainTextureSamples,this._mainTexture.onAfterUnbindObservable.add((function(){var D=w._blurTexture1.getInternalTexture();D&&(w._scene.postProcessManager.directRender(w._postProcesses1,D,!0),(D=w._blurTexture2.getInternalTexture())&&w._scene.postProcessManager.directRender(w._postProcesses2,D,!0))})),this._postProcesses.map((function(D){D.autoClear=!1}))},t.prototype.isReady=function(w,N){var F=w.getMaterial(),k=w.getRenderingMesh();if(!F||!k)return!1;var j=F.emissiveTexture;return D.prototype._isReady.call(this,w,N,j)},t.prototype.needStencil=function(){return!1},t.prototype._canRenderMesh=function(D,w){return!0},t.prototype._internalRender=function(D){D.setTexture("textureSampler",this._blurTexture1),D.setTexture("textureSampler2",this._blurTexture2),D.setFloat("offset",this._intensity);var w=this._engine,N=w.getStencilBuffer();w.setStencilBuffer(!1),w.drawElementsType(Ps.a.TriangleFillMode,0,6),w.setStencilBuffer(N)},t.prototype._setEmissiveTextureAndColor=function(D,w,N){var F=1;this.customEmissiveTextureSelector?this._emissiveTextureAndColor.texture=this.customEmissiveTextureSelector(D,w,N):N?(this._emissiveTextureAndColor.texture=N.emissiveTexture,this._emissiveTextureAndColor.texture&&(F=this._emissiveTextureAndColor.texture.level)):this._emissiveTextureAndColor.texture=null,this.customEmissiveColorSelector?this.customEmissiveColorSelector(D,w,N,this._emissiveTextureAndColor.color):N.emissiveColor?this._emissiveTextureAndColor.color.set(N.emissiveColor.r*F,N.emissiveColor.g*F,N.emissiveColor.b*F,N.alpha):this._emissiveTextureAndColor.color.set(this.neutralColor.r,this.neutralColor.g,this.neutralColor.b,this.neutralColor.a)},t.prototype._shouldRenderMesh=function(D){return this.hasMesh(D)},t.prototype._addCustomEffectDefines=function(D){D.push("#define GLOW")},t.prototype.addExcludedMesh=function(D){-1===this._excludedMeshes.indexOf(D.uniqueId)&&this._excludedMeshes.push(D.uniqueId)},t.prototype.removeExcludedMesh=function(D){var w=this._excludedMeshes.indexOf(D.uniqueId);-1!==w&&this._excludedMeshes.splice(w,1)},t.prototype.addIncludedOnlyMesh=function(D){-1===this._includedOnlyMeshes.indexOf(D.uniqueId)&&this._includedOnlyMeshes.push(D.uniqueId)},t.prototype.removeIncludedOnlyMesh=function(D){var w=this._includedOnlyMeshes.indexOf(D.uniqueId);-1!==w&&this._includedOnlyMeshes.splice(w,1)},t.prototype.hasMesh=function(w){return!!D.prototype.hasMesh.call(this,w)&&(this._includedOnlyMeshes.length?-1!==this._includedOnlyMeshes.indexOf(w.uniqueId):!this._excludedMeshes.length||-1===this._excludedMeshes.indexOf(w.uniqueId))},t.prototype._useMeshMaterial=function(D){return 0!=this._meshesUsingTheirOwnMaterials.length&&this._meshesUsingTheirOwnMaterials.indexOf(D.uniqueId)>-1},t.prototype.referenceMeshToUseItsOwnMaterial=function(D){this._meshesUsingTheirOwnMaterials.push(D.uniqueId)},t.prototype.unReferenceMeshFromUsingItsOwnMaterial=function(D){for(var w=this._meshesUsingTheirOwnMaterials.indexOf(D.uniqueId);w>0;)this._meshesUsingTheirOwnMaterials.slice(w,w+1),w=this._meshesUsingTheirOwnMaterials.indexOf(D.uniqueId)},t.prototype._disposeMesh=function(D){this.removeIncludedOnlyMesh(D),this.removeExcludedMesh(D)},t.prototype.getClassName=function(){return"GlowLayer"},t.prototype.serialize=function(){var D,w=Ie.a.Serialize(this);if(w.customType="BABYLON.GlowLayer",w.includedMeshes=[],this._includedOnlyMeshes.length)for(D=0;D<this._includedOnlyMeshes.length;D++)(N=this._scene.getMeshByUniqueID(this._includedOnlyMeshes[D]))&&w.includedMeshes.push(N.id);if(w.excludedMeshes=[],this._excludedMeshes.length)for(D=0;D<this._excludedMeshes.length;D++){var N;(N=this._scene.getMeshByUniqueID(this._excludedMeshes[D]))&&w.excludedMeshes.push(N.id)}return w},t.Parse=function(D,w,N){var F,k=Ie.a.Parse((function(){return new t(D.name,w,D.options)}),D,w,N);for(F=0;F<D.excludedMeshes.length;F++)(j=w.getMeshByID(D.excludedMeshes[F]))&&k.addExcludedMesh(j);for(F=0;F<D.includedMeshes.length;F++){var j;(j=w.getMeshByID(D.includedMeshes[F]))&&k.addIncludedOnlyMesh(j)}return k},t.EffectName="GlowLayer",t.DefaultBlurKernelSize=32,t.DefaultTextureRatio=.5,Object(Z.c)([Object(Ie.c)()],t.prototype,"blurKernelSize",null),Object(Z.c)([Object(Ie.c)()],t.prototype,"intensity",null),Object(Z.c)([Object(Ie.c)("options")],t.prototype,"_options",void 0),t}(Cs);H.a.RegisteredTypes["BABYLON.GlowLayer"]=Rs,li.a.ShadersStore.glowBlurPostProcessPixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec2 screenSize;\nuniform vec2 direction;\nuniform float blurWidth;\n\nfloat getLuminance(vec3 color)\n{\nreturn dot(color,vec3(0.2126,0.7152,0.0722));\n}\nvoid main(void)\n{\nfloat weights[7];\nweights[0]=0.05;\nweights[1]=0.1;\nweights[2]=0.2;\nweights[3]=0.3;\nweights[4]=0.2;\nweights[5]=0.1;\nweights[6]=0.05;\nvec2 texelSize=vec2(1.0/screenSize.x,1.0/screenSize.y);\nvec2 texelStep=texelSize*direction*blurWidth;\nvec2 start=vUV-3.0*texelStep;\nvec4 baseColor=vec4(0.,0.,0.,0.);\nvec2 texelOffset=vec2(0.,0.);\nfor (int i=0; i<7; i++)\n{\n\nvec4 texel=texture2D(textureSampler,start+texelOffset);\nbaseColor.a+=texel.a*weights[i];\n\nfloat luminance=getLuminance(baseColor.rgb);\nfloat luminanceTexel=getLuminance(texel.rgb);\nfloat choice=step(luminanceTexel,luminance);\nbaseColor.rgb=choice*baseColor.rgb+(1.0-choice)*texel.rgb;\ntexelOffset+=texelStep;\n}\ngl_FragColor=baseColor;\n}",F.a.prototype.getHighlightLayerByName=function(D){for(var w=0;w<this.effectLayers.length;w++)if(this.effectLayers[w].name===D&&this.effectLayers[w].getEffectName()===Fs.EffectName)return this.effectLayers[w];return null};var Ns=function(D){function t(w,N,F,k,j,z,G,H){void 0===z&&(z=Jt.a.BILINEAR_SAMPLINGMODE);var X=D.call(this,w,"glowBlurPostProcess",["screenSize","direction","blurWidth"],null,k,j,z,G,H)||this;return X.direction=N,X.kernel=F,X.onApplyObservable.add((function(D){D.setFloat2("screenSize",X.width,X.height),D.setVector2("direction",X.direction),D.setFloat("blurWidth",X.kernel)})),X}return Object(Z.d)(t,D),t}(fi),Fs=function(D){function t(w,N,F){var k=D.call(this,w,N)||this;return k.name=w,k.innerGlow=!0,k.outerGlow=!0,k.onBeforeBlurObservable=new j.c,k.onAfterBlurObservable=new j.c,k._instanceGlowingMeshStencilReference=t.GlowingMeshStencilReference++,k._meshes={},k._excludedMeshes={},k.neutralColor=t.NeutralColor,k._engine.isStencilEnable||oe.a.Warn("Rendering the Highlight Layer requires the stencil to be active on the canvas. var engine = new Engine(canvas, antialias, { stencil: true }"),k._options=Object(Z.a)({mainTextureRatio:.5,blurTextureSizeRatio:.5,blurHorizontalSize:1,blurVerticalSize:1,alphaBlendingMode:ce.a.ALPHA_COMBINE,camera:null,renderingGroupId:-1},F),k._init({alphaBlendingMode:k._options.alphaBlendingMode,camera:k._options.camera,mainTextureFixedSize:k._options.mainTextureFixedSize,mainTextureRatio:k._options.mainTextureRatio,renderingGroupId:k._options.renderingGroupId}),k._shouldRender=!1,k}return Object(Z.d)(t,D),Object.defineProperty(t.prototype,"blurHorizontalSize",{get:function(){return this._horizontalBlurPostprocess.kernel},set:function(D){this._horizontalBlurPostprocess.kernel=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"blurVerticalSize",{get:function(){return this._verticalBlurPostprocess.kernel},set:function(D){this._verticalBlurPostprocess.kernel=D},enumerable:!0,configurable:!0}),t.prototype.getEffectName=function(){return t.EffectName},t.prototype._createMergeEffect=function(){return this._engine.createEffect("glowMapMerge",[Zi.b.PositionKind],["offset"],["textureSampler"],this._options.isStroke?"#define STROKE \n":void 0)},t.prototype._createTextureAndPostProcesses=function(){var D,w=this,N=this._mainTextureDesiredSize.width*this._options.blurTextureSizeRatio,F=this._mainTextureDesiredSize.height*this._options.blurTextureSizeRatio;N=this._engine.needPOTTextures?Ct.a.GetExponentOfTwo(N,this._maxSize):N,F=this._engine.needPOTTextures?Ct.a.GetExponentOfTwo(F,this._maxSize):F,D=this._engine.getCaps().textureHalfFloatRender?ce.a.TEXTURETYPE_HALF_FLOAT:ce.a.TEXTURETYPE_UNSIGNED_INT,this._blurTexture=new Li("HighlightLayerBlurRTT",{width:N,height:F},this._scene,!1,!0,D),this._blurTexture.wrapU=Jt.a.CLAMP_ADDRESSMODE,this._blurTexture.wrapV=Jt.a.CLAMP_ADDRESSMODE,this._blurTexture.anisotropicFilteringLevel=16,this._blurTexture.updateSamplingMode(Jt.a.TRILINEAR_SAMPLINGMODE),this._blurTexture.renderParticles=!1,this._blurTexture.ignoreCameraViewport=!0,this._textures=[this._blurTexture],this._options.alphaBlendingMode===ce.a.ALPHA_COMBINE?(this._downSamplePostprocess=new pi("HighlightLayerPPP",this._options.blurTextureSizeRatio,null,Jt.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine()),this._downSamplePostprocess.onApplyObservable.add((function(D){D.setTexture("textureSampler",w._mainTexture)})),this._horizontalBlurPostprocess=new Ns("HighlightLayerHBP",new z.d(1,0),this._options.blurHorizontalSize,1,null,Jt.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine()),this._horizontalBlurPostprocess.onApplyObservable.add((function(D){D.setFloat2("screenSize",N,F)})),this._verticalBlurPostprocess=new Ns("HighlightLayerVBP",new z.d(0,1),this._options.blurVerticalSize,1,null,Jt.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine()),this._verticalBlurPostprocess.onApplyObservable.add((function(D){D.setFloat2("screenSize",N,F)})),this._postProcesses=[this._downSamplePostprocess,this._horizontalBlurPostprocess,this._verticalBlurPostprocess]):(this._horizontalBlurPostprocess=new Fo("HighlightLayerHBP",new z.d(1,0),this._options.blurHorizontalSize/2,{width:N,height:F},null,Jt.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,D),this._horizontalBlurPostprocess.width=N,this._horizontalBlurPostprocess.height=F,this._horizontalBlurPostprocess.onApplyObservable.add((function(D){D.setTexture("textureSampler",w._mainTexture)})),this._verticalBlurPostprocess=new Fo("HighlightLayerVBP",new z.d(0,1),this._options.blurVerticalSize/2,{width:N,height:F},null,Jt.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,D),this._postProcesses=[this._horizontalBlurPostprocess,this._verticalBlurPostprocess]),this._mainTexture.onAfterUnbindObservable.add((function(){w.onBeforeBlurObservable.notifyObservers(w);var D=w._blurTexture.getInternalTexture();D&&w._scene.postProcessManager.directRender(w._postProcesses,D,!0),w.onAfterBlurObservable.notifyObservers(w)})),this._postProcesses.map((function(D){D.autoClear=!1}))},t.prototype.needStencil=function(){return!0},t.prototype.isReady=function(w,N){var F=w.getMaterial(),k=w.getRenderingMesh();if(!F||!k||!this._meshes)return!1;var j=null,z=this._meshes[k.uniqueId];return z&&z.glowEmissiveOnly&&F&&(j=F.emissiveTexture),D.prototype._isReady.call(this,w,N,j)},t.prototype._internalRender=function(D){D.setTexture("textureSampler",this._blurTexture);var w=this._engine;w.cacheStencilState(),w.setStencilOperationPass(ce.a.REPLACE),w.setStencilOperationFail(ce.a.KEEP),w.setStencilOperationDepthFail(ce.a.KEEP),w.setStencilMask(0),w.setStencilBuffer(!0),w.setStencilFunctionReference(this._instanceGlowingMeshStencilReference),this.outerGlow&&(D.setFloat("offset",0),w.setStencilFunction(ce.a.NOTEQUAL),w.drawElementsType(Ps.a.TriangleFillMode,0,6)),this.innerGlow&&(D.setFloat("offset",1),w.setStencilFunction(ce.a.EQUAL),w.drawElementsType(Ps.a.TriangleFillMode,0,6)),w.restoreStencilState()},t.prototype.shouldRender=function(){return!!D.prototype.shouldRender.call(this)&&!!this._meshes},t.prototype._shouldRenderMesh=function(w){return!(this._excludedMeshes&&this._excludedMeshes[w.uniqueId]||!D.prototype.hasMesh.call(this,w))},t.prototype._setEmissiveTextureAndColor=function(D,w,N){var F=this._meshes[D.uniqueId];F?this._emissiveTextureAndColor.color.set(F.color.r,F.color.g,F.color.b,1):this._emissiveTextureAndColor.color.set(this.neutralColor.r,this.neutralColor.g,this.neutralColor.b,this.neutralColor.a),F&&F.glowEmissiveOnly&&N?(this._emissiveTextureAndColor.texture=N.emissiveTexture,this._emissiveTextureAndColor.color.set(1,1,1,1)):this._emissiveTextureAndColor.texture=null},t.prototype.addExcludedMesh=function(D){this._excludedMeshes&&(this._excludedMeshes[D.uniqueId]||(this._excludedMeshes[D.uniqueId]={mesh:D,beforeBind:D.onBeforeBindObservable.add((function(D){D.getEngine().setStencilBuffer(!1)})),afterRender:D.onAfterRenderObservable.add((function(D){D.getEngine().setStencilBuffer(!0)}))}))},t.prototype.removeExcludedMesh=function(D){if(this._excludedMeshes){var w=this._excludedMeshes[D.uniqueId];w&&(w.beforeBind&&D.onBeforeBindObservable.remove(w.beforeBind),w.afterRender&&D.onAfterRenderObservable.remove(w.afterRender)),this._excludedMeshes[D.uniqueId]=null}},t.prototype.hasMesh=function(w){return!!this._meshes&&!!D.prototype.hasMesh.call(this,w)&&void 0!==this._meshes[w.uniqueId]&&null!==this._meshes[w.uniqueId]},t.prototype.addMesh=function(D,w,N){var F=this;if(void 0===N&&(N=!1),this._meshes){var k=this._meshes[D.uniqueId];k?k.color=w:(this._meshes[D.uniqueId]={mesh:D,color:w,observerHighlight:D.onBeforeBindObservable.add((function(D){F.isEnabled&&(F._excludedMeshes&&F._excludedMeshes[D.uniqueId]?F._defaultStencilReference(D):D.getScene().getEngine().setStencilFunctionReference(F._instanceGlowingMeshStencilReference))})),observerDefault:D.onAfterRenderObservable.add((function(D){F.isEnabled&&F._defaultStencilReference(D)})),glowEmissiveOnly:N},D.onDisposeObservable.add((function(){F._disposeMesh(D)}))),this._shouldRender=!0}},t.prototype.removeMesh=function(D){if(this._meshes){var w=this._meshes[D.uniqueId];for(var N in w&&(w.observerHighlight&&D.onBeforeBindObservable.remove(w.observerHighlight),w.observerDefault&&D.onAfterRenderObservable.remove(w.observerDefault),delete this._meshes[D.uniqueId]),this._shouldRender=!1,this._meshes)if(this._meshes[N]){this._shouldRender=!0;break}}},t.prototype.removeAllMeshes=function(){if(this._meshes)for(var D in this._meshes)if(this._meshes.hasOwnProperty(D)){var w=this._meshes[D];w&&this.removeMesh(w.mesh)}},t.prototype._defaultStencilReference=function(D){D.getScene().getEngine().setStencilFunctionReference(t.NormalMeshStencilReference)},t.prototype._disposeMesh=function(D){this.removeMesh(D),this.removeExcludedMesh(D)},t.prototype.dispose=function(){if(this._meshes){for(var w in this._meshes)(N=this._meshes[w])&&N.mesh&&(N.observerHighlight&&N.mesh.onBeforeBindObservable.remove(N.observerHighlight),N.observerDefault&&N.mesh.onAfterRenderObservable.remove(N.observerDefault));this._meshes=null}if(this._excludedMeshes){for(var w in this._excludedMeshes){var N;(N=this._excludedMeshes[w])&&(N.beforeBind&&N.mesh.onBeforeBindObservable.remove(N.beforeBind),N.afterRender&&N.mesh.onAfterRenderObservable.remove(N.afterRender))}this._excludedMeshes=null}D.prototype.dispose.call(this)},t.prototype.getClassName=function(){return"HighlightLayer"},t.prototype.serialize=function(){var D=Ie.a.Serialize(this);if(D.customType="BABYLON.HighlightLayer",D.meshes=[],this._meshes)for(var w in this._meshes){var N=this._meshes[w];N&&D.meshes.push({glowEmissiveOnly:N.glowEmissiveOnly,color:N.color.asArray(),meshId:N.mesh.id})}if(D.excludedMeshes=[],this._excludedMeshes)for(var F in this._excludedMeshes){var k=this._excludedMeshes[F];k&&D.excludedMeshes.push(k.mesh.id)}return D},t.Parse=function(D,w,N){var F,k=Ie.a.Parse((function(){return new t(D.name,w,D.options)}),D,w,N);for(F=0;F<D.excludedMeshes.length;F++)(j=w.getMeshByID(D.excludedMeshes[F]))&&k.addExcludedMesh(j);for(F=0;F<D.meshes.length;F++){var j,z=D.meshes[F];(j=w.getMeshByID(z.meshId))&&k.addMesh(j,G.a.FromArray(z.color),z.glowEmissiveOnly)}return k},t.EffectName="HighlightLayer",t.NeutralColor=new G.b(0,0,0,0),t.GlowingMeshStencilReference=2,t.NormalMeshStencilReference=1,Object(Z.c)([Object(Ie.c)()],t.prototype,"innerGlow",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"outerGlow",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"blurHorizontalSize",null),Object(Z.c)([Object(Ie.c)()],t.prototype,"blurVerticalSize",null),Object(Z.c)([Object(Ie.c)("options")],t.prototype,"_options",void 0),t}(Cs);H.a.RegisteredTypes["BABYLON.HighlightLayer"]=Fs;var Bs=function(){function e(D){this.name=Nt.a.NAME_LAYER,this.scene=D,this._engine=D.getEngine(),D.layers=new Array}return e.prototype.register=function(){this.scene._beforeCameraDrawStage.registerStep(Nt.a.STEP_BEFORECAMERADRAW_LAYER,this,this._drawCameraBackground),this.scene._afterCameraDrawStage.registerStep(Nt.a.STEP_AFTERCAMERADRAW_LAYER,this,this._drawCameraForeground),this.scene._beforeRenderTargetDrawStage.registerStep(Nt.a.STEP_BEFORERENDERTARGETDRAW_LAYER,this,this._drawRenderTargetBackground),this.scene._afterRenderTargetDrawStage.registerStep(Nt.a.STEP_AFTERRENDERTARGETDRAW_LAYER,this,this._drawRenderTargetForeground)},e.prototype.rebuild=function(){for(var D=0,w=this.scene.layers;D<w.length;D++)w[D]._rebuild()},e.prototype.dispose=function(){for(var D=this.scene.layers;D.length;)D[0].dispose()},e.prototype._draw=function(D){var w=this.scene.layers;if(w.length){this._engine.setDepthBuffer(!1);for(var N=0,F=w;N<F.length;N++){var k=F[N];D(k)&&k.render()}this._engine.setDepthBuffer(!0)}},e.prototype._drawCameraPredicate=function(D,w,N){return!D.renderOnlyInRenderTargetTextures&&D.isBackground===w&&0!=(D.layerMask&N)},e.prototype._drawCameraBackground=function(D){var w=this;this._draw((function(N){return w._drawCameraPredicate(N,!0,D.layerMask)}))},e.prototype._drawCameraForeground=function(D){var w=this;this._draw((function(N){return w._drawCameraPredicate(N,!1,D.layerMask)}))},e.prototype._drawRenderTargetPredicate=function(D,w,N,F){return D.renderTargetTextures.length>0&&D.isBackground===w&&D.renderTargetTextures.indexOf(F)>-1&&0!=(D.layerMask&N)},e.prototype._drawRenderTargetBackground=function(D){var w=this;this._draw((function(N){return w._drawRenderTargetPredicate(N,!0,w.scene.activeCamera.layerMask,D)}))},e.prototype._drawRenderTargetForeground=function(D){var w=this;this._draw((function(N){return w._drawRenderTargetPredicate(N,!1,w.scene.activeCamera.layerMask,D)}))},e.prototype.addFromContainer=function(D){var w=this;D.layers&&D.layers.forEach((function(D){w.scene.layers.push(D)}))},e.prototype.removeFromContainer=function(D,w){var N=this;void 0===w&&(w=!1),D.layers&&D.layers.forEach((function(D){var F=N.scene.layers.indexOf(D);-1!==F&&N.scene.layers.splice(F,1),w&&D.dispose()}))},e}();li.a.ShadersStore.layerPixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec4 color;\n\n#include<helperFunctions>\nvoid main(void) {\nvec4 baseColor=texture2D(textureSampler,vUV);\n#ifdef LINEAR\nbaseColor.rgb=toGammaSpace(baseColor.rgb);\n#endif\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\ngl_FragColor=baseColor*color;\n}",li.a.ShadersStore.layerVertexShader="\nattribute vec2 position;\n\nuniform vec2 scale;\nuniform vec2 offset;\nuniform mat4 textureMatrix;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) {\nvec2 shiftedPosition=position*scale+offset;\nvUV=vec2(textureMatrix*vec4(shiftedPosition*madd+madd,1.0,0.0));\ngl_Position=vec4(shiftedPosition,0.0,1.0);\n}";var ks=function(){function e(D,w,N,F,k){this.name=D,this.scale=new z.d(1,1),this.offset=new z.d(0,0),this.alphaBlendingMode=ce.a.ALPHA_COMBINE,this.layerMask=268435455,this.renderTargetTextures=[],this.renderOnlyInRenderTargetTextures=!1,this._vertexBuffers={},this.onDisposeObservable=new j.c,this.onBeforeRenderObservable=new j.c,this.onAfterRenderObservable=new j.c,this.texture=w?new Jt.a(w,N,!0):null,this.isBackground=void 0===F||F,this.color=void 0===k?new G.b(1,1,1,1):k,this._scene=N||Me.a.LastCreatedScene;var H=this._scene._getComponent(Nt.a.NAME_LAYER);H||(H=new Bs(this._scene),this._scene._addComponent(H)),this._scene.layers.push(this);var X=this._scene.getEngine(),q=[];q.push(1,1),q.push(-1,1),q.push(-1,-1),q.push(1,-1);var Z=new Zi.b(X,q,Zi.b.PositionKind,!1,!1,2);this._vertexBuffers[Zi.b.PositionKind]=Z,this._createIndexBuffer()}return Object.defineProperty(e.prototype,"onDispose",{set:function(D){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(D)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onBeforeRender",{set:function(D){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(D)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onAfterRender",{set:function(D){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(D)},enumerable:!0,configurable:!0}),e.prototype._createIndexBuffer=function(){var D=this._scene.getEngine(),w=[];w.push(0),w.push(1),w.push(2),w.push(0),w.push(2),w.push(3),this._indexBuffer=D.createIndexBuffer(w)},e.prototype._rebuild=function(){var D=this._vertexBuffers[Zi.b.PositionKind];D&&D._rebuild(),this._createIndexBuffer()},e.prototype.render=function(){var D=this._scene.getEngine(),w="";this.alphaTest&&(w="#define ALPHATEST"),this.texture&&!this.texture.gammaSpace&&(w+="\r\n#define LINEAR"),this._previousDefines!==w&&(this._previousDefines=w,this._effect=D.createEffect("layer",[Zi.b.PositionKind],["textureMatrix","color","scale","offset"],["textureSampler"],w));var N=this._effect;N&&N.isReady()&&this.texture&&this.texture.isReady()&&(D=this._scene.getEngine(),this.onBeforeRenderObservable.notifyObservers(this),D.enableEffect(N),D.setState(!1),N.setTexture("textureSampler",this.texture),N.setMatrix("textureMatrix",this.texture.getTextureMatrix()),N.setFloat4("color",this.color.r,this.color.g,this.color.b,this.color.a),N.setVector2("offset",this.offset),N.setVector2("scale",this.scale),D.bindBuffers(this._vertexBuffers,this._indexBuffer,N),this.alphaTest?D.drawElementsType(Ps.a.TriangleFillMode,0,6):(D.setAlphaMode(this.alphaBlendingMode),D.drawElementsType(Ps.a.TriangleFillMode,0,6),D.setAlphaMode(ce.a.ALPHA_DISABLE)),this.onAfterRenderObservable.notifyObservers(this))},e.prototype.dispose=function(){var D=this._vertexBuffers[Zi.b.PositionKind];D&&(D.dispose(),this._vertexBuffers[Zi.b.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this.texture&&(this.texture.dispose(),this.texture=null),this.renderTargetTextures=[];var w=this._scene.layers.indexOf(this);this._scene.layers.splice(w,1),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderObservable.clear()},e}(),Us=function(){function e(D,w,N,F,k){this.size=D,this.position=w,this.alphaMode=ce.a.ALPHA_ONEONE,this.color=N||new G.a(1,1,1),this.texture=F?new Jt.a(F,k.getScene(),!0):null,this._system=k,k.lensFlares.push(this)}return e.AddFlare=function(D,w,N,F,k){return new e(D,w,N,F,k)},e.prototype.dispose=function(){this.texture&&this.texture.dispose();var D=this._system.lensFlares.indexOf(this);this._system.lensFlares.splice(D,1)},e}();li.a.ShadersStore.lensFlarePixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec4 color;\nvoid main(void) {\nvec4 baseColor=texture2D(textureSampler,vUV);\ngl_FragColor=baseColor*color;\n}",li.a.ShadersStore.lensFlareVertexShader="\nattribute vec2 position;\n\nuniform mat4 viewportMatrix;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) {\nvUV=position*madd+madd;\ngl_Position=viewportMatrix*vec4(position,0.0,1.0);\n}";var Vs=function(){function e(D,w,N){this.name=D,this.lensFlares=new Array,this.borderLimit=300,this.viewportBorder=0,this.layerMask=268435455,this._vertexBuffers={},this._isEnabled=!0,this._scene=N||Me.a.LastCreatedScene,e._SceneComponentInitialization(this._scene),this._emitter=w,this.id=D,N.lensFlareSystems.push(this),this.meshesSelectionPredicate=function(D){return N.activeCamera&&D.material&&D.isVisible&&D.isEnabled()&&D.isBlocker&&0!=(D.layerMask&N.activeCamera.layerMask)};var F=N.getEngine(),k=[];k.push(1,1),k.push(-1,1),k.push(-1,-1),k.push(1,-1),this._vertexBuffers[Zi.b.PositionKind]=new Zi.b(F,k,Zi.b.PositionKind,!1,!1,2);var j=[];j.push(0),j.push(1),j.push(2),j.push(0),j.push(2),j.push(3),this._indexBuffer=F.createIndexBuffer(j),this._effect=F.createEffect("lensFlare",[Zi.b.PositionKind],["color","viewportMatrix"],["textureSampler"],"")}return Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(D){this._isEnabled=D},enumerable:!0,configurable:!0}),e.prototype.getScene=function(){return this._scene},e.prototype.getEmitter=function(){return this._emitter},e.prototype.setEmitter=function(D){this._emitter=D},e.prototype.getEmitterPosition=function(){return this._emitter.getAbsolutePosition?this._emitter.getAbsolutePosition():this._emitter.position},e.prototype.computeEffectivePosition=function(D){var w=this.getEmitterPosition();return w=z.e.Project(w,z.a.Identity(),this._scene.getTransformMatrix(),D),this._positionX=w.x,this._positionY=w.y,w=z.e.TransformCoordinates(this.getEmitterPosition(),this._scene.getViewMatrix()),this.viewportBorder>0&&(D.x-=this.viewportBorder,D.y-=this.viewportBorder,D.width+=2*this.viewportBorder,D.height+=2*this.viewportBorder,w.x+=this.viewportBorder,w.y+=this.viewportBorder,this._positionX+=this.viewportBorder,this._positionY+=this.viewportBorder),w.z>0&&(this._positionX>D.x&&this._positionX<D.x+D.width&&this._positionY>D.y&&(this._positionY,D.y,D.height),!0)},e.prototype._isVisible=function(){if(!this._isEnabled||!this._scene.activeCamera)return!1;var D=this.getEmitterPosition().subtract(this._scene.activeCamera.globalPosition),w=D.length();D.normalize();var N=new Qn.a(this._scene.activeCamera.globalPosition,D),F=this._scene.pickWithRay(N,this.meshesSelectionPredicate,!0);return!F||!F.hit||F.distance>w},e.prototype.render=function(){if(!this._effect.isReady()||!this._scene.activeCamera)return!1;var D,w,N=this._scene.getEngine(),F=this._scene.activeCamera.viewport.toGlobal(N.getRenderWidth(!0),N.getRenderHeight(!0));if(!this.computeEffectivePosition(F))return!1;if(!this._isVisible())return!1;var k=(D=this._positionX<this.borderLimit+F.x?this.borderLimit+F.x-this._positionX:this._positionX>F.x+F.width-this.borderLimit?this._positionX-F.x-F.width+this.borderLimit:0)>(w=this._positionY<this.borderLimit+F.y?this.borderLimit+F.y-this._positionY:this._positionY>F.y+F.height-this.borderLimit?this._positionY-F.y-F.height+this.borderLimit:0)?D:w;(k-=this.viewportBorder)>this.borderLimit&&(k=this.borderLimit);var j=1-De.a.Clamp(k/this.borderLimit,0,1);if(j<0)return!1;j>1&&(j=1),this.viewportBorder>0&&(F.x+=this.viewportBorder,F.y+=this.viewportBorder,F.width-=2*this.viewportBorder,F.height-=2*this.viewportBorder,this._positionX-=this.viewportBorder,this._positionY-=this.viewportBorder);var G=F.x+F.width/2,H=F.y+F.height/2,X=G-this._positionX,q=H-this._positionY;N.enableEffect(this._effect),N.setState(!1),N.setDepthBuffer(!1),N.bindBuffers(this._vertexBuffers,this._indexBuffer,this._effect);for(var Z=0;Z<this.lensFlares.length;Z++){var J=this.lensFlares[Z];if(!J.texture||J.texture.isReady()){N.setAlphaMode(J.alphaMode);var $=G-X*J.position,te=H-q*J.position,ie=J.size,oe=J.size*N.getAspectRatio(this._scene.activeCamera,!0),he=$/(F.width+2*F.x)*2-1,fe=1-te/(F.height+2*F.y)*2,pe=z.a.FromValues(ie/2,0,0,0,0,oe/2,0,0,0,0,1,0,he,fe,0,1);this._effect.setMatrix("viewportMatrix",pe),this._effect.setTexture("textureSampler",J.texture),this._effect.setFloat4("color",J.color.r*j,J.color.g*j,J.color.b*j,1),N.drawElementsType(Ps.a.TriangleFillMode,0,6)}}return N.setDepthBuffer(!0),N.setAlphaMode(ce.a.ALPHA_DISABLE),!0},e.prototype.dispose=function(){var D=this._vertexBuffers[Zi.b.PositionKind];for(D&&(D.dispose(),this._vertexBuffers[Zi.b.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null);this.lensFlares.length;)this.lensFlares[0].dispose();var w=this._scene.lensFlareSystems.indexOf(this);this._scene.lensFlareSystems.splice(w,1)},e.Parse=function(D,w,N){var F=w.getLastEntryByID(D.emitterId),k=D.name||"lensFlareSystem#"+D.emitterId,j=new e(k,F,w);j.id=D.id||k,j.borderLimit=D.borderLimit;for(var z=0;z<D.flares.length;z++){var H=D.flares[z];Us.AddFlare(H.size,H.position,G.a.FromArray(H.color),H.textureName?N+H.textureName:"",j)}return j},e.prototype.serialize=function(){var D={};D.id=this.id,D.name=this.name,D.emitterId=this.getEmitter().id,D.borderLimit=this.borderLimit,D.flares=[];for(var w=0;w<this.lensFlares.length;w++){var N=this.lensFlares[w];D.flares.push({size:N.size,position:N.position,color:N.color.asArray(),textureName:Dt.b.GetFilename(N.texture?N.texture.name:"")})}return D},e._SceneComponentInitialization=function(D){throw It.a.WarnImport("LensFlareSystemSceneComponent")},e}();F.a.AddParser(Nt.a.NAME_LENSFLARESYSTEM,(function(D,w,N,F){if(void 0!==D.lensFlareSystems&&null!==D.lensFlareSystems){N.lensFlareSystems||(N.lensFlareSystems=new Array);for(var k=0,j=D.lensFlareSystems.length;k<j;k++){var z=D.lensFlareSystems[k],G=Vs.Parse(z,w,F);N.lensFlareSystems.push(G)}}})),F.a.prototype.getLensFlareSystemByName=function(D){for(var w=0;w<this.lensFlareSystems.length;w++)if(this.lensFlareSystems[w].name===D)return this.lensFlareSystems[w];return null},F.a.prototype.getLensFlareSystemByID=function(D){for(var w=0;w<this.lensFlareSystems.length;w++)if(this.lensFlareSystems[w].id===D)return this.lensFlareSystems[w];return null},F.a.prototype.removeLensFlareSystem=function(D){var w=this.lensFlareSystems.indexOf(D);return-1!==w&&this.lensFlareSystems.splice(w,1),w},F.a.prototype.addLensFlareSystem=function(D){this.lensFlareSystems.push(D)};var js=function(){function e(D){this.name=Nt.a.NAME_LENSFLARESYSTEM,this.scene=D,D.lensFlareSystems=new Array}return e.prototype.register=function(){this.scene._afterCameraDrawStage.registerStep(Nt.a.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM,this,this._draw)},e.prototype.rebuild=function(){},e.prototype.addFromContainer=function(D){var w=this;D.lensFlareSystems&&D.lensFlareSystems.forEach((function(D){w.scene.addLensFlareSystem(D)}))},e.prototype.removeFromContainer=function(D,w){var N=this;D.lensFlareSystems&&D.lensFlareSystems.forEach((function(D){N.scene.removeLensFlareSystem(D),w&&D.dispose()}))},e.prototype.serialize=function(D){D.lensFlareSystems=[];for(var w=0,N=this.scene.lensFlareSystems;w<N.length;w++){var F=N[w];D.lensFlareSystems.push(F.serialize())}},e.prototype.dispose=function(){for(var D=this.scene.lensFlareSystems;D.length;)D[0].dispose()},e.prototype._draw=function(D){if(this.scene.lensFlaresEnabled){var w=this.scene.lensFlareSystems;Dt.b.StartPerformanceCounter("Lens flares",w.length>0);for(var N=0,F=w;N<F.length;N++){var k=F[N];0!=(D.layerMask&k.layerMask)&&k.render()}Dt.b.EndPerformanceCounter("Lens flares",w.length>0)}},e}();Vs._SceneComponentInitialization=function(D){var w=D._getComponent(Nt.a.NAME_LENSFLARESYSTEM);w||(w=new js(D),D._addComponent(w))},li.a.ShadersStore.shadowMapPixelShader="#ifndef FLOAT\n#include<packingFunctions>\n#endif\nvarying float vDepthMetric;\n#ifdef USEDISTANCE\nuniform vec3 lightData;\nvarying vec3 vPositionW;\n#endif\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\nuniform vec3 biasAndScale;\nuniform vec2 depthValues;\n#ifdef DEPTHCLAMP\nvarying float z;\n#endif\n#include<clipPlaneFragmentDeclaration>\nvoid main(void)\n{\n#include<clipPlaneFragment>\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\nfloat depth=vDepthMetric;\n#ifdef DEPTHCLAMP\n#ifdef USEDISTANCE\ndepth=clamp(((length(vPositionW-lightData)+depthValues.x)/(depthValues.y))+biasAndScale.x,0.0,1.0);\n#else\ndepth=clamp(((z+depthValues.x)/(depthValues.y))+biasAndScale.x,0.0,1.0);\n#endif\ngl_FragDepth=depth;\n#elif defined(USEDISTANCE)\ndepth=(length(vPositionW-lightData)+depthValues.x)/(depthValues.y)+biasAndScale.x;\n#endif\n#ifdef ESM\ndepth=clamp(exp(-min(87.,biasAndScale.z*depth)),0.,1.);\n#endif\n#ifdef FLOAT\ngl_FragColor=vec4(depth,1.0,1.0,1.0);\n#else\ngl_FragColor=pack(depth);\n#endif\n}",li.a.ShadersStore.shadowMapVertexShader="\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\nuniform vec3 lightData;\n#endif\n#include<bonesDeclaration>\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n\n#include<instancesDeclaration>\n#include<helperFunctions>\nuniform mat4 viewProjection;\nuniform vec3 biasAndScale;\nuniform vec2 depthValues;\nvarying float vDepthMetric;\n#ifdef USEDISTANCE\nvarying vec3 vPositionW;\n#endif\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\n#ifdef DEPTHCLAMP\nvarying float z;\n#endif\n#include<clipPlaneVertexDeclaration>\nvoid main(void)\n{\nvec3 positionUpdated=position;\n#ifdef UV1\nvec2 uvUpdated=uv;\n#endif\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPos=finalWorld*vec4(positionUpdated,1.0);\n\n#ifdef NORMAL\nmat3 normalWorld=mat3(finalWorld);\n#ifdef NONUNIFORMSCALING\nnormalWorld=transposeMat3(inverseMat3(normalWorld));\n#endif\nvec3 worldNor=normalize(normalWorld*normal);\n#ifdef DIRECTIONINLIGHTDATA\nvec3 worldLightDir=normalize(-lightData.xyz);\n#else\nvec3 directionToLight=lightData.xyz-worldPos.xyz;\nvec3 worldLightDir=normalize(directionToLight);\n#endif\nfloat ndl=dot(worldNor,worldLightDir);\nfloat sinNL=sqrt(1.0-ndl*ndl);\nfloat normalBias=biasAndScale.y*sinNL;\nworldPos.xyz-=worldNor*normalBias;\n#endif\n#ifdef USEDISTANCE\nvPositionW=worldPos.xyz;\n#endif\n\ngl_Position=viewProjection*worldPos;\n#ifdef DEPTHTEXTURE\n\ngl_Position.z+=biasAndScale.x*gl_Position.w;\n#endif\n#ifdef DEPTHCLAMP\nz=gl_Position.z;\ngl_Position.z=0.0;\n#elif !defined(USEDISTANCE)\n\nvDepthMetric=((gl_Position.z+depthValues.x)/(depthValues.y))+biasAndScale.x;\n#endif\n#ifdef ALPHATEST\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n#include<clipPlaneVertex>\n}",li.a.ShadersStore.depthBoxBlurPixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec2 screenSize;\nvoid main(void)\n{\nvec4 colorDepth=vec4(0.0);\nfor (int x=-OFFSET; x<=OFFSET; x++)\nfor (int y=-OFFSET; y<=OFFSET; y++)\ncolorDepth+=texture2D(textureSampler,vUV+vec2(x,y)/screenSize);\ngl_FragColor=(colorDepth/float((OFFSET*2+1)*(OFFSET*2+1)));\n}";var zs=function(){function e(D,w,N){this.onBeforeShadowMapRenderObservable=new j.c,this.onAfterShadowMapRenderObservable=new j.c,this.onBeforeShadowMapRenderMeshObservable=new j.c,this.onAfterShadowMapRenderMeshObservable=new j.c,this._bias=5e-5,this._normalBias=0,this._blurBoxOffset=1,this._blurScale=2,this._blurKernel=1,this._useKernelBlur=!1,this._filter=e.FILTER_NONE,this._filteringQuality=e.QUALITY_HIGH,this._contactHardeningLightSizeUVRatio=.1,this._darkness=0,this._transparencyShadow=!1,this.frustumEdgeFalloff=0,this.forceBackFacesOnly=!1,this._lightDirection=z.e.Zero(),this._viewMatrix=z.a.Zero(),this._projectionMatrix=z.a.Zero(),this._transformMatrix=z.a.Zero(),this._cachedPosition=new z.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cachedDirection=new z.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._currentFaceIndex=0,this._currentFaceIndexCache=0,this._defaultTextureMatrix=z.a.Identity(),this._mapSize=D,this._light=w,this._scene=w.getScene(),w._shadowGenerator=this,e._SceneComponentInitialization(this._scene);var F=this._scene.getEngine().getCaps();N?F.textureFloatRender&&F.textureFloatLinearFiltering?this._textureType=ce.a.TEXTURETYPE_FLOAT:F.textureHalfFloatRender&&F.textureHalfFloatLinearFiltering?this._textureType=ce.a.TEXTURETYPE_HALF_FLOAT:this._textureType=ce.a.TEXTURETYPE_UNSIGNED_INT:F.textureHalfFloatRender&&F.textureHalfFloatLinearFiltering?this._textureType=ce.a.TEXTURETYPE_HALF_FLOAT:F.textureFloatRender&&F.textureFloatLinearFiltering?this._textureType=ce.a.TEXTURETYPE_FLOAT:this._textureType=ce.a.TEXTURETYPE_UNSIGNED_INT,this._initializeGenerator(),this._applyFilterValues()}return Object.defineProperty(e.prototype,"bias",{get:function(){return this._bias},set:function(D){this._bias=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"normalBias",{get:function(){return this._normalBias},set:function(D){this._normalBias=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blurBoxOffset",{get:function(){return this._blurBoxOffset},set:function(D){this._blurBoxOffset!==D&&(this._blurBoxOffset=D,this._disposeBlurPostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blurScale",{get:function(){return this._blurScale},set:function(D){this._blurScale!==D&&(this._blurScale=D,this._disposeBlurPostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blurKernel",{get:function(){return this._blurKernel},set:function(D){this._blurKernel!==D&&(this._blurKernel=D,this._disposeBlurPostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useKernelBlur",{get:function(){return this._useKernelBlur},set:function(D){this._useKernelBlur!==D&&(this._useKernelBlur=D,this._disposeBlurPostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthScale",{get:function(){return void 0!==this._depthScale?this._depthScale:this._light.getDepthScale()},set:function(D){this._depthScale=D},enumerable:!0,configurable:!0}),e.prototype._validateFilter=function(D){return D},Object.defineProperty(e.prototype,"filter",{get:function(){return this._filter},set:function(D){if(D=this._validateFilter(D),this._light.needCube()){if(D===e.FILTER_BLUREXPONENTIALSHADOWMAP)return void(this.useExponentialShadowMap=!0);if(D===e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP)return void(this.useCloseExponentialShadowMap=!0);if(D===e.FILTER_PCF||D===e.FILTER_PCSS)return void(this.usePoissonSampling=!0)}D!==e.FILTER_PCF&&D!==e.FILTER_PCSS||1!==this._scene.getEngine().webGLVersion?this._filter!==D&&(this._filter=D,this._disposeBlurPostProcesses(),this._applyFilterValues(),this._light._markMeshesAsLightDirty()):this.usePoissonSampling=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"usePoissonSampling",{get:function(){return this.filter===e.FILTER_POISSONSAMPLING},set:function(D){var w=this._validateFilter(e.FILTER_POISSONSAMPLING);(D||this.filter===e.FILTER_POISSONSAMPLING)&&(this.filter=D?w:e.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useExponentialShadowMap",{get:function(){return this.filter===e.FILTER_EXPONENTIALSHADOWMAP},set:function(D){var w=this._validateFilter(e.FILTER_EXPONENTIALSHADOWMAP);(D||this.filter===e.FILTER_EXPONENTIALSHADOWMAP)&&(this.filter=D?w:e.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useBlurExponentialShadowMap",{get:function(){return this.filter===e.FILTER_BLUREXPONENTIALSHADOWMAP},set:function(D){var w=this._validateFilter(e.FILTER_BLUREXPONENTIALSHADOWMAP);(D||this.filter===e.FILTER_BLUREXPONENTIALSHADOWMAP)&&(this.filter=D?w:e.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useCloseExponentialShadowMap",{get:function(){return this.filter===e.FILTER_CLOSEEXPONENTIALSHADOWMAP},set:function(D){var w=this._validateFilter(e.FILTER_CLOSEEXPONENTIALSHADOWMAP);(D||this.filter===e.FILTER_CLOSEEXPONENTIALSHADOWMAP)&&(this.filter=D?w:e.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useBlurCloseExponentialShadowMap",{get:function(){return this.filter===e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP},set:function(D){var w=this._validateFilter(e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP);(D||this.filter===e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP)&&(this.filter=D?w:e.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"usePercentageCloserFiltering",{get:function(){return this.filter===e.FILTER_PCF},set:function(D){var w=this._validateFilter(e.FILTER_PCF);(D||this.filter===e.FILTER_PCF)&&(this.filter=D?w:e.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"filteringQuality",{get:function(){return this._filteringQuality},set:function(D){this._filteringQuality!==D&&(this._filteringQuality=D,this._disposeBlurPostProcesses(),this._applyFilterValues(),this._light._markMeshesAsLightDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useContactHardeningShadow",{get:function(){return this.filter===e.FILTER_PCSS},set:function(D){var w=this._validateFilter(e.FILTER_PCSS);(D||this.filter===e.FILTER_PCSS)&&(this.filter=D?w:e.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contactHardeningLightSizeUVRatio",{get:function(){return this._contactHardeningLightSizeUVRatio},set:function(D){this._contactHardeningLightSizeUVRatio=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"darkness",{get:function(){return this._darkness},set:function(D){this.setDarkness(D)},enumerable:!0,configurable:!0}),e.prototype.getDarkness=function(){return this._darkness},e.prototype.setDarkness=function(D){return this._darkness=D>=1?1:D<=0?0:D,this},Object.defineProperty(e.prototype,"transparencyShadow",{get:function(){return this._transparencyShadow},set:function(D){this.setTransparencyShadow(D)},enumerable:!0,configurable:!0}),e.prototype.setTransparencyShadow=function(D){return this._transparencyShadow=D,this},e.prototype.getShadowMap=function(){return this._shadowMap},e.prototype.getShadowMapForRendering=function(){return this._shadowMap2?this._shadowMap2:this._shadowMap},e.prototype.getClassName=function(){return e.CLASSNAME},e.prototype.addShadowCaster=function(D,w){var N;return void 0===w&&(w=!0),this._shadowMap?(this._shadowMap.renderList||(this._shadowMap.renderList=[]),this._shadowMap.renderList.push(D),w&&(N=this._shadowMap.renderList).push.apply(N,D.getChildMeshes()),this):this},e.prototype.removeShadowCaster=function(D,w){if(void 0===w&&(w=!0),!this._shadowMap||!this._shadowMap.renderList)return this;var N=this._shadowMap.renderList.indexOf(D);if(-1!==N&&this._shadowMap.renderList.splice(N,1),w)for(var F=0,k=D.getChildren();F<k.length;F++){var j=k[F];this.removeShadowCaster(j)}return this},e.prototype.getLight=function(){return this._light},e.prototype._initializeGenerator=function(){this._light._markMeshesAsLightDirty(),this._initializeShadowMap()},e.prototype._createTargetRenderTexture=function(){this._scene.getEngine().webGLVersion>1?(this._shadowMap=new Li(this._light.name+"_shadowMap",this._mapSize,this._scene,!1,!0,this._textureType,this._light.needCube(),void 0,!1,!1),this._shadowMap.createDepthStencilTexture(ce.a.LESS,!0)):this._shadowMap=new Li(this._light.name+"_shadowMap",this._mapSize,this._scene,!1,!0,this._textureType,this._light.needCube())},e.prototype._initializeShadowMap=function(){var D=this;if(this._createTargetRenderTexture(),null!==this._shadowMap){this._shadowMap.wrapU=Jt.a.CLAMP_ADDRESSMODE,this._shadowMap.wrapV=Jt.a.CLAMP_ADDRESSMODE,this._shadowMap.anisotropicFilteringLevel=1,this._shadowMap.updateSamplingMode(Jt.a.BILINEAR_SAMPLINGMODE),this._shadowMap.renderParticles=!1,this._shadowMap.ignoreCameraViewport=!0,this._storedUniqueId&&(this._shadowMap.uniqueId=this._storedUniqueId),this._shadowMap.customRenderFunction=this._renderForShadowMap.bind(this);var w=this._scene.getEngine();this._shadowMap.onBeforeRenderObservable.add((function(N){D._currentFaceIndex=N,D._filter===e.FILTER_PCF&&w.setColorWrite(!1)})),this._shadowMap.onAfterUnbindObservable.add((function(){if(D._filter===e.FILTER_PCF&&w.setColorWrite(!0),D.useBlurExponentialShadowMap||D.useBlurCloseExponentialShadowMap){var N=D.getShadowMapForRendering();N&&D._scene.postProcessManager.directRender(D._blurPostProcesses,N.getInternalTexture(),!0)}}));var N=new G.b(0,0,0,0),F=new G.b(1,1,1,1);this._shadowMap.onClearObservable.add((function(w){D._filter===e.FILTER_PCF?w.clear(F,!1,!0,!1):D.useExponentialShadowMap||D.useBlurExponentialShadowMap?w.clear(N,!0,!0,!1):w.clear(F,!0,!0,!1)})),this._shadowMap.onResizeObservable.add((function(w){D._storedUniqueId=D._shadowMap.uniqueId,D._mapSize=w.getRenderSize(),D._light._markMeshesAsLightDirty(),D.recreateShadowMap()}));for(var k=Ii.b.MIN_RENDERINGGROUPS;k<Ii.b.MAX_RENDERINGGROUPS;k++)this._shadowMap.setRenderingAutoClearDepthStencil(k,!1)}},e.prototype._initializeBlurRTTAndPostProcesses=function(){var D=this,w=this._scene.getEngine(),N=this._mapSize/this.blurScale;this.useKernelBlur&&1===this.blurScale||(this._shadowMap2=new Li(this._light.name+"_shadowMap2",N,this._scene,!1,!0,this._textureType),this._shadowMap2.wrapU=Jt.a.CLAMP_ADDRESSMODE,this._shadowMap2.wrapV=Jt.a.CLAMP_ADDRESSMODE,this._shadowMap2.updateSamplingMode(Jt.a.BILINEAR_SAMPLINGMODE)),this.useKernelBlur?(this._kernelBlurXPostprocess=new Fo(this._light.name+"KernelBlurX",new z.d(1,0),this.blurKernel,1,null,Jt.a.BILINEAR_SAMPLINGMODE,w,!1,this._textureType),this._kernelBlurXPostprocess.width=N,this._kernelBlurXPostprocess.height=N,this._kernelBlurXPostprocess.onApplyObservable.add((function(w){w.setTexture("textureSampler",D._shadowMap)})),this._kernelBlurYPostprocess=new Fo(this._light.name+"KernelBlurY",new z.d(0,1),this.blurKernel,1,null,Jt.a.BILINEAR_SAMPLINGMODE,w,!1,this._textureType),this._kernelBlurXPostprocess.autoClear=!1,this._kernelBlurYPostprocess.autoClear=!1,this._textureType===ce.a.TEXTURETYPE_UNSIGNED_INT&&(this._kernelBlurXPostprocess.packedFloat=!0,this._kernelBlurYPostprocess.packedFloat=!0),this._blurPostProcesses=[this._kernelBlurXPostprocess,this._kernelBlurYPostprocess]):(this._boxBlurPostprocess=new fi(this._light.name+"DepthBoxBlur","depthBoxBlur",["screenSize","boxOffset"],[],1,null,Jt.a.BILINEAR_SAMPLINGMODE,w,!1,"#define OFFSET "+this._blurBoxOffset,this._textureType),this._boxBlurPostprocess.onApplyObservable.add((function(w){w.setFloat2("screenSize",N,N),w.setTexture("textureSampler",D._shadowMap)})),this._boxBlurPostprocess.autoClear=!1,this._blurPostProcesses=[this._boxBlurPostprocess])},e.prototype._renderForShadowMap=function(D,w,N,F){var k,j=this._scene.getEngine(),z=j.getColorWrite();if(F.length){for(j.setColorWrite(!1),k=0;k<F.length;k++)this._renderSubMeshForShadowMap(F.data[k]);j.setColorWrite(z)}for(k=0;k<D.length;k++)this._renderSubMeshForShadowMap(D.data[k]);for(k=0;k<w.length;k++)this._renderSubMeshForShadowMap(w.data[k]);if(this._transparencyShadow)for(k=0;k<N.length;k++)this._renderSubMeshForShadowMap(N.data[k])},e.prototype._bindCustomEffectForRenderSubMeshForShadowMap=function(D,w){},e.prototype._renderSubMeshForShadowMap=function(D){var w=this,N=D.getRenderingMesh(),F=this._scene,k=F.getEngine(),j=D.getMaterial();if(N._internalAbstractMeshDataInfo._isActiveIntermediate=!1,j&&0!==D.verticesCount){k.setState(j.backFaceCulling);var z=N._getInstancesRenderList(D._id);if(!z.mustReturn){var G=k.getCaps().instancedArrays&&null!==z.visibleInstances[D._id]&&void 0!==z.visibleInstances[D._id];if(this.isReady(D,G)){if(k.enableEffect(this._effect),N._bind(D,this._effect,j.fillMode),this._effect.setFloat3("biasAndScale",this.bias,this.normalBias,this.depthScale),this._effect.setMatrix("viewProjection",this.getTransformMatrix()),this.getLight().getTypeID()===Ro.a.LIGHTTYPEID_DIRECTIONALLIGHT?this._effect.setVector3("lightData",this._cachedDirection):this._effect.setVector3("lightData",this._cachedPosition),F.activeCamera&&this._effect.setFloat2("depthValues",this.getLight().getDepthMinZ(F.activeCamera),this.getLight().getDepthMinZ(F.activeCamera)+this.getLight().getDepthMaxZ(F.activeCamera)),j&&j.needAlphaTesting()){var H=j.getAlphaTestTexture();H&&(this._effect.setTexture("diffuseSampler",H),this._effect.setMatrix("diffuseMatrix",H.getTextureMatrix()||this._defaultTextureMatrix))}if(N.useBones&&N.computeBonesUsingShaders&&N.skeleton){var X=N.skeleton;if(X.isUsingTextureForMatrices){var q=X.getTransformMatrixTexture(N);if(!q)return;this._effect.setTexture("boneSampler",q),this._effect.setFloat("boneTextureWidth",4*(X.bones.length+1))}else this._effect.setMatrices("mBones",X.getTransformMatrices(N))}jo.a.BindMorphTargetParameters(N,this._effect),jo.a.BindClipPlane(this._effect,F),this._bindCustomEffectForRenderSubMeshForShadowMap(D,this._effect),this.forceBackFacesOnly&&k.setState(!0,0,!1,!0),this.onBeforeShadowMapRenderMeshObservable.notifyObservers(N),this.onBeforeShadowMapRenderObservable.notifyObservers(this._effect),N._processRendering(D,this._effect,j.fillMode,z,G,(function(D,N){return w._effect.setMatrix("world",N)})),this.forceBackFacesOnly&&k.setState(!0,0,!1,!1),this.onAfterShadowMapRenderObservable.notifyObservers(this._effect),this.onAfterShadowMapRenderMeshObservable.notifyObservers(N)}else this._shadowMap&&this._shadowMap.resetRefreshCounter()}}},e.prototype._applyFilterValues=function(){this._shadowMap&&(this.filter===e.FILTER_NONE||this.filter===e.FILTER_PCSS?this._shadowMap.updateSamplingMode(Jt.a.NEAREST_SAMPLINGMODE):this._shadowMap.updateSamplingMode(Jt.a.BILINEAR_SAMPLINGMODE))},e.prototype.forceCompilation=function(D,w){var N=this,F=Object(Z.a)({useInstances:!1},w),k=this.getShadowMap();if(k){var j=k.renderList;if(j){for(var z=new Array,G=0,H=j;G<H.length;G++){var X=H[G];z.push.apply(z,X.subMeshes)}if(0!==z.length){var q=0,d=function(){if(N._scene&&N._scene.getEngine()){for(;N.isReady(z[q],F.useInstances);)if(++q>=z.length)return void(D&&D(N));setTimeout(d,16)}};d()}else D&&D(this)}else D&&D(this)}else D&&D(this)},e.prototype.forceCompilationAsync=function(D){var w=this;return new Promise((function(N){w.forceCompilation((function(){N()}),D)}))},e.prototype._isReadyCustomDefines=function(D,w,N){},e.prototype.isReady=function(D,w){var N=[];this._textureType!==ce.a.TEXTURETYPE_UNSIGNED_INT&&N.push("#define FLOAT"),this.useExponentialShadowMap||this.useBlurExponentialShadowMap?N.push("#define ESM"):(this.usePercentageCloserFiltering||this.useContactHardeningShadow)&&N.push("#define DEPTHTEXTURE");var F=[Zi.b.PositionKind],k=D.getMesh(),j=D.getMaterial();if(this.normalBias&&k.isVerticesDataPresent(Zi.b.NormalKind)&&(F.push(Zi.b.NormalKind),N.push("#define NORMAL"),k.nonUniformScaling&&N.push("#define NONUNIFORMSCALING"),this.getLight().getTypeID()===Ro.a.LIGHTTYPEID_DIRECTIONALLIGHT&&N.push("#define DIRECTIONINLIGHTDATA")),j&&j.needAlphaTesting()){var z=j.getAlphaTestTexture();z&&(N.push("#define ALPHATEST"),k.isVerticesDataPresent(Zi.b.UVKind)&&(F.push(Zi.b.UVKind),N.push("#define UV1")),k.isVerticesDataPresent(Zi.b.UV2Kind)&&1===z.coordinatesIndex&&(F.push(Zi.b.UV2Kind),N.push("#define UV2")))}var G=new Wo.a;if(k.useBones&&k.computeBonesUsingShaders&&k.skeleton){F.push(Zi.b.MatricesIndicesKind),F.push(Zi.b.MatricesWeightsKind),k.numBoneInfluencers>4&&(F.push(Zi.b.MatricesIndicesExtraKind),F.push(Zi.b.MatricesWeightsExtraKind));var H=k.skeleton;N.push("#define NUM_BONE_INFLUENCERS "+k.numBoneInfluencers),k.numBoneInfluencers>0&&G.addCPUSkinningFallback(0,k),H.isUsingTextureForMatrices?N.push("#define BONETEXTURE"):N.push("#define BonesPerMesh "+(H.bones.length+1))}else N.push("#define NUM_BONE_INFLUENCERS 0");var X=k.morphTargetManager,q=0;X&&X.numInfluencers>0&&(N.push("#define MORPHTARGETS"),q=X.numInfluencers,N.push("#define NUM_MORPH_INFLUENCERS "+q),jo.a.PrepareAttributesForMorphTargetsInfluencers(F,k,q));var Z=this._scene;if(Z.clipPlane&&N.push("#define CLIPPLANE"),Z.clipPlane2&&N.push("#define CLIPPLANE2"),Z.clipPlane3&&N.push("#define CLIPPLANE3"),Z.clipPlane4&&N.push("#define CLIPPLANE4"),Z.clipPlane5&&N.push("#define CLIPPLANE5"),Z.clipPlane6&&N.push("#define CLIPPLANE6"),w&&(N.push("#define INSTANCES"),jo.a.PushAttributesForInstances(F)),this.customShaderOptions&&this.customShaderOptions.defines)for(var J=0,$=this.customShaderOptions.defines;J<$.length;J++){var te=$[J];-1===N.indexOf(te)&&N.push(te)}this._light.needCube()&&N.push("#define USEDISTANCE"),this._isReadyCustomDefines(N,D,w);var ie=N.join("\n");if(this._cachedDefines!==ie){this._cachedDefines=ie;var oe="shadowMap",he=["world","mBones","viewProjection","diffuseMatrix","lightData","depthValues","biasAndScale","morphTargetInfluences","boneTextureWidth","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6"],fe=["diffuseSampler","boneSampler"];if(this.customShaderOptions){if(oe=this.customShaderOptions.shaderName,this.customShaderOptions.attributes)for(var pe=0,_e=this.customShaderOptions.attributes;pe<_e.length;pe++){var ve=_e[pe];-1===F.indexOf(ve)&&F.push(ve)}if(this.customShaderOptions.uniforms)for(var ye=0,be=this.customShaderOptions.uniforms;ye<be.length;ye++){var Te=be[ye];-1===he.indexOf(Te)&&he.push(Te)}if(this.customShaderOptions.samplers)for(var Ee=0,Se=this.customShaderOptions.samplers;Ee<Se.length;Ee++){var Me=Se[Ee];-1===fe.indexOf(Me)&&fe.push(Me)}}this._effect=this._scene.getEngine().createEffect(oe,F,he,fe,ie,G,void 0,void 0,{maxSimultaneousMorphTargets:q})}return!(!this._effect.isReady()||((this.useBlurExponentialShadowMap||this.useBlurCloseExponentialShadowMap)&&(this._blurPostProcesses&&this._blurPostProcesses.length||this._initializeBlurRTTAndPostProcesses()),this._kernelBlurXPostprocess&&!this._kernelBlurXPostprocess.isReady()||this._kernelBlurYPostprocess&&!this._kernelBlurYPostprocess.isReady()||this._boxBlurPostprocess&&!this._boxBlurPostprocess.isReady()))},e.prototype.prepareDefines=function(D,w){var N=this._scene,F=this._light;N.shadowsEnabled&&F.shadowEnabled&&(D["SHADOW"+w]=!0,this.useContactHardeningShadow?(D["SHADOWPCSS"+w]=!0,this._filteringQuality===e.QUALITY_LOW?D["SHADOWLOWQUALITY"+w]=!0:this._filteringQuality===e.QUALITY_MEDIUM&&(D["SHADOWMEDIUMQUALITY"+w]=!0)):this.usePercentageCloserFiltering?(D["SHADOWPCF"+w]=!0,this._filteringQuality===e.QUALITY_LOW?D["SHADOWLOWQUALITY"+w]=!0:this._filteringQuality===e.QUALITY_MEDIUM&&(D["SHADOWMEDIUMQUALITY"+w]=!0)):this.usePoissonSampling?D["SHADOWPOISSON"+w]=!0:this.useExponentialShadowMap||this.useBlurExponentialShadowMap?D["SHADOWESM"+w]=!0:(this.useCloseExponentialShadowMap||this.useBlurCloseExponentialShadowMap)&&(D["SHADOWCLOSEESM"+w]=!0),F.needCube()&&(D["SHADOWCUBE"+w]=!0))},e.prototype.bindShadowLight=function(D,w){var N=this._light,F=this._scene;if(F.shadowsEnabled&&N.shadowEnabled){var k=F.activeCamera;if(k){var j=this.getShadowMap();j&&(N.needCube()||w.setMatrix("lightMatrix"+D,this.getTransformMatrix()),this._filter===e.FILTER_PCF?(w.setDepthStencilTexture("shadowSampler"+D,this.getShadowMapForRendering()),N._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),j.getSize().width,1/j.getSize().width,this.frustumEdgeFalloff,D)):this._filter===e.FILTER_PCSS?(w.setDepthStencilTexture("shadowSampler"+D,this.getShadowMapForRendering()),w.setTexture("depthSampler"+D,this.getShadowMapForRendering()),N._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),1/j.getSize().width,this._contactHardeningLightSizeUVRatio*j.getSize().width,this.frustumEdgeFalloff,D)):(w.setTexture("shadowSampler"+D,this.getShadowMapForRendering()),N._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),this.blurScale/j.getSize().width,this.depthScale,this.frustumEdgeFalloff,D)),N._uniformBuffer.updateFloat2("depthValues",this.getLight().getDepthMinZ(k),this.getLight().getDepthMinZ(k)+this.getLight().getDepthMaxZ(k),D))}}},e.prototype.getTransformMatrix=function(){var D=this._scene;if(this._currentRenderID===D.getRenderId()&&this._currentFaceIndexCache===this._currentFaceIndex)return this._transformMatrix;this._currentRenderID=D.getRenderId(),this._currentFaceIndexCache=this._currentFaceIndex;var w=this._light.position;if(this._light.computeTransformedInformation()&&(w=this._light.transformedPosition),z.e.NormalizeToRef(this._light.getShadowDirection(this._currentFaceIndex),this._lightDirection),1===Math.abs(z.e.Dot(this._lightDirection,z.e.Up()))&&(this._lightDirection.z=1e-13),this._light.needProjectionMatrixCompute()||!this._cachedPosition||!this._cachedDirection||!w.equals(this._cachedPosition)||!this._lightDirection.equals(this._cachedDirection)){this._cachedPosition.copyFrom(w),this._cachedDirection.copyFrom(this._lightDirection),z.a.LookAtLHToRef(w,w.add(this._lightDirection),z.e.Up(),this._viewMatrix);var N=this.getShadowMap();if(N){var F=N.renderList;F&&this._light.setShadowProjectionMatrix(this._projectionMatrix,this._viewMatrix,F)}this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix)}return this._transformMatrix},e.prototype.recreateShadowMap=function(){var D=this._shadowMap;if(D){var w=D.renderList;this._disposeRTTandPostProcesses(),this._initializeGenerator(),this.filter=this.filter,this._applyFilterValues(),this._shadowMap.renderList=w}},e.prototype._disposeBlurPostProcesses=function(){this._shadowMap2&&(this._shadowMap2.dispose(),this._shadowMap2=null),this._boxBlurPostprocess&&(this._boxBlurPostprocess.dispose(),this._boxBlurPostprocess=null),this._kernelBlurXPostprocess&&(this._kernelBlurXPostprocess.dispose(),this._kernelBlurXPostprocess=null),this._kernelBlurYPostprocess&&(this._kernelBlurYPostprocess.dispose(),this._kernelBlurYPostprocess=null),this._blurPostProcesses=[]},e.prototype._disposeRTTandPostProcesses=function(){this._shadowMap&&(this._shadowMap.dispose(),this._shadowMap=null),this._disposeBlurPostProcesses()},e.prototype.dispose=function(){this._disposeRTTandPostProcesses(),this._light&&(this._light._shadowGenerator=null,this._light._markMeshesAsLightDirty()),this.onBeforeShadowMapRenderMeshObservable.clear(),this.onBeforeShadowMapRenderObservable.clear(),this.onAfterShadowMapRenderMeshObservable.clear(),this.onAfterShadowMapRenderObservable.clear()},e.prototype.serialize=function(){var D={},w=this.getShadowMap();if(!w)return D;if(D.className=this.getClassName(),D.lightId=this._light.id,D.mapSize=w.getRenderSize(),D.forceBackFacesOnly=this.forceBackFacesOnly,D.darkness=this.getDarkness(),D.transparencyShadow=this._transparencyShadow,D.frustumEdgeFalloff=this.frustumEdgeFalloff,D.bias=this.bias,D.normalBias=this.normalBias,D.usePercentageCloserFiltering=this.usePercentageCloserFiltering,D.useContactHardeningShadow=this.useContactHardeningShadow,D.contactHardeningLightSizeUVRatio=this.contactHardeningLightSizeUVRatio,D.filteringQuality=this.filteringQuality,D.useExponentialShadowMap=this.useExponentialShadowMap,D.useBlurExponentialShadowMap=this.useBlurExponentialShadowMap,D.useCloseExponentialShadowMap=this.useBlurExponentialShadowMap,D.useBlurCloseExponentialShadowMap=this.useBlurExponentialShadowMap,D.usePoissonSampling=this.usePoissonSampling,D.depthScale=this.depthScale,D.blurBoxOffset=this.blurBoxOffset,D.blurKernel=this.blurKernel,D.blurScale=this.blurScale,D.useKernelBlur=this.useKernelBlur,D.renderList=[],w.renderList)for(var N=0;N<w.renderList.length;N++){var F=w.renderList[N];D.renderList.push(F.id)}return D},e.Parse=function(D,w,N){for(var F=w.getLightByID(D.lightId),k=N?N(D.mapSize,F):new e(D.mapSize,F),j=k.getShadowMap(),z=0;z<D.renderList.length;z++)w.getMeshesByID(D.renderList[z]).forEach((function(D){j&&(j.renderList||(j.renderList=[]),j.renderList.push(D))}));return k.forceBackFacesOnly=!!D.forceBackFacesOnly,void 0!==D.darkness&&k.setDarkness(D.darkness),D.transparencyShadow&&k.setTransparencyShadow(!0),void 0!==D.frustumEdgeFalloff&&(k.frustumEdgeFalloff=D.frustumEdgeFalloff),void 0!==D.bias&&(k.bias=D.bias),void 0!==D.normalBias&&(k.normalBias=D.normalBias),D.usePercentageCloserFiltering?k.usePercentageCloserFiltering=!0:D.useContactHardeningShadow?k.useContactHardeningShadow=!0:D.usePoissonSampling?k.usePoissonSampling=!0:D.useExponentialShadowMap?k.useExponentialShadowMap=!0:D.useBlurExponentialShadowMap?k.useBlurExponentialShadowMap=!0:D.useCloseExponentialShadowMap?k.useCloseExponentialShadowMap=!0:D.useBlurCloseExponentialShadowMap?k.useBlurCloseExponentialShadowMap=!0:D.useVarianceShadowMap?k.useExponentialShadowMap=!0:D.useBlurVarianceShadowMap&&(k.useBlurExponentialShadowMap=!0),void 0!==D.contactHardeningLightSizeUVRatio&&(k.contactHardeningLightSizeUVRatio=D.contactHardeningLightSizeUVRatio),void 0!==D.filteringQuality&&(k.filteringQuality=D.filteringQuality),D.depthScale&&(k.depthScale=D.depthScale),D.blurScale&&(k.blurScale=D.blurScale),D.blurBoxOffset&&(k.blurBoxOffset=D.blurBoxOffset),D.useKernelBlur&&(k.useKernelBlur=D.useKernelBlur),D.blurKernel&&(k.blurKernel=D.blurKernel),k},e.CLASSNAME="ShadowGenerator",e.FILTER_NONE=0,e.FILTER_EXPONENTIALSHADOWMAP=1,e.FILTER_POISSONSAMPLING=2,e.FILTER_BLUREXPONENTIALSHADOWMAP=3,e.FILTER_CLOSEEXPONENTIALSHADOWMAP=4,e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP=5,e.FILTER_PCF=6,e.FILTER_PCSS=7,e.QUALITY_HIGH=0,e.QUALITY_MEDIUM=1,e.QUALITY_LOW=2,e._SceneComponentInitialization=function(D){throw It.a.WarnImport("ShadowGeneratorSceneComponent")},e}();li.a.ShadersStore.depthPixelShader="#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\nvarying float vDepthMetric;\n#ifdef PACKED\n#include<packingFunctions>\n#endif\nvoid main(void)\n{\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\n#ifdef NONLINEARDEPTH\n#ifdef PACKED\ngl_FragColor=pack(gl_FragCoord.z);\n#else\ngl_FragColor=vec4(gl_FragCoord.z,0.0,0.0,0.0);\n#endif\n#else\n#ifdef PACKED\ngl_FragColor=pack(vDepthMetric);\n#else\ngl_FragColor=vec4(vDepthMetric,0.0,0.0,1.0);\n#endif\n#endif\n}",li.a.ShadersStore.depthVertexShader="\nattribute vec3 position;\n#include<bonesDeclaration>\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\nuniform vec2 depthValues;\n#if defined(ALPHATEST) || defined(NEED_UV)\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\nvarying float vDepthMetric;\nvoid main(void)\n{\nvec3 positionUpdated=position;\n#ifdef UV1\nvec2 uvUpdated=uv;\n#endif\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(positionUpdated,1.0);\nvDepthMetric=((gl_Position.z+depthValues.x)/(depthValues.y));\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n}\n";var Gs=function(){function e(D,w,N,F){var k=this;void 0===w&&(w=ce.a.TEXTURETYPE_FLOAT),void 0===N&&(N=null),void 0===F&&(F=!1),this.enabled=!0,this.useOnlyInActiveCamera=!1,this._scene=D,this._storeNonLinearDepth=F,this.isPacked=w===ce.a.TEXTURETYPE_UNSIGNED_BYTE,this.isPacked?this._clearColor=new G.b(1,1,1,1):this._clearColor=new G.b(1,0,0,1),e._SceneComponentInitialization(this._scene),this._camera=N;var j=D.getEngine(),z=this.isPacked||1===j.webGLVersion?ce.a.TEXTUREFORMAT_RGBA:ce.a.TEXTUREFORMAT_R;this._depthMap=new Li("depthMap",{width:j.getRenderWidth(),height:j.getRenderHeight()},this._scene,!1,!0,w,!1,void 0,void 0,void 0,void 0,z),this._depthMap.wrapU=Jt.a.CLAMP_ADDRESSMODE,this._depthMap.wrapV=Jt.a.CLAMP_ADDRESSMODE,this._depthMap.refreshRate=1,this._depthMap.renderParticles=!1,this._depthMap.renderList=null,this._depthMap.activeCamera=this._camera,this._depthMap.ignoreCameraViewport=!0,this._depthMap.useCameraPostProcesses=!1,this._depthMap.onClearObservable.add((function(D){D.clear(k._clearColor,!0,!0,!0)}));var l=function(D){var w=D.getRenderingMesh(),N=k._scene,F=N.getEngine(),j=D.getMaterial();if(w._internalAbstractMeshDataInfo._isActiveIntermediate=!1,j){F.setState(j.backFaceCulling,0,!1,N.useRightHandedSystem);var z=w._getInstancesRenderList(D._id);if(!z.mustReturn){var G=F.getCaps().instancedArrays&&null!==z.visibleInstances[D._id],H=k._camera||N.activeCamera;if(k.isReady(D,G)&&H){if(F.enableEffect(k._effect),w._bind(D,k._effect,j.fillMode),k._effect.setMatrix("viewProjection",N.getTransformMatrix()),k._effect.setFloat2("depthValues",H.minZ,H.minZ+H.maxZ),j&&j.needAlphaTesting()){var X=j.getAlphaTestTexture();X&&(k._effect.setTexture("diffuseSampler",X),k._effect.setMatrix("diffuseMatrix",X.getTextureMatrix()))}w.useBones&&w.computeBonesUsingShaders&&w.skeleton&&k._effect.setMatrices("mBones",w.skeleton.getTransformMatrices(w)),jo.a.BindMorphTargetParameters(w,k._effect),w._processRendering(D,k._effect,j.fillMode,z,G,(function(D,w){return k._effect.setMatrix("world",w)}))}}}};this._depthMap.customRenderFunction=function(D,w,N,F){var k;if(F.length){for(j.setColorWrite(!1),k=0;k<F.length;k++)l(F.data[k]);j.setColorWrite(!0)}for(k=0;k<D.length;k++)l(D.data[k]);for(k=0;k<w.length;k++)l(w.data[k])}}return e.prototype.isReady=function(D,w){var N=D.getMaterial();if(N.disableDepthWrite)return!1;var F=[],k=[Zi.b.PositionKind],j=D.getMesh();N&&N.needAlphaTesting()&&N.getAlphaTestTexture()&&(F.push("#define ALPHATEST"),j.isVerticesDataPresent(Zi.b.UVKind)&&(k.push(Zi.b.UVKind),F.push("#define UV1")),j.isVerticesDataPresent(Zi.b.UV2Kind)&&(k.push(Zi.b.UV2Kind),F.push("#define UV2"))),j.useBones&&j.computeBonesUsingShaders?(k.push(Zi.b.MatricesIndicesKind),k.push(Zi.b.MatricesWeightsKind),j.numBoneInfluencers>4&&(k.push(Zi.b.MatricesIndicesExtraKind),k.push(Zi.b.MatricesWeightsExtraKind)),F.push("#define NUM_BONE_INFLUENCERS "+j.numBoneInfluencers),F.push("#define BonesPerMesh "+(j.skeleton?j.skeleton.bones.length+1:0))):F.push("#define NUM_BONE_INFLUENCERS 0");var z=j.morphTargetManager,G=0;z&&z.numInfluencers>0&&(G=z.numInfluencers,F.push("#define MORPHTARGETS"),F.push("#define NUM_MORPH_INFLUENCERS "+G),jo.a.PrepareAttributesForMorphTargetsInfluencers(k,j,G)),w&&(F.push("#define INSTANCES"),jo.a.PushAttributesForInstances(k)),this._storeNonLinearDepth&&F.push("#define NONLINEARDEPTH"),this.isPacked&&F.push("#define PACKED");var H=F.join("\n");return this._cachedDefines!==H&&(this._cachedDefines=H,this._effect=this._scene.getEngine().createEffect("depth",k,["world","mBones","viewProjection","diffuseMatrix","depthValues","morphTargetInfluences"],["diffuseSampler"],H,void 0,void 0,void 0,{maxSimultaneousMorphTargets:G})),this._effect.isReady()},e.prototype.getDepthMap=function(){return this._depthMap},e.prototype.dispose=function(){this._depthMap.dispose()},e._SceneComponentInitialization=function(D){throw It.a.WarnImport("DepthRendererSceneComponent")},e}();li.a.ShadersStore.minmaxReduxPixelShader="attribute vec2 vUV;\nuniform sampler2D textureSampler;\n#if defined(INITIAL)\nuniform sampler2D sourceTexture;\nuniform vec2 texSize;\nvoid main(void)\n{\nivec2 coord=ivec2(vUV*(texSize-1.0));\nfloat f1=texelFetch(sourceTexture,coord,0).r;\nfloat f2=texelFetch(sourceTexture,coord+ivec2(1,0),0).r;\nfloat f3=texelFetch(sourceTexture,coord+ivec2(1,1),0).r;\nfloat f4=texelFetch(sourceTexture,coord+ivec2(0,1),0).r;\nfloat minz=min(min(min(f1,f2),f3),f4);\n#ifdef DEPTH_REDUX\nfloat maxz=max(max(max(sign(1.0-f1)*f1,sign(1.0-f2)*f2),sign(1.0-f3)*f3),sign(1.0-f4)*f4);\n#else\nfloat maxz=max(max(max(f1,f2),f3),f4);\n#endif\nglFragColor=vec4(minz,maxz,0.,0.);\n}\n#elif defined(MAIN)\nuniform vec2 texSize;\nvoid main(void)\n{\nivec2 coord=ivec2(vUV*(texSize-1.0));\nvec2 f1=texelFetch(textureSampler,coord,0).rg;\nvec2 f2=texelFetch(textureSampler,coord+ivec2(1,0),0).rg;\nvec2 f3=texelFetch(textureSampler,coord+ivec2(1,1),0).rg;\nvec2 f4=texelFetch(textureSampler,coord+ivec2(0,1),0).rg;\nfloat minz=min(min(min(f1.x,f2.x),f3.x),f4.x);\nfloat maxz=max(max(max(f1.y,f2.y),f3.y),f4.y);\nglFragColor=vec4(minz,maxz,0.,0.);\n}\n#elif defined(ONEBEFORELAST)\nuniform ivec2 texSize;\nvoid main(void)\n{\nivec2 coord=ivec2(vUV*vec2(texSize-1));\nvec2 f1=texelFetch(textureSampler,coord % texSize,0).rg;\nvec2 f2=texelFetch(textureSampler,(coord+ivec2(1,0)) % texSize,0).rg;\nvec2 f3=texelFetch(textureSampler,(coord+ivec2(1,1)) % texSize,0).rg;\nvec2 f4=texelFetch(textureSampler,(coord+ivec2(0,1)) % texSize,0).rg;\nfloat minz=min(f1.x,f2.x);\nfloat maxz=max(f1.y,f2.y);\nglFragColor=vec4(minz,maxz,0.,0.);\n}\n#elif defined(LAST)\nvoid main(void)\n{\ndiscard;\nglFragColor=vec4(0.);\n}\n#endif\n";var Ys=function(){function e(D){this.onAfterReductionPerformed=new j.c,this._forceFullscreenViewport=!0,this._activated=!1,this._camera=D,this._postProcessManager=new Di.a(D.getScene())}return Object.defineProperty(e.prototype,"sourceTexture",{get:function(){return this._sourceTexture},enumerable:!0,configurable:!0}),e.prototype.setSourceTexture=function(D,w,N,F){var k=this;if(void 0===N&&(N=ce.a.TEXTURETYPE_HALF_FLOAT),void 0===F&&(F=!0),D!==this._sourceTexture){this.dispose(!1),this._sourceTexture=D,this._reductionSteps=[],this._forceFullscreenViewport=F;var j=this._camera.getScene(),z=new fi("Initial reduction phase","minmaxRedux",["texSize"],["sourceTexture"],1,null,ce.a.TEXTURE_NEAREST_NEAREST,j.getEngine(),!1,"#define INITIAL"+(w?"\n#define DEPTH_REDUX":""),N,void 0,void 0,void 0,ce.a.TEXTUREFORMAT_RG);z.autoClear=!1,z.forceFullscreenViewport=F;var G=this._sourceTexture.getRenderWidth(),H=this._sourceTexture.getRenderHeight();z.onApply=function(D,w){return function(N){N.setTexture("sourceTexture",k._sourceTexture),N.setFloatArray2("texSize",new Float32Array([D,w]))}}(G,H),this._reductionSteps.push(z);for(var X=1;G>1||H>1;){G=Math.max(Math.round(G/2),1),H=Math.max(Math.round(H/2),1);var q=new fi("Reduction phase "+X,"minmaxRedux",["texSize"],null,{width:G,height:H},null,ce.a.TEXTURE_NEAREST_NEAREST,j.getEngine(),!1,"#define "+(1==G&&1==H?"LAST":1==G||1==H?"ONEBEFORELAST":"MAIN"),N,void 0,void 0,void 0,ce.a.TEXTUREFORMAT_RG);q.autoClear=!1,q.forceFullscreenViewport=F,q.onApply=function(D,w){return function(N){1==D||1==w?N.setIntArray2("texSize",new Int32Array([D,w])):N.setFloatArray2("texSize",new Float32Array([D,w]))}}(G,H),this._reductionSteps.push(q),X++,1==G&&1==H&&q.onAfterRenderObservable.add(function(D,w,N){var F=new Float32Array(4*D*w),z={min:0,max:0};return function(){j.getEngine()._readTexturePixels(N.inputTexture,D,w,-1,0,F),z.min=F[0],z.max=F[1],k.onAfterReductionPerformed.notifyObservers(z)}}(G,H,q))}}},Object.defineProperty(e.prototype,"refreshRate",{get:function(){return this._sourceTexture?this._sourceTexture.refreshRate:-1},set:function(D){this._sourceTexture&&(this._sourceTexture.refreshRate=D)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activated",{get:function(){return this._activated},enumerable:!0,configurable:!0}),e.prototype.activate=function(){var D=this;!this._onAfterUnbindObserver&&this._sourceTexture&&(this._onAfterUnbindObserver=this._sourceTexture.onAfterUnbindObservable.add((function(){D._reductionSteps[0].activate(D._camera),D._postProcessManager.directRender(D._reductionSteps,D._reductionSteps[0].inputTexture,D._forceFullscreenViewport),D._camera.getScene().getEngine().unBindFramebuffer(D._reductionSteps[0].inputTexture,!1)})),this._activated=!0)},e.prototype.deactivate=function(){this._onAfterUnbindObserver&&this._sourceTexture&&(this._sourceTexture.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=null,this._activated=!1)},e.prototype.dispose=function(D){if(void 0===D&&(D=!0),D&&this.onAfterReductionPerformed.clear(),this.deactivate(),this._reductionSteps){for(var w=0;w<this._reductionSteps.length;++w)this._reductionSteps[w].dispose();this._reductionSteps=null}this._postProcessManager&&D&&this._postProcessManager.dispose(),this._sourceTexture=null},e}(),Ws=function(D){function t(w){return D.call(this,w)||this}return Object(Z.d)(t,D),Object.defineProperty(t.prototype,"depthRenderer",{get:function(){return this._depthRenderer},enumerable:!0,configurable:!0}),t.prototype.setDepthRenderer=function(w,N,F){void 0===w&&(w=null),void 0===N&&(N=ce.a.TEXTURETYPE_HALF_FLOAT),void 0===F&&(F=!0);var k=this._camera.getScene();this._depthRenderer&&(delete k._depthRenderer[this._depthRendererId],this._depthRenderer.dispose(),this._depthRenderer=null),null===w&&(k._depthRenderer||(k._depthRenderer={}),(w=this._depthRenderer=new Gs(k,N,this._camera,!1)).enabled=!1,this._depthRendererId="minmax"+this._camera.id,k._depthRenderer[this._depthRendererId]=w),D.prototype.setSourceTexture.call(this,w.getDepthMap(),!0,N,F)},t.prototype.setSourceTexture=function(w,N,F,k){void 0===F&&(F=ce.a.TEXTURETYPE_HALF_FLOAT),void 0===k&&(k=!0),D.prototype.setSourceTexture.call(this,w,N,F,k)},t.prototype.activate=function(){this._depthRenderer&&(this._depthRenderer.enabled=!0),D.prototype.activate.call(this)},t.prototype.deactivate=function(){D.prototype.deactivate.call(this),this._depthRenderer&&(this._depthRenderer.enabled=!1)},t.prototype.dispose=function(w){var N;void 0===w&&(w=!0),D.prototype.dispose.call(this,w),this._depthRenderer&&w&&(null===(N=this._depthRenderer.getDepthMap().getScene())||void 0===N||N._depthRenderer[this._depthRendererId],this._depthRenderer.dispose(),this._depthRenderer=null)},t}(Ys),Xs=z.e.Up(),Qs=z.e.Zero(),qs=new z.e,Zs=new z.e,Js=new z.a,$s=function(D){function t(w,N,F){var k=D.call(this,w,N,F)||this;if(1==k._scene.getEngine().webGLVersion)throw"CSM can only be used in WebGL2";return k.usePercentageCloserFiltering=!0,k}return Object(Z.d)(t,D),t.prototype._validateFilter=function(D){return D===zs.FILTER_NONE||D===zs.FILTER_PCF||D===zs.FILTER_PCSS?D:(console.error('Unsupported filter "'+D+'"!'),zs.FILTER_NONE)},Object.defineProperty(t.prototype,"numCascades",{get:function(){return this._numCascades},set:function(D){(D=Math.min(Math.max(D,t.MIN_CASCADES_COUNT),t.MAX_CASCADES_COUNT))!==this._numCascades&&(this._numCascades=D,this.recreateShadowMap())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"freezeShadowCastersBoundingInfo",{get:function(){return this._freezeShadowCastersBoundingInfo},set:function(D){this._freezeShadowCastersBoundingInfoObservable&&D&&(this._scene.onBeforeRenderObservable.remove(this._freezeShadowCastersBoundingInfoObservable),this._freezeShadowCastersBoundingInfoObservable=null),this._freezeShadowCastersBoundingInfoObservable||D||(this._freezeShadowCastersBoundingInfoObservable=this._scene.onBeforeRenderObservable.add(this._computeShadowCastersBoundingInfo.bind(this))),this._freezeShadowCastersBoundingInfo=D,D&&this._computeShadowCastersBoundingInfo()},enumerable:!0,configurable:!0}),t.prototype._computeShadowCastersBoundingInfo=function(){if(this._scbiMin.copyFromFloats(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._scbiMax.copyFromFloats(Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE),this._shadowMap&&this._shadowMap.renderList){for(var D=this._shadowMap.renderList,w=0;w<D.length;w++)if(k=D[w]){var N=k.getBoundingInfo().boundingBox;this._scbiMin.minimizeInPlace(N.minimumWorld),this._scbiMax.maximizeInPlace(N.maximumWorld)}var F=this._scene.meshes;for(w=0;w<F.length;w++){var k;(k=F[w])&&k.isVisible&&k.isEnabled&&k.receiveShadows&&(N=k.getBoundingInfo().boundingBox,this._scbiMin.minimizeInPlace(N.minimumWorld),this._scbiMax.maximizeInPlace(N.maximumWorld))}}this._shadowCastersBoundingInfo.reConstruct(this._scbiMin,this._scbiMax)},Object.defineProperty(t.prototype,"shadowCastersBoundingInfo",{get:function(){return this._shadowCastersBoundingInfo},set:function(D){this._shadowCastersBoundingInfo=D},enumerable:!0,configurable:!0}),t.prototype.setMinMaxDistance=function(D,w){this._minDistance===D&&this._maxDistance===w||(D>w&&(D=0,w=1),D<0&&(D=0),w>1&&(w=1),this._minDistance=D,this._maxDistance=w,this._breaksAreDirty=!0)},Object.defineProperty(t.prototype,"minDistance",{get:function(){return this._minDistance},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxDistance",{get:function(){return this._maxDistance},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return t.CLASSNAME},t.prototype.getCascadeMinExtents=function(D){return D>=0&&D<this._numCascades?this._cascadeMinExtents[D]:null},t.prototype.getCascadeMaxExtents=function(D){return D>=0&&D<this._numCascades?this._cascadeMaxExtents[D]:null},Object.defineProperty(t.prototype,"shadowMaxZ",{get:function(){return this._scene&&this._scene.activeCamera?this._shadowMaxZ:0},set:function(D){this._scene&&this._scene.activeCamera?this._shadowMaxZ===D||D<this._scene.activeCamera.minZ||D>this._scene.activeCamera.maxZ||(this._shadowMaxZ=D,this._light._markMeshesAsLightDirty(),this._breaksAreDirty=!0):this._shadowMaxZ=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"debug",{get:function(){return this._debug},set:function(D){this._debug=D,this._light._markMeshesAsLightDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"depthClamp",{get:function(){return this._depthClamp},set:function(D){this._depthClamp=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cascadeBlendPercentage",{get:function(){return this._cascadeBlendPercentage},set:function(D){this._cascadeBlendPercentage=D,this._light._markMeshesAsLightDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lambda",{get:function(){return this._lambda},set:function(D){var w=Math.min(Math.max(D,0),1);this._lambda!=w&&(this._lambda=w,this._breaksAreDirty=!0)},enumerable:!0,configurable:!0}),t.prototype.getCascadeViewMatrix=function(D){return D>=0&&D<this._numCascades?this._viewMatrices[D]:null},t.prototype.getCascadeProjectionMatrix=function(D){return D>=0&&D<this._numCascades?this._projectionMatrices[D]:null},t.prototype.getCascadeTransformMatrix=function(D){return D>=0&&D<this._numCascades?this._transformMatrices[D]:null},t.prototype.setDepthRenderer=function(D){this._depthRenderer=D,this._depthReducer&&this._depthReducer.setDepthRenderer(this._depthRenderer)},Object.defineProperty(t.prototype,"autoCalcDepthBounds",{get:function(){return this._autoCalcDepthBounds},set:function(D){var w=this,N=this._scene.activeCamera;if(N){if(this._autoCalcDepthBounds=D,!D)return this._depthReducer&&this._depthReducer.deactivate(),void this.setMinMaxDistance(0,1);this._depthReducer||(this._depthReducer=new Ws(N),this._depthReducer.onAfterReductionPerformed.add((function(D){var N=D.min,F=D.max;N>=F&&(N=0,F=1),N==w._minDistance&&F==w._maxDistance||w.setMinMaxDistance(N,F)})),this._depthReducer.setDepthRenderer(this._depthRenderer)),this._depthReducer.activate()}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"autoCalcDepthBoundsRefreshRate",{get:function(){var D,w,N;return null!=(N=null===(w=null===(D=this._depthReducer)||void 0===D?void 0:D.depthRenderer)||void 0===w?void 0:w.getDepthMap().refreshRate)?N:-1},set:function(D){var w;(null===(w=this._depthReducer)||void 0===w?void 0:w.depthRenderer)&&(this._depthReducer.depthRenderer.getDepthMap().refreshRate=D)},enumerable:!0,configurable:!0}),t.prototype.splitFrustum=function(){this._breaksAreDirty=!0},t.prototype._splitFrustum=function(){var D=this._scene.activeCamera;if(D){for(var w=D.minZ,N=D.maxZ,F=N-w,k=this._minDistance,j=w+k*F,z=w+(this._shadowMaxZ<N&&this._shadowMaxZ>=w?Math.min((this._shadowMaxZ-w)/(N-w),this._maxDistance):this._maxDistance)*F,G=z-j,H=z/j,X=0;X<this._cascades.length;++X){var q=(X+1)/this._numCascades,Z=j*Math.pow(H,q),J=j+G*q,$=this._lambda*(Z-J)+J;this._cascades[X].prevBreakDistance=0===X?k:this._cascades[X-1].breakDistance,this._cascades[X].breakDistance=($-w)/F,this._viewSpaceFrustumsZ[X]=w+this._cascades[X].breakDistance*F,this._frustumLengths[X]=(this._cascades[X].breakDistance-this._cascades[X].prevBreakDistance)*F}this._breaksAreDirty=!1}},t.prototype._computeMatrices=function(){if(this._scene.activeCamera){z.e.NormalizeToRef(this._light.getShadowDirection(0),this._lightDirection),1===Math.abs(z.e.Dot(this._lightDirection,z.e.Up()))&&(this._lightDirection.z=1e-13),this._cachedDirection.copyFrom(this._lightDirection);for(var D=0;D<this._numCascades;++D){this._computeFrustumInWorldSpace(D),this._computeCascadeFrustum(D),this._cascadeMaxExtents[D].subtractToRef(this._cascadeMinExtents[D],qs),this._frustumCenter[D].addToRef(this._lightDirection.scale(this._cascadeMinExtents[D].z),this._shadowCameraPos[D]),z.a.LookAtLHToRef(this._shadowCameraPos[D],this._frustumCenter[D],Xs,this._viewMatrices[D]);var w=0,N=qs.z,F=this._shadowCastersBoundingInfo;F.update(this._viewMatrices[D]),N=Math.min(N,F.boundingBox.maximumWorld.z),w=this._depthClamp&&this.filter!==zs.FILTER_PCSS?Math.max(w,F.boundingBox.minimumWorld.z):Math.min(w,F.boundingBox.minimumWorld.z),z.a.OrthoOffCenterLHToRef(this._cascadeMinExtents[D].x,this._cascadeMaxExtents[D].x,this._cascadeMinExtents[D].y,this._cascadeMaxExtents[D].y,w,N,this._projectionMatrices[D]),this._cascadeMinExtents[D].z=w,this._cascadeMaxExtents[D].z=N,this._viewMatrices[D].multiplyToRef(this._projectionMatrices[D],this._transformMatrices[D]),z.e.TransformCoordinatesToRef(Qs,this._transformMatrices[D],qs),qs.scaleInPlace(this._mapSize/2),Zs.copyFromFloats(Math.round(qs.x),Math.round(qs.y),Math.round(qs.z)),Zs.subtractInPlace(qs).scaleInPlace(2/this._mapSize),z.a.TranslationToRef(Zs.x,Zs.y,0,Js),this._projectionMatrices[D].multiplyToRef(Js,this._projectionMatrices[D]),this._viewMatrices[D].multiplyToRef(this._projectionMatrices[D],this._transformMatrices[D]),this._transformMatrices[D].copyToArray(this._transformMatricesAsArray,16*D)}}},t.prototype._computeFrustumInWorldSpace=function(D){if(this._scene.activeCamera){var w=this._cascades[D].prevBreakDistance,N=this._cascades[D].breakDistance;this._scene.activeCamera.getViewMatrix();for(var F=z.a.Invert(this._scene.activeCamera.getTransformationMatrix()),k=0;k<t.frustumCornersNDCSpace.length;++k)z.e.TransformCoordinatesToRef(t.frustumCornersNDCSpace[k],F,this._frustumCornersWorldSpace[D][k]);for(k=0;k<t.frustumCornersNDCSpace.length/2;++k)qs.copyFrom(this._frustumCornersWorldSpace[D][k+4]).subtractInPlace(this._frustumCornersWorldSpace[D][k]),Zs.copyFrom(qs).scaleInPlace(w),qs.scaleInPlace(N),qs.addInPlace(this._frustumCornersWorldSpace[D][k]),this._frustumCornersWorldSpace[D][k+4].copyFrom(qs),this._frustumCornersWorldSpace[D][k].addInPlace(Zs)}},t.prototype._computeCascadeFrustum=function(D){if(this._cascadeMinExtents[D].copyFromFloats(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cascadeMaxExtents[D].copyFromFloats(Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE),this._frustumCenter[D].copyFromFloats(0,0,0),this._scene.activeCamera){for(var w=0;w<this._frustumCornersWorldSpace[D].length;++w)this._frustumCenter[D].addInPlace(this._frustumCornersWorldSpace[D][w]);if(this._frustumCenter[D].scaleInPlace(1/this._frustumCornersWorldSpace[D].length),this.stabilizeCascades){var N=0;for(w=0;w<this._frustumCornersWorldSpace[D].length;++w){var F=this._frustumCornersWorldSpace[D][w].subtractToRef(this._frustumCenter[D],qs).length();N=Math.max(N,F)}N=Math.ceil(16*N)/16,this._cascadeMaxExtents[D].copyFromFloats(N,N,N),this._cascadeMinExtents[D].copyFromFloats(-N,-N,-N)}else{var k=this._frustumCenter[D];for(this._frustumCenter[D].addToRef(this._lightDirection,qs),z.a.LookAtLHToRef(k,qs,Xs,Js),w=0;w<this._frustumCornersWorldSpace[D].length;++w)z.e.TransformCoordinatesToRef(this._frustumCornersWorldSpace[D][w],Js,qs),this._cascadeMinExtents[D].minimizeInPlace(qs),this._cascadeMaxExtents[D].maximizeInPlace(qs)}}},t.prototype._initializeGenerator=function(){var w,N,F,k,j,G,H,X,q,Z,J,$,te,ie,oe,ce,he,fe,pe,_e;this.penumbraDarkness=null!=(w=this.penumbraDarkness)?w:1,this._numCascades=null!=(N=this._numCascades)?N:t.DEFAULT_CASCADES_COUNT,this.stabilizeCascades=null!=(F=this.stabilizeCascades)&&F,this._freezeShadowCastersBoundingInfoObservable=null!=(k=this._freezeShadowCastersBoundingInfoObservable)?k:null,this.freezeShadowCastersBoundingInfo=null!=(j=this.freezeShadowCastersBoundingInfo)&&j,this._scbiMin=null!=(G=this._scbiMin)?G:new z.e(0,0,0),this._scbiMax=null!=(H=this._scbiMax)?H:new z.e(0,0,0),this._shadowCastersBoundingInfo=null!=(X=this._shadowCastersBoundingInfo)?X:new yr.a(new z.e(0,0,0),new z.e(0,0,0)),this._breaksAreDirty=null==(q=this._breaksAreDirty)||q,this._minDistance=null!=(Z=this._minDistance)?Z:0,this._maxDistance=null!=(J=this._maxDistance)?J:1,this._currentLayer=null!=($=this._currentLayer)?$:0,this._shadowMaxZ=null!=(oe=null!=(te=this._shadowMaxZ)?te:null===(ie=this._scene.activeCamera)||void 0===ie?void 0:ie.maxZ)?oe:1e4,this._debug=null!=(ce=this._debug)&&ce,this._depthClamp=null==(he=this._depthClamp)||he,this._cascadeBlendPercentage=null!=(fe=this._cascadeBlendPercentage)?fe:.1,this._lambda=null!=(pe=this._lambda)?pe:.5,this._autoCalcDepthBounds=null!=(_e=this._autoCalcDepthBounds)&&_e,D.prototype._initializeGenerator.call(this)},t.prototype._createTargetRenderTexture=function(){var D={width:this._mapSize,height:this._mapSize,layers:this.numCascades};this._shadowMap=new Li(this._light.name+"_shadowMap",D,this._scene,!1,!0,this._textureType,!1,void 0,!1,!1,void 0),this._shadowMap.createDepthStencilTexture(ce.a.LESS,!0)},t.prototype._initializeShadowMap=function(){var w=this;if(D.prototype._initializeShadowMap.call(this),null!==this._shadowMap){this._transformMatricesAsArray=new Float32Array(16*this._numCascades),this._viewSpaceFrustumsZ=new Array(this._numCascades),this._frustumLengths=new Array(this._numCascades),this._lightSizeUVCorrection=new Array(2*this._numCascades),this._depthCorrection=new Array(this._numCascades),this._cascades=[],this._viewMatrices=[],this._projectionMatrices=[],this._transformMatrices=[],this._cascadeMinExtents=[],this._cascadeMaxExtents=[],this._frustumCenter=[],this._shadowCameraPos=[],this._frustumCornersWorldSpace=[];for(var N=0;N<this._numCascades;++N){this._cascades[N]={prevBreakDistance:0,breakDistance:0},this._viewMatrices[N]=z.a.Zero(),this._projectionMatrices[N]=z.a.Zero(),this._transformMatrices[N]=z.a.Zero(),this._cascadeMinExtents[N]=new z.e,this._cascadeMaxExtents[N]=new z.e,this._frustumCenter[N]=new z.e,this._shadowCameraPos[N]=new z.e,this._frustumCornersWorldSpace[N]=new Array(t.frustumCornersNDCSpace.length);for(var F=0;F<t.frustumCornersNDCSpace.length;++F)this._frustumCornersWorldSpace[N][F]=new z.e}this._shadowMap.onBeforeRenderObservable.add((function(D){w._currentLayer=D})),this._shadowMap.onBeforeBindObservable.add((function(){w._breaksAreDirty&&w._splitFrustum(),w._computeMatrices()})),this._splitFrustum()}},t.prototype._bindCustomEffectForRenderSubMeshForShadowMap=function(D,w){w.setMatrix("viewProjection",this.getCascadeTransformMatrix(this._currentLayer))},t.prototype._isReadyCustomDefines=function(D,w,N){this._depthClamp&&this._filter!==zs.FILTER_PCSS&&D.push("#define DEPTHCLAMP")},t.prototype.prepareDefines=function(w,N){D.prototype.prepareDefines.call(this,w,N);var F=this._scene,k=this._light;if(F.shadowsEnabled&&k.shadowEnabled){w["SHADOWCSM"+N]=!0,w["SHADOWCSMDEBUG"+N]=this.debug,w["SHADOWCSMNUM_CASCADES"+N]=this.numCascades,w["SHADOWCSM_RIGHTHANDED"+N]=F.useRightHandedSystem;var j=F.activeCamera;j&&this._shadowMaxZ<j.maxZ&&(w["SHADOWCSMUSESHADOWMAXZ"+N]=!0),0===this.cascadeBlendPercentage&&(w["SHADOWCSMNOBLEND"+N]=!0)}},t.prototype.bindShadowLight=function(D,w){var N=this._light,F=this._scene;if(F.shadowsEnabled&&N.shadowEnabled){var k=F.activeCamera;if(k){var j=this.getShadowMap();if(j){var z=j.getSize().width;if(w.setMatrices("lightMatrix"+D,this._transformMatricesAsArray),w.setArray("viewFrustumZ"+D,this._viewSpaceFrustumsZ),w.setFloat("cascadeBlendFactor"+D,0===this.cascadeBlendPercentage?1e4:1/this.cascadeBlendPercentage),w.setArray("frustumLengths"+D,this._frustumLengths),this._filter===zs.FILTER_PCF)w.setDepthStencilTexture("shadowSampler"+D,j),N._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),z,1/z,this.frustumEdgeFalloff,D);else if(this._filter===zs.FILTER_PCSS){for(var G=0;G<this._numCascades;++G)this._lightSizeUVCorrection[2*G+0]=0===G?1:(this._cascadeMaxExtents[0].x-this._cascadeMinExtents[0].x)/(this._cascadeMaxExtents[G].x-this._cascadeMinExtents[G].x),this._lightSizeUVCorrection[2*G+1]=0===G?1:(this._cascadeMaxExtents[0].y-this._cascadeMinExtents[0].y)/(this._cascadeMaxExtents[G].y-this._cascadeMinExtents[G].y),this._depthCorrection[G]=0===G?1:(this._cascadeMaxExtents[G].z-this._cascadeMinExtents[G].z)/(this._cascadeMaxExtents[0].z-this._cascadeMinExtents[0].z);w.setDepthStencilTexture("shadowSampler"+D,j),w.setTexture("depthSampler"+D,j),w.setArray2("lightSizeUVCorrection"+D,this._lightSizeUVCorrection),w.setArray("depthCorrection"+D,this._depthCorrection),w.setFloat("penumbraDarkness"+D,this.penumbraDarkness),N._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),1/z,this._contactHardeningLightSizeUVRatio*z,this.frustumEdgeFalloff,D)}else w.setTexture("shadowSampler"+D,j),N._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),z,1/z,this.frustumEdgeFalloff,D);N._uniformBuffer.updateFloat2("depthValues",this.getLight().getDepthMinZ(k),this.getLight().getDepthMinZ(k)+this.getLight().getDepthMaxZ(k),D)}}}},t.prototype.getTransformMatrix=function(){return this.getCascadeTransformMatrix(0)},t.prototype.dispose=function(){D.prototype.dispose.call(this),this._freezeShadowCastersBoundingInfoObservable&&(this._scene.onBeforeRenderObservable.remove(this._freezeShadowCastersBoundingInfoObservable),this._freezeShadowCastersBoundingInfoObservable=null),this._depthReducer&&(this._depthReducer.dispose(),this._depthReducer=null)},t.prototype.serialize=function(){var w=D.prototype.serialize.call(this),N=this.getShadowMap();if(!N)return w;if(w.numCascades=this._numCascades,w.debug=this._debug,w.stabilizeCascades=this.stabilizeCascades,w.lambda=this._lambda,w.cascadeBlendPercentage=this.cascadeBlendPercentage,w.depthClamp=this._depthClamp,w.autoCalcDepthBounds=this.autoCalcDepthBounds,w.shadowMaxZ=this._shadowMaxZ,w.penumbraDarkness=this.penumbraDarkness,w.freezeShadowCastersBoundingInfo=this._freezeShadowCastersBoundingInfo,w.minDistance=this.minDistance,w.maxDistance=this.maxDistance,w.renderList=[],N.renderList)for(var F=0;F<N.renderList.length;F++){var k=N.renderList[F];w.renderList.push(k.id)}return w},t.Parse=function(D,w){var N=zs.Parse(D,w,(function(D,w){return new t(D,w)}));return void 0!==D.numCascades&&(N.numCascades=D.numCascades),void 0!==D.debug&&(N.debug=D.debug),void 0!==D.stabilizeCascades&&(N.stabilizeCascades=D.stabilizeCascades),void 0!==D.lambda&&(N.lambda=D.lambda),void 0!==D.cascadeBlendPercentage&&(N.cascadeBlendPercentage=D.cascadeBlendPercentage),void 0!==D.depthClamp&&(N.depthClamp=D.depthClamp),void 0!==D.autoCalcDepthBounds&&(N.autoCalcDepthBounds=D.autoCalcDepthBounds),void 0!==D.shadowMaxZ&&(N.shadowMaxZ=D.shadowMaxZ),void 0!==D.penumbraDarkness&&(N.penumbraDarkness=D.penumbraDarkness),void 0!==D.freezeShadowCastersBoundingInfo&&(N.freezeShadowCastersBoundingInfo=D.freezeShadowCastersBoundingInfo),void 0!==D.minDistance&&void 0!==D.maxDistance&&N.setMinMaxDistance(D.minDistance,D.maxDistance),N},t.frustumCornersNDCSpace=[new z.e(-1,1,-1),new z.e(1,1,-1),new z.e(1,-1,-1),new z.e(-1,-1,-1),new z.e(-1,1,1),new z.e(1,1,1),new z.e(1,-1,1),new z.e(-1,-1,1)],t.CLASSNAME="CascadedShadowGenerator",t.DEFAULT_CASCADES_COUNT=4,t.MIN_CASCADES_COUNT=2,t.MAX_CASCADES_COUNT=4,t._SceneComponentInitialization=function(D){throw It.a.WarnImport("ShadowGeneratorSceneComponent")},t}(zs);F.a.AddParser(Nt.a.NAME_SHADOWGENERATOR,(function(D,w){if(void 0!==D.shadowGenerators&&null!==D.shadowGenerators)for(var N=0,F=D.shadowGenerators.length;N<F;N++){var k=D.shadowGenerators[N];k.className===$s.CLASSNAME?$s.Parse(k,w):zs.Parse(k,w)}}));var ec=function(){function e(D){this.name=Nt.a.NAME_SHADOWGENERATOR,this.scene=D}return e.prototype.register=function(){this.scene._gatherRenderTargetsStage.registerStep(Nt.a.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR,this,this._gatherRenderTargets)},e.prototype.rebuild=function(){},e.prototype.serialize=function(D){D.shadowGenerators=[];for(var w=0,N=this.scene.lights;w<N.length;w++){var F=N[w].getShadowGenerator();F&&D.shadowGenerators.push(F.serialize())}},e.prototype.addFromContainer=function(D){},e.prototype.removeFromContainer=function(D,w){},e.prototype.dispose=function(){},e.prototype._gatherRenderTargets=function(D){var w=this.scene;if(this.scene.shadowsEnabled)for(var N=0;N<w.lights.length;N++){var F=w.lights[N],k=F.getShadowGenerator();if(F.isEnabled()&&F.shadowEnabled&&k){var j=k.getShadowMap();-1!==w.textures.indexOf(j)&&D.push(j)}}},e}();zs._SceneComponentInitialization=function(D){var w=D._getComponent(Nt.a.NAME_SHADOWGENERATOR);w||(w=new ec(D),D._addComponent(w))},we.a.AddNodeConstructor("Light_Type_0",(function(D,w){return function(){return new tc(D,z.e.Zero(),w)}}));var tc=function(D){function t(w,N,F){var k=D.call(this,w,F)||this;return k._shadowAngle=Math.PI/2,k.position=N,k}return Object(Z.d)(t,D),Object.defineProperty(t.prototype,"shadowAngle",{get:function(){return this._shadowAngle},set:function(D){this._shadowAngle=D,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"direction",{get:function(){return this._direction},set:function(D){var w=this.needCube();this._direction=D,this.needCube()!==w&&this._shadowGenerator&&this._shadowGenerator.recreateShadowMap()},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"PointLight"},t.prototype.getTypeID=function(){return Ro.a.LIGHTTYPEID_POINTLIGHT},t.prototype.needCube=function(){return!this.direction},t.prototype.getShadowDirection=function(w){if(this.direction)return D.prototype.getShadowDirection.call(this,w);switch(w){case 0:return new z.e(1,0,0);case 1:return new z.e(-1,0,0);case 2:return new z.e(0,-1,0);case 3:return new z.e(0,1,0);case 4:return new z.e(0,0,1);case 5:return new z.e(0,0,-1)}return z.e.Zero()},t.prototype._setDefaultShadowProjectionMatrix=function(D,w,N){var F=this.getScene().activeCamera;F&&z.a.PerspectiveFovLHToRef(this.shadowAngle,1,this.getDepthMinZ(F),this.getDepthMaxZ(F),D)},t.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},t.prototype.transferToEffect=function(D,w){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,w):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,w),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,w),this},t.prototype.transferToNodeMaterialEffect=function(D,w){return this.computeTransformedInformation()?D.setFloat3(w,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):D.setFloat3(w,this.position.x,this.position.y,this.position.z),this},t.prototype.prepareLightSpecificDefines=function(D,w){D["POINTLIGHT"+w]=!0},Object(Z.c)([Object(Ie.c)()],t.prototype,"shadowAngle",null),t}(Do),nc=function(){function e(D,w,N){var F=this;void 0===w&&(w=""),void 0===N&&(N="black"),this._renderingCanvas=D,this._loadingText=w,this._loadingDivBackgroundColor=N,this._resizeLoadingUI=function(){var D=F._renderingCanvas.getBoundingClientRect(),w=window.getComputedStyle(F._renderingCanvas).position;F._loadingDiv&&(F._loadingDiv.style.position="fixed"===w?"fixed":"absolute",F._loadingDiv.style.left=D.left+"px",F._loadingDiv.style.top=D.top+"px",F._loadingDiv.style.width=D.width+"px",F._loadingDiv.style.height=D.height+"px")}}return e.prototype.displayLoadingUI=function(){if(!this._loadingDiv){this._loadingDiv=document.createElement("div"),this._loadingDiv.id="babylonjsLoadingDiv",this._loadingDiv.style.opacity="0",this._loadingDiv.style.transition="opacity 1.5s ease",this._loadingDiv.style.pointerEvents="none",this._loadingTextDiv=document.createElement("div"),this._loadingTextDiv.style.position="absolute",this._loadingTextDiv.style.left="0",this._loadingTextDiv.style.top="50%",this._loadingTextDiv.style.marginTop="80px",this._loadingTextDiv.style.width="100%",this._loadingTextDiv.style.height="20px",this._loadingTextDiv.style.fontFamily="Arial",this._loadingTextDiv.style.fontSize="14px",this._loadingTextDiv.style.color="white",this._loadingTextDiv.style.textAlign="center",this._loadingTextDiv.innerHTML="Loading",this._loadingDiv.appendChild(this._loadingTextDiv),this._loadingTextDiv.innerHTML=this._loadingText;var D=document.createElement("style");D.type="text/css",D.innerHTML="@-webkit-keyframes spin1 {                    0% { -webkit-transform: rotate(0deg);}\n                    100% { -webkit-transform: rotate(360deg);}\n                }                @keyframes spin1 {                    0% { transform: rotate(0deg);}\n                    100% { transform: rotate(360deg);}\n                }",document.getElementsByTagName("head")[0].appendChild(D);var w=!!window.SVGSVGElement,N=new Image;e.DefaultLogoUrl?N.src=e.DefaultLogoUrl:N.src=w?"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxODAuMTcgMjA4LjA0Ij48ZGVmcz48c3R5bGU+LmNscy0xe2ZpbGw6I2ZmZjt9LmNscy0ye2ZpbGw6I2UwNjg0Yjt9LmNscy0ze2ZpbGw6I2JiNDY0Yjt9LmNscy00e2ZpbGw6I2UwZGVkODt9LmNscy01e2ZpbGw6I2Q1ZDJjYTt9PC9zdHlsZT48L2RlZnM+PHRpdGxlPkJhYnlsb25Mb2dvPC90aXRsZT48ZyBpZD0iTGF5ZXJfMiIgZGF0YS1uYW1lPSJMYXllciAyIj48ZyBpZD0iUGFnZV9FbGVtZW50cyIgZGF0YS1uYW1lPSJQYWdlIEVsZW1lbnRzIj48cGF0aCBjbGFzcz0iY2xzLTEiIGQ9Ik05MC4wOSwwLDAsNTJWMTU2bDkwLjA5LDUyLDkwLjA4LTUyVjUyWiIvPjxwb2x5Z29uIGNsYXNzPSJjbHMtMiIgcG9pbnRzPSIxODAuMTcgNTIuMDEgMTUxLjk3IDM1LjczIDEyNC44NSA1MS4zOSAxNTMuMDUgNjcuNjcgMTgwLjE3IDUyLjAxIi8+PHBvbHlnb24gY2xhc3M9ImNscy0yIiBwb2ludHM9IjI3LjEyIDY3LjY3IDExNy4yMSAxNS42NiA5MC4wOCAwIDAgNTIuMDEgMjcuMTIgNjcuNjciLz48cG9seWdvbiBjbGFzcz0iY2xzLTIiIHBvaW50cz0iNjEuODkgMTIwLjMgOTAuMDggMTM2LjU4IDExOC4yOCAxMjAuMyA5MC4wOCAxMDQuMDIgNjEuODkgMTIwLjMiLz48cG9seWdvbiBjbGFzcz0iY2xzLTMiIHBvaW50cz0iMTUzLjA1IDY3LjY3IDE1My4wNSAxNDAuMzcgOTAuMDggMTc2LjcyIDI3LjEyIDE0MC4zNyAyNy4xMiA2Ny42NyAwIDUyLjAxIDAgMTU2LjAzIDkwLjA4IDIwOC4wNCAxODAuMTcgMTU2LjAzIDE4MC4xNyA1Mi4wMSAxNTMuMDUgNjcuNjciLz48cG9seWdvbiBjbGFzcz0iY2xzLTMiIHBvaW50cz0iOTAuMDggNzEuNDYgNjEuODkgODcuNzQgNjEuODkgMTIwLjMgOTAuMDggMTA0LjAyIDExOC4yOCAxMjAuMyAxMTguMjggODcuNzQgOTAuMDggNzEuNDYiLz48cG9seWdvbiBjbGFzcz0iY2xzLTQiIHBvaW50cz0iMTUzLjA1IDY3LjY3IDExOC4yOCA4Ny43NCAxMTguMjggMTIwLjMgOTAuMDggMTM2LjU4IDkwLjA4IDE3Ni43MiAxNTMuMDUgMTQwLjM3IDE1My4wNSA2Ny42NyIvPjxwb2x5Z29uIGNsYXNzPSJjbHMtNSIgcG9pbnRzPSIyNy4xMiA2Ny42NyA2MS44OSA4Ny43NCA2MS44OSAxMjAuMyA5MC4wOCAxMzYuNTggOTAuMDggMTc2LjcyIDI3LjEyIDE0MC4zNyAyNy4xMiA2Ny42NyIvPjwvZz48L2c+PC9zdmc+":"https://cdn.babylonjs.com/Assets/babylonLogo.png",N.style.position="absolute",N.style.left="40%",N.style.top="40%",N.style.width="20%",N.style.height="20%";var F=new Image;if(e.DefaultSpinnerUrl?F.src=e.DefaultSpinnerUrl:F.src=w?"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzOTIgMzkyIj48ZGVmcz48c3R5bGU+LmNscy0xe2ZpbGw6I2UwNjg0Yjt9LmNscy0ye2ZpbGw6bm9uZTt9PC9zdHlsZT48L2RlZnM+PHRpdGxlPlNwaW5uZXJJY29uPC90aXRsZT48ZyBpZD0iTGF5ZXJfMiIgZGF0YS1uYW1lPSJMYXllciAyIj48ZyBpZD0iU3Bpbm5lciI+PHBhdGggY2xhc3M9ImNscy0xIiBkPSJNNDAuMjEsMTI2LjQzYzMuNy03LjMxLDcuNjctMTQuNDQsMTItMjEuMzJsMy4zNi01LjEsMy41Mi01YzEuMjMtMS42MywyLjQxLTMuMjksMy42NS00LjkxczIuNTMtMy4yMSwzLjgyLTQuNzlBMTg1LjIsMTg1LjIsMCwwLDEsODMuNCw2Ny40M2EyMDgsMjA4LDAsMCwxLDE5LTE1LjY2YzMuMzUtMi40MSw2Ljc0LTQuNzgsMTAuMjUtN3M3LjExLTQuMjgsMTAuNzUtNi4zMmM3LjI5LTQsMTQuNzMtOCwyMi41My0xMS40OSwzLjktMS43Miw3Ljg4LTMuMywxMi00LjY0YTEwNC4yMiwxMDQuMjIsMCwwLDEsMTIuNDQtMy4yMyw2Mi40NCw2Mi40NCwwLDAsMSwxMi43OC0xLjM5QTI1LjkyLDI1LjkyLDAsMCwxLDE5NiwyMS40NGE2LjU1LDYuNTUsMCwwLDEsMi4wNSw5LDYuNjYsNi42NiwwLDAsMS0xLjY0LDEuNzhsLS40MS4yOWEyMi4wNywyMi4wNywwLDAsMS01Ljc4LDMsMzAuNDIsMzAuNDIsMCwwLDEtNS42NywxLjYyLDM3LjgyLDM3LjgyLDAsMCwxLTUuNjkuNzFjLTEsMC0xLjkuMTgtMi44NS4yNmwtMi44NS4yNHEtNS43Mi41MS0xMS40OCwxLjFjLTMuODQuNC03LjcxLjgyLTExLjU4LDEuNGExMTIuMzQsMTEyLjM0LDAsMCwwLTIyLjk0LDUuNjFjLTMuNzIsMS4zNS03LjM0LDMtMTAuOTQsNC42NHMtNy4xNCwzLjUxLTEwLjYsNS41MUExNTEuNiwxNTEuNiwwLDAsMCw2OC41Niw4N0M2Ny4yMyw4OC40OCw2Niw5MCw2NC42NCw5MS41NnMtMi41MSwzLjE1LTMuNzUsNC43M2wtMy41NCw0LjljLTEuMTMsMS42Ni0yLjIzLDMuMzUtMy4zMyw1YTEyNywxMjcsMCwwLDAtMTAuOTMsMjEuNDksMS41OCwxLjU4LDAsMSwxLTMtMS4xNVM0MC4xOSwxMjYuNDcsNDAuMjEsMTI2LjQzWiIvPjxyZWN0IGNsYXNzPSJjbHMtMiIgd2lkdGg9IjM5MiIgaGVpZ2h0PSIzOTIiLz48L2c+PC9nPjwvc3ZnPg==":"https://cdn.babylonjs.com/Assets/loadingIcon.png",F.style.position="absolute",F.style.left="30%",F.style.top="30%",F.style.width="40%",F.style.height="40%",F.style.animation="spin1 0.75s infinite linear",F.style.webkitAnimation="spin1 0.75s infinite linear",F.style.transformOrigin="50% 50%",F.style.webkitTransformOrigin="50% 50%",!w){var k={w:16,h:18.5},j={w:30,h:30};N.style.width=k.w+"vh",N.style.height=k.h+"vh",N.style.left="calc(50% - "+k.w/2+"vh)",N.style.top="calc(50% - "+k.h/2+"vh)",F.style.width=j.w+"vh",F.style.height=j.h+"vh",F.style.left="calc(50% - "+j.w/2+"vh)",F.style.top="calc(50% - "+j.h/2+"vh)"}this._loadingDiv.appendChild(N),this._loadingDiv.appendChild(F),this._resizeLoadingUI(),window.addEventListener("resize",this._resizeLoadingUI),this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor,document.body.appendChild(this._loadingDiv),this._loadingDiv.style.opacity="1"}},e.prototype.hideLoadingUI=function(){var D=this;this._loadingDiv&&(this._loadingDiv.style.opacity="0",this._loadingDiv.addEventListener("transitionend",(function(){D._loadingDiv&&(D._loadingDiv.parentElement&&D._loadingDiv.parentElement.removeChild(D._loadingDiv),window.removeEventListener("resize",D._resizeLoadingUI),D._loadingDiv=null)})))},Object.defineProperty(e.prototype,"loadingUIText",{get:function(){return this._loadingText},set:function(D){this._loadingText=D,this._loadingTextDiv&&(this._loadingTextDiv.innerHTML=this._loadingText)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loadingUIBackgroundColor",{get:function(){return this._loadingDivBackgroundColor},set:function(D){this._loadingDivBackgroundColor=D,this._loadingDiv&&(this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor)},enumerable:!0,configurable:!0}),e.DefaultLogoUrl="",e.DefaultSpinnerUrl="",e}();Ct.a.DefaultLoadingScreenFactory=function(D){return new nc(D)};var ic=N(69),rc=N(71),ac=function(){function e(){}return e.ConvertPanoramaToCubemap=function(D,w,N,F){if(!D)throw"ConvertPanoramaToCubemap: input cannot be null";if(D.length!=w*N*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(F,this.FACE_FRONT,D,w,N),back:this.CreateCubemapTexture(F,this.FACE_BACK,D,w,N),left:this.CreateCubemapTexture(F,this.FACE_LEFT,D,w,N),right:this.CreateCubemapTexture(F,this.FACE_RIGHT,D,w,N),up:this.CreateCubemapTexture(F,this.FACE_UP,D,w,N),down:this.CreateCubemapTexture(F,this.FACE_DOWN,D,w,N),size:F,type:ce.a.TEXTURETYPE_FLOAT,format:ce.a.TEXTUREFORMAT_RGB,gammaSpace:!1}},e.CreateCubemapTexture=function(D,w,N,F,k){for(var j=new ArrayBuffer(D*D*4*3),z=new Float32Array(j),G=w[1].subtract(w[0]).scale(1/D),H=w[3].subtract(w[2]).scale(1/D),X=1/D,q=0,Z=0;Z<D;Z++){for(var J=w[0],$=w[2],te=0;te<D;te++){var ie=$.subtract(J).scale(q).add(J);ie.normalize();var oe=this.CalcProjectionSpherical(ie,N,F,k);z[Z*D*3+3*te+0]=oe.r,z[Z*D*3+3*te+1]=oe.g,z[Z*D*3+3*te+2]=oe.b,J=J.add(G),$=$.add(H)}q+=X}return z},e.CalcProjectionSpherical=function(D,w,N,F){for(var k=Math.atan2(D.z,D.x),j=Math.acos(D.y);k<-Math.PI;)k+=2*Math.PI;for(;k>Math.PI;)k-=2*Math.PI;var z=k/Math.PI,G=j/Math.PI;z=.5*z+.5;var H=Math.round(z*N);H<0?H=0:H>=N&&(H=N-1);var X=Math.round(G*F);X<0?X=0:X>=F&&(X=F-1);var q=F-X-1;return{r:w[q*N*3+3*H+0],g:w[q*N*3+3*H+1],b:w[q*N*3+3*H+2]}},e.FACE_FRONT=[new z.e(-1,-1,-1),new z.e(1,-1,-1),new z.e(-1,1,-1),new z.e(1,1,-1)],e.FACE_BACK=[new z.e(1,-1,1),new z.e(-1,-1,1),new z.e(1,1,1),new z.e(-1,1,1)],e.FACE_RIGHT=[new z.e(1,-1,-1),new z.e(1,-1,1),new z.e(1,1,-1),new z.e(1,1,1)],e.FACE_LEFT=[new z.e(-1,-1,1),new z.e(-1,-1,-1),new z.e(-1,1,1),new z.e(-1,1,-1)],e.FACE_DOWN=[new z.e(-1,1,-1),new z.e(1,1,-1),new z.e(-1,1,1),new z.e(1,1,1)],e.FACE_UP=[new z.e(-1,-1,1),new z.e(1,-1,1),new z.e(-1,-1,-1),new z.e(1,-1,-1)],e}(),sc=function(){function e(){}return e.Ldexp=function(D,w){return w>1023?D*Math.pow(2,1023)*Math.pow(2,w-1023):w<-1074?D*Math.pow(2,-1074)*Math.pow(2,w+1074):D*Math.pow(2,w)},e.Rgbe2float=function(D,w,N,F,k,j){k>0?(k=this.Ldexp(1,k-136),D[j+0]=w*k,D[j+1]=N*k,D[j+2]=F*k):(D[j+0]=0,D[j+1]=0,D[j+2]=0)},e.readStringLine=function(D,w){for(var N="",F="",k=w;k<D.length-w&&"\n"!=(F=String.fromCharCode(D[k]));k++)N+=F;return N},e.RGBE_ReadHeader=function(D){var w,N,F=this.readStringLine(D,0);if("#"!=F[0]||"?"!=F[1])throw"Bad HDR Format.";var k=!1,j=!1,z=0;do{z+=F.length+1,"FORMAT=32-bit_rle_rgbe"==(F=this.readStringLine(D,z))?j=!0:0==F.length&&(k=!0)}while(!k);if(!j)throw"HDR Bad header format, unsupported FORMAT";z+=F.length+1,F=this.readStringLine(D,z);var G=/^\-Y (.*) \+X (.*)$/g.exec(F);if(!G||G.length<3)throw"HDR Bad header format, no size";if(N=parseInt(G[2]),w=parseInt(G[1]),N<8||N>32767)throw"HDR Bad header format, unsupported size";return{height:w,width:N,dataPosition:z+=F.length+1}},e.GetCubeMapTextureData=function(D,w){var N=new Uint8Array(D),F=this.RGBE_ReadHeader(N),k=this.RGBE_ReadPixels_RLE(N,F);return ac.ConvertPanoramaToCubemap(k,F.width,F.height,w)},e.RGBE_ReadPixels=function(D,w){return this.RGBE_ReadPixels_RLE(D,w)},e.RGBE_ReadPixels_RLE=function(D,w){for(var N,F,k,j,z,G=w.height,H=w.width,X=w.dataPosition,q=0,Z=0,J=0,$=new ArrayBuffer(4*H),te=new Uint8Array($),ie=new ArrayBuffer(w.width*w.height*4*3),oe=new Float32Array(ie);G>0;){if(N=D[X++],F=D[X++],k=D[X++],j=D[X++],2!=N||2!=F||128&k)throw"HDR Bad header format, not RLE";if((k<<8|j)!=H)throw"HDR Bad header format, wrong scan line width";for(q=0,J=0;J<4;J++)for(Z=(J+1)*H;q<Z;)if(N=D[X++],F=D[X++],N>128){if(0==(z=N-128)||z>Z-q)throw"HDR Bad Format, bad scanline data (run)";for(;z-- >0;)te[q++]=F}else{if(0==(z=N)||z>Z-q)throw"HDR Bad Format, bad scanline data (non-run)";if(te[q++]=F,--z>0)for(var ce=0;ce<z;ce++)te[q++]=D[X++]}for(J=0;J<H;J++)N=te[J],F=te[J+H],k=te[J+2*H],j=te[J+3*H],this.Rgbe2float(oe,N,F,k,j,(w.height-G)*H*3+3*J);G--}return oe},e}(),uc=function(D){function t(w,N,F,k,j,G,H,X,q){void 0===k&&(k=!1),void 0===j&&(j=!0),void 0===G&&(G=!1),void 0===H&&(H=!1),void 0===X&&(X=null),void 0===q&&(q=null);var Z=D.call(this,N)||this;return Z._generateHarmonics=!0,Z._onLoad=null,Z._onError=null,Z.coordinatesMode=Jt.a.CUBIC_MODE,Z._isBlocking=!0,Z._rotationY=0,Z.boundingBoxPosition=z.e.Zero(),w?(Z.name=w,Z.url=w,Z.hasAlpha=!1,Z.isCube=!0,Z._textureMatrix=z.a.Identity(),Z._onLoad=X,Z._onError=q,Z.gammaSpace=G,Z._noMipmap=k,Z._size=F,Z._generateHarmonics=j,Z._texture=Z._getFromCache(w,Z._noMipmap),Z._texture?X&&(Z._texture.isReady?Dt.b.SetImmediate((function(){return X()})):Z._texture.onLoadedObservable.add(X)):N.useDelayedTextureLoading?Z.delayLoadState=ce.a.DELAYLOADSTATE_NOTLOADED:Z.loadTexture(),Z):Z}return Object(Z.d)(t,D),Object.defineProperty(t.prototype,"isBlocking",{get:function(){return this._isBlocking},set:function(D){this._isBlocking=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotationY",{get:function(){return this._rotationY},set:function(D){this._rotationY=D,this.setReflectionTextureMatrix(z.a.RotationY(this._rotationY))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"boundingBoxSize",{get:function(){return this._boundingBoxSize},set:function(D){if(!this._boundingBoxSize||!this._boundingBoxSize.equals(D)){this._boundingBoxSize=D;var w=this.getScene();w&&w.markAllMaterialsAsDirty(ce.a.MATERIAL_TextureDirtyFlag)}},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"HDRCubeTexture"},t.prototype.loadTexture=function(){var D=this,w=this.getScene();w&&(this._texture=w.getEngine().createRawCubeTextureFromUrl(this.url,w,this._size,ce.a.TEXTUREFORMAT_RGB,w.getEngine().getCaps().textureFloat?ce.a.TEXTURETYPE_FLOAT:ce.a.TEXTURETYPE_UNSIGNED_INT,this._noMipmap,(function(w){D.lodGenerationOffset=0,D.lodGenerationScale=.8;var N=D.getScene();if(!N)return null;var F=sc.GetCubeMapTextureData(w,D._size);if(D._generateHarmonics){var k=Fr.ConvertCubeMapToSphericalPolynomial(F);D.sphericalPolynomial=k}for(var j=[],z=null,G=0;G<6;G++){if(!N.getEngine().getCaps().textureFloat){var H=new ArrayBuffer(D._size*D._size*3);z=new Uint8Array(H)}var X=F[t._facesMapping[G]];if(D.gammaSpace||z)for(var q=0;q<D._size*D._size;q++)if(D.gammaSpace&&(X[3*q+0]=Math.pow(X[3*q+0],rt.b),X[3*q+1]=Math.pow(X[3*q+1],rt.b),X[3*q+2]=Math.pow(X[3*q+2],rt.b)),z){var Z=Math.max(255*X[3*q+0],0),J=Math.max(255*X[3*q+1],0),$=Math.max(255*X[3*q+2],0),te=Math.max(Math.max(Z,J),$);if(te>255){var ie=255/te;Z*=ie,J*=ie,$*=ie}z[3*q+0]=Z,z[3*q+1]=J,z[3*q+2]=$}z?j.push(z):j.push(X)}return j}),null,this._onLoad,this._onError))},t.prototype.clone=function(){var D=this.getScene();if(!D)return this;var w=new t(this.url,D,this._size,this._noMipmap,this._generateHarmonics,this.gammaSpace);return w.level=this.level,w.wrapU=this.wrapU,w.wrapV=this.wrapV,w.coordinatesIndex=this.coordinatesIndex,w.coordinatesMode=this.coordinatesMode,w},t.prototype.delayLoad=function(){this.delayLoadState===ce.a.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=ce.a.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap),this._texture||this.loadTexture())},t.prototype.getReflectionTextureMatrix=function(){return this._textureMatrix},t.prototype.setReflectionTextureMatrix=function(D){var w=this;this._textureMatrix=D,D.updateFlag!==this._textureMatrix.updateFlag&&D.isIdentity()!==this._textureMatrix.isIdentity()&&this.getScene().markAllMaterialsAsDirty(ce.a.MATERIAL_TextureDirtyFlag,(function(D){return-1!==D.getActiveTextures().indexOf(w)}))},t.Parse=function(D,w,N){var F=null;return D.name&&!D.isRenderTarget&&((F=new t(N+D.name,w,D.size,D.noMipmap,D.generateHarmonics,D.useInGammaSpace)).name=D.name,F.hasAlpha=D.hasAlpha,F.level=D.level,F.coordinatesMode=D.coordinatesMode,F.isBlocking=D.isBlocking),F&&(D.boundingBoxPosition&&(F.boundingBoxPosition=z.e.FromArray(D.boundingBoxPosition)),D.boundingBoxSize&&(F.boundingBoxSize=z.e.FromArray(D.boundingBoxSize)),D.rotationY&&(F.rotationY=D.rotationY)),F},t.prototype.serialize=function(){if(!this.name)return null;var D={};return D.name=this.name,D.hasAlpha=this.hasAlpha,D.isCube=!0,D.level=this.level,D.size=this._size,D.coordinatesMode=this.coordinatesMode,D.useInGammaSpace=this.gammaSpace,D.generateHarmonics=this._generateHarmonics,D.customType="BABYLON.HDRCubeTexture",D.noMipmap=this._noMipmap,D.isBlocking=this._isBlocking,D.rotationY=this._rotationY,D},t._facesMapping=["right","left","up","down","front","back"],t}(Nr.a);H.a.RegisteredTypes["BABYLON.HDRCubeTexture"]=uc;var lc=function(){function e(D,w,N){void 0===w&&(w=0),void 0===N&&(N=null),this.name=D,this.animations=new Array,this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uniqueId=0,this.onInfluenceChanged=new j.c,this._onDataLayoutChanged=new j.c,this._animationPropertiesOverride=null,this._scene=N||Me.a.LastCreatedScene,this.influence=w,this._scene&&(this._uniqueId=this._scene.getUniqueId())}return Object.defineProperty(e.prototype,"influence",{get:function(){return this._influence},set:function(D){if(this._influence!==D){var w=this._influence;this._influence=D,this.onInfluenceChanged.hasObservers&&this.onInfluenceChanged.notifyObservers(0===w||0===D)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animationPropertiesOverride",{get:function(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride},set:function(D){this._animationPropertiesOverride=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasPositions",{get:function(){return!!this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasNormals",{get:function(){return!!this._normals},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasTangents",{get:function(){return!!this._tangents},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasUVs",{get:function(){return!!this._uvs},enumerable:!0,configurable:!0}),e.prototype.setPositions=function(D){var w=this.hasPositions;this._positions=D,w!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)},e.prototype.getPositions=function(){return this._positions},e.prototype.setNormals=function(D){var w=this.hasNormals;this._normals=D,w!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)},e.prototype.getNormals=function(){return this._normals},e.prototype.setTangents=function(D){var w=this.hasTangents;this._tangents=D,w!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)},e.prototype.getTangents=function(){return this._tangents},e.prototype.setUVs=function(D){var w=this.hasUVs;this._uvs=D,w!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)},e.prototype.getUVs=function(){return this._uvs},e.prototype.clone=function(){var D=this,w=Ie.a.Clone((function(){return new e(D.name,D.influence,D._scene)}),this);return w._positions=this._positions,w._normals=this._normals,w._tangents=this._tangents,w._uvs=this._uvs,w},e.prototype.serialize=function(){var D={};return D.name=this.name,D.influence=this.influence,D.positions=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(D.id=this.id),this.hasNormals&&(D.normals=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(D.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(D.uvs=Array.prototype.slice.call(this.getUVs())),Ie.a.AppendSerializedAnimations(this,D),D},e.prototype.getClassName=function(){return"MorphTarget"},e.Parse=function(D){var w=new e(D.name,D.influence);if(w.setPositions(D.positions),null!=D.id&&(w.id=D.id),D.normals&&w.setNormals(D.normals),D.tangents&&w.setTangents(D.tangents),D.uvs&&w.setUVs(D.uvs),D.animations)for(var N=0;N<D.animations.length;N++){var F=D.animations[N],k=H.a.GetClass("BABYLON.Animation");k&&w.animations.push(k.Parse(F))}return w},e.FromMesh=function(D,w,N){w||(w=D.name);var F=new e(w,N,D.getScene());return F.setPositions(D.getVerticesData(Zi.b.PositionKind)),D.isVerticesDataPresent(Zi.b.NormalKind)&&F.setNormals(D.getVerticesData(Zi.b.NormalKind)),D.isVerticesDataPresent(Zi.b.TangentKind)&&F.setTangents(D.getVerticesData(Zi.b.TangentKind)),D.isVerticesDataPresent(Zi.b.UVKind)&&F.setUVs(D.getVerticesData(Zi.b.UVKind)),F},Object(Z.c)([Object(Ie.c)()],e.prototype,"id",void 0),e}(),fc=function(){function e(D){void 0===D&&(D=null),this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new ui.a(16),this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,D||(D=Me.a.LastCreatedScene),this._scene=D,this._scene&&(this._scene.morphTargetManagers.push(this),this._uniqueId=this._scene.getUniqueId())}return Object.defineProperty(e.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vertexCount",{get:function(){return this._vertexCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"supportsNormals",{get:function(){return this._supportsNormals&&this.enableNormalMorphing},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"supportsTangents",{get:function(){return this._supportsTangents&&this.enableTangentMorphing},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"supportsUVs",{get:function(){return this._supportsUVs&&this.enableUVMorphing},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numTargets",{get:function(){return this._targets.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numInfluencers",{get:function(){return this._activeTargets.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"influences",{get:function(){return this._influences},enumerable:!0,configurable:!0}),e.prototype.getActiveTarget=function(D){return this._activeTargets.data[D]},e.prototype.getTarget=function(D){return this._targets[D]},e.prototype.addTarget=function(D){var w=this;this._targets.push(D),this._targetInfluenceChangedObservers.push(D.onInfluenceChanged.add((function(D){w._syncActiveTargets(D)}))),this._targetDataLayoutChangedObservers.push(D._onDataLayoutChanged.add((function(){w._syncActiveTargets(!0)}))),this._syncActiveTargets(!0)},e.prototype.removeTarget=function(D){var w=this._targets.indexOf(D);w>=0&&(this._targets.splice(w,1),D.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(w,1)[0]),D._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(w,1)[0]),this._syncActiveTargets(!0))},e.prototype.clone=function(){for(var D=new e(this._scene),w=0,N=this._targets;w<N.length;w++){var F=N[w];D.addTarget(F.clone())}return D.enableNormalMorphing=this.enableNormalMorphing,D.enableTangentMorphing=this.enableTangentMorphing,D.enableUVMorphing=this.enableUVMorphing,D},e.prototype.serialize=function(){var D={};D.id=this.uniqueId,D.targets=[];for(var w=0,N=this._targets;w<N.length;w++){var F=N[w];D.targets.push(F.serialize())}return D},e.prototype._syncActiveTargets=function(D){var w=0;this._activeTargets.reset(),this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._vertexCount=0;for(var N=0,F=this._targets;N<F.length;N++){var k=F[N];if(0!==k.influence){this._activeTargets.push(k),this._tempInfluences[w++]=k.influence,this._supportsNormals=this._supportsNormals&&k.hasNormals,this._supportsTangents=this._supportsTangents&&k.hasTangents,this._supportsUVs=this._supportsUVs&&k.hasUVs;var j=k.getPositions();if(j){var z=j.length/3;if(0===this._vertexCount)this._vertexCount=z;else if(this._vertexCount!==z)return void oe.a.Error("Incompatible target. Targets must all have the same vertices count.")}}}this._influences&&this._influences.length===w||(this._influences=new Float32Array(w));for(var G=0;G<w;G++)this._influences[G]=this._tempInfluences[G];D&&this.synchronize()},e.prototype.synchronize=function(){if(this._scene)for(var D=0,w=this._scene.meshes;D<w.length;D++){var N=w[D];N.morphTargetManager===this&&N._syncGeometryWithMorphTargetManager()}},e.Parse=function(D,w){var N=new e(w);N._uniqueId=D.id;for(var F=0,k=D.targets;F<k.length;F++){var j=k[F];N.addTarget(lc.Parse(j))}return N},e}(),pc=N(30),mc=N(47),gc=function(){function e(D,w){if(void 0===w&&(w=e.DefaultPluginFactory()),this._physicsPlugin=w,this._impostors=[],this._joints=[],this._subTimeStep=0,!this._physicsPlugin.isSupported())throw new Error("Physics Engine "+this._physicsPlugin.name+" cannot be found. Please make sure it is included.");D=D||new z.e(0,-9.807,0),this.setGravity(D),this.setTimeStep()}return e.DefaultPluginFactory=function(){throw It.a.WarnImport("CannonJSPlugin")},e.prototype.setGravity=function(D){this.gravity=D,this._physicsPlugin.setGravity(this.gravity)},e.prototype.setTimeStep=function(D){void 0===D&&(D=1/60),this._physicsPlugin.setTimeStep(D)},e.prototype.getTimeStep=function(){return this._physicsPlugin.getTimeStep()},e.prototype.setSubTimeStep=function(D){void 0===D&&(D=0),this._subTimeStep=D},e.prototype.getSubTimeStep=function(){return this._subTimeStep},e.prototype.dispose=function(){this._impostors.forEach((function(D){D.dispose()})),this._physicsPlugin.dispose()},e.prototype.getPhysicsPluginName=function(){return this._physicsPlugin.name},e.prototype.addImpostor=function(D){D.uniqueId=this._impostors.push(D),D.parent||this._physicsPlugin.generatePhysicsBody(D)},e.prototype.removeImpostor=function(D){var w=this._impostors.indexOf(D);w>-1&&this._impostors.splice(w,1).length&&this.getPhysicsPlugin().removePhysicsBody(D)},e.prototype.addJoint=function(D,w,N){var F={mainImpostor:D,connectedImpostor:w,joint:N};N.physicsPlugin=this._physicsPlugin,this._joints.push(F),this._physicsPlugin.generateJoint(F)},e.prototype.removeJoint=function(D,w,N){var F=this._joints.filter((function(F){return F.connectedImpostor===w&&F.joint===N&&F.mainImpostor===D}));F.length&&this._physicsPlugin.removeJoint(F[0])},e.prototype._step=function(D){var w=this;this._impostors.forEach((function(D){D.isBodyInitRequired()&&w._physicsPlugin.generatePhysicsBody(D)})),D>.1?D=.1:D<=0&&(D=1/60),this._physicsPlugin.executeStep(D,this._impostors)},e.prototype.getPhysicsPlugin=function(){return this._physicsPlugin},e.prototype.getImpostors=function(){return this._impostors},e.prototype.getImpostorForPhysicsObject=function(D){for(var w=0;w<this._impostors.length;++w)if(this._impostors[w].object===D)return this._impostors[w];return null},e.prototype.getImpostorWithPhysicsBody=function(D){for(var w=0;w<this._impostors.length;++w)if(this._impostors[w].physicsBody===D)return this._impostors[w];return null},e.prototype.raycast=function(D,w){return this._physicsPlugin.raycast(D,w)},e.Epsilon=.001,e}(),bc=function(){function e(){this._hasHit=!1,this._hitDistance=0,this._hitNormalWorld=z.e.Zero(),this._hitPointWorld=z.e.Zero(),this._rayFromWorld=z.e.Zero(),this._rayToWorld=z.e.Zero()}return Object.defineProperty(e.prototype,"hasHit",{get:function(){return this._hasHit},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hitDistance",{get:function(){return this._hitDistance},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hitNormalWorld",{get:function(){return this._hitNormalWorld},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hitPointWorld",{get:function(){return this._hitPointWorld},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rayFromWorld",{get:function(){return this._rayFromWorld},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rayToWorld",{get:function(){return this._rayToWorld},enumerable:!0,configurable:!0}),e.prototype.setHitData=function(D,w){this._hasHit=!0,this._hitNormalWorld=new z.e(D.x,D.y,D.z),this._hitPointWorld=new z.e(w.x,w.y,w.z)},e.prototype.setHitDistance=function(D){this._hitDistance=D},e.prototype.calculateHitDistance=function(){this._hitDistance=z.e.Distance(this._rayFromWorld,this._hitPointWorld)},e.prototype.reset=function(D,w){void 0===D&&(D=z.e.Zero()),void 0===w&&(w=z.e.Zero()),this._rayFromWorld=D,this._rayToWorld=w,this._hasHit=!1,this._hitDistance=0,this._hitNormalWorld=z.e.Zero(),this._hitPointWorld=z.e.Zero()},e}(),Tc=function(){function e(D,w,N){void 0===D&&(D=!0),void 0===w&&(w=10),void 0===N&&(N=CANNON),this._useDeltaForWorldStep=D,this.name="CannonJSPlugin",this._physicsMaterials=new Array,this._fixedTimeStep=1/60,this._physicsBodysToRemoveAfterStep=new Array,this._minus90X=new z.b(-.7071067811865475,0,0,.7071067811865475),this._plus90X=new z.b(.7071067811865475,0,0,.7071067811865475),this._tmpPosition=z.e.Zero(),this._tmpDeltaPosition=z.e.Zero(),this._tmpUnityRotation=new z.b,this.BJSCANNON=N,this.isSupported()?(this._extendNamespace(),this.world=new this.BJSCANNON.World,this.world.broadphase=new this.BJSCANNON.NaiveBroadphase,this.world.solver.iterations=w,this._cannonRaycastResult=new this.BJSCANNON.RaycastResult,this._raycastResult=new bc):oe.a.Error("CannonJS is not available. Please make sure you included the js file.")}return e.prototype.setGravity=function(D){this.world.gravity.copy(D)},e.prototype.setTimeStep=function(D){this._fixedTimeStep=D},e.prototype.getTimeStep=function(){return this._fixedTimeStep},e.prototype.executeStep=function(D){this.world.step(this._fixedTimeStep,this._useDeltaForWorldStep?D:0,3),this._removeMarkedPhysicsBodiesFromWorld()},e.prototype._removeMarkedPhysicsBodiesFromWorld=function(){var D=this;this._physicsBodysToRemoveAfterStep.length>0&&(this._physicsBodysToRemoveAfterStep.forEach((function(w){D.world.remove(w)})),this._physicsBodysToRemoveAfterStep=[])},e.prototype.applyImpulse=function(D,w,N){var F=new this.BJSCANNON.Vec3(N.x,N.y,N.z),k=new this.BJSCANNON.Vec3(w.x,w.y,w.z);D.physicsBody.applyImpulse(k,F)},e.prototype.applyForce=function(D,w,N){var F=new this.BJSCANNON.Vec3(N.x,N.y,N.z),k=new this.BJSCANNON.Vec3(w.x,w.y,w.z);D.physicsBody.applyForce(k,F)},e.prototype.generatePhysicsBody=function(D){if(this._removeMarkedPhysicsBodiesFromWorld(),D.parent)D.physicsBody&&(this.removePhysicsBody(D),D.forceUpdate());else{if(D.isBodyInitRequired()){var w=this._createShape(D),N=D.physicsBody;N&&this.removePhysicsBody(D);var F=this._addMaterial("mat-"+D.uniqueId,D.getParam("friction"),D.getParam("restitution")),k={mass:D.getParam("mass"),material:F},j=D.getParam("nativeOptions");for(var z in j)j.hasOwnProperty(z)&&(k[z]=j[z]);D.physicsBody=new this.BJSCANNON.Body(k),D.physicsBody.addEventListener("collide",D.onCollide),this.world.addEventListener("preStep",D.beforeStep),this.world.addEventListener("postStep",D.afterStep),D.physicsBody.addShape(w),this.world.add(D.physicsBody),N&&["force","torque","velocity","angularVelocity"].forEach((function(w){D.physicsBody[w].copy(N[w])})),this._processChildMeshes(D)}this._updatePhysicsBodyTransformation(D)}},e.prototype._processChildMeshes=function(D){var w=this,N=D.object.getChildMeshes?D.object.getChildMeshes(!0):[],F=D.object.rotationQuaternion;if(N.length){var r=function(N,k){if(F&&k.rotationQuaternion){var j=k.getPhysicsImpostor();if(j&&j.parent!==D){var G=k.position.clone(),H=k.rotationQuaternion.multiply(z.b.Inverse(F));j.physicsBody&&(w.removePhysicsBody(j),j.physicsBody=null),j.parent=D,j.resetUpdateFlags(),D.physicsBody.addShape(w._createShape(j),new w.BJSCANNON.Vec3(G.x,G.y,G.z),new w.BJSCANNON.Quaternion(H.x,H.y,H.z,H.w)),D.physicsBody.mass+=j.getParam("mass")}F.multiplyInPlace(k.rotationQuaternion),k.getChildMeshes(!0).filter((function(D){return!!D.physicsImpostor})).forEach(r.bind(w,k.getAbsolutePosition()))}};N.filter((function(D){return!!D.physicsImpostor})).forEach(r.bind(this,D.object.getAbsolutePosition()))}},e.prototype.removePhysicsBody=function(D){D.physicsBody.removeEventListener("collide",D.onCollide),this.world.removeEventListener("preStep",D.beforeStep),this.world.removeEventListener("postStep",D.afterStep),-1===this._physicsBodysToRemoveAfterStep.indexOf(D.physicsBody)&&this._physicsBodysToRemoveAfterStep.push(D.physicsBody)},e.prototype.generateJoint=function(D){var w=D.mainImpostor.physicsBody,N=D.connectedImpostor.physicsBody;if(w&&N){var F,k=D.joint.jointData,j={pivotA:k.mainPivot?(new this.BJSCANNON.Vec3).copy(k.mainPivot):null,pivotB:k.connectedPivot?(new this.BJSCANNON.Vec3).copy(k.connectedPivot):null,axisA:k.mainAxis?(new this.BJSCANNON.Vec3).copy(k.mainAxis):null,axisB:k.connectedAxis?(new this.BJSCANNON.Vec3).copy(k.connectedAxis):null,maxForce:k.nativeParams.maxForce,collideConnected:!!k.collision};switch(D.joint.type){case mc.e.HingeJoint:case mc.e.Hinge2Joint:F=new this.BJSCANNON.HingeConstraint(w,N,j);break;case mc.e.DistanceJoint:F=new this.BJSCANNON.DistanceConstraint(w,N,k.maxDistance||2);break;case mc.e.SpringJoint:var z=k;F=new this.BJSCANNON.Spring(w,N,{restLength:z.length,stiffness:z.stiffness,damping:z.damping,localAnchorA:j.pivotA,localAnchorB:j.pivotB});break;case mc.e.LockJoint:F=new this.BJSCANNON.LockConstraint(w,N,j);break;case mc.e.PointToPointJoint:case mc.e.BallAndSocketJoint:default:F=new this.BJSCANNON.PointToPointConstraint(w,j.pivotA,N,j.pivotB,j.maxForce)}F.collideConnected=!!k.collision,D.joint.physicsJoint=F,D.joint.type!==mc.e.SpringJoint?this.world.addConstraint(F):(D.joint.jointData.forceApplicationCallback=D.joint.jointData.forceApplicationCallback||function(){F.applyForce()},D.mainImpostor.registerAfterPhysicsStep(D.joint.jointData.forceApplicationCallback))}},e.prototype.removeJoint=function(D){D.joint.type!==mc.e.SpringJoint?this.world.removeConstraint(D.joint.physicsJoint):D.mainImpostor.unregisterAfterPhysicsStep(D.joint.jointData.forceApplicationCallback)},e.prototype._addMaterial=function(D,w,N){var F,k;for(F=0;F<this._physicsMaterials.length;F++)if((k=this._physicsMaterials[F]).friction===w&&k.restitution===N)return k;var j=new this.BJSCANNON.Material(D);return j.friction=w,j.restitution=N,this._physicsMaterials.push(j),j},e.prototype._checkWithEpsilon=function(D){return D<gc.Epsilon?gc.Epsilon:D},e.prototype._createShape=function(D){var w,N=D.object,F=D.getObjectExtendSize();switch(D.type){case pc.a.SphereImpostor:var k=F.x,j=F.y,G=F.z;w=new this.BJSCANNON.Sphere(Math.max(this._checkWithEpsilon(k),this._checkWithEpsilon(j),this._checkWithEpsilon(G))/2);break;case pc.a.CylinderImpostor:var H=D.getParam("nativeOptions");H||(H={});var X=void 0!==H.radiusTop?H.radiusTop:this._checkWithEpsilon(F.x)/2,q=void 0!==H.radiusBottom?H.radiusBottom:this._checkWithEpsilon(F.x)/2,Z=void 0!==H.height?H.height:this._checkWithEpsilon(F.y),J=void 0!==H.numSegments?H.numSegments:16;w=new this.BJSCANNON.Cylinder(X,q,Z,J);var $=new this.BJSCANNON.Quaternion;$.setFromAxisAngle(new this.BJSCANNON.Vec3(1,0,0),-Math.PI/2);var te=new this.BJSCANNON.Vec3(0,0,0);w.transformAllPoints(te,$);break;case pc.a.BoxImpostor:var ie=F.scale(.5);w=new this.BJSCANNON.Box(new this.BJSCANNON.Vec3(this._checkWithEpsilon(ie.x),this._checkWithEpsilon(ie.y),this._checkWithEpsilon(ie.z)));break;case pc.a.PlaneImpostor:oe.a.Warn("Attention, PlaneImposter might not behave as you expect. Consider using BoxImposter instead"),w=new this.BJSCANNON.Plane;break;case pc.a.MeshImpostor:var ce=N.getVerticesData?N.getVerticesData(Zi.b.PositionKind):[],he=N.getIndices?N.getIndices():[];if(!ce)return;var fe=N.position.clone(),pe=N.rotation&&N.rotation.clone(),_e=N.rotationQuaternion&&N.rotationQuaternion.clone();N.position.copyFromFloats(0,0,0),N.rotation&&N.rotation.copyFromFloats(0,0,0),N.rotationQuaternion&&N.rotationQuaternion.copyFrom(D.getParentsRotation()),N.rotationQuaternion&&N.parent&&N.rotationQuaternion.conjugateInPlace();var ve,ye=N.computeWorldMatrix(!0),be=new Array;for(ve=0;ve<ce.length;ve+=3)z.e.TransformCoordinates(z.e.FromArray(ce,ve),ye).toArray(be,ve);oe.a.Warn("MeshImpostor only collides against spheres."),w=new this.BJSCANNON.Trimesh(be,he),N.position.copyFrom(fe),pe&&N.rotation&&N.rotation.copyFrom(pe),_e&&N.rotationQuaternion&&N.rotationQuaternion.copyFrom(_e);break;case pc.a.HeightmapImpostor:var Te=N.position.clone(),Ee=N.rotation&&N.rotation.clone(),Se=N.rotationQuaternion&&N.rotationQuaternion.clone();N.position.copyFromFloats(0,0,0),N.rotation&&N.rotation.copyFromFloats(0,0,0),N.rotationQuaternion&&N.rotationQuaternion.copyFrom(D.getParentsRotation()),N.rotationQuaternion&&N.parent&&N.rotationQuaternion.conjugateInPlace(),N.rotationQuaternion&&N.rotationQuaternion.multiplyInPlace(this._minus90X),w=this._createHeightmap(N),N.position.copyFrom(Te),Ee&&N.rotation&&N.rotation.copyFrom(Ee),Se&&N.rotationQuaternion&&N.rotationQuaternion.copyFrom(Se),N.computeWorldMatrix(!0);break;case pc.a.ParticleImpostor:w=new this.BJSCANNON.Particle;break;case pc.a.NoImpostor:w=new this.BJSCANNON.Box(new this.BJSCANNON.Vec3(0,0,0))}return w},e.prototype._createHeightmap=function(D,w){var N,F=D.getVerticesData(Zi.b.PositionKind),k=D.computeWorldMatrix(!0),j=new Array;for(N=0;N<F.length;N+=3)z.e.TransformCoordinates(z.e.FromArray(F,N),k).toArray(j,N);F=j;for(var G=new Array,H=w||~~(Math.sqrt(F.length/3)-1),X=D.getBoundingInfo(),q=Math.min(X.boundingBox.extendSizeWorld.x,X.boundingBox.extendSizeWorld.y),Z=X.boundingBox.extendSizeWorld.z,J=2*q/H,$=0;$<F.length;$+=3){var te=Math.round(F[$+0]/J+H/2),ie=Math.round(-1*(F[$+1]/J-H/2)),oe=-F[$+2]+Z;G[te]||(G[te]=[]),G[te][ie]||(G[te][ie]=oe),G[te][ie]=Math.max(oe,G[te][ie])}for(te=0;te<=H;++te){if(!G[te]){for(var ce=1;!G[(te+ce)%H];)ce++;G[te]=G[(te+ce)%H].slice()}for(ie=0;ie<=H;++ie)if(!G[te][ie]){var he;for(ce=1;void 0===he;)he=G[te][(ie+ce++)%H];G[te][ie]=he}}var fe=new this.BJSCANNON.Heightfield(G,{elementSize:J});return fe.minY=Z,fe},e.prototype._updatePhysicsBodyTransformation=function(D){var w=D.object;if(w.computeWorldMatrix&&w.computeWorldMatrix(!0),w.getBoundingInfo()){var N=D.getObjectCenter();this._tmpDeltaPosition.copyFrom(w.getAbsolutePivotPoint().subtract(N)),this._tmpDeltaPosition.divideInPlace(D.object.scaling),this._tmpPosition.copyFrom(N);var F=w.rotationQuaternion;if(F){if(D.type!==pc.a.PlaneImpostor&&D.type!==pc.a.HeightmapImpostor||(F=F.multiply(this._minus90X),D.setDeltaRotation(this._plus90X)),D.type===pc.a.HeightmapImpostor){var k=w,j=k.getBoundingInfo(),G=k.rotationQuaternion;k.rotationQuaternion=this._tmpUnityRotation,k.computeWorldMatrix(!0);var H=N.clone(),X=k.getPivotMatrix();X=X?X.clone():z.a.Identity();var q=z.a.Translation(j.boundingBox.extendSizeWorld.x,0,-j.boundingBox.extendSizeWorld.z);k.setPreTransformMatrix(q),k.computeWorldMatrix(!0);var Z=j.boundingBox.centerWorld.subtract(N).subtract(k.position).negate();this._tmpPosition.copyFromFloats(Z.x,Z.y-j.boundingBox.extendSizeWorld.y,Z.z),this._tmpDeltaPosition.copyFrom(j.boundingBox.centerWorld.subtract(H)),this._tmpDeltaPosition.y+=j.boundingBox.extendSizeWorld.y,k.rotationQuaternion=G,k.setPreTransformMatrix(X),k.computeWorldMatrix(!0)}else D.type===pc.a.MeshImpostor&&this._tmpDeltaPosition.copyFromFloats(0,0,0);D.setDeltaPosition(this._tmpDeltaPosition),D.physicsBody.position.copy(this._tmpPosition),D.physicsBody.quaternion.copy(F)}}},e.prototype.setTransformationFromPhysicsBody=function(D){D.object.position.copyFrom(D.physicsBody.position),D.object.rotationQuaternion&&D.object.rotationQuaternion.copyFrom(D.physicsBody.quaternion)},e.prototype.setPhysicsBodyTransformation=function(D,w,N){D.physicsBody.position.copy(w),D.physicsBody.quaternion.copy(N)},e.prototype.isSupported=function(){return void 0!==this.BJSCANNON},e.prototype.setLinearVelocity=function(D,w){D.physicsBody.velocity.copy(w)},e.prototype.setAngularVelocity=function(D,w){D.physicsBody.angularVelocity.copy(w)},e.prototype.getLinearVelocity=function(D){var w=D.physicsBody.velocity;return w?new z.e(w.x,w.y,w.z):null},e.prototype.getAngularVelocity=function(D){var w=D.physicsBody.angularVelocity;return w?new z.e(w.x,w.y,w.z):null},e.prototype.setBodyMass=function(D,w){D.physicsBody.mass=w,D.physicsBody.updateMassProperties()},e.prototype.getBodyMass=function(D){return D.physicsBody.mass},e.prototype.getBodyFriction=function(D){return D.physicsBody.material.friction},e.prototype.setBodyFriction=function(D,w){D.physicsBody.material.friction=w},e.prototype.getBodyRestitution=function(D){return D.physicsBody.material.restitution},e.prototype.setBodyRestitution=function(D,w){D.physicsBody.material.restitution=w},e.prototype.sleepBody=function(D){D.physicsBody.sleep()},e.prototype.wakeUpBody=function(D){D.physicsBody.wakeUp()},e.prototype.updateDistanceJoint=function(D,w){D.physicsJoint.distance=w},e.prototype.setMotor=function(D,w,N,F){F||(D.physicsJoint.enableMotor(),D.physicsJoint.setMotorSpeed(w),N&&this.setLimit(D,N))},e.prototype.setLimit=function(D,w,N){D.physicsJoint.motorEquation.maxForce=w,D.physicsJoint.motorEquation.minForce=void 0===N?-w:N},e.prototype.syncMeshWithImpostor=function(D,w){var N=w.physicsBody;D.position.x=N.position.x,D.position.y=N.position.y,D.position.z=N.position.z,D.rotationQuaternion&&(D.rotationQuaternion.x=N.quaternion.x,D.rotationQuaternion.y=N.quaternion.y,D.rotationQuaternion.z=N.quaternion.z,D.rotationQuaternion.w=N.quaternion.w)},e.prototype.getRadius=function(D){return D.physicsBody.shapes[0].boundingSphereRadius},e.prototype.getBoxSizeToRef=function(D,w){var N=D.physicsBody.shapes[0];w.x=2*N.halfExtents.x,w.y=2*N.halfExtents.y,w.z=2*N.halfExtents.z},e.prototype.dispose=function(){},e.prototype._extendNamespace=function(){var D=new this.BJSCANNON.Vec3,w=this.BJSCANNON;this.BJSCANNON.World.prototype.step=function(N,F,k){if(k=k||10,0===(F=F||0))this.internalStep(N),this.time+=N;else{var j=Math.floor((this.time+F)/N)-Math.floor(this.time/N);j=Math.min(j,k)||1;for(var z=performance.now(),G=0;G!==j&&(this.internalStep(N),!(performance.now()-z>1e3*N));G++);this.time+=F;for(var H=this.time%N/N,X=D,q=this.bodies,Z=0;Z!==q.length;Z++){var J=q[Z];J.type!==w.Body.STATIC&&J.sleepState!==w.Body.SLEEPING?(J.position.vsub(J.previousPosition,X),X.scale(H,X),J.position.vadd(X,J.interpolatedPosition)):(J.interpolatedPosition.copy(J.position),J.interpolatedQuaternion.copy(J.quaternion))}}}},e.prototype.raycast=function(D,w){return this._cannonRaycastResult.reset(),this.world.raycastClosest(D,w,{},this._cannonRaycastResult),this._raycastResult.reset(D,w),this._cannonRaycastResult.hasHit&&(this._raycastResult.setHitData({x:this._cannonRaycastResult.hitNormalWorld.x,y:this._cannonRaycastResult.hitNormalWorld.y,z:this._cannonRaycastResult.hitNormalWorld.z},{x:this._cannonRaycastResult.hitPointWorld.x,y:this._cannonRaycastResult.hitPointWorld.y,z:this._cannonRaycastResult.hitPointWorld.z}),this._raycastResult.setHitDistance(this._cannonRaycastResult.distance)),this._raycastResult},e}();gc.DefaultPluginFactory=function(){return new Tc};var Sc=function(){function e(D,w){void 0===w&&(w=OIMO),this.name="OimoJSPlugin",this._tmpImpostorsArray=[],this._tmpPositionVector=z.e.Zero(),this.BJSOIMO=w,this.world=new this.BJSOIMO.World({iterations:D}),this.world.clear(),this._raycastResult=new bc}return e.prototype.setGravity=function(D){this.world.gravity.copy(D)},e.prototype.setTimeStep=function(D){this.world.timeStep=D},e.prototype.getTimeStep=function(){return this.world.timeStep},e.prototype.executeStep=function(D,w){var N=this;w.forEach((function(D){D.beforeStep()})),this.world.step(),w.forEach((function(D){D.afterStep(),N._tmpImpostorsArray[D.uniqueId]=D}));for(var F=this.world.contacts;null!==F;)if(!F.touching||F.body1.sleeping||F.body2.sleeping){var k=this._tmpImpostorsArray[+F.body1.name],j=this._tmpImpostorsArray[+F.body2.name];k&&j?(k.onCollide({body:j.physicsBody}),j.onCollide({body:k.physicsBody}),F=F.next):F=F.next}else F=F.next},e.prototype.applyImpulse=function(D,w,N){var F=D.physicsBody.mass;D.physicsBody.applyImpulse(N.scale(this.world.invScale),w.scale(this.world.invScale*F))},e.prototype.applyForce=function(D,w,N){oe.a.Warn("Oimo doesn't support applying force. Using impule instead."),this.applyImpulse(D,w,N)},e.prototype.generatePhysicsBody=function(D){var w=this;if(D.parent)D.physicsBody&&(this.removePhysicsBody(D),D.forceUpdate());else{if(D.isBodyInitRequired()){var N={name:D.uniqueId,config:[D.getParam("mass")||.001,D.getParam("friction"),D.getParam("restitution")],size:[],type:[],pos:[],posShape:[],rot:[],rotShape:[],move:0!==D.getParam("mass"),density:D.getParam("mass"),friction:D.getParam("friction"),restitution:D.getParam("restitution"),world:this.world},F=[D];(j=D.object).getChildMeshes&&j.getChildMeshes().forEach((function(D){D.physicsImpostor&&F.push(D.physicsImpostor)}));var r=function(D){return Math.max(D,gc.Epsilon)},k=new z.b;F.forEach((function(F){if(F.object.rotationQuaternion){var j=F.object.rotationQuaternion;k=j.clone(),F.object.rotationQuaternion.set(0,0,0,1),F.object.computeWorldMatrix(!0);var z=j.toEulerAngles(),G=F.getObjectExtendSize();if(F===D){var H=D.getObjectCenter();D.object.getAbsolutePivotPoint().subtractToRef(H,w._tmpPositionVector),w._tmpPositionVector.divideInPlace(D.object.scaling),N.pos.push(H.x),N.pos.push(H.y),N.pos.push(H.z),N.posShape.push(0,0,0),N.rotShape.push(0,0,0)}else{var X=F.object.position.clone();N.posShape.push(X.x),N.posShape.push(X.y),N.posShape.push(X.z),N.rotShape.push(57.29577951308232*z.x),N.rotShape.push(57.29577951308232*z.y),N.rotShape.push(57.29577951308232*z.z)}switch(F.object.rotationQuaternion.copyFrom(k),F.type){case pc.a.ParticleImpostor:oe.a.Warn("No Particle support in OIMO.js. using SphereImpostor instead");case pc.a.SphereImpostor:var q=G.x,Z=G.y,J=G.z,$=Math.max(r(q),r(Z),r(J))/2;N.type.push("sphere"),N.size.push($),N.size.push($),N.size.push($);break;case pc.a.CylinderImpostor:var te=r(G.x)/2,ie=r(G.y);N.type.push("cylinder"),N.size.push(te),N.size.push(ie),N.size.push(ie);break;case pc.a.PlaneImpostor:case pc.a.BoxImpostor:default:te=r(G.x),ie=r(G.y);var ce=r(G.z);N.type.push("box"),N.size.push(te),N.size.push(ie),N.size.push(ce)}F.object.rotationQuaternion=j}})),D.physicsBody=this.world.add(N),D.physicsBody.resetQuaternion(k),D.physicsBody.updatePosition(0)}else this._tmpPositionVector.copyFromFloats(0,0,0);var j;D.setDeltaPosition(this._tmpPositionVector)}},e.prototype.removePhysicsBody=function(D){this.world.removeRigidBody(D.physicsBody)},e.prototype.generateJoint=function(D){var w=D.mainImpostor.physicsBody,N=D.connectedImpostor.physicsBody;if(w&&N){var F,k=D.joint.jointData,j=k.nativeParams||{},z={body1:w,body2:N,axe1:j.axe1||(k.mainAxis?k.mainAxis.asArray():null),axe2:j.axe2||(k.connectedAxis?k.connectedAxis.asArray():null),pos1:j.pos1||(k.mainPivot?k.mainPivot.asArray():null),pos2:j.pos2||(k.connectedPivot?k.connectedPivot.asArray():null),min:j.min,max:j.max,collision:j.collision||k.collision,spring:j.spring,world:this.world};switch(D.joint.type){case mc.e.BallAndSocketJoint:F="jointBall";break;case mc.e.SpringJoint:oe.a.Warn("OIMO.js doesn't support Spring Constraint. Simulating using DistanceJoint instead");var G=k;z.min=G.length||z.min,z.max=Math.max(z.min,z.max);case mc.e.DistanceJoint:F="jointDistance",z.max=k.maxDistance;break;case mc.e.PrismaticJoint:F="jointPrisme";break;case mc.e.SliderJoint:F="jointSlide";break;case mc.e.WheelJoint:F="jointWheel";break;case mc.e.HingeJoint:default:F="jointHinge"}z.type=F,D.joint.physicsJoint=this.world.add(z)}},e.prototype.removeJoint=function(D){try{this.world.removeJoint(D.joint.physicsJoint)}catch(D){oe.a.Warn(D)}},e.prototype.isSupported=function(){return void 0!==this.BJSOIMO},e.prototype.setTransformationFromPhysicsBody=function(D){if(!D.physicsBody.sleeping){if(D.physicsBody.shapes.next){for(var w=D.physicsBody.shapes;w.next;)w=w.next;D.object.position.copyFrom(w.position)}else D.object.position.copyFrom(D.physicsBody.getPosition());D.object.rotationQuaternion&&D.object.rotationQuaternion.copyFrom(D.physicsBody.getQuaternion())}},e.prototype.setPhysicsBodyTransformation=function(D,w,N){var F=D.physicsBody;D.physicsBody.shapes.next||(F.position.copy(w),F.orientation.copy(N),F.syncShapes(),F.awake())},e.prototype.setLinearVelocity=function(D,w){D.physicsBody.linearVelocity.copy(w)},e.prototype.setAngularVelocity=function(D,w){D.physicsBody.angularVelocity.copy(w)},e.prototype.getLinearVelocity=function(D){var w=D.physicsBody.linearVelocity;return w?new z.e(w.x,w.y,w.z):null},e.prototype.getAngularVelocity=function(D){var w=D.physicsBody.angularVelocity;return w?new z.e(w.x,w.y,w.z):null},e.prototype.setBodyMass=function(D,w){var N=0===w;D.physicsBody.shapes.density=N?1:w,D.physicsBody.setupMass(N?2:1)},e.prototype.getBodyMass=function(D){return D.physicsBody.shapes.density},e.prototype.getBodyFriction=function(D){return D.physicsBody.shapes.friction},e.prototype.setBodyFriction=function(D,w){D.physicsBody.shapes.friction=w},e.prototype.getBodyRestitution=function(D){return D.physicsBody.shapes.restitution},e.prototype.setBodyRestitution=function(D,w){D.physicsBody.shapes.restitution=w},e.prototype.sleepBody=function(D){D.physicsBody.sleep()},e.prototype.wakeUpBody=function(D){D.physicsBody.awake()},e.prototype.updateDistanceJoint=function(D,w,N){D.physicsJoint.limitMotor.upperLimit=w,void 0!==N&&(D.physicsJoint.limitMotor.lowerLimit=N)},e.prototype.setMotor=function(D,w,N,F){void 0!==N?oe.a.Warn("OimoJS plugin currently has unexpected behavior when using setMotor with force parameter"):N=1e6,w*=-1;var k=F?D.physicsJoint.rotationalLimitMotor2:D.physicsJoint.rotationalLimitMotor1||D.physicsJoint.rotationalLimitMotor||D.physicsJoint.limitMotor;k&&k.setMotor(w,N)},e.prototype.setLimit=function(D,w,N,F){var k=F?D.physicsJoint.rotationalLimitMotor2:D.physicsJoint.rotationalLimitMotor1||D.physicsJoint.rotationalLimitMotor||D.physicsJoint.limitMotor;k&&k.setLimit(w,void 0===N?-w:N)},e.prototype.syncMeshWithImpostor=function(D,w){var N=w.physicsBody;D.position.x=N.position.x,D.position.y=N.position.y,D.position.z=N.position.z,D.rotationQuaternion&&(D.rotationQuaternion.x=N.orientation.x,D.rotationQuaternion.y=N.orientation.y,D.rotationQuaternion.z=N.orientation.z,D.rotationQuaternion.w=N.orientation.s)},e.prototype.getRadius=function(D){return D.physicsBody.shapes.radius},e.prototype.getBoxSizeToRef=function(D,w){var N=D.physicsBody.shapes;w.x=2*N.halfWidth,w.y=2*N.halfHeight,w.z=2*N.halfDepth},e.prototype.dispose=function(){this.world.clear()},e.prototype.raycast=function(D,w){return oe.a.Warn("raycast is not currently supported by the Oimo physics plugin"),this._raycastResult.reset(D,w),this._raycastResult},e}();qi.a.CreateRibbon=function(D){var w=D.pathArray,N=D.closeArray||!1,F=D.closePath||!1,k=D.invertUV||!1,j=Math.floor(w[0].length/2),z=D.offset||j;z=z>j?j:Math.floor(z);var G,H,X,q,Z=0===D.sideOrientation?0:D.sideOrientation||qi.a.DEFAULTSIDE,J=D.uvs,$=D.colors,te=[],ie=[],oe=[],ce=[],he=[],fe=[],pe=[],_e=[],ve=[],ye=[];if(w.length<2){var be=[],Te=[];for(X=0;X<w[0].length-z;X++)be.push(w[0][X]),Te.push(w[0][X+z]);w=[be,Te]}var Ee,Se,Me,xe,Ae,Pe=0,Oe=F?1:0;for(G=w[0].length,H=0;H<w.length;H++){for(pe[H]=0,he[H]=[0],G=G<(Se=(Ee=w[H]).length)?G:Se,q=0;q<Se;)te.push(Ee[q].x,Ee[q].y,Ee[q].z),q>0&&(Me=Ee[q].subtract(Ee[q-1]).length()+pe[H],he[H].push(Me),pe[H]=Me),q++;F&&(q--,te.push(Ee[0].x,Ee[0].y,Ee[0].z),Me=Ee[q].subtract(Ee[0]).length()+pe[H],he[H].push(Me),pe[H]=Me),ve[H]=Se+Oe,ye[H]=Pe,Pe+=Se+Oe}var Re,De,Ie=null,Le=null;for(X=0;X<G+Oe;X++){for(_e[X]=0,fe[X]=[0],H=0;H<w.length-1;H++)xe=w[H],Ae=w[H+1],X===G?(Ie=xe[0],Le=Ae[0]):(Ie=xe[X],Le=Ae[X]),Me=Le.subtract(Ie).length()+_e[X],fe[X].push(Me),_e[X]=Me;N&&Le&&Ie&&(xe=w[H],Ae=w[0],X===G&&(Le=Ae[0]),Me=Le.subtract(Ie).length()+_e[X],_e[X]=Me)}if(J)for(H=0;H<J.length;H++)ce.push(J[H].x,J[H].y);else for(H=0;H<w.length;H++)for(X=0;X<G+Oe;X++)Re=0!=pe[H]?he[H][X]/pe[H]:0,De=0!=_e[X]?fe[X][H]/_e[X]:0,k?ce.push(De,Re):ce.push(Re,De);for(var we=0,Ne=ve[H=0]-1,Fe=ve[H+1]-1,Be=Ne<Fe?Ne:Fe,Ue=ye[1]-ye[0],Ve=N?ve.length:ve.length-1;we<=Be&&H<Ve;)ie.push(we,we+Ue,we+1),ie.push(we+Ue+1,we+1,we+Ue),(we+=1)===Be&&(++H==ve.length-1?(Ue=ye[0]-ye[H],Ne=ve[H]-1,Fe=ve[0]-1):(Ue=ye[H+1]-ye[H],Ne=ve[H]-1,Fe=ve[H+1]-1),we=ye[H],Be=Ne<Fe?Ne+we:Fe+we);if(qi.a.ComputeNormals(te,ie,oe),F){var ze=0,Ge=0;for(H=0;H<w.length;H++)ze=3*ye[H],Ge=H+1<w.length?3*(ye[H+1]-1):oe.length-3,oe[ze]=.5*(oe[ze]+oe[Ge]),oe[ze+1]=.5*(oe[ze+1]+oe[Ge+1]),oe[ze+2]=.5*(oe[ze+2]+oe[Ge+2]),oe[Ge]=oe[ze],oe[Ge+1]=oe[ze+1],oe[Ge+2]=oe[ze+2]}qi.a._ComputeSides(Z,te,ie,oe,ce,D.frontUVs,D.backUVs);var Ye=null;if($){Ye=new Float32Array(4*$.length);for(var He=0;He<$.length;He++)Ye[4*He]=$[He].r,Ye[4*He+1]=$[He].g,Ye[4*He+2]=$[He].b,Ye[4*He+3]=$[He].a}var We=new qi.a,Xe=new Float32Array(te),Ke=new Float32Array(oe),Qe=new Float32Array(ce);return We.indices=ie,We.positions=Xe,We.normals=Ke,We.uvs=Qe,Ye&&We.set(Ye,Zi.b.ColorKind),F&&(We._idx=ye),We},xt.a.CreateRibbon=function(D,w,N,F,k,j,z,G,H){return void 0===N&&(N=!1),void 0===z&&(z=!1),xc.CreateRibbon(D,{pathArray:w,closeArray:N,closePath:F,offset:k,updatable:z,sideOrientation:G,instance:H},j)};var xc=function(){function e(){}return e.CreateRibbon=function(D,w,N){void 0===N&&(N=null);var F=w.pathArray,k=w.closeArray,j=w.closePath,G=xt.a._GetDefaultSideOrientation(w.sideOrientation),H=w.instance,X=w.updatable;if(H){var q=z.c.Vector3[0].setAll(Number.MAX_VALUE),Z=z.c.Vector3[1].setAll(-Number.MAX_VALUE),J=H.getVerticesData(Zi.b.PositionKind);if(function(D){for(var w=F[0].length,N=H,k=0,j=N._originalBuilderSideOrientation===xt.a.DOUBLESIDE?2:1,z=1;z<=j;++z)for(var G=0;G<F.length;++G){var X=F[G],J=X.length;w=w<J?w:J;for(var $=0;$<w;++$){var te=X[$];D[k]=te.x,D[k+1]=te.y,D[k+2]=te.z,q.minimizeInPlaceFromFloats(te.x,te.y,te.z),Z.maximizeInPlaceFromFloats(te.x,te.y,te.z),k+=3}N._creationDataStorage&&N._creationDataStorage.closePath&&(te=X[0],D[k]=te.x,D[k+1]=te.y,D[k+2]=te.z,k+=3)}}(J),H._boundingInfo?H._boundingInfo.reConstruct(q,Z,H._worldMatrix):H._boundingInfo=new yr.a(q,Z,H._worldMatrix),H.updateVerticesData(Zi.b.PositionKind,J,!1,!1),w.colors){for(var $=H.getVerticesData(Zi.b.ColorKind),te=0,ie=0;te<w.colors.length;te++,ie+=4){var oe=w.colors[te];$[ie]=oe.r,$[ie+1]=oe.g,$[ie+2]=oe.b,$[ie+3]=oe.a}H.updateVerticesData(Zi.b.ColorKind,$,!1,!1)}if(w.uvs){for(var ce=H.getVerticesData(Zi.b.UVKind),he=0;he<w.uvs.length;he++)ce[2*he]=w.uvs[he].x,ce[2*he+1]=w.uvs[he].y;H.updateVerticesData(Zi.b.UVKind,ce,!1,!1)}if(!H.areNormalsFrozen||H.isFacetDataEnabled){var fe=H.getIndices(),pe=H.getVerticesData(Zi.b.NormalKind),_e=H.isFacetDataEnabled?H.getFacetDataParameters():null;if(qi.a.ComputeNormals(J,fe,pe,_e),H._creationDataStorage&&H._creationDataStorage.closePath)for(var ve=0,ye=0,be=0;be<F.length;be++)ve=3*H._creationDataStorage.idx[be],ye=be+1<F.length?3*(H._creationDataStorage.idx[be+1]-1):pe.length-3,pe[ve]=.5*(pe[ve]+pe[ye]),pe[ve+1]=.5*(pe[ve+1]+pe[ye+1]),pe[ve+2]=.5*(pe[ve+2]+pe[ye+2]),pe[ye]=pe[ve],pe[ye+1]=pe[ve+1],pe[ye+2]=pe[ve+2];H.areNormalsFrozen||H.updateVerticesData(Zi.b.NormalKind,pe,!1,!1)}return H}var Te=new xt.a(D,N);Te._originalBuilderSideOrientation=G,Te._creationDataStorage=new xt.b;var Ee=qi.a.CreateRibbon(w);return j&&(Te._creationDataStorage.idx=Ee._idx),Te._creationDataStorage.closePath=j,Te._creationDataStorage.closeArray=k,Ee.applyToMesh(Te,X),Te},e}();xt.a.ExtrudeShape=function(D,w,N,F,k,j,z,G,H,X){void 0===z&&(z=null);var q={shape:w,path:N,scale:F,rotation:k,cap:0===j?0:j||xt.a.NO_CAP,sideOrientation:H,instance:X,updatable:G};return Pc.ExtrudeShape(D,q,z)},xt.a.ExtrudeShapeCustom=function(D,w,N,F,k,j,z,G,H,X,q,Z){var J={shape:w,path:N,scaleFunction:F,rotationFunction:k,ribbonCloseArray:j,ribbonClosePath:z,cap:0===G?0:G||xt.a.NO_CAP,sideOrientation:q,instance:Z,updatable:X};return Pc.ExtrudeShapeCustom(D,J,H)};var Pc=function(){function e(){}return e.ExtrudeShape=function(D,w,N){void 0===N&&(N=null);var F=w.path,k=w.shape,j=w.scale||1,z=w.rotation||0,G=0===w.cap?0:w.cap||xt.a.NO_CAP,H=w.updatable,X=xt.a._GetDefaultSideOrientation(w.sideOrientation),q=w.instance||null,Z=w.invertUV||!1;return e._ExtrudeShapeGeneric(D,k,F,j,z,null,null,!1,!1,G,!1,N,!!H,X,q,Z,w.frontUVs||null,w.backUVs||null)},e.ExtrudeShapeCustom=function(D,w,N){void 0===N&&(N=null);var F=w.path,k=w.shape,j=w.scaleFunction||function(){return 1},z=w.rotationFunction||function(){return 0},G=w.ribbonCloseArray||!1,H=w.ribbonClosePath||!1,X=0===w.cap?0:w.cap||xt.a.NO_CAP,q=w.updatable,Z=xt.a._GetDefaultSideOrientation(w.sideOrientation),J=w.instance,$=w.invertUV||!1;return e._ExtrudeShapeGeneric(D,k,F,null,null,j,z,G,H,X,!0,N,!!q,Z,J||null,$,w.frontUVs||null,w.backUVs||null)},e._ExtrudeShapeGeneric=function(D,w,N,F,k,j,G,H,X,q,Z,J,$,te,ie,oe,ce,he){var fe,pe,T=function(D,w,N,F,k,j,G,H,X,q){for(var Z=N.getTangents(),J=N.getNormals(),$=N.getBinormals(),te=N.getDistances(),ie=0,oe=q&&H?H:function(){return null!==j?j:0},ce=q&&G?G:function(){return null!==k?k:1},he=X===xt.a.NO_CAP||X===xt.a.CAP_END?0:2,fe=z.c.Matrix[0],pe=0;pe<w.length;pe++){for(var _e=new Array,ve=oe(pe,te[pe]),ye=ce(pe,te[pe]),be=0;be<D.length;be++){z.a.RotationAxisToRef(Z[pe],ie,fe);var Te=Z[pe].scale(D[be].z).add(J[pe].scale(D[be].x)).add($[pe].scale(D[be].y)),Ee=_e[be]?_e[be]:z.e.Zero();z.e.TransformCoordinatesToRef(Te,fe,Ee),Ee.scaleInPlace(ye).addInPlace(w[pe]),_e[be]=Ee}F[he]=_e,ie+=ve,he++}var C=function(D){var w,N=Array(),F=z.e.Zero();for(w=0;w<D.length;w++)F.addInPlace(D[w]);for(F.scaleInPlace(1/D.length),w=0;w<D.length;w++)N.push(F);return N};switch(X){case xt.a.NO_CAP:break;case xt.a.CAP_START:F[0]=C(F[2]),F[1]=F[2];break;case xt.a.CAP_END:F[he]=F[he-1],F[he+1]=C(F[he-1]);break;case xt.a.CAP_ALL:F[0]=C(F[2]),F[1]=F[2],F[he]=F[he-1],F[he+1]=C(F[he-1])}return F};if(ie){var _e=ie._creationDataStorage;return fe=_e.path3D.update(N),pe=T(w,N,_e.path3D,_e.pathArray,F,k,j,G,_e.cap,Z),xt.a.CreateRibbon("",pe,!1,!1,0,J||void 0,!1,0,ie)}pe=T(w,N,fe=new ut(N),new Array,F,k,j,G,q=q<0||q>3?0:q,Z);var ve=xc.CreateRibbon(D,{pathArray:pe,closeArray:H,closePath:X,updatable:$,sideOrientation:te,invertUV:oe,frontUVs:ce||void 0,backUVs:he||void 0},J);return ve._creationDataStorage.pathArray=pe,ve._creationDataStorage.path3D=fe,ve._creationDataStorage.cap=q,ve},e}(),Oc=function(){function e(D,w,N){var F=this;void 0===D&&(D=!0),void 0===w&&(w=Ammo),void 0===N&&(N=null),this._useDeltaForWorldStep=D,this.bjsAMMO={},this.name="AmmoJSPlugin",this._timeStep=1/60,this._fixedTimeStep=1/60,this._maxSteps=5,this._tmpQuaternion=new z.b,this._tmpContactCallbackResult=!1,this._tmpVector=new z.e,this._tmpMatrix=new z.a,"function"==typeof w?w(this.bjsAMMO):this.bjsAMMO=w,this.isSupported()?(this._collisionConfiguration=new this.bjsAMMO.btSoftBodyRigidBodyCollisionConfiguration,this._dispatcher=new this.bjsAMMO.btCollisionDispatcher(this._collisionConfiguration),this._overlappingPairCache=N||new this.bjsAMMO.btDbvtBroadphase,this._solver=new this.bjsAMMO.btSequentialImpulseConstraintSolver,this._softBodySolver=new this.bjsAMMO.btDefaultSoftBodySolver,this.world=new this.bjsAMMO.btSoftRigidDynamicsWorld(this._dispatcher,this._overlappingPairCache,this._solver,this._collisionConfiguration,this._softBodySolver),this._tmpAmmoConcreteContactResultCallback=new this.bjsAMMO.ConcreteContactResultCallback,this._tmpAmmoConcreteContactResultCallback.addSingleResult=function(){F._tmpContactCallbackResult=!0},this._raycastResult=new bc,this._tmpAmmoTransform=new this.bjsAMMO.btTransform,this._tmpAmmoTransform.setIdentity(),this._tmpAmmoQuaternion=new this.bjsAMMO.btQuaternion(0,0,0,1),this._tmpAmmoVectorA=new this.bjsAMMO.btVector3(0,0,0),this._tmpAmmoVectorB=new this.bjsAMMO.btVector3(0,0,0),this._tmpAmmoVectorC=new this.bjsAMMO.btVector3(0,0,0),this._tmpAmmoVectorD=new this.bjsAMMO.btVector3(0,0,0)):oe.a.Error("AmmoJS is not available. Please make sure you included the js file.")}return e.prototype.setGravity=function(D){this._tmpAmmoVectorA.setValue(D.x,D.y,D.z),this.world.setGravity(this._tmpAmmoVectorA),this.world.getWorldInfo().set_m_gravity(this._tmpAmmoVectorA)},e.prototype.setTimeStep=function(D){this._timeStep=D},e.prototype.setFixedTimeStep=function(D){this._fixedTimeStep=D},e.prototype.setMaxSteps=function(D){this._maxSteps=D},e.prototype.getTimeStep=function(){return this._timeStep},e.prototype._isImpostorInContact=function(D){return this._tmpContactCallbackResult=!1,this.world.contactTest(D.physicsBody,this._tmpAmmoConcreteContactResultCallback),this._tmpContactCallbackResult},e.prototype._isImpostorPairInContact=function(D,w){return this._tmpContactCallbackResult=!1,this.world.contactPairTest(D.physicsBody,w.physicsBody,this._tmpAmmoConcreteContactResultCallback),this._tmpContactCallbackResult},e.prototype._stepSimulation=function(D,w,N){if(void 0===D&&(D=1/60),void 0===w&&(w=10),void 0===N&&(N=1/60),0==w)this.world.stepSimulation(D,0);else for(;w>0&&D>0;)D-N<N?(this.world.stepSimulation(D,0),D=0):(D-=N,this.world.stepSimulation(N,0)),w--},e.prototype.executeStep=function(D,w){for(var N=0,F=w;N<F.length;N++){var k=F[N];k.soft||k.beforeStep()}this._stepSimulation(this._useDeltaForWorldStep?D:this._timeStep,this._maxSteps,this._fixedTimeStep);for(var j=0,z=w;j<z.length;j++){var G=z[j];if(G.soft?this._afterSoftStep(G):G.afterStep(),G._onPhysicsCollideCallbacks.length>0&&this._isImpostorInContact(G))for(var H=0,X=G._onPhysicsCollideCallbacks;H<X.length;H++)for(var q=0,Z=X[H].otherImpostors;q<Z.length;q++){var J=Z[q];(G.physicsBody.isActive()||J.physicsBody.isActive())&&this._isImpostorPairInContact(G,J)&&(G.onCollide({body:J.physicsBody}),J.onCollide({body:G.physicsBody}))}}},e.prototype._afterSoftStep=function(D){D.type===pc.a.RopeImpostor?this._ropeStep(D):this._softbodyOrClothStep(D)},e.prototype._ropeStep=function(D){for(var w,N,F,k,j=D.physicsBody.get_m_nodes(),G=j.size(),H=new Array,X=0;X<G;X++)N=(w=j.at(X).get_m_x()).x(),F=w.y(),k=w.z(),H.push(new z.e(N,F,k));var q=D.object,Z=D.getParam("shape");D._isFromLine?D.object=yo.a.CreateLines("lines",{points:H,instance:q}):D.object=Pc.ExtrudeShape("ext",{shape:Z,path:H,instance:q})},e.prototype._softbodyOrClothStep=function(D){var w=D.type===pc.a.ClothImpostor?1:-1,N=D.object,F=N.getVerticesData(Zi.b.PositionKind);F||(F=[]);var k=N.getVerticesData(Zi.b.NormalKind);k||(k=[]);for(var j,z,G,H,X,q,Z,J,$=F.length/3,te=D.physicsBody.get_m_nodes(),ie=0;ie<$;ie++){var oe;G=(z=(j=te.at(ie)).get_m_x()).x(),H=z.y(),X=z.z()*w,q=(oe=j.get_m_n()).x(),Z=oe.y(),J=oe.z()*w,F[3*ie]=G,F[3*ie+1]=H,F[3*ie+2]=X,k[3*ie]=q,k[3*ie+1]=Z,k[3*ie+2]=J}var ce=new qi.a;ce.positions=F,ce.normals=k,ce.uvs=N.getVerticesData(Zi.b.UVKind),ce.colors=N.getVerticesData(Zi.b.ColorKind),N&&N.getIndices&&(ce.indices=N.getIndices()),ce.applyToMesh(N)},e.prototype.applyImpulse=function(D,w,N){if(D.soft)oe.a.Warn("Cannot be applied to a soft body");else{D.physicsBody.activate();var F=this._tmpAmmoVectorA,k=this._tmpAmmoVectorB;D.object&&D.object.getWorldMatrix&&(D.object.getWorldMatrix().invertToRef(this._tmpMatrix),z.e.TransformCoordinatesToRef(N,this._tmpMatrix,this._tmpVector),N=this._tmpVector),F.setValue(N.x,N.y,N.z),k.setValue(w.x,w.y,w.z),D.physicsBody.applyImpulse(k,F)}},e.prototype.applyForce=function(D,w,N){if(D.soft)oe.a.Warn("Cannot be applied to a soft body");else{D.physicsBody.activate();var F=this._tmpAmmoVectorA,k=this._tmpAmmoVectorB;D.object&&D.object.getWorldMatrix&&(D.object.getWorldMatrix().invertToRef(this._tmpMatrix),z.e.TransformCoordinatesToRef(N,this._tmpMatrix,this._tmpVector),N=this._tmpVector),F.setValue(N.x,N.y,N.z),k.setValue(w.x,w.y,w.z),D.physicsBody.applyForce(k,F)}},e.prototype.generatePhysicsBody=function(D){if(D._pluginData.toDispose=[],D.parent)D.physicsBody&&(this.removePhysicsBody(D),D.forceUpdate());else if(D.isBodyInitRequired()){var w=this._createShape(D),N=D.getParam("mass");if(D._pluginData.mass=N,D.soft)w.get_m_cfg().set_collisions(17),w.get_m_cfg().set_kDP(D.getParam("damping")),this.bjsAMMO.castObject(w,this.bjsAMMO.btCollisionObject).getCollisionShape().setMargin(D.getParam("margin")),w.setActivationState(e.DISABLE_DEACTIVATION_FLAG),this.world.addSoftBody(w,1,-1),D.physicsBody=w,D._pluginData.toDispose.push(w),this.setBodyPressure(D,0),D.type===pc.a.SoftbodyImpostor&&this.setBodyPressure(D,D.getParam("pressure")),this.setBodyStiffness(D,D.getParam("stiffness")),this.setBodyVelocityIterations(D,D.getParam("velocityIterations")),this.setBodyPositionIterations(D,D.getParam("positionIterations"));else{var F=new this.bjsAMMO.btVector3(0,0,0),k=new this.bjsAMMO.btTransform;k.setIdentity(),0!==N&&w.calculateLocalInertia(N,F),this._tmpAmmoVectorA.setValue(D.object.position.x,D.object.position.y,D.object.position.z),this._tmpAmmoQuaternion.setValue(D.object.rotationQuaternion.x,D.object.rotationQuaternion.y,D.object.rotationQuaternion.z,D.object.rotationQuaternion.w),k.setOrigin(this._tmpAmmoVectorA),k.setRotation(this._tmpAmmoQuaternion);var j=new this.bjsAMMO.btDefaultMotionState(k),z=new this.bjsAMMO.btRigidBodyConstructionInfo(N,j,w,F),G=new this.bjsAMMO.btRigidBody(z);0===N&&(G.setCollisionFlags(G.getCollisionFlags()|e.KINEMATIC_FLAG),G.setActivationState(e.DISABLE_DEACTIVATION_FLAG)),D.type!=pc.a.NoImpostor||w.getChildShape||G.setCollisionFlags(G.getCollisionFlags()|e.DISABLE_COLLISION_FLAG),this.world.addRigidBody(G),D.physicsBody=G,D._pluginData.toDispose=D._pluginData.toDispose.concat([G,z,j,k,F,w])}this.setBodyRestitution(D,D.getParam("restitution")),this.setBodyFriction(D,D.getParam("friction"))}},e.prototype.removePhysicsBody=function(D){var w=this;this.world&&(D.soft?this.world.removeSoftBody(D.physicsBody):this.world.removeRigidBody(D.physicsBody),D._pluginData&&(D._pluginData.toDispose.forEach((function(D){w.bjsAMMO.destroy(D)})),D._pluginData.toDispose=[]))},e.prototype.generateJoint=function(D){var w=D.mainImpostor.physicsBody,N=D.connectedImpostor.physicsBody;if(w&&N){var F,k=D.joint.jointData;switch(k.mainPivot||(k.mainPivot=new z.e(0,0,0)),k.connectedPivot||(k.connectedPivot=new z.e(0,0,0)),D.joint.type){case mc.e.DistanceJoint:var j=k.maxDistance;j&&(k.mainPivot=new z.e(0,-j/2,0),k.connectedPivot=new z.e(0,j/2,0)),F=new this.bjsAMMO.btPoint2PointConstraint(w,N,new this.bjsAMMO.btVector3(k.mainPivot.x,k.mainPivot.y,k.mainPivot.z),new this.bjsAMMO.btVector3(k.connectedPivot.x,k.connectedPivot.y,k.connectedPivot.z));break;case mc.e.HingeJoint:k.mainAxis||(k.mainAxis=new z.e(0,0,0)),k.connectedAxis||(k.connectedAxis=new z.e(0,0,0));var G=new this.bjsAMMO.btVector3(k.mainAxis.x,k.mainAxis.y,k.mainAxis.z),H=new this.bjsAMMO.btVector3(k.connectedAxis.x,k.connectedAxis.y,k.connectedAxis.z);F=new this.bjsAMMO.btHingeConstraint(w,N,new this.bjsAMMO.btVector3(k.mainPivot.x,k.mainPivot.y,k.mainPivot.z),new this.bjsAMMO.btVector3(k.connectedPivot.x,k.connectedPivot.y,k.connectedPivot.z),G,H);break;case mc.e.BallAndSocketJoint:F=new this.bjsAMMO.btPoint2PointConstraint(w,N,new this.bjsAMMO.btVector3(k.mainPivot.x,k.mainPivot.y,k.mainPivot.z),new this.bjsAMMO.btVector3(k.connectedPivot.x,k.connectedPivot.y,k.connectedPivot.z));break;default:oe.a.Warn("JointType not currently supported by the Ammo plugin, falling back to PhysicsJoint.BallAndSocketJoint"),F=new this.bjsAMMO.btPoint2PointConstraint(w,N,new this.bjsAMMO.btVector3(k.mainPivot.x,k.mainPivot.y,k.mainPivot.z),new this.bjsAMMO.btVector3(k.connectedPivot.x,k.connectedPivot.y,k.connectedPivot.z))}this.world.addConstraint(F,!D.joint.jointData.collision),D.joint.physicsJoint=F}},e.prototype.removeJoint=function(D){this.world&&this.world.removeConstraint(D.joint.physicsJoint)},e.prototype._addMeshVerts=function(D,w,N){var F=this,k=0;if(N&&N.getIndices&&N.getWorldMatrix&&N.getChildMeshes){var j=N.getIndices();j||(j=[]);var G=N.getVerticesData(Zi.b.PositionKind);G||(G=[]),N.computeWorldMatrix(!1);for(var H=j.length/3,X=0;X<H;X++){for(var q=[],Z=0;Z<3;Z++){var J,$=new z.e(G[3*j[3*X+Z]+0],G[3*j[3*X+Z]+1],G[3*j[3*X+Z]+2]);z.a.ScalingToRef(N.scaling.x,N.scaling.y,N.scaling.z,this._tmpMatrix),$=z.e.TransformCoordinates($,this._tmpMatrix),(J=0==Z?this._tmpAmmoVectorA:1==Z?this._tmpAmmoVectorB:this._tmpAmmoVectorC).setValue($.x,$.y,$.z),q.push(J)}D.addTriangle(q[0],q[1],q[2]),k++}N.getChildMeshes().forEach((function(N){k+=F._addMeshVerts(D,w,N)}))}return k},e.prototype._softVertexData=function(D){var w=D.object;if(w&&w.getIndices&&w.getWorldMatrix&&w.getChildMeshes){var N=w.getIndices();N||(N=[]);var F=w.getVerticesData(Zi.b.PositionKind);F||(F=[]);var k=w.getVerticesData(Zi.b.NormalKind);k||(k=[]),w.computeWorldMatrix(!1);for(var j=[],G=[],H=0;H<F.length;H+=3){var X=new z.e(F[H],F[H+1],F[H+2]),q=new z.e(k[H],k[H+1],k[H+2]);X=z.e.TransformCoordinates(X,w.getWorldMatrix()),q=z.e.TransformNormal(q,w.getWorldMatrix()),j.push(X.x,X.y,X.z),G.push(q.x,q.y,q.z)}var Z=new qi.a;return Z.positions=j,Z.normals=G,Z.uvs=w.getVerticesData(Zi.b.UVKind),Z.colors=w.getVerticesData(Zi.b.ColorKind),w&&w.getIndices&&(Z.indices=w.getIndices()),Z.applyToMesh(w),w.position=z.e.Zero(),w.rotationQuaternion=null,w.rotation=z.e.Zero(),w.computeWorldMatrix(!0),Z}return qi.a.ExtractFromMesh(w)},e.prototype._createSoftbody=function(D){var w=D.object;if(w&&w.getIndices){var N=w.getIndices();N||(N=[]);var F=this._softVertexData(D),k=F.positions,j=F.normals;if(null===k||null===j)return new this.bjsAMMO.btCompoundShape;for(var G=[],H=[],X=0;X<k.length;X+=3){var q=new z.e(k[X],k[X+1],k[X+2]),Z=new z.e(j[X],j[X+1],j[X+2]);G.push(q.x,q.y,-q.z),H.push(Z.x,Z.y,-Z.z)}var J=(new this.bjsAMMO.btSoftBodyHelpers).CreateFromTriMesh(this.world.getWorldInfo(),G,w.getIndices(),N.length/3,!0),$=k.length/3,te=J.get_m_nodes();for(X=0;X<$;X++){var ie;(ie=te.at(X).get_m_n()).setX(H[3*X]),ie.setY(H[3*X+1]),ie.setZ(H[3*X+2])}return J}},e.prototype._createCloth=function(D){var w=D.object;if(w&&w.getIndices){var N=w.getIndices();N||(N=[]);var F=this._softVertexData(D),k=F.positions,j=F.normals;if(null===k||null===j)return new this.bjsAMMO.btCompoundShape;var z=k.length,G=Math.sqrt(z/3);D.segments=G;var H=G-1;return this._tmpAmmoVectorA.setValue(k[0],k[1],k[2]),this._tmpAmmoVectorB.setValue(k[3*H],k[3*H+1],k[3*H+2]),this._tmpAmmoVectorD.setValue(k[z-3],k[z-2],k[z-1]),this._tmpAmmoVectorC.setValue(k[z-3-3*H],k[z-2-3*H],k[z-1-3*H]),(new this.bjsAMMO.btSoftBodyHelpers).CreatePatch(this.world.getWorldInfo(),this._tmpAmmoVectorA,this._tmpAmmoVectorB,this._tmpAmmoVectorC,this._tmpAmmoVectorD,G,G,D.getParam("fixedPoints"),!0)}},e.prototype._createRope=function(D){var w,N,F=this._softVertexData(D),k=F.positions,j=F.normals;if(null===k||null===j)return new this.bjsAMMO.btCompoundShape;if(F.applyToMesh(D.object,!0),D._isFromLine=!0,0===j.map((function(D){return D*D})).reduce((function(D,w){return D+w})))N=(w=k.length)/3-1,this._tmpAmmoVectorA.setValue(k[0],k[1],k[2]),this._tmpAmmoVectorB.setValue(k[w-3],k[w-2],k[w-1]);else{D._isFromLine=!1;var z=D.getParam("path");if(null===D.getParam("shape"))return oe.a.Warn("No shape available for extruded mesh"),new this.bjsAMMO.btCompoundShape;if(k.length%(3*z.length)!=0)return oe.a.Warn("Path does not match extrusion"),new this.bjsAMMO.btCompoundShape;N=(w=z.length)-1,this._tmpAmmoVectorA.setValue(z[0].x,z[0].y,z[0].z),this._tmpAmmoVectorB.setValue(z[w-1].x,z[w-1].y,z[w-1].z)}D.segments=N;var G=D.getParam("fixedPoints");G=G>3?3:G;var H=(new this.bjsAMMO.btSoftBodyHelpers).CreateRope(this.world.getWorldInfo(),this._tmpAmmoVectorA,this._tmpAmmoVectorB,N-1,G);return H.get_m_cfg().set_collisions(17),H},e.prototype._createCustom=function(D){var w=null;return this.onCreateCustomShape&&(w=this.onCreateCustomShape(D)),null==w&&(w=new this.bjsAMMO.btCompoundShape),w},e.prototype._addHullVerts=function(D,w,N){var F=this,k=0;if(N&&N.getIndices&&N.getWorldMatrix&&N.getChildMeshes){var j=N.getIndices();j||(j=[]);var G=N.getVerticesData(Zi.b.PositionKind);G||(G=[]),N.computeWorldMatrix(!1);for(var H=j.length/3,X=0;X<H;X++){for(var q=[],Z=0;Z<3;Z++){var J,$=new z.e(G[3*j[3*X+Z]+0],G[3*j[3*X+Z]+1],G[3*j[3*X+Z]+2]);z.a.ScalingToRef(N.scaling.x,N.scaling.y,N.scaling.z,this._tmpMatrix),$=z.e.TransformCoordinates($,this._tmpMatrix),(J=0==Z?this._tmpAmmoVectorA:1==Z?this._tmpAmmoVectorB:this._tmpAmmoVectorC).setValue($.x,$.y,$.z),q.push(J)}D.addPoint(q[0],!0),D.addPoint(q[1],!0),D.addPoint(q[2],!0),k++}N.getChildMeshes().forEach((function(N){k+=F._addHullVerts(D,w,N)}))}return k},e.prototype._createShape=function(D,w){var N=this;void 0===w&&(w=!1);var F,k=D.object,j=D.getObjectExtendSize();if(!w){var G=D.object.getChildMeshes?D.object.getChildMeshes(!0):[];F=new this.bjsAMMO.btCompoundShape;var H=0;if(G.forEach((function(D){var w=D.getPhysicsImpostor();if(w){if(w.type==pc.a.MeshImpostor)throw"A child MeshImpostor is not supported. Only primitive impostors are supported as children (eg. box or sphere)";var k=N._createShape(w),j=D.parent.getWorldMatrix().clone(),G=new z.e;j.decompose(G),N._tmpAmmoTransform.getOrigin().setValue(D.position.x*G.x,D.position.y*G.y,D.position.z*G.z),N._tmpAmmoQuaternion.setValue(D.rotationQuaternion.x,D.rotationQuaternion.y,D.rotationQuaternion.z,D.rotationQuaternion.w),N._tmpAmmoTransform.setRotation(N._tmpAmmoQuaternion),F.addChildShape(N._tmpAmmoTransform,k),w.dispose(),H++}})),H>0){if(D.type!=pc.a.NoImpostor){var X=this._createShape(D,!0);X&&(this._tmpAmmoTransform.getOrigin().setValue(0,0,0),this._tmpAmmoQuaternion.setValue(0,0,0,1),this._tmpAmmoTransform.setRotation(this._tmpAmmoQuaternion),F.addChildShape(this._tmpAmmoTransform,X))}return F}this.bjsAMMO.destroy(F),F=null}switch(D.type){case pc.a.SphereImpostor:if(De.a.WithinEpsilon(j.x,j.y,1e-4)&&De.a.WithinEpsilon(j.x,j.z,1e-4))F=new this.bjsAMMO.btSphereShape(j.x/2);else{var q=[new this.bjsAMMO.btVector3(0,0,0)];(F=new this.bjsAMMO.btMultiSphereShape(q,[1],1)).setLocalScaling(new this.bjsAMMO.btVector3(j.x/2,j.y/2,j.z/2))}break;case pc.a.CapsuleImpostor:F=new this.bjsAMMO.btCapsuleShape(j.x/2,j.y/2);break;case pc.a.CylinderImpostor:this._tmpAmmoVectorA.setValue(j.x/2,j.y/2,j.z/2),F=new this.bjsAMMO.btCylinderShape(this._tmpAmmoVectorA);break;case pc.a.PlaneImpostor:case pc.a.BoxImpostor:this._tmpAmmoVectorA.setValue(j.x/2,j.y/2,j.z/2),F=new this.bjsAMMO.btBoxShape(this._tmpAmmoVectorA);break;case pc.a.MeshImpostor:if(0==D.getParam("mass")){var Z=new this.bjsAMMO.btTriangleMesh;D._pluginData.toDispose.push(Z);var J=this._addMeshVerts(Z,k,k);F=0==J?new this.bjsAMMO.btCompoundShape:new this.bjsAMMO.btBvhTriangleMeshShape(Z);break}case pc.a.ConvexHullImpostor:var $=new this.bjsAMMO.btConvexHullShape;0==(J=this._addHullVerts($,k,k))?(D._pluginData.toDispose.push($),F=new this.bjsAMMO.btCompoundShape):F=$;break;case pc.a.NoImpostor:F=new this.bjsAMMO.btSphereShape(j.x/2);break;case pc.a.CustomImpostor:F=this._createCustom(D);break;case pc.a.SoftbodyImpostor:F=this._createSoftbody(D);break;case pc.a.ClothImpostor:F=this._createCloth(D);break;case pc.a.RopeImpostor:F=this._createRope(D);break;default:oe.a.Warn("The impostor type is not currently supported by the ammo plugin.")}return F},e.prototype.setTransformationFromPhysicsBody=function(D){D.physicsBody.getMotionState().getWorldTransform(this._tmpAmmoTransform),D.object.position.set(this._tmpAmmoTransform.getOrigin().x(),this._tmpAmmoTransform.getOrigin().y(),this._tmpAmmoTransform.getOrigin().z()),D.object.rotationQuaternion?D.object.rotationQuaternion.set(this._tmpAmmoTransform.getRotation().x(),this._tmpAmmoTransform.getRotation().y(),this._tmpAmmoTransform.getRotation().z(),this._tmpAmmoTransform.getRotation().w()):D.object.rotation&&(this._tmpQuaternion.set(this._tmpAmmoTransform.getRotation().x(),this._tmpAmmoTransform.getRotation().y(),this._tmpAmmoTransform.getRotation().z(),this._tmpAmmoTransform.getRotation().w()),this._tmpQuaternion.toEulerAnglesToRef(D.object.rotation))},e.prototype.setPhysicsBodyTransformation=function(D,w,N){var F=D.physicsBody.getWorldTransform();if(F.getOrigin().x()!=w.x||F.getOrigin().y()!=w.y||F.getOrigin().z()!=w.z||F.getRotation().x()!=N.x||F.getRotation().y()!=N.y||F.getRotation().z()!=N.z||F.getRotation().w()!=N.w)if(this._tmpAmmoVectorA.setValue(w.x,w.y,w.z),F.setOrigin(this._tmpAmmoVectorA),this._tmpAmmoQuaternion.setValue(N.x,N.y,N.z,N.w),F.setRotation(this._tmpAmmoQuaternion),D.physicsBody.setWorldTransform(F),0==D.mass){var k=D.physicsBody.getMotionState();k&&k.setWorldTransform(F)}else D.physicsBody.activate()},e.prototype.isSupported=function(){return void 0!==this.bjsAMMO},e.prototype.setLinearVelocity=function(D,w){this._tmpAmmoVectorA.setValue(w.x,w.y,w.z),D.soft?D.physicsBody.linearVelocity(this._tmpAmmoVectorA):D.physicsBody.setLinearVelocity(this._tmpAmmoVectorA)},e.prototype.setAngularVelocity=function(D,w){this._tmpAmmoVectorA.setValue(w.x,w.y,w.z),D.soft?D.physicsBody.angularVelocity(this._tmpAmmoVectorA):D.physicsBody.setAngularVelocity(this._tmpAmmoVectorA)},e.prototype.getLinearVelocity=function(D){if(D.soft)var w=D.physicsBody.linearVelocity();else w=D.physicsBody.getLinearVelocity();if(!w)return null;var N=new z.e(w.x(),w.y(),w.z());return this.bjsAMMO.destroy(w),N},e.prototype.getAngularVelocity=function(D){if(D.soft)var w=D.physicsBody.angularVelocity();else w=D.physicsBody.getAngularVelocity();if(!w)return null;var N=new z.e(w.x(),w.y(),w.z());return this.bjsAMMO.destroy(w),N},e.prototype.setBodyMass=function(D,w){D.soft?D.physicsBody.setTotalMass(w,!1):D.physicsBody.setMassProps(w),D._pluginData.mass=w},e.prototype.getBodyMass=function(D){return D._pluginData.mass||0},e.prototype.getBodyFriction=function(D){return D._pluginData.friction||0},e.prototype.setBodyFriction=function(D,w){D.soft?D.physicsBody.get_m_cfg().set_kDF(w):D.physicsBody.setFriction(w),D._pluginData.friction=w},e.prototype.getBodyRestitution=function(D){return D._pluginData.restitution||0},e.prototype.setBodyRestitution=function(D,w){D.physicsBody.setRestitution(w),D._pluginData.restitution=w},e.prototype.getBodyPressure=function(D){return D.soft?D._pluginData.pressure||0:(oe.a.Warn("Pressure is not a property of a rigid body"),0)},e.prototype.setBodyPressure=function(D,w){D.soft?D.type===pc.a.SoftbodyImpostor?(D.physicsBody.get_m_cfg().set_kPR(w),D._pluginData.pressure=w):(D.physicsBody.get_m_cfg().set_kPR(0),D._pluginData.pressure=0):oe.a.Warn("Pressure can only be applied to a softbody")},e.prototype.getBodyStiffness=function(D){return D.soft?D._pluginData.stiffness||0:(oe.a.Warn("Stiffness is not a property of a rigid body"),0)},e.prototype.setBodyStiffness=function(D,w){D.soft?(w=(w=w<0?0:w)>1?1:w,D.physicsBody.get_m_materials().at(0).set_m_kLST(w),D._pluginData.stiffness=w):oe.a.Warn("Stiffness cannot be applied to a rigid body")},e.prototype.getBodyVelocityIterations=function(D){return D.soft?D._pluginData.velocityIterations||0:(oe.a.Warn("Velocity iterations is not a property of a rigid body"),0)},e.prototype.setBodyVelocityIterations=function(D,w){D.soft?(w=w<0?0:w,D.physicsBody.get_m_cfg().set_viterations(w),D._pluginData.velocityIterations=w):oe.a.Warn("Velocity iterations cannot be applied to a rigid body")},e.prototype.getBodyPositionIterations=function(D){return D.soft?D._pluginData.positionIterations||0:(oe.a.Warn("Position iterations is not a property of a rigid body"),0)},e.prototype.setBodyPositionIterations=function(D,w){D.soft?(w=w<0?0:w,D.physicsBody.get_m_cfg().set_piterations(w),D._pluginData.positionIterations=w):oe.a.Warn("Position iterations cannot be applied to a rigid body")},e.prototype.appendAnchor=function(D,w,N,F,k,j){void 0===k&&(k=1),void 0===j&&(j=!1);var z=D.segments,G=Math.round((z-1)*N)+z*(z-1-Math.round((z-1)*F));D.physicsBody.appendAnchor(G,w.physicsBody,j,k)},e.prototype.appendHook=function(D,w,N,F,k){void 0===F&&(F=1),void 0===k&&(k=!1);var j=Math.round(D.segments*N);D.physicsBody.appendAnchor(j,w.physicsBody,k,F)},e.prototype.sleepBody=function(D){oe.a.Warn("sleepBody is not currently supported by the Ammo physics plugin")},e.prototype.wakeUpBody=function(D){D.physicsBody.activate()},e.prototype.updateDistanceJoint=function(D,w,N){oe.a.Warn("updateDistanceJoint is not currently supported by the Ammo physics plugin")},e.prototype.setMotor=function(D,w,N,F){D.physicsJoint.enableAngularMotor(!0,w,N)},e.prototype.setLimit=function(D,w,N){oe.a.Warn("setLimit is not currently supported by the Ammo physics plugin")},e.prototype.syncMeshWithImpostor=function(D,w){w.physicsBody.getMotionState().getWorldTransform(this._tmpAmmoTransform),D.position.x=this._tmpAmmoTransform.getOrigin().x(),D.position.y=this._tmpAmmoTransform.getOrigin().y(),D.position.z=this._tmpAmmoTransform.getOrigin().z(),D.rotationQuaternion&&(D.rotationQuaternion.x=this._tmpAmmoTransform.getRotation().x(),D.rotationQuaternion.y=this._tmpAmmoTransform.getRotation().y(),D.rotationQuaternion.z=this._tmpAmmoTransform.getRotation().z(),D.rotationQuaternion.w=this._tmpAmmoTransform.getRotation().w())},e.prototype.getRadius=function(D){return D.getObjectExtendSize().x/2},e.prototype.getBoxSizeToRef=function(D,w){var N=D.getObjectExtendSize();w.x=N.x,w.y=N.y,w.z=N.z},e.prototype.dispose=function(){this.bjsAMMO.destroy(this.world),this.bjsAMMO.destroy(this._solver),this.bjsAMMO.destroy(this._overlappingPairCache),this.bjsAMMO.destroy(this._dispatcher),this.bjsAMMO.destroy(this._collisionConfiguration),this.bjsAMMO.destroy(this._tmpAmmoVectorA),this.bjsAMMO.destroy(this._tmpAmmoVectorB),this.bjsAMMO.destroy(this._tmpAmmoVectorC),this.bjsAMMO.destroy(this._tmpAmmoTransform),this.bjsAMMO.destroy(this._tmpAmmoQuaternion),this.bjsAMMO.destroy(this._tmpAmmoConcreteContactResultCallback),this.world=null},e.prototype.raycast=function(D,w){this._tmpAmmoVectorRCA=new this.bjsAMMO.btVector3(D.x,D.y,D.z),this._tmpAmmoVectorRCB=new this.bjsAMMO.btVector3(w.x,w.y,w.z);var N=new this.bjsAMMO.ClosestRayResultCallback(this._tmpAmmoVectorRCA,this._tmpAmmoVectorRCB);return this.world.rayTest(this._tmpAmmoVectorRCA,this._tmpAmmoVectorRCB,N),this._raycastResult.reset(D,w),N.hasHit()&&(this._raycastResult.setHitData({x:N.get_m_hitNormalWorld().x(),y:N.get_m_hitNormalWorld().y(),z:N.get_m_hitNormalWorld().z()},{x:N.get_m_hitPointWorld().x(),y:N.get_m_hitPointWorld().y(),z:N.get_m_hitPointWorld().z()}),this._raycastResult.calculateHitDistance()),this.bjsAMMO.destroy(N),this.bjsAMMO.destroy(this._tmpAmmoVectorRCA),this.bjsAMMO.destroy(this._tmpAmmoVectorRCB),this._raycastResult},e.DISABLE_COLLISION_FLAG=4,e.KINEMATIC_FLAG=2,e.DISABLE_DEACTIVATION_FLAG=4,e}();F.a.prototype.removeReflectionProbe=function(D){if(!this.reflectionProbes)return-1;var w=this.reflectionProbes.indexOf(D);return-1!==w&&this.reflectionProbes.splice(w,1),w},F.a.prototype.addReflectionProbe=function(D){this.reflectionProbes||(this.reflectionProbes=[]),this.reflectionProbes.push(D)};var Dc=function(){function e(D,w,N,F,k){var j=this;void 0===F&&(F=!0),void 0===k&&(k=!1),this.name=D,this._viewMatrix=z.a.Identity(),this._target=z.e.Zero(),this._add=z.e.Zero(),this._invertYAxis=!1,this.position=z.e.Zero(),this._scene=N,this._scene.reflectionProbes||(this._scene.reflectionProbes=new Array),this._scene.reflectionProbes.push(this),this._renderTargetTexture=new Li(D,w,N,F,!0,k?ce.a.TEXTURETYPE_FLOAT:ce.a.TEXTURETYPE_UNSIGNED_INT,!0),this._renderTargetTexture.onBeforeRenderObservable.add((function(D){switch(D){case 0:j._add.copyFromFloats(1,0,0);break;case 1:j._add.copyFromFloats(-1,0,0);break;case 2:j._add.copyFromFloats(0,j._invertYAxis?1:-1,0);break;case 3:j._add.copyFromFloats(0,j._invertYAxis?-1:1,0);break;case 4:j._add.copyFromFloats(0,0,1);break;case 5:j._add.copyFromFloats(0,0,-1)}j._attachedMesh&&j.position.copyFrom(j._attachedMesh.getAbsolutePosition()),j.position.addToRef(j._add,j._target),z.a.LookAtLHToRef(j.position,j._target,z.e.Up(),j._viewMatrix),N.activeCamera&&(j._projectionMatrix=z.a.PerspectiveFovLH(Math.PI/2,1,N.activeCamera.minZ,N.activeCamera.maxZ),N.setTransformMatrix(j._viewMatrix,j._projectionMatrix)),N._forcedViewPosition=j.position})),this._renderTargetTexture.onAfterUnbindObservable.add((function(){N._forcedViewPosition=null,N.updateTransformMatrix(!0)}))}return Object.defineProperty(e.prototype,"samples",{get:function(){return this._renderTargetTexture.samples},set:function(D){this._renderTargetTexture.samples=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"refreshRate",{get:function(){return this._renderTargetTexture.refreshRate},set:function(D){this._renderTargetTexture.refreshRate=D},enumerable:!0,configurable:!0}),e.prototype.getScene=function(){return this._scene},Object.defineProperty(e.prototype,"cubeTexture",{get:function(){return this._renderTargetTexture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderList",{get:function(){return this._renderTargetTexture.renderList},enumerable:!0,configurable:!0}),e.prototype.attachToMesh=function(D){this._attachedMesh=D},e.prototype.setRenderingAutoClearDepthStencil=function(D,w){this._renderTargetTexture.setRenderingAutoClearDepthStencil(D,w)},e.prototype.dispose=function(){var D=this._scene.reflectionProbes.indexOf(this);-1!==D&&this._scene.reflectionProbes.splice(D,1),this._renderTargetTexture&&(this._renderTargetTexture.dispose(),this._renderTargetTexture=null)},e.prototype.toString=function(D){var w="Name: "+this.name;return D&&(w+=", position: "+this.position.toString(),this._attachedMesh&&(w+=", attached mesh: "+this._attachedMesh.name)),w},e.prototype.getClassName=function(){return"ReflectionProbe"},e.prototype.serialize=function(){var D=Ie.a.Serialize(this,this._renderTargetTexture.serialize());return D.isReflectionProbe=!0,D},e.Parse=function(D,w,N){var F=null;if(w.reflectionProbes)for(var k=0;k<w.reflectionProbes.length;k++){var j=w.reflectionProbes[k];if(j.name===D.name){F=j;break}}return(F=Ie.a.Parse((function(){return F||new e(D.name,D.renderTargetSize,w,D._generateMipMaps)}),D,w,N)).cubeTexture._waitingRenderList=D.renderList,D._attachedMesh&&F.attachToMesh(w.getMeshByID(D._attachedMesh)),F},Object(Z.c)([Object(Ie.k)()],e.prototype,"_attachedMesh",void 0),Object(Z.c)([Object(Ie.o)()],e.prototype,"position",void 0),e}(),wc=function(){function e(){}return e.LoaderInjectedPhysicsEngine=void 0,e}(),Ms=function(D,w,N,F){for(var k=0,j=w.materials.length;k<j;k++){var z=w.materials[k];if(z.id===D)return Ps.a.Parse(z,N,F)}return null},Is=function(D,w,N){for(var F in w)if(D.name===w[F])return N.push(D.id),!0;return!(!D.parentId||-1===N.indexOf(D.parentId)||(N.push(D.id),0))},Ds=function(D,w){return D+" of "+(w?w.file+" from "+w.name+" version: "+w.version+", exporter version: "+w.exporter_version:"unknown")},ws=function(D,w){var N=w;if(w._waitingData.lods){if(w._waitingData.lods.ids&&w._waitingData.lods.ids.length>0){var F=w._waitingData.lods.ids,k=N.isEnabled(!1);if(w._waitingData.lods.distances){var j=w._waitingData.lods.distances;if(j.length>=F.length){var z=j.length>F.length?j[j.length-1]:0;N.setEnabled(!1);for(var G=0;G<F.length;G++){var H=F[G],X=D.getMeshByID(H);null!=X&&N.addLODLevel(j[G],X)}z>0&&N.addLODLevel(z,null),!0===k&&N.setEnabled(!0)}else Dt.b.Warn("Invalid level of detail distances for "+w.name)}}w._waitingData.lods=null}},Ls=function(D,w,N,k,j){void 0===j&&(j=!1);var z=new Pt(D),G="importScene has failed JSON parse";try{var X=JSON.parse(w);G="";var q,Z,J=ro.loggingLevel===ro.DETAILED_LOGGING;if(void 0!==X.environmentTexture&&null!==X.environmentTexture){var $=void 0===X.isPBR||X.isPBR;if(X.environmentTextureType&&"BABYLON.HDRCubeTexture"===X.environmentTextureType){var te=X.environmentTextureSize?X.environmentTextureSize:128,ie=new uc((X.environmentTexture.match(/https?:\/\//g)?"":N)+X.environmentTexture,D,te,!0,!$);X.environmentTextureRotationY&&(ie.rotationY=X.environmentTextureRotationY),D.environmentTexture=ie}else if(Uo.a.EndsWith(X.environmentTexture,".env")){var ce=new Vo((X.environmentTexture.match(/https?:\/\//g)?"":N)+X.environmentTexture,D);X.environmentTextureRotationY&&(ce.rotationY=X.environmentTextureRotationY),D.environmentTexture=ce}else{var he=Vo.CreateFromPrefilteredData((X.environmentTexture.match(/https?:\/\//g)?"":N)+X.environmentTexture,D);X.environmentTextureRotationY&&(he.rotationY=X.environmentTextureRotationY),D.environmentTexture=he}if(!0===X.createDefaultSkybox){var fe=void 0!==D.activeCamera&&null!==D.activeCamera?(D.activeCamera.maxZ-D.activeCamera.minZ)/2:1e3,pe=X.skyboxBlurLevel||0;D.createDefaultSkybox(D.environmentTexture,$,fe,pe)}z.environmentTexture=D.environmentTexture}if(void 0!==X.environmentIntensity&&null!==X.environmentIntensity&&(D.environmentIntensity=X.environmentIntensity),void 0!==X.lights&&null!==X.lights)for(q=0,Z=X.lights.length;q<Z;q++){var _e=X.lights[q],ve=Ro.a.Parse(_e,D);ve&&(z.lights.push(ve),G+=0===q?"\n\tLights:":"",G+="\n\t\t"+ve.toString(J))}if(void 0!==X.reflectionProbes&&null!==X.reflectionProbes)for(q=0,Z=X.reflectionProbes.length;q<Z;q++){var ye=X.reflectionProbes[q],be=Dc.Parse(ye,D,N);be&&(z.reflectionProbes.push(be),G+=0===q?"\n\tReflection Probes:":"",G+="\n\t\t"+be.toString(J))}if(void 0!==X.animations&&null!==X.animations)for(q=0,Z=X.animations.length;q<Z;q++){var Te=X.animations[q],Ee=H.a.GetClass("BABYLON.Animation");if(Ee){var Se=Ee.Parse(Te);D.animations.push(Se),z.animations.push(Se),G+=0===q?"\n\tAnimations:":"",G+="\n\t\t"+Se.toString(J)}}if(void 0!==X.materials&&null!==X.materials)for(q=0,Z=X.materials.length;q<Z;q++){var Me=X.materials[q],xe=Ps.a.Parse(Me,D,N);xe&&(z.materials.push(xe),G+=0===q?"\n\tMaterials:":"",G+="\n\t\t"+xe.toString(J),xe.getActiveTextures().forEach((function(D){-1==z.textures.indexOf(D)&&z.textures.push(D)})))}if(void 0!==X.multiMaterials&&null!==X.multiMaterials)for(q=0,Z=X.multiMaterials.length;q<Z;q++){var Pe=X.multiMaterials[q],Oe=rc.a.ParseMultiMaterial(Pe,D);z.multiMaterials.push(Oe),G+=0===q?"\n\tMultiMaterials:":"",G+="\n\t\t"+Oe.toString(J),Oe.getActiveTextures().forEach((function(D){-1==z.textures.indexOf(D)&&z.textures.push(D)}))}if(void 0!==X.morphTargetManagers&&null!==X.morphTargetManagers)for(var Re=0,De=X.morphTargetManagers;Re<De.length;Re++){var Ie=De[Re];z.morphTargetManagers.push(fc.Parse(Ie,D))}if(void 0!==X.skeletons&&null!==X.skeletons)for(q=0,Z=X.skeletons.length;q<Z;q++){var Le=X.skeletons[q],we=tn.Parse(Le,D);z.skeletons.push(we),G+=0===q?"\n\tSkeletons:":"",G+="\n\t\t"+we.toString(J)}var Ne=X.geometries;if(null!=Ne){var Fe=new Array,Be=Ne.vertexData;if(null!=Be)for(q=0,Z=Be.length;q<Z;q++){var Ue=Be[q];Fe.push(ic.a.Parse(Ue,D,N))}Fe.forEach((function(D){D&&z.geometries.push(D)}))}if(void 0!==X.transformNodes&&null!==X.transformNodes)for(q=0,Z=X.transformNodes.length;q<Z;q++){var Ve=X.transformNodes[q],ze=So.a.Parse(Ve,D,N);z.transformNodes.push(ze)}if(void 0!==X.meshes&&null!==X.meshes)for(q=0,Z=X.meshes.length;q<Z;q++){var Ge=X.meshes[q],Ye=xt.a.Parse(Ge,D,N);z.meshes.push(Ye),G+=0===q?"\n\tMeshes:":"",G+="\n\t\t"+Ye.toString(J)}if(void 0!==X.cameras&&null!==X.cameras)for(q=0,Z=X.cameras.length;q<Z;q++){var He=X.cameras[q],We=Xt.a.Parse(He,D);z.cameras.push(We),G+=0===q?"\n\tCameras:":"",G+="\n\t\t"+We.toString(J)}if(void 0!==X.animationGroups&&null!==X.animationGroups)for(q=0,Z=X.animationGroups.length;q<Z;q++){var Xe=X.animationGroups[q],Ke=tt.Parse(Xe,D);z.animationGroups.push(Ke),G+=0===q?"\n\tAnimationGroups:":"",G+="\n\t\t"+Ke.toString(J)}for(q=0,Z=D.cameras.length;q<Z;q++)(We=D.cameras[q])._waitingParentId&&(We.parent=D.getLastEntryByID(We._waitingParentId),We._waitingParentId=null);for(q=0,Z=D.lights.length;q<Z;q++){var Qe=D.lights[q];Qe&&Qe._waitingParentId&&(Qe.parent=D.getLastEntryByID(Qe._waitingParentId),Qe._waitingParentId=null)}for(q=0,Z=D.transformNodes.length;q<Z;q++){var Ze=D.transformNodes[q];Ze._waitingParentId&&(Ze.parent=D.getLastEntryByID(Ze._waitingParentId),Ze._waitingParentId=null)}for(q=0,Z=D.meshes.length;q<Z;q++)(Ye=D.meshes[q])._waitingParentId&&(Ye.parent=D.getLastEntryByID(Ye._waitingParentId),Ye._waitingParentId=null),Ye._waitingData.lods&&ws(D,Ye);for(q=0,Z=D.skeletons.length;q<Z;q++)(we=D.skeletons[q])._hasWaitingData&&(null!=we.bones&&we.bones.forEach((function(w){if(w._waitingTransformNodeId){var N=D.getLastEntryByID(w._waitingTransformNodeId);N&&w.linkTransformNode(N),w._waitingTransformNodeId=null}})),we._hasWaitingData=null);for(q=0,Z=D.meshes.length;q<Z;q++){var Je=D.meshes[q];Je._waitingData.freezeWorldMatrix?(Je.freezeWorldMatrix(),Je._waitingData.freezeWorldMatrix=null):Je.computeWorldMatrix(!0)}for(q=0,Z=D.lights.length;q<Z;q++){var $e=D.lights[q];if($e._excludedMeshesIds.length>0){for(var et=0;et<$e._excludedMeshesIds.length;et++){var rt=D.getMeshByID($e._excludedMeshesIds[et]);rt&&$e.excludedMeshes.push(rt)}$e._excludedMeshesIds=[]}if($e._includedOnlyMeshesIds.length>0){for(var ot=0;ot<$e._includedOnlyMeshesIds.length;ot++){var at=D.getMeshByID($e._includedOnlyMeshesIds[ot]);at&&$e.includedOnlyMeshes.push(at)}$e._includedOnlyMeshesIds=[]}}for(F.a.Parse(X,D,z,N),q=0,Z=D.meshes.length;q<Z;q++)(Ye=D.meshes[q])._waitingData.actions&&(Ae.Parse(Ye._waitingData.actions,Ye,D),Ye._waitingData.actions=null);void 0!==X.actions&&null!==X.actions&&Ae.Parse(X.actions,null,D)}catch(D){var st=Ds("loadAssets",X?X.producer:"Unknown")+G;if(!k)throw oe.a.Log(st),D;k(st,D)}finally{j||z.removeAllFromScene(),null!==G&&ro.loggingLevel!==ro.NO_LOGGING&&oe.a.Log(Ds("loadAssets",X?X.producer:"Unknown")+(ro.loggingLevel!==ro.MINIMAL_LOGGING?G:""))}return z};ro.RegisterPlugin({name:"babylon.js",extensions:".babylon",canDirectLoad:function(D){return-1!==D.indexOf("babylon")},importMesh:function(D,w,N,k,j,z,G,H){var X="importMesh has failed JSON parse";try{var q=JSON.parse(N);X="";var Z=ro.loggingLevel===ro.DETAILED_LOGGING;D?Array.isArray(D)||(D=[D]):D=null;var J=new Array;if(void 0!==q.meshes&&null!==q.meshes){var $,te,ie,ce=[],he=[];for($=0,te=q.meshes.length;$<te;$++){var fe=q.meshes[$];if(null===D||Is(fe,D,J)){if(null!==D&&delete D[D.indexOf(fe.name)],void 0!==fe.geometryId&&null!==fe.geometryId&&void 0!==q.geometries&&null!==q.geometries){var pe=!1;["boxes","spheres","cylinders","toruses","grounds","planes","torusKnots","vertexData"].forEach((function(D){!0!==pe&&q.geometries[D]&&Array.isArray(q.geometries[D])&&q.geometries[D].forEach((function(N){if(N.id===fe.geometryId){switch(D){case"vertexData":ic.a.Parse(N,w,k)}pe=!0}}))})),!1===pe&&oe.a.Warn("Geometry not found for mesh "+fe.id)}if(fe.materialId){var _e=-1!==he.indexOf(fe.materialId);if(!1===_e&&void 0!==q.multiMaterials&&null!==q.multiMaterials)for(var ve=0,ye=q.multiMaterials.length;ve<ye;ve++){var be=q.multiMaterials[ve];if(be.id===fe.materialId){for(var Te=0,Ee=be.materials.length;Te<Ee;Te++){var Se,Me=be.materials[Te];he.push(Me),(Se=Ms(Me,q,w,k))&&(X+="\n\tMaterial "+Se.toString(Z))}he.push(be.id);var xe=rc.a.ParseMultiMaterial(be,w);xe&&(_e=!0,X+="\n\tMulti-Material "+xe.toString(Z));break}}!1===_e&&(he.push(fe.materialId),(Se=Ms(fe.materialId,q,w,k))?X+="\n\tMaterial "+Se.toString(Z):oe.a.Warn("Material not found for mesh "+fe.id))}if(fe.skeletonId>-1&&void 0!==q.skeletons&&null!==q.skeletons&&0==ce.indexOf(fe.skeletonId)>-1)for(var Ae=0,Pe=q.skeletons.length;Ae<Pe;Ae++){var Oe=q.skeletons[Ae];if(Oe.id===fe.skeletonId){var Re=tn.Parse(Oe,w);G.push(Re),ce.push(Oe.id),X+="\n\tSkeleton "+Re.toString(Z)}}if(void 0!==q.morphTargetManagers&&null!==q.morphTargetManagers)for(var De=0,Ie=q.morphTargetManagers;De<Ie.length;De++){var Le=Ie[De];fc.Parse(Le,w)}var we=xt.a.Parse(fe,w,k);j.push(we),X+="\n\tMesh "+we.toString(Z)}}for($=0,te=w.meshes.length;$<te;$++)(ie=w.meshes[$])._waitingParentId&&(ie.parent=w.getLastEntryByID(ie._waitingParentId),ie._waitingParentId=null),ie._waitingData.lods&&ws(w,ie);for($=0,te=w.skeletons.length;$<te;$++)(Re=w.skeletons[$])._hasWaitingData&&(null!=Re.bones&&Re.bones.forEach((function(D){if(D._waitingTransformNodeId){var N=w.getLastEntryByID(D._waitingTransformNodeId);N&&D.linkTransformNode(N),D._waitingTransformNodeId=null}})),Re._hasWaitingData=null);for($=0,te=w.meshes.length;$<te;$++)(ie=w.meshes[$])._waitingData.freezeWorldMatrix?(ie.freezeWorldMatrix(),ie._waitingData.freezeWorldMatrix=null):ie.computeWorldMatrix(!0)}if(void 0!==q.particleSystems&&null!==q.particleSystems){var Ne=F.a.GetIndividualParser(Nt.a.NAME_PARTICLESYSTEM);if(Ne)for($=0,te=q.particleSystems.length;$<te;$++){var Fe=q.particleSystems[$];-1!==J.indexOf(Fe.emitterId)&&z.push(Ne(Fe,w,k))}}return!0}catch(D){var Be=Ds("importMesh",q?q.producer:"Unknown")+X;if(!H)throw oe.a.Log(Be),D;H(Be,D)}finally{null!==X&&ro.loggingLevel!==ro.NO_LOGGING&&oe.a.Log(Ds("importMesh",q?q.producer:"Unknown")+(ro.loggingLevel!==ro.MINIMAL_LOGGING?X:""))}return!1},load:function(D,w,N,F){var k="importScene has failed JSON parse";try{var j=JSON.parse(w);if(k="",void 0!==j.useDelayedTextureLoading&&null!==j.useDelayedTextureLoading&&(D.useDelayedTextureLoading=j.useDelayedTextureLoading&&!ro.ForceFullSceneLoadingForIncremental),void 0!==j.autoClear&&null!==j.autoClear&&(D.autoClear=j.autoClear),void 0!==j.clearColor&&null!==j.clearColor&&(D.clearColor=G.b.FromArray(j.clearColor)),void 0!==j.ambientColor&&null!==j.ambientColor&&(D.ambientColor=G.a.FromArray(j.ambientColor)),void 0!==j.gravity&&null!==j.gravity&&(D.gravity=z.e.FromArray(j.gravity)),j.fogMode&&0!==j.fogMode)switch(D.fogMode=j.fogMode,D.fogColor=G.a.FromArray(j.fogColor),D.fogStart=j.fogStart,D.fogEnd=j.fogEnd,D.fogDensity=j.fogDensity,k+="\tFog mode for scene:  ",D.fogMode){case 1:k+="exp\n";break;case 2:k+="exp2\n";break;case 3:k+="linear\n"}if(j.physicsEnabled){var H;"cannon"===j.physicsEngine?H=new Tc(void 0,void 0,wc.LoaderInjectedPhysicsEngine):"oimo"===j.physicsEngine?H=new Sc(void 0,wc.LoaderInjectedPhysicsEngine):"ammo"===j.physicsEngine&&(H=new Oc(void 0,wc.LoaderInjectedPhysicsEngine,void 0)),k="\tPhysics engine "+(j.physicsEngine?j.physicsEngine:"oimo")+" enabled\n";var X=j.physicsGravity?z.e.FromArray(j.physicsGravity):null;D.enablePhysics(X,H)}if(void 0!==j.metadata&&null!==j.metadata&&(D.metadata=j.metadata),void 0!==j.collisionsEnabled&&null!==j.collisionsEnabled&&(D.collisionsEnabled=j.collisionsEnabled),!Ls(D,w,N,F,!0))return!1;if(j.autoAnimate&&D.beginAnimation(D,j.autoAnimateFrom,j.autoAnimateTo,j.autoAnimateLoop,j.autoAnimateSpeed||1),void 0!==j.activeCameraID&&null!==j.activeCameraID&&D.setActiveCameraByID(j.activeCameraID),void 0!==j.environmentTexture&&null!==j.environmentTexture){var q=void 0===j.isPBR||j.isPBR;if(j.environmentTextureType&&"BABYLON.HDRCubeTexture"===j.environmentTextureType){var Z=j.environmentTextureSize?j.environmentTextureSize:128,J=new uc(N+j.environmentTexture,D,Z,!0,!q);j.environmentTextureRotationY&&(J.rotationY=j.environmentTextureRotationY),D.environmentTexture=J}else if(Uo.a.EndsWith(j.environmentTexture,".env")){var $=new Vo(N+j.environmentTexture,D);j.environmentTextureRotationY&&($.rotationY=j.environmentTextureRotationY),D.environmentTexture=$}else{var te=Vo.CreateFromPrefilteredData(N+j.environmentTexture,D);j.environmentTextureRotationY&&(te.rotationY=j.environmentTextureRotationY),D.environmentTexture=te}if(!0===j.createDefaultSkybox){var ie=void 0!==D.activeCamera&&null!==D.activeCamera?(D.activeCamera.maxZ-D.activeCamera.minZ)/2:1e3,ce=j.skyboxBlurLevel||0;D.createDefaultSkybox(D.environmentTexture,q,ie,ce)}}return!0}catch(D){var he=Ds("importScene",j?j.producer:"Unknown")+k;if(!F)throw oe.a.Log(he),D;F(he,D)}finally{null!==k&&ro.loggingLevel!==ro.NO_LOGGING&&oe.a.Log(Ds("importScene",j?j.producer:"Unknown")+(ro.loggingLevel!==ro.MINIMAL_LOGGING?k:""))}return!1},loadAssetContainer:function(D,w,N,F){return Ls(D,w,N,F)}});var Nc=N(111),jc=function(){function e(){this._isEnabled=!0,this.leftColor=G.a.White(),this.rightColor=G.a.Black(),this.bias=0,this.power=1}return Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(D){this._isEnabled!==D&&(this._isEnabled=D,Ct.a.MarkAllMaterialsAsDirty(ce.a.MATERIAL_FresnelDirtyFlag|ce.a.MATERIAL_MiscDirtyFlag))},enumerable:!0,configurable:!0}),e.prototype.clone=function(){var D=new e;return xe.a.DeepCopy(this,D),D},e.prototype.serialize=function(){var D={};return D.isEnabled=this.isEnabled,D.leftColor=this.leftColor.asArray(),D.rightColor=this.rightColor.asArray(),D.bias=this.bias,D.power=this.power,D},e.Parse=function(D){var w=new e;return w.isEnabled=D.isEnabled,w.leftColor=G.a.FromArray(D.leftColor),w.rightColor=G.a.FromArray(D.rightColor),w.bias=D.bias,w.power=D.power||1,w},e}();Ie.a._FresnelParametersParser=jc.Parse;var Yc=function(D){function t(w,N){var F=D.call(this,w,N)||this;return F.maxSimultaneousLights=4,F.disableLighting=!1,F.invertNormalMapX=!1,F.invertNormalMapY=!1,F.emissiveColor=new G.a(0,0,0),F.occlusionStrength=1,F.useLightmapAsShadowmap=!1,F._useAlphaFromAlbedoTexture=!0,F._useAmbientInGrayScale=!0,F}return Object(Z.d)(t,D),Object.defineProperty(t.prototype,"doubleSided",{get:function(){return this._twoSidedLighting},set:function(D){this._twoSidedLighting!==D&&(this._twoSidedLighting=D,this.backFaceCulling=!D,this._markAllSubMeshesAsTexturesDirty())},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"PBRBaseSimpleMaterial"},Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"maxSimultaneousLights",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"disableLighting",void 0),Object(Z.c)([Object(Ie.m)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty","_reflectionTexture")],t.prototype,"environmentTexture",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"invertNormalMapX",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"invertNormalMapY",void 0),Object(Z.c)([Object(Ie.m)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty","_bumpTexture")],t.prototype,"normalTexture",void 0),Object(Z.c)([Object(Ie.e)("emissive"),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"emissiveColor",void 0),Object(Z.c)([Object(Ie.m)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"emissiveTexture",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty","_ambientTextureStrength")],t.prototype,"occlusionStrength",void 0),Object(Z.c)([Object(Ie.m)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty","_ambientTexture")],t.prototype,"occlusionTexture",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty","_alphaCutOff")],t.prototype,"alphaCutOff",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"doubleSided",null),Object(Z.c)([Object(Ie.m)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty",null)],t.prototype,"lightmapTexture",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useLightmapAsShadowmap",void 0),t}(pa),Qc=function(D){function t(w,N){var F=D.call(this,w,N)||this;return F._useRoughnessFromMetallicTextureAlpha=!1,F._useRoughnessFromMetallicTextureGreen=!0,F._useMetallnessFromMetallicTextureBlue=!0,F.metallic=1,F.roughness=1,F}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"PBRMetallicRoughnessMaterial"},t.prototype.clone=function(D){var w=this,N=Ie.a.Clone((function(){return new t(D,w.getScene())}),this);return N.id=D,N.name=D,this.clearCoat.copyTo(N.clearCoat),this.anisotropy.copyTo(N.anisotropy),this.brdf.copyTo(N.brdf),this.sheen.copyTo(N.sheen),this.subSurface.copyTo(N.subSurface),N},t.prototype.serialize=function(){var D=Ie.a.Serialize(this);return D.customType="BABYLON.PBRMetallicRoughnessMaterial",D.clearCoat=this.clearCoat.serialize(),D.anisotropy=this.anisotropy.serialize(),D.brdf=this.brdf.serialize(),D.sheen=this.sheen.serialize(),D.subSurface=this.subSurface.serialize(),D},t.Parse=function(D,w,N){var F=Ie.a.Parse((function(){return new t(D.name,w)}),D,w,N);return D.clearCoat&&F.clearCoat.parse(D.clearCoat,w,N),D.anisotropy&&F.anisotropy.parse(D.anisotropy,w,N),D.brdf&&F.brdf.parse(D.brdf,w,N),D.sheen&&F.sheen.parse(D.sheen,w,N),D.subSurface&&F.subSurface.parse(D.subSurface,w,N),F},Object(Z.c)([Object(Ie.e)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty","_albedoColor")],t.prototype,"baseColor",void 0),Object(Z.c)([Object(Ie.m)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty","_albedoTexture")],t.prototype,"baseTexture",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"metallic",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"roughness",void 0),Object(Z.c)([Object(Ie.m)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty","_metallicTexture")],t.prototype,"metallicRoughnessTexture",void 0),t}(Yc);H.a.RegisteredTypes["BABYLON.PBRMetallicRoughnessMaterial"]=Qc;var qc=function(D){function t(w,N){var F=D.call(this,w,N)||this;return F._useMicroSurfaceFromReflectivityMapAlpha=!0,F}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"PBRSpecularGlossinessMaterial"},t.prototype.clone=function(D){var w=this,N=Ie.a.Clone((function(){return new t(D,w.getScene())}),this);return N.id=D,N.name=D,this.clearCoat.copyTo(N.clearCoat),this.anisotropy.copyTo(N.anisotropy),this.brdf.copyTo(N.brdf),this.sheen.copyTo(N.sheen),this.subSurface.copyTo(N.subSurface),N},t.prototype.serialize=function(){var D=Ie.a.Serialize(this);return D.customType="BABYLON.PBRSpecularGlossinessMaterial",D.clearCoat=this.clearCoat.serialize(),D.anisotropy=this.anisotropy.serialize(),D.brdf=this.brdf.serialize(),D.sheen=this.sheen.serialize(),D.subSurface=this.subSurface.serialize(),D},t.Parse=function(D,w,N){var F=Ie.a.Parse((function(){return new t(D.name,w)}),D,w,N);return D.clearCoat&&F.clearCoat.parse(D.clearCoat,w,N),D.anisotropy&&F.anisotropy.parse(D.anisotropy,w,N),D.brdf&&F.brdf.parse(D.brdf,w,N),D.sheen&&F.sheen.parse(D.sheen,w,N),D.subSurface&&F.subSurface.parse(D.subSurface,w,N),F},Object(Z.c)([Object(Ie.e)("diffuse"),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty","_albedoColor")],t.prototype,"diffuseColor",void 0),Object(Z.c)([Object(Ie.m)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty","_albedoTexture")],t.prototype,"diffuseTexture",void 0),Object(Z.c)([Object(Ie.e)("specular"),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty","_reflectivityColor")],t.prototype,"specularColor",void 0),Object(Z.c)([Object(Ie.c)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty","_microSurface")],t.prototype,"glossiness",void 0),Object(Z.c)([Object(Ie.m)(),Object(Ie.b)("_markAllSubMeshesAsTexturesDirty","_reflectivityTexture")],t.prototype,"specularGlossinessTexture",void 0),t}(Yc);H.a.RegisteredTypes["BABYLON.PBRSpecularGlossinessMaterial"]=qc;var Zc=N(82),eu=function(D){function t(w,N){var F=D.call(this,N)||this;return w?(F._engine=N.getEngine(),F._textureMatrix=z.a.Identity(),F.name=w,F.url=w,F.hasAlpha=!1,F.isCube=!1,F.is3D=F._engine.webGLVersion>1,F.wrapU=ce.a.TEXTURE_CLAMP_ADDRESSMODE,F.wrapV=ce.a.TEXTURE_CLAMP_ADDRESSMODE,F.wrapR=ce.a.TEXTURE_CLAMP_ADDRESSMODE,F.anisotropicFilteringLevel=1,F._texture=F._getFromCache(w,!0),F._texture||(N.useDelayedTextureLoading?F.delayLoadState=ce.a.DELAYLOADSTATE_NOTLOADED:F.loadTexture()),F):F}return Object(Z.d)(t,D),t.prototype.getTextureMatrix=function(){return this._textureMatrix},t.prototype.load3dlTexture=function(){var D,w=this._engine;D=1===w.webGLVersion?w.createRawTexture(null,1,1,ce.a.TEXTUREFORMAT_RGBA,!1,!1,ce.a.TEXTURE_BILINEAR_SAMPLINGMODE,null,ce.a.TEXTURETYPE_UNSIGNED_INT):w.createRawTexture3D(null,1,1,1,ce.a.TEXTUREFORMAT_RGBA,!1,!1,ce.a.TEXTURE_BILINEAR_SAMPLINGMODE,null,ce.a.TEXTURETYPE_UNSIGNED_INT),this._texture=D;var n=function(N){if("string"==typeof N){for(var F,k=null,j=null,z=N.split("\n"),G=0,H=0,X=0,q=0,Z=0,J=0;J<z.length;J++)if(F=z[J],t._noneEmptyLineRegex.test(F)&&0!==F.indexOf("#")){var $=F.split(" ");if(0!==G){if(0!=G){var te=Math.max(parseInt($[0]),0),ie=Math.max(parseInt($[1]),0),oe=Math.max(parseInt($[2]),0);Z=Math.max(te,Z),Z=Math.max(ie,Z),Z=Math.max(oe,Z);var he=4*(H+q*G+X*G*G);j&&(j[he+0]=te,j[he+1]=ie,j[he+2]=oe),++X%G==0&&(X=0,++q%G==0&&(H++,q=0))}}else G=$.length,k=new Uint8Array(G*G*G*4),j=new Float32Array(G*G*G*4)}if(j&&k)for(J=0;J<j.length;J++)if(J>0&&(J+1)%4==0)k[J]=255;else{var fe=j[J];k[J]=fe/Z*255}D.is3D?(D.updateSize(G,G,G),w.updateRawTexture3D(D,k,ce.a.TEXTUREFORMAT_RGBA,!1)):(D.updateSize(G*G,G),w.updateRawTexture(D,k,ce.a.TEXTUREFORMAT_RGBA,!1))}},N=this.getScene();return N?N._loadFile(this.url,n):this._engine._loadFile(this.url,n),this._texture},t.prototype.loadTexture=function(){this.url&&this.url.toLocaleLowerCase().indexOf(".3dl")==this.url.length-4&&this.load3dlTexture()},t.prototype.clone=function(){var D=new t(this.url,this.getScene());return D.level=this.level,D},t.prototype.delayLoad=function(){this.delayLoadState===ce.a.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=ce.a.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,!0),this._texture||this.loadTexture())},t.Parse=function(D,w){var N=null;return D.name&&!D.isRenderTarget&&((N=new t(D.name,w)).name=D.name,N.level=D.level),N},t.prototype.serialize=function(){if(!this.name)return null;var D={};return D.name=this.name,D.level=this.level,D.customType="BABYLON.ColorGradingTexture",D},t._noneEmptyLineRegex=/\S+/,t}(Nr.a);H.a.RegisteredTypes["BABYLON.ColorGradingTexture"]=eu;var tu=function(D){function t(w,N,F,k,j,z,G){void 0===k&&(k=!1),void 0===j&&(j=!0),void 0===z&&(z=null),void 0===G&&(G=null);var H=D.call(this,N)||this;if(H._onLoad=null,H._onError=null,H.coordinatesMode=Jt.a.CUBIC_MODE,!w)throw new Error("Image url is not set");return H.name=w,H.url=w,H._size=F,H._noMipmap=k,H.gammaSpace=j,H._onLoad=z,H._onError=G,H.hasAlpha=!1,H.isCube=!0,H._texture=H._getFromCache(w,H._noMipmap),H._texture?z&&(H._texture.isReady?Dt.b.SetImmediate((function(){return z()})):H._texture.onLoadedObservable.add(z)):N.useDelayedTextureLoading?H.delayLoadState=ce.a.DELAYLOADSTATE_NOTLOADED:H.loadImage(H.loadTexture.bind(H),H._onError),H}return Object(Z.d)(t,D),t.prototype.loadImage=function(D,w){var N=this,F=document.createElement("canvas"),k=new Image;k.addEventListener("load",(function(){N._width=k.width,N._height=k.height,F.width=N._width,F.height=N._height;var w=F.getContext("2d");w.drawImage(k,0,0);var j=w.getImageData(0,0,k.width,k.height);N._buffer=j.data.buffer,F.remove(),D()})),k.addEventListener("error",(function(D){w&&w(N.getClassName()+" could not be loaded",D)})),k.src=this.url},t.prototype.loadTexture=function(){var D=this,w=this.getScene();w&&(this._texture=w.getEngine().createRawCubeTextureFromUrl(this.url,w,this._size,ce.a.TEXTUREFORMAT_RGB,w.getEngine().getCaps().textureFloat?ce.a.TEXTURETYPE_FLOAT:ce.a.TEXTURETYPE_UNSIGNED_INTEGER,this._noMipmap,(function(){for(var w=D.getFloat32ArrayFromArrayBuffer(D._buffer),N=ac.ConvertPanoramaToCubemap(w,D._width,D._height,D._size),F=[],k=0;k<6;k++){var j=N[t._FacesMapping[k]];F.push(j)}return F}),null,this._onLoad,this._onError))},t.prototype.getFloat32ArrayFromArrayBuffer=function(D){for(var w=new DataView(D),N=new Float32Array(3*D.byteLength/4),F=0,k=0;k<D.byteLength;k++)(k+1)%4!=0&&(N[F++]=w.getUint8(k)/255);return N},t.prototype.getClassName=function(){return"EquiRectangularCubeTexture"},t.prototype.clone=function(){var D=this.getScene();if(!D)return this;var w=new t(this.url,D,this._size,this._noMipmap,this.gammaSpace);return w.level=this.level,w.wrapU=this.wrapU,w.wrapV=this.wrapV,w.coordinatesIndex=this.coordinatesIndex,w.coordinatesMode=this.coordinatesMode,w},t._FacesMapping=["right","left","up","down","front","back"],t}(Nr.a),nu=function(){function e(){}return e.GetTGAHeader=function(D){var w=0;return{id_length:D[w++],colormap_type:D[w++],image_type:D[w++],colormap_index:D[w++]|D[w++]<<8,colormap_length:D[w++]|D[w++]<<8,colormap_size:D[w++],origin:[D[w++]|D[w++]<<8,D[w++]|D[w++]<<8],width:D[w++]|D[w++]<<8,height:D[w++]|D[w++]<<8,pixel_size:D[w++],flags:D[w++]}},e.UploadContent=function(D,w){if(w.length<19)oe.a.Error("Unable to load TGA file - Not enough data to contain header");else{var N=18,F=e.GetTGAHeader(w);if(F.id_length+N>w.length)oe.a.Error("Unable to load TGA file - Not enough data");else{N+=F.id_length;var k,j=!1,z=!1,G=!1;switch(F.image_type){case e._TYPE_RLE_INDEXED:j=!0;case e._TYPE_INDEXED:z=!0;break;case e._TYPE_RLE_RGB:j=!0;case e._TYPE_RGB:break;case e._TYPE_RLE_GREY:j=!0;case e._TYPE_GREY:G=!0}var H,X,q,Z,J,$,te,ie=F.pixel_size>>3,ce=F.width*F.height*ie;if(z&&(H=w.subarray(N,N+=F.colormap_length*(F.colormap_size>>3))),j){var he,fe,pe;k=new Uint8Array(ce);for(var _e=0,ve=new Uint8Array(ie);N<ce&&_e<ce;)if(fe=1+(127&(he=w[N++])),128&he){for(pe=0;pe<ie;++pe)ve[pe]=w[N++];for(pe=0;pe<fe;++pe)k.set(ve,_e+pe*ie);_e+=ie*fe}else{for(fe*=ie,pe=0;pe<fe;++pe)k[_e+pe]=w[N++];_e+=fe}}else k=w.subarray(N,N+=z?F.width*F.height:ce);switch((F.flags&e._ORIGIN_MASK)>>e._ORIGIN_SHIFT){default:case e._ORIGIN_UL:X=0,Z=1,te=F.width,q=0,J=1,$=F.height;break;case e._ORIGIN_BL:X=0,Z=1,te=F.width,q=F.height-1,J=-1,$=-1;break;case e._ORIGIN_UR:X=F.width-1,Z=-1,te=-1,q=0,J=1,$=F.height;break;case e._ORIGIN_BR:X=F.width-1,Z=-1,te=-1,q=F.height-1,J=-1,$=-1}var ye=e["_getImageData"+(G?"Grey":"")+F.pixel_size+"bits"](F,H,k,q,J,$,X,Z,te);D.getEngine()._uploadDataToTextureDirectly(D,ye)}}},e._getImageData8bits=function(D,w,N,F,k,j,z,G,H){var X,q,Z,J=N,$=w,te=D.width,ie=D.height,oe=0,ce=new Uint8Array(te*ie*4);for(Z=F;Z!==j;Z+=k)for(q=z;q!==H;q+=G,oe++)X=J[oe],ce[4*(q+te*Z)+3]=255,ce[4*(q+te*Z)+2]=$[3*X+0],ce[4*(q+te*Z)+1]=$[3*X+1],ce[4*(q+te*Z)+0]=$[3*X+2];return ce},e._getImageData16bits=function(D,w,N,F,k,j,z,G,H){var X,q,Z,J=N,$=D.width,te=D.height,ie=0,oe=new Uint8Array($*te*4);for(Z=F;Z!==j;Z+=k)for(q=z;q!==H;q+=G,ie+=2){var ce=255*((31744&(X=J[ie+0]+(J[ie+1]<<8)))>>10)/31|0,he=255*((992&X)>>5)/31|0,fe=255*(31&X)/31|0;oe[4*(q+$*Z)+0]=ce,oe[4*(q+$*Z)+1]=he,oe[4*(q+$*Z)+2]=fe,oe[4*(q+$*Z)+3]=32768&X?0:255}return oe},e._getImageData24bits=function(D,w,N,F,k,j,z,G,H){var X,q,Z=N,J=D.width,$=D.height,te=0,ie=new Uint8Array(J*$*4);for(q=F;q!==j;q+=k)for(X=z;X!==H;X+=G,te+=3)ie[4*(X+J*q)+3]=255,ie[4*(X+J*q)+2]=Z[te+0],ie[4*(X+J*q)+1]=Z[te+1],ie[4*(X+J*q)+0]=Z[te+2];return ie},e._getImageData32bits=function(D,w,N,F,k,j,z,G,H){var X,q,Z=N,J=D.width,$=D.height,te=0,ie=new Uint8Array(J*$*4);for(q=F;q!==j;q+=k)for(X=z;X!==H;X+=G,te+=4)ie[4*(X+J*q)+2]=Z[te+0],ie[4*(X+J*q)+1]=Z[te+1],ie[4*(X+J*q)+0]=Z[te+2],ie[4*(X+J*q)+3]=Z[te+3];return ie},e._getImageDataGrey8bits=function(D,w,N,F,k,j,z,G,H){var X,q,Z,J=N,$=D.width,te=D.height,ie=0,oe=new Uint8Array($*te*4);for(Z=F;Z!==j;Z+=k)for(q=z;q!==H;q+=G,ie++)X=J[ie],oe[4*(q+$*Z)+0]=X,oe[4*(q+$*Z)+1]=X,oe[4*(q+$*Z)+2]=X,oe[4*(q+$*Z)+3]=255;return oe},e._getImageDataGrey16bits=function(D,w,N,F,k,j,z,G,H){var X,q,Z=N,J=D.width,$=D.height,te=0,ie=new Uint8Array(J*$*4);for(q=F;q!==j;q+=k)for(X=z;X!==H;X+=G,te+=2)ie[4*(X+J*q)+0]=Z[te+0],ie[4*(X+J*q)+1]=Z[te+0],ie[4*(X+J*q)+2]=Z[te+0],ie[4*(X+J*q)+3]=Z[te+1];return ie},e._TYPE_INDEXED=1,e._TYPE_RGB=2,e._TYPE_GREY=3,e._TYPE_RLE_INDEXED=9,e._TYPE_RLE_RGB=10,e._TYPE_RLE_GREY=11,e._ORIGIN_MASK=48,e._ORIGIN_SHIFT=4,e._ORIGIN_BL=0,e._ORIGIN_BR=1,e._ORIGIN_UL=2,e._ORIGIN_UR=3,e}(),iu=function(){function e(){this.supportCascades=!1}return e.prototype.canLoad=function(D){return Uo.a.EndsWith(D,".tga")},e.prototype.loadCubeData=function(D,w,N,F,k){throw".env not supported in Cube."},e.prototype.loadData=function(D,w,N){var F=new Uint8Array(D.buffer,D.byteOffset,D.byteLength),k=nu.GetTGAHeader(F);N(k.width,k.height,w.generateMipMaps,!1,(function(){nu.UploadContent(w,F)}))},e}();Ct.a._TextureLoaders.push(new iu);var ru,Hs=function(){};!function(D){D[D.cTFETC1=0]="cTFETC1",D[D.cTFBC1=1]="cTFBC1",D[D.cTFBC4=2]="cTFBC4",D[D.cTFPVRTC1_4_OPAQUE_ONLY=3]="cTFPVRTC1_4_OPAQUE_ONLY",D[D.cTFBC7_M6_OPAQUE_ONLY=4]="cTFBC7_M6_OPAQUE_ONLY",D[D.cTFETC2=5]="cTFETC2",D[D.cTFBC3=6]="cTFBC3",D[D.cTFBC5=7]="cTFBC5"}(ru||(ru={}));var ou=function(){function e(){}return e.GetInternalFormatFromBasisFormat=function(D){if(D===ru.cTFETC1)return 36196;if(D===ru.cTFBC1)return 33776;if(D===ru.cTFBC3)return 33779;throw"The chosen Basis transcoder format is not currently supported"},e._CreateWorkerAsync=function(){var D=this;return this._WorkerPromise||(this._WorkerPromise=new Promise((function(w){D._Worker?w(D._Worker):Dt.b.LoadFileAsync(e.WasmModuleURL).then((function(N){var F=URL.createObjectURL(new Blob(["("+Ks+")()"],{type:"application/javascript"}));D._Worker=new Worker(F);var o=function(N){"init"===N.data.action&&(D._Worker.removeEventListener("message",o),w(D._Worker))};D._Worker.addEventListener("message",o),D._Worker.postMessage({action:"init",url:e.JSModuleURL,wasmBinary:N})}))}))),this._WorkerPromise},e.TranscodeAsync=function(D,w){var N=this,F=D instanceof ArrayBuffer?new Uint8Array(D):D;return new Promise((function(D,k){N._CreateWorkerAsync().then((function(){var j=N._actionId++,a=function(w){"transcode"===w.data.action&&w.data.id===j&&(N._Worker.removeEventListener("message",a),w.data.success?D(w.data):k("Transcode is not supported on this device"))};N._Worker.addEventListener("message",a);var z=new Uint8Array(F.byteLength);z.set(new Uint8Array(F.buffer,F.byteOffset,F.byteLength)),N._Worker.postMessage({action:"transcode",id:j,imageData:z,config:w,ignoreSupportedFormats:N._IgnoreSupportedFormats},[z.buffer])}))}))},e.LoadTextureFromTranscodeResult=function(D,w){for(var N,F=D.getEngine(),o=function(){if(N=w.fileInfo.images[k].levels[0],D._invertVScale=D.invertY,-1===w.format)if(D.type=ce.a.TEXTURETYPE_UNSIGNED_SHORT_5_6_5,D.format=ce.a.TEXTUREFORMAT_RGB,F.webGLVersion<2&&(De.a.Log2(N.width)%1!=0||De.a.Log2(N.height)%1!=0)){var j=new $t.a(F,$t.b.Temp);D._invertVScale=D.invertY,j.type=ce.a.TEXTURETYPE_UNSIGNED_SHORT_5_6_5,j.format=ce.a.TEXTUREFORMAT_RGB,j.width=N.width+3&-4,j.height=N.height+3&-4,F._bindTextureDirectly(F._gl.TEXTURE_2D,j,!0),F._uploadDataToTextureDirectly(j,N.transcodedPixels,k,0,ce.a.TEXTUREFORMAT_RGB,!0),F._rescaleTexture(j,D,F.scenes[0],F._getInternalFormat(ce.a.TEXTUREFORMAT_RGB),(function(){F._releaseTexture(j),F._bindTextureDirectly(F._gl.TEXTURE_2D,D,!0)}))}else D._invertVScale=!D.invertY,D.width=N.width+3&-4,D.height=N.height+3&-4,F._uploadDataToTextureDirectly(D,N.transcodedPixels,k,0,ce.a.TEXTUREFORMAT_RGB,!0);else D.width=N.width,D.height=N.height,w.fileInfo.images[k].levels.forEach((function(N,j){F._uploadCompressedDataToTextureDirectly(D,e.GetInternalFormatFromBasisFormat(w.format),N.width,N.height,N.transcodedPixels,k,j)})),F.webGLVersion<2&&(De.a.Log2(D.width)%1!=0||De.a.Log2(D.height)%1!=0)&&(Dt.b.Warn("Loaded .basis texture width and height are not a power of two. Texture wrapping will be set to Texture.CLAMP_ADDRESSMODE as other modes are not supported with non power of two dimensions in webGL 1."),D._cachedWrapU=Jt.a.CLAMP_ADDRESSMODE,D._cachedWrapV=Jt.a.CLAMP_ADDRESSMODE)},k=0;k<w.fileInfo.images.length;k++)o()},e._IgnoreSupportedFormats=!1,e.JSModuleURL="https://preview.babylonjs.com/basisTranscoder/basis_transcoder.js",e.WasmModuleURL="https://preview.babylonjs.com/basisTranscoder/basis_transcoder.wasm",e._WorkerPromise=null,e._Worker=null,e._actionId=0,e}();function Ks(){var D=0,w=1,N=5,F=6,k=null;function i(D,w,N,F,k){var j=D.getImageTranscodedSizeInBytes(w,N,F),z=new Uint8Array(j);return D.transcodeImage(z,w,N,F,1,0)?(k&&(z=function(D,w,N,F){for(var k=new Uint16Array(4),j=new Uint16Array(N*F),z=N/4,G=F/4,H=0;H<G;H++)for(var X=0;X<z;X++){var q=0+8*(H*z+X);k[0]=D[q]|D[q+1]<<8,k[1]=D[q+2]|D[q+3]<<8,k[2]=(2*(31&k[0])+1*(31&k[1]))/3|(2*(2016&k[0])+1*(2016&k[1]))/3&2016|(2*(63488&k[0])+1*(63488&k[1]))/3&63488,k[3]=(2*(31&k[1])+1*(31&k[0]))/3|(2*(2016&k[1])+1*(2016&k[0]))/3&2016|(2*(63488&k[1])+1*(63488&k[0]))/3&63488;for(var Z=0;Z<4;Z++){var J=D[q+4+Z],$=(4*H+Z)*N+4*X;j[$++]=k[3&J],j[$++]=k[J>>2&3],j[$++]=k[J>>4&3],j[$++]=k[J>>6&3]}}return j}(z,0,D.getImageWidth(w,N)+3&-4,D.getImageHeight(w,N)+3&-4)),z):null}onmessage=function(j){if("init"===j.data.action)k||(Module={wasmBinary:j.data.wasmBinary},importScripts(j.data.url),k=new Promise((function(D){Module.onRuntimeInitialized=function(){Module.initializeBasis(),D()}}))),k.then((function(){postMessage({action:"init"})}));else if("transcode"===j.data.action){var z=j.data.config,G=j.data.imageData,H=new Module.BasisFile(G),X=function(D){for(var w=D.getHasAlpha(),N=D.getNumImages(),F=[],k=0;k<N;k++){for(var j={levels:[]},z=D.getNumLevels(k),G=0;G<z;G++){var H={width:D.getImageWidth(k,G),height:D.getImageHeight(k,G)};j.levels.push(H)}F.push(j)}return{hasAlpha:w,images:F}}(H),q=j.data.ignoreSupportedFormats?null:function(k,j){var z=null;return k.supportedCompressionFormats&&(k.supportedCompressionFormats.etc1?z=D:k.supportedCompressionFormats.s3tc?z=j.hasAlpha?F:w:k.supportedCompressionFormats.pvrtc||k.supportedCompressionFormats.etc2&&(z=N)),z}(j.data.config,X),Z=!1;null===q&&(Z=!0,q=X.hasAlpha?F:w);var J=!0;H.startTranscoding()||(J=!1);for(var $=[],te=0;te<X.images.length&&J;te++){var ie=X.images[te];if(void 0===z.loadSingleImage||z.loadSingleImage===te){var oe=ie.levels.length;!1===z.loadMipmapLevels&&(oe=1);for(var ce=0;ce<oe;ce++){var he=ie.levels[ce],fe=i(H,te,ce,q,Z);if(!fe){J=!1;break}he.transcodedPixels=fe,$.push(he.transcodedPixels.buffer)}}}H.close(),H.delete(),Z&&(q=-1),J?postMessage({action:"transcode",success:J,id:j.data.id,fileInfo:X,format:q},$):postMessage({action:"transcode",success:J,id:j.data.id})}}}var au=function(){function e(){this.supportCascades=!0}return e.prototype.canLoad=function(D){return Uo.a.EndsWith(D,".basis")},e.prototype.loadCubeData=function(D,w,N,F,k){if(!Array.isArray(D)){var j=w.getEngine().getCaps(),z={supportedCompressionFormats:{etc1:!!j.etc1,s3tc:!!j.s3tc,pvrtc:!!j.pvrtc,etc2:!!j.etc2}};ou.TranscodeAsync(D,z).then((function(D){var N=D.fileInfo.images[0].levels.length>1&&w.generateMipMaps;ou.LoadTextureFromTranscodeResult(w,D),w.getEngine()._setCubeMapTextureParams(N),w.isReady=!0,w.onLoadedObservable.notifyObservers(w),w.onLoadedObservable.clear(),F&&F()})).catch((function(D){Dt.b.Warn("Failed to transcode Basis file, transcoding may not be supported on this device"),w.isReady=!0}))}},e.prototype.loadData=function(D,w,N){var F=w.getEngine().getCaps(),k={supportedCompressionFormats:{etc1:!!F.etc1,s3tc:!!F.s3tc,pvrtc:!!F.pvrtc,etc2:!!F.etc2}};ou.TranscodeAsync(D,k).then((function(D){var F=D.fileInfo.images[0].levels[0],k=D.fileInfo.images[0].levels.length>1&&w.generateMipMaps;N(F.width,F.height,k,-1!==D.format,(function(){ou.LoadTextureFromTranscodeResult(w,D)}))})).catch((function(D){Dt.b.Warn("Failed to transcode Basis file, transcoding may not be supported on this device"),N(0,0,!1,!1,(function(){}))}))},e}();Ct.a._TextureLoaders.push(new au),di.a.prototype.unBindMultiColorAttachmentFramebuffer=function(D,w,N){void 0===w&&(w=!1),this._currentRenderTarget=null;var F=this._gl;if(D[0]._MSAAFramebuffer){F.bindFramebuffer(F.READ_FRAMEBUFFER,D[0]._MSAAFramebuffer),F.bindFramebuffer(F.DRAW_FRAMEBUFFER,D[0]._framebuffer);var k=D[0]._attachments;k||(k=new Array(D.length),D[0]._attachments=k);for(var j=0;j<D.length;j++){for(var z=D[j],G=0;G<k.length;G++)k[G]=F.NONE;k[j]=F[this.webGLVersion>1?"COLOR_ATTACHMENT"+j:"COLOR_ATTACHMENT"+j+"_WEBGL"],F.readBuffer(k[j]),F.drawBuffers(k),F.blitFramebuffer(0,0,z.width,z.height,0,0,z.width,z.height,F.COLOR_BUFFER_BIT,F.NEAREST)}for(j=0;j<k.length;j++)k[j]=F[this.webGLVersion>1?"COLOR_ATTACHMENT"+j:"COLOR_ATTACHMENT"+j+"_WEBGL"];F.drawBuffers(k)}for(j=0;j<D.length;j++)!(z=D[j]).generateMipMaps||w||z.isCube||(this._bindTextureDirectly(F.TEXTURE_2D,z,!0),F.generateMipmap(F.TEXTURE_2D),this._bindTextureDirectly(F.TEXTURE_2D,null));N&&(D[0]._MSAAFramebuffer&&this._bindUnboundFramebuffer(D[0]._framebuffer),N()),this._bindUnboundFramebuffer(null)},di.a.prototype.createMultipleRenderTarget=function(D,w){var N=!1,F=!0,k=!1,j=!1,z=1,G=ce.a.TEXTURETYPE_UNSIGNED_INT,H=ce.a.TEXTURE_TRILINEAR_SAMPLINGMODE,X=new Array,q=new Array;void 0!==w&&(N=void 0!==w.generateMipMaps&&w.generateMipMaps,F=void 0===w.generateDepthBuffer||w.generateDepthBuffer,k=void 0!==w.generateStencilBuffer&&w.generateStencilBuffer,j=void 0!==w.generateDepthTexture&&w.generateDepthTexture,z=w.textureCount||1,w.types&&(X=w.types),w.samplingModes&&(q=w.samplingModes));var Z=this._gl,J=Z.createFramebuffer();this._bindUnboundFramebuffer(J);for(var $=D.width||D,te=D.height||D,ie=[],he=[],fe=this._setupFramebufferDepthAttachments(k,F,$,te),pe=0;pe<z;pe++){var _e=q[pe]||H,ve=X[pe]||G;(ve!==ce.a.TEXTURETYPE_FLOAT||this._caps.textureFloatLinearFiltering)&&(ve!==ce.a.TEXTURETYPE_HALF_FLOAT||this._caps.textureHalfFloatLinearFiltering)||(_e=ce.a.TEXTURE_NEAREST_SAMPLINGMODE);var ye=this._getSamplingParameters(_e,N);ve!==ce.a.TEXTURETYPE_FLOAT||this._caps.textureFloat||(ve=ce.a.TEXTURETYPE_UNSIGNED_INT,oe.a.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type"));var be=new $t.a(this,$t.b.MultiRenderTarget),Te=Z[this.webGLVersion>1?"COLOR_ATTACHMENT"+pe:"COLOR_ATTACHMENT"+pe+"_WEBGL"];ie.push(be),he.push(Te),Z.activeTexture(Z["TEXTURE"+pe]),Z.bindTexture(Z.TEXTURE_2D,be._webGLTexture),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_MAG_FILTER,ye.mag),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_MIN_FILTER,ye.min),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_WRAP_S,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_WRAP_T,Z.CLAMP_TO_EDGE),Z.texImage2D(Z.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(ve),$,te,0,Z.RGBA,this._getWebGLTextureType(ve),null),Z.framebufferTexture2D(Z.DRAW_FRAMEBUFFER,Te,Z.TEXTURE_2D,be._webGLTexture,0),N&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(Z.TEXTURE_2D,null),be._framebuffer=J,be._depthStencilBuffer=fe,be.baseWidth=$,be.baseHeight=te,be.width=$,be.height=te,be.isReady=!0,be.samples=1,be.generateMipMaps=N,be.samplingMode=_e,be.type=ve,be._generateDepthBuffer=F,be._generateStencilBuffer=k,be._attachments=he,this._internalTexturesCache.push(be)}if(j&&this._caps.depthTextureExtension){var Ee=new $t.a(this,$t.b.MultiRenderTarget);Z.activeTexture(Z.TEXTURE0),Z.bindTexture(Z.TEXTURE_2D,Ee._webGLTexture),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_MAG_FILTER,Z.NEAREST),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_MIN_FILTER,Z.NEAREST),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_WRAP_S,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_WRAP_T,Z.CLAMP_TO_EDGE),Z.texImage2D(Z.TEXTURE_2D,0,this.webGLVersion<2?Z.DEPTH_COMPONENT:Z.DEPTH_COMPONENT16,$,te,0,Z.DEPTH_COMPONENT,Z.UNSIGNED_SHORT,null),Z.framebufferTexture2D(Z.FRAMEBUFFER,Z.DEPTH_ATTACHMENT,Z.TEXTURE_2D,Ee._webGLTexture,0),Ee._framebuffer=J,Ee.baseWidth=$,Ee.baseHeight=te,Ee.width=$,Ee.height=te,Ee.isReady=!0,Ee.samples=1,Ee.generateMipMaps=N,Ee.samplingMode=Z.NEAREST,Ee._generateDepthBuffer=F,Ee._generateStencilBuffer=k,ie.push(Ee),this._internalTexturesCache.push(Ee)}return Z.drawBuffers(he),this._bindUnboundFramebuffer(null),this.resetTextureCache(),ie},di.a.prototype.updateMultipleRenderTargetTextureSampleCount=function(D,w){if(this.webGLVersion<2||!D||0==D.length)return 1;if(D[0].samples===w)return w;var N=this._gl;w=Math.min(w,this.getCaps().maxMSAASamples),D[0]._depthStencilBuffer&&(N.deleteRenderbuffer(D[0]._depthStencilBuffer),D[0]._depthStencilBuffer=null),D[0]._MSAAFramebuffer&&(N.deleteFramebuffer(D[0]._MSAAFramebuffer),D[0]._MSAAFramebuffer=null);for(var F=0;F<D.length;F++)D[F]._MSAARenderBuffer&&(N.deleteRenderbuffer(D[F]._MSAARenderBuffer),D[F]._MSAARenderBuffer=null);if(w>1&&N.renderbufferStorageMultisample){var k=N.createFramebuffer();if(!k)throw new Error("Unable to create multi sampled framebuffer");this._bindUnboundFramebuffer(k);var j=this._setupFramebufferDepthAttachments(D[0]._generateStencilBuffer,D[0]._generateDepthBuffer,D[0].width,D[0].height,w),z=[];for(F=0;F<D.length;F++){var G=D[F],H=N[this.webGLVersion>1?"COLOR_ATTACHMENT"+F:"COLOR_ATTACHMENT"+F+"_WEBGL"],X=N.createRenderbuffer();if(!X)throw new Error("Unable to create multi sampled framebuffer");N.bindRenderbuffer(N.RENDERBUFFER,X),N.renderbufferStorageMultisample(N.RENDERBUFFER,w,this._getRGBAMultiSampleBufferFormat(G.type),G.width,G.height),N.framebufferRenderbuffer(N.FRAMEBUFFER,H,N.RENDERBUFFER,X),G._MSAAFramebuffer=k,G._MSAARenderBuffer=X,G.samples=w,G._depthStencilBuffer=j,N.bindRenderbuffer(N.RENDERBUFFER,null),z.push(H)}N.drawBuffers(z)}else this._bindUnboundFramebuffer(D[0]._framebuffer);return this._bindUnboundFramebuffer(null),w};var su=function(D){function t(w,N,F,k,j){var z=this,G=!(!j||!j.generateMipMaps)&&j.generateMipMaps,H=!(!j||!j.generateDepthTexture)&&j.generateDepthTexture,X=!j||void 0===j.doNotChangeAspectRatio||j.doNotChangeAspectRatio;if((z=D.call(this,w,N,k,G,X)||this)._engine=k.getEngine(),z.isSupported){for(var q=[],Z=[],J=0;J<F;J++)j&&j.types&&void 0!==j.types[J]?q.push(j.types[J]):q.push(j&&j.defaultType?j.defaultType:ce.a.TEXTURETYPE_UNSIGNED_INT),j&&j.samplingModes&&void 0!==j.samplingModes[J]?Z.push(j.samplingModes[J]):Z.push(Jt.a.BILINEAR_SAMPLINGMODE);var $=!j||void 0===j.generateDepthBuffer||j.generateDepthBuffer,te=!(!j||void 0===j.generateStencilBuffer)&&j.generateStencilBuffer;return z._size=N,z._multiRenderTargetOptions={samplingModes:Z,generateMipMaps:G,generateDepthBuffer:$,generateStencilBuffer:te,generateDepthTexture:H,types:q,textureCount:F},z._createInternalTextures(),z._createTextures(),z}z.dispose()}return Object(Z.d)(t,D),Object.defineProperty(t.prototype,"isSupported",{get:function(){return this._engine.webGLVersion>1||this._engine.getCaps().drawBuffersExtension},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textures",{get:function(){return this._textures},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"depthTexture",{get:function(){return this._textures[this._textures.length-1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"wrapU",{set:function(D){if(this._textures)for(var w=0;w<this._textures.length;w++)this._textures[w].wrapU=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"wrapV",{set:function(D){if(this._textures)for(var w=0;w<this._textures.length;w++)this._textures[w].wrapV=D},enumerable:!0,configurable:!0}),t.prototype._rebuild=function(){this.releaseInternalTextures(),this._createInternalTextures();for(var D=0;D<this._internalTextures.length;D++)this._textures[D]._texture=this._internalTextures[D];this._texture=this._internalTextures[0]},t.prototype._createInternalTextures=function(){this._internalTextures=this._engine.createMultipleRenderTarget(this._size,this._multiRenderTargetOptions)},t.prototype._createTextures=function(){this._textures=[];for(var D=0;D<this._internalTextures.length;D++){var w=new Jt.a(null,this.getScene());w._texture=this._internalTextures[D],this._textures.push(w)}this._texture=this._internalTextures[0]},Object.defineProperty(t.prototype,"samples",{get:function(){return this._samples},set:function(D){this._samples!==D&&(this._samples=this._engine.updateMultipleRenderTargetTextureSampleCount(this._internalTextures,D))},enumerable:!0,configurable:!0}),t.prototype.resize=function(D){this.releaseInternalTextures(),this._size=D,this._createInternalTextures()},t.prototype.unbindFrameBuffer=function(D,w){var N=this;D.unBindMultiColorAttachmentFramebuffer(this._internalTextures,this.isCube,(function(){N.onAfterRenderObservable.notifyObservers(w)}))},t.prototype.dispose=function(){this.releaseInternalTextures(),D.prototype.dispose.call(this)},t.prototype.releaseInternalTextures=function(){if(this._internalTextures)for(var D=this._internalTextures.length-1;D>=0;D--)void 0!==this._internalTextures[D]&&(this._internalTextures[D].dispose(),this._internalTextures.splice(D,1))},t}(Li),cu=function(){function e(D){this.name=Nt.a.NAME_PROCEDURALTEXTURE,this.scene=D,this.scene.proceduralTextures=new Array}return e.prototype.register=function(){this.scene._beforeClearStage.registerStep(Nt.a.STEP_BEFORECLEAR_PROCEDURALTEXTURE,this,this._beforeClear)},e.prototype.rebuild=function(){},e.prototype.dispose=function(){},e.prototype._beforeClear=function(){if(this.scene.proceduralTexturesEnabled){Dt.b.StartPerformanceCounter("Procedural textures",this.scene.proceduralTextures.length>0);for(var D=0;D<this.scene.proceduralTextures.length;D++){var w=this.scene.proceduralTextures[D];w._shouldRender()&&w.render()}Dt.b.EndPerformanceCounter("Procedural textures",this.scene.proceduralTextures.length>0)}},e}();li.a.ShadersStore.proceduralVertexShader="\nattribute vec2 position;\n\nvarying vec2 vPosition;\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) {\nvPosition=position;\nvUV=position*madd+madd;\ngl_Position=vec4(position,0.0,1.0);\n}";var uu=function(D){function t(w,N,F,k,z,G,H){void 0===z&&(z=null),void 0===G&&(G=!0),void 0===H&&(H=!1);var X=D.call(this,null,k,!G)||this;X.isCube=H,X.isEnabled=!0,X.autoClear=!0,X.onGeneratedObservable=new j.c,X._textures={},X._currentRefreshId=-1,X._frameId=-1,X._refreshRate=1,X._vertexBuffers={},X._uniforms=new Array,X._samplers=new Array,X._floats={},X._ints={},X._floatsArrays={},X._colors3={},X._colors4={},X._vectors2={},X._vectors3={},X._matrices={},X._fallbackTextureUsed=!1,X._cachedDefines="",X._contentUpdateId=-1;var q=(k=X.getScene())._getComponent(Nt.a.NAME_PROCEDURALTEXTURE);q||(q=new cu(k),k._addComponent(q)),k.proceduralTextures.push(X),X._engine=k.getEngine(),X.name=w,X.isRenderTarget=!0,X._size=N,X._generateMipMaps=G,X.setFragment(F),X._fallbackTexture=z,H?(X._texture=X._engine.createRenderTargetCubeTexture(N,{generateMipMaps:G,generateDepthBuffer:!1,generateStencilBuffer:!1}),X.setFloat("face",0)):X._texture=X._engine.createRenderTargetTexture(N,{generateMipMaps:G,generateDepthBuffer:!1,generateStencilBuffer:!1});var Z=[];return Z.push(1,1),Z.push(-1,1),Z.push(-1,-1),Z.push(1,-1),X._vertexBuffers[Zi.b.PositionKind]=new Zi.b(X._engine,Z,Zi.b.PositionKind,!1,!1,2),X._createIndexBuffer(),X}return Object(Z.d)(t,D),t.prototype.getEffect=function(){return this._effect},t.prototype.getContent=function(){return this._contentData&&this._frameId===this._contentUpdateId||(this._contentData=this.readPixels(0,0,this._contentData),this._contentUpdateId=this._frameId),this._contentData},t.prototype._createIndexBuffer=function(){var D=this._engine,w=[];w.push(0),w.push(1),w.push(2),w.push(0),w.push(2),w.push(3),this._indexBuffer=D.createIndexBuffer(w)},t.prototype._rebuild=function(){var D=this._vertexBuffers[Zi.b.PositionKind];D&&D._rebuild(),this._createIndexBuffer(),this.refreshRate===Li.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=Li.REFRESHRATE_RENDER_ONCE)},t.prototype.reset=function(){void 0!==this._effect&&this._effect.dispose()},t.prototype._getDefines=function(){return""},t.prototype.isReady=function(){var D,w=this,N=this._engine;if(!this._fragment)return!1;if(this._fallbackTextureUsed)return!0;var F=this._getDefines();return!(!this._effect||F!==this._cachedDefines||!this._effect.isReady())||(D=void 0!==this._fragment.fragmentElement?{vertex:"procedural",fragmentElement:this._fragment.fragmentElement}:{vertex:"procedural",fragment:this._fragment},this._cachedDefines=F,this._effect=N.createEffect(D,[Zi.b.PositionKind],this._uniforms,this._samplers,F,void 0,void 0,(function(){w.releaseInternalTexture(),w._fallbackTexture&&(w._texture=w._fallbackTexture._texture,w._texture&&w._texture.incrementReferences()),w._fallbackTextureUsed=!0})),this._effect.isReady())},t.prototype.resetRefreshCounter=function(){this._currentRefreshId=-1},t.prototype.setFragment=function(D){this._fragment=D},Object.defineProperty(t.prototype,"refreshRate",{get:function(){return this._refreshRate},set:function(D){this._refreshRate=D,this.resetRefreshCounter()},enumerable:!0,configurable:!0}),t.prototype._shouldRender=function(){return this.isEnabled&&this.isReady()&&this._texture?!this._fallbackTextureUsed&&(-1===this._currentRefreshId||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,this._frameId++,!0):(this._currentRefreshId++,!1)):(this._texture&&(this._texture.isReady=!1),!1)},t.prototype.getRenderSize=function(){return this._size},t.prototype.resize=function(D,w){this._fallbackTextureUsed||(this.releaseInternalTexture(),this._texture=this._engine.createRenderTargetTexture(D,w),this._size=D,this._generateMipMaps=w)},t.prototype._checkUniform=function(D){-1===this._uniforms.indexOf(D)&&this._uniforms.push(D)},t.prototype.setTexture=function(D,w){return-1===this._samplers.indexOf(D)&&this._samplers.push(D),this._textures[D]=w,this},t.prototype.setFloat=function(D,w){return this._checkUniform(D),this._floats[D]=w,this},t.prototype.setInt=function(D,w){return this._checkUniform(D),this._ints[D]=w,this},t.prototype.setFloats=function(D,w){return this._checkUniform(D),this._floatsArrays[D]=w,this},t.prototype.setColor3=function(D,w){return this._checkUniform(D),this._colors3[D]=w,this},t.prototype.setColor4=function(D,w){return this._checkUniform(D),this._colors4[D]=w,this},t.prototype.setVector2=function(D,w){return this._checkUniform(D),this._vectors2[D]=w,this},t.prototype.setVector3=function(D,w){return this._checkUniform(D),this._vectors3[D]=w,this},t.prototype.setMatrix=function(D,w){return this._checkUniform(D),this._matrices[D]=w,this},t.prototype.render=function(D){var w=this.getScene();if(w){var N=this._engine;for(var F in N.enableEffect(this._effect),N.setState(!1),this._textures)this._effect.setTexture(F,this._textures[F]);for(F in this._ints)this._effect.setInt(F,this._ints[F]);for(F in this._floats)this._effect.setFloat(F,this._floats[F]);for(F in this._floatsArrays)this._effect.setArray(F,this._floatsArrays[F]);for(F in this._colors3)this._effect.setColor3(F,this._colors3[F]);for(F in this._colors4){var k=this._colors4[F];this._effect.setFloat4(F,k.r,k.g,k.b,k.a)}for(F in this._vectors2)this._effect.setVector2(F,this._vectors2[F]);for(F in this._vectors3)this._effect.setVector3(F,this._vectors3[F]);for(F in this._matrices)this._effect.setMatrix(F,this._matrices[F]);if(this._texture){if(this.isCube)for(var j=0;j<6;j++)N.bindFramebuffer(this._texture,j,void 0,void 0,!0),N.bindBuffers(this._vertexBuffers,this._indexBuffer,this._effect),this._effect.setFloat("face",j),this.autoClear&&N.clear(w.clearColor,!0,!1,!1),N.drawElementsType(Ps.a.TriangleFillMode,0,6),5===j&&N.generateMipMapsForCubemap(this._texture);else N.bindFramebuffer(this._texture,0,void 0,void 0,!0),N.bindBuffers(this._vertexBuffers,this._indexBuffer,this._effect),this.autoClear&&N.clear(w.clearColor,!0,!1,!1),N.drawElementsType(Ps.a.TriangleFillMode,0,6);N.unBindFramebuffer(this._texture,this.isCube),this.onGenerated&&this.onGenerated(),this.onGeneratedObservable.notifyObservers(this)}}},t.prototype.clone=function(){var D=this.getSize(),w=new t(this.name,D.width,this._fragment,this.getScene(),this._fallbackTexture,this._generateMipMaps);return w.hasAlpha=this.hasAlpha,w.level=this.level,w.coordinatesMode=this.coordinatesMode,w},t.prototype.dispose=function(){var w=this.getScene();if(w){var N=w.proceduralTextures.indexOf(this);N>=0&&w.proceduralTextures.splice(N,1);var F=this._vertexBuffers[Zi.b.PositionKind];F&&(F.dispose(),this._vertexBuffers[Zi.b.PositionKind]=null),this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer)&&(this._indexBuffer=null),D.prototype.dispose.call(this)}},Object(Z.c)([Object(Ie.c)()],t.prototype,"isEnabled",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"autoClear",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"_generateMipMaps",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"_size",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"refreshRate",null),t}(Jt.a),lu=N(65),hu=function(D){function t(w,N,F,k,j,z){var G=D.call(this,w,F,null,k,j,z)||this;return G._animate=!0,G._time=0,G._texturePath=N,G._loadJson(N),G.refreshRate=1,G}return Object(Z.d)(t,D),t.prototype._loadJson=function(D){var w=this,i=function(){oe.a.Log("No config file found in "+D+" trying to use ShadersStore or DOM element");try{w.setFragment(w._texturePath)}catch(D){oe.a.Error("No json or ShaderStore or DOM element found for CustomProceduralTexture")}},N=D+"/config.json",F=new lu.a;F.open("GET",N),F.addEventListener("load",(function(){if(200===F.status||F.responseText&&F.responseText.length>0)try{w._config=JSON.parse(F.response),w.updateShaderUniforms(),w.updateTextures(),w.setFragment(w._texturePath+"/custom"),w._animate=w._config.animate,w.refreshRate=w._config.refreshrate}catch(D){i()}else i()}),!1),F.addEventListener("error",(function(){i()}),!1);try{F.send()}catch(D){oe.a.Error("CustomProceduralTexture: Error on XHR send request.")}},t.prototype.isReady=function(){if(!D.prototype.isReady.call(this))return!1;for(var w in this._textures)if(!this._textures[w].isReady())return!1;return!0},t.prototype.render=function(w){var N=this.getScene();this._animate&&N&&(this._time+=.03*N.getAnimationRatio(),this.updateShaderUniforms()),D.prototype.render.call(this,w)},t.prototype.updateTextures=function(){for(var D=0;D<this._config.sampler2Ds.length;D++)this.setTexture(this._config.sampler2Ds[D].sample2Dname,new Jt.a(this._texturePath+"/"+this._config.sampler2Ds[D].textureRelativeUrl,this.getScene()))},t.prototype.updateShaderUniforms=function(){if(this._config)for(var D=0;D<this._config.uniforms.length;D++){var w=this._config.uniforms[D];switch(w.type){case"float":this.setFloat(w.name,w.value);break;case"color3":this.setColor3(w.name,new G.a(w.r,w.g,w.b));break;case"color4":this.setColor4(w.name,new G.b(w.r,w.g,w.b,w.a));break;case"vector2":this.setVector2(w.name,new z.d(w.x,w.y));break;case"vector3":this.setVector3(w.name,new z.e(w.x,w.y,w.z))}}this.setFloat("time",this._time)},Object.defineProperty(t.prototype,"animate",{get:function(){return this._animate},set:function(D){this._animate=D},enumerable:!0,configurable:!0}),t}(uu);li.a.ShadersStore.noisePixelShader="\n\nuniform float brightness;\nuniform float persistence;\nuniform float timeScale;\n\nvarying vec2 vUV;\n\nvec2 hash22(vec2 p)\n{\np=p*mat2(127.1,311.7,269.5,183.3);\np=-1.0+2.0*fract(sin(p)*43758.5453123);\nreturn sin(p*6.283+timeScale);\n}\nfloat interpolationNoise(vec2 p)\n{\nvec2 pi=floor(p);\nvec2 pf=p-pi;\nvec2 w=pf*pf*(3.-2.*pf);\nfloat f00=dot(hash22(pi+vec2(.0,.0)),pf-vec2(.0,.0));\nfloat f01=dot(hash22(pi+vec2(.0,1.)),pf-vec2(.0,1.));\nfloat f10=dot(hash22(pi+vec2(1.0,0.)),pf-vec2(1.0,0.));\nfloat f11=dot(hash22(pi+vec2(1.0,1.)),pf-vec2(1.0,1.));\nfloat xm1=mix(f00,f10,w.x);\nfloat xm2=mix(f01,f11,w.x);\nfloat ym=mix(xm1,xm2,w.y);\nreturn ym;\n}\nfloat perlinNoise2D(float x,float y)\n{\nfloat sum=0.0;\nfloat frequency=0.0;\nfloat amplitude=0.0;\nfor(int i=0; i<OCTAVES; i++)\n{\nfrequency=pow(2.0,float(i));\namplitude=pow(persistence,float(i));\nsum=sum+interpolationNoise(vec2(x*frequency,y*frequency))*amplitude;\n}\nreturn sum;\n}\n\nvoid main(void)\n{\nfloat x=abs(vUV.x);\nfloat y=abs(vUV.y);\nfloat noise=brightness+(1.0-brightness)*perlinNoise2D(x,y);\ngl_FragColor=vec4(noise,noise,noise,1.0);\n}\n";var fu=function(D){function t(w,N,F,k,j){void 0===N&&(N=256),void 0===F&&(F=Me.a.LastCreatedScene);var z=D.call(this,w,N,"noise",F,k,j)||this;return z._time=0,z.brightness=.2,z.octaves=3,z.persistence=.8,z.animationSpeedFactor=1,z.autoClear=!1,z._updateShaderUniforms(),z}return Object(Z.d)(t,D),t.prototype._updateShaderUniforms=function(){var D=this.getScene();D&&(this._time+=D.getAnimationRatio()*this.animationSpeedFactor*.01,this.setFloat("brightness",this.brightness),this.setFloat("persistence",this.persistence),this.setFloat("timeScale",this._time))},t.prototype._getDefines=function(){return"#define OCTAVES "+(0|this.octaves)},t.prototype.render=function(w){this._updateShaderUniforms(),D.prototype.render.call(this,w)},t.prototype.serialize=function(){var D={customType:"BABYLON.NoiseProceduralTexture"};return D.brightness=this.brightness,D.octaves=this.octaves,D.persistence=this.persistence,D.animationSpeedFactor=this.animationSpeedFactor,D.size=this.getSize().width,D.generateMipMaps=this._generateMipMaps,D},t.Parse=function(D,w){var N=new t(D.name,D.size,w,void 0,D.generateMipMaps);return N.brightness=D.brightness,N.octaves=D.octaves,N.persistence=D.persistence,N.animationSpeedFactor=D.animationSpeedFactor,N},t}(uu);H.a.RegisteredTypes["BABYLON.NoiseProceduralTexture"]=fu;var _u,mu,vu,yu,bu,Tu,Eu=function(D){function t(w,N,F,k,j,z,G,H,X){void 0===k&&(k=ce.a.TEXTUREFORMAT_RGBA),void 0===j&&(j=ce.a.TEXTURETYPE_UNSIGNED_INT),void 0===z&&(z=!1),void 0===G&&(G=!1),void 0===H&&(H=ce.a.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===X&&(X=null);var q=D.call(this,"",w)||this;return q._texture=w.getEngine().createRawCubeTexture(N,F,k,j,z,G,H,X),q}return Object(Z.d)(t,D),t.prototype.update=function(D,w,N,F,k){void 0===k&&(k=null),this._texture.getEngine().updateRawCubeTexture(this._texture,D,w,N,F,k)},t.prototype.updateRGBDAsync=function(D,w,N,F){return void 0===w&&(w=null),void 0===N&&(N=.8),void 0===F&&(F=0),t._UpdateRGBDAsync(this._texture,D,w,N,F)},t.prototype.clone=function(){var D=this;return Ie.a.Clone((function(){var w=D.getScene(),N=D._texture,F=new t(w,N._bufferViewArray,N.width,N.format,N.type,N.generateMipMaps,N.invertY,N.samplingMode,N._compression);return N.source===$t.b.CubeRawRGBD&&F.updateRGBDAsync(N._bufferViewArrayArray,N._sphericalPolynomial,N._lodGenerationScale,N._lodGenerationOffset),F}),this)},t._UpdateRGBDAsync=function(D,w,N,F,k){return D._source=$t.b.CubeRawRGBD,D._bufferViewArrayArray=w,D._lodGenerationScale=F,D._lodGenerationOffset=k,D._sphericalPolynomial=N,Ur.UploadLevelsAsync(D,w).then((function(){D.isReady=!0}))},t}(Vo),Su=function(D){function t(w,N,F,k,j,z,G,H,X,q){void 0===G&&(G=!0),void 0===H&&(H=!1),void 0===X&&(X=Jt.a.TRILINEAR_SAMPLINGMODE),void 0===q&&(q=ce.a.TEXTURETYPE_UNSIGNED_INT);var Z=D.call(this,null,z,!G,H)||this;return Z.format=j,Z._engine=z.getEngine(),Z._texture=z.getEngine().createRawTexture3D(w,N,F,k,j,G,H,X,null,q),Z.is3D=!0,Z}return Object(Z.d)(t,D),t.prototype.update=function(D){this._texture&&this._engine.updateRawTexture3D(this._texture,D,this._texture.format,this._texture.invertY,null,this._texture.type)},t}(Jt.a),Mu=function(D){function t(w,N,F,k,j,z,G,H,X,q){void 0===G&&(G=!0),void 0===H&&(H=!1),void 0===X&&(X=Jt.a.TRILINEAR_SAMPLINGMODE),void 0===q&&(q=ce.a.TEXTURETYPE_UNSIGNED_INT);var Z=D.call(this,null,z,!G,H)||this;return Z.format=j,Z._engine=z.getEngine(),Z._texture=z.getEngine().createRawTexture2DArray(w,N,F,k,j,G,H,X,null,q),Z.is2DArray=!0,Z}return Object(Z.d)(t,D),t.prototype.update=function(D){this._texture&&this._engine.updateRawTexture2DArray(this._texture,D,this._texture.format,this._texture.invertY,null,this._texture.type)},t}(Jt.a),xu=function(D){function t(w,N,F,k){var j=D.call(this,w,N,F,k,!0)||this;return j.refractionPlane=new hr.a(0,1,0,1),j.depth=2,j.onBeforeRenderObservable.add((function(){F.clipPlane=j.refractionPlane})),j.onAfterRenderObservable.add((function(){F.clipPlane=null})),j}return Object(Z.d)(t,D),t.prototype.clone=function(){var D=this.getScene();if(!D)return this;var w=this.getSize(),N=new t(this.name,w.width,D,this._generateMipMaps);return N.hasAlpha=this.hasAlpha,N.level=this.level,N.refractionPlane=this.refractionPlane.clone(),this.renderList&&(N.renderList=this.renderList.slice(0)),N.depth=this.depth,N},t.prototype.serialize=function(){if(!this.name)return null;var w=D.prototype.serialize.call(this);return w.mirrorPlane=this.refractionPlane.asArray(),w.depth=this.depth,w},t}(Li),Au=function(D){function t(w,N,F){var k=D.call(this,F.scene)||this;return N&&(F.engine||F.scene)?(F=Object(Z.a)(Object(Z.a)({},t.DefaultOptions),F),k._engine=F.engine||F.scene.getEngine(),k._generateMipMaps=F.generateMipMaps,k._samplingMode=F.samplingMode,k._textureMatrix=z.a.Identity(),k.name=w,k.element=N,k._isVideo=N instanceof HTMLVideoElement,k.anisotropicFilteringLevel=1,k._createInternalTexture(),k):k}return Object(Z.d)(t,D),t.prototype._createInternalTexture=function(){var D=0,w=0;this._isVideo?(D=this.element.videoWidth,w=this.element.videoHeight):(D=this.element.width,w=this.element.height),this._texture=this._engine.createDynamicTexture(D,w,this._generateMipMaps,this._samplingMode),this.update()},t.prototype.getTextureMatrix=function(){return this._textureMatrix},t.prototype.update=function(D){if(void 0===D&&(D=null),null!=this._texture)if(this._isVideo){var w=this.element;if(w.readyState<w.HAVE_CURRENT_DATA)return;this._engine.updateVideoTexture(this._texture,w,null===D||D)}else{var N=this.element;this._engine.updateDynamicTexture(this._texture,N,null===D||D,!1)}},t.DefaultOptions={generateMipMaps:!1,samplingMode:ce.a.TEXTURE_BILINEAR_SAMPLINGMODE,engine:null,scene:null},t}(Nr.a),_c=function(D,w,N){this.id=D,this.scale=w,this.offset=N},Pu=function(){function e(D,w,N,F){return this.name=D,this.meshes=w,this.scene=F,this.options=N,this.options.map=this.options.map||["ambientTexture","bumpTexture","diffuseTexture","emissiveTexture","lightmapTexture","opacityTexture","reflectionTexture","refractionTexture","specularTexture"],this.options.uvsIn=this.options.uvsIn||Zi.b.UVKind,this.options.uvsOut=this.options.uvsOut||Zi.b.UVKind,this.options.layout=this.options.layout||e.LAYOUT_STRIP,this.options.layout===e.LAYOUT_COLNUM&&(this.options.colnum=this.options.colnum||8),this.options.updateInputMeshes=this.options.updateInputMeshes||!0,this.options.disposeSources=this.options.disposeSources||!0,this._expecting=0,this.options.fillBlanks=this.options.fillBlanks||!0,!0===this.options.fillBlanks&&(this.options.customFillColor=this.options.customFillColor||"black"),this.options.frameSize=this.options.frameSize||256,this.options.paddingRatio=this.options.paddingRatio||.0115,this._paddingValue=Math.ceil(this.options.frameSize*this.options.paddingRatio),this._paddingValue%2!=0&&this._paddingValue++,this.options.paddingMode=this.options.paddingMode||e.SUBUV_WRAP,this.options.paddingMode===e.SUBUV_COLOR&&(this.options.paddingColor=this.options.paddingColor||new G.b(0,0,0,1)),this.sets={},this.frames=[],this}return e.prototype._createFrames=function(D){for(var w=this,N=this._calculateSize(),F=new z.d(1,1).divide(N),k=0,j=this._expecting,H=this.meshes.length,X=Object.keys(this.sets),q=0;q<X.length;q++){var Z=X[q],J=new Xi(this.name+".TexturePack."+Z+"Set",{width:N.x,height:N.y},this.scene,!0,Jt.a.TRILINEAR_SAMPLINGMODE,Ct.a.TEXTUREFORMAT_RGBA),$=J.getContext();$.fillStyle="rgba(0,0,0,0)",$.fillRect(0,0,N.x,N.y),J.update(!1),this.sets[Z]=J}var te=this.options.frameSize||256,ie=this._paddingValue,oe=te+2*ie;for(q=0;q<H;q++)for(var ce=this.meshes[q].material,v=function(z){var H=new Xi("temp",oe,he.scene,!0),Z=H.getContext(),J=he._getFrameOffset(q),f=function(){k++,H.update(!1);var z=Z.getImageData(0,0,oe,oe),G=w.sets[$];if(G.getContext().putImageData(z,N.x*J.x,N.y*J.y),H.dispose(),G.update(!1),k==j)return w._calculateMeshUVFrames(te,ie,N,F,w.options.updateInputMeshes||!1),void D()},$=X[z]||"_blank";if(ce&&null!==ce[$]){var fe=ce[$],pe=new Image;pe.src=fe instanceof Xi?fe.getContext().canvas.toDataURL("image/png"):fe.url,pe.onload=function(){Z.fillStyle="rgba(0,0,0,0)",Z.fillRect(0,0,oe,oe),H.update(!1),Z.setTransform(1,0,0,-1,0,0);var D=[0,0,1,0,1,1,0,1,-1,1,-1,0,-2,0,-1,1,-1];switch(w.options.paddingMode){case 0:for(var N=0;N<9;N++)Z.drawImage(pe,0,0,pe.width,pe.height,ie+te*D[N],ie+te*D[N+1]-oe,te,te);break;case 1:for(var F=0;F<ie;F++)Z.drawImage(pe,0,0,pe.width,pe.height,F+te*D[0],ie-oe,te,te),Z.drawImage(pe,0,0,pe.width,pe.height,2*ie-F,ie-oe,te,te),Z.drawImage(pe,0,0,pe.width,pe.height,ie,F-oe,te,te),Z.drawImage(pe,0,0,pe.width,pe.height,ie,2*ie-F-oe,te,te);Z.drawImage(pe,0,0,pe.width,pe.height,ie+te*D[0],ie+te*D[1]-oe,te,te);break;case 2:Z.fillStyle=(w.options.paddingColor||G.a.Black()).toHexString(),Z.fillRect(0,0,oe,-oe),Z.clearRect(ie,ie,te,te),Z.drawImage(pe,0,0,pe.width,pe.height,ie+te*D[0],ie+te*D[1]-oe,te,te)}Z.setTransform(1,0,0,1,0,0),f()}}else Z.fillStyle="rgba(0,0,0,0)",he.options.fillBlanks&&(Z.fillStyle=he.options.customFillColor),Z.fillRect(0,0,oe,oe),f()},he=this,fe=0;fe<X.length;fe++)v(fe)},e.prototype._calculateSize=function(){var D=this.meshes.length||0,w=this.options.frameSize||0,N=this._paddingValue||0;switch(this.options.layout){case 0:return new z.d(w*D+2*N*D,w+2*N);case 1:var F=Math.max(2,Math.ceil(Math.sqrt(D))),k=w*F+2*N*F;return new z.d(k,k);case 2:var j=this.options.colnum||1,G=Math.max(1,Math.ceil(D/j));return new z.d(w*j+2*N*j,w*G+2*N*G)}return z.d.Zero()},e.prototype._calculateMeshUVFrames=function(D,w,N,F,k){for(var j=this.meshes.length,G=0;G<j;G++){var H=this.meshes[G],X=new z.d(D/N.x,D/N.y),q=F.clone().scale(w),Z=this._getFrameOffset(G).add(q),J=new _c(G,X,Z);this.frames.push(J),k&&(this._updateMeshUV(H,G),this._updateTextureReferences(H))}},e.prototype._getFrameOffset=function(D){var w,N,F,k=this.meshes.length;switch(this.options.layout){case 0:return w=1/k,new z.d(D*w,0);case 1:var j=Math.max(2,Math.ceil(Math.sqrt(k)));return F=D-(N=Math.floor(D/j))*j,w=1/j,new z.d(F*w,N*w);case 2:var G=this.options.colnum||1,H=Math.max(1,Math.ceil(k/G));return N=D-(F=Math.floor(D/H))*H,w=new z.d(1/G,1/H),new z.d(F*w.x,N*w.y)}return z.d.Zero()},e.prototype._updateMeshUV=function(D,w){var N=this.frames[w],F=D.getVerticesData(this.options.uvsIn||Zi.b.UVKind),k=[],j=0;F.length&&(j=F.length||0);for(var z=0;z<j;z+=2)k.push(F[z]*N.scale.x+N.offset.x,F[z+1]*N.scale.y+N.offset.y);D.setVerticesData(this.options.uvsOut||Zi.b.UVKind,k)},e.prototype._updateTextureReferences=function(D,w){void 0===w&&(w=!1);for(var N=D.material,F=Object.keys(this.sets),r=function(D){D.dispose&&D.dispose()},k=0;k<F.length;k++){var j=F[k];if(w)null!==N[j]&&r(N[j]),N[j]=this.sets[j];else{if(!N)return;null!==N[j]&&(r(N[j]),N[j]=this.sets[j])}}},e.prototype.setMeshToFrame=function(D,w,N){void 0===N&&(N=!1),this._updateMeshUV(D,w),N&&this._updateTextureReferences(D,!0)},e.prototype.processAsync=function(){var D=this;return new Promise((function(w,N){try{if(0===D.meshes.length)return void w();for(var F=0,r=function(N){var k=D.meshes[N],j=k.material;if(!j)return++F===D.meshes.length?{value:D._createFrames(w)}:"continue";j.forceCompilationAsync(k).then((function(){!function(N){if(F++,D.options.map){for(var k=0;k<D.options.map.length;k++)null!==N[D.options.map[k]]&&(D.sets[D.options.map[k]]||(D.sets[D.options.map[k]]=!0),D._expecting++);F===D.meshes.length&&D._createFrames(w)}}(j)}))},k=0;k<D.meshes.length;k++){var j=r(k);if("object"==typeof j)return j.value}}catch(D){return N(D)}}))},e.prototype.dispose=function(){for(var D=Object.keys(this.sets),w=0;w<D.length;w++){var N=D[w];this.sets[N].dispose()}},e.prototype.download=function(D,w){var N=this;void 0===D&&(D="png"),void 0===w&&(w=1),setTimeout((function(){var F={name:N.name,sets:{},options:{},frames:[]},k=Object.keys(N.sets),j=Object.keys(N.options);try{for(var z=0;z<k.length;z++){var G=k[z],H=N.sets[G];F.sets[G]=H.getContext().canvas.toDataURL("image/"+D,w)}for(z=0;z<j.length;z++){var X=j[z];F.options[X]=N.options[X]}for(z=0;z<N.frames.length;z++){var q=N.frames[z];F.frames.push(q.scale.x,q.scale.y,q.offset.x,q.offset.y)}}catch(D){return void oe.a.Warn("Unable to download: "+D)}var Z="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(F,null,4)),J=document.createElement("a");J.setAttribute("href",Z),J.setAttribute("download",N.name+"_texurePackage.json"),document.body.appendChild(J),J.click(),J.remove()}),0)},e.prototype.updateFromJSON=function(D){try{var w=JSON.parse(D);this.name=w.name;for(var N=Object.keys(w.options),F=0;F<N.length;F++)this.options[N[F]]=w.options[N[F]];for(F=0;F<w.frames.length;F+=4){var k=new _c(F/4,new z.d(w.frames[F],w.frames[F+1]),new z.d(w.frames[F+2],w.frames[F+3]));this.frames.push(k)}var j=Object.keys(w.sets);for(F=0;F<j.length;F++){var G=new Jt.a(w.sets[j[F]],this.scene,!1,!1);this.sets[j[F]]=G}}catch(D){oe.a.Warn("Unable to update from JSON: "+D)}},e.LAYOUT_STRIP=0,e.LAYOUT_POWER2=1,e.LAYOUT_COLNUM=2,e.SUBUV_WRAP=0,e.SUBUV_EXTEND=1,e.SUBUV_COLOR=2,e}();!function(D){D[D.Vertex=1]="Vertex",D[D.Fragment=2]="Fragment",D[D.Neutral=4]="Neutral",D[D.VertexAndFragment=3]="VertexAndFragment"}(_u||(_u={})),function(D){D[D.Float=1]="Float",D[D.Int=2]="Int",D[D.Vector2=4]="Vector2",D[D.Vector3=8]="Vector3",D[D.Vector4=16]="Vector4",D[D.Color3=32]="Color3",D[D.Color4=64]="Color4",D[D.Matrix=128]="Matrix",D[D.AutoDetect=1024]="AutoDetect",D[D.BasedOnInput=2048]="BasedOnInput"}(mu||(mu={})),function(D){D[D.Uniform=0]="Uniform",D[D.Attribute=1]="Attribute",D[D.Varying=2]="Varying",D[D.Undefined=3]="Undefined"}(vu||(vu={})),function(D){D[D.World=1]="World",D[D.View=2]="View",D[D.Projection=3]="Projection",D[D.ViewProjection=4]="ViewProjection",D[D.WorldView=5]="WorldView",D[D.WorldViewProjection=6]="WorldViewProjection",D[D.CameraPosition=7]="CameraPosition",D[D.FogColor=8]="FogColor",D[D.DeltaTime=9]="DeltaTime"}(yu||(yu={})),function(D){D[D.Compatible=0]="Compatible",D[D.TypeIncompatible=1]="TypeIncompatible",D[D.TargetIncompatible=2]="TargetIncompatible"}(bu||(bu={})),function(D){D[D.Input=0]="Input",D[D.Output=1]="Output"}(Tu||(Tu={}));var Cu=function(){function e(D,w,N){this._connectedPoint=null,this._endpoints=new Array,this._typeConnectionSource=null,this._linkedConnectionSource=null,this._type=mu.Float,this._enforceAssociatedVariableName=!1,this.acceptedConnectionPointTypes=new Array,this.excludedConnectionPointTypes=new Array,this.onConnectionObservable=new j.c,this._prioritizeVertex=!1,this._target=_u.VertexAndFragment,this._ownerBlock=w,this.name=D,this._direction=N}return Object.defineProperty(e.prototype,"direction",{get:function(){return this._direction},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"associatedVariableName",{get:function(){return this._ownerBlock.isInput?this._ownerBlock.associatedVariableName:this._enforceAssociatedVariableName&&this._associatedVariableName||!this._connectedPoint?this._associatedVariableName:this._connectedPoint.associatedVariableName},set:function(D){this._associatedVariableName=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"innerType",{get:function(){return this._linkedConnectionSource&&this._linkedConnectionSource.isConnected?this.type:this._type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){if(this._type===mu.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource&&this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type}return this._type===mu.BasedOnInput&&this._typeConnectionSource?this._typeConnectionSource.type:this._type},set:function(D){this._type=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this._prioritizeVertex&&this._ownerBlock?this._target!==_u.VertexAndFragment?this._target:this._ownerBlock.target===_u.Fragment?_u.Fragment:_u.Vertex:this._target},set:function(D){this._target=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isConnected",{get:function(){return null!==this.connectedPoint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isConnectedToInputBlock",{get:function(){return null!==this.connectedPoint&&this.connectedPoint.ownerBlock.isInput},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"connectInputBlock",{get:function(){return this.isConnectedToInputBlock?this.connectedPoint.ownerBlock:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"connectedPoint",{get:function(){return this._connectedPoint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ownerBlock",{get:function(){return this._ownerBlock},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sourceBlock",{get:function(){return this._connectedPoint?this._connectedPoint.ownerBlock:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"connectedBlocks",{get:function(){return 0===this._endpoints.length?[]:this._endpoints.map((function(D){return D.ownerBlock}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"endpoints",{get:function(){return this._endpoints},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasEndpoints",{get:function(){return this._endpoints&&this._endpoints.length>0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isConnectedInVertexShader",{get:function(){if(this.target===_u.Vertex)return!0;if(!this.hasEndpoints)return!1;for(var D=0,w=this._endpoints;D<w.length;D++){var N=w[D];if(N.ownerBlock.target===_u.Vertex)return!0;if(N.target===_u.Vertex)return!0;if((N.ownerBlock.target===_u.Neutral||N.ownerBlock.target===_u.VertexAndFragment)&&N.ownerBlock.outputs.some((function(D){return D.isConnectedInVertexShader})))return!0}return!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isConnectedInFragmentShader",{get:function(){if(this.target===_u.Fragment)return!0;if(!this.hasEndpoints)return!1;for(var D=0,w=this._endpoints;D<w.length;D++){var N=w[D];if(N.ownerBlock.target===_u.Fragment)return!0;if((N.ownerBlock.target===_u.Neutral||N.ownerBlock.target===_u.VertexAndFragment)&&N.ownerBlock.outputs.some((function(D){return D.isConnectedInFragmentShader})))return!0}return!1},enumerable:!0,configurable:!0}),e.prototype.getClassName=function(){return"NodeMaterialConnectionPoint"},e.prototype.canConnectTo=function(D){return this.checkCompatibilityState(D)===bu.Compatible},e.prototype.checkCompatibilityState=function(D){if(this._ownerBlock.target===_u.Fragment){var w=D.ownerBlock;if(w.target===_u.Vertex)return bu.TargetIncompatible;for(var N=0,F=w.outputs;N<F.length;N++)if(F[N].isConnectedInVertexShader)return bu.TargetIncompatible}if(this.type!==D.type&&D.innerType!==mu.AutoDetect){switch(this.type){case mu.Vector3:if(D.type===mu.Color3)return bu.Compatible;break;case mu.Vector4:if(D.type===mu.Color4)return bu.Compatible;break;case mu.Color3:if(D.type===mu.Vector3)return bu.Compatible;break;case mu.Color4:if(D.type===mu.Vector4)return bu.Compatible}return D.acceptedConnectionPointTypes&&-1!==D.acceptedConnectionPointTypes.indexOf(this.type)?bu.Compatible:bu.TypeIncompatible}return D.excludedConnectionPointTypes&&-1!==D.excludedConnectionPointTypes.indexOf(this.type)?1:bu.Compatible},e.prototype.connectTo=function(D,w){if(void 0===w&&(w=!1),!w&&!this.canConnectTo(D))throw"Cannot connect these two connectors.";return this._endpoints.push(D),D._connectedPoint=this,this._enforceAssociatedVariableName=!1,this.onConnectionObservable.notifyObservers(D),D.onConnectionObservable.notifyObservers(this),this},e.prototype.disconnectFrom=function(D){var w=this._endpoints.indexOf(D);return-1===w||(this._endpoints.splice(w,1),D._connectedPoint=null,this._enforceAssociatedVariableName=!1,D._enforceAssociatedVariableName=!1),this},e.prototype.serialize=function(){var D={};return D.name=this.name,this.connectedPoint&&(D.inputName=this.name,D.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,D.targetConnectionName=this.connectedPoint.name),D},e.prototype.dispose=function(){this.onConnectionObservable.clear()},e}(),Ou=N(138),Ru=function(){function e(D,w,N,F){void 0===w&&(w=_u.Vertex),void 0===N&&(N=!1),void 0===F&&(F=!1),this._isFinalMerger=!1,this._isInput=!1,this._isUnique=!1,this.inputsAreExclusive=!1,this._codeVariableName="",this._inputs=new Array,this._outputs=new Array,this.comments="",this.name=D,this._target=w,this._isFinalMerger=N,this._isInput=F,this.uniqueId=Ou.a.UniqueId}return Object.defineProperty(e.prototype,"isUnique",{get:function(){return this._isUnique},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isFinalMerger",{get:function(){return this._isFinalMerger},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isInput",{get:function(){return this._isInput},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"buildId",{get:function(){return this._buildId},set:function(D){this._buildId=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this._target},set:function(D){0==(this._target&D)&&(this._target=D)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputs",{get:function(){return this._inputs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outputs",{get:function(){return this._outputs},enumerable:!0,configurable:!0}),e.prototype.getInputByName=function(D){var w=this._inputs.filter((function(w){return w.name===D}));return w.length?w[0]:null},e.prototype.getOutputByName=function(D){var w=this._outputs.filter((function(w){return w.name===D}));return w.length?w[0]:null},e.prototype.initialize=function(D){},e.prototype.bind=function(D,w,N){},e.prototype._declareOutput=function(D,w){return w._getGLType(D.type)+" "+D.associatedVariableName},e.prototype._writeVariable=function(D){return D.connectedPoint?""+D.associatedVariableName:"0."},e.prototype._writeFloat=function(D){var w=D.toString();return-1===w.indexOf(".")&&(w+=".0"),""+w},e.prototype.getClassName=function(){return"NodeMaterialBlock"},e.prototype.registerInput=function(D,w,N,F){void 0===N&&(N=!1);var k=new Cu(D,this,Tu.Input);return k.type=w,k.isOptional=N,F&&(k.target=F),this._inputs.push(k),this},e.prototype.registerOutput=function(D,w,N){var F=new Cu(D,this,Tu.Output);return F.type=w,N&&(F.target=N),this._outputs.push(F),this},e.prototype.getFirstAvailableInput=function(D){void 0===D&&(D=null);for(var w=0,N=this._inputs;w<N.length;w++){var F=N[w];if(!(F.connectedPoint||D&&D.type!==F.type&&F.type!==mu.AutoDetect))return F}return null},e.prototype.getFirstAvailableOutput=function(D){void 0===D&&(D=null);for(var w=0,N=this._outputs;w<N.length;w++){var F=N[w];if(!D||!D.target||D.target===_u.Neutral||0!=(D.target&F.target))return F}return null},e.prototype.getSiblingOutput=function(D){var w=this._outputs.indexOf(D);return-1===w||w>=this._outputs.length?null:this._outputs[w+1]},e.prototype.connectTo=function(D,w){if(0!==this._outputs.length){for(var N=w&&w.output?this.getOutputByName(w.output):this.getFirstAvailableOutput(D),F=!0;F;){var k=w&&w.input?D.getInputByName(w.input):D.getFirstAvailableInput(N);if(N&&k&&N.canConnectTo(k))N.connectTo(k),F=!1;else{if(!N)throw"Unable to find a compatible match";N=this.getSiblingOutput(N)}}return this}},e.prototype._buildBlock=function(D){},e.prototype.updateUniformsAndSamples=function(D,w,N,F){},e.prototype.provideFallbacks=function(D,w){},e.prototype.initializeDefines=function(D,w,N,F){void 0===F&&(F=!1)},e.prototype.prepareDefines=function(D,w,N,F){void 0===F&&(F=!1)},e.prototype.autoConfigure=function(D){},e.prototype.replaceRepeatableContent=function(D,w,N,F){},e.prototype.isReady=function(D,w,N,F){return void 0===F&&(F=!1),!0},e.prototype._linkConnectionTypes=function(D,w){this._inputs[D]._linkedConnectionSource=this._inputs[w],this._inputs[w]._linkedConnectionSource=this._inputs[D]},e.prototype._processBuild=function(D,w,N,F){D.build(w,F);var k=null!=w._vertexState,j=D._buildTarget===_u.Vertex&&D.target!==_u.VertexAndFragment;if(k&&(0==(D.target&D._buildTarget)||0==(D.target&N.target)||this.target!==_u.VertexAndFragment&&j)&&(!D.isInput&&w.target!==D._buildTarget||D.isInput&&D.isAttribute)){var z=N.connectedPoint;w._vertexState._emitVaryingFromString("v_"+z.associatedVariableName,w._getGLType(z.type))&&(w._vertexState.compilationString+="v_"+z.associatedVariableName+" = "+z.associatedVariableName+";\r\n"),N.associatedVariableName="v_"+z.associatedVariableName,N._enforceAssociatedVariableName=!0}},e.prototype.build=function(D,w){if(this._buildId===D.sharedData.buildId)return!0;if(!this.isInput)for(var N=0,F=this._outputs;N<F.length;N++)(X=F[N]).associatedVariableName||(X.associatedVariableName=D._getFreeVariableName(X.name));for(var k=0,j=this._inputs;k<j.length;k++){var z=j[k];if(z.connectedPoint){if(this.target!==_u.Neutral){if(0==(z.target&this.target))continue;if(0==(z.target&D.target))continue}(J=z.connectedPoint.ownerBlock)&&J!==this&&this._processBuild(J,D,z,w)}else z.isOptional||D.sharedData.checks.notConnectedNonOptionalInputs.push(z)}if(this._buildId===D.sharedData.buildId)return!0;if(D.sharedData.verbose&&console.log((D.target===_u.Vertex?"Vertex shader":"Fragment shader")+": Building "+this.name+" ["+this.getClassName()+"]"),this.isFinalMerger)switch(D.target){case _u.Vertex:D.sharedData.checks.emitVertex=!0;break;case _u.Fragment:D.sharedData.checks.emitFragment=!0}!this.isInput&&D.sharedData.emitComments&&(D.compilationString+="\r\n//"+this.name+"\r\n"),this._buildBlock(D),this._buildId=D.sharedData.buildId,this._buildTarget=D.target;for(var G=0,H=this._outputs;G<H.length;G++){var X;if(0!=((X=H[G]).target&D.target))for(var q=0,Z=X.endpoints;q<Z.length;q++){var J,$=Z[q];(J=$.ownerBlock)&&0!=(J.target&D.target)&&-1!==w.indexOf(J)&&this._processBuild(J,D,$,w)}}return!1},e.prototype._inputRename=function(D){return D},e.prototype._outputRename=function(D){return D},e.prototype._dumpPropertiesCode=function(){return""},e.prototype._dumpCode=function(D,w){var N;w.push(this);var F=this.name.replace(/[^A-Za-z_]+/g,"");if(this._codeVariableName=F||this.getClassName()+"_"+this.uniqueId,-1!==D.indexOf(this._codeVariableName)){var k=0;do{k++,this._codeVariableName=F+k}while(-1!==D.indexOf(this._codeVariableName))}D.push(this._codeVariableName),N="\r\n// "+this.getClassName()+"\r\n",this.comments&&(N+="// "+this.comments+"\r\n"),N+="var "+this._codeVariableName+" = new BABYLON."+this.getClassName()+'("'+this.name+'");\r\n',N+=this._dumpPropertiesCode();for(var j=0,z=this.inputs;j<z.length;j++){var G=z[j];if(G.isConnected){var H=G.connectedPoint.ownerBlock;-1===w.indexOf(H)&&(N+=H._dumpCode(D,w))}}for(var X=0,q=this.outputs;X<q.length;X++){var Z=q[X];if(Z.hasEndpoints)for(var J=0,$=Z.endpoints;J<$.length;J++)(H=$[J].ownerBlock)&&-1===w.indexOf(H)&&(N+=H._dumpCode(D,w))}return N},e.prototype._dumpCodeForOutputConnections=function(D){var w="";if(-1!==D.indexOf(this))return w;D.push(this);for(var N=0,F=this.inputs;N<F.length;N++){var k=F[N];if(k.isConnected){var j=k.connectedPoint,z=j.ownerBlock;w+=z._dumpCodeForOutputConnections(D),w+=z._codeVariableName+"."+z._outputRename(j.name)+".connectTo("+this._codeVariableName+"."+this._inputRename(k.name)+");\r\n"}}return w},e.prototype.clone=function(D,w){void 0===w&&(w="");var N=this.serialize(),F=H.a.GetClass(N.customType);if(F){var k=new F;return k._deserialize(N,D,w),k}return null},e.prototype.serialize=function(){var D={};D.customType="BABYLON."+this.getClassName(),D.id=this.uniqueId,D.name=this.name,D.comments=this.comments,D.inputs=[];for(var w=0,N=this.inputs;w<N.length;w++){var F=N[w];D.inputs.push(F.serialize())}return D},e.prototype._deserialize=function(D,w,N){this.name=D.name,this.comments=D.comments},e.prototype.dispose=function(){for(var D=0,w=this.inputs;D<w.length;D++)w[D].dispose();for(var N=0,F=this.outputs;N<F.length;N++)F[N].dispose()},e}(),Du=function(){function e(){this.supportUniformBuffers=!1,this.attributes=new Array,this.uniforms=new Array,this.constants=new Array,this.samplers=new Array,this.functions={},this.extensions={},this.counters={},this._attributeDeclaration="",this._uniformDeclaration="",this._constantDeclaration="",this._samplerDeclaration="",this._varyingTransfer="",this._repeatableContentAnchorIndex=0,this._builtCompilationString="",this.compilationString=""}return e.prototype.finalize=function(D){var w=D.sharedData.emitComments,N=this.target===_u.Fragment;this.compilationString="\r\n"+(w?"//Entry point\r\n":"")+"void main(void) {\r\n"+this.compilationString,this._constantDeclaration&&(this.compilationString="\r\n"+(w?"//Constants\r\n":"")+this._constantDeclaration+"\r\n"+this.compilationString);var F="";for(var k in this.functions)F+=this.functions[k]+"\r\n";for(var j in this.compilationString="\r\n"+F+"\r\n"+this.compilationString,!N&&this._varyingTransfer&&(this.compilationString=this.compilationString+"\r\n"+this._varyingTransfer),this.compilationString=this.compilationString+"\r\n}",this.sharedData.varyingDeclaration&&(this.compilationString="\r\n"+(w?"//Varyings\r\n":"")+this.sharedData.varyingDeclaration+"\r\n"+this.compilationString),this._samplerDeclaration&&(this.compilationString="\r\n"+(w?"//Samplers\r\n":"")+this._samplerDeclaration+"\r\n"+this.compilationString),this._uniformDeclaration&&(this.compilationString="\r\n"+(w?"//Uniforms\r\n":"")+this._uniformDeclaration+"\r\n"+this.compilationString),this._attributeDeclaration&&!N&&(this.compilationString="\r\n"+(w?"//Attributes\r\n":"")+this._attributeDeclaration+"\r\n"+this.compilationString),this.extensions){var z=this.extensions[j];this.compilationString="\r\n"+z+"\r\n"+this.compilationString}this._builtCompilationString=this.compilationString},Object.defineProperty(e.prototype,"_repeatableContentAnchor",{get:function(){return"###___ANCHOR"+this._repeatableContentAnchorIndex+++"___###"},enumerable:!0,configurable:!0}),e.prototype._getFreeVariableName=function(D){return D=D.replace(/[^a-zA-Z_]+/g,""),void 0===this.sharedData.variableNames[D]?(this.sharedData.variableNames[D]=0,"output"===D||"texture"===D?D+this.sharedData.variableNames[D]:D):(this.sharedData.variableNames[D]++,D+this.sharedData.variableNames[D])},e.prototype._getFreeDefineName=function(D){return void 0===this.sharedData.defineNames[D]?this.sharedData.defineNames[D]=0:this.sharedData.defineNames[D]++,D+this.sharedData.defineNames[D]},e.prototype._excludeVariableName=function(D){this.sharedData.variableNames[D]=0},e.prototype._emit2DSampler=function(D){this._samplerDeclaration+="uniform sampler2D "+D+";\r\n",this.samplers.push(D)},e.prototype._getGLType=function(D){switch(D){case mu.Float:return"float";case mu.Int:return"int";case mu.Vector2:return"vec2";case mu.Color3:case mu.Vector3:return"vec3";case mu.Color4:case mu.Vector4:return"vec4";case mu.Matrix:return"mat4"}return""},e.prototype._emitExtension=function(D,w){this.extensions[D]||(this.extensions[D]=w)},e.prototype._emitFunction=function(D,w,N){this.functions[D]||(this.sharedData.emitComments&&(w=N+"\r\n"+w),this.functions[D]=w)},e.prototype._emitCodeFromInclude=function(D,w,N){if(N&&N.repeatKey)return"#include<"+D+">[0.."+N.repeatKey+"]\r\n";var F=li.a.IncludesShadersStore[D]+"\r\n";if(this.sharedData.emitComments&&(F=w+"\r\n"+F),!N)return F;if(N.replaceStrings)for(var k=0;k<N.replaceStrings.length;k++){var j=N.replaceStrings[k];F=F.replace(j.search,j.replace)}return F},e.prototype._emitFunctionFromInclude=function(D,w,N,F){void 0===F&&(F="");var k=D+F;if(!this.functions[k]){if(!N||!(N.removeAttributes||N.removeUniforms||N.removeVaryings||N.removeIfDef||N.replaceStrings))return N&&N.repeatKey?this.functions[k]="#include<"+D+">[0.."+N.repeatKey+"]\r\n":this.functions[k]="#include<"+D+">\r\n",void(this.sharedData.emitComments&&(this.functions[k]=w+"\r\n"+this.functions[k]));if(this.functions[k]=li.a.IncludesShadersStore[D],this.sharedData.emitComments&&(this.functions[k]=w+"\r\n"+this.functions[k]),N.removeIfDef&&(this.functions[k]=this.functions[k].replace(/^\s*?#ifdef.+$/gm,""),this.functions[k]=this.functions[k].replace(/^\s*?#endif.*$/gm,""),this.functions[k]=this.functions[k].replace(/^\s*?#else.*$/gm,""),this.functions[k]=this.functions[k].replace(/^\s*?#elif.*$/gm,"")),N.removeAttributes&&(this.functions[k]=this.functions[k].replace(/^\s*?attribute.+$/gm,"")),N.removeUniforms&&(this.functions[k]=this.functions[k].replace(/^\s*?uniform.+$/gm,"")),N.removeVaryings&&(this.functions[k]=this.functions[k].replace(/^\s*?varying.+$/gm,"")),N.replaceStrings)for(var j=0;j<N.replaceStrings.length;j++){var z=N.replaceStrings[j];this.functions[k]=this.functions[k].replace(z.search,z.replace)}}},e.prototype._registerTempVariable=function(D){return-1===this.sharedData.temps.indexOf(D)&&(this.sharedData.temps.push(D),!0)},e.prototype._emitVaryingFromString=function(D,w,N,F){return void 0===N&&(N=""),void 0===F&&(F=!1),-1===this.sharedData.varyings.indexOf(D)&&(this.sharedData.varyings.push(D),N&&(Uo.a.StartsWith(N,"defined(")?this.sharedData.varyingDeclaration+="#if "+N+"\r\n":this.sharedData.varyingDeclaration+=(F?"#ifndef":"#ifdef")+" "+N+"\r\n"),this.sharedData.varyingDeclaration+="varying "+w+" "+D+";\r\n",N&&(this.sharedData.varyingDeclaration+="#endif\r\n"),!0)},e.prototype._emitUniformFromString=function(D,w,N,F){void 0===N&&(N=""),void 0===F&&(F=!1),-1===this.uniforms.indexOf(D)&&(this.uniforms.push(D),N&&(this._uniformDeclaration+=(F?"#ifndef":"#ifdef")+" "+N+"\r\n"),this._uniformDeclaration+="uniform "+w+" "+D+";\r\n",N&&(this._uniformDeclaration+="#endif\r\n"))},e.prototype._emitFloat=function(D){return D.toString()===D.toFixed(0)?D+".0":D.toString()},e}(),Iu=function(){function e(){this.temps=new Array,this.varyings=new Array,this.varyingDeclaration="",this.inputBlocks=new Array,this.textureBlocks=new Array,this.bindableBlocks=new Array,this.blocksWithFallbacks=new Array,this.blocksWithDefines=new Array,this.repeatableContentBlocks=new Array,this.dynamicUniformBlocks=new Array,this.blockingBlocks=new Array,this.animatedInputs=new Array,this.variableNames={},this.defineNames={},this.hints={needWorldViewMatrix:!1,needWorldViewProjectionMatrix:!1,needAlphaBlending:!1,needAlphaTesting:!1},this.checks={emitVertex:!1,emitFragment:!1,notConnectedNonOptionalInputs:new Array},this.variableNames.position=0,this.variableNames.normal=0,this.variableNames.tangent=0,this.variableNames.uv=0,this.variableNames.uv2=0,this.variableNames.uv3=0,this.variableNames.uv4=0,this.variableNames.uv4=0,this.variableNames.uv5=0,this.variableNames.uv6=0,this.variableNames.color=0,this.variableNames.matricesIndices=0,this.variableNames.matricesWeights=0,this.variableNames.matricesIndicesExtra=0,this.variableNames.matricesWeightsExtra=0,this.variableNames.diffuseBase=0,this.variableNames.specularBase=0,this.variableNames.worldPos=0,this.variableNames.shadow=0,this.variableNames.vTBN=0,this.defineNames.MAINUV0=0,this.defineNames.MAINUV1=0,this.defineNames.MAINUV2=0,this.defineNames.MAINUV3=0,this.defineNames.MAINUV4=0,this.defineNames.MAINUV5=0,this.defineNames.MAINUV6=0,this.defineNames.MAINUV7=0}return e.prototype.emitErrors=function(){var D="";this.checks.emitVertex||(D+="NodeMaterial does not have a vertex output. You need to at least add a block that generates a glPosition value.\r\n"),this.checks.emitFragment||(D+="NodeMaterial does not have a fragment output. You need to at least add a block that generates a glFragColor value.\r\n");for(var w=0,N=this.checks.notConnectedNonOptionalInputs;w<N.length;w++){var F=N[w];D+="input "+F.name+" from block "+F.ownerBlock.name+"["+F.ownerBlock.getClassName()+"] is not connected and is not optional.\r\n"}if(D)throw"Build of NodeMaterial failed:\r\n"+D},e}(),Lu=function(D){function t(w){var N=D.call(this,w,_u.Vertex)||this;return N.complementW=1,N.complementZ=0,N.registerInput("vector",mu.AutoDetect),N.registerInput("transform",mu.Matrix),N.registerOutput("output",mu.Vector4),N.registerOutput("xyz",mu.Vector3),N._inputs[0].onConnectionObservable.add((function(D){if(D.ownerBlock.isInput){var w=D.ownerBlock;"normal"!==w.name&&"tangent"!==w.name||(N.complementW=0)}})),N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"TransformBlock"},Object.defineProperty(t.prototype,"vector",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"xyz",{get:function(){return this._outputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"transform",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),t.prototype._buildBlock=function(w){D.prototype._buildBlock.call(this,w);var N=this.vector,F=this.transform;if(N.connectedPoint){switch(N.connectedPoint.type){case mu.Vector2:w.compilationString+=this._declareOutput(this.output,w)+" = "+F.associatedVariableName+" * vec4("+N.associatedVariableName+", "+this._writeFloat(this.complementZ)+", "+this._writeFloat(this.complementW)+");\r\n";break;case mu.Vector3:case mu.Color3:w.compilationString+=this._declareOutput(this.output,w)+" = "+F.associatedVariableName+" * vec4("+N.associatedVariableName+", "+this._writeFloat(this.complementW)+");\r\n";break;default:w.compilationString+=this._declareOutput(this.output,w)+" = "+F.associatedVariableName+" * "+N.associatedVariableName+";\r\n"}this.xyz.hasEndpoints&&(w.compilationString+=this._declareOutput(this.xyz,w)+" = "+this.output.associatedVariableName+".xyz;\r\n")}return this},t.prototype.serialize=function(){var w=D.prototype.serialize.call(this);return w.complementZ=this.complementZ,w.complementW=this.complementW,w},t.prototype._deserialize=function(w,N,F){D.prototype._deserialize.call(this,w,N,F),this.complementZ=void 0!==w.complementZ?w.complementZ:0,this.complementW=void 0!==w.complementW?w.complementW:1},t.prototype._dumpPropertiesCode=function(){return this._codeVariableName+".complementZ = "+this.complementZ+";\r\n"+this._codeVariableName+".complementW = "+this.complementW+";\r\n"},t}(Ru);H.a.RegisteredTypes["BABYLON.TransformBlock"]=Lu;var wu=function(D){function t(w){var N=D.call(this,w,_u.Vertex,!0)||this;return N.registerInput("vector",mu.Vector4),N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"VertexOutputBlock"},Object.defineProperty(t.prototype,"vector",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),t.prototype._buildBlock=function(w){D.prototype._buildBlock.call(this,w);var N=this.vector;return w.compilationString+="gl_Position = "+N.associatedVariableName+";\r\n",this},t}(Ru);H.a.RegisteredTypes["BABYLON.VertexOutputBlock"]=wu;var Nu,Fu=function(D){function t(w){var N=D.call(this,w,_u.Fragment,!0)||this;return N.registerInput("rgba",mu.Color4,!0),N.registerInput("rgb",mu.Color3,!0),N.registerInput("a",mu.Float,!0),N.rgb.acceptedConnectionPointTypes.push(mu.Float),N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"FragmentOutputBlock"},Object.defineProperty(t.prototype,"rgba",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rgb",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"a",{get:function(){return this._inputs[2]},enumerable:!0,configurable:!0}),t.prototype._buildBlock=function(w){D.prototype._buildBlock.call(this,w);var N=this.rgba,F=this.rgb,k=this.a;if(w.sharedData.hints.needAlphaBlending=N.isConnected||k.isConnected,N.connectedPoint)k.isConnected?w.compilationString+="gl_FragColor = vec4("+N.associatedVariableName+".rgb, "+k.associatedVariableName+");\r\n":w.compilationString+="gl_FragColor = "+N.associatedVariableName+";\r\n";else if(F.connectedPoint){var j="1.0";k.connectedPoint&&(j=k.associatedVariableName),F.connectedPoint.type===mu.Float?w.compilationString+="gl_FragColor = vec4("+F.associatedVariableName+", "+F.associatedVariableName+", "+F.associatedVariableName+", "+j+");\r\n":w.compilationString+="gl_FragColor = vec4("+F.associatedVariableName+", "+j+");\r\n"}else w.sharedData.checks.notConnectedNonOptionalInputs.push(N);return this},t}(Ru);H.a.RegisteredTypes["BABYLON.FragmentOutputBlock"]=Fu,function(D){D[D.None=0]="None",D[D.Time=1]="Time"}(Nu||(Nu={}));var Bu=function(D){function t(w,N,F){void 0===N&&(N=_u.Vertex),void 0===F&&(F=mu.AutoDetect);var k=D.call(this,w,N,!1,!0)||this;return k._mode=vu.Undefined,k._animationType=Nu.None,k.min=0,k.max=0,k.isBoolean=!1,k.matrixMode=0,k._systemValue=null,k.visibleInInspector=!1,k.isConstant=!1,k.groupInInspector="",k.onValueChangedObservable=new j.c,k._type=F,k.setDefaultValue(),k.registerOutput("output",F),k}return Object(Z.d)(t,D),Object.defineProperty(t.prototype,"type",{get:function(){if(this._type===mu.AutoDetect){if(this.isUniform&&null!=this.value){if(!isNaN(this.value))return this._type=mu.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=mu.Vector2,this._type;case"Vector3":return this._type=mu.Vector3,this._type;case"Vector4":return this._type=mu.Vector4,this._type;case"Color3":return this._type=mu.Color3,this._type;case"Color4":return this._type=mu.Color4,this._type;case"Matrix":return this._type=mu.Matrix,this._type}}if(this.isAttribute)switch(this.name){case"position":case"normal":case"tangent":return this._type=mu.Vector3,this._type;case"uv":case"uv2":return this._type=mu.Vector2,this._type;case"matricesIndices":case"matricesWeights":case"world0":case"world1":case"world2":case"world3":return this._type=mu.Vector4,this._type;case"color":return this._type=mu.Color4,this._type}if(this.isSystemValue)switch(this._systemValue){case yu.World:case yu.WorldView:case yu.WorldViewProjection:case yu.View:case yu.ViewProjection:case yu.Projection:return this._type=mu.Matrix,this._type;case yu.CameraPosition:return this._type=mu.Vector3,this._type;case yu.FogColor:return this._type=mu.Color3,this._type;case yu.DeltaTime:return this._type=mu.Float,this._type}}return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),t.prototype.setAsAttribute=function(D){return D&&(this.name=D),this._mode=vu.Attribute,this},t.prototype.setAsSystemValue=function(D){return this.systemValue=D,this},Object.defineProperty(t.prototype,"value",{get:function(){return this._storedValue},set:function(D){this.type===mu.Float&&(this.isBoolean?D=D?1:0:this.min!==this.max&&(D=Math.max(this.min,D),D=Math.min(this.max,D))),this._storedValue=D,this._mode=vu.Uniform,this.onValueChangedObservable.notifyObservers(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"valueCallback",{get:function(){return this._valueCallback},set:function(D){this._valueCallback=D,this._mode=vu.Uniform},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"associatedVariableName",{get:function(){return this._associatedVariableName},set:function(D){this._associatedVariableName=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"animationType",{get:function(){return this._animationType},set:function(D){this._animationType=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isUndefined",{get:function(){return this._mode===vu.Undefined},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isUniform",{get:function(){return this._mode===vu.Uniform},set:function(D){this._mode=D?vu.Uniform:vu.Undefined,this.associatedVariableName=""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isAttribute",{get:function(){return this._mode===vu.Attribute},set:function(D){this._mode=D?vu.Attribute:vu.Undefined,this.associatedVariableName=""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isVarying",{get:function(){return this._mode===vu.Varying},set:function(D){this._mode=D?vu.Varying:vu.Undefined,this.associatedVariableName=""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isSystemValue",{get:function(){return null!=this._systemValue},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"systemValue",{get:function(){return this._systemValue},set:function(D){this._mode=vu.Uniform,this.associatedVariableName="",this._systemValue=D},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"InputBlock"},t.prototype.animate=function(D){switch(this._animationType){case Nu.Time:this.type===mu.Float&&(this.value+=.01*D.getAnimationRatio())}},t.prototype._emitDefine=function(D){return"!"===D[0]?"#ifndef "+D.substring(1)+"\r\n":"#ifdef "+D+"\r\n"},t.prototype.initialize=function(D){this.associatedVariableName=""},t.prototype.setDefaultValue=function(){switch(this.type){case mu.Float:this.value=0;break;case mu.Vector2:this.value=z.d.Zero();break;case mu.Vector3:this.value=z.e.Zero();break;case mu.Vector4:this.value=z.f.Zero();break;case mu.Color3:this.value=G.a.White();break;case mu.Color4:this.value=new G.b(1,1,1,1);break;case mu.Matrix:this.value=z.a.Identity()}},t.prototype._emitConstant=function(D){switch(this.type){case mu.Float:return""+D._emitFloat(this.value);case mu.Vector2:return"vec2("+this.value.x+", "+this.value.y+")";case mu.Vector3:return"vec3("+this.value.x+", "+this.value.y+", "+this.value.z+")";case mu.Vector4:return"vec4("+this.value.x+", "+this.value.y+", "+this.value.z+", "+this.value.w+")";case mu.Color3:return"vec3("+this.value.r+", "+this.value.g+", "+this.value.b+")";case mu.Color4:return"vec4("+this.value.r+", "+this.value.g+", "+this.value.b+", "+this.value.a+")"}return""},t.prototype._emit=function(D,w){if(this.isUniform){if(this.associatedVariableName||(this.associatedVariableName=D._getFreeVariableName("u_"+this.name)),this.isConstant){if(-1!==D.constants.indexOf(this.associatedVariableName))return;return D.constants.push(this.associatedVariableName),void(D._constantDeclaration+=this._declareOutput(this.output,D)+" = "+this._emitConstant(D)+";\r\n")}if(-1!==D.uniforms.indexOf(this.associatedVariableName))return;D.uniforms.push(this.associatedVariableName),w&&(D._uniformDeclaration+=this._emitDefine(w)),D._uniformDeclaration+="uniform "+D._getGLType(this.type)+" "+this.associatedVariableName+";\r\n",w&&(D._uniformDeclaration+="#endif\r\n");var N=D.sharedData.hints;if(null!==this._systemValue&&void 0!==this._systemValue)switch(this._systemValue){case yu.WorldView:N.needWorldViewMatrix=!0;break;case yu.WorldViewProjection:N.needWorldViewProjectionMatrix=!0}else this._animationType!==Nu.None&&D.sharedData.animatedInputs.push(this)}else if(this.isAttribute){if(this.associatedVariableName=this.name,this.target===_u.Vertex&&D._vertexState)return void this._emit(D._vertexState,w);if(-1!==D.attributes.indexOf(this.associatedVariableName))return;D.attributes.push(this.associatedVariableName),w&&(D._attributeDeclaration+=this._emitDefine(w)),D._attributeDeclaration+="attribute "+D._getGLType(this.type)+" "+this.associatedVariableName+";\r\n",w&&(D._attributeDeclaration+="#endif\r\n")}},t.prototype._transmitWorld=function(D,w,N,F){if(this._systemValue){var k=this.associatedVariableName;switch(this._systemValue){case yu.World:D.setMatrix(k,w);break;case yu.WorldView:D.setMatrix(k,N);break;case yu.WorldViewProjection:D.setMatrix(k,F)}}},t.prototype._transmit=function(D,w){if(!this.isAttribute){var N=this.associatedVariableName;if(this._systemValue)switch(this._systemValue){case yu.World:case yu.WorldView:case yu.WorldViewProjection:return;case yu.View:D.setMatrix(N,w.getViewMatrix());break;case yu.Projection:D.setMatrix(N,w.getProjectionMatrix());break;case yu.ViewProjection:D.setMatrix(N,w.getTransformMatrix());break;case yu.CameraPosition:D.setVector3(N,w.activeCamera.globalPosition);break;case yu.FogColor:D.setColor3(N,w.fogColor);break;case yu.DeltaTime:D.setFloat(N,w.deltaTime/1e3)}else{var F=this._valueCallback?this._valueCallback():this._storedValue;if(null!==F)switch(this.type){case mu.Float:D.setFloat(N,F);break;case mu.Int:D.setInt(N,F);break;case mu.Color3:D.setColor3(N,F);break;case mu.Color4:D.setDirectColor4(N,F);break;case mu.Vector2:D.setVector2(N,F);break;case mu.Vector3:D.setVector3(N,F);break;case mu.Vector4:D.setVector4(N,F);break;case mu.Matrix:D.setMatrix(N,F)}}}},t.prototype._buildBlock=function(w){D.prototype._buildBlock.call(this,w),(this.isUniform||this.isSystemValue)&&w.sharedData.inputBlocks.push(this),this._emit(w)},t.prototype._dumpPropertiesCode=function(){var D=this._codeVariableName;if(this.isAttribute)return D+'.setAsAttribute("'+this.name+'");\r\n';if(this.isSystemValue)return D+".setAsSystemValue(BABYLON.NodeMaterialSystemValues."+yu[this._systemValue]+");\r\n";if(this.isUniform){var w="";switch(this.type){case mu.Float:var N=D+".value = "+this.value+";\r\n";return N+=D+".min = "+this.min+";\r\n",N+=D+".max = "+this.max+";\r\n",N+=D+".isBoolean = "+this.isBoolean+";\r\n",(N+=D+".matrixMode = "+this.matrixMode+";\r\n")+D+".animationType  = BABYLON.AnimatedInputBlockTypes."+Nu[this.animationType]+";\r\n";case mu.Vector2:w="new BABYLON.Vector2("+this.value.x+", "+this.value.y+")";break;case mu.Vector3:w="new BABYLON.Vector3("+this.value.x+", "+this.value.y+", "+this.value.z+")";break;case mu.Vector4:w="new BABYLON.Vector4("+this.value.x+", "+this.value.y+", "+this.value.z+", "+this.value.w+")";break;case mu.Color3:w="new BABYLON.Color3("+this.value.r+", "+this.value.g+", "+this.value.b+")";break;case mu.Color4:w="new BABYLON.Color4("+this.value.r+", "+this.value.g+", "+this.value.b+", "+this.value.a+")";break;case mu.Matrix:w="BABYLON.Matrix.FromArray(["+this.value.m.toString()+"])"}var F=D+".value = "+w+";\r\n";return(F+=D+".isConstant = "+(this.isConstant?"true":"false")+";\r\n")+D+".visibleInInspector = "+(this.visibleInInspector?"true":"false")+";\r\n"}return""},t.prototype.dispose=function(){this.onValueChangedObservable.clear(),D.prototype.dispose.call(this)},t.prototype.serialize=function(){var w=D.prototype.serialize.call(this);return w.type=this.type,w.mode=this._mode,w.systemValue=this._systemValue,w.animationType=this._animationType,w.visibleInInspector=this.visibleInInspector,w.min=this.min,w.max=this.max,w.isBoolean=this.isBoolean,w.matrixMode=this.matrixMode,w.isConstant=this.isConstant,w.groupInInspector=this.groupInInspector,null!=this._storedValue&&this._mode===vu.Uniform&&(this._storedValue.asArray?(w.valueType="BABYLON."+this._storedValue.getClassName(),w.value=this._storedValue.asArray()):(w.valueType="number",w.value=this._storedValue)),w},t.prototype._deserialize=function(w,N,F){if(D.prototype._deserialize.call(this,w,N,F),this._type=w.type,this._mode=w.mode,this._systemValue=w.systemValue||w.wellKnownValue,this._animationType=w.animationType,this.visibleInInspector=w.visibleInInspector,this.min=w.min||0,this.max=w.max||0,this.isBoolean=!!w.isBoolean,this.matrixMode=w.matrixMode||0,this.isConstant=!!w.isConstant,this.groupInInspector=w.groupInInspector||"",w.valueType)if("number"===w.valueType)this._storedValue=w.value;else{var k=H.a.GetClass(w.valueType);k&&(this._storedValue=k.FromArray(w.value))}},t}(Ru);H.a.RegisteredTypes["BABYLON.InputBlock"]=Bu;var ku=function(D){function t(){var w=D.call(this)||this;return w.NORMAL=!1,w.TANGENT=!1,w.UV1=!1,w.NUM_BONE_INFLUENCERS=0,w.BonesPerMesh=0,w.BONETEXTURE=!1,w.MORPHTARGETS=!1,w.MORPHTARGETS_NORMAL=!1,w.MORPHTARGETS_TANGENT=!1,w.MORPHTARGETS_UV=!1,w.NUM_MORPH_INFLUENCERS=0,w.IMAGEPROCESSING=!1,w.VIGNETTE=!1,w.VIGNETTEBLENDMODEMULTIPLY=!1,w.VIGNETTEBLENDMODEOPAQUE=!1,w.TONEMAPPING=!1,w.TONEMAPPING_ACES=!1,w.CONTRAST=!1,w.EXPOSURE=!1,w.COLORCURVES=!1,w.COLORGRADING=!1,w.COLORGRADING3D=!1,w.SAMPLER3DGREENDEPTH=!1,w.SAMPLER3DBGRMAP=!1,w.IMAGEPROCESSINGPOSTPROCESS=!1,w.BUMPDIRECTUV=0,w.rebuild(),w}return Object(Z.d)(t,D),t.prototype.setValue=function(D,w){void 0===this[D]&&this._keys.push(D),this[D]=w},t}(zo.a),Vu=function(D){function t(w,N,F){void 0===F&&(F={});var k=D.call(this,w,N||Ct.a.LastCreatedScene)||this;return k._buildId=t._BuildIdGenerator++,k._buildWasSuccessful=!1,k._cachedWorldViewMatrix=new z.a,k._cachedWorldViewProjectionMatrix=new z.a,k._optimizers=new Array,k._animationFrame=-1,k.BJSNODEMATERIALEDITOR=k._getGlobalNodeMaterialEditor(),k.editorData=null,k.ignoreAlpha=!1,k.maxSimultaneousLights=4,k.onBuildObservable=new j.c,k._vertexOutputNodes=new Array,k._fragmentOutputNodes=new Array,k.attachedBlocks=new Array,k._options=Object(Z.a)({emitComments:!1},F),k._attachImageProcessingConfiguration(null),k}return Object(Z.d)(t,D),t.prototype._getGlobalNodeMaterialEditor=function(){return"undefined"!=typeof NODEEDITOR?NODEEDITOR:"undefined"!=typeof BABYLON&&void 0!==BABYLON.NodeEditor?BABYLON:void 0},Object.defineProperty(t.prototype,"options",{get:function(){return this._options},set:function(D){this._options=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(D){this._attachImageProcessingConfiguration(D),this._markAllSubMeshesAsTexturesDirty()},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"NodeMaterial"},t.prototype._attachImageProcessingConfiguration=function(D){var w=this;D!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=D||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((function(){w._markAllSubMeshesAsImageProcessingDirty()}))))},t.prototype.getBlockByName=function(D){for(var w=0,N=this.attachedBlocks;w<N.length;w++){var F=N[w];if(F.name===D)return F}return null},t.prototype.getBlockByPredicate=function(D){for(var w=0,N=this.attachedBlocks;w<N.length;w++){var F=N[w];if(D(F))return F}return null},t.prototype.getInputBlockByPredicate=function(D){for(var w=0,N=this.attachedBlocks;w<N.length;w++){var F=N[w];if(F.isInput&&D(F))return F}return null},t.prototype.getInputBlocks=function(){for(var D=[],w=0,N=this.attachedBlocks;w<N.length;w++){var F=N[w];F.isInput&&D.push(F)}return D},t.prototype.registerOptimizer=function(D){if(!(this._optimizers.indexOf(D)>-1))return this._optimizers.push(D),this},t.prototype.unregisterOptimizer=function(D){var w=this._optimizers.indexOf(D);if(-1!==w)return this._optimizers.splice(w,1),this},t.prototype.addOutputNode=function(D){if(null===D.target)throw"This node is not meant to be an output node. You may want to explicitly set its target value.";return 0!=(D.target&_u.Vertex)&&this._addVertexOutputNode(D),0!=(D.target&_u.Fragment)&&this._addFragmentOutputNode(D),this},t.prototype.removeOutputNode=function(D){return null===D.target||(0!=(D.target&_u.Vertex)&&this._removeVertexOutputNode(D),0!=(D.target&_u.Fragment)&&this._removeFragmentOutputNode(D)),this},t.prototype._addVertexOutputNode=function(D){if(-1===this._vertexOutputNodes.indexOf(D))return D.target=_u.Vertex,this._vertexOutputNodes.push(D),this},t.prototype._removeVertexOutputNode=function(D){var w=this._vertexOutputNodes.indexOf(D);if(-1!==w)return this._vertexOutputNodes.splice(w,1),this},t.prototype._addFragmentOutputNode=function(D){if(-1===this._fragmentOutputNodes.indexOf(D))return D.target=_u.Fragment,this._fragmentOutputNodes.push(D),this},t.prototype._removeFragmentOutputNode=function(D){var w=this._fragmentOutputNodes.indexOf(D);if(-1!==w)return this._fragmentOutputNodes.splice(w,1),this},t.prototype.needAlphaBlending=function(){return!this.ignoreAlpha&&(this.alpha<1||this._sharedData&&this._sharedData.hints.needAlphaBlending)},t.prototype.needAlphaTesting=function(){return this._sharedData&&this._sharedData.hints.needAlphaTesting},t.prototype._initializeBlock=function(D,w,N){if(D.initialize(w),D.autoConfigure(this),D._preparationId=this._buildId,-1===this.attachedBlocks.indexOf(D)){if(D.isUnique)for(var F=D.getClassName(),k=0,j=this.attachedBlocks;k<j.length;k++)if(j[k].getClassName()===F)throw"Cannot have multiple blocks of type "+F+" in the same NodeMaterial";this.attachedBlocks.push(D)}for(var z=0,G=D.inputs;z<G.length;z++){var H=G[z];H.associatedVariableName="";var X=H.connectedPoint;if(X){var q=X.ownerBlock;q!==D&&((q.target===_u.VertexAndFragment||w.target===_u.Fragment&&q.target===_u.Vertex&&q._preparationId!==this._buildId)&&N.push(q),this._initializeBlock(q,w,N))}}for(var Z=0,J=D.outputs;Z<J.length;Z++)J[Z].associatedVariableName=""},t.prototype._resetDualBlocks=function(D,w){D.target===_u.VertexAndFragment&&(D.buildId=w);for(var N=0,F=D.inputs;N<F.length;N++){var k=F[N].connectedPoint;if(k){var j=k.ownerBlock;j!==D&&this._resetDualBlocks(j,w)}}},t.prototype.removeBlock=function(D){var w=this.attachedBlocks.indexOf(D);w>-1&&this.attachedBlocks.splice(w,1),D.isFinalMerger&&this.removeOutputNode(D)},t.prototype.build=function(D){void 0===D&&(D=!1),this._buildWasSuccessful=!1;var w=this.getScene().getEngine();if(0===this._vertexOutputNodes.length)throw"You must define at least one vertexOutputNode";if(0===this._fragmentOutputNodes.length)throw"You must define at least one fragmentOutputNode";this._vertexCompilationState=new Du,this._vertexCompilationState.supportUniformBuffers=w.supportsUniformBuffers,this._vertexCompilationState.target=_u.Vertex,this._fragmentCompilationState=new Du,this._fragmentCompilationState.supportUniformBuffers=w.supportsUniformBuffers,this._fragmentCompilationState.target=_u.Fragment,this._sharedData=new Iu,this._vertexCompilationState.sharedData=this._sharedData,this._fragmentCompilationState.sharedData=this._sharedData,this._sharedData.buildId=this._buildId,this._sharedData.emitComments=this._options.emitComments,this._sharedData.verbose=D,this._sharedData.scene=this.getScene();for(var N=[],F=[],k=0,j=this._vertexOutputNodes;k<j.length;k++){var z=j[k];N.push(z),this._initializeBlock(z,this._vertexCompilationState,F)}for(var G=0,H=this._fragmentOutputNodes;G<H.length;G++){var X=H[G];F.push(X),this._initializeBlock(X,this._fragmentCompilationState,N)}this.optimize();for(var q=0,Z=N;q<Z.length;q++)(z=Z[q]).build(this._vertexCompilationState,N);this._fragmentCompilationState.uniforms=this._vertexCompilationState.uniforms.slice(0),this._fragmentCompilationState._uniformDeclaration=this._vertexCompilationState._uniformDeclaration,this._fragmentCompilationState._constantDeclaration=this._vertexCompilationState._constantDeclaration,this._fragmentCompilationState._vertexState=this._vertexCompilationState;for(var J=0,$=F;J<$.length;J++)X=$[J],this._resetDualBlocks(X,this._buildId-1);for(var te=0,ie=F;te<ie.length;te++)(X=ie[te]).build(this._fragmentCompilationState,F);this._vertexCompilationState.finalize(this._vertexCompilationState),this._fragmentCompilationState.finalize(this._fragmentCompilationState),this._buildId=t._BuildIdGenerator++,this._sharedData.emitErrors(),D&&(console.log("Vertex shader:"),console.log(this._vertexCompilationState.compilationString),console.log("Fragment shader:"),console.log(this._fragmentCompilationState.compilationString)),this._buildWasSuccessful=!0,this.onBuildObservable.notifyObservers(this);for(var oe=0,ce=this.getScene().meshes;oe<ce.length;oe++){var he=ce[oe];if(he.subMeshes)for(var fe=0,pe=he.subMeshes;fe<pe.length;fe++){var _e=pe[fe];if(_e.getMaterial()===this&&_e._materialDefines){var ve=_e._materialDefines;ve.markAllAsDirty(),ve.reset()}}}},t.prototype.optimize=function(){for(var D=0,w=this._optimizers;D<w.length;D++)w[D].optimize(this._vertexOutputNodes,this._fragmentOutputNodes)},t.prototype._prepareDefinesForAttributes=function(D,w){var N=w.NORMAL,F=w.TANGENT,k=w.UV1;w.NORMAL=D.isVerticesDataPresent(Zi.b.NormalKind),w.TANGENT=D.isVerticesDataPresent(Zi.b.TangentKind),w.UV1=D.isVerticesDataPresent(Zi.b.UVKind),N===w.NORMAL&&F===w.TANGENT&&k===w.UV1||w.markAsAttributesDirty()},t.prototype.isReadyForSubMesh=function(D,w,N){var F=this;if(void 0===N&&(N=!1),!this._buildWasSuccessful)return!1;var k=this.getScene();if(this._sharedData.animatedInputs){var j=k.getFrameId();if(this._animationFrame!==j){for(var z=0,G=this._sharedData.animatedInputs;z<G.length;z++)G[z].animate(k);this._animationFrame=j}}if(w.effect&&this.isFrozen&&w.effect._wasPreviouslyReady)return!0;w._materialDefines||(w._materialDefines=new ku);var H=w._materialDefines;if(!this.checkReadyOnEveryCall&&w.effect&&H._renderId===k.getRenderId())return!0;var X=k.getEngine();if(this._prepareDefinesForAttributes(D,H),this._sharedData.blockingBlocks.some((function(w){return!w.isReady(D,F,H,N)})))return!1;if(this._sharedData.blocksWithDefines.forEach((function(w){w.initializeDefines(D,F,H,N)})),this._sharedData.blocksWithDefines.forEach((function(w){w.prepareDefines(D,F,H,N)})),H.isDirty){H.markAsProcessed(),this._vertexCompilationState.compilationString=this._vertexCompilationState._builtCompilationString,this._fragmentCompilationState.compilationString=this._fragmentCompilationState._builtCompilationString,this._sharedData.repeatableContentBlocks.forEach((function(w){w.replaceRepeatableContent(F._vertexCompilationState,F._fragmentCompilationState,D,H)}));var q=[];this._sharedData.dynamicUniformBlocks.forEach((function(D){D.updateUniformsAndSamples(F._vertexCompilationState,F,H,q)}));var Z=this._vertexCompilationState.uniforms;this._fragmentCompilationState.uniforms.forEach((function(D){-1===Z.indexOf(D)&&Z.push(D)}));var J=this._vertexCompilationState.samplers;this._fragmentCompilationState.samplers.forEach((function(D){-1===J.indexOf(D)&&J.push(D)}));var $=new Wo.a;this._sharedData.blocksWithFallbacks.forEach((function(w){w.provideFallbacks(D,$)}));var te=w.effect,ie=H.toString(),oe=X.createEffect({vertex:"nodeMaterial"+this._buildId,fragment:"nodeMaterial"+this._buildId,vertexSource:this._vertexCompilationState.compilationString,fragmentSource:this._fragmentCompilationState.compilationString},{attributes:this._vertexCompilationState.attributes,uniformsNames:Z,uniformBuffersNames:q,samplers:J,defines:ie,fallbacks:$,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this.maxSimultaneousLights,maxSimultaneousMorphTargets:H.NUM_MORPH_INFLUENCERS}},X);oe&&(this.allowShaderHotSwapping&&te&&!oe.isReady()?(oe=te,H.markAsUnprocessed()):(k.resetCachedMaterial(),w.setEffect(oe,H)))}return!(!w.effect||!w.effect.isReady()||(H._renderId=k.getRenderId(),w.effect._wasPreviouslyReady=!0,0))},Object.defineProperty(t.prototype,"compiledShaders",{get:function(){return"// Vertex shader\r\n"+this._vertexCompilationState.compilationString+"\r\n\r\n// Fragment shader\r\n"+this._fragmentCompilationState.compilationString},enumerable:!0,configurable:!0}),t.prototype.bindOnlyWorldMatrix=function(D){var w=this.getScene();if(this._activeEffect){var N=this._sharedData.hints;N.needWorldViewMatrix&&D.multiplyToRef(w.getViewMatrix(),this._cachedWorldViewMatrix),N.needWorldViewProjectionMatrix&&D.multiplyToRef(w.getTransformMatrix(),this._cachedWorldViewProjectionMatrix);for(var F=0,k=this._sharedData.inputBlocks;F<k.length;F++)k[F]._transmitWorld(this._activeEffect,D,this._cachedWorldViewMatrix,this._cachedWorldViewProjectionMatrix)}},t.prototype.bindForSubMesh=function(D,w,N){var F=this.getScene(),k=N.effect;if(k){if(this._activeEffect=k,this.bindOnlyWorldMatrix(D),this._mustRebind(F,k,w.visibility)){var j=this._sharedData;if(k&&F.getCachedEffect()!==k){for(var z=0,G=j.bindableBlocks;z<G.length;z++)G[z].bind(k,this,w);for(var H=0,X=j.inputBlocks;H<X.length;H++)X[H]._transmit(k,F)}}this._afterBind(w,this._activeEffect)}},t.prototype.getActiveTextures=function(){var w=D.prototype.getActiveTextures.call(this);return this._sharedData&&w.push.apply(w,this._sharedData.textureBlocks.filter((function(D){return D.texture})).map((function(D){return D.texture}))),w},t.prototype.getTextureBlocks=function(){return this._sharedData?this._sharedData.textureBlocks:[]},t.prototype.hasTexture=function(w){if(D.prototype.hasTexture.call(this,w))return!0;if(!this._sharedData)return!1;for(var N=0,F=this._sharedData.textureBlocks;N<F.length;N++)if(F[N].texture===w)return!0;return!1},t.prototype.dispose=function(w,N,F){if(N)for(var k=0,j=this._sharedData.textureBlocks.filter((function(D){return D.texture})).map((function(D){return D.texture}));k<j.length;k++)j[k].dispose();for(var z=0,G=this.attachedBlocks;z<G.length;z++)G[z].dispose();this.onBuildObservable.clear(),D.prototype.dispose.call(this,w,N,F)},t.prototype._createNodeEditor=function(){this.BJSNODEMATERIALEDITOR=this.BJSNODEMATERIALEDITOR||this._getGlobalNodeMaterialEditor(),this.BJSNODEMATERIALEDITOR.NodeEditor.Show({nodeMaterial:this})},t.prototype.edit=function(D){var w=this;return new Promise((function(N,F){if(void 0===w.BJSNODEMATERIALEDITOR){var k=D&&D.editorURL?D.editorURL:t.EditorURL;Dt.b.LoadScript(k,(function(){w._createNodeEditor(),N()}))}else w._createNodeEditor(),N()}))},t.prototype.clear=function(){this._vertexOutputNodes=[],this._fragmentOutputNodes=[],this.attachedBlocks=[]},t.prototype.setToDefault=function(){this.clear(),this.editorData=null;var D=new Bu("Position");D.setAsAttribute("position");var w=new Bu("World");w.setAsSystemValue(BABYLON.NodeMaterialSystemValues.World);var N=new Lu("WorldPos");D.connectTo(N),w.connectTo(N);var F=new Bu("ViewProjection");F.setAsSystemValue(BABYLON.NodeMaterialSystemValues.ViewProjection);var k=new Lu("WorldPos * ViewProjectionTransform");N.connectTo(k),F.connectTo(k);var j=new wu("VertexOutput");k.connectTo(j);var z=new Bu("color");z.value=new G.b(.8,.8,.8,1);var H=new Fu("FragmentOutput");z.connectTo(H),this.addOutputNode(j),this.addOutputNode(H)},t.prototype.loadAsync=function(D){var w=this;return this.getScene()._loadFileAsync(D).then((function(D){var N=JSON.parse(D);w.loadFromSerialization(N,"")}))},t.prototype._gatherBlocks=function(D,w){if(-1===w.indexOf(D)){w.push(D);for(var N=0,F=D.inputs;N<F.length;N++){var k=F[N].connectedPoint;if(k){var j=k.ownerBlock;j!==D&&this._gatherBlocks(j,w)}}}},t.prototype.generateCode=function(){for(var D=[],w=[],N=[],F=0,k=this._vertexOutputNodes;F<k.length;F++){var j=k[F];this._gatherBlocks(j,w)}for(var z=[],G=0,H=this._fragmentOutputNodes;G<H.length;G++)j=H[G],this._gatherBlocks(j,z);for(var X='var nodeMaterial = new BABYLON.NodeMaterial("'+(this.name||"node material")+'");\r\n',q=0,Z=w;q<Z.length;q++)(ve=Z[q]).isInput&&-1===D.indexOf(ve)&&(X+=ve._dumpCode(N,D));for(var J=0,$=z;J<$.length;J++)(ve=$[J]).isInput&&-1===D.indexOf(ve)&&(X+=ve._dumpCode(N,D));D=[],X+="\r\n// Connections\r\n";for(var te=0,ie=this._vertexOutputNodes;te<ie.length;te++)X+=(ve=ie[te])._dumpCodeForOutputConnections(D);for(var oe=0,ce=this._fragmentOutputNodes;oe<ce.length;oe++)X+=(ve=ce[oe])._dumpCodeForOutputConnections(D);X+="\r\n// Output nodes\r\n";for(var he=0,fe=this._vertexOutputNodes;he<fe.length;he++)X+="nodeMaterial.addOutputNode("+(ve=fe[he])._codeVariableName+");\r\n";for(var pe=0,_e=this._fragmentOutputNodes;pe<_e.length;pe++){var ve;X+="nodeMaterial.addOutputNode("+(ve=_e[pe])._codeVariableName+");\r\n"}return X+"nodeMaterial.build();\r\n"},t.prototype.serialize=function(D){var w=D?{}:Ie.a.Serialize(this);w.editorData=JSON.parse(JSON.stringify(this.editorData));var N=[];if(D)N=D;else{w.customType="BABYLON.NodeMaterial",w.outputNodes=[];for(var F=0,k=this._vertexOutputNodes;F<k.length;F++){var j=k[F];this._gatherBlocks(j,N),w.outputNodes.push(j.uniqueId)}for(var z=0,G=this._fragmentOutputNodes;z<G.length;z++)j=G[z],this._gatherBlocks(j,N),-1===w.outputNodes.indexOf(j.uniqueId)&&w.outputNodes.push(j.uniqueId)}w.blocks=[];for(var H=0,X=N;H<X.length;H++){var q=X[H];w.blocks.push(q.serialize())}if(!D)for(var Z=0,J=this.attachedBlocks;Z<J.length;Z++)q=J[Z],-1===N.indexOf(q)&&w.blocks.push(q.serialize());return w},t.prototype._restoreConnections=function(D,w,N){for(var F=0,k=D.outputs;F<k.length;F++)for(var j=k[F],z=0,G=w.blocks;z<G.length;z++)for(var H=G[z],X=N[H.id],q=0,Z=H.inputs;q<Z.length;q++){var J=Z[q];if(N[J.targetBlockId]!==D||J.targetConnectionName!==j.name);else{var $=X.getInputByName(J.inputName);if(!$||$.isConnected)continue;j.connectTo($,!0),this._restoreConnections(X,w,N)}}},t.prototype.loadFromSerialization=function(D,w){void 0===w&&(w=""),this.clear();for(var N={},F=0,k=D.blocks;F<k.length;F++){var j=k[F],z=H.a.GetClass(j.customType);z&&((X=new z)._deserialize(j,this.getScene(),w),N[j.id]=X,this.attachedBlocks.push(X))}for(var G=0;G<D.blocks.length;G++){var X;(X=N[D.blocks[G].id]).inputs.length||this._restoreConnections(X,D,N)}for(var q=0,Z=D.outputNodes;q<Z.length;q++){var J=Z[q];this.addOutputNode(N[J])}if(D.locations||D.editorData&&D.editorData.locations){for(var $=D.locations||D.editorData.locations,te=0,ie=$;te<ie.length;te++){var oe=ie[te];N[oe.blockId]&&(oe.blockId=N[oe.blockId].uniqueId)}D.locations?this.editorData={locations:$}:(this.editorData=D.editorData,this.editorData.locations=$);var ce=[];for(var he in N)ce[he]=N[he].uniqueId;this.editorData.map=ce}},t.Parse=function(D,w,N){void 0===N&&(N="");var F=Ie.a.Parse((function(){return new t(D.name,w)}),D,w,N);return F.loadFromSerialization(D,N),F.build(),F},t.ParseFromFileAsync=function(D,w,N){var F=new t(D,N);return new Promise((function(D,N){return F.loadAsync(w).then((function(){return D(F)})).catch(N)}))},t.ParseFromSnippetAsync=function(D,w,N){var F=this;return void 0===N&&(N=""),new Promise((function(k,j){var z=new lu.a;z.addEventListener("readystatechange",(function(){if(4==z.readyState)if(200==z.status){var F=JSON.parse(JSON.parse(z.responseText).jsonPayload),G=JSON.parse(F.nodeMaterial),H=Ie.a.Parse((function(){return new t(D,w)}),G,w,N);H.loadFromSerialization(G);try{H.build(!0),k(H)}catch(D){j(D)}}else j("Unable to load the snippet "+D)})),z.open("GET",F.SnippetUrl+"/"+D.replace("#","/")),z.send()}))},t.CreateDefault=function(D,w){var N=new t(D,w);return N.setToDefault(),N.build(),N},t._BuildIdGenerator=0,t.EditorURL="https://unpkg.com/babylonjs-node-editor@"+Ct.a.Version+"/babylon.nodeEditor.js",t.SnippetUrl="https://snippet.babylonjs.com",t}(Yo.a);H.a.RegisteredTypes["BABYLON.NodeMaterial"]=Vu;var ju=function(D){function t(w){var N=D.call(this,w,_u.Vertex)||this;return N.registerInput("matricesIndices",mu.Vector4),N.registerInput("matricesWeights",mu.Vector4),N.registerInput("matricesIndicesExtra",mu.Vector4,!0),N.registerInput("matricesWeightsExtra",mu.Vector4,!0),N.registerInput("world",mu.Matrix),N.registerOutput("output",mu.Matrix),N}return Object(Z.d)(t,D),t.prototype.initialize=function(D){D._excludeVariableName("boneSampler"),D._excludeVariableName("boneTextureWidth"),D._excludeVariableName("mBones"),D._excludeVariableName("BonesPerMesh")},t.prototype.getClassName=function(){return"BonesBlock"},Object.defineProperty(t.prototype,"matricesIndices",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"matricesWeights",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"matricesIndicesExtra",{get:function(){return this._inputs[2]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"matricesWeightsExtra",{get:function(){return this._inputs[3]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"world",{get:function(){return this._inputs[4]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),t.prototype.autoConfigure=function(D){if(!this.matricesIndices.isConnected){var w=D.getInputBlockByPredicate((function(D){return D.isAttribute&&"matricesIndices"===D.name}));w||(w=new Bu("matricesIndices")).setAsAttribute("matricesIndices"),w.output.connectTo(this.matricesIndices)}if(!this.matricesWeights.isConnected){var N=D.getInputBlockByPredicate((function(D){return D.isAttribute&&"matricesWeights"===D.name}));N||(N=new Bu("matricesWeights")).setAsAttribute("matricesWeights"),N.output.connectTo(this.matricesWeights)}if(!this.world.isConnected){var F=D.getInputBlockByPredicate((function(D){return D.systemValue===yu.World}));F||(F=new Bu("world")).setAsSystemValue(yu.World),F.output.connectTo(this.world)}},t.prototype.provideFallbacks=function(D,w){D&&D.useBones&&D.computeBonesUsingShaders&&D.skeleton&&w.addCPUSkinningFallback(0,D)},t.prototype.bind=function(D,w,N){jo.a.BindBonesParameters(N,D)},t.prototype.prepareDefines=function(D,w,N){N._areAttributesDirty&&jo.a.PrepareDefinesForBones(D,N)},t.prototype._buildBlock=function(w){D.prototype._buildBlock.call(this,w),w.sharedData.blocksWithFallbacks.push(this),w.sharedData.bindableBlocks.push(this),w.sharedData.blocksWithDefines.push(this),w.uniforms.push("boneTextureWidth"),w.uniforms.push("mBones"),w.samplers.push("boneSampler");var N="//"+this.name;w._emitFunctionFromInclude("bonesDeclaration",N,{removeAttributes:!0,removeUniforms:!1,removeVaryings:!0,removeIfDef:!1});var F=w._getFreeVariableName("influence");w.compilationString+=w._emitCodeFromInclude("bonesVertex",N,{replaceStrings:[{search:/finalWorld=finalWorld\*influence;/,replace:""},{search:/influence/gm,replace:F}]});var k=this._outputs[0],j=this.world;return w.compilationString+="#if NUM_BONE_INFLUENCERS>0\r\n",w.compilationString+=this._declareOutput(k,w)+" = "+j.associatedVariableName+" * "+F+";\r\n",w.compilationString+="#else\r\n",w.compilationString+=this._declareOutput(k,w)+" = "+j.associatedVariableName+";\r\n",w.compilationString+="#endif\r\n",this},t}(Ru);H.a.RegisteredTypes["BABYLON.BonesBlock"]=ju;var zu=function(D){function t(w){var N=D.call(this,w,_u.Vertex)||this;return N.registerInput("world0",mu.Vector4),N.registerInput("world1",mu.Vector4),N.registerInput("world2",mu.Vector4),N.registerInput("world3",mu.Vector4),N.registerInput("world",mu.Matrix,!0),N.registerOutput("output",mu.Matrix),N.registerOutput("instanceID",mu.Float),N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"InstancesBlock"},Object.defineProperty(t.prototype,"world0",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"world1",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"world2",{get:function(){return this._inputs[2]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"world3",{get:function(){return this._inputs[3]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"world",{get:function(){return this._inputs[4]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"instanceID",{get:function(){return this._outputs[1]},enumerable:!0,configurable:!0}),t.prototype.autoConfigure=function(D){if(!this.world0.connectedPoint){var w=D.getInputBlockByPredicate((function(D){return D.isAttribute&&"world0"===D.name}));w||(w=new Bu("world0")).setAsAttribute("world0"),w.output.connectTo(this.world0)}if(!this.world1.connectedPoint){var N=D.getInputBlockByPredicate((function(D){return D.isAttribute&&"world1"===D.name}));N||(N=new Bu("world1")).setAsAttribute("world1"),N.output.connectTo(this.world1)}if(!this.world2.connectedPoint){var F=D.getInputBlockByPredicate((function(D){return D.isAttribute&&"world2"===D.name}));F||(F=new Bu("world2")).setAsAttribute("world2"),F.output.connectTo(this.world2)}if(!this.world3.connectedPoint){var k=D.getInputBlockByPredicate((function(D){return D.isAttribute&&"world3"===D.name}));k||(k=new Bu("world3")).setAsAttribute("world3"),k.output.connectTo(this.world3)}if(!this.world.connectedPoint){var j=D.getInputBlockByPredicate((function(D){return D.isAttribute&&"world"===D.name}));j||(j=new Bu("world")).setAsSystemValue(yu.World),j.output.connectTo(this.world)}this.world.define="!INSTANCES"},t.prototype.prepareDefines=function(D,w,N,F){void 0===F&&(F=!1);var k=!1;N.INSTANCES!==F&&(N.setValue("INSTANCES",F),k=!0),k&&N.markAsUnprocessed()},t.prototype._buildBlock=function(w){D.prototype._buildBlock.call(this,w),w.sharedData.blocksWithDefines.push(this);var N=this._outputs[0],F=this._outputs[1],k=this.world0,j=this.world1,z=this.world2,G=this.world3;return w.compilationString+="#ifdef INSTANCES\r\n",w.compilationString+=this._declareOutput(N,w)+" = mat4("+k.associatedVariableName+", "+j.associatedVariableName+", "+z.associatedVariableName+", "+G.associatedVariableName+");\r\n",w.compilationString+=this._declareOutput(F,w)+" = float(gl_InstanceID);\r\n",w.compilationString+="#else\r\n",w.compilationString+=this._declareOutput(N,w)+" = "+this.world.associatedVariableName+";\r\n",w.compilationString+=this._declareOutput(F,w)+" = 0.0;\r\n",w.compilationString+="#endif\r\n",this},t}(Ru);H.a.RegisteredTypes["BABYLON.InstancesBlock"]=zu;var Gu=function(D){function t(w){var N=D.call(this,w,_u.Vertex)||this;return N.registerInput("position",mu.Vector3),N.registerInput("normal",mu.Vector3),N.registerInput("tangent",mu.Vector3),N.registerInput("uv",mu.Vector2),N.registerOutput("positionOutput",mu.Vector3),N.registerOutput("normalOutput",mu.Vector3),N.registerOutput("tangentOutput",mu.Vector3),N.registerOutput("uvOutput",mu.Vector2),N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"MorphTargetsBlock"},Object.defineProperty(t.prototype,"position",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"normal",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tangent",{get:function(){return this._inputs[2]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"uv",{get:function(){return this._inputs[3]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"positionOutput",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"normalOutput",{get:function(){return this._outputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tangentOutput",{get:function(){return this._outputs[2]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"uvOutput",{get:function(){return this._outputs[3]},enumerable:!0,configurable:!0}),t.prototype.initialize=function(D){D._excludeVariableName("morphTargetInfluences")},t.prototype.autoConfigure=function(D){if(!this.position.isConnected){var w=D.getInputBlockByPredicate((function(D){return D.isAttribute&&"position"===D.name}));w||(w=new Bu("position")).setAsAttribute(),w.output.connectTo(this.position)}if(!this.normal.isConnected){var N=D.getInputBlockByPredicate((function(D){return D.isAttribute&&"normal"===D.name}));N||(N=new Bu("normal")).setAsAttribute("normal"),N.output.connectTo(this.normal)}if(!this.tangent.isConnected){var F=D.getInputBlockByPredicate((function(D){return D.isAttribute&&"tangent"===D.name}));F||(F=new Bu("tangent")).setAsAttribute("tangent"),F.output.connectTo(this.tangent)}if(!this.uv.isConnected){var k=D.getInputBlockByPredicate((function(D){return D.isAttribute&&"uv"===D.name}));k||(k=new Bu("uv")).setAsAttribute("uv"),k.output.connectTo(this.uv)}},t.prototype.prepareDefines=function(D,w,N){N._areAttributesDirty&&jo.a.PrepareDefinesForMorphTargets(D,N)},t.prototype.bind=function(D,w,N){N&&N.morphTargetManager&&N.morphTargetManager.numInfluencers>0&&jo.a.BindMorphTargetParameters(N,D)},t.prototype.replaceRepeatableContent=function(D,w,N,F){for(var k=this.position,j=this.normal,z=this.tangent,G=this.uv,H=this.positionOutput,X=this.normalOutput,q=this.tangentOutput,Z=this.uvOutput,J=D,$=F.NUM_MORPH_INFLUENCERS,te=N.morphTargetManager,ie=te&&te.supportsNormals&&F.NORMAL,oe=te&&te.supportsTangents&&F.TANGENT,ce=te&&te.supportsUVs&&F.UV1,he="",fe=0;fe<$;fe++)he+="#ifdef MORPHTARGETS\r\n",he+=H.associatedVariableName+" += (position"+fe+" - "+k.associatedVariableName+") * morphTargetInfluences["+fe+"];\r\n",ie&&(he+="#ifdef MORPHTARGETS_NORMAL\r\n",he+=X.associatedVariableName+" += (normal"+fe+" - "+j.associatedVariableName+") * morphTargetInfluences["+fe+"];\r\n",he+="#endif\r\n"),oe&&(he+="#ifdef MORPHTARGETS_TANGENT\r\n",he+=q.associatedVariableName+".xyz += (tangent"+fe+" - "+z.associatedVariableName+".xyz) * morphTargetInfluences["+fe+"];\r\n",he+="#endif\r\n"),ce&&(he+="#ifdef MORPHTARGETS_UV\r\n",he+=Z.associatedVariableName+".xy += (uv_"+fe+" - "+G.associatedVariableName+".xy) * morphTargetInfluences["+fe+"];\r\n",he+="#endif\r\n"),he+="#endif\r\n";if(J.compilationString=J.compilationString.replace(this._repeatableContentAnchor,he),$>0)for(fe=0;fe<$;fe++)J.attributes.push(Zi.b.PositionKind+fe),ie&&J.attributes.push(Zi.b.NormalKind+fe),oe&&J.attributes.push(Zi.b.TangentKind+fe),ce&&J.attributes.push(Zi.b.UVKind+"_"+fe)},t.prototype._buildBlock=function(w){D.prototype._buildBlock.call(this,w),w.sharedData.blocksWithDefines.push(this),w.sharedData.bindableBlocks.push(this),w.sharedData.repeatableContentBlocks.push(this);var N=this.position,F=this.normal,k=this.tangent,j=this.uv,z=this.positionOutput,G=this.normalOutput,H=this.tangentOutput,X=this.uvOutput,q="//"+this.name;return w.uniforms.push("morphTargetInfluences"),w._emitFunctionFromInclude("morphTargetsVertexGlobalDeclaration",q),w._emitFunctionFromInclude("morphTargetsVertexDeclaration",q,{repeatKey:"maxSimultaneousMorphTargets"}),w.compilationString+=this._declareOutput(z,w)+" = "+N.associatedVariableName+";\r\n",w.compilationString+="#ifdef NORMAL\r\n",w.compilationString+=this._declareOutput(G,w)+" = "+F.associatedVariableName+";\r\n",w.compilationString+="#else\r\n",w.compilationString+=this._declareOutput(G,w)+" = vec3(0., 0., 0.);\r\n",w.compilationString+="#endif\r\n",w.compilationString+="#ifdef TANGENT\r\n",w.compilationString+=this._declareOutput(H,w)+" = "+k.associatedVariableName+";\r\n",w.compilationString+="#else\r\n",w.compilationString+=this._declareOutput(H,w)+" = vec3(0., 0., 0.);\r\n",w.compilationString+="#endif\r\n",w.compilationString+="#ifdef UV1\r\n",w.compilationString+=this._declareOutput(X,w)+" = "+j.associatedVariableName+";\r\n",w.compilationString+="#else\r\n",w.compilationString+=this._declareOutput(X,w)+" = vec2(0., 0.);\r\n",w.compilationString+="#endif\r\n",this._repeatableContentAnchor=w._repeatableContentAnchor,w.compilationString+=this._repeatableContentAnchor,this},t}(Ru);H.a.RegisteredTypes["BABYLON.MorphTargetsBlock"]=Gu;var Yu=function(D){function t(w){var N=D.call(this,w,_u.Vertex)||this;return N.registerInput("worldPosition",mu.Vector4,!1,_u.Vertex),N.registerOutput("direction",mu.Vector3),N.registerOutput("color",mu.Color3),N.registerOutput("intensity",mu.Float),N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"LightInformationBlock"},Object.defineProperty(t.prototype,"worldPosition",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"direction",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){return this._outputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"intensity",{get:function(){return this._outputs[2]},enumerable:!0,configurable:!0}),t.prototype.bind=function(D,w,N){if(N){this.light&&this.light.isDisposed&&(this.light=null);var F=this.light,k=w.getScene();if(!F&&k.lights.length&&(F=k.lights[0]),!F||!F.isEnabled)return D.setFloat3(this._lightDataUniformName,0,0,0),void D.setFloat4(this._lightColorUniformName,0,0,0,0);F.transferToNodeMaterialEffect(D,this._lightDataUniformName),D.setColor4(this._lightColorUniformName,F.diffuse,F.intensity)}},t.prototype.prepareDefines=function(D,w,N){if(N._areLightsDirty){var F=this.light;N.setValue(this._lightTypeDefineName,!!(F&&F instanceof tc))}},t.prototype._buildBlock=function(w){D.prototype._buildBlock.call(this,w),w.sharedData.bindableBlocks.push(this),w.sharedData.blocksWithDefines.push(this);var N=this.direction,F=this.color,k=this.intensity;return this._lightDataUniformName=w._getFreeVariableName("lightData"),this._lightColorUniformName=w._getFreeVariableName("lightColor"),this._lightTypeDefineName=w._getFreeDefineName("LIGHTPOINTTYPE"),w._emitUniformFromString(this._lightDataUniformName,"vec3"),w._emitUniformFromString(this._lightColorUniformName,"vec4"),w.compilationString+="#ifdef "+this._lightTypeDefineName+"\r\n",w.compilationString+=this._declareOutput(N,w)+" = normalize("+this.worldPosition.associatedVariableName+".xyz - "+this._lightDataUniformName+");\r\n",w.compilationString+="#else\r\n",w.compilationString+=this._declareOutput(N,w)+" = "+this._lightDataUniformName+";\r\n",w.compilationString+="#endif\r\n",w.compilationString+=this._declareOutput(F,w)+" = "+this._lightColorUniformName+".rgb;\r\n",w.compilationString+=this._declareOutput(k,w)+" = "+this._lightColorUniformName+".a;\r\n",this},t.prototype.serialize=function(){var w=D.prototype.serialize.call(this);return this.light&&(w.lightId=this.light.id),w},t.prototype._deserialize=function(w,N,F){D.prototype._deserialize.call(this,w,N,F),w.lightId&&(this.light=N.getLightByID(w.lightId))},t}(Ru);H.a.RegisteredTypes["BABYLON.LightInformationBlock"]=Yu;var Hu=function(D){function t(w){var N=D.call(this,w,_u.Fragment)||this;return N.registerInput("color",mu.Color4),N.registerOutput("output",mu.Color4),N._inputs[0].acceptedConnectionPointTypes.push(mu.Color3),N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"ImageProcessingBlock"},Object.defineProperty(t.prototype,"color",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),t.prototype.initialize=function(D){D._excludeVariableName("exposureLinear"),D._excludeVariableName("contrast"),D._excludeVariableName("vInverseScreenSize"),D._excludeVariableName("vignetteSettings1"),D._excludeVariableName("vignetteSettings2"),D._excludeVariableName("vCameraColorCurveNegative"),D._excludeVariableName("vCameraColorCurveNeutral"),D._excludeVariableName("vCameraColorCurvePositive"),D._excludeVariableName("txColorTransform"),D._excludeVariableName("colorTransformSettings")},t.prototype.isReady=function(D,w,N){return!(N._areImageProcessingDirty&&w.imageProcessingConfiguration&&!w.imageProcessingConfiguration.isReady())},t.prototype.prepareDefines=function(D,w,N){N._areImageProcessingDirty&&w.imageProcessingConfiguration&&w.imageProcessingConfiguration.prepareDefines(N)},t.prototype.bind=function(D,w,N){N&&w.imageProcessingConfiguration&&w.imageProcessingConfiguration.bind(D)},t.prototype._buildBlock=function(w){D.prototype._buildBlock.call(this,w),w.sharedData.blocksWithDefines.push(this),w.sharedData.blockingBlocks.push(this),w.sharedData.bindableBlocks.push(this),w.uniforms.push("exposureLinear"),w.uniforms.push("contrast"),w.uniforms.push("vInverseScreenSize"),w.uniforms.push("vignetteSettings1"),w.uniforms.push("vignetteSettings2"),w.uniforms.push("vCameraColorCurveNegative"),w.uniforms.push("vCameraColorCurveNeutral"),w.uniforms.push("vCameraColorCurvePositive"),w.uniforms.push("txColorTransform"),w.uniforms.push("colorTransformSettings");var N=this.color,F=this._outputs[0],k="//"+this.name;return w._emitFunctionFromInclude("helperFunctions",k),w._emitFunctionFromInclude("imageProcessingDeclaration",k),w._emitFunctionFromInclude("imageProcessingFunctions",k),N.connectedPoint.type===mu.Color4||N.connectedPoint.type===mu.Vector4?w.compilationString+=this._declareOutput(F,w)+" = "+N.associatedVariableName+";\r\n":w.compilationString+=this._declareOutput(F,w)+" = vec4("+N.associatedVariableName+", 1.0);\r\n",w.compilationString+="#ifdef IMAGEPROCESSINGPOSTPROCESS\r\n",w.compilationString+=F.associatedVariableName+".rgb = toLinearSpace("+N.associatedVariableName+".rgb);\r\n",w.compilationString+="#else\r\n",w.compilationString+="#ifdef IMAGEPROCESSING\r\n",w.compilationString+=F.associatedVariableName+".rgb = toLinearSpace("+N.associatedVariableName+".rgb);\r\n",w.compilationString+=F.associatedVariableName+" = applyImageProcessing("+F.associatedVariableName+");\r\n",w.compilationString+="#endif\r\n",w.compilationString+="#endif\r\n",this},t}(Ru);H.a.RegisteredTypes["BABYLON.ImageProcessingBlock"]=Hu;var Wu=function(D){function t(w){var N=D.call(this,w,_u.Fragment)||this;return N._tangentSpaceParameterName="",N.invertX=!1,N.invertY=!1,N.registerInput("worldPosition",mu.Vector4,!1),N.registerInput("worldNormal",mu.Vector4,!1),N.registerInput("worldTangent",mu.Vector4,!0),N.registerInput("uv",mu.Vector2,!1),N.registerInput("normalMapColor",mu.Color3,!1),N.registerInput("strength",mu.Float,!1),N.registerOutput("output",mu.Vector4),N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"PerturbNormalBlock"},Object.defineProperty(t.prototype,"worldPosition",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"worldNormal",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"worldTangent",{get:function(){return this._inputs[2]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"uv",{get:function(){return this._inputs[3]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"normalMapColor",{get:function(){return this._inputs[4]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"strength",{get:function(){return this._inputs[5]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),t.prototype.prepareDefines=function(D,w,N){N.setValue("BUMP",!0)},t.prototype.bind=function(D,w,N){w.getScene()._mirroredCameraPosition?D.setFloat2(this._tangentSpaceParameterName,this.invertX?1:-1,this.invertY?1:-1):D.setFloat2(this._tangentSpaceParameterName,this.invertX?-1:1,this.invertY?-1:1)},t.prototype.autoConfigure=function(D){if(!this.uv.isConnected){var w=D.getInputBlockByPredicate((function(D){return D.isAttribute&&"uv"===D.name}));w||(w=new Bu("uv")).setAsAttribute(),w.output.connectTo(this.uv)}if(!this.strength.isConnected){var N=new Bu("strength");N.value=1,N.output.connectTo(this.strength)}},t.prototype._buildBlock=function(w){D.prototype._buildBlock.call(this,w);var N="//"+this.name,F=this.uv,k=this.worldPosition,j=this.worldNormal,z=this.worldTangent;w.sharedData.blocksWithDefines.push(this),w.sharedData.bindableBlocks.push(this),this._tangentSpaceParameterName=w._getFreeDefineName("tangentSpaceParameter"),w._emitUniformFromString(this._tangentSpaceParameterName,"vec2");var G=this.strength.isConnectedToInputBlock&&this.strength.connectInputBlock.isConstant?""+w._emitFloat(1/this.strength.connectInputBlock.value):"1.0 / "+this.strength.associatedVariableName;w._emitExtension("derivatives","#extension GL_OES_standard_derivatives : enable");var H={search:/defined\(TANGENT\)/g,replace:z.isConnected?"defined(TANGENT)":"defined(IGNORE)"};return z.isConnected&&(w.compilationString+="vec3 tbnNormal = normalize("+j.associatedVariableName+".xyz);\r\n",w.compilationString+="vec3 tbnTangent = normalize("+z.associatedVariableName+".xyz);\r\n",w.compilationString+="vec3 tbnBitangent = cross(tbnNormal, tbnTangent);\r\n",w.compilationString+="mat3 vTBN = mat3(tbnTangent, tbnBitangent, tbnNormal);\r\n"),w._emitFunctionFromInclude("bumpFragmentFunctions",N,{replaceStrings:[{search:/vBumpInfos.y/g,replace:G},{search:/vTangentSpaceParams/g,replace:this._tangentSpaceParameterName},{search:/vPositionW/g,replace:k.associatedVariableName+".xyz"},H]}),w.compilationString+=this._declareOutput(this.output,w)+" = vec4(0.);\r\n",w.compilationString+=w._emitCodeFromInclude("bumpFragment",N,{replaceStrings:[{search:/perturbNormal\(TBN,vBumpUV\+uvOffset\)/g,replace:"perturbNormal(TBN, "+this.normalMapColor.associatedVariableName+")"},{search:/vBumpInfos.y/g,replace:G},{search:/vBumpUV/g,replace:F.associatedVariableName},{search:/vPositionW/g,replace:k.associatedVariableName+".xyz"},{search:/normalW=/g,replace:this.output.associatedVariableName+".xyz = "},{search:/normalW/g,replace:j.associatedVariableName+".xyz"},H]}),this},t.prototype._dumpPropertiesCode=function(){return this._codeVariableName+".invertX = "+this.invertX+";\r\n"+this._codeVariableName+".invertY = "+this.invertY+";\r\n"},t.prototype.serialize=function(){var w=D.prototype.serialize.call(this);return w.invertX=this.invertX,w.invertY=this.invertY,w},t.prototype._deserialize=function(w,N,F){D.prototype._deserialize.call(this,w,N,F),this.invertX=w.invertX,this.invertY=w.invertY},t}(Ru);H.a.RegisteredTypes["BABYLON.PerturbNormalBlock"]=Wu;var Xu=function(D){function t(w){var N=D.call(this,w,_u.Fragment,!0)||this;return N.registerInput("value",mu.Float,!0),N.registerInput("cutoff",mu.Float,!0),N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"DiscardBlock"},Object.defineProperty(t.prototype,"value",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cutoff",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),t.prototype._buildBlock=function(w){return D.prototype._buildBlock.call(this,w),w.sharedData.hints.needAlphaTesting=!0,w.compilationString+="if ("+this.value.associatedVariableName+" < "+this.cutoff.associatedVariableName+") discard;\r\n",this},t}(Ru);H.a.RegisteredTypes["BABYLON.DiscardBlock"]=Xu;var Ku=function(D){function t(w){var N=D.call(this,w,_u.Fragment)||this;return N.registerOutput("output",mu.Float,_u.Fragment),N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"FrontFacingBlock"},Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),t.prototype._buildBlock=function(w){if(D.prototype._buildBlock.call(this,w),w.target===_u.Vertex)throw"FrontFacingBlock must only be used in a fragment shader";var N=this._outputs[0];return w.compilationString+=this._declareOutput(N,w)+" = gl_FrontFacing ? 1.0 : 0.0;\r\n",this},t}(Ru);H.a.RegisteredTypes["BABYLON.FrontFacingBlock"]=Ku;var Qu=function(D){function t(w){var N=D.call(this,w,_u.Fragment)||this;return N.registerInput("input",mu.AutoDetect,!1),N.registerOutput("dx",mu.BasedOnInput),N.registerOutput("dy",mu.BasedOnInput),N._outputs[0]._typeConnectionSource=N._inputs[0],N._outputs[1]._typeConnectionSource=N._inputs[0],N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"DerivativeBlock"},Object.defineProperty(t.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dx",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dy",{get:function(){return this._outputs[1]},enumerable:!0,configurable:!0}),t.prototype._buildBlock=function(w){D.prototype._buildBlock.call(this,w);var N=this._outputs[0],F=this._outputs[1];return w._emitExtension("derivatives","#extension GL_OES_standard_derivatives : enable"),N.hasEndpoints&&(w.compilationString+=this._declareOutput(N,w)+" = dFdx("+this.input.associatedVariableName+");\r\n"),F.hasEndpoints&&(w.compilationString+=this._declareOutput(F,w)+" = dFdy("+this.input.associatedVariableName+");\r\n"),this},t}(Ru);H.a.RegisteredTypes["BABYLON.DerivativeBlock"]=Qu;var qu=function(D){function t(w){var N=D.call(this,w,_u.VertexAndFragment,!0)||this;return N.registerInput("worldPosition",mu.Vector4,!1,_u.Vertex),N.registerInput("view",mu.Matrix,!1,_u.Vertex),N.registerInput("input",mu.Color3,!1,_u.Fragment),N.registerInput("fogColor",mu.Color3,!1,_u.Fragment),N.registerOutput("output",mu.Color3,_u.Fragment),N.input.acceptedConnectionPointTypes.push(mu.Color4),N.fogColor.acceptedConnectionPointTypes.push(mu.Color4),N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"FogBlock"},Object.defineProperty(t.prototype,"worldPosition",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"view",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"input",{get:function(){return this._inputs[2]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fogColor",{get:function(){return this._inputs[3]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),t.prototype.autoConfigure=function(D){if(!this.view.isConnected){var w=D.getInputBlockByPredicate((function(D){return D.systemValue===yu.View}));w||(w=new Bu("view")).setAsSystemValue(yu.View),w.output.connectTo(this.view)}if(!this.fogColor.isConnected){var N=D.getInputBlockByPredicate((function(D){return D.systemValue===yu.FogColor}));N||(N=new Bu("fogColor",void 0,mu.Color3)).setAsSystemValue(yu.FogColor),N.output.connectTo(this.fogColor)}},t.prototype.prepareDefines=function(D,w,N){var F=D.getScene();N.setValue("FOG",w.fogEnabled&&jo.a.GetFogState(D,F))},t.prototype.bind=function(D,w,N){if(N){var F=N.getScene();D.setFloat4(this._fogParameters,F.fogMode,F.fogStart,F.fogEnd,F.fogDensity)}},t.prototype._buildBlock=function(w){if(D.prototype._buildBlock.call(this,w),w.target===_u.Fragment){w.sharedData.blocksWithDefines.push(this),w.sharedData.bindableBlocks.push(this),w._emitFunctionFromInclude("fogFragmentDeclaration","//"+this.name,{removeUniforms:!0,removeVaryings:!0,removeIfDef:!1,replaceStrings:[{search:/float CalcFogFactor\(\)/,replace:"float CalcFogFactor(vec3 vFogDistance, vec4 vFogInfos)"}]});var N=w._getFreeVariableName("fog"),F=this.input,k=this.fogColor;this._fogParameters=w._getFreeVariableName("fogParameters");var j=this._outputs[0];w._emitUniformFromString(this._fogParameters,"vec4"),w.compilationString+="#ifdef FOG\r\n",w.compilationString+="float "+N+" = CalcFogFactor("+this._fogDistanceName+", "+this._fogParameters+");\r\n",w.compilationString+=this._declareOutput(j,w)+" = "+N+" * "+F.associatedVariableName+".rgb + (1.0 - "+N+") * "+k.associatedVariableName+".rgb;\r\n",w.compilationString+="#else\r\n"+this._declareOutput(j,w)+" =  "+F.associatedVariableName+".rgb;\r\n",w.compilationString+="#endif\r\n"}else{var z=this.worldPosition,G=this.view;this._fogDistanceName=w._getFreeVariableName("vFogDistance"),w._emitVaryingFromString(this._fogDistanceName,"vec3"),w.compilationString+=this._fogDistanceName+" = ("+G.associatedVariableName+" * "+z.associatedVariableName+").xyz;\r\n"}return this},t}(Ru);H.a.RegisteredTypes["BABYLON.FogBlock"]=qu;var Zu=function(D){function t(w){var N=D.call(this,w,_u.VertexAndFragment)||this;return N._isUnique=!0,N.registerInput("worldPosition",mu.Vector4,!1,_u.Vertex),N.registerInput("worldNormal",mu.Vector4,!1,_u.Fragment),N.registerInput("cameraPosition",mu.Vector3,!1,_u.Fragment),N.registerInput("glossiness",mu.Float,!0,_u.Fragment),N.registerInput("glossPower",mu.Float,!0,_u.Fragment),N.registerInput("diffuseColor",mu.Color3,!0,_u.Fragment),N.registerInput("specularColor",mu.Color3,!0,_u.Fragment),N.registerOutput("diffuseOutput",mu.Color3,_u.Fragment),N.registerOutput("specularOutput",mu.Color3,_u.Fragment),N.registerOutput("shadow",mu.Float,_u.Fragment),N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"LightBlock"},Object.defineProperty(t.prototype,"worldPosition",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"worldNormal",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraPosition",{get:function(){return this._inputs[2]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"glossiness",{get:function(){return this._inputs[3]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"glossPower",{get:function(){return this._inputs[4]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"diffuseColor",{get:function(){return this._inputs[5]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"specularColor",{get:function(){return this._inputs[6]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"diffuseOutput",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"specularOutput",{get:function(){return this._outputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadow",{get:function(){return this._outputs[2]},enumerable:!0,configurable:!0}),t.prototype.autoConfigure=function(D){if(!this.cameraPosition.isConnected){var w=D.getInputBlockByPredicate((function(D){return D.systemValue===yu.CameraPosition}));w||(w=new Bu("cameraPosition")).setAsSystemValue(yu.CameraPosition),w.output.connectTo(this.cameraPosition)}},t.prototype.prepareDefines=function(D,w,N){if(N._areLightsDirty){var F=D.getScene();if(this.light){var k={needNormals:!1,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};jo.a.PrepareDefinesForLight(F,D,this.light,this._lightId,N,!0,k),k.needRebuild&&N.rebuild()}else jo.a.PrepareDefinesForLights(F,D,N,!0,w.maxSimultaneousLights)}},t.prototype.updateUniformsAndSamples=function(D,w,N,F){for(var k=0;k<w.maxSimultaneousLights&&N["LIGHT"+k];k++)jo.a.PrepareUniformsAndSamplersForLight(k,D.uniforms,D.samplers,N["PROJECTEDLIGHTTEXTURE"+k],F)},t.prototype.bind=function(D,w,N){if(N){var F=N.getScene();this.light?jo.a.BindLight(this.light,this._lightId,F,D,!0):jo.a.BindLights(F,N,D,!0,w.maxSimultaneousLights)}},t.prototype._injectVertexCode=function(D){var w=this.worldPosition,N="//"+this.name;this.light?(this._lightId=(void 0!==D.counters.lightCounter?D.counters.lightCounter:-1)+1,D.counters.lightCounter=this._lightId,D._emitFunctionFromInclude(D.supportUniformBuffers?"lightUboDeclaration":"lightFragmentDeclaration",N,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()}]},this._lightId.toString())):(D._emitFunctionFromInclude(D.supportUniformBuffers?"lightUboDeclaration":"lightFragmentDeclaration",N,{repeatKey:"maxSimultaneousLights"}),this._lightId=0,D.sharedData.dynamicUniformBlocks.push(this));var F="v_"+w.associatedVariableName;D._emitVaryingFromString(F,"vec4")&&(D.compilationString+=F+" = "+w.associatedVariableName+";\r\n"),this.light?D.compilationString+=D._emitCodeFromInclude("shadowsVertex",N,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()},{search:/worldPos/g,replace:w.associatedVariableName}]}):(D.compilationString+="vec4 worldPos = "+w.associatedVariableName+";\r\n",D.compilationString+=D._emitCodeFromInclude("shadowsVertex",N,{repeatKey:"maxSimultaneousLights"}))},t.prototype._buildBlock=function(w){if(D.prototype._buildBlock.call(this,w),w.target===_u.Fragment){w.sharedData.bindableBlocks.push(this),w.sharedData.blocksWithDefines.push(this);var N="//"+this.name,F=this.worldPosition;w._emitFunctionFromInclude("helperFunctions",N),w._emitFunctionFromInclude("lightsFragmentFunctions",N,{replaceStrings:[{search:/vPositionW/g,replace:"v_"+F.associatedVariableName+".xyz"}]}),w._emitFunctionFromInclude("shadowsFragmentFunctions",N,{replaceStrings:[{search:/vPositionW/g,replace:"v_"+F.associatedVariableName+".xyz"}]}),this.light?w._emitFunctionFromInclude(w.supportUniformBuffers?"lightUboDeclaration":"lightFragmentDeclaration",N,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()}]},this._lightId.toString()):w._emitFunctionFromInclude(w.supportUniformBuffers?"lightUboDeclaration":"lightFragmentDeclaration",N,{repeatKey:"maxSimultaneousLights"}),0===this._lightId&&(w._registerTempVariable("viewDirectionW")&&(w.compilationString+="vec3 viewDirectionW = normalize("+this.cameraPosition.associatedVariableName+" - v_"+F.associatedVariableName+".xyz);\r\n"),w.compilationString+="lightingInfo info;\r\n",w.compilationString+="float shadow = 1.;\r\n",w.compilationString+="float glossiness = "+(this.glossiness.isConnected?this.glossiness.associatedVariableName:"1.0")+" * "+(this.glossPower.isConnected?this.glossPower.associatedVariableName:"1024.0")+";\r\n",w.compilationString+="vec3 diffuseBase = vec3(0., 0., 0.);\r\n",w.compilationString+="vec3 specularBase = vec3(0., 0., 0.);\r\n",w.compilationString+="vec3 normalW = "+this.worldNormal.associatedVariableName+".xyz;\r\n"),this.light?w.compilationString+=w._emitCodeFromInclude("lightFragment",N,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()}]}):w.compilationString+=w._emitCodeFromInclude("lightFragment",N,{repeatKey:"maxSimultaneousLights"});var k=this.diffuseOutput,j=this.specularOutput;return w.compilationString+=this._declareOutput(k,w)+" = diffuseBase"+(this.diffuseColor.isConnected?" * "+this.diffuseColor.associatedVariableName:"")+";\r\n",j.hasEndpoints&&(w.compilationString+=this._declareOutput(j,w)+" = specularBase"+(this.specularColor.isConnected?" * "+this.specularColor.associatedVariableName:"")+";\r\n"),this.shadow.hasEndpoints&&(w.compilationString+=this._declareOutput(this.shadow,w)+" = shadow;\r\n"),this}this._injectVertexCode(w)},t.prototype.serialize=function(){var w=D.prototype.serialize.call(this);return this.light&&(w.lightId=this.light.id),w},t.prototype._deserialize=function(w,N,F){D.prototype._deserialize.call(this,w,N,F),w.lightId&&(this.light=N.getLightByID(w.lightId))},t}(Ru);H.a.RegisteredTypes["BABYLON.LightBlock"]=Zu;var Ju=function(D){function t(w){var N=D.call(this,w,_u.VertexAndFragment)||this;return N.convertToGammaSpace=!1,N.registerInput("uv",mu.Vector2,!1,_u.VertexAndFragment),N.registerOutput("rgba",mu.Color4,_u.Neutral),N.registerOutput("rgb",mu.Color3,_u.Neutral),N.registerOutput("r",mu.Float,_u.Neutral),N.registerOutput("g",mu.Float,_u.Neutral),N.registerOutput("b",mu.Float,_u.Neutral),N.registerOutput("a",mu.Float,_u.Neutral),N._inputs[0].acceptedConnectionPointTypes.push(mu.Vector3),N._inputs[0].acceptedConnectionPointTypes.push(mu.Vector4),N._inputs[0]._prioritizeVertex=!0,N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"TextureBlock"},Object.defineProperty(t.prototype,"uv",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rgba",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rgb",{get:function(){return this._outputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"r",{get:function(){return this._outputs[2]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"g",{get:function(){return this._outputs[3]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"b",{get:function(){return this._outputs[4]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"a",{get:function(){return this._outputs[5]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"target",{get:function(){if(!this.uv.isConnected)return _u.VertexAndFragment;if(this.uv.sourceBlock.isInput)return _u.VertexAndFragment;for(var D=this.uv.connectedPoint;D;){if(D.target===_u.Fragment)return _u.Fragment;if(D.target===_u.Vertex)return _u.VertexAndFragment;if(D.target===_u.Neutral||D.target===_u.VertexAndFragment){var w=D.ownerBlock;D=null;for(var N=0,F=w.inputs;N<F.length;N++){var k=F[N];if(k.connectedPoint){D=k.connectedPoint;break}}}}return _u.VertexAndFragment},enumerable:!0,configurable:!0}),t.prototype.autoConfigure=function(D){if(!this.uv.isConnected){var w=D.getInputBlockByPredicate((function(D){return D.isAttribute&&"uv"===D.name}));w||(w=new Bu("uv")).setAsAttribute(),w.output.connectTo(this.uv)}},t.prototype.initializeDefines=function(D,w,N,F){void 0===F&&(F=!1),N._areTexturesDirty&&N.setValue(this._mainUVDefineName,!1)},t.prototype.prepareDefines=function(D,w,N){if(N._areTexturesDirty){if(!this.texture||!this.texture.getTextureMatrix)return N.setValue(this._defineName,!1),void N.setValue(this._mainUVDefineName,!0);N.setValue(this._linearDefineName,this.convertToGammaSpace),this._isMixed&&(this.texture.getTextureMatrix().isIdentityAs3x2()?(N.setValue(this._defineName,!1),N.setValue(this._mainUVDefineName,!0)):N.setValue(this._defineName,!0))}},t.prototype.isReady=function(){return!(this.texture&&!this.texture.isReadyOrNotBlocking())},t.prototype.bind=function(D,w,N){N&&this.texture&&(this._isMixed&&(D.setFloat(this._textureInfoName,this.texture.level),D.setMatrix(this._textureTransformName,this.texture.getTextureMatrix())),D.setTexture(this._samplerName,this.texture))},Object.defineProperty(t.prototype,"_isMixed",{get:function(){return this.target!==_u.Fragment},enumerable:!0,configurable:!0}),t.prototype._injectVertexCode=function(D){var w=this.uv;if(this._defineName=D._getFreeDefineName("UVTRANSFORM"),this._mainUVDefineName="VMAIN"+w.associatedVariableName.toUpperCase(),w.connectedPoint.ownerBlock.isInput&&(w.connectedPoint.ownerBlock.isAttribute||D._emitUniformFromString(w.associatedVariableName,"vec2")),this._mainUVName="vMain"+w.associatedVariableName,this._transformedUVName=D._getFreeVariableName("transformedUV"),this._textureTransformName=D._getFreeVariableName("textureTransform"),this._textureInfoName=D._getFreeVariableName("textureInfoName"),D._emitVaryingFromString(this._transformedUVName,"vec2",this._defineName),D._emitVaryingFromString(this._mainUVName,"vec2",this._mainUVDefineName),D._emitUniformFromString(this._textureTransformName,"mat4",this._defineName),D.compilationString+="#ifdef "+this._defineName+"\r\n",D.compilationString+=this._transformedUVName+" = vec2("+this._textureTransformName+" * vec4("+w.associatedVariableName+".xy, 1.0, 0.0));\r\n",D.compilationString+="#elif defined("+this._mainUVDefineName+")\r\n",D.compilationString+=this._mainUVName+" = "+w.associatedVariableName+".xy;\r\n",D.compilationString+="#endif\r\n",this._outputs.some((function(D){return D.isConnectedInVertexShader}))){this._writeTextureRead(D,!0);for(var N=0,F=this._outputs;N<F.length;N++){var k=F[N];k.hasEndpoints&&this._writeOutput(D,k,k.name,!0)}}},t.prototype._writeTextureRead=function(D,w){void 0===w&&(w=!1);var N=this.uv;if(w){if(D.target===_u.Fragment)return;D.compilationString+="vec4 "+this._tempTextureRead+" = texture2D("+this._samplerName+", "+N.associatedVariableName+");\r\n"}else this.uv.ownerBlock.target!==_u.Fragment?(D.compilationString+="#ifdef "+this._defineName+"\r\n",D.compilationString+="vec4 "+this._tempTextureRead+" = texture2D("+this._samplerName+", "+this._transformedUVName+");\r\n",D.compilationString+="#elif defined("+this._mainUVDefineName+")\r\n",D.compilationString+="vec4 "+this._tempTextureRead+" = texture2D("+this._samplerName+", "+this._mainUVName+");\r\n",D.compilationString+="#endif\r\n"):D.compilationString+="vec4 "+this._tempTextureRead+" = texture2D("+this._samplerName+", "+N.associatedVariableName+");\r\n"},t.prototype._writeOutput=function(D,w,N,F){if(void 0===F&&(F=!1),F){if(D.target===_u.Fragment)return;D.compilationString+=this._declareOutput(w,D)+" = "+this._tempTextureRead+"."+N+";\r\n"}else if(this.uv.ownerBlock.target!==_u.Fragment){var k=" * "+this._textureInfoName;D.compilationString+=this._declareOutput(w,D)+" = "+this._tempTextureRead+"."+N+k+";\r\n",D.compilationString+="#ifdef "+this._linearDefineName+"\r\n",D.compilationString+=w.associatedVariableName+" = toGammaSpace("+w.associatedVariableName+");\r\n",D.compilationString+="#endif\r\n"}else D.compilationString+=this._declareOutput(w,D)+" = "+this._tempTextureRead+"."+N+";\r\n"},t.prototype._buildBlock=function(w){if(D.prototype._buildBlock.call(this,w),w.target===_u.Vertex&&(this._tempTextureRead=w._getFreeVariableName("tempTextureRead")),(!this._isMixed&&w.target===_u.Fragment||this._isMixed&&w.target===_u.Vertex)&&(this._samplerName=w._getFreeVariableName(this.name+"Sampler"),w._emit2DSampler(this._samplerName),w.sharedData.blockingBlocks.push(this),w.sharedData.textureBlocks.push(this),w.sharedData.blocksWithDefines.push(this),w.sharedData.bindableBlocks.push(this)),w.target===_u.Fragment){if(this._outputs.some((function(D){return D.isConnectedInFragmentShader}))){this._isMixed&&w._emit2DSampler(this._samplerName),this._linearDefineName=w._getFreeDefineName("ISLINEAR");var N="//"+this.name;w._emitFunctionFromInclude("helperFunctions",N),this._isMixed&&w._emitUniformFromString(this._textureInfoName,"float"),this._writeTextureRead(w);for(var F=0,k=this._outputs;F<k.length;F++){var j=k[F];j.hasEndpoints&&this._writeOutput(w,j,j.name)}return this}}else this._injectVertexCode(w)},t.prototype._dumpPropertiesCode=function(){if(!this.texture)return"";var D=this._codeVariableName+'.texture = new BABYLON.Texture("'+this.texture.name+'");\r\n';return D+=this._codeVariableName+".texture.wrapU = "+this.texture.wrapU+";\r\n",D+=this._codeVariableName+".texture.wrapV = "+this.texture.wrapV+";\r\n",D+=this._codeVariableName+".texture.uAng = "+this.texture.uAng+";\r\n",D+=this._codeVariableName+".texture.vAng = "+this.texture.vAng+";\r\n",D+=this._codeVariableName+".texture.wAng = "+this.texture.wAng+";\r\n",D+=this._codeVariableName+".texture.uOffset = "+this.texture.uOffset+";\r\n",D+=this._codeVariableName+".texture.vOffset = "+this.texture.vOffset+";\r\n",D+=this._codeVariableName+".texture.uScale = "+this.texture.uScale+";\r\n",(D+=this._codeVariableName+".texture.vScale = "+this.texture.vScale+";\r\n")+this._codeVariableName+".convertToGammaSpace = "+this.convertToGammaSpace+";\r\n"},t.prototype.serialize=function(){var w=D.prototype.serialize.call(this);return w.convertToGammaSpace=this.convertToGammaSpace,this.texture&&(w.texture=this.texture.serialize()),w},t.prototype._deserialize=function(w,N,F){D.prototype._deserialize.call(this,w,N,F),this.convertToGammaSpace=w.convertToGammaSpace,w.texture&&(F=0===w.texture.url.indexOf("data:")?"":F,this.texture=Jt.a.Parse(w.texture,N,F))},t}(Ru);H.a.RegisteredTypes["BABYLON.TextureBlock"]=Ju;var $u=function(D){function t(w){var N=D.call(this,w,_u.VertexAndFragment)||this;return N.registerInput("position",mu.Vector3,!1,_u.Vertex),N.registerInput("worldPosition",mu.Vector4,!1,_u.Vertex),N.registerInput("worldNormal",mu.Vector4,!1,_u.Fragment),N.registerInput("world",mu.Matrix,!1,_u.Vertex),N.registerInput("cameraPosition",mu.Vector3,!1,_u.Fragment),N.registerInput("view",mu.Matrix,!1,_u.Fragment),N.registerOutput("rgb",mu.Color3,_u.Fragment),N.registerOutput("r",mu.Float,_u.Fragment),N.registerOutput("g",mu.Float,_u.Fragment),N.registerOutput("b",mu.Float,_u.Fragment),N._inputs[0].acceptedConnectionPointTypes.push(mu.Vector4),N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"ReflectionTextureBlock"},Object.defineProperty(t.prototype,"position",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"worldPosition",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"worldNormal",{get:function(){return this._inputs[2]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"world",{get:function(){return this._inputs[3]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraPosition",{get:function(){return this._inputs[4]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"view",{get:function(){return this._inputs[5]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rgb",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"r",{get:function(){return this._outputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"g",{get:function(){return this._outputs[2]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"b",{get:function(){return this._outputs[3]},enumerable:!0,configurable:!0}),t.prototype.autoConfigure=function(D){if(!this.position.isConnected){var w=D.getInputBlockByPredicate((function(D){return D.isAttribute&&"position"===D.name}));w||(w=new Bu("position")).setAsAttribute(),w.output.connectTo(this.position)}if(!this.world.isConnected){var N=D.getInputBlockByPredicate((function(D){return D.systemValue===yu.World}));N||(N=new Bu("world")).setAsSystemValue(yu.World),N.output.connectTo(this.world)}if(!this.cameraPosition.isConnected){var F=D.getInputBlockByPredicate((function(D){return D.systemValue===yu.CameraPosition}));F||(F=new Bu("cameraPosition")).setAsSystemValue(yu.CameraPosition),F.output.connectTo(this.cameraPosition)}if(!this.view.isConnected){var k=D.getInputBlockByPredicate((function(D){return D.systemValue===yu.View}));k||(k=new Bu("view")).setAsSystemValue(yu.View),k.output.connectTo(this.view)}},t.prototype.prepareDefines=function(D,w,N){N._areTexturesDirty&&this.texture&&this.texture.getTextureMatrix&&(N.setValue(this._define3DName,this.texture.isCube),N.setValue(this._defineLocalCubicName,!!this.texture.boundingBoxSize),N.setValue(this._defineExplicitName,this.texture.coordinatesMode===ce.a.TEXTURE_EXPLICIT_MODE),N.setValue(this._defineSkyboxName,this.texture.coordinatesMode===ce.a.TEXTURE_SKYBOX_MODE),N.setValue(this._defineCubicName,this.texture.coordinatesMode===ce.a.TEXTURE_CUBIC_MODE),N.setValue(this._defineSphericalName,this.texture.coordinatesMode===ce.a.TEXTURE_SPHERICAL_MODE),N.setValue(this._definePlanarName,this.texture.coordinatesMode===ce.a.TEXTURE_PLANAR_MODE),N.setValue(this._defineProjectionName,this.texture.coordinatesMode===ce.a.TEXTURE_PROJECTION_MODE),N.setValue(this._defineEquirectangularName,this.texture.coordinatesMode===ce.a.TEXTURE_EQUIRECTANGULAR_MODE),N.setValue(this._defineEquirectangularFixedName,this.texture.coordinatesMode===ce.a.TEXTURE_FIXED_EQUIRECTANGULAR_MODE),N.setValue(this._defineMirroredEquirectangularFixedName,this.texture.coordinatesMode===ce.a.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE))},t.prototype.isReady=function(){return!(this.texture&&!this.texture.isReadyOrNotBlocking())},t.prototype.bind=function(D,w,N){N&&this.texture&&(D.setMatrix(this._reflectionMatrixName,this.texture.getReflectionTextureMatrix()),this.texture.isCube?D.setTexture(this._cubeSamplerName,this.texture):D.setTexture(this._2DSamplerName,this.texture))},t.prototype._injectVertexCode=function(D){var w="v_"+this.worldPosition.associatedVariableName;D._emitVaryingFromString(w,"vec4")&&(D.compilationString+=w+" = "+this.worldPosition.associatedVariableName+";\r\n"),this._positionUVWName=D._getFreeVariableName("positionUVW"),this._directionWName=D._getFreeVariableName("directionW"),D._emitVaryingFromString(this._positionUVWName,"vec3",this._defineSkyboxName)&&(D.compilationString+="#ifdef "+this._defineSkyboxName+"\r\n",D.compilationString+=this._positionUVWName+" = "+this.position.associatedVariableName+".xyz;\r\n",D.compilationString+="#endif\r\n"),D._emitVaryingFromString(this._directionWName,"vec3","defined("+this._defineEquirectangularFixedName+") || defined("+this._defineMirroredEquirectangularFixedName+")")&&(D.compilationString+="#if defined("+this._defineEquirectangularFixedName+") || defined("+this._defineMirroredEquirectangularFixedName+")\r\n",D.compilationString+=this._directionWName+" = normalize(vec3("+this.world.associatedVariableName+" * vec4("+this.position.associatedVariableName+".xyz, 0.0)));\r\n",D.compilationString+="#endif\r\n")},t.prototype._writeOutput=function(D,w,N){D.compilationString+=this._declareOutput(w,D)+" = "+this._reflectionColorName+"."+N+";\r\n"},t.prototype._buildBlock=function(w){if(D.prototype._buildBlock.call(this,w),this.texture){if(w.target!==_u.Fragment)return this._define3DName=w._getFreeDefineName("REFLECTIONMAP_3D"),this._defineCubicName=w._getFreeDefineName("REFLECTIONMAP_CUBIC"),this._defineSphericalName=w._getFreeDefineName("REFLECTIONMAP_SPHERICAL"),this._definePlanarName=w._getFreeDefineName("REFLECTIONMAP_PLANAR"),this._defineProjectionName=w._getFreeDefineName("REFLECTIONMAP_PROJECTION"),this._defineExplicitName=w._getFreeDefineName("REFLECTIONMAP_EXPLICIT"),this._defineEquirectangularName=w._getFreeDefineName("REFLECTIONMAP_EQUIRECTANGULAR"),this._defineLocalCubicName=w._getFreeDefineName("USE_LOCAL_REFLECTIONMAP_CUBIC"),this._defineMirroredEquirectangularFixedName=w._getFreeDefineName("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"),this._defineEquirectangularFixedName=w._getFreeDefineName("REFLECTIONMAP_EQUIRECTANGULAR_FIXED"),this._defineSkyboxName=w._getFreeDefineName("REFLECTIONMAP_SKYBOX"),void this._injectVertexCode(w);w.sharedData.blockingBlocks.push(this),w.sharedData.textureBlocks.push(this),this._cubeSamplerName=w._getFreeVariableName(this.name+"CubeSampler"),w.samplers.push(this._cubeSamplerName),this._2DSamplerName=w._getFreeVariableName(this.name+"2DSampler"),w.samplers.push(this._2DSamplerName),w._samplerDeclaration+="#ifdef "+this._define3DName+"\r\n",w._samplerDeclaration+="uniform samplerCube "+this._cubeSamplerName+";\r\n",w._samplerDeclaration+="#else\r\n",w._samplerDeclaration+="uniform sampler2D "+this._2DSamplerName+";\r\n",w._samplerDeclaration+="#endif\r\n",w.sharedData.blocksWithDefines.push(this),w.sharedData.bindableBlocks.push(this);var N="//"+this.name;w._emitFunction("ReciprocalPI","#define RECIPROCAL_PI2 0.15915494",""),w._emitFunctionFromInclude("reflectionFunction",N),this._reflectionColorName=w._getFreeVariableName("reflectionColor"),this._reflectionCoordsName=w._getFreeVariableName("reflectionUVW"),this._reflection2DCoordsName=w._getFreeVariableName("reflectionUV"),this._reflectionMatrixName=w._getFreeVariableName("reflectionMatrix"),w._emitUniformFromString(this._reflectionMatrixName,"mat4");var F="v_"+this.worldPosition.associatedVariableName,k=this.worldNormal.associatedVariableName+".xyz",j=this._reflectionMatrixName,z="normalize("+this._directionWName+")",G=""+this._positionUVWName,H=""+this.cameraPosition.associatedVariableName,X=""+this.view.associatedVariableName;w.compilationString+="vec3 "+this._reflectionColorName+";\r\n",w.compilationString+="#ifdef "+this._defineMirroredEquirectangularFixedName+"\r\n",w.compilationString+="    vec3 "+this._reflectionCoordsName+" = computeMirroredFixedEquirectangularCoords("+F+", "+k+", "+z+");\r\n",w.compilationString+="#endif\r\n",w.compilationString+="#ifdef "+this._defineEquirectangularFixedName+"\r\n",w.compilationString+="    vec3 "+this._reflectionCoordsName+" = computeFixedEquirectangularCoords("+F+", "+k+", "+z+");\r\n",w.compilationString+="#endif\r\n",w.compilationString+="#ifdef "+this._defineEquirectangularName+"\r\n",w.compilationString+="    vec3 "+this._reflectionCoordsName+" = computeEquirectangularCoords("+F+", "+k+", "+H+".xyz, "+j+");\r\n",w.compilationString+=" #endif\r\n",w.compilationString+="#ifdef "+this._defineSphericalName+"\r\n",w.compilationString+="    vec3 "+this._reflectionCoordsName+" = computeSphericalCoords("+F+", "+k+", "+X+", "+j+");\r\n",w.compilationString+="#endif\r\n",w.compilationString+="#ifdef "+this._definePlanarName+"\r\n",w.compilationString+="    vec3 "+this._reflectionCoordsName+" = computePlanarCoords("+F+", "+k+", "+H+".xyz, "+j+");\r\n",w.compilationString+="#endif\r\n",w.compilationString+="#ifdef "+this._defineCubicName+"\r\n",w.compilationString+="    #ifdef "+this._defineLocalCubicName+"\r\n",w.compilationString+="        vec3 "+this._reflectionCoordsName+" = computeCubicLocalCoords("+F+", "+k+", "+H+".xyz, "+j+", vReflectionSize, vReflectionPosition);\r\n",w.compilationString+="    #else\r\n",w.compilationString+="       vec3 "+this._reflectionCoordsName+" = computeCubicCoords("+F+", "+k+", "+H+".xyz, "+j+");\r\n",w.compilationString+="    #endif\r\n",w.compilationString+="#endif\r\n",w.compilationString+="#ifdef "+this._defineProjectionName+"\r\n",w.compilationString+="    vec3 "+this._reflectionCoordsName+" = computeProjectionCoords("+F+", "+X+", "+j+");\r\n",w.compilationString+="#endif\r\n",w.compilationString+="#ifdef "+this._defineSkyboxName+"\r\n",w.compilationString+="    vec3 "+this._reflectionCoordsName+" = computeSkyBoxCoords("+G+", "+j+");\r\n",w.compilationString+="#endif\r\n",w.compilationString+="#ifdef "+this._defineExplicitName+"\r\n",w.compilationString+="    vec3 "+this._reflectionCoordsName+" = vec3(0, 0, 0);\r\n",w.compilationString+="#endif\r\n",w.compilationString+="#ifdef "+this._define3DName+"\r\n",w.compilationString+=this._reflectionColorName+" = textureCube("+this._cubeSamplerName+", "+this._reflectionCoordsName+").rgb;\r\n",w.compilationString+="#else\r\n",w.compilationString+="vec2 "+this._reflection2DCoordsName+" = "+this._reflectionCoordsName+".xy;\r\n",w.compilationString+="#ifdef "+this._defineProjectionName+"\r\n",w.compilationString+=this._reflection2DCoordsName+" /= "+this._reflectionCoordsName+".z;\r\n",w.compilationString+="#endif\r\n",w.compilationString+=this._reflection2DCoordsName+".y = 1.0 - "+this._reflection2DCoordsName+".y;\r\n",w.compilationString+=this._reflectionColorName+" = texture2D("+this._2DSamplerName+", "+this._reflection2DCoordsName+").rgb;\r\n",w.compilationString+="#endif\r\n";for(var q=0,Z=this._outputs;q<Z.length;q++)(te=Z[q]).hasEndpoints&&this._writeOutput(w,te,te.name);return this}if(w.target===_u.Fragment)for(var J=0,$=this._outputs;J<$.length;J++){var te;(te=$[J]).hasEndpoints&&(w.compilationString+=this._declareOutput(te,w)+" = vec3(0.)."+te.name+";\r\n")}},t.prototype._dumpPropertiesCode=function(){return this.texture?(D=this.texture.isCube?this._codeVariableName+'.texture = new BABYLON.CubeTexture("'+this.texture.name+'");\r\n':this._codeVariableName+'.texture = new BABYLON.Texture("'+this.texture.name+'");\r\n',D+=this._codeVariableName+".texture.coordinatesMode = "+this.texture.coordinatesMode+";\r\n"):"";var D},t.prototype.serialize=function(){var w=D.prototype.serialize.call(this);return this.texture&&(w.texture=this.texture.serialize()),w},t.prototype._deserialize=function(w,N,F){D.prototype._deserialize.call(this,w,N,F),w.texture&&(F=0===w.texture.url.indexOf("data:")?"":F,w.texture.isCube?this.texture=Vo.Parse(w.texture,N,F):this.texture=Jt.a.Parse(w.texture,N,F))},t}(Ru);H.a.RegisteredTypes["BABYLON.ReflectionTextureBlock"]=$u;var el=function(D){function t(w){var N=D.call(this,w,_u.Neutral)||this;return N.registerInput("left",mu.AutoDetect),N.registerInput("right",mu.AutoDetect),N.registerOutput("output",mu.BasedOnInput),N._outputs[0]._typeConnectionSource=N._inputs[0],N._linkConnectionTypes(0,1),N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"MultiplyBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),t.prototype._buildBlock=function(w){D.prototype._buildBlock.call(this,w);var N=this._outputs[0];return w.compilationString+=this._declareOutput(N,w)+" = "+this.left.associatedVariableName+" * "+this.right.associatedVariableName+";\r\n",this},t}(Ru);H.a.RegisteredTypes["BABYLON.MultiplyBlock"]=el;var tl=function(D){function t(w){var N=D.call(this,w,_u.Neutral)||this;return N.registerInput("left",mu.AutoDetect),N.registerInput("right",mu.AutoDetect),N.registerOutput("output",mu.BasedOnInput),N._outputs[0]._typeConnectionSource=N._inputs[0],N._linkConnectionTypes(0,1),N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"AddBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),t.prototype._buildBlock=function(w){D.prototype._buildBlock.call(this,w);var N=this._outputs[0];return w.compilationString+=this._declareOutput(N,w)+" = "+this.left.associatedVariableName+" + "+this.right.associatedVariableName+";\r\n",this},t}(Ru);H.a.RegisteredTypes["BABYLON.AddBlock"]=tl;var nl=function(D){function t(w){var N=D.call(this,w,_u.Neutral)||this;return N.registerInput("input",mu.AutoDetect),N.registerInput("factor",mu.Float),N.registerOutput("output",mu.BasedOnInput),N._outputs[0]._typeConnectionSource=N._inputs[0],N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"ScaleBlock"},Object.defineProperty(t.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"factor",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),t.prototype._buildBlock=function(w){D.prototype._buildBlock.call(this,w);var N=this._outputs[0];return w.compilationString+=this._declareOutput(N,w)+" = "+this.input.associatedVariableName+" * "+this.factor.associatedVariableName+";\r\n",this},t}(Ru);H.a.RegisteredTypes["BABYLON.ScaleBlock"]=nl;var il=function(D){function t(w){var N=D.call(this,w,_u.Neutral)||this;return N.minimum=0,N.maximum=1,N.registerInput("value",mu.AutoDetect),N.registerOutput("output",mu.BasedOnInput),N._outputs[0]._typeConnectionSource=N._inputs[0],N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"ClampBlock"},Object.defineProperty(t.prototype,"value",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),t.prototype._buildBlock=function(w){D.prototype._buildBlock.call(this,w);var N=this._outputs[0];return w.compilationString+=this._declareOutput(N,w)+" = clamp("+this.value.associatedVariableName+", "+this._writeFloat(this.minimum)+", "+this._writeFloat(this.maximum)+");\r\n",this},t.prototype._dumpPropertiesCode=function(){return this._codeVariableName+".minimum = "+this.minimum+";\r\n"+this._codeVariableName+".maximum = "+this.maximum+";\r\n"},t.prototype.serialize=function(){var w=D.prototype.serialize.call(this);return w.minimum=this.minimum,w.maximum=this.maximum,w},t.prototype._deserialize=function(w,N,F){D.prototype._deserialize.call(this,w,N,F),this.minimum=w.minimum,this.maximum=w.maximum},t}(Ru);H.a.RegisteredTypes["BABYLON.ClampBlock"]=il;var rl=function(D){function t(w){var N=D.call(this,w,_u.Neutral)||this;return N.registerInput("left",mu.AutoDetect),N.registerInput("right",mu.AutoDetect),N.registerOutput("output",mu.Vector3),N._linkConnectionTypes(0,1),N._inputs[0].excludedConnectionPointTypes.push(mu.Float),N._inputs[0].excludedConnectionPointTypes.push(mu.Matrix),N._inputs[0].excludedConnectionPointTypes.push(mu.Vector2),N._inputs[1].excludedConnectionPointTypes.push(mu.Float),N._inputs[1].excludedConnectionPointTypes.push(mu.Matrix),N._inputs[1].excludedConnectionPointTypes.push(mu.Vector2),N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"CrossBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),t.prototype._buildBlock=function(w){D.prototype._buildBlock.call(this,w);var N=this._outputs[0];return w.compilationString+=this._declareOutput(N,w)+" = cross("+this.left.associatedVariableName+".xyz, "+this.right.associatedVariableName+".xyz);\r\n",this},t}(Ru);H.a.RegisteredTypes["BABYLON.CrossBlock"]=rl;var ol=function(D){function t(w){var N=D.call(this,w,_u.Neutral)||this;return N.registerInput("left",mu.AutoDetect),N.registerInput("right",mu.AutoDetect),N.registerOutput("output",mu.Float),N._linkConnectionTypes(0,1),N._inputs[0].excludedConnectionPointTypes.push(mu.Float),N._inputs[0].excludedConnectionPointTypes.push(mu.Matrix),N._inputs[1].excludedConnectionPointTypes.push(mu.Float),N._inputs[1].excludedConnectionPointTypes.push(mu.Matrix),N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"DotBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),t.prototype._buildBlock=function(w){D.prototype._buildBlock.call(this,w);var N=this._outputs[0];return w.compilationString+=this._declareOutput(N,w)+" = dot("+this.left.associatedVariableName+", "+this.right.associatedVariableName+");\r\n",this},t}(Ru);H.a.RegisteredTypes["BABYLON.DotBlock"]=ol;var al=function(D){function t(w){var N=D.call(this,w,_u.Neutral)||this;return N.sourceRange=new z.d(-1,1),N.targetRange=new z.d(0,1),N.registerInput("input",mu.AutoDetect),N.registerInput("sourceMin",mu.Float,!0),N.registerInput("sourceMax",mu.Float,!0),N.registerInput("targetMin",mu.Float,!0),N.registerInput("targetMax",mu.Float,!0),N.registerOutput("output",mu.BasedOnInput),N._outputs[0]._typeConnectionSource=N._inputs[0],N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"RemapBlock"},Object.defineProperty(t.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sourceMin",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sourceMax",{get:function(){return this._inputs[2]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"targetMin",{get:function(){return this._inputs[3]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"targetMax",{get:function(){return this._inputs[4]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),t.prototype._buildBlock=function(w){D.prototype._buildBlock.call(this,w);var N=this._outputs[0],F=this.sourceMin.isConnected?this.sourceMin.associatedVariableName:this._writeFloat(this.sourceRange.x),k=this.sourceMax.isConnected?this.sourceMax.associatedVariableName:this._writeFloat(this.sourceRange.y),j=this.targetMin.isConnected?this.targetMin.associatedVariableName:this._writeFloat(this.targetRange.x),z=this.targetMax.isConnected?this.targetMax.associatedVariableName:this._writeFloat(this.targetRange.y);return w.compilationString+=this._declareOutput(N,w)+" = "+j+" + ("+this._inputs[0].associatedVariableName+" - "+F+") * ("+z+" - "+j+") / ("+k+" - "+F+");\r\n",this},t.prototype._dumpPropertiesCode=function(){return this._codeVariableName+".sourceRange = new BABYLON.Vector2("+this.sourceRange.x+", "+this.sourceRange.y+");\r\n"+this._codeVariableName+".targetRange = new BABYLON.Vector2("+this.targetRange.x+", "+this.targetRange.y+");\r\n"},t.prototype.serialize=function(){var w=D.prototype.serialize.call(this);return w.sourceRange=this.sourceRange.asArray(),w.targetRange=this.targetRange.asArray(),w},t.prototype._deserialize=function(w,N,F){D.prototype._deserialize.call(this,w,N,F),this.sourceRange=z.d.FromArray(w.sourceRange),this.targetRange=z.d.FromArray(w.targetRange)},t}(Ru);H.a.RegisteredTypes["BABYLON.RemapBlock"]=al;var sl,cl=function(D){function t(w){var N=D.call(this,w,_u.Neutral)||this;return N.registerInput("input",mu.AutoDetect),N.registerOutput("output",mu.BasedOnInput),N._outputs[0]._typeConnectionSource=N._inputs[0],N._inputs[0].excludedConnectionPointTypes.push(mu.Float),N._inputs[0].excludedConnectionPointTypes.push(mu.Matrix),N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"NormalizeBlock"},Object.defineProperty(t.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),t.prototype._buildBlock=function(w){D.prototype._buildBlock.call(this,w);var N=this._outputs[0],F=this._inputs[0];return w.compilationString+=this._declareOutput(N,w)+" = normalize("+F.associatedVariableName+");\r\n",this},t}(Ru);H.a.RegisteredTypes["BABYLON.NormalizeBlock"]=cl,function(D){D[D.Cos=0]="Cos",D[D.Sin=1]="Sin",D[D.Abs=2]="Abs",D[D.Exp=3]="Exp",D[D.Exp2=4]="Exp2",D[D.Round=5]="Round",D[D.Floor=6]="Floor",D[D.Ceiling=7]="Ceiling",D[D.Sqrt=8]="Sqrt",D[D.Log=9]="Log",D[D.Tan=10]="Tan",D[D.ArcTan=11]="ArcTan",D[D.ArcCos=12]="ArcCos",D[D.ArcSin=13]="ArcSin",D[D.Fract=14]="Fract",D[D.Sign=15]="Sign",D[D.Radians=16]="Radians",D[D.Degrees=17]="Degrees"}(sl||(sl={}));var ul=function(D){function t(w){var N=D.call(this,w,_u.Neutral)||this;return N.operation=sl.Cos,N.registerInput("input",mu.AutoDetect),N.registerOutput("output",mu.BasedOnInput),N._outputs[0]._typeConnectionSource=N._inputs[0],N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"TrigonometryBlock"},Object.defineProperty(t.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),t.prototype._buildBlock=function(w){D.prototype._buildBlock.call(this,w);var N=this._outputs[0],F="";switch(this.operation){case sl.Cos:F="cos";break;case sl.Sin:F="sin";break;case sl.Abs:F="abs";break;case sl.Exp:F="exp";break;case sl.Exp2:F="exp2";break;case sl.Round:F="round";break;case sl.Floor:F="floor";break;case sl.Ceiling:F="ceil";break;case sl.Sqrt:F="sqrt";break;case sl.Log:F="log";break;case sl.Tan:F="tan";break;case sl.ArcTan:F="atan";break;case sl.ArcCos:F="acos";break;case sl.ArcSin:F="asin";break;case sl.Fract:F="fract";break;case sl.Sign:F="sign";break;case sl.Radians:F="radians";break;case sl.Degrees:F="degrees"}return w.compilationString+=this._declareOutput(N,w)+" = "+F+"("+this.input.associatedVariableName+");\r\n",this},t.prototype.serialize=function(){var w=D.prototype.serialize.call(this);return w.operation=this.operation,w},t.prototype._deserialize=function(w,N,F){D.prototype._deserialize.call(this,w,N,F),this.operation=w.operation},t.prototype._dumpPropertiesCode=function(){return this._codeVariableName+".operation = BABYLON.TrigonometryBlockOperations."+sl[this.operation]+";\r\n"},t}(Ru);H.a.RegisteredTypes["BABYLON.TrigonometryBlock"]=ul;var ll=function(D){function t(w){var N=D.call(this,w,_u.Neutral)||this;return N.registerInput("rgb ",mu.Color3,!0),N.registerInput("r",mu.Float,!0),N.registerInput("g",mu.Float,!0),N.registerInput("b",mu.Float,!0),N.registerInput("a",mu.Float,!0),N.registerOutput("rgba",mu.Color4),N.registerOutput("rgb",mu.Color3),N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"ColorMergerBlock"},Object.defineProperty(t.prototype,"rgbIn",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"r",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"g",{get:function(){return this._inputs[2]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"b",{get:function(){return this._inputs[3]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"a",{get:function(){return this._inputs[4]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rgba",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rgbOut",{get:function(){return this._outputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rgb",{get:function(){return this.rgbOut},enumerable:!0,configurable:!0}),t.prototype._buildBlock=function(w){D.prototype._buildBlock.call(this,w);var N=this.r,F=this.g,k=this.b,j=this.a,z=this.rgbIn,G=this._outputs[0],H=this._outputs[1];return z.isConnected?G.hasEndpoints?w.compilationString+=this._declareOutput(G,w)+" = vec4("+z.associatedVariableName+", "+(j.isConnected?this._writeVariable(j):"0.0")+");\r\n":H.hasEndpoints&&(w.compilationString+=this._declareOutput(H,w)+" = "+z.associatedVariableName+";\r\n"):G.hasEndpoints?w.compilationString+=this._declareOutput(G,w)+" = vec4("+(N.isConnected?this._writeVariable(N):"0.0")+", "+(F.isConnected?this._writeVariable(F):"0.0")+", "+(k.isConnected?this._writeVariable(k):"0.0")+", "+(j.isConnected?this._writeVariable(j):"0.0")+");\r\n":H.hasEndpoints&&(w.compilationString+=this._declareOutput(H,w)+" = vec3("+(N.isConnected?this._writeVariable(N):"0.0")+", "+(F.isConnected?this._writeVariable(F):"0.0")+", "+(k.isConnected?this._writeVariable(k):"0.0")+");\r\n"),this},t}(Ru);H.a.RegisteredTypes["BABYLON.ColorMergerBlock"]=ll;var hl=function(D){function t(w){var N=D.call(this,w,_u.Neutral)||this;return N.registerInput("xyz ",mu.Vector3,!0),N.registerInput("xy ",mu.Vector2,!0),N.registerInput("x",mu.Float,!0),N.registerInput("y",mu.Float,!0),N.registerInput("z",mu.Float,!0),N.registerInput("w",mu.Float,!0),N.registerOutput("xyzw",mu.Vector4),N.registerOutput("xyz",mu.Vector3),N.registerOutput("xy",mu.Vector2),N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"VectorMergerBlock"},Object.defineProperty(t.prototype,"xyzIn",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"xyIn",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this._inputs[2]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._inputs[3]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"z",{get:function(){return this._inputs[4]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"w",{get:function(){return this._inputs[5]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"xyzw",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"xyzOut",{get:function(){return this._outputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"xyOut",{get:function(){return this._outputs[2]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"xy",{get:function(){return this.xyOut},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"xyz",{get:function(){return this.xyzOut},enumerable:!0,configurable:!0}),t.prototype._buildBlock=function(w){D.prototype._buildBlock.call(this,w);var N=this.x,F=this.y,k=this.z,j=this.w,z=this.xyIn,G=this.xyzIn,H=this._outputs[0],X=this._outputs[1],q=this._outputs[2];return z.isConnected?H.hasEndpoints?w.compilationString+=this._declareOutput(H,w)+" = vec4("+z.associatedVariableName+", "+(k.isConnected?this._writeVariable(k):"0.0")+", "+(j.isConnected?this._writeVariable(j):"0.0")+");\r\n":X.hasEndpoints?w.compilationString+=this._declareOutput(X,w)+" = vec3("+z.associatedVariableName+", "+(k.isConnected?this._writeVariable(k):"0.0")+");\r\n":q.hasEndpoints&&(w.compilationString+=this._declareOutput(q,w)+" = "+z.associatedVariableName+";\r\n"):G.isConnected?H.hasEndpoints?w.compilationString+=this._declareOutput(H,w)+" = vec4("+G.associatedVariableName+", "+(j.isConnected?this._writeVariable(j):"0.0")+");\r\n":X.hasEndpoints?w.compilationString+=this._declareOutput(X,w)+" = "+G.associatedVariableName+";\r\n":q.hasEndpoints&&(w.compilationString+=this._declareOutput(q,w)+" = "+G.associatedVariableName+".xy;\r\n"):H.hasEndpoints?w.compilationString+=this._declareOutput(H,w)+" = vec4("+(N.isConnected?this._writeVariable(N):"0.0")+", "+(F.isConnected?this._writeVariable(F):"0.0")+", "+(k.isConnected?this._writeVariable(k):"0.0")+", "+(j.isConnected?this._writeVariable(j):"0.0")+");\r\n":X.hasEndpoints?w.compilationString+=this._declareOutput(X,w)+" = vec3("+(N.isConnected?this._writeVariable(N):"0.0")+", "+(F.isConnected?this._writeVariable(F):"0.0")+", "+(k.isConnected?this._writeVariable(k):"0.0")+");\r\n":q.hasEndpoints&&(w.compilationString+=this._declareOutput(q,w)+" = vec2("+(N.isConnected?this._writeVariable(N):"0.0")+", "+(F.isConnected?this._writeVariable(F):"0.0")+");\r\n"),this},t}(Ru);H.a.RegisteredTypes["BABYLON.VectorMergerBlock"]=hl;var dl=function(D){function t(w){var N=D.call(this,w,_u.Neutral)||this;return N.registerInput("rgba",mu.Color4,!0),N.registerInput("rgb ",mu.Color3,!0),N.registerOutput("rgb",mu.Color3),N.registerOutput("r",mu.Float),N.registerOutput("g",mu.Float),N.registerOutput("b",mu.Float),N.registerOutput("a",mu.Float),N.inputsAreExclusive=!0,N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"ColorSplitterBlock"},Object.defineProperty(t.prototype,"rgba",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rgbIn",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rgbOut",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"r",{get:function(){return this._outputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"g",{get:function(){return this._outputs[2]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"b",{get:function(){return this._outputs[3]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"a",{get:function(){return this._outputs[4]},enumerable:!0,configurable:!0}),t.prototype._inputRename=function(D){return"rgb "===D?"rgbIn":D},t.prototype._outputRename=function(D){return"rgb"===D?"rgbOut":D},t.prototype._buildBlock=function(w){D.prototype._buildBlock.call(this,w);var N=this.rgba.isConnected?this.rgba:this.rgbIn;if(N.isConnected){var F=this._outputs[0],k=this._outputs[1],j=this._outputs[2],z=this._outputs[3],G=this._outputs[4];return F.hasEndpoints&&(w.compilationString+=this._declareOutput(F,w)+" = "+N.associatedVariableName+".rgb;\r\n"),k.hasEndpoints&&(w.compilationString+=this._declareOutput(k,w)+" = "+N.associatedVariableName+".r;\r\n"),j.hasEndpoints&&(w.compilationString+=this._declareOutput(j,w)+" = "+N.associatedVariableName+".g;\r\n"),z.hasEndpoints&&(w.compilationString+=this._declareOutput(z,w)+" = "+N.associatedVariableName+".b;\r\n"),G.hasEndpoints&&(w.compilationString+=this._declareOutput(G,w)+" = "+N.associatedVariableName+".a;\r\n"),this}},t}(Ru);H.a.RegisteredTypes["BABYLON.ColorSplitterBlock"]=dl;var fl=function(D){function t(w){var N=D.call(this,w,_u.Neutral)||this;return N.registerInput("xyzw",mu.Vector4,!0),N.registerInput("xyz ",mu.Vector3,!0),N.registerInput("xy ",mu.Vector2,!0),N.registerOutput("xyz",mu.Vector3),N.registerOutput("xy",mu.Vector2),N.registerOutput("x",mu.Float),N.registerOutput("y",mu.Float),N.registerOutput("z",mu.Float),N.registerOutput("w",mu.Float),N.inputsAreExclusive=!0,N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"VectorSplitterBlock"},Object.defineProperty(t.prototype,"xyzw",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"xyzIn",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"xyIn",{get:function(){return this._inputs[2]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"xyzOut",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"xyOut",{get:function(){return this._outputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this._outputs[2]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._outputs[3]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"z",{get:function(){return this._outputs[4]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"w",{get:function(){return this._outputs[5]},enumerable:!0,configurable:!0}),t.prototype._inputRename=function(D){switch(D){case"xy ":return"xyIn";case"xyz ":return"xyzIn";default:return D}},t.prototype._outputRename=function(D){switch(D){case"xy":return"xyOut";case"xyz":return"xyzOut";default:return D}},t.prototype._buildBlock=function(w){D.prototype._buildBlock.call(this,w);var N=this.xyzw.isConnected?this.xyzw:this.xyzIn.isConnected?this.xyzIn:this.xyIn,F=this._outputs[0],k=this._outputs[1],j=this._outputs[2],z=this._outputs[3],G=this._outputs[4],H=this._outputs[5];return F.hasEndpoints&&(N===this.xyIn?w.compilationString+=this._declareOutput(F,w)+" = vec3("+N.associatedVariableName+", 0.0);\r\n":w.compilationString+=this._declareOutput(F,w)+" = "+N.associatedVariableName+".xyz;\r\n"),k.hasEndpoints&&(w.compilationString+=this._declareOutput(k,w)+" = "+N.associatedVariableName+".xy;\r\n"),j.hasEndpoints&&(w.compilationString+=this._declareOutput(j,w)+" = "+N.associatedVariableName+".x;\r\n"),z.hasEndpoints&&(w.compilationString+=this._declareOutput(z,w)+" = "+N.associatedVariableName+".y;\r\n"),G.hasEndpoints&&(w.compilationString+=this._declareOutput(G,w)+" = "+N.associatedVariableName+".z;\r\n"),H.hasEndpoints&&(w.compilationString+=this._declareOutput(H,w)+" = "+N.associatedVariableName+".w;\r\n"),this},t}(Ru);H.a.RegisteredTypes["BABYLON.VectorSplitterBlock"]=fl;var pl=function(D){function t(w){var N=D.call(this,w,_u.Neutral)||this;return N.registerInput("left",mu.AutoDetect),N.registerInput("right",mu.AutoDetect),N.registerInput("gradient",mu.Float),N.registerOutput("output",mu.BasedOnInput),N._outputs[0]._typeConnectionSource=N._inputs[0],N._linkConnectionTypes(0,1),N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"LerpBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gradient",{get:function(){return this._inputs[2]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),t.prototype._buildBlock=function(w){D.prototype._buildBlock.call(this,w);var N=this._outputs[0];return w.compilationString+=this._declareOutput(N,w)+" = mix("+this.left.associatedVariableName+" , "+this.right.associatedVariableName+", "+this.gradient.associatedVariableName+");\r\n",this},t}(Ru);H.a.RegisteredTypes["BABYLON.LerpBlock"]=pl;var _l=function(D){function t(w){var N=D.call(this,w,_u.Neutral)||this;return N.registerInput("left",mu.AutoDetect),N.registerInput("right",mu.AutoDetect),N.registerOutput("output",mu.BasedOnInput),N._outputs[0]._typeConnectionSource=N._inputs[0],N._linkConnectionTypes(0,1),N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"DivideBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),t.prototype._buildBlock=function(w){D.prototype._buildBlock.call(this,w);var N=this._outputs[0];return w.compilationString+=this._declareOutput(N,w)+" = "+this.left.associatedVariableName+" / "+this.right.associatedVariableName+";\r\n",this},t}(Ru);H.a.RegisteredTypes["BABYLON.DivideBlock"]=_l;var ml=function(D){function t(w){var N=D.call(this,w,_u.Neutral)||this;return N.registerInput("left",mu.AutoDetect),N.registerInput("right",mu.AutoDetect),N.registerOutput("output",mu.BasedOnInput),N._outputs[0]._typeConnectionSource=N._inputs[0],N._linkConnectionTypes(0,1),N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"SubtractBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),t.prototype._buildBlock=function(w){D.prototype._buildBlock.call(this,w);var N=this._outputs[0];return w.compilationString+=this._declareOutput(N,w)+" = "+this.left.associatedVariableName+" - "+this.right.associatedVariableName+";\r\n",this},t}(Ru);H.a.RegisteredTypes["BABYLON.SubtractBlock"]=ml;var gl=function(D){function t(w){var N=D.call(this,w,_u.Neutral)||this;return N.registerInput("value",mu.Float),N.registerInput("edge",mu.Float),N.registerOutput("output",mu.Float),N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"StepBlock"},Object.defineProperty(t.prototype,"value",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"edge",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),t.prototype._buildBlock=function(w){D.prototype._buildBlock.call(this,w);var N=this._outputs[0];return w.compilationString+=this._declareOutput(N,w)+" = step("+this.edge.associatedVariableName+", "+this.value.associatedVariableName+");\r\n",this},t}(Ru);H.a.RegisteredTypes["BABYLON.StepBlock"]=gl;var vl=function(D){function t(w){var N=D.call(this,w,_u.Neutral)||this;return N.registerInput("input",mu.AutoDetect),N.registerOutput("output",mu.BasedOnInput),N._outputs[0]._typeConnectionSource=N._inputs[0],N._outputs[0].excludedConnectionPointTypes.push(mu.Matrix),N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"OneMinusBlock"},Object.defineProperty(t.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),t.prototype._buildBlock=function(w){D.prototype._buildBlock.call(this,w);var N=this._outputs[0];return w.compilationString+=this._declareOutput(N,w)+" = 1. - "+this.input.associatedVariableName+";\r\n",this},t}(Ru);H.a.RegisteredTypes["BABYLON.OneMinusBlock"]=vl,H.a.RegisteredTypes["BABYLON.OppositeBlock"]=vl;var yl=function(D){function t(w){var N=D.call(this,w,_u.Neutral)||this;return N.registerInput("worldPosition",mu.Vector4),N.registerInput("cameraPosition",mu.Vector3),N.registerOutput("output",mu.Vector3),N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"ViewDirectionBlock"},Object.defineProperty(t.prototype,"worldPosition",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraPosition",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),t.prototype.autoConfigure=function(D){if(!this.cameraPosition.isConnected){var w=D.getInputBlockByPredicate((function(D){return D.systemValue===yu.CameraPosition}));w||(w=new Bu("cameraPosition")).setAsSystemValue(yu.CameraPosition),w.output.connectTo(this.cameraPosition)}},t.prototype._buildBlock=function(w){D.prototype._buildBlock.call(this,w);var N=this._outputs[0];return w.compilationString+=this._declareOutput(N,w)+" = normalize("+this.cameraPosition.associatedVariableName+" - "+this.worldPosition.associatedVariableName+".xyz);\r\n",this},t}(Ru);H.a.RegisteredTypes["BABYLON.ViewDirectionBlock"]=yl,N(145);var bl=function(D){function t(w){var N=D.call(this,w,_u.Neutral)||this;return N.registerInput("worldNormal",mu.Vector4),N.registerInput("viewDirection",mu.Vector3),N.registerInput("bias",mu.Float),N.registerInput("power",mu.Float),N.registerOutput("fresnel",mu.Float),N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"FresnelBlock"},Object.defineProperty(t.prototype,"worldNormal",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"viewDirection",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bias",{get:function(){return this._inputs[2]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"power",{get:function(){return this._inputs[3]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fresnel",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),t.prototype.autoConfigure=function(D){if(!this.viewDirection.isConnected){var w=new yl("View direction");w.output.connectTo(this.viewDirection),w.autoConfigure(D)}if(!this.bias.isConnected){var N=new Bu("bias");N.value=0,N.output.connectTo(this.bias)}if(!this.power.isConnected){var F=new Bu("power");F.value=1,F.output.connectTo(this.power)}},t.prototype._buildBlock=function(w){D.prototype._buildBlock.call(this,w);var N="//"+this.name;return w._emitFunctionFromInclude("fresnelFunction",N,{removeIfDef:!0}),w.compilationString+=this._declareOutput(this.fresnel,w)+" = computeFresnelTerm("+this.viewDirection.associatedVariableName+".xyz, "+this.worldNormal.associatedVariableName+".xyz, "+this.bias.associatedVariableName+", "+this.power.associatedVariableName+");\r\n",this},t}(Ru);H.a.RegisteredTypes["BABYLON.FresnelBlock"]=bl;var Tl=function(D){function t(w){var N=D.call(this,w,_u.Neutral)||this;return N.registerInput("left",mu.AutoDetect),N.registerInput("right",mu.AutoDetect),N.registerOutput("output",mu.BasedOnInput),N._outputs[0]._typeConnectionSource=N._inputs[0],N._linkConnectionTypes(0,1),N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"MaxBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),t.prototype._buildBlock=function(w){D.prototype._buildBlock.call(this,w);var N=this._outputs[0];return w.compilationString+=this._declareOutput(N,w)+" = max("+this.left.associatedVariableName+", "+this.right.associatedVariableName+");\r\n",this},t}(Ru);H.a.RegisteredTypes["BABYLON.MaxBlock"]=Tl;var El=function(D){function t(w){var N=D.call(this,w,_u.Neutral)||this;return N.registerInput("left",mu.AutoDetect),N.registerInput("right",mu.AutoDetect),N.registerOutput("output",mu.BasedOnInput),N._outputs[0]._typeConnectionSource=N._inputs[0],N._linkConnectionTypes(0,1),N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"MinBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),t.prototype._buildBlock=function(w){D.prototype._buildBlock.call(this,w);var N=this._outputs[0];return w.compilationString+=this._declareOutput(N,w)+" = min("+this.left.associatedVariableName+", "+this.right.associatedVariableName+");\r\n",this},t}(Ru);H.a.RegisteredTypes["BABYLON.MinBlock"]=El;var Sl=function(D){function t(w){var N=D.call(this,w,_u.Neutral)||this;return N.registerInput("left",mu.AutoDetect),N.registerInput("right",mu.AutoDetect),N.registerOutput("output",mu.Float),N._linkConnectionTypes(0,1),N._inputs[0].excludedConnectionPointTypes.push(mu.Float),N._inputs[0].excludedConnectionPointTypes.push(mu.Matrix),N._inputs[1].excludedConnectionPointTypes.push(mu.Float),N._inputs[1].excludedConnectionPointTypes.push(mu.Matrix),N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"DistanceBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),t.prototype._buildBlock=function(w){D.prototype._buildBlock.call(this,w);var N=this._outputs[0];return w.compilationString+=this._declareOutput(N,w)+" = length("+this.left.associatedVariableName+" - "+this.right.associatedVariableName+");\r\n",this},t}(Ru);H.a.RegisteredTypes["BABYLON.DistanceBlock"]=Sl;var Ml=function(D){function t(w){var N=D.call(this,w,_u.Neutral)||this;return N.registerInput("value",mu.AutoDetect),N.registerOutput("output",mu.Float),N._inputs[0].excludedConnectionPointTypes.push(mu.Float),N._inputs[0].excludedConnectionPointTypes.push(mu.Matrix),N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"LengthBlock"},Object.defineProperty(t.prototype,"value",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),t.prototype._buildBlock=function(w){D.prototype._buildBlock.call(this,w);var N=this._outputs[0];return w.compilationString+=this._declareOutput(N,w)+" = length("+this.value.associatedVariableName+");\r\n",this},t}(Ru);H.a.RegisteredTypes["BABYLON.LengthBlock"]=Ml;var Al=function(D){function t(w){var N=D.call(this,w,_u.Neutral)||this;return N.registerInput("value",mu.AutoDetect),N.registerOutput("output",mu.BasedOnInput),N._outputs[0]._typeConnectionSource=N._inputs[0],N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"NegateBlock"},Object.defineProperty(t.prototype,"value",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),t.prototype._buildBlock=function(w){D.prototype._buildBlock.call(this,w);var N=this._outputs[0];return w.compilationString+=this._declareOutput(N,w)+" = -1.0 * "+this.value.associatedVariableName+";\r\n",this},t}(Ru);H.a.RegisteredTypes["BABYLON.NegateBlock"]=Al;var Pl=function(D){function t(w){var N=D.call(this,w,_u.Neutral)||this;return N.registerInput("value",mu.Float),N.registerInput("power",mu.Float),N.registerOutput("output",mu.Float),N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"PowBlock"},Object.defineProperty(t.prototype,"value",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"power",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),t.prototype._buildBlock=function(w){D.prototype._buildBlock.call(this,w);var N=this._outputs[0];return w.compilationString+=this._declareOutput(N,w)+" = pow("+this.value.associatedVariableName+", "+this.power.associatedVariableName+");\r\n",this},t}(Ru);H.a.RegisteredTypes["BABYLON.PowBlock"]=Pl;var Cl=function(D){function t(w){var N=D.call(this,w,_u.Neutral)||this;return N.registerInput("seed",mu.Vector2),N.registerOutput("output",mu.Float),N._inputs[0].acceptedConnectionPointTypes.push(mu.Vector3),N._inputs[0].acceptedConnectionPointTypes.push(mu.Vector4),N._inputs[0].acceptedConnectionPointTypes.push(mu.Color3),N._inputs[0].acceptedConnectionPointTypes.push(mu.Color4),N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"RandomNumberBlock"},Object.defineProperty(t.prototype,"seed",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),t.prototype._buildBlock=function(w){D.prototype._buildBlock.call(this,w);var N=this._outputs[0],F="//"+this.name;return w._emitFunctionFromInclude("helperFunctions",F),w.compilationString+=this._declareOutput(N,w)+" = getRand("+this.seed.associatedVariableName+".xy);\r\n",this},t}(Ru);H.a.RegisteredTypes["BABYLON.RandomNumberBlock"]=Cl;var Ol=function(D){function t(w){var N=D.call(this,w,_u.Neutral)||this;return N.registerInput("x",mu.Float),N.registerInput("y",mu.Float),N.registerOutput("output",mu.Float),N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"ArcTan2Block"},Object.defineProperty(t.prototype,"x",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),t.prototype._buildBlock=function(w){D.prototype._buildBlock.call(this,w);var N=this._outputs[0];return w.compilationString+=this._declareOutput(N,w)+" = atan("+this.x.associatedVariableName+", "+this.y.associatedVariableName+");\r\n",this},t}(Ru);H.a.RegisteredTypes["BABYLON.ArcTan2Block"]=Ol;var Rl=function(D){function t(w){var N=D.call(this,w,_u.Neutral)||this;return N.registerInput("value",mu.Float),N.registerInput("edge0",mu.Float),N.registerInput("edge1",mu.Float),N.registerOutput("output",mu.Float),N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"SmoothStepBlock"},Object.defineProperty(t.prototype,"value",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"edge0",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"edge1",{get:function(){return this._inputs[2]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),t.prototype._buildBlock=function(w){D.prototype._buildBlock.call(this,w);var N=this._outputs[0];return w.compilationString+=this._declareOutput(N,w)+" = smoothstep("+this.edge0.associatedVariableName+", "+this.edge1.associatedVariableName+", "+this.value.associatedVariableName+");\r\n",this},t}(Ru);H.a.RegisteredTypes["BABYLON.SmoothStepBlock"]=Rl;var Dl=function(D){function t(w){var N=D.call(this,w,_u.Neutral)||this;return N.registerInput("input",mu.AutoDetect),N.registerOutput("output",mu.BasedOnInput),N._outputs[0]._typeConnectionSource=N._inputs[0],N._outputs[0].excludedConnectionPointTypes.push(mu.Matrix),N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"ReciprocalBlock"},Object.defineProperty(t.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),t.prototype._buildBlock=function(w){D.prototype._buildBlock.call(this,w);var N=this._outputs[0];return w.compilationString+=this._declareOutput(N,w)+" = 1. / "+this.input.associatedVariableName+";\r\n",this},t}(Ru);H.a.RegisteredTypes["BABYLON.ReciprocalBlock"]=Dl;var Il=function(D){function t(w){var N=D.call(this,w,_u.Neutral)||this;return N.registerInput("value",mu.AutoDetect),N.registerInput("reference",mu.AutoDetect),N.registerInput("distance",mu.Float),N.registerInput("replacement",mu.AutoDetect),N.registerOutput("output",mu.BasedOnInput),N._outputs[0]._typeConnectionSource=N._inputs[0],N._linkConnectionTypes(0,1),N._linkConnectionTypes(0,3),N._inputs[0].excludedConnectionPointTypes.push(mu.Float),N._inputs[0].excludedConnectionPointTypes.push(mu.Matrix),N._inputs[1].excludedConnectionPointTypes.push(mu.Float),N._inputs[1].excludedConnectionPointTypes.push(mu.Matrix),N._inputs[3].excludedConnectionPointTypes.push(mu.Float),N._inputs[3].excludedConnectionPointTypes.push(mu.Matrix),N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"ReplaceColorBlock"},Object.defineProperty(t.prototype,"value",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"reference",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"distance",{get:function(){return this._inputs[2]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"replacement",{get:function(){return this._inputs[3]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),t.prototype._buildBlock=function(w){D.prototype._buildBlock.call(this,w);var N=this._outputs[0];return w.compilationString+=this._declareOutput(N,w)+";\r\n",w.compilationString+="if (length("+this.value.associatedVariableName+" - "+this.reference.associatedVariableName+") < "+this.distance.associatedVariableName+") {\r\n",w.compilationString+=N.associatedVariableName+" = "+this.replacement.associatedVariableName+";\r\n",w.compilationString+="} else {\r\n",w.compilationString+=N.associatedVariableName+" = "+this.value.associatedVariableName+";\r\n",w.compilationString+="}\r\n",this},t}(Ru);H.a.RegisteredTypes["BABYLON.ReplaceColorBlock"]=Il;var Ll,wl=function(D){function t(w){var N=D.call(this,w,_u.Neutral)||this;return N.registerInput("value",mu.AutoDetect),N.registerInput("steps",mu.AutoDetect),N.registerOutput("output",mu.BasedOnInput),N._outputs[0]._typeConnectionSource=N._inputs[0],N._linkConnectionTypes(0,1),N._inputs[0].excludedConnectionPointTypes.push(mu.Matrix),N._inputs[1].excludedConnectionPointTypes.push(mu.Matrix),N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"PosterizeBlock"},Object.defineProperty(t.prototype,"value",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"steps",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),t.prototype._buildBlock=function(w){D.prototype._buildBlock.call(this,w);var N=this._outputs[0];return w.compilationString+=this._declareOutput(N,w)+" = floor("+this.value.associatedVariableName+" / (1.0 / "+this.steps.associatedVariableName+")) * (1.0 / "+this.steps.associatedVariableName+");\r\n",this},t}(Ru);H.a.RegisteredTypes["BABYLON.PosterizeBlock"]=wl,function(D){D[D.SawTooth=0]="SawTooth",D[D.Square=1]="Square",D[D.Triangle=2]="Triangle"}(Ll||(Ll={}));var Nl=function(D){function t(w){var N=D.call(this,w,_u.Neutral)||this;return N.kind=Ll.SawTooth,N.registerInput("input",mu.AutoDetect),N.registerOutput("output",mu.BasedOnInput),N._outputs[0]._typeConnectionSource=N._inputs[0],N._inputs[0].excludedConnectionPointTypes.push(mu.Matrix),N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"WaveBlock"},Object.defineProperty(t.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),t.prototype._buildBlock=function(w){D.prototype._buildBlock.call(this,w);var N=this._outputs[0];switch(this.kind){case Ll.SawTooth:w.compilationString+=this._declareOutput(N,w)+" = "+this.input.associatedVariableName+" - floor(0.5 + "+this.input.associatedVariableName+");\r\n";break;case Ll.Square:w.compilationString+=this._declareOutput(N,w)+" = 1.0 - 2.0 * round(fract("+this.input.associatedVariableName+"));\r\n";break;case Ll.Triangle:w.compilationString+=this._declareOutput(N,w)+" = 2.0 * abs(2.0 * ("+this.input.associatedVariableName+" - floor(0.5 + "+this.input.associatedVariableName+"))) - 1.0;\r\n"}return this},t.prototype.serialize=function(){var w=D.prototype.serialize.call(this);return w.kind=this.kind,w},t.prototype._deserialize=function(w,N,F){D.prototype._deserialize.call(this,w,N,F),this.kind=w.kind},t}(Ru);H.a.RegisteredTypes["BABYLON.WaveBlock"]=Nl;var xl=function(D,w){this.step=D,this.color=w},Fl=function(D){function t(w){var N=D.call(this,w,_u.Neutral)||this;return N.colorSteps=[new xl(0,G.a.Black()),new xl(1,G.a.White())],N.registerInput("gradient",mu.Float),N.registerOutput("output",mu.Color3),N._inputs[0].acceptedConnectionPointTypes.push(mu.Vector2),N._inputs[0].acceptedConnectionPointTypes.push(mu.Vector3),N._inputs[0].acceptedConnectionPointTypes.push(mu.Vector4),N._inputs[0].acceptedConnectionPointTypes.push(mu.Color3),N._inputs[0].acceptedConnectionPointTypes.push(mu.Color4),N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"GradientBlock"},Object.defineProperty(t.prototype,"gradient",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),t.prototype._writeColorConstant=function(D){var w=this.colorSteps[D];return"vec3("+w.color.r+", "+w.color.g+", "+w.color.b+")"},t.prototype._buildBlock=function(w){D.prototype._buildBlock.call(this,w);var N=this._outputs[0];if(this.colorSteps.length&&this.gradient.connectedPoint){var F=w._getFreeVariableName("gradientTempColor"),k=w._getFreeVariableName("gradientTempPosition");w.compilationString+="vec3 "+F+" = "+this._writeColorConstant(0)+";\r\n",w.compilationString+="float "+k+";\r\n";var j=this.gradient.associatedVariableName;this.gradient.connectedPoint.type!==mu.Float&&(j+=".x");for(var z=1;z<this.colorSteps.length;z++){var G=this.colorSteps[z],H=this.colorSteps[z-1];w.compilationString+=k+" = clamp(("+j+" - "+w._emitFloat(H.step)+") / ("+w._emitFloat(G.step)+" -  "+w._emitFloat(H.step)+"), 0.0, 1.0) * step("+w._emitFloat(z)+", "+w._emitFloat(this.colorSteps.length-1)+");\r\n",w.compilationString+=F+" = mix("+F+", "+this._writeColorConstant(z)+", "+k+");\r\n"}return w.compilationString+=this._declareOutput(N,w)+" = "+F+";\r\n",this}w.compilationString+=this._declareOutput(N,w)+" = vec3(0., 0., 0.);\r\n"},t.prototype.serialize=function(){var w=D.prototype.serialize.call(this);return w.colorSteps=this.colorSteps,w},t.prototype._deserialize=function(w,N,F){D.prototype._deserialize.call(this,w,N,F),this.colorSteps=[];for(var k=0,j=w.colorSteps;k<j.length;k++){var z=j[k];this.colorSteps.push(new xl(z.step,new G.a(z.color.r,z.color.g,z.color.b)))}},t.prototype._dumpPropertiesCode=function(){for(var D="",w=0,N=this.colorSteps;w<N.length;w++){var F=N[w];D+=this._codeVariableName+".colorSteps.push(new BABYLON.GradientBlockColorStep("+F.step+", new BABYLON.Color3("+F.color.r+", "+F.color.g+", "+F.color.b+")));\r\n"}return D},t}(Ru);H.a.RegisteredTypes["BABYLON.GradientBlock"]=Fl;var kl=function(D){function t(w){var N=D.call(this,w,_u.Neutral)||this;return N.registerInput("left",mu.AutoDetect),N.registerInput("right",mu.AutoDetect),N.registerInput("gradient",mu.Float),N.registerOutput("output",mu.BasedOnInput),N._outputs[0]._typeConnectionSource=N._inputs[0],N._linkConnectionTypes(0,1),N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"NLerpBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gradient",{get:function(){return this._inputs[2]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),t.prototype._buildBlock=function(w){D.prototype._buildBlock.call(this,w);var N=this._outputs[0];return w.compilationString+=this._declareOutput(N,w)+" = normalize(mix("+this.left.associatedVariableName+" , "+this.right.associatedVariableName+", "+this.gradient.associatedVariableName+"));\r\n",this},t}(Ru);H.a.RegisteredTypes["BABYLON.NLerpBlock"]=kl;var jl=function(D){function t(w){var N=D.call(this,w,_u.Neutral)||this;return N.manhattanDistance=!1,N.registerInput("seed",mu.Vector3),N.registerInput("jitter",mu.Float),N.registerOutput("output",mu.Vector2),N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"WorleyNoise3DBlock"},Object.defineProperty(t.prototype,"seed",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"jitter",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),t.prototype._buildBlock=function(w){if(D.prototype._buildBlock.call(this,w),this.seed.isConnected&&this._outputs[0].hasEndpoints)return w._emitFunction("worley3D","vec3 permute(vec3 x){\r\n    return mod((34.0 * x + 1.0) * x, 289.0);\r\n}\r\n\r\nvec3 dist(vec3 x, vec3 y, vec3 z,  bool manhattanDistance){\r\n    return manhattanDistance ?  abs(x) + abs(y) + abs(z) :  (x * x + y * y + z * z);\r\n}\r\n\r\nvec2 worley(vec3 P, float jitter, bool manhattanDistance){\r\n    float K = 0.142857142857; // 1/7\r\n    float Ko = 0.428571428571; // 1/2-K/2\r\n    float  K2 = 0.020408163265306; // 1/(7*7)\r\n    float Kz = 0.166666666667; // 1/6\r\n    float Kzo = 0.416666666667; // 1/2-1/6*2\r\n\r\n    vec3 Pi = mod(floor(P), 289.0);\r\n    vec3 Pf = fract(P) - 0.5;\r\n\r\n    vec3 Pfx = Pf.x + vec3(1.0, 0.0, -1.0);\r\n    vec3 Pfy = Pf.y + vec3(1.0, 0.0, -1.0);\r\n    vec3 Pfz = Pf.z + vec3(1.0, 0.0, -1.0);\r\n\r\n    vec3 p = permute(Pi.x + vec3(-1.0, 0.0, 1.0));\r\n    vec3 p1 = permute(p + Pi.y - 1.0);\r\n    vec3 p2 = permute(p + Pi.y);\r\n    vec3 p3 = permute(p + Pi.y + 1.0);\r\n\r\n    vec3 p11 = permute(p1 + Pi.z - 1.0);\r\n    vec3 p12 = permute(p1 + Pi.z);\r\n    vec3 p13 = permute(p1 + Pi.z + 1.0);\r\n\r\n    vec3 p21 = permute(p2 + Pi.z - 1.0);\r\n    vec3 p22 = permute(p2 + Pi.z);\r\n    vec3 p23 = permute(p2 + Pi.z + 1.0);\r\n\r\n    vec3 p31 = permute(p3 + Pi.z - 1.0);\r\n    vec3 p32 = permute(p3 + Pi.z);\r\n    vec3 p33 = permute(p3 + Pi.z + 1.0);\r\n\r\n    vec3 ox11 = fract(p11*K) - Ko;\r\n    vec3 oy11 = mod(floor(p11*K), 7.0)*K - Ko;\r\n    vec3 oz11 = floor(p11*K2)*Kz - Kzo; // p11 < 289 guaranteed\r\n\r\n    vec3 ox12 = fract(p12*K) - Ko;\r\n    vec3 oy12 = mod(floor(p12*K), 7.0)*K - Ko;\r\n    vec3 oz12 = floor(p12*K2)*Kz - Kzo;\r\n\r\n    vec3 ox13 = fract(p13*K) - Ko;\r\n    vec3 oy13 = mod(floor(p13*K), 7.0)*K - Ko;\r\n    vec3 oz13 = floor(p13*K2)*Kz - Kzo;\r\n\r\n    vec3 ox21 = fract(p21*K) - Ko;\r\n    vec3 oy21 = mod(floor(p21*K), 7.0)*K - Ko;\r\n    vec3 oz21 = floor(p21*K2)*Kz - Kzo;\r\n\r\n    vec3 ox22 = fract(p22*K) - Ko;\r\n    vec3 oy22 = mod(floor(p22*K), 7.0)*K - Ko;\r\n    vec3 oz22 = floor(p22*K2)*Kz - Kzo;\r\n\r\n    vec3 ox23 = fract(p23*K) - Ko;\r\n    vec3 oy23 = mod(floor(p23*K), 7.0)*K - Ko;\r\n    vec3 oz23 = floor(p23*K2)*Kz - Kzo;\r\n\r\n    vec3 ox31 = fract(p31*K) - Ko;\r\n    vec3 oy31 = mod(floor(p31*K), 7.0)*K - Ko;\r\n    vec3 oz31 = floor(p31*K2)*Kz - Kzo;\r\n\r\n    vec3 ox32 = fract(p32*K) - Ko;\r\n    vec3 oy32 = mod(floor(p32*K), 7.0)*K - Ko;\r\n    vec3 oz32 = floor(p32*K2)*Kz - Kzo;\r\n\r\n    vec3 ox33 = fract(p33*K) - Ko;\r\n    vec3 oy33 = mod(floor(p33*K), 7.0)*K - Ko;\r\n    vec3 oz33 = floor(p33*K2)*Kz - Kzo;\r\n\r\n    vec3 dx11 = Pfx + jitter*ox11;\r\n    vec3 dy11 = Pfy.x + jitter*oy11;\r\n    vec3 dz11 = Pfz.x + jitter*oz11;\r\n\r\n    vec3 dx12 = Pfx + jitter*ox12;\r\n    vec3 dy12 = Pfy.x + jitter*oy12;\r\n    vec3 dz12 = Pfz.y + jitter*oz12;\r\n\r\n    vec3 dx13 = Pfx + jitter*ox13;\r\n    vec3 dy13 = Pfy.x + jitter*oy13;\r\n    vec3 dz13 = Pfz.z + jitter*oz13;\r\n\r\n    vec3 dx21 = Pfx + jitter*ox21;\r\n    vec3 dy21 = Pfy.y + jitter*oy21;\r\n    vec3 dz21 = Pfz.x + jitter*oz21;\r\n\r\n    vec3 dx22 = Pfx + jitter*ox22;\r\n    vec3 dy22 = Pfy.y + jitter*oy22;\r\n    vec3 dz22 = Pfz.y + jitter*oz22;\r\n\r\n    vec3 dx23 = Pfx + jitter*ox23;\r\n    vec3 dy23 = Pfy.y + jitter*oy23;\r\n    vec3 dz23 = Pfz.z + jitter*oz23;\r\n\r\n    vec3 dx31 = Pfx + jitter*ox31;\r\n    vec3 dy31 = Pfy.z + jitter*oy31;\r\n    vec3 dz31 = Pfz.x + jitter*oz31;\r\n\r\n    vec3 dx32 = Pfx + jitter*ox32;\r\n    vec3 dy32 = Pfy.z + jitter*oy32;\r\n    vec3 dz32 = Pfz.y + jitter*oz32;\r\n\r\n    vec3 dx33 = Pfx + jitter*ox33;\r\n    vec3 dy33 = Pfy.z + jitter*oy33;\r\n    vec3 dz33 = Pfz.z + jitter*oz33;\r\n\r\n    vec3 d11 = dist(dx11, dy11, dz11, manhattanDistance);\r\n    vec3 d12 =dist(dx12, dy12, dz12, manhattanDistance);\r\n    vec3 d13 = dist(dx13, dy13, dz13, manhattanDistance);\r\n    vec3 d21 = dist(dx21, dy21, dz21, manhattanDistance);\r\n    vec3 d22 = dist(dx22, dy22, dz22, manhattanDistance);\r\n    vec3 d23 = dist(dx23, dy23, dz23, manhattanDistance);\r\n    vec3 d31 = dist(dx31, dy31, dz31, manhattanDistance);\r\n    vec3 d32 = dist(dx32, dy32, dz32, manhattanDistance);\r\n    vec3 d33 = dist(dx33, dy33, dz33, manhattanDistance);\r\n\r\n    vec3 d1a = min(d11, d12);\r\n    d12 = max(d11, d12);\r\n    d11 = min(d1a, d13); // Smallest now not in d12 or d13\r\n    d13 = max(d1a, d13);\r\n    d12 = min(d12, d13); // 2nd smallest now not in d13\r\n    vec3 d2a = min(d21, d22);\r\n    d22 = max(d21, d22);\r\n    d21 = min(d2a, d23); // Smallest now not in d22 or d23\r\n    d23 = max(d2a, d23);\r\n    d22 = min(d22, d23); // 2nd smallest now not in d23\r\n    vec3 d3a = min(d31, d32);\r\n    d32 = max(d31, d32);\r\n    d31 = min(d3a, d33); // Smallest now not in d32 or d33\r\n    d33 = max(d3a, d33);\r\n    d32 = min(d32, d33); // 2nd smallest now not in d33\r\n    vec3 da = min(d11, d21);\r\n    d21 = max(d11, d21);\r\n    d11 = min(da, d31); // Smallest now in d11\r\n    d31 = max(da, d31); // 2nd smallest now not in d31\r\n    d11.xy = (d11.x < d11.y) ? d11.xy : d11.yx;\r\n    d11.xz = (d11.x < d11.z) ? d11.xz : d11.zx; // d11.x now smallest\r\n    d12 = min(d12, d21); // 2nd smallest now not in d21\r\n    d12 = min(d12, d22); // nor in d22\r\n    d12 = min(d12, d31); // nor in d31\r\n    d12 = min(d12, d32); // nor in d32\r\n    d11.yz = min(d11.yz,d12.xy); // nor in d12.yz\r\n    d11.y = min(d11.y,d12.z); // Only two more to go\r\n    d11.y = min(d11.y,d11.z); // Done! (Phew!)\r\n    return sqrt(d11.xy); // F1, F2\r\n}\r\n\r\n","// Worley3D"),w.compilationString+=this._declareOutput(this._outputs[0],w)+" = worley("+this.seed.associatedVariableName+", "+this.jitter.associatedVariableName+", "+this.manhattanDistance+");\r\n",this},t.prototype._dumpPropertiesCode=function(){return this._codeVariableName+".manhattanDistance = "+this.manhattanDistance+";\r\n"},t.prototype.serialize=function(){var w=D.prototype.serialize.call(this);return w.manhattanDistance=this.manhattanDistance,w},t.prototype._deserialize=function(w,N,F){D.prototype._deserialize.call(this,w,N,F),this.manhattanDistance=w.manhattanDistance},t}(Ru);H.a.RegisteredTypes["BABYLON.WorleyNoise3DBlock"]=jl;var zl=function(D){function t(w){var N=D.call(this,w,_u.Neutral)||this;return N.registerInput("seed",mu.Vector3),N.registerOutput("output",mu.Float),N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"SimplexPerlin3DBlock"},Object.defineProperty(t.prototype,"seed",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),t.prototype._buildBlock=function(w){if(D.prototype._buildBlock.call(this,w),this.seed.isConnected&&this._outputs[0].hasEndpoints)return w._emitFunction("SimplexPerlin3D","const float SKEWFACTOR = 1.0/3.0;\r\nconst float UNSKEWFACTOR = 1.0/6.0;\r\nconst float SIMPLEX_CORNER_POS = 0.5;\r\nconst float SIMPLEX_TETRAHADRON_HEIGHT = 0.70710678118654752440084436210485;\r\nfloat SimplexPerlin3D( vec3 P ){\r\n    P *= SIMPLEX_TETRAHADRON_HEIGHT;\r\n    vec3 Pi = floor( P + dot( P, vec3( SKEWFACTOR) ) );    vec3 x0 = P - Pi + dot(Pi, vec3( UNSKEWFACTOR ) );\r\n    vec3 g = step(x0.yzx, x0.xyz);\r\n    vec3 l = 1.0 - g;\r\n    vec3 Pi_1 = min( g.xyz, l.zxy );\r\n    vec3 Pi_2 = max( g.xyz, l.zxy );\r\n    vec3 x1 = x0 - Pi_1 + UNSKEWFACTOR;\r\n    vec3 x2 = x0 - Pi_2 + SKEWFACTOR;\r\n    vec3 x3 = x0 - SIMPLEX_CORNER_POS;\r\n    vec4 v1234_x = vec4( x0.x, x1.x, x2.x, x3.x );\r\n    vec4 v1234_y = vec4( x0.y, x1.y, x2.y, x3.y );\r\n    vec4 v1234_z = vec4( x0.z, x1.z, x2.z, x3.z );\r\n    Pi.xyz = Pi.xyz - floor(Pi.xyz * ( 1.0 / 69.0 )) * 69.0;\r\n    vec3 Pi_inc1 = step( Pi, vec3( 69.0 - 1.5 ) ) * ( Pi + 1.0 );\r\n    vec4 Pt = vec4( Pi.xy, Pi_inc1.xy ) + vec2( 50.0, 161.0 ).xyxy;\r\n    Pt *= Pt;\r\n    vec4 V1xy_V2xy = mix( Pt.xyxy, Pt.zwzw, vec4( Pi_1.xy, Pi_2.xy ) );\r\n    Pt = vec4( Pt.x, V1xy_V2xy.xz, Pt.z ) * vec4( Pt.y, V1xy_V2xy.yw, Pt.w );\r\n    const vec3 SOMELARGEFLOATS = vec3( 635.298681, 682.357502, 668.926525 );\r\n    const vec3 ZINC = vec3( 48.500388, 65.294118, 63.934599 );\r\n    vec3 lowz_mods = vec3( 1.0 / ( SOMELARGEFLOATS.xyz + Pi.zzz * ZINC.xyz ) );\r\n    vec3 highz_mods = vec3( 1.0 / ( SOMELARGEFLOATS.xyz + Pi_inc1.zzz * ZINC.xyz ) );\r\n    Pi_1 = ( Pi_1.z < 0.5 ) ? lowz_mods : highz_mods;\r\n    Pi_2 = ( Pi_2.z < 0.5 ) ? lowz_mods : highz_mods;\r\n    vec4 hash_0 = fract( Pt * vec4( lowz_mods.x, Pi_1.x, Pi_2.x, highz_mods.x ) ) - 0.49999;\r\n    vec4 hash_1 = fract( Pt * vec4( lowz_mods.y, Pi_1.y, Pi_2.y, highz_mods.y ) ) - 0.49999;\r\n    vec4 hash_2 = fract( Pt * vec4( lowz_mods.z, Pi_1.z, Pi_2.z, highz_mods.z ) ) - 0.49999;\r\n    vec4 grad_results = inversesqrt( hash_0 * hash_0 + hash_1 * hash_1 + hash_2 * hash_2 ) * ( hash_0 * v1234_x + hash_1 * v1234_y + hash_2 * v1234_z );\r\n    const float FINAL_NORMALIZATION = 37.837227241611314102871574478976;\r\n    vec4 kernel_weights = v1234_x * v1234_x + v1234_y * v1234_y + v1234_z * v1234_z;\r\n    kernel_weights = max(0.5 - kernel_weights, 0.0);\r\n    kernel_weights = kernel_weights*kernel_weights*kernel_weights;\r\n    return dot( kernel_weights, grad_results ) * FINAL_NORMALIZATION;\r\n}\r\n","// SimplexPerlin3D"),w.compilationString+=this._declareOutput(this._outputs[0],w)+" = SimplexPerlin3D("+this.seed.associatedVariableName+");\r\n",this},t}(Ru);H.a.RegisteredTypes["BABYLON.SimplexPerlin3DBlock"]=zl;var Gl=function(D){function t(w){var N=D.call(this,w,_u.Neutral)||this;return N.registerInput("normalMap0",mu.Vector3),N.registerInput("normalMap1",mu.Vector3),N.registerOutput("output",mu.Vector3),N._inputs[0].acceptedConnectionPointTypes.push(mu.Color3),N._inputs[0].acceptedConnectionPointTypes.push(mu.Color4),N._inputs[0].acceptedConnectionPointTypes.push(mu.Vector4),N._inputs[1].acceptedConnectionPointTypes.push(mu.Color3),N._inputs[1].acceptedConnectionPointTypes.push(mu.Color4),N._inputs[1].acceptedConnectionPointTypes.push(mu.Vector4),N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"NormalBlendBlock"},Object.defineProperty(t.prototype,"normalMap0",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"normalMap1",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),t.prototype._buildBlock=function(w){D.prototype._buildBlock.call(this,w);var N=this._outputs[0],F=this._inputs[0],k=this._inputs[1],j=w._getFreeVariableName("stepR"),z=w._getFreeVariableName("stepG");return w.compilationString+="float "+j+" = step(0.5, "+F.associatedVariableName+".r);\r\n",w.compilationString+="float "+z+" = step(0.5, "+F.associatedVariableName+".g);\r\n",w.compilationString+=this._declareOutput(N,w)+";\r\n",w.compilationString+=N.associatedVariableName+".r = (1.0 - "+j+") * "+F.associatedVariableName+".r * "+k.associatedVariableName+".r * 2.0 + "+j+" * (1.0 - "+F.associatedVariableName+".r) * (1.0 - "+k.associatedVariableName+".r) * 2.0;\r\n",w.compilationString+=N.associatedVariableName+".g = (1.0 - "+z+") * "+F.associatedVariableName+".g * "+k.associatedVariableName+".g * 2.0 + "+z+" * (1.0 - "+F.associatedVariableName+".g) * (1.0 - "+k.associatedVariableName+".g) * 2.0;\r\n",w.compilationString+=N.associatedVariableName+".b = "+F.associatedVariableName+".b * "+k.associatedVariableName+".b;\r\n",this},t}(Ru);H.a.RegisteredTypes["BABYLON.NormalBlendBlock"]=Gl;var Yl=function(D){function t(w){var N=D.call(this,w,_u.Neutral)||this;return N.registerInput("input",mu.Vector2),N.registerInput("angle",mu.Float),N.registerOutput("output",mu.Vector2),N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"Rotate2dBlock"},Object.defineProperty(t.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"angle",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),t.prototype.autoConfigure=function(D){if(!this.angle.isConnected){var w=new Bu("angle");w.value=0,w.output.connectTo(this.angle)}},t.prototype._buildBlock=function(w){D.prototype._buildBlock.call(this,w);var N=this._outputs[0],F=this.angle,k=this.input;return w.compilationString+=this._declareOutput(N,w)+" = vec2(cos("+F.associatedVariableName+") * "+k.associatedVariableName+".x - sin("+F.associatedVariableName+") * "+k.associatedVariableName+".y, sin("+F.associatedVariableName+") * "+k.associatedVariableName+".x + cos("+F.associatedVariableName+") * "+k.associatedVariableName+".y);\r\n",this},t}(Ru);H.a.RegisteredTypes["BABYLON.Rotate2dBlock"]=Yl;var Hl=function(D){function t(w){var N=D.call(this,w,_u.Neutral)||this;return N.registerInput("incident",mu.Vector3),N.registerInput("normal",mu.Vector3),N.registerOutput("output",mu.Vector3),N._inputs[0].acceptedConnectionPointTypes.push(mu.Vector4),N._inputs[0].acceptedConnectionPointTypes.push(mu.Color3),N._inputs[0].acceptedConnectionPointTypes.push(mu.Color4),N._inputs[1].acceptedConnectionPointTypes.push(mu.Vector4),N._inputs[1].acceptedConnectionPointTypes.push(mu.Color3),N._inputs[1].acceptedConnectionPointTypes.push(mu.Color4),N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"ReflectBlock"},Object.defineProperty(t.prototype,"incident",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"normal",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),t.prototype._buildBlock=function(w){D.prototype._buildBlock.call(this,w);var N=this._outputs[0];return w.compilationString+=this._declareOutput(N,w)+" = reflect("+this.incident.associatedVariableName+".xyz, "+this.normal.associatedVariableName+".xyz);\r\n",this},t}(Ru);H.a.RegisteredTypes["BABYLON.ReflectBlock"]=Hl;var Wl=function(D){function t(w){var N=D.call(this,w,_u.Neutral)||this;return N.registerInput("incident",mu.Vector3),N.registerInput("normal",mu.Vector3),N.registerInput("ior",mu.Float),N.registerOutput("output",mu.Vector3),N._inputs[0].acceptedConnectionPointTypes.push(mu.Vector4),N._inputs[0].acceptedConnectionPointTypes.push(mu.Color3),N._inputs[0].acceptedConnectionPointTypes.push(mu.Color4),N._inputs[1].acceptedConnectionPointTypes.push(mu.Vector4),N._inputs[1].acceptedConnectionPointTypes.push(mu.Color3),N._inputs[1].acceptedConnectionPointTypes.push(mu.Color4),N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"RefractBlock"},Object.defineProperty(t.prototype,"incident",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"normal",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ior",{get:function(){return this._inputs[2]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),t.prototype._buildBlock=function(w){D.prototype._buildBlock.call(this,w);var N=this._outputs[0];return w.compilationString+=this._declareOutput(N,w)+" = refract("+this.incident.associatedVariableName+".xyz, "+this.normal.associatedVariableName+".xyz, "+this.ior.associatedVariableName+");\r\n",this},t}(Ru);H.a.RegisteredTypes["BABYLON.RefractBlock"]=Wl;var Xl=function(D){function t(w){var N=D.call(this,w,_u.Neutral)||this;return N.registerInput("color",mu.Color3),N.registerInput("level",mu.Float),N.registerOutput("output",mu.Color3),N}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"DesaturateBlock"},Object.defineProperty(t.prototype,"color",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"level",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),t.prototype._buildBlock=function(w){D.prototype._buildBlock.call(this,w);var N=this._outputs[0],F=this.color.associatedVariableName,k=w._getFreeVariableName("colorMin"),j=w._getFreeVariableName("colorMax"),z=w._getFreeVariableName("colorMerge");return w.compilationString+="float "+k+" = min(min("+F+".x, "+F+".y), "+F+".z);\r\n",w.compilationString+="float "+j+" = max(max("+F+".x, "+F+".y), "+F+".z);\r\n",w.compilationString+="float "+z+" = 0.5 * ("+k+" + "+j+");\r\n",w.compilationString+=this._declareOutput(N,w)+" = mix("+F+", vec3("+z+", "+z+", "+z+"), "+this.level.associatedVariableName+");\r\n",this},t}(Ru);H.a.RegisteredTypes["BABYLON.DesaturateBlock"]=Xl;var Kl=function(){function e(){}return e.prototype.optimize=function(D,w){},e}(),Ql=function(){function e(D,w){var N;void 0===w&&(w=e._DefaultOptions),this.engine=D,this._ringBufferIndex=0,this._ringScreenBuffer=null,this._fullscreenViewport=new Bi.a(0,0,1,1),w=Object(Z.a)(Object(Z.a)({},e._DefaultOptions),w),this._vertexBuffers=((N={})[Zi.b.PositionKind]=new Zi.b(D,w.positions,Zi.b.PositionKind,!1,!1,2),N),this._indexBuffer=D.createIndexBuffer(w.indices),D.depthCullingState.depthTest=!1,D.stencilState.stencilTest=!1}return e.prototype._getNextFrameBuffer=function(D){if(void 0===D&&(D=!0),!this._ringScreenBuffer){this._ringScreenBuffer=[];for(var w=0;w<2;w++){var N=this.engine.createRenderTargetTexture({width:this.engine.getRenderWidth(!0),height:this.engine.getRenderHeight(!0)},{generateDepthBuffer:!1,generateStencilBuffer:!1,generateMipMaps:!1,samplingMode:ce.a.TEXTURE_NEAREST_NEAREST}),F=new Jt.a("",null);F._texture=N,this._ringScreenBuffer.push(F)}}var k=this._ringScreenBuffer[this._ringBufferIndex];return D&&(this._ringBufferIndex=(this._ringBufferIndex+1)%2),k},e.prototype.setViewport=function(D){void 0===D&&(D=this._fullscreenViewport),this.engine.setViewport(D)},e.prototype.bindBuffers=function(D){this.engine.bindBuffers(this._vertexBuffers,this._indexBuffer,D)},e.prototype.applyEffectWrapper=function(D){this.engine.enableEffect(D.effect),this.bindBuffers(D.effect),D.onApplyObservable.notifyObservers({})},e.prototype.draw=function(){this.engine.drawElementsType(ce.a.MATERIAL_TriangleFillMode,0,6)},e.prototype.render=function(D,w){var N=this;void 0===w&&(w=null),Array.isArray(D)||(D=[D]);for(var F=0,k=D;F<k.length;F++)if(!k[F].effect.isReady())return;D.forEach((function(F,k){var j=w;0!==k&&F.effect.onBindObservable.addOnce((function(){F.effect.setTexture("textureSampler",N._getNextFrameBuffer(!1))})),j=D.length>1&&k!=D.length-1?N._getNextFrameBuffer():w,N.setViewport(),N.applyEffectWrapper(F),j&&N.engine.bindFramebuffer(j.getInternalTexture()),N.draw(),j&&N.engine.unBindFramebuffer(j.getInternalTexture())}))},e.prototype.dispose=function(){this._ringScreenBuffer&&(this._ringScreenBuffer.forEach((function(D){D.dispose()})),this._ringScreenBuffer=null);var D=this._vertexBuffers[Zi.b.PositionKind];D&&(D.dispose(),delete this._vertexBuffers[Zi.b.PositionKind]),this._indexBuffer&&this.engine._releaseBuffer(this._indexBuffer)},e._DefaultOptions={positions:[1,1,-1,1,-1,-1,1,-1],indices:[0,1,2,0,2,3]},e}(),ql=function(){function e(D){var w,N=this;this.onApplyObservable=new j.c;var F=D.uniformNames||[];D.vertexShader?w={fragmentSource:D.fragmentShader,vertexSource:D.vertexShader,spectorName:D.name||"effectWrapper"}:(F.push("scale"),w={fragmentSource:D.fragmentShader,vertex:"postprocess",spectorName:D.name||"effectWrapper"},this.onApplyObservable.add((function(){N.effect.setFloat2("scale",1,1)}))),this.effect=new li.a(w,D.attributeNames||["position"],F,D.samplerNames,D.engine)}return e.prototype.dispose=function(){this.effect.dispose()},e}(),Zl=function(){function e(D){this._pendingActions=new Array,this._workerInfos=D.map((function(D){return{worker:D,active:!1}}))}return e.prototype.dispose=function(){for(var D=0,w=this._workerInfos;D<w.length;D++)w[D].worker.terminate();delete this._workerInfos,delete this._pendingActions},e.prototype.push=function(D){for(var w=0,N=this._workerInfos;w<N.length;w++){var F=N[w];if(!F.active)return void this._execute(F,D)}this._pendingActions.push(D)},e.prototype._execute=function(D,w){var N=this;D.active=!0,w(D.worker,(function(){D.active=!1;var w=N._pendingActions.shift();w&&N._execute(D,w)}))},e}();function Bl(D){return new Promise((function(w){DracoDecoderModule({wasmBinary:D}).then((function(D){w({module:D})}))}))}function Ul(D,w,N,F,k){var j=new D.DecoderBuffer;j.Init(w,w.byteLength);var z,G,H=new D.Decoder;try{var X=H.GetEncodedGeometryType(j);switch(X){case D.TRIANGULAR_MESH:z=new D.Mesh,G=H.DecodeBufferToMesh(j,z);break;case D.POINT_CLOUD:z=new D.PointCloud,G=H.DecodeBufferToPointCloud(j,z);break;default:throw new Error("Invalid geometry type "+X)}if(!G.ok()||!z.ptr)throw new Error(G.error_msg());var q=z.num_points();if(X===D.TRIANGULAR_MESH){var Z=z.num_faces(),J=new D.DracoInt32Array;try{for(var $=new Uint32Array(3*Z),te=0;te<Z;te++){H.GetFaceFromMesh(z,te,J);var ie=3*te;$[ie+0]=J.GetValue(0),$[ie+1]=J.GetValue(1),$[ie+2]=J.GetValue(2)}F($)}finally{D.destroy(J)}}var m=function(w,N){var F=new D.DracoFloat32Array;try{H.GetAttributeFloatForAllPoints(z,N,F);var j=N.num_components();if("color"===w&&3===j){for(var G=new Float32Array(4*q),X=0,Z=0;X<G.length;X+=4,Z+=j)G[X+0]=F.GetValue(Z+0),G[X+1]=F.GetValue(Z+1),G[X+2]=F.GetValue(Z+2),G[X+3]=1;k(w,G)}else{for(G=new Float32Array(q*j),X=0;X<G.length;X++)G[X]=F.GetValue(X);k(w,G)}}finally{D.destroy(F)}};if(N)for(var oe in N){var ce=N[oe];m(oe,H.GetAttributeByUniqueId(z,ce))}else{var he={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"};for(var oe in he)-1!==(ce=H.GetAttributeId(z,D[he[oe]]))&&m(oe,H.GetAttribute(z,ce))}}finally{z&&D.destroy(z),D.destroy(H),D.destroy(j)}}function Vl(D){return"object"!=typeof document||"string"!=typeof D?D:Dt.b.GetAbsoluteUrl(D)}var Jl=function(){function e(D){void 0===D&&(D=e.DefaultNumWorkers);var w=e.Configuration.decoder,N=w.wasmUrl&&w.wasmBinaryUrl&&"object"==typeof WebAssembly?{url:w.wasmUrl,wasmBinaryPromise:Dt.b.LoadFileAsync(Vl(w.wasmBinaryUrl))}:{url:w.fallbackUrl,wasmBinaryPromise:Promise.resolve(void 0)};D&&"function"==typeof Worker?this._workerPoolPromise=N.wasmBinaryPromise.then((function(w){for(var F=""+Bl+Ul+"("+function(){var D;onmessage=function(w){var N=w.data;switch(N.id){case"init":var F=N.decoder;F.url&&(importScripts(F.url),D=Bl(F.wasmBinary)),postMessage("done");break;case"decodeMesh":if(!D)throw new Error("Draco decoder module is not available");D.then((function(D){Ul(D.module,N.dataView,N.attributes,(function(D){postMessage({id:"indices",value:D},[D.buffer])}),(function(D,w){postMessage({id:D,value:w},[w.buffer])})),postMessage("done")}))}}}+")()",k=URL.createObjectURL(new Blob([F],{type:"application/javascript"})),j=new Array(D),z=0;z<j.length;z++)j[z]=new Promise((function(D,F){var j=new Worker(k),a=function(D){j.removeEventListener("error",a),j.removeEventListener("message",s),F(D)},s=function(w){"done"===w.data&&(j.removeEventListener("error",a),j.removeEventListener("message",s),D(j))};j.addEventListener("error",a),j.addEventListener("message",s),j.postMessage({id:"init",decoder:{url:Vl(N.url),wasmBinary:w}})}));return Promise.all(j).then((function(D){return new Zl(D)}))})):this._decoderModulePromise=N.wasmBinaryPromise.then((function(D){if(!N.url)throw new Error("Draco decoder module is not available");return Dt.b.LoadScriptAsync(N.url).then((function(){return Bl(D)}))}))}return Object.defineProperty(e,"DecoderAvailable",{get:function(){var D=e.Configuration.decoder;return!!(D.wasmUrl&&D.wasmBinaryUrl&&"object"==typeof WebAssembly||D.fallbackUrl)},enumerable:!0,configurable:!0}),e.GetDefaultNumWorkers=function(){return"object"==typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1},Object.defineProperty(e,"Default",{get:function(){return e._Default||(e._Default=new e),e._Default},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this._workerPoolPromise&&this._workerPoolPromise.then((function(D){D.dispose()})),delete this._workerPoolPromise,delete this._decoderModulePromise},e.prototype.whenReadyAsync=function(){return this._workerPoolPromise?this._workerPoolPromise.then((function(){})):this._decoderModulePromise?this._decoderModulePromise.then((function(){})):Promise.resolve()},e.prototype.decodeMeshAsync=function(D,w){var N=D instanceof ArrayBuffer?new Uint8Array(D):D;if(this._workerPoolPromise)return this._workerPoolPromise.then((function(D){return new Promise((function(F,k){D.push((function(D,j){var z=new qi.a,s=function(w){D.removeEventListener("error",s),D.removeEventListener("message",c),k(w),j()},c=function(w){"done"===w.data?(D.removeEventListener("error",s),D.removeEventListener("message",c),F(z),j()):"indices"===w.data.id?z.indices=w.data.value:z.set(w.data.value,w.data.id)};D.addEventListener("error",s),D.addEventListener("message",c);var G=new Uint8Array(N.byteLength);G.set(new Uint8Array(N.buffer,N.byteOffset,N.byteLength)),D.postMessage({id:"decodeMesh",dataView:G,attributes:w},[G.buffer])}))}))}));if(this._decoderModulePromise)return this._decoderModulePromise.then((function(D){var F=new qi.a;return Ul(D.module,N,w,(function(D){F.indices=D}),(function(D,w){F.set(w,D)})),F}));throw new Error("Draco decoder module is not available")},e.Configuration={decoder:{wasmUrl:"https://preview.babylonjs.com/draco_wasm_wrapper_gltf.js",wasmBinaryUrl:"https://preview.babylonjs.com/draco_decoder_gltf.wasm",fallbackUrl:"https://preview.babylonjs.com/draco_decoder_gltf.js"}},e.DefaultNumWorkers=e.GetDefaultNumWorkers(),e._Default=null,e}(),$l=N(57),hh=0,_h=function(){function e(D,w,N){this.pos=D,this.normal=w,this.uv=N}return e.prototype.clone=function(){return new e(this.pos.clone(),this.normal.clone(),this.uv.clone())},e.prototype.flip=function(){this.normal=this.normal.scale(-1)},e.prototype.interpolate=function(D,w){return new e(z.e.Lerp(this.pos,D.pos,w),z.e.Lerp(this.normal,D.normal,w),z.d.Lerp(this.uv,D.uv,w))},e}(),yh=function(){function e(D,w){this.normal=D,this.w=w}return e.FromPoints=function(D,w,N){var F=N.subtract(D),k=w.subtract(D);if(0===F.lengthSquared()||0===k.lengthSquared())return null;var j=z.e.Normalize(z.e.Cross(F,k));return new e(j,z.e.Dot(j,D))},e.prototype.clone=function(){return new e(this.normal.clone(),this.w)},e.prototype.flip=function(){this.normal.scaleInPlace(-1),this.w=-this.w},e.prototype.splitPolygon=function(D,w,N,F,k){var j,G,H=0,X=[];for(j=0;j<D.vertices.length;j++){var q=(G=z.e.Dot(this.normal,D.vertices[j].pos)-this.w)<-e.EPSILON?2:G>e.EPSILON?1:0;H|=q,X.push(q)}switch(H){case 0:(z.e.Dot(this.normal,D.plane.normal)>0?w:N).push(D);break;case 1:F.push(D);break;case 2:k.push(D);break;case 3:var Z,J=[],$=[];for(j=0;j<D.vertices.length;j++){var te=(j+1)%D.vertices.length,ie=X[j],oe=X[te],ce=D.vertices[j],he=D.vertices[te];if(2!==ie&&J.push(ce),1!==ie&&$.push(2!==ie?ce.clone():ce),3==(ie|oe)){G=(this.w-z.e.Dot(this.normal,ce.pos))/z.e.Dot(this.normal,he.pos.subtract(ce.pos));var fe=ce.interpolate(he,G);J.push(fe),$.push(fe.clone())}}J.length>=3&&(Z=new xh(J,D.shared)).plane&&F.push(Z),$.length>=3&&(Z=new xh($,D.shared)).plane&&k.push(Z)}},e.EPSILON=1e-5,e}(),xh=function(){function e(D,w){this.vertices=D,this.shared=w,this.plane=yh.FromPoints(D[0].pos,D[1].pos,D[2].pos)}return e.prototype.clone=function(){return new e(this.vertices.map((function(D){return D.clone()})),this.shared)},e.prototype.flip=function(){this.vertices.reverse().map((function(D){D.flip()})),this.plane.flip()},e}(),Oh=function(){function e(D){this.plane=null,this.front=null,this.back=null,this.polygons=new Array,D&&this.build(D)}return e.prototype.clone=function(){var D=new e;return D.plane=this.plane&&this.plane.clone(),D.front=this.front&&this.front.clone(),D.back=this.back&&this.back.clone(),D.polygons=this.polygons.map((function(D){return D.clone()})),D},e.prototype.invert=function(){for(var D=0;D<this.polygons.length;D++)this.polygons[D].flip();this.plane&&this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();var w=this.front;this.front=this.back,this.back=w},e.prototype.clipPolygons=function(D){if(!this.plane)return D.slice();for(var w=new Array,N=new Array,F=0;F<D.length;F++)this.plane.splitPolygon(D[F],w,N,w,N);return this.front&&(w=this.front.clipPolygons(w)),N=this.back?this.back.clipPolygons(N):[],w.concat(N)},e.prototype.clipTo=function(D){this.polygons=D.clipPolygons(this.polygons),this.front&&this.front.clipTo(D),this.back&&this.back.clipTo(D)},e.prototype.allPolygons=function(){var D=this.polygons.slice();return this.front&&(D=D.concat(this.front.allPolygons())),this.back&&(D=D.concat(this.back.allPolygons())),D},e.prototype.build=function(D){if(D.length){this.plane||(this.plane=D[0].plane.clone());for(var w=new Array,N=new Array,F=0;F<D.length;F++)this.plane.splitPolygon(D[F],this.polygons,this.polygons,w,N);w.length&&(this.front||(this.front=new e),this.front.build(w)),N.length&&(this.back||(this.back=new e),this.back.build(N))}},e}(),Ih=function(){function e(){this.polygons=new Array}return e.FromMesh=function(D){var w,N,F,k,j,G,H,X,q,Z,J=new Array,$=null;if(!(D instanceof xt.a))throw"BABYLON.CSG: Wrong Mesh type, must be BABYLON.Mesh";D.computeWorldMatrix(!0),H=D.getWorldMatrix(),X=D.position.clone(),q=D.rotation.clone(),D.rotationQuaternion&&($=D.rotationQuaternion.clone()),Z=D.scaling.clone();for(var te=D.getIndices(),ie=D.getVerticesData(Zi.b.PositionKind),oe=D.getVerticesData(Zi.b.NormalKind),ce=D.getVerticesData(Zi.b.UVKind),he=D.subMeshes,fe=0,pe=he.length;fe<pe;fe++)for(var _e=he[fe].indexStart,ve=he[fe].indexCount+he[fe].indexStart;_e<ve;_e+=3){G=[];for(var ye=0;ye<3;ye++){var be=new z.e(oe[3*te[_e+ye]],oe[3*te[_e+ye]+1],oe[3*te[_e+ye]+2]);F=new z.d(ce[2*te[_e+ye]],ce[2*te[_e+ye]+1]);var Te=new z.e(ie[3*te[_e+ye]],ie[3*te[_e+ye]+1],ie[3*te[_e+ye]+2]);k=z.e.TransformCoordinates(Te,H),N=z.e.TransformNormal(be,H),w=new _h(k,N,F),G.push(w)}(j=new xh(G,{subMeshId:fe,meshId:hh,materialIndex:he[fe].materialIndex})).plane&&J.push(j)}var Ee=e.FromPolygons(J);return Ee.matrix=H,Ee.position=X,Ee.rotation=q,Ee.scaling=Z,Ee.rotationQuaternion=$,hh++,Ee},e.FromPolygons=function(D){var w=new e;return w.polygons=D,w},e.prototype.clone=function(){var D=new e;return D.polygons=this.polygons.map((function(D){return D.clone()})),D.copyTransformAttributes(this),D},e.prototype.union=function(D){var w=new Oh(this.clone().polygons),N=new Oh(D.clone().polygons);return w.clipTo(N),N.clipTo(w),N.invert(),N.clipTo(w),N.invert(),w.build(N.allPolygons()),e.FromPolygons(w.allPolygons()).copyTransformAttributes(this)},e.prototype.unionInPlace=function(D){var w=new Oh(this.polygons),N=new Oh(D.polygons);w.clipTo(N),N.clipTo(w),N.invert(),N.clipTo(w),N.invert(),w.build(N.allPolygons()),this.polygons=w.allPolygons()},e.prototype.subtract=function(D){var w=new Oh(this.clone().polygons),N=new Oh(D.clone().polygons);return w.invert(),w.clipTo(N),N.clipTo(w),N.invert(),N.clipTo(w),N.invert(),w.build(N.allPolygons()),w.invert(),e.FromPolygons(w.allPolygons()).copyTransformAttributes(this)},e.prototype.subtractInPlace=function(D){var w=new Oh(this.polygons),N=new Oh(D.polygons);w.invert(),w.clipTo(N),N.clipTo(w),N.invert(),N.clipTo(w),N.invert(),w.build(N.allPolygons()),w.invert(),this.polygons=w.allPolygons()},e.prototype.intersect=function(D){var w=new Oh(this.clone().polygons),N=new Oh(D.clone().polygons);return w.invert(),N.clipTo(w),N.invert(),w.clipTo(N),N.clipTo(w),w.build(N.allPolygons()),w.invert(),e.FromPolygons(w.allPolygons()).copyTransformAttributes(this)},e.prototype.intersectInPlace=function(D){var w=new Oh(this.polygons),N=new Oh(D.polygons);w.invert(),N.clipTo(w),N.invert(),w.clipTo(N),N.clipTo(w),w.build(N.allPolygons()),w.invert(),this.polygons=w.allPolygons()},e.prototype.inverse=function(){var D=this.clone();return D.inverseInPlace(),D},e.prototype.inverseInPlace=function(){this.polygons.map((function(D){D.flip()}))},e.prototype.copyTransformAttributes=function(D){return this.matrix=D.matrix,this.position=D.position,this.rotation=D.rotation,this.scaling=D.scaling,this.rotationQuaternion=D.rotationQuaternion,this},e.prototype.buildMeshGeometry=function(D,w,N){var F=this.matrix.clone();F.invert();var k,j,G,H=new xt.a(D,w),X=[],q=[],Z=[],J=[],$=z.e.Zero(),te=z.e.Zero(),ie=z.d.Zero(),oe=this.polygons,ce=[0,0,0],he={},fe=0,pe={};N&&oe.sort((function(D,w){return D.shared.meshId===w.shared.meshId?D.shared.subMeshId-w.shared.subMeshId:D.shared.meshId-w.shared.meshId}));for(var _e=0,ve=oe.length;_e<ve;_e++){pe[(k=oe[_e]).shared.meshId]||(pe[k.shared.meshId]={}),pe[k.shared.meshId][k.shared.subMeshId]||(pe[k.shared.meshId][k.shared.subMeshId]={indexStart:1/0,indexEnd:-1/0,materialIndex:k.shared.materialIndex}),G=pe[k.shared.meshId][k.shared.subMeshId];for(var ye=2,be=k.vertices.length;ye<be;ye++){ce[0]=0,ce[1]=ye-1,ce[2]=ye;for(var Te=0;Te<3;Te++){$.copyFrom(k.vertices[ce[Te]].pos),te.copyFrom(k.vertices[ce[Te]].normal),ie.copyFrom(k.vertices[ce[Te]].uv);var Ee=z.e.TransformCoordinates($,F),Se=z.e.TransformNormal(te,F);void 0!==(j=he[Ee.x+","+Ee.y+","+Ee.z])&&Z[3*j]===Se.x&&Z[3*j+1]===Se.y&&Z[3*j+2]===Se.z&&J[2*j]===ie.x&&J[2*j+1]===ie.y||(X.push(Ee.x,Ee.y,Ee.z),J.push(ie.x,ie.y),Z.push(te.x,te.y,te.z),j=he[Ee.x+","+Ee.y+","+Ee.z]=X.length/3-1),q.push(j),G.indexStart=Math.min(fe,G.indexStart),G.indexEnd=Math.max(fe,G.indexEnd),fe++}}}if(H.setVerticesData(Zi.b.PositionKind,X),H.setVerticesData(Zi.b.NormalKind,Z),H.setVerticesData(Zi.b.UVKind,J),H.setIndices(q,null),N){var Me,xe=0;for(var Ae in H.subMeshes=new Array,pe){for(var Pe in Me=-1,pe[Ae])G=pe[Ae][Pe],$l.b.CreateFromIndices(G.materialIndex+xe,G.indexStart,G.indexEnd-G.indexStart+1,H),Me=Math.max(G.materialIndex,Me);xe+=++Me}}return H},e.prototype.toMesh=function(D,w,N,F){void 0===w&&(w=null);var k=this.buildMeshGeometry(D,N,F);return k.material=w,k.position.copyFrom(this.position),k.rotation.copyFrom(this.rotation),this.rotationQuaternion&&(k.rotationQuaternion=this.rotationQuaternion.clone()),k.scaling.copyFrom(this.scaling),k.computeWorldMatrix(!0),k},e}(),wh=function(D){function t(w,N,F,k,j,G){void 0===k&&(k=1),void 0===j&&(j=60),void 0===G&&(G=!0);var H=D.call(this,w,F)||this;H._sectionPolygonPointsCount=4,H._running=!1,H._autoStart=G,H._generator=N,H._diameter=k,H._length=j,H._sectionVectors=[],H._sectionNormalVectors=[];for(var X=0;X<H._sectionPolygonPointsCount;X++)H._sectionVectors[X]=z.e.Zero(),H._sectionNormalVectors[X]=z.e.Zero();return H._createMesh(),H}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"TrailMesh"},t.prototype._createMesh=function(){var D=new qi.a,w=[],N=[],F=[],k=z.e.Zero();k=this._generator instanceof Wt.a&&this._generator._boundingInfo?this._generator._boundingInfo.boundingBox.centerWorld:this._generator.position;for(var j=2*Math.PI/this._sectionPolygonPointsCount,G=0;G<this._sectionPolygonPointsCount;G++)w.push(k.x+Math.cos(G*j)*this._diameter,k.y+Math.sin(G*j)*this._diameter,k.z);for(G=1;G<=this._length;G++){for(var H=0;H<this._sectionPolygonPointsCount;H++)w.push(k.x+Math.cos(H*j)*this._diameter,k.y+Math.sin(H*j)*this._diameter,k.z);var X=w.length/3-2*this._sectionPolygonPointsCount;for(H=0;H<this._sectionPolygonPointsCount-1;H++)F.push(X+H,X+H+this._sectionPolygonPointsCount,X+H+this._sectionPolygonPointsCount+1),F.push(X+H,X+H+this._sectionPolygonPointsCount+1,X+H+1);F.push(X+this._sectionPolygonPointsCount-1,X+this._sectionPolygonPointsCount-1+this._sectionPolygonPointsCount,X+this._sectionPolygonPointsCount),F.push(X+this._sectionPolygonPointsCount-1,X+this._sectionPolygonPointsCount,X)}qi.a.ComputeNormals(w,F,N),D.positions=w,D.normals=N,D.indices=F,D.applyToMesh(this,!0),this._autoStart&&this.start()},t.prototype.start=function(){var D=this;this._running||(this._running=!0,this._beforeRenderObserver=this.getScene().onBeforeRenderObservable.add((function(){D.update()})))},t.prototype.stop=function(){this._beforeRenderObserver&&this._running&&(this._running=!1,this.getScene().onBeforeRenderObservable.remove(this._beforeRenderObserver))},t.prototype.update=function(){var D=this.getVerticesData(Zi.b.PositionKind),w=this.getVerticesData(Zi.b.NormalKind),N=this._generator.getWorldMatrix();if(D&&w){for(var F=3*this._sectionPolygonPointsCount;F<D.length;F++)D[F-3*this._sectionPolygonPointsCount]=D[F]-w[F]/this._length*this._diameter;for(F=3*this._sectionPolygonPointsCount;F<w.length;F++)w[F-3*this._sectionPolygonPointsCount]=w[F];var k=D.length-3*this._sectionPolygonPointsCount,j=2*Math.PI/this._sectionPolygonPointsCount;for(F=0;F<this._sectionPolygonPointsCount;F++)this._sectionVectors[F].copyFromFloats(Math.cos(F*j)*this._diameter,Math.sin(F*j)*this._diameter,0),this._sectionNormalVectors[F].copyFromFloats(Math.cos(F*j),Math.sin(F*j),0),z.e.TransformCoordinatesToRef(this._sectionVectors[F],N,this._sectionVectors[F]),z.e.TransformNormalToRef(this._sectionNormalVectors[F],N,this._sectionNormalVectors[F]);for(F=0;F<this._sectionPolygonPointsCount;F++)D[k+3*F]=this._sectionVectors[F].x,D[k+3*F+1]=this._sectionVectors[F].y,D[k+3*F+2]=this._sectionVectors[F].z,w[k+3*F]=this._sectionNormalVectors[F].x,w[k+3*F+1]=this._sectionNormalVectors[F].y,w[k+3*F+2]=this._sectionNormalVectors[F].z;this.updateVerticesData(Zi.b.PositionKind,D,!0,!1),this.updateVerticesData(Zi.b.NormalKind,w,!0,!1)}},t.prototype.clone=function(D,w){return void 0===D&&(D=""),new t(D,void 0===w?this._generator:w,this.getScene(),this._diameter,this._length,this._autoStart)},t.prototype.serialize=function(w){D.prototype.serialize.call(this,w)},t.Parse=function(D,w){return new t(D.name,D._generator,w,D._diameter,D._length,D._autoStart)},t}(xt.a),Nh=N(136),Fh=N(92);qi.a.CreateDisc=function(D){var w=new Array,N=new Array,F=new Array,k=new Array,j=D.radius||.5,z=D.tessellation||64,G=D.arc&&(D.arc<=0||D.arc>1)?1:D.arc||1,H=0===D.sideOrientation?0:D.sideOrientation||qi.a.DEFAULTSIDE;w.push(0,0,0),k.push(.5,.5);for(var X=2*Math.PI*G,q=X/z,Z=0;Z<X;Z+=q){var J=Math.cos(Z),$=Math.sin(Z),te=(J+1)/2,ie=(1-$)/2;w.push(j*J,j*$,0),k.push(te,ie)}1===G&&(w.push(w[3],w[4],w[5]),k.push(k[2],k[3]));for(var oe=w.length/3,ce=1;ce<oe-1;ce++)N.push(ce+1,0,ce);qi.a.ComputeNormals(w,N,F),qi.a._ComputeSides(H,w,N,F,k,D.frontUVs,D.backUVs);var he=new qi.a;return he.indices=N,he.positions=w,he.normals=F,he.uvs=k,he},xt.a.CreateDisc=function(D,w,N,F,k,j){void 0===F&&(F=null);var z={radius:w,tessellation:N,sideOrientation:j,updatable:k};return Bh.CreateDisc(D,z,F)};var Bh=function(){function e(){}return e.CreateDisc=function(D,w,N){void 0===N&&(N=null);var F=new xt.a(D,N);return w.sideOrientation=xt.a._GetDefaultSideOrientation(w.sideOrientation),F._originalBuilderSideOrientation=w.sideOrientation,qi.a.CreateDisc(w).applyToMesh(F,w.updatable),F},e}();qi.a.CreateTiledBox=function(D){for(var w=D.faceUV||new Array(6),N=D.faceColors,F=D.pattern||xt.a.NO_FLIP,k=D.width||D.size||1,j=D.height||D.size||1,H=D.depth||D.size||1,X=D.tileWidth||D.tileSize||1,q=D.tileHeight||D.tileSize||1,Z=D.alignHorizontal||0,J=D.alignVertical||0,$=0===D.sideOrientation?0:D.sideOrientation||qi.a.DEFAULTSIDE,te=0;te<6;te++)void 0===w[te]&&(w[te]=new z.f(0,0,1,1)),N&&void 0===N[te]&&(N[te]=new G.b(1,1,1,1));var ie=k/2,oe=j/2,ce=H/2,he=[];for(te=0;te<2;te++)he[te]=qi.a.CreateTiledPlane({pattern:F,tileWidth:X,tileHeight:q,width:k,height:j,alignVertical:J,alignHorizontal:Z,sideOrientation:$});for(te=2;te<4;te++)he[te]=qi.a.CreateTiledPlane({pattern:F,tileWidth:X,tileHeight:q,width:H,height:j,alignVertical:J,alignHorizontal:Z,sideOrientation:$});var fe=J;for(J===xt.a.BOTTOM?fe=xt.a.TOP:J===xt.a.TOP&&(fe=xt.a.BOTTOM),te=4;te<6;te++)he[te]=qi.a.CreateTiledPlane({pattern:F,tileWidth:X,tileHeight:q,width:k,height:H,alignVertical:fe,alignHorizontal:Z,sideOrientation:$});var pe=[],_e=[],ve=[],ye=[],be=[],Te=[],Ee=[],Se=[],Me=0,xe=0,Ae=0;for(te=0;te<6;te++){Me=he[te].positions.length,Te[te]=[],Ee[te]=[];for(var Pe=0;Pe<Me/3;Pe++)Te[te].push(new z.e(he[te].positions[3*Pe],he[te].positions[3*Pe+1],he[te].positions[3*Pe+2])),Ee[te].push(new z.e(he[te].normals[3*Pe],he[te].normals[3*Pe+1],he[te].normals[3*Pe+2]));xe=he[te].uvs.length,Se[te]=[];for(var Oe=0;Oe<xe;Oe+=2)Se[te][Oe]=w[te].x+(w[te].z-w[te].x)*he[te].uvs[Oe],Se[te][Oe+1]=w[te].y+(w[te].w-w[te].y)*he[te].uvs[Oe+1];if(ve=ve.concat(Se[te]),ye=ye.concat(he[te].indices.map((function(D){return D+Ae}))),Ae+=Te[te].length,N)for(var Re=0;Re<4;Re++)be.push(N[te].r,N[te].g,N[te].b,N[te].a)}var De=new z.e(0,0,ce),Ie=z.a.RotationY(Math.PI);pe=Te[0].map((function(D){return z.e.TransformNormal(D,Ie).add(De)})).map((function(D){return[D.x,D.y,D.z]})).reduce((function(D,w){return D.concat(w)}),[]),_e=Ee[0].map((function(D){return z.e.TransformNormal(D,Ie)})).map((function(D){return[D.x,D.y,D.z]})).reduce((function(D,w){return D.concat(w)}),[]),pe=pe.concat(Te[1].map((function(D){return D.subtract(De)})).map((function(D){return[D.x,D.y,D.z]})).reduce((function(D,w){return D.concat(w)}),[])),_e=_e.concat(Ee[1].map((function(D){return[D.x,D.y,D.z]})).reduce((function(D,w){return D.concat(w)}),[]));var Le=new z.e(ie,0,0),we=z.a.RotationY(-Math.PI/2);pe=pe.concat(Te[2].map((function(D){return z.e.TransformNormal(D,we).add(Le)})).map((function(D){return[D.x,D.y,D.z]})).reduce((function(D,w){return D.concat(w)}),[])),_e=_e.concat(Ee[2].map((function(D){return z.e.TransformNormal(D,we)})).map((function(D){return[D.x,D.y,D.z]})).reduce((function(D,w){return D.concat(w)}),[]));var Ne=z.a.RotationY(Math.PI/2);pe=pe.concat(Te[3].map((function(D){return z.e.TransformNormal(D,Ne).subtract(Le)})).map((function(D){return[D.x,D.y,D.z]})).reduce((function(D,w){return D.concat(w)}),[])),_e=_e.concat(Ee[3].map((function(D){return z.e.TransformNormal(D,Ne)})).map((function(D){return[D.x,D.y,D.z]})).reduce((function(D,w){return D.concat(w)}),[]));var Fe=new z.e(0,oe,0),Be=z.a.RotationX(Math.PI/2);pe=pe.concat(Te[4].map((function(D){return z.e.TransformNormal(D,Be).add(Fe)})).map((function(D){return[D.x,D.y,D.z]})).reduce((function(D,w){return D.concat(w)}),[])),_e=_e.concat(Ee[4].map((function(D){return z.e.TransformNormal(D,Be)})).map((function(D){return[D.x,D.y,D.z]})).reduce((function(D,w){return D.concat(w)}),[]));var Ue=z.a.RotationX(-Math.PI/2);pe=pe.concat(Te[5].map((function(D){return z.e.TransformNormal(D,Ue).subtract(Fe)})).map((function(D){return[D.x,D.y,D.z]})).reduce((function(D,w){return D.concat(w)}),[])),_e=_e.concat(Ee[5].map((function(D){return z.e.TransformNormal(D,Ue)})).map((function(D){return[D.x,D.y,D.z]})).reduce((function(D,w){return D.concat(w)}),[])),qi.a._ComputeSides($,pe,ye,_e,ve);var Ve=new qi.a;if(Ve.indices=ye,Ve.positions=pe,Ve.normals=_e,Ve.uvs=ve,N){var ze=$===qi.a.DOUBLESIDE?be.concat(be):be;Ve.colors=ze}return Ve};var Yh=function(){function e(){}return e.CreateTiledBox=function(D,w,N){void 0===N&&(N=null);var F=new xt.a(D,N);return w.sideOrientation=xt.a._GetDefaultSideOrientation(w.sideOrientation),F._originalBuilderSideOrientation=w.sideOrientation,qi.a.CreateTiledBox(w).applyToMesh(F,w.updatable),F},e}();qi.a.CreateTorusKnot=function(D){var w,N,F=new Array,k=new Array,j=new Array,G=new Array,H=D.radius||2,X=D.tube||.5,q=D.radialSegments||32,Z=D.tubularSegments||32,J=D.p||2,$=D.q||3,te=0===D.sideOrientation?0:D.sideOrientation||qi.a.DEFAULTSIDE,_=function(D){var w=Math.cos(D),N=Math.sin(D),F=$/J*D,k=Math.cos(F),j=H*(2+k)*.5*w,G=H*(2+k)*N*.5,X=H*Math.sin(F)*.5;return new z.e(j,G,X)};for(w=0;w<=q;w++){var ie=w%q/q*2*J*Math.PI,oe=_(ie),ce=_(ie+.01),he=ce.subtract(oe),fe=ce.add(oe),pe=z.e.Cross(he,fe);for(fe=z.e.Cross(pe,he),pe.normalize(),fe.normalize(),N=0;N<Z;N++){var _e=N%Z/Z*2*Math.PI,ve=-X*Math.cos(_e),ye=X*Math.sin(_e);k.push(oe.x+ve*fe.x+ye*pe.x),k.push(oe.y+ve*fe.y+ye*pe.y),k.push(oe.z+ve*fe.z+ye*pe.z),G.push(w/q),G.push(N/Z)}}for(w=0;w<q;w++)for(N=0;N<Z;N++){var be=(N+1)%Z,Te=w*Z+N,Ee=(w+1)*Z+N,Se=(w+1)*Z+be,Me=w*Z+be;F.push(Me),F.push(Ee),F.push(Te),F.push(Me),F.push(Se),F.push(Ee)}qi.a.ComputeNormals(k,F,j),qi.a._ComputeSides(te,k,F,j,G,D.frontUVs,D.backUVs);var xe=new qi.a;return xe.indices=F,xe.positions=k,xe.normals=j,xe.uvs=G,xe},xt.a.CreateTorusKnot=function(D,w,N,F,k,j,z,G,H,X){var q={radius:w,tube:N,radialSegments:F,tubularSegments:k,p:j,q:z,sideOrientation:X,updatable:H};return Wh.CreateTorusKnot(D,q,G)};var Wh=function(){function e(){}return e.CreateTorusKnot=function(D,w,N){var F=new xt.a(D,N);return w.sideOrientation=xt.a._GetDefaultSideOrientation(w.sideOrientation),F._originalBuilderSideOrientation=w.sideOrientation,qi.a.CreateTorusKnot(w).applyToMesh(F,w.updatable),F},e}(),Xh=function(D){function t(w,N){var F=D.call(this,w.x,w.y)||this;return F.index=N,F}return Object(Z.d)(t,D),t}(z.d),Zh=function(){function e(){this.elements=new Array}return e.prototype.add=function(D){var w=this,N=new Array;return D.forEach((function(D){if(0===N.length||!D.equalsWithEpsilon(N[0])){var F=new Xh(D,w.elements.length);N.push(F),w.elements.push(F)}})),N},e.prototype.computeBounds=function(){var D=new z.d(this.elements[0].x,this.elements[0].y),w=new z.d(this.elements[0].x,this.elements[0].y);return this.elements.forEach((function(N){N.x<D.x?D.x=N.x:N.x>w.x&&(w.x=N.x),N.y<D.y?D.y=N.y:N.y>w.y&&(w.y=N.y)})),{min:D,max:w,width:w.x-D.x,height:w.y-D.y}},e}(),Jh=function(){function e(){}return e.Rectangle=function(D,w,N,F){return[new z.d(D,w),new z.d(N,w),new z.d(N,F),new z.d(D,F)]},e.Circle=function(D,w,N,F){void 0===w&&(w=0),void 0===N&&(N=0),void 0===F&&(F=32);for(var k=new Array,j=0,G=2*Math.PI/F,H=0;H<F;H++)k.push(new z.d(w+Math.cos(j)*D,N+Math.sin(j)*D)),j-=G;return k},e.Parse=function(D){var w,N=D.split(/[^-+eE\.\d]+/).map(parseFloat).filter((function(D){return!isNaN(D)})),F=[];for(w=0;w<(2147483646&N.length);w+=2)F.push(new z.d(N[w],N[w+1]));return F},e.StartingAt=function(D,w){return st.StartingAt(D,w)},e}(),$h=function(){function e(D,w,N,F){var k;void 0===F&&(F=earcut),this._points=new Zh,this._outlinepoints=new Zh,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=F,this._name=D,this._scene=N||Ct.a.LastCreatedScene,k=w instanceof st?w.getPoints():w,this._addToepoint(k),this._points.add(k),this._outlinepoints.add(k),void 0===this.bjsEarcut&&oe.a.Warn("Earcut was not found, the polygon will not be built.")}return e.prototype._addToepoint=function(D){for(var w=0,N=D;w<N.length;w++){var F=N[w];this._epoints.push(F.x,F.y)}},e.prototype.addHole=function(D){this._points.add(D);var w=new Zh;return w.add(D),this._holes.push(w),this._eholes.push(this._epoints.length/2),this._addToepoint(D),this},e.prototype.build=function(D,w){void 0===D&&(D=!1),void 0===w&&(w=0);var N=new xt.a(this._name,this._scene),F=this.buildVertexData(w);return N.setVerticesData(Zi.b.PositionKind,F.positions,D),N.setVerticesData(Zi.b.NormalKind,F.normals,D),N.setVerticesData(Zi.b.UVKind,F.uvs,D),N.setIndices(F.indices),N},e.prototype.buildVertexData=function(D){var w=this;void 0===D&&(D=0);var N=new qi.a,F=new Array,k=new Array,j=new Array,z=this._points.computeBounds();this._points.elements.forEach((function(D){F.push(0,1,0),k.push(D.x,0,D.y),j.push((D.x-z.min.x)/z.width,(D.y-z.min.y)/z.height)}));for(var G=new Array,H=this.bjsEarcut(this._epoints,this._eholes,2),X=0;X<H.length;X++)G.push(H[X]);if(D>0){var q=k.length/3;this._points.elements.forEach((function(w){F.push(0,-1,0),k.push(w.x,-D,w.y),j.push(1-(w.x-z.min.x)/z.width,1-(w.y-z.min.y)/z.height)}));var Z=G.length;for(X=0;X<Z;X+=3){var J=G[X+0],$=G[X+1],te=G[X+2];G.push(te+q),G.push($+q),G.push(J+q)}this.addSide(k,F,j,G,z,this._outlinepoints,D,!1),this._holes.forEach((function(N){w.addSide(k,F,j,G,z,N,D,!0)}))}return N.indices=G,N.positions=k,N.normals=F,N.uvs=j,N},e.prototype.addSide=function(D,w,N,F,k,j,G,H){for(var X=D.length/3,q=0,Z=0;Z<j.elements.length;Z++){var J,$=j.elements[Z];J=Z+1>j.elements.length-1?j.elements[0]:j.elements[Z+1],D.push($.x,0,$.y),D.push($.x,-G,$.y),D.push(J.x,0,J.y),D.push(J.x,-G,J.y);var te=new z.e($.x,0,$.y),ie=new z.e(J.x,0,J.y).subtract(te),oe=new z.e(0,1,0),ce=z.e.Cross(ie,oe);ce=ce.normalize(),N.push(q/k.width,0),N.push(q/k.width,1),q+=ie.length(),N.push(q/k.width,0),N.push(q/k.width,1),H?(w.push(ce.x,ce.y,ce.z),w.push(ce.x,ce.y,ce.z),w.push(ce.x,ce.y,ce.z),w.push(ce.x,ce.y,ce.z),F.push(X),F.push(X+2),F.push(X+1),F.push(X+1),F.push(X+2),F.push(X+3)):(w.push(-ce.x,-ce.y,-ce.z),w.push(-ce.x,-ce.y,-ce.z),w.push(-ce.x,-ce.y,-ce.z),w.push(-ce.x,-ce.y,-ce.z),F.push(X),F.push(X+1),F.push(X+2),F.push(X+1),F.push(X+3),F.push(X+2)),X+=4}},e}();qi.a.CreatePolygon=function(D,w,N,F,k,j){for(var H=N||new Array(3),X=F,q=[],Z=0;Z<3;Z++)void 0===H[Z]&&(H[Z]=new z.f(0,0,1,1)),X&&void 0===X[Z]&&(X[Z]=new G.b(1,1,1,1));for(var J=D.getVerticesData(Zi.b.PositionKind),$=D.getVerticesData(Zi.b.NormalKind),te=D.getVerticesData(Zi.b.UVKind),ie=D.getIndices(),oe=0,ce=0,he=0;he<$.length;he+=3)Math.abs($[he+1])<.001&&(ce=1),Math.abs($[he+1]-1)<.001&&(ce=0),Math.abs($[he+1]+1)<.001&&(ce=2),te[2*(oe=he/3)]=(1-te[2*oe])*H[ce].x+te[2*oe]*H[ce].z,te[2*oe+1]=(1-te[2*oe+1])*H[ce].y+te[2*oe+1]*H[ce].w,X&&q.push(X[ce].r,X[ce].g,X[ce].b,X[ce].a);qi.a._ComputeSides(w,J,ie,$,te,k,j);var fe=new qi.a;if(fe.indices=ie,fe.positions=J,fe.normals=$,fe.uvs=te,X){var pe=w===qi.a.DOUBLESIDE?q.concat(q):q;fe.colors=pe}return fe},xt.a.CreatePolygon=function(D,w,N,F,k,j,z){void 0===z&&(z=earcut);var G={shape:w,holes:F,updatable:k,sideOrientation:j};return td.CreatePolygon(D,G,N,z)},xt.a.ExtrudePolygon=function(D,w,N,F,k,j,z,G){void 0===G&&(G=earcut);var H={shape:w,holes:k,depth:N,updatable:j,sideOrientation:z};return td.ExtrudePolygon(D,H,F,G)};var td=function(){function e(){}return e.CreatePolygon=function(D,w,N,F){void 0===N&&(N=null),void 0===F&&(F=earcut),w.sideOrientation=xt.a._GetDefaultSideOrientation(w.sideOrientation);for(var k=w.shape,j=w.holes||[],G=w.depth||0,H=[],X=[],q=0;q<k.length;q++)H[q]=new z.d(k[q].x,k[q].z);H[0].equalsWithEpsilon(H[H.length-1],1e-8)&&H.pop();for(var Z=new $h(D,H,N||Me.a.LastCreatedScene,F),J=0;J<j.length;J++){X=[];for(var $=0;$<j[J].length;$++)X.push(new z.d(j[J][$].x,j[J][$].z));Z.addHole(X)}var te=Z.build(w.updatable,G);return te._originalBuilderSideOrientation=w.sideOrientation,qi.a.CreatePolygon(te,w.sideOrientation,w.faceUV,w.faceColors,w.frontUVs,w.backUVs).applyToMesh(te,w.updatable),te},e.ExtrudePolygon=function(D,w,N,F){return void 0===N&&(N=null),void 0===F&&(F=earcut),e.CreatePolygon(D,w,N,F)},e}();xt.a.CreateLathe=function(D,w,N,F,k,j,z){var G={shape:w,radius:N,tessellation:F,sideOrientation:z,updatable:j};return id.CreateLathe(D,G,k)};var id=function(){function e(){}return e.CreateLathe=function(D,w,N){void 0===N&&(N=null);var F,k=w.arc?w.arc<=0||w.arc>1?1:w.arc:1,j=void 0===w.closed||w.closed,G=w.shape,H=w.radius||1,X=w.tessellation||64,q=w.clip||0,Z=w.updatable,J=xt.a._GetDefaultSideOrientation(w.sideOrientation),$=w.cap||xt.a.NO_CAP,te=2*Math.PI,ie=new Array,oe=w.invertUV||!1,ce=0,he=0,fe=te/X*k,pe=new Array;for(ce=0;ce<=X-q;ce++){for(pe=[],$!=xt.a.CAP_START&&$!=xt.a.CAP_ALL||(pe.push(new z.e(0,G[0].y,0)),pe.push(new z.e(Math.cos(ce*fe)*G[0].x*H,G[0].y,Math.sin(ce*fe)*G[0].x*H))),he=0;he<G.length;he++)F=new z.e(Math.cos(ce*fe)*G[he].x*H,G[he].y,Math.sin(ce*fe)*G[he].x*H),pe.push(F);$!=xt.a.CAP_END&&$!=xt.a.CAP_ALL||(pe.push(new z.e(Math.cos(ce*fe)*G[G.length-1].x*H,G[G.length-1].y,Math.sin(ce*fe)*G[G.length-1].x*H)),pe.push(new z.e(0,G[G.length-1].y,0))),ie.push(pe)}return xc.CreateRibbon(D,{pathArray:ie,closeArray:j,sideOrientation:J,updatable:Z,invertUV:oe,frontUVs:w.frontUVs,backUVs:w.backUVs},N)},e}();qi.a.CreateTiledPlane=function(D){var w=D.pattern||xt.a.NO_FLIP,N=D.tileWidth||D.tileSize||1,F=D.tileHeight||D.tileSize||1,k=D.alignHorizontal||0,j=D.alignVertical||0,z=D.width||D.size||1,G=Math.floor(z/N),H=z-G*N,X=D.height||D.size||1,q=Math.floor(X/F),Z=X-q*F,J=N*G/2,$=F*q/2,te=0,ie=0,oe=0,ce=0,he=0,fe=0;if(H>0||Z>0){switch(oe=-J,ce=-$,he=J,fe=$,k){case xt.a.CENTER:oe-=H/=2,he+=H;break;case xt.a.LEFT:he+=H,te=-H/2;break;case xt.a.RIGHT:oe-=H,te=H/2}switch(j){case xt.a.CENTER:ce-=Z/=2,fe+=Z;break;case xt.a.BOTTOM:fe+=Z,ie=-Z/2;break;case xt.a.TOP:ce-=Z,ie=Z/2}}var pe=[],_e=[],ve=[];ve[0]=[0,0,1,0,1,1,0,1],ve[1]=[0,0,1,0,1,1,0,1],w!==xt.a.ROTATE_TILE&&w!==xt.a.ROTATE_ROW||(ve[1]=[1,1,0,1,0,0,1,0]),w!==xt.a.FLIP_TILE&&w!==xt.a.FLIP_ROW||(ve[1]=[1,0,0,0,0,1,1,1]),w!==xt.a.FLIP_N_ROTATE_TILE&&w!==xt.a.FLIP_N_ROTATE_ROW||(ve[1]=[0,1,1,1,1,0,0,0]);for(var ye=[],be=[],Te=[],Ee=0,Se=0;Se<q;Se++)for(var Me=0;Me<G;Me++)pe.push(Me*N-J+te,Se*F-$+ie,0),pe.push((Me+1)*N-J+te,Se*F-$+ie,0),pe.push((Me+1)*N-J+te,(Se+1)*F-$+ie,0),pe.push(Me*N-J+te,(Se+1)*F-$+ie,0),Te.push(Ee,Ee+1,Ee+3,Ee+1,Ee+2,Ee+3),ye=w===xt.a.FLIP_TILE||w===xt.a.ROTATE_TILE||w===xt.a.FLIP_N_ROTATE_TILE?ye.concat(ve[(Me%2+Se%2)%2]):w===xt.a.FLIP_ROW||w===xt.a.ROTATE_ROW||w===xt.a.FLIP_N_ROTATE_ROW?ye.concat(ve[Se%2]):ye.concat(ve[0]),be.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),_e.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),Ee+=4;if(H>0||Z>0){var xe,Ae,Pe,Oe,Re=Z>0&&(j===xt.a.CENTER||j===xt.a.TOP),De=Z>0&&(j===xt.a.CENTER||j===xt.a.BOTTOM),Ie=H>0&&(k===xt.a.CENTER||k===xt.a.RIGHT),Le=H>0&&(k===xt.a.CENTER||k===xt.a.LEFT),we=[];if(Re&&Ie&&(pe.push(oe+te,ce+ie,0),pe.push(-J+te,ce+ie,0),pe.push(-J+te,ce+Z+ie,0),pe.push(oe+te,ce+Z+ie,0),Te.push(Ee,Ee+1,Ee+3,Ee+1,Ee+2,Ee+3),Ee+=4,we=[xe=1-H/N,Ae=1-Z/F,Pe=1,Ae,Pe,Oe=1,xe,Oe],w===xt.a.ROTATE_ROW&&(we=[1-xe,1-Ae,1-Pe,1-Ae,1-Pe,1-Oe,1-xe,1-Oe]),w===xt.a.FLIP_ROW&&(we=[1-xe,Ae,1-Pe,Ae,1-Pe,Oe,1-xe,Oe]),w===xt.a.FLIP_N_ROTATE_ROW&&(we=[xe,1-Ae,Pe,1-Ae,Pe,1-Oe,xe,1-Oe]),ye=ye.concat(we),be.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),_e.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),Re&&Le&&(pe.push(J+te,ce+ie,0),pe.push(he+te,ce+ie,0),pe.push(he+te,ce+Z+ie,0),pe.push(J+te,ce+Z+ie,0),Te.push(Ee,Ee+1,Ee+3,Ee+1,Ee+2,Ee+3),Ee+=4,we=[xe=0,Ae=1-Z/F,Pe=H/N,Ae,Pe,Oe=1,xe,Oe],(w===xt.a.ROTATE_ROW||w===xt.a.ROTATE_TILE&&G%2==0)&&(we=[1-xe,1-Ae,1-Pe,1-Ae,1-Pe,1-Oe,1-xe,1-Oe]),(w===xt.a.FLIP_ROW||w===xt.a.FLIP_TILE&&G%2==0)&&(we=[1-xe,Ae,1-Pe,Ae,1-Pe,Oe,1-xe,Oe]),(w===xt.a.FLIP_N_ROTATE_ROW||w===xt.a.FLIP_N_ROTATE_TILE&&G%2==0)&&(we=[xe,1-Ae,Pe,1-Ae,Pe,1-Oe,xe,1-Oe]),ye=ye.concat(we),be.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),_e.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),De&&Ie&&(pe.push(oe+te,$+ie,0),pe.push(-J+te,$+ie,0),pe.push(-J+te,fe+ie,0),pe.push(oe+te,fe+ie,0),Te.push(Ee,Ee+1,Ee+3,Ee+1,Ee+2,Ee+3),Ee+=4,we=[xe=1-H/N,Ae=0,Pe=1,Ae,Pe,Oe=Z/F,xe,Oe],(w===xt.a.ROTATE_ROW&&q%2==1||w===xt.a.ROTATE_TILE&&q%1==0)&&(we=[1-xe,1-Ae,1-Pe,1-Ae,1-Pe,1-Oe,1-xe,1-Oe]),(w===xt.a.FLIP_ROW&&q%2==1||w===xt.a.FLIP_TILE&&q%2==0)&&(we=[1-xe,Ae,1-Pe,Ae,1-Pe,Oe,1-xe,Oe]),(w===xt.a.FLIP_N_ROTATE_ROW&&q%2==1||w===xt.a.FLIP_N_ROTATE_TILE&&q%2==0)&&(we=[xe,1-Ae,Pe,1-Ae,Pe,1-Oe,xe,1-Oe]),ye=ye.concat(we),be.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),_e.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),De&&Le&&(pe.push(J+te,$+ie,0),pe.push(he+te,$+ie,0),pe.push(he+te,fe+ie,0),pe.push(J+te,fe+ie,0),Te.push(Ee,Ee+1,Ee+3,Ee+1,Ee+2,Ee+3),Ee+=4,we=[xe=0,Ae=0,Pe=H/N,Ae,Pe,Oe=Z/F,xe,Oe],(w===xt.a.ROTATE_ROW&&q%2==1||w===xt.a.ROTATE_TILE&&(q+G)%2==1)&&(we=[1-xe,1-Ae,1-Pe,1-Ae,1-Pe,1-Oe,1-xe,1-Oe]),(w===xt.a.FLIP_ROW&&q%2==1||w===xt.a.FLIP_TILE&&(q+G)%2==1)&&(we=[1-xe,Ae,1-Pe,Ae,1-Pe,Oe,1-xe,Oe]),(w===xt.a.FLIP_N_ROTATE_ROW&&q%2==1||w===xt.a.FLIP_N_ROTATE_TILE&&(q+G)%2==1)&&(we=[xe,1-Ae,Pe,1-Ae,Pe,1-Oe,xe,1-Oe]),ye=ye.concat(we),be.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),_e.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),Re){var Ne=[];for(xe=0,Ae=1-Z/F,Pe=1,Oe=1,Ne[0]=[xe,Ae,Pe,Ae,Pe,Oe,xe,Oe],Ne[1]=[xe,Ae,Pe,Ae,Pe,Oe,xe,Oe],w!==xt.a.ROTATE_TILE&&w!==xt.a.ROTATE_ROW||(Ne[1]=[1-xe,1-Ae,1-Pe,1-Ae,1-Pe,1-Oe,1-xe,1-Oe]),w!==xt.a.FLIP_TILE&&w!==xt.a.FLIP_ROW||(Ne[1]=[1-xe,Ae,1-Pe,Ae,1-Pe,Oe,1-xe,Oe]),w!==xt.a.FLIP_N_ROTATE_TILE&&w!==xt.a.FLIP_N_ROTATE_ROW||(Ne[1]=[xe,1-Ae,Pe,1-Ae,Pe,1-Oe,xe,1-Oe]),Me=0;Me<G;Me++)pe.push(Me*N-J+te,ce+ie,0),pe.push((Me+1)*N-J+te,ce+ie,0),pe.push((Me+1)*N-J+te,ce+Z+ie,0),pe.push(Me*N-J+te,ce+Z+ie,0),Te.push(Ee,Ee+1,Ee+3,Ee+1,Ee+2,Ee+3),Ee+=4,ye=w===xt.a.FLIP_TILE||w===xt.a.ROTATE_TILE||w===xt.a.FLIP_N_ROTATE_TILE?ye.concat(Ne[(Me+1)%2]):w===xt.a.FLIP_ROW||w===xt.a.ROTATE_ROW||w===xt.a.FLIP_N_ROTATE_ROW?ye.concat(Ne[1]):ye.concat(Ne[0]),be.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),_e.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(De){var Fe=[];for(xe=0,Ae=0,Pe=1,Oe=Z/F,Fe[0]=[xe,Ae,Pe,Ae,Pe,Oe,xe,Oe],Fe[1]=[xe,Ae,Pe,Ae,Pe,Oe,xe,Oe],w!==xt.a.ROTATE_TILE&&w!==xt.a.ROTATE_ROW||(Fe[1]=[1-xe,1-Ae,1-Pe,1-Ae,1-Pe,1-Oe,1-xe,1-Oe]),w!==xt.a.FLIP_TILE&&w!==xt.a.FLIP_ROW||(Fe[1]=[1-xe,Ae,1-Pe,Ae,1-Pe,Oe,1-xe,Oe]),w!==xt.a.FLIP_N_ROTATE_TILE&&w!==xt.a.FLIP_N_ROTATE_ROW||(Fe[1]=[xe,1-Ae,Pe,1-Ae,Pe,1-Oe,xe,1-Oe]),Me=0;Me<G;Me++)pe.push(Me*N-J+te,fe-Z+ie,0),pe.push((Me+1)*N-J+te,fe-Z+ie,0),pe.push((Me+1)*N-J+te,fe+ie,0),pe.push(Me*N-J+te,fe+ie,0),Te.push(Ee,Ee+1,Ee+3,Ee+1,Ee+2,Ee+3),Ee+=4,ye=w===xt.a.FLIP_TILE||w===xt.a.ROTATE_TILE||w===xt.a.FLIP_N_ROTATE_TILE?ye.concat(Fe[(Me+q)%2]):w===xt.a.FLIP_ROW||w===xt.a.ROTATE_ROW||w===xt.a.FLIP_N_ROTATE_ROW?ye.concat(Fe[q%2]):ye.concat(Fe[0]),be.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),_e.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(Ie){var Be=[];for(xe=1-H/N,Ae=0,Pe=1,Oe=1,Be[0]=[xe,Ae,Pe,Ae,Pe,Oe,xe,Oe],Be[1]=[xe,Ae,Pe,Ae,Pe,Oe,xe,Oe],w!==xt.a.ROTATE_TILE&&w!==xt.a.ROTATE_ROW||(Be[1]=[1-xe,1-Ae,1-Pe,1-Ae,1-Pe,1-Oe,1-xe,1-Oe]),w!==xt.a.FLIP_TILE&&w!==xt.a.FLIP_ROW||(Be[1]=[1-xe,Ae,1-Pe,Ae,1-Pe,Oe,1-xe,Oe]),w!==xt.a.FLIP_N_ROTATE_TILE&&w!==xt.a.FLIP_N_ROTATE_ROW||(Be[1]=[xe,1-Ae,Pe,1-Ae,Pe,1-Oe,xe,1-Oe]),Se=0;Se<q;Se++)pe.push(oe+te,Se*F-$+ie,0),pe.push(oe+H+te,Se*F-$+ie,0),pe.push(oe+H+te,(Se+1)*F-$+ie,0),pe.push(oe+te,(Se+1)*F-$+ie,0),Te.push(Ee,Ee+1,Ee+3,Ee+1,Ee+2,Ee+3),Ee+=4,ye=w===xt.a.FLIP_TILE||w===xt.a.ROTATE_TILE||w===xt.a.FLIP_N_ROTATE_TILE?ye.concat(Be[(Se+1)%2]):w===xt.a.FLIP_ROW||w===xt.a.ROTATE_ROW||w===xt.a.FLIP_N_ROTATE_ROW?ye.concat(Be[Se%2]):ye.concat(Be[0]),be.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),_e.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(Le){var Ue=[];for(xe=0,Ae=0,Pe=H/F,Oe=1,Ue[0]=[xe,Ae,Pe,Ae,Pe,Oe,xe,Oe],Ue[1]=[xe,Ae,Pe,Ae,Pe,Oe,xe,Oe],w!==xt.a.ROTATE_TILE&&w!==xt.a.ROTATE_ROW||(Ue[1]=[1-xe,1-Ae,1-Pe,1-Ae,1-Pe,1-Oe,1-xe,1-Oe]),w!==xt.a.FLIP_TILE&&w!==xt.a.FLIP_ROW||(Ue[1]=[1-xe,Ae,1-Pe,Ae,1-Pe,Oe,1-xe,Oe]),w!==xt.a.FLIP_N_ROTATE_TILE&&w!==xt.a.FLIP_N_ROTATE_ROW||(Ue[1]=[xe,1-Ae,Pe,1-Ae,Pe,1-Oe,xe,1-Oe]),Se=0;Se<q;Se++)pe.push(he-H+te,Se*F-$+ie,0),pe.push(he+te,Se*F-$+ie,0),pe.push(he+te,(Se+1)*F-$+ie,0),pe.push(he-H+te,(Se+1)*F-$+ie,0),Te.push(Ee,Ee+1,Ee+3,Ee+1,Ee+2,Ee+3),Ee+=4,ye=w===xt.a.FLIP_TILE||w===xt.a.ROTATE_TILE||w===xt.a.FLIP_N_ROTATE_TILE?ye.concat(Ue[(Se+G)%2]):w===xt.a.FLIP_ROW||w===xt.a.ROTATE_ROW||w===xt.a.FLIP_N_ROTATE_ROW?ye.concat(Ue[Se%2]):ye.concat(Ue[0]),be.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),_e.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}var Ve=0===D.sideOrientation?0:D.sideOrientation||qi.a.DEFAULTSIDE;qi.a._ComputeSides(Ve,pe,Te,_e,ye,D.frontUVs,D.backUVs);var ze=new qi.a;ze.indices=Te,ze.positions=pe,ze.normals=_e,ze.uvs=ye;var Ge=Ve===qi.a.DOUBLESIDE?be.concat(be):be;return ze.colors=Ge,ze};var ud=function(){function e(){}return e.CreateTiledPlane=function(D,w,N){void 0===N&&(N=null);var F=new xt.a(D,N);return w.sideOrientation=xt.a._GetDefaultSideOrientation(w.sideOrientation),F._originalBuilderSideOrientation=w.sideOrientation,qi.a.CreateTiledPlane(w).applyToMesh(F,w.updatable),F},e}();xt.a.CreateTube=function(D,w,N,F,k,j,z,G,H,X){var q={path:w,radius:N,tessellation:F,radiusFunction:k,arc:1,cap:j,updatable:G,sideOrientation:H,instance:X};return hd.CreateTube(D,q,z)};var hd=function(){function e(){}return e.CreateTube=function(D,w,N){void 0===N&&(N=null);var F=w.path,k=w.instance,j=1;void 0!==w.radius?j=w.radius:k&&(j=k._creationDataStorage.radius);var G=w.tessellation||64,H=w.radiusFunction||null,X=w.cap||xt.a.NO_CAP,q=w.invertUV||!1,Z=w.updatable,J=xt.a._GetDefaultSideOrientation(w.sideOrientation);w.arc=w.arc&&(w.arc<=0||w.arc>1)?1:w.arc||1;var $,te,_=function(D,w,N,F,k,j,G,H){for(var X,q,Z,J,$=w.getTangents(),te=w.getNormals(),ie=w.getDistances(),oe=2*Math.PI/k*H,ce=j||function(){return F},he=z.c.Matrix[0],fe=G===xt.a.NO_CAP||G===xt.a.CAP_END?0:2,pe=0;pe<D.length;pe++){q=ce(pe,ie[pe]),X=Array(),Z=te[pe];for(var _e=0;_e<k;_e++)z.a.RotationAxisToRef($[pe],oe*_e,he),J=X[_e]?X[_e]:z.e.Zero(),z.e.TransformCoordinatesToRef(Z,he,J),J.scaleInPlace(q).addInPlace(D[pe]),X[_e]=J;N[fe]=X,fe++}var E=function(w,N){for(var F=Array(),k=0;k<w;k++)F.push(D[N]);return F};switch(G){case xt.a.NO_CAP:break;case xt.a.CAP_START:N[0]=E(k,0),N[1]=N[2].slice(0);break;case xt.a.CAP_END:N[fe]=N[fe-1].slice(0),N[fe+1]=E(k,D.length-1);break;case xt.a.CAP_ALL:N[0]=E(k,0),N[1]=N[2].slice(0),N[fe]=N[fe-1].slice(0),N[fe+1]=E(k,D.length-1)}return N};if(k){var ie=k._creationDataStorage,oe=w.arc||ie.arc;return te=_(F,$=ie.path3D.update(F),ie.pathArray,j,ie.tessellation,H,ie.cap,oe),k=xc.CreateRibbon("",{pathArray:te,instance:k}),ie.path3D=$,ie.pathArray=te,ie.arc=oe,ie.radius=j,k}te=_(F,$=new ut(F),new Array,j,G,H,X=X<0||X>3?0:X,w.arc);var ce=xc.CreateRibbon(D,{pathArray:te,closePath:!0,closeArray:!1,updatable:Z,sideOrientation:J,invertUV:q,frontUVs:w.frontUVs,backUVs:w.backUVs},N);return ce._creationDataStorage.pathArray=te,ce._creationDataStorage.path3D=$,ce._creationDataStorage.tessellation=G,ce._creationDataStorage.cap=X,ce._creationDataStorage.arc=w.arc,ce._creationDataStorage.radius=j,ce},e}();qi.a.CreateIcoSphere=function(D){var w,N=D.sideOrientation||qi.a.DEFAULTSIDE,F=D.radius||1,k=void 0===D.flat||D.flat,j=D.subdivisions||4,G=D.radiusX||F,H=D.radiusY||F,X=D.radiusZ||F,q=(1+Math.sqrt(5))/2,Z=[-1,q,-0,1,q,0,-1,-q,0,1,-q,0,0,-1,-q,0,1,-q,0,-1,q,0,1,q,q,0,1,q,0,-1,-q,0,1,-q,0,-1],J=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],$=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],te=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],ie=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],oe=new Array,ce=new Array,he=new Array,fe=new Array,pe=0,_e=new Array(3),ve=new Array(3);for(w=0;w<3;w++)_e[w]=z.e.Zero(),ve[w]=z.d.Zero();for(var ye=0;ye<20;ye++){for(w=0;w<3;w++){var be=J[3*ye+w];_e[w].copyFromFloats(Z[3*$[be]],Z[3*$[be]+1],Z[3*$[be]+2]),_e[w].normalize().scaleInPlace(F),ve[w].copyFromFloats(te[2*be]*(138/1024)+60/1024+ie[ye]*(-40/1024),te[2*be+1]*(239/1024)+26/1024+ie[ye]*(20/1024))}for(var A=function(D,w,N,F){var q,Z=z.e.Lerp(_e[0],_e[2],w/j),J=z.e.Lerp(_e[1],_e[2],w/j),$=j===w?_e[2]:z.e.Lerp(Z,J,D/(j-w));if($.normalize(),k){var te=z.e.Lerp(_e[0],_e[2],F/j),ie=z.e.Lerp(_e[1],_e[2],F/j);q=z.e.Lerp(te,ie,N/(j-F))}else q=new z.e($.x,$.y,$.z);q.x/=G,q.y/=H,q.z/=X,q.normalize();var ye=z.d.Lerp(ve[0],ve[2],w/j),be=z.d.Lerp(ve[1],ve[2],w/j),Te=j===w?ve[2]:z.d.Lerp(ye,be,D/(j-w));ce.push($.x*G,$.y*H,$.z*X),he.push(q.x,q.y,q.z),fe.push(Te.x,Te.y),oe.push(pe),pe++},Te=0;Te<j;Te++)for(var Ee=0;Ee+Te<j;Ee++)A(Ee,Te,Ee+1/3,Te+1/3),A(Ee+1,Te,Ee+1/3,Te+1/3),A(Ee,Te+1,Ee+1/3,Te+1/3),Ee+Te+1<j&&(A(Ee+1,Te,Ee+2/3,Te+2/3),A(Ee+1,Te+1,Ee+2/3,Te+2/3),A(Ee,Te+1,Ee+2/3,Te+2/3))}qi.a._ComputeSides(N,ce,oe,he,fe,D.frontUVs,D.backUVs);var Se=new qi.a;return Se.indices=oe,Se.positions=ce,Se.normals=he,Se.uvs=fe,Se},xt.a.CreateIcoSphere=function(D,w,N){return fd.CreateIcoSphere(D,w,N)};var fd=function(){function e(){}return e.CreateIcoSphere=function(D,w,N){void 0===N&&(N=null);var F=new xt.a(D,N);return w.sideOrientation=xt.a._GetDefaultSideOrientation(w.sideOrientation),F._originalBuilderSideOrientation=w.sideOrientation,qi.a.CreateIcoSphere(w).applyToMesh(F,w.updatable),F},e}();xt.a.CreateDecal=function(D,w,N,F,k,j){var z={position:N,normal:F,size:k,angle:j};return gd.CreateDecal(D,w,z)};var _d,gd=function(){function e(){}return e.CreateDecal=function(D,w,N){var F=w.getIndices(),k=w.getVerticesData(Zi.b.PositionKind),j=w.getVerticesData(Zi.b.NormalKind),G=N.position||z.e.Zero(),H=N.normal||z.e.Up(),X=N.size||z.e.One(),q=N.angle||0;if(!H){var Z=new z.e(0,0,1),J=w.getScene().activeCamera,$=z.e.TransformCoordinates(Z,J.getWorldMatrix());H=J.globalPosition.subtract($)}var te=-Math.atan2(H.z,H.x)-Math.PI/2,ie=Math.sqrt(H.x*H.x+H.z*H.z),oe=Math.atan2(H.y,ie),ce=z.a.RotationYawPitchRoll(te,oe,q).multiply(z.a.Translation(G.x,G.y,G.z)),he=z.a.Invert(ce),fe=w.getWorldMatrix().multiply(he),pe=new qi.a;pe.indices=[],pe.positions=[],pe.normals=[],pe.uvs=[];for(var _e=0,E=function(D){var w=new bs;if(!F||!k||!j)return w;var N=F[D];return w.position=new z.e(k[3*N],k[3*N+1],k[3*N+2]),w.position=z.e.TransformCoordinates(w.position,fe),w.normal=new z.e(j[3*N],j[3*N+1],j[3*N+2]),w.normal=z.e.TransformNormal(w.normal,fe),w},x=function(D,w){if(0===D.length)return D;for(var N=.5*Math.abs(z.e.Dot(X,w)),n=function(D,F){var k=z.e.GetClipFactor(D.position,F.position,w,N);return new bs(z.e.Lerp(D.position,F.position,k),z.e.Lerp(D.normal,F.normal,k))},F=new Array,k=0;k<D.length;k+=3){var j,G,H,q=null,Z=null,J=null,$=null;switch(((j=z.e.Dot(D[k].position,w)-N>0)?1:0)+((G=z.e.Dot(D[k+1].position,w)-N>0)?1:0)+((H=z.e.Dot(D[k+2].position,w)-N>0)?1:0)){case 0:F.push(D[k]),F.push(D[k+1]),F.push(D[k+2]);break;case 1:if(j&&(q=D[k+1],Z=D[k+2],J=n(D[k],q),$=n(D[k],Z)),G){q=D[k],Z=D[k+2],J=n(D[k+1],q),$=n(D[k+1],Z),F.push(J),F.push(Z.clone()),F.push(q.clone()),F.push(Z.clone()),F.push(J.clone()),F.push($);break}H&&(q=D[k],Z=D[k+1],J=n(D[k+2],q),$=n(D[k+2],Z)),q&&Z&&J&&$&&(F.push(q.clone()),F.push(Z.clone()),F.push(J),F.push($),F.push(J.clone()),F.push(Z.clone()));break;case 2:j||(Z=n(q=D[k].clone(),D[k+1]),J=n(q,D[k+2]),F.push(q),F.push(Z),F.push(J)),G||(Z=n(q=D[k+1].clone(),D[k+2]),J=n(q,D[k]),F.push(q),F.push(Z),F.push(J)),H||(Z=n(q=D[k+2].clone(),D[k]),J=n(q,D[k+1]),F.push(q),F.push(Z),F.push(J))}}return F},ve=0;ve<F.length;ve+=3){var ye=new Array;if(ye.push(E(ve)),ye.push(E(ve+1)),ye.push(E(ve+2)),ye=x(ye,new z.e(1,0,0)),ye=x(ye,new z.e(-1,0,0)),ye=x(ye,new z.e(0,1,0)),ye=x(ye,new z.e(0,-1,0)),ye=x(ye,new z.e(0,0,1)),0!==(ye=x(ye,new z.e(0,0,-1))).length)for(var be=0;be<ye.length;be++){var Te=ye[be];pe.indices.push(_e),Te.position.toArray(pe.positions,3*_e),Te.normal.toArray(pe.normals,3*_e),pe.uvs.push(.5+Te.position.x/X.x),pe.uvs.push(.5+Te.position.y/X.y),_e++}}var Ee=new xt.a(D,w.getScene());return pe.applyToMesh(Ee),Ee.position=G.clone(),Ee.rotation=new z.e(oe,te,q),Ee},e}(),Td=function(){function e(){}return e.CreateBox=function(D,w,N){return void 0===N&&(N=null),po.a.CreateBox(D,w,N)},e.CreateTiledBox=function(D,w,N){return void 0===N&&(N=null),Yh.CreateTiledBox(D,w,N)},e.CreateSphere=function(D,w,N){return void 0===N&&(N=null),vo.a.CreateSphere(D,w,N)},e.CreateDisc=function(D,w,N){return void 0===N&&(N=null),Bh.CreateDisc(D,w,N)},e.CreateIcoSphere=function(D,w,N){return void 0===N&&(N=null),fd.CreateIcoSphere(D,w,N)},e.CreateRibbon=function(D,w,N){return void 0===N&&(N=null),xc.CreateRibbon(D,w,N)},e.CreateCylinder=function(D,w,N){return void 0===N&&(N=null),nr.a.CreateCylinder(D,w,N)},e.CreateTorus=function(D,w,N){return void 0===N&&(N=null),tr.CreateTorus(D,w,N)},e.CreateTorusKnot=function(D,w,N){return void 0===N&&(N=null),Wh.CreateTorusKnot(D,w,N)},e.CreateLineSystem=function(D,w,N){return yo.a.CreateLineSystem(D,w,N)},e.CreateLines=function(D,w,N){return void 0===N&&(N=null),yo.a.CreateLines(D,w,N)},e.CreateDashedLines=function(D,w,N){return void 0===N&&(N=null),yo.a.CreateDashedLines(D,w,N)},e.ExtrudeShape=function(D,w,N){return void 0===N&&(N=null),Pc.ExtrudeShape(D,w,N)},e.ExtrudeShapeCustom=function(D,w,N){return void 0===N&&(N=null),Pc.ExtrudeShapeCustom(D,w,N)},e.CreateLathe=function(D,w,N){return void 0===N&&(N=null),id.CreateLathe(D,w,N)},e.CreateTiledPlane=function(D,w,N){return void 0===N&&(N=null),ud.CreateTiledPlane(D,w,N)},e.CreatePlane=function(D,w,N){return void 0===N&&(N=null),Mo.a.CreatePlane(D,w,N)},e.CreateGround=function(D,w,N){return void 0===N&&(N=null),$i.CreateGround(D,w,N)},e.CreateTiledGround=function(D,w,N){return void 0===N&&(N=null),$i.CreateTiledGround(D,w,N)},e.CreateGroundFromHeightMap=function(D,w,N,F){return void 0===F&&(F=null),$i.CreateGroundFromHeightMap(D,w,N,F)},e.CreatePolygon=function(D,w,N,F){return void 0===N&&(N=null),void 0===F&&(F=earcut),td.CreatePolygon(D,w,N,F)},e.ExtrudePolygon=function(D,w,N,F){return void 0===N&&(N=null),void 0===F&&(F=earcut),td.ExtrudePolygon(D,w,N,F)},e.CreateTube=function(D,w,N){return void 0===N&&(N=null),hd.CreateTube(D,w,N)},e.CreatePolyhedron=function(D,w,N){return void 0===N&&(N=null),Po.CreatePolyhedron(D,w,N)},e.CreateDecal=function(D,w,N){return gd.CreateDecal(D,w,N)},e}(),du=function(D,w,N){this.quality=D,this.distance=w,this.optimizeMesh=N},Sd=function(){function e(){this.running=!1,this._simplificationArray=[]}return e.prototype.addTask=function(D){this._simplificationArray.push(D)},e.prototype.executeNext=function(){var D=this._simplificationArray.pop();D?(this.running=!0,this.runSimplification(D)):this.running=!1},e.prototype.runSimplification=function(D){var w=this;if(D.parallelProcessing)D.settings.forEach((function(N){w.getSimplifier(D).simplify(N,(function(F){D.mesh.addLODLevel(N.distance,F),F.isVisible=!0,N.quality===D.settings[D.settings.length-1].quality&&D.successCallback&&D.successCallback(),w.executeNext()}))}));else{var N=this.getSimplifier(D);Dt.a.Run(D.settings.length,(function(w){var F,k;F=D.settings[w.index],k=function(){w.executeNext()},N.simplify(F,(function(w){D.mesh.addLODLevel(F.distance,w),w.isVisible=!0,k()}))}),(function(){D.successCallback&&D.successCallback(),w.executeNext()}))}},e.prototype.getSimplifier=function(D){switch(D.simplificationType){case _d.QUADRATIC:default:return new Pd(D.mesh)}},e}();!function(D){D[D.QUADRATIC=0]="QUADRATIC"}(_d||(_d={}));var pu=function(D){this.vertices=D,this.error=new Array(4),this.deleted=!1,this.isDirty=!1,this.deletePending=!1,this.borderFactor=0},Md=function(){function e(D,w){this.position=D,this.id=w,this.isBorder=!0,this.q=new Ad,this.triangleCount=0,this.triangleStart=0,this.originalOffsets=[]}return e.prototype.updatePosition=function(D){this.position.copyFrom(D)},e}(),Ad=function(){function e(D){this.data=new Array(10);for(var w=0;w<10;++w)D&&D[w]?this.data[w]=D[w]:this.data[w]=0}return e.prototype.det=function(D,w,N,F,k,j,z,G,H){return this.data[D]*this.data[k]*this.data[H]+this.data[N]*this.data[F]*this.data[G]+this.data[w]*this.data[j]*this.data[z]-this.data[N]*this.data[k]*this.data[z]-this.data[D]*this.data[j]*this.data[G]-this.data[w]*this.data[F]*this.data[H]},e.prototype.addInPlace=function(D){for(var w=0;w<10;++w)this.data[w]+=D.data[w]},e.prototype.addArrayInPlace=function(D){for(var w=0;w<10;++w)this.data[w]+=D[w]},e.prototype.add=function(D){for(var w=new e,N=0;N<10;++N)w.data[N]=this.data[N]+D.data[N];return w},e.FromData=function(D,w,N,F){return new e(e.DataFromNumbers(D,w,N,F))},e.DataFromNumbers=function(D,w,N,F){return[D*D,D*w,D*N,D*F,w*w,w*N,w*F,N*N,N*F,F*F]},e}(),gu=function(D,w){this.vertexId=D,this.triangleId=w},Pd=function(){function e(D){this._mesh=D,this.syncIterations=5e3,this.aggressiveness=7,this.decimationIterations=100,this.boundingBoxEpsilon=rt.a}return e.prototype.simplify=function(D,w){var N=this;this.initDecimatedMesh(),Dt.a.Run(this._mesh.subMeshes.length,(function(w){N.initWithMesh(w.index,(function(){N.runDecimation(D,w.index,(function(){w.executeNext()}))}),D.optimizeMesh)}),(function(){setTimeout((function(){w(N._reconstructedMesh)}),0)}))},e.prototype.runDecimation=function(D,w,N){var F=this,k=~~(this.triangles.length*D.quality),j=0,G=this.triangles.length;Dt.a.Run(this.decimationIterations,(function(D){var w,N;G-j<=k?D.breakLoop():(w=D.index,N=function(){D.executeNext()},setTimeout((function(){w%5==0&&F.updateMesh(0===w);for(var D=0;D<F.triangles.length;++D)F.triangles[D].isDirty=!1;var H=1e-9*Math.pow(w+3,F.aggressiveness);Dt.a.SyncAsyncForLoop(F.triangles.length,F.syncIterations,(function(D){var w=~~((F.triangles.length/2+D)%F.triangles.length),N=F.triangles[w];if(N&&!(N.error[3]>H||N.deleted||N.isDirty))for(var k=0;k<3;++k)if(N.error[k]<H){var G=[],X=[],q=N.vertices[k],Z=N.vertices[(k+1)%3];if(q.isBorder||Z.isBorder)continue;var J=z.e.Zero();F.calculateError(q,Z,J);var $=new Array;if(F.isFlipped(q,Z,J,G,$))continue;if(F.isFlipped(Z,q,J,X,$))continue;if(G.indexOf(!0)<0||X.indexOf(!0)<0)continue;var te=new Array;if($.forEach((function(D){-1===te.indexOf(D)&&(D.deletePending=!0,te.push(D))})),te.length%2!=0)continue;q.q=Z.q.add(q.q),q.updatePosition(J);var ie=F.references.length;j=F.updateTriangles(q,q,G,j),j=F.updateTriangles(q,Z,X,j);var oe=F.references.length-ie;if(oe<=q.triangleCount){if(oe)for(var ce=0;ce<oe;ce++)F.references[q.triangleStart+ce]=F.references[ie+ce]}else q.triangleStart=ie;q.triangleCount=oe;break}}),N,(function(){return G-j<=k}))}),0))}),(function(){setTimeout((function(){F.reconstructMesh(w),N()}),0)}))},e.prototype.initWithMesh=function(D,w,N){var F=this;this.vertices=[],this.triangles=[];var k=this._mesh.getVerticesData(Zi.b.PositionKind),j=this._mesh.getIndices(),G=this._mesh.subMeshes[D],H=[],X=G.verticesCount;Dt.a.SyncAsyncForLoop(X,this.syncIterations/4>>0,(function(D){if(k){var w=D+G.verticesStart,j=z.e.FromArray(k,3*w),X=function(D){if(N)for(var w=0;w<F.vertices.length;++w)if(F.vertices[w].position.equals(D))return F.vertices[w];return null}(j)||new Md(j,F.vertices.length);X.originalOffsets.push(w),X.id===F.vertices.length&&F.vertices.push(X),H.push(X.id)}}),(function(){Dt.a.SyncAsyncForLoop(G.indexCount/3,F.syncIterations,(function(D){if(j){var w=3*(G.indexStart/3+D),N=j[w+0],k=j[w+1],z=j[w+2],X=F.vertices[H[N-G.verticesStart]],q=F.vertices[H[k-G.verticesStart]],Z=F.vertices[H[z-G.verticesStart]],J=new pu([X,q,Z]);J.originalOffset=w,F.triangles.push(J)}}),(function(){F.init(w)}))}))},e.prototype.init=function(D){var w=this;Dt.a.SyncAsyncForLoop(this.triangles.length,this.syncIterations,(function(D){var N=w.triangles[D];N.normal=z.e.Cross(N.vertices[1].position.subtract(N.vertices[0].position),N.vertices[2].position.subtract(N.vertices[0].position)).normalize();for(var F=0;F<3;F++)N.vertices[F].q.addArrayInPlace(Ad.DataFromNumbers(N.normal.x,N.normal.y,N.normal.z,-z.e.Dot(N.normal,N.vertices[0].position)))}),(function(){Dt.a.SyncAsyncForLoop(w.triangles.length,w.syncIterations,(function(D){for(var N=w.triangles[D],F=0;F<3;++F)N.error[F]=w.calculateError(N.vertices[F],N.vertices[(F+1)%3]);N.error[3]=Math.min(N.error[0],N.error[1],N.error[2])}),(function(){D()}))}))},e.prototype.reconstructMesh=function(D){var w,N,F,k=[];for(w=0;w<this.vertices.length;++w)this.vertices[w].triangleCount=0;for(w=0;w<this.triangles.length;++w)if(!this.triangles[w].deleted){for(N=this.triangles[w],F=0;F<3;++F)N.vertices[F].triangleCount=1;k.push(N)}var j=this._reconstructedMesh.getVerticesData(Zi.b.PositionKind)||[],z=this._reconstructedMesh.getVerticesData(Zi.b.NormalKind)||[],G=this._reconstructedMesh.getVerticesData(Zi.b.UVKind)||[],H=this._reconstructedMesh.getVerticesData(Zi.b.ColorKind)||[],X=this._mesh.getVerticesData(Zi.b.NormalKind),q=this._mesh.getVerticesData(Zi.b.UVKind),Z=this._mesh.getVerticesData(Zi.b.ColorKind),J=0;for(w=0;w<this.vertices.length;++w){var $=this.vertices[w];$.id=J,$.triangleCount&&$.originalOffsets.forEach((function(D){X&&(j.push($.position.x),j.push($.position.y),j.push($.position.z),z.push(X[3*D]),z.push(X[3*D+1]),z.push(X[3*D+2]),q&&q.length&&(G.push(q[2*D]),G.push(q[2*D+1])),Z&&Z.length&&(H.push(Z[4*D]),H.push(Z[4*D+1]),H.push(Z[4*D+2]),H.push(Z[4*D+3])),++J)}))}var te=this._reconstructedMesh.getTotalIndices(),ie=this._reconstructedMesh.getTotalVertices(),oe=this._reconstructedMesh.subMeshes;this._reconstructedMesh.subMeshes=[];var ce=this._reconstructedMesh.getIndices(),he=this._mesh.getIndices();for(w=0;w<k.length;++w)N=k[w],[0,1,2].forEach((function(D){var w=he[N.originalOffset+D],F=N.vertices[D].originalOffsets.indexOf(w);F<0&&(F=0),ce.push(N.vertices[D].id+F+ie)}));this._reconstructedMesh.setIndices(ce),this._reconstructedMesh.setVerticesData(Zi.b.PositionKind,j),this._reconstructedMesh.setVerticesData(Zi.b.NormalKind,z),G.length>0&&this._reconstructedMesh.setVerticesData(Zi.b.UVKind,G),H.length>0&&this._reconstructedMesh.setVerticesData(Zi.b.ColorKind,H);var fe=this._mesh.subMeshes[D];D>0&&(this._reconstructedMesh.subMeshes=[],oe.forEach((function(D){$l.b.AddToMesh(D.materialIndex,D.verticesStart,D.verticesCount,D.indexStart,D.indexCount,D.getMesh())})),$l.b.AddToMesh(fe.materialIndex,ie,J,te,3*k.length,this._reconstructedMesh))},e.prototype.initDecimatedMesh=function(){this._reconstructedMesh=new xt.a(this._mesh.name+"Decimated",this._mesh.getScene()),this._reconstructedMesh.material=this._mesh.material,this._reconstructedMesh.parent=this._mesh.parent,this._reconstructedMesh.isVisible=!1,this._reconstructedMesh.renderingGroupId=this._mesh.renderingGroupId},e.prototype.isFlipped=function(D,w,N,F,k){for(var j=0;j<D.triangleCount;++j){var G=this.triangles[this.references[D.triangleStart+j].triangleId];if(!G.deleted){var H=this.references[D.triangleStart+j].vertexId,X=G.vertices[(H+1)%3],q=G.vertices[(H+2)%3];if(X!==w&&q!==w){var Z=X.position.subtract(N);Z=Z.normalize();var J=q.position.subtract(N);if(J=J.normalize(),Math.abs(z.e.Dot(Z,J))>.999)return!0;var $=z.e.Cross(Z,J).normalize();if(F[j]=!1,z.e.Dot($,G.normal)<.2)return!0}else F[j]=!0,k.push(G)}}return!1},e.prototype.updateTriangles=function(D,w,N,F){for(var k=F,j=0;j<w.triangleCount;++j){var z=this.references[w.triangleStart+j],G=this.triangles[z.triangleId];G.deleted||(N[j]&&G.deletePending?(G.deleted=!0,k++):(G.vertices[z.vertexId]=D,G.isDirty=!0,G.error[0]=this.calculateError(G.vertices[0],G.vertices[1])+G.borderFactor/2,G.error[1]=this.calculateError(G.vertices[1],G.vertices[2])+G.borderFactor/2,G.error[2]=this.calculateError(G.vertices[2],G.vertices[0])+G.borderFactor/2,G.error[3]=Math.min(G.error[0],G.error[1],G.error[2]),this.references.push(z)))}return k},e.prototype.identifyBorder=function(){for(var D=0;D<this.vertices.length;++D){var w,N=[],F=[],k=this.vertices[D];for(w=0;w<k.triangleCount;++w)for(var j=this.triangles[this.references[k.triangleStart+w].triangleId],z=0;z<3;z++){for(var G=0,H=j.vertices[z];G<N.length&&F[G]!==H.id;)++G;G===N.length?(N.push(1),F.push(H.id)):N[G]++}for(w=0;w<N.length;++w)1===N[w]?this.vertices[F[w]].isBorder=!0:this.vertices[F[w]].isBorder=!1}},e.prototype.updateMesh=function(D){var w,N,F,k;if(void 0===D&&(D=!1),!D){var j=[];for(w=0;w<this.triangles.length;++w)this.triangles[w].deleted||j.push(this.triangles[w]);this.triangles=j}for(w=0;w<this.vertices.length;++w)this.vertices[w].triangleCount=0,this.vertices[w].triangleStart=0;for(w=0;w<this.triangles.length;++w)for(N=this.triangles[w],F=0;F<3;++F)(k=N.vertices[F]).triangleCount++;var z=0;for(w=0;w<this.vertices.length;++w)this.vertices[w].triangleStart=z,z+=this.vertices[w].triangleCount,this.vertices[w].triangleCount=0;var G=new Array(3*this.triangles.length);for(w=0;w<this.triangles.length;++w)for(N=this.triangles[w],F=0;F<3;++F)G[(k=N.vertices[F]).triangleStart+k.triangleCount]=new gu(F,w),k.triangleCount++;this.references=G,D&&this.identifyBorder()},e.prototype.vertexError=function(D,w){var N=w.x,F=w.y,k=w.z;return D.data[0]*N*N+2*D.data[1]*N*F+2*D.data[2]*N*k+2*D.data[3]*N+D.data[4]*F*F+2*D.data[5]*F*k+2*D.data[6]*F+D.data[7]*k*k+2*D.data[8]*k+D.data[9]},e.prototype.calculateError=function(D,w,N){var F=D.q.add(w.q),k=D.isBorder&&w.isBorder,j=0,G=F.det(0,1,2,1,4,5,2,5,7);if(0===G||k){var H=D.position.add(w.position).divide(new z.e(2,2,2)),X=this.vertexError(F,D.position),q=this.vertexError(F,w.position),Z=this.vertexError(F,H);(j=Math.min(X,q,Z))===X?N&&N.copyFrom(D.position):j===q?N&&N.copyFrom(w.position):N&&N.copyFrom(H)}else N||(N=z.e.Zero()),N.x=-1/G*F.det(1,2,3,4,5,6,5,7,8),N.y=1/G*F.det(0,2,3,1,5,6,2,7,8),N.z=-1/G*F.det(0,1,3,1,4,6,2,5,8),j=this.vertexError(F,N);return j},e}();Object.defineProperty(We.a.prototype,"simplificationQueue",{get:function(){if(!this._simplificationQueue){this._simplificationQueue=new Sd;var D=this._getComponent(Nt.a.NAME_SIMPLIFICATIONQUEUE);D||(D=new Cd(this),this._addComponent(D))}return this._simplificationQueue},set:function(D){this._simplificationQueue=D},enumerable:!0,configurable:!0}),xt.a.prototype.simplify=function(D,w,N,F){return void 0===w&&(w=!0),void 0===N&&(N=_d.QUADRATIC),this.getScene().simplificationQueue.addTask({settings:D,parallelProcessing:w,mesh:this,simplificationType:N,successCallback:F}),this};var Cd=function(){function e(D){this.name=Nt.a.NAME_SIMPLIFICATIONQUEUE,this.scene=D}return e.prototype.register=function(){this.scene._beforeCameraUpdateStage.registerStep(Nt.a.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE,this,this._beforeCameraUpdate)},e.prototype.rebuild=function(){},e.prototype.dispose=function(){},e.prototype._beforeCameraUpdate=function(){this.scene._simplificationQueue&&!this.scene._simplificationQueue.running&&this.scene._simplificationQueue.executeNext()},e}(),Od=N(135),Rd=N(84),Ld=function(){function e(D){void 0===D&&(D=Recast),this.bjsRECAST={},this.name="RecastJSPlugin","function"==typeof D?D(this.bjsRECAST):this.bjsRECAST=D,this.isSupported()||oe.a.Error("RecastJS is not available. Please make sure you included the js file.")}return e.prototype.createNavMesh=function(D,w){var N,F,k,j=new this.bjsRECAST.rcConfig;j.cs=w.cs,j.ch=w.ch,j.borderSize=0,j.tileSize=0,j.walkableSlopeAngle=w.walkableSlopeAngle,j.walkableHeight=w.walkableHeight,j.walkableClimb=w.walkableClimb,j.walkableRadius=w.walkableRadius,j.maxEdgeLen=w.maxEdgeLen,j.maxSimplificationError=w.maxSimplificationError,j.minRegionArea=w.minRegionArea,j.mergeRegionArea=w.mergeRegionArea,j.maxVertsPerPoly=w.maxVertsPerPoly,j.detailSampleDist=w.detailSampleDist,j.detailSampleMaxError=w.detailSampleMaxError,this.navMesh=new this.bjsRECAST.NavMesh;var G=[],H=[],X=0;for(N=0;N<D.length;N++)if(D[N]){var q=D[N],Z=q.getIndices();if(!Z)continue;var J=q.getVerticesData(Zi.b.PositionKind,!1,!1);if(!J)continue;var $=q.computeWorldMatrix(!1);for(F=0;F<Z.length;F++)G.push(Z[F]+X);var te=z.e.Zero(),ie=z.e.Zero();for(k=0;k<J.length;k+=3)z.e.FromArrayToRef(J,k,ie),z.e.TransformCoordinatesToRef(ie,$,te),H.push(te.x,te.y,te.z);X+=J.length/3}this.navMesh.build(H,X,G,G.length,j)},e.prototype.createDebugNavMesh=function(D){var w,N,F=this.navMesh.getDebugNavMesh(),k=F.getTriangleCount(),j=[],z=[];for(w=0;w<3*k;w++)j.push(w);for(w=0;w<k;w++)for(N=0;N<3;N++){var G=F.getTriangle(w).getPoint(N);z.push(G.x,G.y,G.z)}var H=new xt.a("NavMeshDebug",D),X=new qi.a;return X.indices=j,X.positions=z,X.applyToMesh(H,!1),H},e.prototype.getClosestPoint=function(D){var w=new this.bjsRECAST.Vec3(D.x,D.y,D.z),N=this.navMesh.getClosestPoint(w);return new z.e(N.x,N.y,N.z)},e.prototype.getRandomPointAround=function(D,w){var N=new this.bjsRECAST.Vec3(D.x,D.y,D.z),F=this.navMesh.getRandomPointAround(N,w);return new z.e(F.x,F.y,F.z)},e.prototype.moveAlong=function(D,w){var N=new this.bjsRECAST.Vec3(D.x,D.y,D.z),F=new this.bjsRECAST.Vec3(w.x,w.y,w.z),k=this.navMesh.moveAlong(N,F);return new z.e(k.x,k.y,k.z)},e.prototype.computePath=function(D,w){var N,F=new this.bjsRECAST.Vec3(D.x,D.y,D.z),k=new this.bjsRECAST.Vec3(w.x,w.y,w.z),j=this.navMesh.computePath(F,k),G=j.getPointCount(),H=[];for(N=0;N<G;N++){var X=j.getPoint(N);H.push(new z.e(X.x,X.y,X.z))}return H},e.prototype.createCrowd=function(D,w,N){return new wd(this,D,w,N)},e.prototype.setDefaultQueryExtent=function(D){var w=new this.bjsRECAST.Vec3(D.x,D.y,D.z);this.navMesh.setDefaultQueryExtent(w)},e.prototype.getDefaultQueryExtent=function(){var D=this.navMesh.getDefaultQueryExtent();return new z.e(D.x,D.y,D.z)},e.prototype.dispose=function(){},e.prototype.isSupported=function(){return void 0!==this.bjsRECAST},e}(),wd=function(){function e(D,w,N,F){var k=this;this.recastCrowd={},this.transforms=new Array,this.agents=new Array,this._onBeforeAnimationsObserver=null,this.bjsRECASTPlugin=D,this.recastCrowd=new this.bjsRECASTPlugin.bjsRECAST.Crowd(w,N,this.bjsRECASTPlugin.navMesh.getNavMesh()),this._scene=F,this._onBeforeAnimationsObserver=F.onBeforeAnimationsObservable.add((function(){k.update(.001*F.getEngine().getDeltaTime())}))}return e.prototype.addAgent=function(D,w,N){var F=new this.bjsRECASTPlugin.bjsRECAST.dtCrowdAgentParams;F.radius=w.radius,F.height=w.height,F.maxAcceleration=w.maxAcceleration,F.maxSpeed=w.maxSpeed,F.collisionQueryRange=w.collisionQueryRange,F.pathOptimizationRange=w.pathOptimizationRange,F.separationWeight=w.separationWeight,F.updateFlags=7,F.obstacleAvoidanceType=0,F.queryFilterType=0,F.userData=0;var k=this.recastCrowd.addAgent(new this.bjsRECASTPlugin.bjsRECAST.Vec3(D.x,D.y,D.z),F);return this.transforms.push(N),this.agents.push(k),k},e.prototype.getAgentPosition=function(D){var w=this.recastCrowd.getAgentPosition(D);return new z.e(w.x,w.y,w.z)},e.prototype.getAgentVelocity=function(D){var w=this.recastCrowd.getAgentVelocity(D);return new z.e(w.x,w.y,w.z)},e.prototype.agentGoto=function(D,w){this.recastCrowd.agentGoto(D,new this.bjsRECASTPlugin.bjsRECAST.Vec3(w.x,w.y,w.z))},e.prototype.agentTeleport=function(D,w){this.recastCrowd.agentTeleport(D,new this.bjsRECASTPlugin.bjsRECAST.Vec3(w.x,w.y,w.z))},e.prototype.updateAgentParameters=function(D,w){var N=this.recastCrowd.getAgentParameters(D);void 0!==w.radius&&(N.radius=w.radius),void 0!==w.height&&(N.height=w.height),void 0!==w.maxAcceleration&&(N.maxAcceleration=w.maxAcceleration),void 0!==w.maxSpeed&&(N.maxSpeed=w.maxSpeed),void 0!==w.collisionQueryRange&&(N.collisionQueryRange=w.collisionQueryRange),void 0!==w.pathOptimizationRange&&(N.pathOptimizationRange=w.pathOptimizationRange),void 0!==w.separationWeight&&(N.separationWeight=w.separationWeight),this.recastCrowd.setAgentParameters(D,N)},e.prototype.removeAgent=function(D){this.recastCrowd.removeAgent(D);var w=this.agents.indexOf(D);w>-1&&(this.agents.splice(w,1),this.transforms.splice(w,1))},e.prototype.getAgents=function(){return this.agents},e.prototype.update=function(D){this.recastCrowd.update(D);for(var w=0;w<this.agents.length;w++)this.transforms[w].position=this.getAgentPosition(this.agents[w])},e.prototype.setDefaultQueryExtent=function(D){var w=new this.bjsRECASTPlugin.bjsRECAST.Vec3(D.x,D.y,D.z);this.recastCrowd.setDefaultQueryExtent(w)},e.prototype.getDefaultQueryExtent=function(){var D=this.recastCrowd.getDefaultQueryExtent();return new z.e(D.x,D.y,D.z)},e.prototype.dispose=function(){this.recastCrowd.destroy(),this._scene.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null},e}();Ct.a.OfflineProviderFactory=function(D,w,N){return void 0===N&&(N=!1),new Ud(D,w,N)};var Bd,Ud=function(){function e(D,w,N){var F=this;void 0===N&&(N=!1),this._idbFactory="undefined"!=typeof window?window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB:indexedDB,this._callbackManifestChecked=w,this._currentSceneUrl=e._ReturnFullUrlLocation(D),this._db=null,this._enableSceneOffline=!1,this._enableTexturesOffline=!1,this._manifestVersionFound=0,this._mustUpdateRessources=!1,this._hasReachedQuota=!1,e.IDBStorageEnabled?N?(this._enableSceneOffline=!0,this._enableTexturesOffline=!0,this._manifestVersionFound=1,Dt.b.SetImmediate((function(){F._callbackManifestChecked(!0)}))):this._checkManifestFile():this._callbackManifestChecked(!0)}return Object.defineProperty(e.prototype,"enableSceneOffline",{get:function(){return this._enableSceneOffline},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enableTexturesOffline",{get:function(){return this._enableTexturesOffline},enumerable:!0,configurable:!0}),e.prototype._checkManifestFile=function(){var D=this,i=function(){D._enableSceneOffline=!1,D._enableTexturesOffline=!1,D._callbackManifestChecked(!1)},w=!1,N=this._currentSceneUrl+".manifest",F=new lu.a;navigator.onLine&&(w=!0,N=N+(null==N.match(/\?/)?"?":"&")+Date.now()),F.open("GET",N),F.addEventListener("load",(function(){if(200===F.status||e._ValidateXHRData(F,1))try{var w=JSON.parse(F.response);D._enableSceneOffline=w.enableSceneOffline,D._enableTexturesOffline=w.enableTexturesOffline&&e.IsUASupportingBlobStorage,w.version&&!isNaN(parseInt(w.version))&&(D._manifestVersionFound=w.version),D._callbackManifestChecked&&D._callbackManifestChecked(!0)}catch(D){i()}else i()}),!1),F.addEventListener("error",(function(){if(w){w=!1;var N=D._currentSceneUrl+".manifest";F.open("GET",N),F.send()}else i()}),!1);try{F.send()}catch(D){oe.a.Error("Error on XHR send request."),this._callbackManifestChecked(!1)}},e.prototype.open=function(D,w){var N=this,n=function(){N._isSupported=!1,w&&w()};if(this._idbFactory&&(this._enableSceneOffline||this._enableTexturesOffline))if(this._db)D&&D();else{this._hasReachedQuota=!1,this._isSupported=!0;var F=this._idbFactory.open("babylonjs",1);F.onerror=function(){n()},F.onblocked=function(){oe.a.Error("IDB request blocked. Please reload the page."),n()},F.onsuccess=function(){N._db=F.result,D()},F.onupgradeneeded=function(D){if(N._db=D.target.result,N._db)try{N._db.createObjectStore("scenes",{keyPath:"sceneUrl"}),N._db.createObjectStore("versions",{keyPath:"sceneUrl"}),N._db.createObjectStore("textures",{keyPath:"textureUrl"})}catch(D){oe.a.Error("Error while creating object stores. Exception: "+D.message),n()}}}else this._isSupported=!1,w&&w()},e.prototype.loadImage=function(D,w){var N=this,F=e._ReturnFullUrlLocation(D),o=function(){N._hasReachedQuota||null===N._db?w.src=D:N._saveImageIntoDBAsync(F,w)};this._mustUpdateRessources?o():this._loadImageFromDBAsync(F,w,o)},e.prototype._loadImageFromDBAsync=function(D,w,N){if(this._isSupported&&null!==this._db){var F,k=this._db.transaction(["textures"]);k.onabort=function(){w.src=D},k.oncomplete=function(){var k;if(F){var j=window.URL||window.webkitURL;k=j.createObjectURL(F.data),w.onerror=function(){oe.a.Error("Error loading image from blob URL: "+k+" switching back to web url: "+D),w.src=D},w.src=k}else N()};var j=k.objectStore("textures").get(D);j.onsuccess=function(D){F=D.target.result},j.onerror=function(){oe.a.Error("Error loading texture "+D+" from DB."),w.src=D}}else oe.a.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),w.src=D},e.prototype._saveImageIntoDBAsync=function(D,w){var N=this;if(this._isSupported){var r=function(){var D;if(F){var N=window.URL||window.webkitURL;try{D=N.createObjectURL(F)}catch(w){D=N.createObjectURL(F)}}D&&(w.src=D)};if(e.IsUASupportingBlobStorage){var F,k=new lu.a;k.open("GET",D),k.responseType="blob",k.addEventListener("load",(function(){if(200===k.status&&N._db){F=k.response;var j=N._db.transaction(["textures"],"readwrite");j.onabort=function(D){try{var w=(D.srcElement||D.target).error;w&&"QuotaExceededError"===w.name&&(N._hasReachedQuota=!0)}catch(D){}r()},j.oncomplete=function(){r()};var z={textureUrl:D,data:F};try{var G=j.objectStore("textures").put(z);G.onsuccess=function(){},G.onerror=function(){r()}}catch(F){25===F.code&&(e.IsUASupportingBlobStorage=!1,N._enableTexturesOffline=!1),w.src=D}}else w.src=D}),!1),k.addEventListener("error",(function(){oe.a.Error("Error in XHR request in BABYLON.Database."),w.src=D}),!1),k.send()}else w.src=D}else oe.a.Error("Error: IndexedDB not supported by your browser or Babylon.js database is not open."),w.src=D},e.prototype._checkVersionFromDB=function(D,w){var N=this;this._loadVersionFromDBAsync(D,w,(function(){N._saveVersionIntoDBAsync(D,w)}))},e.prototype._loadVersionFromDBAsync=function(D,w,N){var F,k=this;if(this._isSupported&&this._db)try{var j=this._db.transaction(["versions"]);j.oncomplete=function(){F?k._manifestVersionFound!==F.data?(k._mustUpdateRessources=!0,N()):w(F.data):(k._mustUpdateRessources=!0,N())},j.onabort=function(){w(-1)};var z=j.objectStore("versions").get(D);z.onsuccess=function(D){F=D.target.result},z.onerror=function(){oe.a.Error("Error loading version for scene "+D+" from DB."),w(-1)}}catch(D){oe.a.Error("Error while accessing 'versions' object store (READ OP). Exception: "+D.message),w(-1)}else oe.a.Error("Error: IndexedDB not supported by your browser or Babylon.js database is not open."),w(-1)},e.prototype._saveVersionIntoDBAsync=function(D,w){var N=this;if(this._isSupported&&!this._hasReachedQuota&&this._db)try{var F=this._db.transaction(["versions"],"readwrite");F.onabort=function(D){try{var F=D.srcElement.error;F&&"QuotaExceededError"===F.name&&(N._hasReachedQuota=!0)}catch(D){}w(-1)},F.oncomplete=function(){w(N._manifestVersionFound)};var k={sceneUrl:D,data:this._manifestVersionFound},j=F.objectStore("versions").put(k);j.onsuccess=function(){},j.onerror=function(){oe.a.Error("Error in DB add version request in BABYLON.Database.")}}catch(D){oe.a.Error("Error while accessing 'versions' object store (WRITE OP). Exception: "+D.message),w(-1)}else w(-1)},e.prototype.loadFile=function(D,w,N,F,k){var j=this,z=e._ReturnFullUrlLocation(D),c=function(){j._saveFileAsync(z,w,N,k,F)};this._checkVersionFromDB(z,(function(D){-1!==D?j._mustUpdateRessources?j._saveFileAsync(z,w,N,k,F):j._loadFileAsync(z,w,c):F&&F()}))},e.prototype._loadFileAsync=function(D,w,N){if(this._isSupported&&this._db){var F,k;F=-1!==D.indexOf(".babylon")?"scenes":"textures";var j=this._db.transaction([F]);j.oncomplete=function(){k?w(k.data):N()},j.onabort=function(){N()};var z=j.objectStore(F).get(D);z.onsuccess=function(D){k=D.target.result},z.onerror=function(){oe.a.Error("Error loading file "+D+" from DB."),N()}}else oe.a.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),w()},e.prototype._saveFileAsync=function(D,w,N,F,k){var j=this;if(this._isSupported){var z;z=-1!==D.indexOf(".babylon")?"scenes":"textures";var G,H=new lu.a;H.open("GET",D+"?"+Date.now()),F&&(H.responseType="arraybuffer"),N&&(H.onprogress=N),H.addEventListener("load",(function(){if(200===H.status||H.status<400&&e._ValidateXHRData(H,F?6:1))if(G=F?H.response:H.responseText,!j._hasReachedQuota&&j._db){var N,X=j._db.transaction([z],"readwrite");X.onabort=function(D){try{var N=D.srcElement.error;N&&"QuotaExceededError"===N.name&&(j._hasReachedQuota=!0)}catch(D){}w(G)},X.oncomplete=function(){w(G)},N="scenes"===z?{sceneUrl:D,data:G,version:j._manifestVersionFound}:{textureUrl:D,data:G};try{var q=X.objectStore(z).put(N);q.onsuccess=function(){},q.onerror=function(){oe.a.Error("Error in DB add file request in BABYLON.Database.")}}catch(D){w(G)}}else w(G);else H.status>=400&&k?k(H):w()}),!1),H.addEventListener("error",(function(){oe.a.Error("error on XHR request."),w()}),!1),H.send()}else oe.a.Error("Error: IndexedDB not supported by your browser or Babylon.js database is not open."),w()},e._ValidateXHRData=function(D,w){void 0===w&&(w=7);try{if(1&w){if(D.responseText&&D.responseText.length>0)return!0;if(1===w)return!1}if(2&w){var N=nu.GetTGAHeader(D.response);if(N.width&&N.height&&N.width>0&&N.height>0)return!0;if(2===w)return!1}if(4&w){var F=new Uint8Array(D.response,0,3);return 68===F[0]&&68===F[1]&&83===F[2]}}catch(D){}return!1},e.IsUASupportingBlobStorage=!0,e.IDBStorageEnabled=!1,e._ParseURL=function(D){document.createElement("a").href=D;var w=D.substring(0,D.lastIndexOf("#")),N=D.substring(w.lastIndexOf("/")+1,D.length);return D.substring(0,D.indexOf(N,0))},e._ReturnFullUrlLocation=function(D){return-1===D.indexOf("http:/")&&-1===D.indexOf("https:/")?e._ParseURL(window.location.href)+D:D},e}(),Vd=function(){function e(){this.direction1=new z.e(0,1,0),this.direction2=new z.e(0,1,0),this.minEmitBox=new z.e(-.5,-.5,-.5),this.maxEmitBox=new z.e(.5,.5,.5)}return e.prototype.startDirectionFunction=function(D,w,N,F){var k=De.a.RandomRange(this.direction1.x,this.direction2.x),j=De.a.RandomRange(this.direction1.y,this.direction2.y),G=De.a.RandomRange(this.direction1.z,this.direction2.z);if(F)return w.x=k,w.y=j,void(w.z=G);z.e.TransformNormalFromFloatsToRef(k,j,G,D,w)},e.prototype.startPositionFunction=function(D,w,N,F){var k=De.a.RandomRange(this.minEmitBox.x,this.maxEmitBox.x),j=De.a.RandomRange(this.minEmitBox.y,this.maxEmitBox.y),G=De.a.RandomRange(this.minEmitBox.z,this.maxEmitBox.z);if(F)return w.x=k,w.y=j,void(w.z=G);z.e.TransformCoordinatesFromFloatsToRef(k,j,G,D,w)},e.prototype.clone=function(){var D=new e;return xe.a.DeepCopy(this,D),D},e.prototype.applyToShader=function(D){D.setVector3("direction1",this.direction1),D.setVector3("direction2",this.direction2),D.setVector3("minEmitBox",this.minEmitBox),D.setVector3("maxEmitBox",this.maxEmitBox)},e.prototype.getEffectDefines=function(){return"#define BOXEMITTER"},e.prototype.getClassName=function(){return"BoxParticleEmitter"},e.prototype.serialize=function(){var D={};return D.type=this.getClassName(),D.direction1=this.direction1.asArray(),D.direction2=this.direction2.asArray(),D.minEmitBox=this.minEmitBox.asArray(),D.maxEmitBox=this.maxEmitBox.asArray(),D},e.prototype.parse=function(D){z.e.FromArrayToRef(D.direction1,0,this.direction1),z.e.FromArrayToRef(D.direction2,0,this.direction2),z.e.FromArrayToRef(D.minEmitBox,0,this.minEmitBox),z.e.FromArrayToRef(D.maxEmitBox,0,this.maxEmitBox)},e}(),zd=function(){function e(D,w,N){void 0===D&&(D=1),void 0===w&&(w=Math.PI),void 0===N&&(N=0),this.directionRandomizer=N,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=w,this.radius=D}return Object.defineProperty(e.prototype,"radius",{get:function(){return this._radius},set:function(D){this._radius=D,this._buildHeight()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"angle",{get:function(){return this._angle},set:function(D){this._angle=D,this._buildHeight()},enumerable:!0,configurable:!0}),e.prototype._buildHeight=function(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1},e.prototype.startDirectionFunction=function(D,w,N,F){if(1===Math.abs(Math.cos(this._angle))){if(F)return w.x=0,w.y=1,void(w.z=0);z.e.TransformNormalFromFloatsToRef(0,1,0,D,w)}else{var k=N.position.subtract(D.getTranslation()).normalize(),j=De.a.RandomRange(0,this.directionRandomizer),G=De.a.RandomRange(0,this.directionRandomizer),H=De.a.RandomRange(0,this.directionRandomizer);if(k.x+=j,k.y+=G,k.z+=H,k.normalize(),F)return void w.copyFrom(k);z.e.TransformNormalFromFloatsToRef(k.x,k.y,k.z,D,w)}},e.prototype.startPositionFunction=function(D,w,N,F){var k,j=De.a.RandomRange(0,2*Math.PI);k=this.emitFromSpawnPointOnly?1e-4:1-(k=De.a.RandomRange(0,this.heightRange))*k;var G=this._radius-De.a.RandomRange(0,this._radius*this.radiusRange),H=(G*=k)*Math.sin(j),X=G*Math.cos(j),q=k*this._height;if(F)return w.x=H,w.y=q,void(w.z=X);z.e.TransformCoordinatesFromFloatsToRef(H,q,X,D,w)},e.prototype.clone=function(){var D=new e(this._radius,this._angle,this.directionRandomizer);return xe.a.DeepCopy(this,D),D},e.prototype.applyToShader=function(D){D.setFloat2("radius",this._radius,this.radiusRange),D.setFloat("coneAngle",this._angle),D.setFloat2("height",this._height,this.heightRange),D.setFloat("directionRandomizer",this.directionRandomizer)},e.prototype.getEffectDefines=function(){var D="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(D+="\n#define CONEEMITTERSPAWNPOINT"),D},e.prototype.getClassName=function(){return"ConeParticleEmitter"},e.prototype.serialize=function(){var D={};return D.type=this.getClassName(),D.radius=this._radius,D.angle=this._angle,D.directionRandomizer=this.directionRandomizer,D.radiusRange=this.radiusRange,D.heightRange=this.heightRange,D.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,D},e.prototype.parse=function(D){this.radius=D.radius,this.angle=D.angle,this.directionRandomizer=D.directionRandomizer,this.radiusRange=D.radiusRange,this.heightRange=D.heightRange,this.emitFromSpawnPointOnly=D.emitFromSpawnPointOnly},e}(),Yd=function(){function e(D,w,N,F){void 0===D&&(D=1),void 0===w&&(w=1),void 0===N&&(N=1),void 0===F&&(F=0),this.radius=D,this.height=w,this.radiusRange=N,this.directionRandomizer=F}return e.prototype.startDirectionFunction=function(D,w,N,F){var k=N.position.subtract(D.getTranslation()).normalize(),j=De.a.RandomRange(-this.directionRandomizer/2,this.directionRandomizer/2),G=Math.atan2(k.x,k.z);G+=De.a.RandomRange(-Math.PI/2,Math.PI/2)*this.directionRandomizer,k.y=j,k.x=Math.sin(G),k.z=Math.cos(G),k.normalize(),F?w.copyFrom(k):z.e.TransformNormalFromFloatsToRef(k.x,k.y,k.z,D,w)},e.prototype.startPositionFunction=function(D,w,N,F){var k=De.a.RandomRange(-this.height/2,this.height/2),j=De.a.RandomRange(0,2*Math.PI),G=De.a.RandomRange((1-this.radiusRange)*(1-this.radiusRange),1),H=Math.sqrt(G)*this.radius,X=H*Math.cos(j),q=H*Math.sin(j);F?w.copyFromFloats(X,k,q):z.e.TransformCoordinatesFromFloatsToRef(X,k,q,D,w)},e.prototype.clone=function(){var D=new e(this.radius,this.directionRandomizer);return xe.a.DeepCopy(this,D),D},e.prototype.applyToShader=function(D){D.setFloat("radius",this.radius),D.setFloat("height",this.height),D.setFloat("radiusRange",this.radiusRange),D.setFloat("directionRandomizer",this.directionRandomizer)},e.prototype.getEffectDefines=function(){return"#define CYLINDEREMITTER"},e.prototype.getClassName=function(){return"CylinderParticleEmitter"},e.prototype.serialize=function(){var D={};return D.type=this.getClassName(),D.radius=this.radius,D.height=this.height,D.radiusRange=this.radiusRange,D.directionRandomizer=this.directionRandomizer,D},e.prototype.parse=function(D){this.radius=D.radius,this.height=D.height,this.radiusRange=D.radiusRange,this.directionRandomizer=D.directionRandomizer},e}(),Hd=function(D){function t(w,N,F,k,j){void 0===w&&(w=1),void 0===N&&(N=1),void 0===F&&(F=1),void 0===k&&(k=new z.e(0,1,0)),void 0===j&&(j=new z.e(0,1,0));var G=D.call(this,w,N,F)||this;return G.direction1=k,G.direction2=j,G}return Object(Z.d)(t,D),t.prototype.startDirectionFunction=function(D,w,N){var F=De.a.RandomRange(this.direction1.x,this.direction2.x),k=De.a.RandomRange(this.direction1.y,this.direction2.y),j=De.a.RandomRange(this.direction1.z,this.direction2.z);z.e.TransformNormalFromFloatsToRef(F,k,j,D,w)},t.prototype.clone=function(){var D=new t(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return xe.a.DeepCopy(this,D),D},t.prototype.applyToShader=function(D){D.setFloat("radius",this.radius),D.setFloat("height",this.height),D.setFloat("radiusRange",this.radiusRange),D.setVector3("direction1",this.direction1),D.setVector3("direction2",this.direction2)},t.prototype.getEffectDefines=function(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"},t.prototype.getClassName=function(){return"CylinderDirectedParticleEmitter"},t.prototype.serialize=function(){var w=D.prototype.serialize.call(this);return w.direction1=this.direction1.asArray(),w.direction2=this.direction2.asArray(),w},t.prototype.parse=function(w){D.prototype.parse.call(this,w),this.direction1.copyFrom(w.direction1),this.direction2.copyFrom(w.direction2)},t}(Yd),Wd=function(){function e(D,w,N){void 0===D&&(D=1),void 0===w&&(w=1),void 0===N&&(N=0),this.radius=D,this.radiusRange=w,this.directionRandomizer=N}return e.prototype.startDirectionFunction=function(D,w,N,F){var k=N.position.subtract(D.getTranslation()).normalize(),j=De.a.RandomRange(0,this.directionRandomizer),G=De.a.RandomRange(0,this.directionRandomizer),H=De.a.RandomRange(0,this.directionRandomizer);k.x+=j,k.y+=G,k.z+=H,k.normalize(),F?w.copyFrom(k):z.e.TransformNormalFromFloatsToRef(k.x,k.y,k.z,D,w)},e.prototype.startPositionFunction=function(D,w,N,F){var k=this.radius-De.a.RandomRange(0,this.radius*this.radiusRange),j=De.a.RandomRange(0,1),G=De.a.RandomRange(0,2*Math.PI),H=Math.acos(2*j-1),X=k*Math.cos(G)*Math.sin(H),q=k*Math.cos(H),Z=k*Math.sin(G)*Math.sin(H);F?w.copyFromFloats(X,Math.abs(q),Z):z.e.TransformCoordinatesFromFloatsToRef(X,Math.abs(q),Z,D,w)},e.prototype.clone=function(){var D=new e(this.radius,this.directionRandomizer);return xe.a.DeepCopy(this,D),D},e.prototype.applyToShader=function(D){D.setFloat("radius",this.radius),D.setFloat("radiusRange",this.radiusRange),D.setFloat("directionRandomizer",this.directionRandomizer)},e.prototype.getEffectDefines=function(){return"#define HEMISPHERICEMITTER"},e.prototype.getClassName=function(){return"HemisphericParticleEmitter"},e.prototype.serialize=function(){var D={};return D.type=this.getClassName(),D.radius=this.radius,D.radiusRange=this.radiusRange,D.directionRandomizer=this.directionRandomizer,D},e.prototype.parse=function(D){this.radius=D.radius,this.radiusRange=D.radiusRange,this.directionRandomizer=D.directionRandomizer},e}(),Xd=function(){function e(){this.direction1=new z.e(0,1,0),this.direction2=new z.e(0,1,0)}return e.prototype.startDirectionFunction=function(D,w,N,F){var k=De.a.RandomRange(this.direction1.x,this.direction2.x),j=De.a.RandomRange(this.direction1.y,this.direction2.y),G=De.a.RandomRange(this.direction1.z,this.direction2.z);F?w.copyFromFloats(k,j,G):z.e.TransformNormalFromFloatsToRef(k,j,G,D,w)},e.prototype.startPositionFunction=function(D,w,N,F){F?w.copyFromFloats(0,0,0):z.e.TransformCoordinatesFromFloatsToRef(0,0,0,D,w)},e.prototype.clone=function(){var D=new e;return xe.a.DeepCopy(this,D),D},e.prototype.applyToShader=function(D){D.setVector3("direction1",this.direction1),D.setVector3("direction2",this.direction2)},e.prototype.getEffectDefines=function(){return"#define POINTEMITTER"},e.prototype.getClassName=function(){return"PointParticleEmitter"},e.prototype.serialize=function(){var D={};return D.type=this.getClassName(),D.direction1=this.direction1.asArray(),D.direction2=this.direction2.asArray(),D},e.prototype.parse=function(D){z.e.FromArrayToRef(D.direction1,0,this.direction1),z.e.FromArrayToRef(D.direction2,0,this.direction2)},e}(),Qd=function(){function e(D,w,N){void 0===D&&(D=1),void 0===w&&(w=1),void 0===N&&(N=0),this.radius=D,this.radiusRange=w,this.directionRandomizer=N}return e.prototype.startDirectionFunction=function(D,w,N,F){var k=N.position.subtract(D.getTranslation()).normalize(),j=De.a.RandomRange(0,this.directionRandomizer),G=De.a.RandomRange(0,this.directionRandomizer),H=De.a.RandomRange(0,this.directionRandomizer);k.x+=j,k.y+=G,k.z+=H,k.normalize(),F?w.copyFrom(k):z.e.TransformNormalFromFloatsToRef(k.x,k.y,k.z,D,w)},e.prototype.startPositionFunction=function(D,w,N,F){var k=this.radius-De.a.RandomRange(0,this.radius*this.radiusRange),j=De.a.RandomRange(0,1),G=De.a.RandomRange(0,2*Math.PI),H=Math.acos(2*j-1),X=k*Math.cos(G)*Math.sin(H),q=k*Math.cos(H),Z=k*Math.sin(G)*Math.sin(H);F?w.copyFromFloats(X,q,Z):z.e.TransformCoordinatesFromFloatsToRef(X,q,Z,D,w)},e.prototype.clone=function(){var D=new e(this.radius,this.directionRandomizer);return xe.a.DeepCopy(this,D),D},e.prototype.applyToShader=function(D){D.setFloat("radius",this.radius),D.setFloat("radiusRange",this.radiusRange),D.setFloat("directionRandomizer",this.directionRandomizer)},e.prototype.getEffectDefines=function(){return"#define SPHEREEMITTER"},e.prototype.getClassName=function(){return"SphereParticleEmitter"},e.prototype.serialize=function(){var D={};return D.type=this.getClassName(),D.radius=this.radius,D.radiusRange=this.radiusRange,D.directionRandomizer=this.directionRandomizer,D},e.prototype.parse=function(D){this.radius=D.radius,this.radiusRange=D.radiusRange,this.directionRandomizer=D.directionRandomizer},e}(),ef=function(D){function t(w,N,F){void 0===w&&(w=1),void 0===N&&(N=new z.e(0,1,0)),void 0===F&&(F=new z.e(0,1,0));var k=D.call(this,w)||this;return k.direction1=N,k.direction2=F,k}return Object(Z.d)(t,D),t.prototype.startDirectionFunction=function(D,w,N){var F=De.a.RandomRange(this.direction1.x,this.direction2.x),k=De.a.RandomRange(this.direction1.y,this.direction2.y),j=De.a.RandomRange(this.direction1.z,this.direction2.z);z.e.TransformNormalFromFloatsToRef(F,k,j,D,w)},t.prototype.clone=function(){var D=new t(this.radius,this.direction1,this.direction2);return xe.a.DeepCopy(this,D),D},t.prototype.applyToShader=function(D){D.setFloat("radius",this.radius),D.setFloat("radiusRange",this.radiusRange),D.setVector3("direction1",this.direction1),D.setVector3("direction2",this.direction2)},t.prototype.getEffectDefines=function(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"},t.prototype.getClassName=function(){return"SphereDirectedParticleEmitter"},t.prototype.serialize=function(){var w=D.prototype.serialize.call(this);return w.direction1=this.direction1.asArray(),w.direction2=this.direction2.asArray(),w},t.prototype.parse=function(w){D.prototype.parse.call(this,w),this.direction1.copyFrom(w.direction1),this.direction2.copyFrom(w.direction2)},t}(Qd),af=function(){function e(){this.particlePositionGenerator=function(){},this.particleDestinationGenerator=function(){}}return e.prototype.startDirectionFunction=function(D,w,N,F){var k=z.c.Vector3[0];if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,N,k);var j=z.c.Vector3[1];k.subtractToRef(N.position,j),j.scaleToRef(1/N.lifeTime,k)}else k.set(0,0,0);F?w.copyFrom(k):z.e.TransformNormalToRef(k,D,w)},e.prototype.startPositionFunction=function(D,w,N,F){var k=z.c.Vector3[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,N,k):k.set(0,0,0),F?w.copyFrom(k):z.e.TransformCoordinatesToRef(k,D,w)},e.prototype.clone=function(){var D=new e;return xe.a.DeepCopy(this,D),D},e.prototype.applyToShader=function(D){},e.prototype.getEffectDefines=function(){return"#define CUSTOMEMITTER"},e.prototype.getClassName=function(){return"CustomParticleEmitter"},e.prototype.serialize=function(){var D={};return D.type=this.getClassName(),D},e.prototype.parse=function(D){},e}(),cf=function(){function e(D){this.mesh=D,this._indices=null,this._positions=null,this._normals=null,this._storedNormal=z.e.Zero(),this.direction1=new z.e(0,1,0),this.direction2=new z.e(0,1,0),this.useMeshNormalsForDirection=!0,D&&(this._indices=D.getIndices(),this._positions=D.getVerticesData(Zi.b.PositionKind),this._normals=D.getVerticesData(Zi.b.NormalKind))}return e.prototype.startDirectionFunction=function(D,w,N,F){if(this.useMeshNormalsForDirection&&this._normals)z.e.TransformNormalToRef(this._storedNormal,D,w);else{var k=De.a.RandomRange(this.direction1.x,this.direction2.x),j=De.a.RandomRange(this.direction1.y,this.direction2.y),G=De.a.RandomRange(this.direction1.z,this.direction2.z);F?w.copyFromFloats(k,j,G):z.e.TransformNormalFromFloatsToRef(k,j,G,D,w)}},e.prototype.startPositionFunction=function(D,w,N,F){if(this._indices&&this._positions){var k=3*Math.random()*(this._indices.length/3)|0,j=Math.random(),G=Math.random()*(1-j),H=1-j-G,X=this._indices[k],q=this._indices[k+1],Z=this._indices[k+2],J=z.c.Vector3[0],$=z.c.Vector3[1],te=z.c.Vector3[2],ie=z.c.Vector3[3];z.e.FromArrayToRef(this._positions,3*X,J),z.e.FromArrayToRef(this._positions,3*q,$),z.e.FromArrayToRef(this._positions,3*Z,te),ie.x=j*J.x+G*$.x+H*te.x,ie.y=j*J.y+G*$.y+H*te.y,ie.z=j*J.z+G*$.z+H*te.z,F?w.copyFromFloats(ie.x,ie.y,ie.z):z.e.TransformCoordinatesFromFloatsToRef(ie.x,ie.y,ie.z,D,w),this.useMeshNormalsForDirection&&this._normals&&(z.e.FromArrayToRef(this._normals,3*X,J),z.e.FromArrayToRef(this._normals,3*q,$),z.e.FromArrayToRef(this._normals,3*Z,te),this._storedNormal.x=j*J.x+G*$.x+H*te.x,this._storedNormal.y=j*J.y+G*$.y+H*te.y,this._storedNormal.z=j*J.z+G*$.z+H*te.z)}},e.prototype.clone=function(){var D=new e(this.mesh);return xe.a.DeepCopy(this,D),D},e.prototype.applyToShader=function(D){D.setVector3("direction1",this.direction1),D.setVector3("direction2",this.direction2)},e.prototype.getEffectDefines=function(){return""},e.prototype.getClassName=function(){return"MeshParticleEmitter"},e.prototype.serialize=function(){var D,w={};return w.type=this.getClassName(),w.direction1=this.direction1.asArray(),w.direction2=this.direction2.asArray(),w.meshId=null===(D=this.mesh)||void 0===D?void 0:D.id,w.useMeshNormalsForDirection=this.useMeshNormalsForDirection,w},e.prototype.parse=function(D,w){z.e.FromArrayToRef(D.direction1,0,this.direction1),z.e.FromArrayToRef(D.direction2,0,this.direction2),D.meshId&&(this.mesh=w.getLastMeshByID(D.meshId)||void 0),this.useMeshNormalsForDirection=D.useMeshNormalsForDirection},e}(),_f=function(){function e(D){this.animations=[],this.renderingGroupId=0,this.emitter=z.e.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this.targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.noiseStrength=new z.e(10,10,10),this.onAnimationEnd=null,this.blendMode=e.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteRandomStartCell=!1,this.translationPivot=new z.d(0,0),this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.worldOffset=new z.e(0,0,0),this.gravity=z.e.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new G.b(1,1,1,1),this.color2=new G.b(1,1,1,1),this.colorDead=new G.b(0,0,0,1),this.textureMask=new G.b(1,1,1,1),this._isSubEmitter=!1,this.billboardMode=ce.a.PARTICLES_BILLBOARDMODE_ALL,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new Yi.b,this.id=D,this.name=D}return Object.defineProperty(e.prototype,"noiseTexture",{get:function(){return this._noiseTexture},set:function(D){this._noiseTexture!==D&&(this._noiseTexture=D,this._reset())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isAnimationSheetEnabled",{get:function(){return this._isAnimationSheetEnabled},set:function(D){this._isAnimationSheetEnabled!=D&&(this._isAnimationSheetEnabled=D,this._reset())},enumerable:!0,configurable:!0}),e.prototype.getScene=function(){return this._scene},e.prototype._hasTargetStopDurationDependantGradient=function(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0},e.prototype.getDragGradients=function(){return this._dragGradients},e.prototype.getLimitVelocityGradients=function(){return this._limitVelocityGradients},e.prototype.getColorGradients=function(){return this._colorGradients},e.prototype.getSizeGradients=function(){return this._sizeGradients},e.prototype.getColorRemapGradients=function(){return this._colorRemapGradients},e.prototype.getAlphaRemapGradients=function(){return this._alphaRemapGradients},e.prototype.getLifeTimeGradients=function(){return this._lifeTimeGradients},e.prototype.getAngularSpeedGradients=function(){return this._angularSpeedGradients},e.prototype.getVelocityGradients=function(){return this._velocityGradients},e.prototype.getStartSizeGradients=function(){return this._startSizeGradients},e.prototype.getEmitRateGradients=function(){return this._emitRateGradients},Object.defineProperty(e.prototype,"direction1",{get:function(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:z.e.Zero()},set:function(D){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=D)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"direction2",{get:function(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:z.e.Zero()},set:function(D){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=D)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minEmitBox",{get:function(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:z.e.Zero()},set:function(D){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=D)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxEmitBox",{get:function(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:z.e.Zero()},set:function(D){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=D)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isBillboardBased",{get:function(){return this._isBillboardBased},set:function(D){this._isBillboardBased!==D&&(this._isBillboardBased=D,this._reset())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(D){this._attachImageProcessingConfiguration(D)},enumerable:!0,configurable:!0}),e.prototype._attachImageProcessingConfiguration=function(D){D!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration=D||this._scene.imageProcessingConfiguration)},e.prototype._reset=function(){},e.prototype._removeGradientAndTexture=function(D,w,N){if(!w)return this;for(var F=0,k=0,j=w;k<j.length;k++){if(j[k].gradient===D){w.splice(F,1);break}F++}return N&&N.dispose(),this},e.prototype.createPointEmitter=function(D,w){var N=new Xd;return N.direction1=D,N.direction2=w,this.particleEmitterType=N,N},e.prototype.createHemisphericEmitter=function(D,w){void 0===D&&(D=1),void 0===w&&(w=1);var N=new Wd(D,w);return this.particleEmitterType=N,N},e.prototype.createSphereEmitter=function(D,w){void 0===D&&(D=1),void 0===w&&(w=1);var N=new Qd(D,w);return this.particleEmitterType=N,N},e.prototype.createDirectedSphereEmitter=function(D,w,N){void 0===D&&(D=1),void 0===w&&(w=new z.e(0,1,0)),void 0===N&&(N=new z.e(0,1,0));var F=new ef(D,w,N);return this.particleEmitterType=F,F},e.prototype.createCylinderEmitter=function(D,w,N,F){void 0===D&&(D=1),void 0===w&&(w=1),void 0===N&&(N=1),void 0===F&&(F=0);var k=new Yd(D,w,N,F);return this.particleEmitterType=k,k},e.prototype.createDirectedCylinderEmitter=function(D,w,N,F,k){void 0===D&&(D=1),void 0===w&&(w=1),void 0===N&&(N=1),void 0===F&&(F=new z.e(0,1,0)),void 0===k&&(k=new z.e(0,1,0));var j=new Hd(D,w,N,F,k);return this.particleEmitterType=j,j},e.prototype.createConeEmitter=function(D,w){void 0===D&&(D=1),void 0===w&&(w=Math.PI/4);var N=new zd(D,w);return this.particleEmitterType=N,N},e.prototype.createBoxEmitter=function(D,w,N,F){var k=new Vd;return this.particleEmitterType=k,this.direction1=D,this.direction2=w,this.minEmitBox=N,this.maxEmitBox=F,k},e.BLENDMODE_ONEONE=0,e.BLENDMODE_STANDARD=1,e.BLENDMODE_ADD=2,e.BLENDMODE_MULTIPLY=3,e.BLENDMODE_MULTIPLYADD=4,e}(),bf=function(){function e(){}return e.prototype.getColorToRef=function(D){this.color2?G.b.LerpToRef(this.color1,this.color2,Math.random(),D):D.copyFrom(this.color1)},e}(),Uu=function(){},Tf=function(){function e(){}return e.prototype.getFactor=function(){return void 0===this.factor2?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()},e}(),Sf=function(){function e(){}return e.GetCurrentGradient=function(D,w,N){for(var F=0;F<w.length-1;F++){var k=w[F],j=w[F+1];if(D>=k.gradient&&D<=j.gradient)return void N(k,j,(D-k.gradient)/(j.gradient-k.gradient))}var z=w.length-1;N(w[z],w[z],1)},e}(),Of=function(){function e(D){this.particleSystem=D,this.position=z.e.Zero(),this.direction=z.e.Zero(),this.color=new G.b(0,0,0,0),this.colorStep=new G.b(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new z.d(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new G.b(0,0,0,0),this._currentColor2=new G.b(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=e._Count++,this.particleSystem.isAnimationSheetEnabled&&this.updateCellInfoFromSystem()}return e.prototype.updateCellInfoFromSystem=function(){this.cellIndex=this.particleSystem.startSpriteCellID},e.prototype.updateCellIndex=function(){var D=this.age,w=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===w?(w=1,D=this._randomCellOffset):D+=this._randomCellOffset);var N=this._initialEndSpriteCellID-this._initialStartSpriteCellID,F=De.a.Clamp(D*w%this.lifeTime/this.lifeTime);this.cellIndex=this._initialStartSpriteCellID+F*N|0},e.prototype._inheritParticleInfoToSubEmitter=function(D){if(D.particleSystem.emitter.position){var w=D.particleSystem.emitter;w.position.copyFrom(this.position),D.inheritDirection&&w.setDirection(this.direction.normalize(),0,Math.PI/2)}else D.particleSystem.emitter.copyFrom(this.position);this.direction.scaleToRef(D.inheritedVelocityAmount/2,z.c.Vector3[0]),D.particleSystem._inheritedVelocityOffset.copyFrom(z.c.Vector3[0])},e.prototype._inheritParticleInfoToSubEmitters=function(){var D=this;this._attachedSubEmitters&&this._attachedSubEmitters.length>0&&this._attachedSubEmitters.forEach((function(w){D._inheritParticleInfoToSubEmitter(w)}))},e.prototype._reset=function(){this.age=0,this.id=e._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0},e.prototype.copyTo=function(D){D.position.copyFrom(this.position),this._initialDirection?D._initialDirection?D._initialDirection.copyFrom(this._initialDirection):D._initialDirection=this._initialDirection.clone():D._initialDirection=null,D.direction.copyFrom(this.direction),this._localPosition&&(D._localPosition?D._localPosition.copyFrom(this._localPosition):D._localPosition=this._localPosition.clone()),D.color.copyFrom(this.color),D.colorStep.copyFrom(this.colorStep),D.lifeTime=this.lifeTime,D.age=this.age,D._randomCellOffset=this._randomCellOffset,D.size=this.size,D.scale.copyFrom(this.scale),D.angle=this.angle,D.angularSpeed=this.angularSpeed,D.particleSystem=this.particleSystem,D.cellIndex=this.cellIndex,D.id=this.id,D._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(D._currentColorGradient=this._currentColorGradient,D._currentColor1.copyFrom(this._currentColor1),D._currentColor2.copyFrom(this._currentColor2)),this._currentSizeGradient&&(D._currentSizeGradient=this._currentSizeGradient,D._currentSize1=this._currentSize1,D._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(D._currentAngularSpeedGradient=this._currentAngularSpeedGradient,D._currentAngularSpeed1=this._currentAngularSpeed1,D._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(D._currentVelocityGradient=this._currentVelocityGradient,D._currentVelocity1=this._currentVelocity1,D._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(D._currentLimitVelocityGradient=this._currentLimitVelocityGradient,D._currentLimitVelocity1=this._currentLimitVelocity1,D._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(D._currentDragGradient=this._currentDragGradient,D._currentDrag1=this._currentDrag1,D._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(D._initialStartSpriteCellID=this._initialStartSpriteCellID,D._initialEndSpriteCellID=this._initialEndSpriteCellID),this.particleSystem.useRampGradients&&D.remapData.copyFrom(this.remapData),this._randomNoiseCoordinates1&&(D._randomNoiseCoordinates1?(D._randomNoiseCoordinates1.copyFrom(this._randomNoiseCoordinates1),D._randomNoiseCoordinates2.copyFrom(this._randomNoiseCoordinates2)):(D._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),D._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))},e._Count=0,e}();!function(D){D[D.ATTACHED=0]="ATTACHED",D[D.END=1]="END"}(Bd||(Bd={}));var Rf=function(){function e(D){this.particleSystem=D,this.type=Bd.END,this.inheritDirection=!1,this.inheritedVelocityAmount=0,D.emitter&&D.emitter.dispose||(D.emitter=new Wt.a("SubemitterSystemEmitter",D.getScene())),D.onDisposeObservable.add((function(){D.emitter&&D.emitter.dispose&&D.emitter.dispose()}))}return e.prototype.clone=function(){var D=this.particleSystem.emitter;D?D instanceof z.e?D=D.clone():D instanceof Wt.a&&((D=new xt.a("",D.getScene())).isVisible=!1):D=new z.e;var w=new e(this.particleSystem.clone("",D));return w.particleSystem.name+="Clone",w.type=this.type,w.inheritDirection=this.inheritDirection,w.inheritedVelocityAmount=this.inheritedVelocityAmount,w.particleSystem._disposeEmitterOnDispose=!0,w.particleSystem.disposeOnStop=!0,w},e.prototype.serialize=function(){var D={};return D.type=this.type,D.inheritDirection=this.inheritDirection,D.inheritedVelocityAmount=this.inheritedVelocityAmount,D.particleSystem=this.particleSystem.serialize(),D},e._ParseParticleSystem=function(D,w,N){throw It.a.WarnImport("ParseParticle")},e.Parse=function(D,w,N){var F=D.particleSystem,k=new e(e._ParseParticleSystem(F,w,N));return k.type=D.type,k.inheritDirection=D.inheritDirection,k.inheritedVelocityAmount=D.inheritedVelocityAmount,k.particleSystem._isSubEmitter=!0,k},e.prototype.dispose=function(){this.particleSystem.dispose()},e}();li.a.ShadersStore.particlesPixelShader="\nvarying vec2 vUV;\nvarying vec4 vColor;\nuniform vec4 textureMask;\nuniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\nuniform sampler2D rampSampler;\n#endif\nvoid main(void) {\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);\nvec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;\nfloat remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);\nvec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));\nbaseColor.rgb*=rampColor.rgb;\n\nfloat finalAlpha=baseColor.a;\nbaseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;\nbaseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n\n\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\nbaseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n}",li.a.ShadersStore.particlesVertexShader="\nattribute vec3 position;\nattribute vec4 color;\nattribute float angle;\nattribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;\n\nuniform mat4 view;\nuniform mat4 projection;\nuniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos;\n#endif\n\nvarying vec2 vUV;\nvarying vec4 vColor;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {\nvec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));\nvec3 zaxis=normalize(cross(yaxis,xaxis));\nvec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);\nvec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);\nvec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);\nmat3 rotMatrix=mat3(row0,row1,row2);\nvec3 alignedCorner=rotMatrix*rotatedCorner;\nreturn position+alignedCorner;\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {\nvec3 normalizedToCamera=normalize(toCamera);\nvec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));\nvec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);\nvec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\nvec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\nmat3 rotMatrix=mat3(row0,row1,row2);\nvec3 alignedCorner=rotMatrix*rotatedCorner;\nreturn position+alignedCorner;\n}\n#endif\nvoid main(void) {\nvec2 cornerPos;\ncornerPos=(vec2(offset.x-0.5,offset.y-0.5)-translationPivot)*size+translationPivot;\n#ifdef BILLBOARD\n\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.y=0.;\nvec3 yaxis=position-eyePosition;\nyaxis.y=0.;\nvec3 worldPos=rotate(normalize(yaxis),rotatedCorner);\nvec3 viewPos=(view*vec4(worldPos,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\nvec3 toCamera=position-eyePosition;\nvec3 worldPos=rotateAlign(toCamera,rotatedCorner);\nvec3 viewPos=(view*vec4(worldPos,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\nvec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\n\ngl_Position=projection*vec4(viewPos,1.0);\n#else\n\nvec3 rotatedCorner;\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.y=0.;\nvec3 yaxis=normalize(direction);\nvec3 worldPos=rotate(yaxis,rotatedCorner);\ngl_Position=projection*view*vec4(worldPos,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/particlesInfos.z);\nfloat columnOffset=cellIndex-rowOffset*particlesInfos.z;\nvec2 uvScale=particlesInfos.xy;\nvec2 uvOffset=vec2(offset.x ,1.0-offset.y);\nvUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nvec4 worldPos=invView*vec4(viewPos,1.0);\n#endif\n#include<clipPlaneVertex>\n}";var Nf=function(D){function t(w,N,F,k,H,X){void 0===k&&(k=null),void 0===H&&(H=!1),void 0===X&&(X=.01);var q=D.call(this,w)||this;return q._inheritedVelocityOffset=new z.e,q.onDisposeObservable=new j.c,q._particles=new Array,q._stockParticles=new Array,q._newPartsExcess=0,q._vertexBuffers={},q._scaledColorStep=new G.b(0,0,0,0),q._colorDiff=new G.b(0,0,0,0),q._scaledDirection=z.e.Zero(),q._scaledGravity=z.e.Zero(),q._currentRenderId=-1,q._useInstancing=!1,q._started=!1,q._stopped=!1,q._actualFrame=0,q._currentEmitRate1=0,q._currentEmitRate2=0,q._currentStartSize1=0,q._currentStartSize2=0,q._rawTextureWidth=256,q._useRampGradients=!1,q._disposeEmitterOnDispose=!1,q.isLocal=!1,q.recycleParticle=function(D){var w=q._particles.pop();w!==D&&w.copyTo(D),q._stockParticles.push(w)},q._createParticle=function(){var D;if(0!==q._stockParticles.length?(D=q._stockParticles.pop())._reset():D=new Of(q),q._subEmitters&&q._subEmitters.length>0){var w=q._subEmitters[Math.floor(Math.random()*q._subEmitters.length)];D._attachedSubEmitters=[],w.forEach((function(w){if(w.type===Bd.ATTACHED){var N=w.clone();D._attachedSubEmitters.push(N),N.particleSystem.start()}}))}return D},q._emitFromParticle=function(D){if(q._subEmitters&&0!==q._subEmitters.length){var w=Math.floor(Math.random()*q._subEmitters.length);q._subEmitters[w].forEach((function(w){if(w.type===Bd.END){var N=w.clone();D._inheritParticleInfoToSubEmitter(N),N.particleSystem._rootParticleSystem=q,q.activeSubSystems.push(N.particleSystem),N.particleSystem.start()}}))}},q._capacity=N,q._epsilon=X,q._isAnimationSheetEnabled=H,q._scene=F||Me.a.LastCreatedScene,q._attachImageProcessingConfiguration(null),q._customEffect=k,q._scene.particleSystems.push(q),q._useInstancing=q._scene.getEngine().getCaps().instancedArrays,q._createIndexBuffer(),q._createVertexBuffers(),q.particleEmitterType=new Vd,q.updateFunction=function(D){var w=null,N=null;q.noiseTexture&&(w=q.noiseTexture.getSize(),N=q.noiseTexture.getContent());for(var F,r=function(){F=D[k];var j=q._scaledUpdateSpeed,H=F.age;if(F.age+=j,F.age>F.lifeTime){var X=F.age-H;j=(F.lifeTime-H)*j/X,F.age=F.lifeTime}var Z=F.age/F.lifeTime;q._colorGradients&&q._colorGradients.length>0?Sf.GetCurrentGradient(Z,q._colorGradients,(function(D,w,N){D!==F._currentColorGradient&&(F._currentColor1.copyFrom(F._currentColor2),w.getColorToRef(F._currentColor2),F._currentColorGradient=D),G.b.LerpToRef(F._currentColor1,F._currentColor2,N,F.color)})):(F.colorStep.scaleToRef(j,q._scaledColorStep),F.color.addInPlace(q._scaledColorStep),F.color.a<0&&(F.color.a=0)),q._angularSpeedGradients&&q._angularSpeedGradients.length>0&&Sf.GetCurrentGradient(Z,q._angularSpeedGradients,(function(D,w,N){D!==F._currentAngularSpeedGradient&&(F._currentAngularSpeed1=F._currentAngularSpeed2,F._currentAngularSpeed2=w.getFactor(),F._currentAngularSpeedGradient=D),F.angularSpeed=De.a.Lerp(F._currentAngularSpeed1,F._currentAngularSpeed2,N)})),F.angle+=F.angularSpeed*j;var J=j;if(q._velocityGradients&&q._velocityGradients.length>0&&Sf.GetCurrentGradient(Z,q._velocityGradients,(function(D,w,N){D!==F._currentVelocityGradient&&(F._currentVelocity1=F._currentVelocity2,F._currentVelocity2=w.getFactor(),F._currentVelocityGradient=D),J*=De.a.Lerp(F._currentVelocity1,F._currentVelocity2,N)})),F.direction.scaleToRef(J,q._scaledDirection),q._limitVelocityGradients&&q._limitVelocityGradients.length>0&&Sf.GetCurrentGradient(Z,q._limitVelocityGradients,(function(D,w,N){D!==F._currentLimitVelocityGradient&&(F._currentLimitVelocity1=F._currentLimitVelocity2,F._currentLimitVelocity2=w.getFactor(),F._currentLimitVelocityGradient=D);var k=De.a.Lerp(F._currentLimitVelocity1,F._currentLimitVelocity2,N);F.direction.length()>k&&F.direction.scaleInPlace(q.limitVelocityDamping)})),q._dragGradients&&q._dragGradients.length>0&&Sf.GetCurrentGradient(Z,q._dragGradients,(function(D,w,N){D!==F._currentDragGradient&&(F._currentDrag1=F._currentDrag2,F._currentDrag2=w.getFactor(),F._currentDragGradient=D);var k=De.a.Lerp(F._currentDrag1,F._currentDrag2,N);q._scaledDirection.scaleInPlace(1-k)})),q.isLocal?(F._localPosition.addInPlace(q._scaledDirection),z.e.TransformCoordinatesToRef(F._localPosition,q._emitterWorldMatrix,F.position)):F.position.addInPlace(q._scaledDirection),N&&w&&F._randomNoiseCoordinates1){var $=q._fetchR(F._randomNoiseCoordinates1.x,F._randomNoiseCoordinates1.y,w.width,w.height,N),te=q._fetchR(F._randomNoiseCoordinates1.z,F._randomNoiseCoordinates2.x,w.width,w.height,N),ie=q._fetchR(F._randomNoiseCoordinates2.y,F._randomNoiseCoordinates2.z,w.width,w.height,N),oe=z.c.Vector3[0],ce=z.c.Vector3[1];oe.copyFromFloats((2*$-1)*q.noiseStrength.x,(2*te-1)*q.noiseStrength.y,(2*ie-1)*q.noiseStrength.z),oe.scaleToRef(j,ce),F.direction.addInPlace(ce)}if(q.gravity.scaleToRef(j,q._scaledGravity),F.direction.addInPlace(q._scaledGravity),q._sizeGradients&&q._sizeGradients.length>0&&Sf.GetCurrentGradient(Z,q._sizeGradients,(function(D,w,N){D!==F._currentSizeGradient&&(F._currentSize1=F._currentSize2,F._currentSize2=w.getFactor(),F._currentSizeGradient=D),F.size=De.a.Lerp(F._currentSize1,F._currentSize2,N)})),q._useRampGradients&&(q._colorRemapGradients&&q._colorRemapGradients.length>0&&Sf.GetCurrentGradient(Z,q._colorRemapGradients,(function(D,w,N){var k=De.a.Lerp(D.factor1,w.factor1,N),j=De.a.Lerp(D.factor2,w.factor2,N);F.remapData.x=k,F.remapData.y=j-k})),q._alphaRemapGradients&&q._alphaRemapGradients.length>0&&Sf.GetCurrentGradient(Z,q._alphaRemapGradients,(function(D,w,N){var k=De.a.Lerp(D.factor1,w.factor1,N),j=De.a.Lerp(D.factor2,w.factor2,N);F.remapData.z=k,F.remapData.w=j-k}))),q._isAnimationSheetEnabled&&F.updateCellIndex(),F._inheritParticleInfoToSubEmitters(),F.age>=F.lifeTime)return q._emitFromParticle(F),F._attachedSubEmitters&&(F._attachedSubEmitters.forEach((function(D){D.particleSystem.disposeOnStop=!0,D.particleSystem.stop()})),F._attachedSubEmitters=null),q.recycleParticle(F),k--,"continue"},k=0;k<D.length;k++)r()},q}return Object(Z.d)(t,D),Object.defineProperty(t.prototype,"onDispose",{set:function(D){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useRampGradients",{get:function(){return this._useRampGradients},set:function(D){this._useRampGradients!==D&&(this._useRampGradients=D,this._resetEffect())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"particles",{get:function(){return this._particles},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"ParticleSystem"},t.prototype._addFactorGradient=function(D,w,N,F){var k=new Tf;k.gradient=w,k.factor1=N,k.factor2=F,D.push(k),D.sort((function(D,w){return D.gradient<w.gradient?-1:D.gradient>w.gradient?1:0}))},t.prototype._removeFactorGradient=function(D,w){if(D)for(var N=0,F=0,k=D;F<k.length;F++){if(k[F].gradient===w){D.splice(N,1);break}N++}},t.prototype.addLifeTimeGradient=function(D,w,N){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,D,w,N),this},t.prototype.removeLifeTimeGradient=function(D){return this._removeFactorGradient(this._lifeTimeGradients,D),this},t.prototype.addSizeGradient=function(D,w,N){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,D,w,N),this},t.prototype.removeSizeGradient=function(D){return this._removeFactorGradient(this._sizeGradients,D),this},t.prototype.addColorRemapGradient=function(D,w,N){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,D,w,N),this},t.prototype.removeColorRemapGradient=function(D){return this._removeFactorGradient(this._colorRemapGradients,D),this},t.prototype.addAlphaRemapGradient=function(D,w,N){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,D,w,N),this},t.prototype.removeAlphaRemapGradient=function(D){return this._removeFactorGradient(this._alphaRemapGradients,D),this},t.prototype.addAngularSpeedGradient=function(D,w,N){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,D,w,N),this},t.prototype.removeAngularSpeedGradient=function(D){return this._removeFactorGradient(this._angularSpeedGradients,D),this},t.prototype.addVelocityGradient=function(D,w,N){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,D,w,N),this},t.prototype.removeVelocityGradient=function(D){return this._removeFactorGradient(this._velocityGradients,D),this},t.prototype.addLimitVelocityGradient=function(D,w,N){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,D,w,N),this},t.prototype.removeLimitVelocityGradient=function(D){return this._removeFactorGradient(this._limitVelocityGradients,D),this},t.prototype.addDragGradient=function(D,w,N){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,D,w,N),this},t.prototype.removeDragGradient=function(D){return this._removeFactorGradient(this._dragGradients,D),this},t.prototype.addEmitRateGradient=function(D,w,N){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,D,w,N),this},t.prototype.removeEmitRateGradient=function(D){return this._removeFactorGradient(this._emitRateGradients,D),this},t.prototype.addStartSizeGradient=function(D,w,N){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,D,w,N),this},t.prototype.removeStartSizeGradient=function(D){return this._removeFactorGradient(this._emitRateGradients,D),this},t.prototype._createRampGradientTexture=function(){if(this._rampGradients&&this._rampGradients.length&&!this._rampGradientsTexture){for(var D=new Uint8Array(4*this._rawTextureWidth),w=G.c.Color3[0],N=0;N<this._rawTextureWidth;N++){var F=N/this._rawTextureWidth;Sf.GetCurrentGradient(F,this._rampGradients,(function(F,k,j){G.a.LerpToRef(F.color,k.color,j,w),D[4*N]=255*w.r,D[4*N+1]=255*w.g,D[4*N+2]=255*w.b,D[4*N+3]=255}))}this._rampGradientsTexture=en.CreateRGBATexture(D,this._rawTextureWidth,1,this._scene,!1,!1,Jt.a.NEAREST_SAMPLINGMODE)}},t.prototype.getRampGradients=function(){return this._rampGradients},t.prototype.addRampGradient=function(D,w){this._rampGradients||(this._rampGradients=[]);var N=new Uu;return N.gradient=D,N.color=w,this._rampGradients.push(N),this._rampGradients.sort((function(D,w){return D.gradient<w.gradient?-1:D.gradient>w.gradient?1:0})),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture(),this},t.prototype.removeRampGradient=function(D){return this._removeGradientAndTexture(D,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this},t.prototype.addColorGradient=function(D,w,N){this._colorGradients||(this._colorGradients=[]);var F=new bf;return F.gradient=D,F.color1=w,F.color2=N,this._colorGradients.push(F),this._colorGradients.sort((function(D,w){return D.gradient<w.gradient?-1:D.gradient>w.gradient?1:0})),this},t.prototype.removeColorGradient=function(D){if(!this._colorGradients)return this;for(var w=0,N=0,F=this._colorGradients;N<F.length;N++){if(F[N].gradient===D){this._colorGradients.splice(w,1);break}w++}return this},t.prototype._fetchR=function(D,w,N,F,k){return k[4*(((D=.5*Math.abs(D)+.5)*N%N|0)+((w=.5*Math.abs(w)+.5)*F%F|0)*N)]/255},t.prototype._reset=function(){this._resetEffect()},t.prototype._resetEffect=function(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._createVertexBuffers()},t.prototype._createVertexBuffers=function(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&this.billboardMode!==t.BILLBOARDMODE_STRETCHED||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);var D=this._scene.getEngine();this._vertexData=new Float32Array(this._capacity*this._vertexBufferSize*(this._useInstancing?1:4)),this._vertexBuffer=new Zi.a(D,this._vertexData,!0,this._vertexBufferSize);var w=0,N=this._vertexBuffer.createVertexBuffer(Zi.b.PositionKind,w,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[Zi.b.PositionKind]=N,w+=3;var F=this._vertexBuffer.createVertexBuffer(Zi.b.ColorKind,w,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[Zi.b.ColorKind]=F,w+=4;var k=this._vertexBuffer.createVertexBuffer("angle",w,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=k,w+=1;var j,z=this._vertexBuffer.createVertexBuffer("size",w,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=z,w+=2,this._isAnimationSheetEnabled){var G=this._vertexBuffer.createVertexBuffer("cellIndex",w,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=G,w+=1}if(!this._isBillboardBased||this.billboardMode===t.BILLBOARDMODE_STRETCHED){var H=this._vertexBuffer.createVertexBuffer("direction",w,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=H,w+=3}if(this._useRampGradients){var X=this._vertexBuffer.createVertexBuffer("remapData",w,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=X,w+=4}if(this._useInstancing){var q=new Float32Array([0,0,1,0,1,1,0,1]);this._spriteBuffer=new Zi.a(D,q,!1,2),j=this._spriteBuffer.createVertexBuffer("offset",0,2)}else j=this._vertexBuffer.createVertexBuffer("offset",w,2,this._vertexBufferSize,this._useInstancing),w+=2;this._vertexBuffers.offset=j},t.prototype._createIndexBuffer=function(){if(!this._useInstancing){for(var D=[],w=0,N=0;N<this._capacity;N++)D.push(w),D.push(w+1),D.push(w+2),D.push(w),D.push(w+2),D.push(w+3),w+=4;this._indexBuffer=this._scene.getEngine().createIndexBuffer(D)}},t.prototype.getCapacity=function(){return this._capacity},t.prototype.isAlive=function(){return this._alive},t.prototype.isStarted=function(){return this._started},t.prototype._prepareSubEmitterInternalArray=function(){var D=this;this._subEmitters=new Array,this.subEmitters&&this.subEmitters.forEach((function(w){w instanceof t?D._subEmitters.push([new Rf(w)]):w instanceof Rf?D._subEmitters.push([w]):w instanceof Array&&D._subEmitters.push(w)}))},t.prototype.start=function(D){var w=this;if(void 0===D&&(D=this.startDelay),!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(D)setTimeout((function(){w.start(0)}),D);else{if(this._prepareSubEmitterInternalArray(),this._started=!0,this._stopped=!1,this._actualFrame=0,this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=new Array),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){this.emitter instanceof Wt.a&&this.emitter.computeWorldMatrix(!0);var N=this.noiseTexture;if(N&&N.onGeneratedObservable)N.onGeneratedObservable.addOnce((function(){setTimeout((function(){for(var D=0;D<w.preWarmCycles;D++)w.animate(!0),N.render()}))}));else for(var F=0;F<this.preWarmCycles;F++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this.getScene().beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop)}},t.prototype.stop=function(D){void 0===D&&(D=!0),this._stopped=!0,D&&this._stopSubEmitters()},t.prototype.reset=function(){this._stockParticles=[],this._particles=[]},t.prototype._appendParticleVertex=function(D,w,N,F){var k=D*this._vertexBufferSize;if(this._vertexData[k++]=w.position.x+this.worldOffset.x,this._vertexData[k++]=w.position.y+this.worldOffset.y,this._vertexData[k++]=w.position.z+this.worldOffset.z,this._vertexData[k++]=w.color.r,this._vertexData[k++]=w.color.g,this._vertexData[k++]=w.color.b,this._vertexData[k++]=w.color.a,this._vertexData[k++]=w.angle,this._vertexData[k++]=w.scale.x*w.size,this._vertexData[k++]=w.scale.y*w.size,this._isAnimationSheetEnabled&&(this._vertexData[k++]=w.cellIndex),this._isBillboardBased)this.billboardMode===t.BILLBOARDMODE_STRETCHED&&(this._vertexData[k++]=w.direction.x,this._vertexData[k++]=w.direction.y,this._vertexData[k++]=w.direction.z);else if(w._initialDirection){var j=w._initialDirection;this.isLocal&&(z.e.TransformNormalToRef(j,this._emitterWorldMatrix,z.c.Vector3[0]),j=z.c.Vector3[0]),0===j.x&&0===j.z&&(j.x=.001),this._vertexData[k++]=j.x,this._vertexData[k++]=j.y,this._vertexData[k++]=j.z}else{var G=w.direction;this.isLocal&&(z.e.TransformNormalToRef(G,this._emitterWorldMatrix,z.c.Vector3[0]),G=z.c.Vector3[0]),0===G.x&&0===G.z&&(G.x=.001),this._vertexData[k++]=G.x,this._vertexData[k++]=G.y,this._vertexData[k++]=G.z}this._useRampGradients&&(this._vertexData[k++]=w.remapData.x,this._vertexData[k++]=w.remapData.y,this._vertexData[k++]=w.remapData.z,this._vertexData[k++]=w.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===N?N=this._epsilon:1===N&&(N=1-this._epsilon),0===F?F=this._epsilon:1===F&&(F=1-this._epsilon)),this._vertexData[k++]=N,this._vertexData[k++]=F)},t.prototype._stopSubEmitters=function(){this.activeSubSystems&&(this.activeSubSystems.forEach((function(D){D.stop(!0)})),this.activeSubSystems=new Array)},t.prototype._removeFromRoot=function(){if(this._rootParticleSystem){var D=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==D&&this._rootParticleSystem.activeSubSystems.splice(D,1),this._rootParticleSystem=null}},t.prototype._update=function(D){var w,N=this;if(this._alive=this._particles.length>0,this.emitter.position){var F=this.emitter;this._emitterWorldMatrix=F.getWorldMatrix()}else{var k=this.emitter;this._emitterWorldMatrix=z.a.Translation(k.x,k.y,k.z)}this.updateFunction(this._particles);for(var j,c=function(){if(H._particles.length===H._capacity)return"break";if(w=H._createParticle(),H._particles.push(w),H.targetStopDuration&&H._lifeTimeGradients&&H._lifeTimeGradients.length>0){var D=De.a.Clamp(H._actualFrame/H.targetStopDuration);Sf.GetCurrentGradient(D,H._lifeTimeGradients,(function(N,F){var k=N,j=F,z=k.getFactor(),G=j.getFactor(),H=(D-k.gradient)/(j.gradient-k.gradient);w.lifeTime=De.a.Lerp(z,G,H)}))}else w.lifeTime=De.a.RandomRange(H.minLifeTime,H.maxLifeTime);var F=De.a.RandomRange(H.minEmitPower,H.maxEmitPower);if(H.startPositionFunction?H.startPositionFunction(H._emitterWorldMatrix,w.position,w,H.isLocal):H.particleEmitterType.startPositionFunction(H._emitterWorldMatrix,w.position,w,H.isLocal),H.isLocal&&(w._localPosition?w._localPosition.copyFrom(w.position):w._localPosition=w.position.clone(),z.e.TransformCoordinatesToRef(w._localPosition,H._emitterWorldMatrix,w.position)),H.startDirectionFunction?H.startDirectionFunction(H._emitterWorldMatrix,w.direction,w,H.isLocal):H.particleEmitterType.startDirectionFunction(H._emitterWorldMatrix,w.direction,w,H.isLocal),0===F?w._initialDirection?w._initialDirection.copyFrom(w.direction):w._initialDirection=w.direction.clone():w._initialDirection=null,w.direction.scaleInPlace(F),H._sizeGradients&&0!==H._sizeGradients.length?(w._currentSizeGradient=H._sizeGradients[0],w._currentSize1=w._currentSizeGradient.getFactor(),w.size=w._currentSize1,H._sizeGradients.length>1?w._currentSize2=H._sizeGradients[1].getFactor():w._currentSize2=w._currentSize1):w.size=De.a.RandomRange(H.minSize,H.maxSize),w.scale.copyFromFloats(De.a.RandomRange(H.minScaleX,H.maxScaleX),De.a.RandomRange(H.minScaleY,H.maxScaleY)),H._startSizeGradients&&H._startSizeGradients[0]&&H.targetStopDuration){var k=H._actualFrame/H.targetStopDuration;Sf.GetCurrentGradient(k,H._startSizeGradients,(function(D,F,k){D!==N._currentStartSizeGradient&&(N._currentStartSize1=N._currentStartSize2,N._currentStartSize2=F.getFactor(),N._currentStartSizeGradient=D);var j=De.a.Lerp(N._currentStartSize1,N._currentStartSize2,k);w.scale.scaleInPlace(j)}))}H._angularSpeedGradients&&0!==H._angularSpeedGradients.length?(w._currentAngularSpeedGradient=H._angularSpeedGradients[0],w.angularSpeed=w._currentAngularSpeedGradient.getFactor(),w._currentAngularSpeed1=w.angularSpeed,H._angularSpeedGradients.length>1?w._currentAngularSpeed2=H._angularSpeedGradients[1].getFactor():w._currentAngularSpeed2=w._currentAngularSpeed1):w.angularSpeed=De.a.RandomRange(H.minAngularSpeed,H.maxAngularSpeed),w.angle=De.a.RandomRange(H.minInitialRotation,H.maxInitialRotation),H._velocityGradients&&H._velocityGradients.length>0&&(w._currentVelocityGradient=H._velocityGradients[0],w._currentVelocity1=w._currentVelocityGradient.getFactor(),H._velocityGradients.length>1?w._currentVelocity2=H._velocityGradients[1].getFactor():w._currentVelocity2=w._currentVelocity1),H._limitVelocityGradients&&H._limitVelocityGradients.length>0&&(w._currentLimitVelocityGradient=H._limitVelocityGradients[0],w._currentLimitVelocity1=w._currentLimitVelocityGradient.getFactor(),H._limitVelocityGradients.length>1?w._currentLimitVelocity2=H._limitVelocityGradients[1].getFactor():w._currentLimitVelocity2=w._currentLimitVelocity1),H._dragGradients&&H._dragGradients.length>0&&(w._currentDragGradient=H._dragGradients[0],w._currentDrag1=w._currentDragGradient.getFactor(),H._dragGradients.length>1?w._currentDrag2=H._dragGradients[1].getFactor():w._currentDrag2=w._currentDrag1),H._colorGradients&&0!==H._colorGradients.length?(w._currentColorGradient=H._colorGradients[0],w._currentColorGradient.getColorToRef(w.color),w._currentColor1.copyFrom(w.color),H._colorGradients.length>1?H._colorGradients[1].getColorToRef(w._currentColor2):w._currentColor2.copyFrom(w.color)):(j=De.a.RandomRange(0,1),G.b.LerpToRef(H.color1,H.color2,j,w.color),H.colorDead.subtractToRef(w.color,H._colorDiff),H._colorDiff.scaleToRef(1/w.lifeTime,w.colorStep)),H._isAnimationSheetEnabled&&(w._initialStartSpriteCellID=H.startSpriteCellID,w._initialEndSpriteCellID=H.endSpriteCellID),w.direction.addInPlace(H._inheritedVelocityOffset),H._useRampGradients&&(w.remapData=new z.f(0,1,0,1)),H.noiseTexture&&(w._randomNoiseCoordinates1?(w._randomNoiseCoordinates1.copyFromFloats(Math.random(),Math.random(),Math.random()),w._randomNoiseCoordinates2.copyFromFloats(Math.random(),Math.random(),Math.random())):(w._randomNoiseCoordinates1=new z.e(Math.random(),Math.random(),Math.random()),w._randomNoiseCoordinates2=new z.e(Math.random(),Math.random(),Math.random()))),w._inheritParticleInfoToSubEmitters()},H=this,X=0;X<D&&"break"!==c();X++);},t._GetAttributeNamesOrOptions=function(D,w,N){void 0===D&&(D=!1),void 0===w&&(w=!1),void 0===N&&(N=!1);var F=[Zi.b.PositionKind,Zi.b.ColorKind,"angle","offset","size"];return D&&F.push("cellIndex"),w||F.push("direction"),N&&F.push("remapData"),F},t._GetEffectCreationOptions=function(D){void 0===D&&(D=!1);var w=["invView","view","projection","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","textureMask","translationPivot","eyePosition"];return D&&w.push("particlesInfos"),w},t.prototype._getEffect=function(D){if(this._customEffect)return this._customEffect;var w=[];if(this._scene.clipPlane&&w.push("#define CLIPPLANE"),this._scene.clipPlane2&&w.push("#define CLIPPLANE2"),this._scene.clipPlane3&&w.push("#define CLIPPLANE3"),this._scene.clipPlane4&&w.push("#define CLIPPLANE4"),this._scene.clipPlane5&&w.push("#define CLIPPLANE5"),this._scene.clipPlane6&&w.push("#define CLIPPLANE6"),this._isAnimationSheetEnabled&&w.push("#define ANIMATESHEET"),D===t.BLENDMODE_MULTIPLY&&w.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&w.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(w.push("#define BILLBOARD"),this.billboardMode){case t.BILLBOARDMODE_Y:w.push("#define BILLBOARDY");break;case t.BILLBOARDMODE_STRETCHED:w.push("#define BILLBOARDSTRETCHED");break;case t.BILLBOARDMODE_ALL:}this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),w.push(this._imageProcessingConfigurationDefines.toString()));var N=w.join("\n");if(this._cachedDefines!==N){this._cachedDefines=N;var F=t._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&this.billboardMode!==t.BILLBOARDMODE_STRETCHED,this._useRampGradients),k=t._GetEffectCreationOptions(this._isAnimationSheetEnabled),j=["diffuseSampler","rampSampler"];Yi.a&&(Yi.a.PrepareUniforms(k,this._imageProcessingConfigurationDefines),Yi.a.PrepareSamplers(j,this._imageProcessingConfigurationDefines)),this._effect=this._scene.getEngine().createEffect("particles",F,k,j,N)}return this._effect},t.prototype.animate=function(D){var w=this;if(void 0===D&&(D=!1),this._started){if(!D){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}var N;if(this._scaledUpdateSpeed=this.updateSpeed*(D?this.preWarmStepOffset:this._scene.getAnimationRatio()),this.manualEmitCount>-1)N=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{var F=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){var k=this._actualFrame/this.targetStopDuration;Sf.GetCurrentGradient(k,this._emitRateGradients,(function(D,N,k){D!==w._currentEmitRateGradient&&(w._currentEmitRate1=w._currentEmitRate2,w._currentEmitRate2=N.getFactor(),w._currentEmitRateGradient=D),F=De.a.Lerp(w._currentEmitRate1,w._currentEmitRate2,k)}))}N=F*this._scaledUpdateSpeed>>0,this._newPartsExcess+=F*this._scaledUpdateSpeed-N}if(this._newPartsExcess>1&&(N+=this._newPartsExcess>>0,this._newPartsExcess-=this._newPartsExcess>>0),this._alive=!1,this._stopped?N=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(N),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene._toBeDisposed.push(this))),!D){for(var j=0,z=0;z<this._particles.length;z++){var G=this._particles[z];this._appendParticleVertices(j,G),j+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.update(this._vertexData)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}},t.prototype._appendParticleVertices=function(D,w){this._appendParticleVertex(D++,w,0,0),this._useInstancing||(this._appendParticleVertex(D++,w,1,0),this._appendParticleVertex(D++,w,1,1),this._appendParticleVertex(D++,w,0,1))},t.prototype.rebuild=function(){for(var D in this._createIndexBuffer(),this._vertexBuffer&&this._vertexBuffer._rebuild(),this._vertexBuffers)this._vertexBuffers[D]._rebuild()},t.prototype.isReady=function(){if(!(this.emitter&&this._imageProcessingConfiguration.isReady()&&this.particleTexture&&this.particleTexture.isReady()))return!1;if(this.blendMode!==t.BLENDMODE_MULTIPLYADD){if(!this._getEffect(this.blendMode).isReady())return!1}else{if(!this._getEffect(t.BLENDMODE_MULTIPLY).isReady())return!1;if(!this._getEffect(t.BLENDMODE_ADD).isReady())return!1}return!0},t.prototype._render=function(D){var w=this._getEffect(D),N=this._scene.getEngine();N.enableEffect(w);var F=this._scene.getViewMatrix();if(w.setTexture("diffuseSampler",this.particleTexture),w.setMatrix("view",F),w.setMatrix("projection",this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){var k=this.particleTexture.getBaseSize();w.setFloat3("particlesInfos",this.spriteCellWidth/k.width,this.spriteCellHeight/k.height,k.width/this.spriteCellWidth)}if(w.setVector2("translationPivot",this.translationPivot),w.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased){var j=this._scene.activeCamera;w.setVector3("eyePosition",j.globalPosition)}if(this._rampGradientsTexture&&w.setTexture("rampSampler",this._rampGradientsTexture),this._scene.clipPlane||this._scene.clipPlane2||this._scene.clipPlane3||this._scene.clipPlane4||this._scene.clipPlane5||this._scene.clipPlane6){var z=F.clone();z.invert(),w.setMatrix("invView",z),jo.a.BindClipPlane(w,this._scene)}switch(N.bindBuffers(this._vertexBuffers,this._indexBuffer,w),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(w),D){case t.BLENDMODE_ADD:N.setAlphaMode(ce.a.ALPHA_ADD);break;case t.BLENDMODE_ONEONE:N.setAlphaMode(ce.a.ALPHA_ONEONE);break;case t.BLENDMODE_STANDARD:N.setAlphaMode(ce.a.ALPHA_COMBINE);break;case t.BLENDMODE_MULTIPLY:N.setAlphaMode(ce.a.ALPHA_MULTIPLY)}return this._useInstancing?N.drawArraysType(Ps.a.TriangleFanDrawMode,0,4,this._particles.length):N.drawElementsType(Ps.a.TriangleFillMode,0,6*this._particles.length),this._particles.length},t.prototype.render=function(){if(!this.isReady()||!this._particles.length)return 0;var D=this._scene.getEngine();D.setState(!1),this.forceDepthWrite&&D.setDepthWrite(!0);var w=0;return this.blendMode===t.BLENDMODE_MULTIPLYADD&&(w=this._render(t.BLENDMODE_MULTIPLY)+this._render(t.BLENDMODE_ADD)),w=this._render(this.blendMode),D.unbindInstanceAttributes(),D.setAlphaMode(ce.a.ALPHA_DISABLE),w},t.prototype.dispose=function(D){if(void 0===D&&(D=!0),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),D&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),D&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._removeFromRoot(),this._subEmitters&&this._subEmitters.length){for(var w=0;w<this._subEmitters.length;w++)for(var N=0,F=this._subEmitters[w];N<F.length;N++)F[N].dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.emitter&&this.emitter.dispose&&this.emitter.dispose(!0),(w=this._scene.particleSystems.indexOf(this))>-1&&this._scene.particleSystems.splice(w,1),this._scene._activeParticleSystems.dispose(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.reset()},t.prototype.clone=function(D,w){var N=null,F=null;if(null!=this.customShader){var k=(F=this.customShader).shaderOptions.defines.length>0?F.shaderOptions.defines.join("\n"):"";N=this._scene.getEngine().createEffectForParticles(F.shaderPath.fragmentElement,F.shaderOptions.uniforms,F.shaderOptions.samplers,k)}else this._customEffect&&(N=this._customEffect);var j=new t(D,this._capacity,this._scene,N);return j.customShader=F,xe.a.DeepCopy(this,j,["particles","customShader","noiseTexture","particleTexture","onDisposeObservable"]),void 0===w&&(w=this.emitter),j.noiseTexture=this.noiseTexture,j.emitter=w,this.particleTexture&&(this.particleTexture instanceof Xi?(j.particleTexture=this.particleTexture.clone(),j.particleTexture.getContext().drawImage(this.particleTexture.getContext().canvas,0,0),j.particleTexture.update()):j.particleTexture=new Jt.a(this.particleTexture.url,this._scene)),this._colorGradients&&this._colorGradients.forEach((function(D){j.addColorGradient(D.gradient,D.color1,D.color2)})),this._dragGradients&&this._dragGradients.forEach((function(D){j.addDragGradient(D.gradient,D.factor1,D.factor2)})),this._angularSpeedGradients&&this._angularSpeedGradients.forEach((function(D){j.addAngularSpeedGradient(D.gradient,D.factor1,D.factor2)})),this._emitRateGradients&&this._emitRateGradients.forEach((function(D){j.addEmitRateGradient(D.gradient,D.factor1,D.factor2)})),this._lifeTimeGradients&&this._lifeTimeGradients.forEach((function(D){j.addLifeTimeGradient(D.gradient,D.factor1,D.factor2)})),this._limitVelocityGradients&&this._limitVelocityGradients.forEach((function(D){j.addLimitVelocityGradient(D.gradient,D.factor1,D.factor2)})),this._sizeGradients&&this._sizeGradients.forEach((function(D){j.addSizeGradient(D.gradient,D.factor1,D.factor2)})),this._startSizeGradients&&this._startSizeGradients.forEach((function(D){j.addStartSizeGradient(D.gradient,D.factor1,D.factor2)})),this._velocityGradients&&this._velocityGradients.forEach((function(D){j.addVelocityGradient(D.gradient,D.factor1,D.factor2)})),this._rampGradients&&this._rampGradients.forEach((function(D){j.addRampGradient(D.gradient,D.color)})),this._colorRemapGradients&&this._colorRemapGradients.forEach((function(D){j.addColorRemapGradient(D.gradient,D.factor1,D.factor2)})),this._alphaRemapGradients&&this._alphaRemapGradients.forEach((function(D){j.addAlphaRemapGradient(D.gradient,D.factor1,D.factor2)})),this.preventAutoStart||j.start(),j},t.prototype.serialize=function(){var D={};if(t._Serialize(D,this),D.textureMask=this.textureMask.asArray(),D.customShader=this.customShader,D.preventAutoStart=this.preventAutoStart,this.subEmitters){D.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(var w=0,N=this._subEmitters;w<N.length;w++){for(var F=[],k=0,j=N[w];k<j.length;k++){var z=j[k];F.push(z.serialize())}D.subEmitters.push(F)}}return D},t._Serialize=function(D,w){if(D.name=w.name,D.id=w.id,D.capacity=w.getCapacity(),w.emitter.position){var N=w.emitter;D.emitterId=N.id}else{var F=w.emitter;D.emitter=F.asArray()}w.particleEmitterType&&(D.particleEmitterType=w.particleEmitterType.serialize()),w.particleTexture&&(D.textureName=w.particleTexture.name,D.invertY=w.particleTexture._invertY),D.isLocal=w.isLocal,Ie.a.AppendSerializedAnimations(w,D),D.beginAnimationOnStart=w.beginAnimationOnStart,D.beginAnimationFrom=w.beginAnimationFrom,D.beginAnimationTo=w.beginAnimationTo,D.beginAnimationLoop=w.beginAnimationLoop,D.startDelay=w.startDelay,D.renderingGroupId=w.renderingGroupId,D.isBillboardBased=w.isBillboardBased,D.billboardMode=w.billboardMode,D.minAngularSpeed=w.minAngularSpeed,D.maxAngularSpeed=w.maxAngularSpeed,D.minSize=w.minSize,D.maxSize=w.maxSize,D.minScaleX=w.minScaleX,D.maxScaleX=w.maxScaleX,D.minScaleY=w.minScaleY,D.maxScaleY=w.maxScaleY,D.minEmitPower=w.minEmitPower,D.maxEmitPower=w.maxEmitPower,D.minLifeTime=w.minLifeTime,D.maxLifeTime=w.maxLifeTime,D.emitRate=w.emitRate,D.gravity=w.gravity.asArray(),D.noiseStrength=w.noiseStrength.asArray(),D.color1=w.color1.asArray(),D.color2=w.color2.asArray(),D.colorDead=w.colorDead.asArray(),D.updateSpeed=w.updateSpeed,D.targetStopDuration=w.targetStopDuration,D.blendMode=w.blendMode,D.preWarmCycles=w.preWarmCycles,D.preWarmStepOffset=w.preWarmStepOffset,D.minInitialRotation=w.minInitialRotation,D.maxInitialRotation=w.maxInitialRotation,D.startSpriteCellID=w.startSpriteCellID,D.endSpriteCellID=w.endSpriteCellID,D.spriteCellChangeSpeed=w.spriteCellChangeSpeed,D.spriteCellWidth=w.spriteCellWidth,D.spriteCellHeight=w.spriteCellHeight,D.spriteRandomStartCell=w.spriteRandomStartCell,D.isAnimationSheetEnabled=w.isAnimationSheetEnabled;var k=w.getColorGradients();if(k){D.colorGradients=[];for(var j=0,z=k;j<z.length;j++){var G=z[j],H={gradient:G.gradient,color1:G.color1.asArray()};G.color2&&(H.color2=G.color2.asArray()),D.colorGradients.push(H)}}var X=w.getRampGradients();if(X){D.rampGradients=[];for(var q=0,Z=X;q<Z.length;q++){var J=Z[q];H={gradient:J.gradient,color:J.color.asArray()},D.rampGradients.push(H)}D.useRampGradients=w.useRampGradients}var $=w.getColorRemapGradients();if($){D.colorRemapGradients=[];for(var te=0,ie=$;te<ie.length;te++){var oe=ie[te];H={gradient:oe.gradient,factor1:oe.factor1},void 0!==oe.factor2&&(H.factor2=oe.factor2),D.colorRemapGradients.push(H)}}var ce=w.getAlphaRemapGradients();if(ce){D.alphaRemapGradients=[];for(var he=0,fe=ce;he<fe.length;he++){var pe=fe[he];H={gradient:pe.gradient,factor1:pe.factor1},void 0!==pe.factor2&&(H.factor2=pe.factor2),D.alphaRemapGradients.push(H)}}var _e=w.getSizeGradients();if(_e){D.sizeGradients=[];for(var ve=0,ye=_e;ve<ye.length;ve++){var be=ye[ve];H={gradient:be.gradient,factor1:be.factor1},void 0!==be.factor2&&(H.factor2=be.factor2),D.sizeGradients.push(H)}}var Te=w.getAngularSpeedGradients();if(Te){D.angularSpeedGradients=[];for(var Ee=0,Se=Te;Ee<Se.length;Ee++){var Me=Se[Ee];H={gradient:Me.gradient,factor1:Me.factor1},void 0!==Me.factor2&&(H.factor2=Me.factor2),D.angularSpeedGradients.push(H)}}var xe=w.getVelocityGradients();if(xe){D.velocityGradients=[];for(var Ae=0,Pe=xe;Ae<Pe.length;Ae++){var Oe=Pe[Ae];H={gradient:Oe.gradient,factor1:Oe.factor1},void 0!==Oe.factor2&&(H.factor2=Oe.factor2),D.velocityGradients.push(H)}}var Re=w.getDragGradients();if(Re){D.dragGradients=[];for(var De=0,Le=Re;De<Le.length;De++){var we=Le[De];H={gradient:we.gradient,factor1:we.factor1},void 0!==we.factor2&&(H.factor2=we.factor2),D.dragGradients.push(H)}}var Ne=w.getEmitRateGradients();if(Ne){D.emitRateGradients=[];for(var Fe=0,Be=Ne;Fe<Be.length;Fe++){var Ue=Be[Fe];H={gradient:Ue.gradient,factor1:Ue.factor1},void 0!==Ue.factor2&&(H.factor2=Ue.factor2),D.emitRateGradients.push(H)}}var Ve=w.getStartSizeGradients();if(Ve){D.startSizeGradients=[];for(var ze=0,Ge=Ve;ze<Ge.length;ze++){var Ye=Ge[ze];H={gradient:Ye.gradient,factor1:Ye.factor1},void 0!==Ye.factor2&&(H.factor2=Ye.factor2),D.startSizeGradients.push(H)}}var He=w.getLifeTimeGradients();if(He){D.lifeTimeGradients=[];for(var We=0,Xe=He;We<Xe.length;We++){var Ke=Xe[We];H={gradient:Ke.gradient,factor1:Ke.factor1},void 0!==Ke.factor2&&(H.factor2=Ke.factor2),D.lifeTimeGradients.push(H)}}var Qe=w.getLimitVelocityGradients();if(Qe){D.limitVelocityGradients=[];for(var Ze=0,Je=Qe;Ze<Je.length;Ze++){var $e=Je[Ze];H={gradient:$e.gradient,factor1:$e.factor1},void 0!==$e.factor2&&(H.factor2=$e.factor2),D.limitVelocityGradients.push(H)}D.limitVelocityDamping=w.limitVelocityDamping}w.noiseTexture&&(D.noiseTexture=w.noiseTexture.serialize())},t._Parse=function(D,w,N,F){if(D.textureName&&(w.particleTexture=new Jt.a(F+D.textureName,N,!1,void 0===D.invertY||D.invertY),w.particleTexture.name=D.textureName),D.emitterId||0===D.emitterId||void 0!==D.emitter?D.emitterId?w.emitter=N.getLastMeshByID(D.emitterId):w.emitter=z.e.FromArray(D.emitter):w.emitter=z.e.Zero(),w.isLocal=!!D.isLocal,void 0!==D.renderingGroupId&&(w.renderingGroupId=D.renderingGroupId),void 0!==D.isBillboardBased&&(w.isBillboardBased=D.isBillboardBased),void 0!==D.billboardMode&&(w.billboardMode=D.billboardMode),D.animations){for(var k=0;k<D.animations.length;k++){var j=D.animations[k],X=H.a.GetClass("BABYLON.Animation");X&&w.animations.push(X.Parse(j))}w.beginAnimationOnStart=D.beginAnimationOnStart,w.beginAnimationFrom=D.beginAnimationFrom,w.beginAnimationTo=D.beginAnimationTo,w.beginAnimationLoop=D.beginAnimationLoop}if(D.autoAnimate&&N.beginAnimation(w,D.autoAnimateFrom,D.autoAnimateTo,D.autoAnimateLoop,D.autoAnimateSpeed||1),w.startDelay=0|D.startDelay,w.minAngularSpeed=D.minAngularSpeed,w.maxAngularSpeed=D.maxAngularSpeed,w.minSize=D.minSize,w.maxSize=D.maxSize,D.minScaleX&&(w.minScaleX=D.minScaleX,w.maxScaleX=D.maxScaleX,w.minScaleY=D.minScaleY,w.maxScaleY=D.maxScaleY),void 0!==D.preWarmCycles&&(w.preWarmCycles=D.preWarmCycles,w.preWarmStepOffset=D.preWarmStepOffset),void 0!==D.minInitialRotation&&(w.minInitialRotation=D.minInitialRotation,w.maxInitialRotation=D.maxInitialRotation),w.minLifeTime=D.minLifeTime,w.maxLifeTime=D.maxLifeTime,w.minEmitPower=D.minEmitPower,w.maxEmitPower=D.maxEmitPower,w.emitRate=D.emitRate,w.gravity=z.e.FromArray(D.gravity),D.noiseStrength&&(w.noiseStrength=z.e.FromArray(D.noiseStrength)),w.color1=G.b.FromArray(D.color1),w.color2=G.b.FromArray(D.color2),w.colorDead=G.b.FromArray(D.colorDead),w.updateSpeed=D.updateSpeed,w.targetStopDuration=D.targetStopDuration,w.blendMode=D.blendMode,D.colorGradients)for(var q=0,Z=D.colorGradients;q<Z.length;q++){var J=Z[q];w.addColorGradient(J.gradient,G.b.FromArray(J.color1),J.color2?G.b.FromArray(J.color2):void 0)}if(D.rampGradients){for(var $=0,te=D.rampGradients;$<te.length;$++){var ie=te[$];w.addRampGradient(ie.gradient,G.a.FromArray(ie.color))}w.useRampGradients=D.useRampGradients}if(D.colorRemapGradients)for(var oe=0,ce=D.colorRemapGradients;oe<ce.length;oe++){var he=ce[oe];w.addColorRemapGradient(he.gradient,void 0!==he.factor1?he.factor1:he.factor,he.factor2)}if(D.alphaRemapGradients)for(var fe=0,pe=D.alphaRemapGradients;fe<pe.length;fe++){var _e=pe[fe];w.addAlphaRemapGradient(_e.gradient,void 0!==_e.factor1?_e.factor1:_e.factor,_e.factor2)}if(D.sizeGradients)for(var ve=0,ye=D.sizeGradients;ve<ye.length;ve++){var be=ye[ve];w.addSizeGradient(be.gradient,void 0!==be.factor1?be.factor1:be.factor,be.factor2)}if(D.angularSpeedGradients)for(var Te=0,Ee=D.angularSpeedGradients;Te<Ee.length;Te++){var Se=Ee[Te];w.addAngularSpeedGradient(Se.gradient,void 0!==Se.factor1?Se.factor1:Se.factor,Se.factor2)}if(D.velocityGradients)for(var Me=0,xe=D.velocityGradients;Me<xe.length;Me++){var Ae=xe[Me];w.addVelocityGradient(Ae.gradient,void 0!==Ae.factor1?Ae.factor1:Ae.factor,Ae.factor2)}if(D.dragGradients)for(var Pe=0,Oe=D.dragGradients;Pe<Oe.length;Pe++){var Re=Oe[Pe];w.addDragGradient(Re.gradient,void 0!==Re.factor1?Re.factor1:Re.factor,Re.factor2)}if(D.emitRateGradients)for(var De=0,Ie=D.emitRateGradients;De<Ie.length;De++){var Le=Ie[De];w.addEmitRateGradient(Le.gradient,void 0!==Le.factor1?Le.factor1:Le.factor,Le.factor2)}if(D.startSizeGradients)for(var we=0,Ne=D.startSizeGradients;we<Ne.length;we++){var Fe=Ne[we];w.addStartSizeGradient(Fe.gradient,void 0!==Fe.factor1?Fe.factor1:Fe.factor,Fe.factor2)}if(D.lifeTimeGradients)for(var Be=0,Ue=D.lifeTimeGradients;Be<Ue.length;Be++){var Ve=Ue[Be];w.addLifeTimeGradient(Ve.gradient,void 0!==Ve.factor1?Ve.factor1:Ve.factor,Ve.factor2)}if(D.limitVelocityGradients){for(var ze=0,Ge=D.limitVelocityGradients;ze<Ge.length;ze++){var Ye=Ge[ze];w.addLimitVelocityGradient(Ye.gradient,void 0!==Ye.factor1?Ye.factor1:Ye.factor,Ye.factor2)}w.limitVelocityDamping=D.limitVelocityDamping}var He;if(D.noiseTexture&&(w.noiseTexture=uu.Parse(D.noiseTexture,N,F)),D.particleEmitterType){switch(D.particleEmitterType.type){case"SphereParticleEmitter":He=new Qd;break;case"SphereDirectedParticleEmitter":He=new ef;break;case"ConeEmitter":case"ConeParticleEmitter":He=new zd;break;case"CylinderParticleEmitter":He=new Yd;break;case"HemisphericParticleEmitter":He=new Wd;break;case"BoxEmitter":case"BoxParticleEmitter":default:He=new Vd}He.parse(D.particleEmitterType,N)}else(He=new Vd).parse(D,N);w.particleEmitterType=He,w.startSpriteCellID=D.startSpriteCellID,w.endSpriteCellID=D.endSpriteCellID,w.spriteCellWidth=D.spriteCellWidth,w.spriteCellHeight=D.spriteCellHeight,w.spriteCellChangeSpeed=D.spriteCellChangeSpeed,w.spriteRandomStartCell=D.spriteRandomStartCell},t.Parse=function(D,w,N,F){void 0===F&&(F=!1);var k=D.name,j=null,z=null;if(D.customShader){var H=(z=D.customShader).shaderOptions.defines.length>0?z.shaderOptions.defines.join("\n"):"";j=w.getEngine().createEffectForParticles(z.shaderPath.fragmentElement,z.shaderOptions.uniforms,z.shaderOptions.samplers,H)}var X=new t(k,D.capacity,w,j,D.isAnimationSheetEnabled);if(X.customShader=z,D.id&&(X.id=D.id),D.subEmitters){X.subEmitters=[];for(var q=0,Z=D.subEmitters;q<Z.length;q++){for(var J=[],$=0,te=Z[q];$<te.length;$++){var ie=te[$];J.push(Rf.Parse(ie,w,N))}X.subEmitters.push(J)}}return t._Parse(D,X,w,N),X.textureMask=G.b.FromArray(D.textureMask),D.preventAutoStart&&(X.preventAutoStart=D.preventAutoStart),F||X.preventAutoStart||X.start(),X},t.BILLBOARDMODE_Y=ce.a.PARTICLES_BILLBOARDMODE_Y,t.BILLBOARDMODE_ALL=ce.a.PARTICLES_BILLBOARDMODE_ALL,t.BILLBOARDMODE_STRETCHED=ce.a.PARTICLES_BILLBOARDMODE_STRETCHED,t}(_f);Rf._ParseParticleSystem=Nf.Parse,li.a.ShadersStore.gpuUpdateParticlesPixelShader="#version 300 es\nvoid main() {\ndiscard;\n}\n",li.a.ShadersStore.gpuUpdateParticlesVertexShader="#version 300 es\n#define PI 3.14159\nuniform float currentCount;\nuniform float timeDelta;\nuniform float stopFactor;\nuniform mat4 emitterWM;\nuniform vec2 lifeTime;\nuniform vec2 emitPower;\nuniform vec2 sizeRange;\nuniform vec4 scaleRange;\n#ifndef COLORGRADIENTS\nuniform vec4 color1;\nuniform vec4 color2;\n#endif\nuniform vec3 gravity;\nuniform sampler2D randomSampler;\nuniform sampler2D randomSampler2;\nuniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;\nuniform vec3 direction2;\nuniform vec3 minEmitBox;\nuniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;\nuniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;\nuniform float radiusRange;\nuniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;\nuniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;\nuniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;\nuniform float height;\nuniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;\nuniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;\nuniform float coneAngle;\nuniform vec2 height;\nuniform float directionRandomizer;\n#endif\n\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;\nin float life;\nin vec4 seed;\nin vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;\nin vec3 noiseCoordinates2;\n#endif\n\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;\nout float outLife;\nout vec4 outSeed;\nout vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;\nout vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif\n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;\nuniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;\nuniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {\nreturn texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;\n}\nvec4 getRandomVec4(float offset) {\nreturn texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));\n}\nvoid main() {\nfloat newAge=age+timeDelta;\n\nif (newAge>=life && stopFactor != 0.) {\nvec3 newPosition;\nvec3 newDirection;\n\nvec4 randoms=getRandomVec4(seed.x);\n\noutLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;\noutAge=newAge-life;\n\noutSeed=seed;\n\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;\noutSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a;\n#ifndef COLORGRADIENTS\n\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n\n#ifndef ANGULARSPEEDGRADIENTS\noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;\noutAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif\n\n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);\nvec3 randoms3=getRandomVec3(seed.z);\nnewPosition=vec3(0,0,0);\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);\nvec3 randoms3=getRandomVec3(seed.z);\nnewPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);\nvec3 randoms3=getRandomVec3(seed.z);\n\nfloat phi=2.0*PI*randoms2.x;\nfloat theta=acos(2.0*randoms2.y-1.0);\nfloat randX=cos(phi)*sin(theta);\nfloat randY=cos(theta);\nfloat randZ=sin(phi)*sin(theta);\nnewPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);\nnewDirection=newPosition+directionRandomizer*randoms3;\n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);\nvec3 randoms3=getRandomVec3(seed.z);\n\nfloat phi=2.0*PI*randoms2.x;\nfloat theta=acos(2.0*randoms2.y-1.0);\nfloat randX=cos(phi)*sin(theta);\nfloat randY=cos(theta);\nfloat randZ=sin(phi)*sin(theta);\nnewPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\n\nnewDirection=newPosition+directionRandomizer*randoms3;\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);\nvec3 randoms3=getRandomVec3(seed.z);\n\nfloat yPos=(randoms2.x-0.5)*height;\nfloat angle=randoms2.y*PI*2.;\nfloat inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));\nfloat positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));\nfloat xPos=positionRadius*cos(angle);\nfloat zPos=positionRadius*sin(angle);\nnewPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\n\nangle=angle+((randoms3.x-0.5)*PI);\nnewDirection=vec3(cos(angle),randoms3.y-0.5,sin(angle));\nnewDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);\nfloat s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;\n\nh=1.-h*h;\n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;\nlRadius=lRadius*h;\nfloat randX=lRadius*sin(s);\nfloat randZ=lRadius*cos(s);\nfloat randY=h*height.x;\nnewPosition=vec3(randX,randY,randZ);\n\nif (abs(cos(coneAngle)) == 1.0) {\nnewDirection=vec3(0.,1.0,0.);\n} else {\nvec3 randoms3=getRandomVec3(seed.z);\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n}\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;\noutInitialPosition=initialPosition;\n#else\n\nnewPosition=vec3(0.,0.,0.);\n\nnewDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD\noutInitialDirection=direction;\n#endif\n#else\nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\noutDirection=initial*power;\n#ifndef BILLBOARD\noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET\noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif\n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;\noutNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {\nfloat directionScale=timeDelta;\noutAge=newAge;\nfloat ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient;\noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;\noutSeed=seed;\n#ifndef COLORGRADIENTS\noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;\noutSize.yz=size.yz;\n#else\noutSize=size;\n#endif\n#ifndef BILLBOARD\noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;\nfloat currentVelocity=length(updatedDirection);\nif (currentVelocity>limitVelocity) {\nupdatedDirection=updatedDirection*limitVelocityDamping;\n}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nvec3 localPosition=outPosition-emitterWM[3].xyz;\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;\nfloat fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;\nfloat fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;\nvec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;\noutDirection=outDirection+force*timeDelta;\noutNoiseCoordinates1=noiseCoordinates1;\noutNoiseCoordinates2=noiseCoordinates2;\n#endif\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;\noutAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET\nfloat offsetAge=outAge;\nfloat dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;\noffsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif\nfloat ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}\n}",li.a.IncludesShadersStore.clipPlaneFragmentDeclaration2="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif",li.a.ShadersStore.gpuRenderParticlesPixelShader="#version 300 es\nuniform sampler2D textureSampler;\nin vec2 vUV;\nin vec4 vColor;\nout vec4 outFragColor;\n#include<clipPlaneFragmentDeclaration2>\n#include<imageProcessingDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\nvoid main() {\n#include<clipPlaneFragment>\nvec4 textureColor=texture(textureSampler,vUV);\noutFragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;\noutFragColor.rgb=outFragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif\n\n\n#ifdef IMAGEPROCESSINGPOSTPROCESS\noutFragColor.rgb=toLinearSpace(outFragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\noutFragColor.rgb=toLinearSpace(outFragColor.rgb);\noutFragColor=applyImageProcessing(outFragColor);\n#endif\n#endif\n}\n",li.a.IncludesShadersStore.clipPlaneVertexDeclaration2="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;\nout float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;\nout float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;\nout float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;\nout float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;\nout float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;\nout float fClipDistance6;\n#endif",li.a.ShadersStore.gpuRenderParticlesVertexShader="#version 300 es\nuniform mat4 view;\nuniform mat4 projection;\nuniform vec2 translationPivot;\nuniform vec3 worldOffset;\n\nin vec3 position;\nin float age;\nin float life;\nin vec3 size;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nin vec3 direction;\n#endif\nin float angle;\n#ifdef ANIMATESHEET\nin float cellIndex;\n#endif\nin vec2 offset;\nin vec2 uv;\nout vec2 vUV;\nout vec4 vColor;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;\nin vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {\nvec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));\nvec3 zaxis=normalize(cross(yaxis,xaxis));\nvec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);\nvec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);\nvec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);\nmat3 rotMatrix=mat3(row0,row1,row2);\nvec3 alignedCorner=rotMatrix*rotatedCorner;\nreturn (position+worldOffset)+alignedCorner;\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {\nvec3 normalizedToCamera=normalize(toCamera);\nvec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));\nvec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);\nvec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\nvec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\nmat3 rotMatrix=mat3(row0,row1,row2);\nvec3 alignedCorner=rotMatrix*rotatedCorner;\nreturn (position+worldOffset)+alignedCorner;\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);\nfloat columnOffset=cellIndex-rowOffset*sheetInfos.z;\nvec2 uvScale=sheetInfos.xy;\nvec2 uvOffset=vec2(uv.x ,1.0-uv.y);\nvUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=age/life;\n#ifdef COLORGRADIENTS\nvColor=texture(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x+translationPivot;\n#ifdef BILLBOARD\nvec4 rotatedCorner;\nrotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.y=0.;\nvec3 yaxis=(position+worldOffset)-eyePosition;\nyaxis.y=0.;\nvec3 worldPos=rotate(normalize(yaxis),rotatedCorner.xyz);\nvec4 viewPosition=(view*vec4(worldPos,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\nvec3 toCamera=(position+worldOffset)-eyePosition;\nvec3 worldPos=rotateAlign(toCamera,rotatedCorner.xyz);\nvec4 viewPosition=(view*vec4(worldPos,1.0));\n#else\n\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\n\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\n#else\n\nvec3 rotatedCorner;\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=0.;\nrotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nvec3 yaxis=normalize(initialDirection);\nvec3 worldPos=rotate(yaxis,rotatedCorner);\n\nvec4 viewPosition=view*vec4(worldPos,1.0);\n#endif\ngl_Position=projection*viewPosition;\n\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nvec4 worldPos=invView*viewPosition;\n#endif\n#include<clipPlaneVertex>\n}";var kf=function(D){function t(w,N,F,k){void 0===k&&(k=!1);var z=D.call(this,w)||this;z.layerMask=268435455,z._accumulatedCount=0,z._targetIndex=0,z._currentRenderId=-1,z._started=!1,z._stopped=!1,z._timeDelta=0,z._actualFrame=0,z._rawTextureWidth=256,z.onDisposeObservable=new j.c,z.forceDepthWrite=!1,z._preWarmDone=!1,z._scene=F||Me.a.LastCreatedScene,z._attachImageProcessingConfiguration(null),z._engine=z._scene.getEngine(),N.randomTextureSize||delete N.randomTextureSize;var G=Object(Z.a)({capacity:5e4,randomTextureSize:z._engine.getCaps().maxTextureSize},N),H=N;isFinite(H)&&(G.capacity=H),z._capacity=G.capacity,z._activeCount=G.capacity,z._currentActiveCount=0,z._isAnimationSheetEnabled=k,z._scene.particleSystems.push(z),z._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]},z.particleEmitterType=new Vd;for(var X=Math.min(z._engine.getCaps().maxTextureSize,G.randomTextureSize),q=[],J=0;J<X;++J)q.push(Math.random()),q.push(Math.random()),q.push(Math.random()),q.push(Math.random());for(z._randomTexture=new en(new Float32Array(q),X,1,ce.a.TEXTUREFORMAT_RGBA,z._scene,!1,!1,ce.a.TEXTURE_NEAREST_SAMPLINGMODE,ce.a.TEXTURETYPE_FLOAT),z._randomTexture.wrapU=Jt.a.WRAP_ADDRESSMODE,z._randomTexture.wrapV=Jt.a.WRAP_ADDRESSMODE,q=[],J=0;J<X;++J)q.push(Math.random()),q.push(Math.random()),q.push(Math.random()),q.push(Math.random());return z._randomTexture2=new en(new Float32Array(q),X,1,ce.a.TEXTUREFORMAT_RGBA,z._scene,!1,!1,ce.a.TEXTURE_NEAREST_SAMPLINGMODE,ce.a.TEXTURETYPE_FLOAT),z._randomTexture2.wrapU=Jt.a.WRAP_ADDRESSMODE,z._randomTexture2.wrapV=Jt.a.WRAP_ADDRESSMODE,z._randomTextureSize=X,z}return Object(Z.d)(t,D),Object.defineProperty(t,"IsSupported",{get:function(){return!!Me.a.LastCreatedEngine&&Me.a.LastCreatedEngine.webGLVersion>1},enumerable:!0,configurable:!0}),t.prototype.getCapacity=function(){return this._capacity},Object.defineProperty(t.prototype,"activeParticleCount",{get:function(){return this._activeCount},set:function(D){this._activeCount=Math.min(D,this._capacity)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isLocal",{get:function(){return!1},set:function(D){},enumerable:!0,configurable:!0}),t.prototype.isReady=function(){return this._updateEffect?!!(this.emitter&&this._updateEffect.isReady()&&this._imageProcessingConfiguration.isReady()&&this._renderEffect.isReady()&&this.particleTexture&&this.particleTexture.isReady()):(this._recreateUpdateEffect(),this._recreateRenderEffect(),!1)},t.prototype.isStarted=function(){return this._started},t.prototype.start=function(D){var w=this;if(void 0===D&&(D=this.startDelay),!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";D?setTimeout((function(){w.start(0)}),D):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this.getScene().beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))},t.prototype.stop=function(){this._stopped=!0},t.prototype.reset=function(){this._releaseBuffers(),this._releaseVAOs(),this._currentActiveCount=0,this._targetIndex=0},t.prototype.getClassName=function(){return"GPUParticleSystem"},t.prototype._removeGradientAndTexture=function(w,N,F){return D.prototype._removeGradientAndTexture.call(this,w,N,F),this._releaseBuffers(),this},t.prototype.addColorGradient=function(D,w,N){this._colorGradients||(this._colorGradients=[]);var F=new bf;return F.gradient=D,F.color1=w,this._colorGradients.push(F),this._colorGradients.sort((function(D,w){return D.gradient<w.gradient?-1:D.gradient>w.gradient?1:0})),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._releaseBuffers(),this},t.prototype.removeColorGradient=function(D){return this._removeGradientAndTexture(D,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this},t.prototype._addFactorGradient=function(D,w,N){var F=new Tf;F.gradient=w,F.factor1=N,D.push(F),D.sort((function(D,w){return D.gradient<w.gradient?-1:D.gradient>w.gradient?1:0})),this._releaseBuffers()},t.prototype.addSizeGradient=function(D,w){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,D,w),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._releaseBuffers(),this},t.prototype.removeSizeGradient=function(D){return this._removeGradientAndTexture(D,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this},t.prototype.addAngularSpeedGradient=function(D,w){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,D,w),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._releaseBuffers(),this},t.prototype.removeAngularSpeedGradient=function(D){return this._removeGradientAndTexture(D,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this},t.prototype.addVelocityGradient=function(D,w){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,D,w),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._releaseBuffers(),this},t.prototype.removeVelocityGradient=function(D){return this._removeGradientAndTexture(D,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this},t.prototype.addLimitVelocityGradient=function(D,w){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,D,w),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._releaseBuffers(),this},t.prototype.removeLimitVelocityGradient=function(D){return this._removeGradientAndTexture(D,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this},t.prototype.addDragGradient=function(D,w){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,D,w),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._releaseBuffers(),this},t.prototype.removeDragGradient=function(D){return this._removeGradientAndTexture(D,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this},t.prototype.addEmitRateGradient=function(D,w,N){return this},t.prototype.removeEmitRateGradient=function(D){return this},t.prototype.addStartSizeGradient=function(D,w,N){return this},t.prototype.removeStartSizeGradient=function(D){return this},t.prototype.addColorRemapGradient=function(D,w,N){return this},t.prototype.removeColorRemapGradient=function(){return this},t.prototype.addAlphaRemapGradient=function(D,w,N){return this},t.prototype.removeAlphaRemapGradient=function(){return this},t.prototype.addRampGradient=function(D,w){return this},t.prototype.removeRampGradient=function(){return this},t.prototype.getRampGradients=function(){return null},Object.defineProperty(t.prototype,"useRampGradients",{get:function(){return!1},set:function(D){},enumerable:!0,configurable:!0}),t.prototype.addLifeTimeGradient=function(D,w,N){return this},t.prototype.removeLifeTimeGradient=function(D){return this},t.prototype._reset=function(){this._releaseBuffers()},t.prototype._createUpdateVAO=function(D){var w={};w.position=D.createVertexBuffer("position",0,3);var N=3;this.particleEmitterType instanceof af&&(w.initialPosition=D.createVertexBuffer("initialPosition",N,3),N+=3),w.age=D.createVertexBuffer("age",N,1),N+=1,w.life=D.createVertexBuffer("life",N,1),N+=1,w.seed=D.createVertexBuffer("seed",N,4),N+=4,w.size=D.createVertexBuffer("size",N,3),N+=3,this._colorGradientsTexture||(w.color=D.createVertexBuffer("color",N,4),N+=4),w.direction=D.createVertexBuffer("direction",N,3),N+=3,this._isBillboardBased||(w.initialDirection=D.createVertexBuffer("initialDirection",N,3),N+=3),this._angularSpeedGradientsTexture?(w.angle=D.createVertexBuffer("angle",N,1),N+=1):(w.angle=D.createVertexBuffer("angle",N,2),N+=2),this._isAnimationSheetEnabled&&(w.cellIndex=D.createVertexBuffer("cellIndex",N,1),N+=1,this.spriteRandomStartCell&&(w.cellStartOffset=D.createVertexBuffer("cellStartOffset",N,1),N+=1)),this.noiseTexture&&(w.noiseCoordinates1=D.createVertexBuffer("noiseCoordinates1",N,3),N+=3,w.noiseCoordinates2=D.createVertexBuffer("noiseCoordinates2",N,3),N+=3);var F=this._engine.recordVertexArrayObject(w,null,this._updateEffect);return this._engine.bindArrayBuffer(null),F},t.prototype._createRenderVAO=function(D,w){var N={};N.position=D.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);var F=3;this.particleEmitterType instanceof af&&(F+=3),N.age=D.createVertexBuffer("age",F,1,this._attributesStrideSize,!0),F+=1,N.life=D.createVertexBuffer("life",F,1,this._attributesStrideSize,!0),F+=5,N.size=D.createVertexBuffer("size",F,3,this._attributesStrideSize,!0),F+=3,this._colorGradientsTexture||(N.color=D.createVertexBuffer("color",F,4,this._attributesStrideSize,!0),F+=4),this.billboardMode===Nf.BILLBOARDMODE_STRETCHED&&(N.direction=D.createVertexBuffer("direction",F,3,this._attributesStrideSize,!0)),F+=3,this._isBillboardBased||(N.initialDirection=D.createVertexBuffer("initialDirection",F,3,this._attributesStrideSize,!0),F+=3),N.angle=D.createVertexBuffer("angle",F,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?F++:F+=2,this._isAnimationSheetEnabled&&(N.cellIndex=D.createVertexBuffer("cellIndex",F,1,this._attributesStrideSize,!0),F+=1,this.spriteRandomStartCell&&(N.cellStartOffset=D.createVertexBuffer("cellStartOffset",F,1,this._attributesStrideSize,!0),F+=1)),this.noiseTexture&&(N.noiseCoordinates1=D.createVertexBuffer("noiseCoordinates1",F,3,this._attributesStrideSize,!0),F+=3,N.noiseCoordinates2=D.createVertexBuffer("noiseCoordinates2",F,3,this._attributesStrideSize,!0),F+=3),N.offset=w.createVertexBuffer("offset",0,2),N.uv=w.createVertexBuffer("uv",2,2);var k=this._engine.recordVertexArrayObject(N,null,this._renderEffect);return this._engine.bindArrayBuffer(null),k},t.prototype._initialize=function(D){if(void 0===D&&(D=!1),!this._buffer0||D){var w=this._scene.getEngine(),N=new Array;this._attributesStrideSize=21,this._targetIndex=0,this.particleEmitterType instanceof af&&(this._attributesStrideSize+=3),this.isBillboardBased||(this._attributesStrideSize+=3),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6);for(var F=this.particleEmitterType instanceof af,k=z.c.Vector3[0],j=0;j<this._capacity;j++)N.push(0),N.push(0),N.push(0),F&&(this.particleEmitterType.particlePositionGenerator(j,null,k),N.push(k.x),N.push(k.y),N.push(k.z)),N.push(0),N.push(0),N.push(Math.random()),N.push(Math.random()),N.push(Math.random()),N.push(Math.random()),N.push(0),N.push(0),N.push(0),this._colorGradientsTexture||(N.push(0),N.push(0),N.push(0),N.push(0)),F?(this.particleEmitterType.particleDestinationGenerator(j,null,k),N.push(k.x),N.push(k.y),N.push(k.z)):(N.push(0),N.push(0),N.push(0)),this.isBillboardBased||(N.push(0),N.push(0),N.push(0)),N.push(0),this._angularSpeedGradientsTexture||N.push(0),this._isAnimationSheetEnabled&&(N.push(0),this.spriteRandomStartCell&&N.push(0)),this.noiseTexture&&(N.push(Math.random()),N.push(Math.random()),N.push(Math.random()),N.push(Math.random()),N.push(Math.random()),N.push(Math.random()));var G=new Float32Array([.5,.5,1,1,-.5,.5,0,1,-.5,-.5,0,0,.5,-.5,1,0]);this._buffer0=new Zi.a(w,N,!1,this._attributesStrideSize),this._buffer1=new Zi.a(w,N,!1,this._attributesStrideSize),this._spriteBuffer=new Zi.a(w,G,!1,4),this._updateVAO=[],this._updateVAO.push(this._createUpdateVAO(this._buffer0)),this._updateVAO.push(this._createUpdateVAO(this._buffer1)),this._renderVAO=[],this._renderVAO.push(this._createRenderVAO(this._buffer1,this._spriteBuffer)),this._renderVAO.push(this._createRenderVAO(this._buffer0,this._spriteBuffer)),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}},t.prototype._recreateUpdateEffect=function(){var D=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";this._isBillboardBased&&(D+="\n#define BILLBOARD"),this._colorGradientsTexture&&(D+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(D+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(D+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(D+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(D+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(D+="\n#define DRAGGRADIENTS"),this.isAnimationSheetEnabled&&(D+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(D+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(D+="\n#define NOISE"),this._updateEffect&&this._updateEffectOptions.defines===D||(this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this.particleEmitterType instanceof af&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.defines=D,this._updateEffect=new li.a("gpuUpdateParticles",this._updateEffectOptions,this._scene.getEngine()))},t.prototype._recreateRenderEffect=function(){var D="";if(this._scene.clipPlane&&(D="\n#define CLIPPLANE"),this._scene.clipPlane2&&(D="\n#define CLIPPLANE2"),this._scene.clipPlane3&&(D="\n#define CLIPPLANE3"),this._scene.clipPlane4&&(D="\n#define CLIPPLANE4"),this._scene.clipPlane5&&(D="\n#define CLIPPLANE5"),this._scene.clipPlane6&&(D="\n#define CLIPPLANE6"),this.blendMode===Nf.BLENDMODE_MULTIPLY&&(D="\n#define BLENDMULTIPLYMODE"),this._isBillboardBased)switch(D+="\n#define BILLBOARD",this.billboardMode){case Nf.BILLBOARDMODE_Y:D+="\n#define BILLBOARDY";break;case Nf.BILLBOARDMODE_STRETCHED:D+="\n#define BILLBOARDSTRETCHED";break;case Nf.BILLBOARDMODE_ALL:}if(this._colorGradientsTexture&&(D+="\n#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&(D+="\n#define ANIMATESHEET"),this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),D+="\n"+this._imageProcessingConfigurationDefines.toString()),!this._renderEffect||this._renderEffect.defines!==D){var w=["worldOffset","view","projection","colorDead","invView","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","sheetInfos","translationPivot","eyePosition"],N=["textureSampler","colorGradientSampler"];Yi.a&&(Yi.a.PrepareUniforms(w,this._imageProcessingConfigurationDefines),Yi.a.PrepareSamplers(N,this._imageProcessingConfigurationDefines)),this._renderEffect=new li.a("gpuRenderParticles",["position","age","life","size","color","offset","uv","direction","initialDirection","angle","cellIndex"],w,N,this._scene.getEngine(),D)}},t.prototype.animate=function(D){void 0===D&&(D=!1),this._timeDelta=this.updateSpeed*(D?this.preWarmStepOffset:this._scene.getAnimationRatio()),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()},t.prototype._createFactorGradientTexture=function(D,w){var N=this[w];if(D&&D.length&&!N){for(var F=new Float32Array(this._rawTextureWidth),k=0;k<this._rawTextureWidth;k++){var j=k/this._rawTextureWidth;Sf.GetCurrentGradient(j,D,(function(D,w,N){F[k]=De.a.Lerp(D.factor1,w.factor1,N)}))}this[w]=en.CreateRTexture(F,this._rawTextureWidth,1,this._scene,!1,!1,Jt.a.NEAREST_SAMPLINGMODE)}},t.prototype._createSizeGradientTexture=function(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")},t.prototype._createAngularSpeedGradientTexture=function(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")},t.prototype._createVelocityGradientTexture=function(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")},t.prototype._createLimitVelocityGradientTexture=function(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")},t.prototype._createDragGradientTexture=function(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")},t.prototype._createColorGradientTexture=function(){if(this._colorGradients&&this._colorGradients.length&&!this._colorGradientsTexture){for(var D=new Uint8Array(4*this._rawTextureWidth),w=G.c.Color4[0],N=0;N<this._rawTextureWidth;N++){var F=N/this._rawTextureWidth;Sf.GetCurrentGradient(F,this._colorGradients,(function(F,k,j){G.b.LerpToRef(F.color1,k.color1,j,w),D[4*N]=255*w.r,D[4*N+1]=255*w.g,D[4*N+2]=255*w.b,D[4*N+3]=255*w.a}))}this._colorGradientsTexture=en.CreateRGBATexture(D,this._rawTextureWidth,1,this._scene,!1,!1,Jt.a.NEAREST_SAMPLINGMODE)}},t.prototype.render=function(D){if(void 0===D&&(D=!1),!this._started)return 0;if(this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture(),this._recreateUpdateEffect(),this._recreateRenderEffect(),!this.isReady())return 0;if(!D){if(!this._preWarmDone&&this.preWarmCycles){for(var w=0;w<this.preWarmCycles;w++)this.animate(!0),this.render(!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getFrameId())return 0;this._currentRenderId=this._scene.getFrameId()}if(this._initialize(),this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>1){var N=0|this._accumulatedCount;this._accumulatedCount-=N,this._currentActiveCount=Math.min(this._activeCount,this._currentActiveCount+N)}if(!this._currentActiveCount)return 0;var F;if(this._engine.enableEffect(this._updateEffect),this._engine.setState(!1),this._updateEffect.setFloat("currentCount",this._currentActiveCount),this._updateEffect.setFloat("timeDelta",this._timeDelta),this._updateEffect.setFloat("stopFactor",this._stopped?0:1),this._updateEffect.setTexture("randomSampler",this._randomTexture),this._updateEffect.setTexture("randomSampler2",this._randomTexture2),this._updateEffect.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateEffect.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateEffect.setDirectColor4("color1",this.color1),this._updateEffect.setDirectColor4("color2",this.color2)),this._updateEffect.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateEffect.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateEffect.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateEffect.setVector3("gravity",this.gravity),this._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._sizeGradientsTexture),this._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._angularSpeedGradientsTexture),this._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._velocityGradientsTexture),this._limitVelocityGradientsTexture&&(this._updateEffect.setTexture("limitVelocityGradientSampler",this._limitVelocityGradientsTexture),this._updateEffect.setFloat("limitVelocityDamping",this.limitVelocityDamping)),this._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._dragGradientsTexture),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateEffect),this._isAnimationSheetEnabled&&this._updateEffect.setFloat3("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed),this.noiseTexture&&(this._updateEffect.setTexture("noiseSampler",this.noiseTexture),this._updateEffect.setVector3("noiseStrength",this.noiseStrength)),this.emitter.position)F=this.emitter.getWorldMatrix();else{var k=this.emitter;F=z.a.Translation(k.x,k.y,k.z)}if(this._updateEffect.setMatrix("emitterWM",F),this._engine.bindVertexArrayObject(this._updateVAO[this._targetIndex],null),this._engine.bindTransformFeedbackBuffer(this._targetBuffer.getBuffer()),this._engine.setRasterizerState(!1),this._engine.beginTransformFeedback(!0),this._engine.drawArraysType(Ps.a.PointListDrawMode,0,this._currentActiveCount),this._engine.endTransformFeedback(),this._engine.setRasterizerState(!0),this._engine.bindTransformFeedbackBuffer(null),!D){this._engine.enableEffect(this._renderEffect);var j=this._scene.getViewMatrix();if(this._renderEffect.setMatrix("view",j),this._renderEffect.setMatrix("projection",this._scene.getProjectionMatrix()),this._renderEffect.setTexture("textureSampler",this.particleTexture),this._renderEffect.setVector2("translationPivot",this.translationPivot),this._renderEffect.setVector3("worldOffset",this.worldOffset),this._colorGradientsTexture?this._renderEffect.setTexture("colorGradientSampler",this._colorGradientsTexture):this._renderEffect.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){var G=this.particleTexture.getBaseSize();this._renderEffect.setFloat3("sheetInfos",this.spriteCellWidth/G.width,this.spriteCellHeight/G.height,G.width/this.spriteCellWidth)}if(this._isBillboardBased){var H=this._scene.activeCamera;this._renderEffect.setVector3("eyePosition",H.globalPosition)}if(this._scene.clipPlane||this._scene.clipPlane2||this._scene.clipPlane3||this._scene.clipPlane4||this._scene.clipPlane5||this._scene.clipPlane6){var X=j.clone();X.invert(),this._renderEffect.setMatrix("invView",X),jo.a.BindClipPlane(this._renderEffect,this._scene)}switch(this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._renderEffect),this.blendMode){case Nf.BLENDMODE_ADD:this._engine.setAlphaMode(ce.a.ALPHA_ADD);break;case Nf.BLENDMODE_ONEONE:this._engine.setAlphaMode(ce.a.ALPHA_ONEONE);break;case Nf.BLENDMODE_STANDARD:this._engine.setAlphaMode(ce.a.ALPHA_COMBINE);break;case Nf.BLENDMODE_MULTIPLY:this._engine.setAlphaMode(ce.a.ALPHA_MULTIPLY)}this.forceDepthWrite&&this._engine.setDepthWrite(!0),this._engine.bindVertexArrayObject(this._renderVAO[this._targetIndex],null),this._engine.drawArraysType(Ps.a.TriangleFanDrawMode,0,4,this._currentActiveCount),this._engine.setAlphaMode(ce.a.ALPHA_DISABLE)}this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);var q=this._sourceBuffer;return this._sourceBuffer=this._targetBuffer,this._targetBuffer=q,this._currentActiveCount},t.prototype.rebuild=function(){this._initialize(!0)},t.prototype._releaseBuffers=function(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null)},t.prototype._releaseVAOs=function(){if(this._updateVAO){for(var D=0;D<this._updateVAO.length;D++)this._engine.releaseVertexArrayObject(this._updateVAO[D]);for(this._updateVAO=[],D=0;D<this._renderVAO.length;D++)this._engine.releaseVertexArrayObject(this._renderVAO[D]);this._renderVAO=[]}},t.prototype.dispose=function(D){void 0===D&&(D=!0);var w=this._scene.particleSystems.indexOf(this);w>-1&&this._scene.particleSystems.splice(w,1),this._releaseBuffers(),this._releaseVAOs(),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),D&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),D&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()},t.prototype.clone=function(D,w){var N=new t(D,{capacity:this._capacity,randomTextureSize:this._randomTextureSize},this._scene);return xe.a.DeepCopy(this,N,["particles","customShader","noiseTexture","particleTexture","onDisposeObservable"]),void 0===w&&(w=this.emitter),N.emitter=w,this.particleTexture&&(N.particleTexture=new Jt.a(this.particleTexture.url,this._scene)),N.noiseTexture=this.noiseTexture,this._colorGradients&&this._colorGradients.forEach((function(D){N.addColorGradient(D.gradient,D.color1,D.color2)})),this._dragGradients&&this._dragGradients.forEach((function(D){N.addDragGradient(D.gradient,D.factor1)})),this._angularSpeedGradients&&this._angularSpeedGradients.forEach((function(D){N.addAngularSpeedGradient(D.gradient,D.factor1)})),this._emitRateGradients&&this._emitRateGradients.forEach((function(D){N.addEmitRateGradient(D.gradient,D.factor1,D.factor2)})),this._lifeTimeGradients&&this._lifeTimeGradients.forEach((function(D){N.addLifeTimeGradient(D.gradient,D.factor1,D.factor2)})),this._limitVelocityGradients&&this._limitVelocityGradients.forEach((function(D){N.addLimitVelocityGradient(D.gradient,D.factor1)})),this._sizeGradients&&this._sizeGradients.forEach((function(D){N.addSizeGradient(D.gradient,D.factor1)})),this._startSizeGradients&&this._startSizeGradients.forEach((function(D){N.addStartSizeGradient(D.gradient,D.factor1,D.factor2)})),this._velocityGradients&&this._velocityGradients.forEach((function(D){N.addVelocityGradient(D.gradient,D.factor1)})),this._rampGradients&&this._rampGradients.forEach((function(D){N.addRampGradient(D.gradient,D.color)})),this._colorRemapGradients&&this._colorRemapGradients.forEach((function(D){N.addColorRemapGradient(D.gradient,D.factor1,D.factor2)})),this._alphaRemapGradients&&this._alphaRemapGradients.forEach((function(D){N.addAlphaRemapGradient(D.gradient,D.factor1,D.factor2)})),N},t.prototype.serialize=function(){var D={};return Nf._Serialize(D,this),D.activeParticleCount=this.activeParticleCount,D},t.Parse=function(D,w,N,F){void 0===F&&(F=!1);var k=new t(D.name,{capacity:D.capacity,randomTextureSize:D.randomTextureSize},w);return D.activeParticleCount&&(k.activeParticleCount=D.activeParticleCount),Nf._Parse(D,k,w,N),D.preventAutoStart&&(k.preventAutoStart=D.preventAutoStart),F||k.preventAutoStart||k.start(),k},t}(_f),Uf=function(){function e(){this.systems=new Array}return Object.defineProperty(e.prototype,"emitterNode",{get:function(){return this._emitterNode},enumerable:!0,configurable:!0}),e.prototype.setEmitterAsSphere=function(D,w,N){this._emitterNode&&this._emitterNode.dispose(),this._emitterCreationOptions={kind:"Sphere",options:D,renderingGroupId:w};var F=vo.a.CreateSphere("emitterSphere",{diameter:D.diameter,segments:D.segments},N);F.renderingGroupId=w;var k=new Hi.a("emitterSphereMaterial",N);k.emissiveColor=D.color,F.material=k;for(var j=0,z=this.systems;j<z.length;j++)z[j].emitter=F;this._emitterNode=F},e.prototype.start=function(D){for(var w=0,N=this.systems;w<N.length;w++){var F=N[w];D&&(F.emitter=D),F.start()}},e.prototype.dispose=function(){for(var D=0,w=this.systems;D<w.length;D++)w[D].dispose();this.systems=[],this._emitterNode&&(this._emitterNode.dispose(),this._emitterNode=null)},e.prototype.serialize=function(){for(var D={systems:[]},w=0,N=this.systems;w<N.length;w++){var F=N[w];D.systems.push(F.serialize())}return this._emitterNode&&(D.emitter=this._emitterCreationOptions),D},e.Parse=function(D,w,N){void 0===N&&(N=!1);var F=new e,k=this.BaseAssetsUrl+"/textures/";w=w||Me.a.LastCreatedScene;for(var j=0,z=D.systems;j<z.length;j++){var H=z[j];F.systems.push(N?kf.Parse(H,w,k,!0):Nf.Parse(H,w,k,!0))}if(D.emitter){var X=D.emitter.options;switch(D.emitter.kind){case"Sphere":F.setEmitterAsSphere({diameter:X.diameter,segments:X.segments,color:G.a.FromArray(X.color)},D.emitter.renderingGroupId,w)}}return F},e.BaseAssetsUrl="https://assets.babylonjs.com/particles",e}(),Vf=function(){function e(){}return e.CreateDefault=function(D,w,N,F){var k;return void 0===w&&(w=500),void 0===F&&(F=!1),(k=F?new kf("default system",{capacity:w},N):new Nf("default system",w,N)).emitter=D,k.particleTexture=new Jt.a("https://www.babylonjs.com/assets/Flare.png",k.getScene()),k.createConeEmitter(.1,Math.PI/4),k.color1=new G.b(1,1,1,1),k.color2=new G.b(1,1,1,1),k.colorDead=new G.b(1,1,1,0),k.minSize=.1,k.maxSize=.1,k.minEmitPower=2,k.maxEmitPower=2,k.updateSpeed=1/60,k.emitRate=30,k},e.CreateAsync=function(D,w,N){void 0===N&&(N=!1),w||(w=Me.a.LastCreatedScene);var F={};return w._addPendingData(F),new Promise((function(k,j){if(N&&!kf.IsSupported)return w._removePendingData(F),j("Particle system with GPU is not supported.");Dt.b.LoadFile(e.BaseAssetsUrl+"/systems/"+D+".json",(function(D){w._removePendingData(F);var j=JSON.parse(D.toString());return k(Uf.Parse(j,w,N))}),void 0,void 0,void 0,(function(){return w._removePendingData(F),j("An error occured while the creation of your particle system. Check if your type '"+D+"' exists.")}))}))},e.ExportSet=function(D){for(var w=new Uf,N=0,F=D;N<F.length;N++){var k=F[N];w.systems.push(k)}return w},e.BaseAssetsUrl=Uf.BaseAssetsUrl,e}();F.a.AddParser(Nt.a.NAME_PARTICLESYSTEM,(function(D,w,N,k){var j=F.a.GetIndividualParser(Nt.a.NAME_PARTICLESYSTEM);if(j&&void 0!==D.particleSystems&&null!==D.particleSystems)for(var z=0,G=D.particleSystems.length;z<G;z++){var H=D.particleSystems[z];N.particleSystems.push(j(H,w,k))}})),F.a.AddIndividualParser(Nt.a.NAME_PARTICLESYSTEM,(function(D,w,N){return D.activeParticleCount?kf.Parse(D,w,N):Nf.Parse(D,w,N)})),Ct.a.prototype.createEffectForParticles=function(D,w,N,F,k,j,z){void 0===w&&(w=[]),void 0===N&&(N=[]),void 0===F&&(F="");var G=Nf._GetAttributeNamesOrOptions(),H=Nf._GetEffectCreationOptions();return-1===F.indexOf(" BILLBOARD")&&(F+="\n#define BILLBOARD\n"),-1===N.indexOf("diffuseSampler")&&N.push("diffuseSampler"),this.createEffect({vertex:"particles",fragmentElement:D},G,H.concat(w),N,F,k,j,z)},xt.a.prototype.getEmittedParticleSystems=function(){for(var D=new Array,w=0;w<this.getScene().particleSystems.length;w++){var N=this.getScene().particleSystems[w];N.emitter===this&&D.push(N)}return D},xt.a.prototype.getHierarchyEmittedParticleSystems=function(){var D=new Array,w=this.getDescendants();w.push(this);for(var N=0;N<this.getScene().particleSystems.length;N++){var F=this.getScene().particleSystems[N],k=F.emitter;k.position&&-1!==w.indexOf(k)&&D.push(F)}return D};var Yf,Hf=function(){function e(D,w,N,F,k,j,H,X,q,Z){void 0===q&&(q=null),void 0===Z&&(Z=null),this.idx=0,this.id=0,this.color=new G.b(1,1,1,1),this.position=z.e.Zero(),this.rotation=z.e.Zero(),this.scaling=z.e.One(),this.uvs=new z.f(0,0,1,1),this.velocity=z.e.Zero(),this.pivot=z.e.Zero(),this.translateFromPivot=!1,this.alive=!0,this.isVisible=!0,this._pos=0,this._ind=0,this.shapeId=0,this.idxInShape=0,this._stillInvisible=!1,this._rotationMatrix=[1,0,0,0,1,0,0,0,1],this.parentId=null,this.materialIndex=null,this.cullingStrategy=Wt.a.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,this._globalPosition=z.e.Zero(),this.idx=D,this.id=w,this._pos=N,this._ind=F,this._model=k,this.shapeId=j,this.idxInShape=H,this._sps=X,q&&(this._modelBoundingInfo=q,this._boundingInfo=new yr.a(q.minimum,q.maximum)),null!==Z&&(this.materialIndex=Z)}return e.prototype.copyToRef=function(D){return D.position.copyFrom(this.position),D.rotation.copyFrom(this.rotation),this.rotationQuaternion&&(D.rotationQuaternion?D.rotationQuaternion.copyFrom(this.rotationQuaternion):D.rotationQuaternion=this.rotationQuaternion.clone()),D.scaling.copyFrom(this.scaling),this.color&&(D.color?D.color.copyFrom(this.color):D.color=this.color.clone()),D.uvs.copyFrom(this.uvs),D.velocity.copyFrom(this.velocity),D.pivot.copyFrom(this.pivot),D.translateFromPivot=this.translateFromPivot,D.alive=this.alive,D.isVisible=this.isVisible,D.parentId=this.parentId,D.cullingStrategy=this.cullingStrategy,null!==this.materialIndex&&(D.materialIndex=this.materialIndex),this},Object.defineProperty(e.prototype,"scale",{get:function(){return this.scaling},set:function(D){this.scaling=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"quaternion",{get:function(){return this.rotationQuaternion},set:function(D){this.rotationQuaternion=D},enumerable:!0,configurable:!0}),e.prototype.intersectsMesh=function(D){return!(!this._boundingInfo||!D._boundingInfo)&&(this._sps._bSphereOnly?Tr.a.Intersects(this._boundingInfo.boundingSphere,D._boundingInfo.boundingSphere):this._boundingInfo.intersects(D._boundingInfo,!1))},e.prototype.isInFrustum=function(D){return null!==this._boundingInfo&&this._boundingInfo.isInFrustum(D,this.cullingStrategy)},e.prototype.getRotationMatrix=function(D){var w;if(this.rotationQuaternion)w=this.rotationQuaternion;else{w=z.c.Quaternion[0];var N=this.rotation;z.b.RotationYawPitchRollToRef(N.y,N.x,N.z,w)}w.toRotationMatrix(D)},e}(),ih=function(D,w,N,F,k,j,z,G,H){this._indicesLength=0,this.shapeID=D,this._shape=w,this._indices=N,this._indicesLength=N.length,this._shapeUV=j,this._shapeColors=k,this._normals=F,this._positionFunction=z,this._vertexFunction=G,this._material=H},nh=function(D,w,N){this.ind=0,this.indicesLength=0,this.sqDistance=0,this.materialIndex=0,this.ind=D,this.indicesLength=w,this.materialIndex=N},Wf=function(){function e(D,w,N){this.particles=new Array,this.nbParticles=0,this.billboard=!1,this.recomputeNormals=!1,this.counter=0,this.vars={},this._bSphereOnly=!1,this._bSphereRadiusFactor=1,this._positions=new Array,this._indices=new Array,this._normals=new Array,this._colors=new Array,this._uvs=new Array,this._index=0,this._updatable=!0,this._pickable=!1,this._isVisibilityBoxLocked=!1,this._alwaysVisible=!1,this._depthSort=!1,this._expandable=!1,this._shapeCounter=0,this._copy=new Hf(0,0,0,0,null,0,0,this),this._color=new G.b(0,0,0,0),this._computeParticleColor=!0,this._computeParticleTexture=!0,this._computeParticleRotation=!0,this._computeParticleVertex=!1,this._computeBoundingBox=!1,this._depthSortParticles=!0,this._mustUnrotateFixedNormals=!1,this._particlesIntersect=!1,this._needs32Bits=!1,this._isNotBuilt=!0,this._lastParticleId=0,this._idxOfId=[],this._multimaterialEnabled=!1,this._useModelMaterial=!1,this._depthSortFunction=function(D,w){return w.sqDistance-D.sqDistance},this._materialSortFunction=function(D,w){return D.materialIndex-w.materialIndex},this._autoUpdateSubMeshes=!1,this.name=D,this._scene=w||Me.a.LastCreatedScene,this._camera=w.activeCamera,this._pickable=!!N&&N.isPickable,this._depthSort=!!N&&N.enableDepthSort,this._multimaterialEnabled=!!N&&N.enableMultiMaterial,this._useModelMaterial=!!N&&N.useModelMaterial,this._multimaterialEnabled=!!this._useModelMaterial||this._multimaterialEnabled,this._expandable=!!N&&N.expandable,this._particlesIntersect=!!N&&N.particleIntersection,this._bSphereOnly=!!N&&N.boundingSphereOnly,this._bSphereRadiusFactor=N&&N.bSphereRadiusFactor?N.bSphereRadiusFactor:1,N&&void 0!==N.updatable?this._updatable=N.updatable:this._updatable=!0,this._pickable&&(this.pickedParticles=[]),(this._depthSort||this._multimaterialEnabled)&&(this.depthSortedParticles=[]),this._multimaterialEnabled&&(this._multimaterial=new rc.a(this.name+"MultiMaterial",this._scene),this._materials=[],this._materialIndexesById={})}return e.prototype.buildMesh=function(){if(!this._isNotBuilt&&this.mesh)return this.mesh;if(0===this.nbParticles&&!this.mesh){var D=Bh.CreateDisc("",{radius:1,tessellation:3},this._scene);this.addShape(D,1),D.dispose()}if(this._indices32=this._needs32Bits?new Uint32Array(this._indices):new Uint16Array(this._indices),this._positions32=new Float32Array(this._positions),this._uvs32=new Float32Array(this._uvs),this._colors32=new Float32Array(this._colors),!this.mesh){var w=new xt.a(this.name,this._scene);this.mesh=w}!this._updatable&&this._multimaterialEnabled&&this._sortParticlesByMaterial(),this.recomputeNormals&&qi.a.ComputeNormals(this._positions32,this._indices32,this._normals),this._normals32=new Float32Array(this._normals),this._fixedNormal32=new Float32Array(this._normals),this._mustUnrotateFixedNormals&&this._unrotateFixedNormals();var N=new qi.a;return N.indices=this._depthSort?this._indices:this._indices32,N.set(this._positions32,Zi.b.PositionKind),N.set(this._normals32,Zi.b.NormalKind),this._uvs32.length>0&&N.set(this._uvs32,Zi.b.UVKind),this._colors32.length>0&&N.set(this._colors32,Zi.b.ColorKind),N.applyToMesh(this.mesh,this._updatable),this.mesh.isPickable=this._pickable,this._multimaterialEnabled&&this.setMultiMaterial(this._materials),this._expandable||(this._depthSort||this._multimaterialEnabled||(this._indices=null),this._positions=null,this._normals=null,this._uvs=null,this._colors=null,this._updatable||(this.particles.length=0)),this._isNotBuilt=!1,this.recomputeNormals=!1,this.mesh},e.prototype.digest=function(D,w){var N=w&&w.facetNb||1,F=w&&w.number||0,k=w&&w.delta||0,j=D.getVerticesData(Zi.b.PositionKind),G=D.getIndices(),H=D.getVerticesData(Zi.b.UVKind),X=D.getVerticesData(Zi.b.ColorKind),q=D.getVerticesData(Zi.b.NormalKind),Z=w&&w.storage?w.storage:null,J=0,$=G.length/3;F?(F=F>$?$:F,N=Math.round($/F),k=0):N=N>$?$:N;for(var te=[],ie=[],oe=[],ce=[],he=[],fe=z.e.Zero(),pe=N;J<$;){J>$-(N=pe+Math.floor((1+k)*Math.random()))&&(N=$-J),te.length=0,ie.length=0,oe.length=0,ce.length=0,he.length=0;for(var _e=0,ve=3*J;ve<3*(J+N);ve++){oe.push(_e);var ye=G[ve],be=3*ye;if(te.push(j[be],j[be+1],j[be+2]),ie.push(q[be],q[be+1],q[be+2]),H){var Te=2*ye;ce.push(H[Te],H[Te+1])}if(X){var Ee=4*ye;he.push(X[Ee],X[Ee+1],X[Ee+2],X[Ee+3])}_e++}var Se,Me=this.nbParticles,xe=this._posToShape(te),Ae=this._uvsToShapeUV(ce),Pe=Array.from(oe),Oe=Array.from(he),Re=Array.from(ie);for(fe.copyFromFloats(0,0,0),Se=0;Se<xe.length;Se++)fe.addInPlace(xe[Se]);fe.scaleInPlace(1/xe.length);var De,Ie=new z.e(1/0,1/0,1/0),Le=new z.e(-1/0,-1/0,-1/0);for(Se=0;Se<xe.length;Se++)xe[Se].subtractInPlace(fe),Ie.minimizeInPlaceFromFloats(xe[Se].x,xe[Se].y,xe[Se].z),Le.maximizeInPlaceFromFloats(xe[Se].x,xe[Se].y,xe[Se].z);this._particlesIntersect&&(De=new yr.a(Ie,Le));var we=null;this._useModelMaterial&&(we=D.material?D.material:this._setDefaultMaterial());var Ne=new ih(this._shapeCounter,xe,Pe,Re,Oe,Ae,null,null,we),Fe=this._positions.length,Be=this._indices.length;this._meshBuilder(this._index,Be,xe,this._positions,Pe,this._indices,ce,this._uvs,Oe,this._colors,Re,this._normals,Me,0,null,Ne),this._addParticle(Me,this._lastParticleId,Fe,Be,Ne,this._shapeCounter,0,De,Z),this.particles[this.nbParticles].position.addInPlace(fe),Z||(this._index+=xe.length,Me++,this.nbParticles++,this._lastParticleId++),this._shapeCounter++,J+=N}return this._isNotBuilt=!0,this},e.prototype._unrotateFixedNormals=function(){for(var D=0,w=0,N=z.c.Vector3[0],F=z.c.Quaternion[0],k=z.c.Matrix[0],j=0;j<this.particles.length;j++){var G=this.particles[j],H=G._model._shape;if(G.rotationQuaternion)G.rotationQuaternion.conjugateToRef(F);else{var X=G.rotation;z.b.RotationYawPitchRollToRef(X.y,X.x,X.z,F),F.conjugateInPlace()}F.toRotationMatrix(k);for(var q=0;q<H.length;q++)w=D+3*q,z.e.TransformNormalFromFloatsToRef(this._normals32[w],this._normals32[w+1],this._normals32[w+2],k,N),N.toArray(this._fixedNormal32,w);D=w+3}},e.prototype._resetCopy=function(){var D=this._copy;D.position.setAll(0),D.rotation.setAll(0),D.rotationQuaternion=null,D.scaling.setAll(1),D.uvs.copyFromFloats(0,0,1,1),D.color=null,D.translateFromPivot=!1,D.materialIndex=null},e.prototype._meshBuilder=function(D,w,N,F,k,j,G,H,X,q,Z,J,$,te,ie,oe){var ce,he=0,fe=0,pe=0;this._resetCopy();var _e=this._copy,ve=!(!ie||!ie.storage);if(_e.idx=$,_e.idxInShape=te,this._useModelMaterial){var ye=oe._material.uniqueId,be=this._materialIndexesById;be.hasOwnProperty(ye)||(be[ye]=this._materials.length,this._materials.push(oe._material));var Te=be[ye];_e.materialIndex=Te}if(ie&&ie.positionFunction&&(ie.positionFunction(_e,$,te),this._mustUnrotateFixedNormals=!0),ve)return _e;var Ee=z.c.Matrix[0],Se=z.c.Vector3[0],Me=z.c.Vector3[1],xe=z.c.Vector3[2],Ae=z.c.Vector3[3];z.a.IdentityToRef(Ee),_e.getRotationMatrix(Ee),_e.pivot.multiplyToRef(_e.scaling,Ae),_e.translateFromPivot?xe.setAll(0):xe.copyFrom(Ae);var Pe=ie&&ie.vertexFunction;for(ce=0;ce<N.length;ce++){if(Se.copyFrom(N[ce]),Pe&&ie.vertexFunction(_e,Se,ce),Se.multiplyInPlace(_e.scaling).subtractInPlace(Ae),z.e.TransformCoordinatesToRef(Se,Ee,Me),Me.addInPlace(xe).addInPlace(_e.position),F.push(Me.x,Me.y,Me.z),G){var Oe=_e.uvs;H.push((Oe.z-Oe.x)*G[he]+Oe.x,(Oe.w-Oe.y)*G[he+1]+Oe.y),he+=2}if(_e.color)this._color=_e.color;else{var Re=this._color;X&&void 0!==X[fe]?(Re.r=X[fe],Re.g=X[fe+1],Re.b=X[fe+2],Re.a=X[fe+3]):(Re.r=1,Re.g=1,Re.b=1,Re.a=1)}q.push(this._color.r,this._color.g,this._color.b,this._color.a),fe+=4,!this.recomputeNormals&&Z&&(z.e.TransformNormalFromFloatsToRef(Z[pe],Z[pe+1],Z[pe+2],Ee,Se),J.push(Se.x,Se.y,Se.z),pe+=3)}for(ce=0;ce<k.length;ce++){var De=D+k[ce];j.push(De),De>65535&&(this._needs32Bits=!0)}if(this._pickable){var Ie=k.length/3;for(ce=0;ce<Ie;ce++)this.pickedParticles.push({idx:$,faceId:ce})}if(this._depthSort||this._multimaterialEnabled){var Le=null!==_e.materialIndex?_e.materialIndex:0;this.depthSortedParticles.push(new nh(w,k.length,Le))}return _e},e.prototype._posToShape=function(D){for(var w=[],N=0;N<D.length;N+=3)w.push(z.e.FromArray(D,N));return w},e.prototype._uvsToShapeUV=function(D){var w=[];if(D)for(var N=0;N<D.length;N++)w.push(D[N]);return w},e.prototype._addParticle=function(D,w,N,F,k,j,z,G,H){void 0===G&&(G=null),void 0===H&&(H=null);var X=new Hf(D,w,N,F,k,j,z,this,G);return(H||this.particles).push(X),X},e.prototype.addShape=function(D,w,N){var F=D.getVerticesData(Zi.b.PositionKind),k=D.getIndices(),j=D.getVerticesData(Zi.b.UVKind),z=D.getVerticesData(Zi.b.ColorKind),G=D.getVerticesData(Zi.b.NormalKind);this.recomputeNormals=!G;var H=Array.from(k),X=Array.from(G),q=z?Array.from(z):[],Z=N&&N.storage?N.storage:null,J=null;this._particlesIntersect&&(J=D.getBoundingInfo());var $=this._posToShape(F),te=this._uvsToShapeUV(j),ie=N?N.positionFunction:null,oe=N?N.vertexFunction:null,ce=null;this._useModelMaterial&&(ce=D.material?D.material:this._setDefaultMaterial());for(var he=new ih(this._shapeCounter,$,H,X,q,te,ie,oe,ce),fe=0;fe<w;fe++)this._insertNewParticle(this.nbParticles,fe,he,$,k,j,z,G,J,Z,N);return this._shapeCounter++,this._isNotBuilt=!0,this._shapeCounter-1},e.prototype._rebuildParticle=function(D,w){void 0===w&&(w=!1),this._resetCopy();var N=this._copy;D._model._positionFunction&&D._model._positionFunction(N,D.idx,D.idxInShape);var F=z.c.Matrix[0],k=z.c.Vector3[0],j=z.c.Vector3[1],G=z.c.Vector3[2],H=z.c.Vector3[3];N.getRotationMatrix(F),D.pivot.multiplyToRef(D.scaling,H),N.translateFromPivot?G.copyFromFloats(0,0,0):G.copyFrom(H);for(var X=D._model._shape,q=0;q<X.length;q++)k.copyFrom(X[q]),D._model._vertexFunction&&D._model._vertexFunction(N,k,q),k.multiplyInPlace(N.scaling).subtractInPlace(H),z.e.TransformCoordinatesToRef(k,F,j),j.addInPlace(G).addInPlace(N.position).toArray(this._positions32,D._pos+3*q);w&&(D.position.setAll(0),D.rotation.setAll(0),D.rotationQuaternion=null,D.scaling.setAll(1),D.uvs.setAll(0),D.pivot.setAll(0),D.translateFromPivot=!1,D.parentId=null)},e.prototype.rebuildMesh=function(D){void 0===D&&(D=!1);for(var w=0;w<this.particles.length;w++)this._rebuildParticle(this.particles[w],D);return this.mesh.updateVerticesData(Zi.b.PositionKind,this._positions32,!1,!1),this},e.prototype.removeParticles=function(D,w){var N=w-D+1;if(!this._expandable||N<=0||N>=this.nbParticles||!this._updatable)return[];var F=this.particles,k=this.nbParticles;if(w<k-1)for(var j=w+1,z=F[j]._pos-F[D]._pos,G=F[j]._ind-F[D]._ind,H=j;H<k;H++){var X=F[H];X._pos-=z,X._ind-=G}var q=F.splice(D,N);this._positions.length=0,this._indices.length=0,this._colors.length=0,this._uvs.length=0,this._normals.length=0,this._index=0,this._idxOfId.length=0,(this._depthSort||this._multimaterialEnabled)&&(this.depthSortedParticles=[]);for(var Z=0,J=F.length,$=0;$<J;$++){var te=F[$],ie=te._model,oe=ie._shape,ce=ie._indices,he=ie._normals,fe=ie._shapeColors,pe=ie._shapeUV;te.idx=$,this._idxOfId[te.id]=$,this._meshBuilder(this._index,Z,oe,this._positions,ce,this._indices,pe,this._uvs,fe,this._colors,he,this._normals,te.idx,te.idxInShape,null,ie),this._index+=oe.length,Z+=ce.length}return this.nbParticles-=N,this._isNotBuilt=!0,q},e.prototype.insertParticlesFromArray=function(D){if(!this._expandable)return this;for(var w=0,N=D[0].shapeId,F=D.length,k=0;k<F;k++){var j=D[k],z=j._model,G=z._shape,H=z._indices,X=z._shapeUV,q=z._shapeColors,Z=z._normals,J=!Z;this.recomputeNormals=J||this.recomputeNormals;var $=j._boundingInfo,te=this._insertNewParticle(this.nbParticles,w,z,G,H,X,q,Z,$,null,null);j.copyToRef(te),w++,N!=j.shapeId&&(N=j.shapeId,w=0)}return this._isNotBuilt=!0,this},e.prototype._insertNewParticle=function(D,w,N,F,k,j,z,G,H,X,q){var Z=this._positions.length,J=this._indices.length,$=this._meshBuilder(this._index,J,F,this._positions,k,this._indices,j,this._uvs,z,this._colors,G,this._normals,D,w,q,N),te=null;return this._updatable&&((te=this._addParticle(this.nbParticles,this._lastParticleId,Z,J,N,this._shapeCounter,w,H,X)).position.copyFrom($.position),te.rotation.copyFrom($.rotation),$.rotationQuaternion&&(te.rotationQuaternion?te.rotationQuaternion.copyFrom($.rotationQuaternion):te.rotationQuaternion=$.rotationQuaternion.clone()),$.color&&(te.color?te.color.copyFrom($.color):te.color=$.color.clone()),te.scaling.copyFrom($.scaling),te.uvs.copyFrom($.uvs),null!==$.materialIndex&&(te.materialIndex=$.materialIndex),this.expandable&&(this._idxOfId[te.id]=te.idx)),X||(this._index+=F.length,this.nbParticles++,this._lastParticleId++),te},e.prototype.setParticles=function(D,w,N){if(void 0===D&&(D=0),void 0===w&&(w=this.nbParticles-1),void 0===N&&(N=!0),!this._updatable||this._isNotBuilt)return this;this.beforeUpdateParticles(D,w,N);var F=z.c.Matrix[0],k=z.c.Matrix[1],j=this.mesh,G=this._colors32,H=this._positions32,X=this._normals32,q=this._uvs32,Z=this._indices32,J=this._indices,$=this._fixedNormal32,te=z.c.Vector3,ie=te[5].copyFromFloats(1,0,0),oe=te[6].copyFromFloats(0,1,0),ce=te[7].copyFromFloats(0,0,1),he=te[8].setAll(Number.MAX_VALUE),fe=te[9].setAll(-Number.MAX_VALUE),pe=te[10].setAll(0);if((this.billboard||this._depthSort)&&(this.mesh.computeWorldMatrix(!0),this.mesh._worldMatrix.invertToRef(k)),this.billboard){var _e=te[0];this._camera.getDirectionToRef(Qe.a.Z,_e),z.e.TransformNormalToRef(_e,k,ce),ce.normalize();var ve=this._camera.getViewMatrix(!0);z.e.TransformNormalFromFloatsToRef(ve.m[1],ve.m[5],ve.m[9],k,oe),z.e.CrossToRef(oe,ce,ie),oe.normalize(),ie.normalize()}this._depthSort&&z.e.TransformCoordinatesToRef(this._camera.globalPosition,k,pe),z.a.IdentityToRef(F);var ye=0,be=0,Te=0,Ee=0,Se=0,Me=0,xe=0;if(this.mesh.isFacetDataEnabled&&(this._computeBoundingBox=!0),w=w>=this.nbParticles?this.nbParticles-1:w,this._computeBoundingBox&&(0!=D||w!=this.nbParticles-1)){var Ae=this.mesh._boundingInfo;Ae&&(he.copyFrom(Ae.minimum),fe.copyFrom(Ae.maximum))}var Pe=(be=this.particles[D]._pos)/3|0;Ee=4*Pe,Me=2*Pe;for(var Oe=D;Oe<=w;Oe++){var Re=this.particles[Oe];this.updateParticle(Re);var De=Re._model._shape,Ie=Re._model._shapeUV,Le=Re._rotationMatrix,we=Re.position,Ne=Re.rotation,Fe=Re.scaling,Be=Re._globalPosition;if(this._depthSort&&this._depthSortParticles){var Ue=this.depthSortedParticles[Oe];Ue.ind=Re._ind,Ue.indicesLength=Re._model._indicesLength,Ue.sqDistance=z.e.DistanceSquared(Re.position,pe)}if(!Re.alive||Re._stillInvisible&&!Re.isVisible)be+=3*(xe=De.length),Ee+=4*xe,Me+=2*xe;else{if(Re.isVisible){Re._stillInvisible=!1;var Ve=te[12];if(Re.pivot.multiplyToRef(Fe,Ve),this.billboard&&(Ne.x=0,Ne.y=0),(this._computeParticleRotation||this.billboard)&&Re.getRotationMatrix(F),null!==Re.parentId){var ze=this.getParticleById(Re.parentId);if(ze){var Ge=ze._rotationMatrix,Ye=ze._globalPosition,He=we.x*Ge[1]+we.y*Ge[4]+we.z*Ge[7],We=we.x*Ge[0]+we.y*Ge[3]+we.z*Ge[6],Xe=we.x*Ge[2]+we.y*Ge[5]+we.z*Ge[8];if(Be.x=Ye.x+We,Be.y=Ye.y+He,Be.z=Ye.z+Xe,this._computeParticleRotation||this.billboard){var Ke=F.m;Le[0]=Ke[0]*Ge[0]+Ke[1]*Ge[3]+Ke[2]*Ge[6],Le[1]=Ke[0]*Ge[1]+Ke[1]*Ge[4]+Ke[2]*Ge[7],Le[2]=Ke[0]*Ge[2]+Ke[1]*Ge[5]+Ke[2]*Ge[8],Le[3]=Ke[4]*Ge[0]+Ke[5]*Ge[3]+Ke[6]*Ge[6],Le[4]=Ke[4]*Ge[1]+Ke[5]*Ge[4]+Ke[6]*Ge[7],Le[5]=Ke[4]*Ge[2]+Ke[5]*Ge[5]+Ke[6]*Ge[8],Le[6]=Ke[8]*Ge[0]+Ke[9]*Ge[3]+Ke[10]*Ge[6],Le[7]=Ke[8]*Ge[1]+Ke[9]*Ge[4]+Ke[10]*Ge[7],Le[8]=Ke[8]*Ge[2]+Ke[9]*Ge[5]+Ke[10]*Ge[8]}}else Re.parentId=null}else Be.x=we.x,Be.y=we.y,Be.z=we.z,(this._computeParticleRotation||this.billboard)&&(Ke=F.m,Le[0]=Ke[0],Le[1]=Ke[1],Le[2]=Ke[2],Le[3]=Ke[4],Le[4]=Ke[5],Le[5]=Ke[6],Le[6]=Ke[8],Le[7]=Ke[9],Le[8]=Ke[10]);var Ze=te[11];for(Re.translateFromPivot?Ze.setAll(0):Ze.copyFrom(Ve),xe=0;xe<De.length;xe++){ye=be+3*xe,Te=Ee+4*xe,Se=Me+2*xe,(_e=te[0]).copyFrom(De[xe]),this._computeParticleVertex&&this.updateParticleVertex(Re,_e,xe);var Je=_e.x*Fe.x-Ve.x,$e=_e.y*Fe.y-Ve.y,et=_e.z*Fe.z-Ve.z;We=Je*Le[0]+$e*Le[3]+et*Le[6],He=Je*Le[1]+$e*Le[4]+et*Le[7],Xe=Je*Le[2]+$e*Le[5]+et*Le[8],We+=Ze.x,He+=Ze.y,Xe+=Ze.z;var tt=H[ye]=Be.x+ie.x*We+oe.x*He+ce.x*Xe,rt=H[ye+1]=Be.y+ie.y*We+oe.y*He+ce.y*Xe,ot=H[ye+2]=Be.z+ie.z*We+oe.z*He+ce.z*Xe;if(this._computeBoundingBox&&(he.minimizeInPlaceFromFloats(tt,rt,ot),fe.maximizeInPlaceFromFloats(tt,rt,ot)),!this._computeParticleVertex){var at=$[ye],st=$[ye+1],ut=$[ye+2],lt=at*Le[0]+st*Le[3]+ut*Le[6],ht=at*Le[1]+st*Le[4]+ut*Le[7],dt=at*Le[2]+st*Le[5]+ut*Le[8];X[ye]=ie.x*lt+oe.x*ht+ce.x*dt,X[ye+1]=ie.y*lt+oe.y*ht+ce.y*dt,X[ye+2]=ie.z*lt+oe.z*ht+ce.z*dt}if(this._computeParticleColor&&Re.color){var ft=Re.color,pt=this._colors32;pt[Te]=ft.r,pt[Te+1]=ft.g,pt[Te+2]=ft.b,pt[Te+3]=ft.a}if(this._computeParticleTexture){var _t=Re.uvs;q[Se]=Ie[2*xe]*(_t.z-_t.x)+_t.x,q[Se+1]=Ie[2*xe+1]*(_t.w-_t.y)+_t.y}}}else for(Re._stillInvisible=!0,xe=0;xe<De.length;xe++)Te=Ee+4*xe,Se=Me+2*xe,H[ye=be+3*xe]=H[ye+1]=H[ye+2]=0,X[ye]=X[ye+1]=X[ye+2]=0,this._computeParticleColor&&Re.color&&(ft=Re.color,G[Te]=ft.r,G[Te+1]=ft.g,G[Te+2]=ft.b,G[Te+3]=ft.a),this._computeParticleTexture&&(_t=Re.uvs,q[Se]=Ie[2*xe]*(_t.z-_t.x)+_t.x,q[Se+1]=Ie[2*xe+1]*(_t.w-_t.y)+_t.y);if(this._particlesIntersect){var mt=Re._boundingInfo,gt=mt.boundingBox,vt=mt.boundingSphere,yt=Re._modelBoundingInfo;if(!this._bSphereOnly){var bt=yt.boundingBox.vectors,Tt=te[1],Et=te[2];Tt.setAll(Number.MAX_VALUE),Et.setAll(-Number.MAX_VALUE);for(var St=0;St<8;St++){var Mt=bt[St].x*Fe.x,xt=bt[St].y*Fe.y,At=bt[St].z*Fe.z,Pt=(We=Mt*Le[0]+xt*Le[3]+At*Le[6],He=Mt*Le[1]+xt*Le[4]+At*Le[7],Xe=Mt*Le[2]+xt*Le[5]+At*Le[8],we.x+ie.x*We+oe.x*He+ce.x*Xe),Ct=we.y+ie.y*We+oe.y*He+ce.y*Xe,Ot=we.z+ie.z*We+oe.z*He+ce.z*Xe;Tt.minimizeInPlaceFromFloats(Pt,Ct,Ot),Et.maximizeInPlaceFromFloats(Pt,Ct,Ot)}gt.reConstruct(Tt,Et,j._worldMatrix)}var Rt=yt.minimum.multiplyToRef(Fe,te[1]),Dt=yt.maximum.multiplyToRef(Fe,te[2]),It=Dt.addToRef(Rt,te[3]).scaleInPlace(.5).addInPlace(Be),Lt=Dt.subtractToRef(Rt,te[4]).scaleInPlace(.5*this._bSphereRadiusFactor),wt=It.subtractToRef(Lt,te[1]),Nt=It.addToRef(Lt,te[2]);vt.reConstruct(wt,Nt,j._worldMatrix)}be=ye+3,Ee=Te+4,Me=Se+2}}if(N){if(this._computeParticleColor&&j.updateVerticesData(Zi.b.ColorKind,G,!1,!1),this._computeParticleTexture&&j.updateVerticesData(Zi.b.UVKind,q,!1,!1),j.updateVerticesData(Zi.b.PositionKind,H,!1,!1),!j.areNormalsFrozen||j.isFacetDataEnabled){if(this._computeParticleVertex||j.isFacetDataEnabled){var Ft=j.isFacetDataEnabled?j.getFacetDataParameters():null;qi.a.ComputeNormals(H,Z,X,Ft);for(var Bt=0;Bt<X.length;Bt++)$[Bt]=X[Bt]}j.areNormalsFrozen||j.updateVerticesData(Zi.b.NormalKind,X,!1,!1)}if(this._depthSort&&this._depthSortParticles){var kt=this.depthSortedParticles;kt.sort(this._depthSortFunction);for(var Ut=kt.length,Vt=0,jt=0;jt<Ut;jt++){var zt=kt[jt].indicesLength,Gt=kt[jt].ind;for(Bt=0;Bt<zt;Bt++)Z[Vt]=J[Gt+Bt],Vt++}j.updateIndices(Z)}}return this._computeBoundingBox&&(j._boundingInfo?j._boundingInfo.reConstruct(he,fe,j._worldMatrix):j._boundingInfo=new yr.a(he,fe,j._worldMatrix)),this._autoUpdateSubMeshes&&this.computeSubMeshes(),this.afterUpdateParticles(D,w,N),this},e.prototype.dispose=function(){this.mesh.dispose(),this.vars=null,this._positions=null,this._indices=null,this._normals=null,this._uvs=null,this._colors=null,this._indices32=null,this._positions32=null,this._normals32=null,this._fixedNormal32=null,this._uvs32=null,this._colors32=null,this.pickedParticles=null},e.prototype.getParticleById=function(D){var w=this.particles[D];if(w&&w.id==D)return w;var N=this.particles,F=this._idxOfId[D];if(void 0!==F)return N[F];for(var k=0,j=this.nbParticles;k<j;){var z=N[k];if(z.id==D)return z;k++}return null},e.prototype.getParticlesByShapeId=function(D){var w=[];return this.getParticlesByShapeIdToRef(D,w),w},e.prototype.getParticlesByShapeIdToRef=function(D,w){w.length=0;for(var N=0;N<this.nbParticles;N++){var F=this.particles[N];F.shapeId==D&&w.push(F)}return this},e.prototype.computeSubMeshes=function(){if(!this.mesh||!this._multimaterialEnabled)return this;var D=this.depthSortedParticles;if(this.particles.length>0)for(var w=0;w<this.particles.length;w++){var N=this.particles[w];N.materialIndex||(N.materialIndex=0);var F=D[w];F.materialIndex=N.materialIndex,F.ind=N._ind,F.indicesLength=N._model._indicesLength}this._sortParticlesByMaterial();var k=this._indicesByMaterial,j=this._materialIndexes,z=this.mesh;z.subMeshes=[];for(var G=z.getTotalVertices(),H=0;H<j.length;H++){var X=k[H],q=k[H+1]-X,Z=j[H];new $l.b(Z,0,G,X,q,z)}return this},e.prototype._sortParticlesByMaterial=function(){var D=[0];this._indicesByMaterial=D;var w=[];this._materialIndexes=w;var N=this.depthSortedParticles;N.sort(this._materialSortFunction);var F=N.length,k=this._indices32,j=this._indices,z=0,G=N[0].materialIndex;w.push(G);for(var H=0;H<F;H++){var X=N[H],q=X.indicesLength,Z=X.ind;X.materialIndex!==G&&(G=X.materialIndex,D.push(z),w.push(G));for(var J=0;J<q;J++)k[z]=j[Z+J],z++}return D.push(k.length),this._updatable&&this.mesh.updateIndices(k),this},e.prototype._setMaterialIndexesById=function(){this._materialIndexesById={};for(var D=0;D<this._materials.length;D++){var w=this._materials[D].uniqueId;this._materialIndexesById[w]=D}},e.prototype._filterUniqueMaterialId=function(D){return D.filter((function(D,w,N){return N.indexOf(D)===w}))},e.prototype._setDefaultMaterial=function(){return this._defaultMaterial||(this._defaultMaterial=new Hi.a(this.name+"DefaultMaterial",this._scene)),this._defaultMaterial},e.prototype.refreshVisibleSize=function(){return this._isVisibilityBoxLocked||this.mesh.refreshBoundingInfo(),this},e.prototype.setVisibilityBox=function(D){var w=D/2;this.mesh._boundingInfo=new yr.a(new z.e(-w,-w,-w),new z.e(w,w,w))},Object.defineProperty(e.prototype,"isAlwaysVisible",{get:function(){return this._alwaysVisible},set:function(D){this._alwaysVisible=D,this.mesh.alwaysSelectAsActiveMesh=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isVisibilityBoxLocked",{get:function(){return this._isVisibilityBoxLocked},set:function(D){this._isVisibilityBoxLocked=D,this.mesh.getBoundingInfo().isLocked=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"computeParticleRotation",{get:function(){return this._computeParticleRotation},set:function(D){this._computeParticleRotation=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"computeParticleColor",{get:function(){return this._computeParticleColor},set:function(D){this._computeParticleColor=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"computeParticleTexture",{get:function(){return this._computeParticleTexture},set:function(D){this._computeParticleTexture=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"computeParticleVertex",{get:function(){return this._computeParticleVertex},set:function(D){this._computeParticleVertex=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"computeBoundingBox",{get:function(){return this._computeBoundingBox},set:function(D){this._computeBoundingBox=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthSortParticles",{get:function(){return this._depthSortParticles},set:function(D){this._depthSortParticles=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"expandable",{get:function(){return this._expandable},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"multimaterialEnabled",{get:function(){return this._multimaterialEnabled},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useModelMaterial",{get:function(){return this._useModelMaterial},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"materials",{get:function(){return this._materials},enumerable:!0,configurable:!0}),e.prototype.setMultiMaterial=function(D){this._materials=this._filterUniqueMaterialId(D),this._setMaterialIndexesById(),this._multimaterial&&this._multimaterial.dispose(),this._multimaterial=new rc.a(this.name+"MultiMaterial",this._scene);for(var w=0;w<this._materials.length;w++)this._multimaterial.subMaterials.push(this._materials[w]);this.computeSubMeshes(),this.mesh.material=this._multimaterial},Object.defineProperty(e.prototype,"multimaterial",{get:function(){return this._multimaterial},set:function(D){this._multimaterial=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"autoUpdateSubMeshes",{get:function(){return this._autoUpdateSubMeshes},set:function(D){this._autoUpdateSubMeshes=D},enumerable:!0,configurable:!0}),e.prototype.initParticles=function(){},e.prototype.recycleParticle=function(D){return D},e.prototype.updateParticle=function(D){return D},e.prototype.updateParticleVertex=function(D,w,N){return w},e.prototype.beforeUpdateParticles=function(D,w,N){},e.prototype.afterUpdateParticles=function(D,w,N){},e}(),Zf=function(){function e(D,w,N,F,k){this.idx=0,this.color=new G.b(1,1,1,1),this.position=z.e.Zero(),this.rotation=z.e.Zero(),this.uv=new z.d(0,0),this.velocity=z.e.Zero(),this.pivot=z.e.Zero(),this.translateFromPivot=!1,this._pos=0,this._ind=0,this.groupId=0,this.idxInGroup=0,this._stillInvisible=!1,this._rotationMatrix=[1,0,0,0,1,0,0,0,1],this.parentId=null,this._globalPosition=z.e.Zero(),this.idx=D,this._group=w,this.groupId=N,this.idxInGroup=F,this._pcs=k}return Object.defineProperty(e.prototype,"size",{get:function(){return this.size},set:function(D){this.size=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"quaternion",{get:function(){return this.rotationQuaternion},set:function(D){this.rotationQuaternion=D},enumerable:!0,configurable:!0}),e.prototype.intersectsMesh=function(D,w){if(!D._boundingInfo)return!1;if(w=w||!1)return D.getBoundingInfo().boundingSphere.intersectsPoint(this.position.add(this._pcs.mesh.position));var N,F,k,j,z,G;N=D.getBoundingInfo().boundingBox.maximumWorld.x,F=D.getBoundingInfo().boundingBox.minimumWorld.x,k=D.getBoundingInfo().boundingBox.maximumWorld.y,j=D.getBoundingInfo().boundingBox.minimumWorld.y,z=D.getBoundingInfo().boundingBox.maximumWorld.z,G=D.getBoundingInfo().boundingBox.minimumWorld.z;var H=this.position.x+this._pcs.mesh.position.x,X=this.position.y+this._pcs.mesh.position.y,q=this.position.z+this._pcs.mesh.position.z;return F<=H&&H<=N&&j<=X&&X<=k&&G<=q&&q<=z},e.prototype.getRotationMatrix=function(D){var w;if(this.rotationQuaternion)w=this.rotationQuaternion;else{w=z.c.Quaternion[0];var N=this.rotation;z.b.RotationYawPitchRollToRef(N.y,N.x,N.z,w)}w.toRotationMatrix(D)},e}(),ah=function(D,w){this.groupID=D,this._positionFunction=w};!function(D){D[D.Color=2]="Color",D[D.UV=1]="UV",D[D.Random=0]="Random",D[D.Stated=3]="Stated"}(Yf||(Yf={}));var $f=function(){function e(D,w,N,F){this.particles=new Array,this.nbParticles=0,this.counter=0,this.vars={},this._promises=[],this._positions=new Array,this._indices=new Array,this._normals=new Array,this._colors=new Array,this._uvs=new Array,this._updatable=!0,this._isVisibilityBoxLocked=!1,this._alwaysVisible=!1,this._groups=new Array,this._groupCounter=0,this._computeParticleColor=!0,this._computeParticleTexture=!0,this._computeParticleRotation=!0,this._computeBoundingBox=!1,this._isReady=!1,this.name=D,this._size=w,this._scene=N||Me.a.LastCreatedScene,F&&void 0!==F.updatable?this._updatable=F.updatable:this._updatable=!0}return e.prototype.buildMeshAsync=function(){var D=this;return Promise.all(this._promises).then((function(){return D._isReady=!0,D._buildMesh()}))},e.prototype._buildMesh=function(){0===this.nbParticles&&this.addPoints(1),this._positions32=new Float32Array(this._positions),this._uvs32=new Float32Array(this._uvs),this._colors32=new Float32Array(this._colors);var D=new qi.a;D.set(this._positions32,Zi.b.PositionKind),this._uvs32.length>0&&D.set(this._uvs32,Zi.b.UVKind);var w=0;this._colors32.length>0&&(w=1,D.set(this._colors32,Zi.b.ColorKind));var N=new xt.a(this.name,this._scene);D.applyToMesh(N,this._updatable),this.mesh=N,this._positions=null,this._uvs=null,this._colors=null,this._updatable||(this.particles.length=0);var F=new Hi.a("point cloud material",this._scene);return F.emissiveColor=new G.a(w,w,w),F.disableLighting=!0,F.pointsCloud=!0,F.pointSize=this._size,N.material=F,new Promise((function(D){return D(N)}))},e.prototype._addParticle=function(D,w,N,F){var k=new Zf(D,w,N,F,this);return this.particles.push(k),k},e.prototype._randomUnitVector=function(D){D.position=new z.e(Math.random(),Math.random(),Math.random()),D.color=new G.b(1,1,1,1)},e.prototype._getColorIndicesForCoord=function(D,w,N,F){var k=D._groupImageData,j=N*(4*F)+4*w,z=[j,j+1,j+2,j+3],H=z[1],X=z[2],q=z[3],Z=k[z[0]],J=k[H],$=k[X],te=k[q];return new G.b(Z/255,J/255,$/255,te)},e.prototype._setPointsColorOrUV=function(D,w,N,F,k,j,H){N&&D.updateFacetData();var X=2*D.getBoundingInfo().boundingSphere.radius,q=D.getVerticesData(Zi.b.PositionKind),Z=D.getIndices(),J=D.getVerticesData(Zi.b.UVKind),$=D.getVerticesData(Zi.b.ColorKind),te=z.e.Zero();D.computeWorldMatrix();var ie=D.getWorldMatrix();if(!ie.isIdentity())for(var oe=0;oe<q.length/3;oe++)z.e.TransformCoordinatesFromFloatsToRef(q[3*oe],q[3*oe+1],q[3*oe+2],ie,te),q[3*oe]=te.x,q[3*oe+1]=te.y,q[3*oe+2]=te.z;var ce,he,fe=0,pe=0,_e=0,ve=0,ye=0,be=0,Te=0,Ee=0,Se=0,Me=0,xe=0,Ae=0,Pe=0,Oe=0,Re=z.e.Zero(),Ie=z.e.Zero(),Le=z.e.Zero(),we=z.e.Zero(),Ne=z.e.Zero(),Fe=0,Be=0,Ue=0,Ve=0,ze=0,Ge=0,Ye=z.d.Zero(),He=z.d.Zero(),We=z.d.Zero(),Xe=z.d.Zero(),Ke=z.d.Zero(),Qe=0,Ze=0,Je=0,$e=0,et=0,tt=0,rt=0,ot=0,at=0,st=0,ut=0,lt=0,ht=z.f.Zero(),dt=z.f.Zero(),ft=z.f.Zero(),pt=z.f.Zero(),_t=z.f.Zero(),mt=0,gt=0;H=H||0;var vt,yt=new z.f(0,0,0,0),bt=z.e.Zero(),Tt=z.e.Zero(),Et=z.e.Zero(),St=0,Mt=z.e.Zero(),xt=0,At=0,Pt=new Qn.a(z.e.Zero(),new z.e(1,0,0)),Ct=z.e.Zero();for(pe=0;pe<Z.length/3;pe++){var Ot,Rt,Dt,It,Lt,wt,Nt,Ft;_e=Z[3*pe],ve=Z[3*pe+1],ye=Z[3*pe+2],be=q[3*_e],Te=q[3*_e+1],Ee=q[3*_e+2],Se=q[3*ve],Me=q[3*ve+1],xe=q[3*ve+2],Ae=q[3*ye],Pe=q[3*ye+1],Oe=q[3*ye+2],Re.set(be,Te,Ee),Ie.set(Se,Me,xe),Le.set(Ae,Pe,Oe),Ie.subtractToRef(Re,we),Le.subtractToRef(Ie,Ne),J&&(Fe=J[2*_e],Be=J[2*_e+1],Ue=J[2*ve],Ve=J[2*ve+1],ze=J[2*ye],Ge=J[2*ye+1],Ye.set(Fe,Be),He.set(Ue,Ve),We.set(ze,Ge),He.subtractToRef(Ye,Xe),We.subtractToRef(He,Ke)),$&&F&&(Qe=$[4*_e],Ze=$[4*_e+1],Je=$[4*_e+2],$e=$[4*_e+3],et=$[4*ve],tt=$[4*ve+1],rt=$[4*ve+2],ot=$[4*ve+3],at=$[4*ye],st=$[4*ye+1],ut=$[4*ye+2],lt=$[4*ye+3],ht.set(Qe,Ze,Je,$e),dt.set(et,tt,rt,ot),ft.set(at,st,ut,lt),dt.subtractToRef(ht,pt),ft.subtractToRef(dt,_t));for(var Bt,kt,Ut=new G.a(0,0,0),Vt=new G.a(0,0,0),jt=0;jt<w._groupDensity[pe];jt++)fe=this.particles.length,this._addParticle(fe,w,this._groupCounter,pe+jt),kt=this.particles[fe],mt=De.a.RandomRange(0,1),gt=De.a.RandomRange(0,1),ce=Re.add(we.scale(mt)).add(Ne.scale(mt*gt)),N&&(bt=D.getFacetNormal(pe).normalize().scale(-1),Tt=we.clone().normalize(),Et=z.e.Cross(bt,Tt),St=De.a.RandomRange(0,2*Math.PI),Mt=Tt.scale(Math.cos(St)).add(Et.scale(Math.sin(St))),St=De.a.RandomRange(.1,Math.PI/2),Ct=Mt.scale(Math.cos(St)).add(bt.scale(Math.sin(St))),Pt.origin=ce.add(Ct.scale(1e-5)),Pt.direction=Ct,Pt.length=X,(vt=Pt.intersectsMesh(D)).hit&&(At=vt.pickedPoint.subtract(ce).length(),xt=De.a.RandomRange(0,1)*At,ce.addInPlace(Ct.scale(xt)))),kt.position=ce.clone(),this._positions.push(kt.position.x,kt.position.y,kt.position.z),void 0!==F?J&&(he=Ye.add(Xe.scale(mt)).add(Ke.scale(mt*gt)),F?k&&null!==w._groupImageData?(Ot=w._groupImgWidth,Rt=w._groupImgHeight,Bt=this._getColorIndicesForCoord(w,Math.round(he.x*Ot),Math.round(he.y*Rt),Ot),kt.color=Bt,this._colors.push(Bt.r,Bt.g,Bt.b,Bt.a)):$?(yt=ht.add(pt.scale(mt)).add(_t.scale(mt*gt)),kt.color=new G.b(yt.x,yt.y,yt.z,yt.w),this._colors.push(yt.x,yt.y,yt.z,yt.w)):(yt=ht.set(Math.random(),Math.random(),Math.random(),1),kt.color=new G.b(yt.x,yt.y,yt.z,yt.w),this._colors.push(yt.x,yt.y,yt.z,yt.w)):(kt.uv=he.clone(),this._uvs.push(kt.uv.x,kt.uv.y))):(j?(Ut.set(j.r,j.g,j.b),Dt=De.a.RandomRange(-H,H),It=De.a.RandomRange(-H,H),Lt=(Ft=Ut.toHSV()).r,(wt=Ft.g+Dt)<0&&(wt=0),wt>1&&(wt=1),(Nt=Ft.b+It)<0&&(Nt=0),Nt>1&&(Nt=1),G.a.HSVtoRGBToRef(Lt,wt,Nt,Vt),yt.set(Vt.r,Vt.g,Vt.b,1)):yt=ht.set(Math.random(),Math.random(),Math.random(),1),kt.color=new G.b(yt.x,yt.y,yt.z,yt.w),this._colors.push(yt.x,yt.y,yt.z,yt.w))}},e.prototype._colorFromTexture=function(D,w,N){var F=this;if(null===D.material)return oe.a.Warn(D.name+"has no material."),w._groupImageData=null,void this._setPointsColorOrUV(D,w,N,!0,!1);var k=D.material.getActiveTextures();if(0===k.length)return oe.a.Warn(D.name+"has no useable texture."),w._groupImageData=null,void this._setPointsColorOrUV(D,w,N,!0,!1);var j=D.clone();j.setEnabled(!1),this._promises.push(new Promise((function(D){Nr.a.WhenAllReady(k,(function(){var z=w._textureNb;return z<0&&(z=0),z>k.length-1&&(z=k.length-1),w._groupImageData=k[z].readPixels(),w._groupImgWidth=k[z].getSize().width,w._groupImgHeight=k[z].getSize().height,F._setPointsColorOrUV(j,w,N,!0,!0),j.dispose(),D()}))})))},e.prototype._calculateDensity=function(D,w,N){for(var F,k,j,G,H,X,q,Z,J,$,te,ie,oe,ce,he,fe,pe,_e=new Array,ve=z.e.Zero(),ye=z.e.Zero(),be=z.e.Zero(),Te=z.e.Zero(),Ee=z.e.Zero(),Se=z.e.Zero(),Me=new Array,xe=0,Ae=N.length/3,Pe=0;Pe<Ae;Pe++)F=N[3*Pe],k=N[3*Pe+1],j=N[3*Pe+2],G=w[3*F],H=w[3*F+1],X=w[3*F+2],q=w[3*k],Z=w[3*k+1],J=w[3*k+2],$=w[3*j],te=w[3*j+1],ie=w[3*j+2],ve.set(G,H,X),ye.set(q,Z,J),be.set($,te,ie),ye.subtractToRef(ve,Te),be.subtractToRef(ye,Ee),be.subtractToRef(ve,Se),fe=((oe=Te.length())+(ce=Ee.length())+(he=Se.length()))/2,xe+=pe=Math.sqrt(fe*(fe-oe)*(fe-ce)*(fe-he)),Me[Pe]=pe;var Oe=0;for(Pe=0;Pe<Ae;Pe++)_e[Pe]=Math.floor(D*Me[Pe]/xe),Oe+=_e[Pe];var Re=D-Oe,De=Math.floor(Re/Ae),Ie=Re%Ae;for(De>0&&(_e=_e.map((function(D){return D+De}))),Pe=0;Pe<Ie;Pe++)_e[Pe]+=1;return _e},e.prototype.addPoints=function(D,w){void 0===w&&(w=this._randomUnitVector);for(var N,F=new ah(this._groupCounter,w),k=this.nbParticles,j=0;j<D;j++)N=this._addParticle(k,F,this._groupCounter,j),F&&F._positionFunction&&F._positionFunction(N,k,j),this._positions.push(N.position.x,N.position.y,N.position.z),N.color&&this._colors.push(N.color.r,N.color.g,N.color.b,N.color.a),N.uv&&this._uvs.push(N.uv.x,N.uv.y),k++;return this.nbParticles+=D,this._groupCounter++,this._groupCounter},e.prototype.addSurfacePoints=function(D,w,N,F,k){var j=N||Yf.Random;(isNaN(j)||j<0||j>3)&&(j=Yf.Random);var z=D.getVerticesData(Zi.b.PositionKind),H=D.getIndices();this._groups.push(this._groupCounter);var X=new ah(this._groupCounter,null);switch(X._groupDensity=this._calculateDensity(w,z,H),j===Yf.Color?X._textureNb=F||0:F=F||new G.b(1,1,1,1),j){case Yf.Color:this._colorFromTexture(D,X,!1);break;case Yf.UV:this._setPointsColorOrUV(D,X,!1,!1,!1);break;case Yf.Random:this._setPointsColorOrUV(D,X,!1);break;case Yf.Stated:this._setPointsColorOrUV(D,X,!1,void 0,void 0,F,k)}return this.nbParticles+=w,this._groupCounter++,this._groupCounter-1},e.prototype.addVolumePoints=function(D,w,N,F,k){var j=N||Yf.Random;(isNaN(j)||j<0||j>3)&&(j=Yf.Random);var z=D.getVerticesData(Zi.b.PositionKind),H=D.getIndices();this._groups.push(this._groupCounter);var X=new ah(this._groupCounter,null);switch(X._groupDensity=this._calculateDensity(w,z,H),j===Yf.Color?X._textureNb=F||0:F=F||new G.b(1,1,1,1),j){case Yf.Color:this._colorFromTexture(D,X,!0);break;case Yf.UV:this._setPointsColorOrUV(D,X,!0,!1,!1);break;case Yf.Random:this._setPointsColorOrUV(D,X,!0);break;case Yf.Stated:this._setPointsColorOrUV(D,X,!0,void 0,void 0,F,k)}return this.nbParticles+=w,this._groupCounter++,this._groupCounter-1},e.prototype.setParticles=function(D,w,N){if(void 0===D&&(D=0),void 0===w&&(w=this.nbParticles-1),void 0===N&&(N=!0),!this._updatable||!this._isReady)return this;this.beforeUpdateParticles(D,w,N);var F=z.c.Matrix[0],k=this.mesh,j=this._colors32,G=this._positions32,H=this._uvs32,X=z.c.Vector3,q=X[5].copyFromFloats(1,0,0),Z=X[6].copyFromFloats(0,1,0),J=X[7].copyFromFloats(0,0,1),$=X[8].setAll(Number.MAX_VALUE),te=X[9].setAll(-Number.MAX_VALUE);z.a.IdentityToRef(F);var ie=0;if(this.mesh.isFacetDataEnabled&&(this._computeBoundingBox=!0),w=w>=this.nbParticles?this.nbParticles-1:w,this._computeBoundingBox&&(0!=D||w!=this.nbParticles-1)){var oe=this.mesh._boundingInfo;oe&&($.copyFrom(oe.minimum),te.copyFrom(oe.maximum))}ie=0;for(var ce=0,he=0,fe=0,pe=D;pe<=w;pe++){var _e=this.particles[pe];ce=3*(ie=_e.idx),he=4*ie,fe=2*ie,this.updateParticle(_e);var ve=_e._rotationMatrix,ye=_e.position,be=_e._globalPosition;if(this._computeParticleRotation&&_e.getRotationMatrix(F),null!==_e.parentId){var Te=this.particles[_e.parentId],Ee=Te._rotationMatrix,Se=Te._globalPosition,Me=ye.x*Ee[1]+ye.y*Ee[4]+ye.z*Ee[7],xe=ye.x*Ee[0]+ye.y*Ee[3]+ye.z*Ee[6],Ae=ye.x*Ee[2]+ye.y*Ee[5]+ye.z*Ee[8];if(be.x=Se.x+xe,be.y=Se.y+Me,be.z=Se.z+Ae,this._computeParticleRotation){var Pe=F.m;ve[0]=Pe[0]*Ee[0]+Pe[1]*Ee[3]+Pe[2]*Ee[6],ve[1]=Pe[0]*Ee[1]+Pe[1]*Ee[4]+Pe[2]*Ee[7],ve[2]=Pe[0]*Ee[2]+Pe[1]*Ee[5]+Pe[2]*Ee[8],ve[3]=Pe[4]*Ee[0]+Pe[5]*Ee[3]+Pe[6]*Ee[6],ve[4]=Pe[4]*Ee[1]+Pe[5]*Ee[4]+Pe[6]*Ee[7],ve[5]=Pe[4]*Ee[2]+Pe[5]*Ee[5]+Pe[6]*Ee[8],ve[6]=Pe[8]*Ee[0]+Pe[9]*Ee[3]+Pe[10]*Ee[6],ve[7]=Pe[8]*Ee[1]+Pe[9]*Ee[4]+Pe[10]*Ee[7],ve[8]=Pe[8]*Ee[2]+Pe[9]*Ee[5]+Pe[10]*Ee[8]}}else be.x=0,be.y=0,be.z=0,this._computeParticleRotation&&(Pe=F.m,ve[0]=Pe[0],ve[1]=Pe[1],ve[2]=Pe[2],ve[3]=Pe[4],ve[4]=Pe[5],ve[5]=Pe[6],ve[6]=Pe[8],ve[7]=Pe[9],ve[8]=Pe[10]);var Oe=X[11];_e.translateFromPivot?Oe.setAll(0):Oe.copyFrom(_e.pivot);var Re=X[0];Re.copyFrom(_e.position);var De=Re.x-_e.pivot.x,Ie=Re.y-_e.pivot.y,Le=Re.z-_e.pivot.z,we=De*ve[0]+Ie*ve[3]+Le*ve[6],Ne=De*ve[1]+Ie*ve[4]+Le*ve[7],Fe=De*ve[2]+Ie*ve[5]+Le*ve[8];we+=Oe.x,Ne+=Oe.y,Fe+=Oe.z;var Be=G[ce]=be.x+q.x*we+Z.x*Ne+J.x*Fe,Ue=G[ce+1]=be.y+q.y*we+Z.y*Ne+J.y*Fe,Ve=G[ce+2]=be.z+q.z*we+Z.z*Ne+J.z*Fe;if(this._computeBoundingBox&&($.minimizeInPlaceFromFloats(Be,Ue,Ve),te.maximizeInPlaceFromFloats(Be,Ue,Ve)),this._computeParticleColor&&_e.color){var ze=_e.color,Ge=this._colors32;Ge[he]=ze.r,Ge[he+1]=ze.g,Ge[he+2]=ze.b,Ge[he+3]=ze.a}if(this._computeParticleTexture&&_e.uv){var Ye=_e.uv,He=this._uvs32;He[fe]=Ye.x,He[fe+1]=Ye.y}}return N&&(this._computeParticleColor&&k.updateVerticesData(Zi.b.ColorKind,j,!1,!1),this._computeParticleTexture&&k.updateVerticesData(Zi.b.UVKind,H,!1,!1),k.updateVerticesData(Zi.b.PositionKind,G,!1,!1)),this._computeBoundingBox&&(k._boundingInfo?k._boundingInfo.reConstruct($,te,k._worldMatrix):k._boundingInfo=new yr.a($,te,k._worldMatrix)),this.afterUpdateParticles(D,w,N),this},e.prototype.dispose=function(){this.mesh.dispose(),this.vars=null,this._positions=null,this._indices=null,this._normals=null,this._uvs=null,this._colors=null,this._indices32=null,this._positions32=null,this._uvs32=null,this._colors32=null},e.prototype.refreshVisibleSize=function(){return this._isVisibilityBoxLocked||this.mesh.refreshBoundingInfo(),this},e.prototype.setVisibilityBox=function(D){var w=D/2;this.mesh._boundingInfo=new yr.a(new z.e(-w,-w,-w),new z.e(w,w,w))},Object.defineProperty(e.prototype,"isAlwaysVisible",{get:function(){return this._alwaysVisible},set:function(D){this._alwaysVisible=D,this.mesh.alwaysSelectAsActiveMesh=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"computeParticleRotation",{set:function(D){this._computeParticleRotation=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"computeParticleColor",{get:function(){return this._computeParticleColor},set:function(D){this._computeParticleColor=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"computeParticleTexture",{get:function(){return this._computeParticleTexture},set:function(D){this._computeParticleTexture=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"computeBoundingBox",{get:function(){return this._computeBoundingBox},set:function(D){this._computeBoundingBox=D},enumerable:!0,configurable:!0}),e.prototype.initParticles=function(){},e.prototype.recycleParticle=function(D){return D},e.prototype.updateParticle=function(D){return D},e.prototype.beforeUpdateParticles=function(D,w,N){},e.prototype.afterUpdateParticles=function(D,w,N){},e}();We.a.prototype.getPhysicsEngine=function(){return this._physicsEngine},We.a.prototype.enablePhysics=function(D,w){if(void 0===D&&(D=null),this._physicsEngine)return!0;var N=this._getComponent(Nt.a.NAME_PHYSICSENGINE);N||(N=new np(this),this._addComponent(N));try{return this._physicsEngine=new gc(D,w),this._physicsTimeAccumulator=0,!0}catch(D){return oe.a.Error(D.message),!1}},We.a.prototype.disablePhysicsEngine=function(){this._physicsEngine&&(this._physicsEngine.dispose(),this._physicsEngine=null)},We.a.prototype.isPhysicsEnabled=function(){return void 0!==this._physicsEngine},We.a.prototype.deleteCompoundImpostor=function(D){var w=D.parts[0].mesh;w.physicsImpostor&&(w.physicsImpostor.dispose(),w.physicsImpostor=null)},We.a.prototype._advancePhysicsEngineStep=function(D){if(this._physicsEngine){var w=this._physicsEngine.getSubTimeStep();if(w>0)for(this._physicsTimeAccumulator+=D;this._physicsTimeAccumulator>w;)this.onBeforePhysicsObservable.notifyObservers(this),this._physicsEngine._step(w/1e3),this.onAfterPhysicsObservable.notifyObservers(this),this._physicsTimeAccumulator-=w;else this.onBeforePhysicsObservable.notifyObservers(this),this._physicsEngine._step(D/1e3),this.onAfterPhysicsObservable.notifyObservers(this)}},Object.defineProperty(Wt.a.prototype,"physicsImpostor",{get:function(){return this._physicsImpostor},set:function(D){var w=this;this._physicsImpostor!==D&&(this._disposePhysicsObserver&&this.onDisposeObservable.remove(this._disposePhysicsObserver),this._physicsImpostor=D,D&&(this._disposePhysicsObserver=this.onDisposeObservable.add((function(){w.physicsImpostor&&(w.physicsImpostor.dispose(),w.physicsImpostor=null)}))))},enumerable:!0,configurable:!0}),Wt.a.prototype.getPhysicsImpostor=function(){return this.physicsImpostor},Wt.a.prototype.applyImpulse=function(D,w){return this.physicsImpostor?(this.physicsImpostor.applyImpulse(D,w),this):this},Wt.a.prototype.setPhysicsLinkWith=function(D,w,N,F){return this.physicsImpostor&&D.physicsImpostor?(this.physicsImpostor.createJoint(D.physicsImpostor,mc.e.HingeJoint,{mainPivot:w,connectedPivot:N,nativeParams:F}),this):this};var ep,tp,np=function(){function e(D){var w=this;this.name=Nt.a.NAME_PHYSICSENGINE,this.scene=D,this.scene.onBeforePhysicsObservable=new j.c,this.scene.onAfterPhysicsObservable=new j.c,this.scene.getDeterministicFrameTime=function(){return w.scene._physicsEngine?1e3*w.scene._physicsEngine.getTimeStep():1e3/60}}return e.prototype.register=function(){},e.prototype.rebuild=function(){},e.prototype.dispose=function(){this.scene.onBeforePhysicsObservable.clear(),this.scene.onAfterPhysicsObservable.clear(),this.scene._physicsEngine&&this.scene.disablePhysicsEngine()},e}(),ip=function(){function e(D){this._scene=D,this._physicsEngine=this._scene.getPhysicsEngine(),this._physicsEngine||oe.a.Warn("Physics engine not enabled. Please enable the physics before you can use the methods.")}return e.prototype.applyRadialExplosionImpulse=function(D,w,N,F){if(!this._physicsEngine)return oe.a.Warn("Physics engine not enabled. Please enable the physics before you call this method."),null;var k=this._physicsEngine.getImpostors();if(0===k.length)return null;"number"==typeof w&&((w=new mh).radius=w,w.strength=N||w.strength,w.falloff=F||w.falloff);var j=new rp(this._scene,w),z=Array();return k.forEach((function(w){var N=j.getImpostorHitData(w,D);N&&(w.applyImpulse(N.force,N.contactPoint),z.push({impostor:w,hitData:N}))})),j.triggerAffectedImpostorsCallback(z),j.dispose(!1),j},e.prototype.applyRadialExplosionForce=function(D,w,N,F){if(!this._physicsEngine)return oe.a.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),null;var k=this._physicsEngine.getImpostors();if(0===k.length)return null;"number"==typeof w&&((w=new mh).radius=w,w.strength=N||w.strength,w.falloff=F||w.falloff);var j=new rp(this._scene,w),z=Array();return k.forEach((function(w){var N=j.getImpostorHitData(w,D);N&&(w.applyForce(N.force,N.contactPoint),z.push({impostor:w,hitData:N}))})),j.triggerAffectedImpostorsCallback(z),j.dispose(!1),j},e.prototype.gravitationalField=function(D,w,N,F){if(!this._physicsEngine)return oe.a.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),null;if(0===this._physicsEngine.getImpostors().length)return null;"number"==typeof w&&((w=new mh).radius=w,w.strength=N||w.strength,w.falloff=F||w.falloff);var k=new op(this,this._scene,D,w);return k.dispose(!1),k},e.prototype.updraft=function(D,w,N,F,k){if(!this._physicsEngine)return oe.a.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),null;if(0===this._physicsEngine.getImpostors().length)return null;"number"==typeof w&&((w=new gh).radius=w,w.strength=N||w.strength,w.height=F||w.height,w.updraftMode=k||w.updraftMode);var j=new ap(this._scene,D,w);return j.dispose(!1),j},e.prototype.vortex=function(D,w,N,F){if(!this._physicsEngine)return oe.a.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),null;if(0===this._physicsEngine.getImpostors().length)return null;"number"==typeof w&&((w=new vh).radius=w,w.strength=N||w.strength,w.height=F||w.height);var k=new sp(this._scene,D,w);return k.dispose(!1),k},e}(),rp=function(){function e(D,w){this._scene=D,this._options=w,this._dataFetched=!1,this._options=Object(Z.a)(Object(Z.a)({},new mh),this._options)}return e.prototype.getData=function(){return this._dataFetched=!0,{sphere:this._sphere}},e.prototype.getImpostorHitData=function(D,w){if(0===D.mass)return null;if(!this._intersectsWithSphere(D,w,this._options.radius))return null;if("Mesh"!==D.object.getClassName()&&"InstancedMesh"!==D.object.getClassName())return null;var N=D.getObjectCenter().subtract(w),F=new Qn.a(w,N,this._options.radius).intersectsMesh(D.object).pickedPoint;if(!F)return null;var k=z.e.Distance(w,F);if(k>this._options.radius)return null;var j=this._options.falloff===ep.Constant?this._options.strength:this._options.strength*(1-k/this._options.radius);return{force:N.multiplyByFloats(j,j,j),contactPoint:F,distanceFromOrigin:k}},e.prototype.triggerAffectedImpostorsCallback=function(D){this._options.affectedImpostorsCallback&&this._options.affectedImpostorsCallback(D)},e.prototype.dispose=function(D){var w=this;void 0===D&&(D=!0),D?this._sphere.dispose():setTimeout((function(){w._dataFetched||w._sphere.dispose()}),0)},e.prototype._prepareSphere=function(){this._sphere||(this._sphere=vo.a.CreateSphere("radialExplosionEventSphere",this._options.sphere,this._scene),this._sphere.isVisible=!1)},e.prototype._intersectsWithSphere=function(D,w,N){var F=D.object;return this._prepareSphere(),this._sphere.position=w,this._sphere.scaling=new z.e(2*N,2*N,2*N),this._sphere._updateBoundingInfo(),this._sphere.computeWorldMatrix(!0),this._sphere.intersectsMesh(F,!0)},e}(),op=function(){function e(D,w,N,F){this._physicsHelper=D,this._scene=w,this._origin=N,this._options=F,this._dataFetched=!1,this._options=Object(Z.a)(Object(Z.a)({},new mh),this._options),this._tickCallback=this._tick.bind(this),this._options.strength=-1*this._options.strength}return e.prototype.getData=function(){return this._dataFetched=!0,{sphere:this._sphere}},e.prototype.enable=function(){this._tickCallback.call(this),this._scene.registerBeforeRender(this._tickCallback)},e.prototype.disable=function(){this._scene.unregisterBeforeRender(this._tickCallback)},e.prototype.dispose=function(D){var w=this;void 0===D&&(D=!0),D?this._sphere.dispose():setTimeout((function(){w._dataFetched||w._sphere.dispose()}),0)},e.prototype._tick=function(){if(this._sphere)this._physicsHelper.applyRadialExplosionForce(this._origin,this._options);else{var D=this._physicsHelper.applyRadialExplosionForce(this._origin,this._options);D&&(this._sphere=D.getData().sphere.clone("radialExplosionEventSphereClone"))}},e}(),ap=function(){function e(D,w,N){this._scene=D,this._origin=w,this._options=N,this._originTop=z.e.Zero(),this._originDirection=z.e.Zero(),this._cylinderPosition=z.e.Zero(),this._dataFetched=!1,this._physicsEngine=this._scene.getPhysicsEngine(),this._options=Object(Z.a)(Object(Z.a)({},new gh),this._options),this._origin.addToRef(new z.e(0,this._options.height/2,0),this._cylinderPosition),this._origin.addToRef(new z.e(0,this._options.height,0),this._originTop),this._options.updraftMode===tp.Perpendicular&&(this._originDirection=this._origin.subtract(this._originTop).normalize()),this._tickCallback=this._tick.bind(this),this._prepareCylinder()}return e.prototype.getData=function(){return this._dataFetched=!0,{cylinder:this._cylinder}},e.prototype.enable=function(){this._tickCallback.call(this),this._scene.registerBeforeRender(this._tickCallback)},e.prototype.disable=function(){this._scene.unregisterBeforeRender(this._tickCallback)},e.prototype.dispose=function(D){var w=this;void 0===D&&(D=!0),this._cylinder&&(D?this._cylinder.dispose():setTimeout((function(){w._dataFetched||w._cylinder.dispose()}),0))},e.prototype.getImpostorHitData=function(D){if(0===D.mass)return null;if(!this._intersectsWithCylinder(D))return null;var w=D.getObjectCenter();if(this._options.updraftMode===tp.Perpendicular)var N=this._originDirection;else N=w.subtract(this._originTop);var F=z.e.Distance(this._origin,w),k=-1*this._options.strength;return{force:N.multiplyByFloats(k,k,k),contactPoint:w,distanceFromOrigin:F}},e.prototype._tick=function(){var D=this;this._physicsEngine.getImpostors().forEach((function(w){var N=D.getImpostorHitData(w);N&&w.applyForce(N.force,N.contactPoint)}))},e.prototype._prepareCylinder=function(){this._cylinder||(this._cylinder=nr.a.CreateCylinder("updraftEventCylinder",{height:this._options.height,diameter:2*this._options.radius},this._scene),this._cylinder.isVisible=!1)},e.prototype._intersectsWithCylinder=function(D){var w=D.object;return this._cylinder.position=this._cylinderPosition,this._cylinder.intersectsMesh(w,!0)},e}(),sp=function(){function e(D,w,N){this._scene=D,this._origin=w,this._options=N,this._originTop=z.e.Zero(),this._cylinderPosition=z.e.Zero(),this._dataFetched=!1,this._physicsEngine=this._scene.getPhysicsEngine(),this._options=Object(Z.a)(Object(Z.a)({},new vh),this._options),this._origin.addToRef(new z.e(0,this._options.height/2,0),this._cylinderPosition),this._origin.addToRef(new z.e(0,this._options.height,0),this._originTop),this._tickCallback=this._tick.bind(this),this._prepareCylinder()}return e.prototype.getData=function(){return this._dataFetched=!0,{cylinder:this._cylinder}},e.prototype.enable=function(){this._tickCallback.call(this),this._scene.registerBeforeRender(this._tickCallback)},e.prototype.disable=function(){this._scene.unregisterBeforeRender(this._tickCallback)},e.prototype.dispose=function(D){var w=this;void 0===D&&(D=!0),D?this._cylinder.dispose():setTimeout((function(){w._dataFetched||w._cylinder.dispose()}),0)},e.prototype.getImpostorHitData=function(D){if(0===D.mass)return null;if(!this._intersectsWithCylinder(D))return null;if("Mesh"!==D.object.getClassName()&&"InstancedMesh"!==D.object.getClassName())return null;var w=D.getObjectCenter(),N=new z.e(this._origin.x,w.y,this._origin.z),F=w.subtract(N),k=new Qn.a(N,F,this._options.radius).intersectsMesh(D.object),j=k.pickedPoint;if(!j)return null;var G=k.distance/this._options.radius,H=j.normalize();if(G>this._options.centripetalForceThreshold&&(H=H.negate()),G>this._options.centripetalForceThreshold)var X=H.x*this._options.centripetalForceMultiplier,q=H.y*this._options.updraftForceMultiplier,Z=H.z*this._options.centripetalForceMultiplier;else{var J=z.e.Cross(N,w).normalize();X=(J.x+H.x)*this._options.centrifugalForceMultiplier,q=this._originTop.y*this._options.updraftForceMultiplier,Z=(J.z+H.z)*this._options.centrifugalForceMultiplier}var $=new z.e(X,q,Z);return{force:$=$.multiplyByFloats(this._options.strength,this._options.strength,this._options.strength),contactPoint:w,distanceFromOrigin:G}},e.prototype._tick=function(){var D=this;this._physicsEngine.getImpostors().forEach((function(w){var N=D.getImpostorHitData(w);N&&w.applyForce(N.force,N.contactPoint)}))},e.prototype._prepareCylinder=function(){this._cylinder||(this._cylinder=nr.a.CreateCylinder("vortexEventCylinder",{height:this._options.height,diameter:2*this._options.radius},this._scene),this._cylinder.isVisible=!1)},e.prototype._intersectsWithCylinder=function(D){var w=D.object;return this._cylinder.position=this._cylinderPosition,this._cylinder.intersectsMesh(w,!0)},e}(),mh=function(){this.radius=5,this.strength=10,this.falloff=ep.Constant,this.sphere={segments:32,diameter:1}},gh=function(){this.radius=5,this.strength=10,this.height=10,this.updraftMode=tp.Center},vh=function(){this.radius=5,this.strength=10,this.height=10,this.centripetalForceThreshold=.7,this.centripetalForceMultiplier=5,this.centrifugalForceMultiplier=.5,this.updraftForceMultiplier=.02};!function(D){D[D.Constant=0]="Constant",D[D.Linear=1]="Linear"}(ep||(ep={})),function(D){D[D.Center=0]="Center",D[D.Perpendicular=1]="Perpendicular"}(tp||(tp={})),li.a.ShadersStore.blackAndWhitePixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform float degree;\nvoid main(void)\n{\nvec3 color=texture2D(textureSampler,vUV).rgb;\nfloat luminance=dot(color,vec3(0.3,0.59,0.11));\nvec3 blackAndWhite=vec3(luminance,luminance,luminance);\ngl_FragColor=vec4(color-((color-blackAndWhite)*degree),1.0);\n}";var cp=function(D){function t(w,N,F,k,j,z){var G=D.call(this,w,"blackAndWhite",["degree"],null,N,F,k,j,z)||this;return G.degree=1,G.onApplyObservable.add((function(D){D.setFloat("degree",G.degree)})),G}return Object(Z.d)(t,D),t}(fi),up=function(){function e(D,w,N,F){this._name=w,this._singleInstance=F||!0,this._getPostProcesses=N,this._cameras={},this._indicesForCamera={},this._postProcesses={}}return Object.defineProperty(e.prototype,"isSupported",{get:function(){for(var D in this._postProcesses)if(this._postProcesses.hasOwnProperty(D))for(var w=this._postProcesses[D],N=0;N<w.length;N++)if(!w[N].isSupported)return!1;return!0},enumerable:!0,configurable:!0}),e.prototype._update=function(){},e.prototype._attachCameras=function(D){var w,N=this,F=Dt.b.MakeArray(D||this._cameras);if(F)for(var k=0;k<F.length;k++){var j=F[k],z=j.name;if(w=this._singleInstance?0:z,!this._postProcesses[w]){var G=this._getPostProcesses();G&&(this._postProcesses[w]=Array.isArray(G)?G:[G])}this._indicesForCamera[z]||(this._indicesForCamera[z]=[]),this._postProcesses[w].forEach((function(D){var w=j.attachPostProcess(D);N._indicesForCamera[z].push(w)})),this._cameras[z]||(this._cameras[z]=j)}},e.prototype._detachCameras=function(D){var w=Dt.b.MakeArray(D||this._cameras);if(w)for(var N=0;N<w.length;N++){var F=w[N],k=F.name,j=this._postProcesses[this._singleInstance?0:k];j&&j.forEach((function(D){F.detachPostProcess(D)})),this._cameras[k]&&(this._cameras[k]=null)}},e.prototype._enable=function(D){var w=this,N=Dt.b.MakeArray(D||this._cameras);if(N)for(var F=0;F<N.length;F++)for(var k=N[F],j=k.name,z=0;z<this._indicesForCamera[j].length;z++)void 0!==k._postProcesses[this._indicesForCamera[j][z]]&&null!==k._postProcesses[this._indicesForCamera[j][z]]||this._postProcesses[this._singleInstance?0:j].forEach((function(D){N[F].attachPostProcess(D,w._indicesForCamera[j][z])}))},e.prototype._disable=function(D){var w=Dt.b.MakeArray(D||this._cameras);if(w)for(var N=0;N<w.length;N++){var F=w[N],k=F.name;this._postProcesses[this._singleInstance?0:k].forEach((function(D){F.detachPostProcess(D)}))}},e.prototype.getPostProcesses=function(D){return this._singleInstance?this._postProcesses[0]:D?this._postProcesses[D.name]:null},e}();li.a.ShadersStore.extractHighlightsPixelShader="#include<helperFunctions>\n\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform float threshold;\nuniform float exposure;\nvoid main(void)\n{\ngl_FragColor=texture2D(textureSampler,vUV);\nfloat luma=getLuminance(gl_FragColor.rgb*exposure);\ngl_FragColor.rgb=step(threshold,luma)*gl_FragColor.rgb;\n}";var lp=function(D){function t(w,N,F,k,j,z,G,H){void 0===G&&(G=ce.a.TEXTURETYPE_UNSIGNED_INT),void 0===H&&(H=!1);var X=D.call(this,w,"extractHighlights",["threshold","exposure"],null,N,F,k,j,z,null,G,void 0,null,H)||this;return X.threshold=.9,X._exposure=1,X._inputPostProcess=null,X.onApplyObservable.add((function(D){X._inputPostProcess&&D.setTextureFromPostProcess("textureSampler",X._inputPostProcess),D.setFloat("threshold",Math.pow(X.threshold,rt.b)),D.setFloat("exposure",X._exposure)})),X}return Object(Z.d)(t,D),t}(fi);li.a.ShadersStore.bloomMergePixelShader="uniform sampler2D textureSampler;\nuniform sampler2D bloomBlur;\nvarying vec2 vUV;\nuniform float bloomWeight;\nvoid main(void)\n{\ngl_FragColor=texture2D(textureSampler,vUV);\nvec3 blurred=texture2D(bloomBlur,vUV).rgb;\ngl_FragColor.rgb=gl_FragColor.rgb+(blurred.rgb*bloomWeight);\n}\n";var hp=function(D){function t(w,N,F,k,j,z,G,H,X,q,Z){void 0===q&&(q=ce.a.TEXTURETYPE_UNSIGNED_INT),void 0===Z&&(Z=!1);var J=D.call(this,w,"bloomMerge",["bloomWeight"],["circleOfConfusionSampler","blurStep0","blurStep1","blurStep2","bloomBlur"],j,z,G,H,X,null,q,void 0,null,!0)||this;return J.weight=k,J.onApplyObservable.add((function(D){D.setTextureFromPostProcess("textureSampler",N),D.setTextureFromPostProcessOutput("bloomBlur",F),D.setFloat("bloomWeight",J.weight)})),Z||J.updateEffect(),J}return Object(Z.d)(t,D),t}(fi),dp=function(D){function t(w,N,F,k,j,G){void 0===j&&(j=0),void 0===G&&(G=!1);var H=D.call(this,w.getEngine(),"bloom",(function(){return H._effects}),!0)||this;return H.bloomScale=N,H._effects=[],H._downscale=new lp("highlights",1,null,Jt.a.BILINEAR_SAMPLINGMODE,w.getEngine(),!1,j,G),H._blurX=new Fo("horizontal blur",new z.d(1,0),10,N,null,Jt.a.BILINEAR_SAMPLINGMODE,w.getEngine(),!1,j,void 0,G),H._blurX.alwaysForcePOT=!0,H._blurX.autoClear=!1,H._blurY=new Fo("vertical blur",new z.d(0,1),10,N,null,Jt.a.BILINEAR_SAMPLINGMODE,w.getEngine(),!1,j,void 0,G),H._blurY.alwaysForcePOT=!0,H._blurY.autoClear=!1,H.kernel=k,H._effects=[H._downscale,H._blurX,H._blurY],H._merge=new hp("bloomMerge",H._downscale,H._blurY,F,N,null,Jt.a.BILINEAR_SAMPLINGMODE,w.getEngine(),!1,j,G),H._merge.autoClear=!1,H._effects.push(H._merge),H}return Object(Z.d)(t,D),Object.defineProperty(t.prototype,"threshold",{get:function(){return this._downscale.threshold},set:function(D){this._downscale.threshold=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"weight",{get:function(){return this._merge.weight},set:function(D){this._merge.weight=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"kernel",{get:function(){return this._blurX.kernel/this.bloomScale},set:function(D){this._blurX.kernel=D*this.bloomScale,this._blurY.kernel=D*this.bloomScale},enumerable:!0,configurable:!0}),t.prototype.disposeEffects=function(D){for(var w=0;w<this._effects.length;w++)this._effects[w].dispose(D)},t.prototype._updateEffects=function(){for(var D=0;D<this._effects.length;D++)this._effects[D].updateEffect()},t.prototype._isReady=function(){for(var D=0;D<this._effects.length;D++)if(!this._effects[D].isReady())return!1;return!0},t}(up);li.a.ShadersStore.chromaticAberrationPixelShader="\nuniform sampler2D textureSampler;\n\nuniform float chromatic_aberration;\nuniform float radialIntensity;\nuniform vec2 direction;\nuniform vec2 centerPosition;\nuniform float screen_width;\nuniform float screen_height;\n\nvarying vec2 vUV;\nvoid main(void)\n{\nvec2 centered_screen_pos=vec2(vUV.x-centerPosition.x,vUV.y-centerPosition.y);\nvec2 directionOfEffect=direction;\nif(directionOfEffect.x == 0. && directionOfEffect.y == 0.){\ndirectionOfEffect=normalize(centered_screen_pos);\n}\nfloat radius2=centered_screen_pos.x*centered_screen_pos.x\n+centered_screen_pos.y*centered_screen_pos.y;\nfloat radius=sqrt(radius2);\nvec4 original=texture2D(textureSampler,vUV);\n\nvec3 ref_indices=vec3(-0.3,0.0,0.3);\nfloat ref_shiftX=chromatic_aberration*pow(radius,radialIntensity)*directionOfEffect.x/screen_width;\nfloat ref_shiftY=chromatic_aberration*pow(radius,radialIntensity)*directionOfEffect.y/screen_height;\n\nvec2 ref_coords_r=vec2(vUV.x+ref_indices.r*ref_shiftX,vUV.y+ref_indices.r*ref_shiftY*0.5);\nvec2 ref_coords_g=vec2(vUV.x+ref_indices.g*ref_shiftX,vUV.y+ref_indices.g*ref_shiftY*0.5);\nvec2 ref_coords_b=vec2(vUV.x+ref_indices.b*ref_shiftX,vUV.y+ref_indices.b*ref_shiftY*0.5);\noriginal.r=texture2D(textureSampler,ref_coords_r).r;\noriginal.g=texture2D(textureSampler,ref_coords_g).g;\noriginal.b=texture2D(textureSampler,ref_coords_b).b;\noriginal.a=clamp(texture2D(textureSampler,ref_coords_r).a+texture2D(textureSampler,ref_coords_g).a+texture2D(textureSampler,ref_coords_b).a,0.,1.);\ngl_FragColor=original;\n}";var fp=function(D){function t(w,N,F,k,j,G,H,X,q,Z){void 0===q&&(q=ce.a.TEXTURETYPE_UNSIGNED_INT),void 0===Z&&(Z=!1);var J=D.call(this,w,"chromaticAberration",["chromatic_aberration","screen_width","screen_height","direction","radialIntensity","centerPosition"],[],k,j,G,H,X,null,q,void 0,null,Z)||this;return J.aberrationAmount=30,J.radialIntensity=0,J.direction=new z.d(.707,.707),J.centerPosition=new z.d(.5,.5),J.onApplyObservable.add((function(D){D.setFloat("chromatic_aberration",J.aberrationAmount),D.setFloat("screen_width",N),D.setFloat("screen_height",F),D.setFloat("radialIntensity",J.radialIntensity),D.setFloat2("direction",J.direction.x,J.direction.y),D.setFloat2("centerPosition",J.centerPosition.x,J.centerPosition.y)})),J}return Object(Z.d)(t,D),t}(fi);li.a.ShadersStore.circleOfConfusionPixelShader="\nuniform sampler2D depthSampler;\n\nvarying vec2 vUV;\n\nuniform vec2 cameraMinMaxZ;\n\nuniform float focusDistance;\nuniform float cocPrecalculation;\nvoid main(void)\n{\nfloat depth=texture2D(depthSampler,vUV).r;\nfloat pixelDistance=(cameraMinMaxZ.x+(cameraMinMaxZ.y-cameraMinMaxZ.x)*depth)*1000.0;\nfloat coc=abs(cocPrecalculation* ((focusDistance-pixelDistance)/pixelDistance));\ncoc=clamp(coc,0.0,1.0);\ngl_FragColor=vec4(coc,depth,coc,1.0);\n}\n";var pp=function(D){function t(w,N,F,k,j,z,G,H,X){void 0===H&&(H=ce.a.TEXTURETYPE_UNSIGNED_INT),void 0===X&&(X=!1);var q=D.call(this,w,"circleOfConfusion",["cameraMinMaxZ","focusDistance","cocPrecalculation"],["depthSampler"],F,k,j,z,G,null,H,void 0,null,X)||this;return q.lensSize=50,q.fStop=1.4,q.focusDistance=2e3,q.focalLength=50,q._depthTexture=null,q._depthTexture=N,q.onApplyObservable.add((function(D){if(q._depthTexture){D.setTexture("depthSampler",q._depthTexture);var w=q.lensSize/q.fStop*q.focalLength/(q.focusDistance-q.focalLength);D.setFloat("focusDistance",q.focusDistance),D.setFloat("cocPrecalculation",w),D.setFloat2("cameraMinMaxZ",q._depthTexture.activeCamera.minZ,q._depthTexture.activeCamera.maxZ)}else oe.a.Warn("No depth texture set on CircleOfConfusionPostProcess")})),q}return Object(Z.d)(t,D),Object.defineProperty(t.prototype,"depthTexture",{set:function(D){this._depthTexture=D},enumerable:!0,configurable:!0}),t}(fi);li.a.ShadersStore.colorCorrectionPixelShader="\nuniform sampler2D textureSampler;\nuniform sampler2D colorTable;\n\nvarying vec2 vUV;\n\nconst float SLICE_COUNT=16.0;\n\nvec4 sampleAs3DTexture(sampler2D textureSampler,vec3 uv,float width) {\nfloat sliceSize=1.0/width;\nfloat slicePixelSize=sliceSize/width;\nfloat sliceInnerSize=slicePixelSize*(width-1.0);\nfloat zSlice0=min(floor(uv.z*width),width-1.0);\nfloat zSlice1=min(zSlice0+1.0,width-1.0);\nfloat xOffset=slicePixelSize*0.5+uv.x*sliceInnerSize;\nfloat s0=xOffset+(zSlice0*sliceSize);\nfloat s1=xOffset+(zSlice1*sliceSize);\nvec4 slice0Color=texture2D(textureSampler,vec2(s0,uv.y));\nvec4 slice1Color=texture2D(textureSampler,vec2(s1,uv.y));\nfloat zOffset=mod(uv.z*width,1.0);\nvec4 result=mix(slice0Color,slice1Color,zOffset);\nreturn result;\n}\nvoid main(void)\n{\nvec4 screen_color=texture2D(textureSampler,vUV);\ngl_FragColor=sampleAs3DTexture(colorTable,screen_color.rgb,SLICE_COUNT);\n}";var _p=function(D){function t(w,N,F,k,j,z,G){var H=D.call(this,w,"colorCorrection",null,["colorTable"],F,k,j,z,G)||this;return H._colorTableTexture=new Jt.a(N,k.getScene(),!0,!1,Jt.a.TRILINEAR_SAMPLINGMODE),H._colorTableTexture.anisotropicFilteringLevel=1,H._colorTableTexture.wrapU=Jt.a.CLAMP_ADDRESSMODE,H._colorTableTexture.wrapV=Jt.a.CLAMP_ADDRESSMODE,H.onApply=function(D){D.setTexture("colorTable",H._colorTableTexture)},H}return Object(Z.d)(t,D),t}(fi);li.a.ShadersStore.convolutionPixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform vec2 screenSize;\nuniform float kernel[9];\nvoid main(void)\n{\nvec2 onePixel=vec2(1.0,1.0)/screenSize;\nvec4 colorSum =\ntexture2D(textureSampler,vUV+onePixel*vec2(-1,-1))*kernel[0] +\ntexture2D(textureSampler,vUV+onePixel*vec2(0,-1))*kernel[1] +\ntexture2D(textureSampler,vUV+onePixel*vec2(1,-1))*kernel[2] +\ntexture2D(textureSampler,vUV+onePixel*vec2(-1,0))*kernel[3] +\ntexture2D(textureSampler,vUV+onePixel*vec2(0,0))*kernel[4] +\ntexture2D(textureSampler,vUV+onePixel*vec2(1,0))*kernel[5] +\ntexture2D(textureSampler,vUV+onePixel*vec2(-1,1))*kernel[6] +\ntexture2D(textureSampler,vUV+onePixel*vec2(0,1))*kernel[7] +\ntexture2D(textureSampler,vUV+onePixel*vec2(1,1))*kernel[8];\nfloat kernelWeight =\nkernel[0] +\nkernel[1] +\nkernel[2] +\nkernel[3] +\nkernel[4] +\nkernel[5] +\nkernel[6] +\nkernel[7] +\nkernel[8];\nif (kernelWeight<=0.0) {\nkernelWeight=1.0;\n}\ngl_FragColor=vec4((colorSum/kernelWeight).rgb,1);\n}";var mp=function(D){function t(w,N,F,k,j,z,G,H){void 0===H&&(H=ce.a.TEXTURETYPE_UNSIGNED_INT);var X=D.call(this,w,"convolution",["kernel","screenSize"],null,F,k,j,z,G,null,H)||this;return X.kernel=N,X.onApply=function(D){D.setFloat2("screenSize",X.width,X.height),D.setArray("kernel",X.kernel)},X}return Object(Z.d)(t,D),t.EdgeDetect0Kernel=[1,0,-1,0,0,0,-1,0,1],t.EdgeDetect1Kernel=[0,1,0,1,-4,1,0,1,0],t.EdgeDetect2Kernel=[-1,-1,-1,-1,8,-1,-1,-1,-1],t.SharpenKernel=[0,-1,0,-1,5,-1,0,-1,0],t.EmbossKernel=[-2,-1,0,-1,1,1,0,1,2],t.GaussianKernel=[0,1,0,1,1,1,0,1,0],t}(fi),gp=function(D){function t(w,N,F,k,j,z,G,H,X,q,Z,J,$){void 0===H&&(H=null),void 0===X&&(X=Jt.a.BILINEAR_SAMPLINGMODE),void 0===J&&(J=ce.a.TEXTURETYPE_UNSIGNED_INT),void 0===$&&($=!1);var te=D.call(this,w,F,k,j,z,X=ce.a.TEXTURE_BILINEAR_SAMPLINGMODE,q,Z,J=ce.a.TEXTURETYPE_UNSIGNED_INT,"#define DOF 1\r\n",$)||this;return te.direction=F,te.onApplyObservable.add((function(D){null!=H&&D.setTextureFromPostProcess("textureSampler",H),D.setTextureFromPostProcessOutput("circleOfConfusionSampler",G),N.activeCamera&&D.setFloat2("cameraMinMaxZ",N.activeCamera.minZ,N.activeCamera.maxZ)})),te}return Object(Z.d)(t,D),t}(Fo);li.a.ShadersStore.depthOfFieldMergePixelShader="uniform sampler2D textureSampler;\nvarying vec2 vUV;\nuniform sampler2D circleOfConfusionSampler;\nuniform sampler2D blurStep0;\n#if BLUR_LEVEL>0\nuniform sampler2D blurStep1;\n#endif\n#if BLUR_LEVEL>1\nuniform sampler2D blurStep2;\n#endif\nvoid main(void)\n{\nfloat coc=texture2D(circleOfConfusionSampler,vUV).r;\n#if BLUR_LEVEL == 0\nvec4 original=texture2D(textureSampler,vUV);\nvec4 blurred0=texture2D(blurStep0,vUV);\ngl_FragColor=mix(original,blurred0,coc);\n#endif\n#if BLUR_LEVEL == 1\nif(coc<0.5){\nvec4 original=texture2D(textureSampler,vUV);\nvec4 blurred1=texture2D(blurStep1,vUV);\ngl_FragColor=mix(original,blurred1,coc/0.5);\n}else{\nvec4 blurred0=texture2D(blurStep0,vUV);\nvec4 blurred1=texture2D(blurStep1,vUV);\ngl_FragColor=mix(blurred1,blurred0,(coc-0.5)/0.5);\n}\n#endif\n#if BLUR_LEVEL == 2\nif(coc<0.33){\nvec4 original=texture2D(textureSampler,vUV);\nvec4 blurred2=texture2D(blurStep2,vUV);\ngl_FragColor=mix(original,blurred2,coc/0.33);\n}else if(coc<0.66){\nvec4 blurred1=texture2D(blurStep1,vUV);\nvec4 blurred2=texture2D(blurStep2,vUV);\ngl_FragColor=mix(blurred2,blurred1,(coc-0.33)/0.33);\n}else{\nvec4 blurred0=texture2D(blurStep0,vUV);\nvec4 blurred1=texture2D(blurStep1,vUV);\ngl_FragColor=mix(blurred1,blurred0,(coc-0.66)/0.34);\n}\n#endif\n}\n";var vp,Uh=function(){},yp=function(D){function t(w,N,F,k,j,z,G,H,X,q,Z){void 0===q&&(q=ce.a.TEXTURETYPE_UNSIGNED_INT),void 0===Z&&(Z=!1);var J=D.call(this,w,"depthOfFieldMerge",[],["circleOfConfusionSampler","blurStep0","blurStep1","blurStep2"],j,z,G,H,X,null,q,void 0,null,!0)||this;return J.blurSteps=k,J.onApplyObservable.add((function(D){D.setTextureFromPostProcess("textureSampler",N),D.setTextureFromPostProcessOutput("circleOfConfusionSampler",F),k.forEach((function(w,N){D.setTextureFromPostProcessOutput("blurStep"+(k.length-N-1),w)}))})),Z||J.updateEffect(),J}return Object(Z.d)(t,D),t.prototype.updateEffect=function(w,N,F,k,j,z){void 0===w&&(w=null),void 0===N&&(N=null),void 0===F&&(F=null),w||(w="",w+="#define BLUR_LEVEL "+(this.blurSteps.length-1)+"\n"),D.prototype.updateEffect.call(this,w,N,F,k,j,z)},t}(fi);!function(D){D[D.Low=0]="Low",D[D.Medium=1]="Medium",D[D.High=2]="High"}(vp||(vp={}));var bp=function(D){function t(w,N,F,k,j){void 0===F&&(F=vp.Low),void 0===k&&(k=0),void 0===j&&(j=!1);var G=D.call(this,w.getEngine(),"depth of field",(function(){return G._effects}),!0)||this;G._effects=[],G._circleOfConfusion=new pp("circleOfConfusion",N,1,null,Jt.a.BILINEAR_SAMPLINGMODE,w.getEngine(),!1,k,j),G._depthOfFieldBlurY=[],G._depthOfFieldBlurX=[];var H=1,X=15;switch(F){case vp.High:H=3,X=51;break;case vp.Medium:H=2,X=31;break;default:X=15,H=1}for(var q=X/Math.pow(2,H-1),Z=1,J=0;J<H;J++){var $=new gp("verticle blur",w,new z.d(0,1),q,Z,null,G._circleOfConfusion,0==J?G._circleOfConfusion:null,Jt.a.BILINEAR_SAMPLINGMODE,w.getEngine(),!1,k,j);$.autoClear=!1,Z=.75/Math.pow(2,J);var te=new gp("horizontal blur",w,new z.d(1,0),q,Z,null,G._circleOfConfusion,null,Jt.a.BILINEAR_SAMPLINGMODE,w.getEngine(),!1,k,j);te.autoClear=!1,G._depthOfFieldBlurY.push($),G._depthOfFieldBlurX.push(te)}for(G._effects=[G._circleOfConfusion],J=0;J<G._depthOfFieldBlurX.length;J++)G._effects.push(G._depthOfFieldBlurY[J]),G._effects.push(G._depthOfFieldBlurX[J]);return G._dofMerge=new yp("dofMerge",G._circleOfConfusion,G._circleOfConfusion,G._depthOfFieldBlurX,Z,null,Jt.a.BILINEAR_SAMPLINGMODE,w.getEngine(),!1,k,j),G._dofMerge.autoClear=!1,G._effects.push(G._dofMerge),G}return Object(Z.d)(t,D),Object.defineProperty(t.prototype,"focalLength",{get:function(){return this._circleOfConfusion.focalLength},set:function(D){this._circleOfConfusion.focalLength=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fStop",{get:function(){return this._circleOfConfusion.fStop},set:function(D){this._circleOfConfusion.fStop=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"focusDistance",{get:function(){return this._circleOfConfusion.focusDistance},set:function(D){this._circleOfConfusion.focusDistance=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lensSize",{get:function(){return this._circleOfConfusion.lensSize},set:function(D){this._circleOfConfusion.lensSize=D},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"DepthOfFieldEffect"},Object.defineProperty(t.prototype,"depthTexture",{set:function(D){this._circleOfConfusion.depthTexture=D},enumerable:!0,configurable:!0}),t.prototype.disposeEffects=function(D){for(var w=0;w<this._effects.length;w++)this._effects[w].dispose(D)},t.prototype._updateEffects=function(){for(var D=0;D<this._effects.length;D++)this._effects[D].updateEffect()},t.prototype._isReady=function(){for(var D=0;D<this._effects.length;D++)if(!this._effects[D].isReady())return!1;return!0},t}(up);li.a.ShadersStore.displayPassPixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D passSampler;\nvoid main(void)\n{\ngl_FragColor=texture2D(passSampler,vUV);\n}";var Tp=function(D){function t(w,N,F,k,j,z){return D.call(this,w,"displayPass",["passSampler"],["passSampler"],N,F,k,j,z)||this}return Object(Z.d)(t,D),t}(fi);li.a.ShadersStore.filterPixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform mat4 kernelMatrix;\nvoid main(void)\n{\nvec3 baseColor=texture2D(textureSampler,vUV).rgb;\nvec3 updatedColor=(kernelMatrix*vec4(baseColor,1.0)).rgb;\ngl_FragColor=vec4(updatedColor,1.0);\n}";var Ep=function(D){function t(w,N,F,k,j,z,G){var H=D.call(this,w,"filter",["kernelMatrix"],null,F,k,j,z,G)||this;return H.kernelMatrix=N,H.onApply=function(D){D.setMatrix("kernelMatrix",H.kernelMatrix)},H}return Object(Z.d)(t,D),t}(fi);li.a.ShadersStore.fxaaPixelShader="uniform sampler2D textureSampler;\nuniform vec2 texelSize;\nvarying vec2 vUV;\nvarying vec2 sampleCoordS;\nvarying vec2 sampleCoordE;\nvarying vec2 sampleCoordN;\nvarying vec2 sampleCoordW;\nvarying vec2 sampleCoordNW;\nvarying vec2 sampleCoordSE;\nvarying vec2 sampleCoordNE;\nvarying vec2 sampleCoordSW;\nconst float fxaaQualitySubpix=1.0;\nconst float fxaaQualityEdgeThreshold=0.166;\nconst float fxaaQualityEdgeThresholdMin=0.0833;\nconst vec3 kLumaCoefficients=vec3(0.2126,0.7152,0.0722);\n#define FxaaLuma(rgba) dot(rgba.rgb,kLumaCoefficients)\nvoid main(){\nvec2 posM;\nposM.x=vUV.x;\nposM.y=vUV.y;\nvec4 rgbyM=texture2D(textureSampler,vUV,0.0);\nfloat lumaM=FxaaLuma(rgbyM);\nfloat lumaS=FxaaLuma(texture2D(textureSampler,sampleCoordS,0.0));\nfloat lumaE=FxaaLuma(texture2D(textureSampler,sampleCoordE,0.0));\nfloat lumaN=FxaaLuma(texture2D(textureSampler,sampleCoordN,0.0));\nfloat lumaW=FxaaLuma(texture2D(textureSampler,sampleCoordW,0.0));\nfloat maxSM=max(lumaS,lumaM);\nfloat minSM=min(lumaS,lumaM);\nfloat maxESM=max(lumaE,maxSM);\nfloat minESM=min(lumaE,minSM);\nfloat maxWN=max(lumaN,lumaW);\nfloat minWN=min(lumaN,lumaW);\nfloat rangeMax=max(maxWN,maxESM);\nfloat rangeMin=min(minWN,minESM);\nfloat rangeMaxScaled=rangeMax*fxaaQualityEdgeThreshold;\nfloat range=rangeMax-rangeMin;\nfloat rangeMaxClamped=max(fxaaQualityEdgeThresholdMin,rangeMaxScaled);\n#ifndef MALI\nif(range<rangeMaxClamped)\n{\ngl_FragColor=rgbyM;\nreturn;\n}\n#endif\nfloat lumaNW=FxaaLuma(texture2D(textureSampler,sampleCoordNW,0.0));\nfloat lumaSE=FxaaLuma(texture2D(textureSampler,sampleCoordSE,0.0));\nfloat lumaNE=FxaaLuma(texture2D(textureSampler,sampleCoordNE,0.0));\nfloat lumaSW=FxaaLuma(texture2D(textureSampler,sampleCoordSW,0.0));\nfloat lumaNS=lumaN+lumaS;\nfloat lumaWE=lumaW+lumaE;\nfloat subpixRcpRange=1.0/range;\nfloat subpixNSWE=lumaNS+lumaWE;\nfloat edgeHorz1=(-2.0*lumaM)+lumaNS;\nfloat edgeVert1=(-2.0*lumaM)+lumaWE;\nfloat lumaNESE=lumaNE+lumaSE;\nfloat lumaNWNE=lumaNW+lumaNE;\nfloat edgeHorz2=(-2.0*lumaE)+lumaNESE;\nfloat edgeVert2=(-2.0*lumaN)+lumaNWNE;\nfloat lumaNWSW=lumaNW+lumaSW;\nfloat lumaSWSE=lumaSW+lumaSE;\nfloat edgeHorz4=(abs(edgeHorz1)*2.0)+abs(edgeHorz2);\nfloat edgeVert4=(abs(edgeVert1)*2.0)+abs(edgeVert2);\nfloat edgeHorz3=(-2.0*lumaW)+lumaNWSW;\nfloat edgeVert3=(-2.0*lumaS)+lumaSWSE;\nfloat edgeHorz=abs(edgeHorz3)+edgeHorz4;\nfloat edgeVert=abs(edgeVert3)+edgeVert4;\nfloat subpixNWSWNESE=lumaNWSW+lumaNESE;\nfloat lengthSign=texelSize.x;\nbool horzSpan=edgeHorz>=edgeVert;\nfloat subpixA=subpixNSWE*2.0+subpixNWSWNESE;\nif (!horzSpan)\n{\nlumaN=lumaW;\n}\nif (!horzSpan)\n{\nlumaS=lumaE;\n}\nif (horzSpan)\n{\nlengthSign=texelSize.y;\n}\nfloat subpixB=(subpixA*(1.0/12.0))-lumaM;\nfloat gradientN=lumaN-lumaM;\nfloat gradientS=lumaS-lumaM;\nfloat lumaNN=lumaN+lumaM;\nfloat lumaSS=lumaS+lumaM;\nbool pairN=abs(gradientN)>=abs(gradientS);\nfloat gradient=max(abs(gradientN),abs(gradientS));\nif (pairN)\n{\nlengthSign=-lengthSign;\n}\nfloat subpixC=clamp(abs(subpixB)*subpixRcpRange,0.0,1.0);\nvec2 posB;\nposB.x=posM.x;\nposB.y=posM.y;\nvec2 offNP;\noffNP.x=(!horzSpan) ? 0.0 : texelSize.x;\noffNP.y=(horzSpan) ? 0.0 : texelSize.y;\nif (!horzSpan)\n{\nposB.x+=lengthSign*0.5;\n}\nif (horzSpan)\n{\nposB.y+=lengthSign*0.5;\n}\nvec2 posN;\nposN.x=posB.x-offNP.x*1.5;\nposN.y=posB.y-offNP.y*1.5;\nvec2 posP;\nposP.x=posB.x+offNP.x*1.5;\nposP.y=posB.y+offNP.y*1.5;\nfloat subpixD=((-2.0)*subpixC)+3.0;\nfloat lumaEndN=FxaaLuma(texture2D(textureSampler,posN,0.0));\nfloat subpixE=subpixC*subpixC;\nfloat lumaEndP=FxaaLuma(texture2D(textureSampler,posP,0.0));\nif (!pairN)\n{\nlumaNN=lumaSS;\n}\nfloat gradientScaled=gradient*1.0/4.0;\nfloat lumaMM=lumaM-lumaNN*0.5;\nfloat subpixF=subpixD*subpixE;\nbool lumaMLTZero=lumaMM<0.0;\nlumaEndN-=lumaNN*0.5;\nlumaEndP-=lumaNN*0.5;\nbool doneN=abs(lumaEndN)>=gradientScaled;\nbool doneP=abs(lumaEndP)>=gradientScaled;\nif (!doneN)\n{\nposN.x-=offNP.x*3.0;\n}\nif (!doneN)\n{\nposN.y-=offNP.y*3.0;\n}\nbool doneNP=(!doneN) || (!doneP);\nif (!doneP)\n{\nposP.x+=offNP.x*3.0;\n}\nif (!doneP)\n{\nposP.y+=offNP.y*3.0;\n}\nif (doneNP)\n{\nif (!doneN) lumaEndN=FxaaLuma(texture2D(textureSampler,posN.xy,0.0));\nif (!doneP) lumaEndP=FxaaLuma(texture2D(textureSampler,posP.xy,0.0));\nif (!doneN) lumaEndN=lumaEndN-lumaNN*0.5;\nif (!doneP) lumaEndP=lumaEndP-lumaNN*0.5;\ndoneN=abs(lumaEndN)>=gradientScaled;\ndoneP=abs(lumaEndP)>=gradientScaled;\nif (!doneN) posN.x-=offNP.x*12.0;\nif (!doneN) posN.y-=offNP.y*12.0;\ndoneNP=(!doneN) || (!doneP);\nif (!doneP) posP.x+=offNP.x*12.0;\nif (!doneP) posP.y+=offNP.y*12.0;\n}\nfloat dstN=posM.x-posN.x;\nfloat dstP=posP.x-posM.x;\nif (!horzSpan)\n{\ndstN=posM.y-posN.y;\n}\nif (!horzSpan)\n{\ndstP=posP.y-posM.y;\n}\nbool goodSpanN=(lumaEndN<0.0) != lumaMLTZero;\nfloat spanLength=(dstP+dstN);\nbool goodSpanP=(lumaEndP<0.0) != lumaMLTZero;\nfloat spanLengthRcp=1.0/spanLength;\nbool directionN=dstN<dstP;\nfloat dst=min(dstN,dstP);\nbool goodSpan=directionN ? goodSpanN : goodSpanP;\nfloat subpixG=subpixF*subpixF;\nfloat pixelOffset=(dst*(-spanLengthRcp))+0.5;\nfloat subpixH=subpixG*fxaaQualitySubpix;\nfloat pixelOffsetGood=goodSpan ? pixelOffset : 0.0;\nfloat pixelOffsetSubpix=max(pixelOffsetGood,subpixH);\nif (!horzSpan)\n{\nposM.x+=pixelOffsetSubpix*lengthSign;\n}\nif (horzSpan)\n{\nposM.y+=pixelOffsetSubpix*lengthSign;\n}\n#ifdef MALI\nif(range<rangeMaxClamped)\n{\ngl_FragColor=rgbyM;\n}\nelse\n{\ngl_FragColor=texture2D(textureSampler,posM,0.0);\n}\n#else\ngl_FragColor=texture2D(textureSampler,posM,0.0);\n#endif\n}",li.a.ShadersStore.fxaaVertexShader="\nattribute vec2 position;\nuniform vec2 texelSize;\n\nvarying vec2 vUV;\nvarying vec2 sampleCoordS;\nvarying vec2 sampleCoordE;\nvarying vec2 sampleCoordN;\nvarying vec2 sampleCoordW;\nvarying vec2 sampleCoordNW;\nvarying vec2 sampleCoordSE;\nvarying vec2 sampleCoordNE;\nvarying vec2 sampleCoordSW;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) {\nvUV=(position*madd+madd);\nsampleCoordS=vUV+vec2( 0.0,1.0)*texelSize;\nsampleCoordE=vUV+vec2( 1.0,0.0)*texelSize;\nsampleCoordN=vUV+vec2( 0.0,-1.0)*texelSize;\nsampleCoordW=vUV+vec2(-1.0,0.0)*texelSize;\nsampleCoordNW=vUV+vec2(-1.0,-1.0)*texelSize;\nsampleCoordSE=vUV+vec2( 1.0,1.0)*texelSize;\nsampleCoordNE=vUV+vec2( 1.0,-1.0)*texelSize;\nsampleCoordSW=vUV+vec2(-1.0,1.0)*texelSize;\ngl_Position=vec4(position,0.0,1.0);\n}";var Sp=function(D){function t(w,N,F,k,j,z,G){void 0===F&&(F=null),void 0===G&&(G=ce.a.TEXTURETYPE_UNSIGNED_INT);var H=D.call(this,w,"fxaa",["texelSize"],null,N,F,k||Jt.a.BILINEAR_SAMPLINGMODE,j,z,null,G,"fxaa",void 0,!0)||this,X=H._getDefines();return H.updateEffect(X),H.onApplyObservable.add((function(D){var w=H.texelSize;D.setFloat2("texelSize",w.x,w.y)})),H}return Object(Z.d)(t,D),t.prototype._getDefines=function(){var D=this.getEngine();if(!D)return null;var w=D.getGlInfo();return w&&w.renderer&&w.renderer.toLowerCase().indexOf("mali")>-1?"#define MALI 1\n":null},t}(fi);li.a.ShadersStore.grainPixelShader="#include<helperFunctions>\n\nuniform sampler2D textureSampler;\n\nuniform float intensity;\nuniform float animatedSeed;\n\nvarying vec2 vUV;\nvoid main(void)\n{\ngl_FragColor=texture2D(textureSampler,vUV);\nvec2 seed=vUV*(animatedSeed);\nfloat grain=dither(seed,intensity);\n\nfloat lum=getLuminance(gl_FragColor.rgb);\nfloat grainAmount=(cos(-PI+(lum*PI*2.))+1.)/2.;\ngl_FragColor.rgb+=grain*grainAmount;\ngl_FragColor.rgb=max(gl_FragColor.rgb,0.0);\n}";var Mp=function(D){function t(w,N,F,k,j,z,G,H){void 0===G&&(G=ce.a.TEXTURETYPE_UNSIGNED_INT),void 0===H&&(H=!1);var X=D.call(this,w,"grain",["intensity","animatedSeed"],[],N,F,k,j,z,null,G,void 0,null,H)||this;return X.intensity=30,X.animated=!1,X.onApplyObservable.add((function(D){D.setFloat("intensity",X.intensity),D.setFloat("animatedSeed",X.animated?Math.random()+1:1)})),X}return Object(Z.d)(t,D),t}(fi);li.a.ShadersStore.highlightsPixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nconst vec3 RGBLuminanceCoefficients=vec3(0.2126,0.7152,0.0722);\nvoid main(void)\n{\nvec4 tex=texture2D(textureSampler,vUV);\nvec3 c=tex.rgb;\nfloat luma=dot(c.rgb,RGBLuminanceCoefficients);\n\n\ngl_FragColor=vec4(pow(c,vec3(25.0-luma*15.0)),tex.a);\n}";var xp=function(D){function t(w,N,F,k,j,z,G){return void 0===G&&(G=ce.a.TEXTURETYPE_UNSIGNED_INT),D.call(this,w,"highlights",null,null,N,F,k,j,z,null,G)||this}return Object(Z.d)(t,D),t}(fi);li.a.IncludesShadersStore.mrtFragmentDeclaration="#if __VERSION__>=200\nlayout(location=0) out vec4 glFragData[{X}];\n#endif\n",li.a.ShadersStore.geometryPixelShader="#extension GL_EXT_draw_buffers : require\n#if defined(BUMP) || !defined(NORMAL)\n#extension GL_OES_standard_derivatives : enable\n#endif\nprecision highp float;\nprecision highp int;\n#ifdef BUMP\nvarying mat4 vWorldView;\nvarying vec3 vNormalW;\n#else\nvarying vec3 vNormalV;\n#endif\nvarying vec4 vViewPos;\n#if defined(POSITION) || defined(BUMP)\nvarying vec3 vPositionW;\n#endif\n#ifdef VELOCITY\nvarying vec4 vCurrentPosition;\nvarying vec4 vPreviousPosition;\n#endif\n#ifdef NEED_UV\nvarying vec2 vUV;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform vec2 vTangentSpaceParams;\n#endif\n#ifdef REFLECTIVITY\nvarying vec2 vReflectivityUV;\nuniform sampler2D reflectivitySampler;\n#endif\n#ifdef ALPHATEST\nuniform sampler2D diffuseSampler;\n#endif\n#include<mrtFragmentDeclaration>[RENDER_TARGET_COUNT]\n#include<bumpFragmentFunctions>\nvoid main() {\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\ngl_FragData[0]=vec4(vViewPos.z/vViewPos.w,0.0,0.0,1.0);\n\n#ifdef BUMP\nvec3 normalW=normalize(vNormalW);\n#include<bumpFragment>\ngl_FragData[1]=vec4(normalize(vec3(vWorldView*vec4(normalW,0.0))),1.0);\n#else\ngl_FragData[1]=vec4(normalize(vNormalV),1.0);\n#endif\n#ifdef POSITION\ngl_FragData[POSITION_INDEX]=vec4(vPositionW,1.0);\n#endif\n#ifdef VELOCITY\nvec2 a=(vCurrentPosition.xy/vCurrentPosition.w)*0.5+0.5;\nvec2 b=(vPreviousPosition.xy/vPreviousPosition.w)*0.5+0.5;\nvec2 velocity=abs(a-b);\nvelocity=vec2(pow(velocity.x,1.0/3.0),pow(velocity.y,1.0/3.0))*sign(a-b)*0.5+0.5;\ngl_FragData[VELOCITY_INDEX]=vec4(velocity,0.0,1.0);\n#endif\n#ifdef REFLECTIVITY\n#ifdef HAS_SPECULAR\n\nvec4 reflectivity=texture2D(reflectivitySampler,vReflectivityUV);\n#elif HAS_REFLECTIVITY\n\nvec4 reflectivity=vec4(texture2D(reflectivitySampler,vReflectivityUV).rgb,1.0);\n#else\nvec4 reflectivity=vec4(0.0,0.0,0.0,1.0);\n#endif\ngl_FragData[REFLECTIVITY_INDEX]=reflectivity;\n#endif\n}",li.a.ShadersStore.geometryVertexShader="precision highp float;\nprecision highp int;\n#include<bonesDeclaration>\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#include<instancesDeclaration>\nattribute vec3 position;\nattribute vec3 normal;\n#ifdef NEED_UV\nvarying vec2 vUV;\n#ifdef ALPHATEST\nuniform mat4 diffuseMatrix;\n#endif\n#ifdef BUMP\nuniform mat4 bumpMatrix;\nvarying vec2 vBumpUV;\n#endif\n#ifdef REFLECTIVITY\nuniform mat4 reflectivityMatrix;\nvarying vec2 vReflectivityUV;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\n\nuniform mat4 viewProjection;\nuniform mat4 view;\n#ifdef BUMP\nvarying mat4 vWorldView;\n#endif\n#ifdef BUMP\nvarying vec3 vNormalW;\n#else\nvarying vec3 vNormalV;\n#endif\nvarying vec4 vViewPos;\n#if defined(POSITION) || defined(BUMP)\nvarying vec3 vPositionW;\n#endif\n#ifdef VELOCITY\nuniform mat4 previousWorld;\nuniform mat4 previousViewProjection;\n#ifdef BONES_VELOCITY_ENABLED\n#if NUM_BONE_INFLUENCERS>0\nuniform mat4 mPreviousBones[BonesPerMesh];\n#endif\n#endif\nvarying vec4 vCurrentPosition;\nvarying vec4 vPreviousPosition;\n#endif\nvoid main(void)\n{\nvec3 positionUpdated=position;\nvec3 normalUpdated=normal;\n#ifdef UV1\nvec2 uvUpdated=uv;\n#endif\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#include<instancesVertex>\n#if defined(VELOCITY) && !defined(BONES_VELOCITY_ENABLED)\n\nvCurrentPosition=viewProjection*finalWorld*vec4(positionUpdated,1.0);\nvPreviousPosition=previousViewProjection*previousWorld*vec4(positionUpdated,1.0);\n#endif\n#include<bonesVertex>\nvec4 pos=vec4(finalWorld*vec4(positionUpdated,1.0));\n#ifdef BUMP\nvWorldView=view*finalWorld;\nvNormalW=normalUpdated;\n#else\nvNormalV=normalize(vec3((view*finalWorld)*vec4(normalUpdated,0.0)));\n#endif\nvViewPos=view*pos;\n#if defined(VELOCITY) && defined(BONES_VELOCITY_ENABLED)\nvCurrentPosition=viewProjection*finalWorld*vec4(positionUpdated,1.0);\n#if NUM_BONE_INFLUENCERS>0\nmat4 previousInfluence;\npreviousInfluence=mPreviousBones[int(matricesIndices[0])]*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\npreviousInfluence+=mPreviousBones[int(matricesIndices[1])]*matricesWeights[1];\n#endif\n#if NUM_BONE_INFLUENCERS>2\npreviousInfluence+=mPreviousBones[int(matricesIndices[2])]*matricesWeights[2];\n#endif\n#if NUM_BONE_INFLUENCERS>3\npreviousInfluence+=mPreviousBones[int(matricesIndices[3])]*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\npreviousInfluence+=mPreviousBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];\n#endif\n#if NUM_BONE_INFLUENCERS>5\npreviousInfluence+=mPreviousBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];\n#endif\n#if NUM_BONE_INFLUENCERS>6\npreviousInfluence+=mPreviousBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];\n#endif\n#if NUM_BONE_INFLUENCERS>7\npreviousInfluence+=mPreviousBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];\n#endif\nvPreviousPosition=previousViewProjection*previousWorld*previousInfluence*vec4(positionUpdated,1.0);\n#else\nvPreviousPosition=previousViewProjection*previousWorld*vec4(positionUpdated,1.0);\n#endif\n#endif\n#if defined(POSITION) || defined(BUMP)\nvPositionW=pos.xyz/pos.w;\n#endif\ngl_Position=viewProjection*finalWorld*vec4(positionUpdated,1.0);\n#ifdef NEED_UV\n#ifdef UV1\n#ifdef ALPHATEST\nvUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));\n#else\nvUV=uv;\n#endif\n#ifdef BUMP\nvBumpUV=vec2(bumpMatrix*vec4(uvUpdated,1.0,0.0));\n#endif\n#ifdef REFLECTIVITY\nvReflectivityUV=vec2(reflectivityMatrix*vec4(uvUpdated,1.0,0.0));\n#endif\n#endif\n#ifdef UV2\n#ifdef ALPHATEST\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#else\nvUV=uv2;\n#endif\n#ifdef BUMP\nvBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));\n#endif\n#ifdef REFLECTIVITY\nvReflectivityUV=vec2(reflectivityMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n#endif\n#include<bumpVertex>\n}\n";var Ap=function(){function e(D,w){void 0===w&&(w=1),this._previousTransformationMatrices={},this._previousBonesTransformationMatrices={},this.excludedSkinnedMeshesFromVelocity=[],this.renderTransparentMeshes=!0,this._enablePosition=!1,this._enableVelocity=!1,this._enableReflectivity=!1,this._positionIndex=-1,this._velocityIndex=-1,this._reflectivityIndex=-1,this._scene=D,this._ratio=w,e._SceneComponentInitialization(this._scene),this._createRenderTargets()}return Object.defineProperty(e.prototype,"renderList",{set:function(D){this._multiRenderTarget.renderList=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSupported",{get:function(){return this._multiRenderTarget.isSupported},enumerable:!0,configurable:!0}),e.prototype.getTextureIndex=function(D){switch(D){case e.POSITION_TEXTURE_TYPE:return this._positionIndex;case e.VELOCITY_TEXTURE_TYPE:return this._velocityIndex;case e.REFLECTIVITY_TEXTURE_TYPE:return this._reflectivityIndex;default:return-1}},Object.defineProperty(e.prototype,"enablePosition",{get:function(){return this._enablePosition},set:function(D){this._enablePosition=D,this.dispose(),this._createRenderTargets()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enableVelocity",{get:function(){return this._enableVelocity},set:function(D){this._enableVelocity=D,D||(this._previousTransformationMatrices={}),this.dispose(),this._createRenderTargets()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enableReflectivity",{get:function(){return this._enableReflectivity},set:function(D){this._enableReflectivity=D,this.dispose(),this._createRenderTargets()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ratio",{get:function(){return this._ratio},enumerable:!0,configurable:!0}),e.prototype.isReady=function(D,w){var N=D.getMaterial();if(N&&N.disableDepthWrite)return!1;var F=[],k=[Zi.b.PositionKind,Zi.b.NormalKind],j=D.getMesh();if(N){var z=!1;N.needAlphaBlending()&&(F.push("#define ALPHATEST"),z=!0),N.bumpTexture&&Hi.a.BumpTextureEnabled&&(F.push("#define BUMP"),z=!0),this._enableReflectivity&&(N instanceof Hi.a&&N.specularTexture?(F.push("#define HAS_SPECULAR"),z=!0):N instanceof ga&&N.reflectivityTexture&&(F.push("#define HAS_REFLECTIVITY"),z=!0)),z&&(F.push("#define NEED_UV"),j.isVerticesDataPresent(Zi.b.UVKind)&&(k.push(Zi.b.UVKind),F.push("#define UV1")),j.isVerticesDataPresent(Zi.b.UV2Kind)&&(k.push(Zi.b.UV2Kind),F.push("#define UV2")))}this._enablePosition&&(F.push("#define POSITION"),F.push("#define POSITION_INDEX "+this._positionIndex)),this._enableVelocity&&(F.push("#define VELOCITY"),F.push("#define VELOCITY_INDEX "+this._velocityIndex),-1===this.excludedSkinnedMeshesFromVelocity.indexOf(j)&&F.push("#define BONES_VELOCITY_ENABLED")),this._enableReflectivity&&(F.push("#define REFLECTIVITY"),F.push("#define REFLECTIVITY_INDEX "+this._reflectivityIndex)),j.useBones&&j.computeBonesUsingShaders?(k.push(Zi.b.MatricesIndicesKind),k.push(Zi.b.MatricesWeightsKind),j.numBoneInfluencers>4&&(k.push(Zi.b.MatricesIndicesExtraKind),k.push(Zi.b.MatricesWeightsExtraKind)),F.push("#define NUM_BONE_INFLUENCERS "+j.numBoneInfluencers),F.push("#define BonesPerMesh "+(j.skeleton?j.skeleton.bones.length+1:0))):F.push("#define NUM_BONE_INFLUENCERS 0");var G=j.morphTargetManager,H=0;G&&G.numInfluencers>0&&(H=G.numInfluencers,F.push("#define MORPHTARGETS"),F.push("#define NUM_MORPH_INFLUENCERS "+H),jo.a.PrepareAttributesForMorphTargetsInfluencers(k,j,H)),w&&(F.push("#define INSTANCES"),jo.a.PushAttributesForInstances(k)),F.push("#define RENDER_TARGET_COUNT "+this._multiRenderTarget.textures.length);var X=F.join("\n");return this._cachedDefines!==X&&(this._cachedDefines=X,this._effect=this._scene.getEngine().createEffect("geometry",k,["world","mBones","viewProjection","diffuseMatrix","view","previousWorld","previousViewProjection","mPreviousBones","morphTargetInfluences","bumpMatrix","reflectivityMatrix","vTangentSpaceParams","vBumpInfos"],["diffuseSampler","bumpSampler","reflectivitySampler"],X,void 0,void 0,void 0,{buffersCount:this._multiRenderTarget.textures.length-1,maxSimultaneousMorphTargets:H})),this._effect.isReady()},e.prototype.getGBuffer=function(){return this._multiRenderTarget},Object.defineProperty(e.prototype,"samples",{get:function(){return this._multiRenderTarget.samples},set:function(D){this._multiRenderTarget.samples=D},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this.getGBuffer().dispose()},e.prototype._createRenderTargets=function(){var D=this,w=this._scene.getEngine(),N=2;if(this._enablePosition&&(this._positionIndex=N,N++),this._enableVelocity&&(this._velocityIndex=N,N++),this._enableReflectivity&&(this._reflectivityIndex=N,N++),this._multiRenderTarget=new su("gBuffer",{width:w.getRenderWidth()*this._ratio,height:w.getRenderHeight()*this._ratio},N,this._scene,{generateMipMaps:!1,generateDepthTexture:!0,defaultType:ce.a.TEXTURETYPE_FLOAT}),this.isSupported){this._multiRenderTarget.wrapU=Jt.a.CLAMP_ADDRESSMODE,this._multiRenderTarget.wrapV=Jt.a.CLAMP_ADDRESSMODE,this._multiRenderTarget.refreshRate=1,this._multiRenderTarget.renderParticles=!1,this._multiRenderTarget.renderList=null,this._multiRenderTarget.onClearObservable.add((function(D){D.clear(new G.b(0,0,0,1),!0,!0,!0)}));var n=function(w){var N=w.getRenderingMesh(),F=D._scene,k=F.getEngine(),j=w.getMaterial();if(j){if(N._internalAbstractMeshDataInfo._isActiveIntermediate=!1,D._enableVelocity&&!D._previousTransformationMatrices[N.uniqueId]&&(D._previousTransformationMatrices[N.uniqueId]={world:z.a.Identity(),viewProjection:F.getTransformMatrix()},N.skeleton)){var G=N.skeleton.getTransformMatrices(N);D._previousBonesTransformationMatrices[N.uniqueId]=D._copyBonesTransformationMatrices(G,new Float32Array(G.length))}k.setState(j.backFaceCulling,0,!1,F.useRightHandedSystem);var H=N._getInstancesRenderList(w._id);if(!H.mustReturn){var X=k.getCaps().instancedArrays&&null!==H.visibleInstances[w._id];if(D.isReady(w,X)){if(k.enableEffect(D._effect),N._bind(w,D._effect,j.fillMode),D._effect.setMatrix("viewProjection",F.getTransformMatrix()),D._effect.setMatrix("view",F.getViewMatrix()),j){if(j.needAlphaTesting()){var q=j.getAlphaTestTexture();q&&(D._effect.setTexture("diffuseSampler",q),D._effect.setMatrix("diffuseMatrix",q.getTextureMatrix()))}j.bumpTexture&&F.getEngine().getCaps().standardDerivatives&&Hi.a.BumpTextureEnabled&&(D._effect.setFloat3("vBumpInfos",j.bumpTexture.coordinatesIndex,1/j.bumpTexture.level,j.parallaxScaleBias),D._effect.setMatrix("bumpMatrix",j.bumpTexture.getTextureMatrix()),D._effect.setTexture("bumpSampler",j.bumpTexture),D._effect.setFloat2("vTangentSpaceParams",j.invertNormalMapX?-1:1,j.invertNormalMapY?-1:1)),D._enableReflectivity&&(j instanceof Hi.a&&j.specularTexture?(D._effect.setMatrix("reflectivityMatrix",j.specularTexture.getTextureMatrix()),D._effect.setTexture("reflectivitySampler",j.specularTexture)):j instanceof ga&&j.reflectivityTexture&&(D._effect.setMatrix("reflectivityMatrix",j.reflectivityTexture.getTextureMatrix()),D._effect.setTexture("reflectivitySampler",j.reflectivityTexture)))}N.useBones&&N.computeBonesUsingShaders&&N.skeleton&&(D._effect.setMatrices("mBones",N.skeleton.getTransformMatrices(N)),D._enableVelocity&&D._effect.setMatrices("mPreviousBones",D._previousBonesTransformationMatrices[N.uniqueId])),jo.a.BindMorphTargetParameters(N,D._effect),D._enableVelocity&&(D._effect.setMatrix("previousWorld",D._previousTransformationMatrices[N.uniqueId].world),D._effect.setMatrix("previousViewProjection",D._previousTransformationMatrices[N.uniqueId].viewProjection)),N._processRendering(w,D._effect,j.fillMode,H,X,(function(w,N){return D._effect.setMatrix("world",N)}))}D._enableVelocity&&(D._previousTransformationMatrices[N.uniqueId].world=N.getWorldMatrix().clone(),D._previousTransformationMatrices[N.uniqueId].viewProjection=D._scene.getTransformMatrix().clone(),N.skeleton&&D._copyBonesTransformationMatrices(N.skeleton.getTransformMatrices(N),D._previousBonesTransformationMatrices[N.uniqueId]))}}};this._multiRenderTarget.customRenderFunction=function(N,F,k,j){var z;if(j.length){for(w.setColorWrite(!1),z=0;z<j.length;z++)n(j.data[z]);w.setColorWrite(!0)}for(z=0;z<N.length;z++)n(N.data[z]);for(z=0;z<F.length;z++)n(F.data[z]);if(D.renderTransparentMeshes)for(z=0;z<k.length;z++)n(k.data[z])}}},e.prototype._copyBonesTransformationMatrices=function(D,w){for(var N=0;N<D.length;N++)w[N]=D[N];return w},e.POSITION_TEXTURE_TYPE=1,e.VELOCITY_TEXTURE_TYPE=2,e.REFLECTIVITY_TEXTURE_TYPE=3,e._SceneComponentInitialization=function(D){throw It.a.WarnImport("GeometryBufferRendererSceneComponent")},e}();Object.defineProperty(We.a.prototype,"geometryBufferRenderer",{get:function(){this._geometryBufferRenderer},set:function(D){D&&D.isSupported&&(this._geometryBufferRenderer=D)},enumerable:!0,configurable:!0}),We.a.prototype.enableGeometryBufferRenderer=function(D){return void 0===D&&(D=1),this._geometryBufferRenderer||(this._geometryBufferRenderer=new Ap(this,D),this._geometryBufferRenderer.isSupported||(this._geometryBufferRenderer=null)),this._geometryBufferRenderer},We.a.prototype.disableGeometryBufferRenderer=function(){this._geometryBufferRenderer&&(this._geometryBufferRenderer.dispose(),this._geometryBufferRenderer=null)};var Pp=function(){function e(D){this.name=Nt.a.NAME_GEOMETRYBUFFERRENDERER,this.scene=D}return e.prototype.register=function(){this.scene._gatherRenderTargetsStage.registerStep(Nt.a.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER,this,this._gatherRenderTargets)},e.prototype.rebuild=function(){},e.prototype.dispose=function(){},e.prototype._gatherRenderTargets=function(D){this.scene._geometryBufferRenderer&&D.push(this.scene._geometryBufferRenderer.getGBuffer())},e}();Ap._SceneComponentInitialization=function(D){var w=D._getComponent(Nt.a.NAME_GEOMETRYBUFFERRENDERER);w||(w=new Pp(D),D._addComponent(w))},li.a.ShadersStore.motionBlurPixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D velocitySampler;\nuniform float motionStrength;\nuniform float motionScale;\nuniform vec2 screenSize;\nvoid main(void)\n{\n#ifdef GEOMETRY_SUPPORTED\nvec2 texelSize=1.0/screenSize;\nvec2 velocityColor=texture2D(velocitySampler,vUV).rg*2.0-1.0;\nvec2 velocity=vec2(pow(velocityColor.r,3.0),pow(velocityColor.g,3.0));\nvelocity*=motionScale*motionStrength;\nfloat speed=length(velocity/texelSize);\nint samplesCount=int(clamp(speed,1.0,SAMPLES));\nvelocity=normalize(velocity)*texelSize;\nfloat hlim=float(-samplesCount)*0.5+0.5;\nvec4 result=texture2D(textureSampler,vUV);\nfor (int i=1; i<int(SAMPLES); ++i)\n{\nif (i>=samplesCount)\nbreak;\nvec2 offset=vUV+velocity*(hlim+float(i));\nresult+=texture2D(textureSampler,offset);\n}\ngl_FragColor=result/float(samplesCount);\ngl_FragColor.a=1.0;\n#else\ngl_FragColor=texture2D(textureSampler,vUV);\n#endif\n}\n";var Cp=function(D){function t(w,N,F,k,j,G,H,X,q){void 0===X&&(X=ce.a.TEXTURETYPE_UNSIGNED_INT),void 0===q&&(q=!1);var Z=D.call(this,w,"motionBlur",["motionStrength","motionScale","screenSize"],["velocitySampler"],F,k,j,G,H,"#define GEOMETRY_SUPPORTED\n#define SAMPLES 64.0",X,void 0,null,q)||this;return Z.motionStrength=1,Z._motionBlurSamples=32,Z._geometryBufferRenderer=N.enableGeometryBufferRenderer(),Z._geometryBufferRenderer?(Z._geometryBufferRenderer.enableVelocity=!0,Z.onApply=function(D){if(D.setVector2("screenSize",new z.d(Z.width,Z.height)),D.setFloat("motionScale",N.getAnimationRatio()),D.setFloat("motionStrength",Z.motionStrength),Z._geometryBufferRenderer){var w=Z._geometryBufferRenderer.getTextureIndex(Ap.VELOCITY_TEXTURE_TYPE);D.setTexture("velocitySampler",Z._geometryBufferRenderer.getGBuffer().textures[w])}}):(oe.a.Warn("Multiple Render Target support needed to compute object based motion blur"),Z.updateEffect()),Z}return Object(Z.d)(t,D),Object.defineProperty(t.prototype,"motionBlurSamples",{get:function(){return this._motionBlurSamples},set:function(D){this._motionBlurSamples=D,this._geometryBufferRenderer&&this.updateEffect("#define GEOMETRY_SUPPORTED\n#define SAMPLES "+D.toFixed(1))},enumerable:!0,configurable:!0}),t.prototype.excludeSkinnedMesh=function(D){this._geometryBufferRenderer&&D.skeleton&&this._geometryBufferRenderer.excludedSkinnedMeshesFromVelocity.push(D)},t.prototype.removeExcludedSkinnedMesh=function(D){if(this._geometryBufferRenderer&&D.skeleton){var w=this._geometryBufferRenderer.excludedSkinnedMeshesFromVelocity.indexOf(D);-1!==w&&this._geometryBufferRenderer.excludedSkinnedMeshesFromVelocity.splice(w,1)}},t.prototype.dispose=function(w){this._geometryBufferRenderer&&(this._geometryBufferRenderer._previousTransformationMatrices={},this._geometryBufferRenderer._previousBonesTransformationMatrices={},this._geometryBufferRenderer.excludedSkinnedMeshesFromVelocity=[]),D.prototype.dispose.call(this,w)},t}(fi);li.a.ShadersStore.refractionPixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D refractionSampler;\n\nuniform vec3 baseColor;\nuniform float depth;\nuniform float colorLevel;\nvoid main() {\nfloat ref=1.0-texture2D(refractionSampler,vUV).r;\nvec2 uv=vUV-vec2(0.5);\nvec2 offset=uv*depth*ref;\nvec3 sourceColor=texture2D(textureSampler,vUV-offset).rgb;\ngl_FragColor=vec4(sourceColor+sourceColor*ref*colorLevel,1.0);\n}";var Op=function(D){function t(w,N,F,k,j,z,G,H,X,q){var Z=D.call(this,w,"refraction",["baseColor","depth","colorLevel"],["refractionSampler"],z,G,H,X,q)||this;return Z.color=F,Z.depth=k,Z.colorLevel=j,Z._ownRefractionTexture=!0,Z.onActivateObservable.add((function(D){Z._refTexture=Z._refTexture||new Jt.a(N,D.getScene())})),Z.onApplyObservable.add((function(D){D.setColor3("baseColor",Z.color),D.setFloat("depth",Z.depth),D.setFloat("colorLevel",Z.colorLevel),D.setTexture("refractionSampler",Z._refTexture)})),Z}return Object(Z.d)(t,D),Object.defineProperty(t.prototype,"refractionTexture",{get:function(){return this._refTexture},set:function(D){this._refTexture&&this._ownRefractionTexture&&this._refTexture.dispose(),this._refTexture=D,this._ownRefractionTexture=!1},enumerable:!0,configurable:!0}),t.prototype.dispose=function(w){this._refTexture&&this._ownRefractionTexture&&(this._refTexture.dispose(),this._refTexture=null),D.prototype.dispose.call(this,w)},t}(fi);li.a.ShadersStore.sharpenPixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform vec2 screenSize;\nuniform vec2 sharpnessAmounts;\nvoid main(void)\n{\nvec2 onePixel=vec2(1.0,1.0)/screenSize;\nvec4 color=texture2D(textureSampler,vUV);\nvec4 edgeDetection=texture2D(textureSampler,vUV+onePixel*vec2(0,-1)) +\ntexture2D(textureSampler,vUV+onePixel*vec2(-1,0)) +\ntexture2D(textureSampler,vUV+onePixel*vec2(1,0)) +\ntexture2D(textureSampler,vUV+onePixel*vec2(0,1)) -\ncolor*4.0;\ngl_FragColor=max(vec4(color.rgb*sharpnessAmounts.y,color.a)-(sharpnessAmounts.x*vec4(edgeDetection.rgb,0)),0.);\n}";var Rp=function(D){function t(w,N,F,k,j,z,G,H){void 0===G&&(G=ce.a.TEXTURETYPE_UNSIGNED_INT),void 0===H&&(H=!1);var X=D.call(this,w,"sharpen",["sharpnessAmounts","screenSize"],null,N,F,k,j,z,null,G,void 0,null,H)||this;return X.colorAmount=1,X.edgeAmount=.3,X.onApply=function(D){D.setFloat2("screenSize",X.width,X.height),D.setFloat2("sharpnessAmounts",X.edgeAmount,X.colorAmount)},X}return Object(Z.d)(t,D),t}(fi),Dp=function(){function e(D,w){this.engine=D,this._name=w,this._renderEffects={},this._renderEffectsForIsolatedPass=new Array,this._cameras=[]}return Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cameras",{get:function(){return this._cameras},enumerable:!0,configurable:!0}),e.prototype.getClassName=function(){return"PostProcessRenderPipeline"},Object.defineProperty(e.prototype,"isSupported",{get:function(){for(var D in this._renderEffects)if(this._renderEffects.hasOwnProperty(D)&&!this._renderEffects[D].isSupported)return!1;return!0},enumerable:!0,configurable:!0}),e.prototype.addEffect=function(D){this._renderEffects[D._name]=D},e.prototype._rebuild=function(){},e.prototype._enableEffect=function(D,w){var N=this._renderEffects[D];N&&N._enable(Dt.b.MakeArray(w||this._cameras))},e.prototype._disableEffect=function(D,w){var N=this._renderEffects[D];N&&N._disable(Dt.b.MakeArray(w||this._cameras))},e.prototype._attachCameras=function(D,w){var N=Dt.b.MakeArray(D||this._cameras);if(N){var F,k=[];for(F=0;F<N.length;F++){var j=N[F],z=j.name;-1===this._cameras.indexOf(j)?this._cameras[z]=j:w&&k.push(F)}for(F=0;F<k.length;F++)D.splice(k[F],1);for(var G in this._renderEffects)this._renderEffects.hasOwnProperty(G)&&this._renderEffects[G]._attachCameras(N)}},e.prototype._detachCameras=function(D){var w=Dt.b.MakeArray(D||this._cameras);if(w){for(var N in this._renderEffects)this._renderEffects.hasOwnProperty(N)&&this._renderEffects[N]._detachCameras(w);for(var F=0;F<w.length;F++)this._cameras.splice(this._cameras.indexOf(w[F]),1)}},e.prototype._update=function(){for(var D in this._renderEffects)this._renderEffects.hasOwnProperty(D)&&this._renderEffects[D]._update();for(var w=0;w<this._cameras.length;w++){var N=this._cameras[w].name;this._renderEffectsForIsolatedPass[N]&&this._renderEffectsForIsolatedPass[N]._update()}},e.prototype._reset=function(){this._renderEffects={},this._renderEffectsForIsolatedPass=new Array},e.prototype._enableMSAAOnFirstPostProcess=function(D){if(1===this.engine.webGLVersion)return!1;var w=Object.keys(this._renderEffects);if(w.length>0){var N=this._renderEffects[w[0]].getPostProcesses();N&&(N[0].samples=D)}return!0},e.prototype.dispose=function(){},Object(Z.c)([Object(Ie.c)()],e.prototype,"_name",void 0),e}(),Ip=function(){function e(){this._renderPipelines={}}return Object.defineProperty(e.prototype,"supportedPipelines",{get:function(){var D=[];for(var w in this._renderPipelines)if(this._renderPipelines.hasOwnProperty(w)){var N=this._renderPipelines[w];N.isSupported&&D.push(N)}return D},enumerable:!0,configurable:!0}),e.prototype.addPipeline=function(D){this._renderPipelines[D._name]=D},e.prototype.attachCamerasToRenderPipeline=function(D,w,N){void 0===N&&(N=!1);var F=this._renderPipelines[D];F&&F._attachCameras(w,N)},e.prototype.detachCamerasFromRenderPipeline=function(D,w){var N=this._renderPipelines[D];N&&N._detachCameras(w)},e.prototype.enableEffectInPipeline=function(D,w,N){var F=this._renderPipelines[D];F&&F._enableEffect(w,N)},e.prototype.disableEffectInPipeline=function(D,w,N){var F=this._renderPipelines[D];F&&F._disableEffect(w,N)},e.prototype.update=function(){for(var D in this._renderPipelines)if(this._renderPipelines.hasOwnProperty(D)){var w=this._renderPipelines[D];w.isSupported?w._update():(w.dispose(),delete this._renderPipelines[D])}},e.prototype._rebuild=function(){for(var D in this._renderPipelines)this._renderPipelines.hasOwnProperty(D)&&this._renderPipelines[D]._rebuild()},e.prototype.dispose=function(){for(var D in this._renderPipelines)this._renderPipelines.hasOwnProperty(D)&&this._renderPipelines[D].dispose()},e}();Object.defineProperty(We.a.prototype,"postProcessRenderPipelineManager",{get:function(){if(!this._postProcessRenderPipelineManager){var D=this._getComponent(Nt.a.NAME_POSTPROCESSRENDERPIPELINEMANAGER);D||(D=new Lp(this),this._addComponent(D)),this._postProcessRenderPipelineManager=new Ip}return this._postProcessRenderPipelineManager},enumerable:!0,configurable:!0});var Lp=function(){function e(D){this.name=Nt.a.NAME_POSTPROCESSRENDERPIPELINEMANAGER,this.scene=D}return e.prototype.register=function(){this.scene._gatherRenderTargetsStage.registerStep(Nt.a.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER,this,this._gatherRenderTargets)},e.prototype.rebuild=function(){this.scene._postProcessRenderPipelineManager&&this.scene._postProcessRenderPipelineManager._rebuild()},e.prototype.dispose=function(){this.scene._postProcessRenderPipelineManager&&this.scene._postProcessRenderPipelineManager.dispose()},e.prototype._gatherRenderTargets=function(){this.scene._postProcessRenderPipelineManager&&this.scene._postProcessRenderPipelineManager.update()},e}(),wp=function(D){function t(w,N,F,k,j){void 0===w&&(w=""),void 0===N&&(N=!0),void 0===F&&(F=Me.a.LastCreatedScene),void 0===j&&(j=!0);var z=D.call(this,F.getEngine(),w)||this;z._camerasToBeAttached=[],z.SharpenPostProcessId="SharpenPostProcessEffect",z.ImageProcessingPostProcessId="ImageProcessingPostProcessEffect",z.FxaaPostProcessId="FxaaPostProcessEffect",z.ChromaticAberrationPostProcessId="ChromaticAberrationPostProcessEffect",z.GrainPostProcessId="GrainPostProcessEffect",z._glowLayer=null,z.animations=[],z._imageProcessingConfigurationObserver=null,z._sharpenEnabled=!1,z._bloomEnabled=!1,z._depthOfFieldEnabled=!1,z._depthOfFieldBlurLevel=vp.Low,z._fxaaEnabled=!1,z._imageProcessingEnabled=!0,z._bloomScale=.5,z._chromaticAberrationEnabled=!1,z._grainEnabled=!1,z._buildAllowed=!0,z._resizeObserver=null,z._hardwareScaleLevel=1,z._bloomKernel=64,z._bloomWeight=.15,z._bloomThreshold=.9,z._samples=1,z._hasCleared=!1,z._prevPostProcess=null,z._prevPrevPostProcess=null,z._depthOfFieldSceneObserver=null,z._cameras=k||F.cameras,z._cameras=z._cameras.slice(),z._camerasToBeAttached=z._cameras.slice(),z._buildAllowed=j,z._scene=F;var G=z._scene.getEngine().getCaps();z._hdr=N&&(G.textureHalfFloatRender||G.textureFloatRender),z._hdr?G.textureHalfFloatRender?z._defaultPipelineTextureType=ce.a.TEXTURETYPE_HALF_FLOAT:G.textureFloatRender&&(z._defaultPipelineTextureType=ce.a.TEXTURETYPE_FLOAT):z._defaultPipelineTextureType=ce.a.TEXTURETYPE_UNSIGNED_INT,F.postProcessRenderPipelineManager.addPipeline(z);var H=z._scene.getEngine();return z.sharpen=new Rp("sharpen",1,null,Jt.a.BILINEAR_SAMPLINGMODE,H,!1,z._defaultPipelineTextureType,!0),z._sharpenEffect=new up(H,z.SharpenPostProcessId,(function(){return z.sharpen}),!0),z.depthOfField=new bp(z._scene,null,z._depthOfFieldBlurLevel,z._defaultPipelineTextureType,!0),z.bloom=new dp(z._scene,z._bloomScale,z._bloomWeight,z.bloomKernel,z._defaultPipelineTextureType,!0),z.chromaticAberration=new fp("ChromaticAberration",H.getRenderWidth(),H.getRenderHeight(),1,null,Jt.a.BILINEAR_SAMPLINGMODE,H,!1,z._defaultPipelineTextureType,!0),z._chromaticAberrationEffect=new up(H,z.ChromaticAberrationPostProcessId,(function(){return z.chromaticAberration}),!0),z.grain=new Mp("Grain",1,null,Jt.a.BILINEAR_SAMPLINGMODE,H,!1,z._defaultPipelineTextureType,!0),z._grainEffect=new up(H,z.GrainPostProcessId,(function(){return z.grain}),!0),z._resizeObserver=H.onResizeObservable.add((function(){z._hardwareScaleLevel=H.getHardwareScalingLevel(),z.bloomKernel=z.bloomKernel})),z._imageProcessingConfigurationObserver=z._scene.imageProcessingConfiguration.onUpdateParameters.add((function(){z.bloom._downscale._exposure=z._scene.imageProcessingConfiguration.exposure})),z._buildPipeline(),z}return Object(Z.d)(t,D),Object.defineProperty(t.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sharpenEnabled",{get:function(){return this._sharpenEnabled},set:function(D){this._sharpenEnabled!==D&&(this._sharpenEnabled=D,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bloomKernel",{get:function(){return this._bloomKernel},set:function(D){this._bloomKernel=D,this.bloom.kernel=D/this._hardwareScaleLevel},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bloomWeight",{get:function(){return this._bloomWeight},set:function(D){this._bloomWeight!==D&&(this.bloom.weight=D,this._bloomWeight=D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bloomThreshold",{get:function(){return this._bloomThreshold},set:function(D){this._bloomThreshold!==D&&(this.bloom.threshold=D,this._bloomThreshold=D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bloomScale",{get:function(){return this._bloomScale},set:function(D){this._bloomScale!==D&&(this._bloomScale=D,this._rebuildBloom(),this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bloomEnabled",{get:function(){return this._bloomEnabled},set:function(D){this._bloomEnabled!==D&&(this._bloomEnabled=D,this._buildPipeline())},enumerable:!0,configurable:!0}),t.prototype._rebuildBloom=function(){var D=this.bloom;this.bloom=new dp(this._scene,this.bloomScale,this._bloomWeight,this.bloomKernel,this._defaultPipelineTextureType,!1),this.bloom.threshold=D.threshold;for(var w=0;w<this._cameras.length;w++)D.disposeEffects(this._cameras[w])},Object.defineProperty(t.prototype,"depthOfFieldEnabled",{get:function(){return this._depthOfFieldEnabled},set:function(D){this._depthOfFieldEnabled!==D&&(this._depthOfFieldEnabled=D,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"depthOfFieldBlurLevel",{get:function(){return this._depthOfFieldBlurLevel},set:function(D){if(this._depthOfFieldBlurLevel!==D){this._depthOfFieldBlurLevel=D;var w=this.depthOfField;this.depthOfField=new bp(this._scene,null,this._depthOfFieldBlurLevel,this._defaultPipelineTextureType,!1),this.depthOfField.focalLength=w.focalLength,this.depthOfField.focusDistance=w.focusDistance,this.depthOfField.fStop=w.fStop,this.depthOfField.lensSize=w.lensSize;for(var N=0;N<this._cameras.length;N++)w.disposeEffects(this._cameras[N]);this._buildPipeline()}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fxaaEnabled",{get:function(){return this._fxaaEnabled},set:function(D){this._fxaaEnabled!==D&&(this._fxaaEnabled=D,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"samples",{get:function(){return this._samples},set:function(D){this._samples!==D&&(this._samples=D,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageProcessingEnabled",{get:function(){return this._imageProcessingEnabled},set:function(D){this._imageProcessingEnabled!==D&&(this._imageProcessingEnabled=D,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"glowLayerEnabled",{get:function(){return null!=this._glowLayer},set:function(D){D&&!this._glowLayer?this._glowLayer=new Rs("",this._scene):!D&&this._glowLayer&&(this._glowLayer.dispose(),this._glowLayer=null)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"glowLayer",{get:function(){return this._glowLayer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"chromaticAberrationEnabled",{get:function(){return this._chromaticAberrationEnabled},set:function(D){this._chromaticAberrationEnabled!==D&&(this._chromaticAberrationEnabled=D,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"grainEnabled",{get:function(){return this._grainEnabled},set:function(D){this._grainEnabled!==D&&(this._grainEnabled=D,this._buildPipeline())},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"DefaultRenderingPipeline"},t.prototype.prepare=function(){var D=this._buildAllowed;this._buildAllowed=!0,this._buildPipeline(),this._buildAllowed=D},t.prototype._setAutoClearAndTextureSharing=function(D,w){void 0===w&&(w=!1),this._hasCleared?D.autoClear=!1:(D.autoClear=!0,this._scene.autoClear=!1,this._hasCleared=!0),w||(this._prevPrevPostProcess?D.shareOutputWith(this._prevPrevPostProcess):D.useOwnOutput(),this._prevPostProcess&&(this._prevPrevPostProcess=this._prevPostProcess),this._prevPostProcess=D)},t.prototype._buildPipeline=function(){var D=this;if(this._buildAllowed){this._scene.autoClear=!0;var w=this._scene.getEngine();if(this._disposePostProcesses(),null!==this._cameras&&(this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._cameras),this._cameras=this._camerasToBeAttached.slice()),this._reset(),this._prevPostProcess=null,this._prevPrevPostProcess=null,this._hasCleared=!1,this.depthOfFieldEnabled){if(this._cameras.length>1){for(var N=0,F=this._cameras;N<F.length;N++){var k=F[N];(j=this._scene.enableDepthRenderer(k)).useOnlyInActiveCamera=!0}this._depthOfFieldSceneObserver=this._scene.onAfterRenderTargetsRenderObservable.add((function(w){D._cameras.indexOf(w.activeCamera)>-1&&(D.depthOfField.depthTexture=w.enableDepthRenderer(w.activeCamera).getDepthMap())}))}else{this._scene.onAfterRenderTargetsRenderObservable.remove(this._depthOfFieldSceneObserver);var j=this._scene.enableDepthRenderer(this._cameras[0]);this.depthOfField.depthTexture=j.getDepthMap()}this.depthOfField._isReady()||this.depthOfField._updateEffects(),this.addEffect(this.depthOfField),this._setAutoClearAndTextureSharing(this.depthOfField._effects[0],!0)}else this._scene.onAfterRenderTargetsRenderObservable.remove(this._depthOfFieldSceneObserver);this.bloomEnabled&&(this.bloom._isReady()||this.bloom._updateEffects(),this.addEffect(this.bloom),this._setAutoClearAndTextureSharing(this.bloom._effects[0],!0)),this._imageProcessingEnabled&&(this.imageProcessing=new Qi("imageProcessing",1,null,Jt.a.BILINEAR_SAMPLINGMODE,w,!1,this._defaultPipelineTextureType),this._hdr?(this.addEffect(new up(w,this.ImageProcessingPostProcessId,(function(){return D.imageProcessing}),!0)),this._setAutoClearAndTextureSharing(this.imageProcessing)):this._scene.imageProcessingConfiguration.applyByPostProcess=!1),this.sharpenEnabled&&(this.sharpen.isReady()||this.sharpen.updateEffect(),this.addEffect(this._sharpenEffect),this._setAutoClearAndTextureSharing(this.sharpen)),this.grainEnabled&&(this.grain.isReady()||this.grain.updateEffect(),this.addEffect(this._grainEffect),this._setAutoClearAndTextureSharing(this.grain)),this.chromaticAberrationEnabled&&(this.chromaticAberration.isReady()||this.chromaticAberration.updateEffect(),this.addEffect(this._chromaticAberrationEffect),this._setAutoClearAndTextureSharing(this.chromaticAberration)),this.fxaaEnabled&&(this.fxaa=new Sp("fxaa",1,null,Jt.a.BILINEAR_SAMPLINGMODE,w,!1,this._defaultPipelineTextureType),this.addEffect(new up(w,this.FxaaPostProcessId,(function(){return D.fxaa}),!0)),this._setAutoClearAndTextureSharing(this.fxaa,!0)),null!==this._cameras&&this._scene.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(this._name,this._cameras),this._scene.activeCameras&&this._scene.activeCameras.length>1&&(this._scene.autoClear=!0),!this._enableMSAAOnFirstPostProcess(this.samples)&&this.samples>1&&oe.a.Warn("MSAA failed to enable, MSAA is only supported in browsers that support webGL >= 2.0")}},t.prototype._disposePostProcesses=function(D){void 0===D&&(D=!1);for(var w=0;w<this._cameras.length;w++){var N=this._cameras[w];this.imageProcessing&&this.imageProcessing.dispose(N),this.fxaa&&this.fxaa.dispose(N),D&&(this.sharpen&&this.sharpen.dispose(N),this.depthOfField&&(this._scene.onAfterRenderTargetsRenderObservable.remove(this._depthOfFieldSceneObserver),this.depthOfField.disposeEffects(N)),this.bloom&&this.bloom.disposeEffects(N),this.chromaticAberration&&this.chromaticAberration.dispose(N),this.grain&&this.grain.dispose(N),this._glowLayer&&this._glowLayer.dispose())}this.imageProcessing=null,this.fxaa=null,D&&(this.sharpen=null,this._sharpenEffect=null,this.depthOfField=null,this.bloom=null,this.chromaticAberration=null,this._chromaticAberrationEffect=null,this.grain=null,this._grainEffect=null,this._glowLayer=null)},t.prototype.addCamera=function(D){this._camerasToBeAttached.push(D),this._buildPipeline()},t.prototype.removeCamera=function(D){var w=this._camerasToBeAttached.indexOf(D);this._camerasToBeAttached.splice(w,1),this._buildPipeline()},t.prototype.dispose=function(){this._disposePostProcesses(!0),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._cameras),this._scene.autoClear=!0,this._resizeObserver&&(this._scene.getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this._scene.imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingConfigurationObserver),D.prototype.dispose.call(this)},t.prototype.serialize=function(){var D=Ie.a.Serialize(this);return D.customType="DefaultRenderingPipeline",D},t.Parse=function(D,w,N){return Ie.a.Parse((function(){return new t(D._name,D._name._hdr,w)}),D,w,N)},Object(Z.c)([Object(Ie.c)()],t.prototype,"sharpenEnabled",null),Object(Z.c)([Object(Ie.c)()],t.prototype,"bloomKernel",null),Object(Z.c)([Object(Ie.c)()],t.prototype,"_bloomWeight",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"_bloomThreshold",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"_hdr",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"bloomWeight",null),Object(Z.c)([Object(Ie.c)()],t.prototype,"bloomThreshold",null),Object(Z.c)([Object(Ie.c)()],t.prototype,"bloomScale",null),Object(Z.c)([Object(Ie.c)()],t.prototype,"bloomEnabled",null),Object(Z.c)([Object(Ie.c)()],t.prototype,"depthOfFieldEnabled",null),Object(Z.c)([Object(Ie.c)()],t.prototype,"depthOfFieldBlurLevel",null),Object(Z.c)([Object(Ie.c)()],t.prototype,"fxaaEnabled",null),Object(Z.c)([Object(Ie.c)()],t.prototype,"samples",null),Object(Z.c)([Object(Ie.c)()],t.prototype,"imageProcessingEnabled",null),Object(Z.c)([Object(Ie.c)()],t.prototype,"glowLayerEnabled",null),Object(Z.c)([Object(Ie.c)()],t.prototype,"chromaticAberrationEnabled",null),Object(Z.c)([Object(Ie.c)()],t.prototype,"grainEnabled",null),t}(Dp);H.a.RegisteredTypes["BABYLON.DefaultRenderingPipeline"]=wp,li.a.ShadersStore.lensHighlightsPixelShader="\nuniform sampler2D textureSampler;\n\nuniform float gain;\nuniform float threshold;\nuniform float screen_width;\nuniform float screen_height;\n\nvarying vec2 vUV;\n\nvec4 highlightColor(vec4 color) {\nvec4 highlight=color;\nfloat luminance=dot(highlight.rgb,vec3(0.2125,0.7154,0.0721));\nfloat lum_threshold;\nif (threshold>1.0) { lum_threshold=0.94+0.01*threshold; }\nelse { lum_threshold=0.5+0.44*threshold; }\nluminance=clamp((luminance-lum_threshold)*(1.0/(1.0-lum_threshold)),0.0,1.0);\nhighlight*=luminance*gain;\nhighlight.a=1.0;\nreturn highlight;\n}\nvoid main(void)\n{\nvec4 original=texture2D(textureSampler,vUV);\n\nif (gain == -1.0) {\ngl_FragColor=vec4(0.0,0.0,0.0,1.0);\nreturn;\n}\nfloat w=2.0/screen_width;\nfloat h=2.0/screen_height;\nfloat weight=1.0;\n\nvec4 blurred=vec4(0.0,0.0,0.0,0.0);\n#ifdef PENTAGON\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.84*w,0.43*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.48*w,-1.29*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.61*w,1.51*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.55*w,-0.74*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.71*w,-0.52*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.94*w,1.59*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.40*w,-1.87*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.62*w,1.16*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.09*w,0.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.46*w,-1.71*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.08*w,2.42*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.85*w,-1.89*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.89*w,0.16*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.29*w,1.88*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.40*w,-2.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.54*w,2.26*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.60*w,-0.61*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.31*w,-1.30*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.83*w,2.53*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.12*w,-2.48*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.60*w,1.11*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.82*w,0.99*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.50*w,-2.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.85*w,3.33*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.94*w,-1.92*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.27*w,-0.53*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.95*w,2.48*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.23*w,-3.04*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.17*w,2.05*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.97*w,-0.04*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.25*w,-2.00*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.31*w,3.08*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.94*w,-2.59*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.37*w,0.64*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.13*w,1.93*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.03*w,-3.65*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.60*w,3.17*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.14*w,-1.19*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.00*w,-1.19*h)));\n#else\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.85*w,0.36*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.52*w,-1.14*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.46*w,1.42*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.46*w,-0.83*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.79*w,-0.42*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.11*w,1.62*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.29*w,-2.07*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.69*w,1.39*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.28*w,0.12*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.65*w,-1.69*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.08*w,2.44*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.63*w,-1.90*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.55*w,0.31*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.13*w,1.52*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.56*w,-2.61*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.38*w,2.34*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.64*w,-0.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.53*w,-1.21*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.06*w,2.63*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.00*w,-2.69*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.59*w,1.32*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.82*w,0.78*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.57*w,-2.50*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.54*w,2.93*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.39*w,-1.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.01*w,-0.28*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.04*w,2.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.02*w,-3.05*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.09*w,2.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.07*w,-0.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.44*w,-1.90*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.52*w,3.05*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.68*w,-2.61*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.01*w,0.79*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.76*w,1.46*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.05*w,-2.94*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.21*w,2.88*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.84*w,-1.30*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.98*w,-0.96*h)));\n#endif\nblurred/=39.0;\ngl_FragColor=blurred;\n\n}",li.a.ShadersStore.depthOfFieldPixelShader="\n\n\n\n\nuniform sampler2D textureSampler;\nuniform sampler2D highlightsSampler;\nuniform sampler2D depthSampler;\nuniform sampler2D grainSampler;\n\nuniform float grain_amount;\nuniform bool blur_noise;\nuniform float screen_width;\nuniform float screen_height;\nuniform float distortion;\nuniform bool dof_enabled;\n\nuniform float screen_distance;\nuniform float aperture;\nuniform float darken;\nuniform float edge_blur;\nuniform bool highlights;\n\nuniform float near;\nuniform float far;\n\nvarying vec2 vUV;\n\n#define PI 3.14159265\n#define TWOPI 6.28318530\n#define inverse_focal_length 0.1\n\nvec2 centered_screen_pos;\nvec2 distorted_coords;\nfloat radius2;\nfloat radius;\n\nvec2 rand(vec2 co)\n{\nfloat noise1=(fract(sin(dot(co,vec2(12.9898,78.233)))*43758.5453));\nfloat noise2=(fract(sin(dot(co,vec2(12.9898,78.233)*2.0))*43758.5453));\nreturn clamp(vec2(noise1,noise2),0.0,1.0);\n}\n\nvec2 getDistortedCoords(vec2 coords) {\nif (distortion == 0.0) { return coords; }\nvec2 direction=1.0*normalize(centered_screen_pos);\nvec2 dist_coords=vec2(0.5,0.5);\ndist_coords.x=0.5+direction.x*radius2*1.0;\ndist_coords.y=0.5+direction.y*radius2*1.0;\nfloat dist_amount=clamp(distortion*0.23,0.0,1.0);\ndist_coords=mix(coords,dist_coords,dist_amount);\nreturn dist_coords;\n}\n\nfloat sampleScreen(inout vec4 color,const in vec2 offset,const in float weight) {\n\nvec2 coords=distorted_coords;\nfloat angle=rand(coords*100.0).x*TWOPI;\ncoords+=vec2(offset.x*cos(angle)-offset.y*sin(angle),offset.x*sin(angle)+offset.y*cos(angle));\ncolor+=texture2D(textureSampler,coords)*weight;\nreturn weight;\n}\n\nfloat getBlurLevel(float size) {\nreturn min(3.0,ceil(size/1.0));\n}\n\nvec4 getBlurColor(float size) {\nvec4 col=texture2D(textureSampler,distorted_coords);\nif (size == 0.0) { return col; }\n\n\nfloat blur_level=getBlurLevel(size);\nfloat w=(size/screen_width);\nfloat h=(size/screen_height);\nfloat total_weight=1.0;\nvec2 sample_coords;\ntotal_weight+=sampleScreen(col,vec2(-0.50*w,0.24*h),0.93);\ntotal_weight+=sampleScreen(col,vec2(0.30*w,-0.75*h),0.90);\ntotal_weight+=sampleScreen(col,vec2(0.36*w,0.96*h),0.87);\ntotal_weight+=sampleScreen(col,vec2(-1.08*w,-0.55*h),0.85);\ntotal_weight+=sampleScreen(col,vec2(1.33*w,-0.37*h),0.83);\ntotal_weight+=sampleScreen(col,vec2(-0.82*w,1.31*h),0.80);\ntotal_weight+=sampleScreen(col,vec2(-0.31*w,-1.67*h),0.78);\ntotal_weight+=sampleScreen(col,vec2(1.47*w,1.11*h),0.76);\ntotal_weight+=sampleScreen(col,vec2(-1.97*w,0.19*h),0.74);\ntotal_weight+=sampleScreen(col,vec2(1.42*w,-1.57*h),0.72);\nif (blur_level>1.0) {\ntotal_weight+=sampleScreen(col,vec2(0.01*w,2.25*h),0.70);\ntotal_weight+=sampleScreen(col,vec2(-1.62*w,-1.74*h),0.67);\ntotal_weight+=sampleScreen(col,vec2(2.49*w,0.20*h),0.65);\ntotal_weight+=sampleScreen(col,vec2(-2.07*w,1.61*h),0.63);\ntotal_weight+=sampleScreen(col,vec2(0.46*w,-2.70*h),0.61);\ntotal_weight+=sampleScreen(col,vec2(1.55*w,2.40*h),0.59);\ntotal_weight+=sampleScreen(col,vec2(-2.88*w,-0.75*h),0.56);\ntotal_weight+=sampleScreen(col,vec2(2.73*w,-1.44*h),0.54);\ntotal_weight+=sampleScreen(col,vec2(-1.08*w,3.02*h),0.52);\ntotal_weight+=sampleScreen(col,vec2(-1.28*w,-3.05*h),0.49);\n}\nif (blur_level>2.0) {\ntotal_weight+=sampleScreen(col,vec2(3.11*w,1.43*h),0.46);\ntotal_weight+=sampleScreen(col,vec2(-3.36*w,1.08*h),0.44);\ntotal_weight+=sampleScreen(col,vec2(1.80*w,-3.16*h),0.41);\ntotal_weight+=sampleScreen(col,vec2(0.83*w,3.65*h),0.38);\ntotal_weight+=sampleScreen(col,vec2(-3.16*w,-2.19*h),0.34);\ntotal_weight+=sampleScreen(col,vec2(3.92*w,-0.53*h),0.31);\ntotal_weight+=sampleScreen(col,vec2(-2.59*w,3.12*h),0.26);\ntotal_weight+=sampleScreen(col,vec2(-0.20*w,-4.15*h),0.22);\ntotal_weight+=sampleScreen(col,vec2(3.02*w,3.00*h),0.15);\n}\ncol/=total_weight;\n\nif (darken>0.0) {\ncol.rgb*=clamp(0.3,1.0,1.05-size*0.5*darken);\n}\n\n\n\n\nreturn col;\n}\nvoid main(void)\n{\n\ncentered_screen_pos=vec2(vUV.x-0.5,vUV.y-0.5);\nradius2=centered_screen_pos.x*centered_screen_pos.x+centered_screen_pos.y*centered_screen_pos.y;\nradius=sqrt(radius2);\ndistorted_coords=getDistortedCoords(vUV);\nvec2 texels_coords=vec2(vUV.x*screen_width,vUV.y*screen_height);\nfloat depth=texture2D(depthSampler,distorted_coords).r;\nfloat distance=near+(far-near)*depth;\nvec4 color=texture2D(textureSampler,vUV);\n\n\nfloat coc=abs(aperture*(screen_distance*(inverse_focal_length-1.0/distance)-1.0));\n\nif (dof_enabled == false || coc<0.07) { coc=0.0; }\n\nfloat edge_blur_amount=0.0;\nif (edge_blur>0.0) {\nedge_blur_amount=clamp((radius*2.0-1.0+0.15*edge_blur)*1.5,0.0,1.0)*1.3;\n}\n\nfloat blur_amount=max(edge_blur_amount,coc);\n\nif (blur_amount == 0.0) {\ngl_FragColor=texture2D(textureSampler,distorted_coords);\n}\nelse {\n\ngl_FragColor=getBlurColor(blur_amount*1.7);\n\nif (highlights) {\ngl_FragColor.rgb+=clamp(coc,0.0,1.0)*texture2D(highlightsSampler,distorted_coords).rgb;\n}\nif (blur_noise) {\n\nvec2 noise=rand(distorted_coords)*0.01*blur_amount;\nvec2 blurred_coord=vec2(distorted_coords.x+noise.x,distorted_coords.y+noise.y);\ngl_FragColor=0.04*texture2D(textureSampler,blurred_coord)+0.96*gl_FragColor;\n}\n}\n\nif (grain_amount>0.0) {\nvec4 grain_color=texture2D(grainSampler,texels_coords*0.003);\ngl_FragColor.rgb+=(-0.5+grain_color.rgb)*0.30*grain_amount;\n}\n}\n";var Np=function(D){function t(w,N,F,k,j){void 0===k&&(k=1);var z=D.call(this,F.getEngine(),w)||this;return z.LensChromaticAberrationEffect="LensChromaticAberrationEffect",z.HighlightsEnhancingEffect="HighlightsEnhancingEffect",z.LensDepthOfFieldEffect="LensDepthOfFieldEffect",z._pentagonBokehIsEnabled=!1,z._scene=F,z._depthTexture=F.enableDepthRenderer().getDepthMap(),N.grain_texture?z._grainTexture=N.grain_texture:z._createGrainTexture(),z._edgeBlur=N.edge_blur?N.edge_blur:0,z._grainAmount=N.grain_amount?N.grain_amount:0,z._chromaticAberration=N.chromatic_aberration?N.chromatic_aberration:0,z._distortion=N.distortion?N.distortion:0,z._highlightsGain=void 0!==N.dof_gain?N.dof_gain:-1,z._highlightsThreshold=N.dof_threshold?N.dof_threshold:1,z._dofDistance=void 0!==N.dof_focus_distance?N.dof_focus_distance:-1,z._dofAperture=N.dof_aperture?N.dof_aperture:1,z._dofDarken=N.dof_darken?N.dof_darken:0,z._dofPentagon=void 0===N.dof_pentagon||N.dof_pentagon,z._blurNoise=void 0===N.blur_noise||N.blur_noise,z._createChromaticAberrationPostProcess(k),z._createHighlightsPostProcess(k),z._createDepthOfFieldPostProcess(k/4),z.addEffect(new up(F.getEngine(),z.LensChromaticAberrationEffect,(function(){return z._chromaticAberrationPostProcess}),!0)),z.addEffect(new up(F.getEngine(),z.HighlightsEnhancingEffect,(function(){return z._highlightsPostProcess}),!0)),z.addEffect(new up(F.getEngine(),z.LensDepthOfFieldEffect,(function(){return z._depthOfFieldPostProcess}),!0)),-1===z._highlightsGain&&z._disableEffect(z.HighlightsEnhancingEffect,null),F.postProcessRenderPipelineManager.addPipeline(z),j&&F.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(w,j),z}return Object(Z.d)(t,D),t.prototype.getClassName=function(){return"LensRenderingPipeline"},Object.defineProperty(t.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"edgeBlur",{get:function(){return this._edgeBlur},set:function(D){this.setEdgeBlur(D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"grainAmount",{get:function(){return this._grainAmount},set:function(D){this.setGrainAmount(D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"chromaticAberration",{get:function(){return this._chromaticAberration},set:function(D){this.setChromaticAberration(D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dofAperture",{get:function(){return this._dofAperture},set:function(D){this.setAperture(D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"edgeDistortion",{get:function(){return this._distortion},set:function(D){this.setEdgeDistortion(D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dofDistortion",{get:function(){return this._dofDistance},set:function(D){this.setFocusDistance(D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"darkenOutOfFocus",{get:function(){return this._dofDarken},set:function(D){this.setDarkenOutOfFocus(D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"blurNoise",{get:function(){return this._blurNoise},set:function(D){this._blurNoise=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pentagonBokeh",{get:function(){return this._pentagonBokehIsEnabled},set:function(D){D?this.enablePentagonBokeh():this.disablePentagonBokeh()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"highlightsGain",{get:function(){return this._highlightsGain},set:function(D){this.setHighlightsGain(D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"highlightsThreshold",{get:function(){return this._highlightsThreshold},set:function(D){this.setHighlightsThreshold(D)},enumerable:!0,configurable:!0}),t.prototype.setEdgeBlur=function(D){this._edgeBlur=D},t.prototype.disableEdgeBlur=function(){this._edgeBlur=0},t.prototype.setGrainAmount=function(D){this._grainAmount=D},t.prototype.disableGrain=function(){this._grainAmount=0},t.prototype.setChromaticAberration=function(D){this._chromaticAberration=D},t.prototype.disableChromaticAberration=function(){this._chromaticAberration=0},t.prototype.setEdgeDistortion=function(D){this._distortion=D},t.prototype.disableEdgeDistortion=function(){this._distortion=0},t.prototype.setFocusDistance=function(D){this._dofDistance=D},t.prototype.disableDepthOfField=function(){this._dofDistance=-1},t.prototype.setAperture=function(D){this._dofAperture=D},t.prototype.setDarkenOutOfFocus=function(D){this._dofDarken=D},t.prototype.enablePentagonBokeh=function(){this._highlightsPostProcess.updateEffect("#define PENTAGON\n"),this._pentagonBokehIsEnabled=!0},t.prototype.disablePentagonBokeh=function(){this._pentagonBokehIsEnabled=!1,this._highlightsPostProcess.updateEffect()},t.prototype.enableNoiseBlur=function(){this._blurNoise=!0},t.prototype.disableNoiseBlur=function(){this._blurNoise=!1},t.prototype.setHighlightsGain=function(D){this._highlightsGain=D},t.prototype.setHighlightsThreshold=function(D){-1===this._highlightsGain&&(this._highlightsGain=1),this._highlightsThreshold=D},t.prototype.disableHighlights=function(){this._highlightsGain=-1},t.prototype.dispose=function(D){void 0===D&&(D=!1),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras),this._chromaticAberrationPostProcess=null,this._highlightsPostProcess=null,this._depthOfFieldPostProcess=null,this._grainTexture.dispose(),D&&this._scene.disableDepthRenderer()},t.prototype._createChromaticAberrationPostProcess=function(D){var w=this;this._chromaticAberrationPostProcess=new fi("LensChromaticAberration","chromaticAberration",["chromatic_aberration","screen_width","screen_height","direction","radialIntensity","centerPosition"],[],D,null,Jt.a.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._chromaticAberrationPostProcess.onApply=function(D){D.setFloat("chromatic_aberration",w._chromaticAberration),D.setFloat("screen_width",w._scene.getEngine().getRenderWidth()),D.setFloat("screen_height",w._scene.getEngine().getRenderHeight()),D.setFloat("radialIntensity",1),D.setFloat2("direction",17,17),D.setFloat2("centerPosition",.5,.5)}},t.prototype._createHighlightsPostProcess=function(D){var w=this;this._highlightsPostProcess=new fi("LensHighlights","lensHighlights",["gain","threshold","screen_width","screen_height"],[],D,null,Jt.a.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,this._dofPentagon?"#define PENTAGON\n":""),this._highlightsPostProcess.onApply=function(D){D.setFloat("gain",w._highlightsGain),D.setFloat("threshold",w._highlightsThreshold),D.setTextureFromPostProcess("textureSampler",w._chromaticAberrationPostProcess),D.setFloat("screen_width",w._scene.getEngine().getRenderWidth()),D.setFloat("screen_height",w._scene.getEngine().getRenderHeight())}},t.prototype._createDepthOfFieldPostProcess=function(D){var w=this;this._depthOfFieldPostProcess=new fi("LensDepthOfField","depthOfField",["grain_amount","blur_noise","screen_width","screen_height","distortion","dof_enabled","screen_distance","aperture","darken","edge_blur","highlights","near","far"],["depthSampler","grainSampler","highlightsSampler"],D,null,Jt.a.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._depthOfFieldPostProcess.onApply=function(D){D.setTexture("depthSampler",w._depthTexture),D.setTexture("grainSampler",w._grainTexture),D.setTextureFromPostProcess("textureSampler",w._highlightsPostProcess),D.setTextureFromPostProcess("highlightsSampler",w._depthOfFieldPostProcess),D.setFloat("grain_amount",w._grainAmount),D.setBool("blur_noise",w._blurNoise),D.setFloat("screen_width",w._scene.getEngine().getRenderWidth()),D.setFloat("screen_height",w._scene.getEngine().getRenderHeight()),D.setFloat("distortion",w._distortion),D.setBool("dof_enabled",-1!==w._dofDistance),D.setFloat("screen_distance",1/(.1-1/w._dofDistance)),D.setFloat("aperture",w._dofAperture),D.setFloat("darken",w._dofDarken),D.setFloat("edge_blur",w._edgeBlur),D.setBool("highlights",-1!==w._highlightsGain),w._scene.activeCamera&&(D.setFloat("near",w._scene.activeCamera.minZ),D.setFloat("far",w._scene.activeCamera.maxZ))}},t.prototype._createGrainTexture=function(){this._grainTexture=new Xi("LensNoiseTexture",512,this._scene,!1,Jt.a.BILINEAR_SAMPLINGMODE),this._grainTexture.wrapU=Jt.a.WRAP_ADDRESSMODE,this._grainTexture.wrapV=Jt.a.WRAP_ADDRESSMODE;for(var D,w=this._grainTexture.getContext(),N=0;N<512;N++)for(var F=0;F<512;F++)D=Math.floor(255*(Math.random()*(.58-.42)+.42)),w.fillStyle="rgb("+D+", "+D+", "+D+")",w.fillRect(N,F,1,1);this._grainTexture.update(!1)},t}(Dp);li.a.ShadersStore.ssao2PixelShader="\nprecision highp float;\nuniform sampler2D textureSampler;\nuniform float near;\nuniform float far;\nuniform float radius;\nfloat scales[16]=float[16](\n0.1,\n0.11406250000000001,\n0.131640625,\n0.15625,\n0.187890625,\n0.2265625,\n0.272265625,\n0.325,\n0.384765625,\n0.4515625,\n0.525390625,\n0.60625,\n0.694140625,\n0.7890625,\n0.891015625,\n1.0\n);\nvarying vec2 vUV;\nfloat perspectiveDepthToViewZ( const in float invClipZ,const in float near,const in float far ) {\nreturn ( near*far )/( ( far-near )*invClipZ-far );\n}\nfloat viewZToPerspectiveDepth( const in float viewZ,const in float near,const in float far ) {\nreturn ( near*far/viewZ+far)/( far-near );\n}\nfloat viewZToOrthographicDepth( const in float viewZ,const in float near,const in float far ) {\nreturn ( viewZ+near )/( near-far );\n}\n#ifdef SSAO\nuniform sampler2D randomSampler;\nuniform sampler2D normalSampler;\nuniform float randTextureTiles;\nuniform float samplesFactor;\nuniform vec3 sampleSphere[SAMPLES];\nuniform float totalStrength;\nuniform float base;\nuniform float xViewport;\nuniform float yViewport;\nuniform float maxZ;\nuniform float minZAspect;\nuniform vec2 texelSize;\nuniform mat4 projection;\nvoid main()\n{\nvec3 random=texture2D(randomSampler,vUV*randTextureTiles).rgb;\nfloat depth=texture2D(textureSampler,vUV).r;\nfloat depthSign=depth/abs(depth);\ndepth=depth*depthSign;\nvec3 normal=texture2D(normalSampler,vUV).rgb;\nfloat occlusion=0.0;\nfloat correctedRadius=min(radius,minZAspect*depth/near);\nvec3 vViewRay=vec3((vUV.x*2.0-1.0)*xViewport,(vUV.y*2.0-1.0)*yViewport,depthSign);\nvec3 origin=vViewRay*depth;\nvec3 rvec=random*2.0-1.0;\nrvec.z=0.0;\n\nfloat dotProduct=dot(rvec,normal);\nrvec=1.0-abs(dotProduct)>1e-2 ? rvec : vec3(-rvec.y,0.0,rvec.x);\nvec3 tangent=normalize(rvec-normal*dot(rvec,normal));\nvec3 bitangent=cross(normal,tangent);\nmat3 tbn=mat3(tangent,bitangent,normal);\nfloat difference;\nfor (int i=0; i<SAMPLES; ++i) {\n\nvec3 samplePosition=scales[(i+int(random.x*16.0)) % 16]*tbn*sampleSphere[(i+int(random.y*16.0)) % 16];\nsamplePosition=samplePosition*correctedRadius+origin;\n\nvec4 offset=vec4(samplePosition,1.0);\noffset=projection*offset;\noffset.xyz/=offset.w;\noffset.xy=offset.xy*0.5+0.5;\nif (offset.x<0.0 || offset.y<0.0 || offset.x>1.0 || offset.y>1.0) {\ncontinue;\n}\n\nfloat sampleDepth=abs(texture2D(textureSampler,offset.xy).r);\n\ndifference=depthSign*samplePosition.z-sampleDepth;\nfloat rangeCheck=1.0-smoothstep(correctedRadius*0.5,correctedRadius,difference);\nocclusion+=(difference>=0.0 ? 1.0 : 0.0)*rangeCheck;\n}\nocclusion=occlusion*(1.0-smoothstep(maxZ*0.75,maxZ,depth));\nfloat ao=1.0-totalStrength*occlusion*samplesFactor;\nfloat result=clamp(ao+base,0.0,1.0);\ngl_FragColor=vec4(vec3(result),1.0);\n}\n#endif\n#ifdef BILATERAL_BLUR\nuniform sampler2D depthSampler;\nuniform float outSize;\nuniform float samplerOffsets[SAMPLES];\nvec4 blur9(sampler2D image,vec2 uv,float resolution,vec2 direction) {\nvec4 color=vec4(0.0);\nvec2 off1=vec2(1.3846153846)*direction;\nvec2 off2=vec2(3.2307692308)*direction;\ncolor+=texture2D(image,uv)*0.2270270270;\ncolor+=texture2D(image,uv+(off1/resolution))*0.3162162162;\ncolor+=texture2D(image,uv-(off1/resolution))*0.3162162162;\ncolor+=texture2D(image,uv+(off2/resolution))*0.0702702703;\ncolor+=texture2D(image,uv-(off2/resolution))*0.0702702703;\nreturn color;\n}\nvec4 blur13(sampler2D image,vec2 uv,float resolution,vec2 direction) {\nvec4 color=vec4(0.0);\nvec2 off1=vec2(1.411764705882353)*direction;\nvec2 off2=vec2(3.2941176470588234)*direction;\nvec2 off3=vec2(5.176470588235294)*direction;\ncolor+=texture2D(image,uv)*0.1964825501511404;\ncolor+=texture2D(image,uv+(off1/resolution))*0.2969069646728344;\ncolor+=texture2D(image,uv-(off1/resolution))*0.2969069646728344;\ncolor+=texture2D(image,uv+(off2/resolution))*0.09447039785044732;\ncolor+=texture2D(image,uv-(off2/resolution))*0.09447039785044732;\ncolor+=texture2D(image,uv+(off3/resolution))*0.010381362401148057;\ncolor+=texture2D(image,uv-(off3/resolution))*0.010381362401148057;\nreturn color;\n}\nvec4 blur13Bilateral(sampler2D image,vec2 uv,float resolution,vec2 direction) {\nvec4 color=vec4(0.0);\nvec2 off1=vec2(1.411764705882353)*direction;\nvec2 off2=vec2(3.2941176470588234)*direction;\nvec2 off3=vec2(5.176470588235294)*direction;\nfloat compareDepth=abs(texture2D(depthSampler,uv).r);\nfloat sampleDepth;\nfloat weight;\nfloat weightSum=30.0;\ncolor+=texture2D(image,uv)*30.0;\nsampleDepth=abs(texture2D(depthSampler,uv+(off1/resolution)).r);\nweight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);\nweightSum+=weight;\ncolor+=texture2D(image,uv+(off1/resolution))*weight;\nsampleDepth=abs(texture2D(depthSampler,uv-(off1/resolution)).r);\nweight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);\nweightSum+=weight;\ncolor+=texture2D(image,uv-(off1/resolution))*weight;\nsampleDepth=abs(texture2D(depthSampler,uv+(off2/resolution)).r);\nweight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);\nweightSum+=weight;\ncolor+=texture2D(image,uv+(off2/resolution))*weight;\nsampleDepth=abs(texture2D(depthSampler,uv-(off2/resolution)).r);\nweight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);\nweightSum+=weight;\ncolor+=texture2D(image,uv-(off2/resolution))*weight;\nsampleDepth=abs(texture2D(depthSampler,uv+(off3/resolution)).r);\nweight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);\nweightSum+=weight;\ncolor+=texture2D(image,uv+(off3/resolution))*weight;\nsampleDepth=abs(texture2D(depthSampler,uv-(off3/resolution)).r);\nweight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);\nweightSum+=weight;\ncolor+=texture2D(image,uv-(off3/resolution))*weight;\nreturn color/weightSum;\n}\nvoid main()\n{\n#if EXPENSIVE\nfloat compareDepth=abs(texture2D(depthSampler,vUV).r);\nfloat texelsize=1.0/outSize;\nfloat result=0.0;\nfloat weightSum=0.0;\nfor (int i=0; i<SAMPLES; ++i)\n{\n#ifdef BILATERAL_BLUR_H\nvec2 direction=vec2(1.0,0.0);\nvec2 sampleOffset=vec2(texelsize*samplerOffsets[i],0.0);\n#else\nvec2 direction=vec2(0.0,1.0);\nvec2 sampleOffset=vec2(0.0,texelsize*samplerOffsets[i]);\n#endif\nvec2 samplePos=vUV+sampleOffset;\nfloat sampleDepth=abs(texture2D(depthSampler,samplePos).r);\nfloat weight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30000.0);\nresult+=texture2D(textureSampler,samplePos).r*weight;\nweightSum+=weight;\n}\nresult/=weightSum;\ngl_FragColor.rgb=vec3(result);\ngl_FragColor.a=1.0;\n#else\nvec4 color;\n#ifdef BILATERAL_BLUR_H\nvec2 direction=vec2(1.0,0.0);\ncolor=blur13Bilateral(textureSampler,vUV,outSize,direction);\n#else\nvec2 direction=vec2(0.0,1.0);\ncolor=blur13Bilateral(textureSampler,vUV,outSize,direction);\n#endif\ngl_FragColor.rgb=vec3(color.r);\ngl_FragColor.a=1.0;\n#endif\n}\n#endif\n",li.a.ShadersStore.ssaoCombinePixelShader="uniform sampler2D textureSampler;\nuniform sampler2D originalColor;\nuniform vec4 viewport;\nvarying vec2 vUV;\nvoid main(void) {\nvec4 ssaoColor=texture2D(textureSampler,viewport.xy+vUV*viewport.zw);\nvec4 sceneColor=texture2D(originalColor,vUV);\ngl_FragColor=sceneColor*ssaoColor;\n}\n";var Fp=function(D){function t(w,N,F,k){var j=D.call(this,N.getEngine(),w)||this;if(j.SSAOOriginalSceneColorEffect="SSAOOriginalSceneColorEffect",j.SSAORenderEffect="SSAORenderEffect",j.SSAOBlurHRenderEffect="SSAOBlurHRenderEffect",j.SSAOBlurVRenderEffect="SSAOBlurVRenderEffect",j.SSAOCombineRenderEffect="SSAOCombineRenderEffect",j.totalStrength=1,j.maxZ=100,j.minZAspect=.2,j._samples=8,j._textureSamples=1,j._expensiveBlur=!0,j.radius=2,j.base=0,j._bits=new Uint32Array(1),j._scene=N,j._ratio=F,!j.isSupported)return oe.a.Error("SSAO 2 needs WebGL 2 support."),j;var z=j._ratio.ssaoRatio||F,G=j._ratio.blurRatio||F,H=N.enableGeometryBufferRenderer();return j._createRandomTexture(),j._depthTexture=H.getGBuffer().textures[0],j._normalTexture=H.getGBuffer().textures[1],j._originalColorPostProcess=new pi("SSAOOriginalSceneColor",1,null,Jt.a.BILINEAR_SAMPLINGMODE,N.getEngine(),!1),j._originalColorPostProcess.samples=j.textureSamples,j._createSSAOPostProcess(1),j._createBlurPostProcess(z,G),j._createSSAOCombinePostProcess(G),j.addEffect(new up(N.getEngine(),j.SSAOOriginalSceneColorEffect,(function(){return j._originalColorPostProcess}),!0)),j.addEffect(new up(N.getEngine(),j.SSAORenderEffect,(function(){return j._ssaoPostProcess}),!0)),j.addEffect(new up(N.getEngine(),j.SSAOBlurHRenderEffect,(function(){return j._blurHPostProcess}),!0)),j.addEffect(new up(N.getEngine(),j.SSAOBlurVRenderEffect,(function(){return j._blurVPostProcess}),!0)),j.addEffect(new up(N.getEngine(),j.SSAOCombineRenderEffect,(function(){return j._ssaoCombinePostProcess}),!0)),N.postProcessRenderPipelineManager.addPipeline(j),k&&N.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(w,k),j}return Object(Z.d)(t,D),Object.defineProperty(t.prototype,"samples",{get:function(){return this._samples},set:function(D){this._ssaoPostProcess.updateEffect("#define SAMPLES "+D+"\n#define SSAO"),this._samples=D,this._sampleSphere=this._generateHemisphere()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textureSamples",{get:function(){return this._textureSamples},set:function(D){this._textureSamples=D,this._originalColorPostProcess.samples=D,this._blurHPostProcess.samples=D,this._blurVPostProcess.samples=D,this._ssaoPostProcess.samples=D,this._ssaoCombinePostProcess.samples=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"expensiveBlur",{get:function(){return this._expensiveBlur},set:function(D){this._blurHPostProcess.updateEffect("#define BILATERAL_BLUR\n#define BILATERAL_BLUR_H\n#define SAMPLES 16\n#define EXPENSIVE "+(D?"1":"0")+"\n",null,["textureSampler","depthSampler"]),this._blurVPostProcess.updateEffect("#define BILATERAL_BLUR\n#define SAMPLES 16\n#define EXPENSIVE "+(D?"1":"0")+"\n",null,["textureSampler","depthSampler"]),this._expensiveBlur=D},enumerable:!0,configurable:!0}),Object.defineProperty(t,"IsSupported",{get:function(){var D=Me.a.LastCreatedEngine;return!!D&&D.getCaps().drawBuffersExtension},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"SSAO2RenderingPipeline"},t.prototype.dispose=function(w){void 0===w&&(w=!1);for(var N=0;N<this._scene.cameras.length;N++){var F=this._scene.cameras[N];this._originalColorPostProcess.dispose(F),this._ssaoPostProcess.dispose(F),this._blurHPostProcess.dispose(F),this._blurVPostProcess.dispose(F),this._ssaoCombinePostProcess.dispose(F)}this._randomTexture.dispose(),w&&this._scene.disableGeometryBufferRenderer(),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras),D.prototype.dispose.call(this)},t.prototype._createBlurPostProcess=function(D,w){var N=this;this._samplerOffsets=[];for(var F=this.expensiveBlur,k=-8;k<8;k++)this._samplerOffsets.push(2*k+.5);this._blurHPostProcess=new fi("BlurH","ssao2",["outSize","samplerOffsets","near","far","radius"],["depthSampler"],D,null,Jt.a.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define BILATERAL_BLUR\n#define BILATERAL_BLUR_H\n#define SAMPLES 16\n#define EXPENSIVE "+(F?"1":"0")+"\n"),this._blurHPostProcess.onApply=function(D){N._scene.activeCamera&&(D.setFloat("outSize",N._ssaoCombinePostProcess.width>0?N._ssaoCombinePostProcess.width:N._originalColorPostProcess.width),D.setFloat("near",N._scene.activeCamera.minZ),D.setFloat("far",N._scene.activeCamera.maxZ),D.setFloat("radius",N.radius),D.setTexture("depthSampler",N._depthTexture),D.setArray("samplerOffsets",N._samplerOffsets))},this._blurVPostProcess=new fi("BlurV","ssao2",["outSize","samplerOffsets","near","far","radius"],["depthSampler"],w,null,Jt.a.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define BILATERAL_BLUR\n#define BILATERAL_BLUR_V\n#define SAMPLES 16\n#define EXPENSIVE "+(F?"1":"0")+"\n"),this._blurVPostProcess.onApply=function(D){N._scene.activeCamera&&(D.setFloat("outSize",N._ssaoCombinePostProcess.height>0?N._ssaoCombinePostProcess.height:N._originalColorPostProcess.height),D.setFloat("near",N._scene.activeCamera.minZ),D.setFloat("far",N._scene.activeCamera.maxZ),D.setFloat("radius",N.radius),D.setTexture("depthSampler",N._depthTexture),D.setArray("samplerOffsets",N._samplerOffsets))},this._blurHPostProcess.samples=this.textureSamples,this._blurVPostProcess.samples=this.textureSamples},t.prototype._rebuild=function(){D.prototype._rebuild.call(this)},t.prototype._radicalInverse_VdC=function(D){return this._bits[0]=D,this._bits[0]=(this._bits[0]<<16|this._bits[0]>>16)>>>0,this._bits[0]=(1431655765&this._bits[0])<<1|(2863311530&this._bits[0])>>>1>>>0,this._bits[0]=(858993459&this._bits[0])<<2|(3435973836&this._bits[0])>>>2>>>0,this._bits[0]=(252645135&this._bits[0])<<4|(4042322160&this._bits[0])>>>4>>>0,this._bits[0]=(16711935&this._bits[0])<<8|(4278255360&this._bits[0])>>>8>>>0,2.3283064365386963e-10*this._bits[0]},t.prototype._hammersley=function(D,w){return[D/w,this._radicalInverse_VdC(D)]},t.prototype._hemisphereSample_uniform=function(D,w){var N=2*w*Math.PI,F=1-(.85*D+.15),k=Math.sqrt(1-F*F);return new z.e(Math.cos(N)*k,Math.sin(N)*k,F)},t.prototype._generateHemisphere=function(){for(var D,w=this.samples,N=[],F=0;F<w;){if(w<16)D=this._hemisphereSample_uniform(Math.random(),Math.random());else{var k=this._hammersley(F,w);D=this._hemisphereSample_uniform(k[0],k[1])}N.push(D.x,D.y,D.z),F++}return N},t.prototype._createSSAOPostProcess=function(D){var w=this,N=this.samples;this._sampleSphere=this._generateHemisphere(),this._ssaoPostProcess=new fi("ssao2","ssao2",["sampleSphere","samplesFactor","randTextureTiles","totalStrength","radius","base","range","projection","near","far","texelSize","xViewport","yViewport","maxZ","minZAspect"],["randomSampler","normalSampler"],D,null,Jt.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define SAMPLES "+N+"\n#define SSAO"),this._ssaoPostProcess.onApply=function(D){w._scene.activeCamera&&(D.setArray3("sampleSphere",w._sampleSphere),D.setFloat("randTextureTiles",32),D.setFloat("samplesFactor",1/w.samples),D.setFloat("totalStrength",w.totalStrength),D.setFloat2("texelSize",1/w._ssaoPostProcess.width,1/w._ssaoPostProcess.height),D.setFloat("radius",w.radius),D.setFloat("maxZ",w.maxZ),D.setFloat("minZAspect",w.minZAspect),D.setFloat("base",w.base),D.setFloat("near",w._scene.activeCamera.minZ),D.setFloat("far",w._scene.activeCamera.maxZ),D.setFloat("xViewport",Math.tan(w._scene.activeCamera.fov/2)*w._scene.getEngine().getAspectRatio(w._scene.activeCamera,!0)),D.setFloat("yViewport",Math.tan(w._scene.activeCamera.fov/2)),D.setMatrix("projection",w._scene.getProjectionMatrix()),D.setTexture("textureSampler",w._depthTexture),D.setTexture("normalSampler",w._normalTexture),D.setTexture("randomSampler",w._randomTexture))},this._ssaoPostProcess.samples=this.textureSamples},t.prototype._createSSAOCombinePostProcess=function(D){var w=this;this._ssaoCombinePostProcess=new fi("ssaoCombine","ssaoCombine",[],["originalColor","viewport"],D,null,Jt.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._ssaoCombinePostProcess.onApply=function(D){var N=w._scene.activeCamera.viewport;D.setVector4("viewport",z.c.Vector4[0].copyFromFloats(N.x,N.y,N.width,N.height)),D.setTextureFromPostProcess("originalColor",w._originalColorPostProcess)},this._ssaoCombinePostProcess.samples=this.textureSamples},t.prototype._createRandomTexture=function(){this._randomTexture=new Xi("SSAORandomTexture",128,this._scene,!1,Jt.a.TRILINEAR_SAMPLINGMODE),this._randomTexture.wrapU=Jt.a.WRAP_ADDRESSMODE,this._randomTexture.wrapV=Jt.a.WRAP_ADDRESSMODE;for(var D=this._randomTexture.getContext(),t=function(D,w){return Math.random()*(w-D)+D},w=z.e.Zero(),N=0;N<128;N++)for(var F=0;F<128;F++)w.x=t(0,1),w.y=t(0,1),w.z=0,w.normalize(),w.scaleInPlace(255),w.x=Math.floor(w.x),w.y=Math.floor(w.y),D.fillStyle="rgb("+w.x+", "+w.y+", "+w.z+")",D.fillRect(N,F,1,1);this._randomTexture.update(!1)},t.prototype.serialize=function(){var D=Ie.a.Serialize(this);return D.customType="SSAO2RenderingPipeline",D},t.Parse=function(D,w,N){return Ie.a.Parse((function(){return new t(D._name,w,D._ratio)}),D,w,N)},Object(Z.c)([Object(Ie.c)()],t.prototype,"totalStrength",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"maxZ",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"minZAspect",void 0),Object(Z.c)([Object(Ie.c)("samples")],t.prototype,"_samples",void 0),Object(Z.c)([Object(Ie.c)("textureSamples")],t.prototype,"_textureSamples",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"_ratio",void 0),Object(Z.c)([Object(Ie.c)("expensiveBlur")],t.prototype,"_expensiveBlur",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"radius",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"base",void 0),t}(Dp);H.a.RegisteredTypes["BABYLON.SSAO2RenderingPipeline"]=Fp,li.a.ShadersStore.ssaoPixelShader="\nuniform sampler2D textureSampler;\nvarying vec2 vUV;\n#ifdef SSAO\nuniform sampler2D randomSampler;\nuniform float randTextureTiles;\nuniform float samplesFactor;\nuniform vec3 sampleSphere[SAMPLES];\nuniform float totalStrength;\nuniform float radius;\nuniform float area;\nuniform float fallOff;\nuniform float base;\nvec3 normalFromDepth(float depth,vec2 coords)\n{\nvec2 offset1=vec2(0.0,radius);\nvec2 offset2=vec2(radius,0.0);\nfloat depth1=texture2D(textureSampler,coords+offset1).r;\nfloat depth2=texture2D(textureSampler,coords+offset2).r;\nvec3 p1=vec3(offset1,depth1-depth);\nvec3 p2=vec3(offset2,depth2-depth);\nvec3 normal=cross(p1,p2);\nnormal.z=-normal.z;\nreturn normalize(normal);\n}\nvoid main()\n{\nvec3 random=normalize(texture2D(randomSampler,vUV*randTextureTiles).rgb);\nfloat depth=texture2D(textureSampler,vUV).r;\nvec3 position=vec3(vUV,depth);\nvec3 normal=normalFromDepth(depth,vUV);\nfloat radiusDepth=radius/depth;\nfloat occlusion=0.0;\nvec3 ray;\nvec3 hemiRay;\nfloat occlusionDepth;\nfloat difference;\nfor (int i=0; i<SAMPLES; i++)\n{\nray=radiusDepth*reflect(sampleSphere[i],random);\nhemiRay=position+sign(dot(ray,normal))*ray;\nocclusionDepth=texture2D(textureSampler,clamp(hemiRay.xy,vec2(0.001,0.001),vec2(0.999,0.999))).r;\ndifference=depth-occlusionDepth;\nocclusion+=step(fallOff,difference)*(1.0-smoothstep(fallOff,area,difference));\n}\nfloat ao=1.0-totalStrength*occlusion*samplesFactor;\nfloat result=clamp(ao+base,0.0,1.0);\ngl_FragColor.r=result;\ngl_FragColor.g=result;\ngl_FragColor.b=result;\ngl_FragColor.a=1.0;\n}\n#endif\n";var Bp=function(D){function t(w,N,F,k){var j=D.call(this,N.getEngine(),w)||this;j.SSAOOriginalSceneColorEffect="SSAOOriginalSceneColorEffect",j.SSAORenderEffect="SSAORenderEffect",j.SSAOBlurHRenderEffect="SSAOBlurHRenderEffect",j.SSAOBlurVRenderEffect="SSAOBlurVRenderEffect",j.SSAOCombineRenderEffect="SSAOCombineRenderEffect",j.totalStrength=1,j.radius=1e-4,j.area=.0075,j.fallOff=1e-6,j.base=.5,j._firstUpdate=!0,j._scene=N,j._createRandomTexture(),j._depthTexture=N.enableDepthRenderer().getDepthMap();var z=F.ssaoRatio||F,G=F.combineRatio||F;return j._originalColorPostProcess=new pi("SSAOOriginalSceneColor",G,null,Jt.a.BILINEAR_SAMPLINGMODE,N.getEngine(),!1),j._createSSAOPostProcess(z),j._createBlurPostProcess(z),j._createSSAOCombinePostProcess(G),j.addEffect(new up(N.getEngine(),j.SSAOOriginalSceneColorEffect,(function(){return j._originalColorPostProcess}),!0)),j.addEffect(new up(N.getEngine(),j.SSAORenderEffect,(function(){return j._ssaoPostProcess}),!0)),j.addEffect(new up(N.getEngine(),j.SSAOBlurHRenderEffect,(function(){return j._blurHPostProcess}),!0)),j.addEffect(new up(N.getEngine(),j.SSAOBlurVRenderEffect,(function(){return j._blurVPostProcess}),!0)),j.addEffect(new up(N.getEngine(),j.SSAOCombineRenderEffect,(function(){return j._ssaoCombinePostProcess}),!0)),N.postProcessRenderPipelineManager.addPipeline(j),k&&N.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(w,k),j}return Object(Z.d)(t,D),Object.defineProperty(t.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"SSAORenderingPipeline"},t.prototype.dispose=function(w){void 0===w&&(w=!1);for(var N=0;N<this._scene.cameras.length;N++){var F=this._scene.cameras[N];this._originalColorPostProcess.dispose(F),this._ssaoPostProcess.dispose(F),this._blurHPostProcess.dispose(F),this._blurVPostProcess.dispose(F),this._ssaoCombinePostProcess.dispose(F)}this._randomTexture.dispose(),w&&this._scene.disableDepthRenderer(),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras),D.prototype.dispose.call(this)},t.prototype._createBlurPostProcess=function(D){var w=this;this._blurHPostProcess=new Fo("BlurH",new z.d(1,0),16,D,null,Jt.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,ce.a.TEXTURETYPE_UNSIGNED_INT),this._blurVPostProcess=new Fo("BlurV",new z.d(0,1),16,D,null,Jt.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,ce.a.TEXTURETYPE_UNSIGNED_INT),this._blurHPostProcess.onActivateObservable.add((function(){var D=w._blurHPostProcess.width/w._scene.getEngine().getRenderWidth();w._blurHPostProcess.kernel=16*D})),this._blurVPostProcess.onActivateObservable.add((function(){var D=w._blurVPostProcess.height/w._scene.getEngine().getRenderHeight();w._blurVPostProcess.kernel=16*D}))},t.prototype._rebuild=function(){this._firstUpdate=!0,D.prototype._rebuild.call(this)},t.prototype._createSSAOPostProcess=function(D){var w=this,N=[.5381,.1856,-.4319,.1379,.2486,.443,.3371,.5679,-.0057,-.6999,-.0451,-.0019,.0689,-.1598,-.8547,.056,.0069,-.1843,-.0146,.1402,.0762,.01,-.1924,-.0344,-.3577,-.5301,-.4358,-.3169,.1063,.0158,.0103,-.5869,.0046,-.0897,-.494,.3287,.7119,-.0154,-.0918,-.0533,.0596,-.5411,.0352,-.0631,.546,-.4776,.2847,-.0271];this._ssaoPostProcess=new fi("ssao","ssao",["sampleSphere","samplesFactor","randTextureTiles","totalStrength","radius","area","fallOff","base","range","viewport"],["randomSampler"],D,null,Jt.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define SAMPLES 16\n#define SSAO"),this._ssaoPostProcess.onApply=function(D){w._firstUpdate&&(D.setArray3("sampleSphere",N),D.setFloat("samplesFactor",1/16),D.setFloat("randTextureTiles",4)),D.setFloat("totalStrength",w.totalStrength),D.setFloat("radius",w.radius),D.setFloat("area",w.area),D.setFloat("fallOff",w.fallOff),D.setFloat("base",w.base),D.setTexture("textureSampler",w._depthTexture),D.setTexture("randomSampler",w._randomTexture)}},t.prototype._createSSAOCombinePostProcess=function(D){var w=this;this._ssaoCombinePostProcess=new fi("ssaoCombine","ssaoCombine",[],["originalColor","viewport"],D,null,Jt.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._ssaoCombinePostProcess.onApply=function(D){D.setVector4("viewport",z.c.Vector4[0].copyFromFloats(0,0,1,1)),D.setTextureFromPostProcess("originalColor",w._originalColorPostProcess)}},t.prototype._createRandomTexture=function(){this._randomTexture=new Xi("SSAORandomTexture",512,this._scene,!1,Jt.a.TRILINEAR_SAMPLINGMODE),this._randomTexture.wrapU=Jt.a.WRAP_ADDRESSMODE,this._randomTexture.wrapV=Jt.a.WRAP_ADDRESSMODE;for(var D=this._randomTexture.getContext(),t=function(D,w){return Math.random()*(w-D)+D},w=z.e.Zero(),N=0;N<512;N++)for(var F=0;F<512;F++)w.x=Math.floor(255*t(-1,1)),w.y=Math.floor(255*t(-1,1)),w.z=Math.floor(255*t(-1,1)),D.fillStyle="rgb("+w.x+", "+w.y+", "+w.z+")",D.fillRect(N,F,1,1);this._randomTexture.update(!1)},Object(Z.c)([Object(Ie.c)()],t.prototype,"totalStrength",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"radius",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"area",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"fallOff",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"base",void 0),t}(Dp);li.a.ShadersStore.screenSpaceReflectionPixelShader="\n\nuniform sampler2D textureSampler;\nuniform sampler2D normalSampler;\nuniform sampler2D positionSampler;\nuniform sampler2D reflectivitySampler;\nuniform mat4 view;\nuniform mat4 projection;\nuniform float step;\nuniform float strength;\nuniform float threshold;\nuniform float roughnessFactor;\nuniform float reflectionSpecularFalloffExponent;\n\nvarying vec2 vUV;\n\nstruct ReflectionInfo {\nvec3 color;\nvec4 coords;\n};\n\nvec3 fresnelSchlick(float cosTheta,vec3 F0)\n{\nreturn F0+(1.0-F0)*pow(1.0-cosTheta,5.0);\n}\n\nReflectionInfo smoothReflectionInfo(vec3 dir,vec3 hitCoord)\n{\nReflectionInfo info;\ninfo.color=vec3(0.0);\nvec4 projectedCoord;\nfloat sampledDepth;\nfor(int i=0; i<SMOOTH_STEPS; i++)\n{\nprojectedCoord=projection*vec4(hitCoord,1.0);\nprojectedCoord.xy/=projectedCoord.w;\nprojectedCoord.xy=0.5*projectedCoord.xy+vec2(0.5);\nsampledDepth=(view*texture2D(positionSampler,projectedCoord.xy)).z;\nfloat depth=sampledDepth-hitCoord.z;\ndir*=0.5;\nif(depth>0.0)\nhitCoord-=dir;\nelse\nhitCoord+=dir;\ninfo.color+=texture2D(textureSampler,projectedCoord.xy).rgb;\n}\nprojectedCoord=projection*vec4(hitCoord,1.0);\nprojectedCoord.xy/=projectedCoord.w;\nprojectedCoord.xy=0.5*projectedCoord.xy+vec2(0.5);\n\ninfo.coords=vec4(projectedCoord.xy,sampledDepth,1.0);\ninfo.color+=texture2D(textureSampler,projectedCoord.xy).rgb;\ninfo.color/=float(SMOOTH_STEPS+1);\nreturn info;\n}\n\nReflectionInfo getReflectionInfo(vec3 dir,vec3 hitCoord)\n{\nReflectionInfo info;\nvec4 projectedCoord;\nfloat sampledDepth;\ndir*=step;\nfor(int i=0; i<REFLECTION_SAMPLES; i++)\n{\nhitCoord+=dir;\nprojectedCoord=projection*vec4(hitCoord,1.0);\nprojectedCoord.xy/=projectedCoord.w;\nprojectedCoord.xy=0.5*projectedCoord.xy+vec2(0.5);\nsampledDepth=(view*texture2D(positionSampler,projectedCoord.xy)).z;\nfloat depth=sampledDepth-hitCoord.z;\nif(((depth-dir.z)<threshold) && depth<=0.0)\n{\n#ifdef ENABLE_SMOOTH_REFLECTIONS\nreturn smoothReflectionInfo(dir,hitCoord);\n#else\ninfo.color=texture2D(textureSampler,projectedCoord.xy).rgb;\ninfo.coords=vec4(projectedCoord.xy,sampledDepth,0.0);\nreturn info;\n#endif\n}\n}\ninfo.color=texture2D(textureSampler,projectedCoord.xy).rgb;\ninfo.coords=vec4(projectedCoord.xy,sampledDepth,0.0);\nreturn info;\n}\nvec3 hash(vec3 a)\n{\na=fract(a*0.8);\na+=dot(a,a.yxz+19.19);\nreturn fract((a.xxy+a.yxx)*a.zyx);\n}\nvoid main()\n{\n#ifdef SSR_SUPPORTED\n\nvec3 albedo=texture2D(textureSampler,vUV).rgb;\nfloat spec=texture2D(reflectivitySampler,vUV).r;\nif (spec == 0.0) {\ngl_FragColor=vec4(albedo,1.0);\nreturn;\n}\n\nvec3 normal=(texture2D(normalSampler,vUV)).xyz;\nvec3 position=(view*texture2D(positionSampler,vUV)).xyz;\nvec3 reflected=normalize(reflect(normalize(position),normalize(normal)));\nfloat roughness=1.0-texture2D(reflectivitySampler,vUV).a;\nvec3 jitt=mix(vec3(0.0),hash(position),roughness)*roughnessFactor;\nReflectionInfo info=getReflectionInfo(jitt+reflected,position);\n\nvec2 dCoords=smoothstep(0.2,0.6,abs(vec2(0.5,0.5)-info.coords.xy));\nfloat screenEdgefactor=clamp(1.0-(dCoords.x+dCoords.y),0.0,1.0);\n\nvec3 F0=vec3(0.04);\nF0=mix(F0,albedo,spec);\nvec3 fresnel=fresnelSchlick(max(dot(normalize(normal),normalize(position)),0.0),F0);\n\nfloat reflectionMultiplier=clamp(pow(spec*strength,reflectionSpecularFalloffExponent)*screenEdgefactor*reflected.z,0.0,0.9);\nfloat albedoMultiplier=1.0-reflectionMultiplier;\nvec3 SSR=info.color*fresnel;\ngl_FragColor=vec4((albedo*albedoMultiplier)+(SSR*reflectionMultiplier),1.0);\n#else\ngl_FragColor=texture2D(textureSampler,vUV);\n#endif\n}\n";var kp=function(D){function t(w,N,F,k,j,z,G,H,X){void 0===H&&(H=ce.a.TEXTURETYPE_UNSIGNED_INT),void 0===X&&(X=!1);var q=D.call(this,w,"screenSpaceReflection",["projection","view","threshold","reflectionSpecularFalloffExponent","strength","step","roughnessFactor"],["textureSampler","normalSampler","positionSampler","reflectivitySampler"],F,k,j,z,G,"#define SSR_SUPPORTED\n#define REFLECTION_SAMPLES 64\n#define SMOOTH_STEPS 5\n",H,void 0,null,X)||this;q.threshold=1.2,q.strength=1,q.reflectionSpecularFalloffExponent=3,q.step=1,q.roughnessFactor=.2,q._enableSmoothReflections=!1,q._reflectionSamples=64,q._smoothSteps=5;var Z=N.enableGeometryBufferRenderer();return Z&&Z.isSupported&&(Z.enablePosition=!0,Z.enableReflectivity=!0,q._geometryBufferRenderer=Z),q._updateEffectDefines(),q.onApply=function(D){if(Z){var w=Z.getTextureIndex(Ap.POSITION_TEXTURE_TYPE),F=Z.getTextureIndex(Ap.REFLECTIVITY_TEXTURE_TYPE);D.setTexture("normalSampler",Z.getGBuffer().textures[1]),D.setTexture("positionSampler",Z.getGBuffer().textures[w]),D.setTexture("reflectivitySampler",Z.getGBuffer().textures[F]);var k=N.activeCamera;if(k){var j=k.getViewMatrix(),z=k.getProjectionMatrix();D.setMatrix("projection",z),D.setMatrix("view",j),D.setFloat("threshold",q.threshold),D.setFloat("reflectionSpecularFalloffExponent",q.reflectionSpecularFalloffExponent),D.setFloat("strength",q.strength),D.setFloat("step",q.step),D.setFloat("roughnessFactor",q.roughnessFactor)}}},q}return Object(Z.d)(t,D),Object.defineProperty(t.prototype,"enableSmoothReflections",{get:function(){return this._enableSmoothReflections},set:function(D){D!==this._enableSmoothReflections&&(this._enableSmoothReflections=D,this._updateEffectDefines())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"reflectionSamples",{get:function(){return this._reflectionSamples},set:function(D){D!==this._reflectionSamples&&(this._reflectionSamples=D,this._updateEffectDefines())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"smoothSteps",{get:function(){return this._smoothSteps},set:function(D){D!==this._smoothSteps&&(this._smoothSteps=D,this._updateEffectDefines())},enumerable:!0,configurable:!0}),t.prototype._updateEffectDefines=function(){var D=[];this._geometryBufferRenderer&&D.push("#define SSR_SUPPORTED"),this._enableSmoothReflections&&D.push("#define ENABLE_SMOOTH_REFLECTIONS"),D.push("#define REFLECTION_SAMPLES "+(this._reflectionSamples>>0)),D.push("#define SMOOTH_STEPS "+(this._smoothSteps>>0)),this.updateEffect(D.join("\n"))},Object(Z.c)([Object(Ie.c)()],t.prototype,"threshold",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"strength",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"reflectionSpecularFalloffExponent",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"step",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"roughnessFactor",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"enableSmoothReflections",null),Object(Z.c)([Object(Ie.c)()],t.prototype,"reflectionSamples",null),Object(Z.c)([Object(Ie.c)()],t.prototype,"smoothSteps",null),t}(fi);li.a.ShadersStore.standardPixelShader="uniform sampler2D textureSampler;\nvarying vec2 vUV;\n#if defined(PASS_POST_PROCESS)\nvoid main(void)\n{\nvec4 color=texture2D(textureSampler,vUV);\ngl_FragColor=color;\n}\n#endif\n#if defined(DOWN_SAMPLE_X4)\nuniform vec2 dsOffsets[16];\nvoid main(void)\n{\nvec4 average=vec4(0.0,0.0,0.0,0.0);\naverage=texture2D(textureSampler,vUV+dsOffsets[0]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[1]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[2]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[3]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[4]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[5]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[6]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[7]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[8]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[9]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[10]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[11]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[12]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[13]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[14]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[15]);\naverage/=16.0;\ngl_FragColor=average;\n}\n#endif\n#if defined(BRIGHT_PASS)\nuniform vec2 dsOffsets[4];\nuniform float brightThreshold;\nvoid main(void)\n{\nvec4 average=vec4(0.0,0.0,0.0,0.0);\naverage=texture2D(textureSampler,vUV+vec2(dsOffsets[0].x,dsOffsets[0].y));\naverage+=texture2D(textureSampler,vUV+vec2(dsOffsets[1].x,dsOffsets[1].y));\naverage+=texture2D(textureSampler,vUV+vec2(dsOffsets[2].x,dsOffsets[2].y));\naverage+=texture2D(textureSampler,vUV+vec2(dsOffsets[3].x,dsOffsets[3].y));\naverage*=0.25;\nfloat luminance=length(average.rgb);\nif (luminance<brightThreshold) {\naverage=vec4(0.0,0.0,0.0,1.0);\n}\ngl_FragColor=average;\n}\n#endif\n#if defined(TEXTURE_ADDER)\nuniform sampler2D otherSampler;\nuniform sampler2D lensSampler;\nuniform float exposure;\nvoid main(void)\n{\nvec3 colour=texture2D(textureSampler,vUV).rgb;\ncolour*=exposure;\nvec3 X=max(vec3(0.0,0.0,0.0),colour-0.004);\nvec3 retColor=(X*(6.2*X+0.5))/(X*(6.2*X+1.7)+0.06);\ncolour=retColor*retColor;\ncolour+=colour*texture2D(lensSampler,vUV).rgb;\nvec4 finalColor=vec4(colour.rgb,1.0)+texture2D(otherSampler,vUV);\ngl_FragColor=finalColor;\n}\n#endif\n#if defined(VLS)\n#define PI 3.1415926535897932384626433832795\nuniform mat4 shadowViewProjection;\nuniform mat4 lightWorld;\nuniform vec3 cameraPosition;\nuniform vec3 sunDirection;\nuniform vec3 sunColor;\nuniform vec2 depthValues;\nuniform float scatteringCoefficient;\nuniform float scatteringPower;\nuniform sampler2D shadowMapSampler;\nuniform sampler2D positionSampler;\nfloat computeScattering(float lightDotView)\n{\nfloat result=1.0-scatteringCoefficient*scatteringCoefficient;\nresult/=(4.0*PI*pow(1.0+scatteringCoefficient*scatteringCoefficient-(2.0*scatteringCoefficient)*lightDotView,1.5));\nreturn result;\n}\nvoid main(void)\n{\n\nvec3 worldPos=texture2D(positionSampler,vUV).rgb;\nvec3 startPosition=cameraPosition;\nvec3 rayVector=worldPos-startPosition;\nfloat rayLength=length(rayVector);\nvec3 rayDirection=rayVector/rayLength;\nfloat stepLength=rayLength/NB_STEPS;\nvec3 stepL=rayDirection*stepLength;\nvec3 currentPosition=startPosition;\nvec3 accumFog=vec3(0.0);\nfor (int i=0; i<int(NB_STEPS); i++)\n{\nvec4 worldInShadowCameraSpace=shadowViewProjection*vec4(currentPosition,1.0);\nfloat depthMetric=(worldInShadowCameraSpace.z+depthValues.x)/(depthValues.y);\nfloat shadowPixelDepth=clamp(depthMetric,0.0,1.0);\nworldInShadowCameraSpace.xyz/=worldInShadowCameraSpace.w;\nworldInShadowCameraSpace.xyz=0.5*worldInShadowCameraSpace.xyz+vec3(0.5);\nfloat shadowMapValue=texture2D(shadowMapSampler,worldInShadowCameraSpace.xy).r;\nif (shadowMapValue>shadowPixelDepth)\naccumFog+=sunColor*computeScattering(dot(rayDirection,sunDirection));\ncurrentPosition+=stepL;\n}\naccumFog/=NB_STEPS;\nvec3 color=accumFog*scatteringPower;\ngl_FragColor=vec4(color*exp(color) ,1.0);\n}\n#endif\n#if defined(VLSMERGE)\nuniform sampler2D originalSampler;\nvoid main(void)\n{\ngl_FragColor=texture2D(originalSampler,vUV)+texture2D(textureSampler,vUV);\n}\n#endif\n#if defined(LUMINANCE)\nuniform vec2 lumOffsets[4];\nvoid main()\n{\nfloat average=0.0;\nvec4 color=vec4(0.0);\nfloat maximum=-1e20;\nvec3 weight=vec3(0.299,0.587,0.114);\nfor (int i=0; i<4; i++)\n{\ncolor=texture2D(textureSampler,vUV+ lumOffsets[i]);\n\nfloat GreyValue=dot(color.rgb,vec3(0.33,0.33,0.33));\n\n#ifdef WEIGHTED_AVERAGE\nfloat GreyValue=dot(color.rgb,weight);\n#endif\n#ifdef BRIGHTNESS\nfloat GreyValue=max(color.r,max(color.g,color.b));\n#endif\n#ifdef HSL_COMPONENT\nfloat GreyValue=0.5*(max(color.r,max(color.g,color.b))+min(color.r,min(color.g,color.b)));\n#endif\n#ifdef MAGNITUDE\nfloat GreyValue=length(color.rgb);\n#endif\nmaximum=max(maximum,GreyValue);\naverage+=(0.25*log(1e-5+GreyValue));\n}\naverage=exp(average);\ngl_FragColor=vec4(average,maximum,0.0,1.0);\n}\n#endif\n#if defined(LUMINANCE_DOWN_SAMPLE)\nuniform vec2 dsOffsets[9];\nuniform float halfDestPixelSize;\n#ifdef FINAL_DOWN_SAMPLER\n#include<packingFunctions>\n#endif\nvoid main()\n{\nvec4 color=vec4(0.0);\nfloat average=0.0;\nfor (int i=0; i<9; i++)\n{\ncolor=texture2D(textureSampler,vUV+vec2(halfDestPixelSize,halfDestPixelSize)+dsOffsets[i]);\naverage+=color.r;\n}\naverage/=9.0;\n#ifdef FINAL_DOWN_SAMPLER\ngl_FragColor=pack(average);\n#else\ngl_FragColor=vec4(average,average,0.0,1.0);\n#endif\n}\n#endif\n#if defined(HDR)\nuniform sampler2D textureAdderSampler;\nuniform float averageLuminance;\nvoid main()\n{\nvec4 color=texture2D(textureAdderSampler,vUV);\n#ifndef AUTO_EXPOSURE\nvec4 adjustedColor=color/averageLuminance;\ncolor=adjustedColor;\ncolor.a=1.0;\n#endif\ngl_FragColor=color;\n}\n#endif\n#if defined(LENS_FLARE)\n#define GHOSTS 3\nuniform sampler2D lensColorSampler;\nuniform float strength;\nuniform float ghostDispersal;\nuniform float haloWidth;\nuniform vec2 resolution;\nuniform float distortionStrength;\nfloat hash(vec2 p)\n{\nfloat h=dot(p,vec2(127.1,311.7));\nreturn -1.0+2.0*fract(sin(h)*43758.5453123);\n}\nfloat noise(in vec2 p)\n{\nvec2 i=floor(p);\nvec2 f=fract(p);\nvec2 u=f*f*(3.0-2.0*f);\nreturn mix(mix(hash(i+vec2(0.0,0.0)),\nhash(i+vec2(1.0,0.0)),u.x),\nmix(hash(i+vec2(0.0,1.0)),\nhash(i+vec2(1.0,1.0)),u.x),u.y);\n}\nfloat fbm(vec2 p)\n{\nfloat f=0.0;\nf+=0.5000*noise(p); p*=2.02;\nf+=0.2500*noise(p); p*=2.03;\nf+=0.1250*noise(p); p*=2.01;\nf+=0.0625*noise(p); p*=2.04;\nf/=0.9375;\nreturn f;\n}\nvec3 pattern(vec2 uv)\n{\nvec2 p=-1.0+2.0*uv;\nfloat p2=dot(p,p);\nfloat f=fbm(vec2(15.0*p2))/2.0;\nfloat r=0.2+0.6*sin(12.5*length(uv-vec2(0.5)));\nfloat g=0.2+0.6*sin(20.5*length(uv-vec2(0.5)));\nfloat b=0.2+0.6*sin(17.2*length(uv-vec2(0.5)));\nreturn (1.0-f)*vec3(r,g,b);\n}\nfloat luminance(vec3 color)\n{\nreturn dot(color.rgb,vec3(0.2126,0.7152,0.0722));\n}\nvec4 textureDistorted(sampler2D tex,vec2 texcoord,vec2 direction,vec3 distortion)\n{\nreturn vec4(\ntexture2D(tex,texcoord+direction*distortion.r).r,\ntexture2D(tex,texcoord+direction*distortion.g).g,\ntexture2D(tex,texcoord+direction*distortion.b).b,\n1.0\n);\n}\nvoid main(void)\n{\nvec2 uv=-vUV+vec2(1.0);\nvec2 ghostDir=(vec2(0.5)-uv)*ghostDispersal;\nvec2 texelSize=1.0/resolution;\nvec3 distortion=vec3(-texelSize.x*distortionStrength,0.0,texelSize.x*distortionStrength);\nvec4 result=vec4(0.0);\nfloat ghostIndice=1.0;\nfor (int i=0; i<GHOSTS; ++i)\n{\nvec2 offset=fract(uv+ghostDir*ghostIndice);\nfloat weight=length(vec2(0.5)-offset)/length(vec2(0.5));\nweight=pow(1.0-weight,10.0);\nresult+=textureDistorted(textureSampler,offset,normalize(ghostDir),distortion)*weight*strength;\nghostIndice+=1.0;\n}\nvec2 haloVec=normalize(ghostDir)*haloWidth;\nfloat weight=length(vec2(0.5)-fract(uv+haloVec))/length(vec2(0.5));\nweight=pow(1.0-weight,10.0);\nresult+=textureDistorted(textureSampler,fract(uv+haloVec),normalize(ghostDir),distortion)*weight*strength;\nresult*=texture2D(lensColorSampler,vec2(length(vec2(0.5)-uv)/length(vec2(0.5))));\ngl_FragColor=result;\n}\n#endif\n#if defined(LENS_FLARE_COMPOSE)\nuniform sampler2D otherSampler;\nuniform sampler2D lensDirtSampler;\nuniform sampler2D lensStarSampler;\nuniform mat4 lensStarMatrix;\nvoid main(void)\n{\nvec2 lensFlareCoords=(lensStarMatrix*vec4(vUV,1.0,1.0)).xy;\nvec4 lensMod=texture2D(lensDirtSampler,vUV);\nlensMod+=texture2D(lensStarSampler,vUV);\nvec4 result=texture2D(textureSampler,vUV)*lensMod;\ngl_FragColor=texture2D(otherSampler,vUV)+result;\n}\n#endif\n#if defined(DEPTH_OF_FIELD)\nuniform sampler2D otherSampler;\nuniform sampler2D depthSampler;\nuniform float distance;\nvoid main(void)\n{\nvec4 sharp=texture2D(otherSampler,vUV);\nvec4 blur=texture2D(textureSampler,vUV);\nfloat dist=clamp(texture2D(depthSampler,vUV).r*distance,0.0,1.0);\nfloat factor=0.0;\nif (dist<0.05)\nfactor=1.0;\nelse if (dist<0.1)\nfactor=20.0*(0.1-dist);\nelse if (dist<0.5)\nfactor=0.0;\nelse\nfactor=2.0*(dist-0.5);\nfactor=clamp(factor,0.0,0.90);\ngl_FragColor=mix(sharp,blur,factor);\n}\n#endif\n#if defined(MOTION_BLUR)\nuniform mat4 inverseViewProjection;\nuniform mat4 prevViewProjection;\nuniform vec2 screenSize;\nuniform float motionScale;\nuniform float motionStrength;\nuniform sampler2D depthSampler;\nvoid main(void)\n{\nvec2 texelSize=1.0/screenSize;\nfloat depth=texture2D(depthSampler,vUV).r;\nvec4 cpos=vec4(vUV*2.0-1.0,depth,1.0);\ncpos=cpos*inverseViewProjection;\nvec4 ppos=cpos*prevViewProjection;\nppos.xyz/=ppos.w;\nppos.xy=ppos.xy*0.5+0.5;\nvec2 velocity=(ppos.xy-vUV)*motionScale*motionStrength;\nfloat speed=length(velocity/texelSize);\nint nSamples=int(clamp(speed,1.0,MAX_MOTION_SAMPLES));\nvec4 result=texture2D(textureSampler,vUV);\nfor (int i=1; i<int(MAX_MOTION_SAMPLES); ++i) {\nif (i>=nSamples)\nbreak;\nvec2 offset1=vUV+velocity*(float(i)/float(nSamples-1)-0.5);\nresult+=texture2D(textureSampler,offset1);\n}\ngl_FragColor=result/float(nSamples);\n}\n#endif\n";var Up,Vp=function(D){function t(w,N,F,k,j){void 0===k&&(k=null);var z=D.call(this,N.getEngine(),w)||this;return z.downSampleX4PostProcess=null,z.brightPassPostProcess=null,z.blurHPostProcesses=[],z.blurVPostProcesses=[],z.textureAdderPostProcess=null,z.volumetricLightPostProcess=null,z.volumetricLightSmoothXPostProcess=null,z.volumetricLightSmoothYPostProcess=null,z.volumetricLightMergePostProces=null,z.volumetricLightFinalPostProcess=null,z.luminancePostProcess=null,z.luminanceDownSamplePostProcesses=[],z.hdrPostProcess=null,z.textureAdderFinalPostProcess=null,z.lensFlareFinalPostProcess=null,z.hdrFinalPostProcess=null,z.lensFlarePostProcess=null,z.lensFlareComposePostProcess=null,z.motionBlurPostProcess=null,z.depthOfFieldPostProcess=null,z.fxaaPostProcess=null,z.screenSpaceReflectionPostProcess=null,z.brightThreshold=1,z.blurWidth=512,z.horizontalBlur=!1,z.lensTexture=null,z.volumetricLightCoefficient=.2,z.volumetricLightPower=4,z.volumetricLightBlurScale=64,z.sourceLight=null,z.hdrMinimumLuminance=1,z.hdrDecreaseRate=.5,z.hdrIncreaseRate=.5,z.lensColorTexture=null,z.lensFlareStrength=20,z.lensFlareGhostDispersal=1.4,z.lensFlareHaloWidth=.7,z.lensFlareDistortionStrength=16,z.lensFlareBlurWidth=512,z.lensStarTexture=null,z.lensFlareDirtTexture=null,z.depthOfFieldDistance=10,z.depthOfFieldBlurWidth=64,z.animations=[],z._currentDepthOfFieldSource=null,z._fixedExposure=1,z._currentExposure=1,z._hdrAutoExposure=!1,z._hdrCurrentLuminance=1,z._motionStrength=1,z._isObjectBasedMotionBlur=!1,z._camerasToBeAttached=[],z._bloomEnabled=!1,z._depthOfFieldEnabled=!1,z._vlsEnabled=!1,z._lensFlareEnabled=!1,z._hdrEnabled=!1,z._motionBlurEnabled=!1,z._fxaaEnabled=!1,z._screenSpaceReflectionsEnabled=!1,z._motionBlurSamples=64,z._volumetricLightStepsCount=50,z._samples=1,z._cameras=j||N.cameras,z._cameras=z._cameras.slice(),z._camerasToBeAttached=z._cameras.slice(),z._scene=N,z._basePostProcess=k,z._ratio=F,z._floatTextureType=N.getEngine().getCaps().textureFloatRender?ce.a.TEXTURETYPE_FLOAT:ce.a.TEXTURETYPE_HALF_FLOAT,N.postProcessRenderPipelineManager.addPipeline(z),z._buildPipeline(),z}return Object(Z.d)(t,D),Object.defineProperty(t.prototype,"exposure",{get:function(){return this._fixedExposure},set:function(D){this._fixedExposure=D,this._currentExposure=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hdrAutoExposure",{get:function(){return this._hdrAutoExposure},set:function(D){if(this._hdrAutoExposure=D,this.hdrPostProcess){var w=["#define HDR"];D&&w.push("#define AUTO_EXPOSURE"),this.hdrPostProcess.updateEffect(w.join("\n"))}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"motionStrength",{get:function(){return this._motionStrength},set:function(D){this._motionStrength=D,this._isObjectBasedMotionBlur&&this.motionBlurPostProcess&&(this.motionBlurPostProcess.motionStrength=D)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"objectBasedMotionBlur",{get:function(){return this._isObjectBasedMotionBlur},set:function(D){var w=this._isObjectBasedMotionBlur!==D;this._isObjectBasedMotionBlur=D,w&&this._buildPipeline()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"BloomEnabled",{get:function(){return this._bloomEnabled},set:function(D){this._bloomEnabled!==D&&(this._bloomEnabled=D,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"DepthOfFieldEnabled",{get:function(){return this._depthOfFieldEnabled},set:function(D){this._depthOfFieldEnabled!==D&&(this._depthOfFieldEnabled=D,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"LensFlareEnabled",{get:function(){return this._lensFlareEnabled},set:function(D){this._lensFlareEnabled!==D&&(this._lensFlareEnabled=D,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"HDREnabled",{get:function(){return this._hdrEnabled},set:function(D){this._hdrEnabled!==D&&(this._hdrEnabled=D,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"VLSEnabled",{get:function(){return this._vlsEnabled},set:function(D){if(this._vlsEnabled!==D){if(D&&!this._scene.enableGeometryBufferRenderer())return void oe.a.Warn("Geometry renderer is not supported, cannot create volumetric lights in Standard Rendering Pipeline");this._vlsEnabled=D,this._buildPipeline()}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"MotionBlurEnabled",{get:function(){return this._motionBlurEnabled},set:function(D){this._motionBlurEnabled!==D&&(this._motionBlurEnabled=D,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fxaaEnabled",{get:function(){return this._fxaaEnabled},set:function(D){this._fxaaEnabled!==D&&(this._fxaaEnabled=D,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"screenSpaceReflectionsEnabled",{get:function(){return this._screenSpaceReflectionsEnabled},set:function(D){this._screenSpaceReflectionsEnabled!==D&&(this._screenSpaceReflectionsEnabled=D,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"volumetricLightStepsCount",{get:function(){return this._volumetricLightStepsCount},set:function(D){this.volumetricLightPostProcess&&this.volumetricLightPostProcess.updateEffect("#define VLS\n#define NB_STEPS "+D.toFixed(1)),this._volumetricLightStepsCount=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"motionBlurSamples",{get:function(){return this._motionBlurSamples},set:function(D){this.motionBlurPostProcess&&(this._isObjectBasedMotionBlur?this.motionBlurPostProcess.motionBlurSamples=D:this.motionBlurPostProcess.updateEffect("#define MOTION_BLUR\n#define MAX_MOTION_SAMPLES "+D.toFixed(1))),this._motionBlurSamples=D},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"samples",{get:function(){return this._samples},set:function(D){this._samples!==D&&(this._samples=D,this._buildPipeline())},enumerable:!0,configurable:!0}),t.prototype._buildPipeline=function(){var D=this,w=this._ratio,N=this._scene;this._disposePostProcesses(),null!==this._cameras&&(this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._cameras),this._cameras=this._camerasToBeAttached.slice()),this._reset(),this._screenSpaceReflectionsEnabled&&(this.screenSpaceReflectionPostProcess=new kp("HDRPass",N,w,null,Jt.a.BILINEAR_SAMPLINGMODE,N.getEngine(),!1,this._floatTextureType),this.screenSpaceReflectionPostProcess.onApplyObservable.add((function(){D._currentDepthOfFieldSource=D.screenSpaceReflectionPostProcess})),this.addEffect(new up(N.getEngine(),"HDRScreenSpaceReflections",(function(){return D.screenSpaceReflectionPostProcess}),!0))),this._basePostProcess?this.originalPostProcess=this._basePostProcess:this.originalPostProcess=new fi("HDRPass","standard",[],[],w,null,Jt.a.BILINEAR_SAMPLINGMODE,N.getEngine(),!1,"#define PASS_POST_PROCESS",this._floatTextureType),this.originalPostProcess.autoClear=!this.screenSpaceReflectionPostProcess,this.originalPostProcess.onApplyObservable.add((function(){D._currentDepthOfFieldSource=D.originalPostProcess})),this.addEffect(new up(N.getEngine(),"HDRPassPostProcess",(function(){return D.originalPostProcess}),!0)),this._bloomEnabled&&(this._createDownSampleX4PostProcess(N,w/4),this._createBrightPassPostProcess(N,w/4),this._createBlurPostProcesses(N,w/4,1),this._createTextureAdderPostProcess(N,w),this.textureAdderFinalPostProcess=new fi("HDRDepthOfFieldSource","standard",[],[],w,null,Jt.a.BILINEAR_SAMPLINGMODE,N.getEngine(),!1,"#define PASS_POST_PROCESS",ce.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new up(N.getEngine(),"HDRBaseDepthOfFieldSource",(function(){return D.textureAdderFinalPostProcess}),!0))),this._vlsEnabled&&(this._createVolumetricLightPostProcess(N,w),this.volumetricLightFinalPostProcess=new fi("HDRVLSFinal","standard",[],[],w,null,Jt.a.BILINEAR_SAMPLINGMODE,N.getEngine(),!1,"#define PASS_POST_PROCESS",ce.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new up(N.getEngine(),"HDRVLSFinal",(function(){return D.volumetricLightFinalPostProcess}),!0))),this._lensFlareEnabled&&(this._createLensFlarePostProcess(N,w),this.lensFlareFinalPostProcess=new fi("HDRPostLensFlareDepthOfFieldSource","standard",[],[],w,null,Jt.a.BILINEAR_SAMPLINGMODE,N.getEngine(),!1,"#define PASS_POST_PROCESS",ce.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new up(N.getEngine(),"HDRPostLensFlareDepthOfFieldSource",(function(){return D.lensFlareFinalPostProcess}),!0))),this._hdrEnabled&&(this._createLuminancePostProcesses(N,this._floatTextureType),this._createHdrPostProcess(N,w),this.hdrFinalPostProcess=new fi("HDRPostHDReDepthOfFieldSource","standard",[],[],w,null,Jt.a.BILINEAR_SAMPLINGMODE,N.getEngine(),!1,"#define PASS_POST_PROCESS",ce.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new up(N.getEngine(),"HDRPostHDReDepthOfFieldSource",(function(){return D.hdrFinalPostProcess}),!0))),this._depthOfFieldEnabled&&(this._createBlurPostProcesses(N,w/2,3,"depthOfFieldBlurWidth"),this._createDepthOfFieldPostProcess(N,w)),this._motionBlurEnabled&&this._createMotionBlurPostProcess(N,w),this._fxaaEnabled&&(this.fxaaPostProcess=new Sp("fxaa",1,null,Jt.a.BILINEAR_SAMPLINGMODE,N.getEngine(),!1,ce.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new up(N.getEngine(),"HDRFxaa",(function(){return D.fxaaPostProcess}),!0))),null!==this._cameras&&this._scene.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(this._name,this._cameras),!this._enableMSAAOnFirstPostProcess(this._samples)&&this._samples>1&&oe.a.Warn("MSAA failed to enable, MSAA is only supported in browsers that support webGL >= 2.0")},t.prototype._createDownSampleX4PostProcess=function(D,w){var N=this,F=new Array(32);this.downSampleX4PostProcess=new fi("HDRDownSampleX4","standard",["dsOffsets"],[],w,null,Jt.a.BILINEAR_SAMPLINGMODE,D.getEngine(),!1,"#define DOWN_SAMPLE_X4",this._floatTextureType),this.downSampleX4PostProcess.onApply=function(D){for(var w=0,k=N.downSampleX4PostProcess.width,j=N.downSampleX4PostProcess.height,z=-2;z<2;z++)for(var G=-2;G<2;G++)F[w]=(z+.5)*(1/k),F[w+1]=(G+.5)*(1/j),w+=2;D.setArray2("dsOffsets",F)},this.addEffect(new up(D.getEngine(),"HDRDownSampleX4",(function(){return N.downSampleX4PostProcess}),!0))},t.prototype._createBrightPassPostProcess=function(D,w){var N=this,F=new Array(8);this.brightPassPostProcess=new fi("HDRBrightPass","standard",["dsOffsets","brightThreshold"],[],w,null,Jt.a.BILINEAR_SAMPLINGMODE,D.getEngine(),!1,"#define BRIGHT_PASS",this._floatTextureType),this.brightPassPostProcess.onApply=function(D){var w=1/N.brightPassPostProcess.width,k=1/N.brightPassPostProcess.height;F[0]=-.5*w,F[1]=.5*k,F[2]=.5*w,F[3]=.5*k,F[4]=-.5*w,F[5]=-.5*k,F[6]=.5*w,F[7]=-.5*k,D.setArray2("dsOffsets",F),D.setFloat("brightThreshold",N.brightThreshold)},this.addEffect(new up(D.getEngine(),"HDRBrightPass",(function(){return N.brightPassPostProcess}),!0))},t.prototype._createBlurPostProcesses=function(D,w,N,F){var k=this;void 0===F&&(F="blurWidth");var j=D.getEngine(),G=new Fo("HDRBlurH_"+N,new z.d(1,0),this[F],w,null,Jt.a.BILINEAR_SAMPLINGMODE,D.getEngine(),!1,this._floatTextureType),H=new Fo("HDRBlurV_"+N,new z.d(0,1),this[F],w,null,Jt.a.BILINEAR_SAMPLINGMODE,D.getEngine(),!1,this._floatTextureType);G.onActivateObservable.add((function(){var D=G.width/j.getRenderWidth();G.kernel=k[F]*D})),H.onActivateObservable.add((function(){var D=H.height/j.getRenderHeight();H.kernel=k.horizontalBlur?64*D:k[F]*D})),this.addEffect(new up(D.getEngine(),"HDRBlurH"+N,(function(){return G}),!0)),this.addEffect(new up(D.getEngine(),"HDRBlurV"+N,(function(){return H}),!0)),this.blurHPostProcesses.push(G),this.blurVPostProcesses.push(H)},t.prototype._createTextureAdderPostProcess=function(D,w){var N=this;this.textureAdderPostProcess=new fi("HDRTextureAdder","standard",["exposure"],["otherSampler","lensSampler"],w,null,Jt.a.BILINEAR_SAMPLINGMODE,D.getEngine(),!1,"#define TEXTURE_ADDER",this._floatTextureType),this.textureAdderPostProcess.onApply=function(D){D.setTextureFromPostProcess("otherSampler",N._vlsEnabled?N._currentDepthOfFieldSource:N.originalPostProcess),D.setTexture("lensSampler",N.lensTexture),D.setFloat("exposure",N._currentExposure),N._currentDepthOfFieldSource=N.textureAdderFinalPostProcess},this.addEffect(new up(D.getEngine(),"HDRTextureAdder",(function(){return N.textureAdderPostProcess}),!0))},t.prototype._createVolumetricLightPostProcess=function(D,w){var N=this,F=D.enableGeometryBufferRenderer();F.enablePosition=!0;var k=F.getGBuffer();this.volumetricLightPostProcess=new fi("HDRVLS","standard",["shadowViewProjection","cameraPosition","sunDirection","sunColor","scatteringCoefficient","scatteringPower","depthValues"],["shadowMapSampler","positionSampler"],w/8,null,Jt.a.BILINEAR_SAMPLINGMODE,D.getEngine(),!1,"#define VLS\n#define NB_STEPS "+this._volumetricLightStepsCount.toFixed(1));var j=z.d.Zero();this.volumetricLightPostProcess.onApply=function(D){if(N.sourceLight&&N.sourceLight.getShadowGenerator()&&N._scene.activeCamera){var w=N.sourceLight.getShadowGenerator();D.setTexture("shadowMapSampler",w.getShadowMap()),D.setTexture("positionSampler",k.textures[2]),D.setColor3("sunColor",N.sourceLight.diffuse),D.setVector3("sunDirection",N.sourceLight.getShadowDirection()),D.setVector3("cameraPosition",N._scene.activeCamera.globalPosition),D.setMatrix("shadowViewProjection",w.getTransformMatrix()),D.setFloat("scatteringCoefficient",N.volumetricLightCoefficient),D.setFloat("scatteringPower",N.volumetricLightPower),j.x=N.sourceLight.getDepthMinZ(N._scene.activeCamera),j.y=N.sourceLight.getDepthMaxZ(N._scene.activeCamera),D.setVector2("depthValues",j)}},this.addEffect(new up(D.getEngine(),"HDRVLS",(function(){return N.volumetricLightPostProcess}),!0)),this._createBlurPostProcesses(D,w/4,0,"volumetricLightBlurScale"),this.volumetricLightMergePostProces=new fi("HDRVLSMerge","standard",[],["originalSampler"],w,null,Jt.a.BILINEAR_SAMPLINGMODE,D.getEngine(),!1,"#define VLSMERGE"),this.volumetricLightMergePostProces.onApply=function(D){D.setTextureFromPostProcess("originalSampler",N._bloomEnabled?N.textureAdderFinalPostProcess:N.originalPostProcess),N._currentDepthOfFieldSource=N.volumetricLightFinalPostProcess},this.addEffect(new up(D.getEngine(),"HDRVLSMerge",(function(){return N.volumetricLightMergePostProces}),!0))},t.prototype._createLuminancePostProcesses=function(D,w){var N=this,F=Math.pow(3,t.LuminanceSteps);this.luminancePostProcess=new fi("HDRLuminance","standard",["lumOffsets"],[],{width:F,height:F},null,Jt.a.BILINEAR_SAMPLINGMODE,D.getEngine(),!1,"#define LUMINANCE",w);var k=[];this.luminancePostProcess.onApply=function(D){var w=1/N.luminancePostProcess.width,F=1/N.luminancePostProcess.height;k[0]=-.5*w,k[1]=.5*F,k[2]=.5*w,k[3]=.5*F,k[4]=-.5*w,k[5]=-.5*F,k[6]=.5*w,k[7]=-.5*F,D.setArray2("lumOffsets",k)},this.addEffect(new up(D.getEngine(),"HDRLuminance",(function(){return N.luminancePostProcess}),!0));for(var j=t.LuminanceSteps-1;j>=0;j--){F=Math.pow(3,j);var G="#define LUMINANCE_DOWN_SAMPLE\n";0===j&&(G+="#define FINAL_DOWN_SAMPLER");var H=new fi("HDRLuminanceDownSample"+j,"standard",["dsOffsets","halfDestPixelSize"],[],{width:F,height:F},null,Jt.a.BILINEAR_SAMPLINGMODE,D.getEngine(),!1,G,w);this.luminanceDownSamplePostProcesses.push(H)}var X=this.luminancePostProcess;this.luminanceDownSamplePostProcesses.forEach((function(w,F){var k=new Array(18);w.onApply=function(D){if(X){for(var j=0,z=-1;z<2;z++)for(var G=-1;G<2;G++)k[j]=z/X.width,k[j+1]=G/X.height,j+=2;D.setArray2("dsOffsets",k),D.setFloat("halfDestPixelSize",.5/X.width),X=F===N.luminanceDownSamplePostProcesses.length-1?N.luminancePostProcess:w}},F===N.luminanceDownSamplePostProcesses.length-1&&(w.onAfterRender=function(){var w=D.getEngine().readPixels(0,0,1,1),F=new z.f(1/16581375,1/65025,1/255,1);N._hdrCurrentLuminance=(w[0]*F.x+w[1]*F.y+w[2]*F.z+w[3]*F.w)/100}),N.addEffect(new up(D.getEngine(),"HDRLuminanceDownSample"+F,(function(){return w}),!0))}))},t.prototype._createHdrPostProcess=function(D,w){var N=this,F=["#define HDR"];this._hdrAutoExposure&&F.push("#define AUTO_EXPOSURE"),this.hdrPostProcess=new fi("HDR","standard",["averageLuminance"],["textureAdderSampler"],w,null,Jt.a.BILINEAR_SAMPLINGMODE,D.getEngine(),!1,F.join("\n"),ce.a.TEXTURETYPE_UNSIGNED_INT);var k=1,j=0,z=0;this.hdrPostProcess.onApply=function(w){if(w.setTextureFromPostProcess("textureAdderSampler",N._currentDepthOfFieldSource),j+=D.getEngine().getDeltaTime(),k<0)k=N._hdrCurrentLuminance;else{var F=(z-j)/1e3;N._hdrCurrentLuminance<k+N.hdrDecreaseRate*F?k+=N.hdrDecreaseRate*F:N._hdrCurrentLuminance>k-N.hdrIncreaseRate*F?k-=N.hdrIncreaseRate*F:k=N._hdrCurrentLuminance}N.hdrAutoExposure?N._currentExposure=N._fixedExposure/k:(k=De.a.Clamp(k,N.hdrMinimumLuminance,1e20),w.setFloat("averageLuminance",k)),z=j,N._currentDepthOfFieldSource=N.hdrFinalPostProcess},this.addEffect(new up(D.getEngine(),"HDR",(function(){return N.hdrPostProcess}),!0))},t.prototype._createLensFlarePostProcess=function(D,w){var N=this;this.lensFlarePostProcess=new fi("HDRLensFlare","standard",["strength","ghostDispersal","haloWidth","resolution","distortionStrength"],["lensColorSampler"],w/2,null,Jt.a.BILINEAR_SAMPLINGMODE,D.getEngine(),!1,"#define LENS_FLARE",ce.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new up(D.getEngine(),"HDRLensFlare",(function(){return N.lensFlarePostProcess}),!0)),this._createBlurPostProcesses(D,w/4,2,"lensFlareBlurWidth"),this.lensFlareComposePostProcess=new fi("HDRLensFlareCompose","standard",["lensStarMatrix"],["otherSampler","lensDirtSampler","lensStarSampler"],w,null,Jt.a.BILINEAR_SAMPLINGMODE,D.getEngine(),!1,"#define LENS_FLARE_COMPOSE",ce.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new up(D.getEngine(),"HDRLensFlareCompose",(function(){return N.lensFlareComposePostProcess}),!0));var F=new z.d(0,0);this.lensFlarePostProcess.onApply=function(D){D.setTextureFromPostProcess("textureSampler",N._bloomEnabled?N.blurHPostProcesses[0]:N.originalPostProcess),D.setTexture("lensColorSampler",N.lensColorTexture),D.setFloat("strength",N.lensFlareStrength),D.setFloat("ghostDispersal",N.lensFlareGhostDispersal),D.setFloat("haloWidth",N.lensFlareHaloWidth),F.x=N.lensFlarePostProcess.width,F.y=N.lensFlarePostProcess.height,D.setVector2("resolution",F),D.setFloat("distortionStrength",N.lensFlareDistortionStrength)};var k=z.a.FromValues(2,0,-1,0,0,2,-1,0,0,0,1,0,0,0,0,1),j=z.a.FromValues(.5,0,.5,0,0,.5,.5,0,0,0,1,0,0,0,0,1);this.lensFlareComposePostProcess.onApply=function(D){if(N._scene.activeCamera){D.setTextureFromPostProcess("otherSampler",N.lensFlarePostProcess),D.setTexture("lensDirtSampler",N.lensFlareDirtTexture),D.setTexture("lensStarSampler",N.lensStarTexture);var w=N._scene.activeCamera.getViewMatrix().getRow(0),F=N._scene.activeCamera.getViewMatrix().getRow(2),G=z.e.Dot(w.toVector3(),new z.e(1,0,0))+z.e.Dot(F.toVector3(),new z.e(0,0,1));G*=4;var H=z.a.FromValues(.5*Math.cos(G),-Math.sin(G),0,0,Math.sin(G),.5*Math.cos(G),0,0,0,0,1,0,0,0,0,1),X=j.multiply(H).multiply(k);D.setMatrix("lensStarMatrix",X),N._currentDepthOfFieldSource=N.lensFlareFinalPostProcess}}},t.prototype._createDepthOfFieldPostProcess=function(D,w){var N=this;this.depthOfFieldPostProcess=new fi("HDRDepthOfField","standard",["distance"],["otherSampler","depthSampler"],w,null,Jt.a.BILINEAR_SAMPLINGMODE,D.getEngine(),!1,"#define DEPTH_OF_FIELD",ce.a.TEXTURETYPE_UNSIGNED_INT),this.depthOfFieldPostProcess.onApply=function(D){D.setTextureFromPostProcess("otherSampler",N._currentDepthOfFieldSource),D.setTexture("depthSampler",N._getDepthTexture()),D.setFloat("distance",N.depthOfFieldDistance)},this.addEffect(new up(D.getEngine(),"HDRDepthOfField",(function(){return N.depthOfFieldPostProcess}),!0))},t.prototype._createMotionBlurPostProcess=function(D,w){var N=this;if(this._isObjectBasedMotionBlur){var F=new Cp("HDRMotionBlur",D,w,null,Jt.a.BILINEAR_SAMPLINGMODE,D.getEngine(),!1,ce.a.TEXTURETYPE_UNSIGNED_INT);F.motionStrength=this.motionStrength,F.motionBlurSamples=this.motionBlurSamples,this.motionBlurPostProcess=F}else{this.motionBlurPostProcess=new fi("HDRMotionBlur","standard",["inverseViewProjection","prevViewProjection","screenSize","motionScale","motionStrength"],["depthSampler"],w,null,Jt.a.BILINEAR_SAMPLINGMODE,D.getEngine(),!1,"#define MOTION_BLUR\n#define MAX_MOTION_SAMPLES "+this.motionBlurSamples.toFixed(1),ce.a.TEXTURETYPE_UNSIGNED_INT);var k=0,j=z.a.Identity(),G=z.a.Identity(),H=z.a.Identity(),X=z.d.Zero();this.motionBlurPostProcess.onApply=function(w){(H=D.getProjectionMatrix().multiply(D.getViewMatrix())).invertToRef(G),w.setMatrix("inverseViewProjection",G),w.setMatrix("prevViewProjection",j),j=H,X.x=N.motionBlurPostProcess.width,X.y=N.motionBlurPostProcess.height,w.setVector2("screenSize",X),k=D.getEngine().getFps()/60,w.setFloat("motionScale",k),w.setFloat("motionStrength",N.motionStrength),w.setTexture("depthSampler",N._getDepthTexture())}}this.addEffect(new up(D.getEngine(),"HDRMotionBlur",(function(){return N.motionBlurPostProcess}),!0))},t.prototype._getDepthTexture=function(){return this._scene.getEngine().getCaps().drawBuffersExtension?this._scene.enableGeometryBufferRenderer().getGBuffer().textures[0]:this._scene.enableDepthRenderer().getDepthMap()},t.prototype._disposePostProcesses=function(){for(var D=0;D<this._cameras.length;D++){var w=this._cameras[D];this.originalPostProcess&&this.originalPostProcess.dispose(w),this.screenSpaceReflectionPostProcess&&this.screenSpaceReflectionPostProcess.dispose(w),this.downSampleX4PostProcess&&this.downSampleX4PostProcess.dispose(w),this.brightPassPostProcess&&this.brightPassPostProcess.dispose(w),this.textureAdderPostProcess&&this.textureAdderPostProcess.dispose(w),this.volumetricLightPostProcess&&this.volumetricLightPostProcess.dispose(w),this.volumetricLightSmoothXPostProcess&&this.volumetricLightSmoothXPostProcess.dispose(w),this.volumetricLightSmoothYPostProcess&&this.volumetricLightSmoothYPostProcess.dispose(w),this.volumetricLightMergePostProces&&this.volumetricLightMergePostProces.dispose(w),this.volumetricLightFinalPostProcess&&this.volumetricLightFinalPostProcess.dispose(w),this.lensFlarePostProcess&&this.lensFlarePostProcess.dispose(w),this.lensFlareComposePostProcess&&this.lensFlareComposePostProcess.dispose(w);for(var N=0;N<this.luminanceDownSamplePostProcesses.length;N++)this.luminanceDownSamplePostProcesses[N].dispose(w);for(this.luminancePostProcess&&this.luminancePostProcess.dispose(w),this.hdrPostProcess&&this.hdrPostProcess.dispose(w),this.hdrFinalPostProcess&&this.hdrFinalPostProcess.dispose(w),this.depthOfFieldPostProcess&&this.depthOfFieldPostProcess.dispose(w),this.motionBlurPostProcess&&this.motionBlurPostProcess.dispose(w),this.fxaaPostProcess&&this.fxaaPostProcess.dispose(w),N=0;N<this.blurHPostProcesses.length;N++)this.blurHPostProcesses[N].dispose(w);for(N=0;N<this.blurVPostProcesses.length;N++)this.blurVPostProcesses[N].dispose(w)}this.originalPostProcess=null,this.downSampleX4PostProcess=null,this.brightPassPostProcess=null,this.textureAdderPostProcess=null,this.textureAdderFinalPostProcess=null,this.volumetricLightPostProcess=null,this.volumetricLightSmoothXPostProcess=null,this.volumetricLightSmoothYPostProcess=null,this.volumetricLightMergePostProces=null,this.volumetricLightFinalPostProcess=null,this.lensFlarePostProcess=null,this.lensFlareComposePostProcess=null,this.luminancePostProcess=null,this.hdrPostProcess=null,this.hdrFinalPostProcess=null,this.depthOfFieldPostProcess=null,this.motionBlurPostProcess=null,this.fxaaPostProcess=null,this.screenSpaceReflectionPostProcess=null,this.luminanceDownSamplePostProcesses=[],this.blurHPostProcesses=[],this.blurVPostProcesses=[]},t.prototype.dispose=function(){this._disposePostProcesses(),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._cameras),D.prototype.dispose.call(this)},t.prototype.serialize=function(){var D=Ie.a.Serialize(this);return this.sourceLight&&(D.sourceLightId=this.sourceLight.id),this.screenSpaceReflectionPostProcess&&(D.screenSpaceReflectionPostProcess=Ie.a.Serialize(this.screenSpaceReflectionPostProcess)),D.customType="StandardRenderingPipeline",D},t.Parse=function(D,w,N){var F=Ie.a.Parse((function(){return new t(D._name,w,D._ratio)}),D,w,N);return D.sourceLightId&&(F.sourceLight=w.getLightByID(D.sourceLightId)),D.screenSpaceReflectionPostProcess&&Ie.a.Parse((function(){return F.screenSpaceReflectionPostProcess}),D.screenSpaceReflectionPostProcess,w,N),F},t.LuminanceSteps=6,Object(Z.c)([Object(Ie.c)()],t.prototype,"brightThreshold",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"blurWidth",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"horizontalBlur",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"exposure",null),Object(Z.c)([Object(Ie.m)("lensTexture")],t.prototype,"lensTexture",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"volumetricLightCoefficient",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"volumetricLightPower",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"volumetricLightBlurScale",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"hdrMinimumLuminance",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"hdrDecreaseRate",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"hdrIncreaseRate",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"hdrAutoExposure",null),Object(Z.c)([Object(Ie.m)("lensColorTexture")],t.prototype,"lensColorTexture",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"lensFlareStrength",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"lensFlareGhostDispersal",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"lensFlareHaloWidth",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"lensFlareDistortionStrength",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"lensFlareBlurWidth",void 0),Object(Z.c)([Object(Ie.m)("lensStarTexture")],t.prototype,"lensStarTexture",void 0),Object(Z.c)([Object(Ie.m)("lensFlareDirtTexture")],t.prototype,"lensFlareDirtTexture",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"depthOfFieldDistance",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"depthOfFieldBlurWidth",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"motionStrength",null),Object(Z.c)([Object(Ie.c)()],t.prototype,"objectBasedMotionBlur",null),Object(Z.c)([Object(Ie.c)()],t.prototype,"_ratio",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"BloomEnabled",null),Object(Z.c)([Object(Ie.c)()],t.prototype,"DepthOfFieldEnabled",null),Object(Z.c)([Object(Ie.c)()],t.prototype,"LensFlareEnabled",null),Object(Z.c)([Object(Ie.c)()],t.prototype,"HDREnabled",null),Object(Z.c)([Object(Ie.c)()],t.prototype,"VLSEnabled",null),Object(Z.c)([Object(Ie.c)()],t.prototype,"MotionBlurEnabled",null),Object(Z.c)([Object(Ie.c)()],t.prototype,"fxaaEnabled",null),Object(Z.c)([Object(Ie.c)()],t.prototype,"screenSpaceReflectionsEnabled",null),Object(Z.c)([Object(Ie.c)()],t.prototype,"volumetricLightStepsCount",null),Object(Z.c)([Object(Ie.c)()],t.prototype,"motionBlurSamples",null),Object(Z.c)([Object(Ie.c)()],t.prototype,"samples",null),t}(Dp);H.a.RegisteredTypes["BABYLON.StandardRenderingPipeline"]=Vp,li.a.ShadersStore.tonemapPixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform float _ExposureAdjustment;\n#if defined(HABLE_TONEMAPPING)\nconst float A=0.15;\nconst float B=0.50;\nconst float C=0.10;\nconst float D=0.20;\nconst float E=0.02;\nconst float F=0.30;\nconst float W=11.2;\n#endif\nfloat Luminance(vec3 c)\n{\nreturn dot(c,vec3(0.22,0.707,0.071));\n}\nvoid main(void)\n{\nvec3 colour=texture2D(textureSampler,vUV).rgb;\n#if defined(REINHARD_TONEMAPPING)\nfloat lum=Luminance(colour.rgb);\nfloat lumTm=lum*_ExposureAdjustment;\nfloat scale=lumTm/(1.0+lumTm);\ncolour*=scale/lum;\n#elif defined(HABLE_TONEMAPPING)\ncolour*=_ExposureAdjustment;\nconst float ExposureBias=2.0;\nvec3 x=ExposureBias*colour;\nvec3 curr=((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;\nx=vec3(W,W,W);\nvec3 whiteScale=1.0/(((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F);\ncolour=curr*whiteScale;\n#elif defined(OPTIMIZED_HEJIDAWSON_TONEMAPPING)\ncolour*=_ExposureAdjustment;\nvec3 X=max(vec3(0.0,0.0,0.0),colour-0.004);\nvec3 retColor=(X*(6.2*X+0.5))/(X*(6.2*X+1.7)+0.06);\ncolour=retColor*retColor;\n#elif defined(PHOTOGRAPHIC_TONEMAPPING)\ncolour=vec3(1.0,1.0,1.0)-exp2(-_ExposureAdjustment*colour);\n#endif\ngl_FragColor=vec4(colour.rgb,1.0);\n}",function(D){D[D.Hable=0]="Hable",D[D.Reinhard=1]="Reinhard",D[D.HejiDawson=2]="HejiDawson",D[D.Photographic=3]="Photographic"}(Up||(Up={}));var jp=function(D){function t(w,N,F,k,j,z,G){void 0===j&&(j=ce.a.TEXTURE_BILINEAR_SAMPLINGMODE),void 0===G&&(G=ce.a.TEXTURETYPE_UNSIGNED_INT);var H=D.call(this,w,"tonemap",["_ExposureAdjustment"],null,1,k,j,z,!0,null,G)||this;H._operator=N,H.exposureAdjustment=F;var X="#define ";return H._operator===Up.Hable?X+="HABLE_TONEMAPPING":H._operator===Up.Reinhard?X+="REINHARD_TONEMAPPING":H._operator===Up.HejiDawson?X+="OPTIMIZED_HEJIDAWSON_TONEMAPPING":H._operator===Up.Photographic&&(X+="PHOTOGRAPHIC_TONEMAPPING"),H.updateEffect(X),H.onApply=function(D){D.setFloat("_ExposureAdjustment",H.exposureAdjustment)},H}return Object(Z.d)(t,D),t}(fi);li.a.ShadersStore.volumetricLightScatteringPixelShader="uniform sampler2D textureSampler;\nuniform sampler2D lightScatteringSampler;\nuniform float decay;\nuniform float exposure;\nuniform float weight;\nuniform float density;\nuniform vec2 meshPositionOnScreen;\nvarying vec2 vUV;\nvoid main(void) {\nvec2 tc=vUV;\nvec2 deltaTexCoord=(tc-meshPositionOnScreen.xy);\ndeltaTexCoord*=1.0/float(NUM_SAMPLES)*density;\nfloat illuminationDecay=1.0;\nvec4 color=texture2D(lightScatteringSampler,tc)*0.4;\nfor(int i=0; i<NUM_SAMPLES; i++) {\ntc-=deltaTexCoord;\nvec4 dataSample=texture2D(lightScatteringSampler,tc)*0.4;\ndataSample*=illuminationDecay*weight;\ncolor+=dataSample;\nilluminationDecay*=decay;\n}\nvec4 realColor=texture2D(textureSampler,vUV);\ngl_FragColor=((vec4((vec3(color.r,color.g,color.b)*exposure),1))+(realColor*(1.5-0.4)));\n}\n",li.a.ShadersStore.volumetricLightScatteringPassVertexShader="\nattribute vec3 position;\n#include<bonesDeclaration>\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\nuniform vec2 depthValues;\n#if defined(ALPHATEST) || defined(NEED_UV)\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\nvoid main(void)\n{\nvec3 positionUpdated=position;\n#if (defined(ALPHATEST) || defined(NEED_UV)) && defined(UV1)\nvec2 uvUpdated=uv;\n#endif\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(positionUpdated,1.0);\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n}\n",li.a.ShadersStore.volumetricLightScatteringPassPixelShader="#if defined(ALPHATEST) || defined(NEED_UV)\nvarying vec2 vUV;\n#endif\n#if defined(ALPHATEST)\nuniform sampler2D diffuseSampler;\n#endif\nvoid main(void)\n{\n#if defined(ALPHATEST)\nvec4 diffuseColor=texture2D(diffuseSampler,vUV);\nif (diffuseColor.a<0.4)\ndiscard;\n#endif\ngl_FragColor=vec4(0.0,0.0,0.0,1.0);\n}\n";var zp=function(D){function t(w,N,F,k,j,G,H,X,q){void 0===j&&(j=100),void 0===G&&(G=Jt.a.BILINEAR_SAMPLINGMODE);var Z=D.call(this,w,"volumetricLightScattering",["decay","exposure","weight","meshPositionOnScreen","density"],["lightScatteringSampler"],N.postProcessRatio||N,F,G,H,X,"#define NUM_SAMPLES "+j)||this;return Z._screenCoordinates=z.d.Zero(),Z.customMeshPosition=z.e.Zero(),Z.useCustomMeshPosition=!1,Z.invert=!0,Z.excludedMeshes=new Array,Z.exposure=.3,Z.decay=.96815,Z.weight=.58767,Z.density=.926,H=(q=null===F?q:F.getScene()).getEngine(),Z._viewPort=new Bi.a(0,0,1,1).toGlobal(H.getRenderWidth(),H.getRenderHeight()),Z.mesh=null!==k?k:t.CreateDefaultMesh("VolumetricLightScatteringMesh",q),Z._createPass(q,N.passRatio||N),Z.onActivate=function(D){Z.isSupported||Z.dispose(D),Z.onActivate=null},Z.onApplyObservable.add((function(D){Z._updateMeshScreenCoordinates(q),D.setTexture("lightScatteringSampler",Z._volumetricLightScatteringRTT),D.setFloat("exposure",Z.exposure),D.setFloat("decay",Z.decay),D.setFloat("weight",Z.weight),D.setFloat("density",Z.density),D.setVector2("meshPositionOnScreen",Z._screenCoordinates)})),Z}return Object(Z.d)(t,D),Object.defineProperty(t.prototype,"useDiffuseColor",{get:function(){return oe.a.Warn("VolumetricLightScatteringPostProcess.useDiffuseColor is no longer used, use the mesh material directly instead"),!1},set:function(D){oe.a.Warn("VolumetricLightScatteringPostProcess.useDiffuseColor is no longer used, use the mesh material directly instead")},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"VolumetricLightScatteringPostProcess"},t.prototype._isReady=function(D,w){var N=D.getMesh();if(N===this.mesh&&N.material)return N.material.isReady(N);var F=[],k=[Zi.b.PositionKind],j=D.getMaterial();j&&(j.needAlphaTesting()&&F.push("#define ALPHATEST"),N.isVerticesDataPresent(Zi.b.UVKind)&&(k.push(Zi.b.UVKind),F.push("#define UV1")),N.isVerticesDataPresent(Zi.b.UV2Kind)&&(k.push(Zi.b.UV2Kind),F.push("#define UV2"))),N.useBones&&N.computeBonesUsingShaders?(k.push(Zi.b.MatricesIndicesKind),k.push(Zi.b.MatricesWeightsKind),F.push("#define NUM_BONE_INFLUENCERS "+N.numBoneInfluencers),F.push("#define BonesPerMesh "+(N.skeleton?N.skeleton.bones.length+1:0))):F.push("#define NUM_BONE_INFLUENCERS 0"),w&&(F.push("#define INSTANCES"),jo.a.PushAttributesForInstances(k));var z=F.join("\n");return this._cachedDefines!==z&&(this._cachedDefines=z,this._volumetricLightScatteringPass=N.getScene().getEngine().createEffect("volumetricLightScatteringPass",k,["world","mBones","viewProjection","diffuseMatrix"],["diffuseSampler"],z,void 0,void 0,void 0,{maxSimultaneousMorphTargets:N.numBoneInfluencers})),this._volumetricLightScatteringPass.isReady()},t.prototype.setCustomMeshPosition=function(D){this.customMeshPosition=D},t.prototype.getCustomMeshPosition=function(){return this.customMeshPosition},t.prototype.dispose=function(w){var N=w.getScene().customRenderTargets.indexOf(this._volumetricLightScatteringRTT);-1!==N&&w.getScene().customRenderTargets.splice(N,1),this._volumetricLightScatteringRTT.dispose(),D.prototype.dispose.call(this,w)},t.prototype.getPass=function(){return this._volumetricLightScatteringRTT},t.prototype._meshExcluded=function(D){return this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(D)},t.prototype._createPass=function(D,w){var N=this,F=D.getEngine();this._volumetricLightScatteringRTT=new Li("volumetricLightScatteringMap",{width:F.getRenderWidth()*w,height:F.getRenderHeight()*w},D,!1,!0,ce.a.TEXTURETYPE_UNSIGNED_INT),this._volumetricLightScatteringRTT.wrapU=Jt.a.CLAMP_ADDRESSMODE,this._volumetricLightScatteringRTT.wrapV=Jt.a.CLAMP_ADDRESSMODE,this._volumetricLightScatteringRTT.renderList=null,this._volumetricLightScatteringRTT.renderParticles=!1,this._volumetricLightScatteringRTT.ignoreCameraViewport=!0;var k=this.getCamera();k?k.customRenderTargets.push(this._volumetricLightScatteringRTT):D.customRenderTargets.push(this._volumetricLightScatteringRTT);var j,a=function(D){var w=D.getRenderingMesh();if(!N._meshExcluded(w)){w._internalAbstractMeshDataInfo._isActiveIntermediate=!1;var F=D.getMaterial();if(F){var k=w.getScene(),j=k.getEngine();j.setState(F.backFaceCulling);var z=w._getInstancesRenderList(D._id);if(!z.mustReturn){var G=j.getCaps().instancedArrays&&null!==z.visibleInstances[D._id];if(N._isReady(D,G)){var H=N._volumetricLightScatteringPass;if(w===N.mesh&&(H=D.effect?D.effect:F.getEffect()),j.enableEffect(H),w._bind(D,H,F.fillMode),w===N.mesh)F.bind(w.getWorldMatrix(),w);else{if(N._volumetricLightScatteringPass.setMatrix("viewProjection",k.getTransformMatrix()),F&&F.needAlphaTesting()){var X=F.getAlphaTestTexture();N._volumetricLightScatteringPass.setTexture("diffuseSampler",X),X&&N._volumetricLightScatteringPass.setMatrix("diffuseMatrix",X.getTextureMatrix())}w.useBones&&w.computeBonesUsingShaders&&w.skeleton&&N._volumetricLightScatteringPass.setMatrices("mBones",w.skeleton.getTransformMatrices(w))}w._processRendering(D,N._volumetricLightScatteringPass,Ps.a.TriangleFillMode,z,G,(function(D,w){return H.setMatrix("world",w)}))}}}}},z=new G.b(0,0,0,1);this._volumetricLightScatteringRTT.onBeforeRenderObservable.add((function(){j=D.clearColor,D.clearColor=z})),this._volumetricLightScatteringRTT.onAfterRenderObservable.add((function(){D.clearColor=j})),this._volumetricLightScatteringRTT.customRenderFunction=function(w,N,F,k){var j,z=D.getEngine();if(k.length){for(z.setColorWrite(!1),j=0;j<k.length;j++)a(k.data[j]);z.setColorWrite(!0)}for(j=0;j<w.length;j++)a(w.data[j]);for(j=0;j<N.length;j++)a(N.data[j]);if(F.length){for(j=0;j<F.length;j++){var G=F.data[j],H=G.getBoundingInfo();H&&D.activeCamera&&(G._alphaIndex=G.getMesh().alphaIndex,G._distanceToCamera=H.boundingSphere.centerWorld.subtract(D.activeCamera.position).length())}var X=F.data.slice(0,F.length);for(X.sort((function(D,w){return D._alphaIndex>w._alphaIndex?1:D._alphaIndex<w._alphaIndex?-1:D._distanceToCamera<w._distanceToCamera?1:D._distanceToCamera>w._distanceToCamera?-1:0})),z.setAlphaMode(ce.a.ALPHA_COMBINE),j=0;j<X.length;j++)a(X[j]);z.setAlphaMode(ce.a.ALPHA_DISABLE)}}},t.prototype._updateMeshScreenCoordinates=function(D){var w,N=D.getTransformMatrix();w=this.useCustomMeshPosition?this.customMeshPosition:this.attachedNode?this.attachedNode.position:this.mesh.parent?this.mesh.getAbsolutePosition():this.mesh.position;var F=z.e.Project(w,z.a.Identity(),N,this._viewPort);this._screenCoordinates.x=F.x/this._viewPort.width,this._screenCoordinates.y=F.y/this._viewPort.height,this.invert&&(this._screenCoordinates.y=1-this._screenCoordinates.y)},t.CreateDefaultMesh=function(D,w){var N=xt.a.CreatePlane(D,1,w);N.billboardMode=Wt.a.BILLBOARDMODE_ALL;var F=new Hi.a(D+"Material",w);return F.emissiveColor=new G.a(1,1,1),N.material=F,N},Object(Z.c)([Object(Ie.o)()],t.prototype,"customMeshPosition",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"useCustomMeshPosition",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"invert",void 0),Object(Z.c)([Object(Ie.k)()],t.prototype,"mesh",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"excludedMeshes",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"exposure",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"decay",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"weight",void 0),Object(Z.c)([Object(Ie.c)()],t.prototype,"density",void 0),t}(fi);N(148),N(149),Object.defineProperty(We.a.prototype,"forceShowBoundingBoxes",{get:function(){return this._forceShowBoundingBoxes||!1},set:function(D){this._forceShowBoundingBoxes=D,D&&this.getBoundingBoxRenderer()},enumerable:!0,configurable:!0}),We.a.prototype.getBoundingBoxRenderer=function(){return this._boundingBoxRenderer||(this._boundingBoxRenderer=new Gp(this)),this._boundingBoxRenderer},Object.defineProperty(Wt.a.prototype,"showBoundingBox",{get:function(){return this._showBoundingBox||!1},set:function(D){this._showBoundingBox=D,D&&this.getScene().getBoundingBoxRenderer()},enumerable:!0,configurable:!0});var Gp=function(){function e(D){this.name=Nt.a.NAME_BOUNDINGBOXRENDERER,this.frontColor=new G.a(1,1,1),this.backColor=new G.a(.1,.1,.1),this.showBackLines=!0,this.renderList=new ui.a(32),this._vertexBuffers={},this._fillIndexBuffer=null,this._fillIndexData=null,this.scene=D,D._addComponent(this)}return e.prototype.register=function(){this.scene._beforeEvaluateActiveMeshStage.registerStep(Nt.a.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER,this,this.reset),this.scene._activeMeshStage.registerStep(Nt.a.STEP_ACTIVEMESH_BOUNDINGBOXRENDERER,this,this._activeMesh),this.scene._evaluateSubMeshStage.registerStep(Nt.a.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER,this,this._evaluateSubMesh),this.scene._afterRenderingGroupDrawStage.registerStep(Nt.a.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER,this,this.render)},e.prototype._evaluateSubMesh=function(D,w){if(D.showSubMeshesBoundingBox){var N=w.getBoundingInfo();null!=N&&(N.boundingBox._tag=D.renderingGroupId,this.renderList.push(N.boundingBox))}},e.prototype._activeMesh=function(D,w){if(D.showBoundingBox||this.scene.forceShowBoundingBoxes){var N=D.getBoundingInfo();N.boundingBox._tag=w.renderingGroupId,this.renderList.push(N.boundingBox)}},e.prototype._prepareRessources=function(){if(!this._colorShader){this._colorShader=new Zc.a("colorShader",this.scene,"color",{attributes:[Zi.b.PositionKind],uniforms:["world","viewProjection","color"]}),this._colorShader.reservedDataStore={hidden:!0};var D=this.scene.getEngine(),w=qi.a.CreateBox({size:1});this._vertexBuffers[Zi.b.PositionKind]=new Zi.b(D,w.positions,Zi.b.PositionKind,!1),this._createIndexBuffer(),this._fillIndexData=w.indices}},e.prototype._createIndexBuffer=function(){var D=this.scene.getEngine();this._indexBuffer=D.createIndexBuffer([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,7,1,6,2,5,3,4])},e.prototype.rebuild=function(){var D=this._vertexBuffers[Zi.b.PositionKind];D&&D._rebuild(),this._createIndexBuffer()},e.prototype.reset=function(){this.renderList.reset()},e.prototype.render=function(D){if(0!==this.renderList.length&&(this._prepareRessources(),this._colorShader.isReady())){var w=this.scene.getEngine();w.setDepthWrite(!1),this._colorShader._preBind();for(var N=0;N<this.renderList.length;N++){var F=this.renderList.data[N];if(F._tag===D){var k=F.minimum,j=F.maximum.subtract(k),G=k.add(j.scale(.5)),H=z.a.Scaling(j.x,j.y,j.z).multiply(z.a.Translation(G.x,G.y,G.z)).multiply(F.getWorldMatrix());w.bindBuffers(this._vertexBuffers,this._indexBuffer,this._colorShader.getEffect()),this.showBackLines&&(w.setDepthFunctionToGreaterOrEqual(),this.scene.resetCachedMaterial(),this._colorShader.setColor4("color",this.backColor.toColor4()),this._colorShader.bind(H),w.drawElementsType(Ps.a.LineListDrawMode,0,24)),w.setDepthFunctionToLess(),this.scene.resetCachedMaterial(),this._colorShader.setColor4("color",this.frontColor.toColor4()),this._colorShader.bind(H),w.drawElementsType(Ps.a.LineListDrawMode,0,24)}}this._colorShader.unbind(),w.setDepthFunctionToLessOrEqual(),w.setDepthWrite(!0)}},e.prototype.renderOcclusionBoundingBox=function(D){if(this._prepareRessources(),this._colorShader.isReady()&&D._boundingInfo){var w=this.scene.getEngine();this._fillIndexBuffer||(this._fillIndexBuffer=w.createIndexBuffer(this._fillIndexData)),w.setDepthWrite(!1),w.setColorWrite(!1),this._colorShader._preBind();var N=D._boundingInfo.boundingBox,F=N.minimum,k=N.maximum.subtract(F),j=F.add(k.scale(.5)),G=z.a.Scaling(k.x,k.y,k.z).multiply(z.a.Translation(j.x,j.y,j.z)).multiply(N.getWorldMatrix());w.bindBuffers(this._vertexBuffers,this._fillIndexBuffer,this._colorShader.getEffect()),w.setDepthFunctionToLess(),this.scene.resetCachedMaterial(),this._colorShader.bind(G),w.drawElementsType(Ps.a.TriangleFillMode,0,36),this._colorShader.unbind(),w.setDepthFunctionToLessOrEqual(),w.setDepthWrite(!0),w.setColorWrite(!0)}},e.prototype.dispose=function(){if(this._colorShader){this.renderList.dispose(),this._colorShader.dispose();var D=this._vertexBuffers[Zi.b.PositionKind];D&&(D.dispose(),this._vertexBuffers[Zi.b.PositionKind]=null),this.scene.getEngine()._releaseBuffer(this._indexBuffer),this._fillIndexBuffer&&(this.scene.getEngine()._releaseBuffer(this._fillIndexBuffer),this._fillIndexBuffer=null)}},e}();We.a.prototype.enableDepthRenderer=function(D,w){if(void 0===w&&(w=!1),!(D=D||this.activeCamera))throw"No camera available to enable depth renderer";var N;return this._depthRenderer||(this._depthRenderer={}),this._depthRenderer[D.id]||(N=this.getEngine().getCaps().textureHalfFloatRender?ce.a.TEXTURETYPE_HALF_FLOAT:this.getEngine().getCaps().textureFloatRender?ce.a.TEXTURETYPE_FLOAT:ce.a.TEXTURETYPE_UNSIGNED_BYTE,this._depthRenderer[D.id]=new Gs(this,N,D,w)),this._depthRenderer[D.id]},We.a.prototype.disableDepthRenderer=function(D){(D=D||this.activeCamera)&&this._depthRenderer&&this._depthRenderer[D.id]&&(this._depthRenderer[D.id].dispose(),delete this._depthRenderer[D.id])};var Yp=function(){function e(D){this.name=Nt.a.NAME_DEPTHRENDERER,this.scene=D}return e.prototype.register=function(){this.scene._gatherRenderTargetsStage.registerStep(Nt.a.STEP_GATHERRENDERTARGETS_DEPTHRENDERER,this,this._gatherRenderTargets),this.scene._gatherActiveCameraRenderTargetsStage.registerStep(Nt.a.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER,this,this._gatherActiveCameraRenderTargets)},e.prototype.rebuild=function(){},e.prototype.dispose=function(){for(var D in this.scene._depthRenderer)this.scene._depthRenderer[D].dispose()},e.prototype._gatherRenderTargets=function(D){if(this.scene._depthRenderer)for(var w in this.scene._depthRenderer){var N=this.scene._depthRenderer[w];N.enabled&&!N.useOnlyInActiveCamera&&D.push(N.getDepthMap())}},e.prototype._gatherActiveCameraRenderTargets=function(D){if(this.scene._depthRenderer)for(var w in this.scene._depthRenderer){var N=this.scene._depthRenderer[w];N.enabled&&N.useOnlyInActiveCamera&&this.scene.activeCamera.id===w&&D.push(N.getDepthMap())}},e}();Gs._SceneComponentInitialization=function(D){var w=D._getComponent(Nt.a.NAME_DEPTHRENDERER);w||(w=new Yp(D),D._addComponent(w))},li.a.ShadersStore.linePixelShader="uniform vec4 color;\nvoid main(void) {\ngl_FragColor=color;\n}",li.a.ShadersStore.lineVertexShader="\nattribute vec3 position;\nattribute vec4 normal;\n\nuniform mat4 worldViewProjection;\nuniform float width;\nuniform float aspectRatio;\nvoid main(void) {\nvec4 viewPosition=worldViewProjection*vec4(position,1.0);\nvec4 viewPositionNext=worldViewProjection*vec4(normal.xyz,1.0);\nvec2 currentScreen=viewPosition.xy/viewPosition.w;\nvec2 nextScreen=viewPositionNext.xy/viewPositionNext.w;\ncurrentScreen.x*=aspectRatio;\nnextScreen.x*=aspectRatio;\nvec2 dir=normalize(nextScreen-currentScreen);\nvec2 normalDir=vec2(-dir.y,dir.x);\nnormalDir*=width/2.0;\nnormalDir.x/=aspectRatio;\nvec4 offset=vec4(normalDir*normal.w,0.0,0.0);\ngl_Position=viewPosition+offset;\n}",Wt.a.prototype.disableEdgesRendering=function(){return this._edgesRenderer&&(this._edgesRenderer.dispose(),this._edgesRenderer=null),this},Wt.a.prototype.enableEdgesRendering=function(D,w){return void 0===D&&(D=.95),void 0===w&&(w=!1),this.disableEdgesRendering(),this._edgesRenderer=new Hp(this,D,w),this},Object.defineProperty(Wt.a.prototype,"edgesRenderer",{get:function(){return this._edgesRenderer},enumerable:!0,configurable:!0}),Fh.b.prototype.enableEdgesRendering=function(D,w){return void 0===D&&(D=.95),void 0===w&&(w=!1),this.disableEdgesRendering(),this._edgesRenderer=new Wp(this,D,w),this},Fh.a.prototype.enableEdgesRendering=function(D,w){return void 0===D&&(D=.95),void 0===w&&(w=!1),Fh.b.prototype.enableEdgesRendering.apply(this,arguments),this};var Nd=function(){this.edges=new Array,this.edgesConnectedCount=0},Hp=function(){function e(D,w,N,F){var k=this;void 0===w&&(w=.95),void 0===N&&(N=!1),void 0===F&&(F=!0),this.edgesWidthScalerForOrthographic=1e3,this.edgesWidthScalerForPerspective=50,this._linesPositions=new Array,this._linesNormals=new Array,this._linesIndices=new Array,this._buffers={},this._checkVerticesInsteadOfIndices=!1,this.isEnabled=!0,this._source=D,this._checkVerticesInsteadOfIndices=N,this._epsilon=w,this._prepareRessources(),F&&this._generateEdgesLines(),this._meshRebuildObserver=this._source.onRebuildObservable.add((function(){k._rebuild()})),this._meshDisposeObserver=this._source.onDisposeObservable.add((function(){k.dispose()}))}return e.prototype._prepareRessources=function(){this._lineShader||(this._lineShader=new Zc.a("lineShader",this._source.getScene(),"line",{attributes:["position","normal"],uniforms:["worldViewProjection","color","width","aspectRatio"]}),this._lineShader.disableDepthWrite=!0,this._lineShader.backFaceCulling=!1)},e.prototype._rebuild=function(){var D=this._buffers[Zi.b.PositionKind];D&&D._rebuild(),(D=this._buffers[Zi.b.NormalKind])&&D._rebuild();var w=this._source.getScene().getEngine();this._ib=w.createIndexBuffer(this._linesIndices)},e.prototype.dispose=function(){this._source.onRebuildObservable.remove(this._meshRebuildObserver),this._source.onDisposeObservable.remove(this._meshDisposeObserver);var D=this._buffers[Zi.b.PositionKind];D&&(D.dispose(),this._buffers[Zi.b.PositionKind]=null),(D=this._buffers[Zi.b.NormalKind])&&(D.dispose(),this._buffers[Zi.b.NormalKind]=null),this._ib&&this._source.getScene().getEngine()._releaseBuffer(this._ib),this._lineShader.dispose()},e.prototype._processEdgeForAdjacencies=function(D,w,N,F,k){return D===N&&w===F||D===F&&w===N?0:D===F&&w===k||D===k&&w===F?1:D===k&&w===N||D===N&&w===k?2:-1},e.prototype._processEdgeForAdjacenciesWithVertices=function(D,w,N,F,k){return D.equalsWithEpsilon(N)&&w.equalsWithEpsilon(F)||D.equalsWithEpsilon(F)&&w.equalsWithEpsilon(N)?0:D.equalsWithEpsilon(F)&&w.equalsWithEpsilon(k)||D.equalsWithEpsilon(k)&&w.equalsWithEpsilon(F)?1:D.equalsWithEpsilon(k)&&w.equalsWithEpsilon(N)||D.equalsWithEpsilon(N)&&w.equalsWithEpsilon(k)?2:-1},e.prototype._checkEdge=function(D,w,N,F,k){(void 0===w||z.e.Dot(N[D],N[w])<this._epsilon)&&this.createLine(F,k,this._linesPositions.length/3)},e.prototype.createLine=function(D,w,N){this._linesPositions.push(D.x,D.y,D.z,D.x,D.y,D.z,w.x,w.y,w.z,w.x,w.y,w.z),this._linesNormals.push(w.x,w.y,w.z,-1,w.x,w.y,w.z,1,D.x,D.y,D.z,-1,D.x,D.y,D.z,1),this._linesIndices.push(N,N+1,N+2,N,N+2,N+3)},e.prototype._generateEdgesLines=function(){var D=this._source.getVerticesData(Zi.b.PositionKind),w=this._source.getIndices();if(w&&D){var N,F,k=new Array,j=new Array;for(N=0;N<w.length;N+=3){F=new Nd;var G=w[N],H=w[N+1],X=w[N+2];F.p0=new z.e(D[3*G],D[3*G+1],D[3*G+2]),F.p1=new z.e(D[3*H],D[3*H+1],D[3*H+2]),F.p2=new z.e(D[3*X],D[3*X+1],D[3*X+2]);var q=z.e.Cross(F.p1.subtract(F.p0),F.p2.subtract(F.p1));q.normalize(),j.push(q),k.push(F)}for(N=0;N<k.length;N++){F=k[N];for(var Z=N+1;Z<k.length;Z++){var J=k[Z];if(3===F.edgesConnectedCount)break;if(3!==J.edgesConnectedCount)for(var $=w[3*Z],te=w[3*Z+1],ie=w[3*Z+2],oe=0;oe<3;oe++){var ce=0;if(void 0===F.edges[oe]){switch(oe){case 0:ce=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(F.p0,F.p1,J.p0,J.p1,J.p2):this._processEdgeForAdjacencies(w[3*N],w[3*N+1],$,te,ie);break;case 1:ce=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(F.p1,F.p2,J.p0,J.p1,J.p2):this._processEdgeForAdjacencies(w[3*N+1],w[3*N+2],$,te,ie);break;case 2:ce=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(F.p2,F.p0,J.p0,J.p1,J.p2):this._processEdgeForAdjacencies(w[3*N+2],w[3*N],$,te,ie)}if(-1!==ce&&(F.edges[oe]=Z,J.edges[ce]=N,F.edgesConnectedCount++,J.edgesConnectedCount++,3===F.edgesConnectedCount))break}}}}for(N=0;N<k.length;N++){var he=k[N];this._checkEdge(N,he.edges[0],j,he.p0,he.p1),this._checkEdge(N,he.edges[1],j,he.p1,he.p2),this._checkEdge(N,he.edges[2],j,he.p2,he.p0)}var fe=this._source.getScene().getEngine();this._buffers[Zi.b.PositionKind]=new Zi.b(fe,this._linesPositions,Zi.b.PositionKind,!1),this._buffers[Zi.b.NormalKind]=new Zi.b(fe,this._linesNormals,Zi.b.NormalKind,!1,!1,4),this._ib=fe.createIndexBuffer(this._linesIndices),this._indicesCount=this._linesIndices.length}},e.prototype.isReady=function(){return this._lineShader.isReady()},e.prototype.render=function(){var D=this._source.getScene();if(this.isReady()&&D.activeCamera){var w=D.getEngine();this._lineShader._preBind(),1!==this._source.edgesColor.a?w.setAlphaMode(ce.a.ALPHA_COMBINE):w.setAlphaMode(ce.a.ALPHA_DISABLE),w.bindBuffers(this._buffers,this._ib,this._lineShader.getEffect()),D.resetCachedMaterial(),this._lineShader.setColor4("color",this._source.edgesColor),D.activeCamera.mode===Xt.a.ORTHOGRAPHIC_CAMERA?this._lineShader.setFloat("width",this._source.edgesWidth/this.edgesWidthScalerForOrthographic):this._lineShader.setFloat("width",this._source.edgesWidth/this.edgesWidthScalerForPerspective),this._lineShader.setFloat("aspectRatio",w.getAspectRatio(D.activeCamera)),this._lineShader.bind(this._source.getWorldMatrix()),w.drawElementsType(Ps.a.TriangleFillMode,0,this._indicesCount),this._lineShader.unbind()}},e}(),Wp=function(D){function t(w,N,F){void 0===N&&(N=.95),void 0===F&&(F=!1);var k=D.call(this,w,N,F,!1)||this;return k._generateEdgesLines(),k}return Object(Z.d)(t,D),t.prototype._generateEdgesLines=function(){var D=this._source.getVerticesData(Zi.b.PositionKind),w=this._source.getIndices();if(w&&D){for(var N=z.c.Vector3[0],F=z.c.Vector3[1],k=w.length-1,j=0,G=0;j<k;j+=2,G+=4)z.e.FromArrayToRef(D,3*w[j],N),z.e.FromArrayToRef(D,3*w[j+1],F),this.createLine(N,F,G);var H=this._source.getScene().getEngine();this._buffers[Zi.b.PositionKind]=new Zi.b(H,this._linesPositions,Zi.b.PositionKind,!1),this._buffers[Zi.b.NormalKind]=new Zi.b(H,this._linesNormals,Zi.b.NormalKind,!1,!1,4),this._ib=H.createIndexBuffer(this._linesIndices),this._indicesCount=this._linesIndices.length}},t}(Hp);li.a.ShadersStore.outlinePixelShader="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform vec4 color;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\n#include<logDepthDeclaration>\nvoid main(void) {\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\n#include<logDepthFragment>\ngl_FragColor=color;\n}",li.a.ShadersStore.outlineVertexShader="\nattribute vec3 position;\nattribute vec3 normal;\n#include<bonesDeclaration>\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n\nuniform float offset;\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\n#include<logDepthDeclaration>\nvoid main(void)\n{\nvec3 positionUpdated=position;\nvec3 normalUpdated=normal;\n#ifdef UV1\nvec2 uvUpdated=uv;\n#endif\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\nvec3 offsetPosition=positionUpdated+(normalUpdated*offset);\n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(offsetPosition,1.0);\n#ifdef ALPHATEST\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n#include<logDepthVertex>\n}\n",We.a.prototype.getOutlineRenderer=function(){return this._outlineRenderer||(this._outlineRenderer=new Xp(this)),this._outlineRenderer},Object.defineProperty(xt.a.prototype,"renderOutline",{get:function(){return this._renderOutline},set:function(D){D&&this.getScene().getOutlineRenderer(),this._renderOutline=D},enumerable:!0,configurable:!0}),Object.defineProperty(xt.a.prototype,"renderOverlay",{get:function(){return this._renderOverlay},set:function(D){D&&this.getScene().getOutlineRenderer(),this._renderOverlay=D},enumerable:!0,configurable:!0});var Xp=function(){function e(D){this.name=Nt.a.NAME_OUTLINERENDERER,this.zOffset=1,this.scene=D,this._engine=D.getEngine(),this.scene._addComponent(this)}return e.prototype.register=function(){this.scene._beforeRenderingMeshStage.registerStep(Nt.a.STEP_BEFORERENDERINGMESH_OUTLINE,this,this._beforeRenderingMesh),this.scene._afterRenderingMeshStage.registerStep(Nt.a.STEP_AFTERRENDERINGMESH_OUTLINE,this,this._afterRenderingMesh)},e.prototype.rebuild=function(){},e.prototype.dispose=function(){},e.prototype.render=function(D,w,N){var F=this;void 0===N&&(N=!1);var k=this.scene,j=k.getEngine(),z=j.getCaps().instancedArrays&&null!==w.visibleInstances[D._id]&&void 0!==w.visibleInstances[D._id];if(this.isReady(D,z)){var G=D.getRenderingMesh(),H=D.getMaterial();if(H&&k.activeCamera){if(j.enableEffect(this._effect),H.useLogarithmicDepth&&this._effect.setFloat("logarithmicDepthConstant",2/(Math.log(k.activeCamera.maxZ+1)/Math.LN2)),this._effect.setFloat("offset",N?0:G.outlineWidth),this._effect.setColor4("color",N?G.overlayColor:G.outlineColor,N?G.overlayAlpha:H.alpha),this._effect.setMatrix("viewProjection",k.getTransformMatrix()),G.useBones&&G.computeBonesUsingShaders&&G.skeleton&&this._effect.setMatrices("mBones",G.skeleton.getTransformMatrices(G)),jo.a.BindMorphTargetParameters(G,this._effect),G._bind(D,this._effect,H.fillMode),H&&H.needAlphaTesting()){var X=H.getAlphaTestTexture();X&&(this._effect.setTexture("diffuseSampler",X),this._effect.setMatrix("diffuseMatrix",X.getTextureMatrix()))}j.setZOffset(-this.zOffset),G._processRendering(D,this._effect,H.fillMode,w,z,(function(D,w){F._effect.setMatrix("world",w)})),j.setZOffset(0)}}},e.prototype.isReady=function(D,w){var N=[],F=[Zi.b.PositionKind,Zi.b.NormalKind],k=D.getMesh(),j=D.getMaterial();j&&(j.needAlphaTesting()&&(N.push("#define ALPHATEST"),k.isVerticesDataPresent(Zi.b.UVKind)&&(F.push(Zi.b.UVKind),N.push("#define UV1")),k.isVerticesDataPresent(Zi.b.UV2Kind)&&(F.push(Zi.b.UV2Kind),N.push("#define UV2"))),j.useLogarithmicDepth&&N.push("#define LOGARITHMICDEPTH")),k.useBones&&k.computeBonesUsingShaders?(F.push(Zi.b.MatricesIndicesKind),F.push(Zi.b.MatricesWeightsKind),k.numBoneInfluencers>4&&(F.push(Zi.b.MatricesIndicesExtraKind),F.push(Zi.b.MatricesWeightsExtraKind)),N.push("#define NUM_BONE_INFLUENCERS "+k.numBoneInfluencers),N.push("#define BonesPerMesh "+(k.skeleton?k.skeleton.bones.length+1:0))):N.push("#define NUM_BONE_INFLUENCERS 0");var z=k.morphTargetManager,G=0;z&&z.numInfluencers>0&&(G=z.numInfluencers,N.push("#define MORPHTARGETS"),N.push("#define NUM_MORPH_INFLUENCERS "+G),jo.a.PrepareAttributesForMorphTargetsInfluencers(F,k,G)),w&&(N.push("#define INSTANCES"),jo.a.PushAttributesForInstances(F));var H=N.join("\n");return this._cachedDefines!==H&&(this._cachedDefines=H,this._effect=this.scene.getEngine().createEffect("outline",F,["world","mBones","viewProjection","diffuseMatrix","offset","color","logarithmicDepthConstant","morphTargetInfluences"],["diffuseSampler"],H,void 0,void 0,void 0,{maxSimultaneousMorphTargets:G})),this._effect.isReady()},e.prototype._beforeRenderingMesh=function(D,w,N){if(this._savedDepthWrite=this._engine.getDepthWrite(),D.renderOutline){var F=w.getMaterial();F&&F.needAlphaBlending()&&(this._engine.cacheStencilState(),this._engine.setDepthWrite(!1),this._engine.setColorWrite(!1),this._engine.setStencilBuffer(!0),this._engine.setStencilOperationPass(ce.a.REPLACE),this._engine.setStencilFunction(ce.a.ALWAYS),this._engine.setStencilMask(e._StencilReference),this._engine.setStencilFunctionReference(e._StencilReference),this.render(w,N,!0),this._engine.setColorWrite(!0),this._engine.setStencilFunction(ce.a.NOTEQUAL)),this._engine.setDepthWrite(!1),this.render(w,N),this._engine.setDepthWrite(this._savedDepthWrite),F&&F.needAlphaBlending()&&this._engine.restoreStencilState()}},e.prototype._afterRenderingMesh=function(D,w,N){if(D.renderOverlay){var F=this._engine.getAlphaMode(),k=this._engine.alphaState.alphaBlend;this._engine.setAlphaMode(ce.a.ALPHA_COMBINE),this.render(w,N,!0),this._engine.setAlphaMode(F),this._engine.setDepthWrite(this._savedDepthWrite),this._engine.alphaState.alphaBlend=k}D.renderOutline&&this._savedDepthWrite&&(this._engine.setDepthWrite(!0),this._engine.setColorWrite(!1),this.render(w,N),this._engine.setColorWrite(!0))},e._StencilReference=4,e}(),Kp=N(134),Qp=function(){function e(D,w){this.name=D,this.color=new G.b(1,1,1,1),this.width=1,this.height=1,this.angle=0,this.invertU=0,this.invertV=0,this.animations=new Array,this.isPickable=!1,this._animationStarted=!1,this._loopAnimation=!1,this._fromIndex=0,this._toIndex=0,this._delay=0,this._direction=1,this._time=0,this.isVisible=!0,this._manager=w,this._manager.sprites.push(this),this.position=z.e.Zero()}return Object.defineProperty(e.prototype,"size",{get:function(){return this.width},set:function(D){this.width=D,this.height=D},enumerable:!0,configurable:!0}),e.prototype.playAnimation=function(D,w,N,F,k){this._fromIndex=D,this._toIndex=w,this._loopAnimation=N,this._delay=F,this._animationStarted=!0,D<w?this._direction=1:(this._direction=-1,this._toIndex=D,this._fromIndex=w),this.cellIndex=D,this._time=0,this._onAnimationEnd=k},e.prototype.stopAnimation=function(){this._animationStarted=!1},e.prototype._animate=function(D){this._animationStarted&&(this._time+=D,this._time>this._delay&&(this._time=this._time%this._delay,this.cellIndex+=this._direction,(this._direction>0&&this.cellIndex>this._toIndex||this._direction<0&&this.cellIndex<this._fromIndex)&&(this._loopAnimation?this.cellIndex=this._direction>0?this._fromIndex:this._toIndex:(this.cellIndex=this._toIndex,this._animationStarted=!1,this._onAnimationEnd&&this._onAnimationEnd(),this.disposeWhenFinishedAnimating&&this.dispose()))))},e.prototype.dispose=function(){for(var D=0;D<this._manager.sprites.length;D++)this._manager.sprites[D]==this&&this._manager.sprites.splice(D,1)},e}();We.a.prototype._internalPickSprites=function(D,w,N,F){if(!_r.a)return null;var k=null;if(!F){if(!this.activeCamera)return null;F=this.activeCamera}if(this.spriteManagers.length>0)for(var j=0;j<this.spriteManagers.length;j++){var z=this.spriteManagers[j];if(z.isPickable){var G=z.intersects(D,F,w,N);if(G&&G.hit&&(N||null==k||!(G.distance>=k.distance))&&(k=G,N))break}}return k||new _r.a},We.a.prototype._internalMultiPickSprites=function(D,w,N){if(!_r.a)return null;var F=new Array;if(!N){if(!this.activeCamera)return null;N=this.activeCamera}if(this.spriteManagers.length>0)for(var k=0;k<this.spriteManagers.length;k++){var j=this.spriteManagers[k];if(j.isPickable){var z=j.multiIntersects(D,N,w);null!==z&&(F=F.concat(z))}}return F},We.a.prototype.pickSprite=function(D,w,N,F,k){return this.createPickingRayInCameraSpaceToRef(D,w,this._tempSpritePickingRay,k),this._internalPickSprites(this._tempSpritePickingRay,N,F,k)},We.a.prototype.pickSpriteWithRay=function(D,w,N,F){if(!this._tempSpritePickingRay)return null;if(!F){if(!this.activeCamera)return null;F=this.activeCamera}return Qn.a.TransformToRef(D,F.getViewMatrix(),this._tempSpritePickingRay),this._internalPickSprites(this._tempSpritePickingRay,w,N,F)},We.a.prototype.multiPickSprite=function(D,w,N,F){return this.createPickingRayInCameraSpaceToRef(D,w,this._tempSpritePickingRay,F),this._internalMultiPickSprites(this._tempSpritePickingRay,N,F)},We.a.prototype.multiPickSpriteWithRay=function(D,w,N){if(!this._tempSpritePickingRay)return null;if(!N){if(!this.activeCamera)return null;N=this.activeCamera}return Qn.a.TransformToRef(D,N.getViewMatrix(),this._tempSpritePickingRay),this._internalMultiPickSprites(this._tempSpritePickingRay,w,N)},We.a.prototype.setPointerOverSprite=function(D){this._pointerOverSprite!==D&&(this._pointerOverSprite&&this._pointerOverSprite.actionManager&&this._pointerOverSprite.actionManager.processTrigger(ce.a.ACTION_OnPointerOutTrigger,q.a.CreateNewFromSprite(this._pointerOverSprite,this)),this._pointerOverSprite=D,this._pointerOverSprite&&this._pointerOverSprite.actionManager&&this._pointerOverSprite.actionManager.processTrigger(ce.a.ACTION_OnPointerOverTrigger,q.a.CreateNewFromSprite(this._pointerOverSprite,this)))},We.a.prototype.getPointerOverSprite=function(){return this._pointerOverSprite};var qp=function(){function e(D){this.name=Nt.a.NAME_SPRITE,this.scene=D,this.scene.spriteManagers=new Array,this.scene._tempSpritePickingRay=Qn.a?Qn.a.Zero():null,this.scene.onBeforeSpritesRenderingObservable=new j.c,this.scene.onAfterSpritesRenderingObservable=new j.c,this._spritePredicate=function(D){return!!D.actionManager&&D.isPickable&&D.actionManager.hasPointerTriggers}}return e.prototype.register=function(){this.scene._pointerMoveStage.registerStep(Nt.a.STEP_POINTERMOVE_SPRITE,this,this._pointerMove),this.scene._pointerDownStage.registerStep(Nt.a.STEP_POINTERDOWN_SPRITE,this,this._pointerDown),this.scene._pointerUpStage.registerStep(Nt.a.STEP_POINTERUP_SPRITE,this,this._pointerUp)},e.prototype.rebuild=function(){},e.prototype.dispose=function(){this.scene.onBeforeSpritesRenderingObservable.clear(),this.scene.onAfterSpritesRenderingObservable.clear();for(var D=this.scene.spriteManagers;D.length;)D[0].dispose()},e.prototype._pickSpriteButKeepRay=function(D,w,N,F,k){var j=this.scene.pickSprite(w,N,this._spritePredicate,F,k);return j&&(j.ray=D?D.ray:null),j},e.prototype._pointerMove=function(D,w,N,F,k){var j=this.scene;return F?j.setPointerOverSprite(null):(N=this._pickSpriteButKeepRay(N,D,w,!1,j.cameraToUseForPointers||void 0))&&N.hit&&N.pickedSprite?(j.setPointerOverSprite(N.pickedSprite),j.doNotHandleCursors||(j._pointerOverSprite&&j._pointerOverSprite.actionManager&&j._pointerOverSprite.actionManager.hoverCursor?k.style.cursor=j._pointerOverSprite.actionManager.hoverCursor:k.style.cursor=j.hoverCursor)):j.setPointerOverSprite(null),N},e.prototype._pointerDown=function(D,w,N,F){var k=this.scene;if(k._pickedDownSprite=null,k.spriteManagers.length>0&&(N=k.pickSprite(D,w,this._spritePredicate,!1,k.cameraToUseForPointers||void 0))&&N.hit&&N.pickedSprite&&N.pickedSprite.actionManager){switch(k._pickedDownSprite=N.pickedSprite,F.button){case 0:N.pickedSprite.actionManager.processTrigger(ce.a.ACTION_OnLeftPickTrigger,q.a.CreateNewFromSprite(N.pickedSprite,k,F));break;case 1:N.pickedSprite.actionManager.processTrigger(ce.a.ACTION_OnCenterPickTrigger,q.a.CreateNewFromSprite(N.pickedSprite,k,F));break;case 2:N.pickedSprite.actionManager.processTrigger(ce.a.ACTION_OnRightPickTrigger,q.a.CreateNewFromSprite(N.pickedSprite,k,F))}N.pickedSprite.actionManager&&N.pickedSprite.actionManager.processTrigger(ce.a.ACTION_OnPickDownTrigger,q.a.CreateNewFromSprite(N.pickedSprite,k,F))}return N},e.prototype._pointerUp=function(D,w,N,F){var k=this.scene;if(k.spriteManagers.length>0){var j=k.pickSprite(D,w,this._spritePredicate,!1,k.cameraToUseForPointers||void 0);j&&(j.hit&&j.pickedSprite&&j.pickedSprite.actionManager&&(j.pickedSprite.actionManager.processTrigger(ce.a.ACTION_OnPickUpTrigger,q.a.CreateNewFromSprite(j.pickedSprite,k,F)),j.pickedSprite.actionManager&&(this.scene._inputManager._isPointerSwiping()||j.pickedSprite.actionManager.processTrigger(ce.a.ACTION_OnPickTrigger,q.a.CreateNewFromSprite(j.pickedSprite,k,F)))),k._pickedDownSprite&&k._pickedDownSprite.actionManager&&k._pickedDownSprite!==j.pickedSprite&&k._pickedDownSprite.actionManager.processTrigger(ce.a.ACTION_OnPickOutTrigger,q.a.CreateNewFromSprite(k._pickedDownSprite,k,F)))}return N},e}();li.a.ShadersStore.spritesPixelShader="uniform bool alphaTest;\nvarying vec4 vColor;\n\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n\n#include<fogFragmentDeclaration>\nvoid main(void) {\nvec4 color=texture2D(diffuseSampler,vUV);\nif (alphaTest)\n{\nif (color.a<0.95)\ndiscard;\n}\ncolor*=vColor;\n#include<fogFragment>\ngl_FragColor=color;\n}",li.a.ShadersStore.spritesVertexShader="\nattribute vec4 position;\nattribute vec4 options;\nattribute vec2 inverts;\nattribute vec4 cellInfo;\nattribute vec4 color;\n\nuniform mat4 view;\nuniform mat4 projection;\n\nvarying vec2 vUV;\nvarying vec4 vColor;\n#include<fogVertexDeclaration>\nvoid main(void) {\nvec3 viewPos=(view*vec4(position.xyz,1.0)).xyz;\nvec2 cornerPos;\nfloat angle=position.w;\nvec2 size=vec2(options.x,options.y);\nvec2 offset=options.zw;\ncornerPos=vec2(offset.x-0.5,offset.y-0.5)*size;\n\nvec3 rotatedCorner;\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\n\nviewPos+=rotatedCorner;\ngl_Position=projection*vec4(viewPos,1.0);\n\nvColor=color;\n\nvec2 uvOffset=vec2(abs(offset.x-inverts.x),abs(1.0-offset.y-inverts.y));\nvec2 uvPlace=cellInfo.xy;\nvec2 uvSize=cellInfo.zw;\nvUV.x=uvPlace.x+uvSize.x*uvOffset.x;\nvUV.y=uvPlace.y+uvSize.y*uvOffset.y;\n\n#ifdef FOG\nvFogDistance=viewPos;\n#endif\n}";var Zp=function(){function e(D,w,N,F,k,z,G,H,X){if(void 0===z&&(z=.01),void 0===G&&(G=Jt.a.TRILINEAR_SAMPLINGMODE),void 0===H&&(H=!1),void 0===X&&(X=null),this.name=D,this.sprites=new Array,this.renderingGroupId=0,this.layerMask=268435455,this.fogEnabled=!0,this.isPickable=!1,this._packedAndReady=!1,this.onDisposeObservable=new j.c,this._vertexBuffers={},this._blendMode=ce.a.ALPHA_COMBINE,this.disableDepthWrite=!1,k._getComponent(Nt.a.NAME_SPRITE)||k._addComponent(new qp(k)),this._capacity=N,this._fromPacked=H,this._spriteTexture=new Jt.a(w,k,!0,!1,G),this._spriteTexture.wrapU=Jt.a.CLAMP_ADDRESSMODE,this._spriteTexture.wrapV=Jt.a.CLAMP_ADDRESSMODE,F.width&&F.height)this.cellWidth=F.width,this.cellHeight=F.height;else{if(void 0===F)return;this.cellWidth=F,this.cellHeight=F}this._epsilon=z,this._scene=k,this._scene.spriteManagers.push(this);for(var q=[],Z=0,J=0;J<N;J++)q.push(Z),q.push(Z+1),q.push(Z+2),q.push(Z),q.push(Z+2),q.push(Z+3),Z+=4;this._indexBuffer=k.getEngine().createIndexBuffer(q),this._vertexData=new Float32Array(18*N*4),this._buffer=new Zi.a(k.getEngine(),this._vertexData,!0,18);var $=this._buffer.createVertexBuffer(Zi.b.PositionKind,0,4),te=this._buffer.createVertexBuffer("options",4,4),ie=this._buffer.createVertexBuffer("inverts",8,2),oe=this._buffer.createVertexBuffer("cellInfo",10,4),he=this._buffer.createVertexBuffer(Zi.b.ColorKind,14,4);this._vertexBuffers[Zi.b.PositionKind]=$,this._vertexBuffers.options=te,this._vertexBuffers.inverts=ie,this._vertexBuffers.cellInfo=oe,this._vertexBuffers[Zi.b.ColorKind]=he,this._effectBase=this._scene.getEngine().createEffect("sprites",[Zi.b.PositionKind,"options","inverts","cellInfo",Zi.b.ColorKind],["view","projection","textureInfos","alphaTest"],["diffuseSampler"],""),this._effectFog=this._scene.getEngine().createEffect("sprites",[Zi.b.PositionKind,"options","inverts","cellInfo",Zi.b.ColorKind],["view","projection","textureInfos","alphaTest","vFogInfos","vFogColor"],["diffuseSampler"],"#define FOG"),this._fromPacked&&this._makePacked(w,X)}return Object.defineProperty(e.prototype,"onDispose",{set:function(D){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(D)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"texture",{get:function(){return this._spriteTexture},set:function(D){this._spriteTexture=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blendMode",{get:function(){return this._blendMode},set:function(D){this._blendMode=D},enumerable:!0,configurable:!0}),e.prototype._makePacked=function(D,w){var N=this;if(null!==w)try{var F=void 0;if((F="string"==typeof w?JSON.parse(w):w).frames.length){for(var k={},j=0;j<F.frames.length;j++){var z=F.frames[j];if("string"!=typeof Object.keys(z)[0])throw new Error("Invalid JSON Format.  Check the frame values and make sure the name is the first parameter.");k[z[Object.keys(z)[0]]]=z}F.frames=k}var G=Reflect.ownKeys(F.frames);this._spriteMap=G,this._packedAndReady=!0,this._cellData=F.frames}catch(D){throw this._fromPacked=!1,this._packedAndReady=!1,new Error("Invalid JSON from string. Spritesheet managed with constant cell size.")}else{var H=/\./g,X=void 0;do{X=H.lastIndex,H.test(D)}while(H.lastIndex>0);var q=D.substring(0,X-1)+".json",Z=new XMLHttpRequest;Z.open("GET",q,!0),Z.onerror=function(){oe.a.Error("JSON ERROR: Unable to load JSON file."),N._fromPacked=!1,N._packedAndReady=!1},Z.onload=function(){try{var D=JSON.parse(Z.response),w=Reflect.ownKeys(D.frames);N._spriteMap=w,N._packedAndReady=!0,N._cellData=D.frames}catch(D){throw N._fromPacked=!1,N._packedAndReady=!1,new Error("Invalid JSON format. Please check documentation for format specifications.")}},Z.send()}},e.prototype._appendSpriteVertex=function(D,w,N,F,k){var j=18*D;if(0===N?N=this._epsilon:1===N&&(N=1-this._epsilon),0===F?F=this._epsilon:1===F&&(F=1-this._epsilon),this._vertexData[j]=w.position.x,this._vertexData[j+1]=w.position.y,this._vertexData[j+2]=w.position.z,this._vertexData[j+3]=w.angle,this._vertexData[j+4]=w.width,this._vertexData[j+5]=w.height,this._vertexData[j+6]=N,this._vertexData[j+7]=F,this._vertexData[j+8]=w.invertU?1:0,this._vertexData[j+9]=w.invertV?1:0,this._packedAndReady){w.cellRef||(w.cellIndex=0);var z=w.cellIndex;"number"==typeof z&&isFinite(z)&&Math.floor(z)===z&&(w.cellRef=this._spriteMap[w.cellIndex]),this._vertexData[j+10]=this._cellData[w.cellRef].frame.x/k.width,this._vertexData[j+11]=this._cellData[w.cellRef].frame.y/k.height,this._vertexData[j+12]=this._cellData[w.cellRef].frame.w/k.width,this._vertexData[j+13]=this._cellData[w.cellRef].frame.h/k.height}else{w.cellIndex||(w.cellIndex=0);var G=k.width/this.cellWidth,H=w.cellIndex/G>>0;this._vertexData[j+10]=(w.cellIndex-H*G)*this.cellWidth/k.width,this._vertexData[j+11]=H*this.cellHeight/k.height,this._vertexData[j+12]=this.cellWidth/k.width,this._vertexData[j+13]=this.cellHeight/k.height}this._vertexData[j+14]=w.color.r,this._vertexData[j+15]=w.color.g,this._vertexData[j+16]=w.color.b,this._vertexData[j+17]=w.color.a},e.prototype.intersects=function(D,w,N,F){for(var k=Math.min(this._capacity,this.sprites.length),j=z.e.Zero(),G=z.e.Zero(),H=Number.MAX_VALUE,X=null,q=z.c.Vector3[0],Z=z.c.Vector3[1],J=w.getViewMatrix(),$=0;$<k;$++){var te=this.sprites[$];if(te){if(N){if(!N(te))continue}else if(!te.isPickable)continue;if(z.e.TransformCoordinatesToRef(te.position,J,Z),j.copyFromFloats(Z.x-te.width/2,Z.y-te.height/2,Z.z),G.copyFromFloats(Z.x+te.width/2,Z.y+te.height/2,Z.z),D.intersectsBoxMinMax(j,G)){var ie=z.e.Distance(Z,D.origin);if(H>ie&&(H=ie,X=te,F))break}}}if(X){var oe=new _r.a;J.invertToRef(z.c.Matrix[0]),oe.hit=!0,oe.pickedSprite=X,oe.distance=H;var ce=z.c.Vector3[2];return ce.copyFrom(D.direction),ce.normalize(),ce.scaleInPlace(H),D.origin.addToRef(ce,q),oe.pickedPoint=z.e.TransformCoordinates(q,z.c.Matrix[0]),oe}return null},e.prototype.multiIntersects=function(D,w,N){for(var F,k=Math.min(this._capacity,this.sprites.length),j=z.e.Zero(),G=z.e.Zero(),H=[],X=z.c.Vector3[0].copyFromFloats(0,0,0),q=z.c.Vector3[1].copyFromFloats(0,0,0),Z=w.getViewMatrix(),J=0;J<k;J++){var $=this.sprites[J];if($){if(N){if(!N($))continue}else if(!$.isPickable)continue;if(z.e.TransformCoordinatesToRef($.position,Z,q),j.copyFromFloats(q.x-$.width/2,q.y-$.height/2,q.z),G.copyFromFloats(q.x+$.width/2,q.y+$.height/2,q.z),D.intersectsBoxMinMax(j,G)){F=z.e.Distance(q,D.origin);var te=new _r.a;H.push(te),Z.invertToRef(z.c.Matrix[0]),te.hit=!0,te.pickedSprite=$,te.distance=F;var ie=z.c.Vector3[2];ie.copyFrom(D.direction),ie.normalize(),ie.scaleInPlace(F),D.origin.addToRef(ie,X),te.pickedPoint=z.e.TransformCoordinates(X,z.c.Matrix[0])}}}return H},e.prototype.render=function(){if(this._effectBase.isReady()&&this._effectFog.isReady()&&this._spriteTexture&&this._spriteTexture.isReady()&&this.sprites.length&&(!this._fromPacked||this._packedAndReady&&this._spriteMap&&this._cellData)){for(var D=this._scene.getEngine(),w=this._spriteTexture.getBaseSize(),N=D.getDeltaTime(),F=Math.min(this._capacity,this.sprites.length),k=0,j=!0,z=0;z<F;z++){var G=this.sprites[z];G&&G.isVisible&&(j=!1,G._animate(N),this._appendSpriteVertex(k++,G,0,0,w),this._appendSpriteVertex(k++,G,1,0,w),this._appendSpriteVertex(k++,G,1,1,w),this._appendSpriteVertex(k++,G,0,1,w))}if(!j){this._buffer.update(this._vertexData);var H=this._effectBase;this._scene.fogEnabled&&this._scene.fogMode!==We.a.FOGMODE_NONE&&this.fogEnabled&&(H=this._effectFog),D.enableEffect(H);var X=this._scene.getViewMatrix();H.setTexture("diffuseSampler",this._spriteTexture),H.setMatrix("view",X),H.setMatrix("projection",this._scene.getProjectionMatrix()),this._scene.fogEnabled&&this._scene.fogMode!==We.a.FOGMODE_NONE&&this.fogEnabled&&(H.setFloat4("vFogInfos",this._scene.fogMode,this._scene.fogStart,this._scene.fogEnd,this._scene.fogDensity),H.setColor3("vFogColor",this._scene.fogColor)),D.bindBuffers(this._vertexBuffers,this._indexBuffer,H),D.setDepthFunctionToLessOrEqual(),this.disableDepthWrite||(H.setBool("alphaTest",!0),D.setColorWrite(!1),D.drawElementsType(Ps.a.TriangleFillMode,0,k/4*6),D.setColorWrite(!0),H.setBool("alphaTest",!1)),D.setAlphaMode(this._blendMode),D.drawElementsType(Ps.a.TriangleFillMode,0,k/4*6),D.setAlphaMode(ce.a.ALPHA_DISABLE)}}},e.prototype.dispose=function(){this._buffer&&(this._buffer.dispose(),this._buffer=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._spriteTexture&&(this._spriteTexture.dispose(),this._spriteTexture=null);var D=this._scene.spriteManagers.indexOf(this);this._scene.spriteManagers.splice(D,1),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()},e}();li.a.ShadersStore.spriteMapPixelShader="precision highp float;\nvarying vec3 vPosition;\nvarying vec2 vUV;\nvarying vec2 tUV;\nuniform float time;\nuniform float spriteCount;\nuniform sampler2D spriteSheet;\nuniform vec2 spriteMapSize;\nuniform vec2 outputSize;\nuniform vec2 stageSize;\nuniform sampler2D frameMap;\nuniform sampler2D tileMaps[LAYERS];\nuniform sampler2D animationMap;\nuniform vec3 colorMul;\nfloat mt;\nconst float fdStep=1./4.;\nconst float aFrameSteps=1./MAX_ANIMATION_FRAMES;\nmat4 getFrameData(float frameID){\nfloat fX=frameID/spriteCount;\nreturn mat4(\ntexture2D(frameMap,vec2(fX,0.),0.),\ntexture2D(frameMap,vec2(fX,fdStep*1.),0.),\ntexture2D(frameMap,vec2(fX,fdStep*2.),0.),\nvec4(0.)\n);\n}\nvoid main(){\nvec4 color=vec4(0.);\nvec2 tileUV=fract(tUV);\n#ifdef FLIPU\ntileUV.y=1.0-tileUV.y;\n#endif\nvec2 tileID=floor(tUV);\nvec2 sheetUnits=1./spriteMapSize;\nfloat spriteUnits=1./spriteCount;\nvec2 stageUnits=1./stageSize;\nfor(int i=0; i<LAYERS; i++) {\nfloat frameID;\n#define LAYER_ID_SWITCH\nvec4 animationData=texture2D(animationMap,vec2((frameID+0.5)/spriteCount,0.),0.);\nif(animationData.y>0.) {\nmt=mod(time*animationData.z,1.0);\nfor(float f=0.; f<MAX_ANIMATION_FRAMES; f++){\nif(animationData.y>mt){\nframeID=animationData.x;\nbreak;\n}\nanimationData=texture2D(animationMap,vec2((frameID+0.5)/spriteCount,aFrameSteps*f),0.);\n}\n}\n\nmat4 frameData=getFrameData(frameID+0.5);\nvec2 frameSize=(frameData[0].wz)/spriteMapSize;\nvec2 offset=frameData[0].xy*sheetUnits;\nvec2 ratio=frameData[2].xy/frameData[0].wz;\n\nif (frameData[2].z == 1.){\ntileUV.xy=tileUV.yx;\n}\nif (i == 0){\ncolor=texture2D(spriteSheet,tileUV*frameSize+offset);\n} else {\nvec4 nc=texture2D(spriteSheet,tileUV*frameSize+offset);\nfloat alpha=min(color.a+nc.a,1.0);\nvec3 mixed=mix(color.xyz,nc.xyz,nc.a);\ncolor=vec4(mixed,alpha);\n}\n}\ncolor.xyz*=colorMul;\ngl_FragColor=color;\n}",li.a.ShadersStore.spriteMapVertexShader="precision highp float;\n\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\n\nvarying vec3 vPosition;\nvarying vec2 vUV;\nvarying vec2 tUV;\nvarying vec2 stageUnits;\nvarying vec2 levelUnits;\nvarying vec2 tileID;\n\nuniform float time;\nuniform mat4 worldViewProjection;\nuniform vec2 outputSize;\nuniform vec2 stageSize;\nuniform vec2 spriteMapSize;\nuniform float stageScale;\nvoid main() {\nvec4 p=vec4( position,1. );\nvPosition=p.xyz;\nvUV=uv;\ntUV=uv*stageSize;\ngl_Position=worldViewProjection*p;\n}";var Jp,$p=function(){function e(D,w,N,F,k){var j=this;this.name=D,this.sprites=[],this.atlasJSON=w,this.sprites=this.atlasJSON.frames,this.spriteSheet=N,this.options=F,F.stageSize=F.stageSize||new z.d(1,1),F.outputSize=F.outputSize||F.stageSize,F.outputPosition=F.outputPosition||z.e.Zero(),F.outputRotation=F.outputRotation||z.e.Zero(),F.layerCount=F.layerCount||1,F.maxAnimationFrames=F.maxAnimationFrames||0,F.baseTile=F.baseTile||0,F.flipU=F.flipU||!1,F.colorMultiply=F.colorMultiply||new z.e(1,1,1),this._scene=k,this._frameMap=this._createFrameBuffer(),this._tileMaps=new Array;for(var G=0;G<F.layerCount;G++)this._tileMaps.push(this._createTileBuffer(null,G));this._animationMap=this._createTileAnimationBuffer(null);var H=[];H.push("#define LAYERS "+F.layerCount),F.flipU&&H.push("#define FLIPU"),H.push("#define MAX_ANIMATION_FRAMES "+F.maxAnimationFrames+".0");var X,q=li.a.ShadersStore.spriteMapPixelShader;if(1===this._scene.getEngine().webGLVersion)for(X="",G=0;G<F.layerCount;G++)X+="if ("+G+" == i) { frameID = texture2D(tileMaps["+G+"], (tileID + 0.5) / stageSize, 0.).x; }";else{for(X="switch(i) {",G=0;G<F.layerCount;G++)X+="case "+G+" : frameID = texture(tileMaps["+G+"], (tileID + 0.5) / stageSize, 0.).x;",X+="break;";X+="}"}li.a.ShadersStore["spriteMap"+this.name+"PixelShader"]=q.replace("#define LAYER_ID_SWITCH",X),this._material=new Zc.a("spriteMap:"+this.name,this._scene,{vertex:"spriteMap",fragment:"spriteMap"+this.name},{defines:H,attributes:["position","normal","uv"],uniforms:["worldViewProjection","time","stageSize","outputSize","spriteMapSize","spriteCount","time","colorMul","mousePosition","curTile","flipU"],samplers:["spriteSheet","frameMap","tileMaps","animationMap"],needAlphaBlending:!0}),this._time=0,this._material.setFloat("spriteCount",this.spriteCount),this._material.setVector2("stageSize",F.stageSize),this._material.setVector2("outputSize",F.outputSize),this._material.setTexture("spriteSheet",this.spriteSheet),this._material.setVector2("spriteMapSize",new z.d(1,1)),this._material.setVector3("colorMul",F.colorMultiply);var Z=0,d=function(){j.spriteSheet&&j.spriteSheet.isReady()&&j.spriteSheet._texture?j._material.setVector2("spriteMapSize",new z.d(j.spriteSheet._texture.baseWidth||1,j.spriteSheet._texture.baseHeight||1)):Z<100&&setTimeout((function(){Z++,d()}),100)};d(),this._material.setVector3("colorMul",F.colorMultiply),this._material.setTexture("frameMap",this._frameMap),this._material.setTextureArray("tileMaps",this._tileMaps),this._material.setTexture("animationMap",this._animationMap),this._material.setFloat("time",this._time),this._output=xt.a.CreatePlane(D+":output",1,k,!0),this._output.scaling.x=F.outputSize.x,this._output.scaling.y=F.outputSize.y,this._scene.onBeforeRenderObservable.add((function(){j._time+=j._scene.getEngine().getDeltaTime(),j._material.setFloat("time",j._time)})),this._output.material=this._material}return Object.defineProperty(e.prototype,"spriteCount",{get:function(){return this.sprites.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return this._output.position},set:function(D){this._output.position=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotation",{get:function(){return this._output.rotation},set:function(D){this._output.rotation=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animationMap",{get:function(){return this._animationMap},set:function(D){var w=D._texture._bufferView,N=this._createTileAnimationBuffer(w);this._animationMap.dispose(),this._animationMap=N,this._material.setTexture("animationMap",this._animationMap)},enumerable:!0,configurable:!0}),e.prototype.getTileID=function(){var D=this.getMousePosition();return D.multiplyInPlace(this.options.stageSize||z.d.Zero()),D.x=Math.floor(D.x),D.y=Math.floor(D.y),D},e.prototype.getMousePosition=function(){var D=this._output,w=this._scene.pick(this._scene.pointerX,this._scene.pointerY,(function(w){return w===D}));return w&&w.hit&&w.getTextureCoordinates&&w.getTextureCoordinates()||new z.d(-1,-1)},e.prototype._createFrameBuffer=function(){for(var D=new Array,w=0;w<this.spriteCount;w++)D.push(0,0,0,0),D.push(0,0,0,0),D.push(0,0,0,0),D.push(0,0,0,0);for(w=0;w<this.spriteCount;w++){var N=this.sprites[w].frame,F=this.sprites[w].spriteSourceSize,k=this.sprites[w].sourceSize,j=this.sprites[w].rotated?1:0,z=this.sprites[w].trimmed?1:0;D[4*w]=N.x,D[4*w+1]=N.y,D[4*w+2]=N.w,D[4*w+3]=N.h,D[4*w+4*this.spriteCount]=F.x,D[4*w+1+4*this.spriteCount]=F.y,D[4*w+3+4*this.spriteCount]=F.h,D[4*w+8*this.spriteCount]=k.w,D[4*w+1+8*this.spriteCount]=k.h,D[4*w+2+8*this.spriteCount]=j,D[4*w+3+8*this.spriteCount]=z}var G=new Float32Array(D);return en.CreateRGBATexture(G,this.spriteCount,4,this._scene,!1,!1,Jt.a.NEAREST_NEAREST,Ct.a.TEXTURETYPE_FLOAT)},e.prototype._createTileBuffer=function(D,w){void 0===w&&(w=0);var N=new Array,F=this.options.stageSize.y||0,k=this.options.stageSize.x||0;if(D)N=D;else{var j=this.options.baseTile;0!=w&&(j=0);for(var z=0;z<F;z++)for(var G=0;G<4*k;G+=4)N.push(j,0,0,0)}var H=new Float32Array(N);return en.CreateRGBATexture(H,k,F,this._scene,!1,!1,Jt.a.NEAREST_NEAREST,Ct.a.TEXTURETYPE_FLOAT)},e.prototype.changeTiles=function(D,w,N){var F;if(void 0===D&&(D=0),void 0===N&&(N=0),null!==(F=this._tileMaps[D]._texture._bufferView)){var k=new Array;w instanceof z.d?k.push(w):k=w;for(var j=this.options.stageSize.x||0,G=0;G<k.length;G++){var H=k[G];H.x=Math.floor(H.x),H.y=Math.floor(H.y),F[4*H.x+H.y*(4*j)]=N}var X=this._createTileBuffer(F);this._tileMaps[D].dispose(),this._tileMaps[D]=X,this._material.setTextureArray("tileMap",this._tileMaps)}},e.prototype._createTileAnimationBuffer=function(D){var w,N=new Array;if(D)w=D;else{for(var F=0;F<this.spriteCount;F++){N.push(0,0,0,0);for(var k=1;k<(this.options.maxAnimationFrames||4);)N.push(0,0,0,0),k++}w=new Float32Array(N)}return en.CreateRGBATexture(w,this.spriteCount,this.options.maxAnimationFrames||4,this._scene,!1,!1,Jt.a.NEAREST_NEAREST,Ct.a.TEXTURETYPE_FLOAT)},e.prototype.addAnimationToTile=function(D,w,N,F,k){void 0===D&&(D=0),void 0===w&&(w=0),void 0===N&&(N=0),void 0===F&&(F=0),void 0===k&&(k=1);var j=this._animationMap._texture._bufferView,z=4*D+4*this.spriteCount*w;if(j){j[z]=N,j[z+1]=F,j[z+2]=k;var G=this._createTileAnimationBuffer(j);this._animationMap.dispose(),this._animationMap=G,this._material.setTexture("animationMap",this._animationMap)}},e.prototype.saveTileMaps=function(){for(var D="",w=0;w<this._tileMaps.length;w++)w>0&&(D+="\n\r"),D+=this._tileMaps[w]._texture._bufferView.toString();var N=document.createElement("a");N.href="data:octet/stream;charset=utf-8,"+encodeURI(D),N.target="_blank",N.download=this.name+".tilemaps",N.click(),N.remove()},e.prototype.loadTileMaps=function(D){var w=this,N=new XMLHttpRequest;N.open("GET",D);var F=this.options.layerCount||0;N.onload=function(){for(var D=N.response.split("\n\r"),k=0;k<F;k++){var j=D[k].split(",").map(Number),z=w._createTileBuffer(j);w._tileMaps[k].dispose(),w._tileMaps[k]=z}w._material.setTextureArray("tileMap",w._tileMaps)},N.send()},e.prototype.dispose=function(){this._output.dispose(),this._material.dispose(),this._animationMap.dispose(),this._tileMaps.forEach((function(D){D.dispose()})),this._frameMap.dispose()},e}(),e_=function(D){function t(w,N,F,k,j,z,G){void 0===j&&(j=null),void 0===z&&(z=.01),void 0===G&&(G=Jt.a.TRILINEAR_SAMPLINGMODE);var H=D.call(this,w,N,F,64,k,z,G,!0,j)||this;return H.name=w,H}return Object(Z.d)(t,D),t}(Zp),t_=N(129),n_=N(127),i_=N(128),r_=N(125);!function(D){D[D.INIT=0]="INIT",D[D.RUNNING=1]="RUNNING",D[D.DONE=2]="DONE",D[D.ERROR=3]="ERROR"}(Jp||(Jp={}));var o_,a_=function(){function e(D){this.name=D,this._isCompleted=!1,this._taskState=Jp.INIT}return Object.defineProperty(e.prototype,"isCompleted",{get:function(){return this._isCompleted},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"taskState",{get:function(){return this._taskState},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"errorObject",{get:function(){return this._errorObject},enumerable:!0,configurable:!0}),e.prototype._setErrorObject=function(D,w){this._errorObject||(this._errorObject={message:D,exception:w})},e.prototype.run=function(D,w,N){var F=this;this._taskState=Jp.RUNNING,this.runTask(D,(function(){F.onDoneCallback(w,N)}),(function(D,w){F.onErrorCallback(N,D,w)}))},e.prototype.runTask=function(D,w,N){throw new Error("runTask is not implemented")},e.prototype.reset=function(){this._taskState=Jp.INIT},e.prototype.onErrorCallback=function(D,w,N){this._taskState=Jp.ERROR,this._errorObject={message:w,exception:N},this.onError&&this.onError(this,w,N),D()},e.prototype.onDoneCallback=function(D,w){try{this._taskState=Jp.DONE,this._isCompleted=!0,this.onSuccess&&this.onSuccess(this),D()}catch(D){this.onErrorCallback(w,"Task is done, error executing success callback(s)",D)}},e}(),of=function(D,w,N){this.remainingCount=D,this.totalCount=w,this.task=N},s_=function(D){function t(w,N,F,k){var j=D.call(this,w)||this;return j.name=w,j.meshesNames=N,j.rootUrl=F,j.sceneFilename=k,j}return Object(Z.d)(t,D),t.prototype.runTask=function(D,w,N){var F=this;ro.ImportMesh(this.meshesNames,this.rootUrl,this.sceneFilename,D,(function(D,N,k,j){F.loadedMeshes=D,F.loadedParticleSystems=N,F.loadedSkeletons=k,F.loadedAnimationGroups=j,w()}),null,(function(D,w,F){N(w,F)}))},t}(a_),c_=function(D){function t(w,N){var F=D.call(this,w)||this;return F.name=w,F.url=N,F}return Object(Z.d)(t,D),t.prototype.runTask=function(D,w,N){var F=this;D._loadFile(this.url,(function(D){F.text=D,w()}),void 0,!1,!1,(function(D,w){D&&N(D.status+" "+D.statusText,w)}))},t}(a_),u_=function(D){function t(w,N){var F=D.call(this,w)||this;return F.name=w,F.url=N,F}return Object(Z.d)(t,D),t.prototype.runTask=function(D,w,N){var F=this;D._loadFile(this.url,(function(D){F.data=D,w()}),void 0,!0,!0,(function(D,w){D&&N(D.status+" "+D.statusText,w)}))},t}(a_),l_=function(D){function t(w,N){var F=D.call(this,w)||this;return F.name=w,F.url=N,F}return Object(Z.d)(t,D),t.prototype.runTask=function(D,w,N){var F=this,k=new Image;Dt.b.SetCorsBehavior(this.url,k),k.onload=function(){F.image=k,w()},k.onerror=function(D){N("Error loading image",D)},k.src=this.url},t}(a_),h_=function(D){function t(w,N,F,k,j){void 0===j&&(j=Jt.a.TRILINEAR_SAMPLINGMODE);var z=D.call(this,w)||this;return z.name=w,z.url=N,z.noMipmap=F,z.invertY=k,z.samplingMode=j,z}return Object(Z.d)(t,D),t.prototype.runTask=function(D,w,N){this.texture=new Jt.a(this.url,D,this.noMipmap,this.invertY,this.samplingMode,(function(){w()}),(function(D,w){N(D,w)}))},t}(a_),d_=function(D){function t(w,N,F,k,j){var z=D.call(this,w)||this;return z.name=w,z.url=N,z.extensions=F,z.noMipmap=k,z.files=j,z}return Object(Z.d)(t,D),t.prototype.runTask=function(D,w,N){this.texture=new Vo(this.url,D,this.extensions,this.noMipmap,this.files,(function(){w()}),(function(D,w){N(D,w)}))},t}(a_),f_=function(D){function t(w,N,F,k,j,z,G){void 0===k&&(k=!1),void 0===j&&(j=!0),void 0===z&&(z=!1),void 0===G&&(G=!1);var H=D.call(this,w)||this;return H.name=w,H.url=N,H.size=F,H.noMipmap=k,H.generateHarmonics=j,H.gammaSpace=z,H.reserved=G,H}return Object(Z.d)(t,D),t.prototype.runTask=function(D,w,N){this.texture=new uc(this.url,D,this.size,this.noMipmap,this.generateHarmonics,this.gammaSpace,this.reserved,(function(){w()}),(function(D,w){N(D,w)}))},t}(a_),p_=function(D){function t(w,N,F,k,j){void 0===k&&(k=!1),void 0===j&&(j=!0);var z=D.call(this,w)||this;return z.name=w,z.url=N,z.size=F,z.noMipmap=k,z.gammaSpace=j,z}return Object(Z.d)(t,D),t.prototype.runTask=function(D,w,N){this.texture=new tu(this.url,D,this.size,this.noMipmap,this.gammaSpace,(function(){w()}),(function(D,w){N(D,w)}))},t}(a_),m_=function(){function e(D){this._isLoading=!1,this._tasks=new Array,this._waitingTasksCount=0,this._totalTasksCount=0,this.onTaskSuccessObservable=new j.c,this.onTaskErrorObservable=new j.c,this.onTasksDoneObservable=new j.c,this.onProgressObservable=new j.c,this.useDefaultLoadingScreen=!0,this.autoHideLoadingUI=!0,this._scene=D}return e.prototype.addMeshTask=function(D,w,N,F){var k=new s_(D,w,N,F);return this._tasks.push(k),k},e.prototype.addTextFileTask=function(D,w){var N=new c_(D,w);return this._tasks.push(N),N},e.prototype.addBinaryFileTask=function(D,w){var N=new u_(D,w);return this._tasks.push(N),N},e.prototype.addImageTask=function(D,w){var N=new l_(D,w);return this._tasks.push(N),N},e.prototype.addTextureTask=function(D,w,N,F,k){void 0===k&&(k=Jt.a.TRILINEAR_SAMPLINGMODE);var j=new h_(D,w,N,F,k);return this._tasks.push(j),j},e.prototype.addCubeTextureTask=function(D,w,N,F,k){var j=new d_(D,w,N,F,k);return this._tasks.push(j),j},e.prototype.addHDRCubeTextureTask=function(D,w,N,F,k,j,z){void 0===F&&(F=!1),void 0===k&&(k=!0),void 0===j&&(j=!1),void 0===z&&(z=!1);var G=new f_(D,w,N,F,k,j,z);return this._tasks.push(G),G},e.prototype.addEquiRectangularCubeTextureAssetTask=function(D,w,N,F,k){void 0===F&&(F=!1),void 0===k&&(k=!0);var j=new p_(D,w,N,F,k);return this._tasks.push(j),j},e.prototype.removeTask=function(D){var w=this._tasks.indexOf(D);w>-1&&this._tasks.splice(w,1)},e.prototype._decreaseWaitingTasksCount=function(D){this._waitingTasksCount--;try{this.onProgress&&this.onProgress(this._waitingTasksCount,this._totalTasksCount,D),this.onProgressObservable.notifyObservers(new of(this._waitingTasksCount,this._totalTasksCount,D))}catch(D){oe.a.Error("Error running progress callbacks."),console.log(D)}if(0===this._waitingTasksCount){try{var w=this._tasks.slice();this.onFinish&&this.onFinish(w);for(var N=0,F=w;N<F.length;N++)if((D=F[N]).taskState===Jp.DONE){var k=this._tasks.indexOf(D);k>-1&&this._tasks.splice(k,1)}this.onTasksDoneObservable.notifyObservers(this._tasks)}catch(D){oe.a.Error("Error running tasks-done callbacks."),console.log(D)}this._isLoading=!1,this.autoHideLoadingUI&&this._scene.getEngine().hideLoadingUI()}},e.prototype._runTask=function(D){var w=this,i=function(N,F){D._setErrorObject(N,F),w.onTaskError&&w.onTaskError(D),w.onTaskErrorObservable.notifyObservers(D),w._decreaseWaitingTasksCount(D)};D.run(this._scene,(function(){try{w.onTaskSuccess&&w.onTaskSuccess(D),w.onTaskSuccessObservable.notifyObservers(D),w._decreaseWaitingTasksCount(D)}catch(D){i("Error executing task success callbacks",D)}}),i)},e.prototype.reset=function(){return this._isLoading=!1,this._tasks=new Array,this},e.prototype.load=function(){if(this._isLoading)return this;if(this._isLoading=!0,this._waitingTasksCount=this._tasks.length,this._totalTasksCount=this._tasks.length,0===this._waitingTasksCount)return this._isLoading=!1,this.onFinish&&this.onFinish(this._tasks),this.onTasksDoneObservable.notifyObservers(this._tasks),this;this.useDefaultLoadingScreen&&this._scene.getEngine().displayLoadingUI();for(var D=0;D<this._tasks.length;D++){var w=this._tasks[D];w.taskState===Jp.INIT&&this._runTask(w)}return this},e.prototype.loadAsync=function(){var D=this;return new Promise((function(w,N){D._isLoading?w():(D.onTasksDoneObservable.addOnce((function(D){D&&D.length?N(D):w()})),D.load())}))},e}(),g_=function(){function e(){var D=this;this.promise=new Promise((function(w,N){D._resolve=w,D._reject=N}))}return Object.defineProperty(e.prototype,"resolve",{get:function(){return this._resolve},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reject",{get:function(){return this._reject},enumerable:!0,configurable:!0}),e}(),v_=function(){function e(D,w){this._meshesOrigins=[],this._toCenterVectors=[],this._scaledDirection=z.e.Zero(),this._newPosition=z.e.Zero(),this._centerPosition=z.e.Zero(),this._meshes=D.slice(),w?this._centerMesh=w:this._setCenterMesh();var N=this._meshes.indexOf(this._centerMesh);N>=0&&this._meshes.splice(N,1),this._centerPosition=this._centerMesh.getAbsolutePosition().clone();for(var F=0;F<this._meshes.length;F++)if(this._meshes[F]){var k=this._meshes[F];this._meshesOrigins[F]=k.getAbsolutePosition().clone(),this._toCenterVectors[F]=z.e.Zero(),k._boundingInfo&&this._centerMesh._boundingInfo&&k._boundingInfo.boundingBox.centerWorld.subtractToRef(this._centerMesh._boundingInfo.boundingBox.centerWorld,this._toCenterVectors[F])}}return e.prototype._setCenterMesh=function(){for(var D=z.e.Zero(),w=z.e.Zero(),N=Number.MAX_VALUE,F=0;F<this._meshes.length;F++)this._meshes[F]&&(j=(k=this._meshes[F]).getBoundingInfo())&&w.addInPlace(j.boundingBox.centerWorld);for(D=w.scale(1/this._meshes.length),F=0;F<this._meshes.length;F++){var k,j;if(this._meshes[F]&&(j=(k=this._meshes[F]).getBoundingInfo())){var G=j.boundingBox.centerWorld.subtract(D).lengthSquared();G<N&&(this._centerMesh=k,N=G)}}},e.prototype.getClassName=function(){return"MeshExploder"},e.prototype.getMeshes=function(){var D=this._meshes.slice();return D.unshift(this._centerMesh),D},e.prototype.explode=function(D){void 0===D&&(D=1);for(var w=0;w<this._meshes.length;w++)this._meshes[w]&&this._meshesOrigins[w]&&this._toCenterVectors[w]&&(this._toCenterVectors[w].scaleToRef(D,this._scaledDirection),this._meshesOrigins[w].addToRef(this._scaledDirection,this._newPosition),this._meshes[w].setAbsolutePosition(this._newPosition));this._centerMesh.setAbsolutePosition(this._centerPosition)},e}(),y_=function(){function e(D,w,N,F,k,j,z,G,H){this.onProcessFileCallback=function(){return!0},this._engine=D,this._currentScene=w,this._sceneLoadedCallback=N,this._progressCallback=F,this._additionalRenderLoopLogicCallback=k,this._textureLoadingCallback=j,this._startingProcessingFilesCallback=z,this._onReloadCallback=G,this._errorCallback=H}return Object.defineProperty(e,"FilesToLoad",{get:function(){return eo.a.FilesToLoad},enumerable:!0,configurable:!0}),e.prototype.monitorElementForDragNDrop=function(D){var w=this;D&&(this._elementToMonitor=D,this._dragEnterHandler=function(D){w.drag(D)},this._dragOverHandler=function(D){w.drag(D)},this._dropHandler=function(D){w.drop(D)},this._elementToMonitor.addEventListener("dragenter",this._dragEnterHandler,!1),this._elementToMonitor.addEventListener("dragover",this._dragOverHandler,!1),this._elementToMonitor.addEventListener("drop",this._dropHandler,!1))},e.prototype.dispose=function(){this._elementToMonitor&&(this._elementToMonitor.removeEventListener("dragenter",this._dragEnterHandler),this._elementToMonitor.removeEventListener("dragover",this._dragOverHandler),this._elementToMonitor.removeEventListener("drop",this._dropHandler))},e.prototype.renderFunction=function(){if(this._additionalRenderLoopLogicCallback&&this._additionalRenderLoopLogicCallback(),this._currentScene){if(this._textureLoadingCallback){var D=this._currentScene.getWaitingItemsCount();D>0&&this._textureLoadingCallback(D)}this._currentScene.render()}},e.prototype.drag=function(D){D.stopPropagation(),D.preventDefault()},e.prototype.drop=function(D){D.stopPropagation(),D.preventDefault(),this.loadFiles(D)},e.prototype._traverseFolder=function(D,w,N,F){var k=this,j=D.createReader(),z=D.fullPath.replace(/^\//,"").replace(/(.+?)\/?$/,"$1/");j.readEntries((function(D){N.count+=D.length;for(var j=0,G=D;j<G.length;j++){var H=G[j];H.isFile?H.file((function(D){D.correctName=z+D.name,w.push(D),0==--N.count&&F()})):H.isDirectory&&k._traverseFolder(H,w,N,F)}--N.count&&F()}))},e.prototype._processFiles=function(D){for(var w=0;w<D.length;w++){var N=D[w].correctName.toLowerCase(),F=N.split(".").pop();this.onProcessFileCallback(D[w],N,F)&&("babylon"!==F&&"stl"!==F&&"obj"!==F&&"gltf"!==F&&"glb"!==F||-1!==N.indexOf(".binary.babylon")||-1!==N.indexOf(".incremental.babylon")||(this._sceneFileToLoad=D[w]),e.FilesToLoad[N]=D[w])}},e.prototype.loadFiles=function(D){var w=this;if(D&&D.dataTransfer&&D.dataTransfer.files&&(this._filesToLoad=D.dataTransfer.files),D&&D.target&&D.target.files&&(this._filesToLoad=D.target.files),this._filesToLoad&&0!==this._filesToLoad.length&&(this._startingProcessingFilesCallback&&this._startingProcessingFilesCallback(this._filesToLoad),this._filesToLoad&&this._filesToLoad.length>0)){for(var N=new Array,F=[],k=D.dataTransfer?D.dataTransfer.items:null,j=0;j<this._filesToLoad.length;j++){var z=this._filesToLoad[j],G=z.name.toLowerCase(),H=void 0;if(z.correctName=G,k){var X=k[j];X.getAsEntry?H=X.getAsEntry():X.webkitGetAsEntry&&(H=X.webkitGetAsEntry())}H&&H.isDirectory?F.push(H):N.push(z)}if(0===F.length)this._processFiles(N),this._processReload();else for(var q={count:F.length},Z=0,J=F;Z<J.length;Z++){var $=J[Z];this._traverseFolder($,N,q,(function(){w._processFiles(N),0===q.count&&w._processReload()}))}}},e.prototype._processReload=function(){this._onReloadCallback?this._onReloadCallback(this._sceneFileToLoad):this.reload()},e.prototype.reload=function(){var D=this;this._sceneFileToLoad?(this._currentScene&&(oe.a.errorsCount>0&&oe.a.ClearLogCache(),this._engine.stopRenderLoop()),ro.LoadAsync("file:",this._sceneFileToLoad,this._engine,(function(w){D._progressCallback&&D._progressCallback(w)})).then((function(w){D._currentScene&&D._currentScene.dispose(),D._currentScene=w,D._sceneLoadedCallback&&D._sceneLoadedCallback(D._sceneFileToLoad,D._currentScene),D._currentScene.executeWhenReady((function(){D._engine.runRenderLoop((function(){D.renderFunction()}))}))})).catch((function(w){D._errorCallback&&D._errorCallback(D._sceneFileToLoad,D._currentScene,w.message)}))):oe.a.Error("Please provide a valid .babylon file.")},e}(),b_=N(132),T_=N(131),E_=function(){function e(D){void 0===D&&(D=0),this.priority=D}return e.prototype.getDescription=function(){return""},e.prototype.apply=function(D,w){return!0},e}(),S_=function(D){function t(w,N,F){void 0===w&&(w=0),void 0===N&&(N=1024),void 0===F&&(F=.5);var k=D.call(this,w)||this;return k.priority=w,k.maximumSize=N,k.step=F,k}return Object(Z.d)(t,D),t.prototype.getDescription=function(){return"Reducing render target texture size to "+this.maximumSize},t.prototype.apply=function(D,w){for(var N=!0,F=0;F<D.textures.length;F++){var k=D.textures[F];if(k.canRescale&&!k.getContext){var j=k.getSize();Math.max(j.width,j.height)>this.maximumSize&&(k.scale(this.step),N=!1)}}return N},t}(E_),M_=function(D){function t(w,N,F){void 0===w&&(w=0),void 0===N&&(N=2),void 0===F&&(F=.25);var k=D.call(this,w)||this;return k.priority=w,k.maximumScale=N,k.step=F,k._currentScale=-1,k._directionOffset=1,k}return Object(Z.d)(t,D),t.prototype.getDescription=function(){return"Setting hardware scaling level to "+this._currentScale},t.prototype.apply=function(D,w){return-1===this._currentScale&&(this._currentScale=D.getEngine().getHardwareScalingLevel(),this._currentScale>this.maximumScale&&(this._directionOffset=-1)),this._currentScale+=this._directionOffset*this.step,D.getEngine().setHardwareScalingLevel(this._currentScale),1===this._directionOffset?this._currentScale>=this.maximumScale:this._currentScale<=this.maximumScale},t}(E_),x_=function(D){function t(){return null!==D&&D.apply(this,arguments)||this}return Object(Z.d)(t,D),t.prototype.getDescription=function(){return"Turning shadows on/off"},t.prototype.apply=function(D,w){return D.shadowsEnabled=w.isInImprovementMode,!0},t}(E_),A_=function(D){function t(){return null!==D&&D.apply(this,arguments)||this}return Object(Z.d)(t,D),t.prototype.getDescription=function(){return"Turning post-processes on/off"},t.prototype.apply=function(D,w){return D.postProcessesEnabled=w.isInImprovementMode,!0},t}(E_),P_=function(D){function t(){return null!==D&&D.apply(this,arguments)||this}return Object(Z.d)(t,D),t.prototype.getDescription=function(){return"Turning lens flares on/off"},t.prototype.apply=function(D,w){return D.lensFlaresEnabled=w.isInImprovementMode,!0},t}(E_),C_=function(D){function t(){return null!==D&&D.apply(this,arguments)||this}return Object(Z.d)(t,D),t.prototype.getDescription=function(){return this.onGetDescription?this.onGetDescription():"Running user defined callback"},t.prototype.apply=function(D,w){return!this.onApply||this.onApply(D,w)},t}(E_),O_=function(D){function t(){return null!==D&&D.apply(this,arguments)||this}return Object(Z.d)(t,D),t.prototype.getDescription=function(){return"Turning particles on/off"},t.prototype.apply=function(D,w){return D.particlesEnabled=w.isInImprovementMode,!0},t}(E_),R_=function(D){function t(){return null!==D&&D.apply(this,arguments)||this}return Object(Z.d)(t,D),t.prototype.getDescription=function(){return"Turning render targets off"},t.prototype.apply=function(D,w){return D.renderTargetsEnabled=w.isInImprovementMode,!0},t}(E_),D_=function(D){function t(){var w=null!==D&&D.apply(this,arguments)||this;return w._canBeMerged=function(D){if(!(D instanceof xt.a))return!1;var w=D;return!(w.isDisposed()||!w.isVisible||!w.isEnabled()||w.instances.length>0||w.skeleton||w.hasLODLevels)},w}return Object(Z.d)(t,D),Object.defineProperty(t,"UpdateSelectionTree",{get:function(){return t._UpdateSelectionTree},set:function(D){t._UpdateSelectionTree=D},enumerable:!0,configurable:!0}),t.prototype.getDescription=function(){return"Merging similar meshes together"},t.prototype.apply=function(D,w,N){for(var F=D.meshes.slice(0),k=F.length,j=0;j<k;j++){var z=new Array,G=F[j];if(this._canBeMerged(G)){z.push(G);for(var H=j+1;H<k;H++){var X=F[H];this._canBeMerged(X)&&X.material===G.material&&X.checkCollisions===G.checkCollisions&&(z.push(X),k--,F.splice(H,1),H--)}z.length<2||xt.a.MergeMeshes(z,void 0,!0)}}var q=D;return q.createOrUpdateSelectionOctree&&(null!=N?N&&q.createOrUpdateSelectionOctree():t.UpdateSelectionTree&&q.createOrUpdateSelectionOctree()),!0},t._UpdateSelectionTree=!1,t}(E_),I_=function(){function e(D,w){void 0===D&&(D=60),void 0===w&&(w=2e3),this.targetFrameRate=D,this.trackerDuration=w,this.optimizations=new Array}return e.prototype.addOptimization=function(D){return this.optimizations.push(D),this},e.prototype.addCustomOptimization=function(D,w,N){void 0===N&&(N=0);var F=new C_(N);return F.onApply=D,F.onGetDescription=w,this.optimizations.push(F),this},e.LowDegradationAllowed=function(D){var w=new e(D),N=0;return w.addOptimization(new D_(N)),w.addOptimization(new x_(N)),w.addOptimization(new P_(N)),N++,w.addOptimization(new A_(N)),w.addOptimization(new O_(N)),N++,w.addOptimization(new S_(N,1024)),w},e.ModerateDegradationAllowed=function(D){var w=new e(D),N=0;return w.addOptimization(new D_(N)),w.addOptimization(new x_(N)),w.addOptimization(new P_(N)),N++,w.addOptimization(new A_(N)),w.addOptimization(new O_(N)),N++,w.addOptimization(new S_(N,512)),N++,w.addOptimization(new R_(N)),N++,w.addOptimization(new M_(N,2)),w},e.HighDegradationAllowed=function(D){var w=new e(D),N=0;return w.addOptimization(new D_(N)),w.addOptimization(new x_(N)),w.addOptimization(new P_(N)),N++,w.addOptimization(new A_(N)),w.addOptimization(new O_(N)),N++,w.addOptimization(new S_(N,256)),N++,w.addOptimization(new R_(N)),N++,w.addOptimization(new M_(N,4)),w},e}(),L_=function(){function e(D,w,N,F){var k=this;if(void 0===N&&(N=!0),void 0===F&&(F=!1),this._isRunning=!1,this._currentPriorityLevel=0,this._targetFrameRate=60,this._trackerDuration=2e3,this._currentFrameRate=0,this._improvementMode=!1,this.onSuccessObservable=new j.c,this.onNewOptimizationAppliedObservable=new j.c,this.onFailureObservable=new j.c,this._options=w||new I_,this._options.targetFrameRate&&(this._targetFrameRate=this._options.targetFrameRate),this._options.trackerDuration&&(this._trackerDuration=this._options.trackerDuration),N)for(var z=0,G=0,H=this._options.optimizations;G<H.length;G++)H[G].priority=z++;this._improvementMode=F,this._scene=D||Me.a.LastCreatedScene,this._sceneDisposeObserver=this._scene.onDisposeObservable.add((function(){k._sceneDisposeObserver=null,k.dispose()}))}return Object.defineProperty(e.prototype,"isInImprovementMode",{get:function(){return this._improvementMode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentPriorityLevel",{get:function(){return this._currentPriorityLevel},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentFrameRate",{get:function(){return this._currentFrameRate},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"targetFrameRate",{get:function(){return this._targetFrameRate},set:function(D){this._targetFrameRate=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"trackerDuration",{get:function(){return this._trackerDuration},set:function(D){this._trackerDuration=D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"optimizations",{get:function(){return this._options.optimizations},enumerable:!0,configurable:!0}),e.prototype.stop=function(){this._isRunning=!1},e.prototype.reset=function(){this._currentPriorityLevel=0},e.prototype.start=function(){var D=this;this._isRunning||(this._isRunning=!0,this._scene.executeWhenReady((function(){setTimeout((function(){D._checkCurrentState()}),D._trackerDuration)})))},e.prototype._checkCurrentState=function(){var D=this;if(this._isRunning){var w=this._scene,N=this._options;if(this._currentFrameRate=Math.round(w.getEngine().getFps()),this._improvementMode&&this._currentFrameRate<=this._targetFrameRate||!this._improvementMode&&this._currentFrameRate>=this._targetFrameRate)return this._isRunning=!1,void this.onSuccessObservable.notifyObservers(this);for(var F=!0,k=!0,j=0;j<N.optimizations.length;j++){var z=N.optimizations[j];z.priority===this._currentPriorityLevel&&(k=!1,F=F&&z.apply(w,this),this.onNewOptimizationAppliedObservable.notifyObservers(z))}if(k)return this._isRunning=!1,void this.onFailureObservable.notifyObservers(this);F&&this._currentPriorityLevel++,w.executeWhenReady((function(){setTimeout((function(){D._checkCurrentState()}),D._trackerDuration)}))}},e.prototype.dispose=function(){this.stop(),this.onSuccessObservable.clear(),this.onFailureObservable.clear(),this.onNewOptimizationAppliedObservable.clear(),this._sceneDisposeObserver&&this._scene.onDisposeObservable.remove(this._sceneDisposeObserver)},e.OptimizeAsync=function(D,w,N,F){var k=new e(D,w||I_.ModerateDegradationAllowed(),!1);return N&&k.onSuccessObservable.add((function(){N()})),F&&k.onFailureObservable.add((function(){F()})),k.start(),k},e}(),w_=[],wf=function(D,w){w_[D.id]||D.doNotSerialize||(w.vertexData.push(D.serializeVerticeData()),w_[D.id]=!0)},Lf=function(D,w){var N={},F=D._geometry;return F&&(D.getScene().getGeometryByID(F.id)||wf(F,w.geometries)),D.serialize&&D.serialize(N),N},N_=function(){function e(){}return e.ClearCache=function(){w_=[]},e.Serialize=function(D){var w,N,F,k={};if(e.ClearCache(),k.useDelayedTextureLoading=D.useDelayedTextureLoading,k.autoClear=D.autoClear,k.clearColor=D.clearColor.asArray(),k.ambientColor=D.ambientColor.asArray(),k.gravity=D.gravity.asArray(),k.collisionsEnabled=D.collisionsEnabled,D.fogMode&&0!==D.fogMode&&(k.fogMode=D.fogMode,k.fogColor=D.fogColor.asArray(),k.fogStart=D.fogStart,k.fogEnd=D.fogEnd,k.fogDensity=D.fogDensity),D.isPhysicsEnabled()){var j=D.getPhysicsEngine();j&&(k.physicsEnabled=!0,k.physicsGravity=j.gravity.asArray(),k.physicsEngine=j.getPhysicsPluginName())}D.metadata&&(k.metadata=D.metadata),k.morphTargetManagers=[];for(var z=0,G=D.meshes;z<G.length;z++){var H=(he=G[z]).morphTargetManager;H&&k.morphTargetManagers.push(H.serialize())}for(k.lights=[],w=0;w<D.lights.length;w++)(N=D.lights[w]).doNotSerialize||k.lights.push(N.serialize());for(k.cameras=[],w=0;w<D.cameras.length;w++){var X=D.cameras[w];X.doNotSerialize||k.cameras.push(X.serialize())}if(D.activeCamera&&(k.activeCameraID=D.activeCamera.id),Ie.a.AppendSerializedAnimations(D,k),D.animationGroups&&D.animationGroups.length>0){k.animationGroups=[];for(var q=0;q<D.animationGroups.length;q++){var Z=D.animationGroups[q];k.animationGroups.push(Z.serialize())}}if(D.reflectionProbes&&D.reflectionProbes.length>0)for(k.reflectionProbes=[],w=0;w<D.reflectionProbes.length;w++){var J=D.reflectionProbes[w];k.reflectionProbes.push(J.serialize())}for(k.materials=[],k.multiMaterials=[],w=0;w<D.materials.length;w++)(F=D.materials[w]).doNotSerialize||k.materials.push(F.serialize());for(k.multiMaterials=[],w=0;w<D.multiMaterials.length;w++){var $=D.multiMaterials[w];k.multiMaterials.push($.serialize())}for(D.environmentTexture&&(k.environmentTexture=D.environmentTexture.name),k.environmentIntensity=D.environmentIntensity,k.skeletons=[],w=0;w<D.skeletons.length;w++){var te=D.skeletons[w];te.doNotSerialize||k.skeletons.push(te.serialize())}for(k.transformNodes=[],w=0;w<D.transformNodes.length;w++)D.transformNodes[w].doNotSerialize||k.transformNodes.push(D.transformNodes[w].serialize());k.geometries={},k.geometries.boxes=[],k.geometries.spheres=[],k.geometries.cylinders=[],k.geometries.toruses=[],k.geometries.grounds=[],k.geometries.planes=[],k.geometries.torusKnots=[],k.geometries.vertexData=[],w_=[];var ie=D.getGeometries();for(w=0;w<ie.length;w++){var oe=ie[w];oe.isReady()&&wf(oe,k.geometries)}for(k.meshes=[],w=0;w<D.meshes.length;w++){var he;if((he=D.meshes[w])instanceof xt.a){var fe=he;fe.doNotSerialize||fe.delayLoadState!==ce.a.DELAYLOADSTATE_LOADED&&fe.delayLoadState!==ce.a.DELAYLOADSTATE_NONE||k.meshes.push(Lf(fe,k))}}for(k.particleSystems=[],w=0;w<D.particleSystems.length;w++)k.particleSystems.push(D.particleSystems[w].serialize());D.actionManager&&(k.actions=D.actionManager.serialize("scene"));for(var pe=0,_e=D._serializableComponents;pe<_e.length;pe++)_e[pe].serialize(k);return k},e.SerializeMesh=function(D,w,N){void 0===w&&(w=!1),void 0===N&&(N=!1);var F={};if(e.ClearCache(),D=D instanceof Array?D:[D],w||N)for(var k=0;k<D.length;++k)N&&D[k].getDescendants().forEach((function(w){w instanceof xt.a&&D.indexOf(w)<0&&!w.doNotSerialize&&D.push(w)})),w&&D[k].parent&&D.indexOf(D[k].parent)<0&&!D[k].parent.doNotSerialize&&D.push(D[k].parent);return D.forEach((function(D){!function(D,w){if(D.delayLoadState===ce.a.DELAYLOADSTATE_LOADED||D.delayLoadState===ce.a.DELAYLOADSTATE_NONE){if(D.material&&!D.material.doNotSerialize)if(D.material instanceof rc.a){if(w.multiMaterials=w.multiMaterials||[],w.materials=w.materials||[],!w.multiMaterials.some((function(w){return w.id===D.material.id}))){w.multiMaterials.push(D.material.serialize());for(var i=function(D){D&&(w.materials.some((function(w){return w.id===D.id}))||w.materials.push(D.serialize()))},N=0,F=D.material.subMaterials;N<F.length;N++)i(F[N])}}else w.materials=w.materials||[],w.materials.some((function(w){return w.id===D.material.id}))||w.materials.push(D.material.serialize());var k=D._geometry;k&&(w.geometries||(w.geometries={},w.geometries.boxes=[],w.geometries.spheres=[],w.geometries.cylinders=[],w.geometries.toruses=[],w.geometries.grounds=[],w.geometries.planes=[],w.geometries.torusKnots=[],w.geometries.vertexData=[]),wf(k,w.geometries)),D.skeleton&&!D.skeleton.doNotSerialize&&(w.skeletons=w.skeletons||[],w.skeletons.push(D.skeleton.serialize())),w.meshes=w.meshes||[],w.meshes.push(Lf(D,w))}}(D,F)})),F},e}(),F_=N(35),B_=function(){function e(){}return e.CreateResizedCopy=function(D,w,N,F){void 0===F&&(F=!0);var k=D.getScene(),j=k.getEngine(),z=new Li("resized"+D.name,{width:w,height:N},k,!D.noMipmap,!0,D._texture.type,!1,D.samplingMode,!1);z.wrapU=D.wrapU,z.wrapV=D.wrapV,z.uOffset=D.uOffset,z.vOffset=D.vOffset,z.uScale=D.uScale,z.vScale=D.vScale,z.uAng=D.uAng,z.vAng=D.vAng,z.wAng=D.wAng,z.coordinatesIndex=D.coordinatesIndex,z.level=D.level,z.anisotropicFilteringLevel=D.anisotropicFilteringLevel,z._texture.isReady=!1,D.wrapU=Jt.a.CLAMP_ADDRESSMODE,D.wrapV=Jt.a.CLAMP_ADDRESSMODE;var G=new pi("pass",1,null,F?Jt.a.BILINEAR_SAMPLINGMODE:Jt.a.NEAREST_SAMPLINGMODE,j,!1,ce.a.TEXTURETYPE_UNSIGNED_INT);return G.getEffect().executeWhenCompiled((function(){G.onApply=function(w){w.setTexture("textureSampler",D)};var w=z.getInternalTexture();w&&(k.postProcessManager.directRender([G],w),j.unBindFramebuffer(w),z.disposeFramebufferObjects(),G.dispose(),w.isReady=!0)})),z},e}(),k_=function(){function e(D,w){if(void 0===w&&(w=null),!e.IsSupported(D))throw"Your browser does not support recording so far.";var N=D.getRenderingCanvas();if(!N)throw"The babylon engine must have a canvas to be recorded";this._canvas=N,this._canvas.isRecording=!1,this._options=Object(Z.a)(Object(Z.a)({},e._defaultOptions),w);var F=this._canvas.captureStream(this._options.fps);if(this._options.audioTracks)for(var k=0,j=this._options.audioTracks;k<j.length;k++){var z=j[k];F.addTrack(z)}this._mediaRecorder=new MediaRecorder(F,{mimeType:this._options.mimeType}),this._mediaRecorder.ondataavailable=this._handleDataAvailable.bind(this),this._mediaRecorder.onerror=this._handleError.bind(this),this._mediaRecorder.onstop=this._handleStop.bind(this)}return e.IsSupported=function(D){var w=D.getRenderingCanvas();return!!w&&"function"==typeof w.captureStream},Object.defineProperty(e.prototype,"isRecording",{get:function(){return!!this._canvas&&this._canvas.isRecording},enumerable:!0,configurable:!0}),e.prototype.stopRecording=function(){this._canvas&&this._mediaRecorder&&this.isRecording&&(this._canvas.isRecording=!1,this._mediaRecorder.stop())},e.prototype.startRecording=function(D,w){var N=this;if(void 0===D&&(D="babylonjs.webm"),void 0===w&&(w=7),!this._canvas||!this._mediaRecorder)throw"Recorder has already been disposed";if(this.isRecording)throw"Recording already in progress";return w>0&&setTimeout((function(){N.stopRecording()}),1e3*w),this._fileName=D,this._recordedChunks=[],this._resolve=null,this._reject=null,this._canvas.isRecording=!0,this._mediaRecorder.start(this._options.recordChunckSize),new Promise((function(D,w){N._resolve=D,N._reject=w}))},e.prototype.dispose=function(){this._canvas=null,this._mediaRecorder=null,this._recordedChunks=[],this._fileName=null,this._resolve=null,this._reject=null},e.prototype._handleDataAvailable=function(D){D.data.size>0&&this._recordedChunks.push(D.data)},e.prototype._handleError=function(D){if(this.stopRecording(),!this._reject)throw new D.error;this._reject(D.error)},e.prototype._handleStop=function(){this.stopRecording();var D=new Blob(this._recordedChunks);this._resolve&&this._resolve(D),window.URL.createObjectURL(D),this._fileName&&Dt.b.Download(D,this._fileName)},e._defaultOptions={mimeType:"video/webm",fps:25,recordChunckSize:3e3},e}(),U_=function(){function e(){}return e.CreateScreenshot=function(D,w,N,F,k){void 0===k&&(k="image/png");var j=e._getScreenshotSize(D,w,N),z=j.height,G=j.width;if(z&&G){Dt.b._ScreenshotCanvas||(Dt.b._ScreenshotCanvas=document.createElement("canvas")),Dt.b._ScreenshotCanvas.width=G,Dt.b._ScreenshotCanvas.height=z;var H=Dt.b._ScreenshotCanvas.getContext("2d"),X=D.getRenderWidth()/D.getRenderHeight(),q=G,Z=q/X;Z>z&&(q=(Z=z)*X);var J=Math.max(0,G-q)/2,$=Math.max(0,z-Z)/2,te=D.getRenderingCanvas();H&&te&&H.drawImage(te,J,$,q,Z),Dt.b.EncodeScreenshotCanvasData(F,k)}else oe.a.Error("Invalid 'size' parameter !")},e.CreateScreenshotAsync=function(D,w,N,F){return void 0===F&&(F="image/png"),new Promise((function(k,j){e.CreateScreenshot(D,w,N,(function(D){void 0!==D?k(D):j(new Error("Data is undefined"))}),F)}))},e.CreateScreenshotUsingRenderTarget=function(D,w,N,F,k,j,z,G,H){void 0===k&&(k="image/png"),void 0===j&&(j=1),void 0===z&&(z=!1),void 0===H&&(H=!1);var X=e._getScreenshotSize(D,w,N),q=X.height,Z=X.width,J={width:Z,height:q};if(q&&Z){var $=w.getScene(),te=null;$.activeCamera!==w&&(te=$.activeCamera,$.activeCamera=w);var ie=D.getRenderingCanvas();if(ie){var he={width:ie.width,height:ie.height};D.setSize(Z,q),$.render();var fe=new Li("screenShot",J,$,!1,!1,ce.a.TEXTURETYPE_UNSIGNED_INT,!1,Jt.a.NEAREST_SAMPLINGMODE);fe.renderList=null,fe.samples=j,fe.renderSprites=H,fe.onAfterRenderObservable.add((function(){Dt.b.DumpFramebuffer(Z,q,D,F,k,G)}));var T=function(){$.incrementRenderId(),$.resetCachedMaterial(),fe.render(!0),fe.dispose(),te&&($.activeCamera=te),D.setSize(he.width,he.height),w.getProjectionMatrix(!0)};if(z){var pe=new Sp("antialiasing",1,$.activeCamera);fe.addPostProcess(pe),pe.getEffect().isReady()?T():pe.getEffect().onCompiled=function(){T()}}else T()}else oe.a.Error("No rendering canvas found !")}else oe.a.Error("Invalid 'size' parameter !")},e.CreateScreenshotUsingRenderTargetAsync=function(D,w,N,F,k,j,z,G){return void 0===F&&(F="image/png"),void 0===k&&(k=1),void 0===j&&(j=!1),void 0===G&&(G=!1),new Promise((function(H,X){e.CreateScreenshotUsingRenderTarget(D,w,N,(function(D){void 0!==D?H(D):X(new Error("Data is undefined"))}),F,k,j,z,G)}))},e._getScreenshotSize=function(D,w,N){var F=0,k=0;if("object"==typeof N){var j=N.precision?Math.abs(N.precision):1;N.width&&N.height?(F=N.height*j,k=N.width*j):N.width&&!N.height?(k=N.width*j,F=Math.round(k/D.getAspectRatio(w))):N.height&&!N.width?(F=N.height*j,k=Math.round(F*D.getAspectRatio(w))):(k=Math.round(D.getRenderWidth()*j),F=Math.round(k/D.getAspectRatio(w)))}else isNaN(N)||(F=N,k=N);return k&&(k=Math.floor(k)),F&&(F=Math.floor(F)),{height:0|F,width:0|k}},e}();Dt.b.CreateScreenshot=U_.CreateScreenshot,Dt.b.CreateScreenshotAsync=U_.CreateScreenshotAsync,Dt.b.CreateScreenshotUsingRenderTarget=U_.CreateScreenshotUsingRenderTarget,Dt.b.CreateScreenshotUsingRenderTargetAsync=U_.CreateScreenshotUsingRenderTargetAsync,function(D){D[D.Checkbox=0]="Checkbox",D[D.Slider=1]="Slider",D[D.Vector3=2]="Vector3",D[D.Quaternion=3]="Quaternion",D[D.Color3=4]="Color3",D[D.String=5]="String"}(o_||(o_={}));var V_=N(126),j_=function(){function e(D){this.byteOffset=0,this.buffer=D}return e.prototype.loadAsync=function(D){var w=this;return delete this._dataView,delete this._dataByteOffset,this.buffer.readAsync(this.byteOffset,D).then((function(D){w._dataView=new DataView(D.buffer,D.byteOffset,D.byteLength),w._dataByteOffset=0}))},e.prototype.readUint32=function(){var D=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,D},e.prototype.readUint8Array=function(D){var w=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,D);return this._dataByteOffset+=D,this.byteOffset+=D,w},e.prototype.readString=function(D){return Uo.a.Decode(this.readUint8Array(D))},e.prototype.skipBytes=function(D){this._dataByteOffset+=D,this.byteOffset+=D},e}(),z_=function(D){function t(w,N){void 0===N&&(N={});var F=D.call(this,w)||this;return F.options=N,F._direction=new z.e(0,0,-1),F._mat=new z.a,F._onSelectEnabled=!1,F._origin=new z.e(0,0,0),F.lastNativeXRHitResults=[],F.onHitTestResultObservable=new j.c,F._onHitTestResults=function(D){var w=D.map((function(D){var w=z.a.FromArray(D.hitMatrix);return F._xrSessionManager.scene.useRightHandedSystem||w.toggleModelMatrixHandInPlace(),F.options.worldParentNode&&w.multiplyToRef(F.options.worldParentNode.getWorldMatrix(),w),{xrHitResult:D,transformationMatrix:w}}));F.lastNativeXRHitResults=D,F.onHitTestResultObservable.notifyObservers(w)},F._onSelect=function(D){F._onSelectEnabled&&t.XRHitTestWithSelectEvent(D,F._xrSessionManager.referenceSpace)},F}return Object(Z.d)(t,D),t.XRHitTestWithRay=function(D,w,N,F){return D.requestHitTest(w,N).then((function(D){var w=F||function(D){return!!D.hitMatrix};return D.filter(w)}))},t.XRHitTestWithSelectEvent=function(D,w){var N=D.frame.getPose(D.inputSource.targetRaySpace,w);if(!N)return Promise.resolve([]);var F=new XRRay(N.transform);return this.XRHitTestWithRay(D.frame.session,F,w)},t.prototype.attach=function(){return!!D.prototype.attach.call(this)&&(this.options.testOnPointerDownOnly&&this._xrSessionManager.session.addEventListener("select",this._onSelect,!1),!0)},t.prototype.detach=function(){return!!D.prototype.detach.call(this)&&(this._onSelectEnabled=!1,this._xrSessionManager.session.removeEventListener("select",this._onSelect),!0)},t.prototype.dispose=function(){D.prototype.dispose.call(this),this.onHitTestResultObservable.clear()},t.prototype._onXRFrame=function(D){if(this.attached&&!this.options.testOnPointerDownOnly){var w=D.getViewerPose(this._xrSessionManager.referenceSpace);if(w){z.a.FromArrayToRef(w.transform.matrix,0,this._mat),z.e.TransformCoordinatesFromFloatsToRef(0,0,0,this._mat,this._origin),z.e.TransformCoordinatesFromFloatsToRef(0,0,-1,this._mat,this._direction),this._direction.subtractInPlace(this._origin),this._direction.normalize();var N=new XRRay({x:this._origin.x,y:this._origin.y,z:this._origin.z,w:0},{x:this._direction.x,y:this._direction.y,z:this._direction.z,w:0});t.XRHitTestWithRay(this._xrSessionManager.session,N,this._xrSessionManager.referenceSpace).then(this._onHitTestResults)}}},t.Name=es.HIT_TEST,t.Version=1,t}(fs);ts.AddWebXRFeature(z_.Name,(function(D,w){return function(){return new z_(D,w)}}),z_.Version,!0);var G_=0,Y_=function(D){function t(w,N){void 0===N&&(N={});var F=D.call(this,w)||this;return F._options=N,F._enabled=!1,F._lastFrameDetected=new Set,F._onSelect=function(D){if(F._options.addAnchorOnSelect){var t=function(D){if(D.length){var w=D[0],N=new XRRigidTransform(w.hitMatrix);F.addAnchorAtRigidTransformation(N)}};F._hitTestModule&&!F._hitTestModule.options.testOnPointerDownOnly&&t(F._hitTestModule.lastNativeXRHitResults),z_.XRHitTestWithSelectEvent(D,F._xrSessionManager.referenceSpace).then(t),F._planeDetector}},F._trackedAnchors=[],F.onAnchorAddedObservable=new j.c,F.onAnchorRemovedObservable=new j.c,F.onAnchorUpdatedObservable=new j.c,F}return Object(Z.d)(t,D),t.prototype.addAnchorAtRigidTransformation=function(D,w){return(w||this._xrSessionManager.session).createAnchor(D,this._xrSessionManager.referenceSpace)},t.prototype.attach=function(){return!!D.prototype.attach.call(this)&&(this._options.addAnchorOnSelect&&this._xrSessionManager.session.addEventListener("select",this._onSelect,!1),!0)},t.prototype.detach=function(){return!!D.prototype.detach.call(this)&&(this._xrSessionManager.session.removeEventListener("select",this._onSelect),!0)},t.prototype.dispose=function(){D.prototype.dispose.call(this),this.onAnchorAddedObservable.clear(),this.onAnchorRemovedObservable.clear(),this.onAnchorUpdatedObservable.clear()},t.prototype.setHitTestModule=function(D){this._hitTestModule=D},t.prototype.setPlaneDetector=function(D,w){void 0===w&&(w=!0),this._planeDetector=D,this._options.usePlaneDetection=w},t.prototype._onXRFrame=function(D){var w=this;if(this.attached&&this._enabled&&D){var N=D.trackedAnchors;N&&N.size&&(this._trackedAnchors.filter((function(D){return!N.has(D.xrAnchor)})).map((function(D){var N=w._trackedAnchors.indexOf(D);w._trackedAnchors.splice(N,1),w.onAnchorRemovedObservable.notifyObservers(D)})),N.forEach((function(N){if(w._lastFrameDetected.has(N)){if(N.lastChangedTime===w._xrSessionManager.currentTimestamp){var F=w._findIndexInAnchorArray(N),k=w._trackedAnchors[F];w._updateAnchorWithXRFrame(N,k,D),w.onAnchorUpdatedObservable.notifyObservers(k)}}else{var j={id:G_++,xrAnchor:N},z=w._updateAnchorWithXRFrame(N,j,D);w._trackedAnchors.push(z),w.onAnchorAddedObservable.notifyObservers(z)}})),this._lastFrameDetected=N)}},t.prototype._findIndexInAnchorArray=function(D){for(var w=0;w<this._trackedAnchors.length;++w)if(this._trackedAnchors[w].xrAnchor===D)return w;return-1},t.prototype._updateAnchorWithXRFrame=function(D,w,N){var F=N.getPose(D.anchorSpace,this._xrSessionManager.referenceSpace);if(F){var k=w.transformationMatrix||new z.a;z.a.FromArrayToRef(F.transform.matrix,0,k),this._xrSessionManager.scene.useRightHandedSystem||k.toggleModelMatrixHandInPlace(),w.transformationMatrix=k,this._options.worldParentNode&&k.multiplyToRef(this._options.worldParentNode.getWorldMatrix(),k)}return w},t.Name=es.ANCHOR_SYSTEM,t.Version=1,t}(fs),H_=0,W_=function(D){function t(w,N){void 0===N&&(N={});var F=D.call(this,w)||this;return F._options=N,F._detectedPlanes=[],F._enabled=!1,F._lastFrameDetected=new Set,F.onPlaneAddedObservable=new j.c,F.onPlaneRemovedObservable=new j.c,F.onPlaneUpdatedObservable=new j.c,F._xrSessionManager.session?F._init():F._xrSessionManager.onXRSessionInit.addOnce((function(){F._init()})),F}return Object(Z.d)(t,D),t.prototype.dispose=function(){D.prototype.dispose.call(this),this.onPlaneAddedObservable.clear(),this.onPlaneRemovedObservable.clear(),this.onPlaneUpdatedObservable.clear()},t.prototype._onXRFrame=function(D){var w=this;if(this.attached&&this._enabled&&D){var N=D.worldInformation.detectedPlanes;N&&N.size&&(this._detectedPlanes.filter((function(D){return!N.has(D.xrPlane)})).map((function(D){var N=w._detectedPlanes.indexOf(D);w._detectedPlanes.splice(N,1),w.onPlaneRemovedObservable.notifyObservers(D)})),N.forEach((function(N){if(w._lastFrameDetected.has(N)){if(N.lastChangedTime===w._xrSessionManager.currentTimestamp){var F=w.findIndexInPlaneArray(N);j=w._detectedPlanes[F],w._updatePlaneWithXRPlane(N,j,D),w.onPlaneUpdatedObservable.notifyObservers(j)}}else{var k={id:H_++,xrPlane:N,polygonDefinition:[]},j=w._updatePlaneWithXRPlane(N,k,D);w._detectedPlanes.push(j),w.onPlaneAddedObservable.notifyObservers(j)}})),this._lastFrameDetected=N)}},t.prototype._init=function(){this._xrSessionManager.session.updateWorldTrackingState&&(this._xrSessionManager.session.updateWorldTrackingState({planeDetectionState:{enabled:!0}}),this._enabled=!0,this._detectedPlanes.length&&(this._detectedPlanes=[]))},t.prototype._updatePlaneWithXRPlane=function(D,w,N){var F=this;w.polygonDefinition=D.polygon.map((function(D){var w=F._xrSessionManager.scene.useRightHandedSystem?1:-1;return new z.e(D.x,D.y,D.z*w)}));var k=N.getPose(D.planeSpace,this._xrSessionManager.referenceSpace);if(k){var j=w.transformationMatrix||new z.a;z.a.FromArrayToRef(k.transform.matrix,0,j),this._xrSessionManager.scene.useRightHandedSystem||j.toggleModelMatrixHandInPlace(),w.transformationMatrix=j,this._options.worldParentNode&&j.multiplyToRef(this._options.worldParentNode.getWorldMatrix(),j)}return w},t.prototype.findIndexInPlaneArray=function(D){for(var w=0;w<this._detectedPlanes.length;++w)if(this._detectedPlanes[w].xrPlane===D)return w;return-1},t.Name=es.PLANE_DETECTION,t.Version=1,t}(fs);ts.AddWebXRFeature(W_.Name,(function(D,w){return function(){return new W_(D,w)}}),W_.Version);var X_=function(D){function t(w,N){void 0===N&&(N={});var F=D.call(this,w)||this;return F.options=N,F.onBackgroundStateChangedObservable=new j.c,F}return Object(Z.d)(t,D),t.prototype.attach=function(){return this._setBackgroundState(!1),D.prototype.attach.call(this)},t.prototype.detach=function(){return this._setBackgroundState(!0),D.prototype.detach.call(this)},t.prototype.dispose=function(){D.prototype.dispose.call(this),this.onBackgroundStateChangedObservable.clear()},t.prototype._onXRFrame=function(D){},t.prototype._setBackgroundState=function(D){var w=this._xrSessionManager.scene;if(!this.options.ignoreEnvironmentHelper)if(this.options.environmentHelperRemovalFlags){if(this.options.environmentHelperRemovalFlags.skyBox){var N=w.getMeshByName("BackgroundSkybox");N&&N.setEnabled(D)}if(this.options.environmentHelperRemovalFlags.ground){var F=w.getMeshByName("BackgroundPlane");F&&F.setEnabled(D)}}else{var k=w.getMeshByName("BackgroundHelper");k&&k.setEnabled(D)}this.options.backgroundMeshes&&this.options.backgroundMeshes.forEach((function(w){return w.setEnabled(D)})),this.onBackgroundStateChangedObservable.notifyObservers(D)},t.Name=es.BACKGROUND_REMOVER,t.Version=1,t}(fs);ts.AddWebXRFeature(X_.Name,(function(D,w){return function(){return new X_(D,w)}}),X_.Version,!0);var Kf=function(){},K_=function(D){function t(w,N){var F=D.call(this,w)||this;return F._options=N,F._attachController=function(D){if(!F._controllers[D.uniqueId])if(F._xrSessionManager.scene.isPhysicsEnabled()||oe.a.Warn("physics engine not enabled, skipped. Please add this controller manually."),F._options.physicsProperties.useControllerMesh)D.onMotionControllerInitObservable.addOnce((function(w){w.onModelLoadedObservable.addOnce((function(){var N=new pc.a(w.rootMesh,pc.a.MeshImpostor,Object(Z.a)({mass:0},F._options.physicsProperties)),k=D.grip||D.pointer;F._controllers[D.uniqueId]={xrController:D,impostor:N,oldPos:k.position.clone(),oldRotation:k.rotationQuaternion.clone()}}))}));else{var w=F._options.physicsProperties.impostorType||pc.a.SphereImpostor,N=F._options.physicsProperties.impostorSize||.1,k=vo.a.CreateSphere("impostor-mesh-"+D.uniqueId,{diameterX:"number"==typeof N?N:N.width,diameterY:"number"==typeof N?N:N.height,diameterZ:"number"==typeof N?N:N.depth});k.isVisible=F._debugMode,k.isPickable=!1,k.rotationQuaternion=new z.b;var j=D.grip||D.pointer;k.position.copyFrom(j.position),k.rotationQuaternion.copyFrom(j.rotationQuaternion);var G=new pc.a(k,w,Object(Z.a)({mass:0},F._options.physicsProperties));F._controllers[D.uniqueId]={xrController:D,impostor:G,impostorMesh:k}}},F._controllers={},F._debugMode=!1,F._delta=0,F._lastTimestamp=0,F._tmpQuaternion=new z.b,F._tmpVector=new z.e,F._options.physicsProperties||(F._options.physicsProperties={}),F}return Object(Z.d)(t,D),t.prototype._enablePhysicsDebug=function(){var D=this;this._debugMode=!0,Object.keys(this._controllers).forEach((function(w){var N=D._controllers[w];N.impostorMesh&&(N.impostorMesh.isVisible=!0)}))},t.prototype.addController=function(D){this._attachController(D)},t.prototype.attach=function(){var w=this;if(!D.prototype.attach.call(this))return!1;if(!this._options.xrInput)return!0;if(this._options.xrInput.controllers.forEach(this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerAddedObservable,this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerRemovedObservable,(function(D){w._detachController(D.uniqueId)})),this._options.enableHeadsetImpostor){var N=this._options.headsetImpostorParams||{impostorType:pc.a.SphereImpostor,restitution:.8,impostorSize:.3},F=N.impostorSize||.3;this._headsetMesh=vo.a.CreateSphere("headset-mesh",{diameterX:"number"==typeof F?F:F.width,diameterY:"number"==typeof F?F:F.height,diameterZ:"number"==typeof F?F:F.depth}),this._headsetMesh.rotationQuaternion=new z.b,this._headsetMesh.isVisible=!1,this._headsetImpostor=new pc.a(this._headsetMesh,N.impostorType,Object(Z.a)({mass:0},N))}return!0},t.prototype.detach=function(){var w=this;return!!D.prototype.detach.call(this)&&(Object.keys(this._controllers).forEach((function(D){w._detachController(D)})),this._headsetMesh&&this._headsetMesh.dispose(),!0)},t.prototype.getHeadsetImpostor=function(){return this._headsetImpostor},t.prototype.getImpostorForController=function(D){var w="string"==typeof D?D:D.uniqueId;return this._controllers[w]?this._controllers[w].impostor:null},t.prototype.setPhysicsProperties=function(D){this._options.physicsProperties=Object(Z.a)(Object(Z.a)({},this._options.physicsProperties),D)},t.prototype._onXRFrame=function(D){var w=this;this._delta=this._xrSessionManager.currentTimestamp-this._lastTimestamp,this._lastTimestamp=this._xrSessionManager.currentTimestamp,this._headsetMesh&&(this._headsetMesh.position.copyFrom(this._options.xrInput.xrCamera.position),this._headsetMesh.rotationQuaternion.copyFrom(this._options.xrInput.xrCamera.rotationQuaternion)),Object.keys(this._controllers).forEach((function(D){var N=w._controllers[D],F=N.xrController.grip||N.xrController.pointer,k=N.oldPos||N.impostorMesh.position,j=N.oldRotation||N.impostorMesh.rotationQuaternion;if(F.position.subtractToRef(k,w._tmpVector),w._tmpVector.scaleInPlace(1e3/w._delta),N.impostor.setLinearVelocity(w._tmpVector),w._debugMode&&console.log(w._tmpVector,"linear"),!j.equalsWithEpsilon(F.rotationQuaternion)){j.conjugateInPlace().multiplyToRef(F.rotationQuaternion,w._tmpQuaternion);var z=Math.sqrt(w._tmpQuaternion.x*w._tmpQuaternion.x+w._tmpQuaternion.y*w._tmpQuaternion.y+w._tmpQuaternion.z*w._tmpQuaternion.z);if(w._tmpVector.set(w._tmpQuaternion.x,w._tmpQuaternion.y,w._tmpQuaternion.z),z<.001)w._tmpVector.scaleInPlace(2);else{var G=2*Math.atan2(z,w._tmpQuaternion.w);w._tmpVector.scaleInPlace(G/(z*(w._delta/1e3)))}N.impostor.setAngularVelocity(w._tmpVector),w._debugMode&&console.log(w._tmpVector,w._tmpQuaternion,"angular")}k.copyFrom(F.position),j.copyFrom(F.rotationQuaternion)}))},t.prototype._detachController=function(D){var w=this._controllers[D];w&&(w.impostorMesh&&w.impostorMesh.dispose(),delete this._controllers[D])},t.Name=es.PHYSICS_CONTROLLERS,t.Version=1,t}(fs);ts.AddWebXRFeature(K_.Name,(function(D,w){return function(){return new K_(D,w)}}),K_.Version,!0);var Q_=function(D){function t(w,N,F){var k=D.call(this,w,q_["left-right"],N,F)||this;return k._mapping={defaultButton:{valueNodeName:"VALUE",unpressedNodeName:"UNPRESSED",pressedNodeName:"PRESSED"},defaultAxis:{valueNodeName:"VALUE",minNodeName:"MIN",maxNodeName:"MAX"},buttons:{"xr-standard-trigger":{rootNodeName:"SELECT",componentProperty:"button",states:["default","touched","pressed"]},"xr-standard-squeeze":{rootNodeName:"GRASP",componentProperty:"state",states:["pressed"]},"xr-standard-touchpad":{rootNodeName:"TOUCHPAD_PRESS",labelAnchorNodeName:"squeeze-label",touchPointNodeName:"TOUCH"},"xr-standard-thumbstick":{rootNodeName:"THUMBSTICK_PRESS",componentProperty:"state",states:["pressed"]}},axes:{"xr-standard-touchpad":{"x-axis":{rootNodeName:"TOUCHPAD_TOUCH_X"},"y-axis":{rootNodeName:"TOUCHPAD_TOUCH_Y"}},"xr-standard-thumbstick":{"x-axis":{rootNodeName:"THUMBSTICK_X"},"y-axis":{rootNodeName:"THUMBSTICK_Y"}}}},k.profileId="microsoft-mixed-reality",k}return Object(Z.d)(t,D),t.prototype._getFilenameAndPath=function(){return{filename:"left"===this.handness?t.MODEL_LEFT_FILENAME:t.MODEL_RIGHT_FILENAME,path:t.MODEL_BASE_URL+"default/"}},t.prototype._getModelLoadingConstraints=function(){var D=ro.IsPluginForExtensionAvailable(".glb");return D||oe.a.Warn("glTF / glb loaded was not registered, using generic controller instead"),D},t.prototype._processLoadedModel=function(D){var w=this;this.rootMesh&&(this.getComponentIds().forEach((function(D,N){if(!w.disableAnimation&&D&&w.rootMesh){var F=w._mapping.buttons[D],k=F.rootNodeName;if(!k)return void oe.a.Log("Skipping unknown button at index: "+N+" with mapped name: "+D);var j=w._getChildByName(w.rootMesh,k);if(!j)return void oe.a.Warn("Missing button mesh with name: "+k);if(F.valueMesh=w._getImmediateChildByName(j,w._mapping.defaultButton.valueNodeName),F.pressedMesh=w._getImmediateChildByName(j,w._mapping.defaultButton.pressedNodeName),F.unpressedMesh=w._getImmediateChildByName(j,w._mapping.defaultButton.unpressedNodeName),F.valueMesh&&F.pressedMesh&&F.unpressedMesh){var z=w.getComponent(D);z&&z.onButtonStateChangedObservable.add((function(D){w._lerpTransform(F,D.value)}),void 0,!0)}else oe.a.Warn("Missing button submesh under mesh with name: "+k)}})),this.getComponentIds().forEach((function(D,N){var F=w.getComponent(D);F.isAxes()&&["x-axis","y-axis"].forEach((function(N){if(w.rootMesh){var k=w._mapping.axes[D][N],j=w._getChildByName(w.rootMesh,k.rootNodeName);j?(k.valueMesh=w._getImmediateChildByName(j,w._mapping.defaultAxis.valueNodeName),k.minMesh=w._getImmediateChildByName(j,w._mapping.defaultAxis.minNodeName),k.maxMesh=w._getImmediateChildByName(j,w._mapping.defaultAxis.maxNodeName),k.valueMesh&&k.minMesh&&k.maxMesh?F&&F.onAxisValueChangedObservable.add((function(D){var F="x-axis"===N?D.x:D.y;w._lerpTransform(k,F,!0)}),void 0,!0):oe.a.Warn("Missing axis submesh under mesh with name: "+k.rootNodeName)):oe.a.Warn("Missing axis mesh with name: "+k.rootNodeName)}}))})))},t.prototype._setRootMesh=function(D){var w;this.rootMesh=new xt.a(this.profileId+" "+this.handness,this.scene),this.rootMesh.isPickable=!1;for(var N=0;N<D.length;N++){var F=D[N];F.isPickable=!1,F.parent||(w=F)}w&&w.setParent(this.rootMesh),this.rootMesh.rotationQuaternion=z.b.FromEulerAngles(0,Math.PI,0)},t.prototype._updateModel=function(){},t.MODEL_BASE_URL="https://controllers.babylonjs.com/microsoft/",t.MODEL_LEFT_FILENAME="left.glb",t.MODEL_RIGHT_FILENAME="right.glb",t}(rs);us.RegisterController("windows-mixed-reality",(function(D,w){return new Q_(w,D.gamepad,D.handedness)}));var q_={left:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{xr_standard_trigger_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_trigger_pressed_value",minNodeName:"xr_standard_trigger_pressed_min",maxNodeName:"xr_standard_trigger_pressed_max"}}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{xr_standard_squeeze_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_squeeze_pressed_value",minNodeName:"xr_standard_squeeze_pressed_min",maxNodeName:"xr_standard_squeeze_pressed_max"}}},"xr-standard-touchpad":{type:"touchpad",gamepadIndices:{button:2,xAxis:0,yAxis:1},rootNodeName:"xr_standard_touchpad",visualResponses:{xr_standard_touchpad_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_pressed_value",minNodeName:"xr_standard_touchpad_pressed_min",maxNodeName:"xr_standard_touchpad_pressed_max"},xr_standard_touchpad_xaxis_pressed:{componentProperty:"xAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_xaxis_pressed_value",minNodeName:"xr_standard_touchpad_xaxis_pressed_min",maxNodeName:"xr_standard_touchpad_xaxis_pressed_max"},xr_standard_touchpad_yaxis_pressed:{componentProperty:"yAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_yaxis_pressed_value",minNodeName:"xr_standard_touchpad_yaxis_pressed_min",maxNodeName:"xr_standard_touchpad_yaxis_pressed_max"},xr_standard_touchpad_xaxis_touched:{componentProperty:"xAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_xaxis_touched_value",minNodeName:"xr_standard_touchpad_xaxis_touched_min",maxNodeName:"xr_standard_touchpad_xaxis_touched_max"},xr_standard_touchpad_yaxis_touched:{componentProperty:"yAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_yaxis_touched_value",minNodeName:"xr_standard_touchpad_yaxis_touched_min",maxNodeName:"xr_standard_touchpad_yaxis_touched_max"},xr_standard_touchpad_axes_touched:{componentProperty:"state",states:["touched","pressed"],valueNodeProperty:"visibility",valueNodeName:"xr_standard_touchpad_axes_touched_value"}},touchPointNodeName:"xr_standard_touchpad_axes_touched_value"},"xr-standard-thumbstick":{type:"thumbstick",gamepadIndices:{button:3,xAxis:2,yAxis:3},rootNodeName:"xr_standard_thumbstick",visualResponses:{xr_standard_thumbstick_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_thumbstick_pressed_value",minNodeName:"xr_standard_thumbstick_pressed_min",maxNodeName:"xr_standard_thumbstick_pressed_max"},xr_standard_thumbstick_xaxis_pressed:{componentProperty:"xAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_thumbstick_xaxis_pressed_value",minNodeName:"xr_standard_thumbstick_xaxis_pressed_min",maxNodeName:"xr_standard_thumbstick_xaxis_pressed_max"},xr_standard_thumbstick_yaxis_pressed:{componentProperty:"yAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_thumbstick_yaxis_pressed_value",minNodeName:"xr_standard_thumbstick_yaxis_pressed_min",maxNodeName:"xr_standard_thumbstick_yaxis_pressed_max"}}}},gamepadMapping:"xr-standard",rootNodeName:"microsoft-mixed-reality-left",assetPath:"left.glb"},right:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{xr_standard_trigger_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_trigger_pressed_value",minNodeName:"xr_standard_trigger_pressed_min",maxNodeName:"xr_standard_trigger_pressed_max"}}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{xr_standard_squeeze_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_squeeze_pressed_value",minNodeName:"xr_standard_squeeze_pressed_min",maxNodeName:"xr_standard_squeeze_pressed_max"}}},"xr-standard-touchpad":{type:"touchpad",gamepadIndices:{button:2,xAxis:0,yAxis:1},rootNodeName:"xr_standard_touchpad",visualResponses:{xr_standard_touchpad_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_pressed_value",minNodeName:"xr_standard_touchpad_pressed_min",maxNodeName:"xr_standard_touchpad_pressed_max"},xr_standard_touchpad_xaxis_pressed:{componentProperty:"xAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_xaxis_pressed_value",minNodeName:"xr_standard_touchpad_xaxis_pressed_min",maxNodeName:"xr_standard_touchpad_xaxis_pressed_max"},xr_standard_touchpad_yaxis_pressed:{componentProperty:"yAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_yaxis_pressed_value",minNodeName:"xr_standard_touchpad_yaxis_pressed_min",maxNodeName:"xr_standard_touchpad_yaxis_pressed_max"},xr_standard_touchpad_xaxis_touched:{componentProperty:"xAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_xaxis_touched_value",minNodeName:"xr_standard_touchpad_xaxis_touched_min",maxNodeName:"xr_standard_touchpad_xaxis_touched_max"},xr_standard_touchpad_yaxis_touched:{componentProperty:"yAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_yaxis_touched_value",minNodeName:"xr_standard_touchpad_yaxis_touched_min",maxNodeName:"xr_standard_touchpad_yaxis_touched_max"},xr_standard_touchpad_axes_touched:{componentProperty:"state",states:["touched","pressed"],valueNodeProperty:"visibility",valueNodeName:"xr_standard_touchpad_axes_touched_value"}},touchPointNodeName:"xr_standard_touchpad_axes_touched_value"},"xr-standard-thumbstick":{type:"thumbstick",gamepadIndices:{button:3,xAxis:2,yAxis:3},rootNodeName:"xr_standard_thumbstick",visualResponses:{xr_standard_thumbstick_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_thumbstick_pressed_value",minNodeName:"xr_standard_thumbstick_pressed_min",maxNodeName:"xr_standard_thumbstick_pressed_max"},xr_standard_thumbstick_xaxis_pressed:{componentProperty:"xAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_thumbstick_xaxis_pressed_value",minNodeName:"xr_standard_thumbstick_xaxis_pressed_min",maxNodeName:"xr_standard_thumbstick_xaxis_pressed_max"},xr_standard_thumbstick_yaxis_pressed:{componentProperty:"yAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_thumbstick_yaxis_pressed_value",minNodeName:"xr_standard_thumbstick_yaxis_pressed_min",maxNodeName:"xr_standard_thumbstick_yaxis_pressed_max"}}}},gamepadMapping:"xr-standard",rootNodeName:"microsoft-mixed-reality-right",assetPath:"right.glb"}},Z_=function(D){function t(w,N,F,k,j){void 0===k&&(k=!1),void 0===j&&(j=!1);var z=D.call(this,w,J_[F],N,F)||this;return z._forceLegacyControllers=j,z.profileId="oculus-touch",z}return Object(Z.d)(t,D),t.prototype._getFilenameAndPath=function(){return{filename:"left"===this.handness?t.MODEL_LEFT_FILENAME:t.MODEL_RIGHT_FILENAME,path:this._isQuest()?t.QUEST_MODEL_BASE_URL:t.MODEL_BASE_URL}},t.prototype._getModelLoadingConstraints=function(){return!0},t.prototype._processLoadedModel=function(D){var w=this,N=this._isQuest(),F="right"===this.handness?-1:1;this.getComponentIds().forEach((function(D){var k=D&&w.getComponent(D);k&&k.onButtonStateChangedObservable.add((function(k){if(w.rootMesh&&!w.disableAnimation)switch(D){case"xr-standard-trigger":return void(N||(w._modelRootNode.getChildren()[3].rotation.x=.2*-k.value,w._modelRootNode.getChildren()[3].position.y=.005*-k.value,w._modelRootNode.getChildren()[3].position.z=.005*-k.value));case"xr-standard-squeeze":return void(N||(w._modelRootNode.getChildren()[4].position.x=F*k.value*.0035));case"xr-standard-thumbstick":return;case"a-button":case"x-button":return void(N||(k.pressed?w._modelRootNode.getChildren()[1].position.y=-.001:w._modelRootNode.getChildren()[1].position.y=0));case"b-button":case"y-button":return void(N||(k.pressed?w._modelRootNode.getChildren()[2].position.y=-.001:w._modelRootNode.getChildren()[2].position.y=0))}}),void 0,!0)}))},t.prototype._setRootMesh=function(D){this.rootMesh=new xt.a(this.profileId+" "+this.handness,this.scene),this.rootMesh.rotationQuaternion=z.b.FromEulerAngles(0,Math.PI,0),D.forEach((function(D){D.isPickable=!1})),this._isQuest()?this._modelRootNode=D[0]:(this._modelRootNode=D[1],this.rootMesh.position.y=.034,this.rootMesh.position.z=.052),this._modelRootNode.parent=this.rootMesh},t.prototype._updateModel=function(){},t.prototype._isQuest=function(){return!!navigator.userAgent.match(/Quest/gi)&&!this._forceLegacyControllers},t.MODEL_BASE_URL="https://controllers.babylonjs.com/oculus/",t.MODEL_LEFT_FILENAME="left.babylon",t.MODEL_RIGHT_FILENAME="right.babylon",t.QUEST_MODEL_BASE_URL="https://controllers.babylonjs.com/oculusQuest/",t}(rs);us.RegisterController("oculus-touch",(function(D,w){return new Z_(w,D.gamepad,D.handedness)})),us.RegisterController("oculus-touch-legacy",(function(D,w){return new Z_(w,D.gamepad,D.handedness,!0)}));var J_={left:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{}},"xr-standard-thumbstick":{type:"thumbstick",gamepadIndices:{button:3,xAxis:2,yAxis:3},rootNodeName:"xr_standard_thumbstick",visualResponses:{}},"x-button":{type:"button",gamepadIndices:{button:4},rootNodeName:"x_button",visualResponses:{}},"y-button":{type:"button",gamepadIndices:{button:5},rootNodeName:"y_button",visualResponses:{}},thumbrest:{type:"button",gamepadIndices:{button:6},rootNodeName:"thumbrest",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"oculus-touch-v2-left",assetPath:"left.glb"},right:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{}},"xr-standard-thumbstick":{type:"thumbstick",gamepadIndices:{button:3,xAxis:2,yAxis:3},rootNodeName:"xr_standard_thumbstick",visualResponses:{}},"a-button":{type:"button",gamepadIndices:{button:4},rootNodeName:"a_button",visualResponses:{}},"b-button":{type:"button",gamepadIndices:{button:5},rootNodeName:"b_button",visualResponses:{}},thumbrest:{type:"button",gamepadIndices:{button:6},rootNodeName:"thumbrest",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"oculus-touch-v2-right",assetPath:"right.glb"}},$_=function(D){function t(w,N,F){var k=D.call(this,w,em[F],N,F)||this;return k.profileId="htc-vive",k}return Object(Z.d)(t,D),t.prototype._getFilenameAndPath=function(){return{filename:t.MODEL_FILENAME,path:t.MODEL_BASE_URL}},t.prototype._getModelLoadingConstraints=function(){return!0},t.prototype._processLoadedModel=function(D){var w=this;this.getComponentIds().forEach((function(D){var N=D&&w.getComponent(D);N&&N.onButtonStateChangedObservable.add((function(N){if(w.rootMesh&&!w.disableAnimation)switch(D){case"xr-standard-trigger":return void(w._modelRootNode.getChildren()[6].rotation.x=.15*-N.value);case"xr-standard-touchpad":case"xr-standard-squeeze":return}}),void 0,!0)}))},t.prototype._setRootMesh=function(D){this.rootMesh=new xt.a(this.profileId+" "+this.handness,this.scene),D.forEach((function(D){D.isPickable=!1})),this._modelRootNode=D[1],this._modelRootNode.parent=this.rootMesh,this.rootMesh.rotationQuaternion=z.b.FromEulerAngles(0,Math.PI,0)},t.prototype._updateModel=function(){},t.MODEL_BASE_URL="https://controllers.babylonjs.com/vive/",t.MODEL_FILENAME="wand.babylon",t}(rs);us.RegisterController("htc-vive",(function(D,w){return new $_(w,D.gamepad,D.handedness)}));var em={left:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{}},"xr-standard-touchpad":{type:"touchpad",gamepadIndices:{button:2,xAxis:0,yAxis:1},rootNodeName:"xr_standard_touchpad",visualResponses:{}},menu:{type:"button",gamepadIndices:{button:4},rootNodeName:"menu",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"htc_vive_none",assetPath:"none.glb"},right:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{}},"xr-standard-touchpad":{type:"touchpad",gamepadIndices:{button:2,xAxis:0,yAxis:1},rootNodeName:"xr_standard_touchpad",visualResponses:{}},menu:{type:"button",gamepadIndices:{button:4},rootNodeName:"menu",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"htc_vive_none",assetPath:"none.glb"},none:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{}},"xr-standard-touchpad":{type:"touchpad",gamepadIndices:{button:2,xAxis:0,yAxis:1},rootNodeName:"xr_standard_touchpad",visualResponses:{}},menu:{type:"button",gamepadIndices:{button:4},rootNodeName:"menu",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"htc-vive-none",assetPath:"none.glb"}};N.d(w,"AbstractScene",(function(){return F.a})),N.d(w,"AbstractActionManager",(function(){return k.a})),N.d(w,"Action",(function(){return X})),N.d(w,"ActionEvent",(function(){return q.a})),N.d(w,"ActionManager",(function(){return Ae})),N.d(w,"Condition",(function(){return J})),N.d(w,"ValueCondition",(function(){return $})),N.d(w,"PredicateCondition",(function(){return te})),N.d(w,"StateCondition",(function(){return ie})),N.d(w,"SwitchBooleanAction",(function(){return he})),N.d(w,"SetStateAction",(function(){return fe})),N.d(w,"SetValueAction",(function(){return pe})),N.d(w,"IncrementValueAction",(function(){return _e})),N.d(w,"PlayAnimationAction",(function(){return ve})),N.d(w,"StopAnimationAction",(function(){return ye})),N.d(w,"DoNothingAction",(function(){return be})),N.d(w,"CombineAction",(function(){return Te})),N.d(w,"ExecuteCodeAction",(function(){return Ee})),N.d(w,"SetParentAction",(function(){return Se})),N.d(w,"PlaySoundAction",(function(){return Pe})),N.d(w,"StopSoundAction",(function(){return Oe})),N.d(w,"InterpolateValueAction",(function(){return Be})),N.d(w,"Animatable",(function(){return Je})),N.d(w,"_IAnimationState",(function(){return V})),N.d(w,"Animation",(function(){return Fe})),N.d(w,"TargetedAnimation",(function(){return et})),N.d(w,"AnimationGroup",(function(){return tt})),N.d(w,"AnimationPropertiesOverride",(function(){return ne})),N.d(w,"EasingFunction",(function(){return ht})),N.d(w,"CircleEase",(function(){return dt})),N.d(w,"BackEase",(function(){return ft})),N.d(w,"BounceEase",(function(){return pt})),N.d(w,"CubicEase",(function(){return _t})),N.d(w,"ElasticEase",(function(){return mt})),N.d(w,"ExponentialEase",(function(){return gt})),N.d(w,"PowerEase",(function(){return vt})),N.d(w,"QuadraticEase",(function(){return yt})),N.d(w,"QuarticEase",(function(){return bt})),N.d(w,"QuinticEase",(function(){return Tt})),N.d(w,"SineEase",(function(){return Et})),N.d(w,"BezierCurveEase",(function(){return St})),N.d(w,"RuntimeAnimation",(function(){return He})),N.d(w,"AnimationEvent",(function(){return Mt})),N.d(w,"AnimationKeyInterpolation",(function(){return Re})),N.d(w,"AnimationRange",(function(){return Le})),N.d(w,"KeepAssets",(function(){return At})),N.d(w,"InstantiatedEntries",(function(){return Ce})),N.d(w,"AssetContainer",(function(){return Pt})),N.d(w,"Analyser",(function(){return Ot})),N.d(w,"AudioEngine",(function(){return Rt})),N.d(w,"AudioSceneComponent",(function(){return Ft})),N.d(w,"Sound",(function(){return Lt})),N.d(w,"SoundTrack",(function(){return wt})),N.d(w,"WeightedSound",(function(){return Bt})),N.d(w,"AutoRotationBehavior",(function(){return Ut})),N.d(w,"BouncingBehavior",(function(){return Vt})),N.d(w,"FramingBehavior",(function(){return jt})),N.d(w,"AttachToBoxBehavior",(function(){return zt})),N.d(w,"FadeInOutBehavior",(function(){return Gt})),N.d(w,"MultiPointerScaleBehavior",(function(){return Ht})),N.d(w,"PointerDragBehavior",(function(){return Yt.a})),N.d(w,"SixDofDragBehavior",(function(){return Qt})),N.d(w,"Bone",(function(){return Ze})),N.d(w,"BoneIKController",(function(){return qt})),N.d(w,"BoneLookController",(function(){return Zt})),N.d(w,"Skeleton",(function(){return tn})),N.d(w,"CameraInputTypes",(function(){return nn})),N.d(w,"CameraInputsManager",(function(){return rn})),N.d(w,"Camera",(function(){return Xt.a})),N.d(w,"TargetCamera",(function(){return Nn})),N.d(w,"FreeCamera",(function(){return Fn})),N.d(w,"FreeCameraInputsManager",(function(){return xn})),N.d(w,"TouchCamera",(function(){return Bn})),N.d(w,"ArcRotateCamera",(function(){return kn})),N.d(w,"ArcRotateCameraInputsManager",(function(){return _n})),N.d(w,"DeviceOrientationCamera",(function(){return Un})),N.d(w,"FlyCamera",(function(){return zn})),N.d(w,"FlyCameraInputsManager",(function(){return jn})),N.d(w,"FollowCamera",(function(){return Hn})),N.d(w,"ArcFollowCamera",(function(){return Xn})),N.d(w,"FollowCameraInputsManager",(function(){return Gn})),N.d(w,"GamepadCamera",(function(){return si})),N.d(w,"UniversalCamera",(function(){return ai})),N.d(w,"VirtualJoysticksCamera",(function(){return Pi})),N.d(w,"ArcRotateCameraGamepadInput",(function(){return sn})),N.d(w,"ArcRotateCameraKeyboardMoveInput",(function(){return un})),N.d(w,"ArcRotateCameraMouseWheelInput",(function(){return ln})),N.d(w,"ArcRotateCameraPointersInput",(function(){return dn})),N.d(w,"ArcRotateCameraVRDeviceOrientationInput",(function(){return mn})),N.d(w,"FlyCameraKeyboardInput",(function(){return gn})),N.d(w,"FlyCameraMouseInput",(function(){return vn})),N.d(w,"FollowCameraKeyboardMoveInput",(function(){return yn})),N.d(w,"FollowCameraMouseWheelInput",(function(){return bn})),N.d(w,"FollowCameraPointersInput",(function(){return Tn})),N.d(w,"FreeCameraDeviceOrientationInput",(function(){return An})),N.d(w,"FreeCameraGamepadInput",(function(){return Pn})),N.d(w,"FreeCameraKeyboardMoveInput",(function(){return En})),N.d(w,"FreeCameraMouseInput",(function(){return Sn})),N.d(w,"FreeCameraTouchInput",(function(){return Mn})),N.d(w,"FreeCameraVirtualJoystickInput",(function(){return Ln})),N.d(w,"AnaglyphArcRotateCamera",(function(){return gi})),N.d(w,"AnaglyphFreeCamera",(function(){return vi})),N.d(w,"AnaglyphGamepadCamera",(function(){return yi})),N.d(w,"AnaglyphUniversalCamera",(function(){return bi})),N.d(w,"StereoscopicArcRotateCamera",(function(){return Si})),N.d(w,"StereoscopicFreeCamera",(function(){return Mi})),N.d(w,"StereoscopicGamepadCamera",(function(){return xi})),N.d(w,"StereoscopicUniversalCamera",(function(){return Ai})),N.d(w,"VRCameraMetrics",(function(){return Ci})),N.d(w,"VRDeviceOrientationArcRotateCamera",(function(){return ki})),N.d(w,"VRDeviceOrientationFreeCamera",(function(){return Ui})),N.d(w,"VRDeviceOrientationGamepadCamera",(function(){return Vi})),N.d(w,"OnAfterEnteringVRObservableEvent",(function(){return pn})),N.d(w,"VRExperienceHelper",(function(){return lr})),N.d(w,"WebVRFreeCamera",(function(){return zi})),N.d(w,"Collider",(function(){return fr})),N.d(w,"DefaultCollisionCoordinator",(function(){return pr})),N.d(w,"PickingInfo",(function(){return _r.a})),N.d(w,"IntersectionInfo",(function(){return mr.a})),N.d(w,"_MeshCollisionData",(function(){return gr.a})),N.d(w,"BoundingBox",(function(){return vr.a})),N.d(w,"BoundingInfo",(function(){return yr.a})),N.d(w,"BoundingSphere",(function(){return Tr.a})),N.d(w,"Ray",(function(){return Qn.a})),N.d(w,"Octree",(function(){return Sr})),N.d(w,"OctreeBlock",(function(){return Er})),N.d(w,"OctreeSceneComponent",(function(){return Mr})),N.d(w,"AxesViewer",(function(){return xr.AxesViewer})),N.d(w,"BoneAxesViewer",(function(){return xr.BoneAxesViewer})),N.d(w,"DebugLayerTab",(function(){return xr.DebugLayerTab})),N.d(w,"DebugLayer",(function(){return xr.DebugLayer})),N.d(w,"PhysicsViewer",(function(){return xr.PhysicsViewer})),N.d(w,"RayHelper",(function(){return xr.RayHelper})),N.d(w,"SkeletonViewer",(function(){return xr.SkeletonViewer})),N.d(w,"Constants",(function(){return ce.a})),N.d(w,"ThinEngine",(function(){return di.a})),N.d(w,"Engine",(function(){return Ct.a})),N.d(w,"EngineStore",(function(){return Me.a})),N.d(w,"NullEngineOptions",(function(){return Ar.b})),N.d(w,"NullEngine",(function(){return Ar.a})),N.d(w,"WebGLPipelineContext",(function(){return Pr.a})),N.d(w,"WebGL2ShaderProcessor",(function(){return Cr.a})),N.d(w,"NativeEngine",(function(){return Zr})),N.d(w,"_OcclusionDataStorage",(function(){return Dn})),N.d(w,"_forceTransformFeedbackToBundle",(function(){return!0})),N.d(w,"EngineView",(function(){return wn})),N.d(w,"KeyboardEventTypes",(function(){return cn.a})),N.d(w,"KeyboardInfo",(function(){return cn.b})),N.d(w,"KeyboardInfoPre",(function(){return cn.c})),N.d(w,"PointerEventTypes",(function(){return kt.a})),N.d(w,"PointerInfoBase",(function(){return kt.c})),N.d(w,"PointerInfoPre",(function(){return kt.d})),N.d(w,"PointerInfo",(function(){return kt.b})),N.d(w,"ClipboardEventTypes",(function(){return Jr})),N.d(w,"ClipboardInfo",(function(){return $r})),N.d(w,"StickValues",(function(){return ct})),N.d(w,"Gamepad",(function(){return on})),N.d(w,"GenericPad",(function(){return an})),N.d(w,"GamepadManager",(function(){return ri})),N.d(w,"GamepadSystemSceneComponent",(function(){return oi})),N.d(w,"Xbox360Button",(function(){return qn})),N.d(w,"Xbox360Dpad",(function(){return Zn})),N.d(w,"Xbox360Pad",(function(){return ni})),N.d(w,"DualShockButton",(function(){return ei})),N.d(w,"DualShockDpad",(function(){return ti})),N.d(w,"DualShockPad",(function(){return ii})),N.d(w,"DaydreamController",(function(){return oo})),N.d(w,"GearVRController",(function(){return ao})),N.d(w,"GenericController",(function(){return so})),N.d(w,"OculusTouchController",(function(){return co})),N.d(w,"PoseEnabledControllerType",(function(){return Yn})),N.d(w,"PoseEnabledControllerHelper",(function(){return Jn})),N.d(w,"PoseEnabledController",(function(){return $n})),N.d(w,"ViveController",(function(){return uo})),N.d(w,"WebVRController",(function(){return Gi})),N.d(w,"WindowsMotionController",(function(){return lo})),N.d(w,"XRWindowsMotionController",(function(){return ho})),N.d(w,"AxisDragGizmo",(function(){return fo.a})),N.d(w,"AxisScaleGizmo",(function(){return go})),N.d(w,"BoundingBoxGizmo",(function(){return bo})),N.d(w,"Gizmo",(function(){return _o.a})),N.d(w,"GizmoManager",(function(){return Oo})),N.d(w,"PlaneRotationGizmo",(function(){return To})),N.d(w,"PositionGizmo",(function(){return Ao})),N.d(w,"RotationGizmo",(function(){return Eo})),N.d(w,"ScaleGizmo",(function(){return Co})),N.d(w,"LightGizmo",(function(){return No})),N.d(w,"PlaneDragGizmo",(function(){return xo})),N.d(w,"EnvironmentHelper",(function(){return Qo})),N.d(w,"PhotoDome",(function(){return qo})),N.d(w,"_forceSceneHelpersToBundle",(function(){return!0})),N.d(w,"VideoDome",(function(){return Es})),N.d(w,"EngineInstrumentation",(function(){return xs})),N.d(w,"SceneInstrumentation",(function(){return As})),N.d(w,"_TimeToken",(function(){return In})),N.d(w,"EffectLayer",(function(){return Cs})),N.d(w,"EffectLayerSceneComponent",(function(){return Os})),N.d(w,"GlowLayer",(function(){return Rs})),N.d(w,"HighlightLayer",(function(){return Fs})),N.d(w,"Layer",(function(){return ks})),N.d(w,"LayerSceneComponent",(function(){return Bs})),N.d(w,"LensFlare",(function(){return Us})),N.d(w,"LensFlareSystem",(function(){return Vs})),N.d(w,"LensFlareSystemSceneComponent",(function(){return js})),N.d(w,"Light",(function(){return Ro.a})),N.d(w,"ShadowLight",(function(){return Do})),N.d(w,"DirectionalLight",(function(){return Io})),N.d(w,"HemisphericLight",(function(){return ji.a})),N.d(w,"PointLight",(function(){return tc})),N.d(w,"SpotLight",(function(){return wo})),N.d(w,"ShadowGenerator",(function(){return zs})),N.d(w,"CascadedShadowGenerator",(function(){return $s})),N.d(w,"ShadowGeneratorSceneComponent",(function(){return ec})),N.d(w,"DefaultLoadingScreen",(function(){return nc})),N.d(w,"SceneLoaderProgressEvent",(function(){return io})),N.d(w,"SceneLoaderAnimationGroupLoadingMode",(function(){return Vr})),N.d(w,"SceneLoader",(function(){return ro})),N.d(w,"SceneLoaderFlags",(function(){return no.a})),N.d(w,"_BabylonLoaderRegistered",(function(){return!0})),N.d(w,"BabylonFileLoaderConfiguration",(function(){return wc})),N.d(w,"ColorCurves",(function(){return Nc.a})),N.d(w,"EffectFallbacks",(function(){return Wo.a})),N.d(w,"Effect",(function(){return li.a})),N.d(w,"FresnelParameters",(function(){return jc})),N.d(w,"ImageProcessingConfigurationDefines",(function(){return Yi.b})),N.d(w,"ImageProcessingConfiguration",(function(){return Yi.a})),N.d(w,"Material",(function(){return Ps.a})),N.d(w,"MaterialDefines",(function(){return zo.a})),N.d(w,"MaterialHelper",(function(){return jo.a})),N.d(w,"MultiMaterial",(function(){return rc.a})),N.d(w,"PBRMaterial",(function(){return ga})),N.d(w,"PushMaterial",(function(){return Yo.a})),N.d(w,"ShaderMaterial",(function(){return Zc.a})),N.d(w,"StandardMaterialDefines",(function(){return Hi.b})),N.d(w,"StandardMaterial",(function(){return Hi.a})),N.d(w,"BaseTexture",(function(){return Nr.a})),N.d(w,"CubeTexture",(function(){return Vo})),N.d(w,"DynamicTexture",(function(){return Xi})),N.d(w,"EquiRectangularCubeTexture",(function(){return tu})),N.d(w,"HDRCubeTexture",(function(){return uc})),N.d(w,"InternalTextureSource",(function(){return $t.b})),N.d(w,"InternalTexture",(function(){return $t.a})),N.d(w,"MirrorTexture",(function(){return Bo})),N.d(w,"MultiRenderTarget",(function(){return su})),N.d(w,"RawTexture",(function(){return en})),N.d(w,"RenderTargetTexture",(function(){return Li})),N.d(w,"Texture",(function(){return Jt.a})),N.d(w,"UniformBuffer",(function(){return Ri.a})),N.d(w,"MaterialFlags",(function(){return Ho.a})),N.d(w,"EffectRenderer",(function(){return Ql})),N.d(w,"EffectWrapper",(function(){return ql})),N.d(w,"BackgroundMaterial",(function(){return Ko})),N.d(w,"PBRMaterialDefines",(function(){return fa})),N.d(w,"PBRBaseMaterial",(function(){return pa})),N.d(w,"PBRBaseSimpleMaterial",(function(){return Yc})),N.d(w,"PBRMetallicRoughnessMaterial",(function(){return Qc})),N.d(w,"PBRSpecularGlossinessMaterial",(function(){return qc})),N.d(w,"ColorGradingTexture",(function(){return eu})),N.d(w,"RawCubeTexture",(function(){return Eu})),N.d(w,"RawTexture3D",(function(){return Su})),N.d(w,"RawTexture2DArray",(function(){return Mu})),N.d(w,"RefractionTexture",(function(){return xu})),N.d(w,"VideoTexture",(function(){return ys})),N.d(w,"HtmlElementTexture",(function(){return Au})),N.d(w,"NodeMaterialConnectionPointCompatibilityStates",(function(){return bu})),N.d(w,"NodeMaterialConnectionPointDirection",(function(){return Tu})),N.d(w,"NodeMaterialConnectionPoint",(function(){return Cu})),N.d(w,"NodeMaterialBlock",(function(){return Ru})),N.d(w,"NodeMaterialDefines",(function(){return ku})),N.d(w,"NodeMaterial",(function(){return Vu})),N.d(w,"_DDSTextureLoader",(function(){return ja})),N.d(w,"_ENVTextureLoader",(function(){return Ya})),N.d(w,"_KTXTextureLoader",(function(){return Za})),N.d(w,"_TGATextureLoader",(function(){return iu})),N.d(w,"_BasisTextureLoader",(function(){return au})),N.d(w,"CustomProceduralTexture",(function(){return hu})),N.d(w,"NoiseProceduralTexture",(function(){return fu})),N.d(w,"ProceduralTexture",(function(){return uu})),N.d(w,"ProceduralTextureSceneComponent",(function(){return cu})),N.d(w,"TexturePacker",(function(){return Pu})),N.d(w,"TexturePackerFrame",(function(){return _c})),N.d(w,"NodeMaterialBlockTargets",(function(){return _u})),N.d(w,"NodeMaterialBlockConnectionPointTypes",(function(){return mu})),N.d(w,"NodeMaterialBlockConnectionPointMode",(function(){return vu})),N.d(w,"NodeMaterialSystemValues",(function(){return yu})),N.d(w,"MultiplyBlock",(function(){return el})),N.d(w,"AddBlock",(function(){return tl})),N.d(w,"ScaleBlock",(function(){return nl})),N.d(w,"ClampBlock",(function(){return il})),N.d(w,"CrossBlock",(function(){return rl})),N.d(w,"DotBlock",(function(){return ol})),N.d(w,"TransformBlock",(function(){return Lu})),N.d(w,"RemapBlock",(function(){return al})),N.d(w,"NormalizeBlock",(function(){return cl})),N.d(w,"TrigonometryBlockOperations",(function(){return sl})),N.d(w,"TrigonometryBlock",(function(){return ul})),N.d(w,"ColorMergerBlock",(function(){return ll})),N.d(w,"VectorMergerBlock",(function(){return hl})),N.d(w,"ColorSplitterBlock",(function(){return dl})),N.d(w,"VectorSplitterBlock",(function(){return fl})),N.d(w,"LerpBlock",(function(){return pl})),N.d(w,"DivideBlock",(function(){return _l})),N.d(w,"SubtractBlock",(function(){return ml})),N.d(w,"StepBlock",(function(){return gl})),N.d(w,"OneMinusBlock",(function(){return vl})),N.d(w,"ViewDirectionBlock",(function(){return yl})),N.d(w,"FresnelBlock",(function(){return bl})),N.d(w,"MaxBlock",(function(){return Tl})),N.d(w,"MinBlock",(function(){return El})),N.d(w,"DistanceBlock",(function(){return Sl})),N.d(w,"LengthBlock",(function(){return Ml})),N.d(w,"NegateBlock",(function(){return Al})),N.d(w,"PowBlock",(function(){return Pl})),N.d(w,"RandomNumberBlock",(function(){return Cl})),N.d(w,"ArcTan2Block",(function(){return Ol})),N.d(w,"SmoothStepBlock",(function(){return Rl})),N.d(w,"ReciprocalBlock",(function(){return Dl})),N.d(w,"ReplaceColorBlock",(function(){return Il})),N.d(w,"PosterizeBlock",(function(){return wl})),N.d(w,"WaveBlockKind",(function(){return Ll})),N.d(w,"WaveBlock",(function(){return Nl})),N.d(w,"GradientBlockColorStep",(function(){return xl})),N.d(w,"GradientBlock",(function(){return Fl})),N.d(w,"NLerpBlock",(function(){return kl})),N.d(w,"WorleyNoise3DBlock",(function(){return jl})),N.d(w,"SimplexPerlin3DBlock",(function(){return zl})),N.d(w,"NormalBlendBlock",(function(){return Gl})),N.d(w,"Rotate2dBlock",(function(){return Yl})),N.d(w,"ReflectBlock",(function(){return Hl})),N.d(w,"RefractBlock",(function(){return Wl})),N.d(w,"DesaturateBlock",(function(){return Xl})),N.d(w,"NodeMaterialOptimizer",(function(){return Kl})),N.d(w,"VertexOutputBlock",(function(){return wu})),N.d(w,"BonesBlock",(function(){return ju})),N.d(w,"InstancesBlock",(function(){return zu})),N.d(w,"MorphTargetsBlock",(function(){return Gu})),N.d(w,"LightInformationBlock",(function(){return Yu})),N.d(w,"FragmentOutputBlock",(function(){return Fu})),N.d(w,"ImageProcessingBlock",(function(){return Hu})),N.d(w,"PerturbNormalBlock",(function(){return Wu})),N.d(w,"DiscardBlock",(function(){return Xu})),N.d(w,"FrontFacingBlock",(function(){return Ku})),N.d(w,"DerivativeBlock",(function(){return Qu})),N.d(w,"FogBlock",(function(){return qu})),N.d(w,"LightBlock",(function(){return Zu})),N.d(w,"TextureBlock",(function(){return Ju})),N.d(w,"ReflectionTextureBlock",(function(){return $u})),N.d(w,"InputBlock",(function(){return Bu})),N.d(w,"AnimatedInputBlockTypes",(function(){return Nu})),N.d(w,"Scalar",(function(){return De.a})),N.d(w,"Space",(function(){return Qe.b})),N.d(w,"Axis",(function(){return Qe.a})),N.d(w,"Color3",(function(){return G.a})),N.d(w,"Color4",(function(){return G.b})),N.d(w,"TmpColors",(function(){return G.c})),N.d(w,"ToGammaSpace",(function(){return rt.b})),N.d(w,"ToLinearSpace",(function(){return rt.c})),N.d(w,"Epsilon",(function(){return rt.a})),N.d(w,"Frustum",(function(){return Ni.a})),N.d(w,"Plane",(function(){return hr.a})),N.d(w,"Size",(function(){return Ne.a})),N.d(w,"Vector2",(function(){return z.d})),N.d(w,"Vector3",(function(){return z.e})),N.d(w,"Vector4",(function(){return z.f})),N.d(w,"Quaternion",(function(){return z.b})),N.d(w,"Matrix",(function(){return z.a})),N.d(w,"TmpVectors",(function(){return z.c})),N.d(w,"Viewport",(function(){return Bi.a})),N.d(w,"SphericalHarmonics",(function(){return Lr})),N.d(w,"SphericalPolynomial",(function(){return wr})),N.d(w,"Orientation",(function(){return $e})),N.d(w,"BezierCurve",(function(){return ot})),N.d(w,"Angle",(function(){return at})),N.d(w,"Arc2",(function(){return se})),N.d(w,"Path2",(function(){return st})),N.d(w,"Path3D",(function(){return ut})),N.d(w,"Curve3",(function(){return lt})),N.d(w,"PositionNormalVertex",(function(){return bs})),N.d(w,"PositionNormalTextureVertex",(function(){return Ts})),N.d(w,"AbstractMesh",(function(){return Wt.a})),N.d(w,"Buffer",(function(){return Zi.a})),N.d(w,"VertexBuffer",(function(){return Zi.b})),N.d(w,"CSG",(function(){return Ih})),N.d(w,"Geometry",(function(){return ic.a})),N.d(w,"GroundMesh",(function(){return Ji})),N.d(w,"TrailMesh",(function(){return wh})),N.d(w,"InstancedMesh",(function(){return Nh.a})),N.d(w,"LinesMesh",(function(){return Fh.b})),N.d(w,"InstancedLinesMesh",(function(){return Fh.a})),N.d(w,"_CreationDataStorage",(function(){return xt.b})),N.d(w,"_InstancesBatch",(function(){return xt.c})),N.d(w,"Mesh",(function(){return xt.a})),N.d(w,"VertexData",(function(){return qi.a})),N.d(w,"MeshBuilder",(function(){return Td})),N.d(w,"SimplificationSettings",(function(){return du})),N.d(w,"SimplificationQueue",(function(){return Sd})),N.d(w,"SimplificationType",(function(){return _d})),N.d(w,"SimplicationQueueSceneComponent",(function(){return Cd})),N.d(w,"Polygon",(function(){return Jh})),N.d(w,"PolygonMeshBuilder",(function(){return $h})),N.d(w,"BaseSubMesh",(function(){return $l.a})),N.d(w,"SubMesh",(function(){return $l.b})),N.d(w,"MeshLODLevel",(function(){return Od.a})),N.d(w,"TransformNode",(function(){return So.a})),N.d(w,"BoxBuilder",(function(){return po.a})),N.d(w,"SphereBuilder",(function(){return vo.a})),N.d(w,"CylinderBuilder",(function(){return nr.a})),N.d(w,"TorusBuilder",(function(){return tr})),N.d(w,"LinesBuilder",(function(){return yo.a})),N.d(w,"PlaneBuilder",(function(){return Mo.a})),N.d(w,"GroundBuilder",(function(){return $i})),N.d(w,"DataBuffer",(function(){return Or.a})),N.d(w,"WebGLDataBuffer",(function(){return Rd.a})),N.d(w,"DracoCompression",(function(){return Jl})),N.d(w,"TiledBoxBuilder",(function(){return Yh})),N.d(w,"DiscBuilder",(function(){return Bh})),N.d(w,"RibbonBuilder",(function(){return xc})),N.d(w,"HemisphereBuilder",(function(){return Lo})),N.d(w,"TorusKnotBuilder",(function(){return Wh})),N.d(w,"PolygonBuilder",(function(){return td})),N.d(w,"ShapeBuilder",(function(){return Pc})),N.d(w,"LatheBuilder",(function(){return id})),N.d(w,"TiledPlaneBuilder",(function(){return ud})),N.d(w,"TubeBuilder",(function(){return hd})),N.d(w,"PolyhedronBuilder",(function(){return Po})),N.d(w,"IcoSphereBuilder",(function(){return fd})),N.d(w,"DecalBuilder",(function(){return gd})),N.d(w,"MorphTarget",(function(){return lc})),N.d(w,"MorphTargetManager",(function(){return fc})),N.d(w,"RecastJSPlugin",(function(){return Ld})),N.d(w,"RecastJSCrowd",(function(){return wd})),N.d(w,"Node",(function(){return we.a})),N.d(w,"Database",(function(){return Ud})),N.d(w,"BaseParticleSystem",(function(){return _f})),N.d(w,"GPUParticleSystem",(function(){return kf})),N.d(w,"Particle",(function(){return Of})),N.d(w,"ParticleHelper",(function(){return Vf})),N.d(w,"ParticleSystem",(function(){return Nf})),N.d(w,"_IDoNeedToBeInTheBuild",(function(){return 42})),N.d(w,"ParticleSystemSet",(function(){return Uf})),N.d(w,"SolidParticle",(function(){return Hf})),N.d(w,"ModelShape",(function(){return ih})),N.d(w,"DepthSortedParticle",(function(){return nh})),N.d(w,"SolidParticleSystem",(function(){return Wf})),N.d(w,"CloudPoint",(function(){return Zf})),N.d(w,"PointsGroup",(function(){return ah})),N.d(w,"PointColor",(function(){return Yf})),N.d(w,"PointsCloudSystem",(function(){return $f})),N.d(w,"SubEmitterType",(function(){return Bd})),N.d(w,"SubEmitter",(function(){return Rf})),N.d(w,"BoxParticleEmitter",(function(){return Vd})),N.d(w,"ConeParticleEmitter",(function(){return zd})),N.d(w,"CylinderParticleEmitter",(function(){return Yd})),N.d(w,"CylinderDirectedParticleEmitter",(function(){return Hd})),N.d(w,"HemisphericParticleEmitter",(function(){return Wd})),N.d(w,"PointParticleEmitter",(function(){return Xd})),N.d(w,"SphereParticleEmitter",(function(){return Qd})),N.d(w,"SphereDirectedParticleEmitter",(function(){return ef})),N.d(w,"CustomParticleEmitter",(function(){return af})),N.d(w,"MeshParticleEmitter",(function(){return cf})),N.d(w,"PhysicsEngine",(function(){return gc})),N.d(w,"PhysicsEngineSceneComponent",(function(){return np})),N.d(w,"PhysicsHelper",(function(){return ip})),N.d(w,"PhysicsRadialExplosionEventOptions",(function(){return mh})),N.d(w,"PhysicsUpdraftEventOptions",(function(){return gh})),N.d(w,"PhysicsVortexEventOptions",(function(){return vh})),N.d(w,"PhysicsRadialImpulseFalloff",(function(){return ep})),N.d(w,"PhysicsUpdraftMode",(function(){return tp})),N.d(w,"PhysicsImpostor",(function(){return pc.a})),N.d(w,"PhysicsJoint",(function(){return mc.e})),N.d(w,"DistanceJoint",(function(){return mc.a})),N.d(w,"MotorEnabledJoint",(function(){return mc.d})),N.d(w,"HingeJoint",(function(){return mc.c})),N.d(w,"Hinge2Joint",(function(){return mc.b})),N.d(w,"CannonJSPlugin",(function(){return Tc})),N.d(w,"AmmoJSPlugin",(function(){return Oc})),N.d(w,"OimoJSPlugin",(function(){return Sc})),N.d(w,"AnaglyphPostProcess",(function(){return mi})),N.d(w,"BlackAndWhitePostProcess",(function(){return cp})),N.d(w,"BloomEffect",(function(){return dp})),N.d(w,"BloomMergePostProcess",(function(){return hp})),N.d(w,"BlurPostProcess",(function(){return Fo})),N.d(w,"ChromaticAberrationPostProcess",(function(){return fp})),N.d(w,"CircleOfConfusionPostProcess",(function(){return pp})),N.d(w,"ColorCorrectionPostProcess",(function(){return _p})),N.d(w,"ConvolutionPostProcess",(function(){return mp})),N.d(w,"DepthOfFieldBlurPostProcess",(function(){return gp})),N.d(w,"DepthOfFieldEffectBlurLevel",(function(){return vp})),N.d(w,"DepthOfFieldEffect",(function(){return bp})),N.d(w,"DepthOfFieldMergePostProcessOptions",(function(){return Uh})),N.d(w,"DepthOfFieldMergePostProcess",(function(){return yp})),N.d(w,"DisplayPassPostProcess",(function(){return Tp})),N.d(w,"ExtractHighlightsPostProcess",(function(){return lp})),N.d(w,"FilterPostProcess",(function(){return Ep})),N.d(w,"FxaaPostProcess",(function(){return Sp})),N.d(w,"GrainPostProcess",(function(){return Mp})),N.d(w,"HighlightsPostProcess",(function(){return xp})),N.d(w,"ImageProcessingPostProcess",(function(){return Qi})),N.d(w,"MotionBlurPostProcess",(function(){return Cp})),N.d(w,"PassPostProcess",(function(){return pi})),N.d(w,"PassCubePostProcess",(function(){return _i})),N.d(w,"PostProcess",(function(){return fi})),N.d(w,"PostProcessManager",(function(){return Di.a})),N.d(w,"RefractionPostProcess",(function(){return Op})),N.d(w,"SharpenPostProcess",(function(){return Rp})),N.d(w,"StereoscopicInterlacePostProcessI",(function(){return Ti})),N.d(w,"StereoscopicInterlacePostProcess",(function(){return Ei})),N.d(w,"TonemappingOperator",(function(){return Up})),N.d(w,"TonemapPostProcess",(function(){return jp})),N.d(w,"VolumetricLightScatteringPostProcess",(function(){return zp})),N.d(w,"VRDistortionCorrectionPostProcess",(function(){return Oi})),N.d(w,"VRMultiviewToSingleviewPostProcess",(function(){return Fi})),N.d(w,"ScreenSpaceReflectionPostProcess",(function(){return kp})),N.d(w,"PostProcessRenderEffect",(function(){return up})),N.d(w,"PostProcessRenderPipeline",(function(){return Dp})),N.d(w,"PostProcessRenderPipelineManager",(function(){return Ip})),N.d(w,"PostProcessRenderPipelineManagerSceneComponent",(function(){return Lp})),N.d(w,"DefaultRenderingPipeline",(function(){return wp})),N.d(w,"LensRenderingPipeline",(function(){return Np})),N.d(w,"SSAO2RenderingPipeline",(function(){return Fp})),N.d(w,"SSAORenderingPipeline",(function(){return Bp})),N.d(w,"StandardRenderingPipeline",(function(){return Vp})),N.d(w,"ReflectionProbe",(function(){return Dc})),N.d(w,"BoundingBoxRenderer",(function(){return Gp})),N.d(w,"DepthRenderer",(function(){return Gs})),N.d(w,"DepthRendererSceneComponent",(function(){return Yp})),N.d(w,"EdgesRenderer",(function(){return Hp})),N.d(w,"LineEdgesRenderer",(function(){return Wp})),N.d(w,"GeometryBufferRenderer",(function(){return Ap})),N.d(w,"GeometryBufferRendererSceneComponent",(function(){return Pp})),N.d(w,"OutlineRenderer",(function(){return Xp})),N.d(w,"RenderingGroup",(function(){return Kp.a})),N.d(w,"RenderingGroupInfo",(function(){return Ii.a})),N.d(w,"RenderingManager",(function(){return Ii.b})),N.d(w,"UtilityLayerRenderer",(function(){return mo.a})),N.d(w,"Scene",(function(){return We.a})),N.d(w,"SceneComponentConstants",(function(){return Nt.a})),N.d(w,"Stage",(function(){return Nt.b})),N.d(w,"Sprite",(function(){return Qp})),N.d(w,"SpriteManager",(function(){return Zp})),N.d(w,"SpriteMap",(function(){return $p})),N.d(w,"SpritePackedManager",(function(){return e_})),N.d(w,"SpriteSceneComponent",(function(){return qp})),N.d(w,"AlphaState",(function(){return t_.a})),N.d(w,"DepthCullingState",(function(){return n_.a})),N.d(w,"StencilState",(function(){return i_.a})),N.d(w,"AndOrNotEvaluator",(function(){return r_.a})),N.d(w,"AssetTaskState",(function(){return Jp})),N.d(w,"AbstractAssetTask",(function(){return a_})),N.d(w,"AssetsProgressEvent",(function(){return of})),N.d(w,"MeshAssetTask",(function(){return s_})),N.d(w,"TextFileAssetTask",(function(){return c_})),N.d(w,"BinaryFileAssetTask",(function(){return u_})),N.d(w,"ImageAssetTask",(function(){return l_})),N.d(w,"TextureAssetTask",(function(){return h_})),N.d(w,"CubeTextureAssetTask",(function(){return d_})),N.d(w,"HDRCubeTextureAssetTask",(function(){return f_})),N.d(w,"EquiRectangularCubeTextureAssetTask",(function(){return p_})),N.d(w,"AssetsManager",(function(){return m_})),N.d(w,"BasisTranscodeConfiguration",(function(){return Hs})),N.d(w,"BasisTools",(function(){return ou})),N.d(w,"DDSTools",(function(){return ka})),N.d(w,"expandToProperty",(function(){return Ie.b})),N.d(w,"serialize",(function(){return Ie.c})),N.d(w,"serializeAsTexture",(function(){return Ie.m})),N.d(w,"serializeAsColor3",(function(){return Ie.e})),N.d(w,"serializeAsFresnelParameters",(function(){return Ie.h})),N.d(w,"serializeAsVector2",(function(){return Ie.n})),N.d(w,"serializeAsVector3",(function(){return Ie.o})),N.d(w,"serializeAsMeshReference",(function(){return Ie.k})),N.d(w,"serializeAsColorCurves",(function(){return Ie.g})),N.d(w,"serializeAsColor4",(function(){return Ie.f})),N.d(w,"serializeAsImageProcessingConfiguration",(function(){return Ie.i})),N.d(w,"serializeAsQuaternion",(function(){return Ie.l})),N.d(w,"serializeAsMatrix",(function(){return Ie.j})),N.d(w,"serializeAsCameraReference",(function(){return Ie.d})),N.d(w,"SerializationHelper",(function(){return Ie.a})),N.d(w,"Deferred",(function(){return g_})),N.d(w,"EnvironmentTextureTools",(function(){return Ur})),N.d(w,"MeshExploder",(function(){return v_})),N.d(w,"FilesInput",(function(){return y_})),N.d(w,"KhronosTextureContainer",(function(){return Xa})),N.d(w,"EventState",(function(){return j.a})),N.d(w,"Observer",(function(){return j.d})),N.d(w,"MultiObserver",(function(){return j.b})),N.d(w,"Observable",(function(){return j.c})),N.d(w,"PerformanceMonitor",(function(){return b_.a})),N.d(w,"RollingAverage",(function(){return b_.b})),N.d(w,"PromisePolyfill",(function(){return T_.a})),N.d(w,"SceneOptimization",(function(){return E_})),N.d(w,"TextureOptimization",(function(){return S_})),N.d(w,"HardwareScalingOptimization",(function(){return M_})),N.d(w,"ShadowsOptimization",(function(){return x_})),N.d(w,"PostProcessesOptimization",(function(){return A_})),N.d(w,"LensFlaresOptimization",(function(){return P_})),N.d(w,"CustomOptimization",(function(){return C_})),N.d(w,"ParticlesOptimization",(function(){return O_})),N.d(w,"RenderTargetsOptimization",(function(){return R_})),N.d(w,"MergeMeshesOptimization",(function(){return D_})),N.d(w,"SceneOptimizerOptions",(function(){return I_})),N.d(w,"SceneOptimizer",(function(){return L_})),N.d(w,"SceneSerializer",(function(){return N_})),N.d(w,"SmartArray",(function(){return ui.a})),N.d(w,"SmartArrayNoDuplicate",(function(){return ui.b})),N.d(w,"StringDictionary",(function(){return On.a})),N.d(w,"Tags",(function(){return F_.a})),N.d(w,"TextureTools",(function(){return B_})),N.d(w,"TGATools",(function(){return nu})),N.d(w,"Tools",(function(){return Dt.b})),N.d(w,"className",(function(){return Dt.c})),N.d(w,"AsyncLoop",(function(){return Dt.a})),N.d(w,"VideoRecorder",(function(){return k_})),N.d(w,"JoystickAxis",(function(){return Cn})),N.d(w,"VirtualJoystick",(function(){return Rn})),N.d(w,"WorkerPool",(function(){return Zl})),N.d(w,"Logger",(function(){return oe.a})),N.d(w,"_TypeStore",(function(){return H.a})),N.d(w,"FilesInputStore",(function(){return eo.a})),N.d(w,"DeepCopier",(function(){return xe.a})),N.d(w,"PivotTools",(function(){return Kt.a})),N.d(w,"PrecisionDate",(function(){return Xe.a})),N.d(w,"ScreenshotTools",(function(){return U_})),N.d(w,"WebRequest",(function(){return lu.a})),N.d(w,"InspectableType",(function(){return o_})),N.d(w,"BRDFTextureTools",(function(){return Jo})),N.d(w,"RGBDTextureTools",(function(){return Zo})),N.d(w,"ColorGradient",(function(){return bf})),N.d(w,"Color3Gradient",(function(){return Uu})),N.d(w,"FactorGradient",(function(){return Tf})),N.d(w,"GradientHelper",(function(){return Sf})),N.d(w,"PerfCounter",(function(){return Ss.a})),N.d(w,"RetryStrategy",(function(){return V_.a})),N.d(w,"CanvasGenerator",(function(){return Wi.a})),N.d(w,"LoadFileError",(function(){return ko.b})),N.d(w,"RequestFileError",(function(){return ko.d})),N.d(w,"ReadFileError",(function(){return ko.c})),N.d(w,"FileTools",(function(){return ko.a})),N.d(w,"StringTools",(function(){return Uo.a})),N.d(w,"DataReader",(function(){return j_})),N.d(w,"MinMaxReducer",(function(){return Ys})),N.d(w,"DepthReducer",(function(){return Ws})),N.d(w,"CubeMapToSphericalPolynomialTools",(function(){return Fr})),N.d(w,"HDRTools",(function(){return sc})),N.d(w,"PanoramaToCubeMapTools",(function(){return ac})),N.d(w,"WebXRCamera",(function(){return $a})),N.d(w,"WebXREnterExitUIButton",(function(){return _s})),N.d(w,"WebXREnterExitUIOptions",(function(){return _a})),N.d(w,"WebXREnterExitUI",(function(){return ms})),N.d(w,"WebXRExperienceHelper",(function(){return ns})),N.d(w,"WebXRInput",(function(){return ds})),N.d(w,"WebXRInputSource",(function(){return hs})),N.d(w,"WebXRManagedOutputCanvasOptions",(function(){return ir})),N.d(w,"WebXRManagedOutputCanvas",(function(){return rr})),N.d(w,"WebXRState",(function(){return er})),N.d(w,"WebXRSessionManager",(function(){return or})),N.d(w,"WebXRDefaultExperienceOptions",(function(){return va})),N.d(w,"WebXRDefaultExperience",(function(){return vs})),N.d(w,"WebXRFeatureName",(function(){return es})),N.d(w,"WebXRFeaturesManager",(function(){return ts})),N.d(w,"WebXRHitTestLegacy",(function(){return z_})),N.d(w,"WebXRAnchorSystem",(function(){return Y_})),N.d(w,"WebXRPlaneDetector",(function(){return W_})),N.d(w,"WebXRBackgroundRemover",(function(){return X_})),N.d(w,"WebXRMotionControllerTeleportation",(function(){return gs})),N.d(w,"WebXRControllerPointerSelection",(function(){return ps})),N.d(w,"IWebXRControllerPhysicsOptions",(function(){return Kf})),N.d(w,"WebXRControllerPhysics",(function(){return K_})),N.d(w,"WebXRAbstractMotionController",(function(){return rs})),N.d(w,"WebXRControllerComponent",(function(){return is})),N.d(w,"WebXRGenericTriggerMotionController",(function(){return os})),N.d(w,"WebXRMicrosoftMixedRealityController",(function(){return Q_})),N.d(w,"WebXRMotionControllerManager",(function(){return us})),N.d(w,"WebXROculusTouchMotionController",(function(){return Z_})),N.d(w,"WebXRHTCViveMotionController",(function(){return $_})),N.d(w,"WebXRProfiledMotionController",(function(){return cs}))},function(D,w,N){"use strict";N.d(w,"a",(function(){return k}));var F=N(38),k=function(){function e(){}return e.SetImmediate=function(D){F.a.IsWindowObjectExist()&&window.setImmediate?window.setImmediate(D):setTimeout(D,1)},e}()},function(D,w,N){"use strict";var F=N(36),k=function(){function e(){this.children=[]}return e.prototype.isValid=function(D){return!0},e.prototype.process=function(D,w){var N="";if(this.line){var k=this.line,j=w.processor;j&&(j.lineProcessor&&(k=j.lineProcessor(k,w.isFragment)),j.attributeProcessor&&F.a.StartsWith(this.line,"attribute")?k=j.attributeProcessor(this.line):j.varyingProcessor&&F.a.StartsWith(this.line,"varying")?k=j.varyingProcessor(this.line,w.isFragment):(j.uniformProcessor||j.uniformBufferProcessor)&&F.a.StartsWith(this.line,"uniform")&&(/uniform (.+) (.+)/.test(this.line)?j.uniformProcessor&&(k=j.uniformProcessor(this.line,w.isFragment)):j.uniformBufferProcessor&&(k=j.uniformBufferProcessor(this.line,w.isFragment),w.lookForClosingBracketForUniformBuffer=!0)),j.endOfUniformBufferProcessor&&w.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(w.lookForClosingBracketForUniformBuffer=!1,k=j.endOfUniformBufferProcessor(this.line,w.isFragment))),N+=k+"\r\n"}return this.children.forEach((function(F){N+=F.process(D,w)})),this.additionalDefineKey&&(D[this.additionalDefineKey]=this.additionalDefineValue||"true"),N},e}(),j=function(){function e(){}return Object.defineProperty(e.prototype,"currentLine",{get:function(){return this._lines[this.lineIndex]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canRead",{get:function(){return this.lineIndex<this._lines.length-1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lines",{set:function(D){this._lines=[];for(var w=0,N=D;w<N.length;w++){var F=N[w];if("#"!==F[0])for(var k=F.split(";"),j=0;j<k.length;j++){var z=k[j];(z=z.trim())&&this._lines.push(z+(j!==k.length-1?";":""))}else this._lines.push(F)}},enumerable:!0,configurable:!0}),e}(),z=N(1),G=function(D){function t(){return null!==D&&D.apply(this,arguments)||this}return Object(z.d)(t,D),t.prototype.process=function(D,w){for(var N=0;N<this.children.length;N++){var F=this.children[N];if(F.isValid(D))return F.process(D,w)}return""},t}(k),H=function(D){function t(){return null!==D&&D.apply(this,arguments)||this}return Object(z.d)(t,D),t.prototype.isValid=function(D){return this.testExpression.isTrue(D)},t}(k),X=function(){function e(){}return e.prototype.isTrue=function(D){return!0},e}(),q=function(D){function t(w,N){void 0===N&&(N=!1);var F=D.call(this)||this;return F.define=w,F.not=N,F}return Object(z.d)(t,D),t.prototype.isTrue=function(D){var w=void 0!==D[this.define];return this.not&&(w=!w),w},t}(X),Z=function(D){function t(){return null!==D&&D.apply(this,arguments)||this}return Object(z.d)(t,D),t.prototype.isTrue=function(D){return this.leftOperand.isTrue(D)||this.rightOperand.isTrue(D)},t}(X),J=function(D){function t(){return null!==D&&D.apply(this,arguments)||this}return Object(z.d)(t,D),t.prototype.isTrue=function(D){return this.leftOperand.isTrue(D)&&this.rightOperand.isTrue(D)},t}(X),$=function(D){function t(w,N,F){var k=D.call(this)||this;return k.define=w,k.operand=N,k.testValue=F,k}return Object(z.d)(t,D),t.prototype.isTrue=function(D){var w=D[this.define];void 0===w&&(w=this.define);var N=!1,F=parseInt(w),k=parseInt(this.testValue);switch(this.operand){case">":N=F>k;break;case"<":N=F<k;break;case"<=":N=F<=k;break;case">=":N=F>=k;break;case"==":N=F===k}return N},t}(X),te=N(19);N.d(w,"a",(function(){return ie}));var ie=function(){function e(){}return e.Process=function(D,w,N){var F=this;this._ProcessIncludes(D,w,(function(D){var k=F._ProcessShaderConversion(D,w);N(k)}))},e._ProcessPrecision=function(D,w){var N=w.shouldUseHighPrecisionShader;return-1===D.indexOf("precision highp float")?D=N?"precision highp float;\n"+D:"precision mediump float;\n"+D:N||(D=D.replace("precision highp float","precision mediump float")),D},e._ExtractOperation=function(D){var w=/defined\((.+)\)/.exec(D);if(w&&w.length)return new q(w[1].trim(),"!"===D[0]);for(var N="",F=0,k=0,j=["==",">=","<=","<",">"];k<j.length&&(N=j[k],!((F=D.indexOf(N))>-1));k++);if(-1===F)return new q(D);var z=D.substring(0,F).trim(),G=D.substring(F+N.length).trim();return new $(z,N,G)},e._BuildSubExpression=function(D){var w=D.indexOf("||");if(-1===w){var N=D.indexOf("&&");if(N>-1){var F=new J,k=D.substring(0,N).trim(),j=D.substring(N+2).trim();return F.leftOperand=this._BuildSubExpression(k),F.rightOperand=this._BuildSubExpression(j),F}return this._ExtractOperation(D)}var z=new Z;return k=D.substring(0,w).trim(),j=D.substring(w+2).trim(),z.leftOperand=this._BuildSubExpression(k),z.rightOperand=this._BuildSubExpression(j),z},e._BuildExpression=function(D,w){var N=new H,F=D.substring(0,w),k=D.substring(w).trim();return N.testExpression="#ifdef"===F?new q(k):"#ifndef"===F?new q(k,!0):this._BuildSubExpression(k),N},e._MoveCursorWithinIf=function(D,w,N){for(var F=D.currentLine;this._MoveCursor(D,N);){var j=(F=D.currentLine).substring(0,5).toLowerCase();if("#else"===j){var z=new k;return w.children.push(z),void this._MoveCursor(D,z)}if("#elif"===j){var G=this._BuildExpression(F,5);w.children.push(G),N=G}}},e._MoveCursor=function(D,w){for(;D.canRead;){D.lineIndex++;var N=D.currentLine,F=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/.exec(N);if(F&&F.length)switch(F[0]){case"#ifdef":var j=new G;w.children.push(j);var z=this._BuildExpression(N,6);j.children.push(z),this._MoveCursorWithinIf(D,j,z);break;case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":j=new G,w.children.push(j),z=this._BuildExpression(N,7),j.children.push(z),this._MoveCursorWithinIf(D,j,z);break;case"#if":j=new G,z=this._BuildExpression(N,3),w.children.push(j),j.children.push(z),this._MoveCursorWithinIf(D,j,z)}else{var H=new k;if(H.line=N,w.children.push(H),"#"===N[0]&&"d"===N[1]){var X=N.replace(";","").split(" ");H.additionalDefineKey=X[1],3===X.length&&(H.additionalDefineValue=X[2])}}}return!1},e._EvaluatePreProcessors=function(D,w,N){var F=new k,z=new j;return z.lineIndex=-1,z.lines=D.split("\n"),this._MoveCursor(z,F),F.process(w,N)},e._PreparePreProcessors=function(D){for(var w={},N=0,F=D.defines;N<F.length;N++){var k=F[N].replace("#define","").replace(";","").trim().split(" ");w[k[0]]=k.length>1?k[1]:""}return w.GL_ES="true",w.__VERSION__=D.version,w[D.platformName]="true",w},e._ProcessShaderConversion=function(D,w){var N=this._ProcessPrecision(D,w);if(!w.processor)return N;if(-1!==N.indexOf("#version 3"))return N.replace("#version 300 es","");var F=w.defines,k=this._PreparePreProcessors(w);return w.processor.preProcessor&&(N=w.processor.preProcessor(N,F,w.isFragment)),N=this._EvaluatePreProcessors(N,k,w),w.processor.postProcessor&&(N=w.processor.postProcessor(N,F,w.isFragment)),N},e._ProcessIncludes=function(D,w,N){for(var F=this,k=/#include<(.+)>(\((.*)\))*(\[(.*)\])*/g,j=k.exec(D),z=new String(D);null!=j;){var G=j[1];if(-1!==G.indexOf("__decl__")&&(G=G.replace(/__decl__/,""),w.supportsUniformBuffers&&(G=(G=G.replace(/Vertex/,"Ubo")).replace(/Fragment/,"Ubo")),G+="Declaration"),!w.includesShadersStore[G]){var H=w.shadersRepository+"ShadersInclude/"+G+".fx";return void e._FileToolsLoadFile(H,(function(D){w.includesShadersStore[G]=D,F._ProcessIncludes(z,w,N)}))}var X=w.includesShadersStore[G];if(j[2])for(var q=j[3].split(","),Z=0;Z<q.length;Z+=2){var J=new RegExp(q[Z],"g"),$=q[Z+1];X=X.replace(J,$)}if(j[4]){var te=j[5];if(-1!==te.indexOf("..")){var ie=te.split(".."),oe=parseInt(ie[0]),ce=parseInt(ie[1]),he=X.slice(0);X="",isNaN(ce)&&(ce=w.indexParameters[ie[1]]);for(var fe=oe;fe<ce;fe++)w.supportsUniformBuffers||(he=he.replace(/light\{X\}.(\w*)/g,(function(D,w){return w+"{X}"}))),X+=he.replace(/\{X\}/g,fe.toString())+"\n"}else w.supportsUniformBuffers||(X=X.replace(/light\{X\}.(\w*)/g,(function(D,w){return w+"{X}"}))),X=X.replace(/\{X\}/g,te)}z=z.replace(j[0],X),j=k.exec(D)}N(z)},e._FileToolsLoadFile=function(D,w,N,F,k,j){throw te.a.WarnImport("FileTools")},e}()},function(D,w,N){"use strict";N(8).a.IncludesShadersStore.shadowsFragmentFunctions="#ifdef SHADOWS\n#ifndef SHADOWFLOAT\n\nfloat unpack(vec4 color)\n{\nconst vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);\nreturn dot(color,bit_shift);\n}\n#endif\nfloat computeFallOff(float value,vec2 clipSpace,float frustumEdgeFalloff)\n{\nfloat mask=smoothstep(1.0-frustumEdgeFalloff,1.00000012,clamp(dot(clipSpace,clipSpace),0.,1.));\nreturn mix(value,1.0,mask);\n}\nfloat computeShadowCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadow=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadow=textureCube(shadowSampler,directionToLight).x;\n#endif\nif (depth>shadow)\n{\nreturn darkness;\n}\nreturn 1.0;\n}\nfloat computeShadowWithPoissonSamplingCube(vec3 lightPosition,samplerCube shadowSampler,float mapSize,float darkness,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\nfloat visibility=1.;\nvec3 poissonDisk[4];\npoissonDisk[0]=vec3(-1.0,1.0,-1.0);\npoissonDisk[1]=vec3(1.0,-1.0,-1.0);\npoissonDisk[2]=vec3(-1.0,-1.0,-1.0);\npoissonDisk[3]=vec3(1.0,-1.0,1.0);\n\n#ifndef SHADOWFLOAT\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize))<depth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize))<depth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize))<depth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize))<depth) visibility-=0.25;\n#else\nif (textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize).x<depth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize).x<depth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize).x<depth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize).x<depth) visibility-=0.25;\n#endif\nreturn min(1.0,visibility+darkness);\n}\nfloat computeShadowWithESMCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\nfloat shadowPixelDepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadowMapSample=textureCube(shadowSampler,directionToLight).x;\n#endif\nfloat esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness);\nreturn esm;\n}\nfloat computeShadowWithCloseESMCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\nfloat shadowPixelDepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadowMapSample=textureCube(shadowSampler,directionToLight).x;\n#endif\nfloat esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);\nreturn esm;\n}\n#ifdef WEBGL2\nfloat computeShadowCSM(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray shadowSampler,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nvec3 uvLayer=vec3(uv.x,uv.y,layer);\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadow=unpack(texture2D(shadowSampler,uvLayer));\n#else\nfloat shadow=texture2D(shadowSampler,uvLayer).x;\n#endif\nif (shadowPixelDepth>shadow)\n{\nreturn computeFallOff(darkness,clipSpace.xy,frustumEdgeFalloff);\n}\nreturn 1.;\n}\n#endif\nfloat computeShadow(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadow=unpack(texture2D(shadowSampler,uv));\n#else\nfloat shadow=texture2D(shadowSampler,uv).x;\n#endif\nif (shadowPixelDepth>shadow)\n{\nreturn computeFallOff(darkness,clipSpace.xy,frustumEdgeFalloff);\n}\nreturn 1.;\n}\nfloat computeShadowWithPoissonSampling(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float mapSize,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\nfloat visibility=1.;\nvec2 poissonDisk[4];\npoissonDisk[0]=vec2(-0.94201624,-0.39906216);\npoissonDisk[1]=vec2(0.94558609,-0.76890725);\npoissonDisk[2]=vec2(-0.094184101,-0.92938870);\npoissonDisk[3]=vec2(0.34495938,0.29387760);\n\n#ifndef SHADOWFLOAT\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[0]*mapSize))<shadowPixelDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[1]*mapSize))<shadowPixelDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[2]*mapSize))<shadowPixelDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[3]*mapSize))<shadowPixelDepth) visibility-=0.25;\n#else\nif (texture2D(shadowSampler,uv+poissonDisk[0]*mapSize).x<shadowPixelDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[1]*mapSize).x<shadowPixelDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[2]*mapSize).x<shadowPixelDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[3]*mapSize).x<shadowPixelDepth) visibility-=0.25;\n#endif\nreturn computeFallOff(min(1.0,visibility+darkness),clipSpace.xy,frustumEdgeFalloff);\n}\nfloat computeShadowWithESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(texture2D(shadowSampler,uv));\n#else\nfloat shadowMapSample=texture2D(shadowSampler,uv).x;\n#endif\nfloat esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness);\nreturn computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);\n}\nfloat computeShadowWithCloseESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(texture2D(shadowSampler,uv));\n#else\nfloat shadowMapSample=texture2D(shadowSampler,uv).x;\n#endif\nfloat esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);\nreturn computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);\n}\n#ifdef WEBGL2\n#define GREATEST_LESS_THAN_ONE 0.99999994\n\nfloat computeShadowWithCSMPCF1(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=clamp(uvDepth.z,0.,GREATEST_LESS_THAN_ONE);\nvec4 uvDepthLayer=vec4(uvDepth.x,uvDepth.y,layer,uvDepth.z);\nfloat shadow=texture(shadowSampler,uvDepthLayer);\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n\n\n\nfloat computeShadowWithCSMPCF3(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=clamp(uvDepth.z,0.,GREATEST_LESS_THAN_ONE);\nvec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x;\nuv+=0.5;\nvec2 st=fract(uv);\nvec2 base_uv=floor(uv)-0.5;\nbase_uv*=shadowMapSizeAndInverse.y;\n\n\n\n\nvec2 uvw0=3.-2.*st;\nvec2 uvw1=1.+2.*st;\nvec2 u=vec2((2.-st.x)/uvw0.x-1.,st.x/uvw1.x+1.)*shadowMapSizeAndInverse.y;\nvec2 v=vec2((2.-st.y)/uvw0.y-1.,st.y/uvw1.y+1.)*shadowMapSizeAndInverse.y;\nfloat shadow=0.;\nshadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[0]),layer,uvDepth.z));\nshadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[0]),layer,uvDepth.z));\nshadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[1]),layer,uvDepth.z));\nshadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[1]),layer,uvDepth.z));\nshadow=shadow/16.;\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n\n\n\nfloat computeShadowWithCSMPCF5(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=clamp(uvDepth.z,0.,GREATEST_LESS_THAN_ONE);\nvec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x;\nuv+=0.5;\nvec2 st=fract(uv);\nvec2 base_uv=floor(uv)-0.5;\nbase_uv*=shadowMapSizeAndInverse.y;\n\n\nvec2 uvw0=4.-3.*st;\nvec2 uvw1=vec2(7.);\nvec2 uvw2=1.+3.*st;\nvec3 u=vec3((3.-2.*st.x)/uvw0.x-2.,(3.+st.x)/uvw1.x,st.x/uvw2.x+2.)*shadowMapSizeAndInverse.y;\nvec3 v=vec3((3.-2.*st.y)/uvw0.y-2.,(3.+st.y)/uvw1.y,st.y/uvw2.y+2.)*shadowMapSizeAndInverse.y;\nfloat shadow=0.;\nshadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[0]),layer,uvDepth.z));\nshadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[0]),layer,uvDepth.z));\nshadow+=uvw2.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[0]),layer,uvDepth.z));\nshadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[1]),layer,uvDepth.z));\nshadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[1]),layer,uvDepth.z));\nshadow+=uvw2.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[1]),layer,uvDepth.z));\nshadow+=uvw0.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[2]),layer,uvDepth.z));\nshadow+=uvw1.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[2]),layer,uvDepth.z));\nshadow+=uvw2.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[2]),layer,uvDepth.z));\nshadow=shadow/144.;\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n\nfloat computeShadowWithPCF1(vec4 vPositionFromLight,float depthMetric,sampler2DShadow shadowSampler,float darkness,float frustumEdgeFalloff)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nfloat shadow=texture2D(shadowSampler,uvDepth);\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n\n\n\nfloat computeShadowWithPCF3(vec4 vPositionFromLight,float depthMetric,sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nvec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x;\nuv+=0.5;\nvec2 st=fract(uv);\nvec2 base_uv=floor(uv)-0.5;\nbase_uv*=shadowMapSizeAndInverse.y;\n\n\n\n\nvec2 uvw0=3.-2.*st;\nvec2 uvw1=1.+2.*st;\nvec2 u=vec2((2.-st.x)/uvw0.x-1.,st.x/uvw1.x+1.)*shadowMapSizeAndInverse.y;\nvec2 v=vec2((2.-st.y)/uvw0.y-1.,st.y/uvw1.y+1.)*shadowMapSizeAndInverse.y;\nfloat shadow=0.;\nshadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z));\nshadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z));\nshadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z));\nshadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z));\nshadow=shadow/16.;\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n\n\n\nfloat computeShadowWithPCF5(vec4 vPositionFromLight,float depthMetric,sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nvec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x;\nuv+=0.5;\nvec2 st=fract(uv);\nvec2 base_uv=floor(uv)-0.5;\nbase_uv*=shadowMapSizeAndInverse.y;\n\n\nvec2 uvw0=4.-3.*st;\nvec2 uvw1=vec2(7.);\nvec2 uvw2=1.+3.*st;\nvec3 u=vec3((3.-2.*st.x)/uvw0.x-2.,(3.+st.x)/uvw1.x,st.x/uvw2.x+2.)*shadowMapSizeAndInverse.y;\nvec3 v=vec3((3.-2.*st.y)/uvw0.y-2.,(3.+st.y)/uvw1.y,st.y/uvw2.y+2.)*shadowMapSizeAndInverse.y;\nfloat shadow=0.;\nshadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z));\nshadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z));\nshadow+=uvw2.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[0]),uvDepth.z));\nshadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z));\nshadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z));\nshadow+=uvw2.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[1]),uvDepth.z));\nshadow+=uvw0.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[2]),uvDepth.z));\nshadow+=uvw1.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[2]),uvDepth.z));\nshadow+=uvw2.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[2]),uvDepth.z));\nshadow=shadow/144.;\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\nconst vec3 PoissonSamplers32[64]=vec3[64](\nvec3(0.06407013,0.05409927,0.),\nvec3(0.7366577,0.5789394,0.),\nvec3(-0.6270542,-0.5320278,0.),\nvec3(-0.4096107,0.8411095,0.),\nvec3(0.6849564,-0.4990818,0.),\nvec3(-0.874181,-0.04579735,0.),\nvec3(0.9989998,0.0009880066,0.),\nvec3(-0.004920578,-0.9151649,0.),\nvec3(0.1805763,0.9747483,0.),\nvec3(-0.2138451,0.2635818,0.),\nvec3(0.109845,0.3884785,0.),\nvec3(0.06876755,-0.3581074,0.),\nvec3(0.374073,-0.7661266,0.),\nvec3(0.3079132,-0.1216763,0.),\nvec3(-0.3794335,-0.8271583,0.),\nvec3(-0.203878,-0.07715034,0.),\nvec3(0.5912697,0.1469799,0.),\nvec3(-0.88069,0.3031784,0.),\nvec3(0.5040108,0.8283722,0.),\nvec3(-0.5844124,0.5494877,0.),\nvec3(0.6017799,-0.1726654,0.),\nvec3(-0.5554981,0.1559997,0.),\nvec3(-0.3016369,-0.3900928,0.),\nvec3(-0.5550632,-0.1723762,0.),\nvec3(0.925029,0.2995041,0.),\nvec3(-0.2473137,0.5538505,0.),\nvec3(0.9183037,-0.2862392,0.),\nvec3(0.2469421,0.6718712,0.),\nvec3(0.3916397,-0.4328209,0.),\nvec3(-0.03576927,-0.6220032,0.),\nvec3(-0.04661255,0.7995201,0.),\nvec3(0.4402924,0.3640312,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.)\n);\nconst vec3 PoissonSamplers64[64]=vec3[64](\nvec3(-0.613392,0.617481,0.),\nvec3(0.170019,-0.040254,0.),\nvec3(-0.299417,0.791925,0.),\nvec3(0.645680,0.493210,0.),\nvec3(-0.651784,0.717887,0.),\nvec3(0.421003,0.027070,0.),\nvec3(-0.817194,-0.271096,0.),\nvec3(-0.705374,-0.668203,0.),\nvec3(0.977050,-0.108615,0.),\nvec3(0.063326,0.142369,0.),\nvec3(0.203528,0.214331,0.),\nvec3(-0.667531,0.326090,0.),\nvec3(-0.098422,-0.295755,0.),\nvec3(-0.885922,0.215369,0.),\nvec3(0.566637,0.605213,0.),\nvec3(0.039766,-0.396100,0.),\nvec3(0.751946,0.453352,0.),\nvec3(0.078707,-0.715323,0.),\nvec3(-0.075838,-0.529344,0.),\nvec3(0.724479,-0.580798,0.),\nvec3(0.222999,-0.215125,0.),\nvec3(-0.467574,-0.405438,0.),\nvec3(-0.248268,-0.814753,0.),\nvec3(0.354411,-0.887570,0.),\nvec3(0.175817,0.382366,0.),\nvec3(0.487472,-0.063082,0.),\nvec3(-0.084078,0.898312,0.),\nvec3(0.488876,-0.783441,0.),\nvec3(0.470016,0.217933,0.),\nvec3(-0.696890,-0.549791,0.),\nvec3(-0.149693,0.605762,0.),\nvec3(0.034211,0.979980,0.),\nvec3(0.503098,-0.308878,0.),\nvec3(-0.016205,-0.872921,0.),\nvec3(0.385784,-0.393902,0.),\nvec3(-0.146886,-0.859249,0.),\nvec3(0.643361,0.164098,0.),\nvec3(0.634388,-0.049471,0.),\nvec3(-0.688894,0.007843,0.),\nvec3(0.464034,-0.188818,0.),\nvec3(-0.440840,0.137486,0.),\nvec3(0.364483,0.511704,0.),\nvec3(0.034028,0.325968,0.),\nvec3(0.099094,-0.308023,0.),\nvec3(0.693960,-0.366253,0.),\nvec3(0.678884,-0.204688,0.),\nvec3(0.001801,0.780328,0.),\nvec3(0.145177,-0.898984,0.),\nvec3(0.062655,-0.611866,0.),\nvec3(0.315226,-0.604297,0.),\nvec3(-0.780145,0.486251,0.),\nvec3(-0.371868,0.882138,0.),\nvec3(0.200476,0.494430,0.),\nvec3(-0.494552,-0.711051,0.),\nvec3(0.612476,0.705252,0.),\nvec3(-0.578845,-0.768792,0.),\nvec3(-0.772454,-0.090976,0.),\nvec3(0.504440,0.372295,0.),\nvec3(0.155736,0.065157,0.),\nvec3(0.391522,0.849605,0.),\nvec3(-0.620106,-0.328104,0.),\nvec3(0.789239,-0.419965,0.),\nvec3(-0.545396,0.538133,0.),\nvec3(-0.178564,-0.596057,0.)\n);\n\n\n\n\n\nfloat computeShadowWithCSMPCSS(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,int searchTapCount,int pcfTapCount,vec3[64] poissonSamplers,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=clamp(uvDepth.z,0.,GREATEST_LESS_THAN_ONE);\nvec4 uvDepthLayer=vec4(uvDepth.x,uvDepth.y,layer,uvDepth.z);\nfloat blockerDepth=0.0;\nfloat sumBlockerDepth=0.0;\nfloat numBlocker=0.0;\nfor (int i=0; i<searchTapCount; i ++) {\nblockerDepth=texture(depthSampler,vec3(uvDepth.xy+(lightSizeUV*lightSizeUVCorrection*shadowMapSizeInverse*PoissonSamplers32[i].xy),layer)).r;\nif (blockerDepth<depthMetric) {\nsumBlockerDepth+=blockerDepth;\nnumBlocker++;\n}\n}\nif (numBlocker<1.0) {\nreturn 1.0;\n}\nfloat avgBlockerDepth=sumBlockerDepth/numBlocker;\n\nfloat AAOffset=shadowMapSizeInverse*10.;\n\n\nfloat penumbraRatio=((depthMetric-avgBlockerDepth)*depthCorrection+AAOffset);\nvec4 filterRadius=vec4(penumbraRatio*lightSizeUV*lightSizeUVCorrection*shadowMapSizeInverse,0.,0.);\nfloat random=getRand(vPositionFromLight.xy);\nfloat rotationAngle=random*3.1415926;\nvec2 rotationVector=vec2(cos(rotationAngle),sin(rotationAngle));\nfloat shadow=0.;\nfor (int i=0; i<pcfTapCount; i++) {\nvec4 offset=vec4(poissonSamplers[i],0.);\n\noffset=vec4(offset.x*rotationVector.x-offset.y*rotationVector.y,offset.y*rotationVector.x+offset.x*rotationVector.y,0.,0.);\nshadow+=texture2D(shadowSampler,uvDepthLayer+offset*filterRadius);\n}\nshadow/=float(pcfTapCount);\n\nshadow=mix(shadow,1.,min((depthMetric-avgBlockerDepth)*depthCorrection*penumbraDarkness,1.));\n\nshadow=mix(darkness,1.,shadow);\n\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n\n\n\n\n\nfloat computeShadowWithPCSS(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,int searchTapCount,int pcfTapCount,vec3[64] poissonSamplers)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nfloat blockerDepth=0.0;\nfloat sumBlockerDepth=0.0;\nfloat numBlocker=0.0;\nfor (int i=0; i<searchTapCount; i ++) {\nblockerDepth=texture(depthSampler,uvDepth.xy+(lightSizeUV*shadowMapSizeInverse*PoissonSamplers32[i].xy)).r;\nif (blockerDepth<depthMetric) {\nsumBlockerDepth+=blockerDepth;\nnumBlocker++;\n}\n}\nif (numBlocker<1.0) {\nreturn 1.0;\n}\nfloat avgBlockerDepth=sumBlockerDepth/numBlocker;\n\nfloat AAOffset=shadowMapSizeInverse*10.;\n\n\nfloat penumbraRatio=((depthMetric-avgBlockerDepth)+AAOffset);\nfloat filterRadius=penumbraRatio*lightSizeUV*shadowMapSizeInverse;\nfloat random=getRand(vPositionFromLight.xy);\nfloat rotationAngle=random*3.1415926;\nvec2 rotationVector=vec2(cos(rotationAngle),sin(rotationAngle));\nfloat shadow=0.;\nfor (int i=0; i<pcfTapCount; i++) {\nvec3 offset=poissonSamplers[i];\n\noffset=vec3(offset.x*rotationVector.x-offset.y*rotationVector.y,offset.y*rotationVector.x+offset.x*rotationVector.y,0.);\nshadow+=texture2D(shadowSampler,uvDepth+offset*filterRadius);\n}\nshadow/=float(pcfTapCount);\n\nshadow=mix(shadow,1.,depthMetric-avgBlockerDepth);\n\nshadow=mix(darkness,1.,shadow);\n\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\nfloat computeShadowWithPCSS16(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)\n{\nreturn computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,16,PoissonSamplers32);\n}\nfloat computeShadowWithPCSS32(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)\n{\nreturn computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,32,PoissonSamplers32);\n}\nfloat computeShadowWithPCSS64(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)\n{\nreturn computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,32,64,PoissonSamplers64);\n}\nfloat computeShadowWithCSMPCSS16(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)\n{\nreturn computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,16,PoissonSamplers32,lightSizeUVCorrection,depthCorrection,penumbraDarkness);\n}\nfloat computeShadowWithCSMPCSS32(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)\n{\nreturn computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,32,PoissonSamplers32,lightSizeUVCorrection,depthCorrection,penumbraDarkness);\n}\nfloat computeShadowWithCSMPCSS64(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)\n{\nreturn computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,32,64,PoissonSamplers64,lightSizeUVCorrection,depthCorrection,penumbraDarkness);\n}\n#endif\n#endif\n"},function(D,w,N){"use strict";N(8).a.IncludesShadersStore.reflectionFunction="vec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {\n\nvec3 invOrigVec=vec3(1.0,1.0,1.0)/origVec;\nvec3 halfSize=cubeSize*0.5;\nvec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;\nvec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;\n\nvec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);\n\nfloat distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);\n\nvec3 intersectPositionWS=vertexPos+origVec*distance;\n\nreturn intersectPositionWS-cubePos;\n}\nvec3 computeFixedEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 direction)\n{\nfloat lon=atan(direction.z,direction.x);\nfloat lat=acos(direction.y);\nvec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;\nfloat s=sphereCoords.x*0.5+0.5;\nfloat t=sphereCoords.y;\nreturn vec3(s,t,0);\n}\nvec3 computeMirroredFixedEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 direction)\n{\nfloat lon=atan(direction.z,direction.x);\nfloat lat=acos(direction.y);\nvec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;\nfloat s=sphereCoords.x*0.5+0.5;\nfloat t=sphereCoords.y;\nreturn vec3(1.0-s,t,0);\n}\nvec3 computeEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)\n{\nvec3 cameraToVertex=normalize(worldPos.xyz-eyePosition);\nvec3 r=normalize(reflect(cameraToVertex,worldNormal));\nr=vec3(reflectionMatrix*vec4(r,0));\nfloat lon=atan(r.z,r.x);\nfloat lat=acos(r.y);\nvec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;\nfloat s=sphereCoords.x*0.5+0.5;\nfloat t=sphereCoords.y;\nreturn vec3(s,t,0);\n}\nvec3 computeSphericalCoords(vec4 worldPos,vec3 worldNormal,mat4 view,mat4 reflectionMatrix)\n{\nvec3 viewDir=normalize(vec3(view*worldPos));\nvec3 viewNormal=normalize(vec3(view*vec4(worldNormal,0.0)));\nvec3 r=reflect(viewDir,viewNormal);\nr=vec3(reflectionMatrix*vec4(r,0));\nr.z=r.z-1.0;\nfloat m=2.0*length(r);\nreturn vec3(r.x/m+0.5,1.0-r.y/m-0.5,0);\n}\nvec3 computePlanarCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)\n{\nvec3 viewDir=worldPos.xyz-eyePosition;\nvec3 coords=normalize(reflect(viewDir,worldNormal));\nreturn vec3(reflectionMatrix*vec4(coords,1));\n}\nvec3 computeCubicCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)\n{\nvec3 viewDir=normalize(worldPos.xyz-eyePosition);\n\nvec3 coords=reflect(viewDir,worldNormal);\ncoords=vec3(reflectionMatrix*vec4(coords,0));\n#ifdef INVERTCUBICMAP\ncoords.y*=-1.0;\n#endif\nreturn coords;\n}\nvec3 computeCubicLocalCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix,vec3 reflectionSize,vec3 reflectionPosition)\n{\nvec3 viewDir=normalize(worldPos.xyz-eyePosition);\n\nvec3 coords=reflect(viewDir,worldNormal);\ncoords=parallaxCorrectNormal(worldPos.xyz,coords,reflectionSize,reflectionPosition);\ncoords=vec3(reflectionMatrix*vec4(coords,0));\n#ifdef INVERTCUBICMAP\ncoords.y*=-1.0;\n#endif\nreturn coords;\n}\nvec3 computeProjectionCoords(vec4 worldPos,mat4 view,mat4 reflectionMatrix)\n{\nreturn vec3(reflectionMatrix*(view*worldPos));\n}\nvec3 computeSkyBoxCoords(vec3 positionW,mat4 reflectionMatrix)\n{\nreturn vec3(reflectionMatrix*vec4(positionW,0));\n}\n#ifdef REFLECTION\nvec3 computeReflectionCoords(vec4 worldPos,vec3 worldNormal)\n{\n#ifdef REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED\nvec3 direction=normalize(vDirectionW);\nreturn computeMirroredFixedEquirectangularCoords(worldPos,worldNormal,direction);\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvec3 direction=normalize(vDirectionW);\nreturn computeFixedEquirectangularCoords(worldPos,worldNormal,direction);\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR\nreturn computeEquirectangularCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_SPHERICAL\nreturn computeSphericalCoords(worldPos,worldNormal,view,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_PLANAR\nreturn computePlanarCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_CUBIC\n#ifdef USE_LOCAL_REFLECTIONMAP_CUBIC\nreturn computeCubicLocalCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix,vReflectionSize,vReflectionPosition);\n#else\nreturn computeCubicCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);\n#endif\n#endif\n#ifdef REFLECTIONMAP_PROJECTION\nreturn computeProjectionCoords(worldPos,view,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nreturn computeSkyBoxCoords(vPositionUVW,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_EXPLICIT\nreturn vec3(0,0,0);\n#endif\n}\n#endif"},function(D,w,N){"use strict";N(8).a.IncludesShadersStore.bumpFragmentFunctions="#if defined(BUMP) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)\n#if defined(TANGENT) && defined(NORMAL)\nvarying mat3 vTBN;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\nuniform mat4 normalMatrix;\n#endif\nvec3 perturbNormal(mat3 cotangentFrame,vec3 textureSample,float scale)\n{\ntextureSample=textureSample*2.0-1.0;\n#ifdef NORMALXYSCALE\ntextureSample=normalize(textureSample*vec3(scale,scale,1.0));\n#endif\nreturn normalize(cotangentFrame*textureSample);\n}\n\nmat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv,vec2 tangentSpaceParams)\n{\n\nuv=gl_FrontFacing ? uv : -uv;\n\nvec3 dp1=dFdx(p);\nvec3 dp2=dFdy(p);\nvec2 duv1=dFdx(uv);\nvec2 duv2=dFdy(uv);\n\nvec3 dp2perp=cross(dp2,normal);\nvec3 dp1perp=cross(normal,dp1);\nvec3 tangent=dp2perp*duv1.x+dp1perp*duv2.x;\nvec3 bitangent=dp2perp*duv1.y+dp1perp*duv2.y;\n\ntangent*=tangentSpaceParams.x;\nbitangent*=tangentSpaceParams.y;\n\nfloat invmax=inversesqrt(max(dot(tangent,tangent),dot(bitangent,bitangent)));\nreturn mat3(tangent*invmax,bitangent*invmax,normal);\n}\n#endif\n#if defined(BUMP)\n#if BUMPDIRECTUV == 1\n#define vBumpUV vMainUV1\n#elif BUMPDIRECTUV == 2\n#define vBumpUV vMainUV2\n#else\nvarying vec2 vBumpUV;\n#endif\nuniform sampler2D bumpSampler;\nvec3 perturbNormal(mat3 cotangentFrame,vec2 uv)\n{\nreturn perturbNormal(cotangentFrame,texture2D(bumpSampler,uv).xyz,vBumpInfos.y);\n}\n#endif\n#if defined(BUMP) || defined(CLEARCOAT_BUMP)\nvec3 perturbNormal(mat3 cotangentFrame,vec3 color)\n{\nreturn perturbNormal(cotangentFrame,color,vBumpInfos.y);\n}\n\nmat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv)\n{\nreturn cotangent_frame(normal,p,uv,vTangentSpaceParams);\n}\n#endif\n#if defined(BUMP) && defined(PARALLAX)\nconst float minSamples=4.;\nconst float maxSamples=15.;\nconst int iMaxSamples=15;\n\nvec2 parallaxOcclusion(vec3 vViewDirCoT,vec3 vNormalCoT,vec2 texCoord,float parallaxScale) {\nfloat parallaxLimit=length(vViewDirCoT.xy)/vViewDirCoT.z;\nparallaxLimit*=parallaxScale;\nvec2 vOffsetDir=normalize(vViewDirCoT.xy);\nvec2 vMaxOffset=vOffsetDir*parallaxLimit;\nfloat numSamples=maxSamples+(dot(vViewDirCoT,vNormalCoT)*(minSamples-maxSamples));\nfloat stepSize=1.0/numSamples;\n\nfloat currRayHeight=1.0;\nvec2 vCurrOffset=vec2(0,0);\nvec2 vLastOffset=vec2(0,0);\nfloat lastSampledHeight=1.0;\nfloat currSampledHeight=1.0;\nfor (int i=0; i<iMaxSamples; i++)\n{\ncurrSampledHeight=texture2D(bumpSampler,vBumpUV+vCurrOffset).w;\n\nif (currSampledHeight>currRayHeight)\n{\nfloat delta1=currSampledHeight-currRayHeight;\nfloat delta2=(currRayHeight+stepSize)-lastSampledHeight;\nfloat ratio=delta1/(delta1+delta2);\nvCurrOffset=(ratio)* vLastOffset+(1.0-ratio)*vCurrOffset;\n\nbreak;\n}\nelse\n{\ncurrRayHeight-=stepSize;\nvLastOffset=vCurrOffset;\nvCurrOffset+=stepSize*vMaxOffset;\nlastSampledHeight=currSampledHeight;\n}\n}\nreturn vCurrOffset;\n}\nvec2 parallaxOffset(vec3 viewDir,float heightScale)\n{\n\nfloat height=texture2D(bumpSampler,vBumpUV).w;\nvec2 texCoordOffset=heightScale*viewDir.xy*height;\nreturn -texCoordOffset;\n}\n#endif"},function(D,w,N){"use strict";N(8).a.IncludesShadersStore.bumpFragment="vec2 uvOffset=vec2(0.0,0.0);\n#if defined(BUMP) || defined(PARALLAX)\n#ifdef NORMALXYSCALE\nfloat normalScale=1.0;\n#else\nfloat normalScale=vBumpInfos.y;\n#endif\n#if defined(TANGENT) && defined(NORMAL)\nmat3 TBN=vTBN;\n#else\nmat3 TBN=cotangent_frame(normalW*normalScale,vPositionW,vBumpUV);\n#endif\n#elif defined(ANISOTROPIC)\n#if defined(TANGENT) && defined(NORMAL)\nmat3 TBN=vTBN;\n#else\nmat3 TBN=cotangent_frame(normalW,vPositionW,vMainUV1,vec2(1.,1.));\n#endif\n#endif\n#ifdef PARALLAX\nmat3 invTBN=transposeMat3(TBN);\n#ifdef PARALLAXOCCLUSION\nuvOffset=parallaxOcclusion(invTBN*-viewDirectionW,invTBN*normalW,vBumpUV,vBumpInfos.z);\n#else\nuvOffset=parallaxOffset(invTBN*viewDirectionW,vBumpInfos.z);\n#endif\n#endif\n#ifdef BUMP\n#ifdef OBJECTSPACE_NORMALMAP\nnormalW=normalize(texture2D(bumpSampler,vBumpUV).xyz*2.0-1.0);\nnormalW=normalize(mat3(normalMatrix)*normalW);\n#else\nnormalW=perturbNormal(TBN,vBumpUV+uvOffset);\n#endif\n#endif"},function(D,w,N){"use strict";N(8).a.IncludesShadersStore.lightFragment="#ifdef LIGHT{X}\n#if defined(SHADOWONLY) || defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X}) && defined(LIGHTMAPNOSPECULAR{X})\n\n#else\n#ifdef PBR\n\n#ifdef SPOTLIGHT{X}\npreInfo=computePointAndSpotPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#elif defined(POINTLIGHT{X})\npreInfo=computePointAndSpotPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#elif defined(HEMILIGHT{X})\npreInfo=computeHemisphericPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#elif defined(DIRLIGHT{X})\npreInfo=computeDirectionalPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#endif\npreInfo.NdotV=NdotV;\n\n#ifdef SPOTLIGHT{X}\n#ifdef LIGHT_FALLOFF_GLTF{X}\npreInfo.attenuation=computeDistanceLightFalloff_GLTF(preInfo.lightDistanceSquared,light{X}.vLightFalloff.y);\npreInfo.attenuation*=computeDirectionalLightFalloff_GLTF(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);\n#elif defined(LIGHT_FALLOFF_PHYSICAL{X})\npreInfo.attenuation=computeDistanceLightFalloff_Physical(preInfo.lightDistanceSquared);\npreInfo.attenuation*=computeDirectionalLightFalloff_Physical(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w);\n#elif defined(LIGHT_FALLOFF_STANDARD{X})\npreInfo.attenuation=computeDistanceLightFalloff_Standard(preInfo.lightOffset,light{X}.vLightFalloff.x);\npreInfo.attenuation*=computeDirectionalLightFalloff_Standard(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w,light{X}.vLightData.w);\n#else\npreInfo.attenuation=computeDistanceLightFalloff(preInfo.lightOffset,preInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);\npreInfo.attenuation*=computeDirectionalLightFalloff(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w,light{X}.vLightData.w,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);\n#endif\n#elif defined(POINTLIGHT{X})\n#ifdef LIGHT_FALLOFF_GLTF{X}\npreInfo.attenuation=computeDistanceLightFalloff_GLTF(preInfo.lightDistanceSquared,light{X}.vLightFalloff.y);\n#elif defined(LIGHT_FALLOFF_PHYSICAL{X})\npreInfo.attenuation=computeDistanceLightFalloff_Physical(preInfo.lightDistanceSquared);\n#elif defined(LIGHT_FALLOFF_STANDARD{X})\npreInfo.attenuation=computeDistanceLightFalloff_Standard(preInfo.lightOffset,light{X}.vLightFalloff.x);\n#else\npreInfo.attenuation=computeDistanceLightFalloff(preInfo.lightOffset,preInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);\n#endif\n#else\npreInfo.attenuation=1.0;\n#endif\n\n\n#ifdef HEMILIGHT{X}\npreInfo.roughness=roughness;\n#else\npreInfo.roughness=adjustRoughnessFromLightProperties(roughness,light{X}.vLightSpecular.a,preInfo.lightDistance);\n#endif\n\n#ifdef HEMILIGHT{X}\ninfo.diffuse=computeHemisphericDiffuseLighting(preInfo,light{X}.vLightDiffuse.rgb,light{X}.vLightGround);\n#elif defined(SS_TRANSLUCENCY)\ninfo.diffuse=computeDiffuseAndTransmittedLighting(preInfo,light{X}.vLightDiffuse.rgb,transmittance);\n#else\ninfo.diffuse=computeDiffuseLighting(preInfo,light{X}.vLightDiffuse.rgb);\n#endif\n\n#ifdef SPECULARTERM\n#ifdef ANISOTROPIC\ninfo.specular=computeAnisotropicSpecularLighting(preInfo,viewDirectionW,normalW,anisotropicTangent,anisotropicBitangent,anisotropy,specularEnvironmentR0,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);\n#else\ninfo.specular=computeSpecularLighting(preInfo,normalW,specularEnvironmentR0,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);\n#endif\n#endif\n\n#ifdef SHEEN\n#ifdef SHEEN_LINKWITHALBEDO\n\npreInfo.roughness=sheenIntensity;\n#endif\ninfo.sheen=computeSheenLighting(preInfo,normalW,sheenColor,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);\n#endif\n\n#ifdef CLEARCOAT\n\n#ifdef HEMILIGHT{X}\npreInfo.roughness=clearCoatRoughness;\n#else\npreInfo.roughness=adjustRoughnessFromLightProperties(clearCoatRoughness,light{X}.vLightSpecular.a,preInfo.lightDistance);\n#endif\ninfo.clearCoat=computeClearCoatLighting(preInfo,clearCoatNormalW,clearCoatAARoughnessFactors.x,clearCoatIntensity,light{X}.vLightDiffuse.rgb);\n#ifdef CLEARCOAT_TINT\n\nabsorption=computeClearCoatLightingAbsorption(clearCoatNdotVRefract,preInfo.L,clearCoatNormalW,clearCoatColor,clearCoatThickness,clearCoatIntensity);\ninfo.diffuse*=absorption;\n#ifdef SPECULARTERM\ninfo.specular*=absorption;\n#endif\n#endif\n\ninfo.diffuse*=info.clearCoat.w;\n#ifdef SPECULARTERM\ninfo.specular*=info.clearCoat.w;\n#endif\n#ifdef SHEEN\ninfo.sheen*=info.clearCoat.w;\n#endif\n#endif\n#else\n#ifdef SPOTLIGHT{X}\ninfo=computeSpotLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDirection,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightDiffuse.a,glossiness);\n#elif defined(HEMILIGHT{X})\ninfo=computeHemisphericLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightGround,glossiness);\n#elif defined(POINTLIGHT{X}) || defined(DIRLIGHT{X})\ninfo=computeLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightDiffuse.a,glossiness);\n#endif\n#endif\n#ifdef PROJECTEDLIGHTTEXTURE{X}\ninfo.diffuse*=computeProjectionTextureDiffuseLighting(projectionLightSampler{X},textureProjectionMatrix{X});\n#endif\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nfor (int i=0; i<SHADOWCSMNUM_CASCADES{X}; i++)\n{\n#ifdef SHADOWCSM_RIGHTHANDED{X}\ndiff{X}=viewFrustumZ{X}[i]+vPositionFromCamera{X}.z;\n#else\ndiff{X}=viewFrustumZ{X}[i]-vPositionFromCamera{X}.z;\n#endif\nif (diff{X}>=0.) {\nindex{X}=i;\nbreak;\n}\n}\n#ifdef SHADOWCSMUSESHADOWMAXZ{X}\nif (index{X}>=0)\n#endif\n{\n#if defined(SHADOWPCF{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithCSMPCF1(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithCSMPCF3(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nshadow=computeShadowWithCSMPCF5(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCSS{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithCSMPCSS16(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithCSMPCSS32(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#else\nshadow=computeShadowWithCSMPCSS64(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#endif\n#else\nshadow=computeShadowCSM(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#ifdef SHADOWCSMDEBUG{X}\nshadowDebug{X}=vec3(shadow)*vCascadeColorsMultiplier{X}[index{X}];\n#endif\n#ifndef SHADOWCSMNOBLEND{X}\nfloat frustumLength=frustumLengths{X}[index{X}];\nfloat diffRatio=clamp(diff{X}/frustumLength,0.,1.)*cascadeBlendFactor{X};\nif (index{X}<(SHADOWCSMNUM_CASCADES{X}-1) && diffRatio<1.)\n{\nindex{X}+=1;\nfloat nextShadow=0.;\n#if defined(SHADOWPCF{X})\n#if defined(SHADOWLOWQUALITY{X})\nnextShadow=computeShadowWithCSMPCF1(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nnextShadow=computeShadowWithCSMPCF3(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nnextShadow=computeShadowWithCSMPCF5(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCSS{X})\n#if defined(SHADOWLOWQUALITY{X})\nnextShadow=computeShadowWithCSMPCSS16(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#elif defined(SHADOWMEDIUMQUALITY{X})\nnextShadow=computeShadowWithCSMPCSS32(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#else\nnextShadow=computeShadowWithCSMPCSS64(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#endif\n#else\nnextShadow=computeShadowCSM(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\nshadow=mix(nextShadow,shadow,diffRatio);\n#ifdef SHADOWCSMDEBUG{X}\nshadowDebug{X}=mix(vec3(nextShadow)*vCascadeColorsMultiplier{X}[index{X}],shadowDebug{X},diffRatio);\n#endif\n}\n#endif\n}\n#elif defined(SHADOWCLOSEESM{X})\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithCloseESMCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);\n#else\nshadow=computeShadowWithCloseESM(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWESM{X})\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithESMCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);\n#else\nshadow=computeShadowWithESM(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPOISSON{X})\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithPoissonSamplingCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.depthValues);\n#else\nshadow=computeShadowWithPoissonSampling(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCF{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithPCF1(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithPCF3(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nshadow=computeShadowWithPCF5(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCSS{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithPCSS16(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithPCSS32(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nshadow=computeShadowWithPCSS64(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#else\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.depthValues);\n#else\nshadow=computeShadow(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#endif\n#ifdef SHADOWONLY\n#ifndef SHADOWINUSE\n#define SHADOWINUSE\n#endif\nglobalShadow+=shadow;\nshadowLightCount+=1.0;\n#endif\n#else\nshadow=1.;\n#endif\n#ifndef SHADOWONLY\n#ifdef CUSTOMUSERLIGHTING\ndiffuseBase+=computeCustomDiffuseLighting(info,diffuseBase,shadow);\n#ifdef SPECULARTERM\nspecularBase+=computeCustomSpecularLighting(info,specularBase,shadow);\n#endif\n#elif defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X})\ndiffuseBase+=lightmapColor.rgb*shadow;\n#ifdef SPECULARTERM\n#ifndef LIGHTMAPNOSPECULAR{X}\nspecularBase+=info.specular*shadow*lightmapColor.rgb;\n#endif\n#endif\n#ifdef CLEARCOAT\n#ifndef LIGHTMAPNOSPECULAR{X}\nclearCoatBase+=info.clearCoat.rgb*shadow*lightmapColor.rgb;\n#endif\n#endif\n#ifdef SHEEN\n#ifndef LIGHTMAPNOSPECULAR{X}\nsheenBase+=info.sheen.rgb*shadow;\n#endif\n#endif\n#else\n#ifdef SHADOWCSMDEBUG{X}\ndiffuseBase+=info.diffuse*shadowDebug{X};\n#else\ndiffuseBase+=info.diffuse*shadow;\n#endif\n#ifdef SPECULARTERM\nspecularBase+=info.specular*shadow;\n#endif\n#ifdef CLEARCOAT\nclearCoatBase+=info.clearCoat.rgb*shadow;\n#endif\n#ifdef SHEEN\nsheenBase+=info.sheen.rgb*shadow;\n#endif\n#endif\n#endif\n#endif"},function(D,w,N){"use strict";N(8).a.IncludesShadersStore.fogFragment="#ifdef FOG\nfloat fog=CalcFogFactor();\ncolor.rgb=fog*color.rgb+(1.0-fog)*vFogColor;\n#endif"},function(D,w,N){"use strict";N(8).a.IncludesShadersStore.fogVertexDeclaration="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif"},function(D,w,N){"use strict";N(8).a.IncludesShadersStore.shadowsVertex="#ifdef SHADOWS\n#if defined(SHADOWCSM{X})\nvPositionFromCamera{X}=view*worldPos;\nfor (int i=0; i<SHADOWCSMNUM_CASCADES{X}; i++) {\nvPositionFromLight{X}[i]=lightMatrix{X}[i]*worldPos;\nvDepthMetric{X}[i]=((vPositionFromLight{X}[i].z+light{X}.depthValues.x)/(light{X}.depthValues.y));\n}\n#elif defined(SHADOW{X}) && !defined(SHADOWCUBE{X})\nvPositionFromLight{X}=lightMatrix{X}*worldPos;\nvDepthMetric{X}=((vPositionFromLight{X}.z+light{X}.depthValues.x)/(light{X}.depthValues.y));\n#endif\n#endif"},function(D,w,N){"use strict";N.d(w,"a",(function(){return F}));var F=function(){function e(){}return e.Eval=function(D,w){return"true"===(D=D.match(/\([^\(\)]*\)/g)?D.replace(/\([^\(\)]*\)/g,(function(D){return D=D.slice(1,D.length-1),e._HandleParenthesisContent(D,w)})):e._HandleParenthesisContent(D,w))||"false"!==D&&e.Eval(D,w)},e._HandleParenthesisContent=function(D,w){var N;w=w||function(D){return"true"===D};var F=D.split("||");for(var k in F)if(F.hasOwnProperty(k)){var j=e._SimplifyNegation(F[k].trim()),z=j.split("&&");if(z.length>1)for(var G=0;G<z.length;++G){var H=e._SimplifyNegation(z[G].trim());if(!(N="true"!==H&&"false"!==H?"!"===H[0]?!w(H.substring(1)):w(H):"true"===H)){j="false";break}}if(N||"true"===j){N=!0;break}N="true"!==j&&"false"!==j?"!"===j[0]?!w(j.substring(1)):w(j):"true"===j}return N?"true":"false"},e._SimplifyNegation=function(D){return"!true"===(D=(D=D.replace(/^[\s!]+/,(function(D){return(D=D.replace(/[\s]/g,(function(){return""}))).length%2?"!":""}))).trim())?D="false":"!false"===D&&(D="true"),D},e}()},function(D,w,N){"use strict";N.d(w,"a",(function(){return F}));var F=function(){function e(){}return e.ExponentialBackoff=function(D,w){return void 0===D&&(D=3),void 0===w&&(w=500),function(N,F,k){return 0!==F.status||k>=D||-1!==N.indexOf("file:")?-1:Math.pow(2,k)*w}},e}()},function(D,w,N){"use strict";N.d(w,"a",(function(){return F}));var F=function(){function e(){this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,this.reset()}return Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"zOffset",{get:function(){return this._zOffset},set:function(D){this._zOffset!==D&&(this._zOffset=D,this._isZOffsetDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cullFace",{get:function(){return this._cullFace},set:function(D){this._cullFace!==D&&(this._cullFace=D,this._isCullFaceDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cull",{get:function(){return this._cull},set:function(D){this._cull!==D&&(this._cull=D,this._isCullDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthFunc",{get:function(){return this._depthFunc},set:function(D){this._depthFunc!==D&&(this._depthFunc=D,this._isDepthFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthMask",{get:function(){return this._depthMask},set:function(D){this._depthMask!==D&&(this._depthMask=D,this._isDepthMaskDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthTest",{get:function(){return this._depthTest},set:function(D){this._depthTest!==D&&(this._depthTest=D,this._isDepthTestDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frontFace",{get:function(){return this._frontFace},set:function(D){this._frontFace!==D&&(this._frontFace=D,this._isFrontFaceDirty=!0)},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1},e.prototype.apply=function(D){this.isDirty&&(this._isCullDirty&&(this.cull?D.enable(D.CULL_FACE):D.disable(D.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(D.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(D.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?D.enable(D.DEPTH_TEST):D.disable(D.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(D.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset?(D.enable(D.POLYGON_OFFSET_FILL),D.polygonOffset(this.zOffset,0)):D.disable(D.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(D.frontFace(this.frontFace),this._isFrontFaceDirty=!1))},e}()},function(D,w,N){"use strict";N.d(w,"a",(function(){return k}));var F=N(2),k=function(){function e(){this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.reset()}return Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stencilFunc",{get:function(){return this._stencilFunc},set:function(D){this._stencilFunc!==D&&(this._stencilFunc=D,this._isStencilFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stencilFuncRef",{get:function(){return this._stencilFuncRef},set:function(D){this._stencilFuncRef!==D&&(this._stencilFuncRef=D,this._isStencilFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stencilFuncMask",{get:function(){return this._stencilFuncMask},set:function(D){this._stencilFuncMask!==D&&(this._stencilFuncMask=D,this._isStencilFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stencilOpStencilFail",{get:function(){return this._stencilOpStencilFail},set:function(D){this._stencilOpStencilFail!==D&&(this._stencilOpStencilFail=D,this._isStencilOpDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stencilOpDepthFail",{get:function(){return this._stencilOpDepthFail},set:function(D){this._stencilOpDepthFail!==D&&(this._stencilOpDepthFail=D,this._isStencilOpDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stencilOpStencilDepthPass",{get:function(){return this._stencilOpStencilDepthPass},set:function(D){this._stencilOpStencilDepthPass!==D&&(this._stencilOpStencilDepthPass=D,this._isStencilOpDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stencilMask",{get:function(){return this._stencilMask},set:function(D){this._stencilMask!==D&&(this._stencilMask=D,this._isStencilMaskDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stencilTest",{get:function(){return this._stencilTest},set:function(D){this._stencilTest!==D&&(this._stencilTest=D,this._isStencilTestDirty=!0)},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this._stencilTest=!1,this._stencilMask=255,this._stencilFunc=e.ALWAYS,this._stencilFuncRef=1,this._stencilFuncMask=255,this._stencilOpStencilFail=e.KEEP,this._stencilOpDepthFail=e.KEEP,this._stencilOpStencilDepthPass=e.REPLACE,this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0},e.prototype.apply=function(D){this.isDirty&&(this._isStencilTestDirty&&(this.stencilTest?D.enable(D.STENCIL_TEST):D.disable(D.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(D.stencilMask(this.stencilMask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(D.stencilFunc(this.stencilFunc,this.stencilFuncRef,this.stencilFuncMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(D.stencilOp(this.stencilOpStencilFail,this.stencilOpDepthFail,this.stencilOpStencilDepthPass),this._isStencilOpDirty=!1))},e.ALWAYS=F.a.ALWAYS,e.KEEP=F.a.KEEP,e.REPLACE=F.a.REPLACE,e}()},function(D,w,N){"use strict";N.d(w,"a",(function(){return F}));var F=function(){function e(){this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this.reset()}return Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alphaBlend",{get:function(){return this._alphaBlend},set:function(D){this._alphaBlend!==D&&(this._alphaBlend=D,this._isAlphaBlendDirty=!0)},enumerable:!0,configurable:!0}),e.prototype.setAlphaBlendConstants=function(D,w,N,F){this._blendConstants[0]===D&&this._blendConstants[1]===w&&this._blendConstants[2]===N&&this._blendConstants[3]===F||(this._blendConstants[0]=D,this._blendConstants[1]=w,this._blendConstants[2]=N,this._blendConstants[3]=F,this._isBlendConstantsDirty=!0)},e.prototype.setAlphaBlendFunctionParameters=function(D,w,N,F){this._blendFunctionParameters[0]===D&&this._blendFunctionParameters[1]===w&&this._blendFunctionParameters[2]===N&&this._blendFunctionParameters[3]===F||(this._blendFunctionParameters[0]=D,this._blendFunctionParameters[1]=w,this._blendFunctionParameters[2]=N,this._blendFunctionParameters[3]=F,this._isBlendFunctionParametersDirty=!0)},e.prototype.setAlphaEquationParameters=function(D,w){this._blendEquationParameters[0]===D&&this._blendEquationParameters[1]===w||(this._blendEquationParameters[0]=D,this._blendEquationParameters[1]=w,this._isBlendEquationParametersDirty=!0)},e.prototype.reset=function(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1},e.prototype.apply=function(D){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?D.enable(D.BLEND):D.disable(D.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(D.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(D.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(D.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))},e}()},function(D,w,N){"use strict";N.d(w,"a",(function(){return F}));var F=function(){function e(){this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null}return Object.defineProperty(e.prototype,"isAsync",{get:function(){return this.isParallelCompiled},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isReady",{get:function(){return!!this.program&&(!this.isParallelCompiled||this.engine._isRenderingStateCompiled(this))},enumerable:!0,configurable:!0}),e.prototype._handlesSpectorRebuildCallback=function(D){D&&this.program&&D(this.program)},e}()},function(D,w,N){"use strict";var F;N.d(w,"a",(function(){return j})),function(D){D[D.Pending=0]="Pending",D[D.Fulfilled=1]="Fulfilled",D[D.Rejected=2]="Rejected"}(F||(F={}));var r=function(){this.count=0,this.target=0,this.results=[]},k=function(){function e(D){var w=this;if(this._state=F.Pending,this._children=new Array,this._rejectWasConsumed=!1,D)try{D((function(D){w._resolve(D)}),(function(D){w._reject(D)}))}catch(D){this._reject(D)}}return Object.defineProperty(e.prototype,"_result",{get:function(){return this._resultValue},set:function(D){this._resultValue=D,this._parent&&void 0===this._parent._result&&(this._parent._result=D)},enumerable:!0,configurable:!0}),e.prototype.catch=function(D){return this.then(void 0,D)},e.prototype.then=function(D,w){var N=this,k=new e;return k._onFulfilled=D,k._onRejected=w,this._children.push(k),k._parent=this,this._state!==F.Pending&&setTimeout((function(){if(N._state===F.Fulfilled||N._rejectWasConsumed){var D=k._resolve(N._result);if(null!=D)if(void 0!==D._state){var w=D;k._children.push(w),w._parent=k,k=w}else k._result=D}else k._reject(N._reason)})),k},e.prototype._moveChildren=function(D){var w,N=this;if((w=this._children).push.apply(w,D.splice(0,D.length)),this._children.forEach((function(D){D._parent=N})),this._state===F.Fulfilled)for(var k=0,j=this._children;k<j.length;k++)j[k]._resolve(this._result);else if(this._state===F.Rejected)for(var z=0,G=this._children;z<G.length;z++)G[z]._reject(this._reason)},e.prototype._resolve=function(D){try{this._state=F.Fulfilled;var w=null;if(this._onFulfilled&&(w=this._onFulfilled(D)),null!=w)if(void 0!==w._state){var N=w;N._parent=this,N._moveChildren(this._children),D=N._result}else D=w;this._result=D;for(var k=0,j=this._children;k<j.length;k++)j[k]._resolve(D);this._children.length=0,delete this._onFulfilled,delete this._onRejected}catch(D){this._reject(D,!0)}},e.prototype._reject=function(D,w){if(void 0===w&&(w=!1),this._state=F.Rejected,this._reason=D,this._onRejected&&!w)try{this._onRejected(D),this._rejectWasConsumed=!0}catch(w){D=w}for(var N=0,k=this._children;N<k.length;N++){var j=k[N];this._rejectWasConsumed?j._resolve(null):j._reject(D)}this._children.length=0,delete this._onFulfilled,delete this._onRejected},e.resolve=function(D){var w=new e;return w._resolve(D),w},e._RegisterForFulfillment=function(D,w,N){D.then((function(D){return w.results[N]=D,w.count++,w.count===w.target&&w.rootPromise._resolve(w.results),null}),(function(D){w.rootPromise._state!==F.Rejected&&w.rootPromise._reject(D)}))},e.all=function(D){var w=new e,N=new r;if(N.target=D.length,N.rootPromise=w,D.length)for(var F=0;F<D.length;F++)e._RegisterForFulfillment(D[F],N,F);else w._resolve([]);return w},e.race=function(D){var w=new e;if(D.length)for(var N=0,F=D;N<F.length;N++)F[N].then((function(D){return w&&(w._resolve(D),w=null),null}),(function(D){w&&(w._reject(D),w=null)}));return w},e}(),j=function(){function e(){}return e.Apply=function(D){void 0===D&&(D=!1),(D||"undefined"==typeof Promise)&&(window.Promise=k)},e}()},function(D,w,N){"use strict";N.d(w,"a",(function(){return k})),N.d(w,"b",(function(){return j}));var F=N(52),k=function(){function e(D){void 0===D&&(D=30),this._enabled=!0,this._rollingFrameTime=new j(D)}return e.prototype.sampleFrame=function(D){if(void 0===D&&(D=F.a.Now),this._enabled){if(null!=this._lastFrameTimeMs){var w=D-this._lastFrameTimeMs;this._rollingFrameTime.add(w)}this._lastFrameTimeMs=D}},Object.defineProperty(e.prototype,"averageFrameTime",{get:function(){return this._rollingFrameTime.average},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"averageFrameTimeVariance",{get:function(){return this._rollingFrameTime.variance},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"instantaneousFrameTime",{get:function(){return this._rollingFrameTime.history(0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"averageFPS",{get:function(){return 1e3/this._rollingFrameTime.average},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"instantaneousFPS",{get:function(){var D=this._rollingFrameTime.history(0);return 0===D?0:1e3/D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSaturated",{get:function(){return this._rollingFrameTime.isSaturated()},enumerable:!0,configurable:!0}),e.prototype.enable=function(){this._enabled=!0},e.prototype.disable=function(){this._enabled=!1,this._lastFrameTimeMs=null},Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._enabled},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()},e}(),j=function(){function e(D){this._samples=new Array(D),this.reset()}return e.prototype.add=function(D){var w;if(this.isSaturated()){var N=this._samples[this._pos];w=N-this.average,this.average-=w/(this._sampleCount-1),this._m2-=w*(N-this.average)}else this._sampleCount++;w=D-this.average,this.average+=w/this._sampleCount,this._m2+=w*(D-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=D,this._pos++,this._pos%=this._samples.length},e.prototype.history=function(D){if(D>=this._sampleCount||D>=this._samples.length)return 0;var w=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(w-D)]},e.prototype.isSaturated=function(){return this._sampleCount>=this._samples.length},e.prototype.reset=function(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0},e.prototype._wrapPosition=function(D){var w=this._samples.length;return(D%w+w)%w},e}()},function(D,w,N){"use strict";N.d(w,"a",(function(){return r}));var F=N(0),r=function(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._collider=null,this._oldPositionForCollisions=new F.e(0,0,0),this._diffPositionForCollisions=new F.e(0,0,0)}},function(D,w,N){"use strict";N.d(w,"a",(function(){return z}));var F=N(34),k=N(0),j=N(2),z=function(){function e(D,w,N,k,j){void 0===N&&(N=null),void 0===k&&(k=null),void 0===j&&(j=null),this.index=D,this._opaqueSubMeshes=new F.a(256),this._transparentSubMeshes=new F.a(256),this._alphaTestSubMeshes=new F.a(256),this._depthOnlySubMeshes=new F.a(256),this._particleSystems=new F.a(256),this._spriteManagers=new F.a(256),this._edgesRenderers=new F.a(16),this._scene=w,this.opaqueSortCompareFn=N,this.alphaTestSortCompareFn=k,this.transparentSortCompareFn=j}return Object.defineProperty(e.prototype,"opaqueSortCompareFn",{set:function(D){this._opaqueSortCompareFn=D,this._renderOpaque=D?this.renderOpaqueSorted:e.renderUnsorted},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alphaTestSortCompareFn",{set:function(D){this._alphaTestSortCompareFn=D,this._renderAlphaTest=D?this.renderAlphaTestSorted:e.renderUnsorted},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"transparentSortCompareFn",{set:function(D){this._transparentSortCompareFn=D||e.defaultTransparentSortCompare,this._renderTransparent=this.renderTransparentSorted},enumerable:!0,configurable:!0}),e.prototype.render=function(D,w,N,F){if(D)D(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);else{var k=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(k.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),k.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);var z=k.getStencilBuffer();if(k.setStencilBuffer(!1),w&&this._renderSprites(),N&&this._renderParticles(F),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length&&(this._renderTransparent(this._transparentSubMeshes),k.setAlphaMode(j.a.ALPHA_DISABLE)),k.setStencilBuffer(!1),this._edgesRenderers.length){for(var G=0;G<this._edgesRenderers.length;G++)this._edgesRenderers.data[G].render();k.setAlphaMode(j.a.ALPHA_DISABLE)}k.setStencilBuffer(z)}},e.prototype.renderOpaqueSorted=function(D){return e.renderSorted(D,this._opaqueSortCompareFn,this._scene.activeCamera,!1)},e.prototype.renderAlphaTestSorted=function(D){return e.renderSorted(D,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)},e.prototype.renderTransparentSorted=function(D){return e.renderSorted(D,this._transparentSortCompareFn,this._scene.activeCamera,!0)},e.renderSorted=function(D,w,N,F){for(var z,G=0,H=N?N.globalPosition:e._zeroVector;G<D.length;G++)(z=D.data[G])._alphaIndex=z.getMesh().alphaIndex,z._distanceToCamera=k.e.Distance(z.getBoundingInfo().boundingSphere.centerWorld,H);var X=D.data.slice(0,D.length);for(w&&X.sort(w),G=0;G<X.length;G++){if(z=X[G],F){var q=z.getMaterial();if(q&&q.needDepthPrePass){var Z=q.getScene().getEngine();Z.setColorWrite(!1),Z.setAlphaMode(j.a.ALPHA_DISABLE),z.render(!1),Z.setColorWrite(!0)}}z.render(F)}},e.renderUnsorted=function(D){for(var w=0;w<D.length;w++)D.data[w].render(!1)},e.defaultTransparentSortCompare=function(D,w){return D._alphaIndex>w._alphaIndex?1:D._alphaIndex<w._alphaIndex?-1:e.backToFrontSortCompare(D,w)},e.backToFrontSortCompare=function(D,w){return D._distanceToCamera<w._distanceToCamera?1:D._distanceToCamera>w._distanceToCamera?-1:0},e.frontToBackSortCompare=function(D,w){return D._distanceToCamera<w._distanceToCamera?-1:D._distanceToCamera>w._distanceToCamera?1:0},e.prototype.prepare=function(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this._spriteManagers.reset(),this._edgesRenderers.reset()},e.prototype.dispose=function(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()},e.prototype.dispatch=function(D,w,N){void 0===w&&(w=D.getMesh()),void 0===N&&(N=D.getMaterial()),null!=N&&(N.needAlphaBlendingForMesh(w)?this._transparentSubMeshes.push(D):N.needAlphaTesting()?(N.needDepthPrePass&&this._depthOnlySubMeshes.push(D),this._alphaTestSubMeshes.push(D)):(N.needDepthPrePass&&this._depthOnlySubMeshes.push(D),this._opaqueSubMeshes.push(D)),w._renderingGroup=this,w._edgesRenderer&&w._edgesRenderer.isEnabled&&this._edgesRenderers.push(w._edgesRenderer))},e.prototype.dispatchSprites=function(D){this._spriteManagers.push(D)},e.prototype.dispatchParticles=function(D){this._particleSystems.push(D)},e.prototype._renderParticles=function(D){if(0!==this._particleSystems.length){var w=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(var N=0;N<this._particleSystems.length;N++){var F=this._particleSystems.data[N];if(0!==(w&&w.layerMask&F.layerMask)){var k=F.emitter;k.position&&D&&-1===D.indexOf(k)||this._scene._activeParticles.addCount(F.render(),!1)}}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}},e.prototype._renderSprites=function(){if(this._scene.spritesEnabled&&0!==this._spriteManagers.length){var D=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(var w=0;w<this._spriteManagers.length;w++){var N=this._spriteManagers.data[w];0!==(D&&D.layerMask&N.layerMask)&&N.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}},e._zeroVector=k.e.Zero(),e}()},function(D,w,N){"use strict";N.d(w,"a",(function(){return n}));var n=function(D,w){this.distance=D,this.mesh=w}},function(D,w,N){"use strict";N.d(w,"a",(function(){return Z}));var F=N(1),k=N(0),j=N(7),z=N(27),G=N(5),H=N(33),X=N(43),q=N(4);G.a._instancedMeshFactory=function(D,w){var N=new Z(D,w);if(w.instancedBuffers)for(var F in N.instancedBuffers={},w.instancedBuffers)N.instancedBuffers[F]=w.instancedBuffers[F];return N};var Z=function(D){function t(w,N){var F=D.call(this,w,N.getScene())||this;F._indexInSourceMeshInstanceArray=-1,N.addInstance(F),F._sourceMesh=N,F._unIndexed=N._unIndexed,F.position.copyFrom(N.position),F.rotation.copyFrom(N.rotation),F.scaling.copyFrom(N.scaling),N.rotationQuaternion&&(F.rotationQuaternion=N.rotationQuaternion.clone()),F.animations=N.animations;for(var k=0,j=N.getAnimationRanges();k<j.length;k++){var z=j[k];null!=z&&F.createAnimationRange(z.name,z.from,z.to)}return F.infiniteDistance=N.infiniteDistance,F.setPivotMatrix(N.getPivotMatrix()),F.refreshBoundingInfo(),F._syncSubMeshes(),F}return Object(F.d)(t,D),t.prototype.getClassName=function(){return"InstancedMesh"},Object.defineProperty(t.prototype,"lightSources",{get:function(){return this._sourceMesh._lightSources},enumerable:!0,configurable:!0}),t.prototype._resyncLightSources=function(){},t.prototype._resyncLightSource=function(D){},t.prototype._removeLightSource=function(D,w){},Object.defineProperty(t.prototype,"receiveShadows",{get:function(){return this._sourceMesh.receiveShadows},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"material",{get:function(){return this._sourceMesh.material},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visibility",{get:function(){return this._sourceMesh.visibility},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skeleton",{get:function(){return this._sourceMesh.skeleton},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderingGroupId",{get:function(){return this._sourceMesh.renderingGroupId},set:function(D){this._sourceMesh&&D!==this._sourceMesh.renderingGroupId&&j.a.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")},enumerable:!0,configurable:!0}),t.prototype.getTotalVertices=function(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0},t.prototype.getTotalIndices=function(){return this._sourceMesh.getTotalIndices()},Object.defineProperty(t.prototype,"sourceMesh",{get:function(){return this._sourceMesh},enumerable:!0,configurable:!0}),t.prototype.isReady=function(D){return void 0===D&&(D=!1),this._sourceMesh.isReady(D,!0)},t.prototype.getVerticesData=function(D,w){return this._sourceMesh.getVerticesData(D,w)},t.prototype.setVerticesData=function(D,w,N,F){return this.sourceMesh&&this.sourceMesh.setVerticesData(D,w,N,F),this.sourceMesh},t.prototype.updateVerticesData=function(D,w,N,F){return this.sourceMesh&&this.sourceMesh.updateVerticesData(D,w,N,F),this.sourceMesh},t.prototype.setIndices=function(D,w){return void 0===w&&(w=null),this.sourceMesh&&this.sourceMesh.setIndices(D,w),this.sourceMesh},t.prototype.isVerticesDataPresent=function(D){return this._sourceMesh.isVerticesDataPresent(D)},t.prototype.getIndices=function(){return this._sourceMesh.getIndices()},Object.defineProperty(t.prototype,"_positions",{get:function(){return this._sourceMesh._positions},enumerable:!0,configurable:!0}),t.prototype.refreshBoundingInfo=function(D){if(void 0===D&&(D=!1),this._boundingInfo&&this._boundingInfo.isLocked)return this;var w=this._sourceMesh.geometry?this._sourceMesh.geometry.boundingBias:null;return this._refreshBoundingInfo(this._sourceMesh._getPositionData(D),w),this},t.prototype._preActivate=function(){return this._currentLOD&&this._currentLOD._preActivate(),this},t.prototype._activate=function(D,w){if(this._sourceMesh.subMeshes||j.a.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>0!=this._getWorldMatrixDeterminant()>0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,D),w){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1},t.prototype._postActivate=function(){this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)},t.prototype.getWorldMatrix=function(){if(this._currentLOD&&this._currentLOD.billboardMode!==X.a.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){var w=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,k.c.Vector3[7].copyFrom(this._currentLOD.position),this._currentLOD.position.set(0,0,0),k.c.Matrix[0].copyFrom(this._currentLOD.computeWorldMatrix(!0)),this._currentLOD.position.copyFrom(k.c.Vector3[7]),this._currentLOD._masterMesh=w,k.c.Matrix[0]}return D.prototype.getWorldMatrix.call(this)},Object.defineProperty(t.prototype,"isAnInstance",{get:function(){return!0},enumerable:!0,configurable:!0}),t.prototype.getLOD=function(D){if(!D)return this;var w=this.getBoundingInfo();return this._currentLOD=this.sourceMesh.getLOD(D,w.boundingSphere),this._currentLOD===this.sourceMesh?this.sourceMesh:this._currentLOD},t.prototype._preActivateForIntermediateRendering=function(D){return this.sourceMesh._preActivateForIntermediateRendering(D)},t.prototype._syncSubMeshes=function(){if(this.releaseSubMeshes(),this._sourceMesh.subMeshes)for(var D=0;D<this._sourceMesh.subMeshes.length;D++)this._sourceMesh.subMeshes[D].clone(this,this._sourceMesh);return this},t.prototype._generatePointsArray=function(){return this._sourceMesh._generatePointsArray()},t.prototype.clone=function(D,w,N){void 0===w&&(w=null);var F=this._sourceMesh.createInstance(D);if(H.a.DeepCopy(this,F,["name","subMeshes","uniqueId","parent"],[]),this.refreshBoundingInfo(),w&&(F.parent=w),!N)for(var k=0;k<this.getScene().meshes.length;k++){var j=this.getScene().meshes[k];j.parent===this&&j.clone(j.name,F)}return F.computeWorldMatrix(!0),F},t.prototype.dispose=function(w,N){void 0===N&&(N=!1),this._sourceMesh.removeInstance(this),D.prototype.dispose.call(this,w,N)},t}(z.a);G.a.prototype.registerInstancedBuffer=function(D,w){if(this.removeVerticesData(D),!this.instancedBuffers){this.instancedBuffers={};for(var N=0,F=this.instances;N<F.length;N++)F[N].instancedBuffers={};this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{}}}this.instancedBuffers[D]=null,this._userInstancedBuffersStorage.strides[D]=w,this._userInstancedBuffersStorage.sizes[D]=32*w,this._userInstancedBuffersStorage.data[D]=new Float32Array(this._userInstancedBuffersStorage.sizes[D]),this._userInstancedBuffersStorage.vertexBuffers[D]=new q.b(this.getEngine(),this._userInstancedBuffersStorage.data[D],D,!0,!1,w,!0),this.setVerticesBuffer(this._userInstancedBuffersStorage.vertexBuffers[D]);for(var k=0,j=this.instances;k<j.length;k++)j[k].instancedBuffers[D]=null},G.a.prototype._processInstancedBuffers=function(D,w){var N=D.length;for(var F in this.instancedBuffers){for(var k=this._userInstancedBuffersStorage.sizes[F],j=this._userInstancedBuffersStorage.strides[F],z=(N+1)*j;k<z;)k*=2;this._userInstancedBuffersStorage.data[F].length!=k&&(this._userInstancedBuffersStorage.data[F]=new Float32Array(k),this._userInstancedBuffersStorage.sizes[F]=k,this._userInstancedBuffersStorage.vertexBuffers[F]&&(this._userInstancedBuffersStorage.vertexBuffers[F].dispose(),this._userInstancedBuffersStorage.vertexBuffers[F]=null));var G=this._userInstancedBuffersStorage.data[F],H=0;w&&(H+=j,(Z=this.instancedBuffers[F]).toArray?Z.toArray(G,H):Z.copyToArray(G,H));for(var X=0;X<N;X++){var Z;(Z=D[X].instancedBuffers[F]).toArray?Z.toArray(G,H):Z.copyToArray(G,H),H+=j}this._userInstancedBuffersStorage.vertexBuffers[F]?this._userInstancedBuffersStorage.vertexBuffers[F].updateDirectly(G,0):(this._userInstancedBuffersStorage.vertexBuffers[F]=new q.b(this.getEngine(),this._userInstancedBuffersStorage.data[F],F,!0,!1,j,!0),this.setVerticesBuffer(this._userInstancedBuffersStorage.vertexBuffers[F]))}},G.a.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(var D in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[D]&&this._userInstancedBuffersStorage.vertexBuffers[D].dispose();this.instancedBuffers={}}},function(D,w,N){"use strict";N.d(w,"a",(function(){return F}));var F=function(){function e(){}return e.RandomId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(D){var w=16*Math.random()|0;return("x"===D?w:3&w|8).toString(16)}))},e}()},function(D,w,N){"use strict";N.d(w,"a",(function(){return F}));var F=function(){function e(){}return Object.defineProperty(e,"UniqueId",{get:function(){var D=this._UniqueIdCounter;return this._UniqueIdCounter++,D},enumerable:!0,configurable:!0}),e._UniqueIdCounter=0,e}()},function(D,w,N){"use strict";N(8).a.IncludesShadersStore.lightsFragmentFunctions="\nstruct lightingInfo\n{\nvec3 diffuse;\n#ifdef SPECULARTERM\nvec3 specular;\n#endif\n#ifdef NDOTL\nfloat ndl;\n#endif\n};\nlightingInfo computeLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {\nlightingInfo result;\nvec3 lightVectorW;\nfloat attenuation=1.0;\nif (lightData.w == 0.)\n{\nvec3 direction=lightData.xyz-vPositionW;\nattenuation=max(0.,1.0-length(direction)/range);\nlightVectorW=normalize(direction);\n}\nelse\n{\nlightVectorW=normalize(-lightData.xyz);\n}\n\nfloat ndl=max(0.,dot(vNormal,lightVectorW));\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW+lightVectorW);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;\n}\nlightingInfo computeSpotLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec4 lightDirection,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {\nlightingInfo result;\nvec3 direction=lightData.xyz-vPositionW;\nvec3 lightVectorW=normalize(direction);\nfloat attenuation=max(0.,1.0-length(direction)/range);\n\nfloat cosAngle=max(0.,dot(lightDirection.xyz,-lightVectorW));\nif (cosAngle>=lightDirection.w)\n{\ncosAngle=max(0.,pow(cosAngle,lightData.w));\nattenuation*=cosAngle;\n\nfloat ndl=max(0.,dot(vNormal,lightVectorW));\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW+lightVectorW);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;\n}\nresult.diffuse=vec3(0.);\n#ifdef SPECULARTERM\nresult.specular=vec3(0.);\n#endif\n#ifdef NDOTL\nresult.ndl=0.;\n#endif\nreturn result;\n}\nlightingInfo computeHemisphericLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,vec3 groundColor,float glossiness) {\nlightingInfo result;\n\nfloat ndl=dot(vNormal,lightData.xyz)*0.5+0.5;\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=mix(groundColor,diffuseColor,ndl);\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW+lightData.xyz);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor;\n#endif\nreturn result;\n}\nvec3 computeProjectionTextureDiffuseLighting(sampler2D projectionLightSampler,mat4 textureProjectionMatrix){\nvec4 strq=textureProjectionMatrix*vec4(vPositionW,1.0);\nstrq/=strq.w;\nvec3 textureColor=texture2D(projectionLightSampler,strq.xy).rgb;\nreturn textureColor;\n}"},function(D,w,N){"use strict";N(8).a.IncludesShadersStore.logDepthFragment="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif"},function(D,w,N){"use strict";N(8).a.IncludesShadersStore.bumpVertex="#if defined(BUMP) || defined(PARALLAX) || defined(CLEARCOAT_BUMP)\n#if defined(TANGENT) && defined(NORMAL)\nvec3 tbnNormal=normalize(normalUpdated);\nvec3 tbnTangent=normalize(tangentUpdated.xyz);\nvec3 tbnBitangent=cross(tbnNormal,tbnTangent)*tangentUpdated.w;\nvTBN=mat3(finalWorld)*mat3(tbnTangent,tbnBitangent,tbnNormal);\n#endif\n#endif"},function(D,w,N){"use strict";N(8).a.IncludesShadersStore.fogVertex="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif"},function(D,w,N){"use strict";N(8).a.IncludesShadersStore.logDepthVertex="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;\ngl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif"},function(D,w){var N;N=function(){return this}();try{N=N||new Function("return this")()}catch(D){"object"==typeof window&&(N=window)}D.exports=N},function(D,w,N){"use strict";N(8).a.IncludesShadersStore.fresnelFunction="#ifdef FRESNEL\nfloat computeFresnelTerm(vec3 viewDirection,vec3 worldNormal,float bias,float power)\n{\nfloat fresnelTerm=pow(bias+abs(dot(viewDirection,worldNormal)),power);\nreturn clamp(fresnelTerm,0.,1.);\n}\n#endif"},function(D,w,N){"use strict";N(8).a.IncludesShadersStore.depthPrePass="#ifdef DEPTHPREPASS\ngl_FragColor=vec4(0.,0.,0.,1.0);\nreturn;\n#endif"},function(D,w,N){"use strict";N(8).a.IncludesShadersStore.bumpVertexDeclaration="#if defined(BUMP) || defined(PARALLAX) || defined(CLEARCOAT_BUMP)\n#if defined(TANGENT) && defined(NORMAL)\nvarying mat3 vTBN;\n#endif\n#endif\n"},function(D,w,N){"use strict";var F=N(8),k=(N(106),N(101),"colorPixelShader");F.a.ShadersStore[k]="#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#else\nuniform vec4 color;\n#endif\n#include<clipPlaneFragmentDeclaration>\nvoid main(void) {\n#include<clipPlaneFragment>\n#ifdef VERTEXCOLOR\ngl_FragColor=vColor;\n#else\ngl_FragColor=color;\n#endif\n}"},function(D,w,N){"use strict";var F=N(8),k=(N(74),N(108),N(77),N(78),N(75),N(102),"colorVertexShader");F.a.ShadersStore[k]="\nattribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n#include<clipPlaneVertexDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\n#ifdef MULTIVIEW\nuniform mat4 viewProjectionR;\n#endif\n\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\nvoid main(void) {\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPos=finalWorld*vec4(position,1.0);\n#ifdef MULTIVIEW\nif (gl_ViewID_OVR == 0u) {\ngl_Position=viewProjection*worldPos;\n} else {\ngl_Position=viewProjectionR*worldPos;\n}\n#else\ngl_Position=viewProjection*worldPos;\n#endif\n#include<clipPlaneVertex>\n#ifdef VERTEXCOLOR\n\nvColor=color;\n#endif\n}"},function(D,w,N){"use strict";(function(D){N.d(w,"b",(function(){return u})),N.d(w,"a",(function(){return q}));var F=N(1),k=N(7),j=N(11),z=N(95),G=N(25),H=N(2),X=N(85),u=function(){this.renderWidth=512,this.renderHeight=256,this.textureSize=512,this.deterministicLockstep=!1,this.lockstepMaxSteps=4},q=function(w){function i(N){void 0===N&&(N=new u);var F=w.call(this,null)||this;j.a.Instances.push(F),void 0===N.deterministicLockstep&&(N.deterministicLockstep=!1),void 0===N.lockstepMaxSteps&&(N.lockstepMaxSteps=4),F._options=N,F._caps={maxTexturesImageUnits:16,maxVertexTextureImageUnits:16,maxCombinedTexturesImageUnits:32,maxTextureSize:512,maxCubemapTextureSize:512,maxRenderTextureSize:512,maxVertexAttribs:16,maxVaryingVectors:16,maxFragmentUniformVectors:16,maxVertexUniformVectors:16,standardDerivatives:!1,astc:null,pvrtc:null,etc1:null,etc2:null,maxAnisotropy:0,uintIndices:!1,fragmentDepthSupported:!1,highPrecisionShaderSupported:!0,colorBufferFloat:!1,textureFloat:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloat:!1,textureHalfFloatLinearFiltering:!1,textureHalfFloatRender:!1,textureLOD:!1,drawBuffersExtension:!1,depthTextureExtension:!1,vertexArrayObject:!1,instancedArrays:!1,canUseTimestampForTimerQuery:!1,maxMSAASamples:1,blendMinMax:!1},k.a.Log("Babylon.js v"+j.a.Version+" - Null engine");var z="undefined"!=typeof self?self:void 0!==D?D:window;return"undefined"==typeof URL&&(z.URL={createObjectURL:function(){},revokeObjectURL:function(){}}),"undefined"==typeof Blob&&(z.Blob=function(){}),F}return Object(F.d)(i,w),i.prototype.isDeterministicLockStep=function(){return this._options.deterministicLockstep},i.prototype.getLockstepMaxSteps=function(){return this._options.lockstepMaxSteps},i.prototype.getHardwareScalingLevel=function(){return 1},i.prototype.createVertexBuffer=function(D){var w=new X.a;return w.references=1,w},i.prototype.createIndexBuffer=function(D){var w=new X.a;return w.references=1,w},i.prototype.clear=function(D,w,N,F){void 0===F&&(F=!1)},i.prototype.getRenderWidth=function(D){return void 0===D&&(D=!1),!D&&this._currentRenderTarget?this._currentRenderTarget.width:this._options.renderWidth},i.prototype.getRenderHeight=function(D){return void 0===D&&(D=!1),!D&&this._currentRenderTarget?this._currentRenderTarget.height:this._options.renderHeight},i.prototype.setViewport=function(D,w,N){this._cachedViewport=D},i.prototype.createShaderProgram=function(D,w,N,F,k){return{__SPECTOR_rebuildProgram:null}},i.prototype.getUniforms=function(D,w){return[]},i.prototype.getAttributes=function(D,w){return[]},i.prototype.bindSamplers=function(D){this._currentEffect=null},i.prototype.enableEffect=function(D){this._currentEffect=D,D.onBind&&D.onBind(D),D._onBindObservable&&D._onBindObservable.notifyObservers(D)},i.prototype.setState=function(D,w,N,F){void 0===w&&(w=0),void 0===F&&(F=!1)},i.prototype.setIntArray=function(D,w){},i.prototype.setIntArray2=function(D,w){},i.prototype.setIntArray3=function(D,w){},i.prototype.setIntArray4=function(D,w){},i.prototype.setFloatArray=function(D,w){},i.prototype.setFloatArray2=function(D,w){},i.prototype.setFloatArray3=function(D,w){},i.prototype.setFloatArray4=function(D,w){},i.prototype.setArray=function(D,w){},i.prototype.setArray2=function(D,w){},i.prototype.setArray3=function(D,w){},i.prototype.setArray4=function(D,w){},i.prototype.setMatrices=function(D,w){},i.prototype.setMatrix3x3=function(D,w){},i.prototype.setMatrix2x2=function(D,w){},i.prototype.setFloat=function(D,w){},i.prototype.setFloat2=function(D,w,N){},i.prototype.setFloat3=function(D,w,N,F){},i.prototype.setBool=function(D,w){},i.prototype.setFloat4=function(D,w,N,F,k){},i.prototype.setAlphaMode=function(D,w){void 0===w&&(w=!1),this._alphaMode!==D&&(this.alphaState.alphaBlend=D!==H.a.ALPHA_DISABLE,w||this.setDepthWrite(D===H.a.ALPHA_DISABLE),this._alphaMode=D)},i.prototype.bindBuffers=function(D,w,N){},i.prototype.wipeCaches=function(D){this.preventCacheWipeBetweenFrames||(this.resetTextureCache(),this._currentEffect=null,D&&(this._currentProgram=null,this.stencilState.reset(),this.depthCullingState.reset(),this.alphaState.reset()),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null)},i.prototype.draw=function(D,w,N,F){},i.prototype.drawElementsType=function(D,w,N,F){},i.prototype.drawArraysType=function(D,w,N,F){},i.prototype._createTexture=function(){return{}},i.prototype._releaseTexture=function(D){},i.prototype.createTexture=function(D,w,N,F,k,j,z,X,q,Z,J,$){void 0===k&&(k=H.a.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===j&&(j=null),void 0===z&&(z=null),void 0===X&&(X=null),void 0===q&&(q=null),void 0===Z&&(Z=null),void 0===J&&(J=null);var te=new G.a(this,G.b.Url),ie=String(D);return te.url=ie,te.generateMipMaps=!w,te.samplingMode=k,te.invertY=N,te.baseWidth=this._options.textureSize,te.baseHeight=this._options.textureSize,te.width=this._options.textureSize,te.height=this._options.textureSize,Z&&(te.format=Z),te.isReady=!0,j&&j(),this._internalTexturesCache.push(te),te},i.prototype.createRenderTargetTexture=function(D,w){var N=new z.a;void 0!==w&&"object"==typeof w?(N.generateMipMaps=w.generateMipMaps,N.generateDepthBuffer=void 0===w.generateDepthBuffer||w.generateDepthBuffer,N.generateStencilBuffer=N.generateDepthBuffer&&w.generateStencilBuffer,N.type=void 0===w.type?H.a.TEXTURETYPE_UNSIGNED_INT:w.type,N.samplingMode=void 0===w.samplingMode?H.a.TEXTURE_TRILINEAR_SAMPLINGMODE:w.samplingMode):(N.generateMipMaps=w,N.generateDepthBuffer=!0,N.generateStencilBuffer=!1,N.type=H.a.TEXTURETYPE_UNSIGNED_INT,N.samplingMode=H.a.TEXTURE_TRILINEAR_SAMPLINGMODE);var F=new G.a(this,G.b.RenderTarget),k=D.width||D,j=D.height||D;return F._depthStencilBuffer={},F._framebuffer={},F.baseWidth=k,F.baseHeight=j,F.width=k,F.height=j,F.isReady=!0,F.samples=1,F.generateMipMaps=!!N.generateMipMaps,F.samplingMode=N.samplingMode,F.type=N.type,F._generateDepthBuffer=N.generateDepthBuffer,F._generateStencilBuffer=!!N.generateStencilBuffer,this._internalTexturesCache.push(F),F},i.prototype.updateTextureSamplingMode=function(D,w){w.samplingMode=D},i.prototype.bindFramebuffer=function(D,w,N,F,k){this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=D,this._currentFramebuffer=D._MSAAFramebuffer?D._MSAAFramebuffer:D._framebuffer,this._cachedViewport&&!k&&this.setViewport(this._cachedViewport,N,F)},i.prototype.unBindFramebuffer=function(D,w,N){void 0===w&&(w=!1),this._currentRenderTarget=null,N&&(D._MSAAFramebuffer&&(this._currentFramebuffer=D._framebuffer),N()),this._currentFramebuffer=null},i.prototype.createDynamicVertexBuffer=function(D){var w=new X.a;return w.references=1,w.capacity=1,w},i.prototype.updateDynamicTexture=function(D,w,N,F,k){void 0===F&&(F=!1)},i.prototype.areAllEffectsReady=function(){return!0},i.prototype.getError=function(){return 0},i.prototype._getUnpackAlignement=function(){return 1},i.prototype._unpackFlipY=function(D){},i.prototype.updateDynamicIndexBuffer=function(D,w,N){void 0===N&&(N=0)},i.prototype.updateDynamicVertexBuffer=function(D,w,N,F){},i.prototype._bindTextureDirectly=function(D,w){return this._boundTexturesCache[this._activeChannel]!==w&&(this._boundTexturesCache[this._activeChannel]=w,!0)},i.prototype._bindTexture=function(D,w){D<0||this._bindTextureDirectly(0,w)},i.prototype._deleteBuffer=function(D){},i.prototype.releaseEffects=function(){},i.prototype.displayLoadingUI=function(){},i.prototype.hideLoadingUI=function(){},i.prototype._uploadCompressedDataToTextureDirectly=function(D,w,N,F,k,j,z){void 0===j&&(j=0),void 0===z&&(z=0)},i.prototype._uploadDataToTextureDirectly=function(D,w,N,F){void 0===N&&(N=0),void 0===F&&(F=0)},i.prototype._uploadArrayBufferViewToTexture=function(D,w,N,F){void 0===N&&(N=0),void 0===F&&(F=0)},i.prototype._uploadImageToTexture=function(D,w,N,F){void 0===N&&(N=0),void 0===F&&(F=0)},i}(j.a)}).call(this,N(144))},function(D,w,N){"use strict";N.r(w),function(D){N.d(w,"Debug",(function(){return X}));var F=N(114),k=N(93);N.d(w,"AbstractScene",(function(){return F.AbstractScene})),N.d(w,"KeepAssets",(function(){return F.KeepAssets})),N.d(w,"InstantiatedEntries",(function(){return F.InstantiatedEntries})),N.d(w,"AssetContainer",(function(){return F.AssetContainer})),N.d(w,"Node",(function(){return F.Node})),N.d(w,"Scene",(function(){return F.Scene})),N.d(w,"SceneComponentConstants",(function(){return F.SceneComponentConstants})),N.d(w,"Stage",(function(){return F.Stage})),N.d(w,"AbstractActionManager",(function(){return F.AbstractActionManager})),N.d(w,"Action",(function(){return F.Action})),N.d(w,"ActionEvent",(function(){return F.ActionEvent})),N.d(w,"ActionManager",(function(){return F.ActionManager})),N.d(w,"Condition",(function(){return F.Condition})),N.d(w,"ValueCondition",(function(){return F.ValueCondition})),N.d(w,"PredicateCondition",(function(){return F.PredicateCondition})),N.d(w,"StateCondition",(function(){return F.StateCondition})),N.d(w,"SwitchBooleanAction",(function(){return F.SwitchBooleanAction})),N.d(w,"SetStateAction",(function(){return F.SetStateAction})),N.d(w,"SetValueAction",(function(){return F.SetValueAction})),N.d(w,"IncrementValueAction",(function(){return F.IncrementValueAction})),N.d(w,"PlayAnimationAction",(function(){return F.PlayAnimationAction})),N.d(w,"StopAnimationAction",(function(){return F.StopAnimationAction})),N.d(w,"DoNothingAction",(function(){return F.DoNothingAction})),N.d(w,"CombineAction",(function(){return F.CombineAction})),N.d(w,"ExecuteCodeAction",(function(){return F.ExecuteCodeAction})),N.d(w,"SetParentAction",(function(){return F.SetParentAction})),N.d(w,"PlaySoundAction",(function(){return F.PlaySoundAction})),N.d(w,"StopSoundAction",(function(){return F.StopSoundAction})),N.d(w,"InterpolateValueAction",(function(){return F.InterpolateValueAction})),N.d(w,"Animatable",(function(){return F.Animatable})),N.d(w,"_IAnimationState",(function(){return F._IAnimationState})),N.d(w,"Animation",(function(){return F.Animation})),N.d(w,"TargetedAnimation",(function(){return F.TargetedAnimation})),N.d(w,"AnimationGroup",(function(){return F.AnimationGroup})),N.d(w,"AnimationPropertiesOverride",(function(){return F.AnimationPropertiesOverride})),N.d(w,"EasingFunction",(function(){return F.EasingFunction})),N.d(w,"CircleEase",(function(){return F.CircleEase})),N.d(w,"BackEase",(function(){return F.BackEase})),N.d(w,"BounceEase",(function(){return F.BounceEase})),N.d(w,"CubicEase",(function(){return F.CubicEase})),N.d(w,"ElasticEase",(function(){return F.ElasticEase})),N.d(w,"ExponentialEase",(function(){return F.ExponentialEase})),N.d(w,"PowerEase",(function(){return F.PowerEase})),N.d(w,"QuadraticEase",(function(){return F.QuadraticEase})),N.d(w,"QuarticEase",(function(){return F.QuarticEase})),N.d(w,"QuinticEase",(function(){return F.QuinticEase})),N.d(w,"SineEase",(function(){return F.SineEase})),N.d(w,"BezierCurveEase",(function(){return F.BezierCurveEase})),N.d(w,"RuntimeAnimation",(function(){return F.RuntimeAnimation})),N.d(w,"AnimationEvent",(function(){return F.AnimationEvent})),N.d(w,"AnimationKeyInterpolation",(function(){return F.AnimationKeyInterpolation})),N.d(w,"AnimationRange",(function(){return F.AnimationRange})),N.d(w,"Analyser",(function(){return F.Analyser})),N.d(w,"AudioEngine",(function(){return F.AudioEngine})),N.d(w,"AudioSceneComponent",(function(){return F.AudioSceneComponent})),N.d(w,"Sound",(function(){return F.Sound})),N.d(w,"SoundTrack",(function(){return F.SoundTrack})),N.d(w,"WeightedSound",(function(){return F.WeightedSound})),N.d(w,"Bone",(function(){return F.Bone})),N.d(w,"BoneIKController",(function(){return F.BoneIKController})),N.d(w,"BoneLookController",(function(){return F.BoneLookController})),N.d(w,"Skeleton",(function(){return F.Skeleton})),N.d(w,"CameraInputTypes",(function(){return F.CameraInputTypes})),N.d(w,"CameraInputsManager",(function(){return F.CameraInputsManager})),N.d(w,"Camera",(function(){return F.Camera})),N.d(w,"TargetCamera",(function(){return F.TargetCamera})),N.d(w,"FreeCamera",(function(){return F.FreeCamera})),N.d(w,"FreeCameraInputsManager",(function(){return F.FreeCameraInputsManager})),N.d(w,"TouchCamera",(function(){return F.TouchCamera})),N.d(w,"ArcRotateCamera",(function(){return F.ArcRotateCamera})),N.d(w,"ArcRotateCameraInputsManager",(function(){return F.ArcRotateCameraInputsManager})),N.d(w,"DeviceOrientationCamera",(function(){return F.DeviceOrientationCamera})),N.d(w,"FlyCamera",(function(){return F.FlyCamera})),N.d(w,"FlyCameraInputsManager",(function(){return F.FlyCameraInputsManager})),N.d(w,"FollowCamera",(function(){return F.FollowCamera})),N.d(w,"ArcFollowCamera",(function(){return F.ArcFollowCamera})),N.d(w,"FollowCameraInputsManager",(function(){return F.FollowCameraInputsManager})),N.d(w,"GamepadCamera",(function(){return F.GamepadCamera})),N.d(w,"UniversalCamera",(function(){return F.UniversalCamera})),N.d(w,"VirtualJoysticksCamera",(function(){return F.VirtualJoysticksCamera})),N.d(w,"Collider",(function(){return F.Collider})),N.d(w,"DefaultCollisionCoordinator",(function(){return F.DefaultCollisionCoordinator})),N.d(w,"PickingInfo",(function(){return F.PickingInfo})),N.d(w,"IntersectionInfo",(function(){return F.IntersectionInfo})),N.d(w,"_MeshCollisionData",(function(){return F._MeshCollisionData})),N.d(w,"BoundingBox",(function(){return F.BoundingBox})),N.d(w,"BoundingInfo",(function(){return F.BoundingInfo})),N.d(w,"BoundingSphere",(function(){return F.BoundingSphere})),N.d(w,"Ray",(function(){return F.Ray})),N.d(w,"AxesViewer",(function(){return F.AxesViewer})),N.d(w,"BoneAxesViewer",(function(){return F.BoneAxesViewer})),N.d(w,"DebugLayerTab",(function(){return F.DebugLayerTab})),N.d(w,"DebugLayer",(function(){return F.DebugLayer})),N.d(w,"PhysicsViewer",(function(){return F.PhysicsViewer})),N.d(w,"RayHelper",(function(){return F.RayHelper})),N.d(w,"SkeletonViewer",(function(){return F.SkeletonViewer})),N.d(w,"Constants",(function(){return F.Constants})),N.d(w,"ThinEngine",(function(){return F.ThinEngine})),N.d(w,"Engine",(function(){return F.Engine})),N.d(w,"EngineStore",(function(){return F.EngineStore})),N.d(w,"NullEngineOptions",(function(){return F.NullEngineOptions})),N.d(w,"NullEngine",(function(){return F.NullEngine})),N.d(w,"WebGLPipelineContext",(function(){return F.WebGLPipelineContext})),N.d(w,"WebGL2ShaderProcessor",(function(){return F.WebGL2ShaderProcessor})),N.d(w,"NativeEngine",(function(){return F.NativeEngine})),N.d(w,"KeyboardEventTypes",(function(){return F.KeyboardEventTypes})),N.d(w,"KeyboardInfo",(function(){return F.KeyboardInfo})),N.d(w,"KeyboardInfoPre",(function(){return F.KeyboardInfoPre})),N.d(w,"PointerEventTypes",(function(){return F.PointerEventTypes})),N.d(w,"PointerInfoBase",(function(){return F.PointerInfoBase})),N.d(w,"PointerInfoPre",(function(){return F.PointerInfoPre})),N.d(w,"PointerInfo",(function(){return F.PointerInfo})),N.d(w,"ClipboardEventTypes",(function(){return F.ClipboardEventTypes})),N.d(w,"ClipboardInfo",(function(){return F.ClipboardInfo})),N.d(w,"StickValues",(function(){return F.StickValues})),N.d(w,"Gamepad",(function(){return F.Gamepad})),N.d(w,"GenericPad",(function(){return F.GenericPad})),N.d(w,"GamepadManager",(function(){return F.GamepadManager})),N.d(w,"GamepadSystemSceneComponent",(function(){return F.GamepadSystemSceneComponent})),N.d(w,"Xbox360Button",(function(){return F.Xbox360Button})),N.d(w,"Xbox360Dpad",(function(){return F.Xbox360Dpad})),N.d(w,"Xbox360Pad",(function(){return F.Xbox360Pad})),N.d(w,"DualShockButton",(function(){return F.DualShockButton})),N.d(w,"DualShockDpad",(function(){return F.DualShockDpad})),N.d(w,"DualShockPad",(function(){return F.DualShockPad})),N.d(w,"AxisDragGizmo",(function(){return F.AxisDragGizmo})),N.d(w,"AxisScaleGizmo",(function(){return F.AxisScaleGizmo})),N.d(w,"BoundingBoxGizmo",(function(){return F.BoundingBoxGizmo})),N.d(w,"Gizmo",(function(){return F.Gizmo})),N.d(w,"GizmoManager",(function(){return F.GizmoManager})),N.d(w,"PlaneRotationGizmo",(function(){return F.PlaneRotationGizmo})),N.d(w,"PositionGizmo",(function(){return F.PositionGizmo})),N.d(w,"RotationGizmo",(function(){return F.RotationGizmo})),N.d(w,"ScaleGizmo",(function(){return F.ScaleGizmo})),N.d(w,"LightGizmo",(function(){return F.LightGizmo})),N.d(w,"PlaneDragGizmo",(function(){return F.PlaneDragGizmo})),N.d(w,"EnvironmentHelper",(function(){return F.EnvironmentHelper})),N.d(w,"PhotoDome",(function(){return F.PhotoDome})),N.d(w,"_forceSceneHelpersToBundle",(function(){return F._forceSceneHelpersToBundle})),N.d(w,"VideoDome",(function(){return F.VideoDome})),N.d(w,"EngineInstrumentation",(function(){return F.EngineInstrumentation})),N.d(w,"SceneInstrumentation",(function(){return F.SceneInstrumentation})),N.d(w,"_TimeToken",(function(){return F._TimeToken})),N.d(w,"EffectLayer",(function(){return F.EffectLayer})),N.d(w,"EffectLayerSceneComponent",(function(){return F.EffectLayerSceneComponent})),N.d(w,"GlowLayer",(function(){return F.GlowLayer})),N.d(w,"HighlightLayer",(function(){return F.HighlightLayer})),N.d(w,"Layer",(function(){return F.Layer})),N.d(w,"LayerSceneComponent",(function(){return F.LayerSceneComponent})),N.d(w,"LensFlare",(function(){return F.LensFlare})),N.d(w,"LensFlareSystem",(function(){return F.LensFlareSystem})),N.d(w,"LensFlareSystemSceneComponent",(function(){return F.LensFlareSystemSceneComponent})),N.d(w,"Light",(function(){return F.Light})),N.d(w,"ShadowLight",(function(){return F.ShadowLight})),N.d(w,"DirectionalLight",(function(){return F.DirectionalLight})),N.d(w,"HemisphericLight",(function(){return F.HemisphericLight})),N.d(w,"PointLight",(function(){return F.PointLight})),N.d(w,"SpotLight",(function(){return F.SpotLight})),N.d(w,"DefaultLoadingScreen",(function(){return F.DefaultLoadingScreen})),N.d(w,"SceneLoaderProgressEvent",(function(){return F.SceneLoaderProgressEvent})),N.d(w,"SceneLoaderAnimationGroupLoadingMode",(function(){return F.SceneLoaderAnimationGroupLoadingMode})),N.d(w,"SceneLoader",(function(){return F.SceneLoader})),N.d(w,"SceneLoaderFlags",(function(){return F.SceneLoaderFlags})),N.d(w,"ColorCurves",(function(){return F.ColorCurves})),N.d(w,"EffectFallbacks",(function(){return F.EffectFallbacks})),N.d(w,"Effect",(function(){return F.Effect})),N.d(w,"FresnelParameters",(function(){return F.FresnelParameters})),N.d(w,"ImageProcessingConfigurationDefines",(function(){return F.ImageProcessingConfigurationDefines})),N.d(w,"ImageProcessingConfiguration",(function(){return F.ImageProcessingConfiguration})),N.d(w,"Material",(function(){return F.Material})),N.d(w,"MaterialDefines",(function(){return F.MaterialDefines})),N.d(w,"MaterialHelper",(function(){return F.MaterialHelper})),N.d(w,"MultiMaterial",(function(){return F.MultiMaterial})),N.d(w,"PBRMaterial",(function(){return F.PBRMaterial})),N.d(w,"PushMaterial",(function(){return F.PushMaterial})),N.d(w,"ShaderMaterial",(function(){return F.ShaderMaterial})),N.d(w,"StandardMaterialDefines",(function(){return F.StandardMaterialDefines})),N.d(w,"StandardMaterial",(function(){return F.StandardMaterial})),N.d(w,"BaseTexture",(function(){return F.BaseTexture})),N.d(w,"CubeTexture",(function(){return F.CubeTexture})),N.d(w,"DynamicTexture",(function(){return F.DynamicTexture})),N.d(w,"EquiRectangularCubeTexture",(function(){return F.EquiRectangularCubeTexture})),N.d(w,"HDRCubeTexture",(function(){return F.HDRCubeTexture})),N.d(w,"InternalTextureSource",(function(){return F.InternalTextureSource})),N.d(w,"InternalTexture",(function(){return F.InternalTexture})),N.d(w,"MirrorTexture",(function(){return F.MirrorTexture})),N.d(w,"MultiRenderTarget",(function(){return F.MultiRenderTarget})),N.d(w,"RawTexture",(function(){return F.RawTexture})),N.d(w,"RenderTargetTexture",(function(){return F.RenderTargetTexture})),N.d(w,"Texture",(function(){return F.Texture})),N.d(w,"UniformBuffer",(function(){return F.UniformBuffer})),N.d(w,"MaterialFlags",(function(){return F.MaterialFlags})),N.d(w,"EffectRenderer",(function(){return F.EffectRenderer})),N.d(w,"EffectWrapper",(function(){return F.EffectWrapper})),N.d(w,"Scalar",(function(){return F.Scalar})),N.d(w,"Space",(function(){return F.Space})),N.d(w,"Axis",(function(){return F.Axis})),N.d(w,"Color3",(function(){return F.Color3})),N.d(w,"Color4",(function(){return F.Color4})),N.d(w,"TmpColors",(function(){return F.TmpColors})),N.d(w,"ToGammaSpace",(function(){return F.ToGammaSpace})),N.d(w,"ToLinearSpace",(function(){return F.ToLinearSpace})),N.d(w,"Epsilon",(function(){return F.Epsilon})),N.d(w,"Frustum",(function(){return F.Frustum})),N.d(w,"Plane",(function(){return F.Plane})),N.d(w,"Size",(function(){return F.Size})),N.d(w,"Vector2",(function(){return F.Vector2})),N.d(w,"Vector3",(function(){return F.Vector3})),N.d(w,"Vector4",(function(){return F.Vector4})),N.d(w,"Quaternion",(function(){return F.Quaternion})),N.d(w,"Matrix",(function(){return F.Matrix})),N.d(w,"TmpVectors",(function(){return F.TmpVectors})),N.d(w,"Viewport",(function(){return F.Viewport})),N.d(w,"SphericalHarmonics",(function(){return F.SphericalHarmonics})),N.d(w,"SphericalPolynomial",(function(){return F.SphericalPolynomial})),N.d(w,"AbstractMesh",(function(){return F.AbstractMesh})),N.d(w,"Buffer",(function(){return F.Buffer})),N.d(w,"VertexBuffer",(function(){return F.VertexBuffer})),N.d(w,"CSG",(function(){return F.CSG})),N.d(w,"Geometry",(function(){return F.Geometry})),N.d(w,"GroundMesh",(function(){return F.GroundMesh})),N.d(w,"TrailMesh",(function(){return F.TrailMesh})),N.d(w,"InstancedMesh",(function(){return F.InstancedMesh})),N.d(w,"LinesMesh",(function(){return F.LinesMesh})),N.d(w,"InstancedLinesMesh",(function(){return F.InstancedLinesMesh})),N.d(w,"_CreationDataStorage",(function(){return F._CreationDataStorage})),N.d(w,"_InstancesBatch",(function(){return F._InstancesBatch})),N.d(w,"Mesh",(function(){return F.Mesh})),N.d(w,"VertexData",(function(){return F.VertexData})),N.d(w,"MeshBuilder",(function(){return F.MeshBuilder})),N.d(w,"SimplificationSettings",(function(){return F.SimplificationSettings})),N.d(w,"SimplificationQueue",(function(){return F.SimplificationQueue})),N.d(w,"SimplificationType",(function(){return F.SimplificationType})),N.d(w,"SimplicationQueueSceneComponent",(function(){return F.SimplicationQueueSceneComponent})),N.d(w,"Polygon",(function(){return F.Polygon})),N.d(w,"PolygonMeshBuilder",(function(){return F.PolygonMeshBuilder})),N.d(w,"BaseSubMesh",(function(){return F.BaseSubMesh})),N.d(w,"SubMesh",(function(){return F.SubMesh})),N.d(w,"MeshLODLevel",(function(){return F.MeshLODLevel})),N.d(w,"TransformNode",(function(){return F.TransformNode})),N.d(w,"BoxBuilder",(function(){return F.BoxBuilder})),N.d(w,"SphereBuilder",(function(){return F.SphereBuilder})),N.d(w,"CylinderBuilder",(function(){return F.CylinderBuilder})),N.d(w,"TorusBuilder",(function(){return F.TorusBuilder})),N.d(w,"LinesBuilder",(function(){return F.LinesBuilder})),N.d(w,"PlaneBuilder",(function(){return F.PlaneBuilder})),N.d(w,"GroundBuilder",(function(){return F.GroundBuilder})),N.d(w,"DataBuffer",(function(){return F.DataBuffer})),N.d(w,"WebGLDataBuffer",(function(){return F.WebGLDataBuffer})),N.d(w,"MorphTarget",(function(){return F.MorphTarget})),N.d(w,"MorphTargetManager",(function(){return F.MorphTargetManager})),N.d(w,"Database",(function(){return F.Database})),N.d(w,"BaseParticleSystem",(function(){return F.BaseParticleSystem})),N.d(w,"GPUParticleSystem",(function(){return F.GPUParticleSystem})),N.d(w,"Particle",(function(){return F.Particle})),N.d(w,"ParticleHelper",(function(){return F.ParticleHelper})),N.d(w,"ParticleSystem",(function(){return F.ParticleSystem})),N.d(w,"_IDoNeedToBeInTheBuild",(function(){return F._IDoNeedToBeInTheBuild})),N.d(w,"ParticleSystemSet",(function(){return F.ParticleSystemSet})),N.d(w,"SolidParticle",(function(){return F.SolidParticle})),N.d(w,"ModelShape",(function(){return F.ModelShape})),N.d(w,"DepthSortedParticle",(function(){return F.DepthSortedParticle})),N.d(w,"SolidParticleSystem",(function(){return F.SolidParticleSystem})),N.d(w,"CloudPoint",(function(){return F.CloudPoint})),N.d(w,"PointsGroup",(function(){return F.PointsGroup})),N.d(w,"PointColor",(function(){return F.PointColor})),N.d(w,"PointsCloudSystem",(function(){return F.PointsCloudSystem})),N.d(w,"SubEmitterType",(function(){return F.SubEmitterType})),N.d(w,"SubEmitter",(function(){return F.SubEmitter})),N.d(w,"PhysicsEngine",(function(){return F.PhysicsEngine})),N.d(w,"PhysicsEngineSceneComponent",(function(){return F.PhysicsEngineSceneComponent})),N.d(w,"PhysicsHelper",(function(){return F.PhysicsHelper})),N.d(w,"PhysicsRadialExplosionEventOptions",(function(){return F.PhysicsRadialExplosionEventOptions})),N.d(w,"PhysicsUpdraftEventOptions",(function(){return F.PhysicsUpdraftEventOptions})),N.d(w,"PhysicsVortexEventOptions",(function(){return F.PhysicsVortexEventOptions})),N.d(w,"PhysicsRadialImpulseFalloff",(function(){return F.PhysicsRadialImpulseFalloff})),N.d(w,"PhysicsUpdraftMode",(function(){return F.PhysicsUpdraftMode})),N.d(w,"PhysicsImpostor",(function(){return F.PhysicsImpostor})),N.d(w,"PhysicsJoint",(function(){return F.PhysicsJoint})),N.d(w,"DistanceJoint",(function(){return F.DistanceJoint})),N.d(w,"MotorEnabledJoint",(function(){return F.MotorEnabledJoint})),N.d(w,"HingeJoint",(function(){return F.HingeJoint})),N.d(w,"Hinge2Joint",(function(){return F.Hinge2Joint})),N.d(w,"AnaglyphPostProcess",(function(){return F.AnaglyphPostProcess})),N.d(w,"BlackAndWhitePostProcess",(function(){return F.BlackAndWhitePostProcess})),N.d(w,"BloomEffect",(function(){return F.BloomEffect})),N.d(w,"BloomMergePostProcess",(function(){return F.BloomMergePostProcess})),N.d(w,"BlurPostProcess",(function(){return F.BlurPostProcess})),N.d(w,"ChromaticAberrationPostProcess",(function(){return F.ChromaticAberrationPostProcess})),N.d(w,"CircleOfConfusionPostProcess",(function(){return F.CircleOfConfusionPostProcess})),N.d(w,"ColorCorrectionPostProcess",(function(){return F.ColorCorrectionPostProcess})),N.d(w,"ConvolutionPostProcess",(function(){return F.ConvolutionPostProcess})),N.d(w,"DepthOfFieldBlurPostProcess",(function(){return F.DepthOfFieldBlurPostProcess})),N.d(w,"DepthOfFieldEffectBlurLevel",(function(){return F.DepthOfFieldEffectBlurLevel})),N.d(w,"DepthOfFieldEffect",(function(){return F.DepthOfFieldEffect})),N.d(w,"DepthOfFieldMergePostProcessOptions",(function(){return F.DepthOfFieldMergePostProcessOptions})),N.d(w,"DepthOfFieldMergePostProcess",(function(){return F.DepthOfFieldMergePostProcess})),N.d(w,"DisplayPassPostProcess",(function(){return F.DisplayPassPostProcess})),N.d(w,"ExtractHighlightsPostProcess",(function(){return F.ExtractHighlightsPostProcess})),N.d(w,"FilterPostProcess",(function(){return F.FilterPostProcess})),N.d(w,"FxaaPostProcess",(function(){return F.FxaaPostProcess})),N.d(w,"GrainPostProcess",(function(){return F.GrainPostProcess})),N.d(w,"HighlightsPostProcess",(function(){return F.HighlightsPostProcess})),N.d(w,"ImageProcessingPostProcess",(function(){return F.ImageProcessingPostProcess})),N.d(w,"MotionBlurPostProcess",(function(){return F.MotionBlurPostProcess})),N.d(w,"PassPostProcess",(function(){return F.PassPostProcess})),N.d(w,"PassCubePostProcess",(function(){return F.PassCubePostProcess})),N.d(w,"PostProcess",(function(){return F.PostProcess})),N.d(w,"PostProcessManager",(function(){return F.PostProcessManager})),N.d(w,"RefractionPostProcess",(function(){return F.RefractionPostProcess})),N.d(w,"SharpenPostProcess",(function(){return F.SharpenPostProcess})),N.d(w,"StereoscopicInterlacePostProcessI",(function(){return F.StereoscopicInterlacePostProcessI})),N.d(w,"StereoscopicInterlacePostProcess",(function(){return F.StereoscopicInterlacePostProcess})),N.d(w,"TonemappingOperator",(function(){return F.TonemappingOperator})),N.d(w,"TonemapPostProcess",(function(){return F.TonemapPostProcess})),N.d(w,"VolumetricLightScatteringPostProcess",(function(){return F.VolumetricLightScatteringPostProcess})),N.d(w,"VRDistortionCorrectionPostProcess",(function(){return F.VRDistortionCorrectionPostProcess})),N.d(w,"VRMultiviewToSingleviewPostProcess",(function(){return F.VRMultiviewToSingleviewPostProcess})),N.d(w,"ScreenSpaceReflectionPostProcess",(function(){return F.ScreenSpaceReflectionPostProcess})),N.d(w,"ReflectionProbe",(function(){return F.ReflectionProbe})),N.d(w,"BoundingBoxRenderer",(function(){return F.BoundingBoxRenderer})),N.d(w,"DepthRenderer",(function(){return F.DepthRenderer})),N.d(w,"DepthRendererSceneComponent",(function(){return F.DepthRendererSceneComponent})),N.d(w,"EdgesRenderer",(function(){return F.EdgesRenderer})),N.d(w,"LineEdgesRenderer",(function(){return F.LineEdgesRenderer})),N.d(w,"GeometryBufferRenderer",(function(){return F.GeometryBufferRenderer})),N.d(w,"GeometryBufferRendererSceneComponent",(function(){return F.GeometryBufferRendererSceneComponent})),N.d(w,"OutlineRenderer",(function(){return F.OutlineRenderer})),N.d(w,"RenderingGroup",(function(){return F.RenderingGroup})),N.d(w,"RenderingGroupInfo",(function(){return F.RenderingGroupInfo})),N.d(w,"RenderingManager",(function(){return F.RenderingManager})),N.d(w,"UtilityLayerRenderer",(function(){return F.UtilityLayerRenderer})),N.d(w,"Sprite",(function(){return F.Sprite})),N.d(w,"SpriteManager",(function(){return F.SpriteManager})),N.d(w,"SpriteMap",(function(){return F.SpriteMap})),N.d(w,"SpritePackedManager",(function(){return F.SpritePackedManager})),N.d(w,"SpriteSceneComponent",(function(){return F.SpriteSceneComponent})),N.d(w,"AlphaState",(function(){return F.AlphaState})),N.d(w,"DepthCullingState",(function(){return F.DepthCullingState})),N.d(w,"StencilState",(function(){return F.StencilState})),N.d(w,"AndOrNotEvaluator",(function(){return F.AndOrNotEvaluator})),N.d(w,"AssetTaskState",(function(){return F.AssetTaskState})),N.d(w,"AbstractAssetTask",(function(){return F.AbstractAssetTask})),N.d(w,"AssetsProgressEvent",(function(){return F.AssetsProgressEvent})),N.d(w,"MeshAssetTask",(function(){return F.MeshAssetTask})),N.d(w,"TextFileAssetTask",(function(){return F.TextFileAssetTask})),N.d(w,"BinaryFileAssetTask",(function(){return F.BinaryFileAssetTask})),N.d(w,"ImageAssetTask",(function(){return F.ImageAssetTask})),N.d(w,"TextureAssetTask",(function(){return F.TextureAssetTask})),N.d(w,"CubeTextureAssetTask",(function(){return F.CubeTextureAssetTask})),N.d(w,"HDRCubeTextureAssetTask",(function(){return F.HDRCubeTextureAssetTask})),N.d(w,"EquiRectangularCubeTextureAssetTask",(function(){return F.EquiRectangularCubeTextureAssetTask})),N.d(w,"AssetsManager",(function(){return F.AssetsManager})),N.d(w,"BasisTranscodeConfiguration",(function(){return F.BasisTranscodeConfiguration})),N.d(w,"BasisTools",(function(){return F.BasisTools})),N.d(w,"DDSTools",(function(){return F.DDSTools})),N.d(w,"expandToProperty",(function(){return F.expandToProperty})),N.d(w,"serialize",(function(){return F.serialize})),N.d(w,"serializeAsTexture",(function(){return F.serializeAsTexture})),N.d(w,"serializeAsColor3",(function(){return F.serializeAsColor3})),N.d(w,"serializeAsFresnelParameters",(function(){return F.serializeAsFresnelParameters})),N.d(w,"serializeAsVector2",(function(){return F.serializeAsVector2})),N.d(w,"serializeAsVector3",(function(){return F.serializeAsVector3})),N.d(w,"serializeAsMeshReference",(function(){return F.serializeAsMeshReference})),N.d(w,"serializeAsColorCurves",(function(){return F.serializeAsColorCurves})),N.d(w,"serializeAsColor4",(function(){return F.serializeAsColor4})),N.d(w,"serializeAsImageProcessingConfiguration",(function(){return F.serializeAsImageProcessingConfiguration})),N.d(w,"serializeAsQuaternion",(function(){return F.serializeAsQuaternion})),N.d(w,"serializeAsMatrix",(function(){return F.serializeAsMatrix})),N.d(w,"serializeAsCameraReference",(function(){return F.serializeAsCameraReference})),N.d(w,"SerializationHelper",(function(){return F.SerializationHelper})),N.d(w,"Deferred",(function(){return F.Deferred})),N.d(w,"EnvironmentTextureTools",(function(){return F.EnvironmentTextureTools})),N.d(w,"MeshExploder",(function(){return F.MeshExploder})),N.d(w,"FilesInput",(function(){return F.FilesInput})),N.d(w,"KhronosTextureContainer",(function(){return F.KhronosTextureContainer})),N.d(w,"EventState",(function(){return F.EventState})),N.d(w,"Observer",(function(){return F.Observer})),N.d(w,"MultiObserver",(function(){return F.MultiObserver})),N.d(w,"Observable",(function(){return F.Observable})),N.d(w,"PerformanceMonitor",(function(){return F.PerformanceMonitor})),N.d(w,"RollingAverage",(function(){return F.RollingAverage})),N.d(w,"PromisePolyfill",(function(){return F.PromisePolyfill})),N.d(w,"SceneOptimization",(function(){return F.SceneOptimization})),N.d(w,"TextureOptimization",(function(){return F.TextureOptimization})),N.d(w,"HardwareScalingOptimization",(function(){return F.HardwareScalingOptimization})),N.d(w,"ShadowsOptimization",(function(){return F.ShadowsOptimization})),N.d(w,"PostProcessesOptimization",(function(){return F.PostProcessesOptimization})),N.d(w,"LensFlaresOptimization",(function(){return F.LensFlaresOptimization})),N.d(w,"CustomOptimization",(function(){return F.CustomOptimization})),N.d(w,"ParticlesOptimization",(function(){return F.ParticlesOptimization})),N.d(w,"RenderTargetsOptimization",(function(){return F.RenderTargetsOptimization})),N.d(w,"MergeMeshesOptimization",(function(){return F.MergeMeshesOptimization})),N.d(w,"SceneOptimizerOptions",(function(){return F.SceneOptimizerOptions})),N.d(w,"SceneOptimizer",(function(){return F.SceneOptimizer})),N.d(w,"SceneSerializer",(function(){return F.SceneSerializer})),N.d(w,"SmartArray",(function(){return F.SmartArray})),N.d(w,"SmartArrayNoDuplicate",(function(){return F.SmartArrayNoDuplicate})),N.d(w,"StringDictionary",(function(){return F.StringDictionary})),N.d(w,"Tags",(function(){return F.Tags})),N.d(w,"TextureTools",(function(){return F.TextureTools})),N.d(w,"TGATools",(function(){return F.TGATools})),N.d(w,"Tools",(function(){return F.Tools})),N.d(w,"className",(function(){return F.className})),N.d(w,"AsyncLoop",(function(){return F.AsyncLoop})),N.d(w,"VideoRecorder",(function(){return F.VideoRecorder})),N.d(w,"JoystickAxis",(function(){return F.JoystickAxis})),N.d(w,"VirtualJoystick",(function(){return F.VirtualJoystick})),N.d(w,"WorkerPool",(function(){return F.WorkerPool})),N.d(w,"Logger",(function(){return F.Logger})),N.d(w,"_TypeStore",(function(){return F._TypeStore})),N.d(w,"FilesInputStore",(function(){return F.FilesInputStore})),N.d(w,"DeepCopier",(function(){return F.DeepCopier})),N.d(w,"PivotTools",(function(){return F.PivotTools})),N.d(w,"PrecisionDate",(function(){return F.PrecisionDate})),N.d(w,"ScreenshotTools",(function(){return F.ScreenshotTools})),N.d(w,"WebRequest",(function(){return F.WebRequest})),N.d(w,"InspectableType",(function(){return F.InspectableType})),N.d(w,"BRDFTextureTools",(function(){return F.BRDFTextureTools})),N.d(w,"RGBDTextureTools",(function(){return F.RGBDTextureTools})),N.d(w,"ColorGradient",(function(){return F.ColorGradient})),N.d(w,"Color3Gradient",(function(){return F.Color3Gradient})),N.d(w,"FactorGradient",(function(){return F.FactorGradient})),N.d(w,"GradientHelper",(function(){return F.GradientHelper})),N.d(w,"PerfCounter",(function(){return F.PerfCounter})),N.d(w,"RetryStrategy",(function(){return F.RetryStrategy})),N.d(w,"CanvasGenerator",(function(){return F.CanvasGenerator})),N.d(w,"LoadFileError",(function(){return F.LoadFileError})),N.d(w,"RequestFileError",(function(){return F.RequestFileError})),N.d(w,"ReadFileError",(function(){return F.ReadFileError})),N.d(w,"FileTools",(function(){return F.FileTools})),N.d(w,"StringTools",(function(){return F.StringTools})),N.d(w,"DataReader",(function(){return F.DataReader})),N.d(w,"MinMaxReducer",(function(){return F.MinMaxReducer})),N.d(w,"DepthReducer",(function(){return F.DepthReducer})),N.d(w,"WebXRCamera",(function(){return F.WebXRCamera})),N.d(w,"WebXREnterExitUIButton",(function(){return F.WebXREnterExitUIButton})),N.d(w,"WebXREnterExitUIOptions",(function(){return F.WebXREnterExitUIOptions})),N.d(w,"WebXREnterExitUI",(function(){return F.WebXREnterExitUI})),N.d(w,"WebXRExperienceHelper",(function(){return F.WebXRExperienceHelper})),N.d(w,"WebXRInput",(function(){return F.WebXRInput})),N.d(w,"WebXRInputSource",(function(){return F.WebXRInputSource})),N.d(w,"WebXRManagedOutputCanvasOptions",(function(){return F.WebXRManagedOutputCanvasOptions})),N.d(w,"WebXRManagedOutputCanvas",(function(){return F.WebXRManagedOutputCanvas})),N.d(w,"WebXRState",(function(){return F.WebXRState})),N.d(w,"WebXRSessionManager",(function(){return F.WebXRSessionManager})),N.d(w,"WebXRDefaultExperienceOptions",(function(){return F.WebXRDefaultExperienceOptions})),N.d(w,"WebXRDefaultExperience",(function(){return F.WebXRDefaultExperience})),N.d(w,"WebXRFeatureName",(function(){return F.WebXRFeatureName})),N.d(w,"WebXRFeaturesManager",(function(){return F.WebXRFeaturesManager})),N.d(w,"AutoRotationBehavior",(function(){return F.AutoRotationBehavior})),N.d(w,"BouncingBehavior",(function(){return F.BouncingBehavior})),N.d(w,"FramingBehavior",(function(){return F.FramingBehavior})),N.d(w,"AttachToBoxBehavior",(function(){return F.AttachToBoxBehavior})),N.d(w,"FadeInOutBehavior",(function(){return F.FadeInOutBehavior})),N.d(w,"MultiPointerScaleBehavior",(function(){return F.MultiPointerScaleBehavior})),N.d(w,"PointerDragBehavior",(function(){return F.PointerDragBehavior})),N.d(w,"SixDofDragBehavior",(function(){return F.SixDofDragBehavior})),N.d(w,"ArcRotateCameraGamepadInput",(function(){return F.ArcRotateCameraGamepadInput})),N.d(w,"ArcRotateCameraKeyboardMoveInput",(function(){return F.ArcRotateCameraKeyboardMoveInput})),N.d(w,"ArcRotateCameraMouseWheelInput",(function(){return F.ArcRotateCameraMouseWheelInput})),N.d(w,"ArcRotateCameraPointersInput",(function(){return F.ArcRotateCameraPointersInput})),N.d(w,"ArcRotateCameraVRDeviceOrientationInput",(function(){return F.ArcRotateCameraVRDeviceOrientationInput})),N.d(w,"FlyCameraKeyboardInput",(function(){return F.FlyCameraKeyboardInput})),N.d(w,"FlyCameraMouseInput",(function(){return F.FlyCameraMouseInput})),N.d(w,"FollowCameraKeyboardMoveInput",(function(){return F.FollowCameraKeyboardMoveInput})),N.d(w,"FollowCameraMouseWheelInput",(function(){return F.FollowCameraMouseWheelInput})),N.d(w,"FollowCameraPointersInput",(function(){return F.FollowCameraPointersInput})),N.d(w,"FreeCameraDeviceOrientationInput",(function(){return F.FreeCameraDeviceOrientationInput})),N.d(w,"FreeCameraGamepadInput",(function(){return F.FreeCameraGamepadInput})),N.d(w,"FreeCameraKeyboardMoveInput",(function(){return F.FreeCameraKeyboardMoveInput})),N.d(w,"FreeCameraMouseInput",(function(){return F.FreeCameraMouseInput})),N.d(w,"FreeCameraTouchInput",(function(){return F.FreeCameraTouchInput})),N.d(w,"FreeCameraVirtualJoystickInput",(function(){return F.FreeCameraVirtualJoystickInput})),N.d(w,"AnaglyphArcRotateCamera",(function(){return F.AnaglyphArcRotateCamera})),N.d(w,"AnaglyphFreeCamera",(function(){return F.AnaglyphFreeCamera})),N.d(w,"AnaglyphGamepadCamera",(function(){return F.AnaglyphGamepadCamera})),N.d(w,"AnaglyphUniversalCamera",(function(){return F.AnaglyphUniversalCamera})),N.d(w,"StereoscopicArcRotateCamera",(function(){return F.StereoscopicArcRotateCamera})),N.d(w,"StereoscopicFreeCamera",(function(){return F.StereoscopicFreeCamera})),N.d(w,"StereoscopicGamepadCamera",(function(){return F.StereoscopicGamepadCamera})),N.d(w,"StereoscopicUniversalCamera",(function(){return F.StereoscopicUniversalCamera})),N.d(w,"VRCameraMetrics",(function(){return F.VRCameraMetrics})),N.d(w,"VRDeviceOrientationArcRotateCamera",(function(){return F.VRDeviceOrientationArcRotateCamera})),N.d(w,"VRDeviceOrientationFreeCamera",(function(){return F.VRDeviceOrientationFreeCamera})),N.d(w,"VRDeviceOrientationGamepadCamera",(function(){return F.VRDeviceOrientationGamepadCamera})),N.d(w,"OnAfterEnteringVRObservableEvent",(function(){return F.OnAfterEnteringVRObservableEvent})),N.d(w,"VRExperienceHelper",(function(){return F.VRExperienceHelper})),N.d(w,"WebVRFreeCamera",(function(){return F.WebVRFreeCamera})),N.d(w,"Octree",(function(){return F.Octree})),N.d(w,"OctreeBlock",(function(){return F.OctreeBlock})),N.d(w,"OctreeSceneComponent",(function(){return F.OctreeSceneComponent})),N.d(w,"_OcclusionDataStorage",(function(){return F._OcclusionDataStorage})),N.d(w,"_forceTransformFeedbackToBundle",(function(){return F._forceTransformFeedbackToBundle})),N.d(w,"EngineView",(function(){return F.EngineView})),N.d(w,"DaydreamController",(function(){return F.DaydreamController})),N.d(w,"GearVRController",(function(){return F.GearVRController})),N.d(w,"GenericController",(function(){return F.GenericController})),N.d(w,"OculusTouchController",(function(){return F.OculusTouchController})),N.d(w,"PoseEnabledControllerType",(function(){return F.PoseEnabledControllerType})),N.d(w,"PoseEnabledControllerHelper",(function(){return F.PoseEnabledControllerHelper})),N.d(w,"PoseEnabledController",(function(){return F.PoseEnabledController})),N.d(w,"ViveController",(function(){return F.ViveController})),N.d(w,"WebVRController",(function(){return F.WebVRController})),N.d(w,"WindowsMotionController",(function(){return F.WindowsMotionController})),N.d(w,"XRWindowsMotionController",(function(){return F.XRWindowsMotionController})),N.d(w,"ShadowGenerator",(function(){return F.ShadowGenerator})),N.d(w,"CascadedShadowGenerator",(function(){return F.CascadedShadowGenerator})),N.d(w,"ShadowGeneratorSceneComponent",(function(){return F.ShadowGeneratorSceneComponent})),N.d(w,"_BabylonLoaderRegistered",(function(){return F._BabylonLoaderRegistered})),N.d(w,"BabylonFileLoaderConfiguration",(function(){return F.BabylonFileLoaderConfiguration})),N.d(w,"BackgroundMaterial",(function(){return F.BackgroundMaterial})),N.d(w,"PBRMaterialDefines",(function(){return F.PBRMaterialDefines})),N.d(w,"PBRBaseMaterial",(function(){return F.PBRBaseMaterial})),N.d(w,"PBRBaseSimpleMaterial",(function(){return F.PBRBaseSimpleMaterial})),N.d(w,"PBRMetallicRoughnessMaterial",(function(){return F.PBRMetallicRoughnessMaterial})),N.d(w,"PBRSpecularGlossinessMaterial",(function(){return F.PBRSpecularGlossinessMaterial})),N.d(w,"ColorGradingTexture",(function(){return F.ColorGradingTexture})),N.d(w,"RawCubeTexture",(function(){return F.RawCubeTexture})),N.d(w,"RawTexture3D",(function(){return F.RawTexture3D})),N.d(w,"RawTexture2DArray",(function(){return F.RawTexture2DArray})),N.d(w,"RefractionTexture",(function(){return F.RefractionTexture})),N.d(w,"VideoTexture",(function(){return F.VideoTexture})),N.d(w,"HtmlElementTexture",(function(){return F.HtmlElementTexture})),N.d(w,"NodeMaterialConnectionPointCompatibilityStates",(function(){return F.NodeMaterialConnectionPointCompatibilityStates})),N.d(w,"NodeMaterialConnectionPointDirection",(function(){return F.NodeMaterialConnectionPointDirection})),N.d(w,"NodeMaterialConnectionPoint",(function(){return F.NodeMaterialConnectionPoint})),N.d(w,"NodeMaterialBlock",(function(){return F.NodeMaterialBlock})),N.d(w,"NodeMaterialDefines",(function(){return F.NodeMaterialDefines})),N.d(w,"NodeMaterial",(function(){return F.NodeMaterial})),N.d(w,"Orientation",(function(){return F.Orientation})),N.d(w,"BezierCurve",(function(){return F.BezierCurve})),N.d(w,"Angle",(function(){return F.Angle})),N.d(w,"Arc2",(function(){return F.Arc2})),N.d(w,"Path2",(function(){return F.Path2})),N.d(w,"Path3D",(function(){return F.Path3D})),N.d(w,"Curve3",(function(){return F.Curve3})),N.d(w,"PositionNormalVertex",(function(){return F.PositionNormalVertex})),N.d(w,"PositionNormalTextureVertex",(function(){return F.PositionNormalTextureVertex})),N.d(w,"DracoCompression",(function(){return F.DracoCompression})),N.d(w,"TiledBoxBuilder",(function(){return F.TiledBoxBuilder})),N.d(w,"DiscBuilder",(function(){return F.DiscBuilder})),N.d(w,"RibbonBuilder",(function(){return F.RibbonBuilder})),N.d(w,"HemisphereBuilder",(function(){return F.HemisphereBuilder})),N.d(w,"TorusKnotBuilder",(function(){return F.TorusKnotBuilder})),N.d(w,"PolygonBuilder",(function(){return F.PolygonBuilder})),N.d(w,"ShapeBuilder",(function(){return F.ShapeBuilder})),N.d(w,"LatheBuilder",(function(){return F.LatheBuilder})),N.d(w,"TiledPlaneBuilder",(function(){return F.TiledPlaneBuilder})),N.d(w,"TubeBuilder",(function(){return F.TubeBuilder})),N.d(w,"PolyhedronBuilder",(function(){return F.PolyhedronBuilder})),N.d(w,"IcoSphereBuilder",(function(){return F.IcoSphereBuilder})),N.d(w,"DecalBuilder",(function(){return F.DecalBuilder})),N.d(w,"RecastJSPlugin",(function(){return F.RecastJSPlugin})),N.d(w,"RecastJSCrowd",(function(){return F.RecastJSCrowd})),N.d(w,"BoxParticleEmitter",(function(){return F.BoxParticleEmitter})),N.d(w,"ConeParticleEmitter",(function(){return F.ConeParticleEmitter})),N.d(w,"CylinderParticleEmitter",(function(){return F.CylinderParticleEmitter})),N.d(w,"CylinderDirectedParticleEmitter",(function(){return F.CylinderDirectedParticleEmitter})),N.d(w,"HemisphericParticleEmitter",(function(){return F.HemisphericParticleEmitter})),N.d(w,"PointParticleEmitter",(function(){return F.PointParticleEmitter})),N.d(w,"SphereParticleEmitter",(function(){return F.SphereParticleEmitter})),N.d(w,"SphereDirectedParticleEmitter",(function(){return F.SphereDirectedParticleEmitter})),N.d(w,"CustomParticleEmitter",(function(){return F.CustomParticleEmitter})),N.d(w,"MeshParticleEmitter",(function(){return F.MeshParticleEmitter})),N.d(w,"CannonJSPlugin",(function(){return F.CannonJSPlugin})),N.d(w,"AmmoJSPlugin",(function(){return F.AmmoJSPlugin})),N.d(w,"OimoJSPlugin",(function(){return F.OimoJSPlugin})),N.d(w,"PostProcessRenderEffect",(function(){return F.PostProcessRenderEffect})),N.d(w,"PostProcessRenderPipeline",(function(){return F.PostProcessRenderPipeline})),N.d(w,"PostProcessRenderPipelineManager",(function(){return F.PostProcessRenderPipelineManager})),N.d(w,"PostProcessRenderPipelineManagerSceneComponent",(function(){return F.PostProcessRenderPipelineManagerSceneComponent})),N.d(w,"CubeMapToSphericalPolynomialTools",(function(){return F.CubeMapToSphericalPolynomialTools})),N.d(w,"HDRTools",(function(){return F.HDRTools})),N.d(w,"PanoramaToCubeMapTools",(function(){return F.PanoramaToCubeMapTools})),N.d(w,"WebXRHitTestLegacy",(function(){return F.WebXRHitTestLegacy})),N.d(w,"WebXRAnchorSystem",(function(){return F.WebXRAnchorSystem})),N.d(w,"WebXRPlaneDetector",(function(){return F.WebXRPlaneDetector})),N.d(w,"WebXRBackgroundRemover",(function(){return F.WebXRBackgroundRemover})),N.d(w,"WebXRMotionControllerTeleportation",(function(){return F.WebXRMotionControllerTeleportation})),N.d(w,"WebXRControllerPointerSelection",(function(){return F.WebXRControllerPointerSelection})),N.d(w,"IWebXRControllerPhysicsOptions",(function(){return F.IWebXRControllerPhysicsOptions})),N.d(w,"WebXRControllerPhysics",(function(){return F.WebXRControllerPhysics})),N.d(w,"WebXRAbstractMotionController",(function(){return F.WebXRAbstractMotionController})),N.d(w,"WebXRControllerComponent",(function(){return F.WebXRControllerComponent})),N.d(w,"WebXRGenericTriggerMotionController",(function(){return F.WebXRGenericTriggerMotionController})),N.d(w,"WebXRMicrosoftMixedRealityController",(function(){return F.WebXRMicrosoftMixedRealityController})),N.d(w,"WebXRMotionControllerManager",(function(){return F.WebXRMotionControllerManager})),N.d(w,"WebXROculusTouchMotionController",(function(){return F.WebXROculusTouchMotionController})),N.d(w,"WebXRHTCViveMotionController",(function(){return F.WebXRHTCViveMotionController})),N.d(w,"WebXRProfiledMotionController",(function(){return F.WebXRProfiledMotionController})),N.d(w,"_DDSTextureLoader",(function(){return F._DDSTextureLoader})),N.d(w,"_ENVTextureLoader",(function(){return F._ENVTextureLoader})),N.d(w,"_KTXTextureLoader",(function(){return F._KTXTextureLoader})),N.d(w,"_TGATextureLoader",(function(){return F._TGATextureLoader})),N.d(w,"_BasisTextureLoader",(function(){return F._BasisTextureLoader})),N.d(w,"CustomProceduralTexture",(function(){return F.CustomProceduralTexture})),N.d(w,"NoiseProceduralTexture",(function(){return F.NoiseProceduralTexture})),N.d(w,"ProceduralTexture",(function(){return F.ProceduralTexture})),N.d(w,"ProceduralTextureSceneComponent",(function(){return F.ProceduralTextureSceneComponent})),N.d(w,"TexturePacker",(function(){return F.TexturePacker})),N.d(w,"TexturePackerFrame",(function(){return F.TexturePackerFrame})),N.d(w,"NodeMaterialBlockTargets",(function(){return F.NodeMaterialBlockTargets})),N.d(w,"NodeMaterialBlockConnectionPointTypes",(function(){return F.NodeMaterialBlockConnectionPointTypes})),N.d(w,"NodeMaterialBlockConnectionPointMode",(function(){return F.NodeMaterialBlockConnectionPointMode})),N.d(w,"NodeMaterialSystemValues",(function(){return F.NodeMaterialSystemValues})),N.d(w,"MultiplyBlock",(function(){return F.MultiplyBlock})),N.d(w,"AddBlock",(function(){return F.AddBlock})),N.d(w,"ScaleBlock",(function(){return F.ScaleBlock})),N.d(w,"ClampBlock",(function(){return F.ClampBlock})),N.d(w,"CrossBlock",(function(){return F.CrossBlock})),N.d(w,"DotBlock",(function(){return F.DotBlock})),N.d(w,"TransformBlock",(function(){return F.TransformBlock})),N.d(w,"RemapBlock",(function(){return F.RemapBlock})),N.d(w,"NormalizeBlock",(function(){return F.NormalizeBlock})),N.d(w,"TrigonometryBlockOperations",(function(){return F.TrigonometryBlockOperations})),N.d(w,"TrigonometryBlock",(function(){return F.TrigonometryBlock})),N.d(w,"ColorMergerBlock",(function(){return F.ColorMergerBlock})),N.d(w,"VectorMergerBlock",(function(){return F.VectorMergerBlock})),N.d(w,"ColorSplitterBlock",(function(){return F.ColorSplitterBlock})),N.d(w,"VectorSplitterBlock",(function(){return F.VectorSplitterBlock})),N.d(w,"LerpBlock",(function(){return F.LerpBlock})),N.d(w,"DivideBlock",(function(){return F.DivideBlock})),N.d(w,"SubtractBlock",(function(){return F.SubtractBlock})),N.d(w,"StepBlock",(function(){return F.StepBlock})),N.d(w,"OneMinusBlock",(function(){return F.OneMinusBlock})),N.d(w,"ViewDirectionBlock",(function(){return F.ViewDirectionBlock})),N.d(w,"FresnelBlock",(function(){return F.FresnelBlock})),N.d(w,"MaxBlock",(function(){return F.MaxBlock})),N.d(w,"MinBlock",(function(){return F.MinBlock})),N.d(w,"DistanceBlock",(function(){return F.DistanceBlock})),N.d(w,"LengthBlock",(function(){return F.LengthBlock})),N.d(w,"NegateBlock",(function(){return F.NegateBlock})),N.d(w,"PowBlock",(function(){return F.PowBlock})),N.d(w,"RandomNumberBlock",(function(){return F.RandomNumberBlock})),N.d(w,"ArcTan2Block",(function(){return F.ArcTan2Block})),N.d(w,"SmoothStepBlock",(function(){return F.SmoothStepBlock})),N.d(w,"ReciprocalBlock",(function(){return F.ReciprocalBlock})),N.d(w,"ReplaceColorBlock",(function(){return F.ReplaceColorBlock})),N.d(w,"PosterizeBlock",(function(){return F.PosterizeBlock})),N.d(w,"WaveBlockKind",(function(){return F.WaveBlockKind})),N.d(w,"WaveBlock",(function(){return F.WaveBlock})),N.d(w,"GradientBlockColorStep",(function(){return F.GradientBlockColorStep})),N.d(w,"GradientBlock",(function(){return F.GradientBlock})),N.d(w,"NLerpBlock",(function(){return F.NLerpBlock})),N.d(w,"WorleyNoise3DBlock",(function(){return F.WorleyNoise3DBlock})),N.d(w,"SimplexPerlin3DBlock",(function(){return F.SimplexPerlin3DBlock})),N.d(w,"NormalBlendBlock",(function(){return F.NormalBlendBlock})),N.d(w,"Rotate2dBlock",(function(){return F.Rotate2dBlock})),N.d(w,"ReflectBlock",(function(){return F.ReflectBlock})),N.d(w,"RefractBlock",(function(){return F.RefractBlock})),N.d(w,"DesaturateBlock",(function(){return F.DesaturateBlock})),N.d(w,"NodeMaterialOptimizer",(function(){return F.NodeMaterialOptimizer})),N.d(w,"DefaultRenderingPipeline",(function(){return F.DefaultRenderingPipeline})),N.d(w,"LensRenderingPipeline",(function(){return F.LensRenderingPipeline})),N.d(w,"SSAO2RenderingPipeline",(function(){return F.SSAO2RenderingPipeline})),N.d(w,"SSAORenderingPipeline",(function(){return F.SSAORenderingPipeline})),N.d(w,"StandardRenderingPipeline",(function(){return F.StandardRenderingPipeline})),N.d(w,"VertexOutputBlock",(function(){return F.VertexOutputBlock})),N.d(w,"BonesBlock",(function(){return F.BonesBlock})),N.d(w,"InstancesBlock",(function(){return F.InstancesBlock})),N.d(w,"MorphTargetsBlock",(function(){return F.MorphTargetsBlock})),N.d(w,"LightInformationBlock",(function(){return F.LightInformationBlock})),N.d(w,"FragmentOutputBlock",(function(){return F.FragmentOutputBlock})),N.d(w,"ImageProcessingBlock",(function(){return F.ImageProcessingBlock})),N.d(w,"PerturbNormalBlock",(function(){return F.PerturbNormalBlock})),N.d(w,"DiscardBlock",(function(){return F.DiscardBlock})),N.d(w,"FrontFacingBlock",(function(){return F.FrontFacingBlock})),N.d(w,"DerivativeBlock",(function(){return F.DerivativeBlock})),N.d(w,"FogBlock",(function(){return F.FogBlock})),N.d(w,"LightBlock",(function(){return F.LightBlock})),N.d(w,"TextureBlock",(function(){return F.TextureBlock})),N.d(w,"ReflectionTextureBlock",(function(){return F.ReflectionTextureBlock})),N.d(w,"InputBlock",(function(){return F.InputBlock})),N.d(w,"AnimatedInputBlockTypes",(function(){return F.AnimatedInputBlockTypes}));var j=void 0!==D?D:"undefined"!=typeof window?window:void 0;if(void 0!==j){j.BABYLON=z,j.BABYLON=j.BABYLON||{};var z=j.BABYLON;z.Debug=z.Debug||{};var G=[];for(var H in k)z.Debug[H]=k[H],G.push(H);for(var H in F)z[H]=F[H]}var X={AxesViewer:k.AxesViewer,BoneAxesViewer:k.BoneAxesViewer,PhysicsViewer:k.PhysicsViewer,SkeletonViewer:k.SkeletonViewer}}.call(this,N(144))}])}).call(this,N(6))},,,,function(D,w,N){"use strict";D.exports=function(D){var w=[];return w.toString=function toString(){return this.map((function(w){var N=function cssWithMappingToString(D,w){var N=D[1]||"",F=D[3];if(!F)return N;if(w&&"function"==typeof btoa){var k=function toComment(D){var w=btoa(unescape(encodeURIComponent(JSON.stringify(D)))),N="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(w);return"/*# ".concat(N," */")}(F),j=F.sources.map((function(D){return"/*# sourceURL=".concat(F.sourceRoot||"").concat(D," */")}));return[N].concat(j).concat([k]).join("\n")}return[N].join("\n")}(w,D);return w[2]?"@media ".concat(w[2]," {").concat(N,"}"):N})).join("")},w.i=function(D,N,F){"string"==typeof D&&(D=[[null,D,""]]);var k={};if(F)for(var j=0;j<this.length;j++){var z=this[j][0];null!=z&&(k[z]=!0)}for(var G=0;G<D.length;G++){var H=[].concat(D[G]);F&&k[H[0]]||(N&&(H[2]?H[2]="".concat(N," and ").concat(H[2]):H[2]=N),w.push(H))}},w}},,,function(D,w,N){D.exports=function(){"use strict";var D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(D){return typeof D}:function(D){return D&&"function"==typeof Symbol&&D.constructor===Symbol&&D!==Symbol.prototype?"symbol":typeof D};function t(){return!("undefined"==typeof window||!window.history||!window.history.pushState)}function n(D,w,N){this.root=null,this._routes=[],this._useHash=w,this._hash=void 0===N?"#":N,this._paused=!1,this._destroyed=!1,this._lastRouteResolved=null,this._notFoundHandler=null,this._defaultHandler=null,this._usePushState=!w&&t(),this._onLocationChange=this._onLocationChange.bind(this),this._genericHooks=null,this._historyAPIUpdateMethod="pushState",D?this.root=w?D.replace(/\/$/,"/"+this._hash):D.replace(/\/$/,""):w&&(this.root=this._cLoc().split(this._hash)[0].replace(/\/$/,"/"+this._hash)),this._listen(),this.updatePageLinks()}function o(D){return D instanceof RegExp?D:D.replace(/\/+$/,"").replace(/^\/+/,"^/")}function i(D){return D.replace(/\/$/,"").split("/").length}function s(D,w){return i(w)-i(D)}function r(D,w){return function(D){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).map((function(w){var N=function(D){var w=[];return{regexp:D instanceof RegExp?D:new RegExp(D.replace(n.PARAMETER_REGEXP,(function(D,N,F){return w.push(F),n.REPLACE_VARIABLE_REGEXP})).replace(n.WILDCARD_REGEXP,n.REPLACE_WILDCARD)+n.FOLLOWED_BY_SLASH_REGEXP,n.MATCH_REGEXP_FLAGS),paramNames:w}}(o(w.route)),F=N.regexp,k=N.paramNames,j=D.replace(/^\/+/,"/").match(F),z=function(D,w){return 0===w.length?null:D?D.slice(1,D.length).reduce((function(D,N,F){return null===D&&(D={}),D[w[F]]=decodeURIComponent(N),D}),null):null}(j,k);return!!j&&{match:j,route:w,params:z}})).filter((function(D){return D}))}(D,w)[0]||!1}function a(D,w){var N=w.map((function(w){return""===w.route||"*"===w.route?D:D.split(new RegExp(w.route+"($|/)"))[0]})),F=o(D);return N.length>1?N.reduce((function(D,w){return D.length>w.length&&(D=w),D}),N[0]):1===N.length?N[0]:F}function h(D,w,N){var F,s=function(D){return D.split(/\?(.*)?$/)[0]};return void 0===N&&(N="#"),t()&&!w?s(D).split(N)[0]:(F=D.split(N)).length>1?s(F[1]):s(F[0])}function u(w,N,F){if(N&&"object"===(void 0===N?"undefined":D(N))){if(N.before)return void N.before((function(){(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&(w(),N.after&&N.after(F))}),F);if(N.after)return w(),void(N.after&&N.after(F))}w()}return n.prototype={helpers:{match:r,root:a,clean:o,getOnlyURL:h},navigate:function(D,w){var N;return D=D||"",this._usePushState?(N=(N=(w?"":this._getRoot()+"/")+D.replace(/^\/+/,"/")).replace(/([^:])(\/{2,})/g,"$1/"),history[this._historyAPIUpdateMethod]({},"",N),this.resolve()):"undefined"!=typeof window&&(D=D.replace(new RegExp("^"+this._hash),""),window.location.href=window.location.href.replace(/#$/,"").replace(new RegExp(this._hash+".*$"),"")+this._hash+D),this},on:function(){for(var w=this,N=arguments.length,F=Array(N),k=0;k<N;k++)F[k]=arguments[k];if("function"==typeof F[0])this._defaultHandler={handler:F[0],hooks:F[1]};else if(F.length>=2)if("/"===F[0]){var j=F[1];"object"===D(F[1])&&(j=F[1].uses),this._defaultHandler={handler:j,hooks:F[2]}}else this._add(F[0],F[1],F[2]);else"object"===D(F[0])&&Object.keys(F[0]).sort(s).forEach((function(D){w.on(D,F[0][D])}));return this},off:function(D){return null!==this._defaultHandler&&D===this._defaultHandler.handler?this._defaultHandler=null:null!==this._notFoundHandler&&D===this._notFoundHandler.handler&&(this._notFoundHandler=null),this._routes=this._routes.reduce((function(w,N){return N.handler!==D&&w.push(N),w}),[]),this},notFound:function(D,w){return this._notFoundHandler={handler:D,hooks:w},this},resolve:function(D){var w,N,F=this,k=(D||this._cLoc()).replace(this._getRoot(),"");this._useHash&&(k=k.replace(new RegExp("^/"+this._hash),"/"));var j=function(D){return D.split(/\?(.*)?$/).slice(1).join("")}(D||this._cLoc()),z=h(k,this._useHash,this._hash);return!this._paused&&(this._lastRouteResolved&&z===this._lastRouteResolved.url&&j===this._lastRouteResolved.query?(this._lastRouteResolved.hooks&&this._lastRouteResolved.hooks.already&&this._lastRouteResolved.hooks.already(this._lastRouteResolved.params),!1):(N=r(z,this._routes))?(this._callLeave(),this._lastRouteResolved={url:z,query:j,hooks:N.route.hooks,params:N.params,name:N.route.name},w=N.route.handler,u((function(){u((function(){N.route.route instanceof RegExp?w.apply(void 0,N.match.slice(1,N.match.length)):w(N.params,j)}),N.route.hooks,N.params,F._genericHooks)}),this._genericHooks,N.params),N):this._defaultHandler&&(""===z||"/"===z||z===this._hash||function(D,w,N){if(t()&&!w)return!1;if(!D.match(N))return!1;var F=D.split(N);return F.length<2||""===F[1]}(z,this._useHash,this._hash))?(u((function(){u((function(){F._callLeave(),F._lastRouteResolved={url:z,query:j,hooks:F._defaultHandler.hooks},F._defaultHandler.handler(j)}),F._defaultHandler.hooks)}),this._genericHooks),!0):(this._notFoundHandler&&u((function(){u((function(){F._callLeave(),F._lastRouteResolved={url:z,query:j,hooks:F._notFoundHandler.hooks},F._notFoundHandler.handler(j)}),F._notFoundHandler.hooks)}),this._genericHooks),!1))},destroy:function(){this._routes=[],this._destroyed=!0,this._lastRouteResolved=null,this._genericHooks=null,clearTimeout(this._listeningInterval),"undefined"!=typeof window&&(window.removeEventListener("popstate",this._onLocationChange),window.removeEventListener("hashchange",this._onLocationChange))},updatePageLinks:function(){var D=this;"undefined"!=typeof document&&this._findLinks().forEach((function(w){w.hasListenerAttached||(w.addEventListener("click",(function(N){if((N.ctrlKey||N.metaKey)&&"a"==N.target.tagName.toLowerCase())return!1;var F=D.getLinkPath(w);D._destroyed||(N.preventDefault(),D.navigate(F.replace(/\/+$/,"").replace(/^\/+/,"/")))})),w.hasListenerAttached=!0)}))},generate:function(D){var w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},N=this._routes.reduce((function(N,F){var k;if(F.name===D)for(k in N=F.route,w)N=N.toString().replace(":"+k,w[k]);return N}),"");return this._useHash?this._hash+N:N},link:function(D){return this._getRoot()+D},pause:function(){var D=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._paused=D,this._historyAPIUpdateMethod=D?"replaceState":"pushState"},resume:function(){this.pause(!1)},historyAPIUpdateMethod:function(D){return void 0===D?this._historyAPIUpdateMethod:(this._historyAPIUpdateMethod=D,D)},disableIfAPINotAvailable:function(){t()||this.destroy()},lastRouteResolved:function(){return this._lastRouteResolved},getLinkPath:function(D){return D.getAttribute("href")},hooks:function(D){this._genericHooks=D},_add:function(w){var N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return"string"==typeof w&&(w=encodeURI(w)),this._routes.push("object"===(void 0===N?"undefined":D(N))?{route:w,handler:N.uses,name:N.as,hooks:F||N.hooks}:{route:w,handler:N,hooks:F}),this._add},_getRoot:function(){return null!==this.root||(this.root=a(this._cLoc().split("?")[0],this._routes)),this.root},_listen:function(){var D=this;if(this._usePushState)window.addEventListener("popstate",this._onLocationChange);else if("undefined"!=typeof window&&"onhashchange"in window)window.addEventListener("hashchange",this._onLocationChange);else{var w=this._cLoc(),N=void 0,F=void 0;(F=function(){N=D._cLoc(),w!==N&&(w=N,D.resolve()),D._listeningInterval=setTimeout(F,200)})()}},_cLoc:function(){return"undefined"!=typeof window?void 0!==window.__NAVIGO_WINDOW_LOCATION_MOCK__?window.__NAVIGO_WINDOW_LOCATION_MOCK__:o(window.location.href):""},_findLinks:function(){return[].slice.call(document.querySelectorAll("[data-navigo]"))},_onLocationChange:function(){this.resolve()},_callLeave:function(){var D=this._lastRouteResolved;D&&D.hooks&&D.hooks.leave&&D.hooks.leave(D.params)}},n.PARAMETER_REGEXP=/([:*])(\w+)/g,n.WILDCARD_REGEXP=/\*/g,n.REPLACE_VARIABLE_REGEXP="([^/]+)",n.REPLACE_WILDCARD="(?:.*)",n.FOLLOWED_BY_SLASH_REGEXP="(?:/$|$)",n.MATCH_REGEXP_FLAGS="",n}()},,function(D,w,N){"use strict";N.r(w),N.d(w,"v1",(function(){return J})),N.d(w,"v3",(function(){return $})),N.d(w,"v4",(function(){return te})),N.d(w,"v5",(function(){return ie}));var F="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),k=new Uint8Array(16);function rng(){if(!F)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return F(k)}for(var j=[],z=0;z<256;++z)j[z]=(z+256).toString(16).substr(1);var G,H,X=function bytesToUuid(D,w){var N=w||0,F=j;return[F[D[N++]],F[D[N++]],F[D[N++]],F[D[N++]],"-",F[D[N++]],F[D[N++]],"-",F[D[N++]],F[D[N++]],"-",F[D[N++]],F[D[N++]],"-",F[D[N++]],F[D[N++]],F[D[N++]],F[D[N++]],F[D[N++]],F[D[N++]]].join("")},q=0,Z=0;var J=function v1(D,w,N){var F=w&&N||0,k=w||[],j=(D=D||{}).node||G,z=void 0!==D.clockseq?D.clockseq:H;if(null==j||null==z){var J=D.random||(D.rng||rng)();null==j&&(j=G=[1|J[0],J[1],J[2],J[3],J[4],J[5]]),null==z&&(z=H=16383&(J[6]<<8|J[7]))}var $=void 0!==D.msecs?D.msecs:(new Date).getTime(),te=void 0!==D.nsecs?D.nsecs:Z+1,ie=$-q+(te-Z)/1e4;if(ie<0&&void 0===D.clockseq&&(z=z+1&16383),(ie<0||$>q)&&void 0===D.nsecs&&(te=0),te>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");q=$,Z=te,H=z;var oe=(1e4*(268435455&($+=122192928e5))+te)%4294967296;k[F++]=oe>>>24&255,k[F++]=oe>>>16&255,k[F++]=oe>>>8&255,k[F++]=255&oe;var ce=$/4294967296*1e4&268435455;k[F++]=ce>>>8&255,k[F++]=255&ce,k[F++]=ce>>>24&15|16,k[F++]=ce>>>16&255,k[F++]=z>>>8|128,k[F++]=255&z;for(var he=0;he<6;++he)k[F+he]=j[he];return w||X(k)};var v35=function(D,w,N){var F=function generateUUID(D,F,k,j){var z=k&&j||0;if("string"==typeof D&&(D=function stringToBytes(D){D=unescape(encodeURIComponent(D));for(var w=new Array(D.length),N=0;N<D.length;N++)w[N]=D.charCodeAt(N);return w}(D)),"string"==typeof F&&(F=function uuidToBytes(D){var w=[];return D.replace(/[a-fA-F0-9]{2}/g,(function(D){w.push(parseInt(D,16))})),w}(F)),!Array.isArray(D))throw TypeError("value must be an array of bytes");if(!Array.isArray(F)||16!==F.length)throw TypeError("namespace must be uuid string or an Array of 16 byte values");var G=N(F.concat(D));if(G[6]=15&G[6]|w,G[8]=63&G[8]|128,k)for(var H=0;H<16;++H)k[z+H]=G[H];return k||X(G)};try{F.name=D}catch(D){}return F.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",F.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",F};function safeAdd(D,w){var N=(65535&D)+(65535&w);return(D>>16)+(w>>16)+(N>>16)<<16|65535&N}function md5cmn(D,w,N,F,k,j){return safeAdd(function bitRotateLeft(D,w){return D<<w|D>>>32-w}(safeAdd(safeAdd(w,D),safeAdd(F,j)),k),N)}function md5ff(D,w,N,F,k,j,z){return md5cmn(w&N|~w&F,D,w,k,j,z)}function md5gg(D,w,N,F,k,j,z){return md5cmn(w&F|N&~F,D,w,k,j,z)}function md5hh(D,w,N,F,k,j,z){return md5cmn(w^N^F,D,w,k,j,z)}function md5ii(D,w,N,F,k,j,z){return md5cmn(N^(w|~F),D,w,k,j,z)}var $=v35("v3",48,(function md5(D){if("string"==typeof D){var w=unescape(encodeURIComponent(D));D=new Array(w.length);for(var N=0;N<w.length;N++)D[N]=w.charCodeAt(N)}return function md5ToHexEncodedArray(D){var w,N,F,k=[],j=32*D.length;for(w=0;w<j;w+=8)N=D[w>>5]>>>w%32&255,F=parseInt("0123456789abcdef".charAt(N>>>4&15)+"0123456789abcdef".charAt(15&N),16),k.push(F);return k}(function wordsToMd5(D,w){var N,F,k,j,z;D[w>>5]|=128<<w%32,D[14+(w+64>>>9<<4)]=w;var G=1732584193,H=-271733879,X=-1732584194,q=271733878;for(N=0;N<D.length;N+=16)F=G,k=H,j=X,z=q,G=md5ff(G,H,X,q,D[N],7,-680876936),q=md5ff(q,G,H,X,D[N+1],12,-389564586),X=md5ff(X,q,G,H,D[N+2],17,606105819),H=md5ff(H,X,q,G,D[N+3],22,-1044525330),G=md5ff(G,H,X,q,D[N+4],7,-176418897),q=md5ff(q,G,H,X,D[N+5],12,1200080426),X=md5ff(X,q,G,H,D[N+6],17,-1473231341),H=md5ff(H,X,q,G,D[N+7],22,-45705983),G=md5ff(G,H,X,q,D[N+8],7,1770035416),q=md5ff(q,G,H,X,D[N+9],12,-1958414417),X=md5ff(X,q,G,H,D[N+10],17,-42063),H=md5ff(H,X,q,G,D[N+11],22,-1990404162),G=md5ff(G,H,X,q,D[N+12],7,1804603682),q=md5ff(q,G,H,X,D[N+13],12,-40341101),X=md5ff(X,q,G,H,D[N+14],17,-1502002290),H=md5ff(H,X,q,G,D[N+15],22,1236535329),G=md5gg(G,H,X,q,D[N+1],5,-165796510),q=md5gg(q,G,H,X,D[N+6],9,-1069501632),X=md5gg(X,q,G,H,D[N+11],14,643717713),H=md5gg(H,X,q,G,D[N],20,-373897302),G=md5gg(G,H,X,q,D[N+5],5,-701558691),q=md5gg(q,G,H,X,D[N+10],9,38016083),X=md5gg(X,q,G,H,D[N+15],14,-660478335),H=md5gg(H,X,q,G,D[N+4],20,-405537848),G=md5gg(G,H,X,q,D[N+9],5,568446438),q=md5gg(q,G,H,X,D[N+14],9,-1019803690),X=md5gg(X,q,G,H,D[N+3],14,-187363961),H=md5gg(H,X,q,G,D[N+8],20,1163531501),G=md5gg(G,H,X,q,D[N+13],5,-1444681467),q=md5gg(q,G,H,X,D[N+2],9,-51403784),X=md5gg(X,q,G,H,D[N+7],14,1735328473),H=md5gg(H,X,q,G,D[N+12],20,-1926607734),G=md5hh(G,H,X,q,D[N+5],4,-378558),q=md5hh(q,G,H,X,D[N+8],11,-2022574463),X=md5hh(X,q,G,H,D[N+11],16,1839030562),H=md5hh(H,X,q,G,D[N+14],23,-35309556),G=md5hh(G,H,X,q,D[N+1],4,-1530992060),q=md5hh(q,G,H,X,D[N+4],11,1272893353),X=md5hh(X,q,G,H,D[N+7],16,-155497632),H=md5hh(H,X,q,G,D[N+10],23,-1094730640),G=md5hh(G,H,X,q,D[N+13],4,681279174),q=md5hh(q,G,H,X,D[N],11,-358537222),X=md5hh(X,q,G,H,D[N+3],16,-722521979),H=md5hh(H,X,q,G,D[N+6],23,76029189),G=md5hh(G,H,X,q,D[N+9],4,-640364487),q=md5hh(q,G,H,X,D[N+12],11,-421815835),X=md5hh(X,q,G,H,D[N+15],16,530742520),H=md5hh(H,X,q,G,D[N+2],23,-995338651),G=md5ii(G,H,X,q,D[N],6,-198630844),q=md5ii(q,G,H,X,D[N+7],10,1126891415),X=md5ii(X,q,G,H,D[N+14],15,-1416354905),H=md5ii(H,X,q,G,D[N+5],21,-57434055),G=md5ii(G,H,X,q,D[N+12],6,1700485571),q=md5ii(q,G,H,X,D[N+3],10,-1894986606),X=md5ii(X,q,G,H,D[N+10],15,-1051523),H=md5ii(H,X,q,G,D[N+1],21,-2054922799),G=md5ii(G,H,X,q,D[N+8],6,1873313359),q=md5ii(q,G,H,X,D[N+15],10,-30611744),X=md5ii(X,q,G,H,D[N+6],15,-1560198380),H=md5ii(H,X,q,G,D[N+13],21,1309151649),G=md5ii(G,H,X,q,D[N+4],6,-145523070),q=md5ii(q,G,H,X,D[N+11],10,-1120210379),X=md5ii(X,q,G,H,D[N+2],15,718787259),H=md5ii(H,X,q,G,D[N+9],21,-343485551),G=safeAdd(G,F),H=safeAdd(H,k),X=safeAdd(X,j),q=safeAdd(q,z);return[G,H,X,q]}(function bytesToWords(D){var w,N=[];for(N[(D.length>>2)-1]=void 0,w=0;w<N.length;w+=1)N[w]=0;var F=8*D.length;for(w=0;w<F;w+=8)N[w>>5]|=(255&D[w/8])<<w%32;return N}(D),8*D.length))}));var te=function v4(D,w,N){var F=w&&N||0;"string"==typeof D&&(w="binary"===D?new Array(16):null,D=null);var k=(D=D||{}).random||(D.rng||rng)();if(k[6]=15&k[6]|64,k[8]=63&k[8]|128,w)for(var j=0;j<16;++j)w[F+j]=k[j];return w||X(k)};function f(D,w,N,F){switch(D){case 0:return w&N^~w&F;case 1:return w^N^F;case 2:return w&N^w&F^N&F;case 3:return w^N^F}}function ROTL(D,w){return D<<w|D>>>32-w}var ie=v35("v5",80,(function sha1(D){var w=[1518500249,1859775393,2400959708,3395469782],N=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof D){var F=unescape(encodeURIComponent(D));D=new Array(F.length);for(var k=0;k<F.length;k++)D[k]=F.charCodeAt(k)}D.push(128);var j=D.length/4+2,z=Math.ceil(j/16),G=new Array(z);for(k=0;k<z;k++){G[k]=new Array(16);for(var H=0;H<16;H++)G[k][H]=D[64*k+4*H]<<24|D[64*k+4*H+1]<<16|D[64*k+4*H+2]<<8|D[64*k+4*H+3]}for(G[z-1][14]=8*(D.length-1)/Math.pow(2,32),G[z-1][14]=Math.floor(G[z-1][14]),G[z-1][15]=8*(D.length-1)&4294967295,k=0;k<z;k++){for(var X=new Array(80),q=0;q<16;q++)X[q]=G[k][q];for(q=16;q<80;q++)X[q]=ROTL(X[q-3]^X[q-8]^X[q-14]^X[q-16],1);var Z=N[0],J=N[1],$=N[2],te=N[3],ie=N[4];for(q=0;q<80;q++){var oe=Math.floor(q/20),ce=ROTL(Z,5)+f(oe,J,$,te)+ie+w[oe]+X[q]>>>0;ie=te,te=$,$=ROTL(J,30)>>>0,J=Z,Z=ce}N[0]=N[0]+Z>>>0,N[1]=N[1]+J>>>0,N[2]=N[2]+$>>>0,N[3]=N[3]+te>>>0,N[4]=N[4]+ie>>>0}return[N[0]>>24&255,N[0]>>16&255,N[0]>>8&255,255&N[0],N[1]>>24&255,N[1]>>16&255,N[1]>>8&255,255&N[1],N[2]>>24&255,N[2]>>16&255,N[2]>>8&255,255&N[2],N[3]>>24&255,N[3]>>16&255,N[3]>>8&255,255&N[3],N[4]>>24&255,N[4]>>16&255,N[4]>>8&255,255&N[4]]}))}]]);